     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Interest accruals extract')                   *
     F*****************************************************************
     F*                                                               *
     F*  Midas Customer Lending Module                                *
     F*                                                               *
     F*  LE1110 - Interest Accruals Extract                           *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  NOTE: Check LE5110 for changes that may apply to it if there *                       CAS005
      *        are amendments done to this program.                   *                       CAS005
      *                                                               *                       CAS005
      *  Last Amend No. AR830785           Date 07May13               *
      *  Prev Amend No. AR996895           Date 25Nov12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR996000           Date 02Jul12               *
      *                 CLE064             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CSC042             Date 16Feb09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 248430             Date 21Jun07               *
      *                 248090             Date 26May07               *
      *                 246141             Date 26Mar07               *
      *                 244648             Date 28Feb07               *
      *                 245538             Date 09Feb07               *
      *                 245082             Date 30Jan07               *
      *                 164847             Date 30Nov06               *
      *                 137353             Date 28Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027A            Date 10May06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG10708           Date 27Feb06               *
      *                 BUG8633            Date 22Sep05               *
      *                 CLE042             Date 06Sep05               *
      *                 BUG8157            Date 25Apr05               *
      *                 BUG7739            Date 05Aug05               *
      *                 CIR013             Date 25Apr05               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 28Oct03               *
      *                 CAP074             Date 16Sep03               *
      *                 218782             Date 22Jun03               *
      *                 CLE031             Date 17Feb03               *
      *                 CAS005             Date 16Dec02               *
      *                 CLE028             Date 27Jun02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 142199             DATE 25May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 154799             Date 04Mar99               *
      *                 CEU004             Date 29MAR98               *
      *                 121768             DATE 19FEB98               *
     F*                 126017             DATE 20MAR97               *
     F*                 130846             DATE 19FEB98               *
     F*                 CLE005             Date 22May97               *
     F*                 105752             Date 17Feb97               *
     F*                 097885             DATE 31JAN97               *
     F*                 095244             DATE 01NOV95               *
     F*                 095238             DATE 31OCT95               *
     F*                 090901             DATE 18AUG95               *
     F*                 087811             DATE 31MAY95               *
     F*                 S01465             DATE 22MAR94               *
     F*                 066550             DATE 04FEB94               *
     F*                 S01408             DATE 30JUN93               *  *
     F*                 E49092             DATE 31MAR93               *
     F*                 E38567             DATE 13JAN93               *
     F*                 S01392             DATE 14SEP92               *
     F*                 E20522             DATE 04JUN92               *
     F*                 E26745             DATE 31MAR92               *
     F*                 S01220             DATE 15MAR91               *
     F*                 BHF129             DATE 02AUG90               *
     F*                 S01260             DATE 15MAR90               *
     F*                 S01194             DATE 15JAN90               *
     F*                 E18465             DATE 13DEC89               *
     F*                 E80742             DATE 13DEC89               *
     F*                 S01195             DATE 08/08/89              *
     F*                 S01117             DATE 19/07/89              *
     F*                 E12964             DATE 20/05/88              *
     F*                 E08921             DATE 08/04/88              *
     F*                 S01147             DATE 20/11/87              *
     F*                 E10538             DATE 29/04/87              *
     F*                 E10536             DATE 29/04/87              *
     F*                 E49685             DATE 10/04/87              *
     F*                 E80945             DATE 25/06/86              *
     F*                 E47162             DATE 11/06/86              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  AR830785 - Recompiled due to changes in core hook RULE78Z1.  *
      *             (Child: AR830786)                                 *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR996000 - After COB, a negative interest rate generated an  *
      *             Accrued Interest for Loans                        *
      *  CLE064 - Enhancement of Lending Frequencies                  *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus                                          *
      *  CSC042 - COB Performance fix.                                *
      *           Cut down no of AOBRCHR* calls. At RZB Sofia AO Pgm  *
      *           is called 220K times for 205 branches               *
      *  248430 - Incorrect Accrued to Date amount shown on the       *
      *           report.                                             *
      *  248090 - Incorrect figures on the accruals report.           *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  244648 - Reverse BUG7739.  When ZIEND is less than ZIBEG,    *
      *           AMTA should already be equal to zero.               *
      *  245538 - Reverse BUG10708. To fix BUG10708, add a clas field *
      *           in CLOANC.                                          *
      *  245082 - Loans with first and last day accrual should be     *
      *           treated as first day accruals until maturity        *
      *           date.  Then add one day on the maturity date.       *
      *           Patterned after fix 235784 from Release 4.          *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  137353 - Add new system value "FutValLoansOnIntAccr" to       *
      *           specify whether future Valued Loans are included    *
      *           on LE1120P1 (Interest Accruals Report)              *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A - Conversion Of Customer Number to Alpha             *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG10708 - DB error 3 in LE1120. LTYP and SUTP change        *
      *             upon chaining in CLOANC.                          *
      *  BUG8633 - Discrepancies in reports - LE1120                  *
      *            Applied fix 225734.                                *
      *  CLE042 - Extended Loan Sub Type                              *
      *  BUG8157 - LEC5110  00001 failed due to DBERR                 *
      *  BUG7739 - Negative Interest "To Accrue".                     *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter Mismatch                                  *
      *  CAP074 - Lending API enhancements - Loans input.             *
      *  218782 - Check system value Settlement09Postings to decide   *
      *           whether to use Settlement or Transaction Ccy.       *
      *  CLE031 - Lending Enhancements.                               *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  142199 - Incorrect 'PERIOD TO' field in LE1120P1 rpt for     *
      *           repayment type 1 or 3.                              *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *  CIR004 - Dealing Calculation Method Change.                  *
      *         - Recompiled due to GLINTC and ZINTDY changes         *
      *  154799 - Recompiled due to changes in /COPY,ZACCH            *
     F*  CEU004 - LE Settlement Ccy Conversion Upgrade to DBA R2.0    *
     F*  121768 - Recompile over changed GLINTCZ1                     *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC. Add SR/ZDAT10                 *
     F*  130846 - Wrong switchable feature passed to access object    *
     F*           to determine whether CLE005 is on.                  *
     F*  CLE005 - Customer Lending Enhancements - Others (T3)         *
     F*  105752 - If frequency is blank do not change the next        *
     F*           interest date                                       *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  090901 - ERROR ON E49685. SINCE REPCD IS THE DATE OF NEXT    *
     F*           WORKING DAY, SO SHOULD ONLY GET THE NEXT NEXT INT.  *
     F*           DATE WHEN THE NIDT IS LESS THAN REPCD AS DATE OF    *
     F*           NEXT WORKING DAY IS NOT INCLUDED IN REPORTING       *
     F*  087811 - The date of "Accrual Period To" was incorrect due   *
     F*           to the routine which determines the date being      *
     F*           skipped for a loan with negative principal (i.e. a  *
     F*           loan which has been overpaid)                       *
     F*  S01465 - BLI Lending Enhancements                            *
     F*  066550 - GLINTC has had historical problems and inaccuracies *
     F*           and is now externaly descibed and changed to use    *
     F*           ZINTDYZ1. See document atached to error no on GEMS  *
     F*  S01408  -  Core hook LE1110CPG added                         *
     F*             Core hook LE1110CVSF added                        *
     F*  E49092 - Parameter CSSN for AONOSTR0 call was incorrectly    *
     F*           defined.                                            *
     F*  E38567 - Only exclude loans matured before report control    *
     F*           date & include ones maturing on rep control date    *
     F*  S01392 - Japanese sub module enhancements                    *
     F*  E20522 - PREVIOUSLY, LOANS WITH AN INTEREST RATE OF          *
     F*           ZERO WERE NOT SHOWING UP ON THE INTEREST            *
     F*           ACCRUALS REPORT - LE1120.                           *
     F*  E26745 - INCORRECT CHECK ON RECOURSE IND - IT IS NOW Y/N     *
     F*  S01220 - AMENDED FOR STRATEGIC RISK MANAGEMENT               *
     F*           RELEASE 10 TO ALLOW THE INPUT OF A BOOK             *
     F*           CODE AGAINST A LOAN.                                *
     F*  BHF129 - ERROR FIX E08921 REMOVED SINCE IT IS NOT CORE.      *
     F*  S01260 - ORIGINAL BORROWER ON PARTICIPATIONS PURCHASED..     *
     F*  S01194 - NEW STANDING DATA                                   *
     F*  E18465 - REMOVE E80742 CODE CHANGES. IT IS INCORRECT TO      *
     F*           USE THE REPORT CONTROL DATE AS THE 'PERIOD TO'      *
     F*           DATE.                                               *
     F*  E80742 - 'PERIOD TO' DATE WAS ALWAYS NEXT INTEREST DATE OR   *
     F*           MATURITY DATE REGARDLESS OF REPORT CONTROL DATE.    *
     F*  S01195 - HOLIDAY AMENDMENT                                   *
     F*  S01117 - MULTIBRANCHING                                      *
     F*  E12964 - LOANS PRINTED ON REPORT LE1120 WITH 'CALL'          *
     F*           INSTEAD OF MATURITY DATE IN 'PERIOD TO' COLUMN      *
     F*           AND A LARGE NEGATIVE CREDIT IN 'TO ACCRUE'          *
     F*           COLUMN INSTEAD OF AMOUNT TO ACCRUE.                 *
     F*  E08921 - WHEN A BASE RATE CHANGE IS DONE AFTER A LOAN        *
     F*           PASSED MATURITY DATE, IACD WILL BE INCREASED TO     *
     F*           THE DATE WHEN THE BASE RATE IS CHANGED, THUS        *
     F*           CAUSING A NEGATIVE INTEREST ACCURAL AFTER THE       *
     F*           MATURITY DATE.                                      *
     F*  S01147 - RELEASE 22 (AMENDMENT TO GLINTC)                    *
     F*  E10538 - LOAN NOT BEING EXTRACTED IF INTEREST RATE ZERO.     *
     F*  E10536 - WRONG 'PERIOD TO' DATE BEING USED. IF NEXT          *
     F*           INTEREST DATE LESS THAN REPORT CONTROL DATE         *
     F*           THEN MATURITY DATE BEING USED.                      *
     F*  E49685 - WRONG 'PERIOD TO' DATE BEING USED. MATURITY         *
     F*           INSTEAD OF NEXT INTEREST DATE BEING USED.           *
     F*  E80945 - INDICATOR 98 SETTING IS SAVED AND RESTORED          *
     F*           WHEN S.R.GLINTC IS PERFORMED.                       *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
0011 F*
0013 F*CLOAN***IP**F*****400  7AI     2 DISK                              S01220
0013 F***CLOAN***IP**F     436  7AI     2 DISK                     S01220 S01465
     F***CLOAN***IP  F     458  7AI     2 DISK                     S01465 CEU004
     F*CLOAN***IP  F    1290  7AI     2 DISK                       CEU004 CLE011
     F*CLOAN***IP  F    1310  7AI     2 DISK                                           CLE011 CLE028
     F***CLOAN   IP  F    1375  7AI     2 DISK                                         CLE028 CLE031
     F***CLOAN   IP  F    1535  7AI     2 DISK                                         CLE031 CAP074
     F***CLOAN** IP  F    1560  7AI     2 DISK                                         CAP074 CGL029
     F*CLOAN***IP**F****1632  7AI     2 DISK                                           CGL029 CLE042
     F***CLOAN** IP  F    1773  7AI     2 DISK                                         CLE042 CER020
     F***CLOAN** IP  F    1782  7AI     2 DISK                                         CER020 CLE134
     FCLOAN   IP  F    1874  7AI     2 DISK                                                   CLE134
0014 F*ABLE***IF* F      96 12AI     2 DISK                               S01194
0015 F*CLOANC**IF**F*****400  7AI     2 DISK                                                  CLE042
     F***CLOANC* IF  F    1773  7AI     2 DISK                                         CLE042 CER020
     F***CLOANC* IF  F    1782  7AI     2 DISK                                         CER020 CLE134
     FCLOANC  IF  F    1874  7AI     2 DISK                                                   CLE134
     F*MLOAN***IF  F     400  7AI     2 DISK                                          BUG8157 CLE042
     F***MLOAN** IF  F    1765  7AI     2 DISK                                         CLE042 CER020
     F***MLOAN   IF  F    1782  7AI     2 DISK                                         CER020 CLE134
     FMLOAN   IF  F    1874  7AI     2 DISK                                                   CLE134
0016 FLEACXHH O   F     128            DISK
0016 F*LEACXAC*O***F*****128            DISK                                                  CLE042
     FLEACXAC O   F     132            DISK                                                   CLE042
0016 FLEACXZZ O   F     128            DISK
     F/COPY WNCPYSRC,LE1110F002
0017 F*E1110P1O** F     132            PRINTER                            S01117
     FLE1110AUO   F     132     OF     PRINTER                            S01117
     F/COPY WNCPYSRC,LE1110F001
0018 F* ID F  C  H  L    FUNCTION OF INDICATORS
0019 F* 01            CLOAN LIVE RECORD 'A'
0020 F* 02            CLOAN MATURED RECORD 'A'
     F*       31      ROUND DOWN FAC.IND = 'Y'                            S01392
     F********32******WORK INDICATOR                               E80742 E18465
     F********33******INTEREST ACCRUED TO DATE NOT YET POSTED ZERO E10538 E20522
0021 F*       34      USED IN WTAX SUBROUTINE
0022 F*       35      WORK INDICATOR
0023 F*       36      WORK INDICATOR
0024 F*       37      WORK INDICATOR
0025 F*       38      LOAN NOT YET STARTED
0026 F*       39      PART. SOLD
0027 F*       40      FIRST CYCLE
0028 F*       41      CURRENT PRINCIPAL NEGATIVE
     F*       42      STOP ACCRUALS INDICATOR IS ON
0029 F*       45      ACCRUAL DATE BEFORE NEXT WORKING DAY
0030 F*       46      DETAIL OUTPUT TO LEACX
     F*       47      CORE FEATURE S01465 IS SWITCHED ON                  S01465
0031 F*       58      ACCRUE ON LAST DAY
0032 F*       60      EXCPT OUTPUT HEADER TO LEACX
0032 F*       70      NEXT INTEREST DATE IS ZERO                          S01117
     F*       81      PARTICIPATION PURCHASED                             S01260
     F*       83      RECOURSE INDICATOR = N                              S01260
0033 F*       90-99   STANDARD SUBROUTINES
0034 F*       U7,U8   STANDARD MIDAS USAGE
      /COPY ZSRSRC,ZDATE2Z1                                               S01392
0075 E                    ZFMD   12  12  2               ZFREQA SR.ARRAY  E49685
     E                    ZHC        50  3               ZFREQA SR.ARRAY  E49685
     E                    CPY@    1   1 80
     E                    ACR       150  3                                CLE031
     E                    ACI       150  1                                CLE031
      **  Array of System Values                                                              218782
     E*********           SVAL    1   1 20                                             218782 137353
     E                    SVAL    1   2 20                                                    137353
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E/COPY ZSRSRC,ZDATE9Z1                                               066550
     E                    ##BR      999  3               Branch codes                         CSC042
     E                    ##BC      999  3               Company codes                        CSC042
0038 I**
0039 I**   CLOAN FILE 'A' RECORD
0040 I**
0041 ICLOAN   NS  01   1 CD   8 CA
0042 I       OR   02   1 CM   8 CA
0043 I                                        1   1 RECI
0044 I**********                              2   70LNRF                                      CLE148
     I                                        2   7 LNRF                                      CLE148
0045 I                                        8   8 RCDT
0046 I                                        9   90MRIN
0047 I                                       10  110PTYP
0048 I**********                             12  170CNUM                                      CSD027
0048 I                                       12  17 CNUM                                      CSD027
0049 I***********                            18  200BRCD                  S01117
0049 I                                       18  20 BRCA                  S01117
0050 I                                       21  22 LTYP
0051 I                                       23  24 SUTP
0052 I                                    P  25  270DDAT
0053 I                                    P  28  300VDAT
0054 I                                    P  31  330MDAT
0055 I                                       34  350LASQ
0056 I**********                             36  410FCUS                                      CSD027
0056 I                                       36  41 FCUS                                      CSD027
0057 I                                       42  440FTYP
0058 I                                       45  460FSEQ
0059 I                                       47  49 CCY
0060 I                                    P  50  560CPAM          41
0061 I                                       57  57 INTC
0062 I                                    P  58  637INTR
0063 I                                       64  650BRTT
0064 I                                    P  66  717BRTE
0065 I                                    P  72  777RTSP
0066 I                                    P  78  815MARG
0067 I                                       82  82 SPIN
0068 I                                       83  83 CHIN
0069 I                                    P  84  897WTRT
0070 I                                       90  90 WTIN
0071 I                                       91  910REPT
0072 I                                    P  92  980RAMT
0073 I                                    P  99 1010NRPD
0074 I                                      102 102 RFRQ
0075 I                                      103 1040RDYN
0076 I                                      105 107 FCCY
0077 I                                      108 1100LIND
0078 I                                      111 112 CRSK
0079 I                                      113 114 ACOF
0080 I                                      115 115 NACD
0081 I                                      116 116 RELI
0082 I                                      117 117 AUTO
0083 I                                    P 118 1240PSAM
0084 I                                    P 125 1318BCXR
0085 I                                    P 132 1388FCXR
0086 I                                      139 1400SDST
0087 I**********                            141 152 OSDA                                      CGL029
     I                                      141 152 OSDAQQ                                    CGL029
0088 I                                      153 162 TSTN
0089 I                                      163 1640MDST
0090 I**********                            165 176 OMDA                                      CGL029
     I                                      165 176 OMDAQQ                                    CGL029
0091 I                                      177 186 TMAN
0092 I                                      187 196 FACO
0093 I                                    P 197 1990RLDT
0094 I                                    P 200 2020NROD
0095 I                                      203 203 RLFQ
0096 I                                      204 2050RLDY
     I                                      206 206 RDFC                  S01392
0097 I                                      207 2080NBRA
0098 I                                    P 209 2147NRTS
0099 I                                      215 215 NSIN
0100 I                                      216 2160NCAC
0101 I                                    P 217 2230AWTP
0102 I                                    P 224 2300WTRD
0103 I                                    P 231 2370WTWD
0104 I                                    P 238 2440IWOD
0105 I                                    P 245 2510PWOD
     I                                    P 254 2600PDIN
0106 I                                      287 287 BTIN
0107 I                                      288 2890BLDY
0108 I**********                            290 2950OLNO                                      CSD027
0108 I                                      290 295 OLNO                                      CSD027
0109 I                                      296 296 RCSI
0110 I                                      297 2970ICBS
0111 I                                      298 298 IPFR
0112 I                                    P 299 3050TOTI
0113 I***********                         P 306 3080NIDT                  S01117
0113 I                                    P 306 3080NIDT            70    S01117
0114 I                                    P 309 3110IBDT
0115 I                                    P 312 3140SLID
0116 I                                    P 315 3210AIPD
0117 I                                    P 322 3240DLRC
0118 I                                    P 325 3270IACD
0119 I                                    P 328 3340AITC
0120 I                                    P 335 3410TFEP
0121 I                                    P 342 3480AIAP
0122 I                                    P 349 3550IPRD
0123 I                                    P 356 3620IPRM
0124 I                                    P 363 3690ICTD
0125 I                                    P 370 3760AIMN
0126 I                                    P 377 3790RBDT
0127 I                                      384 3850IFDY
0128 I                                      386 386 LONI
0129 I                                      387 387 CNFI
0130 I                                      388 388 ACEI
0131 I                                      389 389 TLXI
0132 I                                      390 390 CBLI
0133 I                                    P 391 3930ORED
0134 I                                    P 394 3960LCD
0135 I                                      397 397 CHTP
0136 I                                    P 398 4000TNLU
     I                                      401 401 ADDI                  S01392
     I                                      435 436 BOKC                  S01220
     I                                     12851287 SCCY                  CEU004
     I                                     12881290 ICCY                  CEU004
     I                                     13491349 ADIF                                      CLE028
     I                                     13501350 ADCF                                      CLE028
     I                                    P135113570CHGA                                      CLE028
     I                                     13581358 ICIF                                      CLE028
     I                                    P135913650FLTI                                      CLE028
     I                                    P136613680FRPD                                      CLE028
     I                                    P136913750ACCH                                      CLE028
     I                                    P147414808REXR                  CLE031
     I                                     14811481 REXI                  CLE031
     I                                     14821484 PSCY                  CLE031
     I                                    P148514918PEXR                  CLE031
     I                                     14921492 PEXI                  CLE031
     I                                     14931493 STAL                                      CAP074
     I                                     14941513 FRNT                                      CAP074
     I                                     15141533 AFRT                                      CAP074
     I                                     15341534 REPA                                      CAP074
     I                                     15351560 TMST                                      CAP074
     I                                     15611578 OSDA                                      CGL029
     I                                     15791596 OMDA                                      CGL029
     I                                     17621765 CLAS                                      CLE042
     I                                     17661769 DFCL                                      CER020
     I                                     17701773 SLCL                                      CER020
     I                                    P177417760ISDT                                      CER020
     I                                    P177717790FMDT                                      CER020
     I                                     17801782 LOIC                                      CER020
      *                                                                                       CLE134
     I                                     18301830 FAMU                                      CLE134
     I                                     18311831 FPNR                                      CLE134
     I                                    P183218340RIDT                                      CLE134
     I                                    P183518360RIDC                                      CLE134
     I                                     183718370RCAT                                      CLE134
     I                                    P183818390RCAC                                      CLE134
     I                                    P184018420RCSD                                      CLE134
     I                                    P184318440RCDY                                      CLE134
     I                                    P184518460RCCY                                      CLE134
      *                                                                                       CLE134
     I                                    P184718490BIDT                                      CLE134
     I                                    P185018510BIDC                                      CLE134
     I                                     185218520BCAT                                      CLE134
     I                                    P185318540BCAC                                      CLE134
     I                                    P185518570BCSD                                      CLE134
     I                                    P185818590BCDY                                      CLE134
     I                                    P186018610BICC                                      CLE134
      *                                                                                       CLE134
     I                                     18621864 XRFI                                      CLE134
     I                                     186518740XRFN                                      CLE134
      *                                                                                       CLE134
0137 I*
0138 I*    LOANS FILE - TRAILER
0139 I*
0140 I        NS       1 CT
0141 I                                        1   1 RECI
0142 I**********                              2   70LNRF                                      CLE148
     I                                        2   7 LNRF                                      CLE148
0143 I                                        8   8 RCDT
0144 I                                    P  17  190NORE
0145 I                                    P  20  220FLSZ
0146 I                                    P  23  250NLRB
0147 I                                    P  26  280NINS
0148 I                                    P  29  310NDEL
0149 I                                    P  32  340NLRA
0150 I                                    P  35  420VLBF
0151 I                                    P  43  440VLBL
0152 I                                    P  45  520VRIF
0153 I                                    P  53  540VRIL
0154 I                                    P  55  620VRDF
0155 I                                    P  63  640VRDL
0156 I                                    P  65  720VLAF
0157 I                                    P  73  740VLAL
0158 I                                    P  75  770DTMR
0159 I                                    P  78  800ITMR
0160 I                                    P 394 3960LCD
0161 I                                      397 397 CHTP
0162 I                                    P 398 4000TNLU
0163 I*
0164 I* CATCHALL
0165 I        NS
0166 I**********                                                          S01194
0167 I**********                                                          S01194
0168 I*****TABLE FILE - INSTALLATION CONTROL DATA RECORD 1.               S01194
0169 I**********                                                          S01194
0170 I*ABLE***NS       2 C0   3 C1  12 C1                                 S01194
0171 I*******AND      13 C0                                               S01194
0172 I**********                              1   1 RECI                  S01194
0173 I**********                              2   30RECT                  S01194
0174 I**********                             12  130RCDE                  S01194
0175 I**********                             14  66 TITL                  S01194
0176 I**********                             67  67 DATF                  S01194
0177 I***********                            68  700DFBR                  S01194
0178 I**********                             74  74 MODI1                 S01194
0179 I**********                             75  75 MODI2                 S01194
0180 I**********                             76  76 MODI3                 S01194
0181 I**********                          P  77  790RUND                  S01194
0182 I**********                             80  86 RUNA                  S01194
0183 I**********                             87  870SFLG                  S01194
0184 I**********                          P  90  920LCD                   S01194
0185 I**********                             93  93 CHTP                  S01194
0186 I**********                          P  94  960TNLU                  S01194
0187 I**********                                                          S01194
0188 I**********                                                          S01194
0189 I*****TABLE FILE - INSTALLATION CONTROL DATA RECORD 2.               S01194
0190 I**********                                                          S01194
0191 I********NS       1 CD   2 C0   3 C1                                 S01194
0192 I*******AND      12 C1  13 C1                                        S01194
0193 I**********                              1   1 RECI                  S01194
0194 I**********                              2   30RECT                  S01194
0195 I**********                             12  130RCDE                  S01194
0196 I**********                             14  16 BCCY                  S01194
0197 I**********                             17  19 BCYL                  S01194
0198 I**********                             20  22 HOCY                  S01194
0199 I**********                             23  280HEAD                  S01194
0200 I**********                          P  29  310APDA                  S01194
0201 I**********                             35  35 APFQ                  S01194
0202 I**********                          P  36  380LOGS                  S01194
0203 I**********                             39  40 CUZR                  S01194
0204 I**********                          P  41  430DNWD                  S01194
0205 I**********                             44  460BVLP                  S01194
0206 I**********                             47  49 LOCY                  S01194
0207 I**********                             50  510FDAY                  S01194
0208 I**********                             52  52 ACLD                  S01194
0209 I**********                             53  53 MBIN                  S01194
0210 I**********                             86  86 ISAV                  S01194
0211 I**********                          P  87  890LLOG                  S01194
0212 I**********                          P  90  920LCD                   S01194
0213 I**********                             93  93 CHTP                  S01194
0214 I**********                          P  94  960TNLU                  S01194
0478 I***********                                                  E49685 S01195
0479 I*****TABLE*FILE - HOLIDAY RECORD.                            E49685 S01195
0480 I********E-EXCLUDE, I-INCLUDE.                                E49685 S01195
0481 I***********                                                  E49685 S01195
0482 I********NS*      1 CD   2 C2   3 C2                          E49685 S01195
0483 I*******AND*     14 CE                                        E49685 S01195
0484 I*******OR**      1 CD   2 C2   3 C2                          E49685 S01195
0485 I*******AND*     14 CI                                        E49685 S01195
0486 I***********                             1   1 RECI           E49685 S01195
0487 I***********                             2   30RECT           E49685 S01195
0488 I***********                             8  120HOL            E49685 S01195
0489 I***********                            13  130SREC           E49685 S01195
0490 I***********                            14  14 INEX           E49685 S01195
0491 I***********                            15  89 HCCY           E49685 S01195
0215 I********NS****                                                      S01194
0216 I**************                          1   1 RECI                  S01194
0217 I**
0218 I**   CLOAN FILE REDEFINED FOR CHAINING
0219 I**
0220 ICLOANC  NS       1 CD   8 CA
     I       OR        1 CM   8 CA
0221 I                                        1   1 RECI
     I                                       10  110SPTYP                 S01260
     I**********                             12  170SCNUM                              S01260 CSD027
0222 I**********                             12  170CNUM                                      CSD027
     I                                       12  17 SCNUM                                     CSD027
0222 I                                       12  17 CNUM                                      CSD027
0223 I**********                             21  22 LTYP                                    BUG10708
     I**********                             21  22 CLTYP                            BUG10708 245538
     I                                       21  22 LTYP                                      245538
0224 I**********                             23  24 SUTP                                    BUG10708
     I**********                             23  24 CSUTP                            BUG10708 244538
     I                                       23  24 SUTP                                      245538
     I**********                            290 2950SOLNO                              S01260 CSD027
     I                                      290 295 SOLNO                                     CSD027
     I                                      296 296 SRCSI                 S01260
     I                                     17621765 CLAS                                      245538
      *                                                                                       CLE134
     I                                     18301830 FAMU                                      CLE134
     I                                     18311831 FPNR                                      CLE134
     I                                    P183218340RIDT                                      CLE134
     I                                    P183518360RIDC                                      CLE134
     I                                     183718370RCAT                                      CLE134
     I                                    P183818390RCAC                                      CLE134
     I                                    P184018420RCSD                                      CLE134
     I                                    P184318440RCDY                                      CLE134
     I                                    P184518460RCCY                                      CLE134
      *                                                                                       CLE134
     I                                    P184718490BIDT                                      CLE134
     I                                    P185018510BIDC                                      CLE134
     I                                     185218520BCAT                                      CLE134
     I                                    P185318540BCAC                                      CLE134
     I                                    P185518570BCSD                                      CLE134
     I                                    P185818590BCDY                                      CLE134
     I                                    P186018610BICC                                      CLE134
      *                                                                                       CLE134
     I                                     18621864 XRFI                                      CLE134
     I                                     186518740XRFN                                      CLE134
      *                                                                                       CLE134
     IMLOAN   NS       1 CM   8 CA                                                           BUG8157
     I                                        1   1 RECI                                     BUG8157
     I                                       10  110SPTYP                                    BUG8157
     I**********                             12  170SCNUM                            BUG8157 CSD027A
     I**********                             12  170CNUM                             BUG8157 CSD027A
     I                                       12  17 SCNUM                                    CSD027A
     I                                       12  17 CNUM                                     CSD027A
     I                                       21  22 LTYP                                     BUG8157
     I                                       23  24 SUTP                                     BUG8157
     I**********                            290 2950SOLNO                            BUG8157 CSD027A
     I                                      290 295 SOLNO                                    CSD027A
     I                                      296 296 SRCSI                                    BUG8157
     I                                     17621765 CLAS                                      CLE042
      *                                                                                       CLE134
     I                                     18301830 FAMU                                      CLE134
     I                                     18311831 FPNR                                      CLE134
     I                                    P183218340RIDT                                      CLE134
     I                                    P183518360RIDC                                      CLE134
     I                                     183718370RCAT                                      CLE134
     I                                    P183818390RCAC                                      CLE134
     I                                    P184018420RCSD                                      CLE134
     I                                    P184318440RCDY                                      CLE134
     I                                    P184518460RCCY                                      CLE134
      *                                                                                       CLE134
     I                                    P184718490BIDT                                      CLE134
     I                                    P185018510BIDC                                      CLE134
     I                                     185218520BCAT                                      CLE134
     I                                    P185318540BCAC                                      CLE134
     I                                    P185518570BCSD                                      CLE134
     I                                    P185818590BCDY                                      CLE134
     I                                    P186018610BICC                                      CLE134
      *                                                                                       CLE134
     I                                     18621864 XRFI                                      CLE134
     I                                     186518740XRFN                                      CLE134
      *                                                                                       CLE134
0225 I        NS
0226 I                                        1   1 RECI
     I/COPY WNCPYSRC,LE1110I001
0227 I**
0228 I**   DATA STRUCTURES
0229 I**
0230 I**   LDA FOR DATABASE ERROR IDENTIFICATION
0231 ILDA        UDS                            256
0353 I***********                           134 138 DBFILE                S01117
0354 I***********                           139 167 DBKEY                 S01117
0355 I***********                           168 175 DBPGM                 S01117
0356 I***********                           176 177 DBASE                 S01117
0353 I                                      134 141 DBFILE                S01117
0354 I                                      142 170 DBKEY                 S01117
0355 I                                      171 180 DBPGM                 S01117
0356 I                                      181 1830DBASE                 S01117
0377 I*                                                                   S01117
     I/COPY ZSRSRC,ZHOLI                                                  S01195
      **  EXTERNAL DS FOR HOLIDAY DETAILS                                 S01195
      **                                                                  S01117
      **                                                                  S01194
     ISDGELR    E DSSDGELRPD                                              S01117
      ** GENERAL LEDGER DETAILS                                           S01117
     I**************BKALDI                          ACLD            S01117S01392
     I              BKAPDT                          APDA                  S01194
     ISDBANK    E DSSDBANKPD                                              S01194
      ** BANK DETAILS                                                     S01194
     I              BJURPT                          TITL                  S01194
     I              BJCYCD                          BCCY                  S01194
     I              BJDNWD                          DNWD                  S01194
     ISDBRCH    E DSSDBRCHPD                                              S01117
      **  EXTERNAL DS FOR BRANCH CODE DETAILS                             S01117
     I              A8CMCD                          CMPYM                 S01194
      **                                                                  S01117
     ISDNOST    E DSSDNOSTPD                                              S01195
      **  EXTERNAL DS FOR NOSTRO DETAILS                                  S01195
     I              A7NOSN                          CSNM                  S01194
     I              QQACCD                          QQACC1                                    CGL029
      **                                                                  S01195
     IDSCSNM      DS                             10                       S01195
      ** DATA AREA FOR THE LOCATION CODE IN CUSTOMER SHORTNAME FIELD      S01195
     I                                        8  10 NRLC                  S01195
      **                                                                  S01195
     I*                                                                   S01465
     ISCSARD    E DSSCSARDPD                                              S01465
     I** SAR FILE DETAILS                                                 S01465
     I              LCD                             LCDX                  S01465
     I*                                                                   S01194
     ISDCURR    E DSSDCURRPD                                              CLE031
      ** Currency Type                                                    CLE031
      *                                                                   CLE031
     I*SDSVAL***E DSSDSVALPD                                                           218782 222373
      ****EXTERNAL DS FOR SYSTEM VALUES                                                218782 222373
      **********                                                                       218782 222373
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I*                                                                   S01194
     IRUNDT       DS                                                      S01117
      **  DATA AREA RUNDAT                                                S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I/COPY ZSRSRC,ZINTDYZ1                                               066550
     I/COPY ZSRSRC,ZDATE9Z2                                               066550
     I/COPY ZSRSRC,ZDAT10Z1                                               126017
     I**                                                                  S01117
     C**********           MOVEACPY@      BIS@   80                                           CSC042
0236 C**
0237 C**   FIRST CYCLE CALCS
0238 C**
0239 C   40                GOTO ENDFC
0240 C                     SETON                     40
     C                     MOVEACPY@      BIS@   80                                           CSC042
      **                                                                  S01117
      **   IN THE DATAAREA RUNDAT                                         S01117
      **                                                                  S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C           *NAMVAR   DEFN           LDA                             S01194
     C           *LOCK     IN   LDA                                       S01194
0241 C**
0242 C                     EXSR ZSYSTM
0243 C***99*****           MOVE 'TABLE'   DBFILE                          S01194
0243 C   99                MOVE 'SDBANKPD'DBFILE                          S01194
0244 C***99*****           MOVELZTABKY    DBKEY                           S01194
0245 C   99                Z-ADD1         DBASE            DBASE 1
0246 C   99                SETON                     U7U8LR
0247 C***99******          GOTO END                                       S01117
0247 C   99                GOTO ABEND                                     S01117
0248 C**
0249 C**   ACCESS ICDR 2
0250 C**
0251 C**********           MOVE '11'      ZTABKY                          S01194
0252 C********** ZTABKY    CHAINTABLE                99                   S01194
0253 C**N99****  RECI      COMP 'D'                  9999                 S01194
     C*                                                                   S01465
     C** Access SAR details file to determine if the core feature         S01465
     C** S01465 is switched on                                            S01465
     C*                                                                   S01465
     C                     MOVE '0'       *IN47                           S01465
     C                     CALL 'AOSARDR0'                                S01465
     C                     PARM *BLANKS   @RTCD   7                       S01465
     C                     PARM '*VERIFY' @OPTN   7                       S01465
     C                     PARM 'S01465'  @SARD   6                       S01465
     C           SCSARD    PARM SCSARD    DSFDY                           S01465
     C*                                                                   S01465
     C           @RTCD     IFEQ *BLANKS                                   S01465
     C                     MOVE '1'       *IN47                           S01465
     C                     ELSE                                           S01465
     C           @RTCD     IFNE '*NRF   '                                 S01465
     C                     MOVEL'LE1110 ' DBPGM                           S01465
     C                     MOVEL'SCSARDPD'DBFILE           ************   S01465
     C                     MOVEL'*VERIFY' DBKEY            * DBERR 05 *   S01465
     C                     Z-ADD5         DBASE            ************   S01465
     C                     SETON                     U7U8LR               S01465
     C                     SETON                     99                   S01465
     C                     GOTO ABEND                                     S01465
     C                     END                                            S01465
     C                     END                                            S01465
      *                                                                   CLE005
      **  Check is CLE005 is installed                                    CLE005
      *                                                                   CLE005
     C                     CALL 'AOSARDR0'                                CLE005
     C                     PARM *BLANKS   @RTCD   7                       CLE005
     C                     PARM '*VERIFY' @OPTN   7                       CLE005
     C***********          PARM 'S01465'  @SARD   6                 CLE005130846
     C                     PARM 'CLE005'  @SARD                           130846
     C           SCSARD    PARM SCSARD    DSFDY                           CLE005
     C*                                                                   CLE005
     C           @RTCD     IFEQ *BLANKS                                   CLE005
     C                     MOVE 'Y'       CLE005  1                       CLE005
     C                     ELSE                                           CLE005
     C           @RTCD     IFNE '*NRF   '                                 CLE005
     C                     MOVEL'LE1110 ' DBPGM                           CLE005
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE005
     C                     MOVEL'*VERIFY' DBKEY            * DBERR 06 *   CLE005
     C                     Z-ADD6         DBASE            ************   CLE005
     C                     MOVE 'N'       CLE005                          CLE005
     C                     SETON                     U7U8LR               CLE005
     C                     SETON                     99                   CLE005
     C                     GOTO ABEND                                     CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CEU004
      ** Access SAR details file to see if CEU004 is installed            CEU004
      *                                                                   CEU004
     C                     MOVE 'N'       CEU004  1        Set SAR Flag   CEU004
      *                                                                   CEU004
     C                     CALL 'AOSARDR0'                 Rtv SAR Dtls   CEU004
      *                                                    Input:         CEU004
     C                     PARM *BLANKS   P@RTCD  7        -Return Code   CEU004
     C                     PARM '*VERIFY' P@OPTN  7        -Option        CEU004
     C                     PARM 'CEU004'  P@SARD  6        -SAR No        CEU004
      *                                                    Output:        CEU004
     C           SCSARD    PARM SCSARD    DSFDY            -Format        CEU004
      *                                                                   CEU004
     C           P@RTCD    IFEQ *BLANKS                    If Found       CEU004
     C                     MOVE 'Y'       CEU004            Set SAR Flag  CEU004
      *                                                                   CEU004
     C                     ELSE                            Else           CEU004
     C           P@RTCD    IFNE '*NRF   '                   If # NoRecFnd CEU004
     C                     MOVEL'SCSARDPD'DBFILE             Set File     CEU004
     C                     MOVEL'*VERIFY' DBKEY              Set Key      CEU004
     C                     Z-ADD7         DBASE              Set DBase RefCEU004
     C                     SETON                     U7U8LR  Set Ind      CEU004
     C                     SETON                     99      Set Ind      CEU004
     C                     GOTO ABEND                        Bypass to endCEU004
     C                     ENDIF                            End If        CEU004
     C                     ENDIF                           End If         CEU004
      *                                                                                       CLE028
      ** Check if Flat Rate Personal Loans (Rule of 78s) is installed.                        CLE028
      *                                                                                       CLE028
     C                     CALL 'AOSARDR0'                                                    CLE028
     C                     PARM *BLANKS   P@RTCD                                              CLE028
     C                     PARM '*KEY   ' P@OPTN                                              CLE028
     C                     PARM 'CLE028'  P@SARD                                              CLE028
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE028
      *                                                                                       CLE028
     C           P@RTCD    IFEQ *BLANKS                                                       CLE028
     C                     MOVE 'Y'       CLE028  1                                           CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE 'N'       CLE028                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           P@RTCD    IFNE *BLANKS                                                       CLE028
     C           P@RTCD    ANDNE'*NRF   '                                                     CLE028
     C                     MOVE *ON       *INU7                                               CLE028
     C                     MOVE *ON       *INU8                                               CLE028
     C                     MOVE *ON       *INLR                                               CLE028
     C                     MOVE *ON       *IN99                                               CLE028
     C           *LOCK     IN   LDA                                                           CLE028
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE028
     C                     Z-ADD8         DBASE                                               CLE028
     C                     MOVEL'CLE028'  DBKEY                                               CLE028
     C                     MOVELP@OPTN    DBOPTN                                              CLE028
     C                     OUT  LDA                                                           CLE028
     C                     GOTO ABEND                                                         CLE028
     C                     ENDIF                                                              CLE028
      *                                                                   CLE031
      ** Access SAR details file to see if CLE031 is installed            CLE031
      *                                                                   CLE031
     C                     MOVE 'N'       CLE031  1        Set SAR Flag   CLE031
      *                                                                   CLE031
     C                     CALL 'AOSARDR0'                 Rtv SAR Dtls   CLE031
      *                                                    Input:         CLE031
     C                     PARM *BLANKS   P@RTCD  7        -Return Code   CLE031
     C                     PARM '*VERIFY' P@OPTN  7        -Option        CLE031
     C                     PARM 'CLE031'  P@SARD  6        -SAR No        CLE031
      *                                                    Output:        CLE031
     C           SCSARD    PARM SCSARD    DSFDY            -Format        CLE031
      *                                                                   CLE031
     C           P@RTCD    IFEQ *BLANKS                    If Found       CLE031
     C                     MOVE 'Y'       CLE031            Set SAR Flag  CLE031
      *                                                                   CLE031
     C                     ELSE                            Else           CLE031
     C           P@RTCD    IFNE '*NRF   '                   If # NoRecFnd CLE031
     C                     MOVEL'SCSARDPD'DBFILE             Set File     CLE031
     C                     MOVEL'*VERIFY' DBKEY              Set Key      CLE031
     C                     Z-ADD8         DBASE              Set DBase RefCLE031
     C                     SETON                     U7U8LR  Set Ind      CLE031
     C                     SETON                     99      Set Ind      CLE031
     C                     GOTO ABEND                        Bypass to endCLE031
     C                     ENDIF                            End If        CLE031
     C                     ENDIF                           End If         CLE031
      *                                                                                       218782
     C**  Read switchable features file SCSARDPD using access object                          218782
     C**  to determine if switchable feature (CLE033) is switched ON                          218782
     C*                                                                                       218782
     C                     MOVE 'N'       CLE033  1                                           218782
     C*                                                                                       218782
     C                     CALL 'AOSARDR0'                                                    218782
     C                     PARM *BLANKS   P@RTCD                                              218782
     C                     PARM '*VERIFY' P@OPTN                                              218782
     C                     PARM 'CLE033'  P@SARD                                              218782
     C           SCSARD    PARM SCSARD    DSFDY                                               218782
     C*                                                                                       218782
     C**  If feature is on, set up CLE033 variable                                            218782
     C*                                                                                       218782
     C           P@RTCD    IFEQ *BLANKS                                                       218782
      *                                                                                       218782
     C                     MOVE 'Y'       CLE033                                              218782
      *                                                                                       218782
     C                     CALL 'AOSVALR0'                                                    218782
     C                     PARM *BLANKS   P@RTCD                                              218782
     C                     PARM SVAL,1    P@OP01 20                                           218782
     C                     PARM *BLANKS   P@VL01200                                           218782
     C                     PARM *BLANKS   P@OP02 20                                           218782
     C                     PARM *BLANKS   P@VL02200                                           218782
     C                     PARM *BLANKS   P@OP03 20                                           218782
     C                     PARM *BLANKS   P@VL03200                                           218782
     C                     PARM *BLANKS   P@OP04 20                                           218782
     C                     PARM *BLANKS   P@VL04200                                           218782
     C                     PARM *BLANKS   P@OP05 20                                           218782
     C                     PARM *BLANKS   P@VL05200                                           218782
     C                     PARM *BLANKS   P@OP06 20                                           218782
     C                     PARM *BLANKS   P@VL06200                                           218782
     C                     PARM *BLANKS   P@OP07 20                                           218782
     C                     PARM *BLANKS   P@VL07200                                           218782
     C                     PARM *BLANKS   P@OP08 20                                           218782
     C                     PARM *BLANKS   P@VL08200                                           218782
     C                     PARM *BLANKS   P@OP09 20                                           218782
     C                     PARM *BLANKS   P@VL09200                                           218782
     C                     PARM *BLANKS   P@OP10 20                                           218782
     C                     PARM *BLANKS   P@VL10200                                           218782
     C********** SDSVAL    PARM SDSVAL    DSSDY                                        218782 222373
      *                                                                                       218782
     C           P@RTCD    IFNE *BLANKS                                                       218782
     C                     MOVEL'LE1110  'DBPGM     P                                         218782
     C                     MOVEL'SDSVALPD'DBFILE                                              218782
     C                     MOVELSVAL,1    DBKEY                                               218782
     C                     Z-ADD12        DBASE              Set DBase Ref                    218782
     C                     SETON                     U7U8LR  Set Ind                          218782
     C                     SETON                     99      Set Ind                          218782
     C                     GOTO ABEND                        Bypass to end                    218782
     C                     ELSE                                                               218782
      *                                                                                       218782
      ** Save value of Settlement09Postings in a one character field                          218782
     C                     MOVELP@VL01    SET09   1                                           218782
     C                     ENDIF                                                              218782
     C                     ENDIF                                                              218782
     C/COPY WNCPYSRC,LEH01325
      * Check to see whether system value 'FutValLoansOnIntAccr' is 'Y'                       137353
     C                     CALL 'AOSVALR0'                                                    137353
     C                     PARM *BLANKS   P@RTCD                                              137353
     C                     PARM SVAL,2    P@OP01                                              137353
     C                     PARM *BLANKS   P@VL01                                              137353
     C                     PARM *BLANKS   P@OP02                                              137353
     C                     PARM *BLANKS   P@VL02                                              137353
     C                     PARM *BLANKS   P@OP03                                              137353
     C                     PARM *BLANKS   P@VL03                                              137353
     C                     PARM *BLANKS   P@OP04                                              137353
     C                     PARM *BLANKS   P@VL04                                              137353
     C                     PARM *BLANKS   P@OP05                                              137353
     C                     PARM *BLANKS   P@VL05                                              137353
     C                     PARM *BLANKS   P@OP06                                              137353
     C                     PARM *BLANKS   P@VL06                                              137353
     C                     PARM *BLANKS   P@OP07                                              137353
     C                     PARM *BLANKS   P@VL07                                              137353
     C                     PARM *BLANKS   P@OP08                                              137353
     C                     PARM *BLANKS   P@VL08                                              137353
     C                     PARM *BLANKS   P@OP09                                              137353
     C                     PARM *BLANKS   P@VL09                                              137353
     C                     PARM *BLANKS   P@OP10                                              137353
     C                     PARM *BLANKS   P@VL10                                              137353
      *                                                                                       137353
     C           P@RTCD    IFNE *BLANKS                                                       137353
     C                     MOVEL'LE1110  'DBPGM     P                                         137353
     C                     MOVEL'SDSVALPD'DBFILE                                              137353
     C                     MOVELSVAL,2    DBKEY                                               137353
     C                     Z-ADD13        DBASE              Set DBase Ref                    137353
     C                     SETON                     U7U8LR  Set Ind                          137353
     C                     SETON                     99      Set Ind                          137353
     C                     GOTO ABEND                        Bypass to end                    137353
     C                     ELSE                                                               137353
      *                                                                                       137353
      ** Save value of FutValLoansOnIntAccr in a one character field                          137353
     C                     MOVELP@VL01    FUTVAL  1                                           137353
     C                     ENDIF                                                              137353
      *                                                                   CEU004
     C*                                                                   S01194
      ** ACCESS GENERAL LEDGER DETAILS                                    S01194
     C**********           CALL 'AOGELRR0'                                             S01194 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C********** SDGELR    PARM SDGELR    DSFDY                                        S01194 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     SETON                     99                   S01194
     C                     END                                            S01194
0254 C***99*****           MOVE 'TABLE'   DBFILE                          S01194
0254 C   99                MOVE 'SDGELRPD'DBFILE                          S01194
0255 C***99*****           MOVELZTABKY    DBKEY                           S01194
0256 C   99                Z-ADD2         DBASE            DBASE 2
0257 C   99                SETON                     U7U8LR
0258 C***99******          GOTO END                                       S01117
0258 C   99                GOTO ABEND                                     S01117
     C/COPY WNCPYSRC,LE1110C011
0259 C**
0260 C**   CALCULATE TITLE DATE AND REPORT CONTROL DATE
0261 C**
0262 C***********ACLD      COMP 'Y'                      58               S01392
0263 C           APDA      COMP DNWD                   45
0264 C**
0265 C                     Z-ADDDNWD      TDAT    50
0266 C   45                Z-ADDAPDA      TDAT    50
0267 C   45      TDAT      ADD  1         TDAT
0268 C**
0269 C                     Z-ADDDNWD      REPCD   50
0270 C***58******DNWD      SUB  1         REPCD                           S01392
0271 C   45      APDA      ADD  1         REPCD
0272 C***45*58***          Z-ADDAPDA      REPCD                           S01392
0273 C**
0273 C**  STORE ORIGINAL REPORT CONTROL DATE
0273 C**
0273 C                     Z-ADDREPCD     STRREP  50
0273 C**
0274 C                     Z-ADD1         CONTIN  50
0275 C                     Z-ADD1         CNTOUT  50
0276 C**
0277 C                     MOVE 'A'       CLOKEY  7
0278 C**
0279 C**   OUTPUT HEADER TO EXTRACT FILE
0280 C**
0281 C                     SETON                     60
0282 C                     EXCPT
0283 C                     SETOF                     60
0284 C**
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,LE1110CPG                                            S01408
     C                     Z-ADD0         ##BNDX  40                                          CSC042
     C           *LIKE     DEFN ##BNDX    B                                                   CSC042
     C           *LIKE     DEFN ##BNDX    ##BSV                                               CSC042
      *                                                                                       CSC042
0285 C           ENDFC     TAG                             ** ENDFC TAG **
0286 C**
0287 C** MAIN PROCESSING
0288 C**
0289 C                     SETOF                     46
     C*********************Z-ADD0         INTS                     E10538 E20522
0290 C  N01N02             GOTO END
0291 C**
0292 C**   ACCUMULATE HASH TOTALS FOR RECORDS READ IN
0293 C**
0294 C                     Z-ADDINWN      ZZTOTI
0295 C                     Z-ADDINDC      ZZTOTD
0296 C                     MOVE CPAM      ZZAMT
0297 C   41                Z-SUBZZAMT     ZZAMT
0298 C                     EXSR GLZADD
0299 C                     Z-ADDZZTOTI    INWN   150
0300 C                     Z-ADDZZTOTD    INDC    30
0301 C           CONTIN    ADD  2         CONTIN
0302 C**
0303 C   02                GOTO END
     C/COPY WNCPYSRC,LE1110C001
     C**
     C**  CHECK WHETHER STOP ACCRUALS INDICATOR IS ON
     C                     TESTB'3'       LONI           42
     C/COPY WNCPYSRC,LE1110C012
0304 C**
0304 C**   AS THE REPORT CONTROL DATE CAN CHANGE DEPENDING ON ACCRUAL
0304 C**   TYPE OF LOAN RESTORE ORIGINAL VALUE OF THIS FIELD BEFORE
0304 C**   FURTHER PROCESSING EACH LOAN.
     C**
     C                     Z-ADDSTRREP    REPCD
     C/COPY WNCPYSRC,LE1110C002
     C**
0305 C**   CHECK FOR CONDITIONS TO SKIP INTEREST CALCS
     C**                                                                  S01392
     C           ADDI      IFNE 'F'                                       S01392
     C           ADDI      ANDNE'B'                                                           245082
      *                                                                                       CLE028
      ** If Flat Rate Personal Loans (Rule of 78s) is installed,                              CLE028
      ** adjustment of end date above does not apply to flat rate                             CLE028
      ** personal loans.  Thus, deduct 1 from REPCD.                                          CLE028
      *                                                                                       CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C                     SUB  1         REPCD                           S01392
     C                     END                                            S01392
0306 C**
0307 C**   - LOAN NOT STARTED
0308 C***********SLID      COMP RUND                 38                   E47162
0308 C           SLID      COMP REPCD                38                   E47162
0309 C   38                Z-ADD0         AMAD   130
0310 C   38                Z-ADD0         WTAD   130
0311 C***38******          GOTO TAG10                                     S01465
     C   38N47             GOTO TAG10                                     S01465
      * Check system value 'FutValLoansnIntAccr' before skipping future valued                137353
      * loan                                                                                  137353
     C***38*47***          GOTO END                                                    S01465 137353
     C           *IN38     IFEQ '1'                                                           137353
     C           *IN47     ANDEQ'1'                                                           137353
     C           FUTVAL    IFNE 'Y'                                                           137353
     C                     GOTO END                                                           137353
     C                     ELSE                                                               137353
     C                     GOTO TAG10                                                         137353
     C                     ENDIF                                                              137353
     C                     ENDIF                                                              137353
0312 C**   - PRINCIPAL LE 0
0313 C   41                Z-ADD0         ZINTR
0314 C   41                GOTO TAG05
0315 C**   - INTEREST RATE 0
0316 C***********INTR      COMP 0                        35               E20522
     C***35******INTS      ADD  AITC      INTS   130               E10538 E20522
     C***35******INTS      ADD  AIMN      INTS                     E10538 E20522
     C***35******INTS      ADD  AIAP      INTS                     E10538 E20522
     C***35******INTS      SUB  IPRD      INTS                     E10538 E20522
     C***35******INTS      SUB  ICTD      INTS                     E10538 E20522
     C***35******INTS      SUB  IWOD      INTS           33        E10538 E20522
0317 C***35*33***          GOTO END                                E10538 E20522
0317 C** 35                GOTO END                                       E10538
0318 C**
0319 C**   CALCULATE INTEREST FROM CONTROL DATE
0320 C**
     C**  IF STOP ACCRUALS IS ON, SET TO ZERO AND SKIP ROUND
     C   42                Z-ADD0         ZINTR
     C/COPY WNCPYSRC,LE1110C013
     C   42                GOTO TAG05
     C**
     C**   IF MATURITY DATE IS LESS THAN CONTROL DATE, SKIP CALCULATION
     C**   OF INTEREST.  INSTEAD, ADD PDIN, AIAP, AIMN TO OBTAIN
     C**   INTEREST ACCRUED.
     C**
     C           MDAT      COMP 0                    35
     C   35      MDAT      COMP IACD                   35
     C   35      PDIN      ADD  AIMN      TOTINT
     C   35      TOTINT    ADD  AIAP      TOTINT
     C   35                GOTO SKPCLC
     C**
0321 C           MDAT      COMP REPCD                  35
0322 C           MDAT      COMP 0                    36
0323 C**
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C                     Z-ADDVDAT      ZIBEG                                               CLE028
     C                     ELSE                                                               CLE028
0324 C                     Z-ADDIACD      ZIBEG
     C                     ENDIF                                                              CLE028
0325 C                     Z-ADDREPCD     ZIEND
0326 C   35 36             Z-ADDMDAT      ZIEND
      *                                                                                       CLE028
      ** If Flat Rate Personal Loans (Rule of 78s) is installed,                              CLE028
      ** derive the outstanding interest of flat rate personal                                CLE028
      ** loans using the Rule of 78s. Adjustment of end date                                  CLE028
      ** does not apply to this type of loan.                                                 CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
      *                                                                                       CLE028
     C                     EXSR SRIN78                                                        CLE028
      *                                                                                       CLE028
     C                     ELSE                                                               CLE028
      *                                                                   S01392
      * adjust end date according to 'additional day indicator'           S01392
     C**********           Z-ADDVDAT      ZVDAT                                        S01392 245082
     C           RUND      IFGE MDAT                                                          248430
     C                     Z-ADDMDAT      ZMDAT                                               245082
     C                     ELSE                                                               248430
     C                     Z-ADDRUND      ZMDAT                                               248430
     C                     ENDIF                                                              248430
     C                     EXSR ZFLAC                                     S01392
      *                                                                   S01392
0327 C                     MOVE ICBS      ZICALC
0328 C                     Z-ADDCPAM      ZIAMT
0329 C                     Z-ADDINTR      ZIRATE
     C/COPY WNCPYSRC,LE1110C003
0330 C                     EXSR GLINTC
     C/COPY WNCPYSRC,LE1110C004
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
0331 C           TAG05     TAG                             ** TAG05 TAG **
0332 C**
0333 C**   ACCUMULATE TOTAL INTEREST TO DATE
0334 C**
     C**   ROUND DOWN INTEREST IF RDFC = 'Y'                              S01392
0335 C***********ZINTR     ADD  AITC      TOTINT 130H                     S01392
     C           RDFC      COMP 'Y'                      31               S01392
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C                     MOVE *OFF      *IN31                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           *IN41     ANDEQ*OFF                                                          CLE028
     C           *IN42     ANDEQ*OFF                                                          CLE028
     C                     Z-ADDZINTR     TOTINT    H                                         CLE028
     C                     ELSE                                                               CLE028
     C  N31      ZINTR     ADD  AITC      TOTINT 130H                     S01392
     C   31      ZINTR     ADD  AITC      TOTINT                          S01392
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
0336 C           TOTINT    ADD  AIMN      TOTINT
0337 C           TOTINT    ADD  AIAP      TOTINT
     C**
     C           SKPCLC    TAG                             *** SKPCLC ***
0338 C**
0339 C**   CALCULATE INTEREST ACCRUED
0340 C**
     C*****IF*A*BASE RATE CHANGE AFTER MATURITY DATE, IACD WILL BE  E08921BHF129
     C*****CHANGED AND THUS GREATER THAN MDAT.  IPRD SHOULD NOT BE  E08921BHF129
     C*****SUBTRACTED FROM TOTINT, INSTEAD AMAD SHOULD BE EQUAL TO  E08921BHF129
     C*****PDIN.*                                                   E08921BHF129
     C***********MDAT      IFLT IACD                                E08921BHF129
     C***********MDAT      ANDNE0                                  PB/EFIXBHF129
     C***********          Z-ADDTOTINT    AMAD                      E08921BHF129
     C***********          ELSE                                     E08921BHF129
      *                                                                                       CLE028
     C           CLE028    IFEQ 'N'                                                           CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           PTYP      ANDNE80                                                            CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           ADIF      ANDNE'Y'                                                           CLE028
0341 C           TOTINT    SUB  IPRD      AMAD   130
     C                     ELSE                                                               CLE028
     C                     Z-ADDTOTINT    AMAD                                                CLE028
     C                     ENDIF                                                              CLE028
     C***********          END                                      E08921BHF129
0342 C           AMAD      SUB  ICTD      AMAD
0343 C           AMAD      SUB  IWOD      AMAD
0344 C**
0345 C                     SETON                     46
0346 C**
0347 C**   CHECK FOR W/T TYPE AND CALCULATE AMOUNT IF NECESSARY
0348 C**
0349 C           WTIN      COMP ' '                  3535
0350 C   35                Z-ADDAMAD      INTAMT 130
0351 C   35                EXSR WTAX
0352 C   35                Z-ADDWTAMT     WTAD   130
0353 C  N35                Z-ADD0         WTAD
0354 C           TAG10     TAG                             ** TAG10 TAG **
0355 C**
0356 C**   DETERMINE WHETHER INTEREST IS TO BE ACCRUED TO END OF
0357 C**   PERIOD AND SET UP TO DATE IF REQUIRED
0358 C**
0359 C   41                Z-ADD0         AMTA
     C/COPY WNCPYSRC,LE1110C007
0360 C   41                Z-ADD0         WTTA
0361 C***41******          GOTO END                                       087811
0362 C**
     C                     SETOF                     35                   E12964
     C           NIDT      IFNE 0                                         E12964
     C                     EXSR SETLOC                                    S01195
     C                     MOVE W@STBL    ZLOC                            S01195
     C***********NIDT      COMP REPCD                    35         E49685090901
     C           NIDT      COMP REPCD                  35                 090901
     C   35                MOVE IPFR      ZFREQ                           E49685
     C   35                MOVE CCY       ZCCY                            E49685
      *                                                                   CEU004
      ** If feature CEU004 is on, as well as *IN35.                       CEU004
      ** If Settlement currency for EMU non-blank, set the currency field.CEU004
      *                                                                   CEU004
     C           *IN35     IFEQ *ON                                       CLE031
     C           CEU004    IFEQ 'Y'                        If Feature On  CEU004
     C*********  *IN35     ANDEQ*ON                  And *IN35 On   CEU004CLE031
     C           CLE031    IFEQ 'N'                                       CLE031
      *                                                                   CEU004
     C           SCCY      IFNE *BLANKS                     If SetCcy # BlCEU004
     C                     MOVE SCCY      ZCCY               Set Currency CEU004
     C                     ENDIF                            End If        CEU004
     C                     ELSE                                           CLE031
     C                     MOVE CCY       TSTCCY  3                       CLE031
     C                     EXSR CURTAB                                    CLE031
     C                     MOVE TSTINC    WCCYI   1                       CLE031
     C                     EXSR SETCCY                                    CLE031
     C                     MOVE WSCCY     TSTCCY  3                       CLE031
     C                     EXSR CURTAB                                    CLE031
     C                     MOVE TSTINC    WSCCYI  1                       CLE031
     C           WSCCYI    IFEQ 'Y'                                       CLE031
     C           WSCCY     OREQ BKEURO                                    CLE031
     C           WCCYI     ANDEQ'Y'                                       CLE031
     C           SCCY      IFNE *BLANKS                                   CLE031
     C                     MOVE SCCY      ZCCY                            CLE031
     C                     ENDIF                                          CLE031
     C                     ELSE                                           CLE031
     C           WSCCY     IFNE *BLANKS                                   CLE031
     C                     MOVE WSCCY     ZCCY                            CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
     C                     ELSE                                           CLE031
     C           CLE031    IFEQ 'Y'                                       CLE031
     C                     EXSR SETCCY                                    CLE031
     C           WSCCY     IFNE *BLANKS                                   CLE031
     C                     MOVE WSCCY     ZCCY                            CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CEU004
     C                     ENDIF                           End If         CEU004
      *                                                                                       218782
      ** If Settlement Method is 09, & System Value = 'T', use the                            218782
      ** transaction currency instead of the settlement currency                              218782
     C           CLE033    IFEQ 'Y'                                                           218782
     C           SET09     ANDEQ'T'                                                           218782
     C           MDST      ANDEQ09                                                            218782
     C                     MOVE CCY       ZCCY                                                218782
     C                     ENDIF                                                              218782
     C                     ENDIF                                          CLE031
      *                                                                   CEU004
     C   35                MOVE IFDY      ZMDAY                           E49685
     C   35                MOVE NIDT      ZDAYNO                          E49685
     C   35                EXSR ZFRQA                                     E49685
     C   35                Z-ADDZDAYNO    NIDT                            E49685
0363 C*****      NIDT      COMP REPCD                35                   E10536
0363 C********** NIDT      COMP MDAT                   35          E10536 S01117
0363 C  N70      NIDT      COMP MDAT                   35          E10536 S01117
     C                     END                                            E12964
0364 C           MDAT      COMP 0                    36
     C*                                                                   E38567
     C** Exclude loans matured before report control date                 E38567
     C*                                                                   E38567
0365 C***********MDAT      COMP REPCD                  3737               E38567
0365 C           MDAT      COMP REPCD                  37                 E38567
0366 C***35******          Z-ADDNIDT      TODAT   50                      142199
0367 C**N35*36***          Z-ADDMDAT      TODAT                           142199
0368 C**N35N36***          Z-ADD0         TODAT                           142199
     C***********TODAT     COMP REPCD                32            E80742 E18465
     C***32******          Z-ADDREPCD     TODAT   50               E80742 E18465
     C*                                                                   S01465
     C*If*core*feature*S01465*is*switched*on,*set*the*to*dateto*nextS01465142199
     C***interest*date*if*not*zero,*else*set*to*maturity*date*if*notS01465142199
     C***zero,*else*set*to*zero***********************************  S01465142199
     C***********                                                   S01465142199
     C************IN47     IFEQ '1'                                 S01465142199
     C***********                                                   S01465142199
     C***********NIDT      IFGT 0                                   S01465142199
     C***********          Z-ADDNIDT      TODAT                     S01465142199
     C***********          ELSE                                     S01465142199
     C***********MDAT      IFGT 0                                   S01465142199
     C***********          Z-ADDMDAT      TODAT                     S01465142199
     C***********          ELSE                                     S01465142199
     C***********          Z-ADD0         TODAT                     S01465142199
     C***********          END                                      S01465142199
     C***********          END                                      S01465142199
     C***********                                                   S01465142199
     C***********          END                                      S01465142199
     C**                                                                  142199
     C           REPT      IFEQ 1                                         142199
     C           REPT      OREQ 3                                         142199
     C           NRPD      IFEQ 0                                         142199
     C           PTYP      OREQ 80                                                            CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C           ADIF      ANDEQ'Y'                                                           CLE028
     C                     Z-ADDMDAT      TODAT   50                      142199
     C                     ELSE                                           142199
     C                     Z-ADDNRPD      TODAT                           142199
     C                     END                                            142199
     C                     ELSE                                           142199
     C           NIDT      IFEQ 0                                         142199
     C                     Z-ADDMDAT      TODAT                           142199
     C                     ELSE                                           142199
     C           NIDT      IFLT MDAT                                      142199
     C                     Z-ADDNIDT      TODAT                           142199
     C                     ELSE                                           142199
     C                     Z-ADDMDAT      TODAT                           142199
     C                     END                                            142199
     C                     END                                            142199
     C                     END                                            142199
     C**                                                                  142199
     C*                                                                   S01465
0369 C  N35 37             Z-ADD0         AMTA   130
     C/COPY WNCPYSRC,LE1110C008
0370 C  N35 37             Z-ADD0         WTTA   130
0371 C  N35 37             GOTO END
0372 C**
0361 C   41                GOTO END                                       087811
0373 C                     SETON                     46
0374 C**
0375 C**   CALCULATE INTEREST TO ACCRUE
0376 C**
     C**  IF STOP ACCRUALS IS ON, SET TO ZERO AND SKIP ROUND
     C   42                Z-ADD0         WTTA
     C   42                Z-ADD0         AMTA
     C/COPY WNCPYSRC,LE1110C009
     C   42                GOTO END
     C**
     C                     SETOF                     31                   S01392
      *                                                                                       CLE028
      ** If Flat Rate Personal Loans (Rule of 78s) is installed,                              CLE028
      ** add 1 to REPCD when processing a flat rate personal loan.                            CLE028
      ** This is done since the ZIBEG for the computation of the                              CLE028
      ** AMOUNT TO ACCRUE must be the day after the END DATE used                             CLE028
      ** in the computation of ACCRUED INTEREST TO DATE.                                      CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           REPCD     ADD  1         ZIBEG                                               CLE028
     C                     ELSE                                                               CLE028
0377 C**********           Z-ADDREPCD     ZIBEG                                              BUG8633
     C                     Z-ADDIACD      ZIBEG                                              BUG8633
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
0378 C   38                Z-ADDSLID      ZIBEG
0379 C                     Z-ADDTODAT     ZIEND
     C           TODAT     IFEQ MDAT                                                          245082
     C           ADDI      ANDEQ'B'                                                           245082
     C********** TODAT     ANDNEREPCD                                                  248090 248430
     C           ZIEND     ADD  1         ZIEND                                               245082
     C                     END                                                                245082
     C***When*ZIEND*is*less*than*ZIBEG*or*ZIEND*is*holiday***********                 BUG7739 244648
     C****move*Todays*date*plus*1*on*beginning*date*to*eliminate*****                 BUG7739 244648
     C****negative*interest*"To Acrrue".*****************************                 BUG7739 244648
     C           ZIEND     IFLT ZIBEG                                                        BUG7739
     C                     Z-ADD0         AMTA                                                244648
     C                     ELSE                                                               244648
     C********** BJRDNB    IFNE ZIEND                                                 BUG7739 244648
     C********** BJRDNB    ADD  1         ZIBEG                                       BUG7739 244648
     C**********           ELSE                                                       BUG7739 244648
     C**********           Z-ADDZIEND     ZIBEG                                       BUG7739 244648
     C**********           ENDIF                                                      BUG7739 244648
     C**********           ENDIF                                                      BUG7739 244648
     C*                                                                                      BUG7739
      *                                                                                       CLE028
      ** If Flat Rate Personal Loans (Rule of 78s) is installed,                              CLE028
      ** derive the AMOUNT OF INTEREST TO ACCRUE of a flat rate                               CLE028
      ** personal loan using the Rule of 78s.                                                 CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C                     EXSR SRIN78                                                        CLE028
     C                     ELSE                                                               CLE028
     C   38      ADDI      COMP 'B'                      31               S01392
     C   38 31   ZIEND     ADD  1         ZIEND                           S01392
0380 C                     MOVE ICBS      ZICALC
0381 C                     Z-ADDCPAM      ZIAMT
0382 C                     Z-ADDINTR      ZIRATE
     C/COPY WNCPYSRC,LE1110C005
0383 C                     EXSR GLINTC
     C/COPY WNCPYSRC,LE1110C006
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
0384 C***********          Z-ADDZINTR     AMTA      H                     S01392
     C           RDFC      COMP 'Y'                      31               S01392
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C                     MOVE *OFF      *IN31                                               CLE028
     C                     ENDIF                                                              CLE028
     C  N31                Z-ADDZINTR     AMTA      H                     S01392
     C   31                Z-ADDZINTR     AMTA                            S01392
      *                                                                                      BUG8633
     C           AMTA      ADD  AITC      AMTA                                               BUG8633
     C           AMTA      ADD  AIMN      AMTA                                               BUG8633
     C           AMTA      ADD  AIAP      AMTA                                               BUG8633
      *                                                                                      BUG8633
     C           AMTA      SUB  IPRD      AMTA                                               BUG8633
     C           AMTA      SUB  ICTD      AMTA                                               BUG8633
     C           AMTA      SUB  IWOD      AMTA                                               BUG8633
      *                                                                                      BUG8633
     C           AMTA      SUB  AMAD      AMTA                                               BUG8633
      *                                                                                       244648
     C                     ENDIF                                                              244648
     C/COPY WNCPYSRC,LE1110C010
0385 C**
0386 C**   CHECK FOR W/T TYPE AND CALCULATE AMOUNT IF NECESSARY
0387 C**
0388 C           WTIN      COMP ' '                  3535
0389 C   35                Z-ADDAMTA      INTAMT
0390 C   35                EXSR WTAX
0391 C   35                Z-ADDWTAMT     WTTA   130
0392 C  N35                Z-ADD0         WTTA
0393 C           END       TAG                             ** END TAG ****
0394 C**
0395 C**   COUNT RECORDS OUTPUT
0396 C**
      ** Zero out ACCRUED TO DATE and TO ACCRUE fields                                      AR996000
      ** if Interest Rate is neqative                                                       AR996000
     C           INTR      IFLT 0                                                           AR996000
     C           AMAD      ANDLT0                                                           AR996000
     C                     Z-ADD0         AMAD                                              AR996000
     C                     Z-ADD0         AMTA                                              AR996000
     C                     ENDIF                                                            AR996000
0397 C   46      CNTOUT    ADD  1         CNTOUT
     C*                                                                   S01260
     C**********           MOVE CNUM      SNUM    60                                   S01260 CSD027
     C                     MOVE CNUM      SNUM    6                                           CSD027
     C*                                                                   S01260
     C**IF*PART.PURCH.AND*RCSI=BLANK,*OUTPUT*ORIGINAL*CUSTOMER*NO.  S01260E26745
     C* IF PART.PURCH.AND RCSI NE 'Y', OUTPUT ORIGINAL CUSTOMER NO.       E26745
     C*                                                                   S01260
     C                     SETOF                     8183                 S01260
     C           PTYP      COMP 64                       81               S01260
     C  N81      PTYP      COMP 65                       81               S01260
      *                                                                   CLE005
      ** Check for Processing Types 68 or 71                              CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           PTYP      IFEQ 68                                        CLE005
     C           PTYP      OREQ 71                                        CLE005
     C                     MOVE *ON       *IN81                           CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C***81******RCSI      COMP ' '                      83         S01260E26745
     C   81      RCSI      COMP 'Y'                  8383                 E26745
     C   83                MOVE OLNO      SNUM                            S01260
     C*                                                                   S01260
     C**                                                                  S01117
     C*    VALIDATE THE BRANCH CODE                                       S01117
     C**                                                                  S01117
     C           *IN46     IFEQ '1'                                       S01117
     C* Check whether details for Branch already in array                                     CSC042
     C                     MOVELBRCA      ##KB                                                CSC042
     C                     EXSR ##CHKB                                                        CSC042
      * If branch is in the array then use the details                                        CSC042
     C           ##FIC     IFEQ 'Y'                        *** B10                            CSC042
     C                     EXSR ##SETB                                                        CSC042
     C                     ELSE                            *** X10                            CSC042
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BRCA      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01177 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL@DSNB     DBKEY                           S01117
     C                     MOVEL'SDBRCHPD'DBFILE           ************   S01117
     C                     Z-ADD4         DBASE            * DBASE 04 *   S01117
     C                     MOVEL@OPTN     DBOPTN  7        ************   S01117
     C                     SETON                     U7U8LR               S01117
     C                     GOTO ABEND                                     S01117
     C                     ELSE                                                               CSC042
      * Details found on the DB so add them to the array                                      CSC042
      * if the array still has room                                                           CSC042
     C                     EXSR ##ADDB                                                        CSC042
     C                     END                                            S01117
     C                     ENDIF                           *** E10                            CSC042
     C                     END                                            S01117
0398 C**
0399 C**   DETERMINE WHETHER PART. SOLD
0400 C**
0401 C                     SETOF                     39
0402 C   46      PTYP      COMP 66                       39
0403 C   46N39   PTYP      COMP 67                       39
      *                                                                   CLE005
      ** Check for Processing Types 69 or 72                              CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           *IN46     IFEQ *ON                                       CLE005
     C           *IN39     ANDEQ*OFF                                      CLE005
      *                                                                   CLE005
     C           PTYP      IFEQ 69                                        CLE005
     C           PTYP      OREQ 72                                        CLE005
     C                     MOVE *ON       *IN39                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
0404 C**
0405 C**   IF PART. SOLD CHAIN FOR ORIG. DETS.
0406 C**
     C  N39                GOTO TAGA                                      S01260
0407 C   39                MOVELOLNO      CLOKEY
0408 C   39      CLOKEY    CHAINCLOANC               99
     C           *IN99     IFEQ '1'                                                          BUG8157
     C           *IN39     ANDEQ'1'                                                          BUG8157
     C           CLOKEY    CHAINMLOAN                99                                      BUG8157
     C                     ENDIF                                                             BUG8157
0410 C   39 99             SETON                     LRU7U8
0411 C   39 99             MOVE 'CLOAN'   DBFILE
0412 C   39 99             MOVELCLOKEY    DBKEY
0413 C   39 99             Z-ADD3         DBASE            DBASE 3
     C   U8                GOTO ABEND                                     S01117
     C   99                SETOF                     46                   S01260
     C*                                                                   S01260
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,LE1110CVSF                                           S01408
     C* CHECK IF THE ORIGINAL LOAN WAS PURCHASED, AND, IF SO              S01260
     C* WAS IT PURCHASED WITH RECOURSE ?                                  S01260
     C           SPTYP     IFLE 65                                        S01260
     C           SPTYP     IFGE 64                                        S01260
     C***********SRCSI     IFEQ ' '                                 S01260E26745
     C           SRCSI     IFNE 'Y'                                       E26745
     C*                                                                   S01260
     C* IF THE ORIGINAL LOAN WAS PURCHASED WITHOUT RECOURSE,              S01260
     C* USE THE ORIGINAL BORROWER AS A CUSTOMER.                          S01260
     C                     MOVE SOLNO     SNUM                            S01260
     C                     GOTO TAGA                                      S01260
     C                     END                                            S01260
     C                     END                                            S01260
     C                     END                                            S01260
      *                                                                   CLE005
      ** Check for Processing Types 68 or 71                              CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           SPTYP     IFEQ 68                                        CLE005
     C           SPTYP     OREQ 71                                        CLE005
      *                                                                   CLE005
     C           SRCSI     IFNE 'Y'                                       CLE005
     C                     MOVE SOLNO     SNUM                            CLE005
     C                     GOTO TAGA                                      CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
     C*                                                                   S01260
     C                     MOVE SCNUM     SNUM                            S01260
     C*                                                                   S01260
     C           TAGA      TAG                                            S01260
     C*                                                                   S01260
0415 C**
0416 C**
0417 C**   LAST RECORD CALCS
0418 C**
0419 C*R*********CONTIN    ADD  1         CONTIN                          S01117
0420 CLR         CNTOUT    ADD  1         CNTOUT
     CLR         ABEND     TAG                                            S01117
0419 CLR         CONTIN    ADD  1         CONTIN                          S01117
0421 CLR U7                MOVE 'LE1110'  DBPGM
0422 CLRNU8      CONTIN    COMP NORE                 U8U8
0423 CLRNU8      INWN      COMP VLAF                 U8U8
0424 CLRNU8      INDC      COMP VLAL                 U8U8
     CLR U7 U8             EXSR *PSSR                                     S01117
1018 C**
0425 C********************************************************************
      /EJECT                                                                                  CSC042
     C********************************************************************                    CSC042
      *                                                                                       CSC042
      * ##CHKB - Subroutine to check the Branch in the arrays                                 CSC042
      *                                                                                       CSC042
     C           ##CHKB    BEGSR                                                              CSC042
      *                                                                                       CSC042
     C           *LIKE     DEFN A8BRCD    ##KB                                                CSC042
      *                                                                                       CSC042
      * Set off the branch found indicator                                                    CSC042
     C                     MOVEL*BLANK    ##FIC   1                                           CSC042
      *                                                                                       CSC042
      * Save the state of indicator 30 so it can be reset at the end                          CSC042
      * of the SR as it may be used elsewhere in the code                                     CSC042
     C           *IN30     IFEQ *ON                                                           CSC042
     C                     MOVEL'Y'       #IN30   1                                           CSC042
     C                     ELSE                                                               CSC042
     C                     MOVEL'N'       #IN30                                               CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
     C                     SETOF                         30                                   CSC042
      *                                                                                       CSC042
      * Restore the saved Value of B                                                          CSC042
     C                     Z-ADD##BSV     B                                                   CSC042
      *                                                                                       CSC042
     C* Check whether details for Branch already in array                                     CSC042
      *                                                                                       CSC042
      * Is this the same as the last LOKUP, if so we can bypass                               CSC042
      * the LOKUP                                                                             CSC042
      * Defend against B being 0                                                              CSC042
     C           B         IFEQ 0                                                             CSC042
     C                     Z-ADD1         B                                                   CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
      * If the branch being checked is the same then use these                                CSC042
      * details rather than doing a LOKUP                                                     CSC042
     C           ##KB      IFEQ ##BR,B                                                        CSC042
      * Found so seton 30                                                                     CSC042
     C                     SETON                         30                                   CSC042
     C                     ELSE                                                               CSC042
     C                     Z-ADD1         B                                                   CSC042
     C           ##KB      LOKUP##BR,B                   30                                   CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
      * Save the last update to B                                                             CSC042
     C           *IN30     IFEQ *ON                                                           CSC042
     C                     Z-ADDB         ##BSV                                               CSC042
      * Set the indicator to show the data was found                                          CSC042
     C                     MOVEL'Y'       ##FIC                                               CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
      * Reset the state of indicator 30.                                                      CSC042
     C           #IN30     IFEQ 'Y'                                                           CSC042
     C                     MOVEL*ON       *IN30                                               CSC042
     C                     ELSE                                                               CSC042
     C                     MOVEL*OFF      *IN30                                               CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
     C                     ENDSR                                                              CSC042
      ********************************************************************                    CSC042
      /EJECT                                                                                  CSC042
      ********************************************************************                    CSC042
      *                                                                                       CSC042
      * ##SETB - Sets up the SDBRCHPD fields used in the code from the                        CSC042
      * arrays                                                                                CSC042
      *                                                                                       CSC042
     C           ##SETB    BEGSR                                                              CSC042
      *                                                                                       CSC042
     C                     MOVEL##BR,B    A8BRCD                                              CSC042
     C                     MOVEL##BC,B    CMPYM                                               CSC042
      *                                                                                       CSC042
     C                     ENDSR                                                              CSC042
      *                                                                                       CSC042
      ********************************************************************                    CSC042
      /EJECT                                                                                  CSC042
      ********************************************************************                    CSC042
      *                                                                                       CSC042
      * ##ADDB - Adds the SDBRCHPD fields used in the code to the                             CSC042
      * arrays                                                                                CSC042
      *                                                                                       CSC042
     C           ##ADDB    BEGSR                                                              CSC042
      *                                                                                       CSC042
      * If there is still room in the array then add the details                              CSC042
     C           ##BNDX    IFLT 999                                                           CSC042
     C                     ADD  1         ##BNDX                                              CSC042
     C                     Z-ADD##BNDX    B                                                   CSC042
     C                     MOVELA8BRCD    ##BR,B                                              CSC042
     C                     MOVELCMPYM     ##BC,B                                              CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
      * Update ##BSV  so next call to ##CHKB checks this latest adddition                     CSC042
      * to the array first                                                                    CSC042
     C                     Z-ADDB         ##BSV                                               CSC042
      *                                                                                       CSC042
     C                     ENDSR                                                              CSC042
      ********************************************************************                    CSC042
      /EJECT                                                                                  CSC042
      ********************************************************************                    CSC042
0426 C*                                                                  *
0427 C*    WTAX SR. TO CALCULATE WITHHOLDING TAX AMOUNT                  *
0428 C*                                                                  *
0429 C           WTAX      BEGSR                           ** WTAX BEGSR *
0430 C**
0431 C           WTIN      COMP 'N'                  3434
0432 C   34                GOTO NOTN
0433 C**
0434 C**   WITHHOLDING TAX NET
0435 C**
0436 C           100       SUB  WTRT      WRK1   117
0437 C           INTAMT    MULT WTRT      WRK2   130H
     C**                                                                  S01392
     C**   ROUND DOWN WITHHOLDING TAX IF RDFC = 'Y'                       S01392
0438 C***********WRK2      DIV  WRK1      WTAMT  130H                     S01392
     C  N31      WRK2      DIV  WRK1      WTAMT  130H                     S01392
     C   31      WRK2      DIV  WRK1      WTAMT                           S01392
     C**                                                                  S01392
0439 C                     GOTO WTEND
0440 C**
0441 C**   WITTHOLDING TAX GROSS OR RECEIVABLE
0442 C**
0443 C           NOTN      TAG                             ** NOTN TAG ***
0444 C           INTAMT    MULT WTRT      WRK2      H
     C**                                                                  S01392
     C**   ROUND DOWN WITHHOLDING TAX IF RDFC = 'Y'                       S01392
0445 C***********WRK2      DIV  100       WTAMT     H                     S01392
0445 C  N31      WRK2      DIV  100       WTAMT     H                     S01392
0445 C   31      WRK2      DIV  100       WTAMT                           S01392
0446 C**
0447 C           WTEND     ENDSR                           ** WTEND ENDSR
0448 C*                                                                  *
0625 C********************************************************************
      /COPY ZSRSRC,ZDATE2Z4                                               S01392
      /COPY ZSRSRC,ZDATE1Z2                                               S01392
      /COPY ZSRSRC,GLINTCZ1                                               S01392
      /COPY ZSRSRC,ZSAVEZ1                                                S01392
      /COPY ZSRSRC,ZRSTORZ1                                               S01392
      /COPY ZSRSRC,ZFLACZ2                                                S01392
0625 C********************************************************************
0626 C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
0627 C*   IND '99' IS SET BY AN OVERFLOW ERROR
0628 C*
0629 CSR         GLZADD    BEGSR                           *** GLZADD ****
0630 C*
0631 CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
0632 CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
0633 C*
0634 C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
0635 CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
0636 CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
0637 C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
0638 C*
0639 CSR                   EXSR GLZSUM
0640 CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
0641 C*
0642 C********************************************************************
0643 C********************************************************************
0644 C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
0645 C*                        GLZADD, GLZSUB, GLZCMP.
0646 C*          PARAMETERS PASSED -
0647 C*                     I/P ZZAMTI ZZAMTD
0648 C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
0649 C*
0650 CSR         GLZSUM    BEGSR                           *** GLZSUM ****
0651 C*
0652 CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
0653 CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
0654 CSR                   SETOF                     919293
0655 CSR                   SETOF                     949599
0656 C*
0657 C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
0658 CSR         ZZAMTI    COMP 0                      9293
0659 CSR 93      ZZAMTD    COMP 0                      9293
0660 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0661 C*
0662 C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
0663 CSR         ZZTOTI    COMP 0                      9193
0664 CSR 93      ZZTOTD    COMP 0                      9193
0665 C*
0666 C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
0667 CSR 93                Z-ADDZZAMTI    ZZTOTI
0668 CSR 93                Z-ADDZZAMTD    ZZTOTD
0669 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0670 C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
0671 CSR 91N92
0672 CORN91 92             GOTO ZZOFPS
0673 C*
0674 CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
0675 CSR         ZZWK2     COMP 999                  93    '93' = CARRY
0676 CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
0677 C*
0678 CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
0679 CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
0680 CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
0681 CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
0682 C*
0683 C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
0684 CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
0685 CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
0686 CSRN99                Z-ADDZZWK2     ZZTOTD
0687 CSRN99                Z-ADDZZWK3     ZZTOTI
0688 C*
0689 C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
0690 CSR 99                Z-ADD0         ZZAMT  153
0691 CSR                   GOTO ZZSEND
0692 C*
0693 C* THE 'SIGNS' ARE DIFFERENT
0694 CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
0695 C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
0696 C*
0697 CSR 92                Z-SUBZZAMTI    ZZAMTI 150
0698 CSR 92                Z-SUBZZAMTD    ZZAMTD  30
0699 C*
0700 C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
0701 C*
0702 CSR 91                Z-SUBZZTOTI    ZZTOTI
0703 CSR 91                Z-SUBZZTOTD    ZZTOTD
0704 C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
0705 C*
0706 CSR         ZZTOTI    COMP ZZAMTI               93  95
0707 CSR 95      ZZTOTD    COMP ZZAMTD               93  95
0708 C*
0709 C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
0710 CSR 95                Z-ADD0         ZZTOTI
0711 CSR 95                Z-ADD0         ZZTOTD
0712 CSR 95                GOTO ZZSEND
0713 C*
0714 C* IF ZZTOT GT. ZZAMT.
0715 CSR 93      ZZAMTD    COMP ZZTOTD               94
0716 CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
0717 CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
0718 CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
0719 CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
0720 CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
0721 C*
0722 C*
0723 C* IF ZZAMT GT. ZZTOT.
0724 CSRN93      ZZTOTD    COMP ZZAMTD               94
0725 CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
0726 CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
0727 CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
0728 CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
0729 CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
0730 CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
0731 C*
0732 C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
0733 CSR                   SETOF                     94
0734 CSR 93 91
0735 CORN93 92             SETON                     94
0736 CSR 94                Z-SUBZZTOTI    ZZTOTI
0737 CSR 94                Z-SUBZZTOTD    ZZTOTD
0738 C**
0739 C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
0740 CSR 92                Z-SUBZZAMTI    ZZAMTI
0741 CSR 92                Z-SUBZZAMTD    ZZAMTD
0742 CSR         ZZSEND    TAG                             ** ZZSEND TAG *
0743 C**
0744 C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
0745 CSR                   SETOF                     96
0746 CSR         ZZTOTD    COMP 0                        91
0747 CSR 91      ZZTOTI    COMP 0                      96
0748 CSR 96                MOVE '.000-'   ZZNEGD  5
0749 CSR                   ENDSR                             ** ENDSR **
0750 C********************************************************************
0837 C********************************************************************
0838 C**
0839 C**   ZSYSTM SR. TO CHAIN TO THE INSTALLATION CONTROL DATA RECORD.
0840 C**
0841 C           ZSYSTM    BEGSR                           *** ZSYSTM ***
0842 C**********                                                          S01194
0843 C*****SET*UP KEY FOR INSTALLATION CONTROL RECORD.                    S01194
0844 C**********           MOVEL'01      'ZTABKY 12                       S01194
0845 C**********           MOVE '  10'    ZTABKY                          S01194
0846 C**********                                                          S01194
0847 C********** ZTABKY    CHAINTABLE                99    ON NOT THERE   S01194
0848 C**N99***** RECI      COMP 'D'                  9999  ON, IS DELETED S01194
0849 C**********                                                          S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C           @RTCD     IFNE *BLANK                                    S01194
0254 C                     SETON                     99                   S01194
     C                     END                                            S01194
0850 C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.
0851 C           DATF      COMP 'M'                      98MMDDYY, 98 ON
0852 C**
0853 C                     ENDSR
0854 C**
0855 C**
     C/SPACE 3                                                            S01195
     C********************************************************************S01195
     C*                                                                   S01195
     C* ZACCH  --- SUBROUTINE TO ACCESS A HOLIDAY RECORD FOR A            S01195
     C*            PARTICULAR CURRENCY AND (OPTIONAL) LOCATION.           S01195
     C*                                                                   S01195
     C* CALLED FROM: ZFWDT, ZBKDT                                         S01195
     C*                                                                   S01195
     C* CALLS: NOTHING                                                    S01195
     C*                                                                   S01195
     C********************************************************************S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
     C/SPACE 3                                                            S01195
     C********************************************************************S01195
     C*                                                                   S01195
     C* ZFWDT  --- SUBROUTINE TO CALCULATE THE NTH WORKING DAY            S01195
     C*            FORWARD FROM A GIVEN START DATE FOR ANY                S01195
     C*            PARTICULAR CURRENCY AND (OPTIONAL) LOCATION.           S01195
     C*                                                                   S01195
     C* CALLED FROM: FREQA                                                S01195
     C*                                                                   S01195
     C* CALLS: ZACCH                                                      S01195
     C*                                                                   S01195
     C********************************************************************S01195
     C/COPY ZSRSRC,ZFWDT                                                  S01195
     C/SPACE 3                                                            S01195
     C********************************************************************S01195
     C*                                                                   S01195
     C* ZBKDT  --- SUBROUTINE TO CALCULATE THE NTH WORKING DAY            S01195
     C*            BACKWARD FROM A GIVEN START DATE FOR ANY               S01195
     C*            PARTICULAR CURRENCY AND (OPTIONAL) LOCATION.           S01195
     C*                                                                   S01195
     C* CALLED FROM: FREQA                                                S01195
     C*                                                                   S01195
     C* CALLS: ZACCH                                                      S01195
     C*                                                                   S01195
     C********************************************************************S01195
     C/COPY ZSRSRC,ZBKDT                                                  S01195
     C/SPACE 3                                                            S01195
1267 C********************************************************************E49685
1268 C**                                                                  E49685
1269 C**   ZFRQA SR. TO INCREMENT A DAY NUMBER DATE BY A                  E49685
1270 C**             PERIOD VALUE DETERMINED BY A CODE.                   E49685
1271 C**             (STANDARD ZFREQ AMENDED TO ACCOMODATE                E49685
1272 C**             EXTRA CODES P,K,H,G )                                E49685
1273 C**                                                                  E49685
1274 C           ZFRQA     BEGSR                           *** ZFRQA ***  E49685
1275 C**                                                                  E49685
1276 C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.                           E49685
1277 C                     MOVE ZFREQ     ZFREQ   1                       E49685
1278 C                     Z-ADDZDAYNO    ZDAYNO  50                      E49685
1279 C                     Z-ADDZMDAY     ZMDAY   20                      E49685
1280 C                     MOVE ZCCY      ZCCY    3                       E49685
1281 C**                                                                  E49685
1282 C***********          MOVE '   '     ZHC                             S01195
1283 C***********          MOVE ' '       ZTABKY 12                       S01195
1284 C**                                                                  E49685
1285 C**   CONVERT DAY NUMBER TO DATE.                                    E49685
1286 C                     EXSR ZDATE2                                    E49685
1287 C**                                                                  E49685
1288 C**   CHECK FOR AND INCREMENT FOR CODE D-DAILY-WORKING DAY.          E49685
1289 C           ZFREQ     COMP 'D'                      91               E49685
1290 C   91      ZDAYNO    ADD  1         ZDAYNO                          E49685
1291 C***91*****           GOTO ZFHCHK                                                 E49685 CLE028
     C   91                GOTO ZFHCHX                                                        CLE028
1292 C**                                                                  E49685
1293 C**   CHECK FOR AND INCREMENT FOR CODE W-WEEKLY.                     E49685
1294 C           ZFREQ     COMP 'W'                      91               E49685
1295 C   91      ZDAYNO    ADD  7         ZDAYNO                          E49685
1296 C***91*****           GOTO ZFEND                                                  E49685 CLE028
     C   91                GOTO ZFENDX                                                        CLE028
1297 C**                                                                  E49685
1298 C**   CHECK FOR AND INCREMENT FOR CODE F-FORTNIGHTLY.                E49685
1299 C           ZFREQ     COMP 'F'                      91               E49685
1300 C   91      ZDAYNO    ADD  14        ZDAYNO                          E49685
1301 C***91*****           GOTO ZFEND                                                  E49685 CLE028
     C   91                GOTO ZFENDX                                                        CLE028
1302 C**                                                                  E49685
1303 C**   CHECK FOR AND INCREMENT FOR CODE S-SEMI-MONTHLY.               E49685
1304 C           ZFREQ     COMP 'S'                      91               E49685
1305 C   91      ZDAY      COMP 15                   939292               E49685
1306 C   91 92             Z-ADD31        ZDAY                            E49685
1307 C   91 93             Z-ADD15        ZDAY                            E49685
1308 C   91 93   ZMTH      ADD  1         ZMTH                            E49685
1309 C   91                GOTO ZFDATE                                    E49685
1310 C**                                                                  E49685
1311 C**   CHECK FOR AND INCREMENT FOR CODE M-MONTHLY.                    E49685
1312 C           ZFREQ     COMP 'M'                      91               E49685
1313 C   91                Z-ADDZMDAY     ZDAY                            E49685
1314 C   91      ZMTH      ADD  1         ZMTH                            E49685
1315 C   91                GOTO ZFDATE                                    E49685
1316 C**                                                                  E49685
1317 C**   CHECK FOR AND INCREMENT FOR CODE R-SIX DAYS BEFORE END OF MONTHE49685
1318 C           ZFREQ     COMP 'R'                      91               E49685
1319 C   91                Z-ADD31        ZDAY                            E49685
1320 C   91      ZMTH      ADD  1         ZMTH                            E49685
1321 C   91                GOTO ZFDATE                                    E49685
1322 C**                                                                  E49685
1323 C**   CHECK FOR AND INCREMENT FOR CODE T-BIMONTHLY.                  E49685
1324 C           ZFREQ     COMP 'T'                      91               E49685
1325 C   91                Z-ADDZMDAY     ZDAY                            E49685
1326 C   91      ZMTH      ADD  2         ZMTH                            E49685
1327 C   91                GOTO ZFDATE                                    E49685
1328 C**                                                                  E49685
1329 C**   CHECK FOR AND INCREMENT FOR CODE Q-QUARTERLY.                  E49685
1330 C           ZFREQ     COMP 'Q'                      91               E49685
1331 C   91                Z-ADDZMDAY     ZDAY                            E49685
1332 C   91      ZMTH      ADD  3         ZMTH                            E49685
1333 C   91                GOTO ZFDATE                                    E49685
1334 C**                                                                  E49685
1335 C**   CHECK FOR AND INCREMENT FOR CODE X-SIX MONTHLY.                E49685
1336 C           ZFREQ     COMP 'X'                      91               E49685
1337 C   91                Z-ADDZMDAY     ZDAY                            E49685
1338 C   91      ZMTH      ADD  6         ZMTH                            E49685
1339 C   91                GOTO ZFDATE                                    E49685
1340 C**                                                                  E49685
1341 C**   CHECK FOR AND INCREMENT FOR CODE Y-YEARLY.                     E49685
1342 C           ZFREQ     COMP 'Y'                      91               E49685
1343 C   91                Z-ADDZMDAY     ZDAY                            E49685
1344 C   91      ZYEAR     ADD  1         ZYEAR                           E49685
1345 C   91                GOTO ZFDATE                                    E49685
1346 C**                                                                  E49685
1347 C**   CHECK FOR AND INCREMENT FOR CODE L-LAST CALENDAR DAY OF MONTH. E49685
1348 C           ZFREQ     COMP 'L'                      91               E49685
1349 C   91                Z-ADD31        ZDAY                            E49685
1350 C   91      ZMTH      ADD  1         ZMTH                            E49685
1351 C   91                GOTO ZFDATE                                    E49685
1352 C**                                                                  E49685
1353 C**   CHECK FOR AND INCREMENT FOR CODE B-LAST WORKING DAY OF MONTH.  E49685
1354 C           ZFREQ     COMP 'B'                      91               E49685
1355 C   91                Z-ADD31        ZDAY                            E49685
1356 C   91      ZMTH      ADD  1         ZMTH                            E49685
1357 C   91                GOTO ZFDATE                                    E49685
1358 C**                                                                  E49685
1359 C**   CHECK FOR AND INCREMENT FOR CODE P-PENULT. WORK/DAY OF MONTH   E49685
1360 C           ZFREQ     COMP 'P'                      91               E49685
1361 C   91                Z-ADD31        ZDAY                            E49685
1362 C   91      ZMTH      ADD  1         ZMTH                            E49685
1363 C   91                GOTO ZFDATE                                    E49685
1364 C**                                                                  E49685
1365 C**   CHECK FOR AND INCREMENT FOR CODE K-PENULT. WORK/DAY OF QUARTER E49685
1366 C           ZFREQ     COMP 'K'                      91               E49685
1367 C   91                Z-ADD31        ZDAY                            E49685
1368 C   91      ZMTH      ADD  3         ZMTH                            E49685
1369 C   91                GOTO ZFDATE                                    E49685
1370 C**                                                                  E49685
1371 C**   CHECK FOR AND INCREMENT FOR CODE H-PENULT. WORK/DAY OF HLF YR. E49685
1372 C           ZFREQ     COMP 'H'                      91               E49685
1373 C   91                Z-ADD31        ZDAY                            E49685
1374 C   91      ZMTH      ADD  6         ZMTH                            E49685
1375 C   91                GOTO ZFDATE                                    E49685
1376 C**                                                                  E49685
1377 C**   CHECK FOR AND INCREMENT FOR CODE G-PENULT. WORK/DAY OF YEAR    E49685
1378 C           ZFREQ     COMP 'G'                      91               E49685
1379 C   91                Z-ADD31        ZDAY                            E49685
1380 C   91      ZYEAR     ADD  1         ZYEAR                           E49685
1381 C   91                GOTO ZFDATE                                    E49685
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE 4- 4 MONTHLY                                      CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP '4'                      91                                   CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZMTH      ADD  4         ZMTH                                                CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE 5- 5 MONTHLY                                      CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP '5'                      91                                   CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZMTH      ADD  5         ZMTH                                                CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE 7- 7 MONTHLY                                      CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP '7'                      91                                   CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZMTH      ADD  7         ZMTH                                                CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE 8- 8 MONTHLY                                      CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP '8'                      91                                   CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZMTH      ADD  8         ZMTH                                                CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE 9- 9 MONTHLY                                      CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP '9'                      91                                   CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZMTH      ADD  9         ZMTH                                                CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE V- 10 MONTHLY                                     CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP 'V'                      91                                   CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZMTH      ADD  10        ZMTH                                                CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE E- 11 MONTHLY                                     CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP 'E'                      91                                   CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZMTH      ADD  11        ZMTH                                                CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE C- 24 MONTHLY                                     CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP 'C'                      91                                   CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZYEAR     ADD  2         ZYEAR                                               CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE I- 36 MONTHLY                                     CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP 'I'                      91                                   CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZYEAR     ADD  3         ZYEAR                                               CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE J- 48 MONTHLY                                     CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP 'J'                      91                                   CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZYEAR     ADD  4         ZYEAR                                               CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE N- 60 MONTHLY                                     CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP 'N'                      91                                   CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZYEAR     ADD  5         ZYEAR                                               CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE U- 120 MONTHLY                                    CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP 'U'                      91                                   CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZYEAR     ADD  10        ZYEAR                                               CLE064
     C   91                GOTO ZFDATE                                                        CLE064
1382 C**                                                                  E49685
1383 C**   CHECK FOR AND INCREMENT FOR CODE A-MONTHLY ACCRUAL/PROFIT DATE.E49685
1384 C********** ZFREQ     COMP 'A'                      91               S01194
1385 C**********           MOVEL'01    '  ZTABKY                          S01194
1386 C***91*****           MOVE '    11'  ZTABKY                          S01194
1387 C***91***** ZTABKY    CHAINTABLE                99    ON NOT THERE   S01194
1388 C**N99***** RECI      COMP '*'                      99               S01194
     C**********           CALL 'AOGELRR0'                                             S01194 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C********** SDGELR    PARM SDGELR    DSFDY                                        S01117 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     SETON                     99                   S01194
     C                     END                                            S01194
     C           ZFREQ     IFNE ' '                                       105752
1389 C***91N99****         Z-ADDAPDA      ZDAYNO                          E49685
1389 C     N99             Z-ADDAPDA      ZDAYNO                          E49685
     C                     END                                            105752
1390 C**                                                                  E49685
1391 C**   BYPASS IF ZFREQ IS 'A' OR ANY OTHER VALUE                      E49685
1392 C**********           GOTO ZFEND                                                  E49685 CLE028
     C                     GOTO ZFENDX                                                        CLE028
1393 C**                                                                  E49685
1394 C**                                                                  E49685
1395 C**   REFORMAT DATE AND ENSURE VALID.                                E49685
1396 C           ZFDATE    TAG                             ** ZFDATE TAG* E49685
1397 C**                                                                  E49685
1398 C**   VALIDATE MONTH.                                                E49685
1399 C           ZMTH      COMP 12                   91                   E49685
1400 C   91      ZMTH      SUB  12        ZMTH                            E49685
1401 C   91      ZYEAR     ADD  1         ZYEAR                           E49685
1402 C**                                                                  E49685
1403 C**   CHECK FOR LEAP YEAR.                                           E49685
1404 C           ZYEAR     DIV  4         ZLYR    20                      E49685
1405 C                     MVR            ZLY     10     92LEAP YEAR-92 ONE49685
1406 C**                                                                  E49685
1407 C**   VALIDATE DAY NUMBER.                                           E49685
1408 C                     MOVE ZFMD,ZMTH ZWRK2   20                      E49685
1409 C           ZMTH      COMP 2                        93               E49685
1410 C   92 93             Z-ADD29        ZWRK2                           E49685
1411 C**                                                                  E49685
1412 C           ZDAY      COMP ZWRK2                94                   E49685
1413 C   94                Z-ADDZWRK2     ZDAY                            E49685
1414 C**                                                                  E49685
1415 C**   CHECK IF CODE R, TO SUBTRACT 6 DAYS.                           E49685
1416 C           ZFREQ     COMP 'R'                      91               E49685
1417 C   91      ZDAY      SUB  6         ZDAY                            E49685
1418 C**                                                                  E49685
1419 C**   REFORMAT DATE, DDMMYY OR MMDDYY, AND CONVERT TO DAY NUMBER.    E49685
1420 C                     MOVELZDAY      ZWRK4   40                      E49685
1421 C                     MOVE ZMTH      ZWRK4                           E49685
1422 C   98                MOVELZMTH      ZWRK4                           E49685
1423 C   98                MOVE ZDAY      ZWRK4                           E49685
1424 C                     MOVELZWRK4     ZDATE                           E49685
1425 C                     MOVE ZYEAR     ZDATE                           E49685
1426 C                     EXSR ZDATE1                                    E49685
1427 C*****RESET IND. 90 - USED TO ENSURE SUBTRACTION FOR CODES P,K,H,G,  S01195
1428 C*****IS*ONLY DONE ONCE.                                    E49685   S01195
1429 C***********          SETOF                     90          E49685   S01195
1430 C**                                                                  E49685
1431 C**   CHECK IF CODE B,TO BE CHECKED FOR HOLIDAY.                     E49685
1432 C           ZFREQ     COMP 'B'                      91               E49685
1433 C**   CODES P,K,H,G, ALSO TO BE CHECKED FOR HOLIDAY                  E49685
1434 C  N91      ZFREQ     COMP 'P'                      91               E49685
1435 C  N91      ZFREQ     COMP 'K'                      91               E49685
1436 C  N91      ZFREQ     COMP 'H'                      91               E49685
1437 C  N91      ZFREQ     COMP 'G'                      91               E49685
1438 C***91N99***          GOTO ZFHCHK                           E49685   S01195
1438 C   91N99             GOTO ZFHCK2                                    S01195
1439 C**                                                                  E49685
1440 C**********           GOTO ZFEND                                                  E49685 CLE028
     C                     GOTO ZFENDX                                                        CLE028
1441 C**                                                                  E49685
1442 C**   IF FREQUENCY CODE IS 'D',                                      E49685
1443 C**   CHECK IF DAY NUMBER IS A HOLIDAY.                              E49685
1444 C********** ZFHCHK    TAG                             ** ZFHCHK TAG *             E49685 CLE028
     C           ZFHCHX    TAG                                                                CLE028
     C*                                                                   S01195
     C                     Z-ADD0         ZNRDYS                          S01195
     C                     EXSR ZFWDT                                     S01195
     C                     Z-ADDZDYNBR    ZDAYNO                          S01195
     C                     EXSR ZDATE2                                    S01195
     C**********           GOTO ZFEND                                                  S01195 CLE028
     C                     GOTO ZFENDX                                                        CLE028
     C**                                                                  S01195
     C*    IF FREQUENCY CODE IS 'B','P, 'K', 'H', 'G',                    S01195
1443 C*    CHECK IF DAY NUMBER IS A HOLIDAY.                              S01195
     C**                                                                  S01195
1444 C           ZFHCK2    TAG                             ** ZFHCK2 TAG *S01195
     C*                                                                   S01195
     C           ZFREQ     IFEQ 'B'                                       S01195
     C           ZFREQ     OREQ 'P'                                       S01195
     C           ZFREQ     OREQ 'K'                                       S01195
     C           ZFREQ     OREQ 'H'                                       S01195
     C           ZFREQ     OREQ 'G'                                       S01195
     C                     Z-ADD0         ZNRDYS                          S01195
     C                     EXSR ZBKDT                                     S01195
     C                     Z-ADDZDYNBR    ZDAYNO                          S01195
     C                     EXSR ZDATE2                                    S01195
     C                     END                                            S01195
     C*                                                                   S01195
1445 C***********          SETOF                     94            E49685 S01195
1446 C***********                                                  E49685 S01195
1447 C*****DETERMINE CODE.                                         E49685 S01195
1448 C***********ZFREQ     COMP 'D'                      91        E49685 S01195
1449 C***********ZFREQ     COMP 'B'                      92        E49685 S01195
1450 C**N92******ZFREQ     COMP 'P'                      92        E49685 S01195
1451 C**N92******ZFREQ     COMP 'K'                      92        E49685 S01195
1452 C**N92******ZFREQ     COMP 'H'                      92        E49685 S01195
1453 C**N92******ZFREQ     COMP 'G'                      92        E49685 S01195
1454 C***********                                                  E49685 S01195
1455 C*****SET*KEY FOR FIRST HOLIDAY RECORD.                       E49685 S01195
1456 C***********          MOVEL'22    '  ZTABKY                   E49685 S01195
1457 C***********          MOVELZDAYNO    ZWRK6   6                E49685 S01195
1458 C***********          MOVE 1         ZWRK6                    E49685 S01195
1459 C***********          MOVE ZWRK6     ZTABKY                   E49685 S01195
1460 C***********                                                  E49685 S01195
1461 C*****GET*HOLIDAY RECORD.                                     E49685 S01195
1462 C***********ZFHCHN    TAG            E49685           ** ZFHCHN TAG* S01195
1463 C***********ZTABKY    CHAINTABLE     E49685     93    ON NOT THERE   S01195
1464 C**N93******RECI      COMP '*'                      93        E49685 S01195
1465 C**N94******          MOVE '   '     ZHC                      E49685 S01195
1466 C***********                                                  E49685 S01195
1467 C*****STORE*CURRENCIES IF RECORD FOUND.                       E49685 S01195
1468 C**N94N93             MOVEAHCCY      ZHC,1                    E49685 S01195
1469 C***94N93             MOVEAHCCY      ZHC,26                   E49685 S01195
1470 C***********                                                  E49685 S01195
1471 C*****GET*SECORD RECORD, IF NOT ALREADY DONE.                 E49685 S01195
1472 C***********          MOVE ZTABKY    ZWRK1   10               E49685 S01195
1473 C***********ZWRK1     COMP 1                        94        E49685 S01195
1474 C***********          MOVE '2'       ZTABKY                   E49685 S01195
1475 C***94N93***          GOTO ZFHCHN                             E49685 S01195
1476 C***********                                                  E49685 S01195
1477 C*****BYPASS TO END IF NO FIRST RECORD FOUND.                 E49685 S01195
1478 C***93*94***          GOTO ZPNCHK                             E49685 S01195
1479 C***********                                                  E49685 S01195
1480 C*****DETERMINE HOLIDAY RECORD TYPE.                          E49685 S01195
1481 C***********INEX      COMP 'E'                      95        E49685 S01195
1482 C***********INEX      COMP 'I'                      96        E49685 S01195
1483 C***********                                                  E49685 S01195
1484 C*****CHECK*IF CURRENCY ON HOLIDAY.                           E49685 S01195
1485 C***********ZCCY      LOKUPZHC                      97        E49685 S01195
1486 C***********                                                  E49685 S01195
1487 C*****BYPASS IF NOT HOLIDAY FOR CURRENCY.                     E49685 S01195
1488 C***95*97***                                  E49685  EXCLUDE FOUND  S01195
1489 C*R*96N97***          GOTO ZPNCHK             E49685  INCL. NOT FOUNDS01195
1490 C***********                                                  E49685 S01195
1491 C*****INCREMENT OR DECREMENT DAY NUMBER AS REQUIRED.          E49685 S01195
1492 C***91*95N97                                  E49685  EXCL. NOT FOUNDS01195
1493 C*R*91*96*97ZDAYNO    ADD  1         ZDAYNO   E49685  INCLUDE FOUND  S01195
1494 C***********                                                  E49685 S01195
1495 C***92*95N97                                  E49685  EXCL. NOT FOUNDS01195
1496 C*R*92*96*97ZDAYNO    SUB  1         ZDAYNO   E49685  INCLUDE FOUND  S01195
1497 C***********          GOTO ZFHCHK                             E49685 S01195
1498 C***********                                                  E49685 S01195
1499 C***********                                                         E49685
1500 C***********ZPNCHK    TAG                             ** ZPNCHK TAG* E49685
1501 C**   FOR CODES REQUIRING PENULTIMATE WORKING DAY (P,K,H,G) SUBTRACT E49685
1502 C**   ONE AND CHECK THIS FOR HOLIDAY.                                E49685
1503 C***90******          GOTO ZFEND             E49685   ALREADY DONE   S01117
1504 C**                                                                  E49685
1505 C           ZFREQ     COMP 'P'                      92               E49685
1506 C  N92      ZFREQ     COMP 'K'                      92               E49685
1507 C  N92      ZFREQ     COMP 'H'                      92               E49685
1508 C  N92      ZFREQ     COMP 'G'                      92               E49685
1509 C**N92*****           GOTO ZFEND                                                  E49685 CLE028
     C  N92                GOTO ZFENDX                                                        CLE028
1510 C           ZDAYNO    SUB  1         ZDAYNO                          E49685
1511 C***********          SETON                     90          E49685   S01195
     C                     Z-ADD0         ZNRDYS                          S01195
     C                     EXSR ZBKDT                                     S01195
     C                     Z-ADDZDYNBR    ZDAYNO                          S01195
     C                     EXSR ZDATE2                                    S01195
1512 C***********          GOTO ZFHCHK                           E49685   S01195
1513 C********** ZFEND     ENDSR                           * ZFEND ENDSR *             E49685 CLE028
     C           ZFENDX    ENDSR                                                              CLE028
1514 C**                                                                  E49685
1267 C********************************************************************E49685
     C/SPACE 3                                                            S01195
     C********************************************************************S01195
     C**                                                                  S01195
     C**   SUBROUTINE TO DETERMINE SETTLEMENT LOCATIONS                   S01195
     C**   INPUT : MDST, OMDA                                             S01195
     C**   OUTPUT: W@STBL WHOSE VALUE IS :                                S01195
     C**      NOSTRO LOCATION CODE IF SETTLED THRO' A NOSTRO              S01195
     C**      *BLANKS OTHERWISE.                                          S01195
     C**                                                                  S01195
     C**   CALLED FROM: DETERMINE WHETHER INTEREST IS TO BE ACCRUED       S01195
     C**                                                                  S01195
     C********************************************************************S01195
     C           SETLOC    BEGSR                           ***  SETLOC ***S01195
      *                                                                   S01195
      ** INITIALIZE WORKING VARIABLE - SETTLEMENT BRANCH LOCATION         S01195
      *                                                                   S01195
     C           *LIKE     DEFN NRLC      W@STBL                          S01195
     C                     MOVE *BLANKS   W@STBL                          S01195
      *                                                                   S01195
      ** FOR TYPE 01,02,07,08 OR 12, SETTLEMENT LOCATION IS DETERMINED    S01195
      ** BY THE NOSTRO BRANCH.                                            S01195
      *                                                                   S01195
     C           MDST      IFEQ 01                         *B1            S01195
     C           MDST      OREQ 02                                        S01195
     C           MDST      OREQ 07                                        S01195
     C           MDST      OREQ 08                                        S01195
     C           MDST      OREQ 12                                        S01195
      *                                                                   CEU004
      ** If feature CEU004 is on                                          CEU004
      ** If Settlement currency for EMU non-blank, set the Nostro CurrencyCEU004
      *                                                                   CEU004
     C                     MOVE CCY       @KEYB            Set Deflt Ccy  CEU004
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                        If Feature On  CEU004
      *                                                                   CEU004
     C           CLE031    IFEQ 'N'                                       CLE031
     C           SCCY      IFNE *BLANKS                     If SetCcy # BlCEU004
     C                     MOVE SCCY      @KEYB              Set Currency CEU004
     C                     ENDIF                            End If        CEU004
     C                     ELSE                                           CLE031
     C                     MOVE CCY       TSTCCY                          CLE031
     C                     EXSR CURTAB                                    CLE031
     C                     MOVE TSTINC    WCCYI                           CLE031
     C                     EXSR SETCCY                                    CLE031
     C                     MOVE WSCCY     TSTCCY                          CLE031
     C                     EXSR CURTAB                                    CLE031
     C                     MOVE TSTINC    WSCCYI                          CLE031
     C           WSCCYI    IFEQ 'Y'                                       CLE031
     C           WSCCY     OREQ BKEURO                                    CLE031
     C           WCCYI     ANDEQ'Y'                                       CLE031
     C           SCCY      IFNE *BLANKS                                   CLE031
     C                     MOVE SCCY      @KEYB                           CLE031
     C                     ENDIF                                          CLE031
     C                     ELSE                                           CLE031
     C           WSCCY     IFNE *BLANKS                                   CLE031
     C                     MOVE WSCCY     @KEYB                           CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
     C                     ELSE                                           CLE031
     C           CLE031    IFEQ 'Y'                                       CLE031
     C                     EXSR SETCCY                                    CLE031
     C           WSCCY     IFNE *BLANKS                                   CLE031
     C                     MOVE WSCCY     @KEYB                           CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CEU004
     C                     ENDIF                           End If         CEU004
      *                                                                   S01195
     C                     CALL 'AONOSTR0'                                S01195
     C                     PARM '*MSG   ' @RTCD   7                       S01195
     C                     PARM '*KEY   ' @OPTN   7                       S01195
     C                     PARM *BLANKS   @KEYA   6                       S01195
     C***********          PARM CCY       @KEYB   3                S01195 CEU004
     C                     PARM           @KEYB   3        - Ccy Parm     CEU004
     C**********           PARM *BLANKS   @KEYC   4                                    S01195 CGL029
     C                     PARM *BLANKS   @KEYC  10                                           CGL029
     C                     PARM *BLANKS   @KEYD   2                       S01195
     C                     PARM OMDA      @KEYE   2                       S01195
     C                     PARM *BLANKS   BRCD    3                       S01194
     C***********          PARM           CSSN    10                S01194E49092
     C                     PARM           CSSN   10                       E49092
     C                     PARM *BLANKS   PNOI    1                       S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01195
     C           @RTCD     IFEQ *BLANKS                                   S01195
      **                                                                  S01195
      *    MOVE THE LAST 3 CHARACTERS OF CUSTOMER SHORT CODE (WHICH       S01195
      *    IS THE LOACTION CODE) TO START LOACTION CODE FIELD             S01195
      **                                                                  S01195
     C                     MOVE CSNM      DSCSNM                          S01195
     C                     MOVE NRLC      W@STBL                          S01195
     C                     END                                            S01195
      *                                                                   S01195
     C                     END                             *E1            S01195
      *                                                                   S01195
     C           SETRTN    ENDSR                           *** SETRTN *** S01195
      *****************************************************************                       CLE028
      /EJECT                                                                                  CLE028
      *****************************************************************                       CLE028
      *                                                               *                       CLE028
      *  SRIN78 - Deriving Interest Amount for a given period using   *                       CLE028
      *           the Rule of 78s                                     *                       CLE028
      *                                                               *                       CLE028
      *  Called By : Main Processing                                  *                       CLE028
      *                                                               *                       CLE028
      *  Calls     : RULE78                                           *                       CLE028
      *                                                               *                       CLE028
      *****************************************************************                       CLE028
      *                                                                                       CLE028
     C           SRIN78    BEGSR                                                              CLE028
      *                                                                                       CLE028
      ** Set up the appropriate input fields.                                                 CLE028
      *                                                                                       CLE028
     C                     Z-ADDVDAT      W78VDT                                              CLE028
     C                     Z-ADDMDAT      W78MDT                                              CLE028
     C                     Z-ADDFLTI      W78FLT                                              CLE028
     C                     MOVE RFRQ      W78RPF                                              CLE028
     C                     Z-ADDFRPD      W78FRD                                              CLE028
     C                     Z-ADDRDYN      W78RPM                                              CLE028
     C                     MOVE CCY       W78CCY                                              CLE028
     C                     MOVE *BLANKS   W78LCN                                              CLE028
     C                     Z-ADDZIBEG     W78BEG                                              CLE028
     C                     Z-ADDZIEND     W78END                                              CLE028
     C                     MOVE APDA      BKAPDT  50                                          CLE028
     C                     MOVE 'A'       W78ROA                                              CLE028
      *                                                                                       CLE028
     C                     EXSR RULE78                                                        CLE028
      *                                                                                       CLE028
     C                     Z-ADDW78INT    ZINTR                                               CLE028
      *                                                                                       CLE028
     C                     ENDSR                                                              CLE028
     C********************************************************************S01195
     C********************************************************************CLE031
     C*                                                                   CLE031
     C*  SETCCY -  Subroutine to work out the settlement currency         CLE031
     C*                                                                   CLE031
     C*  CALLED FROM:                                                     CLE031
     C*                                                                   CLE031
     C*  CALLS:                                                           CLE031
     C*                                                                   CLE031
     C********************************************************************CLE031
     C*                                                                   CLE031
     C           SETCCY    BEGSR                                          CLE031
     C                     MOVE *BLANKS   WSCCY   3                       CLE031
     C           PTYP      IFNE 66                                        CLE031
     C           PTYP      ANDNE67                                        CLE031
     C           PTYP      ANDNE69                                        CLE031
     C           PTYP      ANDNE72                                        CLE031
     C                     MOVE SCCY      WSCCY                           CLE031
     C                     ELSE                                           CLE031
     C                     MOVE PSCY      WSCCY                           CLE031
     C                     ENDIF                                          CLE031
     C                     ENDSR                                          CLE031
     C********************************************************************CLE031
     C*                                                                   CLE031
     C*  CURTAB -  Subroutine to retrieve whether currency is an 'IN' ccy CLE031
     C*                                                                   CLE031
     C*  CALLED FROM:                                                     CLE031
     C*                                                                   CLE031
     C*  CALLS:                                                           CLE031
     C*                                                                   CLE031
     C********************************************************************CLE031
     C*                                                                   CLE031
     C           CURTAB    BEGSR                                          CLE031
     C                     MOVE *OFF      *IN32                           CLE031
     C           TSTCCY    IFNE *BLANKS                                   CLE031
     C                     Z-ADD1         N       30                      CLE031
     C           TSTCCY    LOKUPACR,N                    32               CLE031
     C           *IN32     IFEQ *ON                                       CLE031
     C                     MOVE ACI,N     TSTINC  1                       CLE031
     C                     ELSE                                           CLE031
      *                                                                   CLE031
     C                     CALL 'AOCURRR0'             99                 CLE031
     C                     PARM '*MSG    '@RTCD   7                       CLE031
     C                     PARM '*KEY    '@OPTN   7                       CLE031
     C                     PARM TSTCCY    CURKEY  3                       CLE031
     C           SDCURR    PARM SDCURR    DSSDY                           CLE031
      *                                                                   CLE031
     C           @RTCD     IFNE *BLANKS                                   CLE031
     C                     MOVEL'SDCURRPD'DBFILE                          CLE031
     C                     MOVEL'*KEY   ' DBKEY                           CLE031
     C                     Z-ADD9         DBASE                           CLE031
     C                     SETON                     U7U8LR               CLE031
     C                     SETON                     99                   CLE031
     C                     ENDIF                                          CLE031
     C                     MOVE *OFF      *IN32                           CLE031
     C           '   '     LOKUPACR,N                    32               CLE031
      *                                                                   CLE031
     C           *IN32     IFEQ *ON                                       CLE031
     C                     MOVE TSTCCY    ACR,N                           CLE031
     C                     MOVE A6INCY    ACI,N                           CLE031
     C                     MOVE A6INCY    TSTINC                          CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     ENDSR                                          CLE031
     C/SPACE 3                                                            S01195
     C********************************************************************S01117
     C*                                                                   S01117
     C*  *PSSR --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS         S01117
     C*                                                                   S01117
     C*  CALLED FROM: AFTER ABNORMAL OPERATION OCCURS                     S01117
     C*                                                                   S01117
     C*  CALLS: NOTHING                                                   S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C                     ENDSR                           ** *PSSR **    S01117
     C*                                                                   S01117
0856 C********************************************************************S01117
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZINTDYZ2                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZDATE9Z3                                               066550
     C/COPY ZSRSRC,ZDAT10Z2                                               126017
     C/COPY ZSRSRC,RULE78Z1                                                                   CLE028
     C/COPY ZSRSRC,ZFREQBZ2                                                                   CLE028
     C/COPY ZSRSRC,ZCHKH                                                                      CLE028
      /EJECT                                                              066550
0857 O**
0858 O**   LEACX - CUSTOMER LENDING INTEREST ACCRUALS EXTRACT
0859 O**
0860 OLEACXHH E        60
0861 O                                    1 'H'
0862 O                         TDAT       8P
0863 O**
0864 OLEACXAC D        46
0865 O                                    1 'D'
0866 O***********              BRCD       4                               S01117
0866 O                         BRCA       4                               S01117
0867 O                         CCY        7
0868 O                         LTYP       9
0869 O                         SUTP      11
0870 O                         PTYP      13
0871 O************             CNUM      19                               S01260
     O                         SNUM      19                               S01260
0872 O                      N39LNRF      25
0873 O                       39OLNO      25
0874 O                         SLID      28P
     O/COPY WNCPYSRC,LE1110O002
0875 O                         TODAT     31P
0876 O                         INTR      37P
0877 O                         CPAM      44P
0878 O                         AMAD      51P
0879 O                         AMTA      58P
0880 O                         WTAD      65P
0881 O                         WTTA      72P
0882 O                       39LNRF      78
     O                         CMPYM     81                               S01117
     O                         CLAS     132                                                   CLE042
     O/COPY WNCPYSRC,LE1110O001
0883 O**
0884 OLEACXZZ T        LR
0885 O                                    1 'T'
0886 O                         CNTOUT     4P
0887 O**
0888 O**   CONTROL REPORT
0889 O**
0890 O*E1110P1T** 03   LR                                                 S01117
0890 OLE1110AUT   03   LR                                                 S01117
0891 O***********                        22 'REFERENCE LE1110'            S01117
0891 O                                   22 'REFERENCE LE1110AU'          S01117
0892 O                         TITL      89
0893 O                                  104 'DATE'
0894 O                         RUNA     112
0895 O                                  127 'PAGE    1'
0896 O        T   05   LR
0897 O                                   69 'INTEREST ACCRUALS EXTRAC'
0898 O                                   86 'T - FILE CONTROLS'
0899 O        T   06   LR
0900 O                                   69 '------------------------'
0901 O                                   86 '-----------------'
0911 O        T 3      LR
0912 O                                   28 'S/CLOAN - RUN CONTROLS'
0913 O                                   59 'NUMBER'
0914 O                                   84 'VALUE'
0915 O        T 1      LR
0916 O                                   28 '----------------------'
0917 O                                   59 'OF RECORDS'
0918 O                                   84 'OF RECORDS'
0919 O        T 2      LR
0920 O                                   29 'TOTAL RECORDS ON FILE'
0921 O                      NU7NORE  3   59
0922 O                      NU7VLAF  4   81
0923 O                      NU7VLAL      84
0924 O        T 2      LR
0925 O                                   29 'TOTAL RECORDS ON FILE'
0926 O                                   42 '- CALCULATED'
0927 O                         CONTIN3   59
0928 O                         INWN  4   81
0929 O                         INDC      84
0930 O                    U8NU7         111 '***   DIFFERENCE   ***'
0931 O        T 3      LR
0932 O                                   28 'S/LEACX - RUN CONTROLS'
0933 O        T 1      LR
0934 O                                   28 '----------------------'
0935 O        T 2      LR
0936 O                                   29 'TOTAL RECORDS ON FILE'
0937 O                         CNTOUT3   59
0902 O        T 32     LR U7
0903 O***********                        51 '*** REFERENCE LE1110'        S01117
0904 O***********                        71 'DATABASE ERROR AT'           S01117
0905 O***********              DBASE     74                               S01117
0903 O                                   39 '*** REFERENCE ***'           S01117
     O                         DBPGM     51                               S01117
0904 O                                   71 'DATABASE ERROR AT'           S01117
0905 O                         DBASE     75                               S01117
0906 O        T        LR U7
0907 O***********                        37 'FILENAME'                    S01117
0908 O***********              DBFILE    43                               S01117
0909 O***********                        48 'KEY'                         S01117
0910 O***********              DBKEY     78                               S01117
0907 O                                   39 'FILENAME'                    S01117
0908 O                         DBFILE    48                               S01117
0909 O                                   52 'KEY'                         S01117
0910 O                         DBKEY     82                               S01117
0938 O********T*3*     LR                                                 S01117
0939 O************                       76 '*** END OF REPORT ***'       S01117
**  ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**  ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**  ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
** CPY@   **      OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
**   SVAL  -  SYSTEM VALUES ARRAY                                                             218782
Settlement09Postings                                                                          218782
FutValLoansOnIntAccr                                                                          137353
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
