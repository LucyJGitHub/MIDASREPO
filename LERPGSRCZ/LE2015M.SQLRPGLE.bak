     H DEBUG FIXNBR(*INPUTPACKED)
     H COPYRIGHT('(c) Finastra International Limited 2002')
      *****************************************************************
/**** *  RPGBASEMOD                                                   *                     MD054605
/*STD *  RPGSQLMOD                                                    *                     MD054605
/*EXI *  TEXT('Midas LE Lending bulk transfer')                       *
/*E*I****FIXNBR(*ZONED)************************************************                       174621
      *****************************************************************
      *                                                               *
      *  Midas - Customer Lending Module                              *
      *                                                               *
      *  LE2015M - Lending Bulk Transfer                              *
      *                                                               *
      *  Function:                                                    *
      *                                                               *
      *  This program is called automatically during                  *
      *  the COB after all the Customer Lending updates have been     *
      *  performed, to download data from the Customer Lending master *
      *  files to the Lending PC application. It also performs the    *
      *  download of the Standing Data as required by the Lending PC  *
      *  application. It can also be executed through an on request   *
      *  option at start up or for recovery purposes.                 *
      *                                                               *
      *  Called By:                                                   *
      *                                                               *
      *  LEC2015  - COB Lending Bulk Transfer Component               *
      *  LEC2015A - On Request Lending Bulk Transfer Component        *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD041126           Date 15Apr20               *
      *  Prev Amend No. CER050             Date 16Jun19               *
      *                 MD054605           Date 17Oct19               *
      *                 CLE071             Date 18Jul18               *
      *                 MD046248           Date 27Oct17               *
      *                 CSD095             Date 08Apr14               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CCB020             Date 06Aug12               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 235907             Date 06Jun06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027A            Date 10May06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 227249             Date 21May04               *
      *                 227199             Date 19May04               *
      *                 226496             Date 15Apr04               *
      *                 226490             Date 31Mar04               *
      *                 226089             Date 30Mar04               *
      *                 225427             Date 02Mar04               *
      *                 223603             Date 25Feb04               *
      *                 219071             Date 25Feb04               *
      *                 CLE035             Date 22Sep03               *
      *                 CLE036             Date 22Sep03               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3644            Date 12Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 TDA035             Date 02Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 CLE034             Date 05May03               *
      *                 CLE033             Date 01Apr03               *
      *                 CLE031             Date 10Feb03               *
      *                 211532             DATE 17Jan03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 210796             Date 27Jan03               *
      *                 CLE028             Date 27Jun02               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 211959             Date 09Jan03               *
      *                 191421             Date 06Jan03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 210749             Date 17Oct02               *
      *                 210696             Date 16Oct02               *
      *                 203561             Date 21Jun02               *
      *                 204452             Date 02May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAP070             Date 08Mar02               *
      *                 CLE023             Date 19Nov01               *
      *                 195720             Date 22Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 193083             DATE 03Jul01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             DATE 15May01               *
      *                 CPB003             DATE 04Dec00               *
      *                 189612             DATE 14Feb01               *
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CRT004             DATE 04May00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 174621             Date 03Feb00               *
      *                 163486             Date 14Oct99               *
      *                 CLE009             Date 11May99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 149721             Date 08Jun99               *
      *                 CEU030             Date 08Jun99               *
      *                 157759             Date 23Apr99               *
      *                 159085             Date 15Apr99               *
      *                 156688             Date 19Mar99               *
      *                 157926 (BT0788)    Date 28May98               *
      *                 157922 (BT1171)    Date 30Sep98               *
      *                 157286 (BT0888)    Date 17Mar99               *
      *                 157217 (BT1420)    Date 29Jan99               *
      *                 CLE008             Date 07Dec98               *
      *                 155429             Date 18Feb99               *
      *                 154773             Date 29Jan99               *
      *                 154016             Date 02Feb99               *
      *                 152695             Date 12Jan99               *
      *                 148756             Date 30Nov98               *
      *                 157286             Date 22Jun98               *
      *                 148708             Date 30Nov98               *
      *                 147933             Date 16Dec98               *
      *                 147261             Date 27Jan99               *
      *                 141477             Date 18Dec99               *
      *                 141453             Date 17Feb99               *
      *                 138354             Date 23Sep98               *
      *                 136318             Date 11Feb99               *
      *                 135072             Date 10Feb99               *
      *                 134495             Date 10Feb99               *
      *                 134078             Date 10Feb99               *
      *                 133384             Date 09Feb99               *
      *                 133237             Date 04Feb99               *
      *                 131254 +(BT0547)   Date 04Feb99               *
      *                 125697             Date 16Feb98               *
      *                 130237             Date 16Feb98               *
      *                 128762             Date 12Jan98               *
      *                 123857             Date 22Oct97               *
      *                 124061             Date 22Oct97               *
      *                 124001             Date 07Oct97               *
      *                 123335             Date 06Oct97               *
      *                 122809             Date 10Sep97               *
      *                 121783             Date 14Aug97               *
      *                 CLE005             Date 22May97               *
      *                 121052             Date 25JUL97               *
      *                 121025             Date 22JUL97               *
      *                 121024             Date 16JUL97               *
      *                 120142             Date 10JUL97               *
      *                 120001             Date 02JUL97               *
      *                 119882             Date 27JUN97               *
      *                 119867             Date 27JUN97               *
      *                 119555             Date 20JUN97               *
      *                 CLE004             Date 09MAY97               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD041126 - Certify WebSphere MQ 9 with Midas product line    *
      *           - Applied for MD055613.                             *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *           Applied for MD-55510.                               *
      *  MD054605 - Deliverable Data Split for SDSVALPD               *
      *  CLE071 - Value Dating of Rate Changes to Fees (Recompile)    *
      *  MD046248 - Finastra Rebranding                               *
      *  CSD095 - Allow Deal Sub-Type and Branch for MM and FX SSIs   *
      *           (Recompile)                                         *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CLE148 - Alpha Loan Reference                                *
      *  CCB020 - COB Restructure - Secondary COB Infrastructure      *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c             *
      *           (Recompile)                                         *
      *  CRE026 - Consumer Banking                                    *
      *  235907 - Ensure that SDBSHSPD (base rate history) is always  *
      *           downloaded as is updated during COB.  Applied fix   *
      *           225209.                                             *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A - Conversion Of Customer Number to Alpha             *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  227249 - Limit extended settlements download to types LE and *
      *           AT                                                  *
      *  227199 - Ensure all LE transactions are dwnloaded in PCRF    *
      *           sequence                                            *
      *  226496 - Change the income splits logical to LETISPL5 which  *
      *           is keyed on PC Reference                            *
      *  226490 - Introduce new start & end control messages for the  *
      *           new static data COB download to differentiate from  *
      *           an input cycle download                             *
      *  226089 - Include system value for COB bank details download  *
      *  225427 - Allow user to select which elements of static data  *
      *           to download during the COB using system values      *
      *  223603 - Introduce a variable delay between batches of msgs. *
      *           Hold delay period on positions 9/10 of LMxxx dtaara *
      *  219071 - Problems downloading when files are empty           *
      *  CLE035 - Lending Enhancements for Nordea Phase 1 Priority 2: *
      *           Income Splits                                       *
      *  CLE036 - LE Enh for Nordea Phase 1 Pty 2: Specific Base Rate *
      *           and allow repayments in facility currency.          *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  CLE025 - Credit Lines (Recompile)                            *
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CLE034 - Lending Enhancements Phase 1 Priority 1A            *
      *  CLE033 - Settlement method 09                                *
      *  CLE031 - Lending Enhancements.                               *
      *  211532 - Download SWIFT financial institution as separate    *
      *           field (including backing out of 189612)             *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enahancements to CAS001, CAS002 and CAS004          *
      *           (Recompile)                                         *
      *  210796 - Extend Our a/c at Nostro field.                     *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  211959 - LE2015M would only compile with QMQM in the library *
      *           list. Changed /copies to specify the library name.  *
      *  191421 - Recompiled due to changes to LESXMFPD               *
      *  210749 - Prevent download of facilities where the primary    *
      *           facility details or the credit application          *
      *           facility details refer to a facility which no       *
      *           longer exists on the database                       *
      *  210696 - Prevent download of loans which do not have         *
      *           corresponding facilities or parts sold which do not *
      *           have corresponding funding participant facilities   *
      *           if they have funding participants                   *
      *  203561 - Send different start and end messages if download   *
      *           is in COB rather than Input Cycle                   *
      *  204452 - Recompiled due to changed PF/LEFEED.                *
      *  CAP070 - Conversion of LE inputs into modular structure to   *
      *           use as APIs. Recompile over changed LEPARTPD        *
      *  CLE023 - Lending Facility History Improvements.              *
      *  195720 - Records missing from Partasgn table after download  *
      *  193083 - Allow for non-Loan Manager branches i.e. those with *
      *           a blank MQSeries bulk queue field on SDBRCHPD. Also *
      *           allow for multiple branches attached to the same    *
      *           Loan Manager server                                 *
      *  CSD006 - Use long DS with SDBSRTPD.                          *
      *  CPB003 - Portfolio Reference Changes in Loan Manager for PB  *
      *           Send Private Banking Module id and PB Customer      *
      *           Also send PMPORTPD if just PB is on.                *
      *           Alter order of downloan so that switchable features *
      *           are sent first. This is so that any defaulting that *
      *           needs to occur due to switchable features is using  *
      *           the latest version of this data.                    *
      *           Also change AOCUSTR0 to AOCUSTR1 to pick up new     *
      *           field                                               *
      *  189612 - Download Swift Financial Institution so that        *
      *           settlements processing in Loan Manager uses the     *
      *           same information to work out if a customer is a     *
      *           bank as Midas.                                      *
      *           Note as the only place Bank To Bank information     *
      *           field is used is in settlements so changing the     *
      *           download of this field to get the information from  *
      *           the Swift Financial Institution field.              *
      *           Note if later both the Bank To Bank information     *
      *           field and the Swift Financial Institution field     *
      *           is needed in Loan Manager then have to reverse this *
      *           change and do the fixes listed in the GEMS document.*
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *  CRT004 - Cashier Midas TCP/IP interface.                     *
      *             Recompiled over SDBRCHPD Changes                  *
      *  174621 - FIXNBR(*ZONED) now incorporated into RPGBASEMOD     *
      *           creation parameter                                  *
      *  163486 - Recompiled due to changes to LVENT.                 *
      *  CLE009 - LE I/C Swift Message Generation for Fees            *
      *           Recompiled due to changes in LEFEED                 *
      *  149721 - Use longer data structure to access AOEXSTR1.       *
      *  CEU030 - EMU Loan Manager Enhancement                        *
      *  157759 - Correct participant share percentages by sending    *
      *           the new system date to Loan Manager in COB for all  *
      *           modes. Loan Manager will simply take the values     *
      *           from Midas on change of system date, otherwise they *
      *           are re-calculated locally and are done twice.       *
      *  159085 - No message sent to LM when there are no Facility    *
      *           Amendments to download from Midas.                  *
      *  156688 - Reconciliation report still counting deleted fess   *
      *  157926 - Ignore interbranch and intercompany events          *
      *  157922 - ICYE cannot be used as a criterion for excluding
      *           events from bulk download - it is wrongly set to Y
      *           on most LVENTEL records. Rather than try to figure
      *           out why that is, let's just suppress the exclusion
      *           here for now
      *  157286 - Add PC originating branch to fees download          *
      *  157217 - New "generated by assignment" flag on facility      *
      *           amendments                                          *
      *  CLE008 - Switchable Feature For Loan Administrator Id        *
      *  155429 - Add user default branch to user message             *
      *  154773 - Place timed halt after 60 Put's so as not to        *
      *           overload the PC server. Also, store last QMQM       *
      *           return code for program dump prior to sending last  *
      *           failure message to the queue.                       *
      *  154016 - Do not count reversed transactions in the           *
      *           reconciliation report.                              *
      *  152695 - Fee Settlement date not sent from Midas to LM       *
      *  148756 - Negative amounts wrong for fees. Also correct       *
      *           margin download when negative.                      *
      *  148708 - Negative amounts wrong for manual repayments.       *
      *  147933 - Number of Transactions Downloaded by each Type of   *
      *           Transaction Report.                                 *
      *  147261 - Add Assignment or Participation indicator           *
      *  141477 - Loan Manager Financial Diary showing incomplete     *
      *           details. Events download from Midas wrong.          *
      *  141453 - Recompiled due to changes in PF/LEFEED              *
      *  138354 - If bulk download halts message should be sent to    *
      *           stop PC side.                                       *
      *  136318 - Extended settlement details for fees is not drip    *
      *           fed correctly.                                      *
      *  135072 - Fee amount needs to be sent as blanks when not      *
      *           entered.                                            *
      *  134495 - POBN/POCN/ROBN/ROCN for Risk Participants need to be*
      *           sent as blanks when not entered.                    *
      *  134078 - For certain PP's the original borrower is not       *
      *           trickle fed down.                                   *
      *  133384 - Credit Agreement Exchange Rate field is not         *
      *           formatted correctly.                                *
      *  133237 - Add profit centre field to fees drip feed.          *
      *  131254 - Negative current principal is not handled correctly.*
      *  125697 - L1ORBO and L1SLNO should not both be filled for     *
      *           both Parts. Purchased and Sold - it should be one   *
      *           or the other                                        *
      *  130237 - Add Credit Agreement Exchange rate fields to        *
      *           download.                                           *
      *  128762 - Correct fee code msg formatting                     *
      *  123857 - Add field for Authorisation to Review All Screens   *
      *           for Lending ICD                                     *
      *  124061 - Next calculation basis needs to be sent as blanks   *
      *           if zero.                                            *
      *  124001 - Set original loan number of an internal part purch  *
      *  123335 - Include new base currency exchange rate/indicator   *
      *  122809 - Certain numeric fields that are zero need to be set *
      *           to blanks, for lending files.                       *
      *  121783 - Call new access objected (AOBRCHR1) created for     *
      *           T1/2 Lending.                                       *
      *  CLE005 - Customer Lending Enhancements - Others (T3)         *
      *         - Changed to ILE module                               *
      *  121052 - Late payment penalty spread/amount set up           *
      *           incorrectly                                         *
      *  121025 - Certain numeric fields that are zero need to be set *
      *           to blanks, for lending files.                       *
      *  121024 - Only download live customers from SDCUSTPD.         *
      *  120142 - PCA ICD will be blank if module not on; therefore   *
      *           only attempt download if module present.            *
      *           Some standing data files are allowed to be empty,   *
      *           do not report as a data base error.                  *
      *  120001 - Sign for margin field should be set to blank if +VE *
      *           and 'Y' if -VE                                      *
      *  119882 - Local Industry Code should be set to blanks if zero *
      *  119867 - When only one record is put from a multiple record  *
      *           file, the continuation flag and message length are  *
      *           set incorrectly                                     *
      *  119555 - Any date and certain numeric fields that are zero   *
      *           need to be set to blanks, for lending files.        *
      *  CLE004 - Created for Customer Lending Enhancements           *
      *                                                               *
      *****************************************************************
      *
     FLEDLLDPD  UF   E           K DISK    INFSR(*PSSR)
      *
     FPMPORTLL  IF   E             DISK    INFSR(*PSSR)
      *
     FSDCODEL1  IF   E             DISK    INFSR(*PSSR)
      *
     FSDPRFML1  IF   E             DISK    INFSR(*PSSR)
      *
     FSDBSHSL1  IF   E             DISK    INFSR(*PSSR)
      *
     FSCSARDL1  IF   E             DISK    INFSR(*PSSR) USROPN
      *
     FCBAICDL1  IF   E           K DISK    INFSR(*PSSR)
      *
     FFCLTY     IF   E           K DISK    INFSR(*PSSR)
     F                                     PREFIX(F#F)
     F                                     IGNORE(FCLTYHHF:FCLTYZZF)
      *
     FFCLTYL0   IF   E           K DISK    INFSR(*PSSR)                                       210749
     F                                     RENAME(FCLTYFMF:FCLTYF2)                           210749
      *                                                                                       210749
     FCLOAN     IF   E           K DISK    INFSR(*PSSR)
     F                                     PREFIX(F#L)
     F                                     IGNORE(CLOANHHF:CLOANZ1F)
      *
     FLOAMS     IF   E           K DISK    INFSR(*PSSR)
     F                                     PREFIX(F#A)
     F                                     IGNORE(LOAMSDHF:LOAMSZ1F)
      *
     F***LEPARTL2  IF   E           K DISK    INFSR(*PSSR)
     F***LEPARTL3  IF   E           K DISK    INFSR(*PSSR)                                    195720
     FLEPARTL4  IF   E           K DISK    INFSR(*PSSR)                                       195720
     F                                     PREFIX(F#P)
      *
     FLEFCAML0  IF   E           K DISK    INFSR(*PSSR)
     F                                     PREFIX(F#M)
      *
     FLEFEEDL1  IF   E           K DISK    INFSR(*PSSR)
     F                                     PREFIX(F#D)
      *
     FLEFEADL1  IF   E           K DISK    INFSR(*PSSR)
     F                                     PREFIX(F#T)
      *
     FLVENT     IF   E           K DISK    INFSR(*PSSR)
     F                                     PREFIX(F#V)
     F                                     IGNORE(LVENTHHF:LVENTZZF)
      *
     FMUSERDD   IF   E             DISK    INFSR(*PSSR)
     F                                     PREFIX(F#U)
      *                                                                         CLE031
     F*SDSVALJ0* IF   E           K DISK    INFSR(*PSSR)                         CLE031     MD054605
                                                                                              CLE034
     FLESTALL8  IF   E           K DISK    INFSR(*PSSR)                                       CLE034
     F                                     PREFIX(F#S)                                        CLE034
                                                                                              CLE035
     FLETISPL2  IF   E           K DISK    INFSR(*PSSR)                                       CLE035
     F                                     PREFIX(F#I)                                        CLE035
      *
     FLE2015AU  O    E             PRINTER INFDS(SPOOLU)
     F                                     USROPN
     F*                                                                                       147933
     FLE2015P1  O    E             PRINTER INFDS(SPOOL1)                                      147933
     F                                     USROPN                                             147933
      *
     F/COPY WNCPYSRC,LE2015F001
      *
      **********************************************************************
      *
      *  F U N C T I O N   O F  I N D I C A T O R S
      *
      *  11 - CLE034 is installed                                                             CLE034
      *  30 - Control text 'Reason Code' on Printer File
      *  80 - Work indicator to replace BANK in X1MSGT with DLED if Lending Down
      *  84 - Work indicator for LOOKUP on array of MQSeries bulk                             193083
      *       download queues already opened                                                  193083
      *  85 - Work indicator for TESTB op code
      *  86 - Work indicator for READ
      *  87 - Work indicator for READ
      *  88 - Work indicator for chain on LEDLLDPD file
      *  89 - Work indicator for chain on LEDLLDPD file
      *  90 - Work indicator for chain on FCLTY file                                          210696
      *
      *----------------------------------------------------------------
      *  U7 U8 LR
      **********************************************************************
      *
      * Copyright
     D CPY@            S             80    DIM(1) CTDATA PERRCD(1)
      *
      * Subroutine Stack
     D STK             S             10    DIM(99)
      * Branch Code Array and related Bulk Transfer Message Queue
     D W#ABRCH         S                   DIM(999) LIKE(A8BRCD)
     D W#AMQBU         S                   DIM(999) LIKE(A8MQBU)
      * Bulk Transfer Message Queues already created and handle
     D W1AMQBU         S                   DIM(999) LIKE(A8MQBU)
     D W1AMQBH         S                   DIM(999) LIKE(P#HOBJ)
      *
     D SDBANK        E DS                  EXTNAME(SDBANKPD)
      *
     D SDBRCH        E DS                  EXTNAME(SDBRCHPD)
      *
     D SDMMOD        E DS                  EXTNAME(SDMMODPD)
      *
     D SDGELR        E DS                  EXTNAME(SDGELRPD)
      *
     D SDRETL        E DS                  EXTNAME(SDRETLPD)
     D  QQACCD1      E                     EXTFLD(QQACCD)                                     CGL029
      *
     D SDCLND        E DS                  EXTNAME(SDCLNDPD)
      *
     D SDPORT        E DS                  EXTNAME(SDPORTPD)
      *
     D SDCUST        E DS                  EXTNAME(SDCUSTPD)
     D  QQDFAC1      E                     EXTFLD(QQDFAC)                                     CGL029
      *
     D SDALTN        E DS                  EXTNAME(SDALTNPD)
      *
     D SDFACT        E DS                  EXTNAME(SDFACTPD)
      *
     D SDCURR        E DS                  EXTNAME(SDCURRPD)
      *
     D SDCTRY        E DS                  EXTNAME(SDCTRYPD)
      *
     D SDFEEC        E DS                  EXTNAME(SDFEEPD)
      *
     D SDINDS        E DS                  EXTNAME(SDINDSPD)
      *
     D SDACOF        E DS                  EXTNAME(SDACOFPD)
      *
     D SDPRFC        E DS                  EXTNAME(SDPRFCPD)
      *
     D SDBOOK        E DS                  EXTNAME(SDBOOKPD)
      *
     D SDLOAN        E DS                  EXTNAME(SDLOANPD)
      *
     D SDBSRT        E DS                  EXTNAME(SDBSRTPD)
      *
     D SDNOST        E DS                  EXTNAME(SDNOSTPD)
     D  QQACCD2      E                     EXTFLD(QQACCD)                                     CGL029
      *
     D SDCNST        E DS                  EXTNAME(SDCNSTPD)
      *
     D ACCNT         E DS                  EXTNAME(ACCNTAB)
      *
     D SDEXST        E DS                  EXTNAME(SDEXSTPD)
      *
     D SDPLCS        E DS                  EXTNAME(SDPLCSPD)
      *
     D SDHOL         E DS                  EXTNAME(SDHOLPD)
      *
     D SDTRAD        E DS                  EXTNAME(SDTRADPD)
     D  QQACCD3      E                     EXTFLD(QQACCD)                                     CGL029
      *
     D SDCCSY        E DS                  EXTNAME(SDCCSYPD)
      *
     D SDPCAC        E DS                  EXTNAME(SDPCACPD)
      *
      ** Switchable features file.
     D SCSARD        E DS                  EXTNAME(SCSARDPD)
     D  SCLCD        E                     EXTFLD(LCD)
      *
      ** Account Code Details                                                   CLE033
     D SDACOD        E DS                  EXTNAME(SDACODPD)                    CLE033
     D  QQACCD4      E                     EXTFLD(QQACCD)                                     CGL029
     D  QQFNIC4      E                     EXTFLD(QQFNIC)                                     CGL029
     D  QQFNAA4      E                     EXTFLD(QQFNAA)                                     CGL029
                                                                                CLE033
     D/COPY WNCPYSRC,LE2015D001
      *
      *
      **  Long Data Structure for Access programs.
     D DSSDY         E DS                  EXTNAME(DSSDY)
      *
      **  Short Data Structure for Access programs.
     D DSFDY         E DS                  EXTNAME(DSFDY)
      *
      **  Extra Long Data Structure for Access programs.                                      149721
     D DSLDY         E DS                  EXTNAME(DS2000DY)                                  149721
      *                                                                                       149721
      **  Static Data Download Start/End Message Format
     D DWX1MF        E DS                  EXTNAME(LEX1MFPD)
      *
      **  Static Data Download Midas Modules Message Format
     D DWS1MF        E DS                  EXTNAME(LES1MFPD)
      *
      **  Static Data Download Bank Details Message Format
     D DWS2MF        E DS                  EXTNAME(LES2MFPD)
      *
      **  Static Data Download General Ledger ICD Message Format
     D DWS3MF        E DS                  EXTNAME(LES3MFPD)
      *
      **  Static Data Download Retail ICD Message Format
     D DWS4MF        E DS                  EXTNAME(LES4MFPD)
     D  QQACCD5      E                     EXTFLD(QQACCD)                                     CGL029
      *
      **  Static Data Download Customer Lending ICD Message Format
     D DWS5MF        E DS                  EXTNAME(LES5MFPD)
      *
      **  Static Data Download Portfolio Management ICD Message Format
     D DWS6MF        E DS                  EXTNAME(LES6MFPD)
      *
      **  Static Data Download Customer Details Message Format
     D DWS7MF        E DS                  EXTNAME(LES7MFPD)
      *
      **  Static Data Download Customer Alt Name & Address Message Format
     D DWS8MF        E DS                  EXTNAME(LES8MFPD)
      *
      **  Static Data Download Facility Types Message Format
     D DWS9MF        E DS                  EXTNAME(LES9MFPD)
      *
      **  Static Data Download Branch Codes Message Format
     D DWS0MF        E DS                  EXTNAME(LES0MFPD)
      *
      **  Static Data Download Currency Codes Message Format
     D DWSAMF        E DS                  EXTNAME(LESAMFPD)
      *
      **  Static Data Download Country Codes Message Format
     D DWSBMF        E DS                  EXTNAME(LESBMFPD)
      *
      **  Static Data Download Fee Codes Message Format
     D DWSXMF        E DS                  EXTNAME(LESXMFPD)
      *
      **  Static Data Download Industry Codes Message Format
     D DWSCMF        E DS                  EXTNAME(LESCMFPD)
      *
      **  Static Data Download Account Officers Codes Message Format
     D DWSDMF        E DS                  EXTNAME(LESDMFPD)
      *
      **  Static Data Download Profit Center Matrices Message Format
     D DWSEMF        E DS                  EXTNAME(LESEMFPD)
      *
      **  Static Data Download Profit Centre Codes Message Format
     D DWSFMF        E DS                  EXTNAME(LESFMFPD)
      *
      **  Static Data Download Book Codes Message Format
     D DWSGMF        E DS                  EXTNAME(LESGMFPD)
      *
      **  Static Data Download Loan Types/sub-types Message Format
     D DWSHMF        E DS                  EXTNAME(LESHMFPD)
      *
      **  Static Data Download Base Rate Codes Message Format
     D DWSIMF        E DS                  EXTNAME(LESIMFPD)
      *
      **  Static Data Download Base Rate History Message Format
     D DWSJMF        E DS                  EXTNAME(LESJMFPD)
      *
      **  Static Data Download Nostro Codes Message Format
     D DWSKMF        E DS                  EXTNAME(LESKMFPD)
     D  QQACCD6      E                     EXTFLD(QQACCD)                                     CGL029
      *
      **  Static Data Download Counterpart Nostro Codes Message Format
     D DWSLMF        E DS                  EXTNAME(LESLMFPD)
      *
      **  Static Data Download Accounts Message Format
     D DWSMMF        E DS                  EXTNAME(LESMMFPD)
      *
      **  Static Data Download Extended Settlements Message Format
     D DWSNMF        E DS                  EXTNAME(LESNMFPD)
     D  QQPONO1      E                     EXTFLD(QQPONO)                                     CGL029
     D  QQRONO1      E                     EXTFLD(QQRONO)                                     CGL029
      *
      **  Static Data Download Portfolio References Message Format
     D DWSOMF        E DS                  EXTNAME(LESOMFPD)
      *
      **  Static Data Download Portfolio Customers Message Format
     D DWSPMF        E DS                  EXTNAME(LESPMFPD)
      *
      **  Static Data Download Holidays Message Format
     D DWSQMF        E DS                  EXTNAME(LESQMFPD)
      *
      **  Static Data Download SWIFT Codewords Message Format
     D DWSRMF        E DS                  EXTNAME(LESRMFPD)
      *
      **  Static Data Download Switchable Features Message Format
     D DWSSMF        E DS                  EXTNAME(LESSMFPD)
      *
      **  Static Data Download Trading Data ICD Message Format
     D DWSTMF        E DS                  EXTNAME(LESTMFPD)
      *
      **  Static Data Download Currency Clearing System Message Format
     D DWSUMF        E DS                  EXTNAME(LESUMFPD)
      *
      **  Static Data Download Profit Centre Accounting ICD Message Format
     D DWSVMF        E DS                  EXTNAME(LESVMFPD)
      *
      **  Lending Download Facilities Message Format
     D DWL0MF        E DS                  EXTNAME(LEL0MFPD)
      *
      **  Lending Download Loans Message Format
     D DWL1MF        E DS                  EXTNAME(LEL1MFPD)
     D  QQPONS1      E                     EXTFLD(QQPONS)                                     CGL029
     D  QQRONS1      E                     EXTFLD(QQRONS)                                     CGL029
      *
      **  Lending Download Loan Amendments Message Format
     D DWL2MF        E DS                  EXTNAME(LEL2MFPD)
     D  QQPONS2      E                     EXTFLD(QQPONS)                                     CGL029
     D  QQRONS2      E                     EXTFLD(QQRONS)                                     CGL029
      *
      **  Lending Download Risk Participants/Assignments Message Format
     D DWL3MF        E DS                  EXTNAME(LEL3MFPD)
     D  QQPONS3      E                     EXTFLD(QQPONS)                                     CGL029
     D  QQRONS3      E                     EXTFLD(QQRONS)                                     CGL029
      *
      **  Facility Amendments Message Format
     D DWL4MF        E DS                  EXTNAME(LEL4MFPD)
     D**D4DTL*                91    190                                                       157217
     D  D4DTL                 91    191                                                       157217
      *
      **  Fees Message Format
     D DWL5MF        E DS                  EXTNAME(LEL5MFPD)
     D  QQPONS4      E                     EXTFLD(QQPONS)                                     CGL029
     D  QQRONS4      E                     EXTFLD(QQRONS)                                     CGL029
     D**D5DTL**********       91   1151                                                       133237
     D**D5DTL**********       91   1155                                                133237 157286
     D**D5DTL******           91   1158                                                157286 148756
     D  D5DTL                 91   1159                                                       148756
      *
      **  Fee Settlements Message Format
     D DWL6MF        E DS                  EXTNAME(LEL6MFPD)
     D  QQPONS5      E                     EXTFLD(QQPONS)                                     CGL029
     D  QQRONS5      E                     EXTFLD(QQRONS)                                     CGL029
     D  D6DTL                 91    822
      *
      **  Lending Events Message Format
     D DWL7MF        E DS                  EXTNAME(LEL7MFPD)
     D  D7DTL                 91    549
      *
      **  Lending PC Msg Fmt Settlement Allocation                                            CLE034
     D DWL8MF        E DS                  EXTNAME(LEL8MFPD)                                  CLE034
     D  QQPONS6      E                     EXTFLD(QQPONS)                                     CGL029
     D  QQRONS6      E                     EXTFLD(QQRONS)                                     CGL029
     D  D8DTL                 91    888                                                       CLE034
      *                                                                                       CLE034
      **  Lending PC Msg Fmt Transaction Income Splits                                        CLE035
     D DWL9MF        E DS                  EXTNAME(LEL9MFPD)                                  CLE035
     D  D9DTL                 91    161                                                       CLE035
      *                                                                                       CLE035
      **  Midas User Message Format
     D DWSWMF        E DS                  EXTNAME(LESWMFPD)
     D**DUDTL*******          91    102                                                       155429
     D  DUDTL                 91    105                                                       155429
      *
     D/COPY WNCPYSRC,LE2015D002
      *
      *                                                                         CLE031
      **  Static Data Download System Values Message Format                     CLE031
     D DWSYMF        E DS                  EXTNAME(LESYMFPD)                    CLE031
      *
     D SDSVAL        E DS                  EXTNAME(SDSVLJW1)                                MD054605
     D                                     PREFIX(X)                                        MD054605
     D NullInds        s              5i 0 dim(21)                                          MD054605
      **  Message Format
     D W#MFMT          S                   LIKE(P#MFMT)
      *
      * Program Status Data Structure
     D PSDS           SDS
     D  W#PGM            *PROC
     D  W#WSID               244    253
     D  W#USER               254    263
      *
      * MQI structures
      *
      * MQI named constants
     **D/COPY**QRPGLESRC,CMQR***************                                                  211959
     D/COPY QMQM/QRPGLESRC,CMQR                                                               211959
      * Object Descriptor - source and reply
     D MQOD            DS
     **D/COPY**QRPGLESRC,CMQODR***********                                                    211959
     D/COPY QMQM/QRPGLESRC,CMQODR                                                             211959
      * Message Descriptor
     D MQMD            DS
     **D/COPY**QRPGLESRC,CMQMDR***********                                                    211959
     D/COPY QMQM/QRPGLESRC,CMQMDR                                                             211959
      * Put message options
     D MQPMO           DS
     **D/COPY**QRPGLESRC,CMQPMOR**********                                                    211959
     D/COPY QMQM/QRPGLESRC,CMQPMOR                                                            211959
      *
     D SPOOL1          DS                                                                     147933
     D  SFILE1                83     92                                                       147933
     D  SFNUM1               123    124B 0                                                    147933
      *                                                                                       147933
     D SPOOLU          DS
     D  SFILEU                83     92
     D  SFNUMU               123    124B 0
      *
     D W#NUMBER8       S             30S 8
     D W#NUMBER7       S             30S 7
      *
      * Key Fields to Check FCLTY B record
     D W#FCLTY         DS
     D  F#FCNUM
     D  F#FFACT
     D  F#FFCNO
     D W1FCLTY         S                   LIKE(W#FCLTY)
      *
      * Key Fields to Check CLOAN B record
     D W#CLOAN         DS
     D  F#LLNRF
     D W1CLOAN         S                   LIKE(W#CLOAN)
      *
      * Local data area for database error details
     D DBERR         E DS                  EXTNAME(LDA)
      *
      * Midas System Phase data area
     D***MPHAS*********E DS                  EXTNAME(MPHAS)                                   CCB020
     D***PHASE*******E                     EXTFLD(MPHAS)                                      CCB020
      *
      * Constant to be sent on QCMDEXEC command
     D SETDLY          C                   CONST('DLYJOB DLY(1)')
     D****SETDLY20        C                   CONST('DLYJOB DLY(20)')                  154773 CLE034
      *
     D CLE028          S              1A                                                      CLE028
      *                                                                                       CLE036
      ** Datastructure to hold input parameter for AOSVALR0.                                  CLE036
     DWPARMDS          DS            20                                                       CLE036
     DWPARM0                   1     20                                                       CLE036
     DWPARM1                   1      5                                                       CLE036
     DWPARM2                   6     10                                                       CLE036
     DWPARM3                  11     15                                                       CLE036
     DWPARM4                  16     20                                                       CLE036
      ** SAR Flags                                                                            CLE036
     D CLE035          S              1A                                                      CLE035
     D CLE036          S              1A                                                      CLE036
      *
      ** Work Variable                                                                        CLE035
     D IncomeSplitCnt  S             13S 0                                                    CLE035
      *                                                                                       CLE035
     I/COPY WNCPYSRC,LE2015I001
      *
      **********************************************************************
      *
     C     *ENTRY        PLIST
     C                   PARM                    P#MODE            1
     C                   PARM                    P#BRANCH          3
      *
      * Initial Processing
     C                   EXSR      INITIAL
      * Main Processing
     C                   EXSR      MAINPROC
      * Final Processing
     C                   EXSR      FINAL
      * Close and exit
     C                   MOVE      *ON           *INLR
     C                   RETURN
      **********************************************************************
      *   Main Processing
      **********************************************************************
     C     MAINPROC      BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'MAINPROC'    STK(@Q)
      *
      *
      * SD mode or Both?
     C     P#MODE        IFEQ      'S'
     C     P#MODE        OREQ      'B'
     C*
      *   Put Static Data Download Start message
     C                   MOVE      'S'           W#MODE
     C                   MOVE      'S'           W#STEN
     C                   EXSR      DSTENMSG
     C*
      *   Static Data Download
     C                   EXSR      DOWNSD
     C*
      *   Put Static Data Download End message
     C                   MOVE      'E'           W#STEN
     C                   EXSR      DSTENMSG
     C                   ENDIF
      *
      *
      * LE mode or Both?
     C     P#MODE        IFEQ      'L'
     C     P#MODE        OREQ      'B'
      *
      *   Put Lending Download Start message
     C                   MOVE      'L'           W#MODE
     C                   MOVE      'S'           W#STEN
     C                   EXSR      DSTENMSG
      *
      *   Lending Download
     C                   EXSR      DOWNLE
      *
      *   Put Lending Download End message
     C                   MOVE      'E'           W#STEN
     C                   EXSR      DSTENMSG
     C                   ENDIF
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      **********************************************************************
      *   Static Data Download Processing
      **********************************************************************
     C     DOWNSD        BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'DOWNSD  '    STK(@Q)
      *
      *
      * Put Switchable Features                                                               CPB003
     C                   MOVE      'SARD'        X1MSGT                                       CPB003
     C                   EXSR      DOWNDETL                                                   CPB003
      *                                                                         CLE031
      * Put System values                                                       CLE031
     C                   MOVE      'SVAL'        X1MSGT                         CLE031
     C                   EXSR      DOWNDETL                                     CLE031
                                                                                            MD054605
     C/EXEC SQL                                                                             MD054605
     C+ close ACursor                                                                       MD054605
     C/END-EXEC                                                                             MD054605
      *
      * Put Midas Module message
     C                   MOVE      'MMOD'        X1MSGT
     C                   EXSR      DOWNICD
      *
      * Put Bank Details message
     C                   MOVE      'BANK'        X1MSGT
     C                   EXSR      DOWNICD
      *
      * Put General Ledger ICD message
     C                   MOVE      'GELR'        X1MSGT
     C                   EXSR      DOWNICD
      *
      * Retail Banking?
     C     BGRTBN        IFEQ      'Y'
      * Put Retail ICD message
     C                   MOVE      'RETL'        X1MSGT
     C                   EXSR      DOWNICD
     C                   ENDIF
      *
      * Put Customer Lending ICD message
     C                   MOVE      'CLND'        X1MSGT
     C                   EXSR      DOWNICD
      *
      * Portfolio Management?
     C     BGPFMG        IFEQ      'Y'
      * Put Portfolio Management ICD message
     C                   MOVE      'PORT'        X1MSGT
     C                   EXSR      DOWNICD
     C                   ENDIF
      *
      * Put Trading ICD message
     C                   MOVE      'TRAD'        X1MSGT
     C                   EXSR      DOWNICD
      *
      * Analytical Accounting?
     C     BGN0ST        IFEQ      'Y'
      * Put Profit Centre Accounting ICD message
     C                   MOVE      'PCAC'        X1MSGT
     C                   EXSR      DOWNICD
     C                   ENDIF
      *
      * Put Customer Details
     C                   MOVE      'CUST'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      * Put Customer Alternative Names and Addresses
     C                   MOVE      'ALTN'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      * Put Facility Types
     C                   MOVE      'FACT'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      * Put Branch Codes
     C                   MOVE      'BRCH'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      * Put Currency Codes
     C                   MOVE      'CURR'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      * Put Country Codes
     C                   MOVE      'CTRY'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      * Put Fee Codes
     C                   MOVE      'FEEC'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      * Put Industry Codes
     C                   MOVE      'INDS'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      * Put Account Officer Codes
     C                   MOVE      'ACOF'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      * Profit Centre Defaults?
     C     BKPCDU        IFEQ      'Y'
      * Put Profit Centre Matrix Details
     C                   MOVE      'PRFM'        X1MSGT
     C                   EXSR      DOWNDETL
     C                   ENDIF
      *
      * Profit Centres Used?
     C     BKPRCU        IFEQ      'Y'
      * Put Profit Centres
     C                   MOVE      'PRFC'        X1MSGT
     C                   EXSR      DOWNDETL
     C                   ENDIF
      *
      * Put Book Codes
     C                   MOVE      'BOOK'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      * Put Loan Types/Sub-types
     C                   MOVE      'LTST'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      * Put Base Rate Codes
     C                   MOVE      'BSRT'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      * Put Base Rate History
     C                   MOVE      'BSHS'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      * Put Nostro Codes
     C                   MOVE      'NOST'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      * Put Counterparty Nostro Codes
     C                   MOVE      'CNST'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      * Put Accounts
     C                   MOVE      'ACNT'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      * Put Extended Settlements
     C                   MOVE      'EXST'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      **Portfolio*Management?*****************************************************************CPB003
      * Portfolio Management or Private Banking?                                              CPB003
     C     BGPFMG        IFEQ      'Y'
     C     BGN4ST        OREQ      'Y'                                                        CPB003
      *
      * Put Portfolio References
     C                   MOVE      'PORR'        X1MSGT
     C                   EXSR      DOWNDETL
     C                   ENDIF                                                                CPB003
      *                                                                                       CPB003
      * Portfolio Management?                                                                 CPB003
     C     BGPFMG        IFEQ      'Y'                                                        CPB003
      *
      * Put Portfolio Customers
     C                   MOVE      'PLCS'        X1MSGT
     C                   EXSR      DOWNDETL
     C                   ENDIF
      *
      * Put Holidays
     C                   MOVE      'HOLS'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      * Put SWIFT Codewords
     C                   MOVE      'CODE'        X1MSGT
     C                   EXSR      DOWNDETL
      ************                                                                            CPB003
      **Put*Switchable*Features***************************************************************CPB003
     C************       MOVE      'SARD'        X1MSGT                                       CPB003
     C************       EXSR      DOWNDETL                                                   CPB003
      *
      * Put Currency Clearing System
     C                   MOVE      'CCSY'        X1MSGT
     C                   EXSR      DOWNDETL
      *
      *
     C/COPY WNCPYSRC,LE2015C005
      *
      * Put User messages
     C     P#CCODE       IFEQ      CCOK
     C     CLE005        ANDEQ     'Y'
     C                   MOVE      'USER'        X1MSGT
     C                   EXSR      DOWNUSER
     C                   ENDIF
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      **********************************************************************
      *   Lending Download Processing
      **********************************************************************
     C     DOWNLE        BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'DOWNLE  '    STK(@Q)
      *                                                                                       235907
      ** Put Base Rate History                                                                235907
      *                                                                                       235907
     C                   MOVE      'BSHS'        X1MSGT                                       235907
     C                   EXSR      DOWNDETL                                                   235907
      *
      *
      * Put Facilities messages
     C                   MOVE      'DLFC'        X1MSGT
     C                   Z-ADD     0             NUMFAC                                       147933
     C                   Z-ADD     0             NUMINP                                       147933
     C                   Z-ADD     0             NUMFUP                                       147933
     C                   EXSR      DOWNDETL
      *
      * Put Loans messages
     C                   MOVE      'DLLN'        X1MSGT
     C                   Z-ADD     0             NUMLON                                       147933
     C                   Z-ADD     0             NUMROL                                       147933
     C                   EXSR      DOWNDETL
      *
      * Put Loan Amendments messages
     C                   MOVE      'DLLA'        X1MSGT
     C                   Z-ADD     0             NUMLOA                                       147933
     C                   Z-ADD     0             NUMPRI                                       147933
     C                   Z-ADD     0             NUMPTR                                       147933
     C                   Z-ADD     0             NUMBRC                                       147933
     C                   Z-ADD     0             NUMSPC                                       147933
     C                   Z-ADD     0             NUMSTC                                       147933
     C                   Z-ADD     0             NUMSSA                                       147933
     C                   Z-ADD     0             NUMREP                                       147933
     C                   Z-ADD     0             NUMMAN                                       147933
     C                   Z-ADD     0             NUMSCH                                       147933
     C                   Z-ADD     0             NUMPSD                                       147933
     C                   EXSR      DOWNDETL
      *
      * Put Risk Participants/Assignments messages
     C                   MOVE      'DLRA'        X1MSGT
     C                   Z-ADD     0             NUMRPT                                       147933
     C                   Z-ADD     0             NUMASS                                       147933
     C                   EXSR      DOWNDETL
      *
     C     CLE005        IFEQ      'Y'
     C     P#CCODE       ANDEQ     CCOK
      *
      * Put Facility Amendments mesages
      *
     C                   MOVE      'DLFA'        X1MSGT
     C                   Z-ADD     0             NUMFAA                                       147933
     C                   EXSR      DOWNDLFA
      *
      * Put Fee messages
     C     P#CCODE       IFEQ      CCOK
     C                   MOVE      'DLFE'        X1MSGT
     C                   Z-ADD     0             NUMFEE                                       147933
     C                   EXSR      DOWNDLFE
      *
     C/COPY WNCPYSRC,LE2015MC01
      * Put Fee Settlements messages
     C     P#CCODE       IFEQ      CCOK
     C                   MOVE      'DLFS'        X1MSGT
     C                   Z-ADD     0             NUMFST                                       147933
     C                   EXSR      DOWNDLFS
      *
      * Put Lending Event messages
     C     P#CCODE       IFEQ      CCOK
     C                   MOVE      'DLEV'        X1MSGT
     C                   EXSR      DOWNDLEV
      *
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
     C                   ENDIF
      *                                                                                       CLE034
      ** If CLE034 is installed.                                                              CLE034
      *                                                                                       CLE034
     C                   IF        CLE034 = 'Y'                                               CLE034
     C                   EVAL      X1MSGT = 'DLSA'                                            CLE034
     C                   EVAL      NUMSTA = *ZERO                                             CLE034
     C                   EXSR      DOWNDLSA                                                   CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE035
      ** If CLE035 is installed.                                                              CLE035
                                                                                              CLE035
     C                   IF        CLE035 = 'Y'                                               CLE035
     C                   EVAL      X1MSGT = 'DLIS'                                            CLE035
     C                   EVAL      IncomeSplitCnt = *ZERO                                     CLE035
     C                   EXSR      DOWNDLIS                                                   CLE035
     C                   ENDIF                                                                CLE035
      *
      *
     C/COPY WNCPYSRC,LE2015C004
      *
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
                                                                                              CLE034
      **********************************************************************                  CLE034
      *   Download Settlement Allocations                                                     CLE034
      **********************************************************************                  CLE034
                                                                                              CLE034
     C     DOWNDLSA      BEGSR                                                                CLE034
                                                                                              CLE034
     C                   EVAL      @Q = @Q + 1                                                CLE034
     C                   EVAL      STK(@Q) = 'DOWNDLSA'                                       CLE034
                                                                                              CLE034
      ** Get message attributes                                                               CLE034
                                                                                              CLE034
     C                   EXSR      MSGATR                                                     CLE034
                                                                                              CLE034
     C                   EVAL      W#NOREC1 = *ZERO                                           CLE034
                                                                                              CLE034
      ** Access file details then format for output to the 'DLSA'                             CLE034
      ** message format                                                                       CLE034
                                                                                              CLE034
     C                   READ      LESTALL8                               87                  CLE034
                                                                                              CLE034
      ** No records at all - send a blank message to clear LM database.                       CLE034
                                                                                              CLE034
     C                   IF        *IN87 = *ON                                                CLE034
     C                   EXSR      SETBLANK                                                   CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
     C                   DOW       *IN87 = *OFF                                               CLE034
                                                                                              CLE034
      ** Initialise number of records processed and message position                          CLE034
                                                                                              CLE034
     C                   EVAL      W#NOREC = *ZERO                                            CLE034
     C                   EVAL      W#MPOS  = 91                                               CLE034
                                                                                              CLE034
     C                   DOW       W#BTNM > W#NOREC                                           CLE034
     C                             AND *IN87 = *OFF                                           CLE034
                                                                                              CLE034
      ** Count the number of Settlement Allocations.                                          CLE034
                                                                                              CLE034
     C                   IF        F#MRECI <> 'R'                                             CLE034
     C                   EVAL      NUMSTA = NUMSTA + 1                                        CLE034
                                                                                              CLE034
     C                   EVAL      W#NOREC  = W#NOREC  + 1                                    CLE034
     C                   EVAL      W#NOREC1 = W#NOREC1 + 1                                    CLE034
     C                   EXSR      FRMTDLSA                                                   CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
     C                   READ      LESTALL8                               87                  CLE034
     C                   ENDDO                                                                CLE034
                                                                                              CLE034
     C                   IF        W#NOREC1 <= W#BTNM                                         CLE034
     C                             AND *IN87 = *ON                                            CLE034
     C                   EVAL      X1CONT = *BLANKS                                           CLE034
     C                   EVAL      W#MLEN = W#BTML * W#NOREC + 90                             CLE034
                                                                                              CLE034
     C                   ELSE                                                                 CLE034
                                                                                              CLE034
      ** Set End flag when last record is read. Otherwise, set                                CLE034
      ** Continuation flag                                                                    CLE034
                                                                                              CLE034
     C                   IF        *IN87 = *ON                                                CLE034
     C                   EVAL      X1CONT = 'L'                                               CLE034
     C                   EVAL      W#MLEN = W#BTML * W#NOREC + 90                             CLE034
     C                   ELSE                                                                 CLE034
     C                   EVAL      X1CONT = 'X'                                               CLE034
     C                   ENDIF                                                                CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
      ** Set number of entries on message and length of each entry                            CLE034
                                                                                              CLE034
     C                   MOVE      W#NOREC       X1BTNM                                       CLE034
     C                   MOVE      W#BTML        X1BTML                                       CLE034
                                                                                              CLE034
      ** Put message onto MQ message queue for each branch                                    CLE034
                                                                                              CLE034
     C                   EXSR      PMQPUTM                                                    CLE034
     C                   ENDDO                                                                CLE034
                                                                                              CLE034
     C                   EVAL      STK(@Q) = *BLANKS                                          CLE034
     C                   EVAL      @Q = @Q - 1                                                CLE034
                                                                                              CLE034
     C                   ENDSR                                                                CLE034
                                                                                              CLE034
      **********************************************************************                  CLE034
      *   Format Download Settlement Allocations                                              CLE034
      **********************************************************************                  CLE034
                                                                                              CLE034
     C     FRMTDLSA      BEGSR                                                                CLE034
                                                                                              CLE034
     C                   EVAL      @Q = @Q + 1                                                CLE034
     C                   EVAL      STK(@Q) = 'FRMTDLSA'                                       CLE034
                                                                                              CLE034
      ** Clear all detail fields.                                                             CLE034
                                                                                              CLE034
     C                   CLEAR                   D8DTL                                        CLE034
                                                                                              CLE034
      ** Transaction Type                                                                     CLE034
     C                   EVAL      L8TYPE  = F#STYPE                                          CLE034
                                                                                              CLE034
      ** Timestamp                                                                            CLE034
     C                   EVAL      L8TMST  = F#STMST                                          CLE034
                                                                                              CLE034
      ** PC Reference                                                                         CLE034
     C                   EVAL      L8PCRF  = F#SPCRF                                          CLE034
                                                                                              CLE034
      ** Loan Reference                                                                       CLE034
     C**********         IF        F#SLNRF <> *ZERO                                    CLE034 CLE148
     C                   IF        F#SLNRF <> *BLANK                                          CLE148
     C                   EVAL      L8LNRF  = F#SLNRF                                          CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
      ** Value Date                                                                           CLE034
     C                   IF        F#SVDAT <> *ZERO                                           CLE034
     C                   EVAL      W#ZDAYN = F#SVDAT                                          CLE034
     C                   EXSR      ZZA0140                                                    CLE034
     C                   EVAL      L8VDAT  = W#DATE8                                          CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
      ** Loan Amendment Sequence Number                                                       CLE034
     C                   IF        F#SLASQ <> *ZERO                                           CLE034
     C                   EVAL      L8LASQ  = F#SLASQ                                          CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
      ** Customer Number                                                                      CLE034
     C**********         IF        F#SCNUM <> *ZERO                                    CLE034 CSD027
     C                   IF        F#SCNUM <> *BLANKS                                         CSD027
     C                   EVAL      L8CNUM  = F#SCNUM                                          CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
      ** Facility                                                                             CLE034
     C                   IF        F#SFACL <> *ZERO                                           CLE034
     C                   EVAL      L8FACL  = F#SFACL                                          CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
      ** Fee Sequence                                                                         CLE034
     C                   IF        F#SFESQ <> *ZERO                                           CLE034
     C                   EVAL      L8FESQ  = F#SFESQ                                          CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
      ** Sequence                                                                             CLE034
     C                   IF        F#SSEQ  <> *ZERO                                           CLE034
     C                   EVAL      L8SEQ   = F#SSEQ                                           CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
      ** Receive Percentage                                                                   CLE034
     C                   EVAL      ZFIELD = *BLANKS                                           CLE034
     C                   EVAL      ZADEC  = 9                                                 CLE034
     C                   MOVE      F#SRCPC       ZFIELD                                       CLE034
     C                   EXSR      ZEDIT                                                      CLE034
     C                   MOVE      ZFIELD        L8RCPC                                       CLE034
                                                                                              CLE034
      ** Receive Settlement Method                                                            CLE034
     C                   IF        F#SRSTM <> *ZERO                                           CLE034
     C                   EVAL      L8RSTM  = F#SRSTM                                          CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
      ** Receive Settlement Account                                                           CLE034
     C                   EVAL      L8RONS  = F#SROBR + F#SRONS                                CLE034
                                                                                              CLE034
      ** Receive Intermediary Bank                                                            CLE034
     C                   EVAL      L8RIBN  = F#SRIBN                                          CLE034
                                                                                              CLE034
      ** Receive Intermediary Bank A/c Line                                                   CLE034
     C                   EVAL      L8RIBA  = F#SRIBA                                          CLE034
                                                                                              CLE034
      ** Receive Ordering Bank                                                                CLE034
     C**********         IF        F#SROBN <> *ZERO                                    CLE034 CSD027
     C                   IF        F#SROBN <> *BLANKS                                         CSD027
     C                   EVAL      L8ROBN  = F#SROBN                                          CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
      ** Receive Ordering Customer                                                            CLE034
     C**********         IF        F#SROCN <> *ZERO                                    CLE034 CSD027
     C                   IF        F#SROCN <> *BLANKS                                         CSD027
     C                   EVAL      L8ROCN  = F#SROCN                                          CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
      ** Receive Settlement Currency                                                          CLE034
     C                   EVAL      L8RSCY  = F#SRSCY                                          CLE034
                                                                                              CLE034
      ** Receive Currency Exchange Rate                                                       CLE034
     C                   EVAL      ZFIELD = *BLANKS                                           CLE034
     C                   EVAL      ZADEC  = 8                                                 CLE034
     C                   MOVE      F#SREXR       ZFIELD                                       CLE034
     C                   EXSR      ZEDIT                                                      CLE034
     C                   MOVE      ZFIELD        L8REXR                                       CLE034
                                                                                              CLE034
      ** Receive Currency Exchange Rate Indicator                                             CLE034
     C                   EVAL      L8REXI  = F#SREXI                                          CLE034
                                                                                              CLE034
      ** Pay Percentage                                                                       CLE034
     C                   EVAL      ZFIELD = *BLANKS                                           CLE034
     C                   EVAL      ZADEC  =  9                                                CLE034
     C                   MOVE      F#SPYPC       ZFIELD                                       CLE034
     C                   EXSR      ZEDIT                                                      CLE034
     C                   MOVE      ZFIELD        L8PYPC                                       CLE034
                                                                                              CLE034
      ** Pay Settlement Method                                                                CLE034
     C                   IF        F#SPSTM <> *ZERO                                           CLE034
     C                   EVAL      L8PSTM  = F#SPSTM                                          CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
      ** Pay Settlement Account                                                               CLE034
     C                   EVAL      L8PONS  = F#SPOBR + F#SPONS                                CLE034
                                                                                              CLE034
      ** Pay Intermediary Bank                                                                CLE034
     C                   EVAL      L8PIBN  = F#SPIBN                                          CLE034
                                                                                              CLE034
      ** Pay Intermediary Bank A/c Line                                                       CLE034
     C                   EVAL      L8PIBA  = F#SPIBA                                          CLE034
                                                                                              CLE034
      ** Pay Ordering Bank                                                                    CLE034
     C**********         IF        F#SPOBN <> *ZERO                                    CLE034 CSD027
     C                   IF        F#SPOBN <> *BLANKS                                         CSD027
     C                   EVAL      L8POBN  = F#SPOBN                                          CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
      ** Pay Ordering Customer                                                                CLE034
     C**********         IF        F#SPOCN <> *ZERO                                    CLE034 CSD027
     C                   IF        F#SPOCN <> *BLANKS                                         CSD027
     C                   EVAL      L8POCN  = F#SPOCN                                          CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
      ** Receiver Correspondent                                                               CLE034
     C                   EVAL      L8RCRN  = F#SRCRN                                          CLE034
                                                                                              CLE034
      ** Receiver Correspondent A/c Line                                                      CLE034
     C                   EVAL      L8RCRA  = F#SRCRA                                          CLE034
                                                                                              CLE034
      ** Receiver Number                                                                      CLE034
     C                   EVAL      L8RVNO  = F#SRVNO                                          CLE034
                                                                                              CLE034
      ** Account with Bank                                                                    CLE034
     C                   EVAL      L8AWBN  = F#SAWBN                                          CLE034
                                                                                              CLE034
      ** Account with Bank Line                                                               CLE034
     C                   EVAL      L8AWBA  = F#SAWBA                                          CLE034
                                                                                              CLE034
      ** Beneficiary                                                                          CLE034
     C                   EVAL      L8BENN  = F#SBENN                                          CLE034
                                                                                              CLE034
      ** Beneficiary A/c Line                                                                 CLE034
     C                   EVAL      L8BENA  = F#SBENA                                          CLE034
                                                                                              CLE034
      ** Details of Payment 1                                                                 CLE034
     C                   EVAL      L8DTP1  = F#SDTP1                                          CLE034
                                                                                              CLE034
      ** Details of Payment 2                                                                 CLE034
     C                   EVAL      L8DTP2  = F#SDTP2                                          CLE034
                                                                                              CLE034
      ** Details of Payment 3                                                                 CLE034
     C                   EVAL      L8DTP3  = F#SDTP3                                          CLE034
                                                                                              CLE034
      ** Details of Payment 4                                                                 CLE034
     C                   EVAL      L8DTP4  = F#SDTP4                                          CLE034
                                                                                              CLE034
      ** Details of Charges                                                                   CLE034
     C                   EVAL      L8DCHG  = F#SDCHG                                          CLE034
                                                                                              CLE034
      ** Bank to Bank Information 1                                                           CLE034
     C                   EVAL      L8BTB1  = F#SBTB1                                          CLE034
                                                                                              CLE034
      ** Bank to Bank Information 2                                                           CLE034
     C                   EVAL      L8BTB2  = F#SBTB2                                          CLE034
                                                                                              CLE034
      ** Bank to Bank Information 3                                                           CLE034
     C                   EVAL      L8BTB3  = F#SBTB3                                          CLE034
                                                                                              CLE034
      ** Bank to Bank Information 4                                                           CLE034
     C                   EVAL      L8BTB4  = F#SBTB4                                          CLE034
                                                                                              CLE034
      ** Bank to Bank Information 5                                                           CLE034
     C                   EVAL      L8BTB5  = F#SBTB5                                          CLE034
                                                                                              CLE034
      ** Bank to Bank Information 6                                                           CLE034
     C                   EVAL      L8BTB6  = F#SBTB6                                          CLE034
                                                                                              CLE034
      ** Cover MT202 required                                                                 CLE034
     C                   EVAL      L8CVMR  = F#SCVMR                                          CLE034
                                                                                              CLE034
      ** Pay Settlement Currency                                                              CLE034
     C                   EVAL      L8PSCY  = F#SPSCY                                          CLE034
                                                                                              CLE034
      ** 'In' Currency in Field 72                                                            CLE034
     C                   EVAL      L8IC72  = F#SIC72                                          CLE034
                                                                                              CLE034
      ** Pay Currency Exchange Rate                                                           CLE034
     C                   EVAL      ZFIELD = *BLANKS                                           CLE034
     C                   EVAL      ZADEC  = 8                                                 CLE034
     C                   MOVE      F#SPEXR       ZFIELD                                       CLE034
     C                   EXSR      ZEDIT                                                      CLE034
     C                   MOVE      ZFIELD        L8PEXR                                       CLE034
                                                                                              CLE034
      ** Pay Currency Exchange Rate Indicator                                                 CLE034
     C                   EVAL      L8PEXI  = F#SPEXI                                          CLE034
                                                                                              CLE034
      ** Parent PC Reference                                                                  CLE034
     C                   EVAL      L8PTRF  = F#SPTRF                                          CLE034
                                                                                              CLE034
      ** Record ID                                                                            CLE034
     C                   EVAL      L8RECI  = F#SRECI                                          CLE034
                                                                                              CLE034
      ** Move message format                                                                  CLE034
                                                                                              CLE034
     C                   EVAL      W#L8MF = %SUBST(DWL8MF:91:W#BTML)                          CLE034
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML) = W#L8MF                      CLE034
     C                   EVAL      W#MPOS = W#MPOS + W#BTML                                   CLE034
                                                                                              CLE034
     C                   EVAL      STK(@Q) = *BLANKS                                          CLE034
     C                   EVAL      @Q = @Q - 1                                                CLE034
                                                                                              CLE034
     C                   ENDSR                                                                CLE034
                                                                                              CLE034
      **********************************************************************                  CLE035
      *   Download Income Splits Details                                                      CLE035
      **********************************************************************                  CLE035
                                                                                              CLE035
     C     DOWNDLIS      BEGSR                                                                CLE035
                                                                                              CLE035
     C                   EVAL      @Q = @Q + 1                                                CLE035
     C                   EVAL      STK(@Q) = 'DOWNDLIS'                                       CLE035
                                                                                              CLE035
      ** Get message attributes                                                               CLE035
                                                                                              CLE035
     C                   EXSR      MSGATR                                                     CLE035
                                                                                              CLE035
      ** Access file details then format for output to the 'DLIS'                             CLE035
      ** message format                                                                       CLE035
                                                                                              CLE035
     C                   READ      LETISPL2                               87                  CLE035
                                                                                              CLE035
      ** No records at all - send a blank message to clear LM database.                       CLE035
                                                                                              CLE035
     C                   IF        *IN87 = *ON                                                CLE035
     C                   EXSR      SETBLANK                                                   CLE035
     C                   ENDIF                                                                CLE035
                                                                                              CLE035
     C                   DOW       *IN87 = *OFF                                               CLE035
                                                                                              CLE035
      ** Initialise number of records processed and message position                          CLE035
                                                                                              CLE035
     C                   EVAL      W#NOREC = *ZERO                                            CLE035
     C                   EVAL      W#MPOS  = 91                                               CLE035
                                                                                              CLE035
     C                   DOW       W#BTNM > W#NOREC                                           CLE035
     C                             AND *IN87 = *OFF                                           CLE035
                                                                                              CLE035
      ** Count the number of Settlement Allocations.                                          CLE035
                                                                                              CLE035
     C                   IF        F#IRECI <> 'R'                                             CLE035
     C                   EVAL      IncomeSplitCnt = IncomeSplitCnt + 1                        CLE035
                                                                                              CLE035
     C                   EVAL      W#NOREC  = W#NOREC  + 1                                    CLE035
     C                   EVAL      W#NOREC1 = W#NOREC1 + 1                                    CLE035
     C                   EXSR      FRMTDLIS                                                   CLE035
     C                   ENDIF                                                                CLE035
                                                                                              CLE035
     C                   READ      LETISPL2                               87                  CLE035
     C                   ENDDO                                                                CLE035
                                                                                              CLE035
     C                   IF        W#NOREC1 <= W#BTNM                                         CLE035
     C                             AND *IN87 = *ON                                            CLE035
     C                   EVAL      X1CONT = *BLANKS                                           CLE035
     C                   EVAL      W#MLEN = W#BTML * W#NOREC + 90                             CLE035
                                                                                              CLE035
     C                   ELSE                                                                 CLE035
                                                                                              CLE035
      ** Set End flag when last record is read. Otherwise, set                                CLE035
      ** Continuation flag                                                                    CLE035
                                                                                              CLE035
     C                   IF        *IN87 = *ON                                                CLE035
     C                   EVAL      X1CONT = 'L'                                               CLE035
     C                   EVAL      W#MLEN = W#BTML * W#NOREC + 90                             CLE035
     C                   ELSE                                                                 CLE035
     C                   EVAL      X1CONT = 'X'                                               CLE035
     C                   ENDIF                                                                CLE035
     C                   ENDIF                                                                CLE035
                                                                                              CLE035
      ** Set number of entries on message and length of each entry                            CLE035
                                                                                              CLE035
     C                   MOVE      W#NOREC       X1BTNM                                       CLE035
     C                   MOVE      W#BTML        X1BTML                                       CLE035
                                                                                              CLE035
      ** Put message onto MQ message queue for each branch                                    CLE035
                                                                                              CLE035
     C                   EXSR      PMQPUTM                                                    CLE035
     C                   ENDDO                                                                CLE035
                                                                                              CLE035
     C                   EVAL      STK(@Q) = *BLANKS                                          CLE035
     C                   EVAL      @Q = @Q - 1                                                CLE035
                                                                                              CLE035
     C                   EVAL      RISCNT = IncomeSplitCnt                                    CLE035
                                                                                              CLE035
     C                   ENDSR                                                                CLE035
                                                                                              CLE035
      **********************************************************************                  CLE035
      *   Format Income Splits Message                                                        CLE035
      **********************************************************************                  CLE035
                                                                                              CLE035
     C     FRMTDLIS      BEGSR                                                                CLE035
                                                                                              CLE035
     C                   EVAL      @Q = @Q + 1                                                CLE035
     C                   EVAL      STK(@Q) = 'FRMTDLIS'                                       CLE035
                                                                                              CLE035
      ** Clear all detail fields.                                                             CLE035
                                                                                              CLE035
     C                   CLEAR                   D9DTL                                        CLE035
                                                                                              CLE035
      ** Loan Reference                                                                       CLE035
     C**********         IF        F#ILNRF <> *ZERO                                    CLE035 CLE148
     C                   IF        F#ILNRF <> *BLANK                                          CLE148
     C                   MOVE      F#ILNRF       L9LNRF                                       CLE035
     C                   ENDIF                                                                CLE035
                                                                                              CLE035
      ** Customer Number                                                                      CLE035
     C**********         IF        F#ICNUM <> *ZERO                                   CLE035 CSD027A
     C                   IF        F#ICNUM <> *BLANKS                                        CSD027A
     C                   MOVE      F#ICNUM       L9CNUM                                       CLE035
     C                   ENDIF                                                                CLE035
                                                                                              CLE035
      ** Facility                                                                             CLE035
     C                   IF        F#IFACL <> *ZERO                                           CLE035
     C                   MOVE      F#IFACL       L9FACL                                       CLE035
     C                   ENDIF                                                                CLE035
                                                                                              CLE035
      ** Fee Sequence                                                                         CLE035
     C                   IF        F#IFESQ <> *ZERO                                           CLE035
     C                   MOVE      F#IFESQ       L9FESQ                                       CLE035
     C                   ENDIF                                                                CLE035
                                                                                              CLE035
      ** Record ID                                                                            CLE035
     C                   EVAL      L9RECI  = F#IRECI                                          CLE035
                                                                                              CLE035
      ** Income Split Customer                                                                CLE035
     C                   MOVE      F#IISCN       L9ISCN                                       CLE035
                                                                                              CLE035
      ** Income Percentage Allocation                                                         CLE035
     C                   EVAL      ZFIELD = *BLANKS                                           CLE035
     C                   EVAL      ZADEC  = 9                                                 CLE035
     C                   MOVE      F#IIPAL       ZFIELD                                       CLE035
     C                   EXSR      ZEDIT                                                      CLE035
     C                   MOVE      ZFIELD        L9IPAL                                       CLE035
                                                                                              CLE035
      ** PC Reference                                                                         CLE035
     C                   EVAL      L9PCRF  = F#IPCRF                                          CLE035
                                                                                              CLE035
      ** Parent PC Reference                                                                  CLE035
     C                   EVAL      L9PPCR  = F#IPPCR                                          CLE035
                                                                                              CLE035
      ** Move message format                                                                  CLE035
                                                                                              CLE035
     C                   EVAL      W#L9MF = %SUBST(DWL9MF:91:W#BTML)                          CLE035
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML) = W#L9MF                      CLE035
     C                   EVAL      W#MPOS = W#MPOS + W#BTML                                   CLE035
                                                                                              CLE035
     C                   EVAL      STK(@Q) = *BLANKS                                          CLE035
     C                   EVAL      @Q = @Q - 1                                                CLE035
                                                                                              CLE035
     C                   ENDSR                                                                CLE035
                                                                                              CLE035
      **********************************************************************
      *   Download ICD Details
      **********************************************************************
     C     DOWNICD       BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'DOWNICD '    STK(@Q)
      *
      *
      * Access Details
     C                   EXSR      GETFIRST
      *
      * Format and populate data
     C                   EXSR      FORMAT
      *
      * Put Message
     C                   EXSR      PMQPUT
      *
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      **********************************************************************
      *   Download Details
      **********************************************************************
     C     DOWNDETL      BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'DOWNDETL'    STK(@Q)
      *
      *
      * Access Details
     C                   EXSR      GETFIRST
      *                                                                                       159085
      * No records at all - send a blank message to clear LM database..                       159085
     C                   IF        %SUBST(X1MSGT:1:2)='DL'                                    159085
     C     *IN87         IFEQ      '1'                                                        159085
     C                   EXSR      SETBLANK                                                   159085
     C                   ENDIF                                                                159085
     C                   ENDIF                                                                159085
      * ... else                                                                              159085
      *
      * Get message attributes
     C                   EXSR      MSGATR
      *
      * Process each message
     C     WWRTCD        DOWEQ     *BLANK
      *
      * Number of records processed
     C                   Z-ADD     *ZERO         W#NOREC
      *
      * Process each customer
     C                   Z-ADD     91            W#MPOS            5 0
     C     WWRTCD        DOWEQ     *BLANK
     C     W#BTNM        ANDGT     W#NOREC
     C*                                                                                       147933
     C** Count number of transactions                                                         147933
     C                   EXSR      COUNTT                                                     147933
      *
      * Do not download closed customers
      *
     C                   SELECT
      *
     C     X1MSGT        WHENEQ    'CUST'
      *
     C     BBTYLC        IFNE      'D'
      * Number of records processed for each PUT
     C                   ADD       1             W#NOREC
      * Total Number of records processed for each file
     C                   ADD       1             W#NOREC1
     C                   ENDIF
      *                                                                                       210696
     C     X1MSGT        WHENEQ    'DLLN'                                                     210696
      *                                                                                       210696
      * Check, for each loan, that all associated facilities are                              210696
      * present on the database. If not, exclude the loan                                     210696
     C                   EXSR      CHKLOAN                                                    210696
     C     LOANOK        IFEQ      'Y'                                                        210696
      *                                                                                       210696
      * Number of records processed for each PUT                                              210696
     C                   ADD       1             W#NOREC                                      210696
      * Total Number of records processed for each file                                       210696
     C                   ADD       1             W#NOREC1                                     210696
      *                                                                                       210696
     C                   ELSE                                                                 210696
      * Reduce the transaction totals for the loans being excluded                            210696
     C     F#LRECI       IFNE      'R'                                                        210696
     C                   SUB       1             NUMLON                                       210696
     C                   ENDIF                                                                210696
     C     F#LRIUS       IFNE      *BLANKS                                                    210696
     C                   SUB       1             NUMROL                                       210696
     C                   ENDIF                                                                210696
     C                   ENDIF                                                                210696
      *
     C     X1MSGT        WHENEQ    'DLFC'                                                     210749
      *                                                                                       210749
      * Check, for each facility, that if a primary facility or                               210749
      * credit application facility is specified, that it exists                              210749
      * on the database. If not, then the facility should not be                              210749
      * downloaded.                                                                           210749
     C                   EXSR      CHKFCLTY                                                   210749
     C     FCLTYOK       IFEQ      'Y'                                                        210749
      *                                                                                       210749
      * Number of records processed for each PUT                                              210749
     C                   ADD       1             W#NOREC                                      210749
      * Total Number of records processed for each file                                       210749
     C                   ADD       1             W#NOREC1                                     210749
      *                                                                                       210749
     C                   ELSE                                                                 210749
      * Reduce the transaction totals for the facilities being excluded                       210749
     C     F#FRECI       IFNE      'R'                                                        210749
     C                   SUB       1             NUMFAC                                       210749
     C                   ENDIF                                                                210749
     C     F#FPRTR       IFEQ      'P'                                                        210749
     C                   SUB       1             NUMFUP                                       210749
     C                   ENDIF                                                                210749
     C     F#FPRTR       IFEQ      'I'                                                        210749
     C                   SUB       1             NUMINP                                       210749
     C                   ENDIF                                                                210749
     C                   ENDIF                                                                210749
      *                                                                                       210749
     C                   OTHER
      *
      * Number of records processed for each PUT
     C                   ADD       1             W#NOREC
      * Total Number of records processed for each file
     C                   ADD       1             W#NOREC1
      *
     C                   ENDSL
      *
      * Format and populate data
     C                   EXSR      FORMAT
      *
      * Access Customer Details
     C                   EXSR      GETNEXT
      * Next Customer
     C                   ENDDO
      *
      * Set number of entries on message
     C                   MOVE      W#NOREC       X1BTNM
      * Set length of each entry
     C                   MOVE      W#BTML        X1BTML
      * Set End Flag
     C     WWRTCD        IFEQ      '*EOF'
     C     W#NOREC1      ANDGT     1
     C                   MOVE      'L'           X1CONT
     C                   EVAL      W#MLEN=       W#BTML*W#NOREC+90
     C                   Z-ADD     0             W#NOREC1
     C                   ENDIF
      *
      * Set Continuation Flag
     C     WWRTCD        IFNE      '*EOF'
     C                   MOVE      'X'           X1CONT
     C                   ENDIF
      *
     C     W#NOREC1      IFEQ      1
     C                   MOVE      *BLANKS       X1CONT
     C                   EVAL      W#MLEN=       W#BTML*W#NOREC+90
     C                   Z-ADD     0             W#NOREC1
     C                   ENDIF
      *
     C* Put message onto MQ message queue for each branch
     C                   EXSR      PMQPUTM
      * Next Message
     C                   ENDDO
      *
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      *
      **********************************************************************
      *   Download Facility Amendments Message
      **********************************************************************
     C     DOWNDLFA      BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'DOWNDLFA'    STK(@Q)
      *
      * Get message attributes
      *
     C                   EXSR      MSGATR
      *
     C                   Z-ADD     *ZERO         W#NOREC1
      *
      * Access file details then format for output to the 'DLFA'
      * message format
      *
     C                   READ      LEFCAML0                               87
      *                                                                                       159085
      * No records at all - send a blank message to clear LM database..                       159085
     C     *IN87         IFEQ      '1'                                                        159085
     C                   EXSR      SETBLANK                                                   159085
     C                   ENDIF                                                                159085
      * ... else                                                                              159085
     C     *IN87         DOWEQ     '0'
      *
      * Initialise number of records processed and message position
      *
     C                   Z-ADD     *ZERO         W#NOREC
     C                   Z-ADD     91            W#MPOS            5 0
      *
     C     W#BTNM        DOWGT     W#NOREC
     C     *IN87         ANDEQ     '0'
     C*                                                                                       147933
     C** Count the number of Facility Amendments.                                             147933
     C     F#MRECI       IFNE      'R'                                                        154016
     C                   ADD       1             NUMFAA                                       147933
      *
     C                   ADD       1             W#NOREC
     C                   ADD       1             W#NOREC1
     C                   EXSR      FRMTDLFA
     C                   ENDIF                                                                154016
      *
     C                   READ      LEFCAML0                               87
     C                   ENDDO
      *
     C     W#NOREC1      IFLE      W#BTNM
     C     *IN87         ANDEQ     '1'
     C                   MOVE      *BLANKS       X1CONT
     C                   EVAL      W#MLEN=       W#BTML*W#NOREC+90
     C                   ELSE
      *
      * Set End flag when last record is read. Otherwise, set
      * Continuation flag
      *
     C     *IN87         IFEQ      '1'
     C                   MOVE      'L'           X1CONT
     C                   EVAL      W#MLEN=       W#BTML*W#NOREC+90
     C                   ELSE
     C                   MOVE      'X'           X1CONT
     C                   ENDIF
     C                   ENDIF
      *
      * Set number of entries on message and length of each entry
      *
     C                   MOVE      W#NOREC       X1BTNM
     C                   MOVE      W#BTML        X1BTML
      *
      * Put message onto MQ message queue for each branch
      *
     C                   EXSR      PMQPUTM
     C                   ENDDO
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      *
      **********************************************************************
      *   Download Fees Message
      **********************************************************************
     C     DOWNDLFE      BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'DOWNDLFE'    STK(@Q)
      *
      * Get message attributes
      *
     C                   EXSR      MSGATR
      *
     C                   Z-ADD     *ZERO         W#NOREC1
      *
      * Access file details then format for output to the 'DLFE'
      * message format
      *
     C                   READ      LEFEEDL1                               87
      *                                                                                       159085
      * No records at all - send a blank message to clear LM database..                       159085
     C     *IN87         IFEQ      '1'                                                        159085
     C                   EXSR      SETBLANK                                                   159085
     C                   ENDIF                                                                159085
      * ... else                                                                              159085
     C     *IN87         DOWEQ     '0'
      *
      * Initialise number of records processed and message position
      *
     C                   Z-ADD     *ZERO         W#NOREC
     C                   Z-ADD     91            W#MPOS            5 0
      *
     C     W#BTNM        DOWGT     W#NOREC
     C     *IN87         ANDEQ     '0'
     C*                                                                                       147933
     C** Count the number of Fees.                                                            147933
     C     F#DFERECI     IFNE      'R'                                                        154016
     C     F#DFERECI     ANDNE     '*'                                                        156688
     C                   ADD       1             NUMFEE                                       147933
      *
     C                   ADD       1             W#NOREC
     C                   ADD       1             W#NOREC1
     C                   EXSR      FRMTDLFE
     C                   ENDIF                                                                154016
      *
     C                   READ      LEFEEDL1                               87
     C                   ENDDO
      *
     C     W#NOREC1      IFLE      W#BTNM
     C     *IN87         ANDEQ     '1'
     C                   MOVE      *BLANKS       X1CONT
     C                   EVAL      W#MLEN=       W#BTML*W#NOREC+90
     C                   ELSE
      *
      * Set End flag when last record is read. Otherwise, set
      * Continuation flag
      *
     C     *IN87         IFEQ      '1'
     C                   MOVE      'L'           X1CONT
     C                   EVAL      W#MLEN=       W#BTML*W#NOREC+90
     C                   ELSE
     C                   MOVE      'X'           X1CONT
     C                   ENDIF
     C                   ENDIF
      *
      * Set number of entries on message and length of each entry
      *
     C                   MOVE      W#NOREC       X1BTNM
     C                   MOVE      W#BTML        X1BTML
      *
      * Put message onto MQ message queue for each branch
      *
     C                   EXSR      PMQPUTM
     C                   ENDDO
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      *
      **********************************************************************
      *   Download Fee Settlement Messages
      **********************************************************************
     C     DOWNDLFS      BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'DOWNDLFS'    STK(@Q)
      *
      * Get message attributes
      *
     C                   EXSR      MSGATR
      *
     C                   Z-ADD     *ZERO         W#NOREC1
      *
      * Access file details then format for output to the 'DLFS'
      * message format
      *
     C                   READ      LEFEADL1                               87
      *                                                                                       159085
      * No records at all - send a blank message to clear LM database..                       159085
     C     *IN87         IFEQ      '1'                                                        159085
     C                   EXSR      SETBLANK                                                   159085
     C                   ENDIF                                                                159085
      * ... else                                                                              159085
     C     *IN87         DOWEQ     '0'
      *
      * Initialise number of records processed and message position
      *
     C                   Z-ADD     *ZERO         W#NOREC
     C                   Z-ADD     91            W#MPOS            5 0
      *
     C     W#BTNM        DOWGT     W#NOREC
     C     *IN87         ANDEQ     '0'
     C*                                                                                       147933
     C** Count the number of Fees Settlements.                                                147933
     C     F#TFARECI     IFEQ      'S'                                                        147933
     C                   ADD       1             NUMFST                                       147933
     C                   ENDIF                                                                147933
      *
     C***Don't*count*if*RECI*=*'A'*******                                               147933154016
     C** Don't count if RECI = 'A' or 'R'                                                     154016
     C     F#TFARECI     IFNE      'A'                                                        147933
     C     F#TFARECI     ANDNE     'R'                                                        154016
     C                   ADD       1             W#NOREC1
     C                   ADD       1             W#NOREC
     C                   EXSR      FRMTDLFS
     C                   ENDIF                                                                147933
      *
     C                   READ      LEFEADL1                               87
     C                   ENDDO
      *
     C     W#NOREC1      IFLE      W#BTNM
     C     *IN87         ANDEQ     '1'
     C                   MOVE      *BLANKS       X1CONT
     C                   EVAL      W#MLEN=       W#BTML*W#NOREC+90
     C                   ELSE
      *
      * Set End flag when last record is read. Otherwise, set
      * Continuation flag
      *
     C     *IN87         IFEQ      '1'
     C                   MOVE      'L'           X1CONT
     C                   EVAL      W#MLEN=       W#BTML*W#NOREC+90
     C                   ELSE
     C                   MOVE      'X'           X1CONT
     C                   ENDIF
     C                   ENDIF
      *
      * Set number of entries on message and length of each entry
      *
     C                   MOVE      W#NOREC       X1BTNM
     C                   MOVE      W#BTML        X1BTML
      *
      * Put message onto MQ message queue for each branch
      *
     C                   EXSR      PMQPUTM
     C                   ENDDO
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      *
      **********************************************************************
      *   Download Event Messages
      **********************************************************************
     C     DOWNDLEV      BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'DOWNDLEV'    STK(@Q)
      *
      * Get message attributes
      *
     C                   EXSR      MSGATR
      *
     C                   Z-ADD     *ZERO         W#NOREC1
      *
      * Access file details then format for output to the 'DLEV'
      * message format
      *
     C                   READ      LVENT                                  87
      *                                                                                       159085
      * No records at all - send a blank message to clear LM database..                       159085
     C     *IN87         IFEQ      '1'                                                        159085
     C                   EXSR      SETBLANK                                                   159085
     C                   ENDIF                                                                159085
      * ... else                                                                              159085
     C     *IN87         DOWEQ     '0'
      *
      * Initialise number of records processed and message position
      *
     C                   Z-ADD     *ZERO         W#NOREC
     C                   Z-ADD     91            W#MPOS            5 0
      *
     C     W#BTNM        DOWGT     W#NOREC
     C     *IN87         ANDEQ     '0'
      *
     C     F#VIBRE       IFNE      'Y'                                                        157926
     C***  F#VICYE       ANDNE     'Y'                                                 157926 157922
     C                   ADD       1             W#NOREC
     C                   ADD       1             W#NOREC1
     C                   EXSR      FRMTDLEV
     C                   END                                                                  157926
      *
     C                   READ      LVENT                                  87
     C                   ENDDO
      *
     C     W#NOREC1      IFLE      W#BTNM
     C     *IN87         ANDEQ     '1'
     C                   MOVE      *BLANKS       X1CONT
     C                   EVAL      W#MLEN=       W#BTML*W#NOREC+90
     C                   ELSE
      *
      * Set End flag when last record is read. Otherwise, set
      * Continuation flag
      *
     C     *IN87         IFEQ      '1'
     C                   MOVE      'L'           X1CONT
     C                   EVAL      W#MLEN=       W#BTML*W#NOREC+90
     C                   ELSE
     C                   MOVE      'X'           X1CONT
     C                   ENDIF
     C                   ENDIF
      *
      * Set number of entries on message and length of each entry
      *
     C                   MOVE      W#NOREC       X1BTNM
     C                   MOVE      W#BTML        X1BTML
      *
      * Put message onto MQ message queue for each branch
      *
     C                   EXSR      PMQPUTM
     C                   ENDDO
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      *
      **********************************************************************
      *   Download User Message
      **********************************************************************
     C     DOWNUSER      BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'DOWNUSER'    STK(@Q)
      *
      * Get message attributes
      *
     C                   EXSR      MSGATR
      *
     C                   Z-ADD     *ZERO         W#NOREC1
      *
      * Access file details then format for output to the 'USER'
      * message format
      *
     C                   READ      MUSERDD                                87
     C     *IN87         DOWEQ     '0'
      *
      * Initialise number of records processed and message position
      *
     C                   Z-ADD     *ZERO         W#NOREC
     C                   Z-ADD     91            W#MPOS            5 0
      *
     C     W#BTNM        DOWGT     W#NOREC
     C     *IN87         ANDEQ     '0'
      *
     C                   ADD       1             W#NOREC
     C                   ADD       1             W#NOREC1
     C                   EXSR      FRMTUSER
      *
     C                   READ      MUSERDD                                87
     C                   ENDDO
      *
     C     W#NOREC1      IFLE      W#BTNM
     C     *IN87         ANDEQ     '1'
     C                   MOVE      *BLANKS       X1CONT
     C                   EVAL      W#MLEN=       W#BTML*W#NOREC+90
     C                   ELSE
      *
      * Set End flag when last record is read. Otherwise, set
      * Continuation flag
      *
     C     *IN87         IFEQ      '1'
     C                   MOVE      'L'           X1CONT
     C                   EVAL      W#MLEN=       W#BTML*W#NOREC+90
     C                   ELSE
     C                   MOVE      'X'           X1CONT
     C                   ENDIF
     C                   ENDIF
      *
      * Set number of entries on message and length of each entry
      *
     C                   MOVE      W#NOREC       X1BTNM
     C                   MOVE      W#BTML        X1BTML
      *
      * Put message onto MQ message queue for each branch
      *
     C                   EXSR      PMQPUTM
     C                   ENDDO
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      *
      *                                                                                       159085
     C/COPY WNCPYSRC,LE2015MC02
      **********************************************************************                  159085
      *   Set Up Blank Message - No Records to Process                                        159085
      **********************************************************************                  159085
     C     SETBLANK      BEGSR                                                                159085
      *                                                                                       159085
     C                   ADD       1             @Q                                           159085
     C                   MOVEL     'SETBLANK'    STK(@Q)                                      159085
      *                                                                                       159085
     C                   CLEAR                   W#MFMT                                       159085
     C                   MOVE      *BLANKS       X1BTNM                                       159085
     C                   MOVE      'L'           X1CONT                                       159085
     C                   EXSR      PMQPUTM                                                    159085
      *                                                                                       159085
     C                   MOVE      *BLANKS       STK(@Q)                                      159085
     C                   SUB       1             @Q                                           159085
      *                                                                                       159085
     C                   ENDSR                                                                159085
      *                                                                                       159085
      **********************************************************************
      *   Format Facility Amendments Message
      **********************************************************************
     C     FRMTDLFA      BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'FRMTDLFA'    STK(@Q)
      *
      * Clear all detail fields.
      *
     C                   CLEAR                   D4DTL
      *
      * Value Date
      *
     C                   Z-ADD     F#MVLDT       W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#DATE8       L4VLDT
      *
      * Next Expiry Date
      *
     C                   Z-ADD     F#MNDEX       W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#DATE8       L4NDEX
      *
      * Get number of decimal places
      *
     C                   MOVE      F#MACCY       W#CCY
     C                   EXSR      GETNBDP
     C                   Z-ADD     A6NBDP        ZADEC
      *
      * Facility Amendment amount
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#MAAMT       ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L4AAMT
      *
      * Move remaining fields to message format
      *
     C*****F#MCNUM       IFNE      0                                                          CSD027
     C     F#MCNUM       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#MCNUM       L4CNUM
     C                   ENDIF
     C     F#MFACT       IFNE      0
     C                   MOVE      F#MFACT       L4FACT
     C                   ENDIF
     C     F#MFCNO       IFNE      0
     C                   MOVE      F#MFCNO       L4FCNO
     C                   ENDIF
     C     F#MSQNO       IFNE      0
     C                   MOVE      F#MSQNO       L4SQNO
     C                   ENDIF
      *
     C                   MOVE      F#MACCY       L4ACCY
     C                   MOVE      F#MRVCR       L4RVCR
     C                   MOVE      F#MIUSR       L4IUSR
     C                   MOVE      F#MAUSR       L4AUSR
     C                   MOVE      F#MXUSR       L4XUSR
     C                   MOVE      F#MRECI       L4RECI
     C                   MOVE      F#MBRCA       L4BRCA
     C                   MOVE      F#MFATP       L4FATP
     C                   MOVE      F#MASTS       L4ASTS
     C                   MOVE      F#MPCRF       L4PCRF
     C                   MOVE      F#MGASSA      L4GASS                                       157217
      *
      * Move message format
      *
     C                   EVAL      W#L4MF=%SUBST(DWL4MF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#L4MF
     C                   ADD       W#BTML        W#MPOS
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      *
      **********************************************************************
      *   Format Fees Message
      **********************************************************************
     C     FRMTDLFE      BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'FRMTDLFE'    STK(@Q)
      *
      * Clear all detail fields.
      *
     C                   CLEAR                   D5DTL
      *
      * Fee period Start Date
      *
     C                   Z-ADD     F#DFEPSTD     W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#DATE8       L5PSTD
      *
      * Fee Period End Date
      *
     C                   Z-ADD     F#DFEPEND     W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#DATE8       L5PEND
      *
      * Next Fee Payment Date
      *
     C                   Z-ADD     F#DFENPYD     W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#DATE8       L5NPYD
      *
      * Fee Settled Date
      *
     C                   Z-ADD     F#DFESDAT     W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#DATE8       L5SDAT
      *
      * Last Payment Date
      *
     C                   Z-ADD     F#DFELPDT     W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#DATE8       L5LPDT
      *
      * Last Accrual Date
      *
     C                   Z-ADD     F#DFELADT     W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#DATE8       L5LADT
      *
      * Past Due Date
      *
     C                   Z-ADD     F#DFEDDAT     W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#DATE8       L5DDAT
      *
      * Previous Last Payment Date
      *
     C                   Z-ADD     F#DFEPLPD     W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#DATE8       L5PLPD
      *
      * Get number of decimal places
      *
     C                   MOVE      F#DFEFCCY     W#CCY
     C                   EXSR      GETNBDP
     C                   Z-ADD     A6NBDP        ZADEC
      *
      * Flat Fees Amount
      *
     C     F#DFEFAMT     IFGE      0
     C                   Z-ADD     F#DFEFAMT     W#DFAMT          13 0
     C                   ELSE
     C                   Z-SUB     F#DFEFAMT     W#DFAMT
     C                   ENDIF
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      W#DFAMT       ZFIELD
     C                   EXSR      ZEDIT
     C     F#DFEFAMT     IFNE      *ZEROS                                                     135072
     C                   MOVE      ZFIELD        L5FAMT
     C                   ELSE                                                                 135072
     C                   MOVE      *BLANKS       L5FAMT                                       135072
     C                   ENDIF                                                                135072
      *
      * Fee Amount Past Due
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      '+'           L5FAPI                                       148756
     C     F#DFEAMTP     IFLT      *ZERO                                                      148756
     C                   MOVE      '-'           L5FAPI                                       148756
     C                   MULT      -1            F#DFEAMTP                                    148756
     C                   ENDIF                                                                148756
     C                   MOVE      F#DFEAMTP     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5AMTP
      *
      * Fee Adjustment Amount
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEAMTA     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5AMTA
      *
      * Fee Settled Amount
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEAMTS     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5AMTS
      *
      * Total Fees Accrued to Date
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEADAT     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5ADAT
      *
      * Outstanding Fee Amount
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEAMTO     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5AMTO
      *
      * Last Payment Fee Amount
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFELPAM     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5LPAM
      *
      * Last Payment Fees Accrued to Date
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEADBP     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5ADBP
      *
      * Last Payment Fee Settled Amount
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEPAMS     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5PAMS
      *
      * Last Payment Fee Amount Past Due
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEPAMP     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5PAMP
      *
      * Fee Rate - Tiers 1 to 5
      *
     C                   Z-ADD     5             ZADEC
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEFRT1     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5FRT1
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEFRT2     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5FRT2
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEFRT3     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5FRT3
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEFRT4     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5FRT4
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEFRT5     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5FRT5
      *
      * Format Fee Amounts - Tiers 1 to 5 according to the number of   .
      * decimal places.
      *
     C     F#DFEPIND     IFEQ      'A'
     C                   Z-ADD     0             ZADEC
     C                   ELSE
     C                   Z-ADD     3             ZADEC
     C                   ENDIF
      *
      * Tiers 1 to 5
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEAMT1     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5AMT1
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEAMT2     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5AMT2
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEAMT3     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5AMT3
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEAMT4     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5AMT4
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEAMT5     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5AMT5
      *
      * Facility Currency Exchange Rate
      *
     C                   Z-ADD     8             ZADEC
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#DFEERAT     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L5ERAT
      *
      * Details of Payment 1 - 4
      *
     C                   EVAL      L5DTPN=       F#DDTP1 +
     C                                           F#DDTP2 +
     C                                           F#DDTP3 +
     C                                           F#DDTP4
      *
      * Bank to Bank Info 1 - 6
      *
     C                   EVAL      L5BTBN=       F#DBTB1 +
     C                                           F#DBTB2 +
     C                                           F#DBTB3 +
     C                                           F#DBTB4 +
     C                                           F#DBTB5 +
     C                                           F#DBTB6
      *
      * Format remaining fields.
      *
     C*****F#DFECNUM     IFNE      0                                                          CSD027
     C     F#DFECNUM     IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#DFECNUM     L5CNUM
     C                   ENDIF
      *
     C     F#DFEFACL     DIV       100           W5FACT
     C     W5FACT        IFNE      0
     C                   MOVE      W5FACT        L5FACT
     C                   ENDIF
      *
     C                   Z-ADD     F#DFEFACL     W5FCNO
     C     W5FCNO        IFNE      0
     C                   MOVE      W5FCNO        L5FCNO
     C                   ENDIF
      *
     C*****F#DFELOAN     IFNE      0                                                          CLE148
     C     F#DFELOAN     IFNE      *BLANK                                                     CLE148
     C                   MOVE      F#DFELOAN     L5LOAN
     C                   ENDIF
      *
     C     F#DFEFSEQ     IFNE      0
     C                   MOVE      F#DFEFSEQ     L5FSEQ
     C                   ENDIF
      *
     C     F#DFEFCOD     IFNE      0
     C                   MOVE      F#DFEFCOD     L5FCOD
     C                   ENDIF
      *
     C     F#DFECALC     IFNE      0
     C                   MOVE      F#DFECALC     L5CALC
     C                   ENDIF
      *
     C     F#DFEDYIM     IFNE      0
     C                   MOVE      F#DFEDYIM     L5DYIM
     C                   ENDIF
      *
     C     F#DPSTM       IFNE      0
     C                   MOVE      F#DPSTM       L5PSTM
     C                   ENDIF
      *
     C*****F#DPOCN       IFNE      0                                                          CSD027
     C     F#DPOCN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#DPOCN       L5POCN
     C                   ENDIF
      *
     C*****F#DPOBN       IFNE      0                                                          CSD027
     C     F#DPOBN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#DPOBN       L5POBN
     C                   ENDIF
      *
     C     F#DRSTM       IFNE      0
     C                   MOVE      F#DRSTM       L5RSTM
     C                   ENDIF
      *
     C*****F#DROCN       IFNE      0                                                          CSD027
     C     F#DROCN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#DROCN       L5ROCN
     C                   ENDIF
      *
     C*****F#DROBN       IFNE      0                                                          CSD027
     C     F#DROBN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#DROBN       L5ROBN
     C                   ENDIF
      *
     C*****F#DSMAC       IFNE      0                                                          CSD027
     C     F#DSMAC       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#DSMAC       L5SMAC
     C                   ENDIF
      *
     C     F#DFEFAMT     IFGE      0
     C                   MOVE      '+'           L5FAMI
     C                   ELSE
     C                   MOVE      '-'           L5FAMI
     C                   ENDIF
      *
      * Move remaining fields.
      *
     C                   MOVE      F#DPTFI       L5PTFI
     C                   MOVE      F#DPTAI       L5PTAI
     C                   MOVE      F#DFEPIND     L5PIND
     C                   MOVE      F#DFEFCCY     L5FCCY
     C                   MOVE      F#DFEPYON     L5PYON
     C                   MOVE      F#DFEAUTO     L5AUTO
     C                   MOVE      F#DFECALT     L5CALT
     C                   MOVE      F#DFEFREQ     L5FREQ
     C                   MOVE      F#DFEMDIN     L5MDIN
     C*****              MOVEL     F#DPONS       L5PONS                                       136318
      *                                                                                       136318
      *   Pay Our Nostro                                                                      136318
     C                   EVAL      L5PONS=       F#DOMDB+F#DPONS                              136318
      *                                                                                       136318
     C                   MOVE      F#DRVNO       L5RVNO
     C                   MOVE      F#DCVMR       L5CVMR
     C                   MOVE      F#DRCRN       L5RCRN
     C                   MOVE      F#DRCRA       L5RCRA
     C                   MOVE      F#DPIBN       L5PIBN
     C                   MOVE      F#DPIBA       L5PIBA
     C                   MOVE      F#DAWBN       L5AWBN
     C                   MOVE      F#DAWBA       L5AWBA
     C                   MOVE      F#DBENN       L5BENN
     C                   MOVE      F#DBENA       L5BENA
     C*****              MOVEL     F#DRONS       L5RONS                                       136318
      *                                                                                       136318
      *   Receive Our Nostro                                                                  136318
     C                   EVAL      L5RONS=       F#DOSDB+F#DRONS                              136318
      *                                                                                       136318
     C                   MOVE      F#DRIBN       L5RIBN
     C                   MOVE      F#DRIBA       L5RIBA
     C                   MOVE      F#DDCHG       L5DCHG
     C                   MOVE      F#DSHFI       L5SHFI
     C                   MOVE      F#DGFPT       L5GFPT
     C                   MOVE      F#DIUSR       L5IUSR
     C                   MOVE      F#DAUSR       L5AUSR
     C                   MOVE      F#DXUSR       L5XUSR
     C                   MOVE      F#DFERECI     L5RECI
     C                   MOVE      F#DFEBRCA     L5BRCA
     C                   MOVE      F#DFEACOF     L5ACOF
     C                   MOVE      F#DFEDIND     L5DIND
     C                   MOVE      F#DFELTYP     L5LTYP
     C                   MOVE      F#DFESUTP     L5SUTP
     C                   MOVE      F#DFESPTI     L5SPTI
     C                   MOVE      F#DFEPPTI     L5PPTI
     C                   MOVE      F#DFEEPTI     L5EPTI
     C                   MOVE      F#DFESBTI     L5SBTI
     C                   MOVE      F#DFEPBTI     L5PBTI
     C                   MOVE      F#DFEEBTI     L5EBTI
     C                   MOVE      F#DFSTS       L5FSTS
     C                   MOVE      F#DPCRF       L5PCRF
     C                   MOVE      F#DFEPRFC     L5PRFC                                       133237
     C                   MOVE      F#DPCOB       L5PCOB                                       157286
      *                                                                                       CEU030
     C     CEU004        IFEQ      'Y'                                                        CEU030
     C                   MOVE      F#DFESCCY     L5SCCY                                       CEU030
     C                   MOVE      F#DFEICCY     L5ICCY                                       CEU030
     C                   ENDIF                                                                CEU030
      *                                                                                       CLE031
     C                   IF        CLE031 = 'Y'                                               CLE031
      *                                                                                       CLE031
      * (Receive) Settlement Currency                                                         CLE031
     C                   EVAL      L5SCCY = F#DFESCCY                                         CLE031
      *                                                                                       CLE031
      * Receive Settlement Currency Exchange Rate                                             CLE031
     C                   Z-ADD     8             ZADEC                                        CLE031
     C                   MOVE      *BLANKS       ZFIELD                                       CLE031
     C                   MOVE      F#DFEREXR     ZFIELD                                       CLE031
     C                   EXSR      ZEDIT                                                      CLE031
     C                   MOVE      ZFIELD        L5REXR                                       CLE031
      *                                                                                       CLE031
      * Receive Settlement Currency Exchange Rate Indicator                                   CLE031
     C                   EVAL      L5REXI = F#DFEREXI                                         CLE031
      *                                                                                       CLE031
      * Pay Settlement Currency                                                               CLE031
     C                   EVAL      L5PSCY = F#DFEPSCY                                         CLE031
      *                                                                                       CLE031
      * Pay Settlement Currency Exchange Rate                                                 CLE031
     C                   Z-ADD     8             ZADEC                                        CLE031
     C                   MOVE      *BLANKS       ZFIELD                                       CLE031
     C                   MOVE      F#DFEPEXR     ZFIELD                                       CLE031
     C                   EXSR      ZEDIT                                                      CLE031
     C                   MOVE      ZFIELD        L5PEXR                                       CLE031
      *                                                                                       CLE031
      * Pay Settlement Currency Exchange Rate Indicator                                       CLE031
     C                   EVAL      L5PEXI = F#DFEPEXI                                         CLE031
     C                   ENDIF                                                                CLE031
                                                                                              CLE034
     C                   IF        CLE034 = 'Y'                                               CLE034
     C                   EVAL      L5STAL = F#DFESTAL                                         CLE034
     C                   ENDIF                                                                CLE034
      *
      * Move message format
      *
     C                   EVAL      W#L5MF=%SUBST(DWL5MF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#L5MF
     C                   ADD       W#BTML        W#MPOS
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      *
      **********************************************************************
      *   Format Fee Settlements Message
      **********************************************************************
     C     FRMTDLFS      BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'FRMTDLFS'    STK(@Q)
      *
      * Clear all detail fields.
      *
     C                   CLEAR                   D6DTL
      *
      * Settlement Due Date.
      *
     C*****              Z-ADD     F#TFASADD     W#ZDAYN                                      152695
     C                   Z-ADD     F#TFAVDAT     W#ZDAYN                                      152695
     C                   EXSR      ZZA0140
     C                   MOVEL     W#DATE8       L6SADD
      *
      * Get number of decimal places
      *
     C                   MOVE      F#TFAFCCY     W#CCY
     C                   EXSR      GETNBDP
     C                   Z-ADD     A6NBDP        ZADEC
      *
      * Fee Settlement Amount
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#TFASADJ     ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L6SADJ
      *
      * Details of Payment 1 - 4
      *
     C                   EVAL      L6DTPN=       F#TDTP1 +
     C                                           F#TDTP2 +
     C                                           F#TDTP3 +
     C                                           F#TDTP4
      *
      * Bank to Bank Info 1 - 6
      *
     C                   EVAL      L6BTBN=       F#TBTB1 +
     C                                           F#TBTB2 +
     C                                           F#TBTB3 +
     C                                           F#TBTB4 +
     C                                           F#TBTB5 +
     C                                           F#TBTB6
      *
      * Format other details.
      *
     C*****F#TFACNUM     IFNE      0                                                          CSD027
     C     F#TFACNUM     IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#TFACNUM     L6CNUM
     C                   ENDIF
      *
     C     F#TFAFACL     DIV       100           W6FACT
     C     W6FACT        IFNE      0
     C                   MOVE      W6FACT        L6FACT
     C                   ENDIF
      *
     C                   Z-ADD     F#TFAFACL     W6FCNO
     C     W6FCNO        IFNE      0
     C                   MOVE      W6FCNO        L6FCNO
     C                   ENDIF
      *
     C     F#TFAFSEQ     IFNE      0
     C                   MOVE      F#TFAFSEQ     L6FSEQ
     C                   ENDIF
      *
     C     F#TPSTM       IFNE      0
     C                   MOVE      F#TPSTM       L6PSTM
     C                   ENDIF
      *
     C*****F#TPOCN       IFNE      0                                                          CSD027
     C     F#TPOCN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#TPOCN       L6POCN
     C                   ENDIF
      *
     C*****F#TPOBN       IFNE      0                                                          CSD027
     C     F#TPOBN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#TPOBN       L6POBN
     C                   ENDIF
      *
     C     F#TRSTM       IFNE      0
     C                   MOVE      F#TRSTM       L6RSTM
     C                   ENDIF
      *
     C*****F#TROCN       IFNE      0                                                          CSD027
     C     F#TROCN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#TROCN       L6ROCN
     C                   ENDIF
      *
     C*****F#TROBN       IFNE      0                                                          CSD027
     C     F#TROBN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#TROBN       L6ROBN
     C                   ENDIF
      *
     C*****F#TFALOAN     IFNE      0                                                          CLE148
     C     F#TFALOAN     IFNE      *BLANK                                                     CLE148
     C                   MOVE      F#TFALOAN     L6LOAN
     C                   ENDIF
      *
      * Move other details.
      *
     C                   MOVE      F#TFASIGN     L6SIGN
     C                   MOVE      F#TFATYPE     L6TYPE
     C*****              MOVEL     F#TPONS       L6PONS                                       136318
      *                                                                                       136318
      *   Pay Our Nostro                                                                      136318
     C                   EVAL      L6PONS=       F#TOMDB+F#TPONS                              136318
      *                                                                                       136318
     C                   MOVE      F#TRVNO       L6RVNO
     C                   MOVE      F#TCVMR       L6CVMR
     C                   MOVE      F#TRCRN       L6RCRN
     C                   MOVE      F#TRCRA       L6RCRA
     C                   MOVE      F#TPIBN       L6PIBN
     C                   MOVE      F#TPIBA       L6PIBA
     C                   MOVE      F#TAWBN       L6AWBN
     C                   MOVE      F#TAWBA       L6AWBA
     C                   MOVE      F#TBENN       L6BENN
     C                   MOVE      F#TBENA       L6BENA
     C*****              MOVEL     F#TRONS       L6RONS                                       136318
      *                                                                                       136318
      *   Receive Our Nostro                                                                  136318
     C                   EVAL      L6RONS=       F#TOSDB+F#TRONS                              136318
      *                                                                                       136318
     C                   MOVE      F#TRIBN       L6RIBN
     C                   MOVE      F#TRIBA       L6RIBA
     C                   MOVE      F#TDCHG       L6DCHG
     C                   MOVE      F#TIUSR       L6IUSR
     C                   MOVE      F#TAUSR       L6AUSR
     C                   MOVE      F#TXUSR       L6XUSR
     C                   MOVE      F#TFARECI     L6RECI
     C                   MOVE      F#TFABRCA     L6BRCA
     C                   MOVE      F#TFAFCCY     L6FCCY
     C                   MOVE      F#TSSTS       L6SSTS
     C                   MOVE      F#TPCRF       L6PCRF
     C                   MOVE      F#TPTFI       L6PTFI
      *                                                                                       CEU030
     C     CEU004        IFEQ      'Y'                                                        CEU030
     C                   MOVE      F#TFASCCY     L6SCCY                                       CEU030
     C                   MOVE      F#TFAICCY     L6ICCY                                       CEU030
     C                   ENDIF                                                                CEU030
      *                                                                                       CLE031
     C                   IF        CLE031 = 'Y'                                               CLE031
      *                                                                                       CLE031
      * (Receive) Settlement Currency                                                         CLE031
     C                   EVAL      L6SCCY = F#TFASCCY                                         CLE031
      *                                                                                       CLE031
      * Receive Settlement Currency Exchange Rate                                             CLE031
     C                   Z-ADD     8             ZADEC                                        CLE031
     C                   MOVE      *BLANKS       ZFIELD                                       CLE031
     C                   MOVE      F#TFAREXR     ZFIELD                                       CLE031
     C                   EXSR      ZEDIT                                                      CLE031
     C                   MOVE      ZFIELD        L6REXR                                       CLE031
      *                                                                                       CLE031
      * Receive Settlement Currency Exchange Rate Indicator                                   CLE031
     C                   EVAL      L6REXI = F#TFAREXI                                         CLE031
      *                                                                                       CLE031
      * Pay Settlement Currency                                                               CLE031
     C                   EVAL      L6PSCY = F#TFAPSCY                                         CLE031
      *                                                                                       CLE031
      * Pay Settlement Currency Exchange Rate                                                 CLE031
     C                   Z-ADD     8             ZADEC                                        CLE031
     C                   MOVE      *BLANKS       ZFIELD                                       CLE031
     C                   MOVE      F#TFAPEXR     ZFIELD                                       CLE031
     C                   EXSR      ZEDIT                                                      CLE031
     C                   MOVE      ZFIELD        L6PEXR                                       CLE031
      *                                                                                       CLE031
      * Pay Settlement Currency Exchange Rate Indicator                                       CLE031
     C                   EVAL      L6PEXI = F#TFAPEXI                                         CLE031
     C                   ENDIF                                                                CLE031
                                                                                              CLE034
     C                   IF        CLE034 = 'Y'                                               CLE034
     C                   EVAL      L6STAL = F#TFASTAL                                         CLE034
     C                   ENDIF                                                                CLE034
      *
      * Move message format
      *
     C                   EVAL      W#L6MF=%SUBST(DWL6MF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#L6MF
     C                   ADD       W#BTML        W#MPOS
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      *
      **********************************************************************
      *   Format Events Message
      **********************************************************************
     C     FRMTDLEV      BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'FRMTDLEV'    STK(@Q)
      *
      * Clear all detail fields.
      *
     C                   CLEAR                   D7DTL
      *
      * Event Date
      *
     C                   Z-ADD     F#VEDAT       W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#DATE8       L7EDAT
      *
      * Associated Event Date
      *
     C                   Z-ADD     F#VOTHD       W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#DATE8       L7OTHD
      *
      * Event Amount
      *
     C                   Z-ADD     F#VECDP       ZADEC
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#VEAMT       ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L7EAMT
      *
      * Associated Event Amount
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#VOTHA       ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L7OTHA
      *
      * Current Principal Amount
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#VCPAM       ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L7CPAM
      *
      * Base Currency Equivalent - Loan Rate
      *
     C                   Z-ADD     WBCND         ZADEC
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#VDBCE       ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L7DBCE
      *
      * Base Currency Equivalent - Spot Rate
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#VBCEQ       ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L7BCEQ
      *
      * Facility Currency Equivalent - Loan Rate
      *
     C                   Z-ADD     F#VFCDP       ZADEC
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#VDFCE       ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L7DFCE
      *
      * Facility Currency Equivalent - Loan Rate
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#VFCEQ       ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L7FCEQ
      *
      * Interest Rate
      *
     C                   Z-ADD     7             ZADEC
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#VINTR       ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L7INTR
      *
      * Withholding Tax Rate
      *
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#VWTRT       ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L7WTRT
      *
      * Base Currency Equivalent Rate
      *
     C                   Z-ADD     8             ZADEC
     C                   MOVE      *BLANKS       ZFIELD
     C                   MOVE      F#VDBCR       ZFIELD
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L7DBCR
      *
      * PC Diary Event type
      *
     C                   MOVE      F#VETYP       WMIET             2
     C                   MOVE      WMIET         L7PCET                                       CLE031
     C                   SELECT
     C     WMIET         WHENEQ    'V1'
     C     WMIET         OREQ      'V2'                                                       141477
     C                   MOVE      'ST'          L7PCET
     C     WMIET         WHENEQ    'M1'
     C     WMIET         OREQ      'M2'                                                       141477
     C                   MOVE      'MA'          L7PCET
     C     WMIET         WHENEQ    'R3'
     C     WMIET         OREQ      'R4'
     C     WMIET         OREQ      'R5'
     C                   MOVE      'RO'          L7PCET
     C     WMIET         WHENEQ    'V3'
     C                   MOVE      'PI'          L7PCET
     C     WMIET         WHENEQ    'I2'
     C     WMIET         OREQ      'I3'                                                       141477
     C     WMIET         OREQ      'R2'
     C                   MOVE      'IN'          L7PCET
     C     WMIET         WHENEQ    'X2'                                                       141477
     C                   MOVE      'IC'          L7PCET                                       141477
     C     WMIET         WHENEQ    'D1'                                                       141477
     C                   MOVE      'PD'          L7PCET                                       141477
     C     WMIET         WHENEQ    'R7'                                                       141477
     C                   MOVE      'PF'          L7PCET                                       141477
     C     WMIET         WHENEQ    'V5'                                                       141477
     C                   MOVE      'PT'          L7PCET                                       141477
     C     WMIET         WHENEQ    'V7'                                                       141477
     C     WMIET         OREQ      'R9'                                                       141477
     C                   MOVE      'MC'          L7PCET                                       141477
     C     WMIET         WHENEQ    'R1'
     C                   MOVE      'RE'          L7PCET
     C     WMIET         WHENEQ    'F1'
     C     WMIET         OREQ      'F2'
     C                   MOVE      'FE'          L7PCET
     C     WMIET         WHENEQ    'H1'                                                       CLE028
     C     CLE028        ANDEQ     'Y'                                                        CLE028
     C                   MOVE      'CH'          L7PCET                                       CLE028
     C                   ENDSL
      *
      * Move other fields.
      *
     C*****F#VLNRF       IFNE      0                                                          CLE148
     C     F#VLNRF       IFNE      *BLANK                                                     CLE148
     C                   MOVE      F#VLNRF       L7LOAN
     C                   ENDIF
     C*****F#VFCUS       IFNE      0                                                          CSD027
     C     F#VFCUS       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#VFCUS       L7FCUS
     C                   ENDIF
     C     F#VFACT       IFNE      0
     C                   MOVE      F#VFACT       L7FACT
     C                   ENDIF
     C     F#VFCNO       IFNE      0
     C                   MOVE      F#VFCNO       L7FCNO
     C                   ENDIF
     C*****F#VOLNO       IFNE      0                                                          CSD027
     C     F#VOLNO       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#VOLNO       L7OLNO
     C                   ENDIF
      *
     C                   MOVE      F#VFCCY       L7FCCY
     C                   MOVE      F#VECDP       L7ECDP
     C                   MOVE      F#VETYP       L7ETYP
     C                   MOVE      F#VEBRC       L7EBRC
     C                   MOVE      F#VECPY       L7ECPY
     C                   MOVE      F#VLTYP       L7LTYP
     C                   MOVE      F#VSUTP       L7SUTP
     C                   MOVE      F#VNGII       L7NGII
      *
     C                   MOVE      F#VRECI       L7RECI
     C                   MOVE      F#VCUNR       L7CNUM
     C                   MOVE      F#VPTNU       L7PTNU
     C                   MOVE      F#VECCY       L7ECCY
     C                   MOVE      F#VFCDP       L7FCDP
     C                   MOVE      F#VFIPI       L7FIPI
     C                   MOVE      F#VSETP       L7SETP
     C                   MOVE      F#VOSBR       L7OSBR
     C                   MOVE      F#VOSAC       L7OSAC
     C                   MOVE      F#VTSEN       L7TSEN
     C                   MOVE      F#VFACO       L7FACO
     C                   MOVE      F#VSPI1       L7SPI1
     C                   MOVE      F#VSPI2       L7SPI2
     C                   MOVE      F#VSPI3       L7SPI3
     C                   MOVE      F#VINOI       L7INOI
     C                   MOVE      F#VPARI       L7PARI
     C                   MOVE      F#VCRNM       L7CRNM
     C                   MOVE      F#VCTWN       L7CTWN
     C                   MOVE      F#VCASK       L7CASK
     C                   MOVE      F#VPRNM       L7PRNM
     C                   MOVE      F#VPTWN       L7PTWN
     C                   MOVE      F#VPASK       L7PASK
     C                   MOVE      F#VCRSK       L7CRSK
     C                   MOVE      F#VFACT       L7FACT
     C                   MOVE      F#VREGC       L7REGC
     C                   MOVE      F#VCDOM       L7CDOM
     C                   MOVE      F#VRDOM       L7RDOM
     C                   MOVE      F#VFREO       L7FREO
     C                   MOVE      F#VWTIN       L7WTIN
     C                   MOVE      F#VAUTO       L7AUTO
     C                   MOVE      F#VACOF       L7ACOF
     C                   MOVE      F#VRCSI       L7RCSI
     C                   MOVE      F#VORBR       L7ORBR
     C                   MOVE      F#VCOOB       L7COOB
     C                   MOVE      F#VBRCA       L7BBRC
     C                   MOVE      F#VCOBB       L7COBB
     C                   MOVE      F#VIBRE       L7IBRE
     C                   MOVE      F#VICYE       L7ICYE
     C                   MOVE      F#VEXEI       L7EXEI
     C                   MOVE      F#VELVB       L7ELVB
     C                   MOVE      F#VELVC       L7ELVC
     C                   MOVE      F#VELVS       L7ELVS
     C                   MOVE      F#VBOKC       L7BOKC
     C                   MOVE      F#VPTFR       L7PTFR
     C                   MOVE      F#VSRLR       L7SRLR
     C                   MOVE      F#VGASI       L7GASI
      *
      * Move message format
      *
     C                   EVAL      W#L7MF=%SUBST(DWL7MF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#L7MF
     C                   ADD       W#BTML        W#MPOS
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      *
      **********************************************************************
      *   Format User Message
      **********************************************************************
     C     FRMTUSER      BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'FRMTUSER'    STK(@Q)
      *
      * Clear all detail fields.
      *
     C                   CLEAR                   DUDTL
      *
      * Move User ID and Language Code.
      *
     C                   MOVEL     F#UUSRP       LUUSID
     C                   MOVEL     F#UMULT       LUMULT
     C*                                                                                       155429
     C** Move User Default Branch.                                                            155429
     C*                                                                                       155429
     C                   MOVEL     F#UDBRN       LUDBRN                                       155429
      *
      * Move message format
      *
     C                   EVAL      W#USMF=%SUBST(DWSWMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#USMF
     C                   ADD       W#BTML        W#MPOS
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      *
      **********************************************************************
      *   Access First Record
      **********************************************************************
     C     GETFIRST      BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'GETFIRST'    STK(@Q)
      *
      *
     C                   SELECT
      *
      * Access Midas Modules Details
     C     X1MSGT        WHENEQ    'MMOD'
      *
     C                   CALL      'AOMMODR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C     SDMMOD        PARM      SDMMOD        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDMMODPD'    DBFILE
     C                   Z-ADD     11            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Bank Details
     C     X1MSGT        WHENEQ    'BANK'
      *
      * Access General Ledger ICD details
     C     X1MSGT        WHENEQ    'GELR'
      *
     C**********         CALL      'AOGELRR0'                                                 CGL029
     C                   CALL      'AOGELRR1'                                                 CGL029
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C*****SDGELR        PARM      SDGELR        DSFDY                                        CGL029
     C     SDGELR        PARM      SDGELR        DSSDY                                        CGL029
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDGELRPD'    DBFILE
     C                   Z-ADD     12            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Retail ICD details
     C     X1MSGT        WHENEQ    'RETL'
      *
     C                   CALL      'AORETLR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C     SDRETL        PARM      SDRETL        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDRETLPD'    DBFILE
     C                   Z-ADD     13            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Customer Lending ICD details
     C     X1MSGT        WHENEQ    'CLND'
      *
     C                   CALL      'AOCLNDR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C*****SDCLND        PARM      SDCLND        DSFDY                                        CLE134
     C     SDCLND        PARM      SDCLND        DSSDY                                        CLE134
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDCLNDPD'    DBFILE
     C                   Z-ADD     14            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Portfolio Management ICD details
     C     X1MSGT        WHENEQ    'PORT'
      *
     C                   CALL      'AOPORTR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C     SDPORT        PARM      SDPORT        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'                                                   219071
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDPORTPD'    DBFILE
     C                   Z-ADD     15            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Trading ICD details
     C     X1MSGT        WHENEQ    'TRAD'
      *
     C                   CALL      'AOTRADR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C     SDTRAD        PARM      SDTRAD        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'                                                   219071
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDTRADPD'    DBFILE
     C                   Z-ADD     16            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Profit Centre Accounting ICD
     C     X1MSGT        WHENEQ    'PCAC'
      *
     C                   CALL      'AOPCACR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C     SDPCAC        PARM      SDPCAC        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'                                                   219071
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDPCACPD'    DBFILE
     C                   Z-ADD     73            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Customer Details
     C     X1MSGT        WHENEQ    'CUST'
      *
     C************       CALL      'AOCUSTR0'                                                 CPB003
     C                   CALL      'AOCUSTR1'                                                 CPB003
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY10           10
     C                   PARM      *BLANK        WWKY7             7
     C*****SDCUST        PARM      SDCUST        DSSDY                                        CPB003
     C     SDCUST        PARM      SDCUST        DSLDY                                        CPB003
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDCUSTPD'    DBFILE
     C                   Z-ADD     17            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
     C/COPY WNCPYSRC,LE2015MC04
      *
      * Access Customer Alternative Names and Addresses
     C     X1MSGT        WHENEQ    'ALTN'
      *
     C                   CALL      'AOALTNR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY6             6
     C                   PARM      *BLANK        WWKY1             1
     C     SDALTN        PARM      SDALTN        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDALTNPD'    DBFILE
     C                   Z-ADD     18            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Facility Types
     C     X1MSGT        WHENEQ    'FACT'
      *
     C                   CALL      'AOFACTR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY3             3
     C     SDFACT        PARM      SDFACT        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'                                                   219071
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDFACTPD'    DBFILE
     C                   Z-ADD     19            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Branch Codes
     C     X1MSGT        WHENEQ    'BRCH'
      *
     C***********        CALL      'AOBRCHR0'
     C                   CALL      'AOBRCHR1'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY3             3
     C     SDBRCH        PARM      SDBRCH        DSSDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDBRCHPD'    DBFILE
     C                   Z-ADD     20            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Currency Codes
     C     X1MSGT        WHENEQ    'CURR'
      *
     C                   CALL      'AOCURRR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY3             3
     C     SDCURR        PARM      SDCURR        DSSDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDCURRPD'    DBFILE
     C                   Z-ADD     21            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Country Codes
     C     X1MSGT        WHENEQ    'CTRY'
      *
     C                   CALL      'AOCTRYR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY2             2
     C     SDCTRY        PARM      SDCTRY        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDCTRYPD'    DBFILE
     C                   Z-ADD     22            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Fee Codes
     C     X1MSGT        WHENEQ    'FEEC'
      *
     C                   CALL      'AOFEER0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY2             2
     C     SDFEEC        PARM      SDFEEC        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'                                                   219071
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDFEEPD'     DBFILE
     C                   Z-ADD     91            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Industry Codes
     C     X1MSGT        WHENEQ    'INDS'
      *
     C                   CALL      'AOINDSR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY3             3
     C     SDINDS        PARM      SDINDS        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDINDSPD'    DBFILE
     C                   Z-ADD     23            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Account Officer Codes
     C     X1MSGT        WHENEQ    'ACOF'
      *
     C                   CALL      'AOACOFR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY2             2
     C     SDACOF        PARM      SDACOF        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDACOFPD'    DBFILE
     C                   Z-ADD     24            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Profit Centre Matrix Details
     C     X1MSGT        WHENEQ    'PRFM'
      *
     C                   READ      SDPRFML1                             8687
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
     C                   ENDIF
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   ENDIF
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDPRFMPD'    DBFILE
     C                   Z-ADD     25            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Profit Centres
     C     X1MSGT        WHENEQ    'PRFC'
      *
     C                   CALL      'AOPRFCR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY4             4
     C     SDPRFC        PARM      SDPRFC        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDPRFCPD'    DBFILE
     C                   Z-ADD     26            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Book Codes
     C     X1MSGT        WHENEQ    'BOOK'
      *
     C                   CALL      'AOBOOKR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY2             2
     C     SDBOOK        PARM      SDBOOK        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'                                                   219071
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDBOOKPD'    DBFILE
     C                   Z-ADD     27            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Loan Types/Sub-types
     C     X1MSGT        WHENEQ    'LTST'
      *
     C                   CALL      'AOLOANR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY2             2
     C                   PARM      *BLANK        WWKY2B            2
     C     SDLOAN        PARM      SDLOAN        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'                                                   219071
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDLOANPD'    DBFILE
     C                   Z-ADD     28            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Base Rate Codes
     C     X1MSGT        WHENEQ    'BSRT'
      *
     C                   CALL      'AOBSRTR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY3             3
     C                   PARM      *BLANK        WWKY2             2
     C*****SDBSRT        PARM      SDBSRT        DSFDY                          CSD006
     C     SDBSRT        PARM      SDBSRT        DSSDY                          CSD006
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDBSRTPD'    DBFILE
     C                   Z-ADD     29            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Base Rate History
     C     X1MSGT        WHENEQ    'BSHS'
      *
     C                   READ      SDBSHSL1                             8687
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
     C                   ENDIF
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   ENDIF
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDBSHSPD'    DBFILE
     C                   Z-ADD     30            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Nostro Codes
     C     X1MSGT        WHENEQ    'NOST'
      *
     C                   CALL      'AONOSTR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY6             6
     C                   PARM      *BLANK        WWKY3             3
     C                   PARM      *BLANK        WWKY4             4
     C                   PARM      *BLANK        WWKY2             2
     C                   PARM      *BLANK        WWKY2B            2
     C                   PARM      *BLANK        WWKY3B            3
     C                   PARM      *BLANK        WWKY10           10
     C                   PARM      *BLANK        WWKY1             1
     C     SDNOST        PARM      SDNOST        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDNOSTPD'    DBFILE
     C                   Z-ADD     31            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Counterparty Nostro Codes
     C     X1MSGT        WHENEQ    'CNST'
      *
     C                   CALL      'AOCNSTR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY8             8
     C     SDCNST        PARM      SDCNST        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDCNSTPD'    DBFILE
     C                   Z-ADD     32            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Accounts Codes
     C     X1MSGT        WHENEQ    'ACNT'
      *
     C                   CALL      'AOACCTR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY10           10
     C                   PARM      *BLANK        WWKY6             6
     C                   PARM      *BLANK        WWKY3             3
     C                   PARM      *BLANK        WWKY4             4
     C                   PARM      *BLANK        WWKY2             2
     C                   PARM      *BLANK        WWKY3B            3
     C     ACCNT         PARM      ACCNT         DSSDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'                                                   219071
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'ACCNTAB'     DBFILE
     C                   Z-ADD     33            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Extended Settlements
     C     X1MSGT        WHENEQ    'EXST'
      *
     C**********         CALL      'AOEXSTR0'                                                 149721
     C                   CALL      'AOEXSTR1'                                                 149721
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY3             3
     C                   PARM      *BLANK        WWKY6             6
     C                   PARM      *BLANK        WWKY2             2
     C*****SDEXST        PARM      SDEXST        DSSDY                          149721
     C     SDEXST        PARM      SDEXST        DSLDY                          149721
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'                                                   219071
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDEXSTPD'    DBFILE
     C                   Z-ADD     34            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Portfolio References
     C     X1MSGT        WHENEQ    'PORR'
      *
     C                   READ      PMPORTLL                             8687
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
     C                   ENDIF
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   ENDIF
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'PMPORTLL'    DBFILE
     C                   Z-ADD     35            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Portfolio Customers
     C     X1MSGT        WHENEQ    'PLCS'
      *
     C                   CALL      'AOPLCSR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY10           10
     C     SDPLCS        PARM      SDPLCS        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDPLCSPD'    DBFILE
     C                   Z-ADD     36            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Holidays
     C     X1MSGT        WHENEQ    'HOLS'
      *
     C                   CALL      'AOHOLSR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY3             3
     C                   PARM      *BLANK        WWKY3B            3
     C                   PARM      *BLANK        WWKY4             4
     C     SDHOL         PARM      SDHOL         DSSDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDHOLPD'     DBFILE
     C                   Z-ADD     37            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Swift Codewords
     C     X1MSGT        WHENEQ    'CODE'
      *
     C                   READ      SDCODEL1                             8687
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
     C                   ENDIF
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   ENDIF
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDCODEL1'    DBFILE
     C                   Z-ADD     38            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Switchable Features
     C     X1MSGT        WHENEQ    'SARD'
      *
     C                   OPEN      SCSARDL1
     C                   READ      SCSARDL1                             8687
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
     C                   ENDIF
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   ENDIF
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SCSARDL1'    DBFILE
     C                   Z-ADD     39            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *                                                                         CLE031
      * Access System values                                                    CLE031
     C     X1MSGT        WHENEQ    'SVAL'                                       CLE031
      *                                                                         CLE031
     C******LOVAL        SETLL     SDSVALJ0                                     CLE031      MD054605
     C**********         READ      SDSVALJ0                             8687    CLE031      MD054605
     C/EXEC SQL                                                                             MD054605
     C+ declare ACursor insensitive scroll cursor for                                       MD054605
     C+ select * from SDSVLJW1                                                              MD054605
     C+ order by GISVAL                                                                     MD054605
     C/END-EXEC                                                                             MD054605
                                                                                            MD054605
     C/EXEC SQL                                                                             MD054605
     C+ close ACursor                                                                       MD054605
     C/END-EXEC                                                                             MD054605
                                                                                            MD054605
     C/EXEC SQL                                                                             MD054605
     C+ open ACursor                                                                        MD054605
     C/END-EXEC                                                                             MD054605
                                                                                            MD054605
     C/EXEC SQL                                                                             MD054605
     C+ fetch next from ACursor into :SDSVAL :NullInds                                      MD054605
     C/END-EXEC                                                                             MD054605
     C                   SETOFF                                       8687                  MD054605
     C                   If        SQLCODE = 100                                            MD054605
     C                   SETON                                        87                    MD054605
     C                   ELSE                                                               MD054605
     C                   If        SQLCODE <> 0                                             MD054605
     C                   SETON                                        86                    MD054605
     C                   ENDIF                                                              MD054605
     C                   ENDIF                                                              MD054605
                                                                                            MD054605
     C     *IN87         IFEQ      *OFF                                         CLE031
     C                   CLEAR                   WWRTCD                         CLE031
     C                   ENDIF                                                  CLE031
     C     *IN87         IFEQ      *ON                                          CLE031
     C                   MOVEL(P)  '*EOF'        WWRTCD                         CLE031
     C                   ENDIF                                                  CLE031
      *   Error?                                                                CLE031
     C     *IN86         IFEQ      *ON                                          CLE031
     C                   MOVEL     '*FIRST'      DBKEY                          CLE031
     C                   MOVEL     'SDSVALJ0'    DBFILE                         CLE031
     C                   Z-ADD     93            DBASE                          CLE031
     C                   EXSR      *PSSR                                        CLE031
     C                   ENDIF                                                  CLE031
      *
      * Access Currency Clearing System
     C     X1MSGT        WHENEQ    'CCSY'
      *
     C                   CALL      'AOCCSYR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      *BLANK        WWKY3             3
     C                   PARM      *BLANK        WWKY2             2
     C     SDCCSY        PARM      SDCCSY        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EMPTY'
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDCCSYPD'    DBFILE
     C                   Z-ADD     40            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Facilities
     C     X1MSGT        WHENEQ    'DLFC'
      *
     C                   READ      FCLTY                                8687
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'FCLTY   '    DBFILE
     C                   Z-ADD     65            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   ENDIF
      *
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
     C                   CLEAR                   WWKY3
      * Get B Record
     C                   MOVE      W#FCLTY       W1FCLTY
     C                   READ      FCLTY                                8687
      *   Error?
     C     *IN86         IFEQ      *ON
     C     *IN87         OREQ      *ON
     C     W#FCLTY       ORNE      W1FCLTY
     C                   MOVEL     '*FIRST B'    DBKEY
     C                   MOVEL     'FCLTY   '    DBFILE
     C                   Z-ADD     66            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
     C                   ENDIF
      *
      * Access Loans
     C     X1MSGT        WHENEQ    'DLLN'
     C                   READ      CLOAN                                8687
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'CLOAN   '    DBFILE
     C                   Z-ADD     67            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   ENDIF
      *
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
      * Get B Record
     C                   MOVE      W#CLOAN       W1CLOAN
     C                   READ      CLOAN                                8687
      *   Error?
     C     *IN86         IFEQ      *ON
     C     *IN87         OREQ      *ON
     C     W#CLOAN       ORNE      W1CLOAN
     C                   MOVEL     '*FIRST B'    DBKEY
     C                   MOVEL     'CLOAN   '    DBFILE
     C                   Z-ADD     68            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
     C                   ENDIF
      *
      * Access Loan Amendments
     C     X1MSGT        WHENEQ    'DLLA'
      *
     C                   READ      LOAMS                                8687
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   ENDIF
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
     C                   ENDIF
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'LOAMS   '    DBFILE
     C                   Z-ADD     69            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Risk Participants/Assignments
     C     X1MSGT        WHENEQ    'DLRA'
      *
     C***********        READ      LEPARTL2                             8687
     C**********         READ      LEPARTL3                             8687                  195720
     C                   READ      LEPARTL4                             8687                  195720
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
     C                   ENDIF
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   ENDIF
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*FIRST'      DBKEY
     C***********        MOVEL     'LEPARTL2'    DBFILE
     C**********         MOVEL     'LEPARTL3'    DBFILE                                       195720
     C                   MOVEL     'LEPARTL4'    DBFILE                                       195720
     C                   Z-ADD     70            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
     C/COPY WNCPYSRC,LE2015C001
      *
      *
     C                   ENDSL
      *
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      **********************************************************************
      *   Access Next Record
      **********************************************************************
     C     GETNEXT       BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'GETNEXT '    STK(@Q)
      *
      *
     C                   SELECT
      * Access Customer Details
     C     X1MSGT        WHENEQ    'CUST'
      *
     C************       CALL      'AOCUSTR0'                                                 CPB003
     C                   CALL      'AOCUSTR1'                                                 CPB003
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY10           10
     C                   PARM      *BLANK        WWKY7             7
     C*****SDCUST        PARM      SDCUST        DSSDY                                        CPB003
     C     SDCUST        PARM      SDCUST        DSLDY                                        CPB003
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDCUSTPD'    DBFILE
     C                   Z-ADD     41            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
     C/COPY WNCPYSRC,LE2015MC05
      *
      * Access Customer Alternative Names and Addresses
     C     X1MSGT        WHENEQ    'ALTN'
      *
     C                   CALL      'AOALTNR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY6             6
     C                   PARM      *BLANK        WWKY1             1
     C     SDALTN        PARM      SDALTN        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDALTNPD'    DBFILE
     C                   Z-ADD     42            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Facility Types
     C     X1MSGT        WHENEQ    'FACT'
      *
     C                   CALL      'AOFACTR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY3             3
     C     SDFACT        PARM      SDFACT        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDFACTPD'    DBFILE
     C                   Z-ADD     43            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Branch Codes
     C     X1MSGT        WHENEQ    'BRCH'
      *
     C***********        CALL      'AOBRCHR0'
     C                   CALL      'AOBRCHR1'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY3             3
     C     SDBRCH        PARM      SDBRCH        DSSDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDBRCHPD'    DBFILE
     C                   Z-ADD     44            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Currency Codes
     C     X1MSGT        WHENEQ    'CURR'
      *
     C                   CALL      'AOCURRR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY3             3
     C     SDCURR        PARM      SDCURR        DSSDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDCURRPD'    DBFILE
     C                   Z-ADD     45            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Country Codes
     C     X1MSGT        WHENEQ    'CTRY'
      *
     C                   CALL      'AOCTRYR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY2             2
     C     SDCTRY        PARM      SDCTRY        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDCTRYPD'    DBFILE
     C                   Z-ADD     46            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Fee Codes
     C     X1MSGT        WHENEQ    'FEEC'
      *
     C                   CALL      'AOFEER0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY2             2
     C     SDFEEC        PARM      SDFEEC        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDFEEPD '    DBFILE
     C                   Z-ADD     92            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Industry Codes
     C     X1MSGT        WHENEQ    'INDS'
      *
     C                   CALL      'AOINDSR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY3             3
     C     SDINDS        PARM      SDINDS        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDINDSPD'    DBFILE
     C                   Z-ADD     47            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Account Officer Codes
     C     X1MSGT        WHENEQ    'ACOF'
      *
     C                   CALL      'AOACOFR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY2             2
     C     SDACOF        PARM      SDACOF        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDACOFPD'    DBFILE
     C                   Z-ADD     48            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Profit Centre Matrix Details
     C     X1MSGT        WHENEQ    'PRFM'
      *
     C                   READ      SDPRFML1                             8687
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
     C                   ENDIF
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   ENDIF
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDPRFMPD'    DBFILE
     C                   Z-ADD     49            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Profit Centres
     C     X1MSGT        WHENEQ    'PRFC'
      *
     C                   CALL      'AOPRFCR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY4             4
     C     SDPRFC        PARM      SDPRFC        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDPRFCPD'    DBFILE
     C                   Z-ADD     50            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Book Codes
     C     X1MSGT        WHENEQ    'BOOK'
      *
     C                   CALL      'AOBOOKR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY2             2
     C     SDBOOK        PARM      SDBOOK        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDBOOKPD'    DBFILE
     C                   Z-ADD     51            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Loan Types/Sub-types
     C     X1MSGT        WHENEQ    'LTST'
      *
     C                   CALL      'AOLOANR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY2             2
     C                   PARM      *BLANK        WWKY2B            2
     C     SDLOAN        PARM      SDLOAN        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDLOANPD'    DBFILE
     C                   Z-ADD     52            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Base Rate Codes
     C     X1MSGT        WHENEQ    'BSRT'
      *
     C                   CALL      'AOBSRTR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY3             3
     C                   PARM      *BLANK        WWKY2             2
     C*****SDBSRT        PARM      SDBSRT        DSFDY                          CSD006
     C     SDBSRT        PARM      SDBSRT        DSSDY                          CSD006
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDBSRTPD'    DBFILE
     C                   Z-ADD     53            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Base Rate History
     C     X1MSGT        WHENEQ    'BSHS'
      *
     C                   READ      SDBSHSL1                             8687
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
     C                   ENDIF
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   ENDIF
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDBSHSPD'    DBFILE
     C                   Z-ADD     54            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Nostro Codes
     C     X1MSGT        WHENEQ    'NOST'
      *
     C                   CALL      'AONOSTR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY6             6
     C                   PARM      *BLANK        WWKY3             3
     C                   PARM      *BLANK        WWKY4             4
     C                   PARM      *BLANK        WWKY2             2
     C                   PARM      *BLANK        WWKY2B            2
     C                   PARM      *BLANK        WWKY3B            3
     C                   PARM      *BLANK        WWKY10           10
     C                   PARM      *BLANK        WWKY1             1
     C     SDNOST        PARM      SDNOST        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDNOSTPD'    DBFILE
     C                   Z-ADD     55            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Counterparty Nostro Codes
     C     X1MSGT        WHENEQ    'CNST'
      *
     C                   CALL      'AOCNSTR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY8             8
     C     SDCNST        PARM      SDCNST        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDCNSTPD'    DBFILE
     C                   Z-ADD     56            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Accounts Codes
     C     X1MSGT        WHENEQ    'ACNT'
      *
     C                   CALL      'AOACCTR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY10           10
     C                   PARM      *BLANK        WWKY6             6
     C                   PARM      *BLANK        WWKY3             3
     C                   PARM      *BLANK        WWKY4             4
     C                   PARM      *BLANK        WWKY2             2
     C                   PARM      *BLANK        WWKY3B            3
     C     ACCNT         PARM      ACCNT         DSSDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'ACCNTAB'     DBFILE
     C                   Z-ADD     57            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Extended Settlements
     C     X1MSGT        WHENEQ    'EXST'
      *
     C**********         CALL      'AOEXSTR0'                                                 149721
     C                   CALL      'AOEXSTR1'                                                 149721
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY3             3
     C                   PARM      *BLANK        WWKY6             6
     C                   PARM      *BLANK        WWKY2             2
     C*****SDEXST        PARM      SDEXST        DSSDY                          149721
     C     SDEXST        PARM      SDEXST        DSLDY                          149721
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDEXSTPD'    DBFILE
     C                   Z-ADD     58            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Portfolio References
     C     X1MSGT        WHENEQ    'PORR'
      *
     C                   READ      PMPORTLL                             8687
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
     C                   ENDIF
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   ENDIF
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'PMPORTLL'    DBFILE
     C                   Z-ADD     59            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Portfolio Customers
     C     X1MSGT        WHENEQ    'PLCS'
      *
     C                   CALL      'AOPLCSR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY10           10
     C     SDPLCS        PARM      SDPLCS        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDPLCSPD'    DBFILE
     C                   Z-ADD     60            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Holidays
     C     X1MSGT        WHENEQ    'HOLS'
      *
     C                   CALL      'AOHOLSR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY3             3
     C                   PARM      *BLANK        WWKY3B            3
     C                   PARM      *BLANK        WWKY4             4
     C     SDHOL         PARM      SDHOL         DSSDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDHOLPD'     DBFILE
     C                   Z-ADD     61            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Swift Codewords
     C     X1MSGT        WHENEQ    'CODE'
      *
     C                   READ      SDCODEL1                             8687
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
     C                   ENDIF
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   ENDIF
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDCODEL1'    DBFILE
     C                   Z-ADD     62            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Switchable Features
     C     X1MSGT        WHENEQ    'SARD'
      *
     C                   READ      SCSARDL1                             8687
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
     C                   ENDIF
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   CLOSE     SCSARDL1
     C                   ENDIF
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SCSARDL1'    DBFILE
     C                   Z-ADD     63            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *                                                                         CLE031
      * Access System values                                                    CLE031
     C     X1MSGT        WHENEQ    'SVAL'                                       CLE031
      *                                                                         CLE031
     C**********         READ      SDSVALJ0                             8687    CLE031      MD054605
     C/EXEC SQL                                                                             MD054605
     C+ fetch next from ACursor into :SDSVAL :NullInds                                      MD054605
     C/END-EXEC                                                                             MD054605
     C                   SETOFF                                       8687                  MD054605
     C                   If        SQLCODE = 100                                            MD054605
     C                   SETON                                        87                    MD054605
     C                   ELSE                                                               MD054605
     C                   If        SQLCODE <> 0                                             MD054605
     C                   SETON                                        86                    MD054605
     C                   ENDIF                                                              MD054605
     C                   ENDIF                                                              MD054605
                                                                                            MD054605
     C     *IN87         IFEQ      *OFF                                         CLE031
     C                   CLEAR                   WWRTCD                         CLE031
     C                   ENDIF                                                  CLE031
     C     *IN87         IFEQ      *ON                                          CLE031
     C                   MOVEL(P)  '*EOF'        WWRTCD                         CLE031
     C                   ENDIF                                                  CLE031
      *   Error?                                                                CLE031
     C     *IN86         IFEQ      *ON                                          CLE031
     C                   MOVEL     '*NEXT '      DBKEY                          CLE031
     C                   MOVEL     'SDSVALJ0'    DBFILE                         CLE031
     C                   Z-ADD     94            DBASE                          CLE031
     C                   EXSR      *PSSR                                        CLE031
     C                   ENDIF                                                  CLE031
      *
      * Access Currency Clearing System
     C     X1MSGT        WHENEQ    'CCSY'
      *
     C                   CALL      'AOCCSYR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*NEXT '      WWOPTN            7
     C                   PARM      *BLANK        WWKY3             3
     C                   PARM      *BLANK        WWKY2             2
     C     SDCCSY        PARM      SDCCSY        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF  '
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDCCSYPD'    DBFILE
     C                   Z-ADD     64            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Facilities
     C     X1MSGT        WHENEQ    'DLFC'
      *
     C                   READ      FCLTY                                8687
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'FCLTY   '    DBFILE
     C                   Z-ADD     65            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   ENDIF
      *
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
      * Get B Record
     C                   MOVE      W#FCLTY       W1FCLTY
     C                   READ      FCLTY                                8687
      *   Error?
     C     *IN86         IFEQ      *ON
     C     *IN87         OREQ      *ON
     C     W#FCLTY       ORNE      W1FCLTY
     C                   MOVEL     '*NEXT B'     DBKEY
     C                   MOVEL     'FCLTY   '    DBFILE
     C                   Z-ADD     66            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
     C                   ENDIF
      *
      * Access Loans
     C     X1MSGT        WHENEQ    'DLLN'
      *
     C                   READ      CLOAN                                8687
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'CLOAN   '    DBFILE
     C                   Z-ADD     67            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   ENDIF
      *
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
      * Get B Record
     C                   MOVE      W#CLOAN       W1CLOAN
     C                   READ      CLOAN                                8687
      *   Error?
     C     *IN86         IFEQ      *ON
     C     *IN87         OREQ      *ON
     C     W#CLOAN       ORNE      W1CLOAN
     C                   MOVEL     '*FIRST B'    DBKEY
     C                   MOVEL     'CLOAN   '    DBFILE
     C                   Z-ADD     68            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
     C                   ENDIF
      *
      * Access Loan Amendments
     C     X1MSGT        WHENEQ    'DLLA'
      *
     C                   READ      LOAMS                                8687
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
     C                   ENDIF
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   ENDIF
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'LOAMS   '    DBFILE
     C                   Z-ADD     71            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Access Risk Participants/Assignments
     C     X1MSGT        WHENEQ    'DLRA'
      *
     C***********        READ      LEPARTL2                             8687
     C**********         READ      LEPARTL3                             8687                  195720
     C                   READ      LEPARTL4                             8687                  195720
     C     *IN87         IFEQ      *OFF
     C                   CLEAR                   WWRTCD
     C                   ENDIF
     C     *IN87         IFEQ      *ON
     C                   MOVEL(P)  '*EOF'        WWRTCD
     C                   ENDIF
      *   Error?
     C     *IN86         IFEQ      *ON
     C                   MOVEL     '*FIRST'      DBKEY
     C***********        MOVEL     'LEPARTL2'    DBFILE
     C**********         MOVEL     'LEPARTL3'    DBFILE                                       195720
     C                   MOVEL     'LEPARTL4'    DBFILE                                       195720
     C                   Z-ADD     72            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
     C/COPY WNCPYSRC,LE2015C002
      *
      *
     C                   ENDSL
      *
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      **********************************************************************
      *   Format and Populate Data
      **********************************************************************
     C     FORMAT        BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'FORMAT  '    STK(@Q)
      *
      *
     C                   SELECT
      *
      * Format Midas Module details
     C     X1MSGT        WHENEQ    'MMOD'
      *
     C                   MOVE      BGMTCL        S1MTCL
     C                   MOVE      BGSWCL        S1SWCL
     C                   MOVE      BGRTBN        S1RTBN
     C                   MOVE      BGPFMG        S1PFMG
     C                   MOVE      BGCHIP        S1CHIP
     C                   MOVE      BGMBIN        S1MBIN
     C                   MOVE      BGN0ST        S1N0ST
     C*                                                                                       CPB003
     C** Always send this information to ensure the length of the                             CPB003
     C** message is the expected length. Note in Loan Manager will only                       CPB003
     C** populate tables with this information if the feature is on                           CPB003
     C*                                                                                       CPB003
     C                   MOVE      BGN4ST        S1N4ST                                       CPB003
      * Move message format
     C                   MOVEL(P)  DWS1MF        W#MFMT
      *
      * Format Bank details
     C     X1MSGT        WHENEQ    'BANK'
      *
      *
      * Format and populate data
     C                   MOVE      BJCNCD        S2CNCD
     C                   MOVE      BJCYCD        S2CYCD
     C                   MOVE      BJHOCY        S2HOCY
     C                   MOVE      BJLCCY        S2LCCY
     C                   MOVE      BJSBRC        S2SBRC
     C                   MOVE      BJCUST        S2CUST
     C                   MOVE      BJSLCD        S2SLCD
     C                   MOVE      BJDFIN        S2DFIN
     C                   MOVE      W#SYSDAT      S2SYDT
     C                   MOVE      W#DNWD        S2DNWD
     C                   MOVE      BJURPT        S2URPT
     C                   MOVE      W#EYD         S2EYD
     C                   MOVE      W#PEYD        S2PEYD
     C                   Z-ADD     BJBVPD        S2BVPD
      *                                                                                       157759
      **Find*out*Midas*System*Phase***********************************                 157759 CCB020
      *                                                                                       157759
     C******LOCK         IN        MPHAS                                               157759 CCB020
     C**********         MOVE      PHASE         W#MPHAS                               157759 CCB020
     C**********         OUT       MPHAS                                               157759 CCB020
      *                                                                                       157759
      * If not input cycle phase                                                              157759
      *                                                                                       157759
     C*****W#MPHAS       IFNE      'A'                                                 157759 CCB020
     C     COBST         IFEQ      '*NO'                                                      CCB020
     C                   EXSR      SYSDAT                                                     157759
     C                   ENDIF                                                                157759
      *                                                                                       157759
      * Move message format
     C                   MOVEL(P)  DWS2MF        W#MFMT
      *
      * Format General Ledger ICD details
     C     X1MSGT        WHENEQ    'GELR'
      *
      *   Convert Accruals Profit Date to DDMMYYYY or MMDDYYYY
     C                   Z-ADD     BKAPDT        W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#ZDATE8      S3APDT
      *
     C                   MOVE      BKAPFQ        S3APFQ
     C                   MOVE      BKAPFD        S3APFD
     C                   MOVE      BKALDI        S3ALDI
     C                   MOVE      BKANWD        S3ANWD
     C                   MOVE      BKPRCU        S3PRCU
     C                   MOVE      BKPRCA        S3PRCA
     C                   MOVE      BKPCDU        S3PCDU
     C                   MOVE      BKPMBK        S3PMBK
     C                   MOVE      BKPMTT        S3PMTT
     C                   MOVE      BKPMST        S3PMST
     C                   MOVE      BKPMDT        S3PMDT
     C                   MOVE      BKPMUR        S3PMUR
     C                   MOVE      BKPMAO        S3PMAO
     C                   MOVE      BKPMCU        S3PMCU
     C                   MOVE      BKPMBH        S3PMBH
     C                   MOVE      BKOBRU        S3OBRU
     C                   MOVE      BKOBUV        S3OBUV
     C     CEU004        IFEQ      'Y'                                                        CEU030
     C                   MOVE      BKEURO        S3EURO                                       CEU030
     C                   MOVE      BKEUCP        S3EUCP                                       CEU030
     C                   ENDIF                                                                CEU030
      * Move message format
     C                   MOVEL(P)  DWS3MF        W#MFMT
      *
      * Format Retail ICD details
     C     X1MSGT        WHENEQ    'RETL'
      *
      * Format and populate data
     C                   MOVE      BMACCD        S4ACCD
     C                   MOVE      BMRANR        S4RANR
      * Move message format
     C                   MOVEL(P)  DWS4MF        W#MFMT
      *
      * Format Customer Lending ICD details
     C     X1MSGT        WHENEQ    'CLND'
      *
      * Format and populate data
     C                   MOVE      BPBRCF        S5BRCF
     C                   MOVE      BPGEEB        S5GEEB
     C                   MOVE      BPBTIN        S5BTIN
     C                   Z-ADD     BPDBDY        S5DBDY
     C                   MOVE      BPDBKC        S5DBKC
     C                   MOVE      BPDASI        S5DASI
     C                   MOVE      BPGIAV        S5GIAV
     C                   MOVE      BPFAAU        S5FAAU
     C                   MOVE      BPFAAM        S5FAAM
     C                   MOVE      BPFAUT        S5FAUT
     C                   MOVE      BPLOAU        S5LOAU
     C                   MOVE      BPPPAU        S5PPAU
     C                   MOVE      BPPSAU        S5PSAU
     C                   MOVE      BPROAU        S5ROAU
     C                   MOVE      BPLMAU        S5LMAU
     C                   MOVE      BPMRAU        S5MRAU
     C                   MOVE      BPREAU        S5REAU
     C                   MOVE      BPTPAU        S5TPAU
     C                   MOVE      BPFEAU        S5FEAU
     C                   MOVE      BPFSAU        S5FSAU
     C                   MOVE      BPGUAU        S5GUAU
     C                   MOVE      BPCAAU        S5CAAU
     C                   MOVE      BPGRPR        S5GRPR
     C                   MOVE      BPGRIR        S5GRIR
     C                   MOVE      BPCONR        S5CONR
     C                   MOVE      BPAURV        S5AURV
     C                   MOVE      BPDRTS        S5DRTS                                       CLE023
      * Move message format
     C                   MOVEL(P)  DWS5MF        W#MFMT
      *
      * Format Portfolio Management ICD details
     C     X1MSGT        WHENEQ    'PORT'
      *
      * Format and populate data
     C                   MOVE      FCR997        S6R997
     C                   MOVE      FCN997        S6N997
     C                   MOVE      FCR998        S6R998
     C                   MOVE      FCN998        S6N998
     C                   MOVE      FCR999        S6R999
     C                   MOVE      FCN999        S6N999
     C                   MOVE      FCPORS        S6PORS
      * Move message format
     C                   MOVEL(P)  DWS6MF        W#MFMT
      *
      * Format Trading ICD details
     C     X1MSGT        WHENEQ    'TRAD'
      *
      * Format and populate data
     C                   MOVE      BLUSCY        STUSCY
      * Move message format
     C                   MOVEL(P)  DWSTMF        W#MFMT
      *
      * Format Profit Centre Accounting ICD details
     C     X1MSGT        WHENEQ    'PCAC'
      *
      * Format and populate data
     C                   MOVE      FTTFRT        SVTFRT
      * Move message format
     C                   MOVEL(P)  DWSVMF        W#MFMT
      *
      * Format Customer Details
     C     X1MSGT        WHENEQ    'CUST'
     C     BBTYLC        ANDNE     'D'
      *
     C                   MOVE      BBCUST        S7CUST
     C                   MOVE      BBCSSN        S7CSSN
     C                   MOVE      BBCNA1        S7CNA1
     C                   MOVE      BBCNA2        S7CNA2
     C                   MOVE      BBCNA3        S7CNA3
     C                   MOVE      BBCNA4        S7CNA4
     C                   MOVE      BBCRTN        S7CRTN
     C                   MOVE      BBCRNM        S7CRNM
     C                   MOVE      BBPAIN        S7PAIN
     C                   MOVE      BBLCCD        S7LCCD
     C                   MOVE      BBACOC        S7ACOC
     C                   MOVE      BBCNCZ        S7CNCZ
     C                   MOVE      BBCOLC        S7COLC
     C                   MOVE      BBCASC        S7CASC
     C                   MOVE      BBBRCD        S7BRCD
     C************       MOVE      BBBNBI        S7BNBI                                       189612
     C************       MOVE      BBSWFI        S7BNBI                                189612 211532
     C                   MOVE      BBBNBI        S7BNBI                                       211532
     C                   MOVE      BBSWFI        S7SWFI                                       211532
     C                   MOVE      BBLINC        S7LINC
     C                   MOVE      BBLICD        S7LICD
     C                   MOVE      BBCTNB        S7CTNB
     C                   MOVE      BBTAIN        S7TAIN
     C                   MOVE      BBREID        S7REID
     C                   MOVE      BBCSID        S7CSID
     C                   MOVE      BBPSWC        S7PSWC
     C                   MOVE      BBSTAD        S7STAD
     C                   MOVE      BBTXA1        S7TXA1
     C                   MOVE      BBTXA2        S7TXA2
     C                   MOVE      BBTXA3        S7TXA3
     C                   MOVE      BBTXA4        S7TXA4
     C                   MOVE      BBTXA5        S7TXA5
     C                   Z-ADD     BBCHID        S7CHID
     C                   Z-ADD     BBCHSC        S7CHSC
     C                   Z-ADD     BBCABA        S7CABA
     C                   Z-ADD     BBABA2        S7ABA2
     C                   MOVE      BBBFIC        S7BFIC
     C                   MOVE      BBBLCD        S7BLCD
     C                   Z-ADD     BBFWCD        S7FWCD
     C                   MOVE      BBLETI        S7LETI
     C                   MOVE      BBCMTI        S7CMTI
     C                   MOVE      BBGSFM        S7GSFM
     C                   MOVE      BBSTFG        S7STFG
     C                   MOVE      BBRWCD        S7RWCD
     C                   MOVE      BBMGTP        S7MGTP
     C*                                                                                       CPB003
     C** Always send this information to ensure the length of the                             CPB003
     C** message is the expected length. Note in Loan Manager will only                       CPB003
     C** populate tables with this information if the feature is on                           CPB003
     C*                                                                                       CPB003
     C                   MOVE      BBPRBA        S7PRBA                                       CPB003
      * Move message format
     C                   EVAL      W#S7MF=%SUBST(DWS7MF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#S7MF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Customer Alternative Names and Addresses
     C     X1MSGT        WHENEQ    'ALTN'
      *
     C                   MOVE      BCCUST        S8CUST
     C                   MOVE      BCADCD        S8ADCD
     C                   MOVE      BCCNA1        S8CNA1
     C                   MOVE      BCCNA2        S8CNA2
     C                   MOVE      BCCNA3        S8CNA3
     C                   MOVE      BCCNA4        S8CNA4
     C                   MOVE      BCCRTN        S8CRTN
     C                   MOVE      BCCTNB        S8CTNB
     C                   MOVE      BCTXNB        S8TXNB
     C                   MOVE      BCCNCD        S8CNCD
      * Move message format
     C                   EVAL      W#S8MF=%SUBST(DWS8MF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#S8MF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Facility Types
     C     X1MSGT        WHENEQ    'FACT'
      *
     C                   MOVE      AMFCTY        S9FCTY
     C                   MOVE      AMFCNM        S9FCNM
      * Move message format
     C                   EVAL      W#S9MF=%SUBST(DWS9MF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#S9MF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Branch Codes
     C     X1MSGT        WHENEQ    'BRCH'
      *
     C                   MOVE      A8BRCD        S0BRCD
     C                   MOVE      A8BRNM        S0BRNM
     C                   MOVE      A8BTWN        S0BTWN
     C                   MOVE      A8CMCD        S0CMCD
     C                   MOVE      A8LCCD        S0LCCD
     C                   MOVE      A8BICN        S0BICN
     C**********         Z-ADD     A8SYCU        S0SYCU                                       CSD027
     C                   EVAL      S0SYCU = A8SYCU                                            CSD027
     C                   MOVE      A8BTID        S0BTID
     C                   MOVE      A8STCD        S0STCD
     C                   MOVE      A8RDFC        S0RDFC
      * Move message format
     C                   EVAL      W#S0MF=%SUBST(DWS0MF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#S0MF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Currency Codes
     C     X1MSGT        WHENEQ    'CURR'
      *
     C                   MOVE      A6CYCD        SACYCD
     C                   MOVE      A6CYNM        SACYNM
     C                   MOVE      A6SWCY        SASWCY
     C                   MOVE      A6NBDP        SANBDP
     C                   MOVE      A6DLCI        SADLCI
      *   Spot Rate
     C                   MOVE(P)   A6SPRT        ZFIELD
     C                   Z-ADD     8             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        SASPRT
      *
     C                   MOVE      A6MDIN        SAMDIN
     C                   MOVE      A6DICB        SADICB
     C                   MOVE      A6TXND        SATXND
     C                   MOVE      A6RDFC        SARDFC
     C     CEU004        IFEQ      'Y'                                                        CEU030
     C                   MOVE      A6INCY        SAINCY                                       CEU030
      *   Euro Rate                                                                           CEU030
     C                   MOVE(P)   A6EUER        ZFIELD                                       CEU030
     C                   Z-ADD     8             ZADEC                                        CEU030
     C                   EXSR      ZEDIT                                                      CEU030
     C                   MOVE      ZFIELD        SAEUER                                       CEU030
      *                                                                                       CEU030
     C                   MOVE      A6EUMD        SAEUMD                                       CEU030
      * Euro Transition Period Start Date                                                     CEU030
     C                   Z-ADD     A6TPSD        W#ZDAYN                                      CEU030
     C                   EXSR      ZZA0140                                                    CEU030
     C                   MOVEL     W#ZDATE8      SATPSD                                       CEU030
      * Euro Transition Period End Date                                                       CEU030
     C                   Z-ADD     A6TPED        W#ZDAYN                                      CEU030
     C                   EXSR      ZZA0140                                                    CEU030
     C                   MOVEL     W#ZDATE8      SATPED                                       CEU030
     C                   ENDIF                                                                CEU030
      * Move message format
     C                   EVAL      W#SAMF=%SUBST(DWSAMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SAMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Country Codes
     C     X1MSGT        WHENEQ    'CTRY'
      *
     C                   MOVE      A4CNCD        SBCNCD
     C                   MOVE      A4CNNM        SBCNNM
     C                   MOVE      A4ISOC        SBISOC
     C                   MOVE      A4RGCD        SBRGCD
      * Move message format
     C                   EVAL      W#SBMF=%SUBST(DWSBMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SBMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Fee Codes
     C     X1MSGT        WHENEQ    'FEEC'
      *
     C*****                                                                                   128762
     C*****              SELECT                                                               128762
     C*****AUFECD        WHENEQ    '01'                                                       128762
     C                   MOVE      AUFECD        SXCD01
     C                   MOVE      AUFENV        SXNV01
     C*****AUFECD        WHENEQ    '02'                                                       128762
     C*****              MOVE      AUFECD        SXCD02                                       128762
     C*****              MOVE      AUFENV        SXNV02                                       128762
     C*****AUFECD        WHENEQ    '03'                                                       128762
     C*****              MOVE      AUFECD        SXCD03                                       128762
     C*****              MOVE      AUFENV        SXNV03                                       128762
     C*****AUFECD        WHENEQ    '04'                                                       128762
     C*****              MOVE      AUFECD        SXCD04                                       128762
     C*****              MOVE      AUFENV        SXNV04                                       128762
     C*****AUFECD        WHENEQ    '05'                                                       128762
     C*****              MOVE      AUFECD        SXCD05                                       128762
     C*****              MOVE      AUFENV        SXNV05                                       128762
     C*****AUFECD        WHENEQ    '06'                                                       128762
     C*****              MOVE      AUFECD        SXCD06                                       128762
     C*****              MOVE      AUFENV        SXNV06                                       128762
     C*****AUFECD        WHENEQ    '07'                                                       128762
     C*****              MOVE      AUFECD        SXCD07                                       128762
     C*****              MOVE      AUFENV        SXNV07                                       128762
     C*****AUFECD        WHENEQ    '08'                                                       128762
     C*****              MOVE      AUFECD        SXCD08                                       128762
     C*****              MOVE      AUFENV        SXNV08                                       128762
     C*****AUFECD        WHENEQ    '09'                                                       128762
     C*****              MOVE      AUFECD        SXCD09                                       128762
     C*****              MOVE      AUFENV        SXNV09                                       128762
     C*****AUFECD        WHENEQ    '10'                                                       128762
     C*****              MOVE      AUFECD        SXCD10                                       128762
     C*****              MOVE      AUFENV        SXNV10                                       128762
     C*****              ENDSL                                                                128762
      * Move message format
     C                   EVAL      W#SXMF=%SUBST(DWSXMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SXMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Industry Codes
     C     X1MSGT        WHENEQ    'INDS'
      *
     C                   MOVE      AOLICD        SCLICD
     C                   MOVE      AOLINA        SCLINA
      * Move message format
     C                   EVAL      W#SCMF=%SUBST(DWSCMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SCMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Account Officer Codes
     C     X1MSGT        WHENEQ    'ACOF'
      *
     C                   MOVE      AZACOC        SDACOC
     C                   MOVE      AZACON        SDACON
     C                   MOVE      AZDPCD        SDDPCD
     C                   MOVE      AZAPHN        SDAPHN
     C                   MOVE      AZAEXT        SDAEXT
      * Move message format
     C                   EVAL      W#SDMF=%SUBST(DWSDMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SDMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Profit Centre Matrix Details
     C     X1MSGT        WHENEQ    'PRFM'
      *
     C                   MOVE      DWPCCD        SEPCCD
     C                   MOVE      DWBKCD        SEBKCD
     C                   MOVE      DWPCTT        SEPCTT
     C                   MOVE      DWSBTY        SESBTY
     C                   MOVE      DWBRCD        SEBRCD
     C                   MOVE      DWDPCD        SEDPCD
     C                   MOVE      DWUSID        SEUSID
     C                   MOVE      DWACOC        SEACOC
     C                   MOVE      DWCUST        SECUST
      * Move message format
     C                   EVAL      W#SEMF=%SUBST(DWSEMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SEMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Profit Centres
     C     X1MSGT        WHENEQ    'PRFC'
      *
     C                   MOVE      DSPCCD        SFPCCD
     C                   MOVE      DSPCDS        SFPCDS
     C                   MOVE      DSDFPR        SFDFPR
     C                   MOVE      DSLFPC        SFLFPC
     C                   MOVE      DSFFPC        SFFFPC
      * Move message format
     C                   EVAL      W#SFMF=%SUBST(DWSFMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SFMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Book Codes
     C     X1MSGT        WHENEQ    'BOOK'
      *
     C                   MOVE      BDBKCD        SGBKCD
     C                   MOVE      BDBKD         SGBKD
     C                   MOVE      BDASPR        SGASPR
      * Move message format
     C                   EVAL      W#SGMF=%SUBST(DWSGMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SGMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Loan Types/Sub-types
     C     X1MSGT        WHENEQ    'LTST'
      *
     C                   MOVE      AYLNTY        SHLNTY
     C                   MOVE      AYLNST        SHLNST
     C                   MOVE      AYLNTD        SHLNTD
     C                   MOVE      AYLNPT        SHLNPT
     C                   MOVE      AYILTY        SHILTY
     C                   MOVE      AYILST        SHILST
      * Move message format
     C                   EVAL      W#SHMF=%SUBST(DWSHMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SHMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Base Rate Codes
     C     X1MSGT        WHENEQ    'BSRT'
      *
     C                   MOVE      BACYCD        SICYCD
     C                   MOVE      BABSRC        SIBSRC
     C                   MOVE      BABSRN        SIBSRN
      *   Current Base Rate
     C                   MOVE(P)   BACBSR        ZFIELD
     C                   Z-ADD     7             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        SICBSR
      *   Value Date of Rate Change
     C                   Z-ADD     BAVDRC        W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#ZDATE8      SIVDRC
      *   New Base Rate
     C                   MOVE(P)   BANBRT        ZFIELD
     C                   Z-ADD     7             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        SINBRT
      *   Value Date for New Rate
     C                   Z-ADD     BAVDNR        W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#ZDATE8      SIVDNR
      * Move message format
     C                   EVAL      W#SIMF=%SUBST(DWSIMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SIMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Base Rate History
     C     X1MSGT        WHENEQ    'BSHS'
      *
     C                   MOVE      G0CYCD        SJCYCD
     C                   Z-ADD     G0BSRC        SJBSRC
      *   History Date
     C                   Z-ADD     G0HIDT        W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#ZDATE8      SJHIDT
      *   Base Rate
     C                   MOVE(P)   G0CBSR        ZFIELD
     C                   Z-ADD     7             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        SJCBSR
      * Move message format
     C                   EVAL      W#SJMF=%SUBST(DWSJMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SJMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Nostro Codes
     C     X1MSGT        WHENEQ    'NOST'
      *
     C                   MOVE      A7CYCD        SKCYCD
     C                   MOVE      A7NONB        SKNONB
     C                   MOVE      A7NOSN        SKNOSN
     C                   MOVE      A7BRCD        SKBRCD
     C                   MOVE      A7CUST        SKCUST
     C                   MOVE      A7ACCD        SKACCD
     C                   MOVE      A7ACSN        SKACSN
     C                   MOVE      A7PNOI        SKPNOI
     C*****              MOVE      A7OANN        SKOANN                                       210796
     C                   MOVE      A7OACN        SKOANN                                       210796
     C                   MOVE      A7ORAC        SKORAC
      * Move message format
     C                   EVAL      W#SKMF=%SUBST(DWSKMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SKMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Counterparty Nostro Codes
     C     X1MSGT        WHENEQ    'CNST'
      *
     C                   MOVE      AWCPNC        SLCPNC
     C                   MOVE      AWCPNM        SLCPNM
     C                   MOVE      AWCNTN        SLCNTN
      *   Customer Shortname
     C                   MOVEL     AWCSN1        SLCSN1
     C                   MOVE      AWCSN2        SLCSN1
      *
     C                   Z-ADD     AWCABA        SLCABA
     C                   MOVE      AWSWID        SLSWID
     C                   Z-ADD     AWCUID        SLCUID
     C                   Z-ADD     AWCHSC        SLCHSC
     C                   MOVE      AWBOJC        SLBOJC
     C                   MOVE      AWBACD        SLBACD
     C                   Z-ADD     AWFWCD        SLFWCD
     C                   MOVE      AWTXA1        SLTXA1
     C                   MOVE      AWSTAD        SLSTAD
      *
      * Move message format
     C                   EVAL      W#SLMF=%SUBST(DWSLMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SLMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Accounts
     C     X1MSGT        WHENEQ    'ACNT'
      *
     C                   MOVE      BRCA          SMBRCA
     C                   MOVE      CNUM          SMCNUM
     C                   MOVE      CCY           SMCCY
     C                   MOVE      ACOD          SMACOD
     C                   MOVE      ACSQ          SMACSQ
     C                   MOVE      ANAM          SMANAM
     C                   Z-ADD     ACNO          SMACNO
     C                   MOVE      RECI          SMRECI
     C                   MOVE      ATYP          SMATYP
     C                   MOVE      ACST          SMACST
      *   Date of Account Opening
     C                   Z-ADD     DACO          W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#ZDATE8      SMDACO
      *   Blocked Debit Indicator
     C                   TESTB     '2'           RETB                     85
     C                   MOVEL     'N'           SMBLDI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           SMBLDI
     C                   ENDIF
     C*   Blocked Credit Indicator
     C                   TESTB     '3'           RETB                     85
     C                   MOVEL     'N'           SMBLCI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           SMBLCI
     C                   ENDIF
      * Move message format
     C                   EVAL      W#SMMF=%SUBST(DWSMMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SMMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Extended Settlements
     C     X1MSGT        WHENEQ    'EXST'
      *
     C                   MOVE      BYCYCD        SNCYCD
     C                   MOVE      BYCUST        SNCUST
     C                   MOVE      BYTRTY        SNTRTY
     C                   MOVE      BYPSTY        SNPSTY
      *   Pay-Our Nostro
     C                   EVAL      SNPONO=       BYOPBR+BYPONO
     C                   MOVE      BYRCNB        SNRCNB
     C                   MOVE      BYCVMR        SNCVMR
     C                   MOVE      BYPOCS        SNPOCS
     C                   MOVE      BYPOBN        SNPOBN
     C                   MOVE      BYRCNO        SNRCNO
     C                   MOVE      BYRCAL        SNRCAL
     C                   MOVE      BYPIBN        SNPIBN
     C                   MOVE      BYPIBA        SNPIBA
     C                   MOVE      BYACBN        SNACBN
     C                   MOVE      BYACBL        SNACBL
     C                   MOVE      BYBYNB        SNBYNB
     C                   MOVE      BYBACL        SNBACL
     C                   MOVE      BYRSTY        SNRSTY
      *   Receipt-Our Nostro
     C                   EVAL      SNRONO=       BYORBR+BYRONO
     C                   MOVE      BYROCS        SNROCS
     C                   MOVE      BYROBN        SNROBN
     C                   MOVE      BYRIBN        SNRIBN
     C                   MOVE      BYRIBL        SNRIBL
     C                   EVAL      SNDPY1=       BYDPY1 +
     C                                           BYDPY2 +
     C                                           BYDPY3 +
     C                                           BYDPY4
     C                   MOVE      BYDECG        SNDECG
     C                   EVAL      SNBBI1=       BYBBI1 +
     C                                           BYBBI2 +
     C                                           BYBBI3 +
     C                                           BYBBI4 +
     C                                           BYBBI5 +
     C                                           BYBBI6
     C     CEU004        IFEQ      'Y'                                                        CEU030
     C                   MOVE      BYSTCY        SNSTCY                                       CEU030
     C                   MOVE      BYIERI        SNIERI                                       CEU030
     C                   ENDIF                                                                CEU030
      * Move message format
     C                   EVAL      W#SNMF=%SUBST(DWSNMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SNMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Portfolio Refences
     C     X1MSGT        WHENEQ    'PORR'
      *
     C                   MOVE      PNCNUM        SOCNUM
     C                   MOVE      PNPTFR        SOPTFR
     C                   MOVE      PNPTFN        SOPTFN
      *   Portfolio closed?
     C                   MOVE      PNRECI        SORECI
     C     PNDPCL        IFGT      *ZERO
     C                   MOVE      'C'           SORECI
     C                   ENDIF
      *   Date Portfolio Opened
     C                   Z-ADD     PNDPOP        W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#ZDATE8      SODPOP
      * Move message format
     C                   EVAL      W#SOMF=%SUBST(DWSOMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SOMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Portfolio Customers
     C     X1MSGT        WHENEQ    'PLCS'
      *
     C                   MOVE      QBCUST        SPCUST
     C                   MOVE      QBDFPO        SPDFPO
     C                   MOVE      QBRECI        SPRECI
      * Move message format
     C                   EVAL      W#SPMF=%SUBST(DWSPMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SPMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Holidays
     C     X1MSGT        WHENEQ    'HOLS'
      *
     C                   MOVE      DGCYCD        SQCYCD
     C                   MOVE      DGLCCD        SQLCCD
     C                   MOVE      DGYRNB        SQYRNB
      *   Holiday Indicators
     C                   EVAL      SQHOLD=%SUBST(SDHOL:17:366)
      * Move message format
     C                   EVAL      W#SQMF=%SUBST(DWSQMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SQMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format SWIFT Codewords
     C     X1MSGT        WHENEQ    'CODE'
      *
     C                   MOVE      FYSWCD        SRSWCD
     C                   MOVE      FYCDES        SRCDES
     C                   MOVE      FYMMID        SRMMID
     C                   MOVE      FYSMTP        SRSMTP
     C                   MOVE      FYDCUS        SRDCUS
      * Move message format
     C                   EVAL      W#SRMF=%SUBST(DWSRMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SRMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Switchable Features
     C     X1MSGT        WHENEQ    'SARD'
      *
     C                   MOVE      ABSARN        SSSARN
     C                   MOVE      ABSARD        SSSARD
      * Move message format
     C                   EVAL      W#SSMF=%SUBST(DWSSMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SSMF
     C                   ADD       W#BTML        W#MPOS
      *                                                                         CLE031
      * Format System values                                                    CLE031
     C     X1MSGT        WHENEQ    'SVAL'                                       CLE031
      *                                                                         CLE031
      * Format and populate data                                                CLE031
     C**********         MOVE      GISVAL        SYSVAL                         CLE031      MD054605
     C**********         MOVE      GIVAL         SYCSET                         CLE031      MD054605
     C                   MOVE      XGISVAL       SYSVAL                                     MD054605
     C                   MOVE      XGIVAL        SYCSET                                     MD054605
      *                                                                         CLE033
      * If CLE033 is on and system value = 'Settlement09AccCode',               CLE033
      * check whether the current setting is a retail account code or           CLE033
      * GL account code                                                         CLE033
     C                   IF        CLE033 = 'Y'                                 CLE033
     C                             AND SYSVAL = 'Settlement09AccCode'           CLE033
     C                   EVAL      @ACOD = SYCSET                               CLE033
      *                                                                         CLE033
      * Access Account Code details                                             CLE033
     C                   CALLB     'AOACODR0'                                   CLE033
     C                   PARM      *BLANKS       @RTCD             7            CLE033
     C                   PARM      '*KEY   '     @OPTN             7            CLE033
     C                   PARM                    @ACOD             4            CLE033
     C     SDACOD        PARM      SDACOD        DSFDY                          CLE033
      *                                                                         CLE033
      * Not Found Error                                                         CLE033
     C     @RTCD         IFNE      *BLANKS                                      CLE033
     C                   MOVEL     @ACOD         DBKEY                          CLE033
     C                   MOVEL     'SDACODPD'    DBFILE                         CLE033
     C                   Z-ADD     87            DBASE                          CLE033
     C                   EXSR      *PSSR                                        CLE033
     C                   ENDIF                                                  CLE033
      *                                                                         CLE033
      * Put account type at the end of account code in the current              CLE033
      * setting field                                                           CLE033
     C                   EVAL      %SUBST(SYCSET:5:1)=A5ACTY                    CLE033
     C                   ENDIF                                                  CLE033
      *                                                                         CLE033
      * Move message format                                                     CLE031
     C                   EVAL      W#SYMF=%SUBST(DWSYMF:91:W#BTML)              CLE031
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SYMF          CLE031
     C                   ADD       W#BTML        W#MPOS                         CLE031
      *
      * Format Currency Clearing System
     C     X1MSGT        WHENEQ    'CCSY'
      *
     C                   MOVE      DPCYCD        SUCYCD
     C                   MOVE      DPCLSY        SUCLSY
      * Move message format
     C                   EVAL      W#SUMF=%SUBST(DWSUMF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#SUMF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Facilities
     C     X1MSGT        WHENEQ    'DLFC'
      *                                                                                       210749
      * Check that all associated facilities are present in the d/b                           210749
     C                   EXSR      CHKFCLTY                                                   210749
     C     FCLTYOK       IFEQ      'Y'                                                        210749
      *
      * Access Currency Codes for decimal places
     C                   MOVE      F#FFCCY       W#CCY
     C                   EXSR      GETNBDP
      *
     C                   MOVE      F#FCNUM       L0CNUM
     C                   MOVE      F#FFACT       L0FACT
     C                   MOVE      F#FFCNO       L0FCNO
     C                   MOVE      F#FBRCA       L0BRCA
     C                   MOVE      F#FORBR       L0ORBR
     C                   MOVE      F#FFCTI       L0FCTI
     C                   MOVE      F#FFCCY       L0FCCY
      *                                                                                       CLE008
      * Loan Administrator Id                                                                 CLE008
     C                   MOVE      F#FLAID       L0LAID                                       CLE008
      *                                                                                       CLE008
      * Assignment/Participation Indicator                                                    147261
     C                   MOVE      F#FPASI       L0PASI                                       147261
      *                                                                                       147261
      *   Facility Amount
     C                   MOVE(P)   F#FFAMT       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0FAMT
      *   Overline Percentage
     C                   MOVE(P)   F#FOVPC       ZFIELD
     C*****              Z-ADD     2             ZADEC
     C                   Z-ADD     3             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0OVPC
      *   Date Approved
     C                   Z-ADD     F#FDTAP       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L0DTAP
     C                   MOVEL     W#DATE8       L0DTAP
      *   Expiry Date
     C                   Z-ADD     F#FDTEX       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L0DTEX
     C                   MOVEL     W#DATE8       L0DTEX
      *
     C                   MOVE      F#FRVCR       L0RVCR
     C                   MOVE      F#FSECI       L0SECI
     C                   MOVE      F#FMCCY       L0MCCY
     C                   MOVE      F#FMCSI       L0MCSI
     C                   MOVE      F#FMBFC       L0MBFC
     C                   MOVE      F#FNACD       L0NACD
     C                   MOVE      F#FCRSK       L0CRSK
      *   Date of last financial statement
     C                   Z-ADD     F#FDLFS       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L0DLFS
     C                   MOVEL     W#DATE8       L0DLFS
      *   Nominal Rate
     C                   MOVE(P)   F#FNOMR       ZFIELD
     C                   Z-ADD     7             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0NOMR
      *   Review Date
     C                   Z-ADD     F#FRVDT       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L0RVDT
     C                   MOVEL     W#DATE8       L0RVDT
      *
     C                   MOVE      F#FRVFR       L0RVFR
      *
     C     F#FRVDY       IFNE      *ZEROS
     C                   MOVE      F#FRVDY       L0RVDY
     C                   ELSE
     C                   MOVE      *BLANKS       L0RVDY
     C                   ENDIF
      *   Narrative
     C                   EVAL      L0NAR1=       F#FNAR1 +
     C                                           F#FNAR2 +
     C                                           F#FNAR3 +
     C                                           F#FNAR4
      *
     C                   MOVE      F#FACOF       L0ACOF
     C                   MOVE      F#FPRFC       L0PRFC
     C                   MOVE      F#FBTIN       L0BTIN
      *
     C     F#FBLDY       IFNE      *ZEROS
     C                   MOVE      F#FBLDY       L0BLDY
     C                   ELSE
     C                   MOVE      *BLANKS       L0BLDY
     C                   ENDIF
      *
     C                   MOVE      F#FSYIN       L0SYIN
      *
     C*****F#FANUM       IFNE      *ZEROS                                                     CSD027
     C     F#FANUM       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#FANUM       L0ANUM
     C                   ELSE
     C                   MOVE      *BLANKS       L0ANUM
     C                   ENDIF
      *
     C                   MOVE      F#FDTPS       L0DTPS
      *                                                                                       CLE028
     C                   IF        CLE028 = 'Y'                                               CLE028
     C                   EVAL      L0DTPX = F#FDTPX                                           CLE028
     C                   ENDIF                                                                CLE028
      *                                                                                       CLE028
     C                   MOVE      F#FRTPS       L0RTPS
      *
     C     F#FRLPD       IFNE      *ZEROS
     C                   MOVE      F#FRLPD       L0RLPD
     C                   ELSE
     C                   MOVE      *BLANKS       L0RLPD
     C                   ENDIF
      *
     C                   MOVE      F#FDICB       L0DICB
     C                   MOVE      F#FCSEL       L0CSEL
     C                   MOVE      F#FALCY       L0ALCY
      *   Date Committed
     C                   Z-ADD     F#FCOMD       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L0COMD
     C                   MOVEL     W#DATE8       L0COMD
      *   Closing Date
     C                   Z-ADD     F#FCDTE       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L0CDTE
     C                   MOVEL     W#DATE8       L0CDTE
      *   Last Available Date
     C                   Z-ADD     F#FAVLD       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L0AVLD
     C                   MOVEL     W#DATE8       L0AVLD
      *
     C                   MOVE      F#FLPTP       L0LPTP
      *
     C     F#FLPBR       IFNE      *ZEROS
     C                   MOVE      F#FLPBR       L0LPBR
     C                   ELSE
     C                   MOVE      *BLANKS       L0LPBR
     C                   ENDIF
      *
      *   Late Payment Penalty Amount
     C                   MOVE(P)   F#FLPAM       ZFIELD
     C     L0LPTP        IFEQ      'A'
     C                   Z-ADD     A6NBDP        ZADEC
     C                   ELSE
     C                   Z-ADD     7             ZADEC
     C                   ENDIF
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0LPAM
      *
     C                   MOVE      F#FLPPS       L0LPPS
     C                   MOVE      F#FDFTP       L0DFTP
     C                   MOVE      F#FDFST       L0DFST
     C                   MOVE      F#FTRCA       L0TRCA
      *
     C*****F#FCANM       IFNE      *ZEROS                                                     CSD027
     C     F#FCANM       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#FCANM       L0CANM
     C                   ELSE
     C                   MOVE      *BLANKS       L0CANM
     C                   ENDIF
      *
     C     F#FCAFT       IFNE      *ZEROS
     C                   MOVE      F#FCAFT       L0CAFT
     C                   ELSE
     C                   MOVE      *BLANKS       L0CAFT
     C                   ENDIF
      *
     C     F#FCAFN       IFNE      *ZEROS
     C                   MOVE      F#FCAFN       L0CAFN
     C                   ELSE
     C                   MOVE      *BLANKS       L0CAFN
     C                   ENDIF
      *
     C     F#FACSQ       IFNE      *ZEROS
     C                   MOVE      F#FACSQ       L0ACSQ
     C                   ELSE
     C                   MOVE      *BLANKS       L0ACSQ
     C                   ENDIF
      *
     C                   MOVE      F#FIUSR       L0IUSR
     C                   MOVE      F#FAUSR       L0AUSR
     C                   MOVE      F#FXUSR       L0XUSR
     C                   MOVE      F#FSYCP       L0SYCP
     C                   MOVE      F#FPRTR       L0PRTR
      *
     C*****F#FPMFC       IFNE      *ZEROS                                                     CSD027
     C     F#FPMFC       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#FPMFC       L0PMFC
     C                   ELSE
     C                   MOVE      *BLANKS       L0PMFC
     C                   ENDIF
      *
     C     F#FPMFT       IFNE      *ZEROS
     C                   MOVE      F#FPMFT       L0PMFT
     C                   ELSE
     C                   MOVE      *BLANKS       L0PMFT
     C                   ENDIF
      *
     C     F#FPMFN       IFNE      *ZEROS
     C                   MOVE      F#FPMFN       L0PMFN
     C                   ELSE
     C                   MOVE      *BLANKS       L0PMFN
     C                   ENDIF
      *
     C*****F#FINUM       IFNE      *ZEROS                                                     CSD027
     C     F#FINUM       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#FINUM       L0INUM
     C                   ELSE
     C                   MOVE      *BLANKS       L0INUM
     C                   ENDIF
      *   Joining Date
     C                   Z-ADD     F#FJDTE       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L0JDTE
     C                   MOVEL     W#DATE8       L0JDTE
      *   Value Date of This Change
     C                   Z-ADD     F#FVDTC       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L0VDTC
     C                   MOVEL     W#DATE8       L0VDTC
      *
     C                   MOVE      F#FSHTP       L0SHTP
      *   Share Percentage
     C                   MOVE(P)   F#FSHPC       ZFIELD
     C                   Z-ADD     12            ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0SHPC
      *
     C                   MOVE      F#FRCSI       L0RCSI
     C                   MOVE      F#FSKIS       L0SKIS
      *   Skim Interest Rate
     C                   MOVE(P)   F#FSKIR       ZFIELD
     C                   Z-ADD     7             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0SKIR
      *
     C                   MOVE      F#FSKFS       L0SKFS
      *   Skim Fees Rate
     C                   MOVE(P)   F#FSKFR       ZFIELD
     C                   Z-ADD     7             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0SKFR
      *
     C     F#FPSTM       IFNE      *ZEROS
     C                   MOVE      F#FPSTM       L0PSTM
     C                   ELSE
     C                   MOVE      *BLANKS       L0PSTM
     C                   ENDIF
      *
      *   Pay Our Nostro
     C                   EVAL      L0PONS=       F#FOMDB+F#FPONS
      *
     C                   MOVE      F#FRVNO       L0RVNO
     C                   MOVE      F#FCVMR       L0CVMR
      *
     C*****F#FPOCN       IFNE      *ZEROS                                                     CSD027
     C     F#FPOCN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#FPOCN       L0POCN
     C                   ELSE
     C                   MOVE      *BLANKS       L0POCN
     C                   ENDIF
      *
     C*****F#FPOBN       IFNE      *ZEROS                                                     CSD027
     C     F#FPOBN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#FPOBN       L0POBN
     C                   ELSE
     C                   MOVE      *BLANKS       L0POBN
     C                   ENDIF
      *
     C                   MOVE      F#FRCRN       L0RCRN
     C                   MOVE      F#FRCRA       L0RCRA
     C                   MOVE      F#FPIBN       L0PIBN
     C                   MOVE      F#FPIBA       L0PIBA
     C                   MOVE      F#FAWBN       L0AWBN
     C                   MOVE      F#FAWBA       L0AWBA
     C                   MOVE      F#FBENN       L0BENN
     C                   MOVE      F#FBENA       L0BENA
      *
     C     F#FRSTM       IFNE      *ZEROS
     C                   MOVE      F#FRSTM       L0RSTM
     C                   ELSE
     C                   MOVE      *BLANKS       L0RSTM
     C                   ENDIF
      *
      *   Receive Our Nostro
     C                   EVAL      L0RONS=       F#FOSDB+F#FRONS
      *
     C*****F#FROCN       IFNE      *ZEROS                                                     CSD027
     C     F#FROCN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#FROCN       L0ROCN
     C                   ELSE
     C                   MOVE      *BLANKS       L0ROCN
     C                   ENDIF
      *
     C*****F#FROBN       IFNE      *ZEROS                                                     CSD027
     C     F#FROBN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#FROBN       L0ROBN
     C                   ELSE
     C                   MOVE      *BLANKS       L0ROBN
     C                   ENDIF
      *
     C                   MOVE      F#FRIBN       L0RIBN
     C                   MOVE      F#FRIBA       L0RIBA
      *   Details of Payments
     C                   EVAL      L0DTP1=       F#FDTP1 +
     C                                           F#FDTP2 +
     C                                           F#FDTP3 +
     C                                           F#FDTP4
      *
     C                   MOVE      F#FDCHG       L0DCHG
      *   Bank to Bank Information
     C                   EVAL      L0BTB1=       F#FBTB1 +
     C                                           F#FBTB2 +
     C                                           F#FBTB3 +
     C                                           F#FBTB4 +
     C                                           F#FBTB5 +
     C                                           F#FBTB6
      *
     C                   MOVE      F#FRECI       L0RECI
      *   Revolving Credit Indicator Last Change Date
     C                   Z-ADD     F#FRVCD       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L0RVCD
     C                   MOVEL     W#DATE8       L0RVCD
      *   Total Amount Drawn
     C                   MOVE(P)   F#FTOTD       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0TOTD
      *   Current Exposure
     C                   MOVE(P)   F#FCAMD       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0CAMD
      *   Previous Exposure
     C                   MOVE(P)   F#FPEXP       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0PEXP
      *   Drawn Amount Day 1
     C                   MOVE(P)   F#FOAM1       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0OAM1
      *   Drawn Amount Day 2
     C                   MOVE(P)   F#FOAM2       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0OAM2
      *   Drawn Amount Day 3
     C                   MOVE(P)   F#FOAM3       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0OAM3
      *   Drawn Amount Day 4
     C                   MOVE(P)   F#FOAM4       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0OAM4
      *   Drawn Amount Day 5
     C                   MOVE(P)   F#FOAM5       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0OAM5
      *   Drawn Amount Day 6
     C                   MOVE(P)   F#FOAM6       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0OAM6
      *   Drawn Amount Day 7
     C                   MOVE(P)   F#FOAM7       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0OAM7
      *   Drawn Amount Day 8
     C                   MOVE(P)   F#FOAM8       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0OAM8
      *   Drawn Amount Day 9
     C                   MOVE(P)   F#FOAM9       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0OAM9
      *   Drawn Amount Day 10
     C                   MOVE(P)   F#FOA10       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L0OA10
      *
     C                   MOVE      F#FFSTS       L0FSTS
     C                   MOVE      F#FPCRF       L0PCRF
      *                                                                                       130237
     C                   MOVE      F#FCMDI       L0CMDI                                       130237
      *                                                                                       130237
     C     F#FCAXR       IFNE      *ZEROS                                                     130237
     C*****              MOVE      F#FCAXR       L0CAXR                                 130237133384
     C                   MOVE(P)   F#FCAXR       ZFIELD                                       133384
     C                   Z-ADD     8             ZADEC                                        133384
     C                   EXSR      ZEDIT                                                      133384
     C                   MOVE      ZFIELD        L0CAXR                                       133384
     C                   ELSE                                                                 130237
     C                   MOVE      *BLANKS       L0CAXR                                       130237
     C                   ENDIF                                                                130237
      *                                                                                       130237
     C     CEU004        IFEQ      'Y'                                                        CEU030
     C                   MOVE      F#FSCCY       L0SCCY                                       CEU030
     C                   MOVE      F#FICCY       L0ICCY                                       CEU030
     C                   ENDIF                                                                CEU030
      *                                                                                       CLE023
     C                   IF        CLE023 = 'Y'                                               CLE023
     C                   MOVE(P)   F#FCEXP       ZFIELD                                       CLE023
     C                   Z-ADD     A6NBDP        ZADEC                                        CLE023
     C                   EXSR      ZEDIT                                                      CLE023
     C                   MOVE      ZFIELD        L0CEXP                                       CLE023
     C                   ENDIF                                                                CLE023
      *                                                                                       CLE031
     C                   IF        CLE031 = 'Y'                                               CLE031
      *                                                                                       CLE031
      * Co-Agent                                                                              CLE031
     C                   EVAL      L0COAG = F#FCOAG                                           CLE031
      *                                                                                       CLE031
      * Facility Agent                                                                        CLE031
     C                   EVAL      L0FCAG = F#FFCAG                                           CLE031
      *                                                                                       CLE031
      * Paying/Handling agent                                                                 CLE031
     C                   EVAL      L0PHAG = F#FPHAG                                           CLE031
      *                                                                                       CLE031
      * Security Agent                                                                        CLE031
     C                   EVAL      L0SCAG = F#FSCAG                                           CLE031
      *                                                                                       CLE031
      * (Receive) Settlement Currency                                                         CLE031
     C                   EVAL      L0SCCY = F#FSCCY                                           CLE031
      *                                                                                       CLE031
      * Receive Settlement Ccy. Exchange Rate                                                 CLE031
     C                   Z-ADD     8             ZADEC                                        CLE031
     C                   MOVE      *BLANKS       ZFIELD                                       CLE031
     C                   MOVE      F#FREXR       ZFIELD                                       CLE031
     C                   EXSR      ZEDIT                                                      CLE031
     C                   MOVE      ZFIELD        L0REXR                                       CLE031
      *                                                                                       CLE031
      * Receive Settlement Ccy. Exchange Rate Indicator                                       CLE031
     C                   EVAL      L0REXI = F#FREXI                                           CLE031
      *                                                                                       CLE031
      * Pay Settlement Currency                                                               CLE031
     C                   EVAL      L0PSCY = F#FPSCY                                           CLE031
      *                                                                                       CLE031
      * Pay Settlement Ccy. Exchange Rate                                                     CLE031
     C                   Z-ADD     8             ZADEC                                        CLE031
     C                   MOVE      *BLANKS       ZFIELD                                       CLE031
     C                   MOVE      F#FPEXR       ZFIELD                                       CLE031
     C                   EXSR      ZEDIT                                                      CLE031
     C                   MOVE      ZFIELD        L0PEXR                                       CLE031
      *                                                                                       CLE031
      * Pay Settlement Ccy. Exchange Rate Indicator                                           CLE031
     C                   EVAL      L0PEXI = F#FPEXI                                           CLE031
     C                   ENDIF                                                                CLE031
                                                                                              CLE034
     C                   IF        CLE034 = 'Y'                                               CLE034
     C                   MOVE      F#FOVAM       ZFIELD                                       CLE034
     C                   Z-ADD     A6NBDP        ZADEC                                        CLE034
     C                   EXSR      ZEDIT                                                      CLE034
     C                   MOVE      ZFIELD        L0OVAM                                       CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
      *                                                                                       CEU030
      * Move message format
     C                   EVAL      W#L0MF=%SUBST(DWL0MF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#L0MF
     C                   ADD       W#BTML        W#MPOS
     C                   ENDIF                                                                210749
      *
      * Format Loans
     C     X1MSGT        WHENEQ    'DLLN'
      *                                                                                       210696
      * Check that all associated facilities are present in the d/b                           210696
     C                   EXSR      CHKLOAN                                                    210696
     C     LOANOK        IFEQ      'Y'                                                        210696
      *                                                                                       210696
      * Access Currency Codes for decimal places for Loan Currency
     C                   MOVE      F#LCCY        W#CCY
     C                   EXSR      GETNBDP
     C                   MOVE      A6NBDP        W#CCYDP
      * Access Currency Codes for decimal places for Facility Currency
     C                   MOVE      F#LFCCY       W#CCY
     C                   EXSR      GETNBDP
     C                   MOVE      A6NBDP        W#FCCYDP
      * New Currency?
      * Access Currency Codes for decimal places for New Currency
     C     F#LNCCY       IFNE      *BLANKS
     C                   MOVE      F#LNCCY       W#CCY
     C                   EXSR      GETNBDP
     C                   MOVE      A6NBDP        W#NCCYDP
     C                   ENDIF
      * Access Currency Codes for decimal places for Local Currency
     C                   MOVE      BJLCCY        W#CCY
     C                   EXSR      GETNBDP
     C                   MOVE      A6NBDP        W#LCCYDP
      *
     C                   MOVE      F#LLNRF       L1LNRF
     C                   MOVE      F#LCNUM       L1CNUM
     C                   MOVE      F#LBRCA       L1BRCA
     C                   MOVE      F#LORBR       L1ORBR
     C                   MOVE      F#LLTYP       L1LTYP
     C                   MOVE      F#LSUTP       L1SUTP
      *   Deal Date
     C                   Z-ADD     F#LDDAT       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L1DDAT
     C                   MOVEL     W#DATE8       L1DDAT
      *   Value Date
     C                   Z-ADD     F#LVDAT       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L1VDAT
     C                   MOVEL     W#DATE8       L1VDAT
      *   Maturity Date
     C                   Z-ADD     F#LMDAT       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L1MDAT
     C                   MOVEL     W#DATE8       L1MDAT
      *
     C                   MOVE      F#LFCUS       L1FCUS
     C                   MOVE      F#LFTYP       L1FTYP
     C                   MOVE      F#LFSEQ       L1FSEQ
     C                   MOVE      F#LCCY        L1CCY
      *   Loan Amount
     C                   MOVE(P)   F#LCPAM       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1CPAM
      *
     C                   MOVE      F#LAUTO       L1AUTO
     C                   MOVE      F#LAPMI       L1APMI
     C                   MOVE      F#LBOKC       L1BOKC
     C                   MOVE      F#LPTFR       L1PTFR
     C                   MOVE      F#LPRFC       L1PRFC
     C                   MOVE      F#LLASQ       L1LASQ
     C                   MOVE      F#LINTC       L1INTC
     C                   MOVE      F#LADDI       L1ADDI
      *
     C     F#LICBS       IFNE      *ZEROS
     C                   MOVE      F#LICBS       L1ICBS
     C                   ELSE
     C                   MOVE      *BLANKS       L1ICBS
     C                   ENDIF
      *
     C     F#LBRTT       IFNE      *ZEROS
     C                   MOVE      F#LBRTT       L1BRTT
     C                   ELSE
     C                   MOVE      *BLANKS       L1BRTT
     C                   ENDIF
      *
      *   Rate/Spread
     C                   MOVE(P)   F#LRTSP       ZFIELD
     C                   Z-ADD     7             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1RTSP
      *
     C                   MOVE      F#LSPIN       L1SPIN
     C                   MOVE      F#LCHIN       L1CHIN
      *   Margin
     C                   MOVE(P)   F#LMARG       ZFIELD
     C                   Z-ADD     5             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1MARG
      *   Margin Sign
     C***********        MOVE      '+'           L1NMI
     C                   MOVE      ' '           L1NMI
     C     F#LMARG       IFLT      *ZERO
     C***********        MOVE      '-'           L1NMI
     C                   MOVE      'Y'           L1NMI
     C                   MULT      -1            F#LMARG                                      148756
     C                   MOVE(P)   F#LMARG       ZFIELD                                       148756
     C                   Z-ADD     5             ZADEC                                        148756
     C                   EXSR      ZEDIT                                                      148756
     C                   MOVE      ZFIELD        L1MARG                                       148756
     C                   ENDIF
      *
     C                   MOVE      F#LRDFC       L1RDFC
     C                   MOVE      F#LWTIN       L1WTIN
      *   Withholding Tax Rate
     C                   MOVE(P)   F#LWTRT       ZFIELD
     C                   Z-ADD     7             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1WTRT
      *
     C                   MOVE      F#LIPFR       L1IPFR
      *
     C     F#LIFDY       IFNE      *ZEROS
     C                   MOVE      F#LIFDY       L1IFDY
     C                   ELSE
     C                   MOVE      *BLANKS       L1IFDY
     C                   ENDIF
      *
      *   Next Interest Payment Date
     C                   Z-ADD     F#LNIDT       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L1NIDT
     C                   MOVEL     W#DATE8       L1NIDT
      *                                                                                       CLE028
      ** If CLE028 is on, format Add on interest, Add on charges, Charge amount,              CLE028
      ** Include charges in interest, Total flat interest, and First repayment date           CLE028
      *                                                                                       CLE028
     C                   IF        CLE028 = 'Y'                                               CLE028
     C                   EVAL      L1ADIF = F#LADIF                                           CLE028
     C                   EVAL      L1ADCF = F#LADCF                                           CLE028
     C                   EVAL      ZFIELD = *BLANKS                                           CLE028
     C                   MOVE      F#LCHGA       ZFIELD                                       CLE028
     C                   Z-ADD     W#CCYDP       ZADEC                                        CLE028
     C                   EXSR      ZEDIT                                                      CLE028
     C                   MOVE      ZFIELD        L1CHGA                                       CLE028
     C                   EVAL      L1ICIF = F#LICIF                                           CLE028
     C                   EVAL      ZFIELD = *BLANKS                                           CLE028
     C                   MOVE      F#LFLTI       ZFIELD                                       CLE028
     C                   EXSR      ZEDIT                                                      CLE028
     C                   MOVE      ZFIELD        L1FLTI                                       CLE028
     C                   Z-ADD     F#LFRPD       W#ZDAYN                                      CLE028
     C                   EXSR      ZZA0140                                                    CLE028
     C                   MOVEL     W#DATE8       L1FRPD                                       CLE028
     C                   ENDIF                                                                CLE028
     C                   Z-ADD     F#LORED       W#ZDAYN                                      CLE028
     C                   EXSR      ZZA0140                                                    CLE028
     C                   MOVEL     W#DATE8       L1ORED                                       CLE028
      *
     C     F#LREPT       IFNE      *ZEROS
     C                   MOVE      F#LREPT       L1REPT
     C                   ELSE
     C                   MOVE      *BLANKS       L1REPT
     C                   ENDIF
      *
      *   Loan Currency Repayment Amount
     C                   MOVE(P)   F#LRAMT       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1RAMT
      *
     C                   MOVE      F#LRFRQ       L1RFRQ
      *
     C     F#LRDYN       IFNE      *ZEROS
     C                   MOVE      F#LRDYN       L1RDYN
     C                   ELSE
     C                   MOVE      *BLANKS       L1RDYN
     C                   ENDIF
      *
      *   Next Repayment Date
     C                   Z-ADD     F#LNRPD       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L1NRPD
     C                   MOVEL     W#DATE8       L1NRPD
      *
     C     F#LLIND       IFNE      *ZEROS
     C                   MOVE      F#LLIND       L1LIND
     C                   ELSE
     C                   MOVE      *BLANKS       L1LIND
     C                   ENDIF
      *
     C     F#LFRBC       IFNE      *ZEROS
     C                   MOVE      F#LFRBC       L1FRBC
     C                   ELSE
     C                   MOVE      *BLANKS       L1FRBC
     C                   ENDIF
      *
     C                   MOVE      F#LCRSK       L1CRSK
     C                   MOVE      F#LACOF       L1ACOF
     C                   MOVE      F#LNACD       L1NACD
      *   Fees Indicator
     C                   TESTB     '2'           F#LRELI                  85
     C                   MOVEL     'N'           L1FEEI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1FEEI
     C                   ENDIF
      *   Documents Indicator
     C                   TESTB     '1'           F#LRELI                  85
     C                   MOVEL     'N'           L1DOCI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1DOCI
     C                   ENDIF
      *   Secured Indicator
     C                   TESTB     '0'           F#LRELI                  85
     C                   MOVEL     'N'           L1SECI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1SECI
     C                   ENDIF
      *   Loan Description
     C                   EVAL      L1LDSC=       F#LNAR1 +
     C                                           F#LNAR2 +
     C                                           F#LNAR3 +
     C                                           F#LNAR4
      *
     C                   MOVE      F#LBMDI       L1BMDI
      *   Base Currency Exchange Rate
     C                   MOVE(P)   F#LBCXR       ZFIELD
     C                   Z-ADD     8             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1BCXR
      *
     C                   MOVE      F#LFMDI       L1FMDI
      *   Facility Currency Exchange Rate
     C                   MOVE(P)   F#LFCXR       ZFIELD
     C                   Z-ADD     8             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1FCXR
      *
     C*****F#LRECE       IFNE      *ZEROS                                                     CSD027
     C     F#LRECE       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#LRECE       L1RECE
     C                   ELSE
     C                   MOVE      *BLANKS       L1RECE
     C                   ENDIF
      *
     C*****F#LCOCU       IFNE      *ZEROS                                                     CSD027
     C     F#LCOCU       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#LCOCU       L1COCU
     C                   ELSE
     C                   MOVE      *BLANKS       L1COCU
     C                   ENDIF
      *
      *   Original Maturity Date
     C                   Z-ADD     F#LOMDT       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L1OMDT
     C                   MOVEL     W#DATE8       L1OMDT
      *
     C                   MOVE      F#LRLFQ       L1RLFQ
      *
     C     F#LRLDY       IFNE      *ZEROS
     C                   MOVE      F#LRLDY       L1RLDY
     C                   ELSE
     C                   MOVE      *BLANKS       L1RLDY
     C                   ENDIF
      *
      *   Rollover Date
     C                   Z-ADD     F#LRLDT       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L1RLDT
     C                   MOVEL     W#DATE8       L1RLDT
      *
     C                   MOVE      F#LBTIN       L1BTIN
      *
     C     F#LBLDY       IFNE      *ZEROS
     C                   MOVE      F#LBLDY       L1BLDY
     C                   ELSE
     C                   MOVE      *BLANKS       L1BLDY
     C                   ENDIF
      *                                                                                       CLE011
      ** Rollover Fix Days                                                                    CLE011
      *                                                                                       CLE011
     C                   IF        CLE011 = 'Y'                                               CLE011
     C                   EVAL      L1RFDY = F#LRFDY                                           CLE011
     C                   EVAL      L1RFRI = F#LRFRI                                           CLE011
     C                   EVAL      L1RFAR = F#LRFAR                                           CLE011
     C                   MOVE      *Blanks       ZFIELD                                       CLE011
     C                   MOVE      F#LRFRT       ZFIELD                                       CLE011
     C                   Z-ADD     7             ZADEC                                        CLE011
     C                   EXSR      ZEDIT                                                      CLE011
     C                   MOVE      ZFIELD        L1RFRT                                       CLE011
     C                   ENDIF                                                                CLE011
      *
     C                   MOVE      F#LRCSI       L1RCSI
     C**********         MOVE      '000000'      L1ORBO                                125697 CSD027
     C                   EVAL      L1ORBO = *BLANKS                                           CSD027
     C                   MOVE      '000000'      L1SLNO                                       125697
      *                                                                                       125697
     C     F#LPTYP       IFEQ      64                                                         125697
     C     F#LPTYP       OREQ      65                                                         125697
     C     F#LPTYP       OREQ      68                                                         134078
     C     F#LPTYP       OREQ      71                                                         134078
     C                   MOVE      F#LOLNO       L1ORBO
     C                   ELSE                                                                 125697
     C     F#LPTYP       IFEQ      66                                                         125697
     C     F#LPTYP       OREQ      67                                                         125697
     C     F#LPTYP       OREQ      69                                                         134078
     C     F#LPTYP       OREQ      72                                                         134078
     C                   MOVE      F#LOLNO       L1SLNO
     C                   ENDIF                                                                125697
     C                   ENDIF                                                                125697
      *                                                                                       125697
     C*****F#LMLNR       IFNE      *ZEROS                                                     CLE148
     C     F#LMLNR       IFNE      *BLANKS                                                    CLE148
     C                   MOVE      F#LMLNR       L1SLNO
     C                   ENDIF
      *   Funding Rate/Spread
     C                   MOVE(P)   F#LFSRP       ZFIELD
     C                   Z-ADD     7             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1FSRP
      *
     C                   MOVE      F#LFSGN       L1FSGN
     C                   MOVE      F#LFPRC       L1FPRC
      *   Special Instructions
     C                   EVAL      L1SPI1=       F#LSPI1 +
     C                                           F#LSPI2 +
     C                                           F#LSPI3
      *
     C     F#LPSTM       IFNE      *ZEROS
     C                   MOVE      F#LPSTM       L1PSTM
     C                   ELSE
     C                   MOVE      *BLANKS       L1PSTM
     C                   ENDIF
      *   Pay Our Nostro
     C                   EVAL      L1PONS=       F#LOSDB+F#LPONS
      *
     C                   MOVE      F#LRVNO       L1RVNO
     C                   MOVE      F#LCVMR       L1CVMR
      *
     C*****F#LPOCN       IFNE      *ZEROS                                                     CSD027
     C     F#LPOCN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#LPOCN       L1POCN
     C                   ELSE
     C                   MOVE      *BLANKS       L1POCN
     C                   ENDIF
      *
     C*****F#LPOBN       IFNE      *ZEROS                                                     CSD027
     C     F#LPOBN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#LPOBN       L1POBN
     C                   ELSE
     C                   MOVE      *BLANKS       L1POBN
     C                   ENDIF
      *
     C                   MOVE      F#LRCRN       L1RCRN
     C                   MOVE      F#LRCRA       L1RCRA
     C                   MOVE      F#LPIBN       L1PIBN
     C                   MOVE      F#LPIBA       L1PIBA
     C                   MOVE      F#LAWBN       L1AWBN
     C                   MOVE      F#LAWBA       L1AWBA
     C                   MOVE      F#LBENN       L1BENN
     C                   MOVE      F#LBENA       L1BENA
      *
     C     F#LRSTM       IFNE      *ZEROS
     C                   MOVE      F#LRSTM       L1RSTM
     C                   ELSE
     C                   MOVE      *BLANKS       L1RSTM
     C                   ENDIF
      *
      *   Receive Our Nostro
     C                   EVAL      L1RONS=       F#LOMDB+F#LRONS
      *
     C*****F#LROCN       IFNE      *ZEROS                                                     CSD027
     C     F#LROCN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#LROCN       L1ROCN
     C                   ELSE
     C                   MOVE      *BLANKS       L1ROCN
     C                   ENDIF
      *
     C*****F#LROBN       IFNE      *ZEROS                                                     CSD027
     C     F#LROBN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#LROBN       L1ROBN
     C                   ELSE
     C                   MOVE      *BLANKS       L1ROBN
     C                   ENDIF
      *
     C                   MOVE      F#LRIBN       L1RIBN
     C                   MOVE      F#LRIBA       L1RIBA
      *   Details of Payments
     C                   EVAL      L1DTP1=       F#LDTP1 +
     C                                           F#LDTP2 +
     C                                           F#LDTP3 +
     C                                           F#LDTP4
      *
     C                   MOVE      F#LDCHG       L1DCHG
      *   Bank to Bank Information
     C                   EVAL      L1BTB1=       F#LBTB1 +
     C                                           F#LBTB2 +
     C                                           F#LBTB3 +
     C                                           F#LBTB4 +
     C                                           F#LBTB5 +
     C                                           F#LBTB6
      *
     C                   MOVE      F#LLNKS       L1LNKS
     C                   MOVE      F#LGASS       L1GASS
     C                   MOVE      F#LDFTP       L1DFTP
     C                   MOVE      F#LDFST       L1DFST
     C                   MOVE      F#LMCRA       L1MCRA
      *   Facility Currency Repayment Amount
     C                   MOVE(P)   F#LFCRA       ZFIELD
     C                   Z-ADD     W#FCCYDP      ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1FCRA
      *
     C                   MOVE      F#LPDDI       L1PDDI
     C                   MOVE      F#LPTDI       L1PTDI
      *
     C     F#LGDPR       IFNE      *ZEROS
     C                   MOVE      F#LGDPR       L1GDPR
     C                   ELSE
     C                   MOVE      *BLANKS       L1GDPR
     C                   ENDIF
      *
     C     F#LGDIN       IFNE      *ZEROS
     C                   MOVE      F#LGDIN       L1GDIN
     C                   ELSE
     C                   MOVE      *BLANKS       L1GDIN
     C                   ENDIF
      *
     C                   MOVE      F#LGPRT       L1GPRT
      *
     C*****F#LTOLN       IFNE      *ZEROS                                                     CLE148
     C     F#LTOLN       IFNE      *BLANKS                                                    CLE148
     C                   MOVE      F#LTOLN       L1TOLN
     C                   ELSE
     C                   MOVE      *BLANKS       L1TOLN
     C                   ENDIF
      *
     C                   MOVE      F#LIUSR       L1IUSR
     C                   MOVE      F#LAUSR       L1AUSR
     C                   MOVE      F#LXUSR       L1XUSR
     C                   MOVE      F#LRECI       L1RECI
     C                   MOVE      F#LPTYP       L1PTYP
      *   Interest Rate
     C                   MOVE(P)   F#LINTR       ZFIELD
     C                   Z-ADD     7             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1INTR
      *   Current Base Rate
     C                   MOVE(P)   F#LBRTE       ZFIELD
     C                   Z-ADD     7             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1BRTE
      *
     C                   MOVE      F#LFCCY       L1FCCY
     C                   MOVE      F#LFCLB       L1FCLB
      *   Part Sold Amount
     C                   MOVE(P)   F#LPSAM       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1PSAM
      *
     C                   MOVE      F#LNOPS       L1NOPS
      *   Accrued Withholding Tax Posted
     C                   MOVE(P)   F#LAWTP       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1AWTP
      *   Withholding Tax Received to Date
     C                   MOVE(P)   F#LWTRD       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1WTRD
      *   Withholding Tax Written Off to Date
     C                   MOVE(P)   F#LWTWD       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1WTWD
      *   Interest Written Off to Date
     C                   MOVE(P)   F#LIWOD       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1IWOD
      *   Principal Written Off to Date
     C                   MOVE(P)   F#LPWOD       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1PWOD
      *   Past Due Interest Amount
     C                   MOVE(P)   F#LPDIN       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1PDIN
      *   Total Interest
     C                   MOVE(P)   F#LTOTI       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1TOTI
      *   Start Date or Last Interest Date
     C                   Z-ADD     F#LSLID       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L1SLID
     C                   MOVEL     W#DATE8       L1SLID
      *   Accrued Interest Posted to Date
     C                   MOVE(P)   F#LAIPD       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1AIPD
      *   Date of Last Rate Change
     C                   Z-ADD     F#LDLRC       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L1DLRC
     C                   MOVEL     W#DATE8       L1DLRC
      *   Interest Accrual Control Date
     C                   Z-ADD     F#LIACD       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L1IACD
     C                   MOVEL     W#DATE8       L1IACD
      *   Accrued Interest to Control Date
     C                   MOVE(P)   F#LAITC       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1AITC
      *   Total Fees Paid
     C                   MOVE(P)   F#LTFEP       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1TFEP
      *   Accrued Interest Adjustment Posted
     C                   MOVE(P)   F#LAIAP       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1AIAP
      *   Interest Paid/Received to Date
     C                   IF        CLE028 = 'N'                                               CLE028
     C                             OR CLE028 = 'Y' AND F#LPTYP <> 80                          CLE028
     C                             OR CLE028='Y' AND F#LPTYP=80 AND F#LADIF<>'Y'              CLE028
     C                   MOVE(P)   F#LIPRD       ZFIELD
     C                   ELSE                                                                 CLE028
     C                   MOVE      *BLANKS       ZFIELD                                       CLE028
     C                   ENDIF                                                                CLE028
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1IPRD
      *   Interest Paid/Received This Month
     C                   MOVE(P)   F#LIPRM       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1IPRM
      *   Interest Capitalised to Date
     C                   MOVE(P)   F#LICTD       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1ICTD
      *   Accrued Interest Manual Adjustment Posted
     C                   MOVE(P)   F#LAIMN       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1AIMN
      *   Loan Special Instruction Indicator
     C                   TESTB     '0'           F#LLONI                  85
     C                   MOVEL     'N'           L1LSII
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1LSII
     C                   ENDIF
      *   Loan Total Interest Override Indicator
     C                   TESTB     '2'           F#LLONI                  85
     C                   MOVEL     'N'           L1LTIO
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1LTIO
     C                   ENDIF
      *   Loan Stop Accruals Indicator
     C                   TESTB     '3'           F#LLONI                  85
     C                   MOVEL     'N'           L1LSAI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1LSAI
     C                   ENDIF
      *   Loan Interest Date Control Indicator
     C                   TESTB     '5'           F#LLONI                  85
     C                   MOVEL     'N'           L1LIDC
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1LIDC
     C                   ENDIF
      *   Confirmation Deal Date Indicator
     C                   TESTB     '0'           F#LCNFI                  85
     C                   MOVEL     'N'           L1CDDI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1CDDI
     C                   ENDIF
      *   Confirmation Control Indicator
     C                   TESTB     '1'           F#LCNFI                  85
     C                   MOVEL     'N'           L1CCI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1CCI
     C                   ENDIF
      *   Confirmation Produce in COB Indicator
     C                   TESTB     '5'           F#LCNFI                  85
     C                   MOVEL     'N'           L1CPCI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1CPCI
     C                   ENDIF
      *   Confirmation Duplicate Required Indicator
     C                   TESTB     '6'           F#LCNFI                  85
     C                   MOVEL     'N'           L1CDRI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1CDRI
     C                   ENDIF
      *   Confirmation Already Printed Indicator
     C                   TESTB     '7'           F#LCNFI                  85
     C                   MOVEL     'N'           L1CAPI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1CAPI
     C                   ENDIF
      *   Accounting Deal Date Indicator
     C                   TESTB     '0'           F#LACEI                  85
     C                   MOVEL     'N'           L1ADIN
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1ADIN
     C                   ENDIF
      *   Accounting Start Date Indicator
     C                   TESTB     '1'           F#LACEI                  85
     C                   MOVEL     'N'           L1ASDI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1ASDI
     C                   ENDIF
      *   Accounting Maturity Date Indicator
     C                   TESTB     '2'           F#LACEI                  85
     C                   MOVEL     'N'           L1AMDI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1AMDI
     C                   ENDIF
      *   Telex Start Date Indicator
     C                   TESTB     '0'           F#LTLXI                  85
     C                   MOVEL     'N'           L1TSDI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1TSDI
     C                   ENDIF
      *   Telex Maturity Date Indicator
     C                   TESTB     '1'           F#LTLXI                  85
     C                   MOVEL     'N'           L1TMDI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1TMDI
     C                   ENDIF
      *   Telex Interest Date Indicator
     C                   TESTB     '2'           F#LTLXI                  85
     C                   MOVEL     'N'           L1TIDI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1TIDI
     C                   ENDIF
      *   Telex Repayment Date Indicator
     C                   TESTB     '3'           F#LTLXI                  85
     C                   MOVEL     'N'           L1TRDI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1TRDI
     C                   ENDIF
      *   Customer Bills Interest Payment Indicator
     C                   TESTB     '0'           F#LCBLI                  85
     C                   MOVEL     'N'           L1CBIP
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1CBIP
     C                   ENDIF
      *   Customer Bills Interest Payment Bill to Resend
     C                   TESTB     '1'           F#LCBLI                  85
     C                   MOVEL     'N'           L1CBPR
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1CBPR
     C                   ENDIF
      *   Customer Bills Repayment Bill Indicator
     C                   TESTB     '2'           F#LCBLI                  85
     C                   MOVEL     'N'           L1CBRB
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1CBRB
     C                   ENDIF
      *   Customer Bills Repayment Bill to Resend
     C                   TESTB     '3'           F#LCBLI                  85
     C                   MOVEL     'N'           L1CBRR
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1CBRR
     C                   ENDIF
      *   Customer Bills Maturity Bill  Indicator
     C                   TESTB     '4'           F#LCBLI                  85
     C                   MOVEL     'N'           L1CBMB
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1CBMB
     C                   ENDIF
      *   Customer Bills Maturity Bill to Resend
     C                   TESTB     '5'           F#LCBLI                  85
     C                   MOVEL     'N'           L1CBMR
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L1CBMR
     C                   ENDIF
      *   Original Interest Amount
     C                   MOVE(P)   F#LORTI       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1ORTI
      *   Total Cost of Funds
     C                   MOVE(P)   F#LTCOF       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1TCOF
      *   Accrued COF posted to date
     C                   MOVE(P)   F#LACPD       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1ACPD
      *   Accrued COF to Control Date
     C                   MOVE(P)   F#LACDA       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1ACDA
      *   Accrued COF Manual Adjustment
     C                   MOVE(P)   F#LACAJ       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1ACAJ
      *   Accrued COF Adjustment Posted
     C                   MOVE(P)   F#LACAP       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1ACAP
      *   COF Paid/Received to Date
     C                   MOVE(P)   F#LCOFD       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1COFD
      *   COF Paid/Received this Month
     C                   MOVE(P)   F#LCOFM       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1COFM
      *   COF Capitalised to Date
     C                   MOVE(P)   F#LCFCD       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1CFCD
      *   Past Due Cost of Funds
     C                   MOVE(P)   F#LPDCF       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1PDCF
      *   COF Accrual Control Date
     C                   Z-ADD     F#LFCTD       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L1FCTD
     C                   MOVEL     W#DATE8       L1FCTD
      *   COF Written Off to Date
     C                   MOVE(P)   F#LFWOD       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1FWOD
      *   Original Principal Amount
     C                   MOVE(P)   F#LOPAM       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1OPAM
      *   YTD Interest Paid Loan Currency
     C                   MOVE(P)   F#LYPLN       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1YPLN
      *   YTD Fees Paid Loan Currency
     C                   MOVE(P)   F#LYFLN       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1YFLN
      *   YTD Withholding Tax Paid Loan Currency
     C                   MOVE(P)   F#LYWLN       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1YWLN
      *   YTD Aggregate Balance Loan Currency
     C                   MOVE(P)   F#LABLN       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1ABLN
      *   YTD Interest Paid Local Currency
     C                   MOVE(P)   F#LYPLC       ZFIELD
     C                   Z-ADD     W#LCCYDP      ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1YPLC
      *   YTD Fees Paid Local Currency
     C                   MOVE(P)   F#LYFLC       ZFIELD
     C                   Z-ADD     W#LCCYDP      ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1YFLC
      *   YTD Withholding Tax Paid Local Currency
     C                   MOVE(P)   F#LYWLC       ZFIELD
     C                   Z-ADD     W#LCCYDP      ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1YWLC
      *   YTD Aggregate Balance Local Currency
     C                   MOVE(P)   F#LABLC       ZFIELD
     C                   Z-ADD     W#LCCYDP      ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1ABLC
      *   YTD Withholding Tax Written Off Loan Currency
     C                   MOVE(P)   F#LWWLN       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1WWLN
      *   YTD Interest Written Off
     C                   MOVE(P)   F#LIWLN       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1IWLN
      *   YTD Principal Written Off
     C                   MOVE(P)   F#LPWLN       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1PWLN
      *
     C                   MOVE      F#LLSTS       L1LSTS
     C                   MOVE      F#LPCRF       L1PCRF
     C                   MOVE      F#LMNSG       L1MNSG
     C                   MOVE      F#LRATF       L1RATF
     C                   MOVE      F#LCNCF       L1CNCF
     C                   MOVE      F#LLPFI       L1LPFI
      *
     C*****F#LPTFC       IFNE      *ZEROS                                                     CSD027
     C     F#LPTFC       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#LPTFC       L1PTFC
     C                   ELSE
     C                   MOVE      *BLANKS       L1PTFC
     C                   ENDIF
      *
     C     F#LPTFT       IFNE      *ZEROS
     C                   MOVE      F#LPTFT       L1PTFT
     C                   ELSE
     C                   MOVE      *BLANKS       L1PTFT
     C                   ENDIF
      *
     C     F#LPTFN       IFNE      *ZEROS
     C                   MOVE      F#LPTFN       L1PTFN
     C                   ELSE
     C                   MOVE      *BLANKS       L1PTFN
     C                   ENDIF
      *
      *   Next Rollover Date
     C                   Z-ADD     F#LNROD       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L1NROD
     C                   MOVEL     W#DATE8       L1NROD
      *
     C     F#LNCAS       IFNE      *ZEROS
     C                   MOVE      F#LNCAS       L1NCAS
     C                   ELSE
     C                   MOVE      *BLANKS       L1NCAS
     C                   ENDIF
      *
     C     F#LNBRA       IFNE      *ZEROS
     C                   MOVE      F#LNBRA       L1NBRA
     C                   ELSE
     C                   MOVE      *BLANKS       L1NBRA
     C                   ENDIF
      *
      *   Next Rate/Spread
     C                   MOVE(P)   F#LNRTS       ZFIELD
     C                   Z-ADD     7             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1NRTS
      *
     C                   MOVE      F#LNSIN       L1NSIN
     C                   MOVE      F#LNCHI       L1NCHI
      *   New Principal Amount
     C                   MOVE(P)   F#LNPRAM      ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1NPAM
      *   New Discount Amount
     C                   MOVE(P)   F#LNDAM       ZFIELD
     C                   Z-ADD     W#CCYDP       ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1NDAM
      *   New Interest Payment Date
     C                   Z-ADD     F#LNIPD       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L1NIPD
     C                   MOVEL     W#DATE8       L1NIPD
      *   New Maturity Date
     C                   Z-ADD     F#LNMDT       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L1NMDT
     C                   MOVEL     W#DATE8       L1NMDT
      *   New Funding Spread/Rate
     C                   MOVE(P)   F#LNFRS       ZFIELD
     C                   Z-ADD     7             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1NFRS
      *
     C                   MOVE      F#LNFSN       L1NFSN
     C                   MOVE      F#LNFPC       L1NFPC
     C                   MOVE      F#LRPST       L1RPST
      *   Pay Rollover Our Nostro
     C                   EVAL      L1RPON=       F#LRLSB+F#LRPON
      *
     C                   MOVE      F#LRRVN       L1RRVN
     C                   MOVE      F#LRCVM       L1RCVM
     C                   MOVE      F#LRPOC       L1RPOC
     C                   MOVE      F#LRPOB       L1RPOB
     C                   MOVE      F#LRRCR       L1RRCR
     C                   MOVE      F#LRRCA       L1RRCA
     C                   MOVE      F#LRPIB       L1RPIB
     C                   MOVE      F#LRPBA       L1RPBA
     C                   MOVE      F#LRAWB       L1RAWB
     C                   MOVE      F#LRAWA       L1RAWA
     C                   MOVE      F#LRBEN       L1RBEN
     C                   MOVE      F#LRBNA       L1RBNA
     C                   MOVE      F#LRRST       L1RRST
      *   Receive Rollover Our Nostro
     C                   EVAL      L1RRON=       F#LRLBR+F#LRRON
      *
     C                   MOVE      F#LRROC       L1RROC
     C                   MOVE      F#LRROB       L1RROB
     C                   MOVE      F#LRRIB       L1RRIB
     C                   MOVE      F#LRRBA       L1RRBA
      *   Rollover Details of Payments
     C                   EVAL      L1RDP1=       F#LRDP1 +
     C                                           F#LRDP2 +
     C                                           F#LRDP3 +
     C                                           F#LRDP4
      *
     C                   MOVE      F#LRDCH       L1RDCH
      *   Bank to Bank Information
     C                   EVAL      L1RBB1=       F#LRBB1 +
     C                                           F#LRBB2 +
     C                                           F#LRBB3 +
     C                                           F#LRBB4 +
     C                                           F#LRBB5 +
     C                                           F#LRBB6
      *
     C                   MOVE      F#LNCCY       L1NCCY
      *   New Currency Principal Amount
     C                   MOVE(P)   F#LNCPA       ZFIELD
     C                   Z-ADD     W#NCCYDP      ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1NCPA
      *
     C                   MOVE      F#LNFMD       L1NFMD
      *   New Facility Currency Exchange Rate
     C                   MOVE(P)   F#LNFCE       ZFIELD
     C                   Z-ADD     8             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1NFCE
      *   New Loan Currency Repayment Amount
     C                   MOVE(P)   F#LNLRA       ZFIELD
     C                   Z-ADD     W#NCCYDP      ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1NLRA
      *
     C                   MOVE      F#LRIUS       L1RIUS
     C                   MOVE      F#LRAUS       L1RAUS
     C                   MOVE      F#LRXUS       L1RXUS
     C                   MOVE      F#LRSTS       L1RSTS
     C                   MOVE      F#LRPCR       L1RPCR
      *
      *   Last Rollover Date
     C                   Z-ADD     F#LLRLD       W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#ZDATE8      L1LRLD
      *
      *   Last Multi-Ccy Rollover Date
     C                   Z-ADD     F#LLMCD       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L1LMCD
     C                   MOVEL     W#DATE8       L1LMCD
      *
     C                   MOVE      F#LNBMD       L1NBMD
      *  New Base Currency Exchange Rate
     C                   MOVE(P)   F#LNBCE       ZFIELD
     C                   Z-ADD     8             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L1NBCE
      *                                                                                       131254
      *   Current Principal Amount Sign                                                       131254
     C                   MOVE      '+'           L1CPAS                                       131254
     C     F#LCPAM       IFLT      *ZERO                                                      131254
     C                   MOVE      '-'           L1CPAS                                       131254
     C                   MULT      -1            F#LCPAM                                      131254
     C                   MOVE(P)   F#LCPAM       ZFIELD                                       131254
     C                   Z-ADD     W#CCYDP       ZADEC                                        131254
     C                   EXSR      ZEDIT                                                      131254
     C                   MOVE      ZFIELD        L1CPAM                                       131254
     C                   ENDIF                                                                131254
      *                                                                                       CEU030
     C     CEU004        IFEQ      'Y'                                                        CEU030
     C                   MOVE      F#LSCCY       L1SCCY                                       CEU030
     C                   MOVE      F#LICCY       L1ICCY                                       CEU030
     C                   MOVE      F#LRRSC       L1RRSC                                       CEU030
     C                   MOVE      F#LRPSC       L1RPSC                                       CEU030
     C                   MOVE      F#LRICY       L1RICY                                       CEU030
     C                   MOVE      F#LECIN       L1ECIN                                       CEU030
     C                   ENDIF                                                                CEU030
      *                                                                                       CLE031
     C                   IF        CLE031 = 'Y'                                               CLE031
      *                                                                                       CLE031
      * Facility Currency principal Amount                                                    CLE031
     C                   Z-ADD     W#FCCYDP      ZADEC                                        CLE031
     C                   MOVE      *BLANKS       ZFIELD                                       CLE031
     C                   MOVE      F#LFPAM       ZFIELD                                       CLE031
     C                   EXSR      ZEDIT                                                      CLE031
     C                   MOVE      ZFIELD        L1FPAM                                       CLE031
      *                                                                                       CLE031
      * (Receive) Settlement Currency                                                         CLE031
     C                   EVAL      L1SCCY = F#LSCCY                                           CLE031
      *                                                                                       CLE031
      * Receive Settlement Ccy. Exchange Rate                                                 CLE031
     C                   Z-ADD     8             ZADEC                                        CLE031
     C                   MOVE      *BLANKS       ZFIELD                                       CLE031
     C                   MOVE      F#LREXR       ZFIELD                                       CLE031
     C                   EXSR      ZEDIT                                                      CLE031
     C                   MOVE      ZFIELD        L1REXR                                       CLE031
      *                                                                                       CLE031
      * Receive Settlement Ccy. Exchange Rate Indicator                                       CLE031
     C                   EVAL      L1REXI = F#LREXI                                           CLE031
      *                                                                                       CLE031
      * Pay Settlement Currency                                                               CLE031
     C                   EVAL      L1PSCY = F#LPSCY                                           CLE031
      *                                                                                       CLE031
      * Pay Settlement Ccy. Exchange Rate                                                     CLE031
     C                   Z-ADD     8             ZADEC                                        CLE031
     C                   MOVE      *BLANKS       ZFIELD                                       CLE031
     C                   MOVE      F#LPEXR       ZFIELD                                       CLE031
     C                   EXSR      ZEDIT                                                      CLE031
     C                   MOVE      ZFIELD        L1PEXR                                       CLE031
      *                                                                                       CLE031
      * Pay Settlement Ccy. Exchange Rate Indicator                                           CLE031
     C                   EVAL      L1PEXI = F#LPEXI                                           CLE031
      *                                                                                       CLE031
      * Roll Receive Settlement Currency                                                      CLE031
     C                   EVAL      L1RRSC = F#LRRSC                                           CLE031
      *                                                                                       CLE031
      * Roll Receive Settlement Currency Exchange Rate                                        CLE031
     C                   Z-ADD     8             ZADEC                                        CLE031
     C                   MOVE      *BLANKS       ZFIELD                                       CLE031
     C                   MOVE      F#LRRSR       ZFIELD                                       CLE031
     C                   EXSR      ZEDIT                                                      CLE031
     C                   MOVE      ZFIELD        L1RRSR                                       CLE031
      *                                                                                       CLE031
      * Roll Receive Settlement Currency Exchange Rate Indicator                              CLE031
     C                   EVAL      L1RRSI = F#LRRSI                                           CLE031
      *                                                                                       CLE031
      * Roll Pay Settlement Currency                                                          CLE031
     C                   EVAL      L1RPSC = F#LRPSC                                           CLE031
      *                                                                                       CLE031
      * Roll Pay Settlement Currency Exchange Rate                                            CLE031
     C                   Z-ADD     8             ZADEC                                        CLE031
     C                   MOVE      *BLANKS       ZFIELD                                       CLE031
     C                   MOVE      F#LRPSR       ZFIELD                                       CLE031
     C                   EXSR      ZEDIT                                                      CLE031
     C                   MOVE      ZFIELD        L1RPSR                                       CLE031
      *                                                                                       CLE031
      * Roll Pay Settlement Currency Exchange Rate Indicator                                  CLE031
     C                   EVAL      L1RPSI = F#LRPSI                                           CLE031
     C                   ENDIF                                                                CLE031
                                                                                              CLE034
     C                   IF        CLE034 = 'Y'                                               CLE034
     C                   EVAL      L1STAL = F#LSTAL                                           CLE034
     C                   EVAL      L1RSTA = F#LRSTA                                           CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE034
      ** Base Rate Fields                                                                     CLE036
                                                                                              CLE036
     C                   IF        CLE036 = 'Y'                                               CLE036
     C                   MOVE      F#LBASR       ZFIELD                                       CLE036
     C                   Z-ADD     7             ZADEC                                        CLE036
     C                   EXSR      ZEDIT                                                      CLE036
     C                   MOVE      ZFIELD        L1BASR                                       CLE036
                                                                                              CLE036
     C                   MOVE      F#LNBSR       ZFIELD                                       CLE036
     C                   Z-ADD     7             ZADEC                                        CLE036
     C                   EXSR      ZEDIT                                                      CLE036
     C                   MOVE      ZFIELD        L1NBSR                                       CLE036
     C                   ENDIF                                                                CLE036
                                                                                              CLE036
      *
      * Move message format
     C                   EVAL      W#L1MF=%SUBST(DWL1MF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#L1MF
     C                   ADD       W#BTML        W#MPOS
     C                   ENDIF                                                                210696
      *
      * Format Loan Amendments
     C     X1MSGT        WHENEQ    'DLLA'
      *
      * Access Currency Codes for decimal places for
      *  Loan Amendment Currency
     C                   MOVE      F#ACCY        W#CCY
     C                   EXSR      GETNBDP
      *
     C                   MOVE      F#ALNRF       L2LNRF
      *   Value Date
     C                   Z-ADD     F#AVDAT       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L2VDAT
     C                   MOVEL     W#DATE8       L2VDAT
      *
     C                   MOVE      F#ALASN       L2LASN
     C                   MOVE      F#ACNUM       L2CNUM
     C                   MOVE      F#ACCY        L2CCY
      *
     C     F#ABRTT       IFNE      *ZEROS
     C                   MOVE      F#ABRTT       L2BRTT
     C                   ELSE
     C                   MOVE      *BLANKS       L2BRTT
     C                   ENDIF
      *
      *   Rate/Spread
     C                   MOVE(P)   F#ARTSP       ZFIELD
     C                   Z-ADD     7             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L2RTSP
      *
     C                   MOVE      F#ASTAI       L2STAI
      *   Maturity Date
     C                   Z-ADD     F#ALSMD       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L2LSMD
     C                   MOVEL     W#DATE8       L2LSMD
      *
     C                   MOVE      F#ALTYP       L2LTYP
     C                   MOVE      F#ASUTP       L2SUTP
      *   Funding Rate/Spread
     C                   MOVE(P)   F#AFSRP       ZFIELD
     C                   Z-ADD     7             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L2FSRP
      *   Special Instructions
     C                   EVAL      L2SPI1=       F#ASPI1 +
     C                                           F#ASPI2 +
     C                                           F#ASPI3
      *
     C     F#APSTM       IFNE      *ZEROS
     C                   MOVE      F#APSTM       L2PSTM
     C                   ELSE
     C                   MOVE      *BLANKS       L2PSTM
     C                   ENDIF
      *
     C                   EVAL      L2PONS=       F#AOSBR + F#APONS
     C                   MOVE      F#ARVNO       L2RVNO
     C                   MOVE      F#ACVMR       L2CVMR
      *
     C*****F#APOCN       IFNE      *ZEROS                                                     CSD027
     C     F#APOCN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#APOCN       L2POCN
     C                   ELSE
     C                   MOVE      *BLANKS       L2POCN
     C                   ENDIF
      *
     C*****F#APOBN       IFNE      *ZEROS                                                     CSD027
     C     F#APOBN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#APOBN       L2POBN
     C                   ELSE
     C                   MOVE      *BLANKS       L2POBN
     C                   ENDIF
      *
     C                   MOVE      F#ARCRN       L2RCRN
     C                   MOVE      F#ARCRA       L2RCRA
     C                   MOVE      F#APIBN       L2PIBN
     C                   MOVE      F#APIBA       L2PIBA
     C                   MOVE      F#AAWBN       L2AWBN
     C                   MOVE      F#AAWBA       L2AWBA
     C                   MOVE      F#ABENN       L2BENN
     C                   MOVE      F#ABENA       L2BENA
      *
     C     F#ARSTM       IFNE      *ZEROS
     C                   MOVE      F#ARSTM       L2RSTM
     C                   ELSE
     C                   MOVE      *BLANKS       L2RSTM
     C                   ENDIF
      *
     C                   EVAL      L2RONS=       F#AOSBR + F#ARONS
      *
     C*****F#AROCN       IFNE      *ZEROS                                                     CSD027
     C     F#AROCN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#AROCN       L2ROCN
     C                   ELSE
     C                   MOVE      *BLANKS       L2ROCN
     C                   ENDIF
      *
     C*****F#AROBN       IFNE      *ZEROS                                                     CSD027
     C     F#AROBN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#AROBN       L2ROBN
     C                   ELSE
     C                   MOVE      *BLANKS       L2ROBN
     C                   ENDIF
      *
     C                   MOVE      F#ARIBN       L2RIBN
     C                   MOVE      F#ARIBA       L2RIBA
      *   Details of Payments
     C                   EVAL      L2DTP1=       F#ADTP1 +
     C                                           F#ADTP2 +
     C                                           F#ADTP3 +
     C                                           F#ADTP4
      *
     C                   MOVE      F#ADCHG       L2DCHG
      *   Bank to Bank Information
     C                   EVAL      L2BTB1=       F#ABTB1 +
     C                                           F#ABTB2 +
     C                                           F#ABTB3 +
     C                                           F#ABTB4 +
     C                                           F#ABTB5 +
     C                                           F#ABTB6
      *
     C                   MOVE      F#ADFTP       L2DFTP
     C                   MOVE      F#ADFST       L2DFST
     C                   MOVE      F#ANRLI       L2NRLI
      *
     C*****F#AROLN       IFNE      *ZEROS                                                     CLE148
     C     F#AROLN       IFNE      *BLANKS                                                    CLE148
     C                   MOVE      F#AROLN       L2ROLN
     C                   ELSE
     C                   MOVE      *BLANKS       L2ROLN
     C                   ENDIF
      *
     C     F#AROSN       IFNE      *ZEROS
     C                   MOVE      F#AROSN       L2ROSN
     C                   ELSE
     C                   MOVE      *BLANKS       L2ROSN
     C                   ENDIF
      *
     C                   MOVE      F#AROBR       L2ROBR
      *
     C*****F#ARORC       IFNE      *ZEROS                                                     CSD027
     C     F#ARORC       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#ARORC       L2RORC
     C                   ELSE
     C                   MOVE      *BLANKS       L2RORC
     C                   ENDIF
      *
     C                   MOVE      F#AIUSR       L2IUSR
     C                   MOVE      F#AAUSR       L2AUSR
     C                   MOVE      F#AXUSR       L2XUSR
     C                   MOVE      F#AAUTO       L2AUTO
      *   X-ref Loan Repayment Value Date
     C                   Z-ADD     F#AXAVD       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L2XAVD
     C                   MOVEL     W#DATE8       L2XAVD
      *
     C     F#AXASQ       IFNE      *ZEROS
     C                   MOVE      F#AXASQ       L2XASQ
     C                   ELSE
     C                   MOVE      *BLANKS       L2XASQ
     C                   ENDIF
      *
      *   Principal Repayment Amount
     C                   MOVE(P)   F#APRAM       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L2PRAM
      *   Principal Repayment Amount Sign
     C                   MOVE      '+'           L2PRAS
     C     F#APRAM       IFLT      *ZERO
     C                   MOVE      '-'           L2PRAS
     C                   MULT      -1            F#APRAM                                      148708
     C                   MOVE(P)   F#APRAM       ZFIELD                                       148708
     C                   Z-ADD     A6NBDP        ZADEC                                        148708
     C                   EXSR      ZEDIT                                                      148708
     C                   MOVE      ZFIELD        L2PRAM                                       148708
     C                   ENDIF
      *   Interest Payment Amount
     C                   MOVE(P)   F#AINTA       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L2INTA
      *   Interest Payment Amount Sign
     C                   MOVE      '+'           L2INTS
     C     F#AINTA       IFLT      *ZERO
     C                   MOVE      '-'           L2INTS
     C                   MULT      -1            F#AINTA                                      148708
     C                   MOVE(P)   F#AINTA       ZFIELD                                       148708
     C                   Z-ADD     A6NBDP        ZADEC                                        148708
     C                   EXSR      ZEDIT                                                      148708
     C                   MOVE      ZFIELD        L2INTA                                       148708
     C                   ENDIF
      *   Total Repayment Amount
     C                   MOVE(P)   F#ATAMT       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L2TAMT
      *   Total Repayment Amount Sign
     C                   MOVE      '+'           L2TAMS
     C     F#ATAMT       IFLT      *ZERO
     C                   MOVE      '-'           L2TAMS
     C                   MULT      -1            F#ATAMT                                      148708
     C                   MOVE(P)   F#ATAMT       ZFIELD                                       148708
     C                   Z-ADD     A6NBDP        ZADEC                                        148708
     C                   EXSR      ZEDIT                                                      148708
     C                   MOVE      ZFIELD        L2TAMT                                       148708
     C                   ENDIF
      *
     C                   MOVE      F#ALWOI       L2LWOI
     C                   MOVE      F#APAST       L2PAST
      *   Penalty Payment Amount
     C                   MOVE(P)   F#APNAM       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L2PNAM
      *   Penalty Payment Amount Sign
     C                   MOVE      '+'           L2PNAS
     C     F#APNAM       IFLT      *ZERO
     C                   MOVE      '-'           L2PNAS
     C                   MULT      -1            F#APNAM                                      148708
     C                   MOVE(P)   F#APNAM       ZFIELD                                       148708
     C                   Z-ADD     A6NBDP        ZADEC                                        148708
     C                   EXSR      ZEDIT                                                      148708
     C                   MOVE      ZFIELD        L2PNAM                                       148708
     C                   ENDIF
      *
     C                   MOVE      F#ARECI       L2RECI
     C                   MOVE      F#APTYP       L2PTYP
     C                   MOVE      F#AAMTP       L2AMTP
     C                   MOVE      F#ABRCA       L2BRCA
      *   Withholding Tax Amount
     C                   MOVE(P)   F#AWTXA       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L2WTXA
      *   Withholding Tax Amount Sign
     C                   MOVE      '+'           L2WTXS
     C     F#AWTXA       IFLT      *ZERO
     C                   MOVE      '-'           L2WTXS
     C                   MULT      -1            F#AWTXA                                      148708
     C                   MOVE(P)   F#AWTXA       ZFIELD                                       148708
     C                   Z-ADD     A6NBDP        ZADEC                                        148708
     C                   EXSR      ZEDIT                                                      148708
     C                   MOVE      ZFIELD        L2WTXA                                       148708
     C                   ENDIF
      *   Fee Amount
     C                   MOVE(P)   F#AFEAM       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L2FEAM
      *   Fee Amount Sign
     C                   MOVE      '+'           L2FEAS
     C     F#AFEAM       IFLT      *ZERO
     C                   MOVE      '-'           L2FEAS
     C                   MULT      -1            F#AFEAM                                      148708
     C                   MOVE(P)   F#AFEAM       ZFIELD                                       148708
     C                   Z-ADD     A6NBDP        ZADEC                                        148708
     C                   EXSR      ZEDIT                                                      148708
     C                   MOVE      ZFIELD        L2FEAM                                       148708
     C                   ENDIF
      *
     C                   MOVE      F#AREPT       L2REPT
      *   Loan Amendment Actioned Indicator
     C                   TESTB     '0'           F#ALAIN                  85
     C                   MOVEL     'N'           L2LAIA
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L2LAIA
     C                   ENDIF
      *   Loan Amendment Telex Sent Indicator
     C                   TESTB     '1'           F#ALAIN                  85
     C                   MOVEL     'N'           L2LAIT
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L2LAIT
     C                   ENDIF
      *   Loan Amendment Confirmation Sent Indicator
     C                   TESTB     '2'           F#ALAIN                  85
     C                   MOVEL     'N'           L2LAIC
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L2LAIC
     C                   ENDIF
      *   Loan Amendment Cust. Bill Sent Indicator
     C                   TESTB     '4'           F#ALAIN                  85
     C                   MOVEL     'N'           L2LAIB
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L2LAIB
     C                   ENDIF
      *   Loan Amendment Resend Bill Indicator
     C                   TESTB     '5'           F#ALAIN                  85
     C                   MOVEL     'N'           L2LAIR
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L2LAIR
     C                   ENDIF
      *   Loan Amendment Conf. Control Indicator
     C                   TESTB     '7'           F#ALAIN                  85
     C                   MOVEL     'N'           L2CLAI
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L2CLAI
     C                   ENDIF
      *   Current Base Rate
     C                   MOVE(P)   F#ABRTE       ZFIELD
     C                   Z-ADD     7             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L2BRTE
      *
     C                   MOVE      F#ASPIN       L2SPIN
     C                   MOVE      F#ACALC       L2CALC
     C                   MOVE      F#AWTIN       L2WTIN
     C                   MOVE      F#AFCUS       L2FCUS
     C                   MOVE      F#AFTYP       L2FTYP
     C                   MOVE      F#AFSEQ       L2FSEQ
      *
     C     F#ARLON       IFNE      *ZEROS
     C                   MOVE      F#ARLON       L2RLON
     C                   ELSE
     C                   MOVE      *BLANKS       L2RLON
     C                   ENDIF
      *
     C     F#AFECD       IFNE      *ZEROS
     C                   MOVE      F#AFECD       L2FECD
     C                   ELSE
     C                   MOVE      *BLANKS       L2FECD
     C                   ENDIF
      *
      *   Past Due Notice 1
     C                   TESTB     '0'           F#APONI                  85
     C                   MOVEL     'N'           L2PDN1
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L2PDN1
     C                   ENDIF
      *   Past Due Notice 2
     C                   TESTB     '1'           F#APONI                  85
     C                   MOVEL     'N'           L2PDN2
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L2PDN2
     C                   ENDIF
      *   Past Due Notice 3
     C                   TESTB     '2'           F#APONI                  85
     C                   MOVEL     'N'           L2PDN3
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L2PDN3
     C                   ENDIF
      *   Past Due Notice 4
     C                   TESTB     '3'           F#APONI                  85
     C                   MOVEL     'N'           L2PDN4
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L2PDN4
     C                   ENDIF
      *   Past Due Notice 5
     C                   TESTB     '4'           F#APONI                  85
     C                   MOVEL     'N'           L2PDN5
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L2PDN5
     C                   ENDIF
      *   Past Due Notice 6
     C                   TESTB     '5'           F#APONI                  85
     C                   MOVEL     'N'           L2PDN6
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L2PDN6
     C                   ENDIF
      *   Past Due Notice 7
     C                   TESTB     '6'           F#APONI                  85
     C                   MOVEL     'N'           L2PDN7
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L2PDN7
     C                   ENDIF
      *   Past Due Notice 8
     C                   TESTB     '7'           F#APONI                  85
     C                   MOVEL     'N'           L2PDN8
     C     *IN85         IFEQ      *ON
     C                   MOVEL     'Y'           L2PDN8
     C                   ENDIF
      *
     C                   MOVE      F#AACTI       L2ACTI
     C                   MOVE      F#ACNFY       L2CNFY
     C                   MOVE      F#ATLXY       L2TLXY
     C                   MOVE      F#ACBLY       L2CBLY
     C                   MOVE      F#AINTC       L2INTC
     C                   MOVE      F#ANACD       L2NACD
     C                   MOVE      F#AACBI       L2ACBI
     C                   MOVE      F#AFCLB       L2FCLB
      *   Rebate
     C                   MOVE(P)   F#AREBT       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L2REBT
      *
     C                   MOVE      F#AFSGN       L2FSGN
     C                   MOVE      F#AFPRC       L2FPRC
      *   Cost of Funds Amount
     C                   MOVE(P)   F#ACOFA       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L2COFA
      *
     C                   MOVE      F#AIRCF       L2IRCF
     C                   MOVE      F#AFRCF       L2FRCF
     C                   MOVE      F#AASTS       L2ASTS
     C                   MOVE      F#APCRF       L2PCRF
     C                   MOVE      F#AMNSG       L2MNSG
     C                   MOVE      F#AGASS       L2GASS
     C                   MOVE      F#AGPRT       L2GPRT
     C                   MOVE      F#APDGN       L2PDGN
     C                   MOVE      F#AGRIN       L2GRIN
     C                   MOVE      F#ARLCY       L2RLCY
      *                                                                                       CEU030
     C     CEU004        IFEQ      'Y'                                                        CEU030
     C                   MOVE      F#ASCCY       L2SCCY                                       CEU030
     C                   MOVE      F#AICCY       L2ICCY                                       CEU030
     C                   ENDIF                                                                CEU030
      *                                                                                       CLE031
     C                   IF        CLE031 = 'Y'                                               CLE031
      *                                                                                       CLE031
      * (Receive) Settlement Currency                                                         CLE031
     C                   EVAL      L2SCCY = F#ASCCY                                           CLE031
      *                                                                                       CLE031
      * Receive Settlement Currency Exchange Rate                                             CLE031
     C                   Z-ADD     8             ZADEC                                        CLE031
     C                   MOVE      *BLANKS       ZFIELD                                       CLE031
     C                   MOVE      F#AREXR       ZFIELD                                       CLE031
     C                   EXSR      ZEDIT                                                      CLE031
     C                   MOVE      ZFIELD        L2REXR                                       CLE031
      *                                                                                       CLE031
      * Receive Settlement Currency Exchange Rate Indicator                                   CLE031
     C                   EVAL      L2REXI = F#AREXI                                           CLE031
      *                                                                                       CLE031
      * Pay Settlement Currency                                                               CLE031
     C                   EVAL      L2PSCY = F#APSCY                                           CLE031
      *                                                                                       CLE031
      * Pay Settlement Currency Exchange Rate                                                 CLE031
     C                   Z-ADD     8             ZADEC                                        CLE031
     C                   MOVE      *BLANKS       ZFIELD                                       CLE031
     C                   MOVE      F#APEXR       ZFIELD                                       CLE031
     C                   EXSR      ZEDIT                                                      CLE031
     C                   MOVE      ZFIELD        L2PEXR                                       CLE031
      *                                                                                       CLE031
      * Pay Settlement Currency Exchange Rate Indicator                                       CLE031
     C                   EVAL      L2PEXI = F#APEXI                                           CLE031
     C                   ENDIF                                                                CLE031
                                                                                              CLE034
     C                   IF        CLE034 = 'Y'                                               CLE034
     C                   EVAL      L2STAL = F#ASTAL                                           CLE034
     C                   ENDIF                                                                CLE034
      *                                                                                       CEU030
     C                   MOVE      *BLANKS       L2FRCY                                       CLE036
     C                   MOVE      *BLANKS       L2FRAM                                       CLE036
     C                   MOVE      *BLANKS       L2FRAS                                       CLE036
     C                   MOVE      *BLANKS       L2FINT                                       CLE036
     C                   MOVE      *BLANKS       L2FINS                                       CLE036
     C                   MOVE      *BLANKS       L2FTXA                                       CLE036
     C                   MOVE      *BLANKS       L2FTXS                                       CLE036
     C                   MOVE      *BLANKS       L2FTOT                                       CLE036
     C                   MOVE      *BLANKS       L2FTOS                                       CLE036
     C                   MOVE      *BLANKS       L2FPEN                                       CLE036
     C                   MOVE      *BLANKS       L2FPES                                       CLE036
      *                                                                                       CLE036
      ** If System Value 'FacilityCcyRepayment' = 'Y', & this is a Past                       CLE036
      ** Due or Repayment in facility ccy, transfer the Fac Ccy values:                       CLE036
     C                   IF        F#AFRCY <> *BLANKS AND                                     CLE036
     C                             FREPAY = 'Y'                                               CLE036
     C                   IF        F#AAMTP = 'MR' OR F#AAMTP = 'RE'                           CLE036
     C                             OR F#AAMTP = 'PD'                                          CLE036
      *                                                                                       CLE036
      **  Loan Amendment in Facility Currency                                                 CLE036
     C                   EVAL      L2FRCY = F#AFRCY                                           CLE036
     C                   MOVE      F#AFRCY       W#CCY                                        CLE036
     C                   EXSR      GETNBDP                                                    CLE036
      *                                                                                       CLE036
      **  Facility Ccy Principal Repayment Amount                                             CLE036
     C                   MOVE(P)   F#AFRAM       ZFIELD                                       CLE036
     C                   Z-ADD     A6NBDP        ZADEC                                        CLE036
     C                   EXSR      ZEDIT                                                      CLE036
     C                   MOVE      ZFIELD        L2FRAM                                       CLE036
      *                                                                                       CLE036
      **  Facility Ccy Principal Repayment Amount Sign                                        CLE036
     C                   MOVE      '+'           L2FRAS                                       CLE036
     C     F#AFRAM       IFLT      *ZERO                                                      CLE036
     C                   MOVE      '-'           L2FRAS                                       CLE036
     C                   MULT      -1            F#AFRAM                                      CLE036
     C                   MOVE(P)   F#AFRAM       ZFIELD                                       CLE036
     C                   Z-ADD     A6NBDP        ZADEC                                        CLE036
     C                   EXSR      ZEDIT                                                      CLE036
     C                   MOVE      ZFIELD        L2FRAM                                       CLE036
     C                   ENDIF                                                                CLE036
      *                                                                                       CLE036
      **  Facility Ccy Interest Payment Amount                                                CLE036
     C                   MOVE(P)   F#AFINT       ZFIELD                                       CLE036
     C                   Z-ADD     A6NBDP        ZADEC                                        CLE036
     C                   EXSR      ZEDIT                                                      CLE036
     C                   MOVE      ZFIELD        L2FINT                                       CLE036
      *   Facility Ccy Interest Payment Amount Sign                                           CLE036
     C                   MOVE      '+'           L2FINS                                       CLE036
     C     F#AFINT       IFLT      *ZERO                                                      CLE036
     C                   MOVE      '-'           L2FINS                                       CLE036
     C                   MULT      -1            F#AFINT                                      CLE036
     C                   MOVE(P)   F#AFINT       ZFIELD                                       CLE036
     C                   Z-ADD     A6NBDP        ZADEC                                        CLE036
     C                   EXSR      ZEDIT                                                      CLE036
     C                   MOVE      ZFIELD        L2FINT                                       CLE036
     C                   ENDIF                                                                CLE036
      *                                                                                       CLE036
      **  Facility Ccy Total Repayment Amount                                                 CLE036
     C                   MOVE(P)   F#AFTOT       ZFIELD                                       CLE036
     C                   Z-ADD     A6NBDP        ZADEC                                        CLE036
     C                   EXSR      ZEDIT                                                      CLE036
     C                   MOVE      ZFIELD        L2FTOT                                       CLE036
      *   Facility Ccy Total Repayment Amount Sign                                            CLE036
     C                   MOVE      '+'           L2FTOS                                       CLE036
     C     F#AFTOT       IFLT      *ZERO                                                      CLE036
     C                   MOVE      '-'           L2FTOS                                       CLE036
     C                   MULT      -1            F#AFTOT                                      CLE036
     C                   MOVE(P)   F#AFTOT       ZFIELD                                       CLE036
     C                   Z-ADD     A6NBDP        ZADEC                                        CLE036
     C                   EXSR      ZEDIT                                                      CLE036
     C                   MOVE      ZFIELD        L2FTOT                                       CLE036
     C                   ENDIF                                                                CLE036
      *                                                                                       CLE036
      **  Facility Ccy Penalty Payment Amount                                                 CLE036
     C                   MOVE(P)   F#AFPEN       ZFIELD                                       CLE036
     C                   Z-ADD     A6NBDP        ZADEC                                        CLE036
     C                   EXSR      ZEDIT                                                      CLE036
     C                   MOVE      ZFIELD        L2FPEN                                       CLE036
      *   Facility Ccy Penalty Payment Amount Sign                                            CLE036
     C                   MOVE      '+'           L2FPES                                       CLE036
     C     F#AFPEN       IFLT      *ZERO                                                      CLE036
     C                   MOVE      '-'           L2FPES                                       CLE036
     C                   MULT      -1            F#AFPEN                                      CLE036
     C                   MOVE(P)   F#AFPEN       ZFIELD                                       CLE036
     C                   Z-ADD     A6NBDP        ZADEC                                        CLE036
     C                   EXSR      ZEDIT                                                      CLE036
     C                   MOVE      ZFIELD        L2FPEN                                       CLE036
     C                   ENDIF                                                                CLE036
      *                                                                                       CLE036
      **  Facility Ccy Withholding Tax Amount                                                 CLE036
     C                   MOVE(P)   F#AFTXA       ZFIELD                                       CLE036
     C                   Z-ADD     A6NBDP        ZADEC                                        CLE036
     C                   EXSR      ZEDIT                                                      CLE036
     C                   MOVE      ZFIELD        L2FTXA                                       CLE036
      *   Facility Ccy Withholding Tax Amount Sign                                            CLE036
     C                   MOVE      '+'           L2FTXS                                       CLE036
     C     F#AFTXA       IFLT      *ZERO                                                      CLE036
     C                   MOVE      '-'           L2FTXS                                       CLE036
     C                   MULT      -1            F#AFTXA                                      CLE036
     C                   MOVE(P)   F#AFTXA       ZFIELD                                       CLE036
     C                   Z-ADD     A6NBDP        ZADEC                                        CLE036
     C                   EXSR      ZEDIT                                                      CLE036
     C                   MOVE      ZFIELD        L2FTXA                                       CLE036
     C                   ENDIF                                                                CLE036
     C                   ENDIF                                                                CLE036
     C                   ENDIF                                                                CLE036
      * Move message format
     C                   EVAL      W#L2MF=%SUBST(DWL2MF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#L2MF
     C                   ADD       W#BTML        W#MPOS
      *
      * Format Risk Participants/Assignments
     C     X1MSGT        WHENEQ    'DLRA'
      *
      * Access Currency Codes for decimal places for
      *  Participant/Assignment Currency
     C                   MOVE      F#PCCY        W#CCY
     C                   EXSR      GETNBDP
      *
     C                   MOVE      F#PCNUM       L3CNUM
     C                   MOVE      F#PFACT       L3FACT
     C                   MOVE      F#PFCNO       L3FCNO
     C                   MOVE      F#PMNUM       L3MNUM
     C                   MOVE      F#PINUM       L3INUM
      *   Joining or Assignment Date
     C                   Z-ADD     F#PJDTE       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L3JDTE
     C                   MOVEL     W#DATE8       L3JDTE
      *   Value Date
     C                   Z-ADD     F#PVDTC       W#ZDAYN
     C                   EXSR      ZZA0140
     C*****              MOVEL     W#ZDATE8      L3VDTC
     C                   MOVEL     W#DATE8       L3VDTC
      *
     C                   MOVE      F#PSHTP       L3SHTP
      *   Syndicate or Assigned Share Percentage
     C                   MOVE(P)   F#PSHPC       ZFIELD
     C                   Z-ADD     12            ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L3SHPC
      *   Syndicate or Assigned Share Amount
     C                   MOVE(P)   F#PSHAM       ZFIELD
     C                   Z-ADD     A6NBDP        ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L3SHAM
      *
     C     F#PFEBR       IFNE      *ZEROS
     C                   MOVE      F#PFEBR       L3FEBR
     C                   ELSE
     C                   MOVE      *BLANKS       L3FEBR
     C                   ENDIF
      *
     C                   MOVE      F#PFERS       L3FERS
      *   Fee Rate/Spread
     C                   MOVE(P)   F#PFERA       ZFIELD
     C                   Z-ADD     7             ZADEC
     C                   EXSR      ZEDIT
     C                   MOVE      ZFIELD        L3FERA
      *
     C                   MOVE      F#PDRTP       L3DRTP
     C                   MOVE      F#PDRST       L3DRST
     C                   MOVE      F#PPSTM       L3PSTM
      *   Pay Our Nostro
     C                   EVAL      L3PONS=       F#POMDB + F#PPONS
      *
     C                   MOVE      F#PRVNO       L3RVNO
     C                   MOVE      F#PCVMR       L3CVMR
      *                                                                                       134495
     C*****F#PPOCN       IFNE      *ZEROS                                              134495 CSD027
     C     F#PPOCN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#PPOCN       L3POCN
     C                   ELSE                                                                 134495
     C                   MOVE      *BLANKS       L3POCN                                       134495
     C                   ENDIF                                                                134495
      *                                                                                       134495
     C*****F#PPOBN       IFNE      *ZEROS                                              134495 CSD027
     C     F#PPOBN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#PPOBN       L3POBN
     C                   ELSE                                                                 134495
     C                   MOVE      *BLANKS       L3POBN                                       134495
     C                   ENDIF                                                                134495
      *                                                                                       134495
     C                   MOVE      F#PRCRN       L3RCRN
     C                   MOVE      F#PRCRA       L3RCRA
     C                   MOVE      F#PPIBN       L3PIBN
     C                   MOVE      F#PPIBA       L3PIBA
     C                   MOVE      F#PAWBN       L3AWBN
     C                   MOVE      F#PAWBA       L3AWBA
     C                   MOVE      F#PBENN       L3BENN
     C                   MOVE      F#PBENA       L3BENA
     C                   MOVE      F#PRSTM       L3RSTM
      *   Receipt Our Nostro
     C                   EVAL      L3RONS=       F#POSDB + F#PRONS
      *
     C*****F#PROCN       IFNE      *ZEROS                                              134495 CSD027
     C     F#PROCN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#PROCN       L3ROCN
     C                   ELSE                                                                 134495
     C                   MOVE      *BLANKS       L3ROCN                                       134495
     C                   ENDIF                                                                134495
      *                                                                                       134495
     C*****F#PROBN       IFNE      *ZEROS                                              134495 CSD027
     C     F#PROBN       IFNE      *BLANKS                                                    CSD027
     C                   MOVE      F#PROBN       L3ROBN
     C                   ELSE                                                                 134495
     C                   MOVE      *BLANKS       L3ROBN                                       134495
     C                   ENDIF                                                                134495
      *                                                                                       134495
     C                   MOVE      F#PRIBN       L3RIBN
     C                   MOVE      F#PRIBA       L3RIBA
      *   Details of Payments
     C                   EVAL      L3DTP1=       F#PDTP1 +
     C                                           F#PDTP2 +
     C                                           F#PDTP3 +
     C                                           F#PDTP4
      *
     C                   MOVE      F#PDCHG       L3DCHG
      *   Bank to Bank Information
     C                   EVAL      L3BTB1=       F#PBTB1 +
     C                                           F#PBTB2 +
     C                                           F#PBTB3 +
     C                                           F#PBTB4 +
     C                                           F#PBTB5 +
     C                                           F#PBTB6
      *
     C                   MOVE      F#PPTAI       L3PTAI
     C                   MOVE      F#PBRCA       L3BRCA
     C                   MOVE      F#PCCY        L3CCY
     C                   MOVE      F#PPCRF       L3PCRF
      *                                                                                       CEU030
     C     CEU004        IFEQ      'Y'                                                        CEU030
     C                   MOVE      F#PSCCY       L3SCCY                                       CEU030
     C                   MOVE      F#PICCY       L3ICCY                                       CEU030
     C                   ENDIF                                                                CEU030
      *                                                                                       CLE031
     C                   IF        CLE031 = 'Y'                                               CLE031
      *                                                                                       CLE031
      * (Receive) Settlement Currency                                                         CLE031
     C                   EVAL      L3SCCY = F#PSCCY                                           CLE031
      *                                                                                       CLE031
      * Receive Settlement Currency Exchange Rate                                             CLE031
     C                   Z-ADD     8             ZADEC                                        CLE031
     C                   MOVE      *BLANKS       ZFIELD                                       CLE031
     C                   MOVE      F#PREXR       ZFIELD                                       CLE031
     C                   EXSR      ZEDIT                                                      CLE031
     C                   MOVE      ZFIELD        L3REXR                                       CLE031
      *                                                                                       CLE031
      * Receive Settlement Currency Exchange Rate Indicator                                   CLE031
     C                   EVAL      L3REXI = F#PREXI                                           CLE031
      *                                                                                       CLE031
      * Pay Settlement Currency                                                               CLE031
     C                   EVAL      L3PSCY = F#PPSCY                                           CLE031
      *                                                                                       CLE031
      * Pay Settlement Currency Exchange Rate                                                 CLE031
     C                   Z-ADD     8             ZADEC                                        CLE031
     C                   MOVE      *BLANKS       ZFIELD                                       CLE031
     C                   MOVE      F#PPEXR       ZFIELD                                       CLE031
     C                   EXSR      ZEDIT                                                      CLE031
     C                   MOVE      ZFIELD        L3PEXR                                       CLE031
      *                                                                                       CLE031
      * Pay Settlement Currency Exchange Rate Indicator                                       CLE031
     C                   EVAL      L3PEXI = F#PPEXI                                           CLE031
     C                   ENDIF                                                                CLE031
      * Move message format
     C                   EVAL      W#L3MF=%SUBST(DWL3MF:91:W#BTML)
     C                   EVAL      %SUBST(W#MFMT:W#MPOS:W#BTML)=W#L3MF
     C                   ADD       W#BTML        W#MPOS
      *
     C/COPY WNCPYSRC,LE2015C003
      *
      *
     C                   ENDSL
      *
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      **********************************************************************                  210696
      *   Check that associated facilities are present for each loan                          210696
      **********************************************************************                  210696
     C     CHKLOAN       BEGSR                                                                210696
      *                                                                                       210696
     C                   ADD       1             @Q                                           210696
     C                   MOVEL     'CHKLOAN'     STK(@Q)                                      210696
      *                                                                                       210696
     C                   MOVE      'Y'           LOANOK            1      99                  210696
     C     WKFAC         KLIST                                                                210696
     C**********         KFLD                    W#CNUM            6 0                 210696 CSD027
     C                   KFLD                    W#CNUM            6                          CSD027
     C                   KFLD                    W#FACT            3 0                        210696
     C                   KFLD                    W#FCNO            2 0                        210696
      *   Check primary facility                                                              210696
     C                   MOVE      F#LFCUS       W#CNUM                                       210696
     C                   MOVE      F#LFTYP       W#FACT                                       210696
     C                   MOVE      F#LFSEQ       W#FCNO                                       210696
     C     WKFAC         CHAIN     FCLTYL0                            90                      210696
     C     *IN90         IFEQ      *ON                                                        210696
     C                   MOVE      'N'           LOANOK                                       210696
     C                   ENDIF                                                                210696
      *                                                                                       210696
      *   Check funding participant facility if funding participant non-blank                 210696
     C*****F#LPTFC       IFNE      *ZEROS                                              210696 CSD027
     C     F#LPTFC       IFNE      *BLANKS                                                    CSD027
      *                                                                                       210696
     C                   MOVE      F#LPTFC       W#CNUM                                       210696
     C                   MOVE      F#LPTFT       W#FACT                                       210696
     C                   MOVE      F#LPTFN       W#FCNO                                       210696
     C     WKFAC         CHAIN     FCLTYL0                            90                      210696
     C     *IN90         IFEQ      *ON                                                        210696
     C                   MOVE      'N'           LOANOK                                       210696
     C                   ENDIF                                                                210696
     C                   ENDIF                                                                210696
     C                   MOVE      *BLANKS       STK(@Q)                                      210696
     C                   SUB       1             @Q                                           210696
      *                                                                                       210696
     C                   ENDSR                                                                210696
      **********************************************************************                  210749
      *   Check that associated facilities are present for each loan                          210749
      **********************************************************************                  210749
     C     CHKFCLTY      BEGSR                                                                210749
      *                                                                                       210749
     C                   ADD       1             @Q                                           210749
     C                   MOVEL     'CHKFCLTY'    STK(@Q)                                      210749
      *                                                                                       210749
     C                   MOVE      'Y'           FCLTYOK           1      99                  210749
      *                                                                                       210749
      *   Check primary facility if primary facility customer field                           210749
      *   is non-blank                                                                        210749
     C*****F#FPMFC       IFNE      *ZEROS                                              210749 CSD027
     C     F#FPMFC       IFNE      *BLANKS                                                    CSD027
      *                                                                                       210749
     C                   MOVE      F#FPMFC       W#CNUM                                       210749
     C                   MOVE      F#FPMFT       W#FACT                                       210749
     C                   MOVE      F#FPMFN       W#FCNO                                       210749
     C     WKFAC         CHAIN     FCLTYL0                            90                      210749
     C     *IN90         IFEQ      *ON                                                        210749
     C                   MOVE      'N'           FCLTYOK                                      210749
     C                   ENDIF                                                                210749
     C                   ENDIF                                                                210749
      *                                                                                       210749
      *   Check credit application facility if credit application                             210749
      *   facility customer is non-blank                                                      210749
     C*****F#FCANM       IFNE      *ZEROS                                              210749 CSD027
     C     F#FCANM       IFNE      *BLANKS                                                    CSD027
      *                                                                                       210749
     C                   MOVE      F#FCANM       W#CNUM                                       210749
     C                   MOVE      F#FCAFT       W#FACT                                       210749
     C                   MOVE      F#FCAFN       W#FCNO                                       210749
     C     WKFAC         CHAIN     FCLTYL0                            90                      210749
     C     *IN90         IFEQ      *ON                                                        210749
     C                   MOVE      'N'           FCLTYOK                                      210749
     C                   ENDIF                                                                210749
     C                   ENDIF                                                                210749
     C                   MOVE      *BLANKS       STK(@Q)                                      210749
     C                   SUB       1             @Q                                           210749
      *                                                                                       210749
     C                   ENDSR                                                                210749
      **********************************************************************
      *   Get Number of Decimal Places
      **********************************************************************
     C     GETNBDP       BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'GETNBDP '    STK(@Q)
      *
      *
      * Access Currency Codes for decimal places
     C     W#CCY         IFNE      WWKY3
     C                   CALL      'AOCURRR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*KEY'        WWOPTN            7
     C                   PARM      W#CCY         WWKY3             3
     C     SDCURR        PARM      SDCURR        DSSDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDCURRPD'    DBFILE
     C                   Z-ADD     78            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
     C                   ENDIF
      *
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      **********************************************************************
      *   Get Message Attributes
      **********************************************************************
     C     MSGATR        BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'MSGATR  '    STK(@Q)
      *
      *
     C     X1MSGT        CHAIN     LEDLLDPD                           88
     C     *IN88         IFEQ      *ON
     C                   MOVEL     X1MSGT        DBKEY
     C                   MOVEL     'LEDLLDPD'    DBFILE
     C                   Z-ADD     75            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      * Get number of entries per message
     C                   Z-ADD     BTNM          W#BTNM
      * Get entry length
     C                   Z-ADD     BTML          W#BTML
      * Get message length
     C                   EVAL      W#MLEN=       W#BTML*W#BTNM+90
     C                   IF        W#MLEN>       %size(W#MFMT)
     C                   MOVEL     X1MSGT        DBKEY
     C                   MOVEL     'LEDLLDPD'    DBFILE
     C                   Z-ADD     17            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      **********************************************************************
      *   Download Start and End Message Processing
      **********************************************************************
     C     DSTENMSG      BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'DSTENMSG'    STK(@Q)
      *
      *
      * Set message type
     C                   SELECT
      *   Static Data Start Message
     C     W#MODE        WHENEQ    'S'
     C     W#STEN        ANDEQ     'S'
      *     Message Type
     C                   MOVE      'SDST'        X1MSGT
      *     Message Header
     C                   MOVEL     W#USER        X1TRUS
     C                   MOVEL     W#WSID        X1TRWS
     C                   MOVE      W#X1ACTN      X1ACTN
     C                   MOVE      W#SYSDAT      X1TRDS
     C                   MOVE      W#X1TRTS      X1TRTS
      *
      *   Static Data End Message
     C     W#MODE        WHENEQ    'S'
     C     W#STEN        ANDEQ     'E'
     C                   MOVE      'SDED'        X1MSGT
      *
      *   If Standing Data and Lending files are to be down loaded set up
      *   continuation flag otherwise leave blank.
      *
     C     P#MODE        IFEQ      'B'
     C                   MOVEL(P)  'X'           X1BTNM
     C                   ELSE
     C                   MOVE      *BLANKS       X1BTNM
     C                   ENDIF
      *
      *   Lending Start Message
     C     W#MODE        WHENEQ    'L'
     C     W#STEN        ANDEQ     'S'
      *                                                                                       203561
      **Find*out*Midas*System*Phase***********************************                 203561 CCB020
      *                                                                                       203561
     C******LOCK         IN        MPHAS                                               203561 CCB020
     C**********         MOVE      PHASE         W#MPHAS                               203561 CCB020
     C**********         OUT       MPHAS                                               203561 CCB020
      *                                                                                       203561
     C*****W#MPHAS       IFEQ      'A'                                                 203561 CCB020
     C     COBST         IFEQ      '*NO'                                                      CCB020
      *     Message Type
     C                   MOVE      'DLST'        X1MSGT
     C                   ELSE                                                                 203561
     C                   MOVE      'DLSC'        X1MSGT                                       203561
     C                   ENDIF                                                                203561
      *     Message Header
     C                   MOVEL     W#USER        X1TRUS
     C                   MOVEL     W#WSID        X1TRWS
     C                   MOVE      W#X1ACTN      X1ACTN
     C                   MOVE      W#SYSDAT      X1TRDS
     C                   MOVE      W#X1TRTS      X1TRTS
     C                   MOVE      *BLANKS       X1CONT
      *
      *   Lending End Message
     C     W#MODE        WHENEQ    'L'
     C     W#STEN        ANDEQ     'E'
      *
      **If*Lending*only*download*need*bank*details*****************                           157759
      * If Lending download end message, always output bank details                           157759
      *
     C*****P#MODE        IFEQ      'L'                                                        157759
      *
     C                   MOVE      'BANK'        X1MSGT
      *
      * Format and populate data
     C                   MOVE      BJCNCD        S2CNCD
     C                   MOVE      BJCYCD        S2CYCD
     C                   MOVE      BJHOCY        S2HOCY
     C                   MOVE      BJLCCY        S2LCCY
     C                   MOVE      BJSBRC        S2SBRC
     C                   MOVE      BJCUST        S2CUST
     C                   MOVE      BJSLCD        S2SLCD
     C                   MOVE      BJDFIN        S2DFIN
     C                   MOVE      W#SYSDAT      S2SYDT
     C                   MOVE      W#DNWD        S2DNWD
     C                   MOVE      BJURPT        S2URPT
     C                   MOVE      W#EYD         S2EYD
     C                   MOVE      W#PEYD        S2PEYD
     C                   Z-ADD     BJBVPD        S2BVPD
      **Move*message*format****************************************                           157759
     C*****              MOVEL(P)  DWS2MF        W#MFMT                                       157759
      *
      * Use BANK format to set up fields for the download message format.
      * Then replace the message text just before the PUT with DLED.
      *
     C                   MOVE      *ON           *IN80
      *
      **Find*out*Midas*System*Phase***********************************                        CCB020
      *
     C******DTAARA       DEFINE                  MPHAS                                        CCB020
     C******LOCK         IN        MPHAS                                                      CCB020
     C**********         MOVE      PHASE         W#MPHAS           1                          CCB020
     C**********         OUT       MPHAS                                                      CCB020
      *
      * If not input cycle phase
      *
     C*****W#MPHAS       IFNE      'A'                                                        CCB020
     C     COBST         IFEQ      '*YES'                                                     CCB020
     C                   EXSR      SYSDAT
     C                   ENDIF
      *
      * Move message format                                                                   157759
     C                   MOVEL(P)  DWS2MF        W#MFMT                                       157759
     C*****              ENDIF                                                                157759
      *
     C******IN80         IFEQ      *OFF                                                       157759
     C*****              MOVE      'DLED'        X1MSGT                                       157759
     C*****              ENDIF                                                                157759
      *
     C                   MOVE      *BLANKS       X1CONT
      *
     C                   ENDSL
      *
      * Put Message
     C                   EXSR      PMQPUT
      *
     C                   MOVE      *OFF          *IN80
      *                                                                                       138354
      * If start message downloaded, set indicator.                                           138354
      *                                                                                       138354
     C     W#STEN        IFEQ      'S'                                                        138354
     C                   MOVEL     'Y'           @STRT             1                          138354
     C                   ENDIF                                                                138354
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      **********************************************************************
      *   Put Message Processing for multiple records
      **********************************************************************
     C     PMQPUTM       BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'PMQPUTM '    STK(@Q)
      *
      *
     C* Put message onto MQ message queue for each branch
     C                   Z-ADD     1             X
     C     W1AMQBU(X)    DOWNE     *BLANK
     C                   ADD       1             PUTCNT                                       154773
      *
      * Message Header reference and sequence no
     C                   MOVEL     W#BTTR        W1BTTR           12
     C                   EVAL      X1TNRF=       W#ABRCH(X) + W1BTTR
     C     11            SUBST(P)  X1TNRF        MDCID
     C                   MOVE      W1BTTR        X1TRSN
      * Message Header
     C                   MOVEL     DWX1MF        W#MFMT
      *
      * Report Options: no report required
     C                   Z-ADD     RONONE        MDREP
      * Message Type: message not requiring a reply
     C                   Z-ADD     MTDGRM        MDMT
      * Message Priority: default priority
     C                   Z-ADD     PRQDEF        MDPRI
      * Message Persistence: message is persistent
     C                   Z-ADD     PEPER         MDPER
      *
      *   Specify that Format name consists entirely of characters
      *
     C                   MOVEL     FMSTR         MDFMT
      *
      * Put message
     C                   CALL      'QMQM'
      * I: Call Id: Put message
      * I: Connection handle
      * I: Object handle
      * I: Message Descriptor:
      *      Report Options: no reports required
      *      Message Type: message not requiring a reply
      *      Message Priority: default priority
      *      Message Persistence: message is persistent
      * I: Put message options: use default values supplied
      * I: Length of the Message
      * I: Message Data
      * O: Completion code
      * O: Reason code
     C                   PARM      MQPUT         P#CID             9 0
     C                   PARM      W#HCONN       P#HCONN           9 0
     C                   PARM      W1AMQBH(X)    P#HOBJ            9 0
     C                   PARM                    MQMD
     C                   PARM                    MQPMO
     C                   PARM      W#MLEN        P#MLEN            9 0
     C                   PARM      W#MFMT        P#MFMT        32767
     C                   PARM      *ZERO         P#CCODE           9 0
     C                   PARM      *ZERO         P#RSCOD           9 0
      *   MQPUT failed?
     C     P#CCODE       IFNE      CCOK
     C                   MOVEL     MQPUT         DBKEY
     C                   MOVEL     'QMQM'        DBFILE
     C                   Z-ADD     8             DBASE
     C                   MOVE      *ON           *IN30
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Update next available transaction reference
     C                   ADD       1             W#BTTR
      * Next queue
     C                   ADD       1             X
      * Add delay after 60 Puts of 20 seconds                                                 154773
     C     PUTCNT        IFEQ      60                                                         154773
     C                   CALL      'QCMDEXC'                                                  154773
     C*********          PARM      SETDLY20      QCMD60           14                    154773CLE034
     C                   PARM      SETDLY        QCMD60           14                          CLE034
     C                   PARM      14            LENGTH           15 5                        154773
     C                   Z-ADD     0             PUTCNT                                       154773
     C                   ENDIF                                                                154773
     C                   ENDDO
      *
     C*
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      **********************************************************************
      *   Put Message Processing
      **********************************************************************
     C     PMQPUT        BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'PMQPUT  '    STK(@Q)
      *
      *
     C     X1MSGT        CHAIN     LEDLLDPD                           88
     C     *IN88         IFEQ      *ON
     C                   MOVEL     X1MSGT        DBKEY
     C                   MOVEL     'LEDLLDPD'    DBFILE
     C                   Z-ADD     76            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      * GetMessage length
     C                   Z-ADD     BTML          W#MLEN
     C                   ADD       90            W#MLEN
      *
      * If Lending only download, BANK details have been set up for DLED
      * message, replace current message text (BANK) with DLED.
      *
     C     *IN80         IFEQ      *ON
     C*****W#MPHAS       IFEQ      'A'                                                 203561 CCB020
     C     COBST         IFEQ      '*NO'                                                      CCB020
     C                   MOVE      'DLED'        X1MSGT
     C                   ELSE                                                                 203561
     C                   MOVE      'DLEC'        X1MSGT                                       203561
     C                   ENDIF                                                                203561
      *                                                                                       203561
     C                   ENDIF
      *
      * Delay the putting of SDED & DLED messages to allow the Static or
      * Lending message download to finish first.
      *
     C     X1MSGT        IFEQ      'SDED'
     C     X1MSGT        OREQ      'DLED'
     C     X1MSGT        OREQ      'DLEC'                                                     203561
      *
     C                   CALL      'QCMDEXC'
     C                   PARM      SETDLY        QCMD             13
     C                   PARM      13            LENGTH           15 5
      *
     C                   ENDIF
      *
      *
     C* Put Download message onto MQ message queue for each branch
     C                   Z-ADD     1             X
     C     W1AMQBU(X)    DOWNE     *BLANK
     C                   ADD       1             PUTCNT                                       154773
      *
      *   Message Header reference and sequence no
     C                   MOVEL     W#BTTR        W1BTTR           12
     C                   EVAL      X1TNRF=       W#ABRCH(X) + W1BTTR
     C     11            SUBST(P)  X1TNRF        MDCID
     C                   MOVE      W1BTTR        X1TRSN
     C                   CLEAR                   X1CONT
     C                   CLEAR                   X1BTML
      *
     C     X1MSGT        IFNE      'SDED'
     C                   CLEAR                   X1BTNM
     C                   ENDIF
      *
      *   Message Header
     C                   MOVEL     DWX1MF        W#MFMT
      *
      * Report Options: no report required
     C                   Z-ADD     RONONE        MDREP
      * Message Type: message not requiring a reply
     C                   Z-ADD     MTDGRM        MDMT
      * Message Priority: default priority
     C                   Z-ADD     PRQDEF        MDPRI
      * Message Persistence: message is persistent
     C                   Z-ADD     PEPER         MDPER
      *
      *   Specify that Format name consists entirely of characters
      *
     C                   MOVEL     FMSTR         MDFMT
      *
      * Put message
     C                   CALL      'QMQM'
      * I: Call Id: Put message
      * I: Connection handle
      * I: Object handle
      * I: Message Descriptor:
      *      Report Options: no reports required
      *      Message Type: message not requiring a reply
      *      Message Priority: default priority
      *      Message Persistence: message is persistent
      * I: Put message options: use default values supplied
      * I: Length of the Message
      * I: Message Data
      * O: Completion code
      * O: Reason code
     C                   PARM      MQPUT         P#CID             9 0
     C                   PARM      W#HCONN       P#HCONN           9 0
     C                   PARM      W1AMQBH(X)    P#HOBJ            9 0
     C                   PARM                    MQMD
     C                   PARM                    MQPMO
     C                   PARM      W#MLEN        P#MLEN            9 0
     C                   PARM      W#MFMT        P#MFMT        32767
     C                   PARM      *ZERO         P#CCODE           9 0
     C                   PARM      *ZERO         P#RSCOD           9 0
      *   MQPUT failed?
     C     P#CCODE       IFNE      CCOK
     C                   MOVEL     MQPUT         DBKEY
     C                   MOVEL     'QMQM'        DBFILE
     C                   Z-ADD     74            DBASE
     C                   MOVE      *ON           *IN30
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Update next available transaction reference
     C                   ADD       1             W#BTTR
      * Next queue
     C                   ADD       1             X
      * Add delay after 60 Puts of 20 seconds                                                 154773
     C     PUTCNT        IFEQ      60                                                         154773
     C                   CALL      'QCMDEXC'                                                  154773
     C                   PARM      SETDLY        QCMD             13                          CLE034
     C                   PARM      13            LENGTH           15 5                        CLE034
     C*******************PARM      SETDLY20      QCMD60           14                    154773CLE034
     C*******************PARM      14            LENGTH           15 5                  154773CLE034
     C                   Z-ADD     0             PUTCNT                                       154773
     C                   ENDIF                                                                154773
     C                   ENDDO
      *
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      **********************************************************************
      *   Set System Run Date & Date of Next Working Day
      **********************************************************************
     C     SYSDAT        BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'SYSDAT  '    STK(@Q)
      *
      * Retrieve COB new run day no. from Automatic COB control file
      *
     C     'A.COB '      CHAIN     CBAICDL1                           87
     C     *IN87         IFEQ      *ON
     C                   MOVEL     'A.COB'       DBKEY
     C                   MOVEL     'CBAICDL1'    DBFILE
     C                   Z-ADD     77            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Convert COB new run day and move to system run date field.
      *
     C                   Z-ADD     ABDBRN        W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#ZDATE8      S2SYDT
      *
      * Calculate date of next working day.
      *
     C                   Z-ADD     ABDBRN        ZDAYNO
     C                   Z-ADD     1             ZNRDYS
     C                   MOVE      BJLCCY        ZCCY
      *
     C                   CALL      'ZFWDT'
     C                   PARM                    ZDAYNO            5 0
     C                   PARM                    ZNRDYS            2 0
     C                   PARM                    ZDYNBR            5 0
     C                   PARM                    ZCCY              3
     C                   PARM                    ZLOC              3
      *
      * Convert date of next working day
      *
     C                   Z-ADD     ZDYNBR        W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#ZDATE8      S2DNWD
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      **********************************************************************
      *   Final Processing
      **********************************************************************
     C     FINAL         BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'FINAL   '    STK(@Q)
      *
      *
     C* Close the MQ bulk transfer queue for each branch
     C                   Z-ADD     1             X
     C     W1AMQBU(X)    DOWNE     *BLANK
      *
      * Close object
     C                   CALL      'QMQM'
      * I: Call Id: Close object
      * I: Connection handle
      * I: Object handle
      * I: Close options: No optional close processing
      * O: Completion code
      * O: Reason code
     C                   PARM      MQCLOS        P#CID             9 0
     C                   PARM      W#HCONN       P#HCONN           9 0
     C                   PARM      W1AMQBH(X)    P#HOBJ            9 0
     C                   PARM      CONONE        P#OPTS            9 0
     C                   PARM      *ZERO         P#CCODE           9 0
     C                   PARM      *ZERO         P#RSCOD           9 0
      *   MQCLOSE failed?
     C     P#CCODE       IFEQ      CCFAIL
     C                   MOVEL     MQCLOS        DBKEY
     C                   MOVEL     'QMQM'        DBFILE
     C                   Z-ADD     9             DBASE
     C                   MOVE      *ON           *IN30
     C                   EXSR      *PSSR
     C                   ENDIF
      * Next queue
     C                   ADD       1             X
     C                   ENDDO
      *
      * Disconnect queue manager
     C                   CALL      'QMQM'
      * I: Call Id: Disconnect queue manager
      * I: Connection handle
      * O: Completion code
      * O: Reason code
     C                   PARM      MQDISC        P#CID             9 0
     C                   PARM      W#HCONN       P#HCONN           9 0
     C                   PARM      *ZERO         P#CCODE           9 0
     C                   PARM      *ZERO         P#RSCOD           9 0
      *   MQDISC failed?
     C     P#CCODE       IFEQ      CCFAIL
     C                   MOVEL     MQDISC        DBKEY
     C                   MOVEL     'QMQM'        DBFILE
     C                   Z-ADD     10            DBASE
     C                   MOVE      *ON           *IN30
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Set next available transaction reference and update
      *  Bulk Transfer Control file
     C     '#BLK'        CHAIN     LEDLLDPD                           89
     C     *IN89         IFEQ      *ON
     C                   MOVEL     '#BLK'        DBKEY
     C                   MOVEL     'LEDLLDPD'    DBFILE
     C                   Z-ADD     65            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
     C                   Z-ADD     W#BTTR        BTTR
     C                   UPDATE    LEDLLDD0
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
      ** Write report for transaction                                                         147933
      *                                                                                       147933
     C                   EXSR      RCFP1                                                      147933
      *                                                                                       147933
     C                   ENDSR
      **********************************************************************
      *  Initialisation
      **********************************************************************
     C     INITIAL       BEGSR
      *
     C                   Z-ADD     1             @Q                3 0
     C                   Z-ADD     0             PUTCNT            2 0                        154773
     C                   MOVEL     'INITIAL   '  STK(@Q)
      *
      *
     C     *LIKE         DEFINE    P#MODE        W#MODE
     C     *LIKE         DEFINE    W#MODE        W#STEN
     C     *LIKE         DEFINE    A8BRCD        WWBRCD
     C     *LIKE         DEFINE    X             XSV
     C     *LIKE         DEFINE    X             XC
     C     *LIKE         DEFINE    P#HCONN       W#HCONN
     C     *LIKE         DEFINE    P#HOBJ        W#HOBJ
     C     *LIKE         DEFINE    X1ACTN        W#X1ACTN
     C     *LIKE         DEFINE    X1TRDS        W#SYSDAT
     C     *LIKE         DEFINE    W#SYSDAT      W#DNWD
     C     *LIKE         DEFINE    W#SYSDAT      W#EYD
     C     *LIKE         DEFINE    W#SYSDAT      W#PEYD
     C     *LIKE         DEFINE    X1TRTS        W#X1TRTS
     C     *LIKE         DEFINE    P#MLEN        W#MLEN
     C     *LIKE         DEFINE    DWS7MF        W#S7MF
     C     *LIKE         DEFINE    DWS8MF        W#S8MF
     C     *LIKE         DEFINE    DWS9MF        W#S9MF
     C     *LIKE         DEFINE    DWS0MF        W#S0MF
     C     *LIKE         DEFINE    DWSAMF        W#SAMF
     C     *LIKE         DEFINE    DWSBMF        W#SBMF
     C     *LIKE         DEFINE    DWSCMF        W#SCMF
     C     *LIKE         DEFINE    DWSDMF        W#SDMF
     C     *LIKE         DEFINE    DWSEMF        W#SEMF
     C     *LIKE         DEFINE    DWSFMF        W#SFMF
     C     *LIKE         DEFINE    DWSGMF        W#SGMF
     C     *LIKE         DEFINE    DWSHMF        W#SHMF
     C     *LIKE         DEFINE    DWSIMF        W#SIMF
     C     *LIKE         DEFINE    DWSJMF        W#SJMF
     C     *LIKE         DEFINE    DWSKMF        W#SKMF
     C     *LIKE         DEFINE    DWSLMF        W#SLMF
     C     *LIKE         DEFINE    DWSMMF        W#SMMF
     C     *LIKE         DEFINE    DWSNMF        W#SNMF
     C     *LIKE         DEFINE    DWSOMF        W#SOMF
     C     *LIKE         DEFINE    DWSPMF        W#SPMF
     C     *LIKE         DEFINE    DWSQMF        W#SQMF
     C     *LIKE         DEFINE    DWSRMF        W#SRMF
     C     *LIKE         DEFINE    DWSSMF        W#SSMF
     C     *LIKE         DEFINE    DWSTMF        W#STMF
     C     *LIKE         DEFINE    DWSUMF        W#SUMF
     C     *LIKE         DEFINE    DWSBMF        W#SXMF
     C     *LIKE         DEFINE    DWL0MF        W#L0MF
     C     *LIKE         DEFINE    DWL1MF        W#L1MF
     C     *LIKE         DEFINE    DWL2MF        W#L2MF
     C     *LIKE         DEFINE    DWL3MF        W#L3MF
     C     *LIKE         DEFINE    DWL4MF        W#L4MF
     C     *LIKE         DEFINE    DWL5MF        W#L5MF
     C     *LIKE         DEFINE    DWL6MF        W#L6MF
     C     *LIKE         DEFINE    DWL7MF        W#L7MF
     C     *LIKE         DEFINE    DWL8MF        W#L8MF                                       CLE034
     C     *LIKE         DEFINE    DWSWMF        W#USMF
     C     *LIKE         DEFINE    DWSYMF        W#SYMF                         CLE031
     C     *LIKE         DEFINE    BTNM          W#NOREC
     C     *LIKE         DEFINE    BTNM          W#NOREC1
     C     *LIKE         DEFINE    BTNM          W#BTNM
     C     *LIKE         DEFINE    BTML          W#BTML
     C     *LIKE         DEFINE    BTTR          W#BTTR
     C     *LIKE         DEFINE    BJCYCD        W#CCY
     C     *LIKE         DEFINE    A6NBDP        W#CCYDP
     C     *LIKE         DEFINE    A6NBDP        W#FCCYDP
     C     *LIKE         DEFINE    A6NBDP        W#NCCYDP
     C     *LIKE         DEFINE    A6NBDP        W#LCCYDP
     C     *LIKE         DEFINE    DWL9MF        W#L9MF                                       CLE035
      *
     C                   MOVE      *OFF          *IN80
     C                   MOVE      *BLANKS       X1CONT
     C                   MOVE      *BLANKS       @STRT                                        138354
     C                   MOVE      *BLANKS       @FAIL                                        138354
      *
      * Set up copyright parameter
     C                   MOVEA     CPY@          MKI@             80
      *
      * Set up Database Error Details.
     C                   MOVEL     W#PGM         DBPGM
     C                   CLEAR                   DBFILE
     C                   CLEAR                   DBKEY
     C                   CLEAR                   DBASE
     C                   CLEAR                   @DUMP
      *
      * Retrieve Bank Details
     C                   CALL      'AOBANKR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C     SDBANK        PARM      SDBANK        DSFDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDBANKPD'    DBFILE
     C                   Z-ADD     1             DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
     C/COPY WNCPYSRC,LE2015MC03
      ** Check if CLE005 is switched *ON.
      *
     C                   MOVE      'N'           CLE005            1
     C                   CALL      'AOSARDR0'
     C                   PARM      *BLANKS       WWRTCD
     C                   PARM      '*VERIFY'     WWOPTN
     C                   PARM      'CLE005'      WWSARD            6
     C     SCSARD        PARM      SCSARD        DSFDY
      *
     C     WWRTCD        IFEQ      *BLANKS
     C                   MOVE      'Y'           CLE005
     C                   ELSE
     C     WWRTCD        IFNE      '*NRF   '
     C                   MOVEL     'CLE005'      DBKEY
     C                   MOVE      'SCSARDPD'    DBFILE
     C                   Z-ADD     79            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
     C                   ENDIF
      *
      ** If CLE005 is intalled, get the base currency's number
      ** of decimal places.
      *
     C     CLE005        IFEQ      'Y'
     C                   CALL      'AOCURRR0'
     C                   PARM      '*MSG'        WWRTCD            7
     C                   PARM      '*FIRST'      WWOPTN            7
     C                   PARM      BJCYCD        WWKY3             3
     C     SDCURR        PARM      SDCURR        DSSDY
      *
     C     WWRTCD        IFEQ      *BLANKS
     C                   MOVE      A6NBDP        WBCND             3 0
     C                   ELSE
     C                   MOVEL     WWKY3         DBKEY
     C                   MOVEL     'SDCURRPD'    DBFILE
     C                   Z-ADD     80            DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
     C                   ENDIF
      *
      * All  Branches?
     C                   Z-ADD     *ZERO         X                 2 0
     C     P#BRANCH      IFEQ      *BLANKS
      *
      * Retrieve first branch
     C***********        CALL      'AOBRCHR0'
     C                   CALL      'AOBRCHR1'
     C                   PARM      '*MSG'        WWRTCD
     C                   PARM      '*FIRST'      WWOPTN
     C                   PARM      *BLANKS       WWBRCD
     C     SDBRCH        PARM      SDBRCH        DSSDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C                   MOVEL     '*FIRST'      DBKEY
     C                   MOVEL     'SDBRCHPD'    DBFILE
     C                   Z-ADD     2             DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      *
     C     WWRTCD        DOWEQ     *BLANKS
      * Add to branch array
     C                   ADD       1             X                 2 0
     C                   MOVEL     A8BRCD        W#ABRCH(X)
     C                   MOVEL     A8MQBU        W#AMQBU(X)
      *
      * Retrieve next branch
     C***********        CALL      'AOBRCHR0'
     C                   CALL      'AOBRCHR1'
     C                   PARM      '*MSG'        WWRTCD
     C                   PARM      '*NEXT '      WWOPTN
     C                   PARM      *BLANKS       WWBRCD
     C     SDBRCH        PARM      SDBRCH        DSSDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C     WWRTCD        ANDNE     '*EOF'
     C                   MOVEL     '*NEXT '      DBKEY
     C                   MOVEL     'SDBRCHPD'    DBFILE
     C                   Z-ADD     3             DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
     C*
     C                   ENDDO
     C                   ELSE
      *
      * Retrieve specified branch
     C***********        CALL      'AOBRCHR0'
     C                   CALL      'AOBRCHR1'
     C                   PARM      '*MSG'        WWRTCD
     C                   PARM      '*KEY  '      WWOPTN
     C                   PARM      P#BRANCH      WWBRCD
     C     SDBRCH        PARM      SDBRCH        DSSDY
      *   Error?
     C     WWRTCD        IFNE      *BLANKS
     C                   MOVEL     '*KEY  '      DBKEY
     C                   MOVEL     'SDBRCHPD'    DBFILE
     C                   Z-ADD     4             DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      * Add to branch array
     C                   ADD       1             X
     C                   MOVEL     A8BRCD        W#ABRCH(X)
     C                   MOVEL     A8MQBU        W#AMQBU(X)
     C                   ENDIF
      * Save value of last branch in array
     C                   Z-ADD     X             XSV
      *
      *                                                                                       CEU030
     C                   MOVE      'N'           CEU004            1                          CEU030
     C                   CALL      'AOSARDR0'                                                 CEU030
     C                   PARM      *BLANKS       WWRTCD                                       CEU030
     C                   PARM      '*VERIFY'     WWOPTN                                       CEU030
     C                   PARM      'CEU004'      WWSARD            6                          CEU030
     C     SCSARD        PARM      SCSARD        DSFDY                                        CEU030
      *                                                                                       CEU030
     C     WWRTCD        IFEQ      *BLANKS                                                    CEU030
     C                   MOVE      'Y'           CEU004                                       CEU030
     C                   ELSE                                                                 CEU030
     C     WWRTCD        IFNE      '*NRF   '                                                  CEU030
     C                   MOVEL     'CEU004'      DBKEY                                        CEU030
     C                   MOVE      'SCSARDPD'    DBFILE                                       CEU030
     C                   Z-ADD     80            DBASE                                        CEU030
     C                   EXSR      *PSSR                                                      CEU030
     C                   ENDIF                                                                CEU030
     C                   ENDIF                                                                CEU030
      *                                                                                       CLE011
      ** Check if Rollover Rate Fixng Day Enhancement (CLE011) is installed                   CLE011
      *                                                                                       CLE011
     C                   CALL      'AOSARDR0'                                                 CLE011
     C                   PARM      *BLANKS       WWRTCD                                       CLE011
     C                   PARM      '*KEY   '     WWOPTN                                       CLE011
     C                   PARM      'CLE011'      WWSARD                                       CLE011
     C     SCSARD        PARM      SCSARD        DSFDY                                        CLE011
      *                                                                                       CLE011
     C                   IF        WWRTCD = *BLANKS                                           CLE011
     C                   MOVE      'Y'           CLE011            1                          CLE011
     C                   ELSE                                                                 CLE011
     C                   MOVE      'N'           CLE011                                       CLE011
     C                   IF        WWRTCD <> '*NRF   '                                        CLE011
     C                   MOVEL     'CLE011'      DBKEY                                        CLE011
     C                   MOVEL     'SCSARDPD'    DBFILE                                       CLE011
     C                   Z-ADD     83            DBASE                                        CLE011
     C                   EXSR      *PSSR                                                      CLE011
     C                   ENDIF                                                                CLE011
     C                   ENDIF                                                                CLE011
      *                                                                                       CLE023
      ** Access SAR details to see if CLE023 - Lending Facility History                       CLE023
      ** Improvements is installed                                                            CLE023
      *                                                                                       CLE023
     C                   CALL      'AOSARDR0'                                                 CLE023
     C                   PARM      *BLANKS       WWRTCD                                       CLE023
     C                   PARM      '*KEY   '     WWOPTN                                       CLE023
     C                   PARM      'CLE023'      WWSARD                                       CLE023
     C     SCSARD        PARM      SCSARD        DSFDY                                        CLE023
      *                                                                                       CLE023
     C                   IF        WWRTCD = *BLANKS                                           CLE023
     C                   MOVE      'Y'           CLE023            1                          CLE023
     C                   ELSE                                                                 CLE023
     C                   MOVE      'N'           CLE023                                       CLE023
     C                   IF        WWRTCD <> '*NRF   '                                        CLE023
     C                   MOVEL     'CLE023'      DBKEY                                        CLE023
     C                   MOVEL     'SCSARDPD'    DBFILE                                       CLE023
     C                   Z-ADD     84            DBASE                                        CLE023
     C                   EXSR      *PSSR                                                      CLE023
     C                   ENDIF                                                                CLE023
     C                   ENDIF                                                                CLE023
      *                                                                                       CLE023
      ** Determine if Flat Rate Personal Loans (CLE028) is installed                          CLE028
      *                                                                                       CLE028
     C                   EVAL      CLE028 = 'N'                                               CLE028
     C                   CALL      'AOSARDR0'                                                 CLE028
     C                   PARM      *BLANKS       WWRTCD                                       CLE028
     C                   PARM      '*VERIFY'     WWOPTN                                       CLE028
     C                   PARM      'CLE028'      WWSARD                                       CLE028
     C     SCSARD        PARM      SCSARD        DSFDY                                        CLE028
      *                                                                                       CLE028
     C                   IF        WWRTCD = *BLANKS                                           CLE028
     C                   EVAL      CLE028 = 'Y'                                               CLE028
     C                   ELSE                                                                 CLE028
     C                   IF        WWRTCD <> '*NRF   '                                        CLE028
     C                   EVAL      DBKEY = 'CLE028'                                           CLE028
     C                   EVAL      DBFILE = 'SCSARDPD'                                        CLE028
     C                   EVAL      DBASE = 93                                                 CLE028
     C                   EXSR      *PSSR                                                      CLE028
     C                   ENDIF                                                                CLE028
     C                   ENDIF                                                                CLE028
      *                                                                                       CLE028
      *                                                                                       CLE031
      ** Access SAR details to see if CLE031 - Lending Enhancements                           CLE031
      ** is installed                                                                         CLE031
      *                                                                                       CLE031
     C                   EVAL      WWRTCD = *BLANKS                                           CLE031
      *                                                                                       CLE031
     C                   CALL      'AOSARDR0'                                                 CLE031
     C                   PARM      *BLANKS       WWRTCD                                       CLE031
     C                   PARM      '*KEY   '     WWOPTN                                       CLE031
     C                   PARM      'CLE031'      WWSARD                                       CLE031
     C     SCSARD        PARM      SCSARD        DSFDY                                        CLE031
      *                                                                                       CLE031
     C                   IF        WWRTCD = *BLANKS                                           CLE031
     C                   MOVE      'Y'           CLE031            1                          CLE031
     C                   ELSE                                                                 CLE031
     C                   MOVE      'N'           CLE031                                       CLE031
     C                   IF        WWRTCD <> '*NRF   '                                        CLE031
     C                   MOVEL     'CLE031'      DBKEY                                        CLE031
     C                   MOVEL     'SCSARDPD'    DBFILE                                       CLE031
     C                   Z-ADD     85            DBASE                                        CLE031
     C                   EXSR      *PSSR                                                      CLE031
     C                   ENDIF                                                                CLE031
     C                   ENDIF                                                                CLE031
      *                                                                         CLE033
      ** Access SAR details to see if CLE033 - Settlement method 9 is           CLE033
      ** installed                                                              CLE033
      *                                                                         CLE033
     C                   EVAL      WWRTCD = *BLANKS                             CLE033
      *                                                                         CLE033
     C                   CALL      'AOSARDR0'                                   CLE033
     C                   PARM      *BLANKS       WWRTCD                         CLE033
     C                   PARM      '*KEY   '     WWOPTN                         CLE033
     C                   PARM      'CLE033'      WWSARD                         CLE033
     C     SCSARD        PARM      SCSARD        DSFDY                          CLE033
      *                                                                         CLE033
     C                   IF        WWRTCD = *BLANKS                             CLE033
     C                   MOVE      'Y'           CLE033            1            CLE033
     C                   ELSE                                                   CLE033
     C                   MOVE      'N'           CLE033                         CLE033
     C                   IF        WWRTCD <> '*NRF   '                          CLE033
     C                   MOVEL     'CLE033'      DBKEY                          CLE033
     C                   MOVEL     'SCSARDPD'    DBFILE                         CLE033
     C                   Z-ADD     86            DBASE                          CLE033
     C                   EXSR      *PSSR                                        CLE033
     C                   ENDIF                                                  CLE033
     C                   ENDIF                                                  CLE033
                                                                                              CLE034
      ** Access SAR details to see if CLE034 is installed.                                    CLE034
                                                                                              CLE034
     C                   EVAL      WWRTCD = *BLANKS                                           CLE034
                                                                                              CLE034
     C                   CALL      'AOSARDR0'                                                 CLE034
     C                   PARM      *BLANKS       WWRTCD                                       CLE034
     C                   PARM      '*KEY   '     WWOPTN                                       CLE034
     C                   PARM      'CLE034'      WWSARD                                       CLE034
     C     SCSARD        PARM      SCSARD        DSFDY                                        CLE034
                                                                                              CLE034
     C                   IF        WWRTCD = *BLANKS                                           CLE034
     C                   MOVE      'Y'           CLE034            1                          CLE034
     C                   EVAL      *IN11 = *ON                                                CLE034
     C                   ELSE                                                                 CLE034
     C                   MOVE      'N'           CLE034                                       CLE034
     C                   EVAL      *IN11 = *OFF                                               CLE034
     C                   IF        WWRTCD <> '*NRF   '                                        CLE034
     C**********         MOVEL     'CLE033'      DBKEY                                 CLE034 CLE036
     C                   MOVEL     'CLE034'      DBKEY                                        CLE036
     C                   MOVEL     'SCSARDPD'    DBFILE                                       CLE034
     C                   Z-ADD     88            DBASE                                        CLE034
     C                   EXSR      *PSSR                                                      CLE034
     C                   ENDIF                                                                CLE034
     C                   ENDIF                                                                CLE034
                                                                                              CLE035
      ** Access SAR details to see if CLE035 is installed.                                    CLE035
                                                                                              CLE035
     C                   EVAL      WWRTCD = *BLANKS                                           CLE035
                                                                                              CLE035
     C                   CALL      'AOSARDR0'                                                 CLE035
     C                   PARM      *BLANKS       WWRTCD                                       CLE035
     C                   PARM      '*KEY   '     WWOPTN                                       CLE035
     C                   PARM      'CLE035'      WWSARD                                       CLE035
     C     SCSARD        PARM      SCSARD        DSFDY                                        CLE035
                                                                                              CLE035
     C                   IF        WWRTCD = *BLANKS                                           CLE035
     C                   MOVE      'Y'           CLE035                                       CLE035
     C                   EVAL      *IN12 = *ON                                                CLE035
     C                   ELSE                                                                 CLE035
     C                   MOVE      'N'           CLE035                                       CLE035
     C                   EVAL      *IN12 = *OFF                                               CLE035
     C                   IF        WWRTCD <> '*NRF   '                                        CLE035
     C                   MOVEL     'CLE035'      DBKEY                                        CLE035
     C                   MOVEL     'SCSARDPD'    DBFILE                                       CLE035
     C                   Z-ADD     89            DBASE                                        CLE035
     C                   EXSR      *PSSR                                                      CLE035
     C                   ENDIF                                                                CLE035
     C                   ENDIF                                                                CLE035
                                                                                              CLE036
      ** Access SAR details to see if CLE036 is installed.                                    CLE036
                                                                                              CLE036
     C                   EVAL      WWRTCD = *BLANKS                                           CLE036
                                                                                              CLE036
     C                   CALL      'AOSARDR0'                                                 CLE036
     C                   PARM      *BLANKS       WWRTCD                                       CLE036
     C                   PARM      '*KEY   '     WWOPTN                                       CLE036
     C                   PARM      'CLE036'      WWSARD                                       CLE036
     C     SCSARD        PARM      SCSARD        DSFDY                                        CLE036
                                                                                              CLE036
     C                   IF        WWRTCD = *BLANKS                                           CLE036
     C                   MOVE      'Y'           CLE036                                       CLE036
     C                   EVAL      *IN12 = *ON                                                CLE036
     C                   ELSE                                                                 CLE036
     C                   MOVE      'N'           CLE036                                       CLE036
     C                   EVAL      *IN12 = *OFF                                               CLE036
     C                   IF        WWRTCD <> '*NRF   '                                        CLE036
     C                   MOVEL     'CLE036'      DBKEY                                        CLE036
     C                   MOVEL     'SCSARDPD'    DBFILE                                       CLE036
     C                   Z-ADD     89            DBASE                                        CLE036
     C                   EXSR      *PSSR                                                      CLE036
     C                   ENDIF                                                                CLE036
     C                   ENDIF                                                                CLE036
      *                                                                                       CLE036
      * Check System Value FacilityCcyRepayment                                               CLE036
      ** Set up parameter so access object checks FacilityCcyRepayment                        CLE036
     C                   MOVE      *BLANKS       WPARM0                                       CLE036
     C                   MOVEL     'Facil'       WPARM1                                       CLE036
     C                   MOVEL     'ityCc'       WPARM2                                       CLE036
     C                   MOVEL     'yRepa'       WPARM3                                       CLE036
     C                   MOVEL     'yment'       WPARM4                                       CLE036
     C                   MOVEL     WPARM0        SVALK1                                       CLE036
      * Call Access object:                                                                   CLE036
     C                   CALL      'AOSVALR0'                                                 CLE036
     C                   PARM                    RTNCDE            7                          CLE036
     C                   PARM                    SVALK1           20                          CLE036
     C                   PARM                    SVAL1           200                          CLE036
     C                   PARM                    SVALK2           20                          CLE036
     C                   PARM                    SVAL2           200                          CLE036
     C                   PARM                    SVALK3           20                          CLE036
     C                   PARM                    SVAL3           200                          CLE036
     C                   PARM                    SVALK4           20                          CLE036
     C                   PARM                    SVAL4           200                          CLE036
     C                   PARM                    SVALK5           20                          CLE036
     C                   PARM                    SVAL5           200                          CLE036
     C                   PARM                    SVALK6           20                          CLE036
     C                   PARM                    SVAL6           200                          CLE036
     C                   PARM                    SVALK7           20                          CLE036
     C                   PARM                    SVAL7           200                          CLE036
     C                   PARM                    SVALK8           20                          CLE036
     C                   PARM                    SVAL8           200                          CLE036
     C                   PARM                    SVALK9           20                          CLE036
     C                   PARM                    SVAL9           200                          CLE036
     C                   PARM                    SVALK0           20                          CLE036
     C                   PARM                    SVAL10          200                          CLE036
      * If the system value is not found then issue a database error                          CLE036
     C     RTNCDE        IFNE      '      '                                                   CLE036
     C                   MOVEL     'SDSVALPD'    DBFILE                                       CLE036
     C                   Z-ADD     95            DBASE                                        CLE036
     C                   MOVEL     'SVALK1'      DBKEY                                        CLE036
     C                   EXSR      *PSSR                                                      CLE036
     C                   ELSE                                                                 CLE036
      * Isolate the first character of SVAL2 which = 'Y' or 'N'.                              CLE036
     C                   MOVEL     SVAL1         WRK01             1                          CLE036
     C     WRK01         IFEQ      'Y'                                                        CLE036
     C                   MOVE      'Y'           FREPAY            1                          CLE036
     C                   ELSE                                                                 CLE036
     C                   MOVE      'N'           FREPAY                                       CLE036
     C                   ENDIF                                                                CLE036
     C                   ENDIF                                                                CLE036
     C/COPY WNCPYSRC,LE2015MC06
      *
      * Connect to MQ Manager explicitly
     C                   CALL      'QMQM'
      * I: Call Id: Connect queue manager
      * I: Queue manager cleared to get the default queue manager
      * O: Connection handle
      * O: Completion code
      * O: Reason code
     C                   PARM      MQCONN        P#CID             9 0
     C                   PARM      *BLANKS       P#QMNAME         48
     C     W#HCONN       PARM      *ZERO         P#HCONN           9 0
     C                   PARM      *ZERO         P#CCODE           9 0
     C                   PARM      *ZERO         P#RSCOD           9 0
      *   MQConnect failed?
     C     P#CCODE       IFEQ      CCFAIL
     C                   MOVEL     MQCONN        DBKEY
     C                   MOVEL     'QMQM'        DBFILE
     C                   Z-ADD     5             DBASE
     C                   MOVE      *ON           *IN30
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      *
     C* Open MQ Bulk Transfer queue for each branch
     C                   Z-ADD     1             X
     C                   Z-ADD     0             XC                                           193083
     C                   DO        XSV           X
      *
     C* Bulk transfer queue already opened?
     C*******************Z-ADD     1             XC                                           193083
     C*****W1AMQBU(XC)***DOWNE     W#AMQBU(X)                                                 193083
     C*****W1AMQBU(XC)***ANDNE     *BLANK                                                     193083
     C     W#AMQBU(X)    IFNE      *BLANKS                                                    193083
     C     W#AMQBU(X)    LOOKUP    W1AMQBU                                84                  193083
     C                                                                                        193083
     C* If Lookup fails then download queue has not already been                              193083
     C* opened, so copy to array of opened queues and open it                                 193083
     C                                                                                        193083
     C     *IN84         IFEQ      *OFF                                                       193083
     C                   ADD       1             XC
     C*******************ENDDO                                                                193083
     C**No,*so*open*queue                                                                     193083
     C*****W1AMQBU(XC)***IFEQ      *BLANKS                                                    193083
      *
      * Object Name: MQ Bulk Transfer Queue Name
     C                   MOVEL     W#AMQBU(X)    ODON
     C                   MOVEL     W#AMQBU(X)    W1AMQBU(XC)
      * Object queue manager name: *blank denotes queue manager to
      *                            which the application is connected
     C                   CLEAR                   ODMN
      *
      * Open object
     C                   CALL      'QMQM'
      * I: Call Id: Open object
      * I: Connection handle
      * I: Object Descriptor:
      *      Object Name: MQ Bulk Transfer Queue Name
      *      Object queue manager name: *blank
      * I: MQOPEN Options: Open to put messages
      * O: Object handle
      * O: Completion code
      * O: Reason code
     C                   PARM      MQOPEN        P#CID             9 0
     C                   PARM      W#HCONN       P#HCONN           9 0
     C                   PARM                    MQOD
     C                   PARM      OOOUT         P#OPTS            9 0
     C     W#HOBJ        PARM      *ZERO         P#HOBJ            9 0
     C                   PARM      *ZERO         P#CCODE           9 0
     C                   PARM      *ZERO         P#RSCOD           9 0
      *   MQOPEN failed?
     C     P#RSCOD       IFNE      RCNONE
     C                   MOVEL     MQOPEN        DBKEY
     C                   MOVEL     'QMQM'        DBFILE
     C                   Z-ADD     6             DBASE
     C                   MOVE      *ON           *IN30
     C                   EXSR      *PSSR
     C                   ENDIF
      *
      * Save Object Handle
     C                   Z-ADD     W#HOBJ        W1AMQBH(XC)
      *
     C                   ENDIF
     C                   ENDIF                                                                193083
     C                   ENDDO
      *
      * Set Transaction Action
     C                   CLEAR                   W#X1ACTN
      *
      * Set System Date
      *   Convert Midas system date to DDMMYYYY or MMDDYYYY
     C                   Z-ADD     BJRDNB        W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#ZDATE8      W#SYSDAT
      *     Date of Next Working Day
     C                   Z-ADD     BJDNWD        W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#ZDATE8      W#DNWD
      *     End of Year Date
     C                   Z-ADD     BJEYD         W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#ZDATE8      W#EYD
      *     Previous End of Year Date
     C                   Z-ADD     BJPEYD        W#ZDAYN
     C                   EXSR      ZZA0140
     C                   MOVEL     W#ZDATE8      W#PEYD
      *
      * Set Timestamp
     C                   MOVE      '00000000'    W#X1TRTS
     C                   TIME                    W#TIME            6 0
     C                   MOVEL     W#TIME        W#X1TRTS
      *
      * Get Bulk Transfer Control Details
     C     '#BLK'        CHAIN     LEDLLDPD                           89
     C     *IN89         IFEQ      *ON
     C                   MOVEL     '#BLK'        DBKEY
     C                   MOVEL     'LEDLLDPD'    DBFILE
     C                   Z-ADD     7             DBASE
     C                   EXSR      *PSSR
     C                   ENDIF
      * Set next available transaction reference
     C                   Z-ADD     BTTR          W#BTTR
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C     CLE005        IFEQ      'Y'
     C                   Z-ADD     0             W5FACT            3 0
     C                   Z-ADD     0             W5FCNO            2 0
     C                   Z-ADD     0             W6FACT            3 0
     C                   Z-ADD     0             W6FCNO            2 0
     C                   ENDIF
      *
      ** Check if the system is in COB phase                                                  CCB020
      *                                                                                       CCB020
     C                   CALL      'CBC001001'                                                CCB020
     C                   PARM      *BLANKS       COBST             4                          CCB020
      *                                                                                       CCB020
     C/COPY WNCPYSRC,LE2015MC07
     C                   ENDSR
      **********************************************************************
      *  ZZA0140   - Convert dayno to DDMMYYYY or MMDDYYYY
      *
      * I: Run Day Number in W#ZDAYN  5N 0
      * I: Date Format in BJDFIN from BANK ICD
      * O: Date in W#ZDATE8F          8A
      **********************************************************************
     C     ZZA0140       BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'ZZA0140   '  STK(@Q)
      *
      * Convert Midas dayno
     C     W#ZDAYN       IFGT      *ZERO
      *
     C                   CALLB     'ZA0140M'
      * O: Return Code
      * I: Midas Day Number
      * I: Midas Date Format  D or M
      * O: Date DDMMYY or MMDDYY
      * O: Date DDMMMYY
      * O: Date YYYYMMDD
      * O: Date DDMMYYYY or MMDDYYYY
     C                   PARM      *BLANK        P#ZRTN            1
     C                   PARM      W#ZDAYN       P#ZDAYN           5 0
     C                   PARM      BJDFIN        P#ZDFMT           1
     C                   PARM      *ZERO         P#ZDATE           6 0
     C                   PARM      *BLANK        P#ZDATA           7
     C                   PARM      *ZERO         P#ZDAT8           8 0
     C     W#ZDATE8      PARM      *ZERO         P#ZDAT8F          8 0
      *
     C                   MOVEL     W#ZDATE8      W#DATE8
      *
     C                   ELSE
     C*****              MOVE      *ALL'0'       W#ZDATE8
     C                   MOVEL     *BLANKS       W#DATE8           8
     C                   ENDIF
      *
     C     *LIKE         DEFINE    P#ZDAYN       W#ZDAYN
     C     *LIKE         DEFINE    P#ZDAT8       W#ZDATE8
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      **********************************************************************
      *  ZEDIT     - Insert decimal point and zeros for numeric
      * I: Numeric field  16A
      * I: Decimal Places  2,0
      * O: Alphanumeric field 16A
      **********************************************************************
     C     ZEDIT         BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'ZEDIT     '  STK(@Q)
      *
      * Convert number to Alpha
     C                   CALLB     'ZAEDITM'
      *
      * I/O: Number in ZFIELD 16A
      * I:   Number of Decimal Places
     C     ZFIELD        PARM      ZFIELD        P#ZFIELD         16
     C                   PARM      ZADEC         P#ZADEC           2 0
     C     *LIKE         DEFINE    P#ZFIELD      ZFIELD
     C     *LIKE         DEFINE    P#ZADEC       ZADEC
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      *
      *****************************************************************                       138354
      *   Download Failed Processing                                                          138354
      *****************************************************************                       138354
     C     DOWNFAIL      BEGSR                                                                138354
      *                                                                                       138354
     C                   ADD       1             @Q                                           138354
     C                   MOVEL     'DOWNFAIL'    STK(@Q)                                      138354
     C                   MOVEL     'Y'           @FAIL             1                          138354
      *                                                                                       138354
      * Send Static Data End Message                                                          138354
     C     W#MODE        IFEQ      'S'                                                        138354
     C                   MOVE      'SDED'        X1MSGT                                       138354
     C                   ENDIF                                                                138354
      *                                                                                       138354
      * Send Lending End Message                                                              138354
     C     W#MODE        IFEQ      'L'                                                        138354
      *                                                                                       203561
      **Find*out*Midas*System*Phase************************************                203561 CCB020
      *                                                                                       203561
     C******LOCK         IN        MPHAS                                               203561 CCB020
     C**********         MOVE      PHASE         W#MPHAS                               203561 CCB020
     C**********         OUT       MPHAS                                               203561 CCB020
      *                                                                                       203561
     C*****W#MPHAS       IFEQ      'A'                                                 203561 CCB020
     C     COBST         IFEQ      '*NO'                                                      CCB020
     C                   MOVE      'DLED'        X1MSGT                                       138354
     C                   ELSE                                                                 203561
     C                   MOVE      'DLEC'        X1MSGT                                       203561
     C                   ENDIF                                                                203561
      *                                                                                       203561
     C                   ENDIF                                                                138354
      *                                                                                       138354
      * Put Message                                                                           138354
      *                                                                                       138354
     C     X1MSGT        CHAIN     LEDLLDPD                           88                      138354
     C     *IN88         IFEQ      *ON                                                        138354
     C                   MOVEL     X1MSGT        DBKEY                                        138354
     C                   MOVEL     'LEDLLDPD'    DBFILE                                       138354
     C                   Z-ADD     81            DBASE                                        138354
     C                   EXSR      *PSSR                                                      138354
     C                   ENDIF                                                                138354
      * GetMessage length                                                                     138354
     C                   Z-ADD     BTML          W#MLEN                                       138354
     C                   ADD       90            W#MLEN                                       138354
      *                                                                                       138354
     C* Put Download message onto MQ message queue for each branch                            138354
     C                   Z-ADD     1             X                                            138354
     C     W1AMQBU(X)    DOWNE     *BLANK                                                     138354
      *                                                                                       138354
      *   Message Header reference and sequence no                                            138354
     C                   MOVEL     W#BTTR        W1BTTR           12                          138354
     C                   EVAL      X1TNRF=       W#ABRCH(X) + W1BTTR                          138354
     C     11            SUBST(P)  X1TNRF        MDCID                                        138354
     C                   MOVE      W1BTTR        X1TRSN                                       138354
     C                   MOVEL(P)  'E'           X1BTNM                                       138354
     C                   CLEAR                   X1CONT                                       138354
     C                   CLEAR                   X1BTML                                       138354
      *                                                                                       138354
      *   Message Header                                                                      138354
     C                   MOVEL     DWX1MF        W#MFMT                                       138354
      *                                                                                       138354
      * Report Options: no report required                                                    138354
     C                   Z-ADD     RONONE        MDREP                                        138354
      * Message Type: message not requiring a reply                                           138354
     C                   Z-ADD     MTDGRM        MDMT                                         138354
      * Message Priority: default priority                                                    138354
     C                   Z-ADD     PRQDEF        MDPRI                                        138354
      * Message Persistence: message is persistent                                            138354
     C                   Z-ADD     PEPER         MDPER                                        138354
      *                                                                                       138354
      *   Specify that Format name consists entirely of characters                            138354
      *                                                                                       138354
     C                   MOVEL     FMSTR         MDFMT                                        138354
      *                                                                                       138354
     C                   CALL      'QMQM'                                                     138354
      * I: Call Id: Put message                                                               138354
      * I: Connection handle                                                                  138354
      * I: Object handle                                                                      138354
      * I: Message Descriptor:                                                                138354
      *      Report Options: no reports required                                              138354
      *      Message Type: message not requiring a reply                                      138354
      *      Message Priority: default priority                                               138354
      *      Message Persistence: message is persistent                                       138354
      * I: Put message options: use default values supplied                                   138354
      * I: Length of the Message                                                              138354
      * I: Message Data                                                                       138354
      * O: Completion code                                                                    138354
      * O: Reason code                                                                        138354
     C                   PARM      MQPUT         P#CID             9 0                        138354
     C                   PARM      W#HCONN       P#HCONN           9 0                        138354
     C                   PARM      W1AMQBH(X)    P#HOBJ            9 0                        138354
     C                   PARM                    MQMD                                         138354
     C                   PARM                    MQPMO                                        138354
     C                   PARM      W#MLEN        P#MLEN            9 0                        138354
     C                   PARM      W#MFMT        P#MFMT        32767                          138354
     C                   PARM      *ZERO         P#CCODE           9 0                        138354
     C                   PARM      *ZERO         P#RSCOD           9 0                        138354
      *   MQPUT failed?                                                                       138354
     C     P#CCODE       IFNE      CCOK                                                       138354
     C                   MOVEL     MQPUT         DBKEY                                        138354
     C                   MOVEL     'QMQM'        DBFILE                                       138354
     C                   Z-ADD     82            DBASE                                        138354
     C                   MOVE      *ON           *IN30                                        138354
     C                   EXSR      *PSSR                                                      138354
     C                   ENDIF                                                                138354
      *                                                                                       138354
      * Update next available transaction reference                                           138354
     C                   ADD       1             W#BTTR                                       138354
      * Next queue                                                                            138354
     C                   ADD       1             X                                            138354
     C                   ENDDO                                                                138354
      *                                                                                       138354
     C                   MOVE      *BLANKS       STK(@Q)                                      138354
     C                   SUB       1             @Q                                           138354
      *                                                                                       138354
     C                   ENDSR                                                                138354
      *                                                                                       138354
      *****************************************************************                       147933
      *   Printer File Processing                                                             147933
      *****************************************************************                       147933
     C     RCFP1         BEGSR                                                                147933
      *                                                                                       147933
     C                   ADD       1             @Q                                           147933
     C                   MOVEL     'RCFP1   '    STK(@Q)                                      147933
      *                                                                                       147933
     C                   OPEN      LE2015P1                                                   147933
      * Log report to RCF                                                                     147933
     C                   Z-ADD     SFNUM1        ZSNUM                                        147933
     C                   CALL      'ZSFILE'                                                   147933
     C                   PARM      *BLANKS       SEQ                                          147933
     C                   PARM      P#BRANCH      WPARM                                        147933
     C                   PARM                    SFILE1                                       147933
     C                   PARM                    ZSNUM                                        147933
     C                   PARM                    ZSERR                                        147933
     C     ZSERR         IFEQ      'Y'                                                        147933
     C                   SETON                                        U7U8LR                  147933
     C                   RETURN                                                               147933
     C                   ENDIF                                                                147933
      *                                                                                       147933
      * Print Header for Report                                                               147933
     C                   WRITE     HEADP1                                                     147933
      * Print Details                                                                         147933
     C                   WRITE     DETAIL                                                     147933
      *                                                                                       147933
     C                   MOVE      *BLANKS       STK(@Q)                                      147933
     C                   SUB       1             @Q                                           147933
      *                                                                                       147933
     C                   ENDSR                                                                147933
      *****************************************************************
      *   Audit File Processing
      *****************************************************************
     C     AUDIT         BEGSR
      *
     C                   ADD       1             @Q
     C                   MOVEL     'AUDIT   '    STK(@Q)
      *
     C                   OPEN      LE2015AU
      * Log audit report to RCF
     C                   Z-ADD     SFNUMU        ZSNUM             6 0
     C                   CALL      'ZSFILE'
     C                   PARM      *BLANKS       SEQ               5
     C                   PARM      *BLANKS       WPARM             3
     C                   PARM                    SFILEU
     C                   PARM                    ZSNUM
     C                   PARM                    ZSERR             1
     C     ZSERR         IFEQ      'Y'
     C                   SETON                                        U7U8LR
     C                   RETURN
     C                   ENDIF
      *
      * Print Header for Audit Report
     C                   WRITE     HEADAU
      * Print Database Error Details
     C                   WRITE     DBERROR
      *
     C                   MOVE      *BLANKS       STK(@Q)
     C                   SUB       1             @Q
      *
     C                   ENDSR
      *****************************************************************                       147933
      *   Subroutine to reconcile transaction amounts                                         147933
      *****************************************************************                       147933
     C     COUNTT        BEGSR                                                                147933
      *                                                                                       147933
     C                   ADD       1             @Q                                           147933
     C                   MOVEL     'COUNTT  '    STK(@Q)                                      147933
      *                                                                                       147933
     C                   SELECT                                                               147933
      *                                                                                       147933
      ** Number of Facilities Transactions as well as internal and                            147933
      ** Funding Participants.                                                                147933
      *                                                                                       147933
     C     X1MSGT        WHENEQ    'DLFC'                                                     147933
     C     F#FRECI       ANDNE     'R'                                                        154016
     C                   ADD       1             NUMFAC                                       147933
     C     F#FPRTR       IFEQ      'P'                                                        147933
     C                   ADD       1             NUMFUP                                       147933
     C                   ENDIF                                                                147933
     C     F#FPRTR       IFEQ      'I'                                                        147933
     C                   ADD       1             NUMINP                                       147933
     C                   ENDIF                                                                147933
      *                                                                                       147933
      ** Number of Risk Participants and Assignments.                                         147933
      *                                                                                       147933
     C     X1MSGT        WHENEQ    'DLRA'                                                     147933
     C     F#PPTAI       IFEQ      'R'                                                        147933
     C                   ADD       1             NUMRPT                                       147933
     C                   ENDIF                                                                147933
     C     F#PPTAI       IFEQ      'A'                                                        147933
     C                   ADD       1             NUMASS                                       147933
     C                   ENDIF                                                                147933
      *                                                                                       147933
      ** Number of Loans and Rollovers.                                                       147933
      *                                                                                       147933
     C     X1MSGT        WHENEQ    'DLLN'                                                     147933
     C     F#LRECI       ANDNE     'R'                                                        154016
     C                   ADD       1             NUMLON                                       147933
     C     F#LRIUS       IFNE      *BLANKS                                                    147933
     C                   ADD       1             NUMROL                                       147933
     C                   ENDIF                                                                147933
      *                                                                                       147933
      ** Number of Loans Amendments including Principal Increases,                            147933
      ** Principal Transfers, Base Rate Code Changes, Spread Changes,                         147933
      ** Loan Sub-Type Changes and Stop Start Accruals. As well as                            147933
      ** Repayments including Manual, Scheduled and Past Due.                                 147933
      *                                                                                       147933
     C     X1MSGT        WHENEQ    'DLLA'                                                     147933
     C     F#ARECI       ANDNE     'R'                                                        154016
     C                   SELECT                                                               147933
     C     F#AAMTP       WHENEQ    'PI'                                                       147933
     C                   ADD       1             NUMPRI                                       147933
     C                   ADD       1             NUMLOA                                       147933
     C     F#AAMTP       WHENEQ    'PF'                                                       147933
     C                   ADD       1             NUMPTR                                       147933
     C                   ADD       1             NUMLOA                                       147933
     C     F#AAMTP       WHENEQ    'BC'                                                       147933
     C                   ADD       1             NUMBRC                                       147933
     C                   ADD       1             NUMLOA                                       147933
     C     F#AAMTP       WHENEQ    'SC'                                                       147933
     C                   ADD       1             NUMSPC                                       147933
     C                   ADD       1             NUMLOA                                       147933
     C     F#AAMTP       WHENEQ    'LS'                                                       147933
     C                   ADD       1             NUMSTC                                       147933
     C                   ADD       1             NUMLOA                                       147933
     C     F#AAMTP       WHENEQ    'SA'                                                       147933
     C                   ADD       1             NUMSSA                                       147933
     C                   ADD       1             NUMLOA                                       147933
     C     F#AAMTP       WHENEQ    'MR'                                                       147933
     C                   ADD       1             NUMREP                                       147933
     C                   ADD       1             NUMMAN                                       147933
     C     F#AAMTP       WHENEQ    'RE'                                                       147933
     C                   ADD       1             NUMREP                                       147933
     C                   ADD       1             NUMSCH                                       147933
     C     F#AAMTP       WHENEQ    'PD'                                                       147933
     C                   ADD       1             NUMREP                                       147933
     C                   ADD       1             NUMPSD                                       147933
     C                   ENDSL                                                                147933
     C                   ENDSL                                                                147933
     C                   MOVE      *BLANKS       STK(@Q)                                      147933
     C                   SUB       1             @Q                                           147933
      *                                                                                       147933
     C                   ENDSR                                                                147933
      *****************************************************************
      *
      *  *PSSR - Exception error processing
      *      Calls - NONE
      *
      *****************************************************************
     C     *PSSR         BEGSR
     C                   Z-ADD     P#CCODE       P#CCODE1          9 0                        154773
     C                   Z-ADD     P#RSCOD       P#RSCOD1          9 0                        154773
      *                                                                                       138354
      *   If start message sent, send download failed message.                                138354
      *                                                                                       138354
     C     @STRT         IFEQ      'Y'                                                        138354
     C     @FAIL         ANDNE     'Y'                                                        138354
     C                   EXSR      DOWNFAIL                                                   138354
     C                   ENDIF                                                                138354
      *
      *   If an error has occurred within this program, update LDA, set
      *   error switches, dump program and return to calling program.
      *
     C     @DUMP         IFEQ      *BLANK
      *
      * Audit report required?
     C     DBFILE        IFNE      *BLANKS
     C                   EXSR      AUDIT
     C                   ENDIF
      *
     C                   DUMP
      *
     C                   MOVE      'Y'           @DUMP             1
     C                   SETON                                        U7U8LR
     C     *DTAARA       DEFINE    LDA           @LDA            256
     C     *LOCK         IN        @LDA
     C                   MOVE      DBERR         @LDA
     C                   OUT       @LDA
     C                   ENDIF
      *
     C                   RETURN
      *
     C                   ENDSR
      *****************************************************************
**  CPY@ - Copyright Statement
(c) Finastra International Limited 2001
