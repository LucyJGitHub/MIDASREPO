     H        1
      *****************************************************************
/*XBI *: OVRDBF FILE(LEIFACLX) TOFILE(LEIFACL2) SHARE(*NO)          : *                       CAP065
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Facility details maintenance')                *
      *****************************************************************
      *                                                               *
      *  Midas - Customer Lending Module                              *
      *                                                               *
      *  LE2020 - Facility Details Maintenance                        *
      *                                                               *
      ***Function:**This*program*can*be*run*in*one*of*four*modes:******                       CAP065
      *  Function:  This program can be run in one of five modes:     *                       CAP065
      *                1. Mode 'I' - Interactive - The program is     *
      *             called from the Midas Transaction Input menu.     *
      *             Data is processed via a screen in the normal way. *
      *                2. Mode 'R' - Record - The program is run      *
      *             interactively through a Midas test environment,   *
      *             and data is input via a screen as in mode 1.      *
      *             However, at the point when updates would be       *
      *             performed a record is written to a 'test harness' *
      *             physical file which will mirror exactly the       *
      *             screen contents.                                  *
      *                3. Mode 'P' - Play - The program is run        *
      *             interactively or in batch through a Midas test    *
      *             environment. Data is read in from the 'test       *
      *             harness' file written in mode 'R'. Updates will   *
      *             be done as in mode 'I'.                           *
      *                4. Mode 'B' - Batch - The program is run in    *
      *             batch, called by a communications control program.*
      *             Data which has been entered via a PC front end    *
      *             is received from a message queue and passed to    *
      *             the program as a parameter. Updates to the Midas  *
      *             database will be done as appropriate to the       *
      *             contents of the parameter and a message will be   *
      *             returned to the control program.                  *
      *                5. Mode 'F' - Fix mode - The program is run    *                       CAP065
      *             interactively from a menu item to repair invalid  *                       CAP065
      *             facilities stored on the invalid  facilities file *                       CAP065
      *             and then resubmit them                            *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. AR674226           Date 04Dec19               *
      *                 MD046248           Date 27Oct17               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR402546           Date 31Jul12               *
      *                 CLE064             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 257423             Date 28Oct08               *
      *                 257155             Date 14Oct08               *
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 224198             Date 07Jan04               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3644            Date 12Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 28Oct03               *
      *                 CAP074             Date 05Apr02               *
      *                 CAP073             Date 08Aug02               *
      *                 CLE029             Date 04Sep02               *
      *                 CLE034             Date 05May03               *
      *                 215775             Date 07Sep03               *
      *                 CSF002             Date 11Aug03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CLE028             Date 27Jun02               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 214894             Date 19Feb03               *
      *                 212023             Date 14Nov02               *
      *                 203201             Date 24Oct02               *
      *                 202456             Date 24Oct02               *
      *                 208485             Date 25Sep02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 205168             Date 02Sep02               *
      *                 204452             Date 02May02               *
      *                 204377             Date 26Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAP068             Date 25JUN02               *
      *                 CPK015             Date 10May02               *
      *                 CAP068             Date 02Apr02               *
      *                 CAP069             Date 02Apr02               *
      *                 CAP070             Date 06Mar02               *
      *                 CLE023             Date 19Nov01               *
      *                 CSC011             Date 01Nov01               *
      *                 CAP065             Date 22Aug01               *
      *                 202011             Date 06Feb02               *
      *                 194864             Date 06Feb02               *
      *                 199238             Date 28Dec01               *
      *                 199210             Date 20Dec01               *
      *                 200182             Date 20Dec01               *
      *                 194540             Date 29Nov01               *
      *                 188823             Date 02Nov01               *
      *                 192130             Date 27Sep01               *
      *                 192057             Date 26Sep01               *
      *                 194667             Date 19Dec01               *
      *                 195995             Date 04Sep01               *
      *                 193678             Date 23Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 194508             Date 19Jun01               *
      *                 CLE014             Date 20Mar01               *
      *                 191571             Date 23Apr01               *
      *                 190897             Date 18Apr01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 23May01               *
      *                 188373             Date 26Mar01               *
      *                 189598             Date 06Mar01               *
      *                 189577             Date 26Feb01               *
      *                 186795             Date 26Feb01               *
      *                 190134             Date 26Feb01               *
      *                 189572             Date 26Feb01               *
      *                 184900             Date 14Feb01               *
      *                 CLE011             Date 07Nov00               *
      *                 188824             Date 12Feb01               *
      *                 187855             Date 30Jan01               *
      *                 188931             Date 24Jan01               *
      *                 187784             Date 17Jan01               *
      *                 187199             Date 16Jan01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CRT004             DATE 04MAY00               *
      *                 183724             Date 10Nov00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 176943             Date 31Mar00               *
      *                 176399             Date 27Mar00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 171759             Date 13Dec99               *
      *                 171743             Date 03Dec99               *
      *                 170106             Date 09Nov99               *
      *                 169206             Date 25Oct99               *
      *                 168913             Date 18Oct99               *
      *                 167979             Date 24Sep99               *
      *                 165960             Date 17Aug99               *
      *                 165099             Date 30Jul99               *
      *                 162883             Date 29Jul99               *
      *                 161257             Date 28Jul99               *
      *                 CLE009             Date 10May99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 154991             Date 26Jul99               *
      *                 161256             Date 26May99               *
      *                 157744             Date 25May99               *
      *                 160627             Date 17May99               *
      *                 157580             Date 03May99               *
      *                 156999             Date 19Apr99               *
      *                 134031             Date 15Apr99               *
      *                 157579             Date 15Apr99               *
      *                 157587             Date 12Apr99               *
      *                 158180 (E44983)    Date 30Mar98               *
      *                 158179 (E44825)    Date 16Dec97               *
      *                 158177 (BT0506)    Date 10Apr98               *
      *                 158167 (BT0673)    Date 10Apr98               *
      *                 158163 (BT0670)    Date 13Apr98               *
      *                 158158 (BT0711)    Date 07May98               *
      *                 158151 (BT0712)    Date 07May98               *
      *                 158144 (BT0885)    Date 18Jun98               *
      *                 158019 (BT0746)    Date 21Aug98               *
      *                 157895             Date 25Mar99               *
      *                 157589             Date 22Mar99               *
      *                 156297             Date 03Mar99               *
      *                 154799             Date 24Feb99               *
      *                 CLE008             Date 10Dec98               *
      *                 155461             Date 18Feb99               *
      *                 155425             Date 17Feb99               *
      *                 155147             Date 18Feb99               *
      *                 155101             Date 10Feb99               *
      *                 153868             Date 29Jan99               *
      *                 153667             Date 04Feb99               *
      *                 151295             Date 18Feb99               *
      *                 150875             Date 11Jan99               *
      *                 149922             Date 12Jan99               *
      *                 148851             Date 13Jan99               *
      *                 148847             Date 10Feb99               *
      *                 148722             Date 18Feb99               *
      *                 148004             Date 25Nov98               *
      *                 146312             Date 02Nov98               *
      *                 145912             Date 23Nov98               *
      *                 145908             Date 28Oct98               *
      *                 144922             Date 13Oct98               *
      *                 144713             Date 26Oct98               *
      *                 144532             Date 09Oct98               *
      *                 143819             Date 02Oct98               *
      *                 143798             Date 15Oct98               *
      *                 143795             Date 15Oct98               *
      *                 143614             Date 28Sep98               *
      *                 142396             Date 25Feb99               *
      *                 141485             Date 18Feb99               *
      *                 141453             Date 17Feb99               *
      *                 135140             Date 10Feb99               *
      *                 133995             Date 10Feb99               *
      *                 133992             Date 10Feb99               *
      *                 133796             Date 10Feb99               *
      *                 133402             Date 09Feb99               *
      *                 133147             Date 08Feb99               *
      *                 132948             Date 05Feb99               *
      *                 132678             Date 05Feb99               *
      *                 126625             Date 03Mar98 (Re-open)     *
      *                 130237             Date 13Feb98               *
      *                 126625             Date 13Feb98               *
      *                 128945             Date 27Jan98               *
      *                 128952             Date 27Jan98               *
      *                 129409             Date 23Jan98               *
      *                 129296             Date 21Jan98               *
      *                 128950             Date 16Jan98               *
      *                 128949             Date 16Jan98               *
      *                 127641             Date 17Nov97               *
      *                 127650             Date 31Oct97               *
      *                 CLE005             Date 22May97               *
      *                 CLE006             Date 22May97               *
      *                 CLE007             Date 22May97               *
      *                 126296             Date 20Nov97               *
      *                 126274             Date 20Nov97               *
      *                 126246             Date 20Nov97               *
      *                 125714             Date 19Nov97               *
      *                 125558             Date 06Nov97               *
      *                 123857             Date 27Oct97               *
      *                 124485             Date 17Oct97               *
      *                 124484             Date 17Oct97               *
      *                 124116             Date 13Oct97               *
      *                 123998             Date 08Oct97               *
      *                 123907             Date 06Oct97               *
      *                 123789             Date 02Oct97               *
      *                 123117             Date 17Sep97               *
      *                 122631             Date 04SEP97               *
      *                 122630             Date 04SEP97               *
      *                 122629             Date 04SEP97               *
      *                 122627             Date 04SEP97               *
      *                 122624             Date 04SEP97               *
      *                 122620             Date 04SEP97               *
      *                 122619             Date 04SEP97               *
      *                 122618             Date 04SEP97               *
      *                 122617             Date 04SEP97               *
      *                 122616             Date 04SEP97               *
      *                 122105             Date 22AUG97               *
      *                 122052             Date 21AUG97               *
      *                 121783             Date 14AUG97               *
      *                 121855             Date 14AUG97               *
      *                 121754             Date 12AUG97               *
      *                 121758             Date 12AUG97               *
      *                 121762             Date 12AUG97               *
      *                 120988             Date 24Jul97               *
      *                 120881             Date 23Jul97               *
      *                 121029             Date 18JUL97               *
      *                 120720             Date 18JUL97               *
      *                 120717             Date 14JUL97               *
      *                 120525             Date 14JUL97               *
      *                 120136             Date 07JUL97               *
      *                 119925             Date 30JUN97               *
      *                 119892             Date 30JUN97               *
      *                 119883             Date 27JUN97               *
      *                 119591             Date 20JUN97               *
      *                 CLE004  *CREATE    Date 24JAN97               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  AR674226 - Manual transaction reached 999. Increase the size *
      *             of utilisation sequence no. and transaction       *
      *             sequence. (Child: AR674227)                       *
      *           - Applied for MD054782.                             *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR402546 - ORED field was changed in FCLTYFN if an amendment *
      *             was made via API. Ensure that ORED will only be   *
      *             updated during insert mode.                       *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c             *
      *           (Recompile)                                         *
      *  257423 - Various field validation error on batch mode entry. *
      *  257155 - API: LEFCTY creates facility with sequence number   *
      *           different from specified                            *
      *         - Apply fix X02788 and 226914                         *
      *         - Emergency fix for Facility Number corruption error  *
      *           for batch mode processing                           *
      *         - Allow user to enter Facility Sequence Number when   *
      *           inserting.                                          *
      *  CRE026 - Consumer Banking                                    *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  224198 - Always set the Participant Facility Indicator, PRTR *
      *           to blanks if non-syndicated.                        *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter Mismatch                                  *
      *  CAP074 - Lending API enhancements - Loans input.             *
      *  CAP073 - Conversion of MN inputs into modular structure to   *
      *           use as APIs. Facility input Transaction Details     *
      *  CLE029 - Addition of Severity code and Limit ID to FCLTYFM   *
      *  CLE034 - Settlement Allocations.                             *
      *  215775 - Defaulting of interest basis should be allowed in   *
      *           batch mode.                                         *
      *  CSF002 - Global layer.                                       *
      *           - Replace previous ZBACT* parameters with the new   *
      *             unique code.                                      *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enahancements to CAS001, CAS002 and CAS004          *
      *           (Recompile)                                         *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  214894 - Check for outstanding Manual Facility Utilisations  *
      *           and Facility Amendments before closing/reversing a  *
      *           facility (regardless of TRCA indicator). Improved   *
      *           text of error messages LEF0290 and LEF0291. Do not  *
      *           allow reversal of Credit Agreement even if tranches *
      *           have expired, as they might be reactivated later.   *
      *  212023 - DICB was not mapped from LEF1MFPD to screen fields  *
      *           because Syndications was off. DICB and lots more    *
      *           are not dependent on Syndications since CLE015.     *
      *  203201 - Amend fix 176943 to include processing for Amend.   *
      *  202456 - Participant facilities not closed correctly         *
      *  208485 - Drawing Type may not be removed if a live loan is   *
      *           currently connected to this facility.               *
      *  205168 - If Credit Agreement's multi-customer, multi-branch, *
      *           and multi-currency is 'N', then tranche's customer, *
      *           branch, and currency should match CA's.             *
      *  204452 - Recompiled due to changed PF/LEFEED.                *
      *  204377 - Release record lock after authorisation.            *
      *  CAP068 - Conversion of LE inputs into modular structure to   *
      *           use as APIs - Funding Participant details           *
      *         - Recompiled for changes to FCLTYFM and FCLTYFN.      *
      *  CPK015 - Correct formatting errors discovered in collection. *
      *         - Initialise Timestamp fields for WRITE operations.   *
      *  CAP068 - Conversion of LE inputs into modular structure to   *
      *           use as APIs - Funding Participant details           *
      *  CAP069 - Conversion of LE inputs into modular structure to   *
      *           use as APIs - Risk Participant details              *
      *  CAP070 - Conversion of LE inputs into modular structure to   *
      *           use as APIs - Assignments details                   *
      *  CLE023 - Lending Facilty History Improvements.               *
      *  CSC011 - 24x7 Midas Availability                             *
      *  CAP065 - Lending API enhancements - Facility Details         *
      *  202011 - The second screen is not shown, and the file is not *
      *           updated, if several facilities selected were        *
      *           selected from the subfile. When checking if a       *
      *           tranche would make a Credit Agreement be exceeded,  *
      *           convert tranche amounts to CA ccy correctly.        *
      *  194864 - Convert TR amount to CA ccy amount if TR ccy is not *
      *           equal to CA ccy to see if CA facility amount will   *
      *           be exceeded.                                        *
      *  199238 - Recompiled due to changes done to DSPF/LE2020DF. Do *
      *           not position cursor on fields which are nondisplay. *
      *  199210 - Recompiled due to changes done to DSPF/LE2020DF.    *
      *  200182 - New facility had 'run date' fields on FCLTYFN based *
      *           on facility ccy, so Facility Availability Enquiry   *
      *           showed rundate as third date in array. Fix is to use*
      *           local ccy rather than facility ccy.                 *
      *  194540 - The display does not show the negative facility amt *
      *           correctly. Pgm should use copy source ZFRPEDZ3      *
      *           (SR/ZFRPED) instead of ZEDITZ2l (SR/ZEDIT) to edit  *
      *           numeric field which considers negative amount.      *
      *           Applied fix 186837.                                 *
      *         - Facility amount was zeroised after amending the     *
      *           facility details.                                   *
      *  188823 - When LE-ICD has "Review all screen in Authorisation *
      *           mode" equal to 'Y' and the user pressed enter on the*
      *           last screen, the first screen is again displayed.   *
      *  192130 - Clear message queue even if CLE006 is off when      *
      *           amending/inserting tranches for correct display     *
      *           of messages.                                        *
      *  192057 - Display correct default value of CA exchange rate   *
      *           when CA and TR currencies are the same. Corrected   *
      *           also the comparison of currencies for display of    *
      *           correct messages for Exchange Rates and Amounts.    *
      *  194667 - Syndications (CLE006) is off but S3SYIN, S3ANUM &   *
      *           S3SYCP are input capable.  Add N17 to PR attribute  *
      *           of these fields                                     *
      *         - Loan administrator error indicator is set on when   *
      *           subfile is read first then insert a new record.     *
      *           Reset *IN67 after the READC operation.              *
      *         - "Req. Authorisation" fields is not available.       *
      *           Added the field to LE2020C1 format                  *
      *  195995 - Database error when authorising facility.  When the *
      *           LE-ICD has "Review all screens in Authorisation     *
      *           mode" equal to 'Y' (*IN88=1) validate screen 1.     *
      *  193678 - Incorrect hash totalling when closing/reversing a   *
      *           facility where FAMT is negative.                    *
      *  CAP065 - Lending API enhancements - Facility Details         *
      *  194508 - Facility has strange credit agreement exch rate     *
      *  CLE014 - Customer Driven Lending Enhancements                *
      *  191571 - If user rolls up to first screen again, after error *
      *           was found on the second screen, they get stuck &    *
      *           cannot get to second screen again. Amended 183724.  *
      *  190897 - Protect Last Availability Date by turning off *IN84 *
      *  CSD006 - Use long DS with SDBSRTPD.                          *
      *  188373 - Expired facility cannot be re-actived by extending  *
      *           the expiry date. Reversed fix 150875 only in LE2020 *
      *           but added a condition such that the expiry date     *
      *           should be greater than rundate.                     *
      *         - For active/live facilities during amendment the     *
      *           expiry date should be later than rundate.           *
      *  189598 - If '?' entered in Loan Administrator Id, then enter *
      *           selected account officer, it will go back to the    *
      *           previous screen.                                    *
      *  189577 - Issue WARNING LEF0323 if Tranche/Credit Agreement   *
      *           Ind. changed from 'TR' to '  ' or vice versa and    *
      *           a manual utilisation already exists.                *
      *  186795 - File out of balance with difference in hash totals. *
      *           Should initialise field ZAMT.                       *
      *  190134 - 189572 doesn't work in authorisation mode.          *
      *  189572 - Validation of amount of Tranche against Credit      *
      *           Agreement is done at wrong time and ignores ccy.    *
      *  184900 - Input fields are being cleared unconditionally.     *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
      *  188824 - Do not call window programs in batch mode.          *
      *  187855 - Expiry date of Tranche facility validated against   *
      *           the expiry dates of fees attached to the Credit     *
      *           Agreement facility.                                 *
      *  188931 - Do not display 'Rev. Cr. Date Changed' when         *
      *           inputting a new Facility.                           *
      *  187784 - Included checking for authority of action code and  *
      *           branch for selection of facilities.                 *
      *  187199 - Do not clear screen as this stops the ? processing  *
      *           from working correctly.                             *
      *  CRT004 - Cashier Midas TCP/IP interface.                     *
      *             Recompiled over SDBRCHPD Changes                  *
      *  183724 - Facility being authorised when screen rollup/down   *
      *           pressed instead of just F11. Also fixed rollup      *
      *           for action code 'A' amend and 'E' enquire.          *
      *  176943 - After authorising a facility the subfile is not     *
      *           updated with the correct facility status and        *
      *           remains 'Complete'.                                 *
      *  176399 - Second screen is not displayed upon enquiry.        *
      *  171759 - Error message LEF0263 displayed although the Credit *
      *           Agreement Exchange rate was correct, so save CA ccy.*
      *  171743 - Allowed to Close or Reverse a Facility with a       *
      *           Matured Loan against it.                            *
      *  170106 - Calculate exchange rate between Tranche ccy & Credit*
      *           Agreement ccy, even if CLE006 (syndications) is off.*
      *  169206 - If expiry date amended, default to Last Availability*
      *           Date unless AVLD different to old expiry date. If   *
      *           facility chosen from subfile, check if reactivated  *
      *           in AMENDS, so that AVLD cannot be greater than DTEX.*
      *  168913 - File updated twice - two facilities with different  *
      *           sequence numbers generated when only one was input. *
      *           Hook LE2020C011 was removed by this fix.            *
      *  167979 - Screen 2 is not displayed when CLE006 is off.       *
      *  165960 - If ICD flag for authorising facility is set to 'N', *
      *           facilities entered or amended should go automa-     *
      *           tically to authorised.                              *
      *  165099 - Closing Date not accepted when Expiry Date falls on *
      *           a holiday in Batch mode.                            *
      *  162883 - Wrong defaulting of participant fee indicator,      *
      *           causing non-agent facility to become agent.         *
      *  161257 - Incorrect defaulting of account officer when        *
      *           primary facility is syndicated and the bank is the  *
      *           agent                                               *
      *  CLE009 - LE I/C Swift Message Generation for Fees            *
      *           Recompiled due to changes in LEFEED                 *
      *  154991 - Expiry date of a Facility should not be less than   *
      *           the End dates of any Fees attached to it            *
      *  161256 - File controls on LE0300 incorrect                   *
      *  157744 - If Base rate code is entered, amount and sign       *
      *           are not mandatory                                   *
      *  160627 - Cannot get out of last screen when Enter is pressed *
      *  157580 - Recompile due to changes in LE2020DF.               *
      *  156999 - Default participant loan type/subtype will only     *
      *           be required if agent is bank; or agent is not bank  *
      *           and facility has funding participants.              *
      *  134031 - Risk part for tranche is not accepted               *
      *  157579 - Last Availability Date looks input capable in       *
      *           enquiry mode.                                       *
      *  157587 - When amending a facility on LE2020, the sign on the *
      *           the amount is defaulted to '+' and is highlighted   *
      *           as an error.                                        *
      *  158180 - FOOB ON THE FACILITIES FILE MAINTENANCE REPORT.
      *  158179 - FACILITY CLOSED EVEN THOUGH A CALL LOAN WITH        *
      *           A ZERO BALANCE EXISTED.                             *
      *  158177 - All transactions input through Midas must have      *
      *           a full PC reference                                 *
      *  158167 - No good reason for prohibiting change to facility / *
      *           commitment indicator, so remove restriction
      *  158163 - Must not be allowed to change a facility to a Credit*
      *           Agreement if it has oustanding loans                *
      *  158158 - Allow review date to remain in the past; it is      *
      *           quite legitimate if facility has not been reviewed  *
      *  158151 - It is wrong to reject Expiry Date as being in past  *
      *           if facility is expired - it makes any amendment     *
      *           to an expired facility impossible                   *
      *  158144 - Warning messages should be overridden in batch.     *
      *  158019 - Multi-ccy ind on the participant records must be    *
      *           the same as on the prime facility.                  *
      *  157895 - Unauthorised facilities cause database error if     *
      *           user is not authorised to branch.                   *
      *  157589 - If '?' in the default loan type/subtype, or in ac - *
      *           count customer field or in base rate, when program  *
      *           returns, it goes directly to window.                *
      *  156297 - Allow Last Availability Date field of reactivated   *
      *           facility to be updated.                             *
      *  154799 - Recompiled due to changes in /COPY,ZACCH            *
      *  151295 - Problems authorising repayment schedules            *
      *           Recompiled due to changes in ZCHKH                  *
      *  154799 - Recompiled due to changes in /COPY,ZACCH            *
      *  CLE008 - Switchable Feature For Loan Administrator Id        *
      *  155461 - Should not be able to enter a multi-customer,       *
      *           multi-currency and multi branch TR if CA is not.    *
      *  155425 - Tried to close an expired facility but got 'Record  *
      *           has been updated by another user' error message.    *
      *  155147 - Recompiled due to changes in LE2020DF.              *
      *  155101 - If Start date is a holiday, no warning on authorise *
      *  153868 - Can't reverese CA even if all tranches against it   *
      *           was reversed.                                       *
      *  153667 - Rollover type 'Z' should allow blank or 0 irregular *
      *           rollover period                                     *
      *  150875 - Amending an expired facility changes the RECI to be *
      *           live - i.e. removal of fix 123117.                  *
      *  149922 - Facility fails on validation on Expiry Date even    *
      *           when not amended.                                   *
      *  148851 - For TR, funding participants not defaulting from CA *
      *           at setup                                            *
      *  148847 - Screen handling/workflow is wrong after second      *
      *           screen.                                             *
      *  148722 - Availibility run date input incorrectly             *
      *  148004 - Warning message returned as a terminal error to     *
      *           Loan Manager.                                       *
      *  146312 - Input for a new facility resulted in a DB error.    *
      *  145912 - Rollup/Rolldown should be allowed.                  *
      *  145908 - Rebuild subfile if F5 pressed.                      *
      *  144922 - Continue processing if no unauthorised records      *
      *  144713 - New warning message displayed if expiry date of a   *
      *           facility is changed                                 *
      *  144532 - Tranche facilties accepted with expiry date later   *
      *           than expiry date of Credit Agreement facilty.       *
      *  143819 - Should have a warning msg when TR's exceed CA       *
      *  143798 - To be able to expire a facility that has 0 amount.  *
      *  143795 - Should be able to close a facility after the loan   *
      *           has matured                                         *
      *  143614 - Need to cope with a direct amendment of a           *
      *           participant facility on Loan Manager.               *
      *  142396 - Message seems to be saved when trying to close fac  *
      *  141485 - Don't get holiday warning when entering Tranche     *
      *           after CA                                            *
      *  141453 - Recompiled due to changes in PF/LEFEED              *
      *  135140 - Cannot enter Shrtname on Facility input for Credit/ *
      *           Agreement Customer.                                 *
      *  133995 - After enquiring on a closed facility you cannot     *
      *           insert a new facility.                              *
      *  133992 - Reversing a Tranche facility reports that there are *
      *           loans against the facility when none are entered.   *
      *  133796 - The warning messages are not working in LE2020.     *
      *  133402 - The validation for CAXR tolerance limits is wrong   *
      *  133147 - Able to change a CA agreement with no TR's to a TR  *
      *           and attach it to itself ie CA agreement facility is *
      *           itself.                                             *
      *  132948 - There is no validation done for facility tranches   *
      *           against credit agreement facilities for start date  *
      *           and facility amount.                                *
      *  132678 - Alt name/address and Account Seq no are not being   *
      *           received correctly from the PC.                     *
      *  126625 - If CLE007 is on Expiry date should not be amendable *
      *  130237 - Extra fields added to LEF1MFPD for Credit Agreement *
      *           Exchange rate.                                      *
      *  126625 - Able to amend a facility that has expired without   *
      *           any validation done for expiry date.                *
      *  128945 - Approval Date > start date message when it isn't    *
      *  128952 - Tranche details should default from the C/A         *
      *  129409 - Facility amount is being corrupted for a syndicated *
      *           facility during an amend.                           *
      *  129296 - Validation for account sequence number should only  *
      *           take place when CLE007 is on.                       *
      *  128950 - Must not delete a Credit Agreement with             *
      *           outstanding Tranches                                *
      *  128949 - Must not authorise a Tranche before the             *
      *           Credit Agreement                                    *
      *  127641 - Credit Agreement deleted though a loan is           *
      *           attached to one of its tranches.                    *
      *  127650 - Internal loan type/subtype must allow 69 and 72     *
      *  CLE005 - Customer Lending Enhancements - Tranche 3           *
      *  CLE006 - Customer Lending Enhancements - Syndications        *
      *  CLE007 - Customer Lending Enhancements - Others              *
      *  126296 - Extension of 124116: make sure that the committed   *
      *           date is not later than today.                       *
      *  126274 - The subfile review scrren should show the customer  *
      *           short name.                                         *
      *  126246 - Closing date should default to start date not,      *
      *           expiry date.                                        *
      *  125714 - Do not allow closed facilities to be amended from   *
      *           initial screen.                                     *
      *  125558 - ORED, CHTP, LCD corrupted on facility               *
      *  123857 - Additional authorisation option, to use F11 or go   *
      *           through all screens and pressing ENTER on the last  *
      *           screen.                                             *
      *  124485 - Expired facilities are not shown on subfile         *
      *  124484 - Can't close an expired facility                     *
      *  124116 - Allow committed date to be any date in the past     *
      *           but not later than start date.                      *
      *  123998 - Texts should be coming from message subfile         *
      *  123907 - Output syndication type on subfile                  *
      *  123789 - File out of balance                                 *
      *  123117 - Amending an expired facility does not change the    *
      *           RECI to be live.                                    *
      *  122631 - Files are not updated when CLE006 is off            *
      *  122630 - F12 from window should take you to previous screen  *
      *  122629 - On enquiry of a facility, window was not displayed  *
      *  122627 - Window program should only be called in record or   *
      *           interactive modes for reverse and close subroutines.*
      *  122624 - Validation of syndication complete incorrect        *
      *  122620 - LEF0091 erroneously issued even though LPAM blank   *
      *  122619 - File out of balance                                 *
      *  122618 - Cannot authorise funding participant facilities     *
      *  122617 - Only allow loan type/sub type for default part      *
      *           to be 66 or 67.                                     *
      *           If facility is non syndicated do not allow default  *
      *           part type to be entered.                            *
      *  122616 - Authorising user should not be the same as the      *
      *           Insert or Amendment user.                           *
      *  122105 - Facility number is returned as zero in the returned *
      *           message, but is needed for participant processing.  *
      *  122052 - Name of message file not set up correctly.          *
      *  121783 - Call new access object AOBRCHR1 instead of AOBRCHR0 *
      *           (uses the long data structure DSSDY)                *
      *  121855 - Length of s1cust is 10, so move left is required.   *
      *  121754 - F5 repositions to last page built on subfile        *
      *  121758 - Retrieve default interest calc basis for currency   *
      *           entered.                                            *
      *  121762 - For a multi-currency facility the permitted         *
      *           currencies are not shown for enquiry mode.          *
      *  120988 - When checking for record lock, use TNLU from FCLTYFM*
      *  120881 - Facility status should be set to 'A' when CLE002    *
      *           is off.                                             *
      *  121029 - Message text for validation of Last Avail date      *
      *           is wrong.                                           *
      *  120720 - Syndication complete problem.                       *
      *  120717 - Facility amount corrupted                           *
      *  120525 - Facility sequence number allocation.                *
      *  120136 - 1. When reversing/closing a facility in batch mode, *
      *           the check for existing participants is not needed.  *
      *           2. Set facility ind to 'A' if agent is the bank.    *
      *           3. In batch mode does not pick up correct no. of    *
      *           decimal places when doing an amend.                 *
      *           4. Include a DUMP in SRBERR subroutine for Batch    *
      *           and Play modes.                                     *
      *  119925 - Show facilty sequence number as part of the message *
      *  119892 - Rename SPARE to SPARF                               *
      *  119883 - Irregular rollover period - correction to           *
      *           default and validation.                             *
      *  119591 - Pad PCRF (PC transaction reference with blanks      *
      *         - Make base rate type  optional.                      *
      *  CLE004 - Customer Lending Enhancements - Tranche 2           *
      *           Replaces LE0020. Written for PC interface and       *
      *           syndications processing.                            *
      *                                                               *
      *****************************************************************
      *                                                               *
      *    F U N C T I O N   O F   I N D I C A T O R S                *
      *                                                               *
      *    01      Subfile display (SFLDSP)
      *    02      SFLEND(*MORE)
      *    03      Subfile clear (SLFCLR)
      *    04      SFLNXTCHG
      *    05      Message subfile
      *    06      No Records Found in Subfile
      *    07      Enquiry
      *    08      Amend Mode
      *    09      Insert Mode
      *    10      Authorise
      *    11      Reverse
      *    12      Close
      *    13      Multi-currency
      *    14      Multi-branch
      *    15      ROLLUP
      *    16      CLE005 (Tranch 3)
      *    17      CLE006 (Syndications)
      *    18      CLE007 (Enhanced Lending)
      *    19      Used for TESTN
      *    20      Customer in error
      *    21      facility type in error
      *    22      facility sequence number in error
      *    23      action in error
      *    24      review from in error
      *    25      requiring authorisation in error
      *    26      subfile selection in error
      *    27      branch code in error
      *    28      currency in error
      *    29      facility amount in error
      *    30      over-line % in error
      *    31      fcty/cmmt indicator in error
      *    32      date approved in error
      *    33      revolving credit in error
      *    34      multi currency indicator in error
      *    35      secured indicator in error
      *    36      expiry date in error
      *    37      country of risk in error
      *    38      multi customer indicator in error
      *    39      Alternative name/address in error
      *    40      Date of last financial statement in error
      *    41      Nominal rate in error
      *    42      Review date in error
      *    43      Frequency in error
      *    44      Frequency day numer in error
      *    45      Account officer in error
      *    46      Profit centre in error
      *    47      Originating branch in error
      *    48      Billing/telex indicator in error
      *    49      Billing days in error
      *    50      Account sequence number in error
      *    51      Multi branch indicator in error
      *    52      Syndication indicator in error
      *    53      Syndication complete indicator in error
      *    54      Agent customer number in error
      *    55      Drawing types in error
      *    56      Default interest basis in error
      *    57      Rollover types in error
      *    58      Irregular rollover period
      *    59      Currency selection in error
      *    60      Allowable currencies in error
      *    61      Date committed in error
      *    62      Closing date in error
      *    63      Last availability date in error
      *    64      Late payment penalty type in error
      *    65      Late payment penalty base rate in error
      *    66      Late payment penalty amount/spread in error
      *    67      Late payment penalty sign in error
      *    68      Default participation loan type/subtype in error
      *    69      CLE008 (Loan Administrator Id)                         CLE008
      *    70      Credit/Agreement Exchange Rate in error                CLE005
      *    71      Exchange Rate Indicator in error                       CLE005
      *    72      Tranche/Credit Agreement Indicator in error            CLE005
      *    73      Credit Agreement Customer in error                     CLE005
      *    74      Credit Agreement Type in error                         CLE005
      *    75      Credit Agreement Number in error                       CLE005
      *    76      ROLLDOWN                                               145912
      *    77      Protect loan administrator id field                    CLE008
      *    78      Protect selected fields if CLE005 and CLE007 are on    CLE005
      *    79      Facility has expired or is closed                      CLE005
      *    80      Used for CHAIN and READ
      *    81      Originating branch used
      *    82      Non display Rev. Cr. Date Changed
      *    83      Insert but not CF09
      *    83      Choose if Screen Title is 'Maintenance'or 'Repair'     CAP065
      *    84      Protect Profit centre
      *    85      Non display profit centre on screen
      *    86      Funding participant or internal facility
      *    87      Used for READC
      *    87      Loan Administrator Id in error                         CLE008
      *    88      F11 is not needed for authorisation                    123857
      *    88
      *    89      Message subfile
      *    90-99   Used by standard subroutine
      *****************************************************************
      *                   Index to subroutines                        *
      *                   ~~~~~~~~~~~~~~~~~~~~                        *
      *  INITPR  -  Initial processing                                *
      *  INTRCV  -  Process key input or review                       *
      *  REVIEW  -                                                    *
      *  KEYPRO  -  Key Input Processing                              *
      *  VLDACY  -  Validate key fields & action code                 *
      *  VLDKEY  -  Validate key fields                               *
      *  VLDAUT  -  Validate Authorisation                            *
      *  PROSEL  -  Process action                                    *
      *  VLDREV  -  Validate review from                              *
      *  BLDSFL  -  Build one subfile page                            *
      *  VLDSFL  -  Validate subfile                                  *
      *  VLDPOS  -  Validate Position fields                          *
      *  VLDSEL  -  Validate subfile selection                        *
      *  ENQRYS  -  Process Enquiry                                   *
      *  INSRTS  -  Process Insert                                    *
      *  AMENDS  -  Process Amend                                     *
      *  AUTHOS  -  Process Authorise                                 *
      *  RESRVS  -  Process Reverse                                   *
      *  CLOSES  -  Process Close                                     *
      *  POPSC1  -  Populate screen 1 fields                          *
      *  POPSC2  -  Populate screen 2 fields                          *
      *  DSPSC2  -  Display Screen 2                                  *
      *  VLDSC1  -  Validate Screen 1                                 *
      *  VLDBRC  -  Validate Branch                                   *
      *  VLDFCI  -  Validate Facility/Commitment indicator            *
      *  VLDCCY  -  Validate Currency                                 *
      *  VLDAMT  -  Validate Facility Amount                          *
      *  VLDOVP  -  Validate Ovel-line %                              *
      *  CLCAVA  -  Calculate Availability                            *
      *  VLDAPR  -  Validate date approved                            *
      *  VLDEXP  -  Validate Expiry Date                              *
      *  VLDRVI  -  Validate Revolving Indicator                      *
      *  VLDSCI  -  Validate Secured Indicator                        *
      *  VLDMCY  -  Validate Multi-currency Indicator                 *
      *  VLDMCU  -  Validate Multi-customer Indicator                 *
      *  VLDCRS  -  Validate Country of risk                          *
      *  VLDALT  -  Validate Alternatin name & address                *
      *  VLDLFS  -  Validate date of last financial statement         *
      *  VLDMUB  -  Validate multi-branch indicator                   *
      *  VLDNMR  -  Validate Nominal rate                             *
      *  VLDRVD  -  Validate Review Date                              *
      *  VLDRVF  -  Validate Review Freauency                         *
      *  VLDRVN  -  Validate Review Day Number                        *
      *  VLDACO  -  Validate Account Officer                          *
      *  VLDPRC  -  Validate Profit Centre                            *
      *  VLDOBR  -  Validate Originating Branch                       *
      *  VLDBLI  -  Validate Billing Indicator                        *
      *  VLDBLD  -  Validate Billing Days                             *
      *  VLDASN  -  Validate Account Sequence Number                  *
      *  VLDSC2  -  Validate Screen 2                                 *
      *  VLDSYI  -  Validate Syndication Indicator                    *
      *  VLDSYC  -  Validate Syndication Complete Indicator           *
      *  VLDACR  -  Validate Agent Customer Number                    *
      *  VLDDTS  -  Validate Drawing Types                            *
      *  VLDICB  -  Validate Default Interest Basis                   *
      *  VLDROT  -  Validate Rollover Types                           *
      *  VLDIRP  -  Validate Irregular Rollover Period                *
      *  VLDCSI  -  Validate Currency Selection Indicator             *
      *  VLDACY  -  Validate Allowable Currencies                     *
      *  VLDDCM  -  Validate Date Committed                           *
      *  VLDCLD  -  Validate Closing Date                             *
      *  VLDLAD  -  Validate Last Availability Date                   *
      *  VLDLPT  -  Validate Late Payment Penalty Type                *
      *  VLDLPB  -  Validate Late Payment Penalty Base Rate           *
      *  VLDLPS  -  Validate Late Payment Penalty Amount/Spread       *
      *  VLDLPN  -  Validate Late Payment Penalty Sign                *
      *  VLDPLT  -  Validate Default Participation Loan Type          *
      *  VLDEXC  -  Validate Exchange Rate/Indicator                  *   CLE005
      *  DRWAMT  -                                                    *
      *  SRWNDW  -  Window processing subroutine                      *
      *  UPDFLE  -  Update Facility File                              *
      *  CLEARM  -  Clears message from the program message queue     *
      *  ZASNMS  -  Sends message to the program message queue        *
      *  SRTEXT  -  Set up text from message file                     *   123907
      *  SRBERR  -  Format batch error details                        *
      *  *PSSR   -  Error handling subroutine                         *
      *  VLDLAI  -  Validate Loan Administrator Id                    *   CLE008
      *  ZSEDIT  -  Edit numeric field for output                     *                       194540
      *****************************************************************
      *
      **  Active Facilities file
     F***LEFCLTL0IF  E           K        DISK         KINFSR *PSSR       124485
     F***         FCLTYFMF                          KRENAMEFCLTYFL0       124485
     FLEFCLTL7IF  E           K        DISK         KINFSR *PSSR          124485
     F            FCLTYFMF                          KRENAMEFCLTYFL7       124485
      *
      **  Facilities Requiring Authorisation
     FLEFCLTL1IF  E           K        DISK         KINFSR *PSSR
     F            FCLTYFMF                          KRENAMEFCLTYFL1
      *
      **  Funding Participant Details file
     FLEFCLTL2UF  E           K        DISK         KINFSR *PSSR
     F            FCLTYFMF                          KRENAMEFCLTYFL2
      *                                                                   CLE005
      **  Credit Agreement File                                           CLE005
     F***LEFCLTL9IF  E           K        DISK        KINFSR *PSSR CLE005 CLE008
     FLEFCLTL9UF  E           K        DISK         KINFSR *PSSR          CLE008
     F            FCLTYFMF                          KRENAMEFCLTYFL9       CLE005
     F                                              KCOMIT                CLE008
      *
      **  Facilities Details file
     FFCLTY   UF  E           K        DISK         KINFSR *PSSR A
     F                                              KCOMIT
     F            FCLTYHHF                          KIGNORE
      *
      **  Facilities Record/Playback file
     FLE2020PDUF  E                    DISK         KINFSR *PSSR A    UC
      *
      **  Customer/Facility/Loan Cross-Reference file
     FLEREF   IF  E           K        DISK         KINFSR *PSSR
      *                                                                   CLE005
      **  Facility Amendment Retrieval Index                              CLE005
     FLEFCAML0IF  E           K        DISK         KINFSR *PSSR          CLE005
      *                                                                   127641
      **  Facility Amendment Retrieval Index                              127641
     FLEFCAML6IF  E           K        DISK         KINFSR *PSSR          127641
     F            LEFCAMPF                          KRENAMELEFCAMP6       127641
      *                                                                   127641
      **  Live Utilisation Retrieval Index                                127641
     FLEMNFUL6IF  E           K        DISK         KINFSR *PSSR          127641
      *
      **  Loan Master file
     FCLOAN   IF  E           K        DISK         KINFSR *PSSR
     F            CLOANHHF                          KIGNORE
     F            CLOANZ1F                          KIGNORE
     F            CLOANCKF                          KIGNORE
     FCLOANF  IF  E           K        DISK                                                   208485
     F            CLOANCLF                          KRENAMEMCLONCLF                           208485
      *
      **  Fees Master file
     FLEFEEDL1IF  E           K        DISK         KINFSR *PSSR
      *                                                                   156297
     FLEFCAML3IF  E           K        DISK                               156297
     F            LEFCAMPF                          KRENAMELEFCAMD3       156297
      *
      **  Workstation file
     FLE2020DFCF  E                    WORKSTN                        UC
     F                                        RRN1  KSFILE LE2020S1
     F                                              KINFSR *PSSR
      *
      **  24/7 Midas Availability log file                                CSC011
     FAPILOGL0UF  E           K        DISK                           UC  CSC011
     F            APILOGD0                          KRENAMEAPILOGX0       CSC011
     F*                                                                   CSC011
      **  Invalid Facilities File                                         CAP065
     FLEIFACPDO   E                    DISK                           UC  CAP065
     F                                              KCOMIT                CAP065
      **  24/7 Midas Availability log files                               CSC011
     FAPVLOGPDO   E                    DISK                           UC  CSC011
     F                                              KCOMIT                CSC011
     FAPILOGPDO   E                    DISK                           UC  CSC011
     F                                              KCOMIT                CSC011
      **  Invalid Facilities FileS                                        CAP065
     FLEIFACL1IF  E           K        DISK                           UC  CAP065
     F            LEIFACP0                          KRENAMELEIFACP1       CAP065
     FLEIFACL2IF  E           K        DISK                           UC  CAP065
     F            LEIFACP0                          KRENAMELEIFACP2       CAP065
     FLEIFACLXUF  E           K        DISK                           UC  CAP065
     F            LEIFACP0                          KRENAMELEIFACDL       CAP065
     F                                              KCOMIT                CAP065
      *
     FCLOANL6 IF  E           K        DISK         KINFSR *PSSR                              202456
     F            CLOANCLF                          KRENAMECLOANCF6                           202456
      *                                                                                       202456
     F/COPY WNCPYSRC,LE2020FFPG
      *
     E                    RUN        10  5 0             FCTLY DRAW DATES
     E                    OAM        10 13 0             FCLTY O/S AMTS.
     E**********          DTS         5  1               Drawing Types                        CLE028
     E                    DTS         6  1               Drawing Types                        CLE028
     E                    WDTS1       6  1                                                    208485
     E                    WDTS2       6  1                                                    208485
     E                    ROT         6  1               Rollover Types
     E                    ACY        12  3
     E                    ACYX       12  3
     E                    POWR    1   7  7 3             Ccy conversion                       194864
     E/COPY ZSRSRC,ZHOLE
     E/COPY ZSRSRC,ZALIGNZ1
      *
      **  Compile time arrays
     E/COPY ZSRSRC,ZDATE2Z1
     E********            ADT     6   6  1                                                    CLE028
     E                    ADT     7   7  1                                                    CLE028
     E                    ARO     7   7  1
     E***********         STS     1   6 10                                123998
     E                    STAMP   1   1 26                                                    CPK015
      ** Array containing dummy timestamp                                                     CPK015
     E                    WDRPT   1  13  3                                                    208485
     E                    CPY@    1   1 80
      /COPY ZSRSRC,ZSEDITZ1                                                                   194540
      *
     ILEREFD1F
     I              RECI                            RFRECI
     I              CNUM                            RFCNUM
     I              FACT                            RFFACT
     I              FCNO                            RFFCNO
     ICLOANCLF
     I              RECI                            CLRECI
     I              CNUM                            CLCNUM
     I              BRCA                            CLBRCA
     I              FCCY                            CLFCCY
     I              CRSK                            CLCRSK
     I              ACOF                            CLACOF
     I              NACD                            CLNACD
     I              BTIN                            CLBTIN
     I              BLDY                            CLBLDY
     I              RCSI                            CLRCSI
     I              ORED                            CLORED
     I              RSTM                            CLRSTM
     I              RONS                            CLRONS
     I              RIBN                            CLRIBN
     I              RIBA                            CLRIBA
     I              ROBN                            CLROBN
     I              ROCN                            CLROCN
     I              PSTM                            CLPSTM
     I              PONS                            CLPONS
     I              PIBN                            CLPIBN
     I              PIBA                            CLPIBA
     I              POBN                            CLPOBN
     I              POCN                            CLPOCN
     I              RCRN                            CLRCRN
     I              RCRA                            CLRCRA
     I              RVNO                            CLRVNO
     I              AWBN                            CLAWBN
     I              AWBA                            CLAWBA
     I              BENN                            CLBENN
     I              BENA                            CLBENA
     I              DTP1                            CLDTP1
     I              DTP2                            CLDTP2
     I              DTP3                            CLDTP3
     I              DTP4                            CLDTP4
     I              DCHG                            CLDCHG
     I              BTB1                            CLBTB1
     I              BTB2                            CLBTB2
     I              BTB3                            CLBTB3
     I              BTB4                            CLBTB4
     I              BTB5                            CLBTB5
     I              BTB6                            CLBTB6
     I              CVMR                            CLCVMR
     I              IUSR                            CLIUSR
     I              AUSR                            CLAUSR
     I              XUSR                            CLXUSR
     I              PCRF                            CLPCRF
     I              PCOB                            CLPCOB
     I              DFTP                            CLDFTP
     I              DFST                            CLDFST
     I              TNLU                            CLTNLU                155425
     I              TMST                            CLTMST                                    CAP074
     IMCLONCLF                                                                                208485
     I              RECI                            C2RECI                                    208485
     I              LNRF                            C2LNRF                                    208485
     I              CNUM                            C2CNUM                                    208485
     I              BRCA                            C2BRCA                                    208485
     I              MDAT                            C2MDAT                                    208485
     I              FCCY                            C2FCCY                                    208485
     I              CRSK                            C2CRSK                                    208485
     I              ACOF                            C2ACOF                                    208485
     I              NACD                            C2NACD                                    208485
     I              OSDB                            C2OSDB                                    208485
     I              ORBR                            C2ORBR                                    208485
     I              PRFC                            C2PRFC                                    208485
     I              BTIN                            C2BTIN                                    208485
     I              BLDY                            C2BLDY                                    208485
     I              RCSI                            C2RCSI                                    208485
     I              ORED                            C2ORED                                    208485
     I              CHTP                            C2CHTP                                    208485
     I              RSTM                            C2RSTM                                    208485
     I              RONS                            C2RONS                                    208485
     I              RIBN                            C2RIBN                                    208485
     I              RIBA                            C2RIBA                                    208485
     I              ROBN                            C2ROBN                                    208485
     I              ROCN                            C2ROCN                                    208485
     I              PSTM                            C2PSTM                                    208485
     I              PONS                            C2PONS                                    208485
     I              PIBN                            C2PIBN                                    208485
     I              PIBA                            C2PIBA                                    208485
     I              POBN                            C2POBN                                    208485
     I              POCN                            C2POCN                                    208485
     I              RCRN                            C2RCRN                                    208485
     I              RCRA                            C2RCRA                                    208485
     I              RVNO                            C2RVNO                                    208485
     I              AWBN                            C2AWBN                                    208485
     I              AWBA                            C2AWBA                                    208485
     I              BENN                            C2BENN                                    208485
     I              BENA                            C2BENA                                    208485
     I              DTP1                            C2DTP1                                    208485
     I              DTP2                            C2DTP2                                    208485
     I              DTP3                            C2DTP3                                    208485
     I              DTP4                            C2DTP4                                    208485
     I              DCHG                            C2DCHG                                    208485
     I              BTB1                            C2BTB1                                    208485
     I              BTB2                            C2BTB2                                    208485
     I              BTB3                            C2BTB3                                    208485
     I              BTB4                            C2BTB4                                    208485
     I              BTB5                            C2BTB5                                    208485
     I              BTB6                            C2BTB6                                    208485
     I              CVMR                            C2CVMR                                    208485
     I              IUSR                            C2IUSR                                    208485
     I              AUSR                            C2AUSR                                    208485
     I              XUSR                            C2XUSR                                    208485
     I              PCRF                            C2PCRF                                    208485
     I              PCOB                            C2PCOB                                    208485
     I              DFTP                            C2DFTP                                    208485
     I              DFST                            C2DFST                                    208485
     I              TNLU                            C2TNLU                                    208485
     I              PTYP                            C2PTYP                                    208485
     I              TMST                            C2TMST                                    CAP074
     IFCLTYFL9                                                            CLE005
     I              RECI                            LERECI                CLE005
     I              CNUM                            LECNUM                CLE005
     I              FACT                            LEFACT                CLE005
     I              FCNO                            LEFCNO                CLE005
     I              RCTP                            LERCTP                CLE005
     I              BRCA                            LEBRCA                CLE005
     I              FCTI                            LEFCTI                CLE005
     I              FCCY                            LEFCCY                CLE005
     I              FAMT                            LEFAMT                CLE005
     I              OVPC                            LEOVPC                CLE005
     I              OVAM                            LEOVAM                                    CLE034
     I              DTAP                            LEDTAP                CLE005
     I              DTEX                            LEDTEX                CLE005
     I              RVCR                            LERVCR                CLE005
     I              SECI                            LESECI                CLE005
     I              MCCY                            LEMCCY                CLE005
     I              MCSI                            LEMCSI                CLE005
     I              NACD                            LENACD                CLE005
     I              CRSK                            LECRSK                CLE005
     I              DLFS                            LEDLFS                CLE005
     I              NOMR                            LENOMR                CLE005
     I              RVDT                            LERVDT                CLE005
     I              RVFR                            LERVFR                CLE005
     I              RVDY                            LERVDY                CLE005
     I              NAR1                            LENAR1                CLE005
     I              NAR2                            LENAR2                CLE005
     I              NAR3                            LENAR3                CLE005
     I              NAR4                            LENAR4                CLE005
     I              MTDH                            LEMTDH                CLE005
     I              MTDL                            LEMTDL                CLE005
     I              MTDA                            LEMTDA                CLE005
     I              QTDA                            LEQTDA                CLE005
     I              YTDA                            LEYTDA                CLE005
     I              ACOF                            LEACOF                CLE005
     I              ORBR                            LEORBR                CLE005
     I              RVCD                            LERVCD                CLE005
     I              ORED                            LEORED                CLE005
     I              LCD                             LELCD                 CLE005
     I              CHTP                            LECHTP                CLE005
     I              TNLU                            LETNLU                CLE005
     I              SYIN                            LESYIN                CLE005
     I              ANUM                            LEANUM                CLE005
     I              DTPS                            LEDTPS                CLE005
     I              DICB                            LEDICB                CLE005
     I              RTPS                            LERTPS                CLE005
     I              RLPD                            LERLPD                CLE005
     I              CSEL                            LECSEL                CLE005
     I              ALCY                            LEALCY                CLE005
     I              COMD                            LECOMD                CLE005
     I              CDTE                            LECDTE                CLE005
     I              AVLD                            LEAVLD                CLE005
     I              LPTP                            LELPTP                CLE005
     I              LPBR                            LELPBR                CLE005
     I              LPAM                            LELPAM                CLE005
     I              LPPS                            LELPPS                CLE005
     I              DFTP                            LEDFTP                CLE005
     I              DFST                            LEDFST                CLE005
     I              TRCA                            LETRCA                CLE005
     I              CANM                            LECANM                CLE005
     I              CAFT                            LECAFT                CLE005
     I              CAFN                            LECAFN                CLE005
     I              ACSQ                            LEACSQ                CLE005
     I              FSTS                            LEFSTS                CLE005
     I              IUSR                            LEIUSR                CLE005
     I              AUSR                            LEAUSR                CLE005
     I              XUSR                            LEXUSR                CLE005
     I              SYCP                            LESYCP                CLE005
     I              PCRF                            LEPCRF                CLE005
     I              PRTR                            LEPRTR                CLE005
     I              PMFC                            LEPMFC                CLE005
     I              PMFT                            LEPMFT                CLE005
     I              PMFN                            LEPMFN                CLE005
     I              INUM                            LEINUM                CLE005
     I              JDTE                            LEJDTE                CLE005
     I              SHTP                            LESHTP                CLE005
     I              SHPC                            LESHPC                CLE005
     I              RCSI                            LERCSI                CLE005
     I              SKIR                            LESKIR                CLE005
     I              SKIS                            LESKIS                CLE005
     I              SKFR                            LESKFR                CLE005
     I              SKFS                            LESKFS                CLE005
     I              VDTC                            LEVDTC                CLE005
     I              OSDB                            LEOSDB                CLE005
     I              OMDB                            LEOMDB                CLE005
     I              RSTM                            LERSTM                CLE005
     I              RONS                            LERONS                CLE005
     I              RIBN                            LERIBN                CLE005
     I              RIBA                            LERIBA                CLE005
     I              ROBN                            LEROBN                CLE005
     I              ROCN                            LEROCN                CLE005
     I              PSTM                            LEPSTM                CLE005
     I              PONS                            LEPONS                CLE005
     I              PIBN                            LEPIBN                CLE005
     I              PIBA                            LEPIBA                CLE005
     I              POBN                            LEPOBN                CLE005
     I              POCN                            LEPOCN                CLE005
     I              RCRN                            LERCRN                CLE005
     I              RCRA                            LERCRA                CLE005
     I              RVNO                            LERVNO                CLE005
     I              AWBN                            LEAWBN                CLE005
     I              AWBA                            LEAWBA                CLE005
     I              BENN                            LEBENN                CLE005
     I              BENA                            LEBENA                CLE005
     I              DTP1                            LEDTP1                CLE005
     I              DTP2                            LEDTP2                CLE005
     I              DTP3                            LEDTP3                CLE005
     I              DTP4                            LEDTP4                CLE005
     I              DCHG                            LEDCHG                CLE005
     I              BTB1                            LEBTB1                CLE005
     I              BTB2                            LEBTB2                CLE005
     I              BTB3                            LEBTB3                CLE005
     I              BTB4                            LEBTB4                CLE005
     I              BTB5                            LEBTB5                CLE005
     I              BTB6                            LEBTB6                CLE005
     I              CVMR                            LECVMR                CLE005
     I              PCOB                            LEPCOB                CLE005
     I              CAXR                            LECAXR                CLE005
     I              CMDI                            LECMDI                CLE005
     I              CACY                            LECACY                CLE005
     I              PFTI                            LEPFTI                CLE005
     I              DTPX                            LEDTPX                                    CLE028
      *                                                                   156297
     ILEFCAMD3                                                            156297
     I              RECI                            D3RECI                156297
     I              BRCA                            D3BRCA                156297
     I              CNUM                            D3CNUM                156297
     I              FACT                            D3FACT                156297
     I              FCNO                            D3FCNO                156297
     I              RVCR                            D3RVCR                156297
     I              ASTS                            D3ASTS                156297
     I              IUSR                            D3IUSR                156297
     I              AUSR                            D3AUSR                156297
     I              XUSR                            D3XUSR                156297
     I              CHTP                            D3CHTP                156297
     IFCLTYFMF                                                                                CPK015
     I              STMP                            FMSTMP                                    CPK015
     IFCLTYFNF                                                                                CPK015
     I              STMP                            FNSTMP                                    CPK015
     ICLOANCF6                                                                                CAP074
     I              TMST                            F6TMST                                    CAP074
     ILEMNFUPF                                                                              AR674226
     I              SQNO                            MFSQNO                                  AR674226
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      *
      * 24X7 Data Structure                                               CSC011
     ISC24X7    E DSSC24X7                                                CSC011
      *                                                                   CSC011
      * SDSTAT Data Structure                                             CSC011
     ISDSTAT    E DSSDSTAT                                                CSC011
      *                                                                   CSC011
      ** IN Message Format
     IP#F1MF    E DSLEF1MFPD
      *
      ** OUT Message Format
     IP#F2MF    E DSLEF2MFPD
      *
      ** IN Message Format
     IP#R1MF    E DSLER1MFPD
     I              QQPONS                          Q1PONS                                    CGL029
     I              QQRONS                          Q1RONS                                    CGL029
      *
      ** OUT Message Format
     IP#R2MF    E DSLER2MFPD
      *
     I/COPY WNCPYSRC,LE2020IIP1
      *
      *  Data Structure for LDA
     ILDA       E DSLDA                         256
     I              SPARE                           SPARF                 119892
      *
      ** DATA AREA TO READ PREVIOUS RUN DATE
     IJNSTAT      DS                            200
     I                                    P 103 1050PRUN
      *
      ** RUNDAT DATA AREA
     IRUNDAT      DS
     I                                        1   7 RUNA
     I                                    P   8  100RUND
     I                                       11  11 SSF
     I                                       12  12 DATF
     I                                       13  13 MBIN
      *
      ** DATA AREA OF MENU USER
     IZMUSER      DS                             17
     I                                       11  13 USRBCH
      *
      ** External DS for bank details
     ISDBANK    E DSSDBANKPD
      *
      ** ALTERNATE NAME AND ADDRESSES
     ISDALTN    E DSSDALTNPD
      *
      ** GENERAL LEDGER DETAILS
     ISDGELR    E DSSDGELRPD
      *
      ** MIDAS MODULE DETAILS
     ISDMMOD    E DSSDMMODPD
      *
      **  ACCESS TO TRADING DETAILS
     ISDTRAD    E DSSDTRADPD
     I              QQACCD                          Q1ACCD                                    CGL029
      *
      **  CUSTOMER LENDING DETAILS
     ISDCLND    E DSSDCLNDPD
      *
      ** BRANCH CODES
     ISDBRCH    E DSSDBRCHPD
     I                                      178 183 A8SYCA                120136
      *
      **   PROFIT CENTRE DFT. MATRIX RETRIEVAL INDEX
     ISDPORC    E DSSDPRFMPD
      *
      **   PROFIT CENTRES
     ISDPRFC    E DSSDPRFCPD
      *
      **   FACILITY TYPE
     ISDFACT    E DSSDFACTPD
      *
      **   CURRENCY TYPE
     ISDCURR    E DSSDCURRPD
      *
      **   CUSTOMER
     ISDCUST    E DSSDCUSTPD
     I              QQDFAC                          Q1DFAC                                    CGL029
      *
      **   COUNTRY
     ISDCTRY    E DSSDCTRYPD
      *
      **   COUNTER-PARTY NOSTROS
     ISDCNST    E DSSDCNSTPD
      *
      **   BASE RATE
     ISDBSRT    E DSSDBSRTPD
      *
      **   ACCOUNT OFFICER DETAILS
     ISDACOF    E DSSDACOFPD
      *
      **
     ISDRETL    E DSSDRETLPD
     I              QQACCD                          Q2ACCD                                    CGL029
      *
      **   NOSTRO DETAILS
     ISDNOST    E DSSDNOSTPD
     I              QQACCD                          Q3ACCD                                    CGL029
      *
      **   DEALS DETAILS
     ISDDEAL    E DSSDDEALPD
     I              QQACCD                          Q4ACCD                                    CGL029
      *
      **   LOAN TYPE / SUB TYPE
     ISDLOAN    E DSSDLOANPD
      *                                                                   CLE014
     ISCSARD    E DSSCSARDPD                                              CLE014
      ** External data structures for access objects                      CLE014
      *
      *  First DS for access program, short Data Structure
     IDSFDY     E DSDSFDY
      *
      * SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE
     IDSSDY     E DSDSSDY
      *                                                                   158177
      * DS for calculating PC reference                                   158177
     ILEALLO    E DSLEALLO                                                158177
      *
     I/COPY ZSRSRC,ZTNLU1Z1
      *
     I            DS
     I                                    P   1  30 RUN
     I                                    P   1   30RUN0
     I                                    P   4   60RUN1
     I                                    P   7   90RUN2
     I                                    P  10  120RUN3
     I                                    P  13  150RUN4
     I                                    P  16  180RUN5
     I                                    P  19  210RUN6
     I                                    P  22  240RUN7
     I                                    P  25  270RUN8
     I                                    P  28  300RUN9
     I            DS
     I                                    P   1  70 OAM
     I                                    P   1   70OAM1
     I                                    P   8  140OAM2
     I                                    P  15  210OAM3
     I                                    P  22  280OAM4
     I                                    P  29  350OAM5
     I                                    P  36  420OAM6
     I                                    P  43  490OAM7
     I                                    P  50  560OAM8
     I                                    P  57  630OAM9
     I                                    P  64  700OA10
      *  DS for drawing types
     I            DS
     I                                        1   6 S3DTX6                                    CLE028
     I                                        1   5 S3DTX5
     I                                        1   1 S3DTS1
     I                                        2   2 S3DTS2
     I                                        3   3 S3DTS3
     I                                        4   4 S3DTS4
     I                                        5   5 S3DTS5
     I                                        6   6 S3DTS6                                    CLE028
      *  DS for rollover types
     I            DS
     I                                        1   6 S3RTX6
     I                                        1   1 S3RTS1
     I                                        2   2 S3RTS2
     I                                        3   3 S3RTS3
     I                                        4   4 S3RTS4
     I                                        5   5 S3RTS5
     I                                        6   6 S3RTS6
      *  DS for allowable currencies
     I            DS
     I                                        1  36 S3ACCY
     I                                        1   3 S3CY01
     I                                        4   6 S3CY02
     I                                        7   9 S3CY03
     I                                       10  12 S3CY04
     I                                       13  15 S3CY05
     I                                       16  18 S3CY06
     I                                       19  21 S3CY07
     I                                       22  24 S3CY08
     I                                       25  27 S3CY09
     I                                       28  30 S3CY10
     I                                       31  33 S3CY11
     I                                       34  36 S3CY12
     I            DS
      ** Separate date values
     I                                        1   6 WDATE
     I                                        1   2 WDAT1
     I                                        3   4 WDAT2
     I                                        5   6 WDAT3
      *
     I            DS
      ** Date format for test harness file
     I                                        1   8 DTST
     I                                        1   2 WTDT1
     I I            '/'                       3   3 WFIL1
     I                                        4   5 WTDT2
     I I            '/'                       6   6 WFIL2
     I                                        7   8 WTDT3
      ** Separate time values
     I                                        1   60WTIME
     I                                        1   2 WTIM1
     I                                        3   4 WTIM2
     I                                        5   6 WTIM3
      *
     I            DS
      ** Time format for test harness file
     I                                        1   8 TMST
     I                                        1   2 WTTM1
     I I            ':'                       3   3 WFIL3
     I                                        4   5 WTTM2
     I I            ':'                       6   6 WFIL4
     I                                        7   8 WTTM3
      *                                                                   CSC011
     I            DS                                                      CSC011
      ** Date fields for populating timestamp in 24/7 log (ddmmyyyy)      CSC011
      ** Used to break up data from F1TRDS in LEF1MFPD                    CSC011
     I                                        1   8 TDATE                 CSC011
     I                                        1   2 TDD                   CSC011
     I                                        3   4 TMM                   CSC011
     I                                        5   8 TYY                   CSC011
      *                                                                   CSC011
     I            DS                                                      CSC011
      ** ISO format timestamp for 24/7 log                                CSC011
      ** Used as Key in APILOGL0                                          CSC011
     I                                        1  26 TSTISO                CSC011
     I                                        1   4 TSTYY                 CSC011
     I I            '-'                       5   5 TSTF1                 CSC011
     I                                        6   7 TSTMM                 CSC011
     I I            '-'                       8   8 TSTF2                 CSC011
     I                                        9  10 TSTDD                 CSC011
     I I            '-'                      11  11 TSTF3                 CSC011
     I                                       12  13 TSTTM1                CSC011
     I I            '.'                      14  14 TSTF4                 CSC011
     I                                       15  16 TSTTM2                CSC011
     I I            '.'                      17  17 TSTF5                 CSC011
     I                                       18  19 TSTTM3                CSC011
     I I            '.'                      20  20 TSTF6                 CSC011
     I                                       21  26 TSTTM4                CSC011
      *                                                                   CSC011
     I            DS                                                      CSC011
      ** Data Structure to separate time for correct timestamp            CSC011
      **                                                                  CSC011
     I                                        1   8 WTSTM                 CSC011
     I                                        1   2 WTSHR                 CSC011
     I                                        3   4 WTSMN                 CSC011
     I                                        5   6 WTSSC                 CSC011
      *                                                                   119925
     IFCTMSG      DS                                                      119925
     I                                        1   6 D#CNUM                119925
     I                                        7   9 D#FACT                119925
     I                                       10  11 D#FCNO                119925
     I              '000000000000000000-  C         C#ZER1
     I              '0000000'
     I***********   '000000000000000000'  C         C#ZER2                CLE005
     I              '000000000000000000-  C         C#ZER2                CLE005
     I              '000000'                                              CLE005
     I              '     0.0000000'      C         C#LPAM                122620
      *                                                                   CAP070
     I            DS                                                      CAP070
     I              'LEASGNSIN'           C         ASGN                  CAP070
      *                                                                   CAP068
     I            DS                                                      CAP068
     I              'LEFPRTSIN'           C         FPRT                  CAP068
      *                                                                   CAP069
     I            DS                                                      CAP069
     I              'LERPRTSIN'           C         RPRT                  CAP069
     I*                                                                   CAP065
     I              'R=Reverse'           C         SCRVRS                CAP065
     I              'C=Close'             C         SCCLOS                CAP065
     I              'X=Authorise'         C         SCXAUT                CAP065
     I              'Q=Delete'            C         SCDELT                CAP065
     I              'E=Enquire'           C         SCENQR                CAP065
     I              'A=Amend'             C         SCAMND                CAP065
     I              'U=Update'            C         SCUPDT                CAP065
     I              'F9=Insert'           C         SCISRT                CAP065
      *
     I/COPY ZSRSRC,ZHOLI
      *
     I/COPY WNCPYSRC,LE2020IIPG
      *
      ** Data to be passed to window program
     I/COPY QWINDSRC,LE2020GDTA
      /COPY ZSRSRC,ZSEDITZ2                                                                   194540
      /EJECT
      * ===============================================================
      **                  D E F I N I T I O N S
      * ===============================================================
      *
      ** PARAMETER Lists
      ** ~~~~~~~~~~~~~~~
     C           *ENTRY    PLIST
     C*********************PARM           P#MODE  1        Mode (I/B/P/R)   CAP065
     C                     PARM           P#MODE  1        Mode (I/B/P/R/F) CAP065
     C                     PARM           P#F1MF           IN Message format
     C                     PARM           P#F2MF           OUT Message format
      *
      ** Define Fields
      ** ~~~~~~~~~~~~~
      **
     C           *LIKE     DEFN CNUM      K1CNUM
     C           *LIKE     DEFN FACT      K1FACT
     C           *LIKE     DEFN FCNO      K1FCNO
      **
     C           *LIKE     DEFN CNUM      K3CNUM
     C           *LIKE     DEFN FACT      K3FACT
     C           *LIKE     DEFN FCNO      K3FCNO
     C           *LIKE     DEFN RCTP      K3RCTP
      **
     C           *LIKE     DEFN CNUM      K4CNUM
     C           *LIKE     DEFN FACT      K4FACT
     C           *LIKE     DEFN FCNO      K4FCNO
      **
     C           *LIKE     DEFN LNRF      K5LNRF
     C           *LIKE     DEFN RCTP      K5RCTP
     C           *LIKE     DEFN BRCA      K4BRCA
      **
     C           *LIKE     DEFN CNUM      K6CNUM
     C           *LIKE     DEFN FACT      K6FACT
     C           *LIKE     DEFN FCNO      K6FCNO                          120525
      **
     C           *LIKE     DEFN CNUM      K7CNUM
      **
     C           *LIKE     DEFN CNUM      K8CNUM
     C           *LIKE     DEFN FACT      K8FACT
     C           *LIKE     DEFN FCNO      K8FCNO
      **
     C           *LIKE     DEFN CNUM      K9CNUM
     C           *LIKE     DEFN FACT      K9FACT
     C           *LIKE     DEFN FCNO      K9FCNO
     C           *LIKE     DEFN RCTP      K9RCTP
      *                                                                   CLE005
     C           *LIKE     DEFN CANM      K0CANM                          CLE005
     C           *LIKE     DEFN CAFT      K0CAFT                          CLE005
     C           *LIKE     DEFN CAFN      K0CAFN                          CLE005
      **                                                                  CLE008
     C           *LIKE     DEFN BRCA      K0BRCA                          CLE008
     C           *LIKE     DEFN CNUM      K0CNUM                          CLE008
     C           *LIKE     DEFN FACT      K0FACT                          CLE008
     C           *LIKE     DEFN FCNO      K0FCNO                          CLE008
      *                                                                   156297
     C           *LIKE     DEFN DTEX      WNDTEX                          156297
      *
      ** Key Lists
      ** ~~~~~~~~~
      *
      **  Chain to LEFCLTL0
     C           K#KY01    KLIST
     C                     KFLD           K1CNUM
     C                     KFLD           K1FACT
     C                     KFLD           K1FCNO
      *
      **  Used for subfile
     C           K#KY02    KLIST
     C                     KFLD           K2CNUM
     C                     KFLD           K2FACT
     C                     KFLD           K2FCNO
      *
      **  Facility
     C           K#KY03    KLIST
     C                     KFLD           K3CNUM
     C                     KFLD           K3FACT
     C                     KFLD           K3FCNO
     C                     KFLD           K3RCTP
      *
      **  Facility participant (LEFCLTL2)
     C           K#KY04    KLIST
     C                     KFLD           K4BRCA
     C                     KFLD           K4CNUM
     C                     KFLD           K4FACT
     C                     KFLD           K4FCNO
      *
      ** used for CLOAN
     C           K#KY05    KLIST
     C                     KFLD           K5LNRF
     C                     KFLD           K5RCTP
      *
      **  Partial key on facility file
     C           K#KY06    KLIST
     C                     KFLD           K6CNUM
     C                     KFLD           K6FACT
     C                     KFLD           K6FCNO                          120525
      *
      ** Key for LEFEDL1
     C           K#KY07    KLIST
     C                     KFLD           K7CNUM
     C                     KFLD           K7FCTY
      *
      **  Used for LEREF
     C           K#KY08    KLIST
     C                     KFLD           K8CNUM
     C                     KFLD           K8FACT
     C                     KFLD           K8FCNO
      *                                                                   CLE005
      **  Used for LEFCAML0                                               CLE005
     C           K#KY09    KLIST                                          CLE005
     C                     KFLD           K9BRCA  3                       CLE005
     C**********           KFLD           K9CUST  60                                   CLE005 CSD027
     C                     KFLD           K9CUST  6                                           CSD027
     C                     KFLD           K9FCTY  30                      CLE005
     C                     KFLD           K9FTNO  20                      CLE005
      *                                                                   CLE005
      **  Used for LEFCLTL9                                               CLE005
     C           K#KY10    KLIST                                          CLE005
     C                     KFLD           K0CANM                          CLE005
     C                     KFLD           K0CAFT                          CLE005
     C                     KFLD           K0CAFN                          CLE005
      *                                                                   128952
      **  Used for LEFCLTL7                                               128952
     C           K#KY11    KLIST                                          128952
     C**********           KFLD           K1CANM  60                                   128952 CSD027
     C                     KFLD           K1CANM  6                                           CSD027
     C                     KFLD           K1CAFT  30                      128952
     C                     KFLD           K1CAFN  20                      128952
     C                     KFLD           K1RCTP  1                       128952
      *                                                                   156297
      **  Used for LEFCAML3                                               156297
      *                                                                   156297
     C           K#KY12    KLIST                                          156297
     C                     KFLD           K3CNUM                          156297
     C                     KFLD           K3FACT                          156297
     C                     KFLD           K3FCNO                          156297
      *                                                                   CSC011
      **  Used for APILOGL0                                               CSC011
      *                                                                   CSC011
     C           KAPLOG    KLIST                                          CSC011
     C                     KFLD           KMTYPE  8                       CSC011
     C                     KFLD           KFOID  20                       CSC011
     C                     KFLD           KTSTMP 26                       CSC011
      *                                                                                       208485
      **  Used for CLOANF                                                                     208485
      *                                                                                       208485
     C           KCLOAF    KLIST                                                              208485
     C                     KFLD           KCNUM                                               208485
     C                     KFLD           KFACT                                               208485
     C                     KFLD           KFCNO                                               208485
      *
      * ===============================================================
      *
      *                M A I N        P R O C E S S I N G
      *
      * ===============================================================
      *
      ** Initialisation
     C                     EXSR INITPR
      *
     C                     SELEC
      *
      ** Interactive or Record
     C           P#MODE    WHEQ 'I'
     C           P#MODE    OREQ 'R'
     C           P#MODE    OREQ 'F'                                       CAP065
     C           CAP065    ANDEQ'Y'                                       CAP065
      *
      ** Process key input (Key or Review)
     C                     EXSR INTRCV
      *
      ** Batch
     C           P#MODE    WHEQ 'B'
      *
      ** Map incoming data into the screen fields
     C                     EXSR MAPFLD
      *
     C                     EXSR KEYPRO
      *
     C           S1ACTN    IFEQ 'I'
     C           S1ACTN    OREQ 'A'
      *
      ** Validate Details of screen 1 from Parameter
     C                     EXSR VLDSC1
      *
      ** Validate Details of screen 2 from Parameter
     C************IN17     IFEQ *ON                                       167979
     C                     EXSR VLDSC2
     C***********          ENDIF                                          167979
      *
     C                     ELSE
      ** Update file for action codes 'X', 'C' and 'R'
     C                     EXSR UPDFLE
      *
     C                     ENDIF
      *
      ** Set up details of returned message format
     C                     MOVE F1MSGT    F2MSGT
     C                     MOVE F1TRUS    F2TRUS
     C                     MOVE F1TRWS    F2TRWS
     C                     MOVE F1TNRF    F2TNRF
     C                     MOVE F1TRSN    F2TRSN
     C                     MOVE F1ACTN    F2ACTN
     C                     MOVE F1TRDS    F2TRDS
     C                     MOVE F1TRTS    F2TRTS
     C                     MOVE F1NRBA    F2NRBA
     C                     MOVE F1CNUM    F2CNUM
     C                     MOVE F1FACT    F2FACT
     C***********W#FCNO    ADD  1         W#FCN   20                      120525
     C***********          MOVE W#FCN     F2FCNO                          120525
     C           S1ACTN    IFEQ 'I'                                       122105
     C                     MOVE K6FCNO    F2FCNO                          120525
     C                     ELSE                                           122105
     C                     MOVE F1FCNO    F2FCNO                          122105
     C                     ENDIF                                          122105
      *
      **  Play
     C           P#MODE    WHEQ 'P'
      *
     C                     READ LE2020PD                 80
     C           *IN80     DOWEQ*OFF
      *
     C                     EXSR KEYPRO
      *
      **  Validate Detail from Parameter
     C                     EXSR VLDSC1
      *
     C           S1ACTN    IFEQ 'I'
     C           S1ACTN    OREQ 'A'
      *
      ** Validate Details of screen 1 from Parameter
     C                     EXSR VLDSC1
      *
      ** Validate Details of screen 2 from Parameter
     C************IN17     IFEQ *ON                                       167979
     C                     EXSR VLDSC2
     C***********          ENDIF                                          167979
      *
     C                     ELSE
      ** Update file for action codes 'X', 'C' and 'R'
     C                     EXSR UPDFLE
      *
     C                     ENDIF
      *
     C                     READ LE2020PD                 80
      *
     C                     ENDDO
      *
     C                     ENDSL
      *
      **  Closedown processing
     C                     EXSR CF03
      /EJECT
      *****************************************************************
      * INTRCV   : Key Input Processing                               *
      *****************************************************************
     C           INTRCV    BEGSR
      *
      **  Clear Message subfile
     C                     EXSR CLEARM
      *
      **  Write initial screen
     C           *INKC     DOWEQ*OFF
      *
     C           P#MODE    IFNE 'F'                                       CAP065
     C                     EXSR DSPHDR                     Header         CAP065
     C***********          WRITELE2020F1                   Header         CAP065
     C                     WRITE#MSGCTL                    Messages
     C                     EXFMTLE2020F2                   Initial screen
      *
      **  Clear Message subfile
     C                     EXSR CLEARM
     C                     MOVE '   '     W#F5MD
      *                                                                   133796
     C                     Z-ADD0         W#CNT                           133796
     C                     MOVE *OFF      *IN32                           133796
     C                     MOVE *OFF      *IN36                           133796
     C                     MOVE *BLANKS   DAYSV2                          133796
     C                     MOVE *BLANKS   DAYSV                           133796
      * Initialise save of TRCA to an invalid value. Blanks is valid.     189577
     C                     MOVE '**'      TRCASV  2                       189577
     C                     Z-ADD0         WAMT   130                      143819
     C                     MOVE '0'       *IN29                                               194864
      *
     C                     ENDIF                                          CAP065
     C*                                                                   CAP065
      ** Build selection subfile if facility not entered
     C           S1CUST    IFEQ *BLANK
     C           S1FACT    ANDEQ*BLANK
     C           S1FCNO    ANDEQ*BLANK
     C           P#MODE    OREQ 'F'                                       CAP065
      *
      **  Review from fields entered
     C                     EXSR REVIEW
      *
     C                     ELSE
      *
      **  Key input processing
     C                     EXSR KEYPRO
      *
     C                     ENDIF
     C*********************CLEARLE2020F2                           160627 187199
      *                                                                   184900
      ** Only clear LE2020F2 when screen is not in error.                 184900
      *                                                                   184900
     C           W#ERR1    IFNE 'Y'                                       184900
     C                     CLEARLE2020F2                                  184900
     C                     MOVE 'N'       S1AUTH                                              194667
     C                     ENDIF                                          184900
      *                                                                   160627
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      * KEYPRO   : Key Input Processing                         *
      ***********************************************************
     C           KEYPRO    BEGSR
      *
     C                     MOVE 'N'       W#ERR1  1
     C                     MOVE *OFF      *IN24
     C                     MOVE *OFF      *IN25
     C                     MOVE *ON       *IN83
      *
      **  Validate input key & action
     C                     EXSR VLDACK
      *
      **  Validate Authority
     C           W#ERR1    IFNE 'Y'
     C                     EXSR VLDAUT
     C                     ENDIF
      *
     C           W#ERR1    IFNE 'Y'
      *
      **  If not insert chain facility file to populate screen fields
     C           S1ACTN    IFNE 'I'
     C                     MOVE 'A'       K3RCTP
     C***********          MOVE S1CUST    K3CNUM                          121855
     C                     MOVELS1CUST    K3CNUM                          121855
     C                     MOVE S1FACT    K3FACT
     C                     MOVE S1FCNO    K3FCNO
     C           K#KY03    CHAINFCLTY               N80
     C                     MOVE TNLU      W#TNLU                          120988
     C                     MOVE 'B'       K3RCTP
     C           K#KY03    CHAINFCLTY               N80
      *                                                                                       194864
      ** Get the Credit Agreement exchange rate                                               194864
      *                                                                                       194864
     C                     Z-ADDCAXR      TRCAXR 138                                          194864
     C                     MOVE CMDI      TRCMDI  1                                           194864
     C                     MOVE CACY      TRCACY  3                                           194864
      *                                                                   133995
     C                     ELSE                                           133995
     C                     MOVE *BLANKS   RECI                            133995
     C                     ENDIF
      *                                                                   157579
     C                     MOVE RECI      WRECI   1                       157579
      *
     C           PRTR      IFEQ 'P'                                       143614
     C           PRTR      OREQ 'I'                                       143614
     C                     MOVE *ON       *IN86                           143614
     C                     ELSE                                           143614
     C                     MOVE *OFF      *IN86                           143614
     C                     ENDIF                                          143614
      *                                                                   143614
      **  If Facility is either closed or expired, check for records      156297
      **  in PF/LEFCAMPD if it has been reactivated.                      156297
      *                                                                   156297
     C                     MOVE *OFF      WREAC   1                       156297
     C           RECI      IFEQ 'C'                                       156297
     C           RECI      OREQ 'E'                                       156297
     C                     EXSR SRCKFR                                    156297
     C                     ENDIF                                          156297
      *                                                                   156297
     C           P#MODE    IFEQ 'I'
     C           P#MODE    OREQ 'R'
      *                                                                   125714
      * If the facility is closed or reversed, do not allow user to       125714
      * amend the details.                                                125714
      *                                                                   125714
     C           RECI      IFEQ 'C'                                       125714
     C           WREAC     ANDEQ*OFF                                      156297
     C           RECI      OREQ 'R'                                       125714
     C                     MOVEL'LEF0125' ZAMSID                          125714
     C                     EXSR ZASNMS                                    125714
     C                     ELSE                                           125714
     C                     EXSR PROSEL
     C                     ENDIF                                          125714
      *                                                                   125714
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  PROSEL : Process action
      ***********************************************************
     C           PROSEL    BEGSR
      *
     C           PRTR      IFEQ 'P'
     C           PRTR      OREQ 'I'
     C                     MOVE *ON       *IN86
     C                     ELSE
     C                     MOVE *OFF      *IN86
     C                     ENDIF
      *
     C                     MOVE 'Y'       W#FLAG
      *
     C                     EXSR CLEARM
      *
     C           P#MODE    IFNE 'F'                                       CAP065
      *
     C           S1ACTN    CASEQ'E'       ENQRYS
     C           S1ACTN    CASEQ'I'       INSRTS
     C           S1ACTN    CASEQ'A'       AMENDS
     C           S1ACTN    CASEQ'X'       AUTHOS
     C           S1ACTN    CASEQ'R'       RESRVS
     C           S1ACTN    CASEQ'C'       CLOSES
     C                     ENDCS
      *
     C                     ELSE                                           CAP065
     C*                                                                   CAP065
     C           S#SEL1    IFEQ 'Q'                                       CAP065
     C                     EXSR DLTINV                                    CAP065
     C                     ELSE                                           CAP065
     C           S1ACTN    CASEQ'I'       AMENDS                          CAP065
     C           S1ACTN    CASEQ'A'       AMENDS                          CAP065
     C           S1ACTN    CASEQ'X'       AUTHOS                          CAP065
     C           S1ACTN    CASEQ'R'       RESRVS                          CAP065
     C           S1ACTN    CASEQ'C'       CLOSES                          CAP065
     C                     ENDCS                                          CAP065
     C                     ENDIF                                          CAP065
     C                     MOVE 'Y'       W#RFSH  1                       CAP065
     C*                                                                   CAP065
     C                     ENDIF                                          CAP065
     C*                                                                   CAP065
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDACK :   Validate Key & Action code
      ***********************************************************
     C           VLDACK    BEGSR
      *
     C                     MOVE *OFF      *IN23
      *
      **  Validate key
     C                     EXSR VLDKEY
      *
      **  Valid action codes
     C           S1ACTN    IFNE 'E'
     C           S1ACTN    ANDNE'A'
     C           S1ACTN    ANDNE'X'
     C           S1ACTN    ANDNE'R'
     C           S1ACTN    ANDNE'C'
     C           S1ACTN    ANDNE'I'
     C                     MOVEL'LEF0001' ZAMSID  7
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN23
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     MOVE 'Y'       W#ERR1
     C                     ENDIF
      *
      **  If no error
     C           W#ERR1    IFNE 'Y'
     C           S1ACTN    ANDNE'I'
      *
     C                     MOVE 'A'       K3RCTP
     C***********          MOVE S1CUST    K3CNUM                          121855
     C                     MOVELS1CUST    K3CNUM                          121855
     C                     MOVE S1FACT    K3FACT
     C                     MOVE S1FCNO    K3FCNO
      *
     C           K#KY03    CHAINFCLTY               N80
      *
      **  Facility must exist for actions 'A' 'E' 'R' 'X' 'C'
     C           *IN80     IFEQ *ON
     C                     MOVEL'LEF0006' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN20
     C                     MOVE *ON       *IN21
     C                     MOVE *ON       *IN22
     C***********          MOVE 'Y'       W#ERR1                          120136
      *
     C                     ELSE
      *                                                                   128949
      **  Put file name in field for reference                            128949
      *                                                                   128949
     C                     MOVEL'FCLTY'   W#FILE                          128949
      *
      ** Validate valid selection
     C                     EXSR VLDACT
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDACT :   Validate valid action
      ***********************************************************
     C           VLDACT    BEGSR
      *
     C                     MOVE *OFF      *IN20
     C                     MOVE *OFF      *IN21
     C                     MOVE *OFF      *IN22
     C                     MOVE 'N'       W#UPOK                                              202011
      *
     C           P#MODE    IFEQ 'F'                                       CAP065
     C           S1ACTN    ANDNE'I'                                       CAP065
      *                                                                   CAP065
      *Check Facility exists                                              CAP065
     C**********           Z-ADDSFCNM     K1CNUM                                       CAP065 CSD027
     C                     MOVE SFCNM     K1CNUM                                              CSD027
     C                     Z-ADDSFACT     K1FACT                          CAP065
     C                     Z-ADDSFCNO     K1FCNO                          CAP065
     C           K#KY01    CHAINLEFCLTL7             80                   CAP065
      *                                                                   CAP065
     C           *IN80     IFEQ *ON                                       CAP065
     C                     MOVE 'LEF0315' W#EMSG                          CAP065
     C                     ENDIF                                          CAP065
      *                                                                   CAP065
     C                     ENDIF                                          CAP065
      *                                                                   CAP065
     C                     SELEC
      *
      **  Funding or internal facility cannot be closed, reversed or
      ****authorised***                                                   122618
     C           PRTR      WHEQ 'P'
     C           S1ACTN    ANDNE'C'                                                           202456
     C           PRTR      OREQ 'I'
     C           S1ACTN    ANDNE'C'                                                           202456
     C***********S1ACTN    IFEQ 'X'                                       122618
     C***********S1ACTN    OREQ 'R'                                       122618
      *                                                                   122618
     C           S1ACTN    IFEQ 'R'                                       122618
     C********** S1ACTN    OREQ 'C'                                                           202456
      *                                                                   CAP065
     C           P#MODE    IFEQ 'F'                                       CAP065
     C                     MOVEL'LEF0055' W#EMSG                          CAP065
     C                     ELSE                                           CAP065
     C                     MOVEL'LEF0055' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN23
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF                                          CAP065
     C                     ENDIF
      *                                                                   122616
      *   Authorising user should not be the same as the Insert or        122616
      *   Amendment user                                                  122616
      *                                                                   122616
     C           S1ACTN    IFEQ 'X'                                       122618
      *                                                                   CAP065
     C           ##USR     IFEQ IUSR                                      122616
     C           ##USR     OREQ AUSR                                      122616
      *                                                                   CAP065
     C           P#MODE    IFEQ 'F'                                       CAP065
     C                     MOVEL'LEF0112' W#EMSG  7                       CAP065
     C                     ELSE                                           CAP065
     C                     MOVEL'LEF0112' ZAMSID                          122616
     C                     MOVE 'Y'       W#ERR1                          122616
     C                     EXSR ZASNMS                                    122616
     C                     MOVE *ON       *IN23                           122616
     C                     ENDIF                                          CAP065
      *                                                                   CAP065
     C                     ENDIF                                          122616
     C                     ENDIF                                          122616
      *
      **  Action code X only allowed if Facility Authorisation required
     C           S1ACTN    WHEQ 'X'
      *
     C           W#FAAU    IFNE 'Y'
      *                                                                   CAP065
     C           P#MODE    IFEQ 'F'                                       CAP065
     C                     MOVEL'LEF0002' W#EMSG                          CAP065
     C                     ELSE                                           CAP065
     C                     MOVEL'LEF0002' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN23
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF                                          CAP065
      *                                                                   CAP065
     C                     ENDIF
      *
      **  Facility must have status 'C' or 'R' for action 'X'
     C           FSTS      IFNE 'C'
     C           FSTS      ANDNE'R'
     C*                                                                   CAP065
     C           P#MODE    IFEQ 'F'                                       CAP065
     C           *IN80     IFEQ *OFF                                      CAP065
     C                     MOVEL'LEF0007' W#EMSG                          CAP065
     C                     ENDIF                                          CAP065
     C                     ELSE                                           CAP065
     C                     MOVEL'LEF0007' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN23
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF                                          CAP065
     C                     ENDIF
      *                                                                   122616
      *   Authorising user should not be the same as the Insert or        122616
      *   Amendment user                                                  122616
      *                                                                   122616
     C           ##USR     IFEQ IUSR                                      122616
     C           ##USR     OREQ AUSR                                      122616
      *                                                                   CAP065
     C           P#MODE    IFEQ 'F'                                       CAP065
     C                     MOVEL'LEF0112' W#EMSG                          CAP065
     C                     ELSE                                           CAP065
     C                     MOVEL'LEF0112' ZAMSID                          122616
     C                     MOVE 'Y'       W#ERR1                          122616
     C                     EXSR ZASNMS                                    122616
     C                     MOVE *ON       *IN23                           122616
     C                     ENDIF                                          CAP065
     C                     ENDIF                                          122616
      *                                                                   128949
      **  Check if facility is a tranche.  If so, authorisation is not    128949
      **  allowed unless the credit agreement facility is already         128949
      **  authorised                                                      128949
      *                                                                   128949
     C                     EXSR CHKAUT                                    128949
      *
      **  Reverse
     C           S1ACTN    WHEQ 'R'
     C           S1ACTN    OREQ 'C'
      *
     C           RECI      IFNE 'D'
     C           S1ACTN    ANDEQ'R'                                       124484
     C           S1ACTN    OREQ 'C'                                       124484
     C           RECI      ANDNE'D'                                       124484
     C           RECI      ANDNE'E'                                       124484
     C*                                                                   CAP065
     C           P#MODE    IFEQ 'F'                                       CAP065
     C                     MOVEL'LEF0085' W#EMSG                          CAP065
     C                     ELSE                                           CAP065
     C                     MOVEL'LEF0085' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN20
     C                     MOVE *ON       *IN21
     C                     MOVE *ON       *IN22
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF                                          CAP065
     C                     ENDIF
     C           PRTR      IFEQ 'P'                                                           202456
     C           S1ACTN    ANDEQ'C'                                                           202456
     C           PRTR      OREQ 'I'                                                           202456
     C           S1ACTN    ANDEQ'C'                                                           202456
     C           FAMT      IFNE 0                                                             202456
     C           SHPC      ORNE 0                                                             202456
     C                     MOVEL'LEF0126' ZAMSID                                              202456
     C                     MOVE 'Y'       W#ERR1                                              202456
     C                     EXSR ZASNMS                                                        202456
     C                     MOVE *ON       *IN23                                               202456
     C                     ENDIF                                                              202456
     C                     ENDIF                                                              202456
      *
      ** Check for outstanding loans.
     C                     Z-ADDDTEX      ZDAYNO                          142396
      *                                                                   142396
     C                     EXSR CHKOTS
      *
     C           W#ERR4    IFEQ 'Y'
     C*                                                                   CAP065
     C           P#MODE    IFEQ 'F'                                       CAP065
     C                     MOVEL'LEF0086' W#EMSG                          CAP065
     C                     ELSE                                           CAP065
     C                     MOVEL'LEF0086' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN23
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF
     C                     ENDIF                                          CAP065
      *                                                                   127641
      **  Check if a loan, manual facility, or facility amendment is      127641
      **  attached to this facility.                                                          214894
      ****attached*to*one*of*the*credit*agreement's*tranches**************             127641 214894
      *                                                                   127641
     C********** S3TRCA    IFEQ 'TR'                                                   133992 214894
     C                     EXSR CHKCRE                                    127641
     C**********           ENDIF                                                       133992 214894
      *                                                                   128950
      **  Check if there are tranches referring to a credit agreement.    128950
      **  If so, credit agreement cannot be deleted                       128950
      *                                                                   128950
     C                     EXSR CHKTRA                                    128950
      *
      *  TO CHECK FOR OUTSTANDING FEES FOR FCLTY RECORD, IF FOUND
      *  THEN THE FCLTY RECORD CANNOT BE REVERSED.
     C                     EXSR CHKFEE
      *
     C                     ENDSL
      *
     C/COPY WNCPYSRC,LE2020C026
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDKEY :   Validate Key
      ***********************************************************
     C           VLDKEY    BEGSR
      *
     C                     MOVE *OFF      *IN20
     C                     MOVE *OFF      *IN21
     C                     MOVE *OFF      *IN22
      ** Validate Customer
     C                     CALL 'AOCUSTR0'
     C                     PARM '       ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM S1CUST    @CNUM  10
     C                     PARM           @CNST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'LEF0003' ZAMSID
     C                     MOVE 'Y'       W#ERR1           Error          120136
     C                     EXSR ZASNMS
     C***********          MOVE 'Y'       W#ERR1           Error          120136
     C                     MOVE *ON       *IN20            RI & PC
      *
     C                     ELSE
      *
     C/COPY WNCPYSRC,LE2020C015
     C                     MOVELBBCSSN    S3CSSN    P
     C           *IN83     IFEQ *ON
     C                     MOVELBBCSSN    S2CSSN    P
     C                     ELSE
     C                     MOVELBBCUST    S2CSSN    P
     C                     ENDIF
     C***********          MOVE *BLANKS   S1CUST                          121855
     C***********          MOVE BBCUST    S1CUST                          121855
     C                     MOVELBBCUST    S1CUST    P                     121855
     C                     MOVE BBCUST    S2CNUM
     C/COPY WNCPYSRC,LE2020C016
      *
     C                     ENDIF
      *
      ** Validate Facility type
     C                     MOVE S1FACT    FKEY
     C                     CALL 'AOFACTR0'PLIST1
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'LEF0004' ZAMSID
     C                     MOVE 'Y'       W#ERR1           Error          120136
     C                     EXSR ZASNMS
     C***********          MOVE 'Y'       W#ERR1           Error          120136
     C                     MOVE *ON       *IN21            RI & PC
     C                     ELSE
     C                     MOVELAMFCTY    S1FACT
     C                     ENDIF
      *
      **  Validate Facility Seq No.
     C           S1ACTN    IFNE 'I'
     C           S1FCNO    ORNE *BLANKS                                                       257155
     C                     TESTN          S1FCNO     19
     C           *IN19     IFEQ *OFF
      *                                                                                       257155
      * Do not allow '00'                                                                     257155
     C           S1FCNO    OREQ '00'                                                          257155
     C                     MOVEL'LEF0005' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN22
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF
      *                                                                                       257155
      ** If insert and Facility Sequence entered, ensure Facility not                         257155
      ** already on file.                                                                     257155
      *                                                                                       257155
     C           S1ACTN    IFEQ 'I'                                                           257155
     C           S1FCNO    ANDNE*BLANKS                                                       257155
     C           W#ERR1    ANDNE'Y'                                                           257155
     C                     MOVE 'A'       K3RCTP                                              257155
     C                     MOVELS1CUST    K3CNUM                                              257155
     C                     MOVE S1FACT    K3FACT                                              257155
     C                     MOVE S1FCNO    K3FCNO                                              257155
     C           K#KY03    SETLLFCLTY                    80                                   257155
      *                                                                                       257155
      *  If found, error.                                                                     257155
     C           *IN80     IFEQ '1'                                                           257155
     C                     MOVEL'LEX0005' ZAMSID                                              257155
     C                     MOVE 'Y'       W#ERR1                                              257155
     C                     MOVEL'XXUSRMSG'ZAMSGF                                              257155
     C                     EXSR ZASNMS                                                        257155
     C                     MOVEL'LERMSGF 'ZAMSGF                                              257155
     C                     MOVEA'111'     *IN,20                                              257155
     C                     ELSE                                                               257155
      *                                                                                       257155
      *  Else, set F6FCNO to value entered                                                    257155
     C                     MOVE S1FCNO    K6FCNO                                              257155
     C                     ENDIF                                                              257155
     C                     ENDIF                                                              257155
      *  For insert this field should not be entered
     C                     ELSE
     C           S1FCNO    IFNE *BLANKS
     C                     MOVEL'LEF0054' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN22
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDAUT :   Validate Authority
      ***********************************************************
     C           VLDAUT    BEGSR
      *
     C                     MOVE *OFF      *IN23
      *
      **  Validate users authority to usse this branch/action
     C                     Z-ADD*ZERO     @ERR
      *
      **  If not a multi-branch
     C           MBIN      IFEQ 'N'
      *
     C           P#MODE    IFEQ 'B'
     C                     CALL 'ZBACTU'
     C                     PARM S1ACTN    @ZACTN  1
     C                     PARM           @USER  10
     C**********           PARM           @ZMGRP  40                                          CSF002
     C**********           PARM           @ZICDE  4                                           CSF002
     C                     PARM           UNQCDE 10                                           CSF002
     C                     PARM           @ERR    10
     C                     ELSE
     C                     CALL 'ZVACTU'
     C                     PARM S1ACTN    @ZACTN  1
     C                     PARM           @ERR    10
     C                     ENDIF
      *
     C           @ERR      IFNE *ZERO
     C                     MOVEL'LEF0009' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN23
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Validate facility branch if not an insert
     C           MBIN      IFEQ 'Y'
     C           S1ACTN    ANDNE'I'
      *
     C           P#MODE    IFEQ 'B'
     C                     CALL 'ZBACTBU'
     C                     PARM S1ACTN    @ZACTN  1
     C                     PARM BRCA      @ZBR    3
     C                     PARM           @USER  10
     C**********           PARM           @ZMGRP  40                                          CSF002
     C**********           PARM           @ZICDE  4                                           CSF002
     C                     PARM           UNQCDE 10                                           CSF002
     C                     PARM           @ERR    10
     C                     ELSE
     C                     CALL 'ZVACTBU'
     C                     PARM S1ACTN    @ZACTN  1
     C                     PARM BRCA      @ZBR    3
     C                     PARM           @ERR    10
     C                     ENDIF
      *
     C           @ERR      IFNE *ZERO
     C           @ERR      IFEQ 1
     C                     MOVEL'LEF0010' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN23
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF
      *
     C           @ERR      IFEQ 2
     C*                                                                   CAP065
     C           P#MODE    IFEQ 'F'                                       CAP065
     C                     MOVEL'LEF0358' ZAMSID                          CAP065
     C                     MOVELS1ACTN    ZAMSDA                          CAP065
     C                     ELSE                                           CAP065
     C                     MOVEL'LEF0011' ZAMSID
     C                     ENDIF                                          CAP065
     C*                                                                   CAP065
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN23
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Validate Orig. Branch if used and validation required and
      **  is not an enquiry and not an insert
     C           BKOBRU    IFEQ 'Y'
     C           BKOBUV    ANDEQ'Y'
     C           S1ACTN    ANDNE'I'
     C           S1ACTN    ANDNE'E'
      *
     C           P#MODE    IFEQ 'B'
     C                     CALL 'ZBOBU'
     C                     PARM ORBR      @ZOBRX  3
     C                     PARM           @USER  10
     C                     PARM           @ERR    10
     C                     ELSE
     C                     CALL 'ZVOBU'
     C                     PARM ORBR      @ZOBRX  3
     C                     PARM           @ERR    10
     C                     ENDIF
      *
     C           @ERR      IFNE *ZERO
      *
     C           @ERR      IFEQ 1
     C                     MOVEL'LEF0012' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN23
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF
      *
     C           @ERR      IFEQ 2
     C                     MOVEL'LEF0013' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN23
     C                     MOVE 'Y'       W#ERR1
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  REVIEW :   List Facilities for selection
      ***********************************************************
     C           REVIEW    BEGSR
      *
     C                     MOVE *OFF      *IN20
     C                     MOVE *OFF      *IN21
     C                     MOVE *OFF      *IN22
     C                     MOVE *OFF      *IN23
     C                     MOVE *OFF      *IN83
     C                     MOVE 'N'       W#ERR1
      *
     C           P#MODE    IFNE 'F'                                       CAP065
      **  Validate Review from
     C                     EXSR VLDREV
     C                     ENDIF                                          CAP065
      *
     C           W#ERR1    IFNE 'Y'
      *
      **  Set up key fileds (for subfile)
     C           *LIKE     DEFN CNUM      K2CNUM
     C           *LIKE     DEFN FACT      K2FACT
     C           *LIKE     DEFN FCNO      K2FCNO
     C                     MOVE S1REV1    K2CNUM
     C                     MOVE S1REV2    K2FACT
     C                     MOVE S1REV3    K2FCNO
     C           *LIKE     DEFN S1REV1    W#REV1
     C           *LIKE     DEFN S1REV2    W#REV2
     C           *LIKE     DEFN S1REV3    W#REV3
     C           *LIKE     DEFN S1AUTH    W#AUTH                                              194667
      *  Save position fields
     C                     MOVE S1REV1    W#REV1
     C                     MOVE S1REV2    W#REV2
     C                     MOVE S1REV3    W#REV3
     C                     MOVE S1AUTH    W#AUTH                                              194667
      *
      **  Build subfile
     C                     Z-ADD0         RRN1    40
     C                     Z-ADD0         CURRRN
     C                     MOVE *BLANKS   S#SEL1
     C                     MOVE *OFF      *IN26
     C                     EXSR BLDSFL
      *
      **  Continue to redisplay the screen if *IN12 & *IN03 remains off
     C           *INKC     DOWEQ*OFF
     C           *INKL     ANDEQ*OFF
      *
     C           W#UPOK    IFEQ 'Y'                                       176943
     C           S1ACTN    ANDEQ'X'                                       176943
     C           S1ACTN    OREQ 'A'                                                           203201
     C           W#RBLD    ANDEQ'Y'                                       176943
     C                     MOVE 'SFL'     W#F5MD                          176943
     C                     EXSR CF05                                      176943
     C                     ENDIF                                          176943
      *                                                                   176943
     C           W#RFSH    IFEQ 'Y'                                       CAP065
     C                     MOVE 'SFL'     W#F5MD                          CAP065
     C                     EXSR CF05                                      CAP065
     C*                                                                   CAP065
     C* Any Subfile MSGs to display?                                      CAP065
     C           W#SMSG    IFNE *BLANKS                                   CAP065
     C                     MOVELW#SMSG    ZAMSID                          CAP065
     C                     EXSR ZASNMS                                    CAP065
     C                     MOVE *BLANKS   W#SMSG                          CAP065
     C                     ENDIF                                          CAP065
     C*                                                                   CAP065
     C                     MOVE 'N'       W#RFSH                          CAP065
     C                     ENDIF                                          CAP065
     C*                                                                   CAP065
     C                     EXSR DSPHDR                     Header         CAP065
     C                     WRITELE2020F3                   Functions
     C                     WRITE#MSGCTL                    Messages
     C   06                WRITELE2020F7                   No records
     C                     EXFMTLE2020C1                   Subfile Control
      *
      **  Clear Message subfile
     C           *IN15     IFEQ *OFF
     C                     EXSR CLEARM
     C                     ENDIF
      *
     C                     MOVE 'SFL'     W#F5MD  3
     C                     Z-ADD0         WAMT   130                      143819
      *
      **  F3  - Exit
     C           *INKC     CASEQ'1'       CF03
      *                                   ****
      **  F5 - Refresh
     C           *INKE     CASEQ'1'       CF05
      *                                   ****
      **  F9 - Insert
     C           *INKI     CASEQ'1'       INSRTS
      *                                   ******
      **  F12 - Previous
     C           *INKL     CASEQ'1'       CF12
      *                                   ****
      **  ROLLUP - Next page
     C  N06      *IN15     CASEQ'1'       BLDSFL
      *                                   ******
      **  Process Enter but no records                                  144922
     C           *IN06     CASEQ'1'       CF12                          144922
      *                                   ****                          144922
      **  Process Enter
     C                     CAS            VLDSFL
      *                                   ******
     C                     ENDCS
      *
     C                     ENDDO
      *
     C                     MOVE *OFF      *INKL
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDREV :   Validate review from
      ***********************************************************
     C           VLDREV    BEGSR
      *
     C                     MOVE *OFF      *IN25
      *
     C           S1AUTH    IFNE 'Y'
     C           S1AUTH    ANDNE'N'
     C                     MOVEL'LEF0014' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN25
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF
      *
     C                     EXSR VLDPOS
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDPOS : Validate position fields
      ***********************************************************
     C           VLDPOS    BEGSR
      *
     C                     MOVE *OFF      *IN24
      *
      **  Validate Review from (Customer)
     C           S1REV1    IFNE *BLANKS
     C**********           TESTN          S1REV1     19                                       CSD027
     C********** *IN19     IFEQ *OFF                                                          CSD027
     C**********           MOVEL'LEF0015' ZAMSID                                              CSD027
     C**********           MOVE 'Y'       W#ERR1                                       120136 CSD027
     C**********           EXSR ZASNMS                                                        CSD027
     C**********           MOVE *ON       *IN24                                               CSD027
     C***********          MOVE 'Y'       W#ERR1                          120136
     C**********           ENDIF                                                              CSD027
     C                     ENDIF
      *
      **  Validate Review from (Facility Type)
     C           S1REV2    IFNE *BLANKS
     C                     TESTN          S1REV2     19
     C           *IN19     IFEQ *OFF
     C                     MOVEL'LEF0015' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN24
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF
     C                     ENDIF
      *
      **  Validate Review from (Facility Seq No.)
     C           S1REV3    IFNE *BLANKS
     C                     TESTN          S1REV3     19
     C           *IN19     IFEQ *OFF
     C                     MOVEL'LEF0015' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN24
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  BLDSFL :   Build One Page
      ***********************************************************
     C           BLDSFL    BEGSR
      *
     C                     Z-ADD0         W#RECS  20
      *
     C           P#MODE    IFEQ 'F'                                       CAP065
     C*                                                                   CAP065
      **  Position file                                                   CAP065
     C           K#KY02    SETLLLEIFACP1             80                   CAP065
     C*                                                                   CAP065
     C                     ELSE                                           CAP065
     C*                                                                   CAP065
      **  Position file
     C           S1AUTH    IFEQ 'N'
     C***********K#KY02    SETLLLEFCLTL0             80                   124485
     C           K#KY02    SETLLLEFCLTL7             80                   124485
     C                     ELSE
     C           K#KY02    SETLLLEFCLTL1             80
     C                     ENDIF
     C*                                                                   CAP065
     C                     ENDIF                                          CAP065
      *
      **  Search argument is greater than the highest key on file
     C           *IN80     IFEQ *ON
     C                     MOVE *ON       *IN06            No records foun
     C                     MOVE *OFF      *IN01            SFLDSP
     C                     Z-ADD0         ##SFRC
      *
     C                     ELSE
     C                     MOVE *OFF      *IN06
     C                     MOVE *OFF      *IN03
     C                     MOVE *ON       *IN01
      *  Position subfile
     C           1         ADD  CURRRN    ##SFRC
     C                     Z-ADDCURRRN    RRN1
      *
     C           P#MODE    IFEQ 'F'                                       CAP065
     C                     READ LEIFACP1                 80               CAP065
     C                     EXSR LOADIV                                    CAP065
     C                     MOVE S1ACTN    S#FSTS                          CAP065
     C                     ELSE                                           CAP065
     C*                                                                   CAP065
     C           S1AUTH    IFEQ 'N'
     C***********          READ LEFCLTL0                 80               124485
     C                     READ LEFCLTL7                 80               124485
     C                     ELSE
     C                     READ LEFCLTL1                 80
     C                     ENDIF
     C*                                                                   CAP065
     C                     ENDIF                                          CAP065
      *
     C           *IN80     DOWEQ*OFF
     C           W#RECS    ANDLT10
      *
     C                     MOVE *BLANKS   S#SEL1
     C                     MOVE *OFF      *IN26
      *  Customer
     C                     MOVE CNUM      S#CNUM
      *                                                                   126274
      ** Access the Customer Details file for Shortname                   126274
      *                                                                   126274
     C                     CALL 'AOCUSTR0'                                126274
     C                     PARM '       ' @RTCD                           126274
     C                     PARM '*KEY   ' @OPTN                           126274
     C                     PARM S#CNUM    @CNUM                           126274
     C                     PARM           @CNST                           126274
     C           SDCUST    PARM SDCUST    DSSDY                           126274
     C                     MOVE *BLANKS   S#CSNM                          126274
     C           @RTCD     IFEQ *BLANKS                                   126274
     C                     MOVE BBCSSN    S#CSNM                          126274
     C                     ELSE                                           126274
     C                     MOVE 'Unknown' S#CSNM                          126274
     C                     ENDIF                                          126274
      *  Facility
     C                     MOVE FACT      S#FACT
     C                     MOVE FCNO      S#FCNO
      *  Currency
     C                     MOVE FCCY      S#FCCY
      *  Branch
     C                     MOVE BRCA      S#BRCA
      *                                                                   123907
      ** Syndication type                                                 123907
      *                                                                   123907
     C                     MOVE *BLANKS   S#SYIN                          123907
     C           SYIN      IFEQ 'Y'                                       123907
     C                     SELEC                                          123907
     C           PRTR      WHEQ *BLANK                                    123907
     C                     MOVEL'LEF0114' ZAMSID                          123907
     C           PRTR      WHEQ 'A'                                       123907
     C                     MOVEL'LEF0115' ZAMSID                          123907
     C           PRTR      WHEQ 'I'                                       123907
     C                     MOVEL'LEF0116' ZAMSID                          123907
     C           PRTR      WHEQ 'P'                                       123907
     C                     MOVEL'LEF0117' ZAMSID                          123907
     C                     ENDSL                                          123907
     C                     EXSR SRTEXT                                    123907
     C                     MOVELZAMSTX    S#SYIN                          123907
     C                     ENDIF                                          123907
      *  Status
     C*          All records in LEIFACL0 are live                         CAP065
     C           P#MODE    IFEQ 'F'                                       CAP065
     C                     MOVE 'D'       RECI                            CAP065
     C                     ENDIF                                          CAP065
     C*                                                                   CAP065
     C                     MOVE *BLANKS   ZAMSID                          123998
     C                     SELEC
     C           RECI      WHEQ 'D'
     C           FSTS      ANDEQ'C'
     C***********          MOVEASTS,1     S#FSTS                          123998
     C                     MOVEL'LEF0118' ZAMSID                          123998
     C           RECI      WHEQ 'D'
     C           FSTS      ANDEQ'A'
     C***********          MOVEASTS,2     S#FSTS                          123998
     C                     MOVEL'LEF0119' ZAMSID                          123998
     C           RECI      WHEQ 'D'
     C           FSTS      ANDEQ'R'
     C***********          MOVEASTS,3     S#FSTS                          123998
     C                     MOVEL'LEF0120' ZAMSID                          123998
     C           RECI      WHEQ 'R'
     C           FSTS      ANDEQ'A'
     C***********          MOVEASTS,4     S#FSTS                          123998
     C                     MOVEL'LEF0121' ZAMSID                          123998
     C           RECI      WHEQ 'C'
     C           FSTS      ANDEQ'A'
     C***********          MOVEASTS,5     S#FSTS                          123998
     C                     MOVEL'LEF0122' ZAMSID                          123998
     C           RECI      WHEQ 'E'                                       124485
     C                     MOVEL'LEF0124' ZAMSID                          124485
     C                     OTHER
     C***********          MOVEASTS,6     S#FSTS                          123998
     C                     MOVE *BLANKS   S#FSTS                          123998
     C                     ENDSL
     C           ZAMSID    IFNE *BLANKS                                   123998
     C                     EXSR SRTEXT                                    123998
     C                     MOVELZAMSTX    S#FSTS                          123998
     C                     MOVE *BLANKS   ZAMSID                          123998
     C                     ENDIF                                          123998
      *
     C                     EXSR VLDBAU
      *
     C           W#DSPR    IFEQ 'Y'
     C           P#MODE    OREQ 'F'                                       CAP065
     C                     ADD  1         RRN1    40
     C                     ADD  1         W#RECS
     C                     WRITELE2020S1
     C                     ENDIF
      *
     C           P#MODE    IFEQ 'F'                                       CAP065
     C                     READ LEIFACP1                 80               CAP065
     C                     EXSR LOADIV                                    CAP065
     C                     ELSE                                           CAP065
     C*                                                                   CAP065
     C           S1AUTH    IFEQ 'N'
     C***********          READ LEFCLTL0                 80               124485
     C                     READ LEFCLTL7                 80               124485
     C                     ELSE
     C                     READ LEFCLTL1                 80
     C                     ENDIF
     C*                                                                   CAP065
     C                     ENDIF                                          CAP065
      *
     C                     ENDDO
      *
     C                     Z-ADDRRN1      CURRRN  40
      *
      **  No more records to display next time user pressed rollup key
     C           *IN80     IFEQ *ON
     C                     MOVE *ON       *IN02            SFLEND(*MORE)
     C                     ELSE
      *
      **  Reposition file
     C                     MOVE *OFF      *IN02
      *
      **  Save key
     C**********           Z-ADDCNUM      K2CNUM                                              CSD027
     C                     MOVE CNUM      K2CNUM                                              CSD027
     C                     Z-ADDFACT      K2FACT
     C                     Z-ADDFCNO      K2FCNO
      *
     C                     ENDIF
      *
     C                     ENDIF
     C           RRN1      IFEQ 0                                         157895
     C                     MOVE *ON       *IN06            No records foun157895
     C                     MOVE *OFF      *IN01            SFLDSP         157895
     C                     Z-ADD0         ##SFRC                          157895
     C                     ENDIF                                          157895
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDBAU :   Validate branch authority
      ***********************************************************
     C           VLDBAU    BEGSR
      *
     C                     MOVE *OFF      *IN23
      *
     C                     Z-ADD*ZERO     @ERR
     C                     MOVE 'Y'       W#DSPR  1
      *
      **  Validate facility branch
     C           MBIN      IFEQ 'Y'
      *
     C           P#MODE    IFEQ 'B'
     C                     CALL 'ZBACTBU'
     C                     PARM S1ACTN    @ZACTN  1
     C                     PARM BRCA      @ZBR    3
     C                     PARM           @USER  10
     C**********           PARM           @ZMGRP  40                                          CSF002
     C**********           PARM           @ZICDE  4                                           CSF002
     C                     PARM           UNQCDE 10                                           CSF002
     C                     PARM           @ERR    10
     C                     ELSE
     C                     CALL 'ZVACTBU'
     C                     PARM S1ACTN    @ZACTN  1
     C                     PARM BRCA      @ZBR    3
     C                     PARM           @ERR    10
     C                     ENDIF
      *
     C           @ERR      IFEQ 1
     C                     MOVE 'N'       W#DSPR
     C                     ENDIF
     C                     ENDIF
      *
      **  Validate Orig. Branch if used and validation required and
      **  is not an enquiry and not an insert
     C           BKOBRU    IFEQ 'Y'
     C           BKOBUV    ANDEQ'Y'
     C           S1ACTN    ANDNE'I'
     C           S1ACTN    ANDNE'E'
      *
     C           P#MODE    IFEQ 'B'
     C                     CALL 'ZBOBU'
     C                     PARM ORBR      @ZOBRX  3
     C                     PARM           @USER  10
     C                     PARM           @ERR    10
     C                     ELSE
     C                     CALL 'ZVOBU'
     C                     PARM ORBR      @ZOBRX  3
     C                     PARM           @ERR    10
     C                     ENDIF
      *
     C           @ERR      IFNE *ZERO
      *
     C           @ERR      IFEQ 1
     C                     MOVEL'LEF0012' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN23
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF
      *
     C           @ERR      IFEQ 2
     C                     MOVEL'LEF0013' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN23
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDSFL :   Validate subfile & position fields
      ***********************************************************
     C           VLDSFL    BEGSR
      *
     C                     MOVE 'N'       W#ERR1
     C                     MOVE *OFF      *IN24
      *
      **  Check if position fields
     C           S1REV1    IFNE W#REV1
     C           S1REV2    ORNE W#REV2
     C           S1REV3    ORNE W#REV3
     C           S1AUTH    ORNE W#AUTH                                                        194667
      *
     C                     EXSR VLDPOS
      *
     C           W#ERR1    IFNE 'Y'
      **  Set up key fields to psition subfile
     C                     MOVE S1REV1    K2CNUM
     C                     MOVE S1REV2    K2FACT
     C                     MOVE S1REV3    K2FCNO
      *   save review fields
     C                     MOVE S1REV1    W#REV1
     C                     MOVE S1REV2    W#REV2
     C                     MOVE S1REV3    W#REV3
      *                                                                                       194667
     C           S1AUTH    IFEQ *BLANKS                                                       194667
     C                     MOVE W#AUTH    S1AUTH                                              194667
     C                     ENDIF                                                              194667
      *
      **  Clear subfile
     C                     MOVE *ON       *IN03            SFLCLR
     C                     MOVE *OFF      *IN01
     C                     WRITELE2020C1
      *
     C                     Z-ADD0         RRN1
     C                     Z-ADD0         CURRRN
     C                     MOVE *BLANKS   S#SEL1
     C                     MOVE *OFF      *IN26
     C                     EXSR BLDSFL
     C                     MOVE S1AUTH    W#AUTH                                              194667
     C                     ENDIF
      *
     C                     ELSE
      *
     C                     EXSR VLDSEL
      *
     C           W#SELE    IFEQ 'N'                                       119925
      *                                                                   119925
      **  Set up key fields to psition subfile                            119925
     C                     MOVE S1REV1    K2CNUM                          119925
     C                     MOVE S1REV2    K2FACT                          119925
     C                     MOVE S1REV3    K2FCNO                          119925
      *                                                                   119925
      **  Clear subfile                                                   119925
     C                     MOVE *ON       *IN03            SFLCLR         119925
     C                     MOVE *OFF      *IN01                           119925
     C                     WRITELE2020C1                                  119925
      *                                                                   119925
     C                     Z-ADD0         RRN1                            119925
     C                     Z-ADD0         CURRRN                          119925
     C                     MOVE *BLANKS   S#SEL1                          119925
     C                     MOVE *OFF      *IN26                           119925
     C                     EXSR BLDSFL                                    119925
     C                     MOVE S1AUTH    W#AUTH                                              194667
     C                     ENDIF                                          119925
      *                                                                   119925
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDSEL : Validate subfile selection
      ***********************************************************
     C           VLDSEL    BEGSR
      *
     C                     MOVE 'N'       W#CF12
     C                     MOVE 'N'       W#SELE  1                       119925
      *
      **  Read all changed records
     C                     READCLE2020S1                 87
      *
     C           *IN87     DOWEQ*OFF
     C           W#CF12    ANDEQ'N'
      *
     C           S#SEL1    IFEQ ' '
      *
     C                     MOVE *OFF      *IN26            RI & PC
     C                     MOVE *OFF      *IN04            SFLNXTCHG
      *
     C                     ELSE
      *                                                                   119925
     C                     MOVE 'Y'       W#SELE                          119925
      **  Only 'A' 'E' 'R' 'C' or 'X' is allowed
     C***********S#SEL1    IFNE 'E'                                       CAP065
     C           P#MODE    IFNE 'F'                                       CAP065
     C           S#SEL1    ANDNE'E'                                       CAP065
     C           S#SEL1    ANDNE'A'
     C           S#SEL1    ANDNE'R'
     C           S#SEL1    ANDNE'C'
     C           S#SEL1    ANDNE'X'
      **  Only 'Q' 'U' allowed in Fix/Repair mode                         CAP065
     C           P#MODE    OREQ 'F'                                       CAP065
     C           S#SEL1    ANDNE'Q'                                       CAP065
     C           S#SEL1    ANDNE'U'                                       CAP065
      *
     C                     MOVEL'LEF0016' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN26            SFLNXTCHG
     C                     MOVE *ON       *IN04            RI & PC
      *
     C                     ELSE
      *
     C           P#MODE    IFEQ 'F'                                       CAP065
     C                     MOVE SACTN     S1ACTN                          CAP065
     C                     ELSE                                           CAP065
     C                     MOVE S#SEL1    S1ACTN
     C                     ENDIF                                          CAP065
     C                     MOVE S#BRCA    BRCA                            187784
      *                                                                   187784
     C                     EXSR VLDAUT                                    187784
      *                                                                   187784
     C           W#ERR1    IFNE 'Y'                                       187784
      *
     C                     MOVE S#CNUM    K1CNUM
     C                     MOVE S#CNUM    K3CNUM
     C                     MOVE S#CNUM    S2CNUM
     C***********          MOVE S#CNUM    S1CUST                          121855
     C                     MOVELS#CNUM    S1CUST    P                     121855
     C                     MOVE S#FACT    K1FACT
     C                     MOVE S#FACT    K3FACT
     C                     MOVE S#FACT    S1FACT
     C                     MOVE S#FCNO    K1FCNO
     C                     MOVE S#FCNO    K3FCNO
     C                     MOVE S#FCNO    S1FCNO
     C*                                                                   CAP065
     C           P#MODE    IFEQ 'F'                                       CAP065
     C           XREPN     CHAINLEIFACP2             80                   CAP065
     C                     EXSR LOADIV                                    CAP065
     C                     MOVEL'LEIFACL1'W#FILE                          CAP065
     C*                                                                   CAP065
     C                     ELSE                                           CAP065
     C*                                                                   CAP065
     C***********K#KY01    CHAINLEFCLTL0             80                   124485
     C           K#KY01    CHAINLEFCLTL7             80                   124485
      *                                                                   128949
      **  Put file name in field for reference                            128949
      *                                                                   128949
     C                     MOVEL'LEFCLTL7'W#FILE                          128949
     C*                                                                   CAP065
     C                     ENDIF                                          CAP065
      *                                                                   128949
     C                     EXSR VLDACT
      *
     C           W#ERR1    IFNE 'Y'
     C           *LIKE     DEFN TNLU      W#TNLU                          120988
     C                     MOVE TNLU      W#TNLU                          120988
     C                     CALL 'AOCUSTR0'
     C                     PARM '       ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM S2CNUM    @CNUM  10
     C                     PARM           @CNST   7
     C           SDCUST    PARM SDCUST    DSSDY
     C                     MOVELBBCSSN    S2CSSN    P
     C                     MOVELBBCSSN    S3CSSN    P
     C                     MOVE 'B'       K3RCTP
     C           P#MODE    IFEQ 'F'                                       CAP065
     C           XREPN     CHAINLEIFACP2            N80                   CAP065
     C                     MOVE SACTN     S1ACTN                          CAP065
     C                     EXSR LOADIV                                    CAP065
     C                     ELSE                                           CAP065
     C           K#KY03    CHAINFCLTY               N80
     C                     ENDIF                                          CAP065
     C                     EXSR PROSEL
     C                     MOVE *OFF      *IN26            SFLNXTCHG
     C                     MOVE *OFF      *IN04            RI & PC
     C                     MOVE *BLANKS   S#SEL1
      *
     C                     ELSE
      *
     C                     MOVE *ON       *IN26            SFLNXTCHG
     C                     MOVE *ON       *IN04            RI & PC
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                   187784
     C                     END                                            187784
      *
     C                     Z-ADDRRN1      ##SFRC           SFLRCDNBR
      *
     C                     UPDATLE2020S1
      *
      **  Read next changed record
     C           W#CF12    IFEQ 'N'
     C                     READCLE2020S1                 87
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     MOVE *OFF      *IN87                                               194667
     C                     MOVE *OFF      *INKL
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  ENQRYS :   Enquire
      ***********************************************************
      *
     C           ENQRYS    BEGSR
      *
     C                     MOVE *ON       *IN07            Protect fields
      *
      **  Populate screen 1 fields
     C                     EXSR POPSC1
      *
      **  Continue to redisplay the screen if *IN12 & *IN03 remains off
     C           *INKC     DOWEQ*OFF
     C           *INKL     ANDEQ*OFF
      *
     C                     WRITELE2020F6                   Commands
     C                     WRITE#MSGCTL                    Messages
      *                                                                                       CLE034
      ** Re-use indicators 52 & 53                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE *IN52     WIN52   1                                           CLE034
     C                     MOVE *IN53     WIN53   1                                           CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE *ON       *IN52                                               CLE034
     C                     MOVE WVOVAM    *IN53                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *OFF      *IN52                                               CLE034
     C                     MOVE *OFF      *IN53                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     EXFMTLE2020F4                   Screen1
      *                                                                                       CLE034
      ** Restore values of indicators 52 & 53                                                 CLE034
      *                                                                                       CLE034
     C                     MOVE WIN52     *IN52                                               CLE034
     C                     MOVE WIN53     *IN53                                               CLE034
      *
     C                     MOVE 'SC1'     W#F5MD
      *
      **  Clear Message subfile
     C                     EXSR CLEARM
      *
      **  F3  - Exit
     C           *INKC     CASEQ'1'       CF03
      *                                   ****
      **  F12 - Previous
     C           *INKL     CASEQ'1'       CF12
      *                                   ****
      **  F21 - Funding Participants
     C           *INKV     CASEQ'1'       PRCMDK
      *                                   ****
      **  F22 - Risk Participants
     C           *INKW     CASEQ'1'       PRCMDK
      *                                   ****
      **  F23 - Assignments
     C           *INKX     CASEQ'1'       PRCMDK
      *                                   ****
      **  Process Enter
     C***17******          CAS            DSPSC2                          167979
     C                     CAS            DSPSC2                          176399
     C                     CAS            VLDSC1                          188823
      *                                   ******
     C                     ENDCS
      *
      **  Process Window
     C           *IN17     IFEQ *OFF
     C           *INKL     ANDEQ*OFF                                      122630
      ** Core hook for externalisation.
     C/COPY WNCPYSRC,LE2020CCP2
      *
     C/COPY WNCPYSRC,LE2020MOV1
     C                     EXSR SRWNDW
      *                                                                   122630
     C********** #RTRN     IFEQ *BLANKS                            122630 183724
     C**********           MOVE *ON       *INKL                    122630 183724
     C**********           ENDIF                                   122630 183724
      *                                                                   122630
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     MOVE *OFF      *IN07
     C                     MOVE *OFF      *INKL
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  INSRTS :   Insert
      ***********************************************************
     C           INSRTS    BEGSR
      *
     C           P#MODE    IFNE 'F'                                       CAP065
     C*                                                                   CAP065
     C                     MOVE *ON       *IN09
     C                     MOVE *OFF      *IN86
     C                     MOVE *ON       *IN82                           188931
     C                     MOVE 'N'       W#ERR1  1
     C                     MOVE 'I'       S1ACTN
     C                     MOVE *BLANKS   DAYSV2                          141485
     C                     MOVE *BLANKS   DAYSV                           141485
      * Initialise save of TRCA to an invalid value. Blanks is valid.     189577
     C                     MOVE '**'      TRCASV                          189577
      *
     C           W#F5MD    IFEQ 'SFL'
      *
      **  Validate users authority to use this branch/action
     C                     Z-ADD*ZERO     @ERR
      *
      **  If not a multi-branch
     C           MBIN      IFEQ 'N'
      *
     C           P#MODE    IFEQ 'B'
     C                     CALL 'ZBACTU'
     C                     PARM S1ACTN    @ZACTN  1
     C                     PARM           @USER  10
     C**********           PARM           @ZMGRP  40                                          CSF002
     C**********           PARM           @ZICDE  4                                           CSF002
     C                     PARM           UNQCDE 10                                           CSF002
     C                     PARM           @ERR    10
     C                     ELSE
     C                     CALL 'ZVACTU'
     C                     PARM S1ACTN    @ZACTN  1
     C                     PARM           @ERR    10
     C                     ENDIF
      *
     C           @ERR      IFNE *ZERO
     C                     MOVEL'LEF0009' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVE *BLANKS   S2CSSN
     C                     MOVE *BLANKS   S1FACT
      *
     C                     ENDIF
      *
     C           W#ERR1    IFNE 'Y'
      *
     C                     EXSR CLRSC1
     C                     EXSR CLRSC2
      *
      **  Continue to redisplay the screen if *IN12 & *IN03 remains off
     C           *INKC     DOWEQ*OFF
     C           *INKL     ANDEQ*OFF
      *
     C                     WRITELE2020F6                   Commands
      *                                                                                       CLE034
      ** Re-use indicators 52 & 53                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE *IN52     WIN52   1                                           CLE034
     C                     MOVE *IN53     WIN53   1                                           CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE *ON       *IN52                                               CLE034
     C                     MOVE WVOVAM    *IN53                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *OFF      *IN52                                               CLE034
     C                     MOVE *OFF      *IN53                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     WRITE#MSGCTL                    Messages
     C                     EXFMTLE2020F4                   Screen1
      *                                                                                       CLE034
      ** Restore values of indicators 52 & 53                                                 CLE034
      *                                                                                       CLE034
     C                     MOVE WIN52     *IN52                                               CLE034
     C                     MOVE WIN53     *IN53                                               CLE034
      *
      **  Clear Message subfile
     C                     EXSR CLEARM
      *
     C                     MOVE 'SC1'     W#F5MD
      *
      **  F3  - Exit
     C           *INKC     CASEQ'1'       CF03
      *
      **  F5  - Refresh
     C           *INKE     CASEQ'1'       CF05
      *                                   ****
      **  F12 - Previous
     C           *INKL     CASEQ'1'       CF12
      *                                   ****
      **  Process Enter
     C                     CAS            VLDSC1
      *                                   ******
     C                     ENDCS
      *
     C                     ENDDO
      *
     C                     ENDIF
      *
     C                     MOVE *OFF      *IN09
     C                     MOVE *OFF      *INKL
      *
     C                     ENDIF                                          CAP065
     C*                                                                   CAP065
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  AMENDS :   Amend
      ***********************************************************
     C           AMENDS    BEGSR
      *                                                                   CAP065
     C                     MOVE *OFF      WNXIST  1                       CAP065
      *                                                                   CAP065
     C           P#MODE    IFEQ 'F'                                       CAP065
     C           S1ACTN    ANDEQ'A'                                       CAP065
     C*   Check that Facility exists                                      CAP065
     C**********           Z-ADDSFCNM     K1CNUM                                       CAP065 CSD027
     C                     MOVE SFCNM     K1CNUM                                              CSD027
     C                     Z-ADDSFACT     K1FACT                          CAP065
     C                     Z-ADDSFCNO     K1FCNO                          CAP065
     C           K#KY01    CHAINLEFCLTL7             80                   CAP065
      *                                                                   CAP065
     C           *IN80     IFEQ *ON                                       CAP065
     C                     MOVE *ON       *IN07                           CAP065
     C                     MOVE *OFF      *IN08                           CAP065
     C                     MOVE *OFF      *IN17                           CAP065
     C                     MOVE *ON       WNXIST                          CAP065
     C                     MOVE 'LEF0315' ZAMSID                          CAP065
     C                     EXSR ZASNMS                                    CAP065
     C                     ENDIF                                          CAP065
     C                     ENDIF                                          CAP065
      *                                                                   CAP065
      **  If Facility is either closed or expired, check for records      169206
      **  in PF/LEFCAMPD if it has been reactivated.                      169206
      *                                                                   169206
     C                     MOVE *OFF      WREAC   1                       169206
     C           RECI      IFEQ 'C'                                       169206
     C           RECI      OREQ 'E'                                       169206
     C                     EXSR SRCKFR                                    169206
     C                     ENDIF                                          169206
      *                                                                   169206
      *
     C           *IN80     IFEQ *OFF                                      CAP065
     C*                                                                   CAP065
      **  If facility is reactivated and RECI = 'C', allow update         156297
      **     for field AVLD to be amendable                               156297
      *                                                                   156297
     C           WREAC     IFEQ *ON                                       156297
     C           WRECI     ANDEQ'C'                                       157579
     C***********RECI      ANDEQ'C'                                156297 157579
     C                     MOVE *ON       *IN07                           156297
     C                     ELSE                                           156297
     C                     MOVE *ON       *IN08
     C                     ENDIF                                          156297
      *
     C                     ENDIF                                          CAP065
     C*                                                                   CAP065
      **  Populate screen 1 fields
     C                     EXSR POPSC1
      *                                                                   CLE005
      **  If the Facility has expired or is closed, Expiry Date           CLE005
      **  Date should be protected.                                       CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           CLE007    ANDEQ'Y'                                       CLE005
     C***********DTEX      IFLT RUND                                CLE005126625
     C***********RECI      OREQ 'C'                                 CLE005126625
     C           RECI      IFEQ 'C'                                       126625
     C           DTEX      ORLT RUND                                      126625
     C                     MOVE '1'       *IN79                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      **  Protect Facility Amount and Revolving Credit Indicator          CLE005
      **  if CLE005 and CLE007 are installed                              CLE005
      *                                                                   CLE005
     C                     MOVE '1'       *IN78                           CLE005
     C                     ENDIF                                          CLE005
      *
      *
      **  Continue to redisplay the screen if *IN12 & *IN03 remains off
     C***********          Z-ADD0         W#CNT   10                CLE005133796
     C                     Z-ADD0         W#CNT   20                      133796
     C                     Z-ADD*ZEROS    W#CNTS                          133796
     C           *INKC     DOWEQ*OFF
     C           *INKL     ANDEQ*OFF
      *
     C                     WRITELE2020F6                   Commands
     C                     WRITE#MSGCTL                    Messages
      *                                                                                       CLE034
      ** Re-use indicators 52 & 53                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE *IN52     WIN52   1                                           CLE034
     C                     MOVE *IN53     WIN53   1                                           CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE *ON       *IN52                                               CLE034
     C                     MOVE WVOVAM    *IN53                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *OFF      *IN52                                               CLE034
     C                     MOVE *OFF      *IN53                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     EXFMTLE2020F4                   Screen1
      *                                                                                       CLE034
      ** Restore values of indicators 52 & 53                                                 CLE034
      *                                                                                       CLE034
     C                     MOVE WIN52     *IN52                                               CLE034
     C                     MOVE WIN53     *IN53                                               CLE034
      *
      **  Clear Message subfile
     C                     EXSR CLEARM
      *
     C                     MOVE 'SC1'     W#F5MD
      *
     C* If AMEND and Facility exists                                      CAP065
     C           WNXIST    IFEQ *OFF                                      CAP065
     C*                                                                   CAP065
      **  F3  - Exit
     C           *INKC     CASEQ'1'       CF03
      *                                   ****
      **  F5  - Refresh
     C           *INKE     CASEQ'1'       CF05
      *                                   ****
      **  F12 - Previous
     C           *INKL     CASEQ'1'       CF12
      *                                   ****
      **  F21 - Funding Participants
     C           *INKV     CASEQ'1'       PRCMDK
      *                                   ****
      **  F22 - Risk Participants
     C           *INKW     CASEQ'1'       PRCMDK
      *                                   ******
      **  F23 - Assignments
     C           *INKX     CASEQ'1'       PRCMDK
      *                                   ******
      **  Process Enter
     C                     CAS            VLDSC1
      *                                   ******
     C                     ENDCS
     C*                                                                   CAP065
     C* If AMEND and Facility does not exist                              CAP065
     C                     ELSE                                           CAP065
     C                     EXSR CF12                                      CAP065
     C                     MOVE *ON       *INKL                           CAP065
     C                     ENDIF                                          CAP065
      *
     C                     ENDDO
      *
     C                     MOVE *OFF      *IN07                           CAP065
     C                     MOVE *OFF      *IN08
     C                     MOVE *OFF      *INKL
     C                     MOVEA'00'      *IN,78                          CLE005
      *                                                                   CAP065
     C           W#IN17    IFEQ 'Y'                                       CAP065
     C                     MOVE *ON       *IN17                           CAP065
     C                     ELSE                                           CAP065
     C                     MOVE *OFF      *IN17                           CAP065
     C                     ENDIF                                          CAP065
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  AUTHOS :   Authorise
      ***********************************************************
     C           AUTHOS    BEGSR
      *
     C                     MOVE *ON       *IN10
     C                     MOVE *ON       *IN07            Protect fields
     C                     MOVE *OFF      *INKK                           CLE005
      *
      **  Populate screen 1 fields
     C                     EXSR POPSC1
      *
      **  Continue to redisplay the screen if *IN12 & *IN03 remains off
     C           *INKC     DOWEQ*OFF
     C           *INKL     ANDEQ*OFF
     C************INKK     ANDEQ*OFF                                      123857
      *
     C           W#EMSG    IFNE *BLANKS                                   CAP065
     C                     MOVE *OFF      *IN17                           CAP065
     C                     MOVE *ON       *IN88                           CAP065
     C                     MOVELW#EMSG    ZAMSID                          CAP065
     C                     EXSR ZASNMS                                    CAP065
     C                     ENDIF                                          CAP065
     C*                                                                   CAP065
     C                     WRITELE2020F6                   Commands
     C                     WRITE#MSGCTL                    Messages
      *                                                                                       CLE034
      ** Re-use indicators 52 & 53                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE *IN52     WIN52   1                                           CLE034
     C                     MOVE *IN53     WIN53   1                                           CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE *ON       *IN52                                               CLE034
     C                     MOVE WVOVAM    *IN53                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *OFF      *IN52                                               CLE034
     C                     MOVE *OFF      *IN53                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     EXFMTLE2020F4                   Screen1
      *                                                                                       CLE034
      ** Restore values of indicators 52 & 53                                                 CLE034
      *                                                                                       CLE034
     C                     MOVE WIN52     *IN52                                               CLE034
     C                     MOVE WIN53     *IN53                                               CLE034
      *
     C                     EXSR CLEARM                                    143819
     C                     MOVE 'SC1'     W#F5MD
      *
     C* If no problems with the Authorise so far                          CAP065
     C           W#EMSG    IFEQ *BLANKS                                   CAP065
     C*                                                                   CAP065
      **  F3  - Exit
     C           *INKC     CASEQ'1'       CF03
      *                                   ****
      **  F11 - Authorise
     C************INKK     CASEQ'1'       UPDFLE                          123857
     C  N88      *INKK     CASEQ'1'       VLDSC1                          123857
      *                                   ******
      **  F12 - Previous
     C           *INKL     CASEQ'1'       CF12
      *                                   ****
      **  F21 - Funding Participants
     C           *INKV     CASEQ'1'       PRCMDK
      *                                   ****
      **  F22 - Risk Participants
     C           *INKW     CASEQ'1'       PRCMDK
      *                                   ****
      **  F23 - Assignments
     C           *INKX     CASEQ'1'       PRCMDK
      *                                   ****
      **  Process Enter
      **  Validate Screen when *IN88='1' (Review all screens in           195995
      **  authorisation mode set in ICD)                                  195995
      *                                                                   195995
     C***17******          CAS            DSPSC2                          123857
     C**********           CAS            VLDSC1                   123857 183724
     C           *IN88     CASEQ'1'       VLDSC1                          195995
      *                                                                   195995
     C           *IN76     CASEQ'1'       DSPSC2                          183724
     C           *IN15     CASEQ'1'       DSPSC2                          183724
     C**********           CAS            DSPSC2                                       183724 194864
     C                     CAS            VLDSC1                          188823
      *                                   ******
     C                     ENDCS
     C*                                                                   CAP065
     C* If problems with the Authorise return to initial subfile          CAP065
     C                     ELSE                                           CAP065
     C                     EXSR CF12                                      CAP065
     C                     MOVE *ON       *INKL                           CAP065
     C                     ENDIF                                          CAP065
      *
      **  Process Window
     C           *IN17     IFEQ *OFF
     C           *INKL     ANDEQ*OFF                                      122630
     C           W#ERR1    ANDEQ'N'                                       188823
     C           W#WARN    ANDEQ'N'                                       188823
      *
     C/COPY WNCPYSRC,LE2020MOV1
     C                     EXSR SRWNDW
      *                                                                   123857
     C           SYIN      IFEQ 'Y'                                       123857
     C           PRTR      ANDNE'P'                                       123857
     C           PRTR      ANDNE'I'                                       123857
     C           #RTRN     ANDEQ*BLANKS                                   148847
     C                     EXSR SRPART                                    123857
     C                     ENDIF                                          123857
      *                                                                   122630
      ** Flag if ENTER is pressed aside from ROLLUP/DOWN.                 183724
      *                                                                   183724
     C           *IN76     IFEQ '0'                                       183724
     C           *IN15     ANDEQ'0'                                       183724
     C                     MOVE 'Y'       ENTPR   1                       183724
     C                     ELSE                                           183724
     C                     MOVE 'N'       ENTPR                           183724
     C                     END                                            183724
      *                                                                   183724
      ** To prevent initial screen from showing if ENTER, ROLLUP or       183724
      ** ROLLDOWN is pressed                                              183724
      *                                                                   183724
     C           #RTRN     IFEQ *BLANKS                                   122630
     C           *IN76     ANDNE'1'                                       183724
     C           *IN15     ANDEQ'0'                                       183724
     C           ENTPR     ANDNE'Y'                                       183724
     C           #RTRN     OREQ *BLANKS                                   183724
     C           *IN76     ANDEQ'0'                                       183724
     C           *IN15     ANDNE'1'                                       183724
     C           ENTPR     ANDNE'Y'                                       183724
     C           #RTRN     OREQ *BLANKS                                   195995
     C           *IN88     ANDEQ'1'                                       195995
     C           W#UPOK    ANDEQ'Y'                                       195995
     C                     MOVE *ON       *INKL                           122630
     C                     ENDIF                                          122630
      *                                                                   122630
      ** Only update facility if F11 - Authorise is pressed               183724
      *                                                                   123857
     C           WF2MSG    IFEQ ' '                                       148847
     C           *INKK     ANDEQ'1'                                       183724
     C                     EXSR UPDFLE                                    123857
     C                     ENDIF                                          148847
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     MOVE *OFF      *IN10
     C                     MOVE *OFF      *IN07
     C                     MOVE *OFF      *INKL
      *
     C           P#MODE    IFEQ 'F'                                       CAP065
     C           *INKK     ANDEQ'1'                                       CAP065
     C           W#EMSG    ANDEQ*BLANKS                                   CAP065
     C           XREPN     CHAINLEIFACDL             99                   CAP065
     C                     DELETLEIFACDL                                  CAP065
     C                     MOVEL'LEF0355' W#SMSG  7                       CAP065
     C                     MOVE CNUM      D#CNUM                          CAP065
     C                     MOVE FACT      D#FACT                          CAP065
     C                     MOVE FCNO      D#FCNO                          CAP065
     C                     MOVELFCTMSG    ZAMSDA                          CAP065
     C                     MOVE 'Y'       W#RBLD                          CAP065
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     EXSR LOGDEL                                    CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     ENDIF                                          CAP065
      *                                                                   CAP065
     C           W#IN17    IFEQ 'Y'                                       CAP065
     C                     MOVE *ON       *IN17                           CAP065
     C                     ELSE                                           CAP065
     C                     MOVE *OFF      *IN17                           CAP065
     C                     ENDIF                                          CAP065
      *                                                                   CAP065
     C           W#IN88    IFEQ 'Y'                                       CAP065
     C                     MOVE *ON       *IN88                           CAP065
     C                     ELSE                                           CAP065
     C                     MOVE *OFF      *IN88                           CAP065
     C                     ENDIF                                          CAP065
      *                                                                   CAP065
     C                     MOVE *BLANKS   W#EMSG                          CAP065
      *                                                                   CAP065
     C           *LOVAL    SETLLFCLTY                                                         204377
      *                                                                                       204377
     C                     ENDSR
      /EJECT
      ***********************************************************         123857
      *  SRPART :                                                         123857
      ***********************************************************         123857
     C           SRPART    BEGSR                                          123857
      *                                                                   123857
     C                     MOVE 'P'       WF2MSG                          148847
     C                     MOVE 'P'       WRPMSG  1                       148847
     C                     MOVE P#MODE    W#MODE  1                       148847
      *                                                                   148847
      ** Show participants screen                                         148847
      *                                                                   148847
     C           WF2MSG    DOWEQ'P'                                       148847
      *                                                                   148847
     C                     SELEC                                          148847
      *                                                                   148847
      ** Call funding participant program on enquire mode after enter     148847
      ** was pressed on second screen or F12 was pressed on Risk          148847
      ** participant screen                                               148847
      *                                                                   148847
     C           WRPMSG    WHEQ 'P'                                       148847
     C***********          MOVE P#MODE    W#MODE  1                123857 148847
     C                     MOVE 'E'       P#MODE                          123857
     C                     MOVELS2CNUM    F1PMFC                          123857
     C                     MOVELS1FACT    F1PMFT                          123857
     C                     MOVELS1FCNO    F1PMFN                          123857
     C                     MOVE S2BRCA    F1BRCA                          123857
     C                     MOVE S2FCCY    F1FCCY                          123857
     C                     MOVE ' '       F2MSGS                          123857
     C                     MOVE 'X'       F1ACTN                          123857
      *                                                                   123857
     C           CAP168    IFEQ 'Y'                                       CAP068
     C           P#MODE    ANDNE'B'                                       CAP068
     C           CAP068    OREQ 'Y'                                       CAP068
     C           P#MODE    ANDEQ'B'                                       CAP068
     C                     MOVEL'Y'       LEFPRT  1                       CAP068
     C                     ELSE                                           CAP068
     C                     MOVEL'N'       LEFPRT                          CAP068
     C                     ENDIF                                          CAP068
     C*                                                                   CAP068
     C           LEFPRT    IFEQ 'Y'                                       CAP068
     C                     CALL FPRT                                      CAP068
     C                     PARM           P#MODE           Batch/InteractiCAP068
     C                     PARM           P#F1MF           IN Message formCAP068
     C                     PARM           P#F2MF           OUT Message forCAP068
      *                                                                   CAP068
     C                     ELSE                                           CAP068
      *                                                                   CAP068
     C                     CALL 'LE2021'                                  123857
     C                     PARM           P#MODE           Batch/Interacti123857
     C                     PARM           P#F1MF           IN Message form123857
     C                     PARM           P#F2MF           OUT Message for123857
     C                     ENDIF                                          CAP068
      *                                                                   123857
     C           F2MSGS    IFEQ 'D'                                       123857
     C           *LOCK     IN   LDA                                       123857
     C                     Z-ADD9         DBASE                           123857
     C                     MOVEL'LE2021  'DBFILE                          123857
     C                     MOVEL'        'DBKEY                           123857
     C                     MOVEL'LE2020'  DBPGM                           123857
     C                     OUT  LDA                                       123857
     C                     EXSR *PSSR                                     123857
     C                     ENDIF                                          123857
      *                                                                   123857
      **  Terminate program if F3 was pressed                             123857
     C           F2MSGS    IFEQ 'T'                                       123857
     C                     EXSR CF03                                      123857
     C                     ENDIF                                          123857
      *                                                                   148847
      ** If F12 pressed from Funding participant screen, should go        148847
      ** back to second screen                                            148847
      *                                                                   148847
     C           F2MSGS    IFEQ 'P'                                       148847
     C                     MOVE 'N'       WF2MSG                          148847
     C                     MOVE ' '       WRPMSG                          148847
     C                     ENDIF                                          148847
      *                                                                   148847
      ** If Enter pressed from Funding participant move 'P' to WADMSG     148847
      ** to proceed to Risk Participant screen                            148847
      *                                                                   148847
     C           F2MSGS    IFEQ ' '                                       148847
     C                     MOVE 'P'       WADMSG                          148847
     C                     MOVE 'P'       WF2MSG                          148847
     C                     ENDIF                                          148847
     C                     MOVE ' '       WRPMSG                          148847
      *                                                                   148847
      ** Call Risk Participant program if enter pressed from Funding      148847
      ** Participant screen or F12 pressed from Assignment Details        148847
      *                                                                   148847
     C           WADMSG    WHEQ 'P'                                       148847
     C                     MOVELS2CNUM    R1CNUM                          148847
     C                     MOVELS1FACT    R1FACT                          148847
     C                     MOVELS1FCNO    R1FCNO                          148847
     C                     MOVE 'X'       R1ACTN                          148847
     C                     MOVE ' '       R2MSGS                          148847
      *                                                                   148847
     C           CAP169    IFEQ 'Y'                                       CAP069
     C           P#MODE    ANDNE'B'                                       CAP069
     C           CAP069    OREQ 'Y'                                       CAP069
     C           P#MODE    ANDEQ'B'                                       CAP069
     C                     MOVEL'Y'       LERPRT  1                       CAP069
     C                     ELSE                                           CAP069
     C                     MOVEL'N'       LERPRT                          CAP069
     C                     ENDIF                                          CAP069
     C*                                                                   CAP069
     C           LERPRT    IFEQ 'Y'                                       CAP069
     C                     CALL RPRT                                      CAP069
     C                     PARM           P#MODE           Batch/InteractiCAP069
     C                     PARM           P#R1MF           IN Message formCAP069
     C                     PARM           P#R2MF           OUT Message forCAP069
      *                                                                   CAP069
     C                     ELSE                                           CAP069
      *                                                                   CAP069
     C                     CALL 'LE2022'                                  148847
     C                     PARM           P#MODE           Batch/Interacti148847
     C                     PARM           P#R1MF           IN Message fmt 148847
     C                     PARM           P#R2MF           OUT Msg fmt    148847
     C                     ENDIF                                          CAP069
      *                                                                   148847
     C           R2MSGS    IFEQ 'D'                                       148847
     C           *LOCK     IN   LDA                                       148847
     C                     Z-ADD10        DBASE                           148847
     C                     MOVEL'LE2023  'DBFILE                          148847
     C                     MOVEL'        'DBKEY                           148847
     C                     MOVEL'LE2020'  DBPGM                           148847
     C                     OUT  LDA                                       148847
     C                     EXSR *PSSR                                     148847
     C                     ENDIF                                          148847
      *                                                                   148847
      **  Terminate program if F3 was pressed                             148847
     C           R2MSGS    IFEQ 'T'                                       148847
     C                     EXSR CF03                                      148847
     C                     ENDIF                                          148847
      *                                                                   148847
     C           R2MSGS    IFEQ 'P'                                       148847
     C                     MOVE R2MSGS    WF2MSG                          148847
     C                     MOVE R2MSGS    WRPMSG                          148847
     C                     ENDIF                                          148847
      *                                                                   148847
      ** If enter was pressed, move 'P' to WFSMSG to proceed to           148847
      ** Assignment program                                               148847
      *                                                                   148847
     C           R2MSGS    IFEQ ' '                                       148847
     C                     MOVE 'P'       WFSMSG                          148847
     C                     MOVE 'P'       WF2MSG                          148847
     C                     ENDIF                                          148847
     C                     MOVE ' '       WADMSG  1                       148847
      *                                                                   123857
      ** Call assignment program                                          123857
      ** if enter pressed from Risk participant screen                    148847
      *                                                                   148847
     C           WFSMSG    WHEQ 'P'                                       148847
     C                     MOVELS2CNUM    R1CNUM                          123857
     C                     MOVELS1FACT    R1FACT                          123857
     C                     MOVELS1FCNO    R1FCNO                          123857
     C                     MOVE 'X'       R1ACTN                          123857
     C                     MOVE ' '       R2MSGS                          123857
      *                                                                   123857
     C           CAP170    IFEQ 'Y'                                       CAP070
     C           P#MODE    ANDNE'B'                                       CAP070
     C           CAP070    OREQ 'Y'                                       CAP070
     C           P#MODE    ANDEQ'B'                                       CAP070
     C                     MOVEL'Y'       LEASGN  1                       CAP070
     C                     ELSE                                           CAP070
     C                     MOVEL'N'       LEASGN                          CAP070
     C                     ENDIF                                          CAP070
     C*                                                                   CAP070
     C           LEASGN    IFEQ 'Y'                                       CAP070
     C                     CALL ASGN                                      CAP070
     C                     PARM           P#MODE           Batch/InteractiCAP070
     C                     PARM           P#R1MF           IN Message formCAP070
     C                     PARM           P#R2MF           OUT Message forCAP070
      *                                                                   CAP070
     C                     ELSE                                           CAP070
      *                                                                   CAP070
     C                     CALL 'LE2023'                                  123857
     C                     PARM           P#MODE           Batch/Interacti123857
     C                     PARM           P#R1MF           IN Message form123857
     C                     PARM           P#R2MF           OUT Message for123857
      *                                                                   123857
     C                     ENDIF                                          CAP070
      *                                                                   123857
     C           R2MSGS    IFEQ 'D'                                       123857
     C           *LOCK     IN   LDA                                       123857
     C                     Z-ADD10        DBASE                           123857
     C                     MOVEL'LE2023  'DBFILE                          123857
     C                     MOVEL'        'DBKEY                           123857
     C                     MOVEL'LE2020'  DBPGM                           123857
     C                     OUT  LDA                                       123857
     C                     EXSR *PSSR                                     123857
     C                     ENDIF                                          123857
      *                                                                   123857
      **  Terminate program if F3 was pressed                             123857
     C***********F2MSGS    IFEQ 'T'                                123857 148847
     C           R2MSGS    IFEQ 'T'                                       148847
     C                     EXSR CF03                                      123857
     C                     ENDIF                                          123857
      *                                                                   148847
     C           R2MSGS    IFEQ 'P'                                       148847
     C                     MOVE R2MSGS    WF2MSG                          148847
     C                     MOVE R2MSGS    WADMSG                          148847
     C                     ENDIF                                          148847
      *                                                                   148847
     C           R2MSGS    IFEQ ' '                                       148847
     C                     MOVE ' '       WF2MSG  1                       148847
     C                     ENDIF                                          148847
     C                     MOVE ' '       WFSMSG  1                       148847
      *                                                                   148847
     C                     ENDSL                                          148847
      *                                                                   148847
     C                     ENDDO                                          148847
      *                                                                   123857
     C                     MOVE W#MODE    P#MODE                          123857
      *                                                                   123857
     C                     ENDSR                                          123857
      ***********************************************************
      *  RESRVS :   Reverse
      ***********************************************************
     C           RESRVS    BEGSR
      *
     C                     MOVE *ON       *IN11
     C                     MOVE *ON       *IN07            Protect fields
     C                     MOVE *OFF      *INKJ                           CLE005
      *
      **  Clear Message subfile
     C                     EXSR CLEARM
      *
      **  Populate screen 1 fields
     C                     EXSR POPSC1
      *
      **  Continue to redisplay the screen if *IN12 & *IN03 remains off
     C           *INKC     DOWEQ*OFF
     C           *INKL     ANDEQ*OFF
     C           *INKJ     ANDEQ*OFF
      *
     C           W#EMSG    IFNE *BLANKS                                   CAP065
     C                     MOVE *OFF      *IN11                           CAP065
     C                     MOVE *OFF      *IN17                           CAP065
     C                     MOVELW#EMSG    ZAMSID                          CAP065
     C                     EXSR ZASNMS                                    CAP065
     C                     ENDIF                                          CAP065
     C*                                                                   CAP065
     C                     WRITELE2020F6                   Commands
     C                     WRITE#MSGCTL                    Messages
      *                                                                                       CLE034
      ** Re-use indicators 52 & 53                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE *IN52     WIN52   1                                           CLE034
     C                     MOVE *IN53     WIN53   1                                           CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE *ON       *IN52                                               CLE034
     C                     MOVE WVOVAM    *IN53                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *OFF      *IN52                                               CLE034
     C                     MOVE *OFF      *IN53                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     EXFMTLE2020F4                   Screen1
      *                                                                                       CLE034
      ** Restore values of indicators 52 & 53                                                 CLE034
      *                                                                                       CLE034
     C                     MOVE WIN52     *IN52                                               CLE034
     C                     MOVE WIN53     *IN53                                               CLE034
      *
     C                     MOVE 'SC1'     W#F5MD
     C*                                                                   CAP065
     C* If no problems with the Reversal so far                           CAP065
     C           W#EMSG    IFEQ *BLANKS                                   CAP065
      *
      **  F3  - Exit
     C           *INKC     CASEQ'1'       CF03
      *                                   ****
      **  F10 - Reverse
     C/COPY WNCPYSRC,LE2020C001
     C           *INKJ     CASEQ'1'       UPDFLE
     C/COPY WNCPYSRC,LE2020C002
      *                                   ******
      **  F12 - Previous
     C           *INKL     CASEQ'1'       CF12
      *                                   ****
      **  F21 - Funding Participants
     C           *INKV     CASEQ'1'       PRCMDK
      *                                   ****
      **  F22 - Risk Participants
     C           *INKW     CASEQ'1'       PRCMDK
      *                                   ****
      **  F23 - Assignments
     C           *INKX     CASEQ'1'       PRCMDK
      *                                   ****
      **  Process Enter
     C***17******          CAS            DSPSC2                          167979
      *                                   ******
     C                     ENDCS
     C*                                                                   CAP065
     C* If problems with the Reversal return to initial subfile           CAP065
     C                     ELSE                                           CAP065
     C                     EXSR CF12                                      CAP065
     C                     MOVE *ON       *INKL                           CAP065
     C                     ENDIF                                          CAP065
      *
      **  Process Window
     C/COPY WNCPYSRC,LE2020C003
     C           *IN17     IFEQ *OFF
     C           *INKL     ANDEQ*OFF                                      122630
     C/COPY WNCPYSRC,LE2020C004
      *                                                                   122627
     C           P#MODE    IFEQ 'I'                                       122627
     C           P#MODE    OREQ 'R'                                       122627
      ** Core hook for externalisation.
     C/COPY WNCPYSRC,LE2020CCP4
      *
     C/COPY WNCPYSRC,LE2020MOV1
     C                     EXSR SRWNDW
      *                                                                   122630
     C           #RTRN     IFEQ *BLANKS                                   122630
     C                     MOVE *ON       *INKL                           122630
     C/COPY WNCPYSRC,LE2020C005
     C                     ENDIF                                          122630
      *                                                                   122630
     C                     ENDIF
      *                                                                   122627
     C                     ENDIF                                          122627
      *
     C                     ENDDO
      *
     C                     MOVE *OFF      *IN11
     C                     MOVE *OFF      *IN07
     C                     MOVE *OFF      *INKL
      *
     C           P#MODE    IFEQ 'F'                                       CAP065
     C           *INKJ     ANDEQ'1'                                       CAP065
     C           W#EMSG    ANDEQ*BLANKS                                   CAP065
     C           XREPN     CHAINLEIFACDL             99                   CAP065
     C                     DELETLEIFACDL                                  CAP065
     C                     MOVEL'LEF0357' W#SMSG  7                       CAP065
     C                     MOVE S2CNUM    D#CNUM                          CAP065
     C                     MOVE S1FACT    D#FACT                          CAP065
     C                     MOVE S1FCNO    D#FCNO                          CAP065
     C                     MOVELFCTMSG    ZAMSDA                          CAP065
     C                     MOVE 'Y'       W#RBLD                          CAP065
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     EXSR LOGDEL                                    CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     ENDIF                                          CAP065
      *                                                                   CAP065
     C           W#IN17    IFEQ 'Y'                                       CAP065
     C                     MOVE *ON       *IN17                           CAP065
     C                     ELSE                                           CAP065
     C                     MOVE *OFF      *IN17                           CAP065
     C                     ENDIF                                          CAP065
      *                                                                   CAP065
     C                     MOVE *BLANKS   W#EMSG                          CAP065
      *                                                                   CAP065
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  CLOSES :   Close
      ***********************************************************
     C           CLOSES    BEGSR
      *
     C*                                                                   CAP065
     C                     MOVE *ON       *IN12
     C                     MOVE *ON       *IN07            Protect fields
     C                     MOVE *OFF      *INKJ                           CLE005
      *
      **  Clear Message subfile
     C                     EXSR CLEARM
      *
      **  Populate screen 1 fields
     C                     EXSR POPSC1
      *
      **  Continue to redisplay the screen if *IN12 & *IN03 remains off
     C           *INKC     DOWEQ*OFF
     C           *INKL     ANDEQ*OFF
     C           *INKJ     ANDEQ*OFF
      *
     C           W#EMSG    IFNE *BLANKS                                   CAP065
     C                     MOVE *OFF      *IN17                           CAP065
     C                     MOVE *OFF      *IN12                           CAP065
     C                     MOVELW#EMSG    ZAMSID                          CAP065
     C                     EXSR ZASNMS                                    CAP065
     C                     ENDIF                                          CAP065
     C*                                                                   CAP065
     C                     WRITELE2020F6                   Commands
     C                     WRITE#MSGCTL                    Messages
      *                                                                                       CLE034
      ** Re-use indicators 52 & 53                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE *IN52     WIN52   1                                           CLE034
     C                     MOVE *IN53     WIN53   1                                           CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE *ON       *IN52                                               CLE034
     C                     MOVE WVOVAM    *IN53                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *OFF      *IN52                                               CLE034
     C                     MOVE *OFF      *IN53                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     EXFMTLE2020F4                   Screen1
      *                                                                                       CLE034
      ** Restore values of indicators 52 & 53                                                 CLE034
      *                                                                                       CLE034
     C                     MOVE WIN52     *IN52                                               CLE034
     C                     MOVE WIN53     *IN53                                               CLE034
      *
     C                     MOVE 'SC1'     W#F5MD
     C*                                                                   CAP065
     C* If no problems with the Closure so far                            CAP065
     C           W#EMSG    IFEQ *BLANKS                                   CAP065
      *
      **  F3  - Exit
     C           *INKC     CASEQ'1'       CF03
      *                                   ****
      **  F10 - Close
     C/COPY WNCPYSRC,LE2020C006
     C           *INKJ     CASEQ'1'       UPDFLE
     C/COPY WNCPYSRC,LE2020C007
      *                                   ****
      **  F12 - Previous
     C           *INKL     CASEQ'1'       CF12
      *                                   ****
      **  F21 - Funding Participants
     C           *INKV     CASEQ'1'       PRCMDK
      *                                   ****
      **  F22 - Risk Participants
     C           *INKW     CASEQ'1'       PRCMDK
      *                                   ****
      **  F23 - Assignments
     C           *INKX     CASEQ'1'       PRCMDK
      *                                   ****
      **  Process Enter
     C   17                CAS            DSPSC2
      *                                   ******
     C                     ENDCS
     C*                                                                   CAP065
     C* If problems with the Closure return to initial subfile            CAP065
     C                     ELSE                                           CAP065
     C                     EXSR CF12                                      CAP065
     C                     MOVE *ON       *INKL                           CAP065
     C                     ENDIF                                          CAP065
      *
      **  Process Window
     C/COPY WNCPYSRC,LE2020C008
     C           *IN17     IFEQ *OFF
     C           *INKL     ANDEQ*OFF                                      122630
     C/COPY WNCPYSRC,LE2020C009
      *                                                                   122627
     C           P#MODE    IFEQ 'I'                                       122627
     C           P#MODE    OREQ 'R'                                       122627
      ** Core hook for externalisation.
     C/COPY WNCPYSRC,LE2020CCP3
      *
     C/COPY WNCPYSRC,LE2020MOV1
     C                     EXSR SRWNDW
      *                                                                   122630
     C           #RTRN     IFEQ *BLANKS                                   122630
     C                     MOVE *ON       *INKL                           122630
     C/COPY WNCPYSRC,LE2020C010
     C                     ENDIF                                          122630
      *                                                                   122630
     C                     ENDIF
      *                                                                   122627
     C                     ENDIF                                          122627
      *
     C                     ENDDO
      *
     C                     MOVE *OFF      *IN12
     C                     MOVE *OFF      *IN07
     C                     MOVE *OFF      *INKL
      *
     C           P#MODE    IFEQ 'F'                                       CAP065
     C           *INKJ     ANDEQ'1'                                       CAP065
     C           W#EMSG    ANDEQ*BLANKS                                   CAP065
     C           XREPN     CHAINLEIFACDL             99                   CAP065
     C                     DELETLEIFACDL                                  CAP065
     C                     MOVEL'LEF0356' W#SMSG  7                       CAP065
     C                     MOVE S2CNUM    D#CNUM                          CAP065
     C                     MOVE S1FACT    D#FACT                          CAP065
     C                     MOVE S1FCNO    D#FCNO                          CAP065
     C                     MOVELFCTMSG    ZAMSDA                          CAP065
     C                     MOVE 'Y'       W#RBLD                          CAP065
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     EXSR LOGDEL                                    CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     ENDIF                                          CAP065
      *                                                                   CAP065
     C           W#IN17    IFEQ 'Y'                                       CAP065
     C                     MOVE *ON       *IN17                           CAP065
     C                     ELSE                                           CAP065
     C                     MOVE *OFF      *IN17                           CAP065
     C                     ENDIF                                          CAP065
      *                                                                   CAP065
     C                     MOVE *BLANKS   W#EMSG                          CAP065
      *                                                                   CAP065
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  POPSC1 :   Populate screen fields
      ***********************************************************
     C           POPSC1    BEGSR
      *
     C************LIKE     DEFN TNLU      W#TNLU                          120988
     C***********          MOVE TNLU      W#TNLU                          120988
      *  Status
     C                     MOVE *BLANKS   ZAMSID                          123998
     C                     SELEC
     C           RECI      WHEQ 'D'
     C           FSTS      ANDEQ'C'
     C***********          MOVEASTS,1     S2FSTS                          123998
     C                     MOVEL'LEF0118' ZAMSID                          123998
     C           RECI      WHEQ 'D'
     C           FSTS      ANDEQ'A'
     C***********          MOVEASTS,2     S2FSTS                          123998
     C                     MOVEL'LEF0119' ZAMSID                          123998
     C           RECI      WHEQ 'D'
     C           FSTS      ANDEQ'R'
     C***********          MOVEASTS,3     S2FSTS                          123998
     C                     MOVEL'LEF0120' ZAMSID                          123998
     C           RECI      WHEQ 'R'
     C           FSTS      ANDEQ'A'
     C***********          MOVEASTS,4     S2FSTS                          123998
     C                     MOVEL'LEF0121' ZAMSID                          123998
     C           RECI      WHEQ 'C'
     C           FSTS      ANDEQ'A'
     C***********          MOVEASTS,5     S2FSTS                          123998
     C                     MOVEL'LEF0122' ZAMSID                          123998
     C           RECI      WHEQ 'E'                                       124485
     C                     MOVEL'LEF0124' ZAMSID                          124485
     C                     OTHER
     C***********          MOVEASTS,6     S2FSTS                          123998
     C                     MOVE *BLANKS   S2FSTS                          123998
     C                     ENDSL
     C           ZAMSID    IFNE *BLANKS                                   123998
     C                     EXSR SRTEXT                                    123998
     C                     MOVELZAMSTX    S2FSTS                          123998
     C                     MOVE *BLANKS   ZAMSID                          123998
     C                     ENDIF                                          123998
      *
     C                     MOVE BRCA      S2BRCA
      *
     C                     MOVE FCCY      S2FCCY
      *
     C                     MOVE FCCY      CKEY
     C                     MOVE '*BLANKS' @RTCD
     C                     CALL 'AOCURRR0'PLIST2
     C           @RTCD     IFNE *BLANKS
     C           P#MODE    IFEQ 'F'                                       CAP068
     C                     MOVEL'LEF0360' ZAMSID                          CAP068
     C                     EXSR ZASNMS                                    CAP068
     C                     ELSE                                           CAP068
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE
     C                     Z-ADD1         DBASE
     C                     MOVELFCCY      DBKEY
     C                     MOVEL'LE2020'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF                                          CAP068
     C                     ENDIF
      *
     C           *LIKE     DEFN A6NBDP    W#NBDP
     C                     MOVE A6NBDP    W#NBDP
      *
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE FAMT      ZFIELD
     C                     Z-ADDW#NBDP    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    S2FAMT
      *                                                                                       194540
     C           FAMT      IFLT 0                                                             194540
     C                     Z-ADD*ZERO     ZFLD15                                              194540
     C                     MOVE FAMT      ZFLD15                                              194540
     C                     Z-ADDW#NBDP    ZDECS                                               194540
     C                     MOVE 'L'       ZECODE                                              194540
     C                     EXSR ZSEDIT                                                        194540
     C                     MOVE ZOUT21    S2FAMT                                              194540
     C                     ENDIF                                                              194540
      *
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE OVPC      ZFIELD
     C                     Z-ADD3         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    S2OVPC
      *                                                                                       CLE034
      ** Format over-line amount if CLE034 is on                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE *BLANKS   ZFIELD                                              CLE034
     C                     MOVE OVAM      ZFIELD                                              CLE034
     C                     Z-ADDW#NBDP    ZADEC                                               CLE034
     C                     EXSR ZEDIT                                                         CLE034
     C                     MOVE ZFIELD    S2OVAM                                              CLE034
     C                     ENDIF                                                              CLE034
      *
     C                     MOVE FCTI      S2FCTI
      *
     C                     MOVE DTAP      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     S2DTAP
      *
     C                     MOVE RVCR      S2RVCR
      *
     C                     MOVE MCCY      S2MCCY
      *
      *  In enquiry mode and multi currency is Y show permitted           121762
      *  currencies                                                       121762
      *                                                                   121762
     C           S1ACTN    IFEQ 'E'                                       121762
     C           S2MCCY    IFEQ 'Y'                                       121762
     C                     MOVE *ON       *IN13                           121762
     C                     ELSE                                           121762
     C                     MOVE *OFF      *IN13                           121762
     C                     ENDIF                                          121762
     C                     ENDIF                                          121762
      *                                                                   121762
     C                     MOVE SECI      S2SECI
      *
     C                     MOVE DTEX      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     S2DTEX
      * Save value of DTEX in date form for validation of AVLD            169206
     C                     MOVE ZDATE     DTEXS2  6                       169206
      *
     C                     MOVE CRSK      S2CRSK
      *
     C                     MOVE MCSI      S2MCSI
      *
     C                     MOVE NACD      S2NACD
      *
     C                     MOVE MBFC      S2MBFC
      *
     C           RVCD      IFEQ 0
     C                     MOVE *ON       *IN82
     C                     ELSE
     C                     MOVE *OFF      *IN82
     C                     MOVE RVCD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     S2RVCD
     C                     ENDIF
      *
     C           DLFS      IFEQ *ZEROS
     C                     MOVE *BLANKS   S2DLFS
     C                     ELSE
     C                     MOVE DLFS      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     S2DLFS
     C                     ENDIF
      *
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE NOMR      ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    S2NOMR
      *
     C           RVDT      IFEQ *ZEROS
     C                     MOVE *BLANKS   S2RVDT
     C                     ELSE
     C                     MOVE RVDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     S2RVDT
     C                     ENDIF
      *
     C                     MOVE RVFR      S2RVFR
      *
     C           RVDY      IFEQ *ZEROS
     C                     MOVE *BLANKS   S2RVDY
     C                     ELSE
     C                     MOVE RVDY      S2RVDY
     C                     ENDIF
      *
     C                     MOVE ACOF      S2ACOF
      *
     C                     MOVE PRFC      S2PRFC
     C                     MOVE BTIN      S2BTIN
      *
     C           BLDY      IFEQ *ZEROS
     C                     MOVE *BLANKS   S2BLDY
     C                     ELSE
     C                     MOVE BLDY      S2BLDY
     C                     ENDIF
      *
     C                     MOVE ORBR      S2ORBR
      *                                                                   128952
      **  Move Tranche/Credit Agreement Indicator, Credit Agreement       128952
      **  Customer, Type, and No. to the 1st screen instead of the 2nd    128952
      *                                                                   128952
     C           CLE005    IFEQ 'Y'                                       128952
     C                     MOVE TRCA      S3TRCA                          128952
     C                     MOVE CMDI      S3CMDI                                              202011
     C                     MOVE CMDI      TRCMDI                                              202011
      *                                                                                       202011
      ** Save the exchange rate between the TR and the CA ccys now, as                        202011
      ** when authorising a tranche the validation to see if the                              202011
      ** Credit Agreement will be exceeded is done on the first screen.                       202011
      *                                                                                       202011
     C                     Z-ADDCAXR      TRCAXR                                              202011
     C                     MOVE *BLANKS   ZFIELD                                              202011
     C           CAXR      IFEQ *ZERO                                                         202011
     C                     MOVE *BLANKS   S3CAXR                                              202011
     C                     ELSE                                                               202011
     C                     MOVE CAXR      ZFIELD                                              202011
     C                     Z-ADD8         ZADEC                                               202011
     C                     EXSR ZEDIT                                                         202011
     C                     MOVE ZFIELD    S3CAXR                                              202011
     C                     ENDIF                                                              202011
      *                                                                   128952
     C********** CANM      IFEQ *ZERO                                                  128952 CSD027
     C           CANM      IFEQ *BLANKS                                                       CSD027
     C                     MOVE *BLANKS   S3CANM                          128952
     C                     ELSE                                           128952
     C***********          MOVE CANM      S3CANM                    128952135140
     C                     MOVE CANM      S3CANM    P                     135140
     C                     ENDIF                                          128952
      *                                                                   128952
     C           CAFT      IFEQ *ZERO                                     128952
     C                     MOVE *BLANKS   S3CAFT                          128952
     C                     ELSE                                           128952
     C                     MOVE CAFT      S3CAFT                          128952
     C                     ENDIF                                          128952
      *                                                                   128952
     C           CAFN      IFEQ *ZERO                                     128952
     C                     MOVE *BLANKS   S3CAFN                          128952
     C                     ELSE                                           128952
     C                     MOVE CAFN      S3CAFN                          128952
     C                     ENDIF                                          128952
      *                                                                   128952
     C                     ENDIF                                          128952
      *
     C                     MOVE NAR1      S2NAR1
     C                     MOVE NAR2      S2NAR2
     C                     MOVE NAR3      S2NAR3
     C                     MOVE NAR4      S2NAR4
      *
     C                     MOVE ACSQ      S2ACSQ
      *                                                                   CLE005
     C                     MOVE SYIN      S3SYIN                          CLE005
      *                                                                   CLE005
      **  Reset Counter                                                   CLE005
      *                                                                   CLE005
     C***********CLE005    IFEQ 'Y'                                 CLE005133796
     C***********CLE007    ANDEQ'Y'                                 CLE005133796
     C                     Z-ADD0         W#CNT                           CLE005
     C                     Z-ADD*ZEROS    W#CNTS                          133796
     C                     MOVE '0'       *IN36                           CLE005
     C                     MOVE *OFF      *IN32                           133796
     C                     MOVE 'N'       W#WARN                          CLE005
     C                     MOVE '0'       *IN29                                               194864
     C***********          ENDIF                                    CLE005133796
      *                                                                   156999
      ** Get default participation type/subtype for F21 proc.             156999
      *                                                                   156999
     C                     MOVE DFTP      S3DFTP                          156999
     C                     MOVE DFST      S3DFST                          156999
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  POPSC2 :   Populate screen fields
      ***********************************************************
     C           POPSC2    BEGSR
      *
     C           PRTR      IFEQ 'P'
     C           PRTR      OREQ 'I'
     C                     MOVE *ON       *IN86
     C                     MOVE PMFC      S3PMFC
     C                     MOVE PMFT      S3PMFT
     C                     MOVE PMFN      S3PMFN
      *                                                                   CLE008
     C           CLE008    IFEQ 'Y'                                       CLE008
     C                     MOVE LAID      S3LAID                          CLE008
     C                     MOVE *ON       *IN77                           CLE008
     C                     MOVE *ON       *IN69                           CLE008
     C                     ELSE                                           CLE008
     C                     MOVE *OFF      *IN69                           CLE008
     C                     MOVE *ON       *IN77                           CLE008
     C                     ENDIF                                          CLE008
      *                                                                   CLE008
     C                     ELSE
     C                     MOVE *OFF      *IN86
      *                                                                   CLE008
     C           CLE008    IFEQ 'Y'                                       CLE008
     C                     MOVE LAID      S3LAID                          CLE008
     C                     MOVE *OFF      *IN77                           CLE008
     C                     MOVE *ON       *IN69                           CLE008
     C                     ELSE                                           CLE008
     C                     MOVE *ON       *IN77                           CLE008
     C                     MOVE *OFF      *IN69                           CLE008
     C                     ENDIF                                          CLE008
      *                                                                   CLE008
     C                     ENDIF
      *
     C                     MOVE SYIN      S3SYIN
      *
     C                     MOVE SYCP      S3SYCP
      *
     C********** ANUM      IFEQ 0                                                             CSD027
     C           ANUM      IFEQ *BLANKS                                                       CSD027
     C                     MOVE *BLANKS   S3ANUM
     C                     ELSE
     C                     MOVELANUM      S3ANUM
     C                     ENDIF
      *                                                                                       CLE028
      ** If Flat Rate Personal Loans (Rule of 78s) is installed,                              CLE028
      ** get the drawing types from the field DTPX.                                           CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     MOVE DTPX      S3DTX6                                              CLE028
     C                     MOVEADTPX      WDTS1                                               CLE028
     C                     ELSE                                                               CLE028
      *
     C                     MOVE DTPS      S3DTX5
     C                     MOVEADTPS      WDTS1                                               208485
     C                     ENDIF                                                              CLE028
      *
     C           DICB      IFEQ 0
     C                     MOVE *BLANKS   S3DICB
     C                     ELSE
     C                     MOVE DICB      S3DICB
     C                     ENDIF
      *
     C                     MOVE RTPS      S3RTX6
      *
     C           RLPD      IFEQ 0
     C                     MOVE *BLANKS   S3RLPD
     C                     ELSE
     C                     MOVE RLPD      S3RLPD
     C                     ENDIF
      *
     C                     MOVE CSEL      S3CSEL
      *
     C                     MOVE ALCY      S3ACCY
      *
     C           COMD      IFEQ *ZEROS
     C                     MOVE *BLANKS   S3COMD
     C                     ELSE
     C                     MOVE COMD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     S3COMD
     C                     ENDIF
      *
     C           CDTE      IFEQ *ZEROS
     C                     MOVE *BLANKS   S3CDTE
     C                     ELSE
     C                     MOVE CDTE      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     S3CDTE
     C                     ENDIF
      *
     C           AVLD      IFEQ *ZEROS
     C                     MOVE *BLANKS   S3AVLD
     C                     ELSE
     C                     MOVE AVLD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     S3AVLD
     C                     ENDIF
      *  Save value of AVLD which was output on screen:                   169206
     C                     MOVE ZDATE     AVLDS3  6                       169206
      *
     C                     MOVE LPTP      S3LPTP
      *
     C********** LPBR      IFEQ *ZEROS                                                        CSD103
     C**********           MOVE *BLANKS   S3LPBR                                              CSD103
     C**********           ELSE                                                               CSD103
     C                     MOVE LPBR      S3LPBR
     C**********           ENDIF                                                              CSD103
     C                     ENDIF
      *
     C           LPAM      IFNE *ZEROS                                    157744
     C           LPTP      IFEQ 'A'
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE LPAM      ZFIELD
     C                     Z-ADDW#NBDP    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    S3LPAM
     C                     ELSE
     C           LPTP      IFEQ 'P'
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE LPAM      ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    S3LPAM
     C                     ELSE
     C                     MOVE *BLANKS   S3LPAM
     C                     ENDIF
     C                     ENDIF
     C                     ELSE                                           157744
     C                     MOVE *BLANKS   S3LPAM                          157744
     C                     ENDIF                                          157744
      *
     C                     MOVE LPPS      S3LPPS                          157587
      *                                                                   157587
     C                     MOVE DFTP      S3DFTP
      *
     C                     MOVE DFST      S3DFST
      *                                                                   CLE005
      **  Move Credit/Agreement Exchange Rate and Indicator               CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C********** CLE006    ANDEQ'Y'                                CLE005 170106
     C                     MOVE *BLANKS   ZFIELD                          CLE005
     C           CAXR      IFEQ *ZERO                                     CLE005
     C                     MOVE *BLANKS   S3CAXR                          CLE005
     C                     ELSE                                           CLE005
     C                     MOVE CAXR      ZFIELD                          CLE005
     C                     Z-ADD8         ZADEC                           CLE005
     C                     EXSR ZEDIT                                     CLE005
     C                     MOVE ZFIELD    S3CAXR                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     MOVE CMDI      S3CMDI                          CLE005
      *                                                                   CLE005
      **  Reset Counter                                                   CLE005
      *                                                                   CLE005
     C           TESTSC    IFNE 'Y'                                       190134
     C                     Z-ADD0         W#CNT2  10                      CLE005
     C                     MOVE 'N'       W#WRN2  1                       CLE005
     C                     MOVE '0'       *IN70                           CLE005
     C                     ENDIF                                          190134
     C                     ENDIF                                          CLE005
      ***********                                                  CLE005 128952
      ****Move*Tranche/Credit Agreement Indicator, Credit AgreementCLE005 128952
      ****Customer, Type, and No.                                  CLE005 128952
      ***********                                                  CLE005 128952
     C***********CLE005    IFEQ 'Y'                                CLE005 128952
     C***********          MOVE TRCA      S3TRCA                   CLE005 128952
      ***********                                                  CLE005 128952
     C***********CANM      IFEQ *ZERO                              CLE005 128952
     C***********          MOVE *BLANKS   S3CANM                   CLE005 128952
     C***********          ELSE                                    CLE005 128952
     C***********          MOVE CANM      S3CANM                   CLE005 128952
     C***********          ENDIF                                   CLE005 128952
      ***********                                                  CLE005 128952
     C***********CAFT      IFEQ *ZERO                              CLE005 128952
     C***********          MOVE *BLANKS   S3CAFT                   CLE005 128952
     C***********          ELSE                                    CLE005 128952
     C***********          MOVE CAFT      S3CAFT                   CLE005 128952
     C***********          ENDIF                                   CLE005 128952
      ***********                                                  CLE005 128952
     C***********CAFN      IFEQ *ZERO                              CLE005 128952
     C***********          MOVE *BLANKS   S3CAFN                   CLE005 128952
     C***********          ELSE                                    CLE005 128952
     C***********          MOVE CAFN      S3CAFN                   CLE005 128952
     C***********          ENDIF                                   CLE005 128952
      ***********                                                  CLE005 128952
     C***********          ENDIF                                   CLE005 128952
      *
     C                     ENDSR
      /EJECT                                                              128952
      ***********************************************************         128952
      *  POPS2A :   Default the Tranche Details from the C/A              128952
      ***********************************************************         128952
     C           POPS2A    BEGSR                                          128952
      *                                                                   128952
     C           S3CANM    IFNE *BLANKS                                   128952
     C           S3CAFT    ANDNE*BLANKS                                   128952
     C           S3CAFN    ANDNE*BLANKS                                   128952
      *                                                                   128952
     C                     MOVE S3CANM    K1CANM                          128952
     C                     MOVE S3CAFT    K1CAFT                          128952
     C                     MOVE S3CAFN    K1CAFN                          128952
     C                     MOVE 'A'       K1RCTP                          128952
      *                                                                   128952
     C           K#KY11    CHAINFCLTY                80                   128952
     C           *IN80     IFEQ '0'                                       128952
      *                                                                                       CLE028
      ** If Flat Rate Personal Loans (Rule of 78s) is installed,                              CLE028
      ** get the drawing types from the field DTPX.                                           CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     MOVE DTPX      S3DTX6                                              CLE028
     C                     MOVEADTPX      WDTS1                                               CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE DTPS      S3DTX5                          128952
     C                     MOVEADTPS      WDTS1                                               208485
     C                     ENDIF                                                              CLE028
     C                     MOVE RTPS      S3RTX6                          128952
     C           RLPD      IFEQ 0                                         128952
     C                     MOVE *BLANKS   S3RLPD                          128952
     C                     ELSE                                           128952
     C                     MOVE RLPD      S3RLPD                          128952
     C                     ENDIF                                          128952
     C           *IN13     IFEQ '1'                                       128952
     C                     MOVE CSEL      S3CSEL                          128952
     C                     MOVE ALCY      S3ACCY                          128952
     C                     ELSE                                           128952
     C                     MOVE *BLANKS   S3CSEL                          128952
     C                     MOVE *BLANKS   S3ACCY                          128952
     C                     ENDIF                                          128952
      *                                                                   CLE008
     C           CLE008    IFEQ 'Y'                                       CLE008
     C                     MOVE LAID      S3LAID                          CLE008
     C           PRTR      IFEQ 'P'                                       CLE008
     C           PRTR      OREQ 'I'                                       CLE008
     C                     MOVE *ON       *IN77                           CLE008
     C                     ELSE                                           CLE008
     C                     MOVE *OFF      *IN77                           CLE008
     C                     ENDIF                                          CLE008
     C                     ENDIF                                          CLE008
      *                                                                   CLE008
     C                     ENDIF                                          128952
      *                                                                   128952
     C                     ENDIF                                          128952
      *                                                                   128952
      **  Chain back to original file                                     128952
      *                                                                   128952
     C           K#KY03    CHAINFCLTY               N80                   128952
      *                                                                   128952
      *                                                                                       192130
      ** Reset the counters/indicators used in validation                                     192130
      *                                                                                       192130
     C           CLE005    IFEQ 'Y'                                                           192130
     C                     Z-ADD0         W#CNT2                                              192130
     C                     MOVE 'N'       W#WRN2                                              192130
     C                     MOVE '0'       *IN70                                               192130
     C                     ENDIF                                                              192130
     C                     ENDSR                                          128952
      /EJECT
      ***********************************************************
      *  DSPSC2 :   Display Screen 2
      ***********************************************************
     C           DSPSC2    BEGSR
      *                                                                                       194667
      ** Reset error indicators                                                               194667
      *                                                                                       194667
     C                     MOVEAC#ZER2    *IN,52                                              194667
     C                     MOVE *OFF      *IN87                                               194667
      *                                                                   CLE005
      **  Clear message queue and reset error indicator                   CLE005
      *                                                                   CLE005
     C***********CLE005    IFEQ 'Y'                                 CLE005133796
     C***********CLE007    ANDEQ'Y'                                 CLE005133796
     C***********W#WARN    ANDEQ'Y'                                 CLE005133796
     C           W#WARN    IFEQ 'Y'                                       133796
     C           S1ACTN    OREQ 'X'                                       143819
      *                                                                   183724
      ** Do not clear error message if error encountered during           183724
      ** validation done when F11 is pressed on first screen.             183724
      *                                                                   183724
     C           W#ERR2    ANDNE'Y'                                       183724
      *                                                                   183724
     C                     EXSR CLEARM                                    CLE005
     C                     WRITE#MSGCTL                    Messages       CLE005
     C                     MOVE '0'       *IN36                           CLE005
     C                     MOVE *OFF      *IN32                           133796
     C                     MOVE '0'       *IN29                           143819
     C                     ENDIF                                          CLE005
      *                                                                   183724
     C                     MOVE '0'       *IN76                           183724
      *
      **  Populate screen 2 fields
     C           S1ACTN    IFNE 'I'
     C           W#FLAG    ANDEQ'Y'
     C           P#MODE    OREQ 'F'                                       CPK015
     C                     EXSR POPSC2
     C                     MOVE 'N'       W#FLAG  1
     C                     ENDIF
      *                                                                   128952
      **  Default the Tranche details from the Credit Agreement on Insert 128952
      *                                                                   128952
     C           S1ACTN    IFEQ 'I'                                       128952
     C                     EXSR POPS2A                                    128952
     C                     ENDIF                                          128952
      *
     C                     MOVE 'N'       W#UPOK  1
      *
      **  Continue to redisplay the screen if *IN12 & *IN03 remains off
     C           *INKC     DOWEQ*OFF
     C           *INKL     ANDEQ*OFF
     C           *IN76     ANDEQ*OFF                                      145912
     C           WSELT     OREQ 'Y'                                       157589
      *                                                                   157589
     C                     MOVE 'N'       WSELT   1                       157589
      *                                                                   183724
      ** Populate screen two for re-validation                            183724
      *                                                                   183724
     C           S1ACTN    IFEQ 'X'                                       183724
     C                     MOVE 'Y'       TESTSC  1                       190134
     C                     EXSR POPSC2                                    183724
     C                     MOVE 'N'       W#FLAG                          183724
     C                     MOVE 'N'       TESTSC                          190134
      *                                                                   183724
      ** Reset error indicators used for screen two validation            183724
      *                                                                   183724
     C           *INKK     IFEQ '0'                                       183724
     C           W#F5MD    ANDEQ'SC1'                                     183724
     C                     MOVEA'00000000'*IN,52                          183724
     C                     MOVEA'00000000'*IN,60                          183724
     C                     MOVE '0'       *IN68                           183724
     C                     MOVE '0'       *IN87                           183724
     C                     MOVE '00'      *IN,70                          183724
     C                     END                                            183724
      *                                                                   183724
     C                     END                                            183724
      *                                                                                       194667
     C           CLE008    IFEQ 'Y'                                                           194667
     C                     MOVE *ON       *IN69                                               194667
     C                     ELSE                                                               194667
     C                     MOVE *OFF      *IN69                                               194667
     C                     ENDIF                                                              194667
      *
      ** Condition *IN84 if facility was closed and is reactivated.       156297
      *                                                                   156297
     C***********RECI      IFEQ 'C'                                156297 157579
     C           WRECI     IFEQ 'C'                                       157579
     C           WREAC     ANDEQ*ON                                       156297
     C           S1ACTN    ANDEQ'A'                                       157579
     C                     MOVE *IN84     WTEMP   1                       156297
     C                     MOVE *ON       *IN84                           156297
     C                     ELSE                                                               190897
     C                     MOVE *OFF      *IN84                                               190897
     C                     ENDIF                                          156297
      *                                                                   156297
     C                     WRITELE2020F6                   Commands
     C                     WRITE#MSGCTL                    Messages
     C                     EXFMTLE2020F5                   Screen2
      *                                                                   156297
     C***********RECI      IFEQ 'C'                                156297 157579
     C           WRECI     IFEQ 'C'                                       157579
     C           WREAC     ANDEQ*ON                                       156297
     C           S1ACTN    ANDEQ'A'                                                           190897
     C                     MOVE WTEMP     *IN84                           156297
     C                     ENDIF                                          156297
      *
      **  Clear Message subfile
     C                     EXSR CLEARM
      *
     C                     MOVE 'SC2'     W#F5MD
      *
      **  F3  - Exit
     C           *INKC     CASEQ'1'       CF03
      *
      **  F5  - Refresh
     C           *INKE     CASEQ'1'       CF05
      *                                   ****
      **  F12 - Previous
     C           *INKL     CASEQ'1'       CF12
      *                                   ****
      **  Rolldown                                                        145912
      *                                                                   145912
     C           *IN76     CASEQ'1'       CF12                            145912
      *                                   ****                            145912
      **  F10 - Close/Delete
     C           *INKJ     CASEQ'1'       UPDFLE
      *                                   ****
      **  F11 - Authorise
     C************INKK     CASEQ'1'       UPDFLE                          123857
     C  N88      *INKK     CASEQ'1'       VLDSC2                          123857
      *                                   ****
      **  F21 - Funding Participants
     C           *INKV     CASEQ'1'       PRCMDK
      *                                   ****
      **  F22 - Risk Participants
     C           *INKW     CASEQ'1'       PRCMDK
      *                                   ****
      **  F23 - Assignments
     C           *INKX     CASEQ'1'       PRCMDK
      *                                   ****
      **  Validate screen 2
     C**********           CAS            VLDSC2                          183724
     C********** *IN15     CASEQ'0'       VLDSC2                                       183724 194864
     C********** *IN15     CASEQ'1'       VLDSC2                                       183724 194864
     C                     CAS            VLDSC2                                              194864
      *                                   ******
     C                     ENDCS
      *
     C                     ENDDO
      *                                                                   183724
      ** Enable switch to next record when ENTER pressed after ROLLDOWN   183724
      *                                                                   183724
     C           *IN76     IFEQ '1'                                       183724
     C                     MOVE 'N'       W#CF12                          183724
     C                     END                                            183724
      *
     C           W#UPOK    IFEQ 'N'
     C                     MOVE *OFF      *INKL
     C                     MOVE *OFF      *IN76                           145912
     C                     ELSE                                                               194864
     C                     Z-ADD0         W#CNTT                                              194864
     C                     Z-ADD0         W#CNT2                                              194864
     C                     MOVE 'N'       W#WRN2                                              194864
     C                     ENDIF
      *                                                                   183724
      ** For Authorisation go to first screen if F12 pressed              183724
      *                                                                   183724
     C           S1ACTN    IFEQ 'X'                                       183724
     C           *INKK     ANDEQ'0'                                       183724
     C           *IN88     ANDEQ'0'                                       188823
     C                     MOVE '0'       *INKL                           183724
     C                     END                                            183724
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  CLRSC1 :   Clear screen 1
      ***********************************************************
     C           CLRSC1    BEGSR
     C                     MOVE *BLANKS   S2BRCA
     C                     MOVE *BLANKS   S2FCCY
     C                     MOVE *BLANKS   S2FAMT
     C                     MOVE *BLANKS   S2OVPC
     C                     MOVE *BLANKS   S2OVAM                                              CLE034
     C                     MOVE *BLANKS   S2FCTI
     C                     MOVE *BLANKS   S2DTAP
     C                     MOVE *BLANKS   S2RVCR
     C                     MOVE *BLANKS   S2MCCY
     C                     MOVE *BLANKS   S2SECI
     C                     MOVE *BLANKS   S2DTEX
     C                     MOVE *BLANKS   S2CRSK
     C                     MOVE *BLANKS   S2MCSI
     C                     MOVE *BLANKS   S2NACD
     C                     MOVE *BLANKS   S2MBFC
     C                     MOVE *BLANKS   S2DLFS
     C                     MOVE *BLANKS   S2NOMR
     C                     MOVE *BLANKS   S2RVDT
     C                     MOVE *BLANKS   S2RVFR
     C                     MOVE *BLANKS   S2RVDY
     C                     MOVE *BLANKS   S2ACOF
     C                     MOVE *BLANKS   S2PRFC
     C                     MOVE *BLANKS   S2ORBR
     C                     MOVE *BLANKS   S2NAR1
     C                     MOVE *BLANKS   S2NAR2
     C                     MOVE *BLANKS   S2NAR3
     C                     MOVE *BLANKS   S2NAR4
     C                     MOVE *BLANKS   S2BTIN
     C                     MOVE *BLANKS   S2BLDY
     C                     MOVE *BLANKS   S2ACSQ                          CLE005
      *                                                                   128952
      **  Move C/A fields to 1st screen instead of the 2nd                128952
      *                                                                   128952
     C                     MOVE *BLANKS   S3TRCA                          128952
     C                     MOVE *BLANKS   S3CANM                          128952
     C                     MOVE *BLANKS   S3CAFT                          128952
     C                     MOVE *BLANKS   S3CAFN                          128952
      *                                                                   128952
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  CLRSC2 :   Clear screen 2
      ***********************************************************
     C           CLRSC2    BEGSR
      *
     C                     MOVE *BLANKS   S3SYIN
     C                     MOVE *BLANKS   S3SYCP
     C                     MOVE *BLANKS   S3ANUM
     C                     MOVE *BLANKS   S3DTS1
     C                     MOVE *BLANKS   S3DTS2
     C                     MOVE *BLANKS   S3DTS3
     C                     MOVE *BLANKS   S3DTS4
     C                     MOVE *BLANKS   S3DTS5
     C                     MOVE *BLANKS   S3DTS6                                              CLE028
     C                     MOVE *BLANKS   S3DICB
     C                     MOVE *BLANKS   S3RTS1
     C                     MOVE *BLANKS   S3RTS2
     C                     MOVE *BLANKS   S3RTS3
     C                     MOVE *BLANKS   S3RTS4
     C                     MOVE *BLANKS   S3RTS5
     C                     MOVE *BLANKS   S3RTS6
     C                     MOVE *BLANKS   S3RLPD
     C                     MOVE *BLANKS   S3CSEL
     C                     MOVE *BLANKS   S3CY01
     C                     MOVE *BLANKS   S3CY02
     C                     MOVE *BLANKS   S3CY03
     C                     MOVE *BLANKS   S3CY04
     C                     MOVE *BLANKS   S3CY05
     C                     MOVE *BLANKS   S3CY06
     C                     MOVE *BLANKS   S3CY07
     C                     MOVE *BLANKS   S3CY08
     C                     MOVE *BLANKS   S3CY09
     C                     MOVE *BLANKS   S3CY10
     C                     MOVE *BLANKS   S3CY11
     C                     MOVE *BLANKS   S3CY12
     C                     MOVE *BLANKS   S3COMD
     C                     MOVE *BLANKS   S3CDTE
     C                     MOVE *BLANKS   S3AVLD
     C                     MOVE *BLANKS   S3LPTP
     C                     MOVE *BLANKS   S3LPBR
     C                     MOVE *BLANKS   S3LPAM
     C                     MOVE *BLANKS   S3LPPS
     C                     MOVE *BLANKS   S3DFTP
     C                     MOVE *BLANKS   S3DFST
     C                     MOVE *BLANKS   S3CAXR                          CLE005
     C                     MOVE *BLANKS   S3CMDI                          CLE005
      *                                                                   128952
      **  Move C/A fields to 1st screen instead of the 2nd                128952
      *                                                                   128952
     C***********          MOVE *BLANKS   S3TRCA                   CLE005 128952
     C***********          MOVE *BLANKS   S3CANM                   CLE005 128952
     C***********          MOVE *BLANKS   S3CAFT                   CLE005 128952
     C***********          MOVE *BLANKS   S3CAFN                   CLE005 128952
     C                     MOVE *BLANKS   S3LAID                          CLE008
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  CF03   :   Closedown
      ***********************************************************
     C           CF03      BEGSR
      *
     C                     MOVE *ON       *INLR
     C                     RETRN
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  CF05   :   Refresh
      ***********************************************************
     C           CF05      BEGSR
      *
      ** Clear Message subfile
     C                     EXSR CLEARM
      *
      ** If it is in Subfile Mode
     C                     SELEC
      *
     C           W#F5MD    WHEQ 'SFL'
      *
      ** Force rebuild of subfile if F5 used                              145908
     C                     MOVE 'Y'       W#RBLD                          145908
     C                     MOVE W#AUTH    S1AUTH                                              194667
     C           W#RBLD    IFEQ 'Y'
     C                     MOVE 'N'       W#RBLD  1
      *
      **  Clear subfile
     C                     MOVE *ON       *IN03            SFLCLR
     C                     MOVE *OFF      *IN01
     C                     WRITELE2020C1
      *
      **  Build first page
     C**********           Z-ADD0         K2CNUM                                              CSD027
     C                     MOVE *BLANKS   K2CNUM                                              CSD027
     C                     Z-ADD0         K2FACT
     C                     Z-ADD0         K2FCNO
      *
     C                     Z-ADD0         RRN1    40
     C                     Z-ADD0         CURRRN
     C                     MOVE *BLANKS   S#SEL1
     C                     MOVE *OFF      *IN26
     C                     EXSR BLDSFL
      *
     C                     ELSE
      *
      ** Clear Selection field
     C           *IN06     IFEQ *OFF
     C                     READCLE2020S1                 87
     C           *IN87     DOWEQ*OFF
     C                     MOVE ' '       S#SEL1
     C                     MOVE *OFF      *IN26
     C                     MOVE *OFF      *IN04
     C                     UPDATLE2020S1
     C                     READCLE2020S1                 87
     C                     ENDDO
      *                                                                   121754
     C                     Z-ADDRRN1      ##SFRC                          121754
      *                                                                   121754
     C                     ENDIF
      *
      ** Position to first page
     C                     ENDIF
      *
     C           W#F5MD    WHEQ 'SC1'
     C           S1ACTN    ANDEQ'I'
     C                     EXSR CLRSC1
     C                     MOVEAC#ZER1    *IN,27
     C                     MOVEA'0000'    *IN,72                          128952
     C                     MOVE '0'       WVOVAM                                              CLE034
      *
     C           W#F5MD    WHEQ 'SC1'
     C           S1ACTN    ANDEQ'A'
     C                     EXSR POPSC1
     C                     MOVEAC#ZER1    *IN,27
     C                     MOVEA'0000'    *IN,72                          128952
     C                     MOVE '0'       WVOVAM                                              CLE034
      *
     C           W#F5MD    WHEQ 'SC2'
     C           S1ACTN    ANDEQ'I'
     C                     EXSR CLRSC2
     C                     MOVEAC#ZER2    *IN,52
      *
     C           W#F5MD    WHEQ 'SC2'
     C           S1ACTN    ANDEQ'A'
     C                     EXSR POPSC2
     C                     MOVEAC#ZER2    *IN,52
      *
     C                     ENDSL
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  CF12   :   Previous
      ***********************************************************
     C           CF12      BEGSR
      *
     C                     MOVE 'Y'       W#CF12  1
      *
     C                     SELEC
      *
     C           W#F5MD    WHEQ 'SC1'
     C                     MOVEAC#ZER1    *IN,27
     C                     MOVEAC#ZER2    *IN,52
     C                     MOVE '0'       WVOVAM                                              CLE034
      *
     C           W#F5MD    WHEQ 'SFL'
     C                     MOVE *BLANKS   S1ACTN
     C                     MOVE *BLANKS   S1CUST
     C                     MOVE *BLANKS   S1FACT
     C                     MOVE *BLANKS   S1FCNO
     C                     MOVE *OFF      *IN20
     C                     MOVE *OFF      *IN21
     C                     MOVE *OFF      *IN22
     C                     MOVE *OFF      *IN23                           143795
      *
      **  Clear subfile
     C           *IN06     IFEQ *OFF
     C                     MOVE *ON       *IN03            SFLCLR
     C                     MOVE *OFF      *IN01
     C                     WRITELE2020C1
     C                     ENDIF
      *
     C                     ENDSL
      *
      ** Reinitialise W#ERR1 when F12 is pressed.                         184900
      *                                                                   184900
     C                     MOVE 'N'       W#ERR1                          184900
      *                                                                   184900
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  PRCMDK :   Process F21, F22, F23
      ***********************************************************
     C           PRCMDK    BEGSR
      *
      *
     C           PRTR      IFEQ 'P'
     C           PRTR      OREQ 'I'
     C                     MOVEL'LEF0084' ZAMSID
     C                     EXSR ZASNMS
      *
     C                     ELSE
      *
     C***********SYIN      IFNE 'Y'                                       CLE005
     C           S3SYIN    IFNE 'Y'                                       CLE005
     C                     MOVEL'LEF0108' ZAMSID
     C                     EXSR ZASNMS
      *
     C                     ELSE
      *
     C                     MOVE 'N'       W#ERR1
     C                     MOVE 'N'       W#ERR2
     C                     MOVE P#MODE    W#MODE  1
      *
     C           S1ACTN    IFEQ 'I'
     C           S1ACTN    OREQ 'A'
      *
     C           W#F5MD    IFEQ 'SC1'
     C                     EXSR VLDSC1
     C                     ELSE
     C           W#F5MD    IFEQ 'SC2'
     C                     EXSR VLDSC2
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           W#ERR1    IFEQ 'N'
     C           W#ERR2    ANDEQ'N'
      *
     C           S1ACTN    IFEQ 'E'
     C           S1ACTN    OREQ 'X'
     C                     MOVE 'E'       P#MODE
     C                     ENDIF
      *                                                                   CLE005
     C                     MOVELS2CNUM    R1CNUM                          CLE005
     C                     MOVELS1FACT    R1FACT                          CLE005
     C                     MOVELS1FCNO    R1FCNO                          CLE005
     C                     MOVE ' '       R2MSGS                          CLE005
      *
     C                     SELEC
      *
     C           *INKV     WHEQ *ON
      *                                                                   156999
      ** Send error message if default loan type/subtype are set          156999
      ** to blanks                                                        156999
      *                                                                   156999
     C           S3DFTP    IFEQ *BLANKS                                   156999
     C           S3DFST    OREQ *BLANKS                                   156999
     C                     MOVEL'LEF0312' ZAMSID                          156999
     C                     EXSR ZASNMS                                    156999
     C                     ELSE                                           156999
      *
      **  Populate prime facility fields
     C           PRTR      IFEQ 'P'
     C           PRTR      OREQ 'I'
     C                     MOVELPMFC      F1PMFC
     C                     MOVELPMFT      F1PMFT
     C                     MOVELPMFN      F1PMFN
     C                     ELSE
     C                     MOVELS2CNUM    F1PMFC
     C                     MOVELS1FACT    F1PMFT
     C                     MOVELS1FCNO    F1PMFN
     C                     ENDIF
      *
     C                     MOVE S2BRCA    F1BRCA
     C                     MOVE S2FCCY    F1FCCY
     C           S1ACTN    IFEQ 'X'                                       148851
     C                     MOVE ' '       F1ACTN                          123857
     C                     ELSE                                           148851
     C                     MOVE S1ACTN    F1ACTN                          148851
     C                     ENDIF                                          148851
     C                     MOVE *BLANKS   F1FAMT                          148851
     C                     MOVE FAMT      F1FAMT                          148851
     C                     MOVE S3TRCA    F1TRCA                          148851
     C                     MOVE S3SYIN    F1SYIN                          148851
     C                     MOVE S2CNUM    F1CNUM                          148851
     C                     MOVE S1FACT    F1FACT                          148851
     C                     MOVE S1FCNO    F1FCNO                          148851
     C                     MOVE S3CANM    F1CANM                          148851
     C                     MOVE S3CAFT    F1CAFT                          148851
     C                     MOVE S3CAFN    F1CAFN                          148851
     C**********           Z-ADDANUM      F1ANUM                                       148851 CSD027
     C                     MOVE ANUM      F1ANUM                                              CSD027
     C                     MOVE ' '       F2MSGS
      *
      *                                                                   CAP068
     C           CAP168    IFEQ 'Y'                                       CAP068
     C           P#MODE    ANDNE'B'                                       CAP068
     C           CAP068    OREQ 'Y'                                       CAP068
     C           P#MODE    ANDEQ'B'                                       CAP068
     C                     MOVEL'Y'       LEFPRT  1                       CAP068
     C                     ELSE                                           CAP068
     C                     MOVEL'N'       LEFPRT                          CAP068
     C                     ENDIF                                          CAP068
     C*                                                                   CAP068
     C           LEFPRT    IFEQ 'Y'                                       CAP068
     C                     CALL FPRT                                      CAP068
     C                     PARM           P#MODE           Batch/InteractiCAP068
     C                     PARM           P#F1MF           IN Message formCAP068
     C                     PARM           P#F2MF           OUT Message forCAP068
      *                                                                   CAP068
     C                     ELSE                                           CAP068
      *                                                                   CAP068
     C                     CALL 'LE2021'
     C                     PARM           P#MODE           Batch/Interacti
     C                     PARM           P#F1MF           IN Message format
     C                     PARM           P#F2MF           OUT Message format
     C                     ENDIF                                          CAP068
      *                                                                   156999
     C                     ENDIF                                          156999
      *
     C           *INKW     WHEQ *ON
      *                                                                   CAP069
     C           CAP169    IFEQ 'Y'                                       CAP069
     C           P#MODE    ANDNE'B'                                       CAP069
     C           CAP069    OREQ 'Y'                                       CAP069
     C           P#MODE    ANDEQ'B'                                       CAP069
     C                     MOVEL'Y'       LERPRT  1                       CAP069
     C                     ELSE                                           CAP069
     C                     MOVEL'N'       LERPRT                          CAP069
     C                     ENDIF                                          CAP069
     C*                                                                   CAP069
     C           LERPRT    IFEQ 'Y'                                       CAP069
     C                     CALL RPRT                                      CAP069
     C                     PARM           P#MODE           Batch/InteractiCAP069
     C                     PARM           P#R1MF           IN Message formCAP069
     C                     PARM           P#R2MF           OUT Message forCAP069
      *                                                                   CAP069
     C                     ELSE                                           CAP069
      *                                                                   CAP069
     C                     CALL 'LE2022'
     C                     PARM           P#MODE           Batch/Interacti
     C                     PARM           P#R1MF           IN Message format
     C                     PARM           P#R2MF           OUT Message format
     C                     ENDIF                                          CAP069
      *
     C           *INKX     WHEQ *ON
      *
     C***********          MOVELS2CNUM    R1CNUM                          CLE005
     C***********          MOVELS1FACT    R1FACT                          CLE005
     C***********          MOVELS1FCNO    R1FCNO                          CLE005
     C***********          MOVE ' '       R1ACTN                   123857 CLE005
     C***********          MOVE ' '       R2MSGS                          CLE005
      *
     C           CAP170    IFEQ 'Y'                                       CAP070
     C           P#MODE    ANDNE'B'                                       CAP070
     C           CAP070    OREQ 'Y'                                       CAP070
     C           P#MODE    ANDEQ'B'                                       CAP070
     C                     MOVEL'Y'       LEASGN  1                       CAP070
     C                     ELSE                                           CAP070
     C                     MOVEL'N'       LEASGN                          CAP070
     C                     ENDIF                                          CAP070
     C*                                                                   CAP070
     C           LEASGN    IFEQ 'Y'                                       CAP070
     C                     CALL ASGN                                      CAP070
     C                     PARM           P#MODE           Batch/InteractiCAP070
     C                     PARM           P#R1MF           IN Message formCAP070
     C                     PARM           P#R2MF           OUT Message forCAP070
      *                                                                   CAP070
     C                     ELSE                                           CAP070
      *                                                                   CAP070
     C                     CALL 'LE2023'
     C                     PARM           P#MODE           Batch/Interacti
     C                     PARM           P#R1MF           IN Message format
     C                     PARM           P#R2MF           OUT Message format
     C                     ENDIF                                          CAP070
      *
     C                     ENDSL
      *
     C           F2MSGS    IFEQ 'D'
     C           *LOCK     IN   LDA
     C                     Z-ADD2         DBASE
     C                     MOVEL'LE2021  'DBFILE
     C                     MOVEL'        'DBKEY
     C                     MOVEL'LE2020'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           R2MSGS    IFEQ 'D'
     C           *LOCK     IN   LDA
     C                     Z-ADD8         DBASE
     C                     MOVEL'LE2023  'DBFILE
     C                     MOVEL'        'DBKEY
     C                     MOVEL'LE2020'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Terminate program if F3 was pressed                             123857
     C           F2MSGS    IFEQ 'T'                                       123857
     C           R2MSGS    OREQ 'T'                                       123857
     C                     EXSR CF03                                      123857
     C                     ENDIF                                          123857
      *                                                                   123857
     C                     MOVE W#MODE    P#MODE
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDSC1 :   Validate screen details (Screen 1)
      ***********************************************************
     C           VLDSC1    BEGSR
      *
     C                     MOVE 'N'       W#ERR1
     C                     MOVE 'N'       W#WARN  1                       133796
     C                     Z-ADDW#CNT     W#CNTS  20                      133796
     C                     MOVE 'N'       CHGIND                          133796
      *
      **  Validate key (when F09 has been pressed)
     C           *IN09     IFEQ *ON
     C           *IN83     ANDEQ*OFF
     C                     MOVELS2CSSN    S1CUST
     C                     MOVE *BLANKS   S1FCNO
     C                     EXSR VLDKEY
     C                     ENDIF
      *
     C           *IN20     IFEQ *OFF
     C           *IN21     ANDEQ*OFF
      *
      **  Validate branch code
     C           S1ACTN    IFEQ 'I'
     C                     EXSR VLDBRC
     C                     ELSE                                                               257423
     C           P#MODE    IFEQ 'B'                                                           257423
     C                     MOVE BRCA      S2BRCA                                              257423
     C                     ENDIF                                                              257423
     C                     ENDIF
      *
      **  Validate Currency
     C***********S1ACTN    IFEQ 'I'                                       120136
     C           S1ACTN    IFNE 'I'                                                           257423
     C           P#MODE    ANDEQ'B'                                                           257423
     C                     MOVE FCCY      S2FCCY                                              257423
     C                     ENDIF                                                              257423
     C                     EXSR VLDCCY
     C***********          ENDIF                                          120136
      *                                                                   121758
      * Retrieve default interest calculation basis for currency          121758
      * entered.                                                          121758
      *                                                                   121758
     C           P#MODE    IFEQ 'I'                                       121758
     C           S1ACTN    ANDEQ'I'                                       121758
     C           P#MODE    OREQ 'B'                                                           215775
     C           S1ACTN    ANDEQ'I'                                                           215775
     C                     MOVE A6DICB    S3DICB                          121758
     C                     ENDIF                                          121758
      *
      **  Validate Facility amount
     C********** S1ACTN    IFNE 'A'                                                    194540 194864
     C********** S1ACTN    ANDNE'X'                                                    194540 194864
     C                     EXSR VLDAMT
     C**********           ENDIF                                                       194540 194864
      *
      **  Validate Over-line %
     C                     EXSR VLDOVP
      *                                                                                       CLE034
      ** Validate Over-line Amount                                                            CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     EXSR SRVOVA                                                        CLE034
     C                     ENDIF                                                              CLE034
      *
      **  If facility or over -line has changed, and facility amount &
      **  over-line were not in error, then calculate availability
     C           W#FCHG    IFEQ 'Y'
     C           S1ACTN    ANDEQ'A'
     C           *IN29     ANDNE*OFF
     C           *IN30     ANDNE*OFF
     C                     EXSR CLCAVA
     C                     ENDIF
      *
      **  Validate Facility/Commitment indicator
     C                     EXSR VLDFCI
      *
      **  Validate date approved
     C***********S1ACTN    IFEQ 'I'                                       155101
     C           S1ACTN    IFNE 'I'                                                           257423
     C           P#MODE    ANDEQ'B'                                                           257423
     C                     MOVE DTAP      ZDAYNO                                              257423
     C                     EXSR ZDATE2                                                        257423
     C                     MOVE ZDATE     S2DTAP                                              257423
     C                     ENDIF                                                              257423
     C                     EXSR VLDAPR
     C***********          ELSE                                           155101
     C***********          MOVE DTAP      W#DTAP                          155101
     C***********          ENDIF                                          155101
      *
      **  Validate expiry date
     C                     EXSR VLDEXP
      *
      **  Validate revolving indicator
     C           S1ACTN    IFNE 'I'                                                           257423
     C           P#MODE    ANDEQ'B'                                                           257423
     C                     MOVE RVCR      S2RVCR                                              257423
     C                     ENDIF                                                              257423
     C                     EXSR VLDRVI
      *
      **  Validate secured indicator
     C                     EXSR VLDSCI
      *
      **  Validation of Tranche/Credit Agreement Indicator, Credit        155461
      **  Agreement Customer, Credit Agreement Type/No. moved to          155461
      **  first screen before validation of multi-ccy indicator           155461
      *                                                                   155461
     C           CLE005    IFEQ 'Y'                                       155461
     C                     EXSR VLDCRA                                    155461
     C                     ENDIF                                          155461
      *                                                                   155461
      **  Validate multi currency indicator
     C                     EXSR VLDMCY
      *
      **  Validate multi customer indicator
     C                     EXSR VLDMCU
      *
      **  Validate country of risk
     C                     EXSR VLDCRS
      *
      **  Validate alternative name & address code
     C                     EXSR VLDALT
      *
      **  Validate date of last financial statement
     C                     EXSR VLDLFS
      *
      **  Validate nominal rate
     C                     EXSR VLDNMR
      *
      **  Validate multi branch indicator
     C                     EXSR VLDMUB
      *
      **  Validate review date
     C                     EXSR VLDRVD
      *
      **  Validate review frequency
     C                     EXSR VLDRVF
      *
      **  Validate review day no.
     C                     EXSR VLDRVN
      *
      **  Validate account officer
     C                     EXSR VLDACO
      *
      **  Validate profit centre
     C                     EXSR VLDPRC
      *
      **  Validate originating branch
     C                     EXSR VLDOBR
      ***********                                                  128952 155461
      ****Validation of Tranche/Credit Agreement Indicator, Credit 128952 155461
      ****Agreement Customer, Credit Agreement Type/No. moved to   128952 155461
      ****first*screen                                             128952 155461
      ***********                                                  128952 155461
     C***********CLE005    IFEQ 'Y'                                128952 155461
     C***********          EXSR VLDCRA                             128952 155461
     C***********          ENDIF                                   128952 155461
      *
      **  Validate billing indicator
     C                     EXSR VLDBLI
      *
      **  Validate billing days
     C                     EXSR VLDBLD
      *
      **  Validate account sequence number
     C           CLE007    IFEQ 'Y'                                       129296
     C                     EXSR VLDASN
     C                     ENDIF                                          129296
      *                                                                   183724
      ** When F11 pressed from first screen also validate second screen   183724
      *                                                                   183724
     C           S1ACTN    IFEQ 'X'                                       183724
     C           *INKK     ANDEQ'1'                                       183724
     C           W#F5MD    ANDEQ'SC1'                                     183724
     C           W#ERR1    ANDNE'Y'                                                           194864
     C           W#WARN    ANDNE'Y'                                                           194864
     C                     EXSR POPSC2                                    183724
     C                     EXSR VLDSC2                                    183724
     C           W#ERR2    IFEQ 'Y'                                       183724
     C                     EXSR DSPSC2                                    183724
     C                     MOVEA'00000000'*IN,52                          183724
     C                     MOVEA'00000000'*IN,60                          183724
     C                     MOVE '0'       *IN68                           183724
     C                     MOVE '0'       *IN87                           183724
     C                     MOVE '00'      *IN,70                          183724
     C                     END                                            183724
     C                     END                                            183724
      *
     C           S1ACTN    IFEQ 'X'                                       123857
     C           *IN88     ANDEQ*OFF                                      123857
     C           *INKK     ANDEQ*ON                                       123857
     C           W#WARN    IFNE 'Y'                                       143819
     C           W#WARN    OREQ 'Y'                                       143819
     C           W#CNT     ANDGTW#CNTS                                    143819
     C           W#CNTS    ANDNE*ZEROS                                    143819
     C           CHGIND    ANDEQ'N'                                       143819
     C                     EXSR CLEARM                                    143819
     C                     EXSR UPDFLE                                    123857
     C                     ENDIF                                          143819
     C                     ENDIF                                          123857
      *                                                                   123857
     C           P#MODE    IFEQ 'I'
     C           P#MODE    OREQ 'R'
     C           P#MODE    OREQ 'F'                                       CAP065
     C***********S1ACTN    IFNE 'X'                                123857 167979
      *                                                                   167979
     C***********W#ERR1    IFEQ 'N'                                       167979
     C************IN17     ANDEQ*OFF                                      167979
      *                                                                   167979
     C*COPY QWINDSRC,LE2020MOV2                                           167979
     C***********          EXSR SRWNDW                                    167979
      *                                                            122631 167979
     C***********#RTRN     IFEQ *BLANKS                            122631 167979
     C***********          EXSR UPDFLE                             122631 167979
     C*COPY WNCPYSRC,LE2020C011                                           167979
     C***********          ENDIF                                   122631 167979
      *                                                            122631 167979
     C***********          ENDIF                                          167969
     C************         ENDIF                                   123857 167979
      *
     C           W#ERR1    IFEQ 'N'
     C           *INKV     ANDEQ*OFF
     C           *INKW     ANDEQ*OFF
     C           *INKX     ANDEQ*OFF
     C************IN17     ANDEQ*ON                                       167979
     C           *INKK     ANDEQ*OFF                                      123857
     C********** W#ERR2    ANDNE'Y'                                                    183724 191571
     C           W#WARN    IFNE 'Y'                                       CLE005
     C           W#WARN    OREQ 'Y'                                       CLE005
     C***********W#CNT     ANDGT1                                   CLE005133796
     C           W#CNT     ANDGTW#CNTS                                    133796
     C           W#CNTS    ANDNE*ZEROS                                    133796
     C           CHGIND    ANDEQ'N'                                       133796
     C********** W#ERR2    ANDNE'Y'                                                    183724 191571
     C                     EXSR DSPSC2
     C                     ENDIF                                          CLE005
     C                     ENDIF
      *
      **Screen*2*needs*to*be*displayed*even*when*CLE006*is*off,*so*167979 168913
      **additional*windows*should*be*displayed*after*screen 2.*****167979 168913
     C***********S1ACTN    IFNE 'X'                                167979 168913
      ***********                                                  167979 168913
     C***********W#ERR1    IFEQ 'N'                                167979 168913
      ***********                                                  167979 168913
     C*/COPY QWINDSRC,LE2020MOV2                                   167979 168913
     C***********          EXSR SRWNDW                             167979 168913
      ************                                                 167979 168913
     C***********#RTRN     IFEQ *BLANKS                            167979 168913
     C***********          EXSR UPDFLE                             167979 168913
     C*/COPY WNCPYSRC,LE2020C011                                   167979 168913
     C***********          ENDIF                                   167979 168913
      ***********                                                  167979 168913
     C***********          ENDIF                                   167979 168913
     C***********          ENDIF                                   167979 168913
      ***********                                                  167979 168913
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDBRC :   Validate Branch code
      ***********************************************************
     C           VLDBRC    BEGSR
      *
     C                     MOVE *OFF      *IN27
      *
     C           MBIN      IFEQ 'Y'
     C           S1ACTN    ANDEQ'I'
      *
      ** If branch not entered, use user's default branch from ZMUSER
     C           S2BRCA    IFEQ *BLANKS
     C           P#MODE    ANDNE'B'
     C                     MOVE USRBCH    S2BRCA
     C                     ENDIF
      *
      **  Branch code must be defined in standing data
     C***********          CALL 'AOBRCHR0'                                121783
     C                     CALL 'AOBRCHR1'                                121783
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM S2BRCA    @BRCA   3
     C           SDBRCH    PARM SDBRCH    DSSDY
     C           @RTCD     IFNE *BLANKS
     C           P#MODE    IFEQ 'F'                                       CAP068
     C                     MOVEL'LEF0359' ZAMSID                          CAP068
     C                     MOVEL'Y'       W#ERR1                          CAP068
     C                     EXSR ZASNMS                                    CAP068
     C                     ELSE                                           CAP068
     C                     MOVEL'LEF0017' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN27
     C                     ENDIF                                          CAP068
     C                     ELSE
     C                     MOVELA8BRCD    S2BRCA
      *
      ** User must have authority of insertion for branch entered.
      *
     C           P#MODE    IFEQ 'B'
     C                     CALL 'ZBACTBU'
     C                     PARM S1ACTN    @ZACTN  1
     C                     PARM S2BRCA    @ZBR    3
     C                     PARM           @USER  10
     C**********           PARM           @ZMGRP  40                                          CSF002
     C**********           PARM           @ZICDE  4                                           CSF002
     C                     PARM           UNQCDE 10                                           CSF002
     C                     PARM           @ERR    10
     C                     ELSE
     C                     CALL 'ZVACTBU'
     C                     PARM S1ACTN    @ZACTN  1
     C                     PARM S2BRCA    @ZBR    3
     C                     PARM           @ERR    10
     C                     ENDIF
      *
     C           @ERR      IFNE *ZERO
     C           @ERR      IFEQ 1
     C                     MOVEL'LEF0010' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN27
     C                     ENDIF
     C           @ERR      IFEQ 2
     C                     MOVEL'LEF0009' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN27
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDFCI :   Validate facility/commiment indicator
      ***********************************************************
     C           VLDFCI    BEGSR
      *
     C                     MOVE *OFF      *IN31
      *
      **  Must be 'C','F' OR 'G'
     C           S2FCTI    IFNE 'C'
     C           S2FCTI    ANDNE'F'
     C           S2FCTI    ANDNE'G'
     C                     MOVEL'LEF0021' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN31
      *
     C                     ELSE
      *
      ** Amend of facility/commitment indicator is allowed
      ** from G to F and F to C but not vice versa
      **  Remove this restriction - no good reason for it                 158167
     C***        S1ACTN    IFEQ 'A'                                       158167
     C***        S2FCTI    ANDNEFCTI                                      158167
      *
     C***        S2FCTI    IFEQ 'G'                                       158167
     C***                  MOVEL'LEF0022' ZAMSID                          158167
     C***                  MOVEL'Y'       W#ERR1                   120136 158167
     C***                  EXSR ZASNMS                                    158167
     C***********          MOVEL'Y'       W#ERR1                          120136
     C***                  MOVE *ON       *IN31                           158167
     C***                  ENDIF                                          158167
      *
     C***        S2FCTI    IFEQ 'F'                                       158167
     C***        FCTI      ANDNE'G'                                       158167
     C***                  MOVEL'LEF0022' ZAMSID                          158167
     C***                  MOVEL'Y'       W#ERR1                   120136 158167
     C***                  EXSR ZASNMS                                    158167
     C***********          MOVEL'Y'       W#ERR1                          120136
     C***                  MOVE *ON       *IN31                           158167
     C***                  ENDIF                                          158167
      *
     C***        S2FCTI    IFEQ 'C'                                       158167
     C***        FCTI      ANDNE'G'                                       158167
     C***        FCTI      ANDNE'F'                                       158167
     C***                  MOVEL'LEF0022' ZAMSID                          158167
     C***                  MOVEL'Y'       W#ERR1                   120136 158167
     C***                  EXSR ZASNMS                                    158167
     C***********          MOVEL'Y'       W#ERR1                          120136
     C***                  MOVE *ON       *IN31                           158167
     C***                  ENDIF                                          158167
      *
     C***                  ENDIF                                          158167
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDCCY :   Validate Currency
      ***********************************************************
     C           VLDCCY    BEGSR
      *
     C                     MOVE *OFF      *IN28
      *
      **   Must be a valid code on SDCURRPD
     C                     MOVE S2FCCY    CKEY
      *
     C                     MOVE '*BLANKS' @RTCD
     C                     CALL 'AOCURRR0'PLIST2
     C           @RTCD     IFNE *BLANKS
     C           P#MODE    IFEQ 'F'                                       CAP068
     C                     MOVEL'LEF0360' ZAMSID                          CAP068
     C                     MOVEL'Y'       W#ERR1                          CAP068
     C                     ELSE                                           CAP068
     C                     MOVEL'LEF0018' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN28
     C                     ENDIF                                          CAP068
     C                     ELSE
     C                     MOVE A6CYCD    S2FCCY
     C                     Z-ADDA6NBDP    W#NBDP
      *
     C           A6DLCI    IFEQ 'N'
     C                     MOVEL'LEF0057' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN28
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDAMT :   Validate facility amount
      ***********************************************************
     C           VLDAMT    BEGSR
      *
     C                     MOVE *OFF      *IN29
      *
     C**********           MOVE 'N'       W#FCHG                                              194864
     C                     MOVE 'N'       W#FCHG  1                                           194864
      *
      **  Must be valid per ZALIGN
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE S2FAMT    ZFIELD
     C***********          Z-ADDA6NBDP    ZADEC                           120717
     C***********13        SUB  A6NBDP    ZADIG                           120717
     C                     Z-ADDW#NBDP    ZADEC                           120717
     C           13        SUB  W#NBDP    ZADIG                           120717
     C                     EXSR ZALIGN
     C           *IN99     IFEQ *ON
     C                     MOVEL'LEF0019' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN29
     C                     ELSE
     C           *LIKE     DEFN FAMT      W#FAMT
     C                     MOVE ZFIELD    W#FAMT
     C           W#FAMT    IFLE 0
      *                                                                   143798
      ** To allow validation of amount only during Insert                 143798
      *                                                                   143798
     C           S1ACTN    ANDEQ'I'                                       143798
     C                     MOVEL'LEF0019' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN29
      *                                                                                       194864
      ** Facility amount is not amendable                                                     194864
      *                                                                                       194864
     C**********           ELSE                                                               194864
      ***determine*wheather*facility*has*changed***********************                       194864
     C********** S1ACTN    IFEQ 'A'                                                           194864
     C********** FAMT      IFNE W#FAMT                                                        194864
     C**********           MOVE 'Y'       W#FCHG  1                                           194864
     C**********           ENDIF                                                              194864
     C**********           ENDIF                                                              194864
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDOVP :   Validate overline percentage
      ***********************************************************
     C           VLDOVP    BEGSR
      *
     C                     MOVE *OFF      *IN30
     C                     MOVE *ZEROS    WOVPC  160                                          CLE034
      *
      **  Must be valid per ZALIGN
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE S2OVPC    ZFIELD
     C                     Z-ADD3         ZADEC
     C                     Z-ADD2         ZADIG
     C                     EXSR ZALIGN
     C           *IN99     IFEQ *ON
     C                     MOVEL'LEF0020' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN30
     C                     ELSE
     C                     MOVE ZFIELD    WOVPC                                               CLE034
     C           S1ACTN    IFEQ 'A'
     C           W#FCHG    ANDNE'Y'
     C           *LIKE     DEFN OVPC      W#OVPC
     C           OVPC      IFNE W#OVPC
     C                     MOVE 'Y'       W#FCHG
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************                       CLE034
      *                                                               *                       CLE034
      *  SRVOVA - Validate Over-line Amount                           *                       CLE034
      *                                                               *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SRVOVA    BEGSR                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE '0'       WVOVAM  1                                           CLE034
      *                                                                                       CLE034
      ** Over-line amount is prohibited if Over-line % is not zero                            CLE034
      *                                                                                       CLE034
     C           S2OVAM    IFNE *BLANKS                                                       CLE034
     C           WOVPC     ANDNE0                                                             CLE034
     C           *IN30     ANDEQ*OFF                                                          CLE034
     C                     MOVE '1'       WVOVAM                                              CLE034
     C                     MOVEL'LEF0367' ZAMSID                                              CLE034
     C                     MOVE 'Y'       W#ERR1                                              CLE034
     C                     EXSR ZASNMS                                                        CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
      ** Must be a valid amount in facility currency                                          CLE034
      *                                                                                       CLE034
     C                     MOVE *BLANKS   ZFIELD                                              CLE034
     C                     MOVE S2OVAM    ZFIELD                                              CLE034
     C                     Z-ADDW#NBDP    ZADEC                                               CLE034
     C           13        SUB  W#NBDP    ZADIG                                               CLE034
     C                     EXSR ZALIGN                                                        CLE034
      *                                                                                       CLE034
     C           *IN99     IFEQ *ON                                                           CLE034
     C                     MOVE '1'       WVOVAM                                              CLE034
     C                     MOVEL'LEF0368' ZAMSID                                              CLE034
     C                     MOVE 'Y'       W#ERR1                                              CLE034
     C                     EXSR ZASNMS                                                        CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *                                                                                       CLE034
      *****************************************************************                       CLE034
      /EJECT                                                                                  CLE034
      ***********************************************************
      *  CLCAVA :   Calcualte availability
      ***********************************************************
     C           CLCAVA    BEGSR
      *
      **  Check that availability under new facility amount +
      **  Cover-line % is not < 0
      *
      **  Calcualte new facility amount + over-line %
     C           W#FAMT    MULT W#OVPC    W#W153 153
     C           W#W153    DIV  100       W#W013 130H
     C           W#FAMT    ADD  W#W013    W#TOTF 130
      *
      **  Check each element of drawn amount array.
      *
     C                     Z-ADD1         A       20
      *
     C           A         DOWLE10
      *
      *
     C           DTEX      IFLE RUN,A
     C                     LEAVE
     C                     ENDIF
      *
     C           W#TOTF    IFLT OAM,A
     C                     MOVEL'LEF0058' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN29
     C                     LEAVE
     C                     ENDIF
      *
     C                     ADD  1         A
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDAPR :   Validate date approved (start date)
      ***********************************************************
     C           VLDAPR    BEGSR
      *
     C                     MOVE *OFF      *IN32
      *
      **  Must be valid date format
     C                     MOVE S2DTAP    ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ *ON
     C           S2DTAP    OREQ *BLANKS
     C                     MOVEL'LEF0023' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN32
     C                     ELSE
      *                                                                   133796
      ** Check if Date Approved is a Holiday                              133796
      *                                                                   133796
     C           S2DTAP    IFNE DAYSV2                                    133796
     C                     MOVELS2FCCY    ZCCY                            133796
     C                     EXSR ZCHKH                                     133796
      *                                                                   133796
     C           ZIND      IFEQ 'H'                                       133796
     C                     MOVEL'LEF0223' ZAMSID                          133796
     C                     MOVEL'Y'       W#WARN                          133796
     C                     EXSR ZASNMS                                    133796
     C                     ADD  1         W#CNT                           133796
     C                     MOVE 'Y'       CHGIND  1                       133796
     C                     MOVE *ON       *IN32                           133796
     C                     ENDIF                                          133796
     C                     ENDIF                                          133796
      *                                                                   133796
     C                     MOVE S2DTAP    DAYSV2  6                       133796
      *                                                                   133796
     C                     Z-ADDZDAYNO    W#DTAP  50
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDEXP :   Validate date expires
      ***********************************************************
     C           VLDEXP    BEGSR
      *
     C                     MOVE *OFF      *IN36
      *
      **  Must be valid date format
     C                     MOVE S2DTEX    ZDATE
     C                     EXSR ZDATE1
      *
     C           *IN99     IFEQ *ON
     C           S2DTEX    OREQ *BLANKS
     C                     MOVEL'LEF0056' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN36
      *
     C                     ELSE
      *
      **  Earlier than run date
      **   Field protected for expired facilities - do not validate       158151
     C           ZDAYNO    IFLT RUND
     C***********S1ACTN    ANDNE'A'                                 CLE005126625
     C***********RECI      ANDNE'E'                                       126625
     C           S1ACTN    ANDNE'A'                                       158151
     C           S1ACTN    ANDNE'X'                                       158151
     C           RECI      ANDNE'E'                                       158151
     C                     MOVEL'LEF0024' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN36
     C                     ENDIF
      *                                                                   188373
     C           ZDAYNO    IFLT RUND                                      188373
     C           S1ACTN    ANDEQ'A'                                       188373
     C           RECI      ANDNE'E'                                       188373
     C                     MOVEL'LEF0024' ZAMSID                          188373
     C                     MOVEL'Y'       W#ERR1                          188373
     C                     EXSR ZASNMS                                    188373
     C                     MOVE '1'       *IN36                           188373
     C                     ENDIF                                          188373
      *                                                                   188373
     C           ZDAYNO    IFLE W#DTAP
     C                     MOVEL'LEF0025' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN36
     C                     ENDIF
      *                                                                   133796
      ** Check if Expiry Date is a Holiday                                133796
      *                                                                   133796
     C           *IN36     IFEQ *OFF                                      133796
     C           S2DTEX    ANDNEDAYSV                                     133796
     C                     MOVELS2FCCY    ZCCY                            133796
     C                     EXSR ZCHKH                                     133796
      *                                                                   133796
     C           ZIND      IFEQ 'H'                                       133796
     C                     MOVEL'LEF0212' ZAMSID                          133796
     C                     MOVEL'Y'       W#WARN                          133796
     C                     EXSR ZASNMS                                    133796
     C                     ADD  1         W#CNT                           133796
     C                     MOVE 'Y'       CHGIND                          133796
     C           P#MODE    IFNE 'B'                                       165099
     C           P#MODE    ANDNE'P'                                       165099
     C                     MOVE *ON       *IN36                           133796
     C                     ENDIF                                          165099
     C                     ENDIF                                          133796
     C                     ENDIF                                          133796
      *                                                                   133796
     C                     MOVE S2DTEX    DAYSV   6                       133796
      *
      **  Check to see if there are any outstanding loans
     C           *IN36     IFEQ *OFF
     C           S1ACTN    IFNE 'I'
     C                     EXSR CHKOTS
      *
     C           W#ERR4    IFEQ 'Y'
     C                     MOVEL'LEF0059' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN36
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      **  If valid
     C           *IN36     IFEQ *OFF
     C                     Z-ADDZDAYNO    W#DTEX  50
      **  Update of drawn amount array
     C           S1ACTN    IFEQ 'A'
      *
      ** Re-instate code to update drawn amount array for facility
      ** expiry date amendment.
     C                     Z-ADD1         A
     C           A         DOWLE10
     C           W#DTEX    IFLT RUN,A
     C                     Z-ADDW#FAMT    OAM,A
     C                     ELSE
     C           DTEX      IFLT RUN,A
     C                     Z-ADD0         OAM,A
     C                     ENDIF
     C                     ENDIF
     C                     ADD  1         A
     C                     ENDDO
      *
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                   CLE005
      **  Read through LEFCAML0 if Expiry Date is amended                 CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           CLE007    ANDEQ'Y'                                       CLE005
      *                                                                   CLE005
     C                     MOVE S2BRCA    K9BRCA                          CLE005
     C                     MOVE S2CNUM    K9CUST                          CLE005
     C                     MOVE S1FACT    K9FCTY                          CLE005
     C                     MOVE S1FCNO    K9FTNO                          CLE005
      *                                                                   CLE005
     C           S1ACTN    IFEQ 'A'                                       CLE005
     C           K#KY09    SETLLLEFCAML0                                  CLE005
     C           K#KY09    READELEFCAML0                 80               CLE005
     C***********          MOVE 'N'       W#WARN  1                 CLE005133796
      *                                                                   CLE005
     C           *IN80     DOWEQ'0'                                       CLE005
     C           W#WARN    ANDEQ'N'                                       CLE005
     C           VLDT      IFGT ZDAYNO                                    CLE005
     C                     MOVEL'LEF0261' ZAMSID                          CLE005
     C                     MOVE 'Y'       W#WARN                          148004
     C                     EXSR ZASNMS                                    CLE005
     C                     MOVE '1'       *IN36                           CLE005
     C***********          MOVE 'Y'       W#WARN                   CLE005 148004
     C                     ADD  1         W#CNT                           CLE005
     C                     ENDIF                                          CLE005
     C           K#KY09    READELEFCAML0                 80               CLE005
     C                     ENDDO                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *
     C                     ENDIF
      *
      ** If expiry date has changed and there are any fees related to     144713
      ***this*facility,*issue*a*warning*message.****************   144713 154991
      ** this facility with an End date greater than the Expiry date      154991
      ** issue an error message                                           154991
      *                                                                   144713
     C           ZDAYNO    IFNE DTEX                                      144713
     C           S1ACTN    ANDNE'I'                                       187855
      *                                                                   144713
     C***********W#WRN2    IFNE 'Y'                                144713 148004
     C***********W#WRN2    OREQ 'Y'                                144713 148004
      *                                                                   154991
     C********** W#WARN    IFNE 'Y'                                148004 154991
     C********** W#WARN    OREQ 'Y'                                148004 154991
     C********** ZDAYNO    ANDNEDTEXER                             144713 154991
      *                                                                   154991
     C**********           Z-ADDCNUM      K7CNUM                                       144713 CSD027
     C                     MOVE CNUM      K7CNUM                                              CSD027
     C                     MOVELFACT      K7FCTY  50                      144713
     C                     MOVE FCNO      K7FCTY                          144713
      *                                                                   144713
     C           K#KY07    SETLLLEFEEDL1                                  144713
     C           K#KY07    READELEFEEDL1                 80               144713
      *                                                                   144713
     C           *IN80     DOWEQ*OFF                                      144713
      *                                                                   144713
      ****If*outstanding*fees*are*found*(FERECI = 'D')*issue*warnin144713 154991
      **  Check if outstanding fees are found (FERECI = 'D')              154991
      *                                                                   144713
     C           FERECI    IFEQ 'D'                                       144713
     C**********           MOVEL'LEF0295' ZAMSID                   144713 154991
     C***********          MOVE 'Y'       W#ERR1                   144713 148004
     C**********           MOVE 'Y'       W#WARN                   148004 154991
     C           ZDAYNO    IFLT FEPEND                                    154991
     C                     MOVEL'LEF0237' ZAMSID                          154991
     C                     MOVEL'Y'       W#ERR1                          154991
     C                     EXSR ZASNMS                                    144713
     C**********           ADD  1         W#CNT                    148004 154991
     C                     MOVE '1'       *IN36                           144713
     C***********          MOVE 'Y'       W#WRN2  1                144713 148004
     C**********           Z-ADDZDAYNO    DTEXER  50               144713 154991
     C                     LEAVE                                          144713
     C                     ENDIF                                          144713
     C                     ENDIF                                          154991
      *                                                                   144713
     C           K#KY07    READELEFEEDL1                 80               144713
      *                                                                   144713
     C                     ENDDO                                          144713
      *                                                                   144713
     C**********           ENDIF                                   144713 154991
     C                     ENDIF                                          144713
      *                                                                   144713
     C                     ENDSR
      /EJECT                                                              128949
      ***********************************************************         128949
      *  CHKAUT :                                                         128949
      ***********************************************************         128949
     C           CHKAUT    BEGSR                                          128949
      *                                                                   128949
     C           TRCA      IFEQ 'TR'                                      128949
      *                                                                   128949
     C                     MOVE CANM      K2CNUM                          128949
     C                     MOVE CAFT      K2FACT                          128949
     C                     MOVE CAFN      K2FCNO                          128949
      *                                                                   128949
     C           K#KY02    CHAINLEFCLTL1             80                   128949
     C           *IN80     IFEQ '0'                                       128949
     C                     MOVE 'LEF0294' ZAMSID                          128949
     C                     MOVEL'Y'       W#ERR1                          128949
     C                     EXSR ZASNMS                                    128949
     C                     MOVE '1'       *IN23                           128949
     C                     ENDIF                                          128949
      *                                                                   128949
     C                     ENDIF                                          128949
      *                                                                   128949
     C                     SELEC                                          128949
     C           W#FILE    WHEQ 'FCLTY'                                   128949
     C           K#KY03    CHAINFCLTY               N80                   128949
     C           W#FILE    WHEQ 'LEFCLTL7'                                128949
     C           K#KY01    CHAINLEFCLTL7             80                   128949
     C                     ENDSL                                          128949
      *                                                                   128949
     C                     MOVE *BLANKS   W#FILE 10                       128949
      *                                                                   128949
     C                     ENDSR                                          128949
      *                                                                   128949
      /EJECT
      ***********************************************************
      *  CHKOTS :
      ***********************************************************
     C           CHKOTS    BEGSR
      *
     C                     MOVE 'N'       W#ERR4  1
      *
      **  Check to see if new expiry date is less than any of the
      **  customer outstanding loan expiry dates.
     C**********           Z-ADDCNUM      K8CNUM                                              CSD027
     C                     MOVE CNUM      K8CNUM                                              CSD027
     C                     Z-ADDFACT      K8FACT
     C                     Z-ADDFCNO      K8FCNO
      *                                                                                       202456
     C           PRTR      IFEQ 'A'                                                           202456
     C           PRTR      OREQ ' '                                                           202456
      *
     C           K#KY08    SETLLLEREF
     C           K#KY08    READELEREF                    80
      *
     C           *IN80     DOWEQ*OFF
      *
     C           RFRECI    IFEQ 'D'
     C**********           Z-ADDLNNO      K5LNRF                                              CLE148
     C                     MOVELLNNO      K5LNRF                                              CLE148
     C                     MOVE 'A'       K5RCTP
     C           K#KY05    CHAINCLOAN                80
      *
     C           ZDAYNO    IFLT MDAT
     C                     MOVE 'Y'       W#ERR4
     C                     LEAVE
     C                     ENDIF
     C           S1ACTN    IFEQ 'R'                                       158179
     C           S1ACTN    OREQ 'C'                                       158179
     C           MDAT      IFEQ 0                                         158179
     C           CLRECI    OREQ 'D'                                       143795
     C           CLRECI    OREQ 'M'                                       171743
     C           CLE005    ANDEQ'Y'                                       143795
     C                     MOVE 'Y'       W#ERR4                          158179
     C                     LEAVE                                          158179
     C                     ENDIF                                          158179
      *
      *                                                                   158179
     C                     ENDIF                                          158179
      *                                                                   158179
      *
     C                     ENDIF
      *
     C           K#KY08    READELEREF                    80
      *
     C                     ENDDO
      *                                                                                       202456
     C                     ELSE                                                               202456
      *                                                                                       202456
     C           K#KY08    CHAINCLOANCF6             80                                       202456
     C           *IN80     IFEQ *OFF                                                          202456
     C                     MOVE 'Y'       W#ERR4                                              202456
     C                     ENDIF                                                              202456
      *                                                                                       202456
     C                     ENDIF                                                              202456
      *
     C                     ENDSR
      /EJECT                                                              127641
      ***********************************************************         127641
      *  CHKCRE : Check if facility has any outstanding transactions      127641              214894
      ***********************************************************         127641
     C           CHKCRE    BEGSR                                          127641
      *                                                                   127641
     C                     MOVE 'N'       W#ERR5  1                       127641
      *                                                                                       214894
      ** If not a Credit Agreement, check for drawings against facility                       214894
      *                                                                                       214894
     C           TRCA      IFNE 'CA'                                                          214894
      *                                                                   127641
      **  Check to see if new expiry date is less than any of the         127641
      **  customer outstanding loan expiry dates.                         127641
      *                                                                   127641
     C***********          Z-ADDCANM      K8CNUM                    127641133992
     C***********          Z-ADDCAFT      K8FACT                    127641133992
     C***********          Z-ADDCAFN      K8FCNO                    127641133992
     C**********           Z-ADDCNUM      K8CNUM                                       133992 CSD027
     C                     MOVE CNUM      K8CNUM                                              CSD027
     C                     Z-ADDFACT      K8FACT                          133992
     C                     Z-ADDFCNO      K8FCNO                          133992
      *                                                                   127641
     C           K#KY08    SETLLLEREF                                     127641
     C           K#KY08    READELEREF                    80               127641
      *                                                                   127641
     C           *IN80     DOWEQ'0'                                       127641
      *                                                                   127641
     C           RFRECI    IFEQ 'D'                                       127641
     C**********           Z-ADDLNNO      K5LNRF                                       127641 CLE148
     C                     MOVELLNNO      K5LNRF                                              CLE148
     C                     MOVE 'A'       K5RCTP                          127641
     C           K#KY05    CHAINCLOAN                80                   127641
      *                                                                   127641
     C           ZDAYNO    IFLT MDAT                                      127641
     C                     MOVE 'Y'       W#ERR5                          127641
     C                     LEAVE                                          127641
     C                     ENDIF                                          127641
      *                                                                   127641
     C                     ENDIF                                          127641
      *                                                                   127641
     C           K#KY08    READELEREF                    80               127641
      *                                                                   127641
     C                     ENDDO                                          127641
      *                                                                   127641
     C           W#ERR5    IFEQ 'Y'                                       127641
     C                     MOVEL'LEF0289 'ZAMSID                          127641
     C                     MOVE 'Y'       W#ERR1                          127641
     C                     EXSR ZASNMS                                    127641
     C                     MOVE '1'       *IN23                           127641
     C                     ENDIF                                          127641
      *                                                                   127641
      ****Check*if*Manual*Fac.*is*attached*to*credit*agreement's*tranche**             127641 214894
      ** Check if a Manual Facility Utilisation is attached to facility                       214894
      *                                                                   127641
     C           K#KY08    CHAINLEMNFUL6             80                   127641
     C           *IN80     IFEQ '0'                                       127641
     C                     MOVEL'LEF0290 'ZAMSID                          127641
     C                     MOVE 'Y'       W#ERR1                          127641
     C                     EXSR ZASNMS                                    127641
     C                     MOVE '1'       *IN23                           127641
     C                     ENDIF                                          127641
      *                                                                   127641
     C                     ENDIF                           END TRCA NE CA                     214894
      *                                                                                       214894
      ****Check*if*Facility*Amend.*is*attached*to*CA's*tranche***********              127641 214894
      ** Check if a Facility Amendment is attached to this facility                           214894
      *                                                                   127641
     C********** K#KY08    CHAINLEFCAML6             80                                127641 214894
     C           K#KY08    CHAINLEFCAML6            N80                                       214894
     C           *IN80     IFEQ '0'                                       127641
     C                     MOVEL'LEF0291 'ZAMSID                          127641
     C                     MOVE 'Y'       W#ERR1                          127641
     C                     EXSR ZASNMS                                    127641
     C                     MOVE '1'       *IN23                           127641
     C                     ENDIF                                          127641
      *                                                                   127641
     C                     ENDSR                                          127641
      *                                                                   127641
      /EJECT                                                              128950
      ***********************************************************         128950
      *  CHKTRA :                                                         128950
      ***********************************************************         128950
     C           CHKTRA    BEGSR                                          128950
      *                                                                   128950
     C           TRCA      IFEQ 'CA'                                      128950
      *                                                                   128950
     C                     MOVE CNUM      K0CANM                          128950
     C                     MOVE FACT      K0CAFT                          128950
     C                     MOVE FCNO      K0CAFN                          128950
      *                                                                   128950
      ** Ensure record is not locked by chain.                                                214894
      *                                                                                       214894
     C********** K#KY10    CHAINLEFCLTL9             80                                128950 214894
     C           K#KY10    CHAINLEFCLTL9            N80                                       214894
      *                                                                   128950
     C           *IN80     IFEQ '0'                                       128950
      *                                                                   153868
      ***AND*record*found*is*live***                                                   153868 214894
     C********** LERECI    ANDEQ'D'                                                    153868 214894
     C                     MOVE 'LEF0293' ZAMSID                          128950
     C                     MOVEL'Y'       W#ERR1                          128950
     C                     EXSR ZASNMS                                    128950
     C                     MOVE '1'       *IN23                           128950
     C                     ENDIF                                          128950
      *                                                                   128950
     C                     ENDIF                                          128950
      *                                                                   128950
     C                     ENDSR                                          128950
      *                                                                   128950
      /EJECT
      ***********************************************************
      *  CHKFEE :
      ***********************************************************
     C           CHKFEE    BEGSR
      *
     C**********           Z-ADDCNUM      K7CNUM                                              CSD027
     C                     MOVE CNUM      K7CNUM                                              CSD027
     C                     MOVELFACT      K7FCTY  50
     C                     MOVE FCNO      K7FCTY
      *
     C           K#KY07    SETLLLEFEEDL1
     C           K#KY07    READELEFEEDL1                 80
      *
     C           *IN80     DOWEQ*OFF
      *
      **  If outstanding fees are found (FERECI = 'D') the facility
      **  cannot be reversed.
      *
     C           FERECI    IFEQ 'D'
     C                     MOVEL'LEF0087' ZAMSID
     C                     MOVE 'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C                     MOVE *ON       *IN23
     C***********          MOVE 'Y'       W#ERR1                          120136
     C                     LEAVE
     C                     ENDIF
      *
     C           K#KY07    READELEFEEDL1                 80
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDRVI :   Validate revolving indicator
      ***********************************************************
     C           VLDRVI    BEGSR
      *
     C                     MOVE *OFF      *IN33
      *
      ** Value must be 'Y','N' or ' '
      ** or 'T' for a 'Credit Agreement' facility.                        CLE014
      *
     C           S2RVCR    IFEQ *BLANKS
     C                     MOVE 'N'       S2RVCR
     C                     ELSE
      *                                                                   CLE014
     C                     SELEC                                          CLE014
      *                                                                   CLE014
     C           CLE014    WHEQ 'Y'                                       CLE014
     C           S3TRCA    ANDEQ'CA'                                      CLE014
     C           S2RVCR    IFNE 'Y'                                       CLE014
     C           S2RVCR    ANDNE'N'                                       CLE014
     C           S2RVCR    ANDNE'T'                                       CLE014
     C                     MOVEL'LEF0350' ZAMSID                          CLE014
     C                     MOVEL'Y'       W#ERR1                          CLE014
     C                     EXSR ZASNMS                                    CLE014
     C                     MOVE *ON       *IN33                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     OTHER                                          CLE014
      *                                                                   CLE014
     C           S2RVCR    IFNE 'Y'
     C           S2RVCR    ANDNE'N'
     C           S2RVCR    ANDNE' '
     C                     MOVEL'LEF0026' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN33
     C                     ENDIF
     C                     ENDSL                                          CLE014
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDSCI :   Validate secured indicator
      ***********************************************************
     C           VLDSCI    BEGSR
      *
     C                     MOVE *OFF      *IN35
      *
      ** Value must be 'Y','N' or ' '
     C           S2SECI    IFEQ *BLANKS
     C                     MOVE 'N'       S2SECI
     C                     ELSE
     C           S2SECI    IFNE 'Y'
     C           S2SECI    ANDNE'N'
     C           S2SECI    ANDNE' '
     C                     MOVEL'LEF0027' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN35
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDMCY :   Validate multi currency indicator
      ***********************************************************
     C           VLDMCY    BEGSR
      *
     C                     MOVE *OFF      *IN34
      *
      ** Value must be 'Y' or 'N' and cannot be amended from 'Y' to 'N'
     C                     SELEC
     C           S2MCCY    WHEQ *BLANKS
     C           S1ACTN    IFNE 'A'
     C                     MOVE 'N'       S2MCCY
     C                     ELSE
     C           MCCY      IFEQ 'Y'
     C           S2MCCY    ANDNE'Y'
     C                     MOVEL'LEF0029' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN34
     C                     ENDIF
     C                     ENDIF
     C           S2MCCY    WHEQ 'N'
     C           S1ACTN    ANDEQ'A'
     C           MCCY      ANDEQ'Y'
     C                     MOVEL'LEF0029' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN34
     C           S2MCCY    WHNE 'Y'
     C           S2MCCY    ANDNE'N'
     C                     MOVEL'LEF0028' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN34
      *                                                                   155461
     C           S2MCCY    WHEQ 'Y'                                       155461
     C           S3TRCA    IFEQ 'TR'                                      155461
     C           WTRCA     ANDEQ'CA'                                      155461
     C           WMCCY     ANDEQ'N'                                       155461
     C                     MOVEL'LEF0132' ZAMSID                          155461
     C                     MOVEL'Y'       W#ERR1                          155461
     C                     EXSR ZASNMS                                    155461
     C                     MOVE *ON       *IN34                           155461
     C                     ENDIF                                          155461
      *                                                                   155461
     C                     ENDSL
      *
     C           *IN34     IFEQ *OFF                                      155461
     C           S2MCCY    IFEQ 'Y'
     C                     MOVE *ON       *IN13
     C                     ELSE
     C                     MOVE *OFF      *IN13
     C                     ENDIF
     C                     ENDIF                                          155461
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDMCU :   Validate multi customer indicator
      ***********************************************************
     C           VLDMCU    BEGSR
      *
     C                     MOVE *OFF      *IN38
      *
      ** Value must be 'Y' or 'N' and cannot be amended from 'Y' to 'N'
     C                     SELEC
     C           S2MCSI    WHEQ *BLANKS
     C           S1ACTN    IFNE 'A'
     C                     MOVE 'N'       S2MCSI
     C                     ELSE
     C           MCSI      IFEQ 'Y'
     C           S2MCSI    ANDNE'Y'
     C                     MOVEL'LEF0031' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN38
     C                     ENDIF
     C                     ENDIF
     C           S2MCSI    WHEQ 'N'
     C           S1ACTN    ANDEQ'A'
     C           MCSI      ANDEQ'Y'
     C                     MOVEL'LEF0031' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN38
     C           S2MCSI    WHNE 'Y'
     C           S2MCSI    ANDNE'N'
     C                     MOVEL'LEF0030' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN38
      *                                                                   155461
     C           S2MCSI    WHEQ 'Y'                                       155461
     C           S3TRCA    IFEQ 'TR'                                      155461
     C           WTRCA     ANDEQ'CA'                                      155461
     C           WMCSI     ANDEQ'N'                                       155461
     C                     MOVEL'LEF0133' ZAMSID                          155461
     C                     MOVEL'Y'       W#ERR1                          155461
     C                     EXSR ZASNMS                                    155461
     C                     MOVE *ON       *IN38                           155461
     C                     ENDIF                                          155461
      *                                                                   155461
     C                     ENDSL
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDCRS :   Validate country of risk
      ***********************************************************
     C           VLDCRS    BEGSR
      *
     C                     MOVE *OFF      *IN37
      *
     C           S2CRSK    IFEQ *BLANKS
      *
      **  Default it to country of citizinship
      **  Access customer file for country of citizenship
     C                     CALL 'AOCUSTR0'
     C                     PARM '       ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM S1CUST    @CNUM  10
     C                     PARM           @CNST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD3         DBASE
     C                     MOVEL'SDCUSTPD'DBFILE
     C                     MOVELS1CUST    DBKEY
     C                     MOVEL'LE2020'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVE BBCNCZ    S2CRSK
     C                     ENDIF
      *
     C                     ELSE
      *
      **  Must be valid country code
     C                     MOVE S2CRSK    CTRYKY
     C                     CALL 'AOCTRYR0'PLIST5
     C           @RTCD     IFEQ *BLANKS
     C                     MOVE A4CNCD    S2CRSK
     C                     ELSE
     C                     MOVEL'LEF0081' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN37
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDALT :   Validate alternative name & address code
      ***********************************************************
     C           VLDALT    BEGSR
      *
     C                     MOVE *OFF      *IN39
      *
      **  Must be valid name & address record on SDALTNPD
     C           S2NACD    IFEQ *BLANKS
     C           S2NACD    OREQ 'B'
     C                     MOVE 'B'       S2NACD
      *
     C                     ELSE
      *
     C                     MOVELS2CNUM    CUST    6
     C                     MOVELS2NACD    ADCD    1
     C                     CALL 'AOALTNR0'
     C                     PARM '*BLANKS' @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM           CUST
     C                     PARM           ADCD
     C           SDALTN    PARM SDALTN    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'LEF0060' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN39
     C***********          ELSE                                           132678
     C***********          MOVE BCADCD    S2NACD                          132678
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDLFS :   Validate date of last financial statement
      ***********************************************************
     C           VLDLFS    BEGSR
      *
     C                     MOVE *OFF      *IN40
      *
     C           S2DLFS    IFNE *BLANKS
      *
      **  Must be valid date format & not greater than run date
     C                     MOVE S2DLFS    ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ *ON
     C                     MOVEL'LEF0033' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN40
     C                     ELSE
     C           ZDAYNO    IFGT RUND
     C                     MOVEL'LEF0034' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN40
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDNMR :   Validate nominal rate
      ***********************************************************
     C           VLDNMR    BEGSR
      *
     C                     MOVE *OFF      *IN41
      *
      **  Must be valid per ZALIGN
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE S2NOMR    ZFIELD
     C                     Z-ADD7         ZADEC
     C                     Z-ADD4         ZADIG
     C                     EXSR ZALIGN
     C           *IN99     IFEQ *ON
     C                     MOVEL'LEF0035' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN41
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDMUB :   Validate multi branch indicator
      ***********************************************************
     C           VLDMUB    BEGSR
      *
     C                     MOVE *OFF      *IN51
      *
      **  Must be 'Y' or 'N' if entered (DEFAULT 'N' IF BLANK)
      **  Cannot be amended from 'Y' to 'N'
      **  & only allowed in multi-branch system
      *
     C           MBIN      IFNE 'Y'
     C                     MOVE 'N'       S2MBFC
      *
     C                     ELSE
      *
      **  Validate indicator value
     C           S2MBFC    IFNE 'Y'
     C           S2MBFC    ANDNE'N'
     C           S2MBFC    ANDNE' '
     C                     MOVEL'LEF0061' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN51
     C                     ENDIF
      *
      **  IF INDICATOR IS 'N' OR ' ' PREVENT AMENDMENT OF FIELD ON FILE
      **  FROM 'Y' TO 'N' ELSE SET FILE FIELD
      *
     C           S2MBFC    IFEQ 'N'
     C           S2MBFC    OREQ ' '
     C           MBFC      IFEQ 'Y'
     C           S1ACTN    ANDEQ'A'
     C                     MOVEL'LEF0062' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN51
     C                     ELSE
     C                     MOVE 'N'       S2MBFC
     C                     ENDIF
     C                     ENDIF
      *                                                                   155461
     C           S2MBFC    IFEQ 'Y'                                       155461
     C           S3TRCA    IFEQ 'TR'                                      155461
     C           WTRCA     ANDEQ'CA'                                      155461
     C           WMBFC     ANDEQ'N'                                       155461
     C                     MOVEL'LEF0134' ZAMSID                          155461
     C                     MOVEL'Y'       W#ERR1                          155461
     C                     EXSR ZASNMS                                    155461
     C                     MOVE *ON       *IN51                           155461
     C                     ENDIF                                          155461
     C                     ENDIF                                          155461
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDRVD :   Validate review date
      ***********************************************************
     C           VLDRVD    BEGSR
      *
     C                     MOVE *OFF      *IN42
      *
     C           S2RVDT    IFNE *BLANKS
      *
      ****Must*be*valid*date*format, greater than run date & approved     158158
      ****date*&*less*than*expiry date                                    158158
      **  Must be valid date format, greater than approved date (N.B.     158158
      **  now called Start Date on screen), and, if Insert, greater       158158
      **   than run date and less than expiry date)                       158158
     C                     MOVE S2RVDT    ZDATE
     C                     EXSR ZDATE1
      *
     C                     SELEC
     C           *IN99     WHEQ *ON
     C                     MOVEL'LEF0036' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN42
     C           ZDAYNO    WHLE RUND
     C           S1ACTN    ANDEQ'I'                                       158158
     C                     MOVEL'LEF0037' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN42
     C           ZDAYNO    WHLE W#DTAP
     C                     MOVEL'LEF0038' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN42
     C           ZDAYNO    WHGE W#DTEX
     C           S1ACTN    ANDEQ'I'                                       158158
     C/COPY WNCPYSRC,LE2020C031
     C                     MOVEL'LEF0039' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN42
     C                     ENDSL
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDRVF :   Validate review frequency
      ***********************************************************
     C           VLDRVF    BEGSR
      *
     C                     MOVE *OFF      *IN43
      *
     C           S2RVFR    IFNE *BLANKS
      *
      **  Must be valid frequency
     C           S2RVDT    IFEQ *BLANKS
     C           S2RVFR    ANDNE*BLANKS
     C                     MOVEL'LEF0040' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN43
     C                     ELSE
     C           S2RVFR    IFNE 'M'
     C           S2RVFR    ANDNE'Q'
     C           S2RVFR    ANDNE'X'
     C           S2RVFR    ANDNE'Y'
     C                     MOVEL'LEF0041' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN43
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDRVN :   Validate review day No.
      ***********************************************************
     C           VLDRVN    BEGSR
      *
     C                     MOVE *OFF      *IN44
      *
     C           S2RVDY    IFNE *BLANKS
      *
      **  Entered only if REV.FRQ. entered, must be valid numeric 1->31
     C           S2RVFR    IFEQ *BLANKS
     C           S2RVDY    ANDNE*BLANKS
     C                     MOVEL'LEF0042' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN44
     C                     ELSE
     C                     TESTN          S2RVDY     19
     C           *IN19     IFEQ *OFF
     C                     MOVEL'LEF0043' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN44
     C                     ELSE
     C           *IN19     IFEQ *ON
     C                     MOVE S2RVDY    W#RVDY  20
     C           W#RVDY    IFGT 31
     C           W#RVDY    ORLT 01
     C                     MOVEL'LEF0043' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN44
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDACO :   Validate account officer
      ***********************************************************
     C           VLDACO    BEGSR
      *
     C                     MOVE *OFF      *IN45
     C                     MOVE 'N'       WBLACF  1                       161257
      *
      **  Default it to country of citizinship
      **  Access customer file for country of citizenship
     C           S2ACOF    IFEQ *BLANKS
     C                     MOVE 'Y'       WBLACF                          161257
     C                     CALL 'AOCUSTR0'
     C                     PARM '       ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM S1CUST    @CNUM
     C                     PARM           @CNST
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C           P#MODE    IFEQ 'F'                                       CAP068
     C                     MOVEL'LEF0361' ZAMSID                          CAP068
     C                     EXSR ZASNMS                                    CAP068
     C                     ELSE                                           CAP068
     C           *LOCK     IN   LDA
     C                     Z-ADD4         DBASE
     C                     MOVEL'SDCUSTPD'DBFILE
     C                     MOVELS1CUST    DBKEY
     C                     MOVEL'LE2020'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF                                          CAP068
     C                     ELSE
     C                     MOVE BBACOC    S2ACOF
     C                     ENDIF
      *
     C                     ELSE
      *
     C                     MOVE S2ACOF    ACOKEY
     C                     CALL 'AOACOFR0'PLIST4
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'LEF0044' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN45
     C                     ELSE
     C                     MOVE AZACOC    S2ACOF
     C                     ENDIF
      *
     C                     ENDIF
     C/COPY WNCPYSRC,LE2020C030
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDPRC :   Validate profit centre
      ***********************************************************
     C           VLDPRC    BEGSR
      *
     C                     MOVE *OFF      *IN46
      *
      **  VALIDATE PROFIT CENTRE IF PROFIT CENTRE IS USED AND
      **  IS AMENDABLE, OR DURING INSERT.
      *
     C           BKPRCU    IFEQ 'Y'
     C           BKPRCA    IFEQ 'Y'
     C           S1ACTN    OREQ 'I'
      *
      **  IF PROFIT CENTRE IS USED THEN :-
      **  VALIDATE THE INPUT PROFIT CENTRE IF ENTERED
      *
     C           S2PRFC    IFNE *BLANKS
     C                     MOVE *BLANKS   @KEY    4
     C                     CALL 'AOPRFCR0'
     C                     PARM '*BLANKS' @RTCD
     C                     PARM '*KEY    '@OPTN
     C                     PARM S2PRFC    @KEY
     C           SDPRFC    PARM SDPRFC    DSFDY
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'LEF0045' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN46
     C                     ELSE
     C                     MOVE DSPCCD    S2PRFC
     C                     ENDIF
      *
      **  ELSE /* PROFIT CENTRE IS USED BUT NOT ENTERED */ :-
      **  EXTRACT THE DEFAULT PROFIT CENTRE IF INPUT PROFIT CENTRE IS
      **  BLANK AND PROFIT CENTRE USED FLAG IS ON AND DEFAULT FLAG IS
      **  ALSO ON.
     C                     ELSE
     C           BKPCDU    IFEQ 'Y'
     C                     CALL 'AOPRFMR0'
     C                     PARM *BLANKS   RTCDPR  1
     C                     PARM *BLANKS   BOOKPR  2
     C                     PARM *BLANKS   TRTPPR  5
     C                     PARM *BLANKS   SUTPPR  2
     C                     PARM S2BRCA    BRANPR  3
     C                     PARM *BLANKS   DEPTPR  3
     C                     PARM ##USR     USERPR 10
     C                     PARM S2ACOF    ACOFPR  2
     C                     PARM S2CNUM    CNUMPR  6
     C                     PARM *BLANKS   PRFCPR  4
     C                     MOVE PRFCPR    S2PRFC
     C           RTCDPR    IFEQ '2'
     C                     MOVEL'LEF0045' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN46
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2020C014
      *
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDOBR :   Validate originating branch
      ***********************************************************
     C           VLDOBR    BEGSR
      *
     C                     MOVE *OFF      *IN47
      *
      **  Must be valid for user and on SDBRCHPD
     C           MBIN      IFEQ 'Y'
      *
      ** IF ORIGINATING BR. NOT USED, SET FIELD IN DBASE TO BOOKING BR.
     C           BKOBRU    IFEQ 'N'
     C                     MOVE S2BRCA    S2ORBR
     C                     ELSE
      *
      ** IF ORIGINATING BR. USED BUT NOT ENTERED, TAKE VALID BOOKING BR.
      ** AS DEFAULT.
     C           S2ORBR    IFEQ *BLANKS
     C           *IN27     IFEQ *OFF
     C                     MOVE S2BRCA    S2ORBR
     C                     ELSE
     C                     MOVEL'LEF0009' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN47
E4   C                     ENDIF
      *
     C                     ELSE
      *
      ** ORIGINATING BRANCH USED AND ENTERED, MUST BE VALID FOR USER.
      **  CHECK IF BRANCH CODE DEFINED IN STANDING DATA
     C***********          CALL 'AOBRCHR0'                                121783
     C                     CALL 'AOBRCHR1'                                121783
     C                     PARM '*BLANKS' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM S2ORBR    @BRCA
     C           SDBRCH    PARM SDBRCH    DSSDY
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'LEF0049' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN47
     C                     ELSE
     C                     MOVELA8BRCD    S2ORBR
      *
      **  ONLY VALIDATED VS USER IF 'ORIG BR/USER VALIDATION' = Y
     C           BKOBUV    IFEQ 'Y'
      *
     C           P#MODE    IFEQ 'B'
     C                     CALL 'ZBOBU'
     C                     PARM ORBR      @ZOBRX  3
     C                     PARM           @USER  10
     C                     PARM           @ERR    10
     C                     ELSE
     C                     CALL 'ZVOBU'
     C                     PARM S2ORBR    @ZBR
     C                     PARM           @ERR
     C                     ENDIF
      *
     C           @ERR      IFNE *ZERO
     C           @ERR      IFEQ 1
     C                     MOVEL'LEF0050' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN47
     C                     ENDIF
     C           @ERR      IFEQ 2
     C                     MOVEL'LEF0051' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN47
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDBLI :   Validate billing indicator
      ***********************************************************
     C           VLDBLI    BEGSR
      *
     C                     MOVE *OFF      *IN48
      *
      **  Must be be 'B', 'T', 'N' or blank
     C           S2BTIN    IFEQ *BLANKS
     C                     MOVE BPBTIN    S2BTIN
     C                     ELSE
     C           S2BTIN    IFNE 'B'
     C           S2BTIN    ANDNE'T'
     C           S2BTIN    ANDNE'N'
     C                     MOVEL'LEF0052' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN48
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDBLD :   Validate billing days
      ***********************************************************
     C           VLDBLD    BEGSR
      *
     C                     MOVE *OFF      *IN49
      *
     C                     SELEC
      *
     C           S2BLDY    WHEQ *BLANKS
     C           S2BTIN    ANDEQ'T'
     C/COPY WNCPYSRC,LE2020C032
     C                     MOVEL'0'       S2BLDY
     C/COPY WNCPYSRC,LE2020C033
     C                     MOVE A6TXND    S2BLDY
      *
     C           S2BLDY    WHEQ *BLANKS
     C           S2BTIN    ANDEQ'B'
     C                     MOVE BPDBDY    S2BLDY
      *
     C           S2BLDY    WHEQ *BLANKS
     C           S2BTIN    ANDEQ'N'
     C/COPY WNCPYSRC,LE2020C034
     C                     MOVE '00'      S2BLDY
     C/COPY WNCPYSRC,LE2020C035
      *
     C           S2BLDY    WHNE *BLANKS
     C                     TESTN          S2BLDY     19
     C           *IN19     IFEQ *OFF
     C                     MOVEL'LEF0053' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN49
     C                     ELSE
     C/COPY WNCPYSRC,LE2020C036
     C                     MOVE S2BLDY    W#BLDY  20
     C/COPY WNCPYSRC,LE2020C037
     C           S2BTIN    IFEQ 'B'
     C/COPY WNCPYSRC,LE2020C038
     C           W#BLDY    IFGT 30
     C/COPY WNCPYSRC,LE2020C039
     C           W#BLDY    ORLT 1
     C                     MOVEL'LEF0053' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN49
     C                     ENDIF
     C                     ENDIF
     C           S2BTIN    IFEQ 'T'
     C           W#BLDY    IFGT 9
     C           W#BLDY    ORLT 1
     C                     MOVEL'LEF0053' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN49
     C                     ENDIF
     C                     ENDIF
     C           S2BTIN    IFEQ 'N'
     C           W#BLDY    ANDNE0
     C                     MOVEL'LEF0053' ZAMSID
     C                     MOVEL'Y'       W#ERR1                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR1                          120136
     C                     MOVE *ON       *IN49
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSL
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDASN :   Validate account sequence number
      ***********************************************************
     C           VLDASN    BEGSR
      *                                                                   CLE005
     C                     MOVE '0'       *IN50                           CLE005
      *                                                                   CLE005
      **  Default Account Sequence Number to '01' if blank                CLE005
      *                                                                   CLE005
     C           S2ACSQ    IFEQ *BLANK                                    CLE005
     C                     MOVE 01        S2ACSQ                          CLE005
     C                     ELSE                                           CLE005
      *                                                                   CLE005
      **  Account Sequence Number must be numeric between 01-99           CLE005
      *                                                                   CLE005
     C                     TESTN          S2ACSQ     19                   CLE005
     C           *IN19     IFEQ '0'                                       CLE005
     C                     MOVEL'LEF0259' ZAMSID                          CLE005
     C                     MOVE 'Y'       W#ERR1                          148004
     C                     EXSR ZASNMS                                    CLE005
     C***********          MOVE 'Y'       W#ERR1                   CLE005 148004
     C                     MOVE '1'       *IN50                           CLE005
      *                                                                   CLE005
      **  Value must be between 01 and 99                                 CLE005
      *                                                                   CLE005
     C                     ELSE                                           CLE005
     C           S2ACSQ    IFLT '01'                                      CLE005
     C           S2ACSQ    ORGT '99'                                      CLE005
     C                     MOVEL'LEF0260' ZAMSID                          CLE005
     C                     MOVE 'Y'       W#ERR1                          148004
     C                     EXSR ZASNMS                                    CLE005
     C***********          MOVE 'Y'       W#ERR1                   CLE005 148004
     C                     MOVE '1'       *IN50                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDSC2 :  Validate Screen 2 details
      ***********************************************************
     C           VLDSC2    BEGSR
      *
     C           S1ACTN    IFEQ 'I'
     C           S1ACTN    OREQ 'A'
     C           S1ACTN    OREQ 'X'                                       123857
      *
     C                     MOVE 'N'       W#ERR2  1
     C                     MOVE 'N'       W#WRN2                          133796
     C                     Z-ADDW#CNT2    W#CNTT  20                      133796
      *                                                                   183724
      ** Retrieve values from first screen for second screen validation   183724
      *                                                                   183724
     C           S1ACTN    IFEQ 'X'                                       183724
     C                     EXSR VLDAPR                                    183724
     C                     EXSR VLDEXP                                    183724
     C                     END                                            183724
      *
     C           *IN17     IFEQ *ON                                       167979
      **  Validate Syndication indicator
     C                     EXSR VLDSYI
      *
      **  Validate Syndication Complete Indicator
     C                     EXSR VLDSYC
      *
      **  Validate Agent Customer Reference
     C           *IN86     IFEQ *OFF                                      122624
     C                     EXSR VLDACR
     C                     ENDIF                                          122624
     C                     ENDIF                                          167979
      *
      **  Validate Drawing Types
     C                     EXSR VLDDTS
      *
      **  Validate Default Interest Basis
     C                     EXSR VLDICB
      *
      **  Validate Rollover Types
     C                     EXSR VLDROT
      *
      **  Validate Irregular Rollover Period
     C                     EXSR VLDIRP
      *
      **  Validate Currency Selection Indicator
     C                     EXSR VLDCSI
      *
      **  Validate Allowable Currencies
     C                     EXSR VLDACY
      *
      **  Validate Date Committed
     C                     EXSR VLDDCM
      *
      **  Validate Closing Date
     C                     EXSR VLDCLD
      *
      **  Validate Last Availability Date
     C                     EXSR VLDLAD
      *
      **  Validate Last Payment Penalty Type
     C                     EXSR VLDLPT
      *
      **  Validate Last Payment Penalty Base Rate
     C                     EXSR VLDLPB
      *
      **  Validate Last Payment Penalty Amount/Spread
     C                     EXSR VLDLPS
      *
      **  Validate Last Payment Penalty Sign
     C                     EXSR VLDLPN
      *
      **  Validate Default Participation Loan Type/subtype
     C                     EXSR VLDPLT
      *                                                                   CLE008
      **  Validate Loan Administrator Id                                  CLE008
     C           *IN77     IFEQ *OFF                                      CLE008
     C           CLE008    ANDEQ'Y'                                       CLE008
     C                     EXSR VLDLAI                                    CLE008
     C                     ENDIF                                          CLE008
      *                                                                   123857
     C           CLE005    IFEQ 'Y'                                                           194864
     C                     EXSR VLDEXC                                                        194864
     C                     ENDIF                                                              194864
      *                                                                                       194864
     C           S1ACTN    IFEQ 'I'                                       123857
     C           WSELT     ANDEQ'N'                                       157589
     C           S1ACTN    OREQ 'A'                                       123857
     C           WSELT     ANDEQ'N'                                       157589
     C           *IN88     OREQ *ON                                       123857
     C           WSELT     ANDEQ'N'                                       157589
      *                                                                   123857
      ***********                                                  CLE005 128952
      ****Validate*Tranche/Credit*Agreement*Indicator,*Credit      CLE005 128952
      ****Agreement*Customer,*Credit*Agreement*Type/No.*if*CLE005  CLE005 128952
      ****is*switched*on.                                          CLE005 128952
      ***********                                                  CLE005 128952
     C***********CLE005    IFEQ 'Y'                                CLE005 128952
     C***********          EXSR VLDCRA                             CLE005 128952
     C***********          ENDIF                                   CLE005 128952
      *                                                                   CLE005
      **  Validate Credit/Agreement Exchange Rate and Exchange            CLE005
      **  Rate Indicator if CLE005 is switched on.                        170106
      ****Rate*Indicator*if*CLE005*and*CLE006*are*switched*on.**** CLE005 170106
      *                                                                   CLE005
     C********** CLE005    IFEQ 'Y'                                                    CLE005 194864
     C***********CLE006    ANDEQ'Y'                                CLE005 170106
     C**********           EXSR VLDEXC                                                 CLE005 194864
     C**********           ENDIF                                                       CLE005 194864
      *
     C           P#MODE    IFEQ 'I'
     C           P#MODE    OREQ 'R'
     C           P#MODE    OREQ 'F'                                       CAP065
     C           W#ERR2    IFEQ 'N'
      *
     C/COPY WNCPYSRC,LEH00611
     C           SYIN      IFEQ 'Y'                                       148847
     C           PRTR      ANDNE'P'                                       148847
     C           PRTR      ANDNE'I'                                       148847
     C           S1ACTN    ANDEQ'X'                                       148847
      *                                                                   148847
     C           *INKV     IFEQ *OFF                                      148847
     C           *INKW     ANDEQ*OFF                                      148847
     C           *INKX     ANDEQ*OFF                                      148847
      *                                                                   148847
     C/COPY WNCPYSRC,LE2020MOV2
     C           W#WRN2    IFNE 'Y'                                       133796
     C           W#WRN2    OREQ 'Y'                                       133796
     C           W#CNT2    ANDGTW#CNTT                                    133796
     C           W#CNTT    ANDNE*ZEROS                                    133796
     C                     EXSR SRWNDW
     C                     ENDIF                                          133796
      *                                                                   123857
     C                     ENDIF                                          148847
     C***********SYIN      IFEQ 'Y'                                123857 148847
     C***********PRTR      ANDNE'P'                                123857 148847
     C***********PRTR      ANDNE'I'                                123857 148847
     C***********S1ACTN    ANDNE'I'                                146312 148847
     C           #RTRN     IFEQ *BLANKS                                   148847
     C                     EXSR SRPART                                    123857
     C                     ENDIF                                          123857
     C                     ELSE                                           148847
      *                                                                   148847
     C/COPY WNCPYSRC,LE2020MOV2                                           148847
     C           *INKV     IFEQ *OFF                                      148847
     C           *INKW     ANDEQ*OFF                                      148847
     C           *INKX     ANDEQ*OFF                                      148847
     C           W#WRN2    IFNE 'Y'                                       148847
     C           W#WRN2    OREQ 'Y'                                       148847
     C           W#CNT2    ANDGTW#CNTT                                    148847
     C           W#CNTT    ANDNE*ZEROS                                    148847
     C                     EXSR SRWNDW                                    148847
     C                     ENDIF                                          148847
     C                     ENDIF                                          148847
     C                     ENDIF                                          148847
      *                                                                   123857
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                          123857
      *
      **  If valid update files
     C           W#ERR2    IFNE 'Y'
     C***********#RTRN     ANDEQ*BLANKS                            122630 123857
     C           *INKV     ANDEQ*OFF
     C           *INKW     ANDEQ*OFF
     C           *INKX     ANDEQ*OFF
     C           W#WRN2    IFNE 'Y'                                       133796
     C           W#WRN2    OREQ 'Y'                                       133796
     C           W#CNT2    ANDGTW#CNTT                                    133796
     C           W#CNTT    ANDNE*ZEROS                                    133796
     C           *IN88     IFEQ *ON                                       123857
     C           #RTRN     ANDEQ*BLANKS                                   123857
     C           WF2MSG    ANDEQ' '                                       148847
     C           WSELT     ANDEQ'N'                                       157589
     C           S1ACTN    ORNE 'X'                                       123857
     C           #RTRN     ANDEQ*BLANKS                                   123857
     C           WSELT     ANDEQ'N'                                       157589
     C           S1ACTN    OREQ 'X'                                       148847
     C           *IN88     ANDEQ*OFF                                      148847
     C           *INKK     ANDEQ*ON                                       148847
     C           #RTRN     ANDEQ*BLANKS                                   148847
     C***********W#WRN2    ORNE 'Y'                                 CLE005133796
     C***********W#WRN2    OREQ 'Y'                                 CLE005133796
     C***********W#CNT2    ANDGT1                                   CLE005133796
     C                     EXSR UPDFLE
     C/COPY WNCPYSRC,LE2020C013
     C                     ELSE                                           123857
      *                                                                   148847
      ** If F11 not pressed on second screen, show window pgm             148847
      *                                                                   148847
     C           S1ACTN    IFEQ 'X'                                       148847
     C           *IN88     ANDEQ*OFF                                      148847
     C           *INKK     ANDEQ*OFF                                      148847
      *                                                                   123857
     C/COPY WNCPYSRC,LE2020MOV1                                           123857
     C           P#MODE    IFEQ 'I'                                       188824
     C           P#MODE    OREQ 'R'                                       188824
     C                     EXSR SRWNDW                                    123857
     C                     END                                            188824
      *                                                                   123857
      **  Move to previous screen                                         123857
     C           #RTRN     IFNE 'USR0790'                                 123857
     C***********          MOVE *ON       *INKL                    123857 148847
     C                     MOVE 'Y'       W#UPOK                          123857
     C                     ENDIF                                          123857
     C                     ENDIF                                          148847
      *                                                                   123857
     C                     ENDIF                                          123857
     C                     ENDIF
     C                     ENDIF                                          133796
      *
     C                     ELSE
      *                                                                   122629
     C/COPY WNCPYSRC,LE2020MOV1                                           122629
     C           P#MODE    IFEQ 'I'                                       188824
     C           P#MODE    OREQ 'R'                                       188824
     C                     EXSR SRWNDW                                    122629
     C                     END                                            188824
      *
      **  Move to previous screen
     C           #RTRN     IFNE 'USR0790'                                 122630
     C***********          MOVE *ON       *INKL                           148847
     C                     MOVE 'Y'       W#UPOK
      *                                                                   160627
     C           S1ACTN    IFEQ 'E'                                       160627
     C                     MOVE *ON       *INKL                           160627
     C                     ENDIF                                          160627
      *                                                                   160627
     C                     ENDIF
     C                     ENDIF                                          122630
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDSYI :   Validate Syndication Indicator
      ***********************************************************
     C           VLDSYI    BEGSR
      *
     C                     MOVE *OFF      *IN52
      *
     C                     SELEC
      *
     C           S3SYIN    WHEQ *BLANKS
     C           S1ACTN    ANDNE'A'
     C                     MOVE 'N'       S3SYIN
     C           S3SYIN    WHNE 'Y'
     C           S3SYIN    ANDNE'N'
     C                     MOVEL'LEF0063' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN52
     C           S1ACTN    WHNE 'I'
     C           S3SYIN    ANDEQ'N'
     C           SYIN      ANDEQ'Y'
     C                     MOVE S2BRCA    K4BRCA
     C                     MOVE K3CNUM    K4CNUM
     C                     MOVE K3FACT    K4FACT
     C                     MOVE K3FCNO    K4FCNO
     C           K#KY04    SETLLLEFCLTL2                 80
     C           *IN80     IFEQ *ON
     C                     MOVEL'LEF0064' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN52
     C                     MOVE *OFF      *IN80
     C                     ENDIF
      *
     C                     ENDSL
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDSYC :   Validate Syndication Complete Indicator
      ***********************************************************
     C           VLDSYC    BEGSR
      *
     C                     MOVE *OFF      *IN53
      *
     C                     SELEC
      *
     C           S3SYIN    WHEQ 'N'
     C           S3SYCP    ANDEQ'Y'
     C                     MOVEL'LEF0105' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN53
      *
     C***********S3SYCP    WHEQ 'Y'                                       120720
      *
      **  Check to see if total of participant's facility amount
      **  equal prime facility amount
     C***********P#MODE    IFNE 'B'                                       120720
      *
     C***********          Z-ADD0         W#TOPF                          120720
     C***********          MOVE S2BRCA    K4BRCA                          120720
     C***********          MOVE K3CNUM    K4CNUM                          120720
     C***********          MOVE K3FACT    K4FACT                          120720
     C***********          MOVE K3FCNO    K4FCNO                          120720
     C***********K#KY04    SETLLLEFCLTL2                                  120720
     C***********K#KY04    READELEFCLTL2            N    80               120720
     C************IN80     DOWEQ*OFF                                      120720
     C***********          ADD  FAMT      W#TOPF 130                      120720
     C***********K#KY04    READELEFCLTL2            N    80               120720
     C***********          ENDDO                                          120720
     C***********          MOVE 'A'       K3RCTP                          120720
     C***********K#KY03    CHAINFCLTY               N80                   120720
     C***********FAMT      IFNE W#TOPF                                    120720
     C***********          MOVEL'LEF0065' ZAMSID                          120720
     C***********          MOVEL'Y'       W#ERR2                    120136120720
     C***********          EXSR ZASNMS                                    120720
     C***********          MOVEL'Y'       W#ERR2                          120136
     C***********          MOVE *ON       *IN53                           120720
     C***********          ENDIF                                          120720
      *
     C***********          ENDIF                                          120720
      *
     C           S3SYCP    WHEQ *BLANKS
     C                     MOVE 'N'       S3SYCP
      *
     C           S3SYCP    WHNE 'Y'
     C           S3SYCP    ANDNE'N'
     C                     MOVEL'LEF0066' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN53
      *
     C                     ENDSL
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDACR :   Validate agent customer reference
      ***********************************************************
     C           VLDACR    BEGSR
      *
     C                     MOVE *OFF      *IN54
      *
     C           S3SYIN    IFEQ 'Y'
      *
     C***********S3ANUM    IFEQ *BLANKS                                   120136
      *
      **  Default to the agent customer reference of the branch of
      **  the facility
     C***********          CALL 'AOBRCHR0'                                121783
     C                     CALL 'AOBRCHR1'                                121783
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM S2BRCA    @BRCA
     C           SDBRCH    PARM SDBRCH    DSSDY
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD5         DBASE
     C                     MOVEL'SDBRCHPD'DBFILE
     C                     MOVELS1CUST    DBKEY
     C                     MOVEL'LE2020'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF                                          120136
     C***********          ELSE                                           120136
     C           S3ANUM    IFEQ *BLANKS                                   120136
     C                     MOVELA8SYCU    S3ANUM    P
     C***********          ENDIF                                          120136
      *
     C                     ELSE
      *
      ** Access the Customer Details file
     C                     CALL 'AOCUSTR0'
     C                     PARM '       ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM S3ANUM    @CNUM
     C                     PARM           @CNST
     C           SDCUST    PARM SDCUST    DSSDY
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'LEF0067' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN54
     C                     ELSE
     C           BBPAIN    IFEQ 'Y'
     C                     MOVEL'LEF0068' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN54
     C                     ELSE
     C           S3ANUM    IFEQ '?'                                       157589
     C                     MOVE 'Y'       WSELT                           157589
     C                     ENDIF                                          157589
     C                     MOVELBBCUST    S3ANUM    P
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                   120136
     C                     MOVE ' '       W#PRTR                          162883
     C           S3ANUM    IFEQ A8SYCA                                    120136
     C                     MOVE 'A'       W#PRTR                          120136
      *                                                                   161257
      ** Default account officer of the agent customer when account       161257
      ** officer is blank and bank is the agent                           161257
      *                                                                   161257
     C           WBLACF    IFEQ 'Y'                                       161257
     C                     CALL 'AOCUSTR0'                                161257
     C                     PARM *BLANKS   PRTCD   7                       161257
     C                     PARM '*KEY   ' POPTN   7                       161257
     C                     PARM S3ANUM    PCNUM  10                       161257
     C                     PARM           PCNST   7                       161257
     C           SDCUST    PARM SDCUST    DSSDY                           161257
      *                                                                   161257
     C           PRTCD     IFNE *BLANKS                                   161257
     C           *LOCK     IN   LDA                                       161257
     C                     Z-ADD12        DBASE                           161257
     C                     MOVEL'SDCUSTPD'DBFILE           ************   161257
     C                     MOVELS3ANUM    DBKEY            * DBERR 12 *   161257
     C                     MOVEL'LE2020'  DBPGM            ************   161257
     C                     OUT  LDA                                       161257
     C                     EXSR *PSSR                                     161257
     C                     ELSE                                           161257
     C                     MOVE BBACOC    S2ACOF                          161257
     C                     ENDIF                                          161257
     C                     ENDIF                                          161257
      *                                                                   120720
      **  Check to see if total of participant's facility amount          120720
      **  equal prime facility amount                                     120720
     C           P#MODE    IFNE 'B'                                       120720
     C           S1ACTN    ANDNE'I'                                       120720
     C           S3SYCP    ANDEQ'Y'                                       120720
      *                                                                   120720
     C                     Z-ADD0         W#TOPF                          120720
     C                     MOVE S2BRCA    K4BRCA                          120720
     C                     MOVE K3CNUM    K4CNUM                          120720
     C                     MOVE K3FACT    K4FACT                          120720
     C                     MOVE K3FCNO    K4FCNO                          120720
     C           K#KY04    SETLLLEFCLTL2                                  120720
     C           K#KY04    READELEFCLTL2            N    80               120720
     C           *IN80     DOWEQ*OFF                                      120720
     C                     ADD  FAMT      W#TOPF 130                      120720
     C           K#KY04    READELEFCLTL2            N    80               120720
     C                     ENDDO                                          120720
     C                     MOVE 'A'       K3RCTP                          120720
     C           K#KY03    CHAINFCLTY               N80                   120720
     C           FAMT      IFNE W#TOPF                                    120720
     C                     MOVEL'LEF0065' ZAMSID                          120720
     C                     MOVEL'Y'       W#ERR2                          148004
     C                     EXSR ZASNMS                                    120720
     C***********          MOVEL'Y'       W#ERR2                   120720 148004
     C                     MOVE *ON       *IN53                           120720
     C                     ENDIF                                          120720
      *                                                                   120720
     C                     ENDIF                                          120720
     C                     ENDIF                                          120136
      *
     C                     ELSE
      *
     C                     MOVE ' '       W#PRTR                                              224198
     C           S3SYIN    IFEQ 'N'
     C           S3ANUM    ANDNE*BLANKS
     C                     MOVEL'LEF0106' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN54
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDDTS :   Validate drawing types
      ***********************************************************
     C           VLDDTS    BEGSR
      *
     C                     MOVE *OFF      *IN55
      *
     C           S3DTX5    IFEQ *BLANKS
     C           CLE028    ANDEQ'N'                                                           CLE028
     C           S3DTX6    OREQ *BLANKS                                                       CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
      *   Default to all if no entry made.
     C                     MOVE 'C'       S3DTS1
     C                     MOVE 'T'       S3DTS2
     C                     MOVE 'D'       S3DTS3
     C                     MOVE 'R'       S3DTS4
     C                     MOVE 'M'       S3DTS5
      *                                                                                       CLE028
      ** If Flat Rate Personal Loans (Rule of 78s) is installed                               CLE028
      ** and Syndication indicator is not 'Y', default the 6th                                CLE028
      ** drawing type to 'F'.                                                                 CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           S3SYIN    ANDNE'Y'                                                           CLE028
     C                     MOVE 'F'       S3DTS6                                              CLE028
     C                     ENDIF                                                              CLE028
      *
     C                     ELSE
      *   Check for valid entries
     C                     Z-ADD1         Y       20
      *                                                                                       CLE028
      ** If Flat Rate Personal Loans (Rule of 78s) is installed,                              CLE028
      ** validate also the 6th Drawing Type. Validation was amended                           CLE028
      ** to accept a drawing type value of 'F' for  Flat Rate                                 CLE028
      ** Personal Loans.                                                                      CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     MOVEAS3DTX6    DTS                                                 CLE028
     C                     ELSE                                                               CLE028
     C                     MOVEAS3DTX5    DTS
     C                     ENDIF                                                              CLE028
      *
     C********** Y         DOWLT6                                                             CLE028
     C           Y         DOWLT7                                                             CLE028
     C           *IN55     ANDEQ*OFF
     C           DTS,Y     LOKUPADT                      19
     C           *IN19     IFEQ *OFF
     C           CLE028    OREQ 'N'                                                           CLE028
     C           DTS,Y     ANDEQ'F'                                                           CLE028
     C                     MOVEL'LEF0070' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN55
      *                                                                                       CLE028
      ** If Flat Rate Personal Loans (Rule of 78s) is installed,                              CLE028
      ** F is not a valid drawing type for syndicated facilities.                             CLE028
      *                                                                                       CLE028
     C                     ELSE                                                               CLE028
     C           DTS,Y     IFEQ 'F'                                                           CLE028
     C           S3SYIN    ANDEQ'Y'                                                           CLE028
     C                     MOVEL'LEF0362' ZAMSID                                              CLE028
     C                     MOVEL'Y'       W#ERR2                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     MOVE *ON       *IN55                                               CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF
     C                     ADD  1         Y
     C                     ENDDO
      *
     C           *IN55     IFEQ *OFF
      *                                                                                       208485
     C                     MOVEADTS       WDTS2                                               208485
      *
      **  Duplicates not allowed
     C                     Z-ADD1         Y
      *
     C********** Y         DOWLT6                                                             CLE028
     C           Y         DOWLT7                                                             CLE028
     C           *IN55     ANDEQ*OFF
     C                     MOVE DTS,Y     W#DTS   1
     C                     MOVE *BLANK    DTS,Y
     C           W#DTS     LOKUPDTS,1                    19
     C           *IN19     IFEQ *ON
     C           W#DTS     ANDNE*BLANKS
     C                     MOVEL'LEF0069' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN55
     C                     ENDIF
     C                     ADD  1         Y
     C                     ENDDO
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     Z-ADD1         Z       20                                          208485
     C           Z         DOWLT7                                                             208485
     C           *IN55     ANDEQ*OFF                                                          208485
     C           WDTS1,Z   LOKUPWDTS2                    19                                   208485
     C           *IN19     IFEQ *OFF                                                          208485
     C           WDTS1,Z   ANDNE*BLANKS                                                       208485
     C**********           Z-ADDCNUM      KCNUM   60                                   208485 CSD027
     C                     MOVE CNUM      KCNUM   6                                           CSD027
     C                     Z-ADDFACT      KFACT   30                                          208485
     C                     Z-ADDFCNO      KFCNO   20                                          208485
     C           KCLOAF    SETLLCLOANF                   60                                   208485
     C           KCLOAF    READECLOANF                   60                                   208485
     C           *IN60     DOWEQ*OFF                                                          208485
     C           C2RECI    IFEQ 'D'                                                           208485
     C                     MOVE *BLANKS   WCHK    3                                           208485
     C                     MOVE C2PTYP    WPTYP   2                                           208485
     C           WDTS1,Z   CAT  WPTYP     WCHK                                                208485
     C           WCHK      LOKUPWDRPT                    19                                   208485
      *                                                                                       208485
     C           *IN19     IFEQ *ON                                                           208485
     C                     MOVEL'LEF0363' ZAMSID                                              208485
     C                     MOVEL'Y'       W#ERR2                                              208485
     C                     EXSR ZASNMS                                                        208485
     C                     MOVE *ON       *IN55                                               208485
     C                     ENDIF                                                              208485
     C                     ENDIF                                                              208485
     C           KCLOAF    READECLOANF                   60                                   208485
     C                     ENDDO                                                              208485
     C                     ENDIF                                                              208485
     C                     ADD  1         Z                                                   208485
     C                     ENDDO                                                              208485
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDICB :   Validate Interest Charging Basis
      ***********************************************************
     C           VLDICB    BEGSR
      *
     C                     MOVE *OFF      *IN56
      *
     C           S3DICB    IFEQ *BLANKS
     C                     MOVEL'LEF0071' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN56
      *
     C                     ELSE
      *
     C                     TESTN          S3DICB     19
     C           *IN19     IFEQ *OFF
     C                     MOVEL'LEF0071' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN56
     C                     ELSE
     C                     MOVE S3DICB    W#DICB  10
     C           W#DICB    IFGT 6
     C           W#DICB    ORLT 1
     C                     MOVEL'LEF0071' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN56
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDROT :   Validate Rollover Types
      ***********************************************************
     C           VLDROT    BEGSR
      *
     C                     MOVE *OFF      *IN57
      *
     C           S3RTX6    IFEQ *BLANKS
      *   Default to all if no entry made.
     C                     MOVE 'M'       S3RTS1
     C                     MOVE 'T'       S3RTS2
     C                     MOVE 'Q'       S3RTS3
     C                     MOVE 'X'       S3RTS4
     C                     MOVE 'Y'       S3RTS5
     C                     MOVE 'Z'       S3RTS6
      *
     C                     ELSE
      *   Check for valid entries
     C                     Z-ADD1         Y
     C                     MOVEAS3RTX6    ROT
      *
     C           Y         DOWLT7
     C           *IN57     ANDEQ*OFF
     C           ROT,Y     LOKUPARO                      19
     C           *IN19     IFEQ *OFF
     C                     MOVEL'LEF0072' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN57
     C                     ENDIF
     C                     ADD  1         Y
     C                     ENDDO
      *
     C           *IN57     IFEQ *OFF
      *
      **  Duplicates not allowed
     C                     Z-ADD1         Y
      *
     C           Y         DOWLT7
     C           *IN57     ANDEQ*OFF
     C                     MOVE ROT,Y     W#ROT   1
     C                     MOVE *BLANK    ROT,Y
     C           W#ROT     LOKUPROT,1                    19
     C           *IN19     IFEQ *ON
     C           W#ROT     ANDNE*BLANKS
     C                     MOVEL'LEF0073' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN57
     C                     ENDIF
     C                     ADD  1         Y
     C                     ENDDO
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDIRP :   Validate Irregular Rollover Types
      ***********************************************************
     C           VLDIRP    BEGSR
      *
     C                     MOVE *OFF      *IN58
      *                                                                   119883
      * If Z (irregular) is used as a rollover period, then entry         119883
      * should be 01-12, default 12; otherwise must be blank/zero.        119883
     C           'Z'       SCAN S3RTX6    Y                               119883
      *
     C           S3RLPD    IFEQ *BLANKS
      *
     C***********Y         IFGT *ZERO                              119883 153667
     C***********          MOVE '12'      S3RLPD                          153667
     C***********          ELSE                                    119883 153667
     C                     MOVE *ZEROS    S3RLPD                          119883
     C***********          ENDIF                                   119883 153667
      *
     C                     ELSE
      *
     C                     TESTN          S3RLPD     19
     C           *IN19     IFEQ *OFF
     C                     MOVEL'LEF0074' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN58
     C                     ELSE
     C                     MOVE S3RLPD    W#RLPD  20
     C           W#RLPD    IFGT 12
     C***********W#RLPD    ORLT 1                                         153667
     C           Y         ANDGT*ZERO                                     153667
     C           W#RLPD    ORLT 0                                         153667
     C           Y         ANDGT*ZERO                                     119883
     C           W#RLPD    ORNE *ZERO                                     119883
     C           Y         ANDEQ*ZERO                                     119883
     C                     MOVEL'LEF0075' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN58
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************         CLE008
      *  VLDLAI :   Validate Loan Administrator Id                        CLE008
      ***********************************************************         CLE008
     C           VLDLAI    BEGSR                                          CLE008
      *                                                                   CLE008
     C                     MOVE *OFF      *IN87                           CLE008
      *                                                                   CLE008
     C           S3LAID    IFNE *BLANKS                                   CLE008
     C                     MOVE S3LAID    ACOKEY                          CLE008
     C                     CALL 'AOACOFR0'PLIST4                          CLE008
     C           @RTCD     IFNE *BLANKS                                   CLE008
     C                     MOVEL'LEF0044' ZAMSID                          CLE008
     C                     MOVEL'Y'       W#ERR2                          CLE008
     C                     EXSR ZASNMS                                    CLE008
     C                     MOVE *ON       *IN87                           CLE008
     C                     ELSE                                           CLE008
      *                                                                   189598
     C                     MOVELS3LAID    S3LAI1  1                       189598
     C                     MOVE S3LAID    S3LAI2  1                       189598
      *                                                                   189598
     C           S3LAI1    IFEQ '?'                                       189598
     C           S3LAI2    OREQ '?'                                       189598
     C                     MOVE 'Y'       WSELT                           189598
     C                     END                                            189598
      *                                                                   189598
     C                     MOVE AZACOC    S3LAID                          CLE008
     C                     ENDIF                                          CLE008
     C                     ELSE                                           CLE008
     C                     MOVE S2ACOF    S3LAID                          CLE008
     C                     ENDIF                                          CLE008
      *                                                                   CLE008
     C                     ENDSR                                          CLE008
      /EJECT                                                              CLE008
      ***********************************************************
      *  VLDCSI :   Validate Currency Selection Indicator
      ***********************************************************
     C           VLDCSI    BEGSR
      *
     C                     MOVE *OFF      *IN59
      *
     C           S2MCCY    IFEQ 'Y'
      *
     C                     SELEC
     C           S3CSEL    WHEQ *BLANKS
     C                     MOVE 'N'       S3CSEL
     C           S3CSEL    WHNE 'Y'
     C           S3CSEL    ANDNE'N'
     C                     MOVEL'LEF0076' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN59
     C                     ENDSL
     C                     ELSE
     C                     MOVE 'N'       S3CSEL
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDACY :   Validate Alloawble Currencies
      ***********************************************************
     C           VLDACY    BEGSR
      *
     C                     MOVE *OFF      *IN60
      *
     C           S3CSEL    IFEQ 'Y'
      *
     C           S3ACCY    IFEQ *BLANKS
      *
      **  At least one currency must be entered
     C                     MOVEL'LEF0077' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN60
      *
     C                     ELSE
      *   Check for valid entries
     C                     MOVEAS3ACCY    ACY
     C                     Z-ADD1         Y
      *
     C           Y         DOWLT13
      *
     C           ACY,Y     IFNE *BLANKS
      **  Must be a valid code on SDCURRPD
     C                     MOVE ACY,Y     CKEY
      *
     C                     MOVE '*BLANKS' @RTCD
     C                     CALL 'AOCURRR0'PLIST2
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'LEF0078' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C************         MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN60
     C                     ELSE
     C************         MOVE A6CYCD    S2FCCY                          119925
     C                     MOVE A6CYCD    ACY,Y                           119925
      *
     C           A6DLCI    IFEQ 'N'
     C                     MOVEL'LEF0057' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN60
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ADD  1         Y
      *
     C                     ENDDO
      *                                                                   119925
     C                     MOVEAACY       S3ACCY                          119925
      *
      **  Duplicates not allowed
     C                     Z-ADD1         Y
      *
     C           Y         DOWLT7
     C                     MOVE ACY,Y     W#ACY   3
     C                     MOVE *BLANK    ACY,Y
     C           W#ACY     LOKUPACY,1                    19
     C           *IN19     IFEQ *ON
     C           W#ACY     ANDNE*BLANKS
     C                     MOVEL'LEF0079' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN60
     C                     ENDIF
     C                     ADD  1         Y
     C                     ENDDO
      *
     C                     ENDIF
      *
     C                     ELSE
      *
     C           S3CSEL    IFEQ 'N'
     C           S3ACCY    ANDNE*BLANKS
     C                     MOVEL'LEF0098' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN60
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDDCM :   Validate Date Committed
      ***********************************************************
     C           VLDDCM    BEGSR
      *
     C                     MOVE *OFF      *IN61
      *
     C           S3COMD    IFEQ *BLANKS
      **Default*to*date*approved***********************************       126296
      * Default to date approved or Run Date, whichever is earlier        126296
      *                                                                   126296
     C***********W#DTAP    IFLE BJRDNB                              126296CSC011
     C           W#DTAP    IFLE WRNDAY                                    CSC011
     C                     MOVE W#DTAP    ZDAYNO
     C                     ELSE                                           126296
     C*********************MOVE BJRDNB    ZDAYNO                    126296CSC011
     C                     MOVE WRNDAY    ZDAYNO                          CSC011
     C                     ENDIF                                          126296
      *                                                                   126296
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     S3COMD
      *
     C                     ELSE
      *
      ** convert to Midas date format
     C                     MOVE S3COMD    ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ *ON
     C                     MOVEL'LEF0080' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN61
     C                     ELSE
     C***********ZDAYNO    IFLT W#DTAP                                    124116
     C***********ZDAYNO    ORGT W#DTEX                                    124116
     C***********          MOVEL'LEF0100' ZAMSID                          124116
     C***********          MOVE 'Y'       W#ERR2                   120136 124116
     C***********          EXSR ZASNMS                                    124116
     C***********          MOVE 'Y'       W#ERR2                          120136
     C***********          MOVE *ON       *IN61                           124116
     C***********          ENDIF                                          124116
     C                     ENDIF
     C                     ENDIF
      *                                                                   124116
      *  Allow Committed/Approval Date to be any date in the past but     124116
      *  not later than Start date.                                       124116
      *  and not later than run date                                      126296
      *                                                                   124116
     C                     MOVE ZDAYNO    W#COMD  50                      124116
     C           W#COMD    IFGT W#DTAP                                    124116
     C***********W#COMD    ORGT BJRDNB                             126296 128945
     C                     MOVEL'LEF0123' ZAMSID                          124116
     C                     MOVE 'Y'       W#ERR2                          124116
     C                     EXSR ZASNMS                                    124116
     C                     MOVE *ON       *IN61                           124116
     C                     ENDIF                                          124116
      *                                                                   128945
      **  Introduce new message description to avoid confusion            128945
      *                                                                   128945
     C***********W#COMD    IFGT BJRDNB                              128945CSC011
     C           W#COMD    IFGT WRNDAY                                    CSC011
     C                     MOVEL'LEF0295' ZAMSID                          128945
     C                     MOVE 'Y'       W#ERR2                          128945
     C                     EXSR ZASNMS                                    128945
     C                     MOVE '1'       *IN61                           128945
     C                     ENDIF                                          128945
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDCLD :   Validate Closing Date
      ***********************************************************
     C           VLDCLD    BEGSR
      *
     C                     MOVE *OFF      *IN62
      *
     C           S3CDTE    IFEQ *BLANKS
      **Default*to*expiry*date*************************************       126246
     C***********          MOVE W#DTEX    ZDAYNO                          126426
      * Default to start date                                             126246
     C                     MOVE W#DTAP    ZDAYNO                          126246
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     S3CDTE
      *
     C                     ELSE
      *
      ** convert to Midas date format
     C                     MOVE S3CDTE    ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ *ON
     C                     MOVEL'LEF0082' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN62
     C                     ELSE
     C           ZDAYNO    IFLT W#DTAP
     C           ZDAYNO    ORGT W#DTEX
     C                     MOVEL'LEF0083' ZAMSID
     C                     MOVE 'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVE 'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN62
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDLAD :   Validate Last Availability Date
      ***********************************************************
     C           VLDLAD    BEGSR
      *
     C                     MOVE *OFF      *IN63
      *
      *    If no value of AVLD input or stored on file,                   169206
     C           S3AVLD    IFEQ *BLANKS
      * Or if AVLD was previously same as Expiry Date, and the Expiry     169206
      *  Date has been changed, but the Available Date has not            169206
     C           AVLD      OREQ DTEX                                      169206
     C           S2DTEX    ANDNEDTEXS2                                    169206
     C           S3AVLD    ANDEQAVLDS3                                    169206
      * Default to expiry date
     C                     MOVE W#DTEX    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     S3AVLD
      *
     C                     ELSE
      *
      ** convert to Midas date format
     C                     MOVE S3AVLD    ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    W#AVLD  50                      149922
     C           *IN99     IFEQ *ON
     C                     MOVEL'LEF0084' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN63
     C                     ELSE
      *                                                                   156297
      ** If facility is reactivated use the new expiry date in the        156297
      ** facility amendment file instead of the existing expiry date      156297
      ** in the facilities file                                           156297
      *                                                                   156297
     C           ZDAYNO    IFLT W#DTAP
     C           ZDAYNO    ORGT W#DTEX
     C           WREAC     ANDEQ*OFF                                      156297
     C           ZDAYNO    ORGT WNDTEX                                    156297
     C           WREAC     ANDEQ*ON                                       156297
     C***********          MOVEL'LEF0085' ZAMSID                          121029
     C                     MOVEL'LEF0111' ZAMSID                          121029
     C                     MOVE 'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVE 'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN63
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDLPT :   Validate Late Payment Penalty Type
      ***********************************************************
     C           VLDLPT    BEGSR
      *
     C                     MOVE *OFF      *IN64
      *
     C           S3LPTP    IFNE *BLANKS
     C           S3LPTP    ANDNE'P'
     C           S3LPTP    ANDNE'A'
     C                     MOVEL'LEF0088' ZAMSID
     C                     MOVE 'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVE 'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN64
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDLPB :   Validate Late Payment Penalty Base Rate
      ***********************************************************
     C           VLDLPB    BEGSR
      *
     C                     MOVE *OFF      *IN65
      *
     C           S3LPTP    IFNE 'P'
      *
     C           S3LPBR    IFNE *BLANKS
     C                     MOVEL'LEF0089' ZAMSID
     C                     MOVE 'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVE 'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN65
     C                     ENDIF
      *
     C                     ELSE
      *
     C           S3LPBR    IFNE *BLANKS                                   119591
     C                     MOVE S2FCCY    BKEY1
     C                     MOVE S3LPBR    BKEY2
     C                     CALL 'AOBSRTR0'PLIST7
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'LEF0090' ZAMSID
     C                     MOVE 'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVE 'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN65
     C                     ELSE
     C           S3LPBR    IFEQ '?'                                       157589
     C                     MOVE 'Y'       WSELT                           157589
     C                     ENDIF                                          157589
     C                     MOVE BABSRC    S3LPBR
     C                     ENDIF
     C                     ENDIF                                          119591
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDLPS :   Validate Late Payment Penalty Amount/Spread
      ***********************************************************
     C           VLDLPS    BEGSR
      *
     C                     MOVE *OFF      *IN66
      *
     C           S3LPAM    IFNE *BLANKS
     C           S3LPAM    ANDNEC#LPAM                                    122620
      *
     C           S3LPTP    IFEQ *BLANKS
     C                     MOVEL'LEF0091' ZAMSID
     C                     MOVE 'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVE 'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN66
      *
     C                     ELSE
      *
     C           S3LPTP    IFEQ 'P'
      *
      **  Must be valid per ZALIGN
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE S3LPAM    ZFIELD
     C                     Z-ADD7         ZADEC
     C                     Z-ADD4         ZADIG
     C                     EXSR ZALIGN
     C           *IN99     IFEQ *ON
     C                     MOVEL'LEF0092' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN66
     C                     ENDIF
      *
     C                     ELSE
      *
     C           S3LPTP    IFEQ 'A'
      *
      **  Must be valid per ZALIGN
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE S3LPAM    ZFIELD
     C                     Z-ADDW#NBDP    ZADEC
     C           13        SUB  W#NBDP    ZADIG
     C                     EXSR ZALIGN
     C           *IN99     IFEQ *ON
     C                     MOVEL'LEF0092' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN66
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ELSE
     C           S3LPTP    IFEQ 'P'
     C           S3LPBR    ANDEQ*BLANKS                                   157744
     C           S3LPTP    OREQ 'A'
     C                     MOVEL'LEF0097' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN66
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDLPN :   Validate Late Payment Penalty Sign
      ***********************************************************
     C           VLDLPN    BEGSR
      *
     C                     MOVE *OFF      *IN67
      *
     C                     SELEC
     C           S3LPTP    WHNE 'P'
     C           S3LPPS    IFNE *BLANKS
     C                     MOVEL'LEF0093' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN67
     C                     ENDIF
     C           S3LPPS    WHEQ *BLANKS
     C           S3LPAM    ANDNE*BLANKS
     C           *IN66     ANDEQ*OFF
     C           S3LPBR    ANDNE*BLANKS                                   157744
     C           *IN65     ANDEQ*OFF                                      157744
     C                     MOVE '+'       S3LPPS
     C           S3LPPS    WHEQ '-'
     C           S3LPPS    OREQ '+'                                       157744
     C           S3LPBR    IFEQ *BLANKS
     C           S3LPAM    ANDNE*BLANKS                                   157744
     C           *IN66     ANDEQ'0'                                       157744
     C                     MOVEL'LEF0094' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN67
     C                     ELSE
     C           S3LPBR    IFNE *BLANKS                                   157744
     C           S3LPAM    ANDEQ*BLANKS                                   157744
     C           *IN65     ANDEQ'0'                                       157744
     C                     MOVEL'LEF0097' ZAMSID                          157744
     C                     MOVEL'Y'       W#ERR2                          157744
     C                     EXSR ZASNMS                                    157744
     C                     MOVE *ON       *IN67                           157744
     C                     ENDIF                                          157744
     C                     ENDIF
     C           S3LPPS    WHNE '-'
     C           S3LPPS    ANDNE'+'
     C           S3LPPS    ANDNE*BLANKS                                   157744
     C                     MOVEL'LEF0095' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN67
     C                     ENDSL
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  VLDPLT :   Validate Default Participation Loan Type/Subtype
      ***********************************************************
     C           VLDPLT    BEGSR
      *
     C                     MOVE *OFF      *IN68
      *
     C           S3SYIN    IFEQ 'Y'
      *                                                                   156999
      ** Check if there are funding participants                          156999
      *                                                                   156999
     C                     MOVE S2BRCA    K4BRCA                          156999
     C                     MOVE K3CNUM    K4CNUM                          156999
     C                     MOVE K3FACT    K4FACT                          156999
     C                     MOVE K3FCNO    K4FCNO                          156999
     C           K#KY04    SETLLLEFCLTL2                 80               156999
      *
     C                     MOVELS3DFTP    ATCD
     C                     MOVELS3DFST    AUCD
     C                     CALL 'AOLOANR0'PLIST9
      *                                                                   156999
      ** No need to validate default participation loan type and          156999
      ** subtype if both are blanks and agent is not the bank and         156999
      ** there are no funding participants attached to the facility.      156999
      *                                                                   156999
     C                     MOVELA8SYCU    W3ANUM  6                       156999
      *                                                                   156999
     C           S3DFTP    IFEQ *BLANKS                                   156999
     C           S3DFST    ANDEQ*BLANKS                                   156999
     C           S3ANUM    ANDNEW3ANUM                                    156999
     C           *IN80     ANDEQ*OFF                                      156999
     C                     ELSE                                           156999
      *                                                                   156999
     C           @RTCD     IFNE *BLANKS
      *                                                                   156999
      ** If there are funding participants, and loan type/subtype         156999
      ** equal to blanks, send appropriate error message                  156999
      *                                                                   156999
     C           *IN80     IFEQ *ON                                       156999
     C           S3DFTP    ANDEQ*BLANKS                                   156999
     C           S3DFST    ANDEQ*BLANKS                                   156999
     C                     MOVEL'LEF0313' ZAMSID                          156999
     C                     MOVEL'Y'       W#ERR2                          156999
     C                     EXSR ZASNMS                                    156999
     C                     ELSE                                           156999
     C                     MOVEL'LEF0096' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     ENDIF                                          156999
     C                     MOVE *ON       *IN68
     C                     ELSE
      *                                                                   156999
      ** If '?' entered, display selected values to screen                156999
      *                                                                   156999
     C           S3DFTP    IFEQ '?'                                       156999
     C           S3DFST    OREQ '?'                                       156999
     C                     MOVE 'Y'       WSELT                           156999
     C                     MOVE AYLNTY    S3DFTP                          156999
     C                     MOVE AYLNST    S3DFST                          156999
     C                     ENDIF                                          156999
      *                                                                   122617
      *  Only allow processing types 66 or 67 to be entered for default   122617
      *  participation loan type/sub type.                                122617
      *                                                                   122617
     C           AYLNPT    IFEQ 67                                        122617
     C           AYLNPT    OREQ 66                                        122617
     C           CLE005    OREQ 'Y'                                       127650
     C           AYLNPT    ANDEQ69                                        127650
     C           CLE005    OREQ 'Y'                                       127650
     C           AYLNPT    ANDEQ72                                        127650
     C***********S3DFTP    IFEQ '?'                                157589 156999
     C***********S3DFST    OREQ '?'                                157589 156999
     C***********          MOVE 'Y'       WSELT                    157589 156999
     C***********          ENDIF                                   157589 156999
     C***********          MOVE AYLNTY    S3DFTP                          156999
     C***********          MOVE AYLNST    S3DFST                          156999
     C                     ELSE                                           122617
     C                     MOVEL'LEF0113' ZAMSID                          122617
     C                     MOVEL'Y'       W#ERR2                          122617
     C                     EXSR ZASNMS                                    122617
     C                     MOVE *ON       *IN68                           122617
     C                     ENDIF                                          122617
      *                                                                   122617
     C                     ENDIF
      *                                                                   156999
     C                     ENDIF                                          156999
      *
     C                     ELSE
     C           S3SYIN    IFEQ 'N'
     C***********S3DFTP    ANDNE*BLANKS                                   122617
     C***********S3DFST    ANDNE*BLANKS                                   122617
     C           S3DFTP    IFNE *BLANKS                                   122617
     C           S3DFST    ORNE *BLANKS                                   122617
     C                     MOVEL'LEF0107' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          120136
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          120136
     C                     MOVE *ON       *IN68
     C                     ENDIF                                          122617
     C                     ENDIF
     C                     ENDIF
      *
      *
     C                     ENDSR
      /EJECT                                                              CLE005
      ***********************************************************         CLE005
      *  VLDCRA :   Validate Tranche/Credit Agreement Indicator           CLE005
      *             Credit Agreement Customer, Type, and No.              CLE005
      ***********************************************************         CLE005
     C           VLDCRA    BEGSR                                          CLE005
      *                                                                   CLE005
     C                     MOVEA'0000'    *IN,72                          CLE005
     C                     MOVE '0'       *IN73                                               205168
     C                     MOVE '0'       *IN27                                               205168
     C                     MOVE '0'       *IN28                                               205168
      *                                                                   CLE005
      **  Validate Tranche/Credit Agreement Indicator                     CLE005
      *                                                                   CLE005
     C           S3TRCA    IFNE 'TR'                                      CLE005
     C           S3TRCA    ANDNE'CA'                                      CLE005
     C           S3TRCA    ANDNE*BLANKS                                   CLE005
     C                     MOVE 'LEF0264' ZAMSID                          CLE005
     C***********          MOVEL'Y'       W#ERR2                   CLE005 128952
     C                     MOVEL'Y'       W#ERR1                   CLE005 128952
     C                     EXSR ZASNMS                                    CLE005
     C                     MOVE '1'       *IN72                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   133147
      * Do not allow a credit agreement to change to a TR and attach      133147
      * it to itself.                                                     133147
      *                                                                   133147
     C           TRCA      IFEQ 'CA'                                      133147
     C           S3TRCA    ANDEQ'TR'                                      133147
     C           S1ACTN    ANDEQ'A'                                       133147
     C           S2CNUM    ANDEQS3CANM                                    133147
     C           S1FACT    ANDEQS3CAFT                                    133147
     C           S1FCNO    ANDEQS3CAFN                                    133147
     C                     MOVE 'LEF0128' ZAMSID                          133147
     C                     MOVEL'Y'       W#ERR1                          133147
     C                     EXSR ZASNMS                                    133147
     C                     MOVE '1'       *IN72                           133147
     C                     ENDIF                                          133147
      *                                                                   CLE005
      **  Check if Tranche/Credit Agreement Indicator may be changed      158163
      **  from blank or TR to CA (prohibit if loans o/s)                  158163
      *                                                                   158163
     C           TRCA      IFEQ 'TR'                                      158163
     C           S3TRCA    ANDEQ'CA'                                      158163
     C           S1ACTN    ANDNE'I'                                       158163
     C           TRCA      OREQ '  '                                      158163
     C           S3TRCA    ANDEQ'CA'                                      158163
     C           S1ACTN    ANDNE'I'                                       158163
      *                                                                   158163
      ** Check for outstanding loans.                                     158163
     C**********           Z-ADDCNUM      K8CNUM                                       158163 CSD027
     C                     MOVE CNUM      K8CNUM                                              CSD027
     C                     Z-ADDFACT      K8FACT                          158163
     C                     Z-ADDFCNO      K8FCNO                          158163
      *                                                                   158163
     C           K#KY08    SETLLLEREF                                     158163
     C           K#KY08    READELEREF                    80               158163
      *                                                                   158163
     C           *IN80     IFEQ '0'                                       158163
     C                     MOVE 'LEF0086' ZAMSID                          158163
     C                     MOVEL'Y'       W#ERR1                          158163
     C                     EXSR ZASNMS                                    158163
     C                     MOVE '1'       *IN72                           158163
     C                     ENDIF                                          158163
     C                     ENDIF                                          158163
      *                                                                   158163
      **  Check if Tranche/Credit Agreement Indicator may be changed      CLE005
      **  from CA to TR                                                   CLE005
      *                                                                   CLE005
     C           TRCA      IFEQ 'CA'                                      CLE005
     C           S3TRCA    ANDEQ'TR'                                      CLE005
     C           S1ACTN    ANDNE'I'                                       CLE005
     C                     MOVE CNUM      K0CANM                          CLE005
     C                     MOVE FACT      K0CAFT                          CLE005
     C                     MOVE FCNO      K0CAFN                          CLE005
     C           K#KY10    CHAINLEFCLTL9             80                   CLE005
     C           *IN80     IFEQ '0'                                       CLE005
     C                     MOVE 'LEF0280' ZAMSID                          CLE005
     C***********          MOVEL'Y'       W#ERR2                   CLE005 128952
     C                     MOVEL'Y'       W#ERR1                   CLE005 128952
     C                     EXSR ZASNMS                                    CLE005
     C                     MOVE '1'       *IN72                           CLE005
      *                                                                   CLE005
      **  Chain to FCLTY to obtain original record                        CLE005
      *                                                                   CLE005
     C                     MOVE 'A'       K3RCTP                          CLE005
     C                     MOVE S2CNUM    K3CNUM                          CLE005
     C                     MOVE S1FACT    K3FACT                          CLE005
     C                     MOVE S1FCNO    K3FCNO                          CLE005
     C           K#KY03    CHAINFCLTY               N80                   CLE005
     C                     MOVE TNLU      W#TNLU                          CLE005
     C                     MOVE 'B'       K3RCTP                          CLE005
     C           K#KY03    CHAINFCLTY               N80                   CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      **  Validate Credit Agreement Customer                              CLE005
      *                                                                   CLE005
     C           S3TRCA    IFEQ 'TR'                                      CLE005
      *                                                                   155461
     C                     MOVE *BLANKS   WTRCA   2                       155461
     C                     MOVE *BLANK    WMCCY   1                       155461
     C                     MOVE *BLANK    WMCSI   1                       155461
     C                     MOVE *BLANK    WMBFC   1                       155461
      *                                                                   CLE005
     C                     CALL 'AOCUSTR0'                                CLE005
     C                     PARM '       ' @RTCD                           CLE005
     C                     PARM '*KEY   ' @OPTN                           CLE005
     C                     PARM S3CANM    @CNUM  10                       CLE005
     C                     PARM           @CNST   7                       CLE005
     C           SDCUST    PARM SDCUST    DSSDY                           CLE005
      *                                                                   CLE005
     C           @RTCD     IFNE *BLANKS                                   CLE005
     C                     MOVEL'LEF0266' ZAMSID                          CLE005
     C***********          MOVE 'Y'       W#ERR2                   CLE005 128952
     C                     MOVE 'Y'       W#ERR1                   CLE005 128952
     C                     EXSR ZASNMS                                    CLE005
     C                     MOVE '1'       *IN73                           CLE005
     C                     ELSE                                           CLE005
     C***********          MOVE BBCUST    S3CANM                    CLE005135140
     C                     MOVE BBCUST    S3CANM    P                     135140
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      **  Validate Credit Agreement Type                                  CLE005
      *                                                                   CLE005
     C                     MOVE S3CAFT    FKEY                            CLE005
     C                     CALL 'AOFACTR0'PLIST1                          CLE005
      *                                                                   CLE005
     C           @RTCD     IFNE *BLANKS                                   CLE005
     C                     MOVEL'LEF0268' ZAMSID                          CLE005
     C***********          MOVE 'Y'       W#ERR2                   CLE005 128952
     C                     MOVE 'Y'       W#ERR1                   CLE005 128952
     C                     EXSR ZASNMS                                    CLE005
     C                     MOVE '1'       *IN74                           CLE005
     C                     ELSE                                           CLE005
     C                     MOVELAMFCTY    S3CAFT                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      **  Validate Credit Agreement Facility No.                          CLE005
      *                                                                   CLE005
     C                     TESTN          S3CAFN     19                   CLE005
     C           *IN19     IFEQ '0'                                       CLE005
     C                     MOVEL'LEF0270' ZAMSID                          CLE005
     C                     MOVE 'Y'       W#ERR1                          148004
     C                     EXSR ZASNMS                                    CLE005
     C***********          MOVE 'Y'       W#ERR2                   CLE005 128952
     C***********          MOVE 'Y'       W#ERR1                   128952 148004
     C                     MOVE '1'       *IN75                           CLE005
     C                     ELSE                                           CLE005
     C           S3CAFN    IFLT '01'                                      CLE005
     C           S3CAFN    ORGT '99'                                      CLE005
     C                     MOVEL'LEF0271' ZAMSID                          CLE005
     C                     MOVE 'Y'       W#ERR1                          148004
     C                     EXSR ZASNMS                                    CLE005
     C***********          MOVE 'Y'       W#ERR2                   CLE005 128952
     C***********          MOVE 'Y'       W#ERR1                   128952 148004
     C                     MOVE '1'       *IN75                           CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C***********W#ERR2    IFNE 'Y'                                CLE005 128952
     C           W#ERR1    IFNE 'Y'                                CLE005 128952
      *                                                                   CLE005
     C                     MOVE 'A'       K3RCTP                          CLE005
     C                     MOVE S3CANM    K3CNUM                          CLE005
     C                     MOVE S3CAFT    K3FACT                          CLE005
     C                     MOVE S3CAFN    K3FCNO                          CLE005
      *                                                                   CLE005
     C           K#KY03    CHAINFCLTY               N80                   CLE005
     C                     MOVE 'B'       K3RCTP                          155461
     C           K#KY03    CHAINFCLTY               N80                   155461
      *                                                                   CLE005
      **  Must be a valid facility set up as a Credit Agreement           CLE005
      *                                                                   CLE005
     C           *IN80     IFEQ '1'                                       CLE005
     C                     MOVEL'LEF0006' ZAMSID                          CLE005
     C***********          MOVE 'Y'       W#ERR2                   CLE005 128952
     C                     MOVE 'Y'       W#ERR1                   CLE005 128952
     C                     EXSR ZASNMS                                    CLE005
     C                     MOVE '1'       *IN73                           CLE005
     C                     MOVE '1'       *IN74                           CLE005
     C                     MOVE '1'       *IN75                           CLE005
      *                                                                   CLE005
      **  Facility chosen must be set up as Credit Agreement              CLE005
      *                                                                   CLE005
     C                     ELSE                                           CLE005
     C           TRCA      IFNE 'CA'                                      CLE005
     C                     MOVEL'LEF0277' ZAMSID                          CLE005
     C***********          MOVE 'Y'       W#ERR2                   CLE005 128952
     C                     MOVE 'Y'       W#ERR1                   CLE005 128952
     C                     EXSR ZASNMS                                    CLE005
     C                     MOVE '1'       *IN73                           CLE005
     C                     MOVE '1'       *IN74                           CLE005
     C                     MOVE '1'       *IN75                           CLE005
     C                     ENDIF                                          CLE005
     C                     MOVE TRCA      WTRCA                           155461
     C                     MOVE MCCY      WMCCY                           155461
     C                     MOVE MCSI      WMCSI                           155461
     C                     MOVE MBFC      WMBFC                           155461
      * Save Credit agreement currency for validation of CAXR later.      171759
     C                     MOVE FCCY      WCACCY  3        CA currency    171759
      *                                                                   132948
      **The*Tranche*agreement facility amount cannot not exceed the 132948189572
      **amount*for*the credit agreement facility.                   132948189572
      *                                                                   132948
     C           S3TRCA    IFEQ 'TR'                                      132948
      *                                                                   143819
     C           WMCSI     IFEQ 'N'                                                           205168
     C           WTRCA     ANDEQ'CA'                                                          205168
      *                                                                                       205168
     C                     MOVE CNUM      FCUST   6                                           205168
      *                                                                                       205168
     C           S2CNUM    IFNE FCUST                                                         205168
      *                                                                                       205168
     C                     MOVEL'LEF0365' ZAMSID                                              205168
     C                     MOVE 'Y'       W#ERR1                                              205168
     C                     EXSR ZASNMS                                                        205168
     C                     MOVE '1'       *IN73                                               205168
      *                                                                                       205168
     C                     ENDIF                                                              205168
      *                                                                                       205168
     C                     ENDIF                                                              205168
      *                                                                                       205168
     C           WMBFC     IFEQ 'N'                                                           205168
     C           WTRCA     ANDEQ'CA'                                                          205168
      *                                                                                       205168
     C           S2BRCA    IFNE BRCA                                                          205168
      *                                                                                       205168
     C                     MOVEL'LEF0366' ZAMSID                                              205168
     C                     MOVE 'Y'       W#ERR1                                              205168
     C                     EXSR ZASNMS                                                        205168
     C                     MOVE '1'       *IN27                                               205168
      *                                                                                       205168
     C                     ENDIF                                                              205168
      *                                                                                       205168
     C                     ENDIF                                                              205168
      *                                                                                       205168
     C           WMCCY     IFEQ 'N'                                                           205168
     C           WTRCA     ANDEQ'CA'                                                          205168
      *                                                                                       205168
     C           S2FCCY    IFNE FCCY                                                          205168
      *                                                                                       205168
     C                     MOVEL'LEF0364' ZAMSID                                              205168
     C                     MOVE 'Y'       W#ERR1                                              205168
     C                     EXSR ZASNMS                                                        205168
     C                     MOVE '1'       *IN28                                               205168
      *                                                                                       205168
     C                     ENDIF                                                              205168
      *                                                                                       205168
     C                     ENDIF                                                              205168
      *                                                                                       205168
     C***********          Z-ADDFAMT      WAMNT  130                143819189572
     C***********          MOVE S3CANM    K0CANM                    143819189572
     C***********          MOVE S3CAFT    K0CAFT                    143819189572
     C***********          MOVE S3CAFN    K0CAFN                    143819189572
      ***********                                                   143819189572
     C************LOVAL    SETLLFCLTYFL9                            143819189572
     C***********K#KY10    CHAINFCLTYFL9             05             143819189572
      ***********                                                   143819189572
     C************IN05     DOWEQ'0'                                 143819189572
      ***********                                                   143819189572
     C***********LERECI    IFEQ 'D'                                 143819189572
     C***********          MOVE LEFACT    WFACT   3                 143819189572
     C***********          MOVE LEFCNO    WFCNO   2                 143819189572
     C***********S1ACTN    IFEQ 'I'                                 143819189572
     C***********S1ACTN    ORNE 'I'                                 143819189572
     C***********WFACT     ANDNES1FACT                              143819189572
     C***********WFCNO     ANDNES1FCNO                              143819189572
     C***********S1ACTN    ORNE 'I'                                 143819189572
     C***********WFACT     ANDEQS1FACT                              143819189572
     C***********WFCNO     ANDNES1FCNO                              143819189572
     C***********S1ACTN    ORNE 'I'                                 143819189572
     C***********WFACT     ANDNES1FACT                              143819189572
     C***********WFCNO     ANDEQS1FCNO                              143819189572
     C***********          SUB  LEFAMT    WAMNT                     143819189572
     C***********          ENDIF                                    143819189572
     C***********          ENDIF                                    143819189572
      ***********                                                   143819189572
     C***********          READ FCLTYFL9                 05         143819189572
     C***********LECANM    IFNE K0CANM                              143819189572
     C***********LECAFT    ORNE K0CAFT                              143819189572
     C***********LECAFN    ORNE K0CAFN                              143819189572
     C***********          LEAVE                                    143819189572
     C***********          ENDIF                                    143819189572
      ***********                                                   143819189572
     C***********          ENDDO                                    143819189572
      *                                                                   143819
     C***********W#FAMT    IFGT FAMT                               132948 143819
     C***********W#FAMT    IFGT WAMNT                               143819189572
     C***********W#FAMT    ANDNEWAMT                                143819189572
     C***********          MOVEL'LEF0126' ZAMSID                   132948 143819
     C***********          MOVEL'Y'       W#ERR1                   132948 143819
     C***********          MOVEL'LEF0129' ZAMSID                    143819189572
     C***********          MOVEL'Y'       W#WARN                    143819189572
     C***********          ADD  1         W#CNT                     143819189572
     C***********          MOVE 'Y'       CHGIND  1                 143819189572
     C***********          EXSR ZASNMS                              132948189572
     C***********          MOVE *ON       *IN29                     132948189572
     C***********          ENDIF                                    132948189572
     C/COPY WNCPYSRC,LE2020C018
     C***********          Z-ADDW#FAMT    WAMT                      143819189572
      *                                                                   132948
      ** Validate if Authorisation, or Insert/Amend with Tranche ccy                          202011
      ** same as Credit Agreement ccy. (If Insert/Amend with different                        202011
      ** ccys, this validation will be done on the second screen)                             202011
      *                                                                                       194864
     C           S1ACTN    IFEQ 'X'                                                           194864
     C           S1ACTN    OREQ 'I'                                                           194864
     C           S2FCCY    ANDEQFCCY                                                          194864
     C           S1ACTN    OREQ 'A'                                                           194864
     C           S2FCCY    ANDEQFCCY                                                          194864
      *                                                                                       194864
     C                     Z-ADDFAMT      WAMNT  130                                          194864
     C                     MOVE S3CANM    K0CANM                                              194864
     C                     MOVE S3CAFT    K0CAFT                                              194864
     C                     MOVE S3CAFN    K0CAFN                                              194864
     C                     MOVE 'N'       TRYES                                               194864
      *                                                                                       194864
     C           *LOVAL    SETLLFCLTYFL9                                                      194864
     C           K#KY10    CHAINFCLTYFL9             05                                       194864
      *                                                                                       194864
     C           *IN05     DOWEQ'0'                                                           194864
      *                                                                                       194864
     C           LERECI    IFEQ 'D'                                                           194864
     C                     MOVE LECNUM    WCUST   6                                           194864
     C                     MOVE LEFACT    WFACT   3                                           194864
     C                     MOVE LEFCNO    WFCNO   2                                           194864
     C                     MOVE 'Y'       TRYES   1                                           194864
      *                                                                                       194864
     C           S1CUST    IFNE WCUST                                                         194864
     C           WFACT     ORNE S1FACT                                                        194864
     C           WFCNO     ORNE S1FCNO                                                        194864
      *                                                                                       194864
      ** Convert TR Amount if FCCY is not equal to TR ccy                                     194864
      *                                                                                       194864
     C                     MOVE *BLANKS   TRCCY                                               194864
     C                     Z-ADD0         TRAMT                                               194864
     C           FCCY      IFNE LEFCCY                                                        194864
     C                     MOVE LEFCCY    TRCCY   3                                           194864
     C                     Z-ADDLEFAMT    TRAMT  130                                          194864
     C                     EXSR CONVTR                                                        194864
     C                     ELSE                                                               194864
     C                     Z-ADDLEFAMT    TRFAMT                                              194864
     C                     ENDIF                                                              194864
      *                                                                                       194864
     C                     SUB  TRFAMT    WAMNT                                               194864
     C                     ENDIF                                                              194864
     C                     ENDIF                                                              194864
      *                                                                                       194864
     C**********           READ FCLTYFL9                 05                            194864 CPK015
     C           K#KY10    READEFCLTYFL9                 05                                   CPK015
     C********** LECANM    IFNE K0CANM                                                 194864 CPK015
     C********** LECAFT    ORNE K0CAFT                                                 194864 CPK015
     C********** LECAFN    ORNE K0CAFN                                                 194864 CPK015
     C**********           LEAVE                                                       194864 CPK015
     C**********           ENDIF                                                       194864 CPK015
      *                                                                                       194864
     C                     ENDDO                                                              194864
      *                                                                                       194864
      ** Convert TR amount to CA amount if currencies are                                     194864
      ** different.                                                                           194864
      *                                                                                       194864
     C                     MOVE *BLANKS   TRCCY                                               194864
     C                     Z-ADD0         TRAMT                                               194864
     C                     MOVE 'N'       TRYES                                               194864
     C           WCACCY    IFNE S2FCCY                                                        194864
     C                     MOVE S2FCCY    TRCCY                                               194864
     C                     Z-ADDW#FAMT    TRAMT                                               194864
     C                     EXSR CONVTR                                                        194864
     C                     ELSE                                                               194864
     C                     Z-ADDW#FAMT    TRFAMT                                              194864
     C                     ENDIF                                                              194864
      *                                                                                       194864
      ** Issue a warning message if the TR amount will                                        194864
      ** exceed the CA amount.                                                                194864
      *                                                                                       194864
     C           TRFAMT    IFGT WAMNT                                                         194864
     C           TRFAMT    ANDNEWAMT                                                          194864
     C                     MOVEL'LEF0129' ZAMSID                                              194864
     C                     MOVEL'Y'       W#WARN                                              194864
     C                     ADD  1         W#CNT                                               194864
     C                     MOVE 'Y'       CHGIND  1                                           194864
     C                     EXSR ZASNMS                                                        194864
     C                     MOVE *ON       *IN29                                               194864
     C                     Z-ADDTRFAMT    WAMT                                                194864
     C                     ELSE                                                               194864
     C                     Z-ADD0         WAMT                                                194864
     C                     ENDIF                                                              194864
      *                                                                                       194864
     C                     ENDIF                                                              194864
      *                                                                                       194864
      * The start date for a tranche agreement cannot be before the       132948
      * start date of the credit agreement facility                       132948
      *                                                                   132948
     C           W#DTAP    IFLT DTAP                                      132948
     C                     MOVEL'LEF0127' ZAMSID                          132948
     C                     MOVEL'Y'       W#ERR1                          132948
     C                     EXSR ZASNMS                                    132948
     C                     MOVE *ON       *IN32                           132948
     C                     ENDIF                                          132948
      *                                                                   144532
      * The expiry date for a tranche agreement cannot be after the       144532
      * expiry date of the credit agreement facility                      144532
      *                                                                   144532
     C           W#DTEX    IFGT DTEX                                      144532
     C                     MOVEL'LEF0130' ZAMSID                          144532
     C                     MOVEL'Y'       W#ERR1                          144532
     C                     EXSR ZASNMS                                    144532
     C                     MOVE *ON       *IN36                           144532
     C                     ENDIF                                          144532
     C                     ENDIF                                          132948
      *                                                                   CLE005
      **  Chain to FCLTY to obtain original record                        CLE005
      *                                                                   CLE005
     C                     MOVE 'A'       K3RCTP                          CLE005
     C                     MOVE S2CNUM    K3CNUM                          CLE005
     C                     MOVE S1FACT    K3FACT                          CLE005
     C                     MOVE S1FCNO    K3FCNO                          CLE005
     C           K#KY03    CHAINFCLTY               N80                   CLE005
     C                     MOVE TNLU      W#TNLU                          CLE005
     C                     MOVE 'B'       K3RCTP                          CLE005
     C           K#KY03    CHAINFCLTY               N80                   CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ELSE                                           CLE005
      *                                                                   CLE005
     C           S3CANM    IFNE *BLANKS                                   CLE005
     C                     MOVE 'LEF0265' ZAMSID                          CLE005
     C***********          MOVEL'Y'       W#ERR2                   CLE005 128952
     C                     MOVEL'Y'       W#ERR1                   CLE005 128952
     C                     EXSR ZASNMS                                    CLE005
     C                     MOVE '1'       *IN73                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C           S3CAFT    IFNE *BLANKS                                   CLE005
     C                     MOVE 'LEF0267' ZAMSID                          CLE005
     C***********          MOVEL'Y'       W#ERR2                   CLE005 128952
     C                     MOVEL'Y'       W#ERR1                   CLE005 128952
     C                     EXSR ZASNMS                                    CLE005
     C                     MOVE '1'       *IN74                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C           S3CAFN    IFNE *BLANKS                                   CLE005
     C                     MOVE 'LEF0269' ZAMSID                          CLE005
     C***********          MOVEL'Y'       W#ERR2                   CLE005 128952
     C                     MOVEL'Y'       W#ERR1                   CLE005 128952
     C                     EXSR ZASNMS                                    CLE005
     C                     MOVE '1'       *IN75                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     MOVE *BLANKS   CACY                            CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      **  Check if Manual Fac. is attached to credit agreement's tranche  189577
      *   before allowing amend from '  ' to 'TR' or from 'TR' to '  '    189577
     C           W#ERR1    IFNE 'Y'                                       189577
     C           *IN72     IFEQ *OFF                                      189577
     C           S3TRCA    ANDNETRCASV                                    189577
     C           TRCA      IFEQ '  '                                      189577
     C           S3TRCA    ANDEQ'TR'                                      189577
     C           S1ACTN    ANDNE'I'                                       189577
     C           TRCA      OREQ 'TR'                                      189577
     C           S3TRCA    ANDEQ'  '                                      189577
     C           S1ACTN    ANDNE'I'                                       189577
     C**********           Z-ADDCNUM      K8CNUM                                       189577 CSD027
     C                     MOVE CNUM      K8CNUM                                              CSD027
     C                     Z-ADDFACT      K8FACT                          189577
     C                     Z-ADDFCNO      K8FCNO                          189577
     C           K#KY08    CHAINLEMNFUL6             80                   189577
     C           *IN80     IFEQ '0'                                       189577
     C                     MOVE '1'       *IN72                           189577
     C                     MOVEL'LEF0323' ZAMSID                          189577
     C                     MOVEL'Y'       W#WARN                          189577
     C                     ADD  1         W#CNT                           189577
     C                     MOVE 'Y'       CHGIND  1                       189577
     C                     EXSR ZASNMS                                    189577
     C                     ENDIF                                          189577
     C                     ENDIF                                          189577
     C                     ENDIF                                          189577
     C                     MOVE S3TRCA    TRCASV                          189577
     C                     ENDIF                                          189577
      *                                                                   189577
     C                     ENDSR                                          CLE005
      /EJECT                                                              CLE005
      ***********************************************************         CLE005
      *  VLDEXC :   Validate Exchange Rate/Indicator                      CLE005
      ***********************************************************         CLE005
     C           VLDEXC    BEGSR                                          CLE005
      *                                                                   CLE005
     C                     MOVE '0'       *IN70                           CLE005
     C                     MOVE '0'       *IN71                           CLE005
      *                                                                   CLE005
      **  Must only be validated and entered if Tranche                   CLE005
      *                                                                   CLE005
     C           S3TRCA    IFEQ 'TR'                                      CLE005
      *                                                                   194508
      ** Validate first if the entered exchange rate is numeric           194508
      *                                                                   194508
     C           S3CAXR    IFNE *BLANKS                                   194508
     C                     MOVE *BLANKS   ZFIELD                          194508
     C                     MOVE S3CAXR    ZFIELD                          194508
     C                     Z-ADD8         ZADEC                           194508
     C                     Z-ADD5         ZADIG                           194508
     C                     EXSR ZALIGN                                    194508
     C           *IN99     IFEQ *ON                                       194508
     C                     MOVEL'LEF0352' ZAMSID                          194508
     C                     MOVEL'Y'       W#ERR2                          194508
     C                     EXSR ZASNMS                                    194508
     C                     MOVE *ON       *IN70                           194508
     C                     ENDIF                                          194508
     C                     ENDIF                                          194508
      *                                                                   133402
      * Need to obtain the correct cross rate between CA and TR           133402
      * Credit Facility currency                                          133402
      *  Use previously saved value of the Credit Agreement currency      171759
     C************         MOVELFCCY      WCURR   3                133402 171759
     C           W#ERR2    IFNE 'Y'                                       194508
     C                     MOVELWCACCY    WCURR   3                       171759
     C                     EXSR SRCURR                                    133402
     C                     MOVE A6MDIN    WMDIN   1                       133402
     C                     Z-ADDA6SPRT    WSPRT  138                      133402
      *                                                                   133402
      * Tranche Facility currency                                         133402
     C                     MOVELS2FCCY    WCURR                           133402
     C                     EXSR SRCURR                                    133402
     C                     Z-ADDA6NBDP    WNBDP   10                      133402
     C                     MOVE A6MDIN    ZMDI1   1                       133402
     C                     Z-ADDA6SPRT    ZRATE1 138                      133402
     C                     MOVE WMDIN     ZMDI2   1                       133402
     C                     Z-ADDWSPRT     ZRATE2 138                      133402
     C                     EXSR ZXRATE                                    133402
      *                                                                   133402
     C                     Z-ADDZRATEX    WSPOT  138                      133402
      *                                                                   CLE005
      **  Determine cross rate and mult/div indicator                     CLE005
      *                                                                   CLE005
     C                     Z-ADDA6SPRT    WSVRT  138                      CLE005
     C***********          MOVE A6MDIN    WSVIN   1                 CLE005133402
     C                     Z-ADDA6NBDP    WCDPF   10                      CLE005
      *                                                                   CLE005
     C***********WSVIN     IFEQ 'M'                                 CLE005133402
     C***********          MOVE 'D'       WMINX   1                 CLE005133402
     C***********          ELSE                                     CLE005133402
     C***********          MOVE 'M'       WMINX                     CLE005133402
     C***********          ENDIF                                    CLE005133402
      *                                                                   CLE005
     C***********A6MDIN    IFEQ 'M'                                 CLE005133402
     C***********WSVIN     ANDEQ'M'                                 CLE005133402
     C***********A6MDIN    OREQ 'D'                                 CLE005133402
     C***********WSVIN     ANDEQ'D'                                 CLE005133402
     C***********A6SPRT    DIV  WSVRT     WSPOT  138H               CLE005133402
     C***********          ELSE                                     CLE005133402
     C***********A6SPRT    MULT WSVRT     WSPOT     H               CLE005133402
     C***********          ENDIF                                    CLE005133402
      *                                                                   CLE005
      **  Validate Credit/Agreement Exchange Rate Indicator               CLE005
      *                                                                   CLE005
     C           S3CMDI    IFEQ *BLANKS                                   CLE005
     C           *IN73     ANDNE'1'                                       CLE005
     C           S3CMDI    OREQ *BLANKS                                   CLE005
     C           *IN74     ANDNE'1'                                       CLE005
     C           S3CMDI    OREQ *BLANKS                                   CLE005
     C           *IN75     ANDNE'1'                                       CLE005
      *                                                                   CLE005
      **  Default to the Cross Rate Indicator if blank                    CLE005
      *                                                                   CLE005
     C***********          MOVE WMINX     S3CMDI                    CLE005133402
     C                     MOVE ZMDIX     S3CMDI                          133402
     C                     ELSE                                           CLE005
      *                                                                   CLE005
      **  Must be either 'M' or 'D' if entered                            CLE005
      *                                                                   CLE005
     C           S3CMDI    IFNE 'M'                                       CLE005
     C           S3CMDI    ANDNE'D'                                       CLE005
     C                     MOVE '1'       *IN71                           CLE005
     C                     MOVEL'LEF0262' ZAMSID                          CLE005
     C                     MOVEL'Y'       W#ERR2                          CLE005
     C                     EXSR ZASNMS                                    CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      **  Validate Credit/Agreement Exchange Rate                         CLE005
      *                                                                   CLE005
     C           S3CAXR    IFEQ *BLANK                                    CLE005
     C           *IN73     ANDNE'1'                                       CLE005
     C           S3CAXR    OREQ *BLANKS                                   CLE005
     C           *IN74     ANDNE'1'                                       CLE005
     C           S3CAXR    OREQ *BLANKS                                   CLE005
     C           *IN75     ANDNE'1'                                       CLE005
     C                     MOVE WSPOT     WSVFX                           CLE005
     C                     MOVE *BLANKS   ZFIELD                          CLE005
     C                     MOVE WSPOT     ZFIELD                          CLE005
     C                     Z-ADD8         ZADEC                           CLE005
     C                     EXSR ZEDIT                                     CLE005
     C                     MOVE ZFIELD    S3CAXR                          CLE005
     C                     ELSE                                           CLE005
     C                     MOVE *BLANKS   ZFIELD                          CLE005
     C                     MOVE S3CAXR    ZFIELD                          CLE005
     C                     Z-ADD8         ZADEC                           CLE005
     C                     Z-ADD5         ZADIG                           CLE005
     C                     EXSR ZALIGN                                    CLE005
     C                     MOVE ZFIELD    WSVFX  138                      CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     MOVE S3CANM    K1CNUM                          CLE005
     C                     MOVE S3CAFT    K1FACT                          CLE005
     C                     MOVE S3CAFN    K1FCNO                          CLE005
      *                                                                   CLE005
     C           K#KY01    CHAINFCLTY                80                   CLE005
     C           *IN80     IFEQ '0'                                       CLE005
     C                     MOVE FCCY      W#CACY  3                       CLE005
     C********** FCCY      IFEQ S#FCCY                                    CLE005              192057
     C           FCCY      IFEQ S2FCCY                                                        192057
     C                     MOVE *BLANKS   ZFIELD                          CLE005
     C**********           MOVE 1         ZFIELD                          CLE005              192057
     C                     Z-ADD1         WDCAXR 138                                          192057
     C                     MOVE WDCAXR    ZFIELD                                              192057
     C                     Z-ADD8         ZADEC                           CLE005
     C                     EXSR ZEDIT                                     CLE005
     C                     MOVE ZFIELD    S3CAXR                          CLE005
     C                     ELSE                                           CLE005
      *                                                                   CLE005
      **  Check that the Exchange Rate is within 25% of Cross Rate        CLE005
      *                                                                   CLE005
     C***********S3CMDI    IFNE WMINX                               CLE005133402
     C           S3CMDI    IFNE ZMDIX                                     133402
     C           1         DIV  WSPOT     WSPOT     H                     CLE005
     C                     ENDIF                                          CLE005
     C           WSPOT     MULT 0.75      WRATM  138H                     CLE005
     C***********WSPOT     MULT 1.75      WRATP  138H               CLE005133402
     C           WSPOT     MULT 1.25      WRATP  138H                     133402
      *                                                                   CLE005
     C********** WSVFX     IFNE WSVFY                               CLE005190134
     C**********           Z-ADD0         W#CNT2                    CLE005190134
     C**********           ENDIF                                    CLE005190134
      *                                                                   CLE005
     C           WSVFX     IFLE WRATM                                     CLE005
     C           WSVFX     ORGT WRATP                                     CLE005
     C           W#CNT2    IFLT 1                                         CLE005
     C                     MOVE '1'       *IN70                           CLE005
     C                     MOVEL'LEF0263' ZAMSID                          CLE005
     C                     MOVEL'Y'       W#WRN2                          CLE005
     C                     EXSR ZASNMS                                    CLE005
     C                     ENDIF                                          CLE005
     C                     ADD  1         W#CNT2                          CLE005
     C                     Z-ADDWSVFX     WSVFY  138                      CLE005
     C                     ELSE                                           CLE005
     C                     MOVE *BLANKS   ZFIELD                          CLE005
     C                     MOVE WSVFX     ZFIELD                          CLE005
     C                     Z-ADD8         ZADEC                           CLE005
     C                     EXSR ZEDIT                                     CLE005
     C                     MOVE ZFIELD    S3CAXR                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                                       194864
      ** Validate if Tranche ccy is different from Credit Agreement ccy                       202011
      ** and action is not 'X' (if Authorising, or if the two ccys                            202011
      **  are the same, this was already validated on first screen)                           202011
      *                                                                                       194864
     C           S2FCCY    IFNE FCCY                                                          194864
     C           S1ACTN    ANDNE'X'                                                           202011
      *                                                                                       202011
      * The Tranche agreement facility amount cannot exceed the           189572
      * amount for the Credit Agreement.                                  189572
      *                                                                   189572
     C                     Z-ADDFAMT      WAMNT  130                      189572
     C                     MOVE S3CANM    K0CANM                          189572
     C                     MOVE S3CAFT    K0CAFT                          189572
     C                     MOVE S3CAFN    K0CAFN                          189572
     C                     MOVE 'N'       TRYES                                               194864
      *                                                                   189572
      * Access all existing Tranches for the Credit Agreement             189572
      *                                                                   189572
     C           *LOVAL    SETLLFCLTYFL9                                  189572
     C           K#KY10    CHAINFCLTYFL9             05                   189572
      *                                                                   189572
     C           *IN05     DOWEQ'0'                                       189572
      *                                                                   189572
     C           LERECI    IFEQ 'D'                                       189572
     C                     MOVE LECNUM    WCUST   6                                           194864
     C                     MOVE LEFACT    WFACT   3                       189572
     C                     MOVE LEFCNO    WFCNO   2                       189572
     C                     MOVE 'Y'       TRYES   1                                           194864
      *                                                                   189572
      * Subtract Tranche amount from (remaining) Credit Agreement amount  189572
      *                                                                   189572
     C********** S1ACTN    IFEQ 'I'                                                    189572 194864
     C********** S1ACTN    ORNE 'I'                                                    189572 194864
     C********** WFACT     ANDNES1FACT                                                 189572 194864
     C********** WFCNO     ANDNES1FCNO                                                 189572 194864
     C********** S1ACTN    ORNE 'I'                                                    189572 194864
     C********** WFACT     ANDEQS1FACT                                                 189572 194864
     C********** WFCNO     ANDNES1FCNO                                                 189572 194864
     C********** S1ACTN    ORNE 'I'                                                    189572 194864
     C********** WFACT     ANDNES1FACT                                                 189572 194864
     C********** WFCNO     ANDEQS1FCNO                                                 189572 194864
      *                                                                                       194864
     C           S1CUST    IFNE WCUST                                                         194864
     C           WFACT     ORNE S1FACT                                                        194864
     C           WFCNO     ORNE S1FCNO                                                        194864
      *                                                                   189572
      * Straight subtraction if currencies are the same                   189572
      *                                                                   189572
     C           LEFCCY    IFEQ FCCY                                      189572
     C                     SUB  LEFAMT    WAMNT                           189572
      *                                                                   189572
      * Else convert to Credit Agreement currency before subtracting      189572
      *                                                                   189572
     C                     ELSE                                           189572
     C********** LECMDI    IFEQ 'M'                                                    189572 194864
     C********** LEFAMT    MULT LECAXR    WTAMT  130                                   189572 194864
     C**********           ELSE                                                        189572 194864
     C********** LEFAMT    DIV  LECAXR    WTAMT                                        189572 194864
     C**********           ENDIF                                                       189572 194864
     C**********           SUB  WTAMT     WAMNT                                        189572 194864
     C                     MOVE LEFCCY    TRCCY   3                                           194864
     C                     Z-ADDLEFAMT    TRAMT  130                                          194864
     C                     EXSR CONVTR                                                        194864
     C                     SUB  TRFAMT    WAMNT                                               194864
     C                     ENDIF                                          189572
     C                     ENDIF                                          189572
     C                     ENDIF                                          189572
      *                                                                                       194864
     C                     MOVE *BLANKS   TRCCY                                               194864
     C                     Z-ADD0         TRAMT                                               194864
     C                     MOVE 'N'       TRYES                                               194864
      *                                                                   189572
     C                     READ FCLTYFL9                 05               189572
     C           LECANM    IFNE K0CANM                                    189572
     C           LECAFT    ORNE K0CAFT                                    189572
     C           LECAFN    ORNE K0CAFN                                    189572
     C                     LEAVE                                          189572
     C                     ENDIF                                          189572
     C                     ENDDO                                          189572
      *                                                                   189572
      * Convert amount of this Tranche if necessary before comparing      189572
      * with remaining Credit Agreement amount.                           189572
      *                                                                   189572
     C********** S#FCCY    IFEQ FCCY                                                   189572 194864
     C**********           Z-ADDW#FAMT    WTAMT                                        189572 194864
     C**********           ELSE                                                        189572 194864
     C********** S3CMDI    IFEQ 'M'                                                    189572 194864
     C********** W#FAMT    MULT WSVFX     WTAMT                                        189572 194864
     C**********           ELSE                                                        189572 194864
     C********** W#FAMT    DIV  WSVFX     WTAMT                                        189572 194864
     C**********           ENDIF                                                       189572 194864
     C                     MOVE S2FCCY    TRCCY                                               194864
     C                     Z-ADDW#FAMT    TRAMT                                               194864
     C                     EXSR CONVTR                                                        194864
     C                     Z-ADDTRFAMT    WTAMT  130                                          194864
     C**********           ENDIF                                                       189572 194864
     C           WTAMT     IFGT WAMNT                                     189572
     C********** WTAMT     ANDNEWAMT                                                   189572 194864
     C           W#FAMT    ANDNEWAMT                                                          194864
     C                     MOVEL'LEF0129' ZAMSID                          189572
     C                     MOVEL'Y'       W#WRN2                          189572
     C                     ADD  1         W#CNT2                          189572
     C                     MOVE 'Y'       CHGIND  1                       189572
     C                     EXSR ZASNMS                                    189572
     C                     MOVE *ON       *IN70                           189572
     C                     Z-ADDW#FAMT    WAMT                                                194864
     C                     ELSE                                                               194864
     C                     Z-ADD0         WAMT                                                194864
     C                     ENDIF                                          189572
     C                     Z-ADDW#FAMT    WAMT                            189572
      *                                                                                       194864
     C                     ENDIF                                                              194864
      *                                                                   CLE005
      **  Chain to FCLTY to obtain original record                        CLE005
      *                                                                   CLE005
     C                     MOVE 'A'       K3RCTP                          CLE005
     C                     MOVE S2CNUM    K3CNUM                          CLE005
     C                     MOVE S1FACT    K3FACT                          CLE005
     C                     MOVE S1FCNO    K3FCNO                          CLE005
     C           K#KY03    CHAINFCLTY               N80                   CLE005
     C           *IN80     IFEQ *ON                                       134031
     C                     MOVE *BLANKS   PRTR                            134031
     C                     MOVE *BLANKS   SYIN                            134031
     C                     ENDIF                                          134031
     C                     MOVE TNLU      W#TNLU                          CLE005
     C                     MOVE 'B'       K3RCTP                          CLE005
     C           K#KY03    CHAINFCLTY               N80                   CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          194508
      *                                                                   CLE005
     C                     ELSE                                           CLE005
      *                                                                   CLE005
      **  Credit Agreement Exchange Rate and Indicator must only be       CLE005
      **  entered for a tranche                                           CLE005
      *                                                                   CLE005
     C           S3CAXR    IFNE *BLANKS                                   CLE005
     C                     MOVE 'LEF0274' ZAMSID                          CLE005
     C                     MOVEL'Y'       W#ERR2                          CLE005
     C                     EXSR ZASNMS                                    CLE005
     C                     MOVE '1'       *IN70                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C           S3CMDI    IFNE *BLANKS                                   CLE005
     C                     MOVE 'LEF0275' ZAMSID                          CLE005
     C                     MOVEL'Y'       W#ERR2                          CLE005
     C                     EXSR ZASNMS                                    CLE005
     C                     MOVE '1'       *IN71                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDSR                                          CLE005
      /EJECT                                                              CLE005
      ***********************************************************         CLE005
      *  UPDFLE :   Update files
      ***********************************************************
     C           UPDFLE    BEGSR
      *
      ** Record Mode 'R'
      ** ~~~~~~~~~~~~~~~
     C           P#MODE    IFEQ 'R'
      *
      **  Write the contents of the detail screen.
     C                     Z-ADDRUND      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     WDATE
     C                     MOVE WDAT1     WTDT1
     C                     MOVE WDAT2     WTDT2
     C                     MOVE WDAT3     WTDT3
      *
     C                     TIME           WTIME
     C                     MOVE WTIM1     WTTM1
     C                     MOVE WTIM2     WTTM2
     C                     MOVE WTIM3     WTTM3
      *
     C                     WRITELE2020D0
      *
     C                     ENDIF
      *
     C                     MOVE 'N'       W#ERR3  1
     C                     MOVE 'N'       W#ERR5                          161256
      *
      ** Save facility amount before updating it to use in updating
      ** trailer
     C           *LIKE     DEFN FAMT      W#SAVF
     C                     Z-ADDFAMT      W#SAVF
      *
     C                     SELEC
      **  Write facility record
     C           S1ACTN    WHEQ 'I'
     C                     EXSR WRITER
      **  Update facility record
     C           S1ACTN    WHEQ 'A'
     C                     EXSR AMENDR
      **  Authorise facility
     C           S1ACTN    WHEQ 'X'
     C                     EXSR AUTHOR
      **  Reverse facility
     C           S1ACTN    WHEQ 'R'
     C                     EXSR REVESR
      *
      **  Close facility
     C           S1ACTN    WHEQ 'C'
     C                     EXSR CLOSER
     C                     ENDSL
      *
      **  Update trailer
     C           W#ERR3    IFNE 'Y'
     C           W#ERR5    ANDNE'Y'                                       120720
     C                     EXSR UPDTRL
     C                     ENDIF
      *
      ** Commit the database changes
     C           P#MODE    IFNE 'B'
     C           W#ERR5    ANDNE'Y'                                       120525
     C           W#ERR3    ANDNE'Y'                                       120720
     C                     COMIT
     C                     ENDIF
      *
      * If Support System active, write transaction to 24x7 log           CSC011
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C*                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
      *                                                                   CSC011
      * Convert facility to LEF1MF format                                 CSC011
     C                     EXSR LOG247                                    CSC011
      *                                                                   CSC011
      * Write valid facility in LEF1MF format to 24x7 Log File            CSC011
     C                     MOVE 'V'       LOGVAL  1                       CSC011
     C                     EXSR APLGTR                                    CSC011
     C                     COMIT                                          CSC011
      *                                                                   CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
      **  Move to previous screen
     C                     MOVE *ON       *INKL
     C                     MOVE 'Y'       W#UPOK
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  WRITER :   Write a facility record
      ***********************************************************
     C           WRITER    BEGSR
      *                                                                                       192130
      **  Clear message queue and reset error indicator                                       192130
      *                                                                                       192130
     C           CLE005    IFEQ 'Y'                                                           192130
     C           W#WRN2    ANDEQ'Y'                                                           192130
     C                     EXSR CLEARM                                                        192130
     C                     WRITE#MSGCTL                    Messages                           192130
     C                     MOVE '0'       *IN70                                               192130
     C                     ENDIF                                                              192130
      *
      **  Write record type 'A'
      *
      ** Determine Facility Sequence number if not entered.                                   257155
      *                                                                                       257155
     C           S1FCNO    IFEQ *BLANKS                                                       257155
      *                                                                                       257155
      **   Facility sequence number
     C                     MOVE S2CNUM    K6CNUM
     C                     MOVE S1FACT    K6FACT
     C                     Z-ADD1         K6FCNO                          120525
     C                     MOVE 'N'       W#EXIT  1                       120525
     C                     MOVE 'N'       W#ERR5  1                       120525
     C***********K#KY06    SETLLFCLTY                    80               120525
     C************IN80     IFEQ *OFF                                      120525
     C************LIKE     DEFN FCNO      W#FCNO                          120525
     C***********          Z-ADD0         W#FCNO                          120525
     C***********          ELSE                                           120525
     C***********K#KY06    SETGTFCLTY                                     120525
     ************K#KY06    REDPEFCLTY               N    80               120525
     C***********          Z-ADDFCNO      W#FCNO                          120525
     C***********          ENDIF                                          120525
      *                                                                   120525
     C           K#KY06    SETLLFCLTY                    80               120525
     C           W#EXIT    DOWNE'Y'                                       120525
      *                                                                   120525
     C           *IN80     IFEQ *OFF                                      120525
     C                     MOVE 'Y'       W#EXIT                          120525
     C                     ELSE                                           120525
     C           K6FCNO    IFNE 99                                        120525
     C                     ADD  1         K6FCNO                          120525
     C           K#KY06    SETLLFCLTY                    80               120525
     C                     ELSE                                           120525
     C                     MOVE 'Y'       W#EXIT                          120525
     C                     MOVE 'Y'       W#ERR5                          120525
     C                     ENDIF                                          120525
     C                     ENDIF                                          120525
      *                                                                   120525
     C                     ENDDO                                          120525
      *                                                                   120525
     C                     ENDIF                                                              257155
      *                                                                                       257155
     C                     MOVE *OFF      *IN80
      *
     C           W#ERR5    IFEQ 'N'                                       120525
     C***********W#FCNO    ADD  1         FCNO                            120525
     C                     Z-ADDK6FCNO    FCNO                            120525
     C                     MOVE 'D'       RECI
     C                     MOVE 'A'       RCTP
     C                     MOVE S2CNUM    CNUM
     C                     MOVE S1FACT    FACT
     C           P#MODE    IFEQ 'B'
     C                     MOVE F1IUSR    IUSR
     C                     MOVE F1XUSR    XUSR
     C                     MOVE F1AUSR    AUSR
     C                     MOVE 'A'       FSTS
     C/COPY WNCPYSRC,LE2020C027
     C                     ELSE
     C                     MOVE ##USR     IUSR
     C           CLE002    IFEQ 'N'                                       120881
     C           BPFAAU    OREQ 'N'                                       165960
     C                     MOVE 'A'       FSTS                            120881
     C                     ELSE                                           120881
     C                     MOVE 'C'       FSTS
     C                     ENDIF                                          120881
     C                     ENDIF
      *
     C                     EXSR LOADFM
      *
     C                     EXSR INITFM
      *
     C                     MOVEASTAMP,1   FMSTMP           Default Timestamp                  CPK015
     C                     WRITEFCLTYFMF
      *
      **  Write record type 'B'
     C                     MOVE 'B'       RCTP
      *
     C                     EXSR LOADFN
      *
     C                     EXSR INITFN
      *
     C                     MOVEASTAMP,1   FNSTMP           Default Timestamp                  CPK015
     C                     WRITEFCLTYFNF
      *
     C           P#MODE    IFEQ 'I'
     C           P#MODE    OREQ 'R'
     C                     MOVEL'LEF0102' ZAMSID
     C                     MOVELCNUM      D#CNUM                          119925
     C                     MOVELFACT      D#FACT                          119925
     C***********          MOVELFCNO      D#FCNO                   119955 120525
     C                     MOVE K6FCNO    D#FCNO                          120525
     C                     MOVELFCTMSG    ZAMSDA                          119925
     C                     EXSR ZASNMS
     C                     ENDIF
     C/COPY WNCPYSRC,LE2020C012
      *
      **  Rebuild subfile
     C                     MOVE 'Y'       W#RBLD
     C                     ELSE                                           120525
     C                     MOVEL'LEF0110' ZAMSID                          120525
     C                     EXSR ZASNMS                                    120525
     C                     ENDIF                                          120525
      *
     C           P#MODE    IFEQ 'F'                                       CAP065
     C           XREPN     CHAINLEIFACDL             99                   CAP065
     C                     DELETLEIFACDL                                  CAP065
     C                     MOVEL'LEF0354' W#SMSG  7                       CAP065
     C                     MOVELK6CNUM    D#CNUM                          CAP065
     C                     MOVELK6FACT    D#FACT                          CAP065
     C                     MOVE K6FCNO    D#FCNO                          CAP065
     C                     MOVELFCTMSG    ZAMSDA                          CAP065
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     EXSR LOGDEL                                    CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     ENDIF                                          CAP065
     C*                                                                   CAP065
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  AMENDR :   Amend a facility record
      ***********************************************************
     C           AMENDR    BEGSR
      *                                                                   CLE005
      **  Clear message queue and reset error indicator                   CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C********** CLE006    ANDEQ'Y'                                                    CLE005 192130
     C           W#WRN2    ANDEQ'Y'                                       CLE005
     C                     EXSR CLEARM                                    CLE005
     C                     WRITE#MSGCTL                    Messages       CLE005
     C                     MOVE '0'       *IN70                           CLE005
     C                     ENDIF                                          CLE005
      *
     C                     MOVE S2CNUM    K3CNUM
     C                     MOVE S1FACT    K3FACT
     C                     MOVE S1FCNO    K3FCNO
     C                     MOVE 'A'       K3RCTP
      *
     C           K#KY03    CHAINFCLTY                80
      *
     C           P#MODE    IFEQ 'B'
     C           P#MODE    OREQ 'R'
     C                     MOVE TNLU      W#TNLU
     C                     ENDIF
      *
      ** Determine if record has been updated by another workstation
     C           *IN80     IFEQ *OFF
     C           W#TNLU    ANDEQTNLU
     C           *IN80     OREQ *OFF                                      CAP065
     C           P#MODE    ANDEQ'F'                                       CAP065
      *
     C           P#MODE    IFEQ 'B'
      *
     C                     MOVE F1AUSR    AUSR
     C                     MOVE F1XUSR    XUSR
     C                     MOVE 'A'       FSTS
      *
     C                     ELSE
      *
     C                     MOVE ##USR     AUSR
     C                     MOVE *BLANKS   XUSR
      *
     C           CLE002    IFEQ 'N'                                       120881
     C           BPFAAU    OREQ 'N'                                       165960
     C                     MOVE 'A'       FSTS                            120881
     C                     ELSE                                           120881
     C           FSTS      IFEQ 'A'
     C                     MOVE 'R'       FSTS
     C                     ENDIF
     C                     ENDIF                                          120881
      *
     C                     ENDIF
      *
     C                     EXSR LOADFM
      *
     C                     UPDATFCLTYFMF
      *
      **  Check for the existence of funding participant/internal
      **  facilities, if any are found, update the expiry dates on
      **  these with the value of the prime facility
      **  also update them with multi-ccy indicator                       158019
      **  Also update the loan adminstrator id                            CLE008
      *                                                                   CLE008
      * Key K#KY10 set up for use after the read of LEFCLTL2              CLE008
      *                                                                   CLE008
     C                     MOVE CNUM      K0CANM                          CLE008
     C                     MOVE FACT      K0CAFT                          CLE008
     C                     MOVE FCNO      K0CAFN                          CLE008
      *                                                                   CLE008
     C           SYIN      IFEQ 'Y'
      *
     C                     MOVE BRCA      K4BRCA
     C                     MOVE CNUM      K4CNUM
     C                     MOVE FACT      K4FACT
     C                     MOVE FCNO      K4FCNO
     C           *LIKE     DEFN FAMT      W@FAMT
     C                     Z-ADDFAMT      W@FAMT
      *
     C           K#KY04    CHAINLEFCLTL2             80
     C           *IN80     DOWEQ*OFF
     C                     MOVE W#DTEX    DTEX
     C                     MOVE W#AVLD    AVLD                            149922
     C                     MOVE S2MCCY    MCCY                            158019
      *                                                                   CLE008
     C           CLE008    IFEQ 'Y'                                       CLE008
     C                     MOVE S3LAID    LAID                            CLE008
     C                     ENDIF                                          CLE008
      *                                                                   CLE008
     C                     UPDATFCLTYFL2
     C           K#KY04    READELEFCLTL2                 80
     C                     ENDDO
      *
     C                     Z-ADDW@FAMT    FAMT
     C                     ENDIF
      *                                                                   CLE008
      ** If amended on Credit Agreement Facility, it must update all      CLE008
      ** associated Tranches with the same value                          CLE008
      *                                                                   CLE008
     C           P#MODE    IFNE 'B'                                       CLE008
     C           CLE008    IFEQ 'Y'                                       CLE008
     C           TRCA      ANDEQ'CA'                                      CLE008
     C           K#KY10    CHAINLEFCLTL9             80                   CLE008
     C           *IN80     DOWEQ*OFF                                      CLE008
     C                     MOVE S3LAID    LAID                            CLE008
     C                     UPDATFCLTYFL9                                  CLE008
     C           K#KY10    READELEFCLTL9                 80               CLE008
     C                     ENDDO                                          CLE008
     C                     ENDIF                                          CLE008
     C                     ENDIF                                          CLE008
      *
     C                     MOVE 'B'       K3RCTP
      *
     C           K#KY03    CHAINFCLTY                80
      *
     C                     EXSR LOADFN
     C                     UPDATFCLTYFNF
      *
     C           P#MODE    IFEQ 'I'
     C           P#MODE    OREQ 'R'
     C                     MOVEL'LEF0101' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      **  Rebuild subfile
     C                     MOVE 'Y'       W#RBLD
      *
     C                     ELSE
      *
     C                     MOVE 'Y'       W#ERR3
     C                     MOVEL'LEP0026' ZAMSID
     C*                                                                   CAP065
     C           P#MODE    IFEQ 'F'                                       CAP065
     C* Facility not found in facility file                               CAP065
     C                     MOVEL'LER0153' ZAMSID                          CAP065
     C                     MOVE 'Y'       W#NOFC  1                       CAP065
     C                     ENDIF                                          CAP065
     C*                                                                   CAP065
     C                     EXSR ZASNMS
      *
     C                     ENDIF
      *
     C           P#MODE    IFEQ 'F'                                       CAP065
     C           W#NOFC    ANDNE'Y'                                       CAP065
     C           XREPN     CHAINLEIFACDL             99                   CAP065
     C                     DELETLEIFACDL                                  CAP065
     C                     MOVEL'LEF0353' W#SMSG  7                       CAP065
     C                     MOVE CNUM      D#CNUM                          CAP065
     C                     MOVE FACT      D#FACT                          CAP065
     C                     MOVE FCNO      D#FCNO                          CAP065
     C                     MOVELFCTMSG    ZAMSDA                          CAP065
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     EXSR LOGDEL                                    CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     ENDIF                                          CAP065
      *                                                                   CAP065
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  AUTHOR :   Authorise facility
      ***********************************************************
     C           AUTHOR    BEGSR
      *
     C                     MOVE S2CNUM    K3CNUM
     C                     MOVE S1FACT    K3FACT
     C                     MOVE S1FCNO    K3FCNO
     C                     MOVE 'A'       K3RCTP
      *
     C           K#KY03    CHAINFCLTY                80
      *
     C           P#MODE    IFEQ 'B'
     C           P#MODE    OREQ 'R'
     C                     MOVE TNLU      W#TNLU
     C                     ENDIF
      *
      ** Determine if record has been updated by another workstation
     C           *IN80     IFEQ *OFF
     C           W#TNLU    ANDEQTNLU
      *
     C           P#MODE    IFEQ 'B'
     C                     MOVE F1XUSR    XUSR
     C                     ELSE
     C                     MOVE ##USR     XUSR
     C                     ENDIF
      *
     C                     MOVE 'A'       FSTS
      *
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      TNLU
     C                     Z-ADDBJRDNB    LCD
     C***********          MOVE S1ACTN    CHTP                            122619
     C***********          MOVE CHTP      S1ACTN                   122619 123789
      *
     C                     UPDATFCLTYFMF
      *
     C                     MOVE 'B'       K3RCTP
      *
     C           K#KY03    CHAINFCLTY                80
     C                     Z-ADDNATN      TNLU
     C                     Z-ADDBJRDNB    LCD
     C***********          MOVE S1ACTN    CHTP                            122619
     C***********          MOVE CHTP      S1ACTN                   122619 123789
      *
     C                     UPDATFCLTYFNF
      *
     C           P#MODE    IFEQ 'I'
     C           P#MODE    OREQ 'R'
     C                     MOVEL'LEF0103' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      **  Rebuild subfile
     C                     MOVE 'Y'       W#RBLD
      *
     C                     ELSE
      *
     C                     MOVE 'Y'       W#ERR3
     C                     MOVEL'LEP0026' ZAMSID
     C                     EXSR ZASNMS
      *
     C                     ENDIF
      *
     C/COPY WNCPYSRC,LE2020C028
     C                     ENDSR
     C/COPY WNCPYSRC,LE2020C029
      /EJECT
      ***********************************************************
      *  REVESR :   Reverse facility
      ***********************************************************
     C           REVESR    BEGSR
      *
      ** Check for funding participants
     C           P#MODE    IFNE 'B'                                       120136
     C                     MOVE S2BRCA    K4BRCA
     C                     MOVE S2CNUM    K4CNUM
     C                     MOVE S1FACT    K4FACT
     C                     MOVE S1FCNO    K4FCNO
     C           K#KY04    CHAINLEFCLTL2            N80
     C           *IN80     DOWEQ*OFF
     C           RECI      IFEQ 'D'
     C                     MOVE 'Y'       W#ERR3
     C                     MOVEL'LEF0109' ZAMSID
     C                     EXSR ZASNMS
     C                     LEAVE
     C                     ENDIF
     C           K#KY04    READELEFCLTL2            N    80
     C                     ENDDO
     C                     ENDIF                                          120136
      *
     C           W#ERR3    IFNE 'Y'
      *
     C                     MOVE S2CNUM    K3CNUM
     C                     MOVE S1FACT    K3FACT
     C                     MOVE S1FCNO    K3FCNO
     C                     MOVE 'A'       K3RCTP
      *
     C           K#KY03    CHAINFCLTY                80
      *
     C           P#MODE    IFEQ 'B'
     C           P#MODE    OREQ 'R'
     C                     MOVE TNLU      W#TNLU
     C                     ENDIF
      *
      ** Determine if record has been updated by another workstation
     C           *IN80     IFEQ *OFF
     C           W#TNLU    ANDEQTNLU
      *
     C                     MOVE 'A'       FSTS
     C                     MOVE 'R'       RECI
      *
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      TNLU
     C                     Z-ADDBJRDNB    LCD
     C                     MOVE S1ACTN    CHTP
      *
     C                     UPDATFCLTYFMF
      *
     C                     MOVE 'B'       K3RCTP
      *
     C           K#KY03    CHAINFCLTY                80
      *
     C                     MOVE 'R'       RECI
     C                     Z-ADDNATN      TNLU
     C                     Z-ADDBJRDNB    LCD
     C                     MOVE S1ACTN    CHTP
      *
     C                     UPDATFCLTYFNF
     C/COPY WNCPYSRC,LE2020C019
      *
     C           P#MODE    IFEQ 'I'
     C           P#MODE    OREQ 'R'
     C                     MOVEL'LEF0099' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      **  Rebuild subfile
     C                     MOVE 'Y'       W#RBLD
      *
     C                     ELSE
      *
     C                     MOVE 'Y'       W#ERR3
     C                     MOVEL'LEP0026' ZAMSID
     C                     EXSR ZASNMS
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  CLOSER :   Close facility
      ***********************************************************
     C           CLOSER    BEGSR
      *
      ** Check for funding participants
     C           P#MODE    IFNE 'B'                                       120136
     C                     MOVE S2BRCA    K4BRCA
     C                     MOVE S2CNUM    K4CNUM
     C                     MOVE S1FACT    K4FACT
     C                     MOVE S1FCNO    K4FCNO
     C           K#KY04    CHAINLEFCLTL2            N80
     C           *IN80     DOWEQ*OFF
     C           RECI      IFEQ 'D'
     C                     MOVE 'Y'       W#ERR3
     C                     MOVEL'LEF0109' ZAMSID
     C                     EXSR ZASNMS
     C                     LEAVE
     C                     ENDIF
     C           K#KY04    READELEFCLTL2            N    80
     C                     ENDDO
     C                     ENDIF                                          120136
      *
      *
     C           W#ERR3    IFNE 'Y'
      *
     C                     MOVE S2CNUM    K3CNUM
     C                     MOVE S1FACT    K3FACT
     C                     MOVE S1FCNO    K3FCNO
     C                     MOVE 'A'       K3RCTP
      *
     C           K#KY03    CHAINFCLTY                80
      *
     C           P#MODE    IFEQ 'B'
     C           P#MODE    OREQ 'R'
     C                     MOVE TNLU      W#TNLU
     C                     ENDIF
      *
      ** Determine if record has been updated by another workstation
     C           *IN80     IFEQ *OFF
     C           W#TNLU    ANDEQTNLU
      *
     C                     MOVE 'A'       FSTS
     C                     MOVE 'C'       RECI
      *
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      TNLU
     C                     Z-ADDBJRDNB    LCD
     C                     MOVE S1ACTN    CHTP
      *
     C                     UPDATFCLTYFMF
      *
     C                     MOVE 'B'       K3RCTP
      *
     C           K#KY03    CHAINFCLTY                80
     C                     MOVE 'C'       RECI
     C                     Z-ADDNATN      TNLU
     C                     Z-ADDBJRDNB    LCD
     C                     MOVE S1ACTN    CHTP
      *
     C                     UPDATFCLTYFNF
     C/COPY WNCPYSRC,LE2020C020
      *
     C           P#MODE    IFEQ 'I'
     C           P#MODE    OREQ 'R'
     C                     MOVEL'LEF0104' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      **  Rebuild subfile
     C                     MOVE 'Y'       W#RBLD
      *
     C                     ELSE
      *
     C                     MOVE 'Y'       W#ERR3
     C                     MOVEL'LEP0026' ZAMSID
     C                     EXSR ZASNMS
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  UPDTRL :
      ***********************************************************
     C           UPDTRL    BEGSR
      *                                                                   186795
     C                     Z-ADD0         ZAMT                            186795
      *
      ** Update the file controls on LF/FCLTY
     C**********           Z-ADD999999    K3CNUM                                              CSD027
     C                     MOVE '999999'  K3CNUM                                              CSD027
     C                     Z-ADD999       K3FACT
     C                     Z-ADD99        K3FCNO
     C                     MOVE 'Z'       K3RCTP
      *
     C           K#KY03    CHAINFCLTY                80
     C           *IN80     IFEQ *ON
     C           *IN80     OREQ *OFF
     C           RECI      ANDNE'T'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE
     C                     Z-ADD6         DBASE
     C                     MOVE K3CNUM    DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     SELEC
      *
      **  Inserts
     C           S1ACTN    WHEQ 'I'
     C                     ADD  2         NORE
     C                     ADD  2         NINS
     C                     ADD  2         NLRA
      *
      ** Set up amount fields
     C           FAMT      DIV  1000      ZZAMT  153
      *
     C                     Z-ADDVRIF      ZZTOTI
     C                     Z-ADDVRIL      ZZTOTD
     C                     EXSR SRZADD
     C                     Z-ADDZZTOTI    VRIF
     C                     Z-ADDZZTOTD    VRIL
      *
      **  Save it to calculate totals
     C                     Z-ADDFAMT      ZAMT   150
      *
      **  Amend
     C           S1ACTN    WHEQ 'A'
      *
     C                     Z-ADDVRAF      ZZTOTI
     C                     Z-ADDVRAL      ZZTOTD
     C           FAMT      SUB  W#SAVF    W#ADJ  150
     C                     MOVE W#ADJ     ZZAMT
     C           W#ADJ     DIV  1000      ZZAMT  153
     C                     EXSR SRZADD
     C                     Z-ADDZZTOTI    VRAF
     C                     Z-ADDZZTOTD    VRAL
      *
     C                     Z-ADDW#ADJ     ZAMT
      *
      **  Close and reversals
     C           S1ACTN    WHEQ 'R'
     C           S1ACTN    OREQ 'C'
      *
      **  Only update number of live recotds
     C           NDEL      ADD  2         NDEL
     C                     SUB  2         NLRA
      *
      ** Set up amount fields
      *                                                                                       193678
     C           W#SAVF    IFLT 0                                                             193678
     C                     Z-SUBW#SAVF    W#SAVF                                              193678
     C                     END                                                                193678
     C           W#SAVF    DIV  1000      ZZAMT  153
      *
     C                     Z-ADDVRDF      ZZTOTI
     C                     Z-ADDVRDL      ZZTOTD
     C                     EXSR SRZADD
     C                     Z-ADDZZTOTI    VRDF
     C                     Z-ADDZZTOTD    VRDL
      *
     C                     Z-SUBW#SAVF    ZAMT
      *
     C                     ENDSL
      *
      ** Calcualte Totals
     C           ZAMT      DIV  1000      ZZAMT
     C                     Z-ADDVLAF      ZZTOTI
     C                     Z-ADDVLAL      ZZTOTD
     C                     EXSR SRZADD
     C                     Z-ADDZZTOTI    VLAF
     C                     Z-ADDZZTOTD    VLAL
      *
     C                     Z-ADDBJRDNB    LCD
     C                     MOVE S1ACTN    CHTP
     C                     Z-ADDNATN      TNLU
     C                     UPDATFCLTYZZF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRZADD   : Adds an amount (ZZAMT) to the total (ZZTOTI,ZZTOTD)*
      *****************************************************************
     C           SRZADD    BEGSR
      *
      ** Split ZZAMT into integer and decimal fields
      *
     C                     Z-ADDZZAMT     ZZAMTI 150
     C                     MOVE ZZAMT     ZZAMTD  30
      *
      ** Both ZZAMTI and ZZAMTD contain a 'sign' zone now
      *
     C                     EXSR SRZSUM
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRZSUM   : Carries out the addition of the amounts            *
      * Called by: SRZADD                                             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRZSUM    BEGSR
      *
      ** Save values of indicators to be used in the program
     C                     MOVE *IN91     WIN91   1
     C                     MOVE *IN92     WIN92   1
     C                     MOVE *IN93     WIN93   1
     C                     MOVE *IN94     WIN94   1
     C                     MOVE *IN95     WIN95   1
     C                     MOVEA'00000'   *IN,91
     C                     MOVE '0'       *IN99
      *
     C                     DO
      *
      ** Determine sign of ZZAMTI and ZZAMTD, 92 IF NEG
      ** If both are zero, bypass processing
      *
     C           ZZAMTI    IFEQ *ZEROS
     C           ZZAMTD    ANDEQ*ZEROS
     C                     LEAVE
     C                     ELSE
     C           ZZAMTI    IFLT *ZEROS
     C           ZZAMTD    ORLT *ZEROS
     C                     MOVE '1'       *IN92
     C                     ENDIF
     C                     ENDIF
      *
      ** Determine sign of ZZTOTI and ZZTOTD, 91 IF NEG.
      ** If ZZTOTAL is ZERO, return ZZAMOUNT.
      *
     C           ZZTOTI    IFEQ *ZEROS
     C           ZZTOTD    ANDEQ*ZEROS
     C                     Z-ADDZZAMTI    ZZTOTI 150
     C                     Z-ADDZZAMTD    ZZTOTD  30
     C                     LEAVE
     C                     ELSE
     C           ZZTOTI    IFLT *ZEROS
     C           ZZTOTD    ORLT *ZEROS
     C                     MOVE '1'       *IN91
     C                     ENDIF
     C                     ENDIF
      *
      ** If signs differ, bypass overflow checks
      *
     C           *IN91     IFEQ '0'
     C           *IN92     ANDEQ'0'
     C           *IN91     OREQ '1'
     C           *IN92     ANDEQ'1'
      *
     C           ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     C           ZZWK2     IFGT 999
     C           ZZWK2     ORLE 999
     C           ZZWK2     ANDLT-999
      *
     C           *IN92     IFEQ '0'
     C           ZZAMTI    ADD  1         ZZWK3  150
     C                     ELSE
     C           ZZAMTI    SUB  1         ZZWK3
     C                     ENDIF
     C           ZZTOTI    ADD  ZZWK3     ZZWK3
      *
     C                     ELSE
     C           ZZTOTI    ADD  ZZAMTI    ZZWK3
     C                     ENDIF
      *
      ** If the modulus of ZZWK3 is less than the modulus of ZZTOTI,
      ** then overflow has occurred
      *
     C           *IN92     IFEQ '0'
     C           ZZWK3     COMP ZZTOTI                 99
     C                     ELSE
     C           ZZWK3     COMP ZZTOTI               99
     C                     ENDIF
      *
      ** If overflow occurs, zeroise ZZAMT
      *
     C           *IN99     IFEQ '1'
     C                     Z-ADD0         ZZAMT  153
     C                     ELSE
     C                     Z-ADDZZWK2     ZZTOTD
     C                     Z-ADDZZWK3     ZZTOTI
     C                     ENDIF
     C                     LEAVE
     C                     ENDIF
      *
      ** the signs are different
      *
     C           *IN91     IFEQ '1'
     C           *IN92     ANDEQ'0'
     C           *IN91     OREQ '0'
     C           *IN92     ANDEQ'1'
      *
      ** If ZZAMT was negative, make it positive to compare with ZZTOT
      *
     C           *IN92     IFEQ '1'
     C                     Z-SUBZZAMTI    ZZAMTI 150
     C                     Z-SUBZZAMTD    ZZAMTD  30
     C                     ENDIF
      *
      ** If ZZTOT was negative, make it positive to compare with ZZAMT
      *
     C           *IN91     IFEQ '1'
     C                     Z-SUBZZTOTI    ZZTOTI
     C                     Z-SUBZZTOTD    ZZTOTD
     C                     ENDIF
      *
      ** Both ZZAMT and ZZTOT are now positive
      ** If ZZTOT equals ZZAMT, return zero
      *
     C                     MOVE '0'       *IN93
     C           ZZTOTI    IFEQ ZZAMTI
     C           ZZTOTD    ANDEQZZAMTD
     C                     Z-ADD0         ZZTOTI
     C                     Z-ADD0         ZZTOTD
     C                     LEAVE                                          158180
     C                     ELSE
     C           ZZTOTI    IFGT ZZAMTI
     C           ZZTOTD    OREQ ZZAMTD
     C                     MOVE '1'       *IN93
     C                     ENDIF
     C                     ENDIF
      *
      ** If ZZTOT greater than ZZAMT
      *
     C           *IN93     IFEQ '1'
     C           ZZAMTD    IFGT ZZTOTD
     C           ZZTOTI    SUB  1         ZZTOTI
     C           ZZTOTD    ADD  1000      ZZWK2
     C           ZZTOTI    SUB  ZZAMTI    ZZTOTI
     C           ZZWK2     SUB  ZZAMTD    ZZTOTD
     C                     ELSE
     C           ZZTOTI    SUB  ZZAMTI    ZZTOTI
     C           ZZTOTD    SUB  ZZAMTD    ZZTOTD
     C                     ENDIF
      *
      ** If ZZAMT greater than ZZAMT
      *
     C                     ELSE
     C           ZZTOTD    IFGT ZZAMTD
     C           ZZAMTI    SUB  1         ZZWK3  150
     C           ZZAMTD    ADD  1000      ZZWK2
     C           ZZWK3     SUB  ZZTOTI    ZZTOTI
     C           ZZWK2     SUB  ZZTOTD    ZZTOTD
     C                     ELSE
     C           ZZAMTI    SUB  ZZTOTI    ZZTOTI
     C           ZZAMTD    SUB  ZZTOTD    ZZTOTD
     C                     ENDIF
     C                     ENDIF
      *
      ** Reverse sign of ZZTOT if larger input fields were negative
      *
     C           *IN93     IFEQ '1'
     C           *IN91     ANDEQ'1'
     C           *IN93     OREQ '0'
     C           *IN92     ANDEQ'1'
     C                     Z-SUBZZTOTI    ZZTOTI
     C                     Z-SUBZZTOTD    ZZTOTD
     C                     ENDIF
      *
      ** Restore sign of ZZAMTI & ZZAMTD if reversed
      *
     C           *IN92     IFEQ '1'
     C                     Z-SUBZZAMTI    ZZAMTI
     C                     Z-SUBZZAMTD    ZZAMTD
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDDO
      *
      ** If ZZTOTD is zero, and ZZTOTI is negative, setup  ZZNEGD
      *
     C           ZZTOTD    IFEQ *ZEROS
     C           ZZTOTI    ANDLT*ZEROS
     C                     MOVE '.000-'   ZZNEGD  5
     C                     ENDIF
      *
      ** Restore previous indicator values
      *
     C                     MOVE WIN91     *IN91
     C                     MOVE WIN92     *IN92
     C                     MOVE WIN93     *IN93
     C                     MOVE WIN94     *IN94
     C                     MOVE WIN95     *IN95
      *
     C                     ENDSR
      ***********************************************************
      *  LOADFM :   Load deyails to file
      ***********************************************************
     C           LOADFM    BEGSR
      *
      ***If*an*expired facility is amended set RECI to live status 123117 150875
      ***********                                                  123117 150875
     C***********S1ACTN    IFEQ 'A'                                123117 150875
     C***********RECI      ANDEQ'E'                                123117 150875
     C***********          MOVE 'D'       RECI                     123117 150875
     C***********          ENDIF                                   123117 150875
      ***********                                                  123117 150875
      *                                                                   188373
      ** If an expired facility is amended set RECI to live status        188373
      *                                                                   188373
     C                     MOVE S2DTEX    ZDATE                           188373
     C                     EXSR ZDATE1                                    188373
     C           S1ACTN    IFEQ 'A'                                       188373
     C           RECI      ANDEQ'E'                                       188373
     C           ZDAYNO    ANDGTRUND                                      188373
     C                     MOVE 'D'       RECI                            188373
     C                     ENDIF                                          188373
      *                                                                   188373
     C                     MOVE S2BRCA    BRCA
     C                     MOVE S2FCCY    FCCY
      *
     C***********13        SUB  A6NBDP    ZADIG                           120717
     C***********          Z-ADDA6NBDP    ZADEC                           120717
     C           S1ACTN    IFNE 'A'                                                           194540
     C           S1ACTN    ANDNE'X'                                                           194540
     C           13        SUB  W#NBDP    ZADIG                           120717
     C                     Z-ADDW#NBDP    ZADEC                           120717
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE S2FAMT    ZFIELD
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    FAMT
     C                     END                                                                194540
      *
     C                     Z-ADD2         ZADIG
     C                     Z-ADD3         ZADEC
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE S2OVPC    ZFIELD
     C                     EXSR ZALIGN
      *
     C                     MOVE ZFIELD    OVPC
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           13        SUB  W#NBDP    ZADIG                                               CLE034
     C                     Z-ADDW#NBDP    ZADEC                                               CLE034
     C                     MOVE *BLANKS   ZFIELD                                              CLE034
     C                     MOVE S2OVAM    ZFIELD                                              CLE034
     C                     EXSR ZALIGN                                                        CLE034
     C                     MOVE ZFIELD    OVAM                                                CLE034
     C                     ENDIF                                                              CLE034
      *
     C                     MOVE S2FCTI    FCTI
      *
     C                     MOVE S2SECI    SECI
      *
     C                     MOVE S2DTAP    ZDATE
     C                     EXSR ZDATE1
     C                     MOVE ZDAYNO    DTAP
      *
     C                     MOVE S2MCCY    MCCY
      *
     C                     MOVE S2DTEX    ZDATE
     C                     EXSR ZDATE1
     C                     MOVE ZDAYNO    DTEX
      *
     C                     MOVE S2CRSK    CRSK
      *
     C                     MOVE S2MCSI    MCSI
      *
     C                     MOVE S2NACD    NACD
      *
     C                     MOVE S2DLFS    ZDATE
     C                     EXSR ZDATE1
     C                     MOVE ZDAYNO    DLFS
      *
     C                     Z-ADD4         ZADIG
     C                     Z-ADD7         ZADEC
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE S2NOMR    ZFIELD
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    NOMR
      *
     C                     MOVE S2RVDT    ZDATE
     C                     EXSR ZDATE1
     C                     MOVE ZDAYNO    RVDT
      *
     C                     MOVE S2RVFR    RVFR
      *
     C                     MOVE S2RVDY    RVDY
      *
     C                     MOVE S2NAR1    NAR1
      *
     C                     MOVE S2NAR2    NAR2
      *
     C                     MOVE S2NAR3    NAR3
      *
     C                     MOVE S2NAR4    NAR4
      *
     C                     MOVE S2ACOF    ACOF
      *
     C                     MOVE S2ORBR    ORBR
      *
     C           S1ACTN    IFEQ 'I'
      *
     C                     Z-ADD0         RVCD
      *
     C                     ELSE
      *
     C           S1ACTN    IFEQ 'A'
      *
      **  If this is the first change of RVCR today then RVCD become
      **  run date
      **  and if RVCR has been changed to 'N' then initialise OAM
      **  outstanding amount array (for elements run date to end of array
     C           S2RVCR    IFNE RVCR
     C           RUND      ANDNERVCD
      *
     C                     Z-ADDRUND      RVCD
      *
     C           S2RVCR    IFEQ 'N'
      *
     C                     Z-ADD1         A
     C           RUND      LOKUPRUN,A                    19
     C           *IN19     IFEQ *ON
     C           A         DOWLE10
     C                     Z-ADDFAMT      OAM,A
     C                     ADD  1         A
     C                     ENDDO
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVE S2RVCR    RVCR
      *
     C           S1ACTN    IFEQ 'I'                                       125558
     C                     Z-ADDRUND      ORED
     C                     ENDIF                                          125558
      *
     C                     Z-ADDRUND      LCD
      *
     C                     MOVE S1ACTN    CHTP
      *
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      TNLU
      *
     C           P#MODE    IFEQ 'B'
     C                     MOVE F1PCOB    PCOB
     C                     ELSE
     C                     MOVE *BLANKS   PCOB
     C                     ENDIF
      *
     C           P#MODE    IFNE 'B'
     C           S1ACTN    ANDEQ'I'
     C***********          CALL 'AOBRCHR0'                                121783
     C                     CALL 'AOBRCHR1'                                121783
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM S2BRCA    @BRCA
     C           SDBRCH    PARM SDBRCH    DSSDY
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD7         DBASE
     C                     MOVEL'SDBRCHPD'DBFILE
     C                     MOVELS2BRCA    DBKEY
     C                     MOVEL'LE2020'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVELA8MQSM    W#1ST3  3
     C*******              MOVELW#1ST3    PCRF                            119591
     C***                  MOVELW#1ST3    PCRF      P              119591 158177
     C********** *NAMVAR   DEFN           LEALLO                                       158177 CLE148
     C********** *LOCK     IN   LEALLO                                                 158177 CLE148
     C********** PCLAST    ADD  1         PCNEXT  80                                   158177 CLE148
     C                     CALL 'LEALLO'                                                      CLE148
     C                     PARM *BLANKS   PRTCD   7                                           CLE148
     C                     PARM 'Y'       PUPDT   1                                           CLE148
     C                     PARM *BLANKS   PCLAST                                              CLE148
     C                     PARM *BLANKS   PCNEXT  8                                           CLE148
      *                                                                                       CLE148
     C                     MOVE PCNEXT    W1ST11 11                       158177
     C                     MOVELW#1ST3    W1ST11                          158177
     C                     MOVELW1ST11    PCRF                            158177
     C                     MOVE '0001'    PCRF                            158177
     C**********           Z-ADDPCNEXT    PCLAST                                       158177 CLE148
     C**********           OUT  LEALLO                                                 158177 CLE148
     C                     ENDIF
      *
     C                     ELSE
      *
     C           P#MODE    IFEQ 'B'
     C                     MOVE F1TNRF    PCRF
     C                     ENDIF
      *
     C                     ENDIF
      *
     C************IN17     IFEQ *ON                                       167979
      *
     C                     MOVE S3SYIN    SYIN
      *
     C                     MOVELS3ANUM    ANUM
     C           *LIKE     DEFN PRTR      W#PRTR                          120136
     C           *IN86     IFEQ *OFF                                      122624
     C                     MOVE W#PRTR    PRTR                            120136
     C                     ENDIF                                          122624
      *
      ** If Flat Rate Personal Loans (Rule of 78s) is installed,                              CLE028
      ** move the drawing types to the field DTPX.                                            CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     MOVE S3DTX6    DTPX                                                CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     MOVE S3DTX5    DTPS
      *
     C                     MOVE S3DICB    DICB
      *
     C                     MOVE S3RTX6    RTPS
      *
     C                     MOVE S3RLPD    RLPD
      *
     C                     MOVE S3CSEL    CSEL
      *
     C                     MOVE S3ACCY    ALCY
      *
     C                     MOVE S3COMD    ZDATE
     C                     EXSR ZDATE1
     C                     MOVE ZDAYNO    COMD
      *
     C                     MOVE S3CDTE    ZDATE
     C                     EXSR ZDATE1
     C                     MOVE ZDAYNO    CDTE
      *
     C                     MOVE S3AVLD    ZDATE
     C                     EXSR ZDATE1
     C                     MOVE ZDAYNO    AVLD
      *
     C                     MOVE S3LPTP    LPTP
      *
     C                     MOVE S3LPBR    LPBR
      *
     C           LPTP      IFEQ 'P'
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE S3LPAM    ZFIELD
     C                     Z-ADD7         ZADEC
     C                     Z-ADD4         ZADIG
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    LPAM
     C                     ELSE
     C           LPTP      IFEQ 'A'
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE S3LPAM    ZFIELD
     C                     Z-ADDW#NBDP    ZADEC
     C           13        SUB  W#NBDP    ZADIG
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    LPAM
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVE S3LPPS    LPPS
      *
     C                     MOVE S3DFTP    DFTP
      *
     C                     MOVE S3DFST    DFST
      *
     C                     MOVE S3SYCP    SYCP
      *
     C***********          ENDIF                                          167979
      *                                                                   CLE005
      **  Write Credit/Agreement Exchange Rate and Indicator              CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C********** CLE006    ANDEQ'Y'                                CLE005 170106
      *                                                                   CLE005
     C                     Z-ADD5         ZADIG                           CLE005
     C                     Z-ADD8         ZADEC                           CLE005
     C                     MOVE *BLANK    ZFIELD                          CLE005
     C                     MOVE S3CAXR    ZFIELD                          CLE005
     C                     EXSR ZALIGN                                    CLE005
     C                     MOVE ZFIELD    CAXR                            CLE005
      *                                                                   CLE005
     C                     MOVE S3CMDI    CMDI                            CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      **  Write Account Sequence Number                                   CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           CLE007    ANDEQ'Y'                                       CLE005
     C                     MOVE S2ACSQ    ACSQ                            CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      **  Write Tranche/Credit Agreement Indicator, Credit Agreement      CLE005
      **  Customer, Type, and Number                                      CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C                     MOVE S3TRCA    TRCA                            CLE005
     C                     MOVE S3CANM    CANM                            CLE005
     C                     MOVE S3CAFT    CAFT                            CLE005
     C                     MOVE S3CAFN    CAFN                            CLE005
     C                     MOVE W#CACY    CACY                            CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE008
      **  Write Loan Administrator Id                                     CLE008
      *                                                                   CLE008
     C           CLE008    IFEQ 'Y'                                       CLE008
     C           *IN77     ANDEQ*OFF                                      CLE008
     C                     MOVE S3LAID    LAID                            CLE008
     C                     ENDIF                                          CLE008
      *
     C                     ENDSR
      /EJECT
      ***********************************************************         CAP065
      *  LOADIV :   Load details from Invalid Facilities File             CAP065
      ***********************************************************         CAP065
     C*                                                                   CAP065
     C           LOADIV    BEGSR                                          CAP065
     C*                                                                   CAP065
     C                     MOVE SFCCY     FCCY                            CAP065
     C                     MOVE SBRCA     BRCA                            CAP065
     C                     MOVE SSYIN     SYIN                            CAP065
     C                     MOVE *BLANKS   FSTS                            CAP065
     C                     MOVE SFCNM     CNUM                            CAP065
     C                     MOVE SFACT     FACT                            CAP065
     C                     MOVE SFCNO     FCNO                            CAP065
     C*                                                                   CAP065
     C                     MOVELSACTN     S1ACTN                          CAP065
     C                     MOVELSORBR     ORBR                            CAP065
     C                     MOVELSFCTI     FCTI                            CAP065
      *                                                                   CPK015
      ** Set up the facility amount with the correct formatting           CPK015
      *                                                                   CPK015
     C                     MOVE FCCY      CKEY                            CPK015
     C                     MOVE '*BLANKS' @RTCD                           CPK015
     C                     CALL 'AOCURRR0'PLIST2                          CPK015
     C           @RTCD     IFNE *BLANKS                                   CPK015
     C           *LOCK     IN   LDA                                       CPK015
     C                     MOVEL'SDCURRPD'DBFILE                          CPK015
     C                     Z-ADD14        DBASE                           CPK015
     C                     MOVELFCCY      DBKEY                           CPK015
     C                     MOVEL'LE2020'  DBPGM                           CPK015
     C                     OUT  LDA                                       CPK015
     C                     EXSR *PSSR                                     CPK015
     C                     ENDIF                                          CPK015
      *                                                                   CPK015
     C                     MOVE A6NBDP    W#NBDP                          CPK015
     C******************   MOVELSFAMT     FAMT                            CPK015
      *                                                                   CPK015
     C           13        SUB  W#NBDP    ZADIG                           CPK015
     C                     Z-ADDW#NBDP    ZADEC                           CPK015
     C                     MOVE *BLANK    ZFIELD                          CPK015
     C                     MOVE SFAMT     ZFIELD                          CPK015
     C                     EXSR ZALIGN                                    CPK015
     C                     MOVE ZFIELD    FAMT                            CPK015
      *                                                                   CPK015
     C*********************MOVELSFAMT     FAMT                     CAP065 CPK015
     C                     Z-ADD2         ZADIG                           CPK015
     C                     Z-ADD3         ZADEC                           CPK015
     C                     MOVE *BLANK    ZFIELD                          CPK015
     C                     MOVE SOVPC     ZFIELD                          CPK015
     C                     EXSR ZALIGN                                    CPK015
     C                     MOVE ZFIELD    OVPC                            CPK015
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           13        SUB  W#NBDP    ZADIG                                               CLE034
     C                     Z-ADDW#NBDP    ZADEC                                               CLE034
     C                     MOVE *BLANKS   ZFIELD                                              CLE034
     C                     MOVE SOVAM     ZFIELD                                              CLE034
     C                     EXSR ZALIGN                                                        CLE034
     C                     MOVE ZFIELD    OVAM                                                CLE034
     C                     ENDIF                                                              CLE034
     C*********************MOVELSOVPC     OVPC                     CAP065 CPK015
     C                     MOVE SDTAP     DTAP                            CAP065
     C                     MOVE SDTEX     DTEX                            CAP065
     C                     MOVELSRVCR     RVCR                            CAP065
     C                     MOVELSSECI     SECI                            CAP065
     C                     MOVELSMCCY     MCCY                            CAP065
     C                     MOVELSMCSI     MCSI                            CAP065
     C                     MOVELSMBFC     MBFC                            CAP065
     C                     MOVELSNACD     NACD                            CAP065
     C                     MOVELSCRSK     CRSK                            CAP065
     C                     MOVE SDLFS     DLFS                            CAP065
     C                     Z-ADD4         ZADIG                           CPK015
     C                     Z-ADD7         ZADEC                           CPK015
     C                     MOVE *BLANK    ZFIELD                          CPK015
     C                     MOVE SNOMR     ZFIELD                          CPK015
     C                     EXSR ZALIGN                                    CPK015
     C                     MOVE ZFIELD    NOMR                            CPK015
     C*********************MOVELSNOMR     NOMR                     CAP065 CPK015
     C                     MOVE SRVDT     RVDT                            CAP065
     C                     MOVELSRVFR     RVFR                            CAP065
     C                     MOVELSRVDY     RVDY                            CAP065
     C                     MOVELSNAR1     NAR1                            CAP065
     C                     MOVELSNAR2     NAR2                            CAP065
     C                     MOVELSNAR3     NAR3                            CAP065
     C                     MOVELSNAR4     NAR4                            CAP065
     C                     MOVELSACOF     ACOF                            CAP065
     C                     MOVELSPRFC     PRFC                            CAP065
     C                     MOVELSBTIN     BTIN                            CAP065
     C                     MOVELSBLDY     BLDY                            CAP065
     C                     MOVELSACSQ     ACSQ                            CAP065
     C                     MOVELSANUM     ANUM                            CAP065
     C                     MOVELSDTS1     S3DTS1                          CAP065
     C                     MOVELSDTS2     S3DTS2                          CAP065
     C                     MOVELSDTS3     S3DTS3                          CAP065
     C                     MOVELSDTS4     S3DTS4                          CAP065
     C                     MOVELSDTS5     S3DTS5                          CAP065
     C                     MOVELS3DTX5    DTPS                            CAP065
     C                     MOVELSRTS1     S3RTS1                          CAP065
     C                     MOVELSRTS2     S3RTS2                          CAP065
     C                     MOVELSRTS3     S3RTS3                          CAP065
     C                     MOVELSRTS4     S3RTS4                          CAP065
     C                     MOVELSRTS5     S3RTS5                          CAP065
     C                     MOVELSRTS6     S3RTS6                          CAP065
     C                     MOVELS3RTX6    RTPS                            CAP065
     C                     MOVELSRLPD     RLPD                            CAP065
     C                     MOVELSDICB     DICB                            CAP065
     C                     MOVELSCSEL     CSEL                            CAP065
     C                     MOVELSCY01     S3CY01                          CAP065
     C                     MOVELSCY02     S3CY02                          CAP065
     C                     MOVELSCY03     S3CY03                          CAP065
     C                     MOVELSCY04     S3CY04                          CAP065
     C                     MOVELSCY05     S3CY05                          CAP065
     C                     MOVELSCY06     S3CY06                          CAP065
     C                     MOVELSCY07     S3CY07                          CAP065
     C                     MOVELSCY08     S3CY08                          CAP065
     C                     MOVELSCY09     S3CY09                          CAP065
     C                     MOVELSCY10     S3CY10                          CAP065
     C                     MOVELSCY11     S3CY11                          CAP065
     C                     MOVELSCY12     S3CY12                          CAP065
     C                     MOVELS3ACCY    ALCY                            CAP065
     C                     MOVE SCOMD     COMD                            CAP065
     C                     MOVE SCDTE     CDTE                            CAP065
     C                     MOVE SAVLD     AVLD                            CAP065
     C                     MOVELSLPTP     LPTP                            CAP065
     C                     MOVELSLPBR     LPBR                            CAP065
      *                                                                   CPK015
      ** Set up the facility amount with the correct formatting           CPK015
      ** IF Late Payment Penalty Type = P (Percentage Rate) use 4 dig     CPK015
      ** and 7 dec else if Late Payment Penalty Type = A (Amount) use     CPK015
      ** Facility currency to format.                                     CPK015
      *                                                                   CPK015
     C*********************MOVELSLPAM     LPAM                     CAP065 CPK015
      *                                                                   CPK015
     C                     SELEC                                          CPK015
     C           SLPTP     WHEQ 'P'                                       CPK015
     C                     Z-ADD7         ZADEC                           CPK015
     C                     Z-ADD4         ZADIG                           CPK015
     C           SLPTP     WHEQ 'A'                                       CPK015
     C                     MOVE A6NBDP    W#NBDP                          CPK015
     C           13        SUB  W#NBDP    ZADIG                           CPK015
     C                     Z-ADDW#NBDP    ZADEC                           CPK015
     C                     ENDSL                                          CPK015
      *                                                                   CPK015
     C                     MOVE *BLANK    ZFIELD                          CPK015
     C                     MOVE SLPAM     ZFIELD                          CPK015
     C                     EXSR ZALIGN                                    CPK015
     C                     MOVE ZFIELD    LPAM                            CPK015
      *                                                                   CPK015
     C                     MOVELSLPPS     LPPS                            CAP065
     C                     MOVELSDFTP     DFTP                            CAP065
     C                     MOVELSDFST     DFST                            CAP065
     C                     MOVELSTRCA     TRCA                            CAP065
     C                     MOVELSCANM     CANM                            CAP065
     C                     MOVELSCAFT     CAFT                            CAP065
     C                     MOVELSCAFN     CAFN                            CAP065
     C                     MOVELSSYCP     SYCP                            CAP065
     C                     MOVELSCMDI     CMDI                            CAP065
     C                     MOVELSCAXR     CAXR                            CAP065
     C                     MOVELSLAID     LAID                            CAP065
     C                     ENDSR                                          CAP065
     C*                                                                   CAP065
      /EJECT                                                              CAP065
      ***********************************************************         CAP065
      *  DSPHDR :   Display the Header of the display file                CAP065
      ***********************************************************         CAP065
     C           DSPHDR    BEGSR                                          CAP065
     C*                                                                   CAP065
     C* Borrow the use of *IN 83 to signify 'F' mode                      CAP065
     C*                                                                   CAP065
     C           *IN83     IFEQ *ON                                       CAP065
     C                     MOVE '1'       TEMP83  1                       CAP065
     C                     ELSE                                           CAP065
     C                     MOVE '0'       TEMP83                          CAP065
     C                     ENDIF                                          CAP065
     C*                                                                   CAP065
     C           P#MODE    IFEQ 'F'                                       CAP065
     C                     MOVE *ON       *IN83                           CAP065
     C                     ELSE                                           CAP065
     C                     MOVE *OFF      *IN83                           CAP065
     C                     ENDIF                                          CAP065
     C*                                                                   CAP065
     C                     WRITELE2020F1                   Header         CAP065
     C*                                                                   CAP065
     C           TEMP83    IFEQ '1'                                       CAP065
     C                     MOVE *ON       *IN83                           CAP065
     C                     ELSE                                           CAP065
     C                     MOVE *OFF      *IN83                           CAP065
     C                     ENDIF                                          CAP065
     C*                                                                   CAP065
     C                     ENDSR                                          CAP065
      /EJECT                                                              CAP065
      ***********************************************************
      *  INITFM :
      ***********************************************************
     C           INITFM    BEGSR
      *
     C                     Z-ADD0         MTDH
     C                     Z-ADD0         MTDL
     C                     Z-ADD0         MTDA
     C                     Z-ADD0         QTDA
     C                     Z-ADD0         YTDA
     C                     MOVE *BLANKS   ZZ001
     C                     MOVE *BLANKS   ZZ002A
     C                     MOVE *BLANKS   AUSR
     C                     MOVE *BLANKS   XUSR
     C***********          MOVE *BLANKS   PRTR                            120136
     C**********           Z-ADD0         PMFC                                                CSD027
     C                     MOVE *BLANKS   PMFC                                                CSD027
     C                     Z-ADD0         PMFT
     C                     Z-ADD0         PMFN
     C**********           Z-ADD0         INUM                                                CSD027
     C                     MOVE *BLANKS   INUM                                                CSD027
     C                     Z-ADD0         JDTE
     C                     MOVE *BLANKS   SHTP
     C                     Z-ADD0         SHPC
     C                     MOVE *BLANKS   RCSI
     C                     Z-ADD0         SKIR
     C                     MOVE *BLANKS   SKIS
     C                     Z-ADD0         SKFR
     C                     MOVE *BLANKS   SKFS
     C                     Z-ADD0         VDTC
     C                     MOVE *BLANKS   OSDB
     C                     MOVE *BLANKS   OMDB
     C                     Z-ADD0         RSTM
     C                     MOVE *BLANKS   RONS
     C                     MOVE *BLANKS   RIBN
     C                     MOVE *BLANKS   RIBA
     C**********           Z-ADD0         ROBN                                                CSD027
     C**********           Z-ADD0         ROCN                                                CSD027
     C                     MOVE *BLANKS   ROBN                                                CSD027
     C                     MOVE *BLANKS   ROCN                                                CSD027
     C                     Z-ADD0         PSTM
     C                     MOVE *BLANKS   PONS
     C                     MOVE *BLANKS   PIBN
     C                     MOVE *BLANKS   PIBA
     C**********           Z-ADD0         POBN                                                CSD027
     C**********           Z-ADD0         POCN                                                CSD027
     C                     MOVE *BLANKS   POBN                                                CSD027
     C                     MOVE *BLANKS   POCN                                                CSD027
     C                     MOVE *BLANKS   RCRN
     C                     MOVE *BLANKS   RCRA
     C                     MOVE *BLANKS   RVNO
     C                     MOVE *BLANKS   AWBN
     C                     MOVE *BLANKS   AWBA
     C                     MOVE *BLANKS   BENN
     C                     MOVE *BLANKS   BENA
     C                     MOVE *BLANKS   DTP1
     C                     MOVE *BLANKS   DTP2
     C                     MOVE *BLANKS   DTP3
     C                     MOVE *BLANKS   DTP4
     C                     MOVE *BLANKS   DCHG
     C                     MOVE *BLANKS   BTB1
     C                     MOVE *BLANKS   BTB2
     C                     MOVE *BLANKS   BTB3
     C                     MOVE *BLANKS   BTB4
     C                     MOVE *BLANKS   BTB5
     C                     MOVE *BLANKS   BTB6
     C                     MOVE *BLANKS   CVMR
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  LOADFN : Load fields into FCLTYFN
      ***********************************************************
     C           LOADFN    BEGSR
      *
     C***********S1ACTN    IFEQ 'A'                                123117 150875
     C***********RECI      ANDEQ'E'                                123117 150875
     C***********          MOVE 'D'       RECI                     123117 150875
     C***********          ENDIF                                   123117 150875
      ***********                                                  123117 150875
      *                                                                   188373
      ** If an expired facility is amended set RECI to live status        188373
      *                                                                   188373
     C                     MOVE S2DTEX    ZDATE                           188373
     C                     EXSR ZDATE1                                    188373
     C           S1ACTN    IFEQ 'A'                                       188373
     C           RECI      ANDEQ'E'                                       188373
     C           ZDAYNO    ANDGTRUND                                      188373
     C                     MOVE 'D'       RECI                            188373
     C                     ENDIF                                          188373
      *                                                                   188373
     C                     MOVE S2BTIN    BTIN
      *
     C                     MOVE S2BLDY    BLDY
      *
     C                     MOVE S2PRFC    PRFC
      *
     C                     MOVE S2MBFC    MBFC
      *
     C**********           Z-ADDRUND      ORED                                              AR402546
      *
     C                     Z-ADDRUND      LCD
      *
     C           S1ACTN    IFEQ 'I'                                       125558
     C                     MOVE 'I'       CHTP
     C                     Z-ADDRUND      ORED                                              AR402546
     C                     ENDIF                                          125558
      *
     C                     Z-ADDNATN      TNLU
      *
     C           S1ACTN    IFEQ 'I'
     C                     EXSR DRWAMT
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  DRWAMT :
      ***********************************************************
     C           DRWAMT    BEGSR
      *
      **  Determine 'DRAWN AMOUNT' days and read data area JNSTAT
      **  for previous run date
      *
     C                     IN   JNSTAT
      *
     C                     Z-ADDPRUN      PRUND   50
     C                     Z-ADDPRUN      ZDAYNO
      *  Check for holidays in local currency:                                                200182
     C**********           MOVE S2FCCY    ZCCY                                                200182
     C                     MOVE BJLCCY    ZCCY                                                200182
     C                     MOVE *BLANKS   ZLOC
      *
     C***********          Z-ADD1         ZNRDYS                          148722
     C***********          EXSR ZFWDT                                     148722
     C***********          Z-ADDZDYNBR    ZDAYNO                          148722
     C***********          Z-ADDZDYNBR    RUN0                            148722
     C                     Z-ADDPRUN      RUN0                            148722
      *
     C                     Z-ADD1         ZNRDYS
     C                     EXSR ZFWDT
     C                     Z-ADDZDYNBR    ZDAYNO
     C                     Z-ADDZDYNBR    RUN1
      *
     C                     Z-ADD1         ZNRDYS
     C                     EXSR ZFWDT
     C                     Z-ADDZDYNBR    ZDAYNO
     C                     Z-ADDZDYNBR    RUN2
      *
     C                     Z-ADD1         ZNRDYS
     C                     EXSR ZFWDT
     C                     Z-ADDZDYNBR    ZDAYNO
     C                     Z-ADDZDYNBR    RUN3
      *
     C                     Z-ADD1         ZNRDYS
     C                     EXSR ZFWDT
     C                     Z-ADDZDYNBR    ZDAYNO
     C                     Z-ADDZDYNBR    RUN4
      *
     C                     Z-ADD1         ZNRDYS
     C                     EXSR ZFWDT
     C                     Z-ADDZDYNBR    ZDAYNO
     C                     Z-ADDZDYNBR    RUN5
      *
     C                     Z-ADD1         ZNRDYS
     C                     EXSR ZFWDT
     C                     Z-ADDZDYNBR    ZDAYNO
     C                     Z-ADDZDYNBR    RUN6
      *
     C                     Z-ADD1         ZNRDYS
     C                     EXSR ZFWDT
     C                     Z-ADDZDYNBR    ZDAYNO
     C                     Z-ADDZDYNBR    RUN7
      *
     C                     Z-ADD1         ZNRDYS
     C                     EXSR ZFWDT
     C                     Z-ADDZDYNBR    ZDAYNO
     C                     Z-ADDZDYNBR    RUN8
      *
     C                     Z-ADD1         ZNRDYS
     C                     EXSR ZFWDT
     C                     Z-ADDZDYNBR    ZDAYNO
     C                     Z-ADDZDYNBR    RUN9
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  INITFN : Initialise fields on FCLTYFN
      ***********************************************************
     C           INITFN    BEGSR
      *
     C                     Z-ADD*ZEROS    OAM
     C                     MOVE *BLANKS   CMFT
     C                     Z-ADD0         CALC
     C                     MOVE *BLANKS   SPRD
     C**********           Z-ADD0         BCOD                                                CSD103
     C                     MOVE *BLANKS   BCOD                                                CSD103
     C                     Z-ADD0         BRAT
     C                     Z-ADD0         STDT
     C                     Z-ADD0         EDDT
     C                     Z-ADD0         DUDT
     C                     MOVE *BLANKS   BLFR
     C                     Z-ADD0         BLDN
     C                     Z-ADD0         SETT
     C                     MOVE *BLANKS   OBAC
     C                     MOVE *BLANKS   TNAC
     C                     Z-ADD0         SLCD
     C                     Z-ADD0         ACCD
     C                     Z-ADD0         ADNP
     C                     Z-ADD0         PDTD
     C                     Z-ADD0         AFPD
     C                     Z-ADD0         ADJP
     C                     Z-ADD0         ADJN
     C                     Z-ADD0         TOTD
     C                     Z-ADD0         CAMD
     C                     Z-ADD0         LSWSC
     C                     MOVE *BLANKS   BITS
     C                     Z-ADD0         PEXP
     C                     MOVE *BLANKS   ZZ003
     C                     MOVE *BLANKS   CFBR
     C                     MOVE *BLANKS   ZZ002
      *                                                                                       CLE023
     C                     Z-ADD0         CEXP                                                CLE023
      *
     C                     ENDSR
      /EJECT
      ***********************************************************
      *  MAPFLD : Map the input data read from the transmitted msg
      ***********************************************************
     C           MAPFLD    BEGSR
      *
      **  Map the input data read from the teansmitted message.
     C                     MOVE 'N'       WSELT                           157589
     C                     MOVE F1ACTN    S1ACTN
     C                     MOVE F1CNUM    S2CNUM
     C***********          MOVE F1CNUM    S1CUST                          121855
     C                     MOVELF1CNUM    S1CUST    P                     121855
     C                     MOVE F1FACT    S1FACT
     C           S1ACTN    IFEQ 'I'
     C           F1FCNO    ANDLE*ZERO                                                         257155
     C                     MOVE *BLANKS   S1FCNO
     C                     ELSE
     C                     MOVE F1FCNO    S1FCNO
     C                     ENDIF
     C                     MOVE F1BRCA    S2BRCA
     C                     MOVE F1ORBR    S2ORBR
     C                     MOVE F1FCTI    S2FCTI
     C                     MOVE F1FCCY    S2FCCY
     C                     MOVE F1FAMT    S2FAMT
     C                     MOVE F1OVPC    S2OVPC
     C                     MOVE F1OVAM    S2OVAM                                              CLE034
      *
     C                     MOVELF1DTAP    S2DTAP
     C                     MOVE F1DTAP    W#TWO   2
     C                     MOVE W#TWO     S2DTAP
      *
     C                     MOVELF1DTEX    S2DTEX
     C                     MOVE F1DTEX    W#TWO
     C                     MOVE W#TWO     S2DTEX
      *
     C                     MOVE F1RVCR    S2RVCR
     C                     MOVE F1SECI    S2SECI
     C                     MOVE F1MCCY    S2MCCY
     C                     MOVE F1MCSI    S2MCSI
     C                     MOVE F1MBFC    S2MBFC
     C                     MOVE F1NACD    S2NACD
     C                     MOVE F1CRSK    S2CRSK
      *
     C                     MOVELF1DLFS    S2DLFS
     C                     MOVE F1DLFS    W#TWO
     C                     MOVE W#TWO     S2DLFS
      *
     C                     MOVE F1NOMR    S2NOMR
      *
     C                     MOVELF1RVDT    S2RVDT
     C                     MOVE F1RVDT    W#TWO
     C                     MOVE W#TWO     S2RVDT
      *
     C                     MOVE F1RVFR    S2RVFR
     C                     MOVE F1RVDY    S2RVDY
     C                     MOVE F1NAR1    S2NAR1
     C                     MOVE F1NAR2    S2NAR2
     C                     MOVE F1NAR3    S2NAR3
     C                     MOVE F1NAR4    S2NAR4
     C                     MOVE F1ACOF    S2ACOF
     C                     MOVE F1PRFC    S2PRFC
     C                     MOVE F1BTIN    S2BTIN
     C           F1BLDY    IFEQ *ZERO                                     CAP065
     C                     MOVE *BLANKS   S2BLDY                          CAP065
     C                     ELSE                                           CAP065
     C                     MOVE F1BLDY    S2BLDY
     C                     ENDIF                                          CAP065
     C                     MOVE F1ACSQ    S2ACSQ                          132678
      *
     C           *IN17     IFEQ *ON
     C                     MOVE F1SYIN    S3SYIN
     C********** F1ANUM    IFEQ *ZERO                                                  CAP065 CSD027
     C           F1ANUM    IFEQ *BLANKS                                                       CSD027
     C                     MOVE *BLANKS   S3ANUM                          CAP065
     C                     ELSE                                           CAP065
     C                     MOVE F1ANUM    S3ANUM
     C                     ENDIF                                          CAP065
     C                     ENDIF                                                              212023
      *                                                                                       212023
      ** *IN17 = Syndications. Most fields are not dependent on Syndications now.             212023
      *                                                                                       212023
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     MOVE F1DTPX    S3DTX6                                              CLE028
     C                     MOVEAF1DTPX    WDTS1                                               CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE F1DTPS    S3DTX5
     C                     MOVEAF1DTPS    WDTS1                                               208485
     C                     ENDIF                                                              CLE028
     C                     MOVE F1RTPS    S3RTX6
     C                     MOVE F1RLPD    S3RLPD
     C                     MOVE F1DICB    S3DICB
     C                     MOVE F1CSEL    S3CSEL
     C                     MOVE F1ALCY    S3ACCY
      *
     C           *IN17     IFEQ *ON                                                           212023
     C                     MOVELF1COMD    S3COMD
     C                     MOVE F1COMD    W#TWO
     C                     MOVE W#TWO     S3COMD
      *
     C                     MOVELF1CDTE    S3CDTE
     C                     MOVE F1CDTE    W#TWO
     C                     MOVE W#TWO     S3CDTE
     C                     ENDIF                                                              212023
      *
     C                     MOVELF1AVLD    S3AVLD
     C                     MOVE F1AVLD    W#TWO
     C                     MOVE W#TWO     S3AVLD
      *
     C                     MOVE F1LPTP    S3LPTP
     C********** F1LPBR    IFEQ *ZERO                                                  CAP065 CSD103
     C**********           MOVE *BLANKS   S3LPBR                                       CAP065 CSD103
     C**********           ELSE                                                        CAP065 CSD103
     C                     MOVE F1LPBR    S3LPBR
     C**********           ENDIF                                                       CAP065 CSD103                                     CAP065
     C                     MOVE F1LPAM    S3LPAM
     C                     MOVE F1LPPS    S3LPPS
      *                                                                                       212023
     C           *IN17     IFEQ *ON                                                           212023
     C                     MOVE F1DFTP    S3DFTP
     C                     MOVE F1DFST    S3DFST
     C                     ENDIF                                                              212023
     C*                                                                                       212023
     C                     MOVE F1TRCA    S3TRCA
     C*
     C***********          MOVE F1CANM    S3CANM                          135140
     C********** F1CANM    IFEQ *ZERO                                                  CAP065 CSD027
     C           F1CANM    IFEQ *BLANKS                                                       CSD027
     C                     MOVE *BLANKS   S3CANM                          CAP065
     C                     ELSE                                           CAP065
     C                     MOVE F1CANM    S3CANM    P                     135140
     C                     ENDIF                                          CAP065
     C*
     C           F1CAFT    IFEQ *ZERO                                     CAP065
     C                     MOVE *BLANKS   S3CAFT                          CAP065
     C                     ELSE                                           CAP065
     C                     MOVE F1CAFT    S3CAFT
     C                     ENDIF                                          CAP065
     C*
     C           F1CAFN    IFEQ *ZERO                                     CAP065
     C                     MOVE *BLANKS   S3CAFT                          CAP065
     C                     ELSE                                           CAP065
     C                     MOVE F1CAFN    S3CAFN
     C                     ENDIF                                          CAP065
     C*
     C           *IN17     IFEQ *ON                                                           212023
     C                     MOVE F1SYCP    S3SYCP
     C                     ENDIF                                                              212023
      *                                                                                       212023
     C                     MOVE F1CMDI    S3CMDI                          130237
     C                     MOVE F1CAXR    S3CAXR                          130237
     C**********           ENDIF                                                              212023
      *                                                                   CLE008
     C           CLE008    IFEQ 'Y'                                       CLE008
     C                     MOVE F1LAID    S3LAID                          CLE008
     C                     ENDIF                                          CLE008
      *
     C                     ENDSR
      /EJECT
      *****************************************************************   133402
      * SRCURR   - Access currency details                            *   133402
      * Called by: VLDEXC - Validate Exchange Rate                    *   133402
      * Calls    : AOCURRR0                                           *   133402
      *                                                               *   133402
      *****************************************************************   133402
      *                                                                   133402
     C           SRCURR    BEGSR                                          133402
      *                                                                   133402
     C                     CALL 'AOCURRR0'                                133402
     C                     PARM '*BLANK  '@RTCD                           133402
     C                     PARM '*KEY    '@OPTN                           133402
     C                     PARM WCURR     CKEY                            133402
     C           SDCURR    PARM SDCURR    DSSDY                           133402
      *                                                                   133402
     C           @RTCD     IFNE *BLANKS                                   133402
     C           *LOCK     IN   LDA                                       133402
     C                     MOVEL'SDCURRPD'DBFILE           ************   133402
     C                     Z-ADD11        DBASE            * DBERR 11 *   133402
     C                     MOVELWCURR     DBKEY            ************   133402
     C                     OUT  LDA                                       133402
     C                     EXSR *PSSR                                     133402
     C                     ENDIF                                          133402
      *                                                                   133402
     C                     ENDSR                                          133402
      /EJECT                                                              133402
      *****************************************************************
      *  ZASNMS  -   Sends messages to the program's message queue
      *****************************************************************
     C           ZASNMS    BEGSR
      *
     C           P#MODE    IFEQ 'B'
     C           P#MODE    OREQ 'P'
     C                     EXSR SRBERR
      *
     C                     ELSE
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message Id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C                     PARM           ZAMSTP  7        Message type.
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRBERR  -  Set up batch error details                         *
      *****************************************************************
     C           SRBERR    BEGSR
      *
     C                     CALL 'Y2RVMGC'
     C                     PARM           @RTCD
     C                     PARM           ZAMSID           Message Id.
     C                     PARM           ZAMSGF           Message file.
     C                     PARM           ZAMSDA           Message data.
     C                     PARM           ZAMSTX132        Messge text
      *
      *  Include DUMP here for problems during batch and play modes.      120136
      *                                                                   120136
     C           W#ERR1    IFEQ 'Y'                                       120136
     C           W#ERR2    OREQ 'Y'                                       120136
     C           W#ERR3    OREQ 'Y'                                       120136
      *                                                                   CAP065
     C           P#MODE    IFEQ 'B'                                       CAP065
     C           CAP065    ANDEQ'Y'                                       CAP065
     C           F1RPLC    ANDEQ'B'                                       CAP065
     C*                                                                   CAP065
     C                     CALL 'LEC0215'                                 CAP065
     C                     PARM           XREPN                           CAP065
     C*                                                                   CAP065
     C*Map fields to invalid facilities file                              CAP065
     C                     EXSR MAPINV                                    CAP065
     C*                                                                   CAP065
     C                     MOVEASTAMP,1   STMST            Default Timestamp                  CPK015
     C                     WRITELEIFACP0                                  CAP065
      *                                                                   CSC011
      * If Support System active, write transaction to 24x7 log           CSC011
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
      *                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
      *                                                                   CSC011
      * Convert facility to LEF1MF format                                 CSC011
     C                     EXSR LOADFM                                    CSC011
     C                     EXSR LOG247                                    CSC011
      *                                                                   CSC011
      * Write invalid facility in LEF1MF format to 24x7 Log File          CSC011
     C                     MOVE 'I'       LOGVAL  1                       CSC011
     C                     EXSR APLGTR                                    CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     COMIT                                          CAP065
     C*                                                                   CSC011
     C                     ELSE                                           CAP065
      *                                                                   CAP065
     C                     DUMP                                           120136
     C                     ENDIF                                          CAP065
      *                                                                   CAP065
     C                     ENDIF                                          120136
      *                                                                   120136
      ** If batch mode, set up details of returned message format
      ** otherwise update message severity/id/text of test harness file
     C           P#MODE    IFEQ 'B'
     C                     MOVE F1MSGT    F2MSGT
     C                     MOVE F1TRUS    F2TRUS
     C                     MOVE F1TRWS    F2TRWS
     C                     MOVE F1TNRF    F2TNRF
     C                     MOVE F1TRSN    F2TRSN
     C                     MOVE F1ACTN    F2ACTN
     C                     MOVE F1TRDS    F2TRDS
     C                     MOVE F1TRTS    F2TRTS
     C                     MOVE F1NRBA    F2NRBA
     C           W#WARN    IFEQ 'Y'                                       158144
     C           W#WRN2    OREQ 'Y'                                       158144
     C                     MOVEL'W'       F2MSGS                          158144
     C                     ELSE                                           158144
     C                     MOVEL'E'       F2MSGS
     C                     END                                            158144
     C           W#ERR1    IFEQ 'Y'                                       148004
     C           W#ERR2    OREQ 'Y'                                       148004
     C           W#ERR3    OREQ 'Y'                                       148004
     C                     MOVEL'E'       F2MSGS                          148004
     C                     ENDIF                                          148004
     C                     MOVELZAMSID    F2MSGI
     C                     MOVELZAMSTX    F2MSTX
     C                     MOVE F1CNUM    F2CNUM
     C                     MOVE F1FACT    F2FACT
     C           S1ACTN    IFEQ 'I'
     C                     Z-ADD0         F2FCNO
     C                     ELSE
     C                     MOVE F1FCNO    F2FCNO
     C                     ENDIF
      *                                                                   158144
      ** If not a warning error, stop validation and return               158144
      ** For batch mode, update LDA before returning                      158144
      *                                                                   158144
     C           F2MSGS    IFEQ 'E'                                       158144
      *                                                                   158144
     C           *LOCK     IN   LDA                                       158144
     C                     MOVELZAMSID    DBKEY                           158144
     C                     MOVEL'LERMSGF' DBFILE                          158144
     C                     OUT  LDA                                       158144
     C                     MOVE *ON       *INLR
     C                     RETRN
     C                     ENDIF                                          158144
      *                                                                   158144
      *  Play Mode
     C                     ELSE
     C                     UPDATLE2020D0
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT                                                              123998
      *****************************************************************   123998
      * SRTEXT  -  Set up text from the message file                  *   123998
      *****************************************************************   123998
     C           SRTEXT    BEGSR                                          123998
      *                                                                   123998
     C                     CALL 'Y2RVMGC'                                 123998
     C                     PARM *BLANKS   @RTCD                           123998
     C                     PARM           ZAMSID           Message Id.    123998
     C                     PARM           ZAMSGF           Message file.  123998
     C                     PARM           ZAMSDA           Message data.  123998
     C                     PARM           ZAMSTX132        Messge text    123998
      *                                                                   123998
     C                     ENDSR                                          123998
      /EJECT
      *****************************************************************
      * CLEARM  -  Clears the message queue                           *
      *****************************************************************
     C           CLEARM    BEGSR
      *
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRWNDW   : Window processing subroutine                       *
      *****************************************************************
     C           SRWNDW    BEGSR
      *
      **  Call window manager WN0010
     C                     CALL 'WN0010'
     C                     PARM 'LE2020'  #PGM   10
     C                     PARM           KEY     2
     C                     PARM S1ACTN    ACTION  1
     C                     PARM           DATA
     C                     PARM *BLANK    #RTRN   7
     C                     PARM           SPARE 256
     C/COPY WNCPYSRC,LE2020C021
      *
      ** Process return code
     C           #RTRN     IFNE *BLANK
     C                     MOVEL#RTRN     ZAMSID
     C***********          MOVEL'WNMSGF'  ZAMSGF                          122052
     C                     MOVEL'WNMSGF  'ZAMSGF                          122052
     C                     EXSR ZASNMS
     C                     MOVEL'LERMSGF' ZAMSGF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * INITPR   : Initial Processing                                 *
      *****************************************************************
     C           INITPR    BEGSR
      *
      **  Define Parameter lists
     C           PLIST1    PLIST
     C                     PARM '*BLANKS' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           FKEY    3
     C           SDFACT    PARM SDFACT    DSFDY
      *
     C           PLIST2    PLIST
     C                     PARM           @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           CKEY    3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           PLIST3    PLIST
     C                     PARM '*BLANKS' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           KEYC   10
     C                     PARM           KEYSTS  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           PLIST4    PLIST
     C                     PARM '*BLANKS' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           ACOKEY  2
     C           SDACOF    PARM SDACOF    DSFDY
      *
     C           PLIST5    PLIST
     C                     PARM '*BLANKS' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           CTRYKY  2
     C           SDCTRY    PARM SDCTRY    DSFDY
      *
     C           PLIST6    PLIST
     C                     PARM '*BLANKS' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           ARCD    8
     C           SDCNST    PARM SDCNST    DSFDY
      *
     C           PLIST7    PLIST
     C                     PARM '*BLANKS' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           BKEY1   3
     C                     PARM           BKEY2   2
     C********** SDBSRT    PARM SDBSRT    DSFDY                                 CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                                 CSD006
      *
     C           PLIST8    PLIST
     C                     PARM '*BLANKS' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           @KEYA   6
     C                     PARM           @KEYB   3
     C                     PARM           @KEYC   4
     C                     PARM           @KEYD   2
     C                     PARM           @KEYE   2
     C                     PARM           @KEYF   3
     C                     PARM           @KEYG  10
     C                     PARM           @KEYH   1
     C           SDNOST    PARM SDNOST    DSFDY
      *                    PARM           @KEYG  10
     C           PLIST9    PLIST
     C                     PARM '*BLANKS' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           ATCD    2
     C                     PARM           AUCD    2
     C           SDLOAN    PARM SDLOAN    DSFDY
      *
      **  Define the LDA for error handling
     C           *NAMVAR   DEFN           LDA
      *
      **  DEFINE DTAARA JNSTAT
     C           *NAMVAR   DEFN           JNSTAT
      *
     C           *NAMVAR   DEFN           RUNDAT
      *
     C           *NAMVAR   DEFN           ZMUSER
      *
     C           *NAMVAR   DEFN           SDSTAT                          CSC011
     C*                                                                   CSC011
     C           *NAMVAR   DEFN           SC24X7                          CSC011
     C*                                                                   CSC011
     C                     MOVEACPY@      MKI@   80
      *
      ** Core hook for externalisation.
     C/COPY WNCPYSRC,LE2020CCPG
      *
      *
      **  Access Bank Details
     C                     CALL 'AOBANKR0'
     C                     PARM '*DBERR ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDBANK    PARM SDBANK    DSFDY
      *
      **  CHECK SYSTEM DATE FORMAT, DDMMYY(98 off) OR MMDDYY(98 on)
     C           BJDFIN    IFEQ 'M'
     C                     MOVE *ON       *IN98
     C                     ENDIF
      *
      **  ACCESS MIDAS MODULE DETAILS
     C                     CALL 'AOMMODR0'
     C                     PARM '*DBERR ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
      *
      ** ACCESS GENERAL LEDGER DETAILS
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *
     C           BGRTBN    IFEQ 'Y'
     C                     CALL 'AORETLR0'
     C                     PARM '*DBERR ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDRETL    PARM SDRETL    DSFDY
     C                     ENDIF
      *
      ** ACCESS TRADING DATA
     C                     CALL 'AOTRADR0'
     C                     PARM '*DBERR ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDTRAD    PARM SDTRAD    DSFDY
      *
      ** ACCESS DEALING DATA
     C           BGDLFX    IFEQ 'Y'
     C           BGDLMM    OREQ 'Y'
     C**********           CALL 'AODEALR0'                                                    CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C********** SDDEAL    PARM SDDEAL    DSFDY                                               CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C                     ENDIF
      *
      **  ACCESS CUSTOMER LENDING DATA
     C                     CALL 'AOCLNDR0'
     C                     PARM '*DBERR ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C********** SDCLND    PARM SDCLND    DSFDY                                               CLE134
     C           SDCLND    PARM SDCLND    DSSDY                                               CLE134
      *                                                                   123857
     C           BPAURV    IFEQ 'Y'                                       123857
     C                     MOVE *ON       *IN88                           123857
     C                     MOVE 'Y'       W#IN88  1                       CAP065
     C                     ELSE                                           123857
     C                     MOVE *OFF      *IN88                           123857
     C                     MOVE 'N'       W#IN88                          CAP065
     C                     ENDIF                                          123857
      *
      **  GET MBIN FROM DTAARA/RUNDAT
     C                     IN   RUNDAT
      *
      **  GET USER'S DEFAULT BRANCH
     C           P#MODE    IFNE 'B'
     C                     IN   ZMUSER
     C                     ENDIF
      *
      ** Before Flat Rate Personal Loans (Rule of 78s), *IN81 was                             CLE028
      ** modified yet not used in the program.  Thus the following                            CLE028
      ** lines were "commented out" so that in81 may be used.                                 CLE028
      *                                                                                       CLE028
      ****CHECK*IF*'ORIGINATING*BRANCH*USED'***************************                       CLE028
     C********** BKOBRU    IFEQ 'N'                                                           CLE028
     C********** MBIN      OREQ 'N'                                                           CLE028
     C**********           MOVE *ON       *IN81                                               CLE028
     C**********           ENDIF                                                              CLE028
      *
      **  WHEN MBIN = N, PROTECT AND NONDISPLAY ALL BRANCH FIELDS
     C           MBIN      IFEQ 'Y'
     C                     MOVE *ON       *IN14
     C                     ENDIF
      *
      **  CHECK IF 'PROFIT CENTRE USED'
     C           BKPRCU    IFEQ 'N'
     C                     MOVE *ON       *IN84
     C                     MOVE *ON       *IN85
     C                     ENDIF
      *
      **    CHECK IF 'PROFIT CENTRE AMENDABLE'
     C           BKPRCA    IFEQ 'N'
     C                     MOVE *ON       *IN84
     C                     END
      *
      **  Access Switchable SAR details for the existence of CLE002
      **  (Authorisation)
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANK    @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'CLE002'  @SARD   6
      *
     C           @RTCD     IFEQ *BLANK
     C                     MOVE 'Y'       CLE002  1
     C                     ELSE
     C                     MOVE 'N'       CLE002
     C                     ENDIF
      *
      **  Access Switchable SAR details for the existence of CLE005
      **  (Tranch 3)
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANK    @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'CLE005'  @SARD
      *
     C           @RTCD     IFEQ *BLANK
     C                     MOVE 'Y'       CLE005  1
     C                     MOVE *ON       *IN16
     C                     ELSE
     C                     MOVE *OFF      *IN16
     C                     MOVE 'N'       CLE005
     C                     ENDIF
      *
      **  Access Switchable SAR details for the existence of CLE006
      **  (Syndications)
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANK    @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'CLE006'  @SARD
      *
     C           @RTCD     IFEQ *BLANK
     C                     MOVE 'Y'       CLE006  1
     C                     MOVE *ON       *IN17
     C                     MOVE 'Y'       W#IN17  1                       CAP065
     C                     ELSE
     C                     MOVE 'N'       CLE006
     C                     MOVE *OFF      *IN17
     C                     MOVE 'N'       W#IN17                          CAP065
     C                     ENDIF
      *
      **  Access Switchable SAR details for the existence of CLE007
      **  (Enhanced Lending)
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANK    @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'CLE007'  @SARD
      *
     C           @RTCD     IFEQ *BLANK
     C                     MOVE 'Y'       CLE007  1
     C                     MOVE *ON       *IN18
     C                     ELSE
     C                     MOVE 'N'       CLE007
     C                     MOVE *OFF      *IN18
     C                     ENDIF
      *
      **
     C           CLE002    IFEQ 'Y'
     C                     MOVE BPFAAU    W#FAAU  1
     C                     ELSE
     C                     MOVE 'N'       W#FAAU
     C                     ENDIF
      *                                                                   CLE008
      **  Access Switchable SAR details for the existence of CLE008       CLE008
      **  (Loan Administrator Id)                                         CLE008
     C                     CALL 'AOSARDR0'                                CLE008
     C                     PARM *BLANK    @RTCD                           CLE008
     C                     PARM '*VERIFY' @OPTN                           CLE008
     C                     PARM 'CLE008'  @SARD                           CLE008
      *                                                                   CLE008
     C           @RTCD     IFEQ *BLANK                                    CLE008
     C                     MOVE 'Y'       CLE008  1                       CLE008
     C                     MOVE *ON       *IN69                           CLE008
     C                     ELSE                                           CLE008
     C                     MOVE 'N'       CLE008                          CLE008
     C                     MOVE *OFF      *IN69                           CLE008
     C                     ENDIF                                          CLE008
      *                                                                   CLE014
      ** Determine if CLE014 is installed                                 CLE014
      *                                                                   CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM '       ' PRTCD   7                       CLE014
     C                     PARM '*VERIFY' POPTN   7                       CLE014
     C                     PARM 'CLE014'  PSARD   6                       CLE014
     C           SCSARD    PARM SCSARD    DSSDY                           CLE014
      *                                                                   CLE014
      ** Handle Database Error                                            CLE014
      *                                                                   CLE014
     C           PRTCD     IFNE *BLANKS                                   CLE014
     C           PRTCD     ANDNE'*NRF   '                                 CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVE 'SCSARDPD'DBFILE                          CLE014
     C                     MOVELPSARD     DBKEY                           CLE014
     C                     Z-ADD13        DBASE                           CLE014
     C                     MOVEL'LE2020'  DBPGM                           CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** CLE014 is installed                                              CLE014
      *                                                                   CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CLE014  1                       CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CLE014                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CAP068
      **  Access Switchable SAR details for the existence of CAP068       CAP068
      **  (Assignments API)                                               CAP068
     C                     CALL 'AOSARDR0'                                CAP068
     C                     PARM *BLANK    @RTCD                           CAP068
     C                     PARM '*VERIFY' @OPTN                           CAP068
     C                     PARM 'CAP068'  @SARD                           CAP068
      *                                                                   CAP068
     C           @RTCD     IFEQ *BLANK                                    CAP068
     C                     MOVE 'Y'       CAP068  1                       CAP068
     C                     ELSE                                           CAP068
     C                     MOVE 'N'       CAP068                          CAP068
     C                     ENDIF                                          CAP068
      *                                                                   CAP068
      **  Access Switchable SAR details for the existence of CAP168       CAP068
      **  (Assignments Screen API)                                        CAP068
     C                     CALL 'AOSARDR0'                                CAP068
     C                     PARM *BLANK    @RTCD                           CAP068
     C                     PARM '*VERIFY' @OPTN                           CAP068
     C                     PARM 'CAP168'  @SARD                           CAP068
      *                                                                   CAP068
     C           @RTCD     IFEQ *BLANK                                    CAP068
     C                     MOVE 'Y'       CAP168  1                       CAP068
     C                     ELSE                                           CAP068
     C                     MOVE 'N'       CAP168                          CAP068
     C                     ENDIF                                          CAP068
      *                                                                   CAP068
      *                                                                   CAP069
      **  Access Switchable SAR details for the existence of CAP069       CAP069
      **  (Assignments API)                                               CAP069
     C                     CALL 'AOSARDR0'                                CAP069
     C                     PARM *BLANK    @RTCD                           CAP069
     C                     PARM '*VERIFY' @OPTN                           CAP069
     C                     PARM 'CAP069'  @SARD                           CAP069
      *                                                                   CAP069
     C           @RTCD     IFEQ *BLANK                                    CAP069
     C                     MOVE 'Y'       CAP069  1                       CAP069
     C                     ELSE                                           CAP069
     C                     MOVE 'N'       CAP069                          CAP069
     C                     ENDIF                                          CAP069
      *                                                                   CAP069
      **  Access Switchable SAR details for the existence of CAP169       CAP069
      **  (Assignments Screen API)                                        CAP069
     C                     CALL 'AOSARDR0'                                CAP069
     C                     PARM *BLANK    @RTCD                           CAP069
     C                     PARM '*VERIFY' @OPTN                           CAP069
     C                     PARM 'CAP169'  @SARD                           CAP069
      *                                                                   CAP069
     C           @RTCD     IFEQ *BLANK                                    CAP069
     C                     MOVE 'Y'       CAP169  1                       CAP069
     C                     ELSE                                           CAP069
     C                     MOVE 'N'       CAP169                          CAP069
     C                     ENDIF                                          CAP069
      *                                                                   CAP069
      *                                                                   CAP070
      **  Access Switchable SAR details for the existence of CAP070       CAP070
      **  (Assignments API)                                               CAP070
     C                     CALL 'AOSARDR0'                                CAP070
     C                     PARM *BLANK    @RTCD                           CAP070
     C                     PARM '*VERIFY' @OPTN                           CAP070
     C                     PARM 'CAP070'  @SARD                           CAP070
      *                                                                   CAP070
     C           @RTCD     IFEQ *BLANK                                    CAP070
     C                     MOVE 'Y'       CAP070  1                       CAP070
     C                     ELSE                                           CAP070
     C                     MOVE 'N'       CAP070                          CAP070
     C                     ENDIF                                          CAP070
      *                                                                   CAP070
      **  Access Switchable SAR details for the existence of CAP170       CAP070
      **  (Assignments Screen API)                                        CAP070
     C                     CALL 'AOSARDR0'                                CAP070
     C                     PARM *BLANK    @RTCD                           CAP070
     C                     PARM '*VERIFY' @OPTN                           CAP070
     C                     PARM 'CAP170'  @SARD                           CAP070
      *                                                                   CAP070
     C           @RTCD     IFEQ *BLANK                                    CAP070
     C                     MOVE 'Y'       CAP170  1                       CAP070
     C                     ELSE                                           CAP070
     C                     MOVE 'N'       CAP170                          CAP070
     C                     ENDIF                                          CAP070
      *                                                                   CAP070
     C/COPY WNCPYSRC,LE2020C017
      *
      ** Determine if Lending API enhancements - Facilities Input active? CAP065
      *                                                                   CAP065
     C                     CALL 'AOSARDR0'                                CAP065
     C                     PARM *BLANK    @RTCD                           CAP065
     C                     PARM '*VERIFY' @OPTN                           CAP065
     C                     PARM 'CAP065'  @SARD                           CAP065
     C*                                                                   CAP065
     C           @RTCD     IFEQ *BLANKS                                   CAP065
     C                     MOVE 'Y'       CAP065  1                       CAP065
     C                     ELSE                                           CAP065
     C                     MOVE 'N'       CAP065                          CAP065
     C                     ENDIF                                          CAP065
      *                                                                                       CLE028
      ** Check if Flat Rate Personal Loans (Rule of 78s) is installed                         CLE028
      *                                                                                       CLE028
     C                     CALL 'AOSARDR0'                                                    CLE028
     C                     PARM '       ' PRTCD                                               CLE028
     C                     PARM '*VERIFY' POPTN                                               CLE028
     C                     PARM 'CLE028'  PSARD                                               CLE028
     C           SCSARD    PARM SCSARD    DSSDY                                               CLE028
      *                                                                                       CLE028
      ** Handle Database Error                                                                CLE028
      *                                                                                       CLE028
     C           PRTCD     IFNE *BLANKS                                                       CLE028
     C           PRTCD     ANDNE'*NRF   '                                                     CLE028
     C           *LOCK     IN   LDA                                                           CLE028
     C                     MOVE 'SCSARDPD'DBFILE                                              CLE028
     C                     MOVE *BLANK    DBKEY                                               CLE028
     C                     MOVELPSARD     DBKEY                                               CLE028
     C                     Z-ADD15        DBASE                                               CLE028
     C                     MOVEL'LE2020'  DBPGM                                               CLE028
     C                     OUT  LDA                                                           CLE028
     C                     EXSR *PSSR                                                         CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** CLE028 is installed                                                                  CLE028
      *                                                                                       CLE028
     C           PRTCD     IFEQ *BLANKS                                                       CLE028
     C                     MOVE 'Y'       CLE028  1                                           CLE028
     C                     MOVE *ON       *IN81                                               CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE 'N'       CLE028                                              CLE028
     C                     MOVE *OFF      *IN81                                               CLE028
     C                     ENDIF                                                              CLE028
      *
      ** Determine if 24x7 Midas Availability active?                     CSC011
      *                                                                   CSC011
     C                     CALL 'AOSARDR0'                                CSC011
     C                     PARM *BLANK    @RTCD                           CSC011
     C                     PARM '*VERIFY' @OPTN                           CSC011
     C                     PARM 'CSC011'  @SARD                           CSC011
     C*                                                                   CSC011
     C           @RTCD     IFEQ *BLANKS                                   CSC011
     C                     MOVE 'Y'       CSC011  1                       CSC011
     C                     ELSE                                           CSC011
     C                     MOVE 'N'       CSC011                          CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C*                                                                   CSC011
     C* Is the support system on?                                         CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     Z-ADDS1DATE    WRNDAY  60                      CSC011
     C                     ELSE                                           CSC011
     C                     MOVE BJRDNB    WRNDAY                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                                       CLE034
      ** Check if CLE034 is on                                                                CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSARDR0'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM '*VERIFY' POPTN                                               CLE034
     C                     PARM 'CLE034'  PSARD                                               CLE034
      *                                                                                       CLE034
     C           PRTCD     IFNE *BLANKS                                                       CLE034
     C           PRTCD     ANDNE'*NRF   '                                                     CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVE 'SCSARDPD'DBFILE                                              CLE034
     C                     MOVELPSARD     DBKEY                                               CLE034
     C                     Z-ADD15        DBASE                                               CLE034
     C                     MOVEL'LE2020'  DBPGM                                               CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           PRTCD     IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'Y'       CLE034  1                                           CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'N'       CLE034                                              CLE034
     C                     ENDIF                                                              CLE034
     C*                                                                   CSC011
      **  Open workstn or play/readback file as appropriate
     C           P#MODE    IFEQ 'I'
     C           P#MODE    OREQ 'R'
     C                     OPEN LE2020DF
     C                     MOVE ##USR     S#USER
     C                     MOVE ##JOB     S#WSID
     C                     MOVE RUNA      S#RUNA
     C                     MOVE *ON       *IN89
     C                     ENDIF
      *
     C           P#MODE    IFEQ 'R'
     C           P#MODE    OREQ 'P'
     C                     OPEN LE2020PD
     C                     ENDIF
      *
     C                     MOVEL'LERMSGF 'ZAMSGF
      *
      **  if in batch mode, Set up transaction user, menu group and
      **  menu code
     C           P#MODE    IFEQ 'B'
     C                     MOVELF1TRUS    @USER
     C**********           Z-ADD1         @ZMGRP                                              CSF002
     C**********           MOVE 'FCTY'    @ZICDE                                              CSF002
     C                     MOVEL'00000'   UNQCDE                                              CSF002
     C                     MOVE '01805'   UNQCDE                                              CSF002
     C                     OPEN LEIFACPD                                  CAP065
     C                     ENDIF
      *
     C           P#MODE    IFEQ 'F'                                       CAP065
     C                     OPEN LEIFACPD                                  CAP065
     C                     OPEN LEIFACL1                                  CAP065
     C                     OPEN LEIFACL2                                  CAP065
     C                     OPEN LEIFACLX                                  CAP065
     C                     OPEN LE2020DF                                  CAP065
     C                     MOVE *ON       *IN89                           CAP065
     C                     MOVE ##USR     S#USER                          CAP065
     C                     MOVE ##JOB     S#WSID                          CAP065
     C                     MOVE RUNA      S#RUNA                          CAP065
     C                     MOVELSCDELT    S1EQDL                          CAP065
     C                     MOVE SCUPDT    S1AMND                          CAP065
     C                     MOVE *BLANKS   S1RVRS                          CAP065
     C                     MOVE *BLANKS   S1CLOS                          CAP065
     C                     MOVE *BLANKS   S1XAUT                          CAP065
     C                     MOVE *BLANKS   S1ISRT                          CAP065
     C*                                                                   CAP065
     C                     ELSE                                           CAP065
     C                     MOVE SCRVRS    S1RVRS                          CAP065
     C                     MOVE SCCLOS    S1CLOS                          CAP065
     C                     MOVE SCXAUT    S1XAUT                          CAP065
     C                     MOVE SCISRT    S1ISRT                          CAP065
     C                     MOVE SCENQR    S1EQDL                          CAP065
     C                     MOVELSCAMND    S1AMND                          CAP065
     C                     ENDIF                                          CAP065
      *
     C                     MOVE 'N'       S1AUTH
      *
     C                     ENDSR
      /EJECT                                                              156297
      *****************************************************************   156297
      *  SRCKFR  -  Check if the Facility has been reactivated.       *   156297
      *  Called by: AMENDS - Process amendment                        *   156297
      *  Calls    : None                                              *   156297
      *****************************************************************   156297
      *                                                                   156297
     C           SRCKFR    BEGSR                                          156297
      *                                                                   156297
     C           K#KY12    SETLLLEFCAML3                                  156297
     C           K#KY12    READELEFCAML3                 80               156297
      *                                                                   156297
     C           *IN80     DOWEQ*OFF                                      156297
     C           WREAC     ANDEQ*OFF                                      156297
     C           D3RECI    IFEQ 'D'                                       156297
     C           FATP      ANDEQ'FR'                                      156297
     C                     Z-ADDNDEX      WNDTEX                          156297
     C                     MOVE *ON       WREAC                           156297
     C                     ENDIF                                          156297
     C           K#KY12    READELEFCAML3                 80               156297
     C                     ENDDO                                          156297
      *                                                                   156297
     C                     MOVE *OFF      *IN80                           156297
      *                                                                   156297
     C                     ENDSR                                          156297
      *
      /EJECT                                                              CAP065
      *****************************************************************   CAP065
      *  DLTINV  -  Delete an invalid facility from the invalid       *   CAP065
      *             facilities file                                   *   CAP065
      *  Called by: PROSEL                                            *   CAP065
      *  Calls    : LE2031                                            *   CAP065
      *****************************************************************   CAP065
     C*                                                                   CAP065
     C           DLTINV    BEGSR                                          CAP065
     C*                                                                   CAP065
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
      *                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     MOVE 'Y'       SUPSYS  1                       CSC011
     C                     ELSE                                           CSC011
     C                     MOVE 'N'       SUPSYS                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     CALL 'LE2031'                                  CAP065
      * Invalid file name                                                 CAP065
     C                     PARM 'LEIFACPD'INVFIL  8                       CAP065
      * Repair Number                                                     CAP065
     C                     PARM XREPN     IREPN   50                      CAP065
      **Support*System On                                          CSC011 222373
     C**********           PARM SUPSYS    SUPSYS                   CSC011 222373
      **Front*Office ID / PC Transaction Reference                 CSC011 222373
     C**********           PARM STNRF     STNRF                    CSC011 222373
      **Transaction Timestamp                                      CSC011 222373
     C**********           PARM STMST     STMST                    CSC011 222373
     C*                                                                   CAP065
     C                     ENDSR                                          CAP065
     C*                                                                   CAP065
      /EJECT                                                              CAP065
      *****************************************************************   CAP065
      *  MAPINV  -  Map the fields to the invalid facilities file     *   CAP065
      *             LEIFACPD                                          *   CAP065
      *  Called by: SBERR                                             *   CAP065
      *  Calls    : None                                              *   CAP065
      *****************************************************************   CAP065
      *                                                                   CAP065
     C           MAPINV    BEGSR                                          CAP065
      *                                                                   CAP065
     C                     MOVEL@USER     SUSRL                           CAP065
     C                     MOVELZAMSID    XMSID                           CAP065
      *                                                                   CAP065
     C                     MOVELS1CUST    SFCNM                           CAP065
     C                     MOVELS1FACT    SFACT                           CAP065
     C                     MOVELS1FCNO    SFCNO                           CAP065
     C                     MOVELS2FCCY    SFCCY                           CAP065
     C                     MOVELS2BRCA    SBRCA                           CAP065
     C                     MOVELS3SYIN    SSYIN                           CAP065
      *                                                                   CAP065
     C                     MOVELS1ACTN    SACTN                           CAP065
     C                     MOVELS2ORBR    SORBR                           CAP065
     C                     MOVELS2FCTI    SFCTI                           CAP065
     C                     MOVELS2FAMT    SFAMT                           CAP065
     C                     MOVELS2OVPC    SOVPC                           CAP065
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVELS2OVAM    SOVAM                                               CLE034
     C                     ENDIF                                                              CLE034
     C*                                                                   CAP065
     C                     MOVE S2DTAP    ZDATE                           CAP065
     C                     EXSR ZDATE1                                    CAP065
     C                     MOVE ZDAYNO    SDTAP                           CAP065
     C*                                                                   CAP065
     C                     MOVELS2DTEX    ZDATE                           CAP065
     C                     EXSR ZDATE1                                    CAP065
     C                     MOVE ZDAYNO    SDTEX                           CAP065
     C*                                                                   CAP065
     C                     MOVELS2RVCR    SRVCR                           CAP065
     C                     MOVELS2SECI    SSECI                           CAP065
     C                     MOVELS2MCCY    SMCCY                           CAP065
     C                     MOVELS2MCSI    SMCSI                           CAP065
     C                     MOVELS2MBFC    SMBFC                           CAP065
     C                     MOVELS2NACD    SNACD                           CAP065
     C                     MOVELS2CRSK    SCRSK                           CAP065
     C*                                                                   CAP065
     C                     MOVELS2DLFS    ZDATE                           CAP065
     C                     EXSR ZDATE1                                    CAP065
     C                     MOVE ZDAYNO    SDLFS                           CAP065
     C*                                                                   CAP065
     C                     MOVELS2NOMR    SNOMR                           CAP065
     C*                                                                   CAP065
     C                     MOVELS2RVDT    ZDATE                           CAP065
     C                     EXSR ZDATE1                                    CAP065
     C                     MOVE ZDAYNO    SRVDT                           CAP065
     C*                                                                   CAP065
     C                     MOVELS2RVFR    SRVFR                           CAP065
     C                     MOVELS2RVDY    SRVDY                           CAP065
     C                     MOVELS2NAR1    SNAR1                           CAP065
     C                     MOVELS2NAR2    SNAR2                           CAP065
     C                     MOVELS2NAR3    SNAR3                           CAP065
     C                     MOVELS2NAR4    SNAR4                           CAP065
     C                     MOVELS2ACOF    SACOF                           CAP065
     C                     MOVELS2PRFC    SPRFC                           CAP065
     C                     MOVELS2BTIN    SBTIN                           CAP065
     C                     MOVELS2BLDY    SBLDY                           CAP065
     C                     MOVELS2ACSQ    SACSQ                           CAP065
     C                     MOVELS3ANUM    SANUM                           CAP065
     C                     MOVELS3DTS1    SDTS1                           CAP065
     C                     MOVELS3DTS2    SDTS2                           CAP065
     C                     MOVELS3DTS3    SDTS3                           CAP065
     C                     MOVELS3DTS4    SDTS4                           CAP065
     C                     MOVELS3DTS5    SDTS5                           CAP065
     C                     MOVELS3RTS1    SRTS1                           CAP065
     C                     MOVELS3RTS2    SRTS2                           CAP065
     C                     MOVELS3RTS3    SRTS3                           CAP065
     C                     MOVELS3RTS4    SRTS4                           CAP065
     C                     MOVELS3RTS5    SRTS5                           CAP065
     C                     MOVELS3RTS6    SRTS6                           CAP065
     C                     MOVELS3RLPD    SRLPD                           CAP065
     C                     MOVELS3DICB    SDICB                           CAP065
     C                     MOVELS3CSEL    SCSEL                           CAP065
     C                     MOVELS3CY01    SCY01                           CAP065
     C                     MOVELS3CY02    SCY02                           CAP065
     C                     MOVELS3CY03    SCY03                           CAP065
     C                     MOVELS3CY04    SCY04                           CAP065
     C                     MOVELS3CY05    SCY05                           CAP065
     C                     MOVELS3CY06    SCY06                           CAP065
     C                     MOVELS3CY07    SCY07                           CAP065
     C                     MOVELS3CY08    SCY08                           CAP065
     C                     MOVELS3CY09    SCY09                           CAP065
     C                     MOVELS3CY10    SCY10                           CAP065
     C                     MOVELS3CY11    SCY11                           CAP065
     C                     MOVELS3CY12    SCY12                           CAP065
     C*                                                                   CAP065
     C                     MOVELS3COMD    ZDATE                           CAP065
     C                     EXSR ZDATE1                                    CAP065
     C                     MOVE ZDAYNO    SCOMD                           CAP065
     C*                                                                   CAP065
     C                     MOVELS3CDTE    ZDATE                           CAP065
     C                     EXSR ZDATE1                                    CAP065
     C                     MOVE ZDAYNO    SCDTE                           CAP065
     C*                                                                   CAP065
     C                     MOVELS3AVLD    ZDATE                           CAP065
     C                     EXSR ZDATE1                                    CAP065
     C                     MOVE ZDAYNO    SAVLD                           CAP065
     C*                                                                   CAP065
     C                     MOVELS3LPTP    SLPTP                           CAP065
     C                     MOVELS3LPBR    SLPBR                           CAP065
     C                     MOVELS3LPAM    SLPAM                           CAP065
     C                     MOVELS3LPPS    SLPPS                           CAP065
     C                     MOVELS3DFTP    SDFTP                           CAP065
     C                     MOVELS3DFST    SDFST                           CAP065
     C                     MOVELS3TRCA    STRCA                           CAP065
     C                     MOVELS3CANM    SCANM                           CAP065
     C                     MOVELS3CAFT    SCAFT                           CAP065
     C                     MOVELS3CAFN    SCAFN                           CAP065
     C                     MOVELS3SYCP    SSYCP                           CAP065
     C                     MOVELS3CMDI    SCMDI                           CAP065
     C                     MOVELS3CAXR    SCAXR                           CAP065
     C                     MOVELS3LAID    SLAID                           CAP065
      *                                                                   CAP065
     C                     MOVELF1PRTR    SPRTR                           CAP065
     C                     MOVELF1TNRF    STNRF                           CSC011
     C*                                                                   CSC011
      * If the Time and Date fields provided from Front Office are        CSC011
      * blank then obtain current date/time to populate the transaction   CSC011
      * timestamp field                                                   CSC011
     C           F1TRTS    IFEQ *BLANKS                                   CSC011
     C           F1TRDS    OREQ *BLANKS                                   CSC011
      *                                                                   CSC011
     C                     CALL 'ZAGENTS'                                 CSC011
     C                     PARM ZATMST    ZATMST 26                       CSC011
     C                     MOVE ZATMST    STMST                           CSC011
      *                                                                   CSC011
     C                     ELSE                                           CSC011
     C                     MOVE F1TRDS    TDATE                           CSC011
     C                     MOVE TYY       TSTYY                           CSC011
     C                     MOVE TMM       TSTMM                           CSC011
     C                     MOVE TDD       TSTDD                           CSC011
     C                     MOVE F1TRTS    WTSTM                           CSC011
     C                     MOVE WTSHR     TSTTM1                          CSC011
     C                     MOVE WTSMN     TSTTM2                          CSC011
     C                     MOVE WTSSC     TSTTM3                          CSC011
     C                     MOVE '000000'  TSTTM4                          CSC011
     C                     MOVE TSTISO    STMST                           CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     MOVELF1TRTS    STNRF                           CSC011
      *                                                                   CAP065
     C                     ENDSR                                          CAP065
      *                                                                   CSC011
      /EJECT                                                              CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
      *  LOG247  -  Convert fields to the format required to be       *   CSC011
      *             written to the 24x7 Midas Availability Log        *   CSC011
      *  Called by: UPDFLE                                            *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           LOG247    BEGSR                                          CSC011
      *                                                                   CSC011
     C           P#MODE    IFNE 'B'                                       CSC011
     C                     CLEARP#F1MF                                    CSC011
     C                     MOVE 'FCTY'    F1MSGT                          CSC011
     C                     MOVE ##USR     F1TRUS                          CSC011
     C                     MOVE ##JOB     F1TRWS                          CSC011
     C                     MOVE *BLANKS   F1TRSN                          CSC011
     C                     MOVE S1ACTN    F1ACTN                          CSC011
     C*                                                                   CSC011
     C                     MOVEL'LE'      W#MSGT  6                       CSC011
     C                     MOVE F1MSGT    W#MSGT                          CSC011
     C                     MOVELW#MSGT    APMTYP                          CSC011
     C                     MOVE '  '      APMTYP                          CSC011
     C                     MOVELF1TNRF    APSOFC                          CSC011
     C*                                                                   CSC011
     C                     MOVE STMST     APSTMS                          CSC011
      *                                                                   CSC011
      ** If timestamp field is blank, then call ZAGENTS to set it up      CSC011
      *                                                                   CSC011
     C           APSTMS    IFEQ *BLANKS                                   CSC011
     C                     CALL 'ZAGENTS'                                 CSC011
     C                     PARM ZATMST    ZATMST 26                       CSC011
     C                     MOVE ZATMST    APSTMS                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     MOVE TSTISO    WTSTIS 26                       CSC011
     C                     MOVE APSTMS    TSTISO                          CSC011
      *                                                                   CSC011
     C* Timestamp has already been generated in subroutine MAPINV         CSC011
      *                                                                   CSC011
     C           F1TRTS    IFEQ *BLANKS                                   CSC011
     C                     MOVELTSTTM1    WSTM1   40                      CSC011
     C                     MOVE TSTTM2    WSTM1                           CSC011
     C                     MOVELTSTTM3    WSTM2   40                      CSC011
     C                     MOVELTSTTM4    WSTM3   20                      CSC011
     C                     MOVELWSTM1     F1TRTS                          CSC011
     C                     MOVE WSTM3     WSTM2                           CSC011
     C                     MOVE WSTM2     F1TRTS                          CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C           F1TRDS    IFEQ *BLANKS                                   CSC011
     C                     MOVE TSTYY     TYY                             CSC011
     C                     MOVE TSTMM     TMM                             CSC011
     C                     MOVE TSTDD     TDD                             CSC011
     C                     MOVE TDATE     F1TRDS                          CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     MOVE WTSTIS    TSTISO                          CSC011
     C*                                                                   CSC011
     C                     Z-ADD1         F1NRBA                          CSC011
     C                     MOVE *BLANKS   F1RPLC                          CSC011
     C                     MOVE *BLANKS   F1FIL3                          CSC011
     C                     MOVE S2CNUM    F1CNUM                          CSC011
     C                     MOVE S1FACT    F1FACT                          CSC011
     C                     MOVE S1FCNO    F1FCNO                          CSC011
     C                     MOVE S2BRCA    F1BRCA                          CSC011
     C                     MOVE S2ORBR    F1ORBR                          CSC011
     C                     MOVE S2FCTI    F1FCTI                          CSC011
     C                     MOVE S2FCCY    F1FCCY                          CSC011
     C                     MOVE S2FAMT    F1FAMT                          CSC011
     C                     MOVE S2OVPC    F1OVPC                          CSC011
     C                     MOVE S2DTAP    F1DTAP                          CSC011
     C                     MOVE S2DTEX    F1DTEX                          CSC011
     C                     MOVE S2RVCR    F1RVCR                          CSC011
     C                     MOVE S2SECI    F1SECI                          CSC011
     C                     MOVE S2MCCY    F1MCCY                          CSC011
     C                     MOVE S2MCSI    F1MCSI                          CSC011
     C                     MOVE S2MBFC    F1MBFC                          CSC011
     C                     MOVE S2NACD    F1NACD                          CSC011
     C                     MOVE S2CRSK    F1CRSK                          CSC011
     C                     MOVE S2DLFS    F1DLFS                          CSC011
     C                     MOVE S2NOMR    F1NOMR                          CSC011
     C                     MOVE S2RVDT    F1RVDT                          CSC011
     C                     MOVE S2RVFR    F1RVFR                          CSC011
     C                     MOVE S2RVDY    F1RVDY                          CSC011
     C                     MOVE S2NAR1    F1NAR1                          CSC011
     C                     MOVE S2NAR2    F1NAR2                          CSC011
     C                     MOVE S2NAR3    F1NAR3                          CSC011
     C                     MOVE S2NAR4    F1NAR4                          CSC011
     C                     MOVE S2ACOF    F1ACOF                          CSC011
     C                     MOVE S2PRFC    F1PRFC                          CSC011
     C                     MOVE S2BTIN    F1BTIN                          CSC011
     C                     MOVE S2BLDY    F1BLDY                          CSC011
     C                     MOVE S3SYIN    F1SYIN                          CSC011
     C                     MOVE S3ANUM    F1ANUM                          CSC011
     C                     MOVE S3DTX5    F1DTPS                          CSC011
     C                     MOVE S3RTX6    F1RTPS                          CSC011
     C                     MOVE S3RLPD    F1RLPD                          CSC011
     C                     MOVE S3DICB    F1DICB                          CSC011
     C                     MOVE S3CSEL    F1CSEL                          CSC011
     C                     MOVE S3ACCY    F1ALCY                          CSC011
     C                     MOVE S3COMD    F1COMD                          CSC011
     C                     MOVE S3CDTE    F1CDTE                          CSC011
     C                     MOVE S3AVLD    F1AVLD                          CSC011
     C                     MOVE S3LPTP    F1LPTP                          CSC011
     C                     MOVE S3LPBR    F1LPBR                          CSC011
     C                     MOVE S3LPAM    F1LPAM                          CSC011
     C                     MOVE S3LPPS    F1LPPS                          CSC011
     C                     MOVE S3DFTP    F1DFTP                          CSC011
     C                     MOVE S3DFST    F1DFST                          CSC011
     C                     MOVE S3TRCA    F1TRCA                          CSC011
     C                     MOVE S3CANM    F1CANM                          CSC011
     C                     MOVE S3CAFT    F1CAFT                          CSC011
     C                     MOVE S3CAFN    F1CAFN                          CSC011
     C                     MOVE S2ACSQ    F1ACSQ                          CSC011
     C                     MOVE IUSR      F1IUSR                          CSC011
     C                     MOVE AUSR      F1AUSR                          CSC011
     C                     MOVE XUSR      F1XUSR                          CSC011
     C                     MOVE S3SYCP    F1SYCP                          CSC011
     C                     MOVE SPRTR     F1PRTR                          CSC011
     C                     MOVE S3PMFC    F1PMFC                          CSC011
     C                     MOVE S3PMFT    F1PMFT                          CSC011
     C                     MOVE S3PMFN    F1PMFN                          CSC011
     C**********           Z-ADDINUM      F1INUM                                       CSC011 CSD027
     C                     MOVE INUM      F1INUM                                              CSD027
     C                     MOVE JDTE      F1JDTE                          CSC011
     C                     MOVE VDTC      F1VDTC                          CSC011
     C                     MOVE SHTP      F1SHTP                          CSC011
     C                     MOVE SHPC      F1SHPC                          CSC011
     C                     MOVE RCSI      F1RCSI                          CSC011
     C                     MOVE SKIS      F1SKIS                          CSC011
     C                     MOVE SKIR      F1SKIR                          CSC011
     C                     MOVE SKFS      F1SKFS                          CSC011
     C                     MOVE SKFR      F1SKFR                          CSC011
     C                     Z-ADDPSTM      F1PSTM                          CSC011
     C                     MOVE OMDB      F1OMDB                          CSC011
     C                     MOVE PONS      F1PONS                          CSC011
     C                     MOVE RVNO      F1RVNO                          CSC011
     C                     MOVE CVMR      F1CVMR                          CSC011
     C**********           Z-ADDPOCN      F1POCN                                       CSC011 CSD027
     C**********           Z-ADDPOBN      F1POBN                                       CSC011 CSD027
     C                     MOVE POCN      F1POCN                                              CSD027
     C                     MOVE POBN      F1POBN                                              CSD027
     C                     MOVE RCRN      F1RCRN                          CSC011
     C                     MOVE RCRA      F1RCRA                          CSC011
     C                     MOVE PIBN      F1PIBN                          CSC011
     C                     MOVE PIBA      F1PIBA                          CSC011
     C                     MOVE AWBN      F1AWBN                          CSC011
     C                     MOVE AWBA      F1AWBA                          CSC011
     C                     MOVE BENN      F1BENN                          CSC011
     C                     MOVE BENA      F1BENA                          CSC011
     C                     Z-ADDRSTM      F1RSTM                          CSC011
     C                     MOVE OSDB      F1OSDB                          CSC011
     C                     MOVE RONS      F1RONS                          CSC011
     C**********           Z-ADDROCN      F1ROCN                                       CSC011 CSD027
     C**********           Z-ADDROBN      F1ROBN                                       CSC011 CSD027
     C                     MOVE ROCN      F1ROCN                                              CSD027
     C                     MOVE ROBN      F1ROBN                                              CSD027
     C                     MOVE RIBN      F1RIBN                          CSC011
     C                     MOVE RIBA      F1RIBA                          CSC011
     C                     MOVE DTP1      F1DTP1                          CSC011
     C                     MOVE DTP2      F1DTP2                          CSC011
     C                     MOVE DTP3      F1DTP3                          CSC011
     C                     MOVE DTP4      F1DTP4                          CSC011
     C                     MOVE DCHG      F1DCHG                          CSC011
     C                     MOVE BTB1      F1BTB1                          CSC011
     C                     MOVE BTB2      F1BTB2                          CSC011
     C                     MOVE BTB3      F1BTB3                          CSC011
     C                     MOVE BTB4      F1BTB4                          CSC011
     C                     MOVE BTB5      F1BTB5                          CSC011
     C                     MOVE BTB6      F1BTB6                          CSC011
     C                     MOVE PCOB      F1PCOB                          CSC011
     C                     MOVE CMDI      F1CMDI                          CSC011
     C                     MOVE CAXR      F1CAXR                          CSC011
     C                     MOVE SCCY      F1SCCY                          CSC011
     C                     MOVE ICCY      F1ICCY                          CSC011
     C                     MOVE LAID      F1LAID                          CSC011
     C                     MOVE PASI      F1PASI                          CSC011
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE S2OVAM    F1OVAM                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     ENDSR                                          CSC011
      *                                                                   CSC011
      /EJECT                                                              CSC011
      *****************************************************************   CSC011
      *  APLGTR  -  Write facility transaction to the 24X7 Midas      *   CSC011
      *             availability Log File                             *   CSC011
      *  Called by: UPDFLE                                            *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           APLGTR    BEGSR                                          CSC011
      *                                                                   CSC011
     C                     MOVELP#F1MF    APTRAN                          CSC011
      *                                                                   CSC011
     C           LOGVAL    IFEQ 'V'                                       CSC011
     C                     OPEN APVLOGPD                                  CSC011
     C                     WRITEAPVLOGD0                                  CSC011
     C                     CLOSEAPVLOGPD                                  CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C           LOGVAL    IFEQ 'I'                                       CSC011
     C                     OPEN APILOGPD                                  CSC011
     C                     WRITEAPILOGD0                                  CSC011
     C                     CLOSEAPILOGPD                                  CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     ENDSR                                          CSC011
      *                                                                   CSC011
      /EJECT                                                              CSC011
      *****************************************************************   CSC011
      *  LOGDEL  -  Delete record from 24x7 Midas availability log    *   CSC011
      *             file                                              *   CSC011
      *  Called by: AUTHOS, RESRVS, CLOSES, WRITER, AMENDR            *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           LOGDEL    BEGSR                                          CSC011
      *                                                                   CSC011
     C                     MOVEL'LE'      W#MSGT                          CSC011
     C                     MOVE F1MSGT    W#MSGT                          CSC011
     C                     MOVELW#MSGT    KMTYPE                          CSC011
     C                     MOVE '  '      KMTYPE                          CSC011
     C                     MOVELSTNRF     KFOID                           CSC011
     C                     MOVE STMST     KTSTMP                          CSC011
      *                                                                   CSC011
     C                     OPEN APILOGL0                                  CSC011
     C           KAPLOG    CHAINAPILOGX0             99                   CSC011
     C           *IN99     IFEQ *OFF                                      CSC011
     C                     DELETAPILOGX0                                  CSC011
     C                     ENDIF                                          CSC011
     C                     CLOSEAPILOGL0                                  CSC011
      *                                                                   CSC011
     C                     ENDSR                                          CSC011
      /EJECT                                                                                  194864
      *****************************************************************                       194864
      *  CONVTR  -  Converts TR amount to CA amount.                  *                       194864
      *  Called by: VLDCRA - Validates Tranche and Credit Agreement   *                       194864
      *  Calls    : None                                              *                       194864
      *****************************************************************                       194864
      *                                                                                       194864
     C           CONVTR    BEGSR                                                              194864
      *                                                                                       194864
     C                     Z-ADD*ZERO     WFCBAL                                              194864
     C                     Z-ADD*ZERO     TRFAMT                                              194864
      *                                                                                       194864
      ** Need to obtain the correct cross rate between CA and TR                              194864
      ** credit facility currency                                                             194864
      *                                                                                       194864
     C                     MOVELWCACCY    WCURR                                               194864
     C                     EXSR SRCURR                                                        194864
     C                     Z-ADDA6NBDP    CNBDP   10                                          194864
      *                                                                                       194864
     C                     MOVELTRCCY     WCURR                                               194864
     C                     EXSR SRCURR                                                        194864
     C                     Z-ADDA6NBDP    TNBDP   10                                          194864
      *                                                                                       194864
     C           TRYES     IFNE 'Y'                                                           194864
      *                                                                                       194864
     C           S1ACTN    IFEQ 'I'                                                           194864
     C           S1ACTN    OREQ 'A'                                                           194864
     C           WSVFX     ANDNETRCAXR                                                        194864
     C           WSVFX     ANDNE0                                                             202011
      *                                                                                       194864
     C                     Z-ADDWSVFX     WEXTR  138                                          194864
     C                     MOVE S3CMDI    CMDIN                                               194864
      *                                                                                       194864
     C                     ELSE                                                               194864
      *                                                                                       194864
      ** If not insert, use the CA exchange rate from the                                     194864
      ** facility file.                                                                       194864
      *                                                                                       194864
     C                     Z-ADDTRCAXR    WEXTR                                               194864
     C                     MOVE TRCMDI    CMDIN   1                                           194864
     C                     ENDIF                                                              194864
      *                                                                                       194864
     C                     ELSE                                                               194864
     C                     Z-ADDLECAXR    WEXTR                                               194864
     C                     MOVE LECMDI    CMDIN                                               194864
     C                     ENDIF                                                              194864
      *                                                                                       194864
     C           CNBDP     SUB  TNBDP     WCX     10                                          194864
     C                     ADD  4         WCX                                                 194864
      *                                                                                       194864
     C           CMDIN     IFEQ 'D'                                                           202011
     C           WEXTR     DIV  POWR,WCX  WEXRT2 138H                                         194864
     C           1         DIV  WEXRT2    WEXRT2                                              194864
     C                     ELSE                                                               194864
     C           WEXTR     MULT POWR,WCX  WEXRT2    H                                         194864
     C                     ENDIF                                                              194864
      *                                                                                       194864
     C           TRAMT     MULT WEXRT2    WFCBAL 130H                                         202011
     C                     Z-ADDWFCBAL    TRFAMT 130H                                         194864
      *                                                                                       194864
     C                     ENDSR                                                              194864
      *                                                                   CSC011
      /EJECT                                                              CSC011
      *****************************************************************
      *                                                               *
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *                                                               *
      *****************************************************************
     C           *PSSR     BEGSR                           ** *PSSR SR **
      *
     C           @RUN      IFEQ *BLANK
      *
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     MOVE *ON       *INU7
     C                     MOVE *ON       *INU8
     C                     MOVE *ON       *INLR
     C                     MOVE 'D'       F2MSGS
      *
     C           P#MODE    IFNE 'P'
     C           P#MODE    ANDNE'B'
     C                     ROLBK
     C                     CALL 'DBERRCTL'
     C                     ENDIF
      *
     C                     RETRN
      *
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
     C/COPY ZSRSRC,ZALIGNZ2L
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZEDITZ2L
      /EJECT
     C/COPY ZSRSRC,ZFWDT
      /EJECT
     C/COPY ZSRSRC,ZACCH
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z2
      /EJECT
     C/COPY ZSRSRC,ZTNLU1Z2
      /EJECT                                                              133796
     C/COPY ZSRSRC,ZCHKH                                                  133796
      /EJECT                                                              133402
     C/COPY ZSRSRC,ZXRATEZ1                                               133402
      /EJECT                                                                                  194540
      /COPY ZSRSRC,ZSEDITZ3                                                                   194540
      *                                                                                       CLE028
      ** Elements of Array ADT were amended to include 'F'.                                   CLE028
      *                                                                                       CLE028
**  POWR -- USED IN CURRENCY CONVERSION(FACILITY)                                             194864
0000001                                                                                       194864
0000010                                                                                       194864
0000100                                                                                       194864
0001000                                                                                       194864
0010000                                                                                       194864
0100000                                                                                       194864
1000000                                                                                       194864
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** ADT
 CTDRMF                                                                                       CLE028
** ARO
 MTQXYZ
** STAMP - Dummy timestamp                                                                    CPK015
0001-01-01-00.00.00.000000                                                                    CPK015
** WDRPT **      Table of Facility's Drawing Types and Loan Processing Types                  208485
C61                                                                                           208485
C68                                                                                           208485
C69                                                                                           208485
T62                                                                                           208485
T64                                                                                           208485
T66                                                                                           208485
D63                                                                                           208485
D65                                                                                           208485
D67                                                                                           208485
R70                                                                                           208485
R71                                                                                           208485
R72                                                                                           208485
F80                                                                                           208485
** CPY@
(c) Finastra International Limited 2001
