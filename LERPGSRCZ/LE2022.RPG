     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Risk participants maintenance')               *
      *****************************************************************
      *                                                               *
      *  Midas - Customer Lending Module                              *
      *                                                               *
      *  LE2022 - Risk Participants Maintenance                       *
      *                                                               *
      *  Function:  This program will be run in one of five modes:    *
      *             1. Mode 'I' - Interactive                         *
      *                The program is called from LE2020, facilities  *
      *             input. Data is processed through a screen in the  *
      *             standard way.                                     *
      *                                                               *
      *             2. Mode 'E' - Interactive Enquiry                 *
      *                The program is called from LE0170, facilities  *
      *             enquiry. It may also be called from LE2020,       *
      *             facilities input, where it is appropriate to      *
      *             restrict the action to enquiry. Data is processed *
      *             via a screen as in mode 1.                        *
      *                                                               *
      *             3. Mode 'R' - Record                              *
      *                The program is run interactively through a     *
      *             Midas test environment, and data is processed     *
      *             through a screen as in 1. At the point when       *
      *             updates are performed a record is written to a    *
      *             'test harness' physical file which will mirror    *
      *             exactly the contents of the screen.               *
      *                                                               *
      *             4. Mode 'P' - Play                                *
      *                The program is run interactively or in batch   *
      *             through a Midas test environment. Data is read in *
      *             from the 'test harness' file. Updates to the      *
      *             Midas database will be as done in 1.              *
      *                                                               *
      *             5. Mode 'B' - Batch                               *
      *                The program is run in batch and called by a    *
      *             communications control program. Data which has    *
      *             been entered in a PC subsystem is received from a *
      *             message queue and passed to the program as a      *
      *             parameter. Updates to the Midas database will be  *
      *             as done according to the contents of the parameter*
      *             and a returned message will be returned to the    *
      *             control program.                                  *
      *                                                               *
      *  Called By: LE2020 - Facility Details Maintenance             *
      *             LE0170 - Facility Details Enquiry                 *
      *  Calls    : SD2400 - Extended Settlements                     *
      *             SD2410 - Settlement Details Validation            *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CLE106             Date 11Mar05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 28Oct03               *
      *                 CLE034             Date 11Jun03               *
      *                 CLE031             Date 03Feb03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 28Jun02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 178424             Date 10May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 15May01               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 160706             Date 14May99               *
      *                 157594             Date 06Apr99               *
      *                 155538             Date 18Feb99               *
      *                 148847             Date 10Feb99               *
      *                 153650             Date 02Feb99               *
      *                 145908             Date 26Oct98               *
      *                 140807 (BT0805)    Date 15Feb99               *
      *                 158141 (BT0738)    Date 18MAY98               *
      *                 135152             Date 11Feb99               *
      *                 134293             Date 10Feb99               *
      *                 134031             Date 10Feb99               *
      *                 134008             Date 10Feb99               *
      *                 133855             Date 10Feb99               *
      *                 133789             Date 09Feb99               *
      *                 133620             Date 09Feb99               *
      *                 133619             Date 09Feb99               *
      *                 133613             Date 09Feb99               *
      *                 133411             Date 09Feb99               *
      *                 133253             Date 05Feb99               *
      *                 132687             Date 05Feb99               *
      *                 132283             Date 04Feb99               *
      *                 CEU004             Date 02Feb98               *
      *                 CLE005  *CREATE    Date 22May97               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *           (Recompile)                                         *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c             *
      *           (Recompile)                                         *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  CLE106 - Syndication Manager (Recompile)                     *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter Mismatch                                  *
      *  CLE034 - Lending Enhancements for Phase 1 Priority1A         *
      *  CLE031 - Lending Enhancements (Recompile)                    *
      *  CPK015 - Release 4.01 Packaging:                             *
      *           - A default timestamp string is required for WRITE. *
      *  178424 - Upon pressing F22 when enquiring on or amending an  *
      *           expired syndicated facility, system encounters a    *
      *           database error. Chain using LF LEFCLTL7, which      *
      *           includes expired facilities.                        *
      *  CSD006 - Use long DS with SDBSRTPD.                          *
      *  160706 - Customer number/shortname corruption. Move should   *
      *           be move-left in several instances.                  *
      *  157594 - Cross reference risk parts sold to funding parts    *
      *           sold, so risk can only be sold on portion of loan   *
      *           which is held by customer.                          *
      *  155538 - PCRF field not setup correctly                      *
      *  148847 - Screen handling/workflow is wrong after second      *
      *           screen.                                             *
      *  153650 - Client names should be shown (Apply fix 140835)     *
      *  145908 - Midas standard Processing errors                    *
      *  140807 - Retail flags not being passed to settlement         *
      *           validation program.                                 *
      *  135152 - There needs to be a separate standard settlement    *
      *           instruction transaction type for Lending - use of   *
      *           'MM' is not sufficiently flexible                   *
      *  134293 - Supress the 'Record Updated' message to LM          *
      *  134031 - Entering a Risk Participant from the PC results in  *
      *           error on insert of syndicate member.                *
      *  134008 - Extended settlement instructions are not setting up *
      *           the branch correctly for '05' method.               *
      *  133855 - The amounts and percentages are not saved correctly *
      *  158141 - ZDATE1 COPES WITH AMERICAN FORMAT SO DO NOT HAVE    *
      *           TO CHANGE IT EXPLICITLY                             *
      *  133789 - Fee Settlements '05' are defaulting to the account  *
      *           but not including the branch.                       *
      *  133620 - The wrong PC reference is being picked up and       *
      *           entered on file.                                    *
      *  133619 - No message is sent for an insert from the PC.       *
      *  133613 - Allow entry of both spread rate and base rate, plus *
      *           fix dump for batch mode errors.                     *
      *  133411 - Supress the 'Record added' message to Loan Manager  *
      *  133253 - Risk participants are not being written to LEPARTPD *
      *  132687 - Subfile crashes when there are no records displayed *
      *           and enter is taken.                                 *
      *  132283 - Risk Part type/sub type needs to be mandatory       *
      *           F3 from ext settle screen updates the file.         *
      *  CEU004 - LE Settlement Ccy Conversion Upgrade to DBA R2.0    *
      *  CLE005 - Customer Lending Enhancements - Tranche 3           *
      *                                                               *
      *****************************************************************
      *                                                               *
      *    F U N C T I O N   O F   I N D I C A T O R S                *
      *                                                               *
      *    01      .........................................          *
      *    02      .........................................          *
      *    03      F3 - Exit Program                                  *
      *    04      .........................................          *
      *    05      F5 - Refresh Screen                                *
      *    06      .........................................          *
      *    07      Enquiry Mode                                       *
      *    08      Amend Mode                                         *
      *    09      F9 - Insert Mode                                   *
      *    10      F10 - Delete Mode                                  *
      *    11      .........................................          *
      *    12      F12 - Go to Previous Screen                        *
      *    13      .........................................          *
      *    14      F14 - Settlement Screen                            *
      *    15      .........................................          *
      *    16      .........................................          *
      *    17      .........................................          *
      *    18      .........................................          *
      *    19      .........................................          *
      *    20      .........................................          *
      *    21      .........................................          *
      *    22      .........................................          *
      *    23      .........................................          *
      *    24      .........................................          *
      *    25      .........................................          *
      *    26      .........................................          *
      *    27      .........................................          *
      *    28      .........................................          *
      *    29      Chain to Subfile                                   *
      *    30      Subfile Display (SFLDSP)                           *
      *    31      Subfile Display Control (SFLDSPCTL)                *
      *    32      Subfile End (SFLEND)                               *
      *    33      Subfile Clear (SFLCLR)                             *
      *    34      Display PAGE KEYS                                  *
      *    35      .........................................          *
      *    36      .........................................          *
      *    37      .........................................          *
      *    38      .........................................          *
      *    39      .........................................          *
      *    40      Invalid Subfile Selection                          *
      *    41      Invalid Syndicate Member                           *
      *    42      Invalid Introducing Customer                       *
      *    43      Invalid joining date                               *
      *    44      Invalid Share type                                 *
      *    45      Invalid Share (amount/percentage)                  *
      *    46      Invalid Fee Base Rate                              *
      *    47      Invalid Rate/Spread                                *
      *    48      Invalid Sign                                       *
      *    49      Invalid Loan Type                                  *
      *    50      Invalid Loan Sub-type                              *
      *    51      Invalid Review From                                *
      *    52      .........................................          *
      *    53      Protect Fee Base Rate Field                        *
      *    54      Protect Fee Rate/Spread Field                      *
      *    55      Protect Fields                                     *
      *    56      Enable F10                                         *
      *    57      .........................................          *
      *    58      .........................................          *
      *    59      .........................................          *
      *    60      No Records Found in Subfile                        *
      *    61      .........................................          *
      *    62      .........................................          *
      *    63      .........................................          *
      *    64      .........................................          *
      *    65      .........................................          *
      *    66      .........................................          *
      *    67      .........................................          *
      *    68      .........................................          *
      *    69      Used for TESTN                                     *
      *    70      Chain/Read Indicator                               *
      *    71      .........................................          *
      *    72      .........................................          *
      *    73      .........................................          *
      *    74      .........................................          *
      *    75      .........................................          *
      *    76      .........................................          *
      *    77      .........................................          *
      *    78      .........................................          *
      *    79      .........................................          *
      *    80      Read Indicator for LEPARTL1                        *
      *    81      Read Indicator for LEFCLTL0                        *
      *    82      Read Indicator for LEPARTL1                        *
      *    83      .........................................          *
      *    84      .........................................          *
      *    85      .........................................          *
      *    86      .........................................          *
      *    87      .........................................          *
      *    88      .........................................          *
      *    89      Message subfile                                    *
      *    90-99   Used by standard subroutine                        *
      *****************************************************************
      *                   Index to subroutines                        *
      *                   ~~~~~~~~~~~~~~~~~~~~                        *
      *  INITPR  -  Initial Processing                                *
      *  BLDSFL  -  Build Subfile                                     *
      *  MAPFLD  -  Map the input data read from the transmitted msg  *
      *  REVIEW  -  Interactive Processing                            *
      *  PROSEL  -  Process Enter from Subfile Screen                 *
      *  INSERT  -  Process Insert Screen                             *
      *  ENQRYS  -  Process Enquiry Screen                            *
      *  AMENDS  -  Process Amend Screen                              *
      *  DELETS  -  Process Delete Screen                             *
      *  VLDDET  -  Validate Detail Screen                            *
      *  VLDSFL  -  Validate Subfile and Position Fields              *
      *  VLDSEL  -  Validate Subfile Selection                        *
      *  VLDALL  -  Validate Action Codes                             *
      *  VLDENQ  -  Validate Action Codes for Interactive Enquiry     *
      *  VLDPOS  -  Validate Position Fields                          *
      *  VLDCUS  -  Validate Syndicate Member                         *
      *  VLDINC  -  Validate Introducing Customer                     *
      *  VLDJDT  -  Validate Joining Date                             *
      *  VLDSHR  -  Validate Share Type and Share Amount              *
      *  VLDRAT  -  Validate Fee Base Rate and Fee Rate/Spread        *
      *  VLDSGN  -  Validate Fee Rate/Spread Sign                     *
      *  VLDLON  -  Validate Risk Participation Loan Type/Sub-type    *
      *  WRITER  -  Write a record to LF/LEPARTL1                     *
      *  AMENDR  -  Amend a record in LF/LEPARTL1                     *
      *  DELETR  -  Delete a record in LF/LEPARTL1                    *
      *  LOADFM  -  Load Details to file                              *
      *  POPSCR  -  Move fields to screen                             *
      *  PRSETT  -  Load Settlement Details into File                 *
      *  UPDFLE  -  Update File                                       *
      *  AMOUNT  -  Accumulate the Participant Share Amounts          *
      *  KEY2    -  Chain facility to populate screen fields          *
      *  SR2410  -  Validate Settlement Details                       *
      *  SRWNDW  -  Window Processing Subroutine                      *
      *  FEXSET  -  Setup details for settlement screen               *
      *  MFSSCR  -  Move fields to settlement screen (SETLIAB)        *
      *  SHRTNM  -  Setup SETLIAZ (used in SD2410)                    *
      *  INITIS  -  Clear settlement screen for insert                *
      *  CF03    -  Terminate Program                                 *
      *  CF05    -  Refresh Screen                                    *
      *  CF10    -  Delete a record                                   *
      *  CF12    -  Move to previous screen                           *
      *  CF14    -  Move to settlement screen                         *
      *  CLRSC   -  Clear screen fields for insert                    *
      *  CLEARM  -  Clear message from the program message queue      *
      *  ZASNMS  -  Sends message to the program message queue        *
      *  SRBERR  -  Format Batch Error details                        *
      *  *PSSR   -  Error handling subroutine                         *
      *****************************************************************
      *
      **  Facilities File
     FLEFCLTL0IF  E           K        DISK         KINFSR *PSSR
     F            FCLTYFMF                          KRENAMEFCLT0
      **  Live and Expired Facilities Details File                        178424
     FLEFCLTL7IF  E           K        DISK         KINFSR *PSSR          178424
     F            FCLTYFMF                          KRENAMEFCLT7          178424
      *                                                                                       CLE034
      **  Live, Expired & Reversed Facilities Details File                                    CLE034
     FLEFCLRL7IF  E           K        DISK         KINFSR *PSSR                              CLE034
     F            FCLTYFMF                          KRENAMEFCLR7                              CLE034
      *
      **  Risk Participant Details File
     FLEPARTL1UF  E           K        DISK         KINFSR *PSSR A
     F                                              KCOMIT
      *
      **  Risk Participant Play/Record file
     FLE2022PDUF  E           K        DISK         KINFSR *PSSR A    UC
      *
      **  Workstation file
     FLE2022DFCF  E                    WORKSTN                        UC
     F                                        RRN1  KSFILE LE2022S1
     F                                              KINFSR *PSSR
      *                                                                   157594
      **  Facilities File                                                 157594
     FLEFCLTL2IF  E           K        DISK         KINFSR *PSSR          157594
     F            FCLTYFMF                          KRENAMEFCLT2          157594
      *                                                                   157594
      *
     E                    STAMP   1   1 26                                                    CPK015
      ** Array containing dummy timestamp                                                     CPK015
      **  Array containing Copyright statement
     E                    CPY@    1   1 80
     E/COPY ZSRSRC,ZALIGNZ1
      *
      **  Compile time arrays
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZDATE9Z1
     ILEPARTD0                                                                                CPK015
     I              STMP                            LPSTMP                                    CPK015
     ILE2022D0                                                                                CGL029
     I              QQPONS                          Q1PONS                                    CGL029
     I              QQRONS                          Q1RONS                                    CGL029
     IFCLT2                                                               157594
     I              RECI                            LERECI                157594
     I              CNUM                            LECNUM                157594
     I              FACT                            LEFACT                157594
     I              FCNO                            LEFCNO                157594
     I              RCTP                            LERCTP                157594
     I              BRCA                            LEBRCA                157594
     I              FCTI                            LEFCTI                157594
     I              FCCY                            LEFCCY                157594
     I              FAMT                            LEFAMT                157594
     I              OVPC                            LEOVPC                157594
     I              DTAP                            LEDTAP                157594
     I              DTEX                            LEDTEX                157594
     I              RVCR                            LERVCR                157594
     I              SECI                            LESECI                157594
     I              MCCY                            LEMCCY                157594
     I              MCSI                            LEMCSI                157594
     I              NACD                            LENACD                157594
     I              CRSK                            LECRSK                157594
     I              DLFS                            LEDLFS                157594
     I              NOMR                            LENOMR                157594
     I              RVDT                            LERVDT                157594
     I              RVFR                            LERVFR                157594
     I              RVDY                            LERVDY                157594
     I              NAR1                            LENAR1                157594
     I              NAR2                            LENAR2                157594
     I              NAR3                            LENAR3                157594
     I              NAR4                            LENAR4                157594
     I              MTDH                            LEMTDH                157594
     I              MTDL                            LEMTDL                157594
     I              MTDA                            LEMTDA                157594
     I              QTDA                            LEQTDA                157594
     I              YTDA                            LEYTDA                157594
     I              ACOF                            LEACOF                157594
     I              ORBR                            LEORBR                157594
     I              RVCD                            LERVCD                157594
     I              ORED                            LEORED                157594
     I              LCD                             LELCD                 157594
     I              CHTP                            LECHTP                157594
     I              TNLU                            LETNLU                157594
     I              SYIN                            LESYIN                157594
     I              ANUM                            LEANUM                157594
     I              DTPS                            LEDTPS                157594
     I              DICB                            LEDICB                157594
     I              RTPS                            LERTPS                157594
     I              RLPD                            LERLPD                157594
     I              CSEL                            LECSEL                157594
     I              ALCY                            LEALCY                157594
     I              COMD                            LECOMD                157594
     I              CDTE                            LECDTE                157594
     I              AVLD                            LEAVLD                157594
     I              LPTP                            LELPTP                157594
     I              LPBR                            LELPBR                157594
     I              LPAM                            LELPAM                157594
     I              LPPS                            LELPPS                157594
     I              DFTP                            LEDFTP                157594
     I              DFST                            LEDFST                157594
     I              TRCA                            LETRCA                157594
     I              CANM                            LECANM                157594
     I              CAFT                            LECAFT                157594
     I              CAFN                            LECAFN                157594
     I              ACSQ                            LEACSQ                157594
     I              FSTS                            LEFSTS                157594
     I              IUSR                            LEIUSR                157594
     I              AUSR                            LEAUSR                157594
     I              XUSR                            LEXUSR                157594
     I              SYCP                            LESYCP                157594
     I              PCRF                            LEPCRF                157594
     I              PRTR                            LEPRTR                157594
     I              PMFC                            LEPMFC                157594
     I              PMFT                            LEPMFT                157594
     I              PMFN                            LEPMFN                157594
     I              INUM                            LEINUM                157594
     I              JDTE                            LEJDTE                157594
     I              SHTP                            LESHTP                157594
     I              SHPC                            LESHPC                157594
     I              RCSI                            LERCSI                157594
     I              SKIR                            LESKIR                157594
     I              SKIS                            LESKIS                157594
     I              SKFR                            LESKFR                157594
     I              SKFS                            LESKFS                157594
     I              VDTC                            LEVDTC                157594
     I              OSDB                            LEOSDB                157594
     I              OMDB                            LEOMDB                157594
     I              RSTM                            LERSTM                157594
     I              RONS                            LERONS                157594
     I              RIBN                            LERIBN                157594
     I              RIBA                            LERIBA                157594
     I              ROBN                            LEROBN                157594
     I              ROCN                            LEROCN                157594
     I              PSTM                            LEPSTM                157594
     I              PONS                            LEPONS                157594
     I              PIBN                            LEPIBN                157594
     I              PIBA                            LEPIBA                157594
     I              POBN                            LEPOBN                157594
     I              POCN                            LEPOCN                157594
     I              RCRN                            LERCRN                157594
     I              RCRA                            LERCRA                157594
     I              RVNO                            LERVNO                157594
     I              AWBN                            LEAWBN                157594
     I              AWBA                            LEAWBA                157594
     I              BENN                            LEBENN                157594
     I              BENA                            LEBENA                157594
     I              DTP1                            LEDTP1                157594
     I              DTP2                            LEDTP2                157594
     I              DTP3                            LEDTP3                157594
     I              DTP4                            LEDTP4                157594
     I              DCHG                            LEDCHG                157594
     I              BTB1                            LEBTB1                157594
     I              BTB2                            LEBTB2                157594
     I              BTB3                            LEBTB3                157594
     I              BTB4                            LEBTB4                157594
     I              BTB5                            LEBTB5                157594
     I              BTB6                            LEBTB6                157594
     I              CVMR                            LECVMR                157594
     I              PCOB                            LEPCOB                157594
     I              CAXR                            LECAXR                157594
     I              CMDI                            LECMDI                157594
     I              CACY                            LECACY                157594
     I              PFTI                            LEPFTI                157594
     I              SCCY                            LESCCY                157594
     I              ICCY                            LEICCY                157594
     I              LAID                            LELAID                157594
     I              PASI                            LEPASI                157594
     IP#R1MF    E DSLER1MFPD
      **  IN Message Format
      *
     IP#R2MF    E DSLER2MFPD
      **  OUT Message Format
      *
     ILDA       E DSLDA                         256
      **  Local data area for database error details
      **  *LOCK IN LDA immediately before and OUT LDA immediately
      **  after each database error handling.
      **
      *                                     134 141 DBFILE
      *                                     142 170 DBKEY
      *                                     171 180 DBPGM
      *                                     181 1830DBASE
     I                                      184 256 DBTXT
     IRUNDAT      DS
      **  Rundat Data Area
      *
     I                                        1   7 RUNA
     I                                    P   8  100RUND
     I                                       11  11 SSF
     I                                       12  12 DATF
     I                                       13  13 MBIN
     IPSDS       SDS
      **  Program Status Data Structure - gives Job/Workstation name
      **  and User ID
      *
     I                                     *PROGRAM ##PGM
     I                                      244 253 WSID
     I                                      254 263 USER
     ISETLIB    E DSSETLIAB
     I              QQPONS                          Q1PONS                                    CGL029
     I              QQRONS                          Q1RONS                                    CGL029
      **  Data structure for passing a parameter to synon screen
      **  handling program.
      *
     ISETLIZ    E DSSETLIAZ
      **  Data structure for passing a parameter to synon screen
      **  handling program.
     I@PARM3    E DSSDSETLPD                                              222373
      *
     ISDBANK    E DSSDBANKPD
      **  External DS for bank details
      *                                                                   140807
     ISDMMOD    E DSSDMMODPD                                              140807
      **  External DS for module details                                  140807
      *                                                                   140807
     ISDRETL    E DSSDRETLPD                                              140807
      **  External DS for retail details                                  140807
      *
     ISDBRCH    E DSSDBRCHPD
      **  Branch Codes
      *
     ISDCUST    E DSSDCUSTPD
     I              QQDFAC                          Q1DFAC                                    CGL029
      **  Customer Details
      *
     ISDCURR    E DSSDCURRPD
      **  Currency Type
      *
     ISDBSRT    E DSSDBSRTPD
      **  Base Rate
      *
     ISDLOAN    E DSSDLOANPD
      **  Loan Type / Sub Type
      *
     IDSFDY     E DSDSFDY
      **  First DS for access program, short Data Structure
      *
     IDSSDY     E DSDSSDY
      **  Second DS for access programs, long Data Structure
      *
     ILEALLO    E DSLEALLO                                                155538
      ** DS for calculating PC reference                                  155538
      *                                                                   155538
     I            DS
      **  Separate date values
      *
     I                                        1   2 W#JDT1
     I                                        3   4 W#JDT2
     I                                        7   8 W#JDT3
     I                                        1   8 W#JDTE
     I            DS
      **  Separate date values
      *
     I                                        1   6 WDATE
     I                                        1   2 WDAT1
     I                                        3   4 WDAT2
     I                                        5   6 WDAT3
      *
     I            DS
      **  Date format for test harness file
      *
     I                                        7  14 DTST
     I                                        7   8 WTDT1
     I I            '/'                       9   9 WFIL1
     I                                       10  11 WTDT2
     I I            '/'                      12  12 WFIL2
     I                                       13  14 WTDT3
      **  Separate time values
      *
     I                                       15  200WTIME
     I                                       15  16 WTIM1
     I                                       17  18 WTIM2
     I                                       19  20 WTIM3
      *
     I            DS
      **  Time format for test harness file
      *
     I                                       21  28 TMST
     I                                       21  22 WTTM1
     I I            ':'                      23  23 WFIL3
     I                                       24  25 WTTM2
     I I            ':'                      26  26 WFIL4
     I                                       27  28 WTTM3
     I              '000000000000000000-  C         C#ZER1
     I              '0000000'
     I              '000000000000000000'  C         C#ZER2
      *
      **  Data to be passed to window program
      *
     I/COPY QWINDSRC,LE2022GDTA
     I/COPY ZSRSRC,ZDAT10Z1
      *
      /EJECT
      * ===============================================================
      **                  D E F I N I T I O N S
      * ===============================================================
      *
      ** PARAMETER Lists
      ** ~~~~~~~~~~~~~~~
     C           *ENTRY    PLIST
     C                     PARM           P#MODE  1        Mode (I/B/P/R)
     C                     PARM           P#R1MF           IN Message format
     C                     PARM           P#R2MF           OUT Message format
      *
      ** Key Lists
      ** ~~~~~~~~~
      *
      **  Key list to access Prime Facility
     C           K#LTL0    KLIST
     C**********           KFLD           K#CNUM  60                                          CSD027
     C                     KFLD           K#CNUM  6                                           CSD027
     C                     KFLD           K#FACT  30
     C                     KFLD           K#FCNO  20
      *
      **  Key list to access Superfacility record
     C           K#LTL1    KLIST
     C**********           KFLD           K#CANM  60                                          CSD027
     C                     KFLD           K#CANM  6                                           CSD027
     C                     KFLD           K#CAFT  30
     C                     KFLD           K#CAFN  20
      *
      **  Key list to access Risk Participant Details File
     C           K#LTL2    KLIST
     C                     KFLD           K#BRCA  3
     C**********           KFLD           K#CUNO  60                                          CSD027
     C                     KFLD           K#CUNO  6                                           CSD027
     C                     KFLD           K#CUFA  30
     C                     KFLD           K#CFNO  20
     C**********           KFLD           K#CSSN  60                                          CSD027
     C                     KFLD           K#CSSN  6                                           CSD027
      *
      **  Key list to access Risk Participant Details File
     C           K#LTL3    KLIST
     C                     KFLD           K#BRCA  3
     C**********           KFLD           K#CUNO  60                                          CSD027
     C                     KFLD           K#CUNO  6                                           CSD027
     C                     KFLD           K#CUFA  30
     C                     KFLD           K#CFNO  20
      *                                                                   157594
      **  Key list to access Funding Participant Details File             157594
     C           K#FCL2    KLIST                                          157594
     C                     KFLD           K#BRCO  3                       157594
     C**********           KFLD           K#CUNU  60                                   157594 CSD027
     C                     KFLD           K#CUNU  6                                           CSD027
     C                     KFLD           K#CUFC  30                      157594
     C                     KFLD           K#CFNM  20                      157594
      *
      * ===============================================================
      *
      *                M A I N        P R O C E S S I N G
      *
      * ===============================================================
      *
      **  Perform Initialisation
      *
     C                     EXSR INITPR
      *
     C                     SELEC
     C           P#MODE    WHEQ 'I'
     C           P#MODE    OREQ 'R'
     C           P#MODE    OREQ 'E'
     C                     EXSR REVIEW
     C           P#MODE    WHEQ 'B'
     C                     EXSR MAPFLD
     C                     EXSR VLDDET
      *                                                                   133619
      ** Set up details of returned message format                        133619
     C                     MOVE R1MSGT    R2MSGT                          133619
     C                     MOVE R1TRUS    R2TRUS                          133619
     C                     MOVE R1TRWS    R2TRWS                          133619
     C                     MOVE R1TNRF    R2TNRF                          133619
     C                     MOVE R1TRSN    R2TRSN                          133619
     C                     MOVE R1ACTN    R2ACTN                          133619
     C                     MOVE R1TRDS    R2TRDS                          133619
     C                     MOVE R1TRTS    R2TRTS                          133619
     C                     MOVE R1NRBA    R2NRBA                          133619
     C                     MOVE R1CNUM    R2CNUM                          133619
     C                     MOVE R1FACT    R2FACT                          133619
     C                     MOVE R1FCNO    R2FCNO                          133619
     C                     MOVE R1MNUM    R2MNUM                          133619
     C                     MOVE R1INUM    R2INUM                          133619
      *
     C           P#MODE    WHEQ 'P'
     C                     READ LE2022PD                 70
     C           *IN70     DOWEQ'0'
      *
      **  Validate Detail from Parameter
      *
     C                     MOVE S#ACTN    W#ACTN
      *
     C           W#ACTN    IFNE 'D'
     C                     EXSR VLDDET
     C                     ELSE
     C                     MOVE '1'       *IN10
     C                     EXSR UPDFLE
     C                     ENDIF
      *
     C                     READ LE2022PD                 70
      *
     C                     ENDDO
      *
     C                     ENDSL
      *
     C                     EXSR CF03
      *
      /EJECT
      *****************************************************************
      * INITPR    : Initial Processing                                *
      * Called by : Main routine                                      *
      * Calls     : AOBANKR0 - Access Bank Details                    *
      *             AOSARDR0 - Access Switches                        *
      *             AOBRCHR0 - Access Branch Codes                    *
      *             AOCURRR0 - Access Currency Details                *
      *             AOCUSTR0 - Access Customer Details                *
      *****************************************************************
      *
     C           INITPR    BEGSR
      *
      **  Set up copyright parameter
      *
     C                     MOVEACPY@      CPY2@  80
      *
      **  Define the LDA for error handling
      *
     C           *NAMVAR   DEFN           LDA
     C           *NAMVAR   DEFN           RUNDAT
      *
      **  Get MBIN from DTAARA/RUNDAT
      *
     C                     IN   RUNDAT
      *
      **  Access Bank Details
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*DBERR ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
      **  Data base error in file SDBANKPD
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD1         DBASE            ***************
     C                     MOVEL'SDBANKPD'DBFILE           *DB ERROR 001 *
     C                     MOVEL'LE2022'  DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Check System Date Format, DDMMYY (*IN98 off)
      **                            MMDDYY (*IN98 on).
      *
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     END
      *
     C                     MOVE BJMRDT    S#RUNA           Midas run date
      *                                                                   140807
      * Get module details                                                140807
     C                     CALL 'AOMMODR0'                                140807
     C                     PARM *BLANKS   @RTCD                           140807
     C                     PARM '*FIRST ' @OPTN                           140807
     C           SDMMOD    PARM SDMMOD    DSFDY                           140807
      *                                                                   140807
     C           @RTCD     IFNE *BLANKS                                   140807
     C           *LOCK     IN   LDA                                       140807
     C                     SETON                       U7U8               140807
     C                     Z-ADD10        DBASE                           140807
     C                     MOVEL'SDMMODPD'DBFILE                          140807
     C                     MOVEL'LE2022'  DBKEY                           140807
     C                     OUT  LDA                                       140807
     C                     EXSR *PSSR                                     140807
     C                     ENDIF                                          140807
      *                                                                   140807
      * Set retail flags                                                  140807
     C                     MOVE BGRTBN    PMRETP                          140807
     C           BGRTBN    IFEQ 'Y'                                       140807
     C                     CALL 'AORETLR0'                                140807
     C                     PARM *BLANKS   @RTCD                           140807
     C                     PARM '*FIRST ' @OPTN                           140807
     C           SDRETL    PARM SDRETL    DSFDY                           140807
      *                                                                   140807
     C           @RTCD     IFNE *BLANKS                                   140807
     C           *LOCK     IN   LDA                                       140807
     C                     SETON                       U7U8               140807
     C                     Z-ADD11        DBASE                           140807
     C                     MOVEL'SDRETLPD'DBFILE                          140807
     C                     MOVEL'LE2022'  DBKEY                           140807
     C                     OUT  LDA                                       140807
     C                     EXSR *PSSR                                     140807
     C                     ENDIF                                          140807
      *                                                                   140807
     C                     MOVE BMRANR    PMRETS                          140807
     C                     ENDIF                                          140807
      *                                                                   140807
      *
      **  Access the Switchable Features file
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANK    @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'CLE002'  @SARD   6
      *
     C           @RTCD     IFEQ *BLANK
     C                     MOVE 'Y'       CLE002  1
     C                     ELSE
     C                     MOVE 'N'       CLE002
     C                     ENDIF
      *                                                                   CEU004
      **  Check if CEU004 is switched on                                  CEU004
      *                                                                   CEU004
     C                     CALL 'AOSARDR0'                                CEU004
     C                     PARM *BLANK    @RTCD                           CEU004
     C                     PARM '*VERIFY' @OPTN                           CEU004
     C                     PARM 'CEU004'  @SARD   6                       CEU004
      *                                                                   CEU004
     C           @RTCD     IFEQ *BLANK                                    CEU004
     C                     MOVE 'Y'       CEU004  1                       CEU004
     C                     ELSE                                           CEU004
     C                     MOVE 'N'       CEU004                          CEU004
      *                                                                   CEU004
      **  Data base error in file SCSARDPD                                CEU004
      *                                                                   CEU004
     C           @RTCD     IFNE '*NRF    '                                CEU004
     C           *LOCK     IN   LDA                                       CEU004
     C                     SETON                       U7U8               CEU004
     C                     Z-ADD9         DBASE            ***************CEU004
     C                     MOVEL'SCSARDPD'DBFILE           *DB ERROR 009 *CEU004
     C                     MOVEL'CEU004'  DBKEY            ***************CEU004
     C                     OUT  LDA                                       CEU004
     C                     EXSR *PSSR                                     CEU004
     C                     ENDIF                                          CEU004
     C                     ENDIF                                          CEU004
      *
      **  Determine parm-Mode
      *
     C                     MOVE 'N'       W#OPEN  1
     C           P#MODE    IFEQ 'I'
     C           P#MODE    OREQ 'R'
     C                     OPEN LE2022DF
     C                     MOVE USER      S#USER
     C                     MOVE WSID      S#WSID
     C                     MOVE RUNA      S#RUNA
     C                     MOVE '1'       *IN89
     C                     MOVE 'Y'       W#OPEN
     C                     ENDIF
      *
     C           P#MODE    IFEQ 'R'
     C           P#MODE    OREQ 'P'
     C                     OPEN LE2022PD
     C                     ENDIF
      *
      **  Access the Facility in LF/LEFCLTL0
      *
     C                     MOVE *BLANKS   K#CNUM
     C                     MOVE *BLANKS   K#FACT
     C                     MOVE *BLANKS   K#FCNO
      *
     C                     MOVE R1CNUM    K#CNUM
     C                     MOVE R1FACT    K#FACT
     C                     MOVE R1FCNO    K#FCNO
     C           P#MODE    IFEQ 'B'                                       CLE034
     C           K#LTL0    CHAINLEFCLRL7             70                   CLE034
     C                     ELSE                                           CLE034
     C********** K#LTL0    CHAINLEFCLTL0             70                   178424
     C           K#LTL0    CHAINLEFCLTL7             70                   178424
     C                     ENDIF                                          CLE034
      *
     C           *IN70     IFEQ '1'
     C           *LOCK     IN   LDA
     C**********           MOVEL'LEFCLTL0'DBFILE           ************** 178424
     C                     MOVEL'LEFCLTL7'DBFILE           ************** 178424
     C                     Z-ADD2         DBASE            *DB ERROR 002 *
     C                     MOVE K#CNUM    DBKEY            ***************
     C                     MOVEL'LE2022'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVELBRCA      W#BRCA  3
     C**********           MOVELCNUM      W#CNUM  60                                          CSD027
     C                     MOVELCNUM      W#CNUM  6                                           CSD027
     C                     MOVELFACT      W#FACT  30
     C                     MOVELFCNO      W#FCNO  20
     C**********           MOVELMNUM      W#MNUM  60                                          CSD027
     C                     MOVELMNUM      W#MNUM  6                                           CSD027
     C                     ENDIF
      *
      **  Access Branch Codes
      *
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM BRCA      @BRCA   3
     C           SDBRCH    PARM SDBRCH    DSSDY
      *
      **  Data base error in file SDBRCHPD
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD3         DBASE            ***************
     C                     MOVEL'SDBRCHPD'DBFILE           *DB ERROR 003 *
     C                     MOVEL'LE2022'  DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Access Currency Details
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM FCCY      @BRCA   3
     C           SDCURR    PARM SDCURR    DSSDY
      *
      **  Data base error in file SDCURRPD
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD4         DBASE            ***************
     C                     MOVEL'LE2022  'DBPGM            *DB ERROR 004 *
     C                     MOVELFCCY      DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Populate screen header
      *
     C                     MOVE CNUM      S#ANUM
     C                     MOVE BRCA      S#BRCA           Branch
     C                     MOVE FCCY      S#FCCY           Currency
     C                     MOVE R1CNUM    S#PMFC           Facility Custom
     C                     MOVE R1FACT    S#PMFT           Facility No
     C                     MOVE R1FCNO    S#PMFN           Facility No
      *
      **  Get Facility Amount
      *
     C                     MOVE FAMT      ZFIELD
     C                     Z-ADDA6NBDP    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    S#FAMT
      *
      **  Access Customer Details File
      *
     C                     MOVE CNUM      P#MNUM  6
     C                     CALL 'AOCUSTR0'
     C                     PARM '*BLANKS' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM P#MNUM    @CNUM  10
     C                     PARM           @CNST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD5         DBASE
     C                     MOVEL'SDCUSTPD'DBFILE
     C                     MOVELP#MNUM    DBKEY
     C                     MOVEL'LE2022  'DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ELSE
     C                     MOVE BBCRNM    S#CRNM
     C                     ENDIF
      *
      **  Save prime facility amount
      *
     C           *LIKE     DEFN FAMT      W#FAMT
     C                     Z-ADDFAMT      W#FAMT           Prim facility
      *
      **  Open DSPF/LE2022DF if parm-Mode is NOT = 'B'
      *
     C           P#MODE    IFNE 'B'
     C           W#OPEN    ANDNE'Y'
     C                     OPEN LE2022DF
     C                     MOVE USER      S#USER
     C                     MOVE WSID      S#WSID
     C                     MOVE RUNA      S#RUNA
     C                     MOVE '1'       *IN89
     C                     ENDIF
      *
     C                     MOVEL'LERMSGF 'ZAMSGF
     C                     MOVE USER      S#USER
     C                     MOVE WSID      S#WSID
     C                     MOVE BJMRDT    S#RUNA
      *
      **  If the facility is a part of a tranche and it's a syndicated
      **  facility, the list of members should default to the list of
      **  members for the superfacility. 'This facility' refers to the
      **  facility for which LE2022 has been called.
      *
     C           TRCA      IFEQ 'TR'
     C           P#MODE    ANDNE'B'                                       134031
      *
     C                     MOVE BRCA      K#BRCA
     C                     MOVE CNUM      K#CUNO
     C                     MOVE FACT      K#CUFA
     C                     MOVE FCNO      K#CFNO
      *
      **  Default Members
      *
     C           K#LTL3    CHAINLEPARTL1             80
     C           *IN80     IFEQ '1'
     C                     MOVE CANM      K#CANM
     C                     MOVE CAFT      K#CAFT
     C                     MOVE CAFN      K#CAFN
     C           K#LTL1    SETLLLEFCLTL0
     C           K#LTL1    READELEFCLTL0                 81
     C           *IN81     DOWEQ'0'
     C                     MOVE BRCA      K#BRCA
     C                     MOVE CNUM      K#CUNO
     C                     MOVE FACT      K#CUFA
     C                     MOVE FCNO      K#CFNO
     C           K#LTL3    SETLLLEPARTL1
     C           K#LTL3    READELEPARTL1                 82
     C           *IN82     DOWEQ'0'
     C                     MOVELW#BRCA    BRCA
     C                     MOVELW#CNUM    CNUM
     C                     MOVELW#FACT    FACT
     C                     MOVELW#FCNO    FCNO
     C                     MOVEASTAMP,1   LPSTMP           Default Timestamp                  CPK015
     C                     WRITELEPARTD0
     C           K#LTL3    READELEPARTL1                 82
     C                     ENDDO
     C           K#LTL1    READELEFCLTL0                 81
     C                     ENDDO
     C                     ENDIF
     C                     ENDIF
      *
     C           P#MODE    IFEQ 'E'
     C                     MOVE *ON       *IN07
     C                     ENDIF
      *                                                                   148847
     C                     MOVE 'N'       WENTR   1                       148847
      *                                                                                       CLE031
      **  Check if CLE031 is switched on                                                      CLE031
      *                                                                                       CLE031
     C                     MOVE 'N'       CLE031  1                                           CLE031
     C                     CALL 'AOSARDR0'                                                    CLE031
     C                     PARM *BLANK    @RTCD                                               CLE031
     C                     PARM '*VERIFY' @OPTN                                               CLE031
     C                     PARM 'CLE031'  @SARD   6                                           CLE031
      *                                                                                       CLE031
     C           @RTCD     IFEQ *BLANK                                                        CLE031
     C                     MOVE 'Y'       CLE031                                              CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
      **  Data base error in file SCSARDPD                                                    CLE031
      *                                                                                       CLE031
     C           @RTCD     IFNE '*NRF    '                                                    CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     SETON                       U7U8                                   CLE031
     C                     Z-ADD12        DBASE                                               CLE031
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE031
     C                     MOVEL'CLE031'  DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * BLDSFL    : Build Subfile                                     *
      * Called by : VLDSFL, REVIEW, CF05                              *
      * Calls     : AOCUSTR0 - Access Customer Details                *
      *             ZEDIT, AMOUNT                                     *
      *****************************************************************
      *
     C           BLDSFL    BEGSR
      *
     C                     Z-ADD0         RRN1    40
     C                     Z-ADD0         W#RECS  20
     C                     MOVE 'N'       W#FLAG
      *
     C                     MOVELBRCA      K#BRCA
     C                     MOVELCNUM      K#CUNO
     C                     MOVELFACT      K#CUFA
     C                     MOVELFCNO      K#CFNO
     C                     MOVELK#CUST    K#CSSN
      *
      **  Clear subfile
      *
     C                     MOVEA'00010'   *IN,30
     C                     WRITELE2022C1
      *
      **  Read LF/LEPARTL1
      *
     C           K#LTL2    SETLLLEPARTL1
     C           K#LTL3    READELEPARTL1                 70
      *
     C           *IN70     DOWEQ'0'
     C           W#RECS    ANDLT10
      *
      **  Move Member Number
      *
     C                     MOVE MNUM      S#CNUM
      *
      **  Access Customer Details File
      *
     C                     MOVE MNUM      P#MNUM  6
     C                     CALL 'AOCUSTR0'
     C                     PARM '*BLANKS' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM P#MNUM    @CNUM  10
     C                     PARM           @CNST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD6         DBASE
     C                     MOVEL'SDCUSTPD'DBFILE
     C                     MOVELP#MNUM    DBKEY
     C                     MOVEL'LE2022  'DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ELSE
     C                     MOVE BBCSSN    S#CUSD
     C                     ENDIF
      *
      **  Joining Date
      *
     C                     MOVE JDTE      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     WDATE
     C                     MOVE WDAT1     WTDT1
     C                     MOVE WDAT2     WTDT2
     C                     MOVE WDAT3     WTDT3
     C                     MOVE DTST      S#JDTE
      *
      **  Share Type
      *
     C                     MOVE SHTP      S#SHTP
      *
      **  Share Amount/Percentage
      *
     C           SHTP      IFEQ 'A'
      *
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE SHAM      ZFIELD
     C                     Z-ADDA6NBDP    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    S#SHAR
      *
     C                     ELSE
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE SHPC      ZFIELD
     C                     Z-ADD12        ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    S#SHAR
     C                     ENDIF
      *
     C                     ADD  1         RRN1
     C                     ADD  1         W#RECS
     C                     WRITELE2022S1
     C           K#LTL3    READELEPARTL1                 70
      *
     C                     ENDDO
      *
     C                     Z-ADDRRN1      CURRRN  40
      *
      **  Set on subfile display indicators
      *
     C           RRN1      IFGT 0
     C                     MOVEA'1110'    *IN,30
     C                     MOVE '0'       *IN60
     C                     Z-ADD1         ##SFRC
      *
      **  Display PAGE KEYS if more than one page
      *
     C           RRN1      IFGT 9
     C                     MOVE '1'       *IN34
     C                     ENDIF
      *
      **  Determine Participant Share Amount
      *
     C                     EXSR AMOUNT
      *
      **  Evaluate the Percentage Sold
      *
     C           W#SHAM    DIV  FAMT      W#PCSD 159
     C           W#PCSD    MULT 100       W#PCSD                          133855
     C                     MOVE W#PCSD    ZFIELD
     C                     Z-ADD9         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    S#PCSD
      *
     C                     ELSE
     C                     MOVEA'01000'   *IN,30
     C                     MOVE '1'       *IN60
     C                     Z-ADD0         ##SFRC
     C                     ENDIF
      *
     C**********           Z-ADDCNUM      K#CUST  60                                          CSD027
     C                     MOVE CNUM      K#CUST  6                                           CSD027
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * MAPFLD    : Map Incoming Data                                 *
      * Called by : Main routine                                      *
      * Calls     : AOCUSTR0 - Access Customer Details                *
      *****************************************************************
      *
     C           MAPFLD    BEGSR
      *
      **  Map the input data read from the transmitted message.
      *
     C           P#MODE    IFEQ 'B'
      *
     C                     MOVE R1ACTN    S#SEL1
     C                     MOVE S#SEL1    W#ACTN
     C                     MOVE R1CNUM    S#ANUM
      *
      **  Access Customer Details File
      *
     C                     MOVE S#ANUM    P#MNUM  6
     C                     CALL 'AOCUSTR0'
     C                     PARM '*BLANKS' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM P#MNUM    @CNUM  10
     C                     PARM           @CNST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD7         DBASE
     C                     MOVEL'SDCUSTPD'DBFILE
     C                     MOVELP#MNUM    DBKEY
     C                     MOVEL'LE2022  'DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ELSE
     C                     MOVE BBCRNM    S#CRNM
     C                     ENDIF
      *
     C                     MOVE R1CNUM    S#PMFC
     C                     MOVE R1FACT    S#PMFT
     C                     MOVE R1FCNO    S#PMFN
     C***********          MOVE R1MNUM    S#CSSN                          160706
     C***********          MOVE S#CSSN    P#MNUM  6                       160706
     C                     MOVELR1MNUM    S#CSSN    P                     160706
     C                     MOVELS#CSSN    P#MNUM  6                       160706
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM '*BLANKS' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM P#MNUM    @CNUM  10
     C                     PARM           @CNST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD8         DBASE
     C                     MOVEL'SDCUSTPD'DBFILE
     C                     MOVELP#MNUM    DBKEY
     C                     MOVEL'LE2022  'DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ELSE
     C***********          MOVE BBCRNM    S#CUSD                          160706
     C                     MOVE BBCSSN    S#CUSD                          160706
     C                     ENDIF
      *
     C                     MOVE R1JDTE    W#JDTE
     C***********BJDFIN    IFEQ 'M'                                       158141
     C***********          MOVE W#JDT1    WDAT2                           158141
     C***********          MOVE W#JDT2    WDAT1                           158141
     C***********          ELSE                                           158141
     C                     MOVE W#JDT1    WDAT1
     C                     MOVE W#JDT2    WDAT2
     C***********          ENDIF                                          158141
      *
     C                     MOVE W#JDT3    WDAT3
     C                     MOVE WDATE     S#JDAT
      *
     C                     MOVE R1SHTP    S#SHTP
     C           R1SHTP    IFEQ 'P'
     C                     MOVE R1SHPC    S#SHAR
     C                     ELSE
     C                     MOVE R1SHAM    S#SHAR
     C                     ENDIF
      *
     C                     MOVE R1FEBR    S#LPBR
     C                     MOVE R1FERA    S#LPAM
     C                     MOVE R1FERS    S#LPPS
     C                     MOVE R1DRTP    S#DFTP
     C                     MOVE R1DRST    S#DFST
      *
      **  Settlement details.
      *
     C                     MOVE R1RSTM    H#RSTM
     C                     MOVELR1RONS    H#ROBR                          134008
     C                     MOVE R1RONS    H#RONS
      *                                                                   134008
     C                     MOVE R1RIBN    H#RIBN
     C                     MOVE R1RIBA    H#RIBA
     C                     MOVE R1ROBN    H#ROBN
     C                     MOVE R1ROCN    H#ROCN
      *                                                                   134008
     C                     MOVE R1PSTM    H#PSTM
     C                     MOVELR1PONS    H#POBR                          134008
     C                     MOVE R1PONS    H#PONS
      *                                                                   134008
     C                     MOVE R1PIBN    H#PIBN
     C                     MOVE R1PIBA    H#PIBA
     C                     MOVE R1POBN    H#POBN
     C                     MOVE R1POCN    H#POCN
     C                     MOVE R1CVMR    H#CVMR
     C                     MOVE R1RCRN    H#RCRN
     C                     MOVE R1RCRA    H#RCRA
     C                     MOVE R1RVNO    H#RVNO
     C                     MOVE R1AWBN    H#AWBN
     C                     MOVE R1AWBA    H#AWBA
     C                     MOVE R1BENN    H#BENN
     C                     MOVE R1BENA    H#BENA
     C                     MOVE R1DTP1    H#DTP1
     C                     MOVE R1DCHG    H#DCHG
     C                     MOVE R1BTB1    H#BTB1
     C                     MOVE R1PCOB    H#PCOB
      *                                                                   CEU004
      **  Set fields if CEU004 is switched on                             CEU004
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           CLE031    OREQ 'Y'                                                           CLE031
     C                     MOVE R1SCCY    H#SCCY                          CEU004
     C                     MOVE R1ICCY    H#ICCY                          CEU004
     C                     ENDIF                                          CEU004
      *
     C                     ENDIF
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE R1REXR    H#REXR                                              CLE031
     C           R1REXR    IFNE *BLANKS                                                       CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE R1REXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     MOVE *OFF      *IN99                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
     C                     Z-ADD*ZEROS    WSEXR  138                                          CLE031
     C                     MOVELZFIELD    WSEXR                                               CLE031
     C           *IN99     IFEQ *ON                                                           CLE031
     C           WSEXR     OREQ *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   H#REXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE R1REXI    H#REXI                                              CLE031
     C           R1REXI    IFEQ 'N'                                                           CLE031
     C                     MOVE *BLANKS   H#REXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE R1PSCY    H#PSCY                                              CLE031
     C                     MOVE R1PEXR    H#PEXR                                              CLE031
     C           R1PEXR    IFNE *BLANKS                                                       CLE031
     C                     MOVE R1PEXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     MOVE *OFF      *IN99                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
     C                     Z-ADD*ZEROS    WSEXR                                               CLE031
     C                     MOVELZFIELD    WSEXR                                               CLE031
     C           *IN99     IFEQ *ON                                                           CLE031
     C           WSEXR     OREQ *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   H#PEXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE R1PEXI    H#PEXI                                              CLE031
     C           R1PEXI    IFEQ 'N'                                                           CLE031
     C                     MOVE *BLANKS   H#PEXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * REVIEW    : Process Intractive processing                     *
      * Called by : Main routine, DELETR, UPDFLE                      *
      * Calls     : VLDPOS, BLDSFL, CF03, CF05, INSERT, VLDSFL        *
      *****************************************************************
      *
     C           REVIEW    BEGSR
      *
     C                     MOVE '0'       *IN51
      *
      **  Validate Review from
      *
     C                     EXSR VLDPOS
      *
      **  Perform only if Review From is valid
      *
     C           *IN51     IFEQ '0'
      *
      **  Continue to redisplay the screen if *IN03 remains off
      *
     C           *IN03     DOWEQ'0'
      *
      **  Set up Key fields (for subfile)
      *
     C                     MOVELW#BRCA    K#BRCA
     C                     MOVELS#REV1    K#CUST
     C           *LIKE     DEFN S#REV1    W#REV1
      *
      **  Save position fields
      *
     C                     MOVELS#REV1    W#REV1
      *
      **  Build Subfile
      *
     C                     Z-ADD0         RRN1
     C                     Z-ADD0         CURRRN
     C                     MOVE *BLANKS   S#SEL1
     C                     MOVE '0'       *IN40
     C                     EXSR BLDSFL
      *
     C                     WRITELE2022F1                   Header
     C                     WRITELE2022F3                   Function Keys
     C                     WRITE#MSGCTL                    Messages
     C   60                WRITELE2022F4                   No Records  s
     C                     EXFMTLE2022C1                   Subfile Control
      *
      **  Clear Message subfile
      *
     C                     EXSR CLEARM
      *
      **  this is used in CF05 (refresh)
      *
     C                     MOVE 'SFL'     W#F5MD  3
      *
      **  F3  - Exit
      *                                   ****
     C           *IN03     CASEQ'1'       CF03
      *                                   ****
      **  F5 - Refresh
      *
     C           *IN05     CASEQ'1'       CF05
      *                                   ****
      **  F9 - Add
      *                                   ******
     C           *IN09     CASEQ'1'       INSERT
      *                                   ******
      **  F12- Previous                                                   145908
      *                                   ****                            145908
     C           *IN12     CASEQ'1'       CF03                            145908
      *                                   ****                            145908
      **  Enter Key Processing
      *                                   ******
     C                     CAS            VLDSFL
      *                                   ******
     C                     ENDCS
      *
     C                     ENDDO
      *
     C                     MOVE '0'       *IN12
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * PROSEL    : Read Selection                                    *
      * Called by : VLDSEL                                            *
      * Calls     : CLEARM, KEY2, ENQRYS, AMENDS, DELETS              *
      *****************************************************************
      *
     C           PROSEL    BEGSR
      *
      **  Process selection only if records exist on subfile
      *
     C           *IN60     IFEQ '0'
      *
      **  Clear Message subfile
      *
     C                     EXSR CLEARM
      *
      **  Insert chain facility file to populate screen fields
      *
     C                     EXSR KEY2
      *
     C           W#ACTN    CASEQ'E'       ENQRYS
     C           W#ACTN    CASEQ'A'       AMENDS
     C           W#ACTN    CASEQ'D'       DELETS
     C                     ENDCS
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * INSERT    : Process Insert Screen                             *
      * Called by : REVIEW                                            *
      * Calls     : CLEARM, CLRSC, CF03, CF05, CF12, CF14, VLDDET     *
      *****************************************************************
      *
     C           INSERT    BEGSR
      *
      **  Clear Message subfile
      *
     C                     EXSR CLEARM
      *
      **  Clear Screen
      *
     C                     EXSR CLRSC
      *
     C                     MOVE 'I'       W#ACTN
     C                     MOVE '0'       *IN55            Dont Protect
     C                     MOVE '0'       *IN56            Disable F10
     C                     MOVE '0'       *IN12
     C                     MOVE 'Y'       W#VSET
      *
     C                     MOVE 'INS'     W#F5MD  3
      *
     C           *IN03     DOWEQ'0'
     C           *IN12     ANDEQ'0'
      *
     C                     WRITELE2022F1                   Header
     C                     WRITELE2022F5                   Function Keys
     C                     WRITE#MSGCTL                    Messages
     C                     EXFMTLE2022F2                   Screen
      *
      **  F3  - Exit
      *                                   ****
     C           *IN03     CASEQ'1'       CF03
      *                                   ****
      **  F5  - Refresh
      *                                   ****
     C           *IN05     CASEQ'1'       CF05
      *                                   ****
      **  F12 - Previous
      *                                   ****
     C           *IN12     CASEQ'1'       CF12
      *                                   ****
      **  F14 - Settlements
      *                                   ****
     C           *IN14     CASEQ'1'       CF14
      *                                   ****
      **  Enter Key Processing
      *                                   ******
     C                     CAS            VLDDET
      *                                   ******
     C                     ENDCS
      *
     C                     ENDDO
      *
     C                     MOVE '0'       *IN09
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * ENQRYS    : Process Enquiry Screen                            *
      * Called by : PROSEL                                            *
      * Calls     : CLEARM, CLRSC, POPSCR, CF03, CF12, CF14           *
      *             VLDDET, SRWNDW                                    *
      *****************************************************************
      *
     C           ENQRYS    BEGSR
      *
      **  Clear Message subfile
      *
     C                     EXSR CLEARM
      *
      **  Clear Screen
      *
     C                     EXSR CLRSC
      *
      **  Move File fields to screen
      *
     C                     EXSR POPSCR
      *
     C                     MOVE '0'       *IN12
     C                     MOVE '1'       *IN55            Protect Fields
     C                     MOVE '0'       *IN56            Disable F10
      *
      **  Display screen until F12 or F3 pressed
      *
     C           *IN03     DOWEQ'0'
     C           *IN12     ANDEQ'0'
      *
     C                     WRITELE2022F1                   Header
     C                     WRITELE2022F5                   Function Keys
     C                     WRITE#MSGCTL                    Messages
     C                     EXFMTLE2022F2                   Screen
      *
      **  F3  - Exit
      *                                   ****
     C           *IN03     CASEQ'1'       CF03
      *                                   ****
      **  F12- Previous
      *                                   ****
     C           *IN12     CASEQ'1'       CF12
      *                                   ****
      **  F14 - Settlements
      *                                   ****
     C           *IN14     CASEQ'1'       CF14
      *                                   ****
      **  Process ENTER
      *                                   ******
     C                     CAS            VLDDET
      *                                   ******
     C                     ENDCS
      *
     C                     ENDDO
      *
     C                     EXSR SRWNDW
     C                     MOVE '0'       *IN55            Protect Fields
     C                     MOVE '1'       *IN12
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * AMENDS    : Process Amend Screen                              *
      * Called by : PROSEL                                            *
      * Calls     : CLEARM, CLRSC, POPSCR, CF03, CF05                 *
      *             CF12, CF14, VLDDET                                *
      *****************************************************************
      *
     C           AMENDS    BEGSR
      *
      **  Clear Message subfile
      *
     C                     EXSR CLEARM
      *
      **  Clear Screen Fields
      *
     C                     EXSR CLRSC
      *
      **  Move File fields to screen
      *
     C                     EXSR POPSCR
      *
     C                     MOVE '1'       *IN08
     C                     MOVE '0'       *IN55            Dont Protrct
     C                     MOVE '0'       *IN56            Disable F10
     C                     MOVE '0'       *IN12
     C                     MOVE 'UPD'     W#F5MD  3
      *
      **  Valid settlement details
      *
     C                     MOVE 'Y'       W#VSET
      *
      **  Display screen until F03 or F12 pressed
      *
     C           *IN03     DOWEQ'0'
     C           *IN12     ANDEQ'0'
      *
     C                     WRITELE2022F1                   Header
     C                     WRITELE2022F5                   Function Keys
     C                     WRITE#MSGCTL                    Messages
     C                     EXFMTLE2022F2                   Screen
      *
      **  F3  - Exit
      *                                   ****
     C           *IN03     CASEQ'1'       CF03
      *                                   ****
      **  F5  - Refresh
      *                                   ****
     C           *IN05     CASEQ'1'       CF05
      *                                   ****
      **  F12 - Previous
      *                                   ****
     C           *IN12     CASEQ'1'       CF12
      *                                   ****
      **  F14 - Settlements
      *                                   ****
     C           *IN14     CASEQ'1'       CF14
      *                                   ****
      **  Enter Key Processing
      *                                   ******
     C                     CAS            VLDDET
      *                                   ******
     C                     ENDCS
      *
     C                     ENDDO
      *
     C                     MOVE '0'       *IN08
     C                     MOVE '0'       *IN12
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * DELETS    : Process Delete Screen                             *
      * Called by : PROSEL                                            *
      * Calls     : CLEARM, CLRSC, POPSCR, UPDFLE, CF12, CF14         *
      *****************************************************************
      *
     C           DELETS    BEGSR
      *
      **  Clear Message subfile
      *
     C                     EXSR CLEARM
      *
      **  Clear Screen Fields
      *
     C                     EXSR CLRSC
      *
      **  Move File fields to screen
      *
     C                     EXSR POPSCR
      *
     C                     MOVE '0'       *IN10
     C                     MOVE '0'       *IN12
     C                     MOVE '1'       *IN55            Protect Fiel
     C                     MOVE '1'       *IN56            Enable F10
     C                     MOVE 'N'       W#SIGN  1
      *
      **  Display screen until F3, F12, or F10 is pressed
      *
     C           *IN03     DOWEQ'0'
     C           *IN12     ANDEQ'0'
     C           *IN10     ANDEQ'0'
      *
     C                     WRITELE2022F1                   Header
     C                     WRITELE2022F5                   Function Keys
     C                     WRITE#MSGCTL                    Messages
     C                     EXFMTLE2022F2                   Screen
      *
      **  F3  - Terminate Program
      *                                   ****
     C           *IN03     CASEQ'1'       CF03
      *                                   ****
      **  F10 - Delete Record
      *                                   ******
     C           *IN10     CASEQ'1'       UPDFLE
      *                                   ******
      **  F12 - Previous
      *                                   ****
     C           *IN12     CASEQ'1'       CF12
      *                                   ****
      **  F14 - Settlements
      *                                   ****
     C           *IN14     CASEQ'1'       CF14
      *                                   ****
      **  Process ENTER Key
      *                                   ******
     C                     CAS            ERRMSG
      *                                   ******
     C                     ENDCS
      *
     C                     ENDDO
      *
     C                     MOVE '1'       *IN12
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * VLDDET    : Validate Screen Input                             *
      * Called by : Main Routine, ENQRYS, AMENDS, INSERT              *
      * Calls     : VLDCUS, VLDINC, VLDJDT, VLDSHR, VLDRAT, VLDSGN,   *
      *             VLDLON, SR2410, SRWNDW, UPDFLE                    *
      *****************************************************************
      *
     C           VLDDET    BEGSR
      *
     C                     MOVE 'N'       W#ERR2  1        Error
     C                     MOVE 'Y'       W#VSET
      *
     C           P#MODE    IFNE 'B'
     C           P#MODE    ANDNE'P'
      *
      **  Setof invalid error indicators
      *
     C                     SETOF                     414243
     C                     SETOF                     444546
     C                     SETOF                     474849
     C                     SETOF                     50
      *
      **  Clear Message subfile
      *
     C                     EXSR CLEARM
      *
     C                     ENDIF
      *
     C           W#ACTN    IFEQ 'I'
      *
      **  Validate Syndicate Member
      *
     C                     EXSR VLDCUS
     C                     ENDIF
      *
      **  Validate Introducing Customer
      *
     C                     EXSR VLDINC
      *
      **  Validate Joining Date
      *
     C                     EXSR VLDJDT
      *
      **  Validate Share
      *
     C                     EXSR VLDSHR
      *
      **  Validate Fee Base Rate and Rate/Spread
      *
     C                     EXSR VLDRAT
      *
      **  Validate Rate/Spread Sign
      *
     C                     EXSR VLDSGN
      *
      **  Validate Risk Participation Loan Type/Sub-type
      *
     C                     EXSR VLDLON
      *
      **  Perform Extended Settlements
      *
     C           W#ERR2    IFEQ 'N'
     C           W#ACTN    ANDNE'D'
     C           P#MODE    ANDNE'P'
     C           P#MODE    ANDNE'B'
     C           *IN14     ANDNE'1'                                                           CLE031
     C                     MOVE 'N'       W#FLAG
     C                     EXSR CF14
     C           W#ERR2    IFEQ 'Y'
     C                     MOVE 'E'       W#SEV   1
     C                     ELSE
     C                     MOVE *BLANKS   W#SEV
     C                     ENDIF
     C                     ENDIF
      *
      **  Generate message if error exists in Settlement Details
      *
     C           W#VSET    IFEQ 'N'
     C                     MOVEL'LEK0031' ZAMSID
     C                     MOVEL'Y'       W#ERR2           Error          133613
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2           Error          133613
     C                     ENDIF
      *
      **  Validate settlement details
      *
     C           P#MODE    IFEQ 'P'
     C           P#MODE    OREQ 'B'
     C                     EXSR SR2410
     C           W#ACTN    IFEQ 'D'
     C                     MOVE '1'       *IN10
     C                     ENDIF
     C                     ENDIF
      *
     C           W#ERR2    IFEQ 'N'
     C           W#VSET    ANDEQ'Y'
      *
     C           P#MODE    IFEQ 'I'
     C           P#MODE    OREQ 'R'
     C                     EXSR SRWNDW
     C                     ENDIF
      *
     C           *IN03     IFEQ *OFF                                      132283
     C                     EXSR UPDFLE
     C                     ENDIF                                          132283
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * VLDSFL    : Validate subfile and position fields              *
      * Called by : REVIEW                                            *
      * Calls     : VLDPOS, BLDSFL, VLDSEL                            *
      *****************************************************************
      *
     C           VLDSFL    BEGSR
      *
     C                     MOVE 'N'       W#ERR1  1
     C                     Z-ADD0         W#CNT1  30
     C                     MOVE '0'       *IN51
      *
      **  Check if position fields
      *
     C           S#REV1    IFNE W#REV1
      *
     C                     EXSR VLDPOS
      *
     C           *IN51     IFEQ '0'
      *
      **  Set up key fields to position subfile
      *
     C                     MOVE S#REV1    K#CUST
     C                     MOVE S#REV1    W#REV1
      *
      **  Clear subfile
      *
     C                     MOVE '1'       *IN33
     C                     MOVE '0'       *IN30
     C                     WRITELE2022C1
      *
     C                     Z-ADD0         RRN1
     C                     Z-ADD0         CURRRN
     C                     MOVE *BLANKS   S#SEL1
     C                     MOVE '0'       *IN40
     C                     EXSR BLDSFL
     C                     ENDIF
      *
     C                     ELSE
      *
     C           *IN60     IFEQ *OFF                                      132687
     C                     EXSR VLDSEL
      *                                                                   148847
     C                     MOVE *OFF      *IN12                           148847
     C                     ENDIF                                          132687
      *                                                                   148847
     C           R1ACTN    IFEQ 'X'                                       148847
     C           *IN60     IFEQ *ON                                       148847
     C           W#CNT1    OREQ *ZEROS                                    148847
     C                     MOVE *ON       *IN12                           148847
     C                     MOVE 'Y'       WENTR                           148847
     C                     EXSR CF03                                      148847
     C                     ENDIF                                          148847
     C                     ENDIF                                          148847
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * VLDSEL    : Validate Subfile Selection                        *
      * Called by : VLDSFL                                            *
      * Calls     : VLDENQ, VLDALL, PROSEL                            *
      *****************************************************************
      *
     C           VLDSEL    BEGSR
      *
     C                     MOVE 'N'       W#CF12
      *
      **  Read all changed records
      *
     C                     READCLE2022S1                 70
      *
     C           *IN70     DOWEQ'0'
     C           W#CF12    ANDEQ'N'
      *
     C           P#MODE    IFEQ 'E'
     C                     EXSR VLDENQ
     C                     ELSE
     C                     EXSR VLDALL
     C                     ENDIF
      *
     C                     MOVE '1'       *IN35            SFLNXTCHG
     C                     UPDATLE2022S1
     C                     MOVE '0'       *IN35            SFLNXTCHG
      *
      **  Read next changed record
      *
     C           W#CF12    IFEQ 'N'
     C                     READCLE2022S1                 70
     C                     ENDIF
      *
     C                     ENDDO
      *
      **  Read all changed records
      *
     C           W#ERR1    IFEQ 'N'
     C                     READCLE2022S1                 70
      *
     C           *IN70     DOWEQ'0'
     C           W#CF12    ANDEQ'N'
      *
     C                     MOVE S#SEL1    W#ACTN  1
     C                     MOVE *BLANKS   S#SEL1
     C                     EXSR PROSEL
      *
     C                     Z-ADDRRN1      W#RRN1  40       Save it
     C                     Z-ADDRRN1      ##SFRC           SFLRCDNBR
      *
     C                     UPDATLE2022S1
      *
      **  Read next changed record
      *
     C           W#CF12    IFEQ 'N'
     C                     READCLE2022S1                 70
     C                     ENDIF
      *
     C                     ENDDO
     C                     ENDIF
      *
     C                     MOVE '0'       *IN12
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * VLDALL    : Validate subfile selection                        *
      *             (Insert, Amend, Delete, and Enquire)              *
      * Called by : VLDSEL                                            *
      * Calls     : ZASNMS                                            *
      *****************************************************************
      *
     C           VLDALL    BEGSR
      *
      **  Only 'A' 'E' or 'R' can be used to make a valid selection
      *
     C           S#SEL1    IFNE 'E'
     C           S#SEL1    ANDNE'A'
     C           S#SEL1    ANDNE'D'
      *
     C                     MOVEL'LEK0030' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       *IN40            RI & PC
     C                     MOVE '1'       *IN35            SFLNXTCHG
     C                     MOVEL'Y'       W#ERR1           Error
     C                     ELSE
     C                     MOVE '0'       *IN40            RI & PC
     C                     MOVE '1'       *IN35            SFLNXTCHG
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * VLDENQ    : Validate subfile selection for Enquiry            *
      * Called by : VLDSEL                                            *
      * Calls     : ZASNMS                                            *
      *****************************************************************
      *
     C           VLDENQ    BEGSR
      *
      **  Only 'E' can be used to make a valid selection
      *
     C           S#SEL1    IFNE 'E'
     C           S#SEL1    ANDNE' '
      *
     C                     MOVE '1'       *IN40            RI & PC
     C                     MOVE '1'       *IN35            SFLNXTCHG
      *
      **  Display Message if not already displayed
      *
     C           W#ERR1    IFEQ 'N'
     C                     MOVEL'LEK0030' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'Y'       W#ERR1           Error
     C                     ENDIF
     C                     ELSE
     C                     MOVE '0'       *IN40            RI & PC
     C                     MOVE '1'       *IN35            SFLNXTCHG
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *  VLDPOS    : Validate position fields                         *
      *  Called By : VLDSFL, REVIEW                                   *
      *  Calls     : ZASNMS,                                          *
      *****************************************************************
      *
     C           VLDPOS    BEGSR
      *
     C                     MOVE '0'       *IN51
      *
      **  Validate Review from (Customer)
      *
     C           S#REV1    IFNE *BLANKS
     C**********           TESTN          S#REV1     69                                       CSD027
     C********** *IN69     IFEQ '0'                                                           CSD027
     C**********           MOVEL'LEK0029' ZAMSID                                              CSD027
     C**********           EXSR ZASNMS                                                        CSD027
     C**********           MOVE '1'       *IN51                                               CSD027
     C**********           MOVE 'Y'       W#ERR1                                              CSD027
     C**********           ENDIF                                                              CSD027
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * VLDCUS    : Validate Syndicated Customer                      *
      * Called by : VLDDET                                            *
      * Calls     : AOCUSTR0 - Access Customer Details                *
      *             ZASNMS
      *****************************************************************
      *
     C           VLDCUS    BEGSR
      *                                                                   153650
     C                     MOVE *BLANKS   S#SRNM                          153650
     C                     MOVE *BLANKS   S#SRTN                          153650
      *
      **  Check if the Syndicate member has been entered
      *
     C           S#CSSN    IFEQ *BLANKS
      *
     C                     MOVE 'Y'       W#ERR2           Error
     C                     MOVE '1'       *IN41            RI & PC
      *
      **  Display Message
      *
     C                     MOVEL'LEK0008' ZAMSID
     C                     EXSR ZASNMS
      *
     C                     ELSE
      *
      **  Access the Customer Details file
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM '       ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM S#CSSN    @CNUM  10
     C                     PARM           @CNST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      **  Display Message
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'LEK0001' ZAMSID
     C                     MOVEL'Y'       W#ERR2           Error          133613
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2           Error          133613
     C                     MOVE '1'       *IN41            RI & PC
      *
     C                     ELSE
      *
     C                     MOVE *BLANKS   S#CSSN
     C***********          MOVE BBCUST    S#CSSN                          160706
     C                     MOVELBBCUST    S#CSSN    P                     160706
     C                     MOVELBBCSSN    S#SRNM                          153650
     C                     MOVELBBCRTN    S#SRTN                          153650
      *
      **  Check if already exists
      *
     C                     MOVE BBCUST    K#CSSN
     C           K#LTL2    CHAINLEPARTL1             70
     C           *IN70     IFEQ '0'
     C                     MOVE 'Y'       W#ERR2           Error
     C                     MOVE '1'       *IN41            RI & PC
      *
      **  Display Message
      *
     C                     MOVEL'LEK0011' ZAMSID
     C                     EXSR ZASNMS
      *
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * VLDINC    : Validate Introducing Customer                     *
      * Called by : VLDDET                                            *
      * Calls     : AOCUSTR0 - Access Customer Details                *
      *             ZASNMS                                            *
      *****************************************************************
      *
     C           VLDINC    BEGSR
      *                                                                   153650
     C                     MOVE *BLANKS   S#IRNM                          153650
     C                     MOVE *BLANKS   S#IRTN                          153650
      *
     C           S#INUM    IFEQ *BLANKS
      *
      **  Default to the agent entered against the syndicated facility
      *
     C***********          MOVE ANUM      S#INUM                          160706
     C                     MOVELANUM      S#INUM    P                     160706
      *                                                                   153650
      **  Access the Customer Details file for 'introduced by'            153650
      *                                                                   153650
     C                     CALL 'AOCUSTR0'                                153650
     C                     PARM '       ' @RTCD                           153650
     C                     PARM '*KEY   ' @OPTN                           153650
     C                     PARM S#INUM    @CNUM  10                       153650
     C                     PARM           @CNST   7                       153650
     C           SDCUST    PARM SDCUST    DSSDY                           153650
     C                     MOVELBBCRNM    S#IRNM                          153650
     C                     MOVELBBCRTN    S#IRTN                          153650
      *
     C                     ELSE
      *
      **  Access the Customer Details file
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM '       ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM S#INUM    @CNUM  10
     C                     PARM           @CNST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      **  Display Message
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'LEK0002' ZAMSID
     C                     MOVE 'Y'       W#ERR2           Error          133613
     C                     EXSR ZASNMS
     C***********          MOVE 'Y'       W#ERR2           Error          133613
     C                     MOVE '1'       *IN42            RI & PC
     C                     ELSE
     C                     MOVE *BLANKS   S#INUM
     C***********          MOVE BBCUST    S#INUM                          160706
     C                     MOVELBBCUST    S#INUM    P                     160706
     C                     MOVELBBCRNM    S#IRNM                          153650
     C                     MOVELBBCRTN    S#IRTN                          153650
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * VLDJDT    : Validate Joining Date                             *
      * Called by : VLDDET                                            *
      * Calls     : ZDATE1, ZDATE2, ZASNMS                            *
      *****************************************************************
      *
     C           VLDJDT    BEGSR
      *
     C           S#JDAT    IFEQ *BLANKS
      *
      **  Default to the system date
      *
     C                     MOVE BJRDNB    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     S#JDAT
      *
     C                     ELSE
      *
      **  Convert to Midas date format
      *
     C                     MOVE '0'       *IN99
     C                     MOVE S#JDAT    ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'                        invalid
      *
      **  Display Message
      *
     C                     MOVEL'LEK0003' ZAMSID
     C                     MOVE 'Y'       W#ERR2           Error          133613
     C                     EXSR ZASNMS
     C***********          MOVE 'Y'       W#ERR2           Error          133613
     C                     MOVE '1'       *IN43            RI & PC
      *
     C                     ELSE                            Valid
     C           ZDAYNO    IFGT BJRDNB                     GT than Run dat
      *
      **  Display Message
      *
     C                     MOVEL'LEK0014' ZAMSID
     C                     MOVE 'Y'       W#ERR2           Error          133613
     C                     EXSR ZASNMS
     C***********          MOVE 'Y'       W#ERR2           Error          133613
     C                     MOVE '1'       *IN43            RI & PC
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
     C           *LIKE     DEFN ZDAYNO    W#DAYN
     C                     MOVE ZDAYNO    W#DAYN
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * VLDSHR    : Validate Share Type and Share Amount              *
      * Called by : VLDDET                                            *
      * Calls     : ZASNMS, ZALIGN                                    *
      *****************************************************************
      *
     C           VLDSHR    BEGSR
      *
     C                     Z-ADD*ZEROS    W#SHAR 150
     C                     MOVE *BLANKS   ZFIELD
     C                     Z-ADD*ZEROS    W#FPAM                          157594
     C                     Z-ADD*ZEROS    W#SHAM                          157594
     C                     Z-ADD*ZEROS    W#RISK                          157594
      *
      **  Validate the Share Type
      *
     C           S#SHTP    IFNE 'P'
     C           S#SHTP    ANDNE'A'
      *
      **  Display Message
      *
     C                     MOVEL'LEK0004' ZAMSID
     C                     MOVE 'Y'       W#ERR2           Error          133613
     C                     EXSR ZASNMS
     C***********          MOVE 'Y'       W#ERR2           Error          133613
     C                     MOVE '1'       *IN44            RI & PC
      *
     C                     ENDIF
      *
      **  Validate Share
      *
     C           S#SHTP    IFEQ 'P'
     C                     Z-ADD3         ZADIG
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE S#SHAR    ZFIELD
     C                     Z-ADD12        ZADEC
     C                     MOVE '0'       *IN99
     C                     EXSR ZALIGN
     C                     ELSE
      *
     C           S#SHTP    IFEQ 'A'
     C           13        SUB  A6NBDP    ZADIG
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE S#SHAR    ZFIELD
     C                     Z-ADDA6NBDP    ZADEC
     C                     MOVE '0'       *IN99
     C                     EXSR ZALIGN
     C                     ENDIF
     C                     ENDIF
      *
     C           ZFIELD    IFEQ *BLANK
     C           S#SHAR    OREQ *BLANK
     C           *IN99     OREQ '1'
      *
      **  Display Message
      *
     C                     MOVEL'LEK0005' ZAMSID
     C                     MOVE 'Y'       W#ERR2           Error          133613
     C                     EXSR ZASNMS
     C***********          MOVE 'Y'       W#ERR2           Error          133613
     C                     MOVE '1'       *IN45            RI & PC
     C                     ELSE
     C                     MOVE ZFIELD    W#SHAR
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    S#SHAR
      *                                                                   157594
      **  Calculate Amount if share type is percentage                    157594
      *                                                                   157594
     C           S#SHTP    IFEQ 'P'                                       157594
     C                     MOVE W#FAMT    P#PAMT 13                       157594
     C                     MOVE W#SHAR    P#SHPC 15                       157594
     C                     MOVE *BLANKS   P#FAMT 13                       157594
     C                     MOVE S#SHTP    P#SHTP  1                       157594
     C                     CALL 'LE2024'                                  157594
     C                     PARM           P#PAMT                          157594
     C                     PARM           P#SHPC                          157594
     C                     PARM           P#FAMT                          157594
     C                     PARM           P#SHTP                          157594
      *                                                                   157594
     C                     MOVE P#FAMT    W#RISK 130                      157594
     C                     ELSE                                           157594
     C                     MOVE W#SHAR    W#RISK 130                      157594
     C                     ENDIF                                          157594
      *
     C                     ENDIF
      *
      ** Set up key to access details of funding participants             157594
      *                                                                   157594
     C                     MOVE BRCA      K#BRCO                          157594
     C                     MOVE CNUM      K#CUNU                          157594
     C                     MOVE FACT      K#CUFC                          157594
     C                     MOVE FCNO      K#CFNM                          157594
      *                                                                   157594
      ** Access details of Funding Participants to calculate amount       157594
      ** of prime facility which has been sold. Use this to calculate     157594
      ** share still held.                                                157594
      *                                                                   157594
     C           K#FCL2    SETLLLEFCLTL2                                  157594
     C           K#FCL2    READELEFCLTL2                 83               157594
     C           *IN83     DOWEQ'0'                                       157594
     C           LEPRTR    IFEQ 'P'                                       157594
     C                     SUB  LEFAMT    W#FPAM 130                      157594
     C                     ENDIF                                          157594
     C           K#FCL2    READELEFCLTL2                 83               157594
     C                     ENDDO                                          157594
     C                     ADD  FAMT      W#FPAM 130                      157594
      *                                                                   157594
      ** Obtain details of current Risk Particpations against prime       157594
      ** facility to determine portion which has already been sold.       157594
      *                                                                   157594
     C                     MOVE BRCA      K#BRCA                          157594
     C                     MOVE CNUM      K#CUNO                          157594
     C                     MOVE FACT      K#CUFA                          157594
     C                     MOVE FCNO      K#CFNO                          157594
      *                                                                   157594
     C                     EXSR AMOUNT                                    157594
     C                     ADD  W#SHAM    W#RISK                          157594
      *                                                                   157594
      ** If action is to amend an existing part sold subtract original    157594
      ** out of W#RISK                                                    157594
      *                                                                   157594
     C           W#ACTN    IFEQ 'A'                                       157594
      *                                                                   157594
     C                     MOVE S#CNUM    K#CSSN                          157594
      *                                                                   157594
     C           K#LTL2    CHAINLEPARTL1             70                   157594
      *                                                                   157594
     C                     SUB  SHAM      W#RISK                          157594
      *                                                                   157594
     C                     ENDIF                                          157594
      *                                                                   157594
      ** Total Risk Sold should not exceed retained portion of            157594
      ** facility                                                         157594
      *                                                                   157594
     C           W#RISK    IFGT W#FPAM                                    157594
      *                                                                   157594
      **  Display Message                                                 157594
      *                                                                   157594
     C                     MOVEL'LEK0033' ZAMSID                          157594
     C                     MOVE 'Y'       W#ERR2           Error          157594
     C                     EXSR ZASNMS                                    157594
     C                     MOVE '1'       *IN45            RI & PC        157594
      *                                                                   157594
     C                     ENDIF                                          157594
      *                                                                   157594
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * VLDRAT    : Validate Fee Base Rate and Fee Rate/Spread        *
      * Called by : VLDDET                                            *
      * Calls     : AOBSRTR0 - Access Base Rate Codes                 *
      *             ZASNMS, ZALIGN, ZEDIT
      *****************************************************************
      *
     C           VLDRAT    BEGSR
      *
     C                     Z-ADD*ZEROS    W#LPAM 117
      *
      ****Fee*Base*Rate*and*Fee*Rate/Spread*cannot*be*entered*at*the***   133613
      ****same*time****************************************************   133613
      *
     C***********S#LPBR    IFNE *BLANKS                                   133613
     C***********S#LPAM    ANDNE*BLANKS                                   133613
     C***********          MOVEL'LEK0012' ZAMSID                          133613
     C***********          EXSR ZASNMS                                    133613
     C***********          MOVE 'Y'       W#ERR2                          133613
     C***********          MOVE '1'       *IN46                           133613
     C***********          MOVE '1'       *IN47                           133613
     C***********          ENDIF                                          133613
      *
      **  At least one field should be entered
      *
     C           S#LPBR    IFEQ *BLANKS
     C           S#LPAM    ANDEQ*BLANKS
     C                     MOVEL'LEK0012' ZAMSID
     C                     MOVE 'Y'       W#ERR2                          133613
     C                     EXSR ZASNMS
     C***********          MOVE 'Y'       W#ERR2                          133613
     C                     MOVE '1'       *IN46
     C                     MOVE '1'       *IN47
     C                     ENDIF
      *
      **  Validate Fee Base Rate
      *
     C           PLIST7    PLIST
     C                     PARM '*BLANKS' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           BKEY1   3
     C                     PARM           BKEY2   2
     C********** SDBSRT    PARM SDBSRT    DSFDY                                 CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                                 CSD006
      *
     C           S#LPBR    IFNE *BLANKS
     C           S#LPAM    ANDEQ*BLANKS
     C                     MOVE S#FCCY    BKEY1
     C                     MOVE S#LPBR    BKEY2
     C                     CALL 'AOBSRTR0'PLIST7
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'LEK0006' ZAMSID
     C                     MOVE 'Y'       W#ERR2                          133613
     C                     EXSR ZASNMS
     C***********          MOVE 'Y'       W#ERR2                          133613
     C                     MOVE '1'       *IN46
     C                     ELSE
     C                     MOVE BABSRC    S#LPBR
     C                     ENDIF
     C                     ENDIF
      *
      **  Validate Fee Rate/Spread
      *
     C           S#LPAM    IFNE *BLANKS
     C           S#LPBR    ANDEQ*BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE S#LPAM    ZFIELD
     C                     Z-ADD7         ZADEC
     C                     Z-ADD4         ZADIG
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     MOVEL'LEK0007' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          133613
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          133613
     C                     MOVE '1'       *IN47
     C                     ELSE
     C                     MOVE ZFIELD    W#LPAM
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    S#LPAM
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * VLDSGN    : Validate Fee Rate/Spread Sign                     *
      * Called by : VLDDET                                            *
      * Calls     : ZASNMS                                            *
      *****************************************************************
      *
     C           VLDSGN    BEGSR
      *
      **  Default to '-' if Fee Rate/Spread Sign is equal to blank
      *
     C           S#LPPS    IFEQ *BLANKS
     C                     MOVE '-'       S#LPPS
     C                     ENDIF
      *
      **  Validate Fee Rate/Spread Sign
      *
     C           S#LPPS    IFNE '+'
     C           S#LPPS    ANDNE'-'
     C                     MOVEL'LEK0009' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          133613
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          133613
     C                     MOVE '1'       *IN48
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * VLDLON    : Validate Risk Participation Loan Type/Sub-type    *
      * Called by : VLDDET                                            *
      * Calls     : AOLOANR0 - Access Loan Types/Sub Types            *
      *             ZASNMS
      *****************************************************************
      *
     C           VLDLON    BEGSR
      *
      **  Entry not mandatory
      *
     C           S#DFTP    IFNE *BLANKS
     C           S#DFST    ORNE *BLANKS
      *
     C           PLIST9    PLIST
     C                     PARM '*BLANKS' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           ATCD    2
     C                     PARM           AUCD    2
     C           SDLOAN    PARM SDLOAN    DSFDY
      *
     C                     MOVELS#DFTP    ATCD
     C                     MOVELS#DFST    AUCD
     C                     CALL 'AOLOANR0'PLIST9
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'LEK0010' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          133613
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          133613
     C                     MOVE '1'       *IN49
     C                     MOVE '1'       *IN50
     C                     ELSE
     C           AYLNPT    IFEQ 70
     C           AYLNPT    OREQ 71
     C           AYLNPT    OREQ 72
     C                     MOVE AYLNTY    S#DFTP
     C                     MOVE AYLNST    S#DFST
     C                     ELSE
     C                     MOVEL'LEK0028' ZAMSID
     C                     MOVEL'Y'       W#ERR2                          133613
     C                     EXSR ZASNMS
     C***********          MOVEL'Y'       W#ERR2                          133613
     C                     MOVE '1'       *IN49
     C                     MOVE '1'       *IN50
     C                     ENDIF
     C                     ENDIF
      *
     C                     ELSE                                           132283
     C                     MOVEL'LEK0032' ZAMSID                          132283
     C                     MOVEL'Y'       W#ERR2                          133613
     C                     EXSR ZASNMS                                    132283
     C***********          MOVEL'Y'       W#ERR2                    132283133613
     C                     MOVE '1'       *IN49                           132283
     C                     MOVE '1'       *IN50                           132283
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * WRITER    : Write a record to LF/LEPARTL1, as per contents    *
      *             of Detail Screens                                 *
      * Called by : UPDFLE                                            *
      * Calls     : LOADFM, CLEARM, CLRSC, ZASNMS                     *
      *****************************************************************
      *
     C           WRITER    BEGSR
      *
     C                     MOVE S#BRCA    K#BRCA
     C                     MOVE S#PMFC    K#CUNO
     C                     MOVE S#PMFT    K#CUFA
     C                     MOVE S#PMFN    K#CFNO
     C***********          MOVE S#CSSN    K#CSSN                          160706
     C                     MOVELS#CSSN    K#CSSN                          160706
     C           K#LTL2    CHAINLEPARTL1             70
      *
     C           *IN70     IFEQ '1'
      *
      **  Write record type 'R'
      *
     C                     EXSR LOADFM
      *
      **  Rebuild subfile
      *
     C           P#MODE    IFNE 'P'
     C           P#MODE    ANDNE'B'
     C                     MOVE 'Y'       W#RBLD
     C***********          ENDIF                                          133411
      *
      **  Clear Message subfile (to add a new record)
      *
     C                     EXSR CLEARM
     C                     ENDIF                                          133411
      *
      **  Display Message (Record added)
      *
     C                     MOVEASTAMP,1   LPSTMP           Default Timestamp                  CPK015
     C                     WRITELEPARTD0
      *
     C           P#MODE    IFNE 'P'                                       133411
     C           P#MODE    ANDNE'B'                                       133411
     C                     MOVEL'LEK0021' ZAMSID
     C                     EXSR ZASNMS
      *
      **  Clear Screen
      *
     C                     EXSR CLRSC
     C                     ENDIF                                          133411
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * AMENDR    : Update Risk Participant Details File              *
      * Called by : UPDFLE                                            *
      * Calls     : LOADFM, ZASNMS,                                   *
      *****************************************************************
      *
     C           AMENDR    BEGSR
      *
     C                     MOVE S#BRCA    K#BRCA
     C                     MOVE S#PMFC    K#CUNO
     C                     MOVE S#PMFT    K#CUFA
     C                     MOVE S#PMFN    K#CFNO
     C***********          MOVE S#CSSN    K#CSSN                          157594
     C                     MOVELS#CSSN    K#CSSN                          157594
      *
     C           K#LTL2    CHAINLEPARTL1             70
      *
     C           *IN70     IFEQ '0'
      *
     C                     EXSR LOADFM
      *
     C                     UPDATLEPARTD0
      *
      **  Display Message (Record updated)
      *
     C           P#MODE    IFNE 'P'                                       134293
     C           P#MODE    ANDNE'B'                                       134293
     C                     MOVEL'LEK0022' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF                                          134293
      *
     C                     ELSE
      *
     C                     MOVE 'Y'       W#ERR2
     C                     MOVEL'LEK0026' ZAMSID
     C                     EXSR ZASNMS
      *
     C                     ENDIF
     C                     MOVE '1'       *IN12
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * DELETR    : Delete the record in LF/LEPARTL1                  *
      * Called by : CF10                                              *
      * Calls     : ZASNMS, REVIEW                                    *
      *****************************************************************
      *
     C           DELETR    BEGSR
      *
     C                     MOVE 'N'       W#ERAS  1
      *
     C                     MOVE S#BRCA    K#BRCA
     C                     MOVE S#PMFC    K#CUNO
     C                     MOVE S#PMFT    K#CUFA
     C                     MOVE S#PMFN    K#CFNO
     C***********          MOVE S#CSSN    K#CSSN                          160706
     C                     MOVELS#CSSN    K#CSSN                          160706
      *
     C           K#LTL2    CHAINLEPARTL1             70
     C           *IN70     IFEQ '0'
     C                     DELETLEPARTD0
      *
      **  Display Message (Record Deleted)
      *
     C           P#MODE    IFNE 'P'                                       CLE034
     C           P#MODE    ANDNE'B'                                       CLE034
     C                     MOVEL'LEK0023' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'Y'       W#ERAS
     C                     ENDIF                                          CLE034
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * LOADFM    : Load details to Facility File                     *
      * Called by : WRITER, AMENDR                                    *
      * Calls     : ZDATE1, ZALIGN, LE2024, PRSETT                    *
      *****************************************************************
      *
     C           LOADFM    BEGSR
      *
     C           W#ACTN    IFEQ 'I'
     C                     MOVE S#PMFC    CNUM
     C                     MOVE S#PMFT    FACT
     C                     MOVE S#PMFN    FCNO
     C                     MOVE S#FCCY    CCY
     C                     MOVE S#BRCA    BRCA
     C***********          MOVE S#CSSN    MNUM                            160706
     C                     MOVELS#CSSN    MNUM                            160706
     C                     ENDIF
      *
     C***********          MOVE S#INUM    INUM                            160706
     C                     MOVELS#INUM    INUM                            160706
     C                     MOVE S#JDAT    ZDATE
     C                     EXSR ZDATE1
     C                     MOVE ZDAYNO    JDTE
     C                     MOVE S#SHTP    SHTP
      *
     C                     MOVE S#JDAT    WDATE
     C                     MOVE WDAT1     WTDT1
     C                     MOVE WDAT2     WTDT2
     C                     MOVE WDAT3     WTDT3
     C                     MOVE DTST      S#JDTE
      *                                                                   133620
     C           P#MODE    IFEQ 'B'                                       133620
     C                     MOVE R1PCOB    PCOB                            133620
     C                     ELSE                                           133620
     C                     MOVE *BLANKS   PCOB                            133620
     C                     ENDIF                                          133620
      *                                                                   133620
     C           P#MODE    IFNE 'B'                                       133620
     C           W#ACTN    ANDEQ'I'                                       133620
     C                     MOVELA8MQSM    W#1ST3  3                       133620
     C***********          MOVELW#1ST3    PCRF      P              133620 155538
     C********** *NAMVAR   DEFN           LEALLO                                       155538 CLE148
     C********** *LOCK     IN   LEALLO                                                 155538 CLE148
     C********** PCLAST    ADD  1         PCNEXT  80                                   155538 CLE148
     C                     CALL 'LEALLO'                                                      CLE148
     C                     PARM *BLANKS   PRTCD   7                                           CLE148
     C                     PARM 'Y'       PUPDT   1                                           CLE148
     C                     PARM *BLANKS   PCLAST                                              CLE148
     C                     PARM *BLANKS   PCNEXT  8                                           CLE148
      *                                                                                       CLE148
     C                     MOVE PCNEXT    W1ST11 11                       155538
     C                     MOVELW#1ST3    W1ST11                          155538
     C                     MOVELW1ST11    PCRF                            155538
     C                     MOVE '0001'    PCRF                            155538
     C**********           Z-ADDPCNEXT    PCLAST                                       155538 CLE148
     C**********           OUT  LEALLO                                                 155538 CLE148
     C                     ELSE                                           133620
     C           P#MODE    IFEQ 'B'                                       133620
     C                     MOVE R1TNRF    PCRF                            133620
     C                     ENDIF                                          133620
     C                     ENDIF                                          133620
      *
     C           S#SHTP    IFEQ 'A'
     C           13        SUB  A6NBDP    ZADIG
     C                     Z-ADDA6NBDP    ZADEC
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE S#SHAR    ZFIELD
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SHAM
      *
      **  Calculate percentage
      *
     C                     MOVE W#FAMT    P#PAMT 13
     C                     MOVE *BLANKS   P#SHPC 15
     C                     MOVE ZFIELD    P#FAMT 13
     C                     MOVE S#SHTP    P#SHTP  1
     C                     CALL 'LE2024'
     C                     PARM           P#PAMT
     C                     PARM           P#SHPC
     C                     PARM           P#FAMT
     C                     PARM           P#SHTP
      *
     C                     MOVE P#SHPC    SHPC                            133855
     C***********          MOVE P#SHPC    W#SHPC 150                      133855
      *
     C***********          SELEC                                          133855
     C***********A6NBDP    WHEQ 0                                         133855
     C***********          Z-ADDW#SHPC    SHPC                            133855
     C***********A6NBDP    WHEQ 1                                         133855
     C***********W#SHPC    DIV  10        SHPC                            133855
     C***********A6NBDP    WHEQ 2                                         133855
     C***********W#SHPC    DIV  100       SHPC                            133855
     C***********A6NBDP    WHEQ 3                                         133855
     C***********W#SHPC    DIV  1000      SHPC                            133855
     C***********          ENDSL                                          133855
      *
     C                     ENDIF
      *
     C           S#SHTP    IFEQ 'P'
     C                     Z-ADD3         ZADIG
     C                     Z-ADD12        ZADEC
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE S#SHAR    ZFIELD
     C                     MOVE '0'       *IN99
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SHPC
      *
      **  Calculate Amount
      *
     C                     MOVE W#FAMT    P#PAMT 13
     C                     MOVE ZFIELD    P#SHPC 15
     C                     MOVE *BLANKS   P#FAMT 13
     C                     MOVE S#SHTP    P#SHTP  1
     C                     CALL 'LE2024'
     C                     PARM           P#PAMT
     C                     PARM           P#SHPC
     C                     PARM           P#FAMT
     C                     PARM           P#SHTP
      *
     C                     MOVE P#FAMT    SHAM                            133855
     C***********          MOVE P#FAMT    W#SHAM 130                      133855
      *
     C***********          SELEC                                          133855
     C***********A6NBDP    WHEQ 0                                         133855
     C***********          Z-ADDW#SHAM    SHAM                            133855
     C***********A6NBDP    WHEQ 1                                         133855
     C***********10        MULT W#SHAM    SHAM                            133855
     C***********A6NBDP    WHEQ 2                                         133855
     C***********100       MULT W#SHAM    SHAM                            133855
     C***********A6NBDP    WHEQ 3                                         133855
     C***********1000      MULT W#SHAM    SHAM                            133855
     C***********          ENDSL                                          133855
      *
     C                     ENDIF
      *
     C                     MOVE S#LPBR    FEBR
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE S#LPAM    ZFIELD
     C                     Z-ADD7         ZADEC
     C                     Z-ADD4         ZADIG
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    FERA
     C                     MOVE S#LPPS    FERS
     C                     MOVE S#DFTP    DRTP
     C                     MOVE S#DFST    DRST
     C                     MOVE 'R'       PTAI
      *
      **  Settlement details
      *
     C           W#CF14    IFEQ 'Y'
     C           P#MODE    OREQ 'B'
     C           P#MODE    OREQ 'P'
     C                     EXSR PRSETT
     C                     MOVE 'N'       W#CF14
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * POPSCR    : Move fields to screen                             *
      * Called by : ENQRYS, AMENDS, DELETS, CF05                      *
      * Calls     : ZEDIT,                                            *
      *****************************************************************
      *
     C           POPSCR    BEGSR
      *
     C***********          MOVE MNUM      S#CSSN                          153650
     C***********          MOVE INUM      S#INUM                          153650
     C***********          MOVELMNUM      S#CSSN                    153650160706
     C***********          MOVELINUM      S#INUM                    153650160706
     C                     MOVELMNUM      S#CSSN    P                     160706
     C                     MOVELINUM      S#INUM    P                     160706
      *                                                                   153650
      **  Access the Customer Details file for member name                153650
      *                                                                   153650
     C                     CALL 'AOCUSTR0'                                153650
     C                     PARM '       ' @RTCD                           153650
     C                     PARM '*KEY   ' @OPTN                           153650
     C                     PARM S#CSSN    @CNUM                           153650
     C                     PARM           @CNST                           153650
     C           SDCUST    PARM SDCUST    DSSDY                           153650
     C                     MOVELBBCRNM    S#SRNM                          153650
     C                     MOVELBBCRTN    S#SRTN                          153650
      *                                                                   153650
      **  Access the Customer Details file for 'introduced by'            153650
      *                                                                   153650
     C                     CALL 'AOCUSTR0'                                153650
     C                     PARM '       ' @RTCD                           153650
     C                     PARM '*KEY   ' @OPTN                           153650
     C                     PARM S#INUM    @CNUM                           153650
     C                     PARM           @CNST                           153650
     C           SDCUST    PARM SDCUST    DSSDY                           153650
     C                     MOVELBBCRNM    S#IRNM                          153650
     C                     MOVELBBCRTN    S#IRTN                          153650
      *                                                                   153650
     C                     MOVE JDTE      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     S#JDAT
     C                     MOVELSHTP      S#SHTP
      *
     C                     MOVE *BLANKS   ZFIELD
     C           SHTP      IFEQ 'P'
     C                     MOVE SHPC      ZFIELD
     C                     Z-ADD12        ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    S#SHAR
     C                     ELSE
     C                     MOVE SHAM      ZFIELD
     C                     Z-ADDA6NBDP    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    S#SHAR
     C                     ENDIF
      *
     C           FEBR      IFEQ *ZEROS
     C                     MOVE *BLANKS   S#LPBR
     C                     ELSE
     C                     MOVELFEBR      S#LPBR
     C                     ENDIF
      *
     C           FERA      IFNE *ZEROS
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE FERA      ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    S#LPAM
     C                     ELSE
     C                     MOVE *BLANKS   S#LPAM
     C                     ENDIF
      *
     C                     MOVE FERS      S#LPPS
     C                     MOVE DRTP      S#DFTP
     C                     MOVE DRST      S#DFST
      *
      **  Populate Hidden Settlement fields
      *
     C                     MOVE OSDB      H#OSDB
     C                     MOVE OMDB      H#OMDB
     C                     MOVE RSTM      H#RSTM
     C                     MOVE RONS      H#RONS
     C                     MOVE RIBN      H#RIBN
     C                     MOVE RIBA      H#RIBA
     C                     MOVE ROBN      H#ROBN
     C                     MOVE ROCN      H#ROCN
     C                     MOVE PSTM      H#PSTM
     C                     MOVE PONS      H#PONS
     C                     MOVE PIBN      H#PIBN
     C                     MOVE PIBA      H#PIBA
     C                     MOVE POBN      H#POBN
     C                     MOVE POCN      H#POCN
     C                     MOVE CVMR      H#CVMR
     C                     MOVE RCRN      H#RCRN
     C                     MOVE RCRA      H#RCRA
     C                     MOVE RVNO      H#RVNO
     C                     MOVE AWBN      H#AWBN
     C                     MOVE AWBA      H#AWBA
     C                     MOVE BENN      H#BENN
     C                     MOVE BENA      H#BENA
     C                     MOVE DTP1      H#DTP1
     C                     MOVE DTP2      H#DTP2
     C                     MOVE DTP3      H#DTP3
     C                     MOVE DTP4      H#DTP4
     C                     MOVE DCHG      H#DCHG
     C                     MOVE BTB1      H#BTB1
     C                     MOVE BTB2      H#BTB2
     C                     MOVE BTB3      H#BTB3
     C                     MOVE BTB4      H#BTB4
     C                     MOVE BTB5      H#BTB5
     C                     MOVE BTB6      H#BTB6
     C                     MOVE PCRF      H#PCRF
     C                     MOVE PCOB      H#PCOB
      *                                                                   CEU004
      **  Set fields if CEU004 is switched on                             CEU004
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           CLE031    OREQ 'Y'                                                           CLE031
     C                     MOVE SCCY      H#SCCY                          CEU004
     C                     MOVE ICCY      H#ICCY                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
      *                                                                                       CLE031
     C           REXR      IFEQ 0                                                             CLE031
     C                     MOVE *BLANKS   H#REXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE REXR      ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    H#REXR                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVE REXI      H#REXI                                              CLE031
     C                     MOVE PSCY      H#PSCY                                              CLE031
      *                                                                                       CLE031
     C           PEXR      IFEQ 0                                                             CLE031
     C                     MOVE *BLANKS   H#PEXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE PEXR      ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    H#PEXR                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVE PEXI      H#PEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * PRSETT    : Load settlement details into file                 *
      * Called by : LOADFM                                            *
      * Calls     : None.                                             *
      *****************************************************************
      *
     C           PRSETT    BEGSR
      *
     C                     MOVE PMROBR    OSDB
     C                     MOVE PMPOBR    OMDB
     C                     MOVE PMPSTM    PSTM
     C                     MOVE PMRSTM    RSTM
     C                     MOVE PMPONS    PONS
     C                     MOVE PMRONS    RONS
      *
     C                     MOVELPMRIBA    RIBA
     C                     MOVELPAAWBN    AWBN
     C                     MOVELPARIBN    RIBN
     C                     MOVELPABENN    BENN
     C                     MOVELPMBTB1    BTB1
     C                     MOVELPMBTB2    BTB2
     C                     MOVELPMBTB3    BTB3
     C                     MOVELPMBTB4    BTB4
     C                     MOVELPMBTB5    BTB5
     C                     MOVELPMBTB6    BTB6
     C                     MOVE PMCVMR    CVMR
     C                     MOVE PAROBN    ROBN
     C                     MOVE PAROCN    ROCN
     C                     MOVE PAPOBN    POBN
     C                     MOVE PAPOCN    POCN
     C                     MOVE PAPIBN    PIBN
     C                     MOVE PMPIBA    PIBA
     C                     MOVE PARCRN    RCRN
     C                     MOVE PMRCRA    RCRA
     C                     MOVE PARVNO    RVNO
     C                     MOVE PMAWBA    AWBA
     C                     MOVE PMBENA    BENA
     C                     MOVE PMDTP1    DTP1
     C                     MOVE PMDTP2    DTP2
     C                     MOVE PMDTP3    DTP3
     C                     MOVE PMDTP4    DTP4
     C                     MOVE PMDCHG    DCHG
     C                     MOVE PMCVMR    CVMR
      *                                                                   CEU004
      **  Set fields if CEU004 is switched on                             CEU004
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           P#MODE    IFNE 'P'                                       CEU004
     C                     MOVE PMPSCY    SCCY                            CEU004
     C                     MOVE PMIC72    ICCY                            CEU004
     C                     ELSE                                           CEU004
     C                     MOVE PMSCCY    SCCY                            CEU004
     C                     MOVE PMICCY    ICCY                            CEU004
     C                     ENDIF                                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PMRSCY    SCCY                                                CLE031
     C           PMREXR    IFEQ *ZERO                                                         CLE031
     C                     Z-ADD0         REXR                                                CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   ZFIELD 16                                           CLE031
     C                     MOVE PMREXR    ZFIELD                                              CLE031
     C                     MOVE *BLANKS   ZAFLD  16                                           CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
     C                     MOVE ZFIELD    WZREX0 130                                          CLE031
     C           WZREX0    DIV  100000000 WZREX8 138                                          CLE031
     C                     Z-ADDWZREX8    REXR                                                CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVE PMREXI    REXI                                                CLE031
     C                     MOVE PMPSCY    PSCY                                                CLE031
      *                                                                                       CLE031
     C           PMPEXR    IFEQ *ZERO                                                         CLE031
     C                     Z-ADD0         PEXR                                                CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   ZFIELD 16                                           CLE031
     C                     MOVE PMPEXR    ZFIELD                                              CLE031
     C                     MOVE *BLANKS   ZAFLD  16                                           CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
     C                     MOVE ZFIELD    WZPEX0 130                                          CLE031
     C           WZPEX0    DIV  100000000 WZPEX8 138                                          CLE031
     C                     Z-ADDWZPEX8    PEXR                                                CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVE PMPEXI    PEXI                                                CLE031
     C                     ENDIF                                                              CLE031
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * UPDFLE    : Update facility file                              *
      * Called by : DELETS, VLDDET                                    *
      * CallS     : WRITER, AMENDR, CF10, REVIEW, CLRSC,              *
      *****************************************************************
      *
     C           UPDFLE    BEGSR
      *
      **  Record Mode 'R'
      *
     C           P#MODE    IFEQ 'R'
      *
      **  Write the key fields, action code, date and time stamps,
      **  and the contents of the Detail Screens.
      *
      **  Action Code
      *
     C                     MOVE W#ACTN    S#ACTN
      *
      **  Date Stamp
      *
     C                     Z-ADDRUND      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     WDATE
     C                     MOVE WDAT1     WTDT1
     C                     MOVE WDAT2     WTDT2
     C                     MOVE WDAT3     WTDT3
     C                     MOVE DTST      S#DTST
      *
      **  Time Stamp
      *
     C                     TIME           WTIME
     C                     MOVE WTIM1     WTTM1
     C                     MOVE WTIM2     WTTM2
     C                     MOVE WTIM3     WTTM3
     C                     MOVE TMST      S#TMST
      *
      **  Joining Date
      *
     C                     MOVE *BLANKS   WDATE
     C                     MOVE S#JDAT    WDATE
     C                     MOVE WDAT1     WTDT1
     C                     MOVE WDAT2     WTDT2
     C                     MOVE WDAT3     WTDT3
     C                     MOVE DTST      S#JDTE
      *                                                                   CEU004
      **  Settlement Currency and IN Currency in Fld 72                   CEU004
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           CLE031    OREQ 'Y'                                                           CLE031
     C                     MOVE PMPSCY    PMSCCY                          CEU004
     C                     MOVE PMIC72    PMICCY                          CEU004
     C                     ENDIF                                          CEU004
      *
      **  Do not write Detail Fields if Action is Delete
      *
     C           W#ACTN    IFEQ 'D'
     C           *LIKE     DEFN S#CSSN    W#CSSN
     C                     MOVE S#CSSN    W#CSSN
     C                     EXSR CLRSC
     C                     EXSR INITIS
     C                     MOVE W#CSSN    S#CSSN
     C                     MOVE *BLANKS   S#JDTE
     C                     ENDIF
      *
     C                     WRITELE2022D0
      *
     C                     ENDIF
      *
      **  Write facility record
      *
     C           W#ACTN    IFEQ 'I'
     C                     EXSR WRITER
     C                     ENDIF
      *
      **  Update facility record
      *
     C           W#ACTN    IFEQ 'A'
     C                     EXSR AMENDR
     C                     ENDIF
      *
      **  Delete facility record
      *
     C           W#ACTN    IFEQ 'D'
     C                     EXSR CF10
     C                     ENDIF
      *
      **  Commit the database changes
      *
     C           P#MODE    IFNE 'B'
     C                     COMIT
     C                     ENDIF
      *
      **  Enquire facility record
      *
     C           W#ACTN    IFEQ 'E'
     C                     MOVE '1'       *IN12
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * AMOUNT    : Accumulate the Participant Share Amounts          *
      * Called by : BLDSFL                                            *
      * Calls     : None                                              *
      *****************************************************************
      *
     C           AMOUNT    BEGSR
      *
     C                     Z-ADD0         W#SHAM 130
      *
     C           K#LTL3    SETLLLEPARTL1
     C           K#LTL3    READELEPARTL1                 70
      *
     C           *IN70     DOWEQ'0'
     C                     ADD  SHAM      W#SHAM
     C           K#LTL3    READELEPARTL1                 70
     C                     ENDDO
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * KEY2      : Chain facility to populate screen fields          *
      * Called by : PROSEL                                            *
      * Calls     : None                                              *
      *****************************************************************
      *
     C           KEY2      BEGSR
      *
     C           S#SEL1    IFNE 'I'
     C                     MOVE S#BRCA    K#BRCA
     C                     MOVE S#PMFC    K#CUNO
     C                     MOVE S#PMFT    K#CUFA
     C                     MOVE S#PMFN    K#CFNO
     C                     MOVE S#CNUM    K#CSSN
     C           K#LTL2    CHAINLEPARTL1             70
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * ERRMSG    : Display Error Message for Delete                  *
      * Called by : DELETS                                            *
      * Calls     : ZASNMS                                            *
      *****************************************************************
      *
     C           ERRMSG    BEGSR
      *
     C           W#SIGN    IFEQ 'N'
     C                     MOVEL'LEK0027' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'Y'       W#SIGN
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SR2410    : Validate settlement details (Batch or Play)       *
      * Called by : VLDDET                                            *
      * Calls     : FEXSET, SD2410, *PSSR, ZASNMS                     *
      *****************************************************************
      *
     C           SR2410    BEGSR
      *
      **  Set up fields on call to SD2410 for settlement validation
      **  Process settlement branch only if method 05 and
      **  multibranching
      *
     C                     EXSR FEXSET
     C                     MOVE 'Y'       W#VSET
      *
     C                     CALL 'SD2410'
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           @PARM3                          222373
      *
      **  Terminate program if database error returned
      *
     C           PMDBSE    IFNE *ZERO
     C           *LOCK     IN   LDA
     C                     MOVELPMDBFL    DBFILE
     C                     Z-ADDPMDBSE    DBASE
     C                     MOVELPMDBKY    DBKEY
     C                     MOVELPMDPGM    DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Settlement detail in error
      *
     C           PMERCD    IFNE *BLANKS
     C           3         SUBSTPMERCD:1  WSERR   3
     C                     MOVEL'ESM0'    ZAMSID
     C                     MOVE WSERR     ZAMSID
     C                     MOVEL'DRSMM   'ZAMSGF
     C                     MOVE 'Y'       W#ERR2           Error          133253
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRWNDW    : Window processing subroutine                      *
      * Called by : ENQRYS, VLDDET                                    *
      * Calls     : WN0010                                            *
      *****************************************************************
      *
     C           SRWNDW    BEGSR
      *
     C/COPY WNCPYSRC,LE2022MOV1
      *
      **  Call window manager WN0010
      *
     C                     CALL 'WN0010'
     C                     PARM 'LE2022'  #PGM   10
     C                     PARM           KEY     2
     C                     PARM W#ACTN    ACTION  1
     C                     PARM           DATA
     C                     PARM *BLANK    #RTRN   7
     C                     PARM           SPARF 256
      *
      **  Process return code
      *
     C           #RTRN     IFNE *BLANK
     C                     MOVEL#RTRN     ZAMSID
     C                     MOVEL'WNMSGF'  ZAMSGF
     C                     EXSR ZASNMS
     C                     MOVEL'LERMSGF' ZAMSGF
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * FEXSET    : Setup details for settlement screen               *
      * Called by : SR2410, CF14                                      *
      * Calls     : MFSSCR, INITIS                                    *
      *****************************************************************
      *
     C           FEXSET    BEGSR
      *
      **  Setup details for settlement screen if first time pass
      **  through extended settlement screen.
      *
     C                     MOVE W#ACTN    PMACTC
     C***********          MOVE 'MMLD'    PMCPGM                          135152
     C                     MOVE 'LEND'    PMCPGM                          135152
     C                     Z-ADD0         PMDBSE
     C                     MOVE *BLANKS   PMERCD
     C                     MOVE 'Y'       PMFRST
     C                     Z-ADDBJRDNB    PMRUND
      *
      **  Determine if Pay & Receive Settlement Screen will be
      **  protected.
      *
     C           W#ACTN    IFEQ 'E'
     C           W#ACTN    OREQ 'D'
     C                     MOVE 'Y'       PMPRCV
     C                     MOVE 'Y'       PMPPAY
     C                     ELSE
     C                     MOVE 'N'       PMPRCV
     C                     MOVE 'N'       PMPPAY
     C                     ENDIF
      *
      **  Move file values to SD2400 parameters to be
      **  displayed on Settlement screen for Amend or Reverse.
      **  Initialize SD2400 parameters for Insert.
      *
     C           W#ACTN    IFEQ 'A'
     C           W#ACTN    OREQ 'E'
     C           W#ACTN    OREQ 'D'
     C           W#ACTN    OREQ 'I'                                       133253
     C           P#MODE    ANDEQ'B'                                       133253
     C                     EXSR MFSSCR
     C                     ELSE
     C           W#ACTN    IFEQ 'I'
     C           P#MODE    ANDEQ'I'
     C           P#MODE    OREQ 'R'
     C                     EXSR INITIS
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVE S#CSSN    PMCSNM
     C                     MOVE S#BRCA    PMBRCA
     C                     MOVE S#FCCY    PMRCCY
     C                     MOVE S#FCCY    PMPCCY
     C                     MOVE *BLANK    PMFFND
     C                     MOVE *BLANK    PMCMDP
      *
      **  For Insert clear out error codes for every entry to
      **  Extended Settlement (i.e. SD2400 treats every entry
      **  to the settlement screen as if it's the first
      **  time for insert
      *
     C           W#ACTN    IFEQ 'I'
     C                     MOVE *BLANKS   PMERCD
     C                     ENDIF
      *
      **  Flag for Validation only
      *
     C           PMFRST    IFEQ 'N'
     C                     MOVE 'Y'       PMVALO
     C                     ELSE
     C                     MOVE 'N'       PMVALO
     C                     ENDIF
      *
      **  Settlement Detials Valid Flag, Date of Receipt and Payment.
      *
     C           W#ACTN    IFEQ 'E'
     C           W#ACTN    OREQ 'D'
     C                     MOVE 'Y'       PMSDTV
     C                     Z-ADD0         PMDTRC
     C                     Z-ADD0         PMDTPY
     C                     ENDIF
      *
     C           W#ACTN    IFEQ 'I'
     C           W#ACTN    OREQ 'A'
     C                     MOVE 'N'       PMSDTV
     C                     ENDIF
      *
      **  Set up Date of Receipt
      *
     C                     Z-ADDBJRDNB    PMDTRC
      *
      **  Set up Date of Payment
      *
     C                     Z-ADDBJRDNB    PMDTPY
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * MFSSCR    : Move fields to settlement screen (SETLIAB)        *
      * Called by : FEXSET                                            *
      * Calls     : SHRTNM                                            *
      *****************************************************************
      *
     C           MFSSCR    BEGSR
      *
     C                     Z-ADDH#RSTM    PMRSTM
     C                     MOVE H#RONS    PMRONS
     C                     MOVE H#RIBN    PARIBN
     C                     MOVE H#RIBA    PMRIBA
      *
     C********** H#ROBN    IFNE 0                                                             CSD027
     C           H#ROBN    IFNE *BLANKS                                                       CSD027
     C                     MOVE H#ROBN    PAROBN
     C                     ELSE
     C                     MOVE *BLANKS   PAROBN
     C                     ENDIF
      *
     C********** H#ROCN    IFNE 0                                                             CSD027
     C           H#ROCN    IFNE *BLANKS                                                       CSD027
     C                     MOVE H#ROCN    PAROCN
     C                     ELSE
     C                     MOVE *BLANKS   PAROCN
     C                     ENDIF
      *
     C                     Z-ADDH#PSTM    PMPSTM
     C                     MOVE H#PONS    PMPONS
     C                     MOVE H#PIBN    PAPIBN
     C                     MOVE H#PIBA    PMPIBA
      *
     C********** H#POBN    IFNE 0                                                             CSD027
     C           H#POBN    IFNE *BLANKS                                                       CSD027
     C                     MOVE H#POBN    PAPOBN
     C                     ELSE
     C                     MOVE *BLANKS   PAPOBN
     C                     ENDIF
      *
     C********** H#POCN    IFNE 0                                                             CSD027
     C           H#POCN    IFNE *BLANKS                                                       CSD027
     C                     MOVE H#POCN    PAPOCN
     C                     ELSE
     C                     MOVE *BLANKS   PAPOCN
     C                     END
      *
     C                     MOVE H#CVMR    PMCVMR
     C                     MOVE H#RCRN    PARCRN
     C                     MOVE H#RCRA    PMRCRA
     C                     MOVE H#RVNO    PARVNO
     C                     MOVE H#AWBN    PAAWBN
     C                     MOVE H#AWBA    PMAWBA
     C                     MOVE H#BENN    PABENN
     C                     MOVE H#BENA    PMBENA
     C                     MOVE H#DTP1    PMDTP1
     C                     MOVE H#DTP2    PMDTP2
     C                     MOVE H#DTP3    PMDTP3
     C                     MOVE H#DTP4    PMDTP4
     C                     MOVE H#DCHG    PMDCHG
     C                     MOVE H#BTB1    PMBTB1
     C                     MOVE H#BTB2    PMBTB2
     C                     MOVE H#BTB3    PMBTB3
     C                     MOVE H#BTB4    PMBTB4
     C                     MOVE H#BTB5    PMBTB5
     C                     MOVE H#BTB6    PMBTB6
      *                                                                   134008
      * Strip out the branch if settlement method is not '05'             134008
      *                                                                   134008
     C           H#PSTM    IFEQ 05                                        134008
     C           H#POBR    IFEQ *BLANKS                                   133789
     C                     MOVE H#OMDB    PMPOBR                          133789
     C                     ELSE                                           133789
     C                     MOVE H#POBR    PMPOBR
     C                     ENDIF                                          133789
     C                     ELSE                                           134008
     C                     MOVE *BLANKS   PMPOBR                          134008
     C                     ENDIF                                          134008
      *                                                                   134008
     C           H#RSTM    IFEQ 05                                        134008
     C           H#ROBR    IFEQ *BLANKS                                   133789
     C                     MOVE H#OSDB    PMROBR                          133789
     C                     ELSE                                           133789
     C                     MOVE H#ROBR    PMROBR
     C                     ENDIF                                          133789
     C                     ELSE                                           134008
     C                     MOVE *BLANKS   PMROBR                          134008
     C                     ENDIF                                          134008
      *                                                                   CEU004
      **  Set fields if CEU004 is switched on                             CEU004
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           CLE031    OREQ 'Y'                                                           CLE031
     C                     MOVE H#SCCY    PMRSCY                          CEU004
     C                     MOVE H#SCCY    PMPSCY                          CEU004
     C                     MOVE H#ICCY    PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *
      **  Setup SETLIAZ fields
      *
     C                     EXSR SHRTNM
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE H#SCCY    PMRSCY                                              CLE031
     C                     MOVE H#REXR    PMREXR                                              CLE031
     C                     MOVE H#REXI    PMREXI                                              CLE031
     C                     MOVE H#PSCY    PMPSCY                                              CLE031
     C                     MOVE H#PEXR    PMPEXR                                              CLE031
     C                     MOVE H#PEXI    PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SHRTNM    : Setup SETLIAZ (used in SD2410)                    *
      * Called by : MFSSCR                                            *
      * Calls     : None.                                             *
      *****************************************************************
      *
     C           SHRTNM    BEGSR
      *
      **  Counterparty Pay Instructions.
      *
     C                     MOVE *BLANKS   PMRIBN
     C                     MOVELPARIBN    PMRIBN
      *
      **  RCPT - RCPT - Ordering Bank No.
      *
     C                     MOVE *BLANKS   PMROBN
     C                     MOVELPAROBN    PMROBN
      *
      **  RCPT - Ordering Customer No.
      *
     C                     MOVE *BLANKS   PMROCN
     C                     MOVELPAROCN    PMROCN
      *
      **  Pay - Intermediary Bank No.
      *
     C                     MOVE *BLANKS   PMPIBN
     C                     MOVELPAPIBN    PMPIBN
      *
      **  Pay - Ordering Bank No.
      *
     C                     MOVE *BLANKS   PMPOBN
     C                     MOVELPAPOBN    PMPOBN
      *
      **  Pay - Ordering Customer No.
      *
     C                     MOVE *BLANKS   PMPOCN
     C                     MOVELPAPOCN    PMPOCN
      *
      **  Receiver Correspondent No.
      *
     C                     MOVE *BLANKS   PMRCRN
     C                     MOVELPARCRN    PMRCRN
      *
      **  Receiver Number
      *
     C                     MOVE *BLANKS   PMRVNO
     C                     MOVELPARVNO    PMRVNO
      *
      **  Counterparty Receive Instructions.
      *
     C                     MOVE *BLANKS   PMAWBN
     C                     MOVELPAAWBN    PMAWBN
      *
      **  For Account of Instructions.
      *
     C                     MOVE *BLANKS   PMBENN
     C                     MOVELPABENN    PMBENN
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * INITIS    : Clear settlement screen for insert                *
      * Called by : FEXSET                                            *
      * Calls     : None                                              *
      *****************************************************************
      *
     C           INITIS    BEGSR
      *
     C                     Z-ADD0         PMRSTM
     C                     MOVE *BLANKS   PMRONS
     C                     MOVE *BLANKS   PARIBN
     C                     MOVE *BLANKS   PMRIBN
     C                     MOVE *BLANKS   PMRIBA
     C                     MOVE *BLANKS   PAROBN
     C                     MOVE *BLANKS   PMROBN
     C                     MOVE *BLANKS   PAROCN
     C                     MOVE *BLANKS   PMROCN
     C                     Z-ADD0         PMPSTM
     C                     MOVE *BLANKS   PMPONS
     C                     MOVE *BLANKS   PAPIBN
     C                     MOVE *BLANKS   PMPIBN
     C                     MOVE *BLANKS   PMPIBA
     C                     MOVE *BLANKS   PAPOBN
     C                     MOVE *BLANKS   PMPOBN
     C                     MOVE *BLANKS   PAPOCN
     C                     MOVE *BLANKS   PMPOCN
     C                     MOVE *BLANKS   PMCVMR
     C                     MOVE *BLANKS   PARCRN
     C                     MOVE *BLANKS   PMRCRN
     C                     MOVE *BLANKS   PMRCRA
     C                     MOVE *BLANKS   PARVNO
     C                     MOVE *BLANKS   PMRVNO
     C                     MOVE *BLANKS   PAAWBN
     C                     MOVE *BLANKS   PMAWBN
     C                     MOVE *BLANKS   PMAWBA
     C                     MOVE *BLANKS   PABENN
     C                     MOVE *BLANKS   PMBENN
     C                     MOVE *BLANKS   PMBENA
     C                     MOVE *BLANKS   PMDTP1
     C                     MOVE *BLANKS   PMDTP2
     C                     MOVE *BLANKS   PMDTP3
     C                     MOVE *BLANKS   PMDTP4
     C                     MOVE *BLANKS   PMDCHG
     C                     MOVE *BLANKS   PMBTB1
     C                     MOVE *BLANKS   PMBTB2
     C                     MOVE *BLANKS   PMBTB3
     C                     MOVE *BLANKS   PMBTB4
     C                     MOVE *BLANKS   PMBTB5
     C                     MOVE *BLANKS   PMBTB6
     C                     MOVE *BLANKS   PMPOBR
     C                     MOVE *BLANKS   PMROBR
      *                                                                   CEU004
      **  Initialise fields if CEU004 is switched on                      CEU004
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           CLE031    OREQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   PMRSCY                          CEU004
     C                     MOVE *BLANKS   PMPSCY                          CEU004
     C                     MOVE *BLANKS   PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     MOVE *BLANKS   PMREXI                                              CLE031
     C                     MOVE *BLANKS   PMPSCY                                              CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     MOVE *BLANKS   PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * CF03      : Exit Program                                      *
      * Called by : Main Routine, ENQRYS, AMENDS, REVIEW, VLDAUT      *
      *             INSERT, DELETS                                    *
      * Calls     : SD2400                                            *
      *****************************************************************
      *
     C           CF03      BEGSR
      *
      **  Close SD2400 program and end this program's processing
      *
     C           P#MODE    IFEQ 'I'
     C           P#MODE    OREQ 'R'
     C           P#MODE    OREQ 'E'
     C                     MOVE 'T'       PMTERM
     C           *IN12     IFEQ *OFF                                      145908
     C                     MOVEL'T'       R2MSGS                          145908
     C                     ELSE                                           148847
     C           WENTR     IFEQ 'N'                                       148847
     C                     MOVE 'P'       R2MSGS                          148847
     C                     ENDIF                                          148847
     C                     ENDIF                                          145908
     C                     CALL 'SD2400'
     C                     PARM           @RTCD
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           @DLNUM  6                       222373
     C                     PARM           @PARM3                          222373
     C                     ENDIF
      *
     C                     SETON                     LR
     C                     RETRN
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * CF05      : Refresh Screen                                    *
      * Called by : AMENDS, REVIEW, INSERT                            *
      * Calls     : CLEARM, BLDSFL, CLRSC, POPSCR                     *
      *****************************************************************
      *
     C           CF05      BEGSR
      *
      **  Clear Message subfile
      *
     C                     EXSR CLEARM
      *
      **  If it is in Subfile Mode
      *
     C           W#F5MD    IFEQ 'SFL'
      *
     C           W#RBLD    IFEQ 'Y'
     C                     MOVE 'N'       W#RBLD  1
      *
      **  Clear Subfile
      *
     C                     MOVE '1'       *IN31
     C                     MOVE '0'       *IN30
     C                     WRITELE2022C1
      *
      **  Build first page
      *
     C**********           Z-ADD0         K#CUST                                              CSD027
     C                     MOVE *BLANKS   K#CUST                                              CSD027
      *
     C                     Z-ADD0         RRN1
     C                     Z-ADD0         CURRRN
     C                     MOVE *BLANKS   S#SEL1
     C                     MOVE '0'       *IN40
     C                     EXSR BLDSFL
      *
     C                     ELSE
      *
      **  Clear Selection field
      *
     C           *IN60     IFEQ '0'
     C           1         CHAINLE2022S1             29
     C           *IN29     DOWEQ'0'
     C                     MOVE ' '       S#SEL1
     C                     MOVE '0'       *IN40            RI & PC
     C                     MOVE '0'       *IN35            SFLNXTCHG
     C                     UPDATLE2022S1
     C                     READCLE2022S1                 29
     C                     ENDDO
     C                     ENDIF
      *
      **  Position to first page
      *
     C                     Z-ADD1         ##SFRC           SFLRCDNBR
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  If it is in Insert Mode
      *
     C           W#F5MD    IFEQ 'INS'
     C                     EXSR CLRSC
     C                     SETOF                     404142
     C                     SETOF                     434445
     C                     SETOF                     464748
     C                     SETOF                     495051
     C                     ENDIF
      *
      **  If it is in Amend Mode
      *
     C           W#F5MD    IFEQ 'UPD'
     C                     EXSR POPSCR
     C                     SETOF                     404142
     C                     SETOF                     424445
     C                     SETOF                     464748
     C                     SETOF                     495051
     C                     ENDIF
      *
     C           *IN51     IFEQ '1'
     C                     MOVE *BLANKS   S#REV1
     C                     SETOF                     51
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * CF10      : Process Deletion of record                        *
      * Called by : UPDFLE                                            *
      * Calls     : CLEARM, DELETR, ZASNMS                            *
      *****************************************************************
      *
     C           CF10      BEGSR
      *
     C           *IN10     IFEQ '0'
     C                     MOVE '1'       *IN12
     C                     ELSE
      *
      **  Clear Message subfile
      *
     C                     EXSR CLEARM
      *
      **  Update facility file
      *
     C                     EXSR DELETR
      *
      **  Rebuild subfile if not in Play/Batch Mode
      *
     C           P#MODE    IFNE 'P'
     C           P#MODE    ANDNE'B'
     C           W#ERR2    IFNE 'Y'
     C                     MOVE 'Y'       W#RBLD
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * CF12      : Previous Screen                                   *
      * Called by : ENQRYS, AMENDS, DELETS, INSERT                    *
      * Calls     : CLEARM                                            *
      *****************************************************************
      *
     C           CF12      BEGSR
      *
     C                     MOVE 'Y'       W#CF12  1
      *
      **  Clear Message subfile
      *
     C                     EXSR CLEARM
      *
     C                     SETOF                     414243
     C                     SETOF                     444546
     C                     SETOF                     474849
     C                     SETOF                     505152
     C                     MOVE 'N'       W#FLAG
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * CF14      : Extended Settlement Details                       *
      * Called by : ENQRYS, AMENDS, DELETS, INSERT                    *
      * Calls     : FEXSET, SD2400                                    *
      *****************************************************************
      *
     C           CF14      BEGSR
      *
     C                     MOVE 'Y'       W#CF14  1
      *
      **  Setup parameters for call to SETLIB
      *
     C           W#FLAG    IFEQ 'N'
     C                     EXSR FEXSET
     C                     ENDIF
     C                     MOVE *BLANKS   PMTERM
      *
     C                     CALL 'SD2400'
     C                     PARM           @RTCD
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           @DLNUM  6                       222373
     C                     PARM           @PARM3                          222373
      *
      **  Terminate program if database error returned
      *
     C           PMDBSE    IFNE 0
     C           *LOCK     IN   LDA
     C                     MOVELPMDBFL    DBFILE
     C                     MOVE PMDBSE    DBASE
     C                     MOVELPMDBKY    DBKEY
     C                     MOVELPMDPGM    DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           PMCMDP    IFEQ '03'
     C                     MOVE '1'       *IN03
     C                     MOVE '0'       *IN14
      *
     C                     ELSE
     C           PMCMDP    IFEQ '12'
     C           W#ACTN    ANDNE'D'
     C           W#ACTN    ANDNE'E'
      *
      **  Settlement Detail valid or F12 is pressed without validation
      **  (i.e. ENTER not pressed in the settlement screen)
      *
     C           PMSDTV    IFEQ 'Y'
     C           PMSDTV    OREQ 'N'
     C           PMERCD    ANDEQ*BLANKS
     C                     MOVE 'Y'       W#VSET  1
     C                     MOVE 'Y'       W#FLAG  1
     C                     ENDIF
      *
      **  Settlement Detail in Error
      *
     C           PMERCD    IFNE *BLANKS
     C                     MOVE 'N'       W#VSET
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     MOVE 'N'       PMFRST
      *
     C                     MOVE *OFF      *IN14                                               CLE031
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * CLRSC     : Clear Screen fields                               *
      * Called by : ENQRYS, AMENDS, DELETS, WRITER, UPDFLE, CF05      *
      *             INSERT                                            *
      * Calls     : None                                              *
      *****************************************************************
      *
     C           CLRSC     BEGSR
      *
     C                     MOVE *BLANK    S#CSSN
     C                     MOVE *BLANK    S#INUM
     C                     MOVE *BLANK    S#JDAT
     C                     MOVE *BLANK    S#SHTP
     C                     MOVE *BLANK    S#SHAR
     C                     MOVE *BLANK    S#LPBR
     C                     MOVE *BLANK    S#LPAM
     C                     MOVE *BLANK    S#LPPS
     C                     MOVE *BLANK    S#DFTP
     C                     MOVE *BLANK    S#DFST
     C                     MOVE *BLANK    S#SRNM                          153650
     C                     MOVE *BLANK    S#SRTN                          153650
     C                     MOVE *BLANK    S#IRNM                          153650
     C                     MOVE *BLANK    S#IRTN                          153650
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * CLEARM    : Clears the message queue                          *
      * Called by : ENQRYS, AMENDS, DELETS, WRITER, VLDDET, REVIEW    *
      *             PROSEL, INSERT, CF05, CF10, CF12                  *
      * Calls     : Y2CLMSC                                           *
      *****************************************************************
      *
     C           CLEARM    BEGSR
      *
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * ZASNMS    : Sends messages to the program's message queue     *
      * Called by : Main routine                                      *
      * Calls     : SRBERR, Y2SNMGC                                   *
      *****************************************************************
      *
     C           ZASNMS    BEGSR
      *
     C           P#MODE    IFEQ 'B'
     C           P#MODE    OREQ 'P'
     C                     EXSR SRBERR
      *
     C                     ELSE
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     ENDIF
      *
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message Id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C                     PARM           ZAMSTP  7        Message type.
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRBERR    : Set up batch error details                        *
      * Called by : ZASNMS                                            *
      * Calls     : Y2RVMGC                                           *
      *****************************************************************
      *
     C           SRBERR    BEGSR
      *
     C                     CALL 'Y2RVMGC'
     C                     PARM           @RTCD
     C                     PARM           ZAMSID           Message Id.
     C                     PARM           ZAMSGF           Message file.
     C                     PARM           ZAMSDA           Message data.
     C                     PARM           ZAMSTX132        Messge text
      *                                                                   133253
      *  Include DUMP here for problems during batch and play modes.      133253
      *                                                                   133253
     C           W#ERR2    IFEQ 'Y'                                       133253
     C                     DUMP                                           133253
     C                     ENDIF                                          133253
      *
      **  If batch mode, set up details of returned message format
      **  otherwise update message severity/id/text of test
      **  harness file.
      *
     C           P#MODE    IFEQ 'B'
     C                     MOVE R1MSGT    R2MSGT
     C                     MOVE R1TRUS    R2TRUS
     C                     MOVE R1TRWS    R2TRWS
     C                     MOVE R1TNRF    R2TNRF
     C                     MOVE R1TRSN    R2TRSN
     C                     MOVE R1ACTN    R2ACTN
     C                     MOVE R1TRDS    R2TRDS
     C                     MOVE R1TRTS    R2TRTS
     C                     MOVE R1NRBA    R2NRBA
     C***********          MOVELW#SEV     R2MSGS                          133253
     C                     MOVEL'E'       R2MSGS                          133253
     C                     MOVELZAMSID    R2MSGI
     C                     MOVELZAMSTX    R2MSTX
     C                     MOVE R1CNUM    R2CNUM
     C                     MOVE R1FACT    R2FACT
     C                     MOVE R1FCNO    R2FCNO
     C                     MOVE R1MNUM    R2MNUM
     C                     MOVE R1INUM    R2INUM
     C                     MOVE '1'       *INLR
     C                     RETRN
      *
      **  Play Mode
      *
     C                     ELSE
     C***********          MOVELW#SEV     RMSV                            133253
     C                     MOVEL'E'       RMSV                            133253
     C                     MOVELZAMSID    RMID
     C                     MOVELZAMSTX    RMTY
     C                     UPDATLE2022D0
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * *PSSR     : Program exception error routine                   *
      * Called by :                                                   *
      * Calls     : DBERRCTL                                          *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           ** *PSSR SR **
      *
     C           @RUN      IFEQ *BLANK
      *
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     MOVE '0'       *INU7
     C                     MOVE '0'       *INU8
     C                     MOVE '0'       *INLR
     C           P#MODE    IFNE 'P'
     C           P#MODE    ANDNE'B'
     C                     CALL 'DBERRCTL'
      *
     C                     ENDIF
      *
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
     C/COPY ZSRSRC,ZALIGNZ2L
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZEDITZ2L
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z2
      /EJECT
     C/COPY ZSRSRC,ZDAT10Z2
      *
** STAMP - Dummy timestamp                                                                    CPK015
0001-01-01-00.00.00.000000                                                                    CPK015
**  CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
