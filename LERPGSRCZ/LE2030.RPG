     H        1
      *****************************************************************
/*XBI *  OVRDBF FILE(LEILONLX) TOFILE(LEILONL2) SHARE(*NO)            *    CAP053
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Loans/parts purchased/parts sold input')      *
      *****************************************************************
      *                                                               *
      *  Midas - Customer Lending Module                              *
      *                                                               *
      *  LE2030 - Loans/Parts Purchased/Parts Sold Input              *
      *                                                               *
      *  Function:  This is a new program for Loan, Participation     *
      *             Purchased and Participation Sold.  This could be  *
      *             run in any of the five modes available, depending *
      *             on the parameter passed to it.                    *
      *               1. Interactive ('I') - called from the Midas    *
      *                    Transaction Input menu                     *
      *               2. Record ('R') - Run interactively but updates *
      *                    are done to a new 'test harness' file      *
      *               3. Play ('P') - Run interactively but data is   *
      *                    read from the 'test harness' file          *
      *               4. Batch ('B') - Run in batch and called by a   *
      *                    communications control program             *
      *               5. Repair ('F') - called from the Midas         *    CAP053
      *                    Transaction Input menu to repair invalid   *    CAP053
      *                    transactions.                              *    CAP053
      *                                                               *
      *  Called By: LEC0202 - Customer Loans Input CLP                *
      *             LEC0204 - Parts Purchased Input CLP               *
      *             LEC0205 - Parts Sold Input CLP                    *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. MD034840           Date 10Feb17               *
      *  Prev Amend No. CGL184             Date 07Dec16               *
      *                 MD035570           Date 05Oct15               *
      *                 MD041443           Date 19Sep16               *
      *                 CLE141             Date 08Feb16               *
      *                 AR847588           Date 10Mar15               *
      *                 AR868380           Date 11Jun13               *
      *                 AR882700           Date 07Jun13               *
      *                 AR819476           Date 06Jun13               *
      *                 AR830785           Date 07May13               *
      *                 AR1021136          Date 24Apr13               *
      *                 AR1067935          Date 24Apr13               *
      *                 AR1096933          Date 02Apr13               *
      *                 AR1089839          Date 20Feb13               *
      *                 AR740107A          Date 21Dec12               *
      *                 AR740107           Date 21Dec12               *
      *                 AR826115           Date 07Dec12               *
      *                 AR722666           Date 18Oct12               *
      *                 AR740717           Date 18Oct12               *
      *                 260514             Date 17Oct12               *
      *                 AR763386           Date 14Oct12               *
      *                 AR548562           Date 20Sep12               *
      *                 AR322732           Date 23Jul12               *
      *                 AR970786           Date 23Jul12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR820267           Date 25Aug11               *
      *                 CRE073             Date 06Dec10               *
      *                 CLE143             Date 06Dec10               *
      *                 CLE139             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 AR705865           Date 09Feb11               *
      *                 261338             Date 27Nov09               *
      *                 262328             Date 30Oct09               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      *                 CER047             Date 19May08               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG21845A          Date 26Feb09               *
      *                 BUG21845           Date 23Feb09               *
      *                 BUG22318           Date 28Jan09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 258109             Date 11Dec08               *
      *                 257126             Date 10Oct08               *
      *                 256730             Date 06Oct08               *
      *                 246141             Date 26Mar07               *
      *                 245297             Date 27Feb06               *
      *                 238907             Date 15Dec06               *
      *                 164847             Date 30Nov06               *
      *                 243770             Date 16Nov06               *
      *                 CRE026             Date 19Feb07               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 26Sep06               *
      *                 241648             Date 01Sep06               *
      *                 238657             Date 17Jul06               *
      *                 CGL058             Date 30Jun06               *
      *                 BUG11642           Date 28Jun06               *
      *                 CSD031             Date 10Apr06               *
      *                 BUG8832            Date 03Oct05               *
      *                 BUG11371           Date 16May06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 BUG9850            Date 12Jan06               *
      *                 228328             Date 11Aug04               *
      *                 227711             Date 28May04               *
      *                 227710             Date 21May04               *
      *                 CLE038             Date 12May04               *
      *                 227374             Date 28May04               *
      *                 227114             Date 14May04               *
      *                 226238             Date 06Apr04               *
      *                 225272             Date 30Mar04               *
      *                 223619             Date 09Dec03               *
      *                 223592             Date 05Dec03               *
      *                 222575             Date 13Nov03               *
      *                 221965             Date 08Oct03               *
      *                 CLE036             Date 22Sep03               *
      *                 CIR013             Date 25Apr05               *
      *                 233545             Date 18May05               *
      *                 CAS011             Date 16May05               *
      *                 232348             Date 21Feb05               *
      *                 232314             Date 28Feb05               *
      *                 CAS009             Date 04May04               *
      *                 CSW037A            Date 02May05               *
      *                 228390             Date 14Jul04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3644            Date 12Jul04               *
      *                 BUG4524            Date 18Oct04               *
      *                 CLE025             Date 20Oct03               *
      *                 225491             Date 05Mar04               *
      *                 CGL029             Date 01Sep03               *
      *                 222709             Date 14Nov03               *
      *                 CPK018             Date 15Nov03               *
      *                 222373             Date 28Oct03               *
      *                 221941             Date 07Oct03               *
      *                 220754             Date 02Sep03               *
      *                 CAP075             Date 08Aug02               *
      *                 CAP074             Date 08Aug02               *
      *                 CAP073             Date 08Aug02               *
      *                 CDE005             Date 08Aug02               *
      *                 CLE029             Date 04Sep02               *
      *                 CPK017             Date 14Sep03               *
      *                 216736             Date 08Sep03               *
      *                 219069             Date 08Sep03               *
      *                 218753             Date 08Sep03               *
      *                 218581             Date 08Sep03               *
      *                 CLE034             Date 08Sep03               *
      *                 217270             Date 08Sep03               *
      *                 CLE033             Date 08Sep03               *
      *                 CLE031             Date 07Sep03               *
      *                 CSF002             Date 11Aug03               *
      *                 222972             Date 23Nov02               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 220514             Date 12Aug03               *
      *                 219695             Date 16Jul03               *
      *                 218531             Date 04Jun03               *
      *                 CSD015             Date 14Oct02               *
      *                 217847             Date 12May03               *
      *                 216443             Date 05Apr03               *
      *                 CLE028             Date 27Jun02               *
      *                 CAS004             Date 26Jun02               *
      *                 208221             Date 11Dec02               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 202101             Date 10Jan03               *
      *                 212288             Date 10Jan03               *
      *                 211871             Date 10Jan03               *
      *                 211253             Date 10Jan03               *
      *                 206438             Date 06Jan03               *
      *                 204024             Date 06Jan03               *
      *                 202917             Date 06Jan03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 206578             Date 27Nov02               *
      *                 202436             Date 03Oct02               *
      *                 197449             Date 03Oct02               *
      *                 211587             Date 05Nov02               *
      *                 211489             Date 04Nov02               *
      *                 204786             Date 29Oct02               *
      *                 209887             Date 11Oct02               *
      *                 208725             Date 17Sep02               *
      *                 206235             Date 29Aug02               *
      *                 206257             Date 28Aug02               *
      *                 207964             Date 23Aug02               *
      *                 207595             Date 23Aug02               *
      *                 207689             Date 23Aug02               *
      *                 207676             Date 23Aug02               *
      *                 203794             Date 23Aug02               *
      *                 206443             Date 11Jun02               *
      *                 205249             Date 10Jun02               *
      *                 205535             Date 10Jun02               *
      *                 190640             Date 07Jun02               *
      *                 204708             Date 07Jun02               *
      *                 204452             Date 02May02               *
      *                 201672             Date 29Apr02               *
      *                 204347             Date 25Apr02               *
      *                 204247             Date 24Apr02               *
      *                 204073             Date 24Apr02               *
      *                 202381             Date 24Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAP068             Date 25JUN02               *
      *                 203795             Date 19Mar02               *
      *                 203092             Date 18Feb02               *
      *                 CLE023             Date 19Nov01               *
      *                 CSC011             Date 12Feb02               *
      *                 202537             Date 31JAN02               *
      *                 202402             Date 22JAN02               *
      *                 202401             Date 22JAN02               *
      *                 194864             Date 06Feb02               *
      *                 199985             Date 22Jan02               *
      *                 CAS001             Date 23Nov01               *
      *                 CLE015             Date 13Dec01               *
      *                 195745             Date 15Jan02               *
      *                 201165             Date 11Jan02               *
      *                 199274             Date 03Jan02               *
      *                 199822             Date 21Dec01               *
      *                 200031             Date 20Dec01               *
      *                 193974             Date 21Sep01               *
      *                 197084             Date 11Sep01               *
      *                 161824             Date 16Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CAP053             Date 12Mar01               *
      *                 193944             Date 23Jul01               *
      *                 186431             Date 19Jul01               *
      *                 191152             Date 16Jul01               *
      *                 178920             Date 16Jul01               *
      *                 181775             Date 16Jul01               *
      *                 180051             Date 13Jul01               *
      *                 193890             Date 28Jun01               *
      *                 192790             Date 28Jun01               *
      *                 190132             Date 28Jun01               *
      *                 190638             Date 28Jun01               *
      *                 190016             Date 28Jun01               *
      *                 183896             Date 28Jun01               *
      *                 183572             Date 28Jun01               *
      *                 194715             Date 03Jul01               *
      *                 194509             Date 19Jun01               *
      *                 CDE002             Date 04Apr00               *
      *                 CLE014             Date 20Mar01               *
      *                 191800             Date 18May01               *
      *                 185035             Date 01May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 15May01               *
      *                 190420             Date 27FEB01               *
      *                 189591             Date 19Feb01               *
      *                 188583             Date 02Feb01
      *                 189824             Date 14Feb01               *
      *                 189593             Date 14Feb01               *
      *                 181084             Date 30Jan01               *
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CRT004             Date 04May00               *
      *                 185457             Date 08Nov00               *
      *                 180654             Date 19Sep00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 175450             Date 09Mar00               *
      *                 175452             Date 08Mar00               *
      *                 CIR004             Date 20Jan00               *
      *                 171863             Date 24Jul00               *
      *                 175451             Date 08Jun00               *
      *                 176510             Date 28Mar00               *
      *                 177012             Date 28Mar00               *
      *                 174984             Date 12Apr00               *
      *                 CDE001             Date 12Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 168879             Date 11Nov99               *
      *                 168270             Date 17Sep99               *
      *                 169212             Date 19Oct99               *
      *                 CPB001             Date 08Sep99               *
      *                 CLE009             Date 29Apr99               *
      *                 167146             Date 10Sep99               *
      *                 165965             Date 17Aug99               *
      *                 162899             Date 06Aug99               *
      *                 161257             Date 01Aug99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 154991             Date 26Jul99               *
      *                 162648             Date 18Jun99               *
      *                 134725             Date 14Jun99               *
      *                 159259             Date 09Jun99               *
      *                 158264             Date 25May99               *
      *                 160946             Date 25May99               *
      *                 159215             Date 25May99               *
      *                 160632             Date 25May99               *
      *                 158863             Date 25May99               *
      *                 158055             Date 24May99               *
      *                 CPL002             Date 08Mar99               *
      *                 159256             Date 11May99               *
      *                 160096             Date 04May99               *
      *                 157756             Date 30Apr99               *
      *                 154221             Date 26Apr99               *
      *                 159355             Date 21Apr99               *
      *                 157749             Date 20Apr99               *
      *                 158856             Date 15Apr99               *
      *                 157553             Date 14Apr99               *
      *                 158582             Date 08Apr99               *
      *                 158143             Date 30Mar99               *
      *                 157634             Date 29Mar99               *
      *                 157636             Date 26Mar99               *
      *                 158087 (BT1105)    Date 30Sep98               *
      *                 158085 (BT1430)    Date 02Feb99               *
      *                 158084 (BT1453)    Date 04Feb99               *
      *                 158082 (BT1468)    Date 09Feb99               *
      *                 158059 (BT0377)    Date 29Mar99               *
      *                 158058 (BT0450)    Date 29Mar99               *
      *                 158057 (BD5150)    DATE 29Mar99               *
      *                 158703 (BT0511)    Date 09DEC97               *
      *                 158056 (BT0458)    DATE 29Mar99               *
      *                 158054 (BD5387)    DATE 29Mar99               *
      *                 158052 (BT0844)    Date 29Mar99               *
      *                 158051 (BT0923)    Date 29Mar99               *
      *                 158047 (BT1086)    Date 21Aug98               *
      *                 158050 (WH0001)    Date 29Mar99               *
      *                 158046 (BT0506)    Date 29Mar99               *
      *                 157535             Date 26Mar99               *
      *                 157761             Date 24Mar99               *
      *                 157675             Date 24Mar99               *
      *                 147999             Date 11Mar99               *
      *                 156497             Date 11Mar99               *
      *                 156297             Date 05Mar99               *
      *                 156136             Date 04Mar99               *
      *                 154799             Date 24Feb99               *
      *                 154711             Date 10Feb99               *
      *                 151295             Date 18Feb99               *
      *                 134804             Date 04Jun98               *
      *                 155936             Date 24Feb99               *
      *                 155773             Date 23Feb99               *
      *                 155721             Date 24Feb99               *
      *                 155674             Date 23Feb99               *
      *                 155610             Date 26Feb99               *
      *                 155102             Date 16Feb99               *
      *                 153860             Date 15Feb99               *
      *                 153787             Date 16Feb99               *
      *                 153786             Date 26Jan99               *
      *                 153663             Date 21Jan99               *
      *                 152892             Date 13Jan99               *
      *                 152618             Date 11Jan99               *
      *                 152323             Date 07Jan99               *
      *                 152176             Date 15Jan99               *
      *                 152173             Date 05Jan99               *
      *                 150748             Date 06Jan99               *
      *                 150744             Date 22Dec98               *
      *                 147261             Date 27Jan99               *
      *                 146834             Date 14Jan99               *
      *                 146745             Date 04Nov98               *
      *                 145826             Date 28Oct98               *
      *                 145490             Date 20Oct98               *
      *                 144089             Date 23Oct98               *
      *                 143772             Date 12Oct98               *
      *                 142586             Date 08Oct98               *
      *                 142522             Date 13Nov98               *
      *                 142405             Date 26Feb99               *
      *                 142388             Date 18Feb99               *
      *                 142393             Date 18Feb99               *
      *                 142225             Date 18Feb99               *
      *                 142002             Date 18Feb99               *
      *                 141453             Date 17Feb99               *
      *                 141200             Date 16Feb99               *
      *                 140825             Date 15Feb99               *
      *                 138350             Date 11Feb99               *
      *                 135152             Date 11Feb99               *
      *                 133865             Date 10Feb99               *
      *                 132568             Date 05Feb99               *
      *                 132564             Date 04Feb99               *
      *                 132559             Date 04Feb99               *
      *                 125258             Date 31Mar98 (Re-open)     *
      *                 132558             Date 04Feb99               *
      *                 132162             Date 04Feb99               *
      *                 131253             Date 04Feb99               *
      *                 122461             Date 11Feb99               *
      *                 144915             Date 28Oct98               *
      *                 144688             Date 15Oct98               *
      *                 CEU004             Date 02Feb98               *
      *                 121768             Date 20Feb98               *
      *                 125258             Date 05Mar98               *
      *                 127120             Date 17Feb98               *
      *                 127124             Date 16Feb98               *
      *                 125697             Date 16Feb98               *
      *                 126623             Date 16Feb98               *
      *                 130173             Date 06Feb98               *
      *                 128953             Date 20Jan98               *
      *                 128946             Date 16Jan98               *
      *                 128563             Date 07Jan98               *
      *                 CLE007             Date 27Jun97               *
      *                 CLE005             Date 22May97               *
      *                 127169             Date 05Dec97               *
      *                 126310             Date 24NOV97               *
      *                 126274             Date 20NOV97               *
      *                 126065             Date 18NOV97               *
      *                 125557             Date 13NOV97 (Re-open)     *
      *                 125468             Date 07NOV97               *
      *                 125557             Date 06NOV97               *
      *                 125545             Date 06NOV97               *
      *                 125027             Date 04NOV97               *
      *                 125323             Date 04NOV97               *
      *                 125184             Date 31Oct97               *
      *                 125029             Date 31Oct97               *
      *                 124812             Date 23Oct97               *
      *                 124727             Date 22Oct97               *
      *                 123857             Date 15Oct97               *
      *                 122685             Date 09Oct97               *
      *                 121141             Date 09Oct97               *
      *                 124024             Date 07Oct97               *
      *                 124001             Date 07Oct97               *
      *                 123906             Date 07Oct97               *
      *                 123998             Date 07Oct97               *
      *                 123801             Date 06Oct97               *
      *                 123859             Date 06Oct97               *
      *                 123789             Date 02Oct97               *
      *                 122098             Date 02Oct97               *
      *                 120025             Date 01Oct97               *
      *                 123471             Date 25Sep97               *
      *                 123295             Date 22Sep97               *
      *                 123227             Date 19Sep97               *
      *                 123021             Date 15SEP97               *
      *                 122960             Date 15SEP97               *
      *                 122718             Date 12SEP97               *
      *                 122651             Date 05SEP97               *
      *                 122650             Date 05SEP97               *
      *                 122649             Date 05SEP97               *
      *                 122485             Date 02SEP97               *
      *                 122384             Date 29AUG97               *
      *                 122052             Date 21AUG97               *
      *                 121783             Date 21AUG97               *
      *                 121970             Date 21AUG97               *
      *                 121855             Date 21AUG97               *
      *                 121890             Date 15AUG97               *
      *                 121737             Date 12AUG97               *
      *                 121719             Date 11AUG97               *
      *                 121718             Date 11AUG97               *
      *                 121715             Date 11AUG97               *
      *                 121711             Date 11AUG97               *
      *                 121710             Date 11AUG97               *
      *                 121142             Date 23JUL97               *
      *                 120813             Date 23JUL97               *
      *                 120842             Date 22JUL97               *
      *                 120825             Date 22JUL97               *
      *                 120670             Date 17JUL97               *
      *                 120392             Date 10JUL97               *
      *                 120468             Date 09JUL97               *
      *                 120278             Date 08JUL97               *
      *                 120121             Date 04JUL97               *
      *                 120002             Date 02JUL97               *
      *                 119594             Date 20JUN97               *
      *                 CLE004 *Create     Date 02Dec96               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD034840 - No error issued for input of base rate even if    *
      *             Base Rate Change Facility ICD is set to 'N'.      *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  MD035570 - LEC06 failed on checksum. Amend LCD on insert     *
      *             to be the same as ORED.                           *
      *  MD041443 -  CBC022001 failed due to invalid character in file *
      *             text description (Recompile)                      *
      *  CLE141 - Currency and Location Business Day Convention       *
      *           (Recompile)                                         *
      *  AR847588 - Enable system to accept negative spread rate.     *
      *           - Applied for MD033488                              *
      *  AR868380 - APISERVER on LCKW status. Return *RECLCK to       *
      *             calling program if file locking occurred on       *
      *             online position files. (Child: AR868381)          *
      *  AR882700 - LEC06A on MESSAGEWAIT on A1 TEST SYSTEM. Insert   *
      *             additional validation in Facility Currency        *
      *             Exchange Rate. (Child: AR882701)                  *
      *  AR819476 - System did not generate the projected movements   *
      *             after changing PDCL loan's settlement account.    *
      *             Amend program to reverse the projected movement   *
      *             for the old account and generate the projected    *
      *             movement for the new account.  (Child: AR819484)  *
      *  AR830785 - Looping on insert of accrued interest adjustment  *
      *             Extended core fix 263533. (Child: AR830786)       *
      *  AR1021136 - CLE148: Loan with reference '000000' can be      *
      *              created. Issue an error message when AlphaLoan   *
      *              is allow and input loan ref# is '000000' or      *
      *              '999999'. Also, issue an error message when      *
      *              action 'A' and 'X' for loan with ref# '000000'.  *
      *              (Child: AR1021140)                               *
      *  AR1067935 - CLE134: Changes to repayment details for PDCL are*
      *              accepted. Do not allow repayment details for     *
      *              PDCL. (Child: AR1067936)                         *
      *  AR1096933 - Warning message of event code not found during   *
      *              complete and authorisation.                      *
      *  AR1089839 - COBOP and 2.1 source clashes                     *
      *  AR740107A - No warning message is encountered when maturity  *
      *              date is amended to be and has a repayment        *
      *              scheduled on the same date. Amend program such   *
      *              a warning message would be shown if maturity date*
      *              and repayment schedule has the same date.        *
      *              (Child: AR740108A)                               *
      *  AR740107 - Maturity changed equal to repayment date requires *
      *             warning message. Additional validation added      *
      *             between Maturity and Next Repayment date.         *
      *             (Child: AR740108)                                 *
      *  AR826115 - Component LEC0456 failed due to DBERR 10 in file  *
      *             SDBSRTPD. Removed validation of BPBRCF to prevent *
      *             database error when BPBRCF='N'. (Child: AR826116) *
      *  AR722666 - Loan matured but still shows old maturity date.   *
      *             Amendment of maturity date should also consider   *
      *             the defined maturity on LS amendment from LOAMS   *
      *             (Child: AR722667)                                 *
      *  AR740717 - Maturity date cannot be earlier than existing loan*
      *             amendment(except REpayment Schedule) and historic *
      *             event (Child: AR740718)                           *
      *  260514 - APISERVER looping when Loan repayment date          *
      *           amended for repayment type 3                        *
      *  AR763386 - Error on amendment of PDCL with expired facility. *
      *             Added condition to allow amendment of PDCL even   *
      *             if facility is expired. (Child: AR763387)         *
      *  AR548562 - Incorrect OSDB field after amendment of loan via  *
      *             API. Added validation if PMPPAY/PMPRCV is 'Y',    *
      *             field OSDB/OMDB will not be updated. Patterned    *
      *             after fix 244018B                                 *
      *  AR322732 - LEC0212A and APISERVER locks LTRIX file.          *
      *           - Prevent LTRIX RRN 1 from being locked.            *
      *  AR970786 - Error while closing the loan (Child: AR970787)    *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR820267 - Mapping error and Contractual Spread error not    *
      *             recognized                                        *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CLE143 - Original Loan Contract Date & Effective Interest    *
      *           Rate (Recompile)                                    *
      *  CLE139 - Lending Fee Capitalisation (Recompile)              *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  AR705865 - Error "Could not find record" due to T_GZCLIPEX   *
      *             table not populated (Child: AR705866)             *
      *  261338 - Loan was not written to PF/CLONCLQD extension file  *
      *           causing Midas Plus screen to display error message  *
      *           that loan could not be found.                       *
      *           Amend program to write record in PF/CLONCLQD when   *
      *           transaction is processed thru API.                  *
      *  262328 - Serious Midas error occurred. Increase size of WBIC *
      *           array from 150 to 900.                              *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CER047 - German Features LF037-00 Reporting §24c             *
      *           (Recompile)                                         *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus                                          *
      *  BUG21845A - Wrong interest calculation for Flat Rate Loans   *
      *              Reopened                                         *
      *  BUG21845 - Wrong interest calculation for Flat Rate Loans    *
      *  BUG22318 - Risk Participation loans with recourse are not    *
      *             allowed                                           *
      *  258109 - Retrieve Rate fixing days default.                  *
      *  257126 - Collect RZB R4 fixes 227278, 232435, 224038.        *
      *         - Allow same processing for 'F'-front office repair-  *
      *           as in 'B' Back office. Copy existing fields for     *
      *           amendments. Also ignore any compare errors as       *
      *           non-amandable fields will not be sent from F/O.     *
      *           Incomplete fix 207689. Applied it to batch mode for *
      *           API use                                             *
      *           Pass loan number and loan T/S from loan record id   *
      *           coming blank from the APIs                          *
      *           Amend fix 162648. Move settelemt nostro correctly   *
      *           if settlement methos is 05                          *
      *           Pass correct our nostro for settlement type 05      *
      *           When LTRIX's next relative record is non-blank,     *
      *           program loops.                                      *
      *  256730 - Allow LNRF value for PTPU and PTSO.                 *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  245297 - Settlement fields are overwritten after chain to    *
      *           CLOAN for the details of SOLNO.                     *
      *  238907 - Rename RONS and PONS for LOAMSDKF and LELOAM3F.     *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  243770 - LEL0132 prevented maturity of participated loan.    *
      *           The system should amend the participants' maturity  *
      *           dates. (Changes not applied here since CLE106       *
      *           is not included in this source code)                *
      *  CRE026 - Consumer Banking                                    *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  241648 - Allow repayment date equal to loan's maturity date. *
      *  238657 - Reopen of BUG8832.                                  *
      *         - DS/MAINRF no longer matches Pf/CLOANCL causing      *
      *           ESM0908 to still be produced when settle details    *
      *           validated through SD2410.                           *
      *  CGL058 - Default Branch Code                                 *
      *  BUG11642 - parm mismatch on call to AOLOANR0 due to          *
      *             Loan Class not passed (introduced by CLE042).     *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  BUG8832- Necessary changes missed by CGL029                  *
      *  BUG11371 - Incorrect re-use of indicators 2 and 3.           *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  BUG9850- Unsuccessful creation of Loan via Prin Transfer     *
      *  228328 - Remove fix 221965. If SPIN = P, Effective Interest  *
      *           Rate should just be percentage of Base Rate.        *
      *  227711 - Risk participants not identified correctly.         *
      *  227710 - If F3 is pressed in the settlement programs, ensure *
      *           that all database changes are rolled back.          *
      *  CLE038 - Lending Enhancement for Nordea: Allocation by Amount*
      *  227374 - When doing a principal transfer, the deal date can  *
      *           be a holiday in the local currency                  *
      *  227114 - If the facility currency repayment amount is        *
      *           outside the tolerance, this should be a warning     *
      *           error similar to the facility currency exchange rate*
      *  226238 - Only recalculate the loan amount from the facility  *
      *           amount if not in batch as get both values in batch  *
      *  225272 - Rounding gives an error which is incorrect.         *
      *           If convert cpam to facility currency, the result    *
      *           does not have to equal fpam. Should then convert    *
      *           fpam to loan currency. If this does not equal cpam  *
      *           then this is an error.                              *
      *           This is because the fpam is input on Loan Manager   *
      *           which converts it to give the cpam. If you then     *
      *           convert back again can get rounding errors.         *
      *           The fix just repeats the calculation that Loan      *
      *           Manager has done and sees if it gets the same result*
      *  223619 - Error fix 180654 should not have changed when the   *
      *           change indicator is taken from the Loan Manager     *
      *           message. If the base rate code is blanks or '00',   *
      *           then leave the change indicator as blanks to get    *
      *           defaulted.                                          *
      *  223592 - Only do not do shadow postings if the loan is part  *
      *           principal transfer unit of work.                    *
      *  222575 - For loans generated by Principal Transfers, default *
      *           the base rate change indicator to that from the     *
      *           transfer originating loan.                          *
      *  221965 - If spread is 'P' effective interest is the Base Rate*
      *           + the percentage of the base rate.                  *
      *  CLE036 - LE Enh for Nordea Phase 1 Pty 2- Specific Base Rate *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *  233545 - Cut-off Date (Recompile)                            *
      *  CAS011 - EIR/AC Accounting Upgrade to MP1                    *
      *  232348 - Introduce cut-off date for non-linear amortisation  *
      *  232314 - TFDP and TFDPA are updated incorrectly              *
      *  CAS009 - Effective Interest Rate/Amortised Cost Accounting   *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  228390 - Introduce a new yield curve type 'S' (for swap      *
      *           rates) which will apply the formula currently being *
      *           used by curve type 'Z' and a new formula for type   *
      *           'Z' is to be introduced.                            *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  BUG4524- Data mapping error in CLOAN file during insert of   *
      *           Part Sold Loan.                                     *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  225491 - Need timestamp if called for Principal Transfer.    *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222709 - SUBR/SRSHDW (Project movements) is not being called *
      *           when PMODE = 'B' due to fix 217270.                 *
      *  CPK018 - MidasPlus additional packaging.                     *
      *  222373 - Parameter mismatch.                                 *
      *  221941 - Do not allow input in facility currency amount      *
      *           if the facility and loan currencies are the same.   *
      *  220754 - Multi-currency rollovers need to be processed       *
      *           by the online updates.                              *
      *  CAP075 - Lending API enhancements - Loan Amendments Input    *
      *  CAP074 - Lending API enhancements - Loans input.             *
      *  CAP073 - Lending API enhancements - Facility Input           *
      *  CDE005 - Reservation ID                                      *
      *  CLE029 - Addition of Severity code and Limit ID to FCLTYFM   *
      *  CPK017 - Midas Plus packaging.  Clash of field names.        *
      *  216736 - When checking if a risk part sold, cannot rely on   *
      *           there not being a participant facility as there     *
      *           could be a funding participant with the same cust   *
      *  219069 - Only do check that the convert loan amount and the  *
      *           facility amount are same if the currencies are      *
      *           different                                           *
      *  218753 - Do not use old 'Last Availability Date' if facility *
      *           has been reactivated.                               *
      *  218581 - RPCR should not be set up in batch mode             *
      *  CLE034 - Lending Enhancements Phase 1 Priority 1A            *
      *  217270 - Amending loan on loan manager produces duplicate    *
      *           records on LEHOSTPD                                 *
      *  CLE033 - Settlement method 09                                *
      *  CLE031 - Lending Enhancements.                               *
      *  CSF002 - Global layer.                                       *
      *           - Replace previous ZBACT* parameters with the new   *
      *             unique code.                                      *
      *  222972 - Define R4 event for a loan with processing type 80  *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enahancements to CAS001, CAS002 and CAS004          *
      *  220514 - Past Due Interest exceeds Total Flat Interest in    *
      *           CLOANCL.                                            *
      *  219695 - When Rule of 78s is installed, interest amnt of Non-*
      *           Flat Rate Personal Loan should still be non-amenda- *
      *           ble.  If Interest Amount of a Flat Rate Personal    *
      *           loan is amendable, inputed amount must be validated *
      *           or defaulted when '*' is entered to this field.     *
      *  218531 - Early Mature not allowed for Flat Rate Loans        *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  217847 - Wrong calculation of Loan Repayment Amount when     *
      *           loan is amended on the day of insert.               *
      *           Compute for value of WTOTI as this is use in the    *
      *           computation of the Loan Repayment Amount. Also take *
      *           into consideration the payment due day indicator.   *
      *  216443 - Program loops when repayment schedule is more than  *
      *           99 times.                                           *
      *           Redefine WCTR variable to 5,0 dimension.            *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  CAS004 - Hedge Accounting Phase A                            *
      *  208221 - Changes identified during alpha site                *
      *  202101 - Amend processing introduced by 192790.  Internal    *
      *           Participation Purchased loans should be correctly   *
      *           processed with regard to validation for mulit-ccy   *
      *           allowed indicator, MCRA.  MCRA of internal parts    *
      *           purchased loans and participation sold loans must   *
      *           be equal to MCRA of original or mirror loan.        *
      *  212288 - Interest projected movements have been created      *
      *           twice for loans changed in Loan Manager.            *
      *  211871 - Allow revalidation during authorization to display  *
      *           F12 related message ESM0800.                        *
      *  211253 - Portfolio Reference wrongly updated with value from *
      *           previous loan amended.                              *
      *  206438 - During authorisation, special instructions for      *
      *           Customer Lending loans were not displayed on screen.*
      *  204024 - Do not set on bit 5 of CBLI (maturity bill to be re-*
      *           sent) when maturity date is blanked-out, to avoid a *
      *           call loan from maturing with a blank maturity date. *
      *  202917 - Initialise MCRAM for correct defaulting of multi-ccy*
      *           rollovers allowed indicator of parts sold.          *
      *  206578 - Amendment to 206443 - availability wrong on Credit  *
      *           Agreement when amending reactivated loan, as amount *
      *           was converted twice.                                *
      *  202436 - Error message LEL0515 received in Loan Manager      *
      *           because the field MCRAM was not updated from the    *
      *           the main loan.                                      *
      *  197449 - Validation not required when in batch mode.         *
      *  211587 - Do not check authorisation to action code/branch if *
      *           PTYPE = 'PTFT' and action code is not 'I', so that  *
      *           Principal Transfers can be authorised.              *
      *  211489 - If System value LoanNbrAutoAllocate = 'Y', then the *
      *           loan reference field on the detail screen shouldn't *
      *           be input-capable. Amendment to fix 208725.          *
      *  204786 - Funding rate disappeared when loan was amended via  *
      *           Customer Loan Input.                                *
      *  209887 - Confirmations not produced if Part Sold amended on  *
      *           input date. Produce confirmations when a loan is    *
      *           inserted and amended on the same day, and when loan *
      *           is authorised.
      *         - Confirmation not produced when the maturity date of *
      *           of a loan was amended. Need to initialise workfields*
      *           WCSET and WMSET.                                    *
      *  208725 - Enhance fix provided for service call 207689 such   *
      *           that users are allowed to choose their loan number  *
      *           upon pressing F9, for insert, from the subfile.     *
      *  206235 - Do not update facility exposure and availability    *
      *           if maturity date changed to be earlier than the     *
      *           next working day, and loan is not autosettled.      *
      *  206257 - Initialise effective interest rate WINTT to avoid   *
      *           a previous value being used by non-interest-bearing *
      *           risk loans. Also default the spread indicator SPIN  *
      *           to 'A' for risk loans with no interest details.     *
      *  207964 - Incorrect exposure if loan is in base currency. Do  *
      *           not change ZMD to 'M'. Amendment to CLE023.         *
      *  207595 - Availability wrong after autosettle indicator was   *
      *           changed. Amendment to fix 204347 - initialise MATAM2*
      *           if non-autosettle loan and action is not insert.    *
      *  207689 - If the system value LoanNbrAutoAllocate = 'N', the  *
      *           user can choose a new loan's number. If = 'Y', then *
      *           it should always be automatically allocated.        *
      *           If loan number ranges are not set up yet, don't use *
      *           a database error, just display a new error message. *
      *  207676 - Allow creation of a new loan through Principal      *
      *           Transfer. Do not check authorisation to action code/*
      *           branch if PTYPE = 'PTFT'.                           *
      *  203794 - PRTP cannot be entered against a facility which is  *
      *           not multi-customer                                  *
      *  206443 - Incorrect availability when maturity date amended on*
      *           a reactivated loan - must convert amount of 'MR' to *
      *           facility currency. Amended fix 205535.              *
      *  205249 - Incorrect availability when loan's maturity date    *
      *           was amended to mature earlier.                      *
      *  205535 - Availability not updated when extending the maturity*
      *           date of a re-activated loan.                        *
      *  190640 - Incorrect update of facility availability when loan *
      *           maturity date was amended.  Fixes 158055 & 127169   *
      *           were reversed so that a revolving credit facility   *
      *           will become available again on loan's maturity date.*
      *  204708 - Availability of a facility should be affected up to *
      *           and including the expiry date of the facility.      *
      *  204452 - Recompiled due to changed PF/LEFEED.                *
      *  201672 - Calculate projected interest and principal on       *
      *           maturity.                                           *
      *  204347 - Update OAM and CAMD during I/C when Auto-settle     *
      *           indicator is changed.                               *
      *  204247 - Incorrect error message displayed when amending the *
      *           Autopay at Maturity flag for a loan for which the   *
      *           pay telex has already been generated.               *
      *  204073 - Decrease F9NALN by 1 before using it as reference   *
      *           of newly created loan via principal transfer.       *
      *           Also, make database error numbers unique.           *
      *  202381 - Re-activated loans and loan amendments do not       *
      *           appear for amendment/authorisation.                 *
      *           Ensure re-activated loans are displayed RATF='Y'    *
      *  CAP068 - Recompiled for changes to FCLTYFM and FCLTYFN.      *
      *  203795 - Convert repayment amount using the correct new      *
      *           facility currency exchange rate.                    *
      *  203092 - Wrong update of CAMD of participant facility for    *
      *           Parts sold.
      *  CLE023 - Lending Facility History Improvements.              *
      *  CSC011 - 24x7 Midas Availability                             *
      *  202537 - Sfl selection validation incorrect.                 *
      *  202402 - Error LEL0423 not valid in this scenario.           *
      *  202401 - Need to save multi ccy rollover allowed indicator   *
      *           if internal parts purchased.                        *
      *  194864 - Convert principal amount to CA ccy amount if loan   *
      *           ccy is not equal to CA ccy to see if CA facility    *
      *           amount will be exceeded.                            *
      *  199985 - If loan ccy and facility ccy are both either 'EUR'  *
      *           or 'In' ccys, FCXR rate must be defaulted. Add new  *
      *           error message.                                      *
      *  CAS001 - Net Present Value (NPV) Accounting                  *
      *           Also ensure that message format in sync with file   *
      *           layout.                                             *
      *  CLE015 - Functionality moved from Syndicated Lending to      *
      *           Customer Lending                                    *
      *  195745 - Discount amount of a loan is zeroised when amended  *
      *           even if no details are changed.                     *
      *  201165 - If a loan has a different branch to the facility &  *
      *           it is sent from Loan Manager an error occurs.       *
      *  199274 - Recompiled due to amendments in LE2030DF.           *
      *  199822 - Funding fields should not appear for risk loans     *
      *           because these loans are not funded.                 *
      *  200031 - Warning message 'WARNING: Funding Spread Rate       *
      *           exceeds tolerance level.' is displayed for risk and *
      *           discount loans which do not use funding rates. The  *
      *           fix is to initialise display fields SFRSP and SFPRC.*
      *  193974 - In amend mode, don't validate changed Maturity Date *
      *           against Repay/Int Dates until 2nd screen.           *
      *  197084 - Changed the condition for field BPAURV by comparing *
      *           it to 'Y' instead of 'N'                            *
      *  161824 - Allow to mature a loan under an expired facility.   *
      *  CAP053 - Lending API enhancements - Loans Input              *
      *  193944 - CHTP not updated when PT-generated loan amended -   *
      *           may cause FooB in LE0310                            *
      *  186431 - Added processing to handle LTRIX record locks.      *
      *  191152 - Settlement currency not showing during enquiry.     *
      *           Do not overwrite ORED of loan with ORED of CA.      *
      *  178920 - Loan Amendments against the part sold loan should   *
      *           affect the original loan's part sold amount.        *
      *  181775 - Participation sold loan is set to mature on rundate,*
      *           insert of another part sold loan with value date    *
      *           equal to or greater than the next day should be     *
      *           allowed.                                            *
      *  180051 - Loan amount for Internal Part Purchased (IPP) loan  *
      *           should not be greater than the mirror loan's        *
      *           available loan amount, same thing with part sold    *
      *           loan against sale of loan.                          *
      *  190638 - Warning not issued even for amended maturity date   *
      *           even if it is earlier than last loan amendment.     *
      *  190132 - Display new error message LEL0518 if the value date *
      *           of the loan is greater than the credit agreement    *
      *           facility's Last Availability Date.                  *
      *  192790 - Unable to amend Multi-Ccy rollover field to 'Y' on  *
      *           Participation Sold loan. Fix is to amend the        *
      *           validation of multi-ccy rollover field and display  *
      *           a correct & more meaningful error message, LEL0515. *
      *  190016 - If interest frequency = 'R' (rollover), display new *
      *           message (LEL0516) if next interest payment does not *
      *           match the rollover date. Default rollover date into *
      *           interest date field if its blank & frequency is 'R'.*
      *  193890 - Decrease F9NALN (Next Available Loan Number) by 1   *
      *           before using it as the loan number for the loan     *
      *           being inserted.                                     *
      *  183896 - Guarantee loans may incur past due on set maturity  *
      *           date.  Auto pay at maturity indicator must not be   *
      *           always equal to 'Y'.                                *
      *  183572 - Do not display 'F8=Amend' if user is not authorised *
      *           to action code 'A' for the booking branch of the    *
      *           loan.                                               *
      *  194509 - Amended Transactions go to Re-auth and then complete*
      *  194715 - Remove repayment amount but wrong update on CA      *
      *  CDE002 - Revenue Analysis                                    *
      *  CLE014 - Customer Driven Lending Enhancements                *
      *  191800 - Database error lock during authorisation.           *
      *           Specify 'N' on position 53 during chaining of CLOAN *
      *           in order to read the record but not lock it.        *
      *  185035 - Update Credit Agreement even if CLE006 is off.      *
      *  CSD006 - Use long DS with SDBSRTPD.                          *
      *  190420 - SLNRF must be allocated if no window(correct 189593)*
      *  189591 - When value of negative indicator is changed to 'Y', *
      *           margin still has positive value in customer         *
      *           loans file.                                         *
      *  188583 - Default Participation loan type/subtype should be   *
      *           protected if CLE006 is switched off(completion of   *
      *           fix 171864). Recompile only.                        *
      *  189824 - Window should be shown if F10 taken on the different*
      *           screens in case of action R                         *
      *  189593 - SLNRF still blank when window is called             *
      *           (insertion of a transaction with blank LNRF)        *
      *  181084 - Dbase error when two users amend the same loan on   *
      *           detail screen 1. Unlock facility file when chain.   *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *  CRT004 - Cashier Midas TCP/IP interface.                     *
      *             Recompiled over SDBRCHPD Changes                  *
      *  185457 - Loan is drawn by customers other than the one whom  *
      *           the non-multicustomer facility is granted.          *
      *  180654 - Change indicator is not displayed for enquiry and   *  *
      *           amend modes.                                        *  *
      *  175450 - Shadow files should not be updated if Risk Loan and *
      *           there's no interest payment date.                   *
      *  175452 - Apply existing fix 174984:-                         *
      *  CIR004 - Dealing Calculation Method Change.                  *
      *         - Recompiled due to GLINTC and ZINTDY changes         *
      *  171863 - Check CLE007, not CLE006, for facility amendments.  *
      *  175451 - On line updates on PRONOS, MEMOS, OLPOS and         *
      *           RSACMTPD were done twice when inserting loan in     *
      *           batch mode.                                         *
      *  176510 - Based on Fix 133062 - Book code is used in          *
      *           Profit Centre matrix assignment                     *
      *  177012 - Booking Profit Centre not displayed on screen or    *
      *           written to CLOAN.                                   *
      *  174984 - Settlement fields are being overwritten by values   *
      *           on the facility whenever a loan is amended and the  *
      *           action taken directly from the first screen.        *
      *  CDE001 - Data Export - CCRM Limits                           *
      *  168879 - The OAM Fields should not be updated beyond the     *
      *           facility expiry date.                               *
      *  168270 - Loan number range code is an alpha field on         *
      *           SDLENOPD. Made this program consistent.             *
      *  169212 - Allow EMU multi-ccy rollover if the loan's currency *
      *           is an IN currency                                   *
      *  CPB001 - 'Private Banking' Module                            *
      *  CLE009 - LE I/C Swift Message Generation for Fees            *
      *  167146 - Wrong update of settlement branch for parts sold    *
      *           when in batch mode.                                 *
      *  165965 - Allow a disc parts sold to early mature             *
      *  162899 - Multi-ccy rollover details of parts sold should not *
      *           be defaulted if multi-ccy rollover for sale of loan *
      *           was already processed.                              *
      *  161257 - Incorrect defaulting of account officer when        *
      *           loans are entered against a syndicated facility     *
      *           where bank is the agent                             *
      *  154991 - Maturity date of Loan should not be less than       *
      *           the End dates of any Fees attached to it.           *
      *         - Rename TNLU fields held on FCLTYFN/FM as preventing *
      *           update of CLOANCL/K in Amend Mode.                  *
      *         - Increase the size of MAINRF to reflect the size of  *
      *           CLOANCL.                                            *
      *  162648 - Invalid receipt nostro message returned if creating *
      *           a new loan from a principal transfer transaction.   *
      *  134725 - Multi-ccy details of newly inserted Parts sold      *
      *           should be defaulted from that of original loan.     *
      *  159259 - Allow participations (both internal parts purchase  *
      *           and parts sold) to be inserted in batch mode with   *
      *           zero principal                                      *
      *  158264 - Must consider grace day period when validating      *
      *           next interest date and next repayment date.         *
      *  160946 - Rollover Date can be equal to Interest Accrual      *
      *           Control Date.                                       *
      *  159215 - Introduce new error msg if repay date is earlier    *
      *           than interest accrual date on Amend.                *
      *  160632 - Cannot leave rate blank or zero for risk part sold. *
      *  158863 - Error in parts sold input validation                *
      *  158055 - 127169 is not complete for the amendment of maturity*
      *           to the run date.                                    *
      *  CPL002 - Midas-Plato Interface                               *
      *           Initialise Original Interest Rate                   *
      *  159256 - Send interactive warning message if syndicated      *
      *           loan is amended via Midas.                          *
      *  160096 - Include Funding/Risk participant flag. Input        *
      *           parameter extended to match value passed by LE2010. *
      *  157756 - System should generate new payment if payment date  *
      *           is amended.                                         *
      *  154221 - Allow entry of payment due/payment taken indicators *
      *           for repayment types 1 and 3. Currently only allowed *
      *           for repayment type 2.                               *
      *  159355 - Validation error introduced when internal particip- *
      *           ant missing for an Internal Part Purchased.         *
      *  157749 - Validation of repayment date/repayment amount       *
      *           incorrect                                           *
      *  158856 - Change Risk Loan validation. For Risk Parts         *
      *           Purchased and Risk Parts Sold, do not allow 'Y'     *
      *           in the Recourse indicator. Remove warning on        *
      *           margin field if left blank for all risk loans.      *
      *  157553 - Cannot enter repay amount on loan created today by  *
      *           Principal Transfer.                                 *
      *  158582 - PC Ref Nos not being generated in interactive mode. *
      *  158143 - Warning error should be given if Margin is zero.    *
      *  157634 - Facility amount for Internal Part. Purchased should *
      *           be validated against internal customer's facility.  *
      *  157636 - Problem with part sold being created (due to input  *
      *           of an assignment on LM) after some of the original  *
      *           loan had been manually repaid.                      *
      *  158087 - Overwriting of change type in related loan (which   *
      *           has just been reversed in batch mode) causes        *
      *           imbalance in CoB program le0310.                    *
      *  158085 - Entry of interest date wrongly permitted for repay  *
      *           types other than 2                                  *
      *  158084 - "Auto-pay at maturity" validation is confused for   *
      *           risk loans                                          *
      *  158082 - Do not worry about current authorisation status of  *
      *           loan when authorising a Principal Transfer          *
      *  158059 - Interest Date not defaulting to Rollover Date
      *           on Parts. Purchased (cf. LE0052)
      *  158058 - Bogus warning message for rollover date issued
      *           on amend
     F*  158057 - STANDARD SETTLEMENT INSTRUCTIONS SHOULD USE         *
     F*           ORIGINAL CUSTOMER FOR LOOKUP NOT PURCHASED FROM     *
      *           (upgraded from LE0052)
      *  158703 - On Parts Sold allow change of pay instructions      *
      *           at maturity and protect receive instructions        *
      *           as start.                                           *
      *  158056 - When maturity date is rejected as being earlier
      *           than interest, repay or roll dates (LEL0131), those
      *           dates must be shown as part of the message,
      *           otherwise it's a pain in the neck to go to the
      *           next screen to check them.
      *           (amend also to GBLERMSGF)
      *  158054 - Every conf. has the word "AMENDMENT" (erroneously)  *
      *           ,caused by ORED's not being set up correctly on     *
      *           CLOANCK                                             *
      *  BT0699 - LEL0135 wrong when part purchased without recourse
      *           issue new msg LEL0136 if facility customer not equal
      *           to original borrower for non multi-cust. facilities
      *           also, facility customer should default to original
      *           borrower if blank
      *  158052 - Only update participant facility if Linked to Part  *
      *           Facility is set to I or P                           *
      *  158051 - Major faux pas in 158046: it creates RPCR for
      *           PC-input loans as well (not the intention)
      *  158047 - Error in 122685 causes risk part sold to be linked  *
      *           to funding participant. This causes CoB database    *
      *           error 001 in ler032.                                *
      *  158050 - FIRST 3 CHAARACTERS OF RPCR SHOULD BE OUTPUT FOR    *
      *           PC input loans                                      *
      *  158046 - All transactions input through Midas must have      *
      *           a full PC reference                                 *
      *  157535 - Availability wrong after syndicated loan reversal   *
      *  157761 - Errors encountered on a write or update should be   *
      *           handled by sr/*pssr. Some will be suppressed        *
      *           because the 'error' indicator has been specified.   *
      *           Re-code these lines.                                *
      *  157675 - Hard-coding of '0.00' is incorrect when currency    *
      *           does not have two decimal places.                   *
      *           Standard subroutine zfrped corrected for the case   *
      *           where amount is zero and currency has zero decimal  *
      *           places. Fix E44905 removed accordingly.             *
      *  147999 - Availability/Exposure update incorrectly for        *
      *           facility                                            *
      *  156497 - Cannot amend loan if principal amount is negative.  *
      *  156297 - Reverse part of fix 153787, regarding the           *
      *           validation of the last availability date.           *
      *  156136 - Principal amount should consider 'PI', 'PT', 'PF',  *
      *           'RE' and 'MR' when selling off part of the loan.    *
      *  154799 - Recompiled due to changes in /COPY,ZACCH            *
      *  154711 - New loans/parts purch./parts sold created during a  *
      *           Principal Transfer on LM cause PC references to be  *
      *           corrupted.                                          *
      *  151295 - Problems authorising repayment schedules            *
      *           Recompiled due to changes in ZCHKH                  *
      *  134804 - LEL0135 wrong when part purchased without recourse
      *           issue new msg LEL0136 if facility customer not equal
      *           to original borrower for non multi-cust. facilities
      *           also, facility customer should default to original
      *           borrower if blank
      *  155936 - Validation of Payment Taken Day is wrong.           *
      *  155773 - Can't authorise a loan due to wrong ccy shown on    *
      *           screen                                              *
      *  155721 - Not able to create a new loan from an existing part *
      *           sold to the new loan created by the principal       *
      *           transfer                                            *
      *  155674 - Confirmation indicator is not output when reversal  *
      *  155610 - Authorisation processing incorrect if CLE002 is     *
      *           off as manual ICD flags are still on.               *
      *  155102 - Repayment type invalid when authorising guaranteed  *
      *           loans, processing type 70.                          *
      *  153860 - I/C update of fclty exposure/availability wrong for *
      *           reversals.                                          *
      *  153787 - Allow input of loan when facility used has just     *
      *           been reactivated same day.                          *
      *  153786 - Fix misleading error messages if facility has       *
      *           expired, has been closed, or has been deleted.      *
      *  153663 - Automatic unlinking no longer required.             *
      *  152892 - Records written to ltrix before transaction is      *
      *           authorised.                                         *
      *  152618 - Do not calculate/validate next interest date if     *
      *           this program is called from LE2130 for a Principal  *
      *           Transfer.                                           *
      *           Cannot call ZFREQ* when interest frequency is "R"   *
      *           (rollover) - "R" means 6 days before EoM in         *
      *           the standard SUBRs                                  *
      *  152323 - Incorrect message file being defaulted              *
      *  152176 - Rounding error occured when getting reciprocal      *
      *           of exchange rate.                                   *
      *  152173 - Rollover date should be allowed on loans which are  *
      *           risk parts sold on call loans.                      *
      *  150748 - Wrong facility picked up if a reversed participant  *
      *           already exists, resulting in Database error.        *
      *  150744 - PC reference not generated for principal transfer   *
      *           for new loan.                                       *
      *  147261 - Default Assignment/Participation indicator from the *
      *           funding participant facility.                       *
      *  146834 - Introduce a warning message LEL0504 for interest    *
      *           payment date earlier than rundate.                  *
      *  146745 - Repayment amount can still be rejected in error for *
      *           risk participations sold.                           *
      *  145826 - Midas availability and exposure is wrong on         *
      *           Credit agreements.                                  *
      *  145490 - Wrldy is only set on insert, causing unlinking      *
      *           from syndicate.                                     *
      *  144089 - Addition of 'modified' payment due day indicator    *
      *           type                                                *
      *  143772 - Current Exposure/Availability problem.              *
      *  142586 - I/O error when trying to reverse a principal        *
      *           transfer.  The program tries to access a loan       *
      *           amendment record which is already lock to the       *
      *           same job.
      *  142522 - Loan record is locked after update is cancelled.    *
      *  142405 - Fix installed to ensure a SWIFT message is produced *
      *           if the interest date of a part sold is changed to   *
      *           today's date.                                       *
      *  142393 - Rollover on Risk loans not allowed                  *
      *  142388 - Repay Schedule for risk loans not allowed           *
      *  142225 - Loans authorised from PC are not being flagged for  *
      *           'confirmation required'.                            *
      *  142002 - Facility currency repayment amount is valid for     *
      *           participations sold in call or term loans.          *
      *  141453 - Recompiled due to changes in PF/LEFEED              *
      *  141200 - Exposure and availability on main facility should   *
      *           not be updated for Internal Parts Purchased.        *
      *  140825 - Cannot amend PT-generated loans                     *
      *  138350 - Amount sold is not updated properly                 *
      *  135152 - There needs to be a separate standard settlement    *
      *           instruction transaction type for Lending - use of   *
      *           'MM' is not sufficiently flexible                   *
      *  133865 - Correct the validation of Fclty Ccy Repay Amount    *
      *  132568 - Problems reversing a PP against a non agent         *
      *           syndicated facility.                                *
      *  132564 - Syndicated loans in batch mode are being unlinked   *
      *           when amended.                                       *
      *  132559 - Risk part sold are updating/validating against the  *
      *           part sold amount of the main loan.                  *
      *  132558 - Only allow enquiry option on a loan that has been   *
      *           created via PT.                                     *
      *  132162 - Allow MCRA to be 'Y' only for loan processing types *
      *           which are allowed to have rollovers                 *
      *  131253 - Accept amendment when CLE005 is *ON and RATF in     *
      *           CLOANCL is 'Y' even if RECI is 'M'.                 *
      *  144915 - Recompiled due to changes in LF/CLOAN.              *
      *  122461 - Correct the setting of 'manual/system generated'    *
      *           flag. Where the transaction is from loan manager,   *
      *           (but not the first message in the unit of work),    *
      *           set to 'S'; otherwise set to 'M'.                   *
      *  144688 - Include all types of loan that can be rolled over.  *
      *         - Applied fix 136103 and 142393.                      *
      *  CEU004 - LE Settlement Ccy Conversion Upgrade to DBA R2.0    *
      *  121768 - Recompile over changed GLINTCZ1                     *
      *  125258 - Change the validation on loan and fclty repayments. *
      *  127120 - For a parts sold the currency validation is checking*
      *           against the facility permitted ccy as well as       *
      *           against the loan ccy.                               *
      *  127124 - The wrong currency is being used to format fclty    *
      *           repayment amount.                                   *
      *  125697 - Mirror loan number sent across as zeroes, not blank *
      *  126623 - Interest calc for parts sold should default to      *
      *           value on loan or part purchased which it is         *
      *           linked to.                                          *
      *  130173 - In batch mode when LTRIX is full the program does   *
      *           not return the loan number and dumps for insert of  *
      *           part sold.                                          *
      *  128953 - Loan Processing Types should be validated           *
      *           against facility                                    *
      *  128946 - Must not use Credit Agreements for Loans and        *
      *           Parts Purchased                                     *
      *  128563 - Error on setting up KLIST                           *
      *  CLE007 - Customer Lending Enhancements - Others              *
      *  CLE005 - Customer Lending Enhancements - Tranche 3           *
      *  127169 - The OAM is not being updated correctly when the     *
      *           maturity date for a loan is amended to be within    *
      *           the next 10 working days.                           *
      *  126310 - Set up several loans for authorisation on the       *
      *           subfile but only the first works correctly.         *
      *  126274 - The subfile review screen should show the customer  *
      *           short name.                                         *
      *  126065 - Interest calculation basis should default from the  *
      *           loan sold for Parts Purchased.                      *
      *  125468 - Amend loan, error on Rollover date previously       *
      *           entered                                             *
      *  125557 - Amend loan through options 1,2,3,4 no longer        *
      *           working.                                            *
      *  125545 - Can't amend maturity date on discount loan in batch.*
      *           Linked to syndicate set to 'N' in error in batch.   *
      *           Linked to syndicate flag shouldn't be protected.    *
      *  125027 - Enter a loan earlier than 10 working days all OAM   *
      *           are updated                                         *
      *  125323 - Amend loan, get wrong warning message tha facility  *
      *           exceeded                                            *
      *  125184 - Purchased from should accept 10-char cust shortname *
      *  125029 - Return loan number for batch mode not only on insert*
      *  124812 - Can't early mature a syndicated loan in batch mode  *
      *  124727 - LEL0302 duplicate message id                        *
      *  123857 - Additional authorisation option, to use F11 or go   *
      *           through all screens and pressing ENTER on the last  *
      *           screen.  Also, remove fix 121737.                   *
      *  122685 - Incorrect update of facility availability amount    *
      *  121141 - Database error 37 for a non-agent facility          *
      *  124024 - Exposure/availability update incorrect for parts    *
      *           sold with recourse                                  *
      *  124001 - Allow the input of mirror loan number for internal  *
      *           parts purchased to hold the original loan number.   *
      *           Then update original loan's parts sold amount       *
      *           for an internal part purchased just like part sold. *
      *  123906 - Do not invalidate maturity date when it equals      *
      *           the last loan amendment date                        *
      *  123998 - Texts should be coming from message subfile         *
      *  123801 - Return exact settlement detail error in batch mode  *
      *  123859 - Interest calculation should be shown w/o rollup     *
      *  123789 - File out of balance                                 *
      *  122098 - Allow rollovers for discount PP/PSs                 *
      *  120025 - 'Multi-ccy rollovers allowed' flag and Facility     *
      *           repayment amount are now available for parts sold   *
      *  123471 - Problems reversing a loan with parts sold attached  *
      *           result in a data base error (DBASE 32 & 18)         *
      *  123295 - Allow 1-4 as action codes to go to specific screens *
      *  123227 - Principal transfer authorisation to use BPTPAU flag *
      *         - Also, settlement of psold should be opposite of loan*
      *  123021 - Set rollover status to 'A' for insert               *
      *  122960 - Use first parameter of positions update program     *
      *           to suppress rollback in batch mode.                 *
      *  122718 - Remove validation for reversal of parts sold when   *
      *           part purchased and originating loan are sent as well*
      *  122651 - SWIFT messages are not generated when run in Batch  *
      *  122650 - Remove validation for Rollover date and irregular   *
      *           rollover period.                                    *
      *  122649 - No SWIFT message is produced when a loan is         *
      *           authorised.                                         *
      *  122485 - The BIT settings are set incorrectly when amending  *
      *           a loan.                                             *
      *  122384 - The return PC message when reversing a loan is      *
      *           blank.                                              *
      *  122052 - Name of message file not set up correctly.          *
      *  121783 - Call new access object AOBRCHR1 instead of AOBRCHR0 *
      *           (uses the long data structure DSSDY)                *
      *  121970 - Set Rollover PC Trans Ref to 1st 3 characters of    *
      *           Loan Trans Ref when inserting.                      *
      *  121855 - Window program should only be called after the      *
      *           last screen.                                        *
      *  121890 - Validation on spread indicator incorrect.           *
      *  121737 - When enter is pressed during an amend update files  *
      *           and exit.                                           *
      *  121719 - No validation done for permitted currencies against *
      *           a multi-currency facility.                          *
      *  121718 - Start date of loan should not be earlier than       *
      *           committed date on facility                          *
      *  121715 - Updating LEREFD1 for facility the customer no. is   *
      *           the loan customer.                                  *
      *  121711 - Default interest payment is not picked up when it   *
      *           has been entered on the facilities screen.          *
      *  121710 - In enquiry mode cannot tell if a loan is reversed.  *
      *  121142 - Update without prior read when reversing syndicated *
      *           loan. Also dump not conditioned correctly.          *
      *  120813 - For Parts Sold, derive the value for Assignment     *
      *           flag, (A or P). Do this for insert in               *
      *           interactive mode only.                              *
      *  120842 - default linked to syndicate to 'N' for syndicated   *
      *           facility.                                           *
      *  120825 - Purchase from could be set to agent custmer number  *
      *           if agent is the bank.                               *
      *  120670 - Value date must not be later than 'Last             *
      *           Availability Date' of facility                      *
      *  120392 - Validation of internal participation purchased is   *
      *           wrong. Valid transactions are being rejected.       *
      *  120468 - Include a DUMP in SRBERR subroutine for Batch and   *
      *           Play modes.                                         *
      *  120278 - 1. In batch mode transaction should be authorised.  *
      *           2. Error flag is cleared so that errors are not     *
      *           handled correctly in le2010.                        *
      *  120121 - When running in batch mode program was looping      *
      *           during Dump mode for entry of syndicated            *
      *           Participation Purchased.                            *
      *  120002 - If processing in batch mode, then status of         *
      *           transaction should always be set to 'A'.            *
      *         - Number of items in batch on return message is       *
      *           corrupted.                                          *
      *         - program perform COMIT operation while in batch mode *
      *         - Use A8SYCU instead of A8BICN                        *
      *  119594 - SD2400 should not be called when running in         *
      *           Batch or Play mode.                                 *
      *  CLE004 - Customer Lending Enhancements - Syndications.       *
      *                                                               *
      *****************************************************************
     FLE2030DFCF  E                    WORKSTN                        UC
     F                                        SRRN  KSFILE LE2030S0
      *
     FLE2030PDUF  E                    DISK         KINFSR *PSSR A    UC
      *
     FCLOAN   UF  E           K        DISK         KINFSR *PSSR A
     F                                              KCOMIT
     F            CLOANHHF                          KIGNORE
     FCLOANCL IF  E                    DISK                               180051
     F            CLOANCLF                          KRENAMECLOANLJ        180051
     F/COPY WNCPYSRC,LE2030F003
      *
     FAPILOGL0UF  E           K        DISK                           UC  CSC011
      **  24/7 Midas Availability log file                                CSC011
     F            APILOGD0                          KRENAMEAPILOGX0       CSC011
     F*                                                                   CSC011
     FAPVLOGPDO   E                    DISK                           UC  CSC011
      **  24/7 Midas Availability log files                               CSC011
     F                                              KCOMIT                CSC011
     FAPILOGPDO   E                    DISK                           UC  CSC011
     F                                              KCOMIT                CSC011
      *                                                                   CSC011
     FLEREF   UF  E           K        DISK         KINFSR *PSSR A
     F                                              KCOMIT
      *
     F***LTRIX***UF  F      43            DISK         KINFSR *PSSR                         AR322732
     FLTRIX   O   F      45            DISK         KINFSR *PSSR A                          AR322732
     F                                              KCOMIT
     F                                              KINFDS FLDTX          186431
      *
     FFCLTY   UF  E           K        DISK         KINFSR *PSSR
     F                                              KCOMIT
     F            FCLTYHHF                          KIGNORE
     F            FCLTYZZF                          KIGNORE
      *                                                                   120813
     FLEPARTL2IF  E           K        DISK                               120813
      *
     F*LEFEEDL1***IF  E           K        DISK                           CLE009
      *                                                                   CLE009
     FLEFEEDL1UF  E           K        DISK         KINFSR *PSSR          CLE009
     F                                              KCOMIT                CLE009
      *                                                                   CLE009
     FLEFELNL0UF  E           K        DISK         KINFSR *PSSR A        CLE009
     F                                              KCOMIT                CLE009
      *
     F***LOAMS***IF  E           K        DISK                            140825
     F***LOAMS***UF  E           K        DISK                     140825 142522
     FLOAMS   IF  E           K        DISK                               142522
     F            LOAMSDHF                          KIGNORE
     F            LOAMSZ1F                          KIGNORE
      *                                                                   142522
     FLELOAML3UF  E           K        DISK         KINFSR *PSSR          142522
     F                                              KCOMIT                142522
     F            LOAMSDKF                          KRENAMELELOAM3F       142522
      *
     FLELOANL0IF  E           K        DISK
     F            CLOANCLF                          KRENAMELELOAND0
      *
     FLELOANL1IF  E           K        DISK
     F            CLOANCLF                          KRENAMELELOAND1
      *
     FPSOLDLL IF  E           K        DISK
     F            CLOANCLF                          KRENAMEPSOLDF
      *
     FPMPORTPDIF  E           K        DISK
      *
     FLEFCLTL4IF  E           K        DISK
     F            FCLTYFMF                          KRENAMELEFCLTD0
      *
     FSDBRCHL5IF  E           K        DISK
      *                                                                   CLE005
     FLEFCAML7IF  E           K        DISK                               CLE005
      *                                                                   CLE005
     FLEPARTL1IF  E           K        DISK                               CLE005
     F            LEPARTD0                          KRENAMELEPARTD1       CLE005
      *                                                                   153787
     FLEFCAML3IF  E           K        DISK                               153787
     F            LEFCAMPF                          KRENAMELEFCAMD3       153787
      *                                                                   157634
     FLEFCLTL2IF  E           K        DISK                               157634
     F            FCLTYFMF                          KRENAMELEFCLTD2       157634
      *                                                                                       190132
     FLEFCLTLDIF  E           K        DISK                                                   190132
     F            FCLTYFMF                          KRENAMELEFCLTDD                           190132
     FLEFCLTLCIF  E           K        DISK                                                   194864
     F            FCLTYFNF                          KRENAMELEFCLTDC                           194864
     F/COPY WNCPYSRC,LE2030F002
      *                                                                   154991
      **  Addition of FEES Master File                                    154991
     FLEFEEDL2IF  E           K        DISK                               154991
     F            LEFEEDF                           KRENAMELEFEED2F       154991
      *                                                                   154991
     F/COPY WNCPYSRC,LE2030F004
     FLEILONPDO   E                    DISK                           UC  CAP053
     F/COPY WNCPYSRC,LE2030F005
     F                                              KCOMIT                CAP053
     FLEILONL1IF  E           K        DISK                           UC  CAP053
     F            LEILONP0                          KRENAMELEILONP1       CAP053
     FLEILONL2IF  E           K        DISK                           UC  CAP053
     F            LEILONP0                          KRENAMELEILONP2       CAP053
     F/COPY WNCPYSRC,LE2030F006
     FLEILONLXUF  E           K        DISK                           UC  CAP053
     F            LEILONP0                          KRENAMELEILONDL       CAP053
     F                                              KCOMIT                CAP053
     F/COPY WNCPYSRC,LEH00510
     FMLOAN   IF  E           K        DISK                                                   207689
     F            CLOANHHF                          KIGNORE                                   207689
     F            CLOANZ1F                          KIGNORE                                   207689
     F            CLOANCKF                          KIGNORE                                   207689
     F            CLOANCLF                          KRENAMEMLOANCLF                           207689
      *                                                                                       207689
     FASHTRNLAIF  E           K        DISK                                                   CAS004
     FASHGLKL1IF  E           K        DISK                                                   CAS004
      *                                                                                       CSD015
     FSDCWHTL1IF  E           K        DISK                                                   CSD015
      ** Compliance Watch Hit List by Function Type/Identifier/Branch                         CSD015
      *                                                                                       CSD015
     FLEEIRDL5UF  E           K        DISK         KCOMIT                                    CAS009
     F            LEEIRDD0                          KRENAMELEEIRDD5                           CAS009
     FHISTR   IF  E           K        DISK                                                 AR740717
     FCLONCLQDO   E                    DISK         KCOMIT                                    261338
     FTGZCLPL0O   E                    DISK         KCOMIT                                  AR705865
     F            T_GZCLIPEX                        KRENAMETGZCLPD0                         AR705865
     F/COPY WNCPYSRC,LE2030F001
      /EJECT
      *****************************************************************
      *                                                               *
      *    F U N C T I O N   O F   I N D I C A T O R S                *
      *                                                               *
      *    01           BLI Lending Enhancement (S01465) is installed *
      *    01           Also used as a record not found indicator     *   178920
      *    02           Originating branch used                       *
      *    02           Invalid Settlement Allocation (re-used)       *                       CLE034
      *    03           Profit centre is not being used               *
      *    03           CLE034 indicator (re-used)                    *                       CLE034
      *    04           Profit centre non-amendable                   *
      *    05           Portfolio module is on                        *
      *    06           Multibranching process                        *
      *    07           Invalid profit centre                         *
      *    08           Invalid customer confirmation                 *
      *    09           Invalid guarantee receiver                    *
      *    10           Invalid base currency indicator               *
      *    11           Invalid base currency exchange rate           *
      *    12           Invalid facility currency indicator           *
      *    13           Invalid facility currency exchange rate       *
      *    14           Invalid A/C sequence                          *
      *    15           Invalid alternate name/address                *
      *                 Invalid mirror loan number                    *   124001
      *    16           Invalid portfolio                             *
      *    17           Invalid booking profit centre                 *
      *    18           Invalid secured                               *
      *                 F11 is not needed for authorisation           *   123857
      *    19           Invalid FRB code                              *
      *    20           Invalid book code                             *
      *    21           Processing for parts purchased input          *
      *    22           Processing for parts sold input               *
      *    23           Protect portfolio reference                   *
      *    24           Guarantees issued is active                   *
      *    25           CLE006 SAR is installed                       *
      *    26           Authorisation requests                        *
      *    27           Reversal requests                             *
      *    28           Amend requests                                *
      *    29           Invalid Assignment                            *
      *    30           Invalid action code (also for select field)   *
      *    31           Invalid loan number                           *
      *    32           Invalid requiring authorisation flag          *
      *    33           Invalid customer or original borrower/        *
      *                 Invalid review from field                     *
      *    34           Invalid facility / CLE002 is installed        *
      *                 Invalid requiring authorisation field         *
      *    35           Invalid branch                                *
      *                 CLE028 is installed                           *                       CLE028
      *    36           Invalid loan type/subtype                     *
      *                 Invalid add on interest                       *                       CLE028
      *    37           Invalid purchased from/sale of loan           *
      *                 Invalid add on charges                        *                       CLE028
      *    38           Invalid currency                              *
      *                 Invalid include charges in interest           *                       CLE028
      *    39           Invalid amount                                *
      *                 Invalid charge amount                         *                       CLE028
      *    40           Invalid deal date                             *
      *    41           Invalid auto settlement                       *
      *                 Nondisplay for YLDC when CAS001 installed     *                       CAS001
      *    42           Invalid value date                            *
      *    43           Invalid recourse indicator/                   *
      *                 Protect funding details                       *
      *    44           Invalid maturity date                         *
      *    45           Invalid auto payment at maturity/             *
      *                 CLE005 is installed                           *
      *    46           Invalid multi-currency rollover               *
      *                 Nondisplay for FYLD when CAS001 installed     *                       CAS001
      *    47           Invalid base rate/                            *
      *                 Loan is syndicated, downloaded from PC        *
      *    48           Invalid base rate change indicator            *
      *                 Display SFCCY and SFCPAM (Detail 1)           *                       CLE031
      *    49           Invalid spread rate                           *
      *                 Invalid Facility Ccy Principal Amount (SFCPAM)*                       CLE031
      *    50           Invalid spread indicator                      *
      *    51           Invalid interest payment date                 *
      *    52           Invalid interest frequency                    *
      *    53           Invalid interest day number                   *
      *    54           Invalid interest basis                        *
      *    55           Invalid interest/discount amount              *
      *    56           Invalid margin                                *
      *    57           Invalid negative                              *
      *    58           Invalid withholding tax rate                  *
      *    59           Invalid withholding tax indicator             *
      *    60           Invalid interest capitalisation               *
      *    61           Invalid round-down indicator                  *
      *    62           Invalid accrual indicator                     *
      *                 Invalid YLDC indicator when CAS001 installed  *                       CAS001
      *    63           Invalid rollover date                         *
      *    64           Invalid rollover frequency                    *
      *                 Invalid FYLD indicator when CAS001 installed  *                       CAS001
      *    65           Invalid rollover day number                   *
      *    66           Invalid default parts loan type/subtype       *
      *    67           Invalid linked to syndicate                   *
      *    68           Invalid repayment type                        *
      *    69           Invalid loan currency repayment amount        *
      *                 LOKUP number array                            *   157749
      *                 LOKUP currency array                          *   CLE009
      *    70           Invalid facility currency repayment amount    *
      *    71           Invalid repayment date                        *
      *    72           Invalid repayment frequency                   *
      *    73           Invalid repayment day number                  *
      *    74           Invalid bill/telex                            *
      *    75           Invalid billing days                          *
      *    76           Invalid payment taken day                     *
      *                 Also used as a CLE011 indicator               *   CLE011
      *    77           Invalid grace days for interest repayment     *
      *                 F11 is not needed for authorisation           *   123857
      *                 Also used as Rate Fixing Day error indicator  *   CLE011
      *    78           Invalid grace days for principal repayment    *
      *    79           Invalid payment due day                       *
      *    80           Invalid account officer                       *
      *    81           Invalid industry                              *
      *    82           Invalid fees                                  *
      *    83           Invalid originating branch                    *
      *    84           Invalid country of risk                       *
      *    85           Invalid documents                             *
      *    86           End of file in Loans file for the subfile /   *
      *                 Invalid funding spread/rate                   *
      *    87           No more changed subfile record                *
      *                 Invalid funding sign                          *
      *    88           Rollup indicator for subfile /                *
      *                 Rolldown indicator for detail screens         *
      *    89           Read/Chain indicator                          *
      *    91           Standard subroutine work indicator            *
      *    92           Subfile clear (off=subfile display)           *
      *    93           Subfile display control, not subfile display  *
      *    94           Subfile next change                           *
      *    95           Protect screen fields for enquire/reversal    *
      *                 and authorisation                             *
      *    96           Analytical accounting is installed and        *
      *                 funding details can be input                  *
      *                 or revenue analysis is installed and          *   CDE002
      *                 funding details can be input                  *   CDE002
      *    97           Program work indicator                        *
      *    98           Date format indicator is month/day/year       *
      *    99           Standard subroutine work indicator            *
      *                                                               *
      *****************************************************************
      /EJECT
     E                    CPY@    1   1 80
      ** Copyright statement
     E***********         WSTAT   1   8 15                                123998
      ***Loan*status                                                      123998
     E                    WNOST   5   5  2 0
      ** Settlements through nostros
     E                    WFREQ   7   7  1
      ** Frequency codes for interest and repayments
     E/COPY WNCPYSRC,LEH00874
     E**********          WDRPT   1  12  3                                             128953 CLE028
     E/COPY WNCPYSRC,LEH00875
     E                    WDRPT   1  13  3                                                    CLE028
      ** Drawing Types of Facility and Processing Types of Loans          128953
     E                    RUNS       10  5 0A
      ** Facility expiry dates
     E                    OAM        10 13 0
      ** Facility expiry amounts
     E**********          WBIC      150  6 0                                                  CSD027
     E**********          WBIC      150  6                                             CSD027 262328
     E                    WBIC      900  6                                                    262328
      ** Branch internal customer array
     E                    WCY         9  3                                121719
      ** Work Allowable currencies array                                  121719
      *
     E                    NUM         9  1                                157749
      ** Number array                                                     157749
     E                    AMTAB      15  1                                157749
      ** Loan currency repayment amount                                   157749
      *                                                                   157749
     E                    CYA       150  3                                CLE009
      ** Currencies array                                                 CLE009
     E                    TND       150  1 0                              CLE009
      ** Telex Notice Days array                                          CLE009
     E                    RUNC       10  5 0A                                                 194864
      ** Facility expiry dates                                                                194864
     E                    OAMC       10 13 0A                                                 194864
      ** Facility Drawn Amount                                                                194864
     E                    STAMP   1   1 26                                                    CLE034
      ** Array containing dummy timestamp                                                     CLE034
      *                                                                   CLE009
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZDATE9Z1
     E/COPY ZSRSRC,ZEDITZ1
     E/COPY ZSRSRC,ZF2CE
     E/COPY ZSRSRC,ZFREQBZ1
     E/COPY ZSRSRC,ZFRPEDZ1
     E/COPY ZSRSRC,ZHOLE
     E/COPY ZSRSRC,ZPOWERZ1
     E                    OPTAG   1  13 25                                                    CSD015
     E                    CLTAG   1  13 25                                                    CSD015
      ** Watch List Fields's Open and Close Tags                                              CSD015
     E**********          DRAW        5  1                                             128953 CLE028
     E                    DRAW        6  1                                                    CLE028
      ** Work Array for Drawing Types                                     128953
      *
     E                    ACUR       20  3                                                    CLE034
      ** Array of Currencies                                                                  CLE034
      *                                                                                       CLE034
     E                    ALOC       20  3                                                    CLE034
      ** Array of Locations                                                                   CLE034
      *                                                                                       CLE034
     E                    SVALTX  1   1 20                                                    CLE148
      *
     E/COPY WNCPYSRC,LE2030E001
      /SPACE 3
      *
     ILE2030D0
      ** Rename fields
     I              LNRF                            LNRFH
     I              FCUS                            FCUSH
     I              DDAT                            DDATH
     I              STDT                            STDTH
     I              MDAT                            MDATH
     I              CPAM                            CPAMH
     I              LASQ                            LASQH
     I              CALC                            CALCH
     I              BRTT                            BRTTH
     I              RTSP                            RTSPH
     I              RLDT                            RLDTH
     I              RLDY                            RLDYH
     I              MARG                            MARGH
     I              NIDT                            NIDTH
     I              IFDY                            IFDYH
     I              WTRT                            WTRTH
     I              REPT                            REPTH
     I              BLDY                            BLDYH
     I              FRBC                            FRBCH
     I              LIND                            LINDH
     I              BCXR                            BCXRH
     I              FCXR                            FCXRH
     I              RECE                            RECEH
     I              COCU                            COCUH
     I              OLNO                            OLNOH
     I              OSDB                            OSDBH
     I              OMDB                            OMDBH
     I              RSTM                            RSTMH
     I              RONS                            RONSH
     I              RIBN                            RIBNH
     I              RIBA                            RIBAH
     I              ROBN                            ROBNH
     I              ROCN                            ROCNH
     I              PSTM                            PSTMH
     I              PONS                            PONSH
     I              PIBN                            PIBNH
     I              PIBA                            PIBAH
     I              POBN                            POBNH
     I              POCN                            POCNH
     I              RCRN                            RCRNH
     I              RCRA                            RCRAH
     I              RVNO                            RVNOH
     I              AWBN                            AWBNH
     I              AWBA                            AWBAH
     I              BENN                            BENNH
     I              BENA                            BENAH
     I              DTP1                            DTP1H
     I              DTP2                            DTP2H
     I              DTP3                            DTP3H
     I              DTP4                            DTP4H
     I              DCHG                            DCHGH
     I              BTB1                            BTB1H
     I              BTB2                            BTB2H
     I              BTB3                            BTB3H
     I              BTB4                            BTB4H
     I              BTB5                            BTB5H
     I              BTB6                            BTB6H
     I              CVMR                            CVMRH
     I              FCRA                            FCRAH
     I              GDPR                            GDPRH
     I              GDIN                            GDINH
     I              MLNR                            MLNRH                 124001
     I              SCCY                            SCCYH                 CEU004
     I              ICCY                            ICCYH                 CEU004
     I              FPAM                            FPAMH                                     CLE031
     I              REXR                            REXRH                                     CLE031
     I              REXI                            REXIH                                     CLE031
     I              PSCY                            PSCYH                                     CLE031
     I              PEXR                            PEXRH                                     CLE031
     I              PEXI                            PEXIH                                     CLE031
     I              STAL                            STALH                                     CLE034
     I              BASR                            BASRH                                     CLE036
     I              LOIC                            LOICH                                     CER020
      *
     ICLOANCKF
      ** Rename fields
     I              NLRA                            NLRAK
     I              ORED                            OREDK
     I              TMST                            CKTMST                                    CPK017
      *
     ICLOANCLF
      ** Rename fields
     I              PCOB                            PCOBL
     I              PCRF                            PCRFL
     I              TMST                            CLTMST                                    CPK017
     I              CLAS                            CLCLAS                                  BUG11642
     I/COPY WNCPYSRC,LE2030I007
      *                                                                   180051
     ICLOANLJ                                                             180051
      *                                                                   180051
      ** Rename fields of CLOANLJ                                         180051
      *                                                                   180051
     I              RECI                            RECIX                 180051
     I              LNRF                            LNRFX                 180051
     I              RCDT                            RCDTX                 180051
     I              MRIN                            MRINX                 180051
     I              PTYP                            PTYPX                 180051
     I              CNUM                            CNUMX                 180051
     I              BRCA                            BRCAX                 180051
     I              LTYP                            LTYPX                 180051
     I              SUTP                            SUTPX                 180051
     I              DDAT                            DDATX                 180051
     I              VDAT                            VDATX                 180051
     I              MDAT                            MDATX                 180051
     I              LASQ                            LASQX                 180051
     I              FCUS                            FCUSX                 180051
     I              FTYP                            FTYPX                 180051
     I              FSEQ                            FSEQX                 180051
     I              CCY                             CCYX                  180051
     I              CPAM                            CPAMX                 180051
     I              INTC                            INTCX                 180051
     I              INTR                            INTRX                 180051
     I              BRTT                            BRTTX                 180051
     I              BRTE                            BRTEX                 180051
     I              RTSP                            RTSPX                 180051
     I              MARG                            MARGX                 180051
     I              SPIN                            SPINX                 180051
     I              CHIN                            CHINX                 180051
     I              WTRT                            WTRTX                 180051
     I              WTIN                            WTINX                 180051
     I              REPT                            REPTX                 180051
     I              RAMT                            RAMTX                 180051
     I              NRPD                            NRPDX                 180051
     I              RFRQ                            RFRQX                 180051
     I              RDYN                            RDYNX                 180051
     I              FCCY                            FCCYX                 180051
     I              LIND                            LINDX                 180051
     I              CRSK                            CRSKX                 180051
     I              ACOF                            ACOFX                 180051
     I              NACD                            NACDX                 180051
     I              RELI                            RELIX                 180051
     I              AUTO                            AUTOX                 180051
     I              PSAM                            PSAMX                 180051
     I              BCXR                            BCXRX                 180051
     I              FCXR                            FCXRX                 180051
     I              SDST                            SDSTX                 180051
     I              OSDA                            OSDAX                 180051
     I              TSTN                            TSTNX                 180051
     I              MDST                            MDSTX                 180051
     I              OMDA                            OMDAX                 180051
     I              TMAN                            TMANX                 180051
     I              FACO                            FACOX                 180051
     I              RLDT                            RLDTX                 180051
     I              NROD                            NRODX                 180051
     I              RLFQ                            RLFQX                 180051
     I              RLDY                            RLDYX                 180051
     I              RDFC                            RDFCX                 180051
     I              NBRA                            NBRAX                 180051
     I              NRTS                            NRTSX                 180051
     I              NSIN                            NSINX                 180051
     I              NCAS                            NCASX                 180051
     I              AWTP                            AWTPX                 180051
     I              WTRD                            WTRDX                 180051
     I              WTWD                            WTWDX                 180051
     I              IWOD                            IWODX                 180051
     I              PWOD                            PWODX                 180051
     I              BMDI                            BMDIX                 180051
     I              FMDI                            FMDIX                 180051
     I              PDIN                            PDINX                 180051
     I              LSWC                            LSWCX                 180051
     I              LSWS                            LSWSX                 180051
     I              OSDB                            OSDBX                 180051
     I              OMDB                            OMDBX                 180051
     I              ORBR                            ORBRX                 180051
     I              PRFC                            PRFCX                 180051
     I              FCLB                            FCLBX                 180051
     I              MLNR                            MLNRX                 180051
     I              BTIN                            BTINX                 180051
     I              BLDY                            BLDYX                 180051
     I              OLNO                            OLNOX                 180051
     I              RCSI                            RCSIX                 180051
     I              ICBS                            ICBSX                 180051
     I              IPFR                            IPFRX                 180051
     I              TOTI                            TOTIX                 180051
     I              NIDT                            NIDTX                 180051
     I              IBDT                            IBDTX                 180051
     I              SLID                            SLIDX                 180051
     I              AIPD                            AIPDX                 180051
     I              DLRC                            DLRCX                 180051
     I              IACD                            IACDX                 180051
     I              AITC                            AITCX                 180051
     I              TFEP                            TFEPX                 180051
     I              AIAP                            AIAPX                 180051
     I              IPRD                            IPRDX                 180051
     I              IPRM                            IPRMX                 180051
     I              ICTD                            ICTDX                 180051
     I              AIMN                            AIMNX                 180051
     I              RBDT                            RBDTX                 180051
     I              NOPS                            NOPSX                 180051
     I              NCHI                            NCHIX                 180051
     I              ZZ001A                          ZZ01AX                180051
     I              IFDY                            IFDYX                 180051
     I              LONI                            LONIX                 180051
     I              CNFI                            CNFIX                 180051
     I              ACEI                            ACEIX                 180051
     I              TLXI                            TLXIX                 180051
     I              CBLI                            CBLIX                 180051
     I              ORED                            OREDX                 180051
     I              LCD                             LCDX                  180051
     I              CHTP                            CHTPX                 180051
     I              TNLU                            TNLUX                 180051
     I              ADDI                            ADDIX                 180051
     I              ORMD                            ORMDX                 180051
     I              ORTI                            ORTIX                 180051
     I              ZZ023A                          ZZ23AX                180051
     I              BOKC                            BOKCX                 180051
     I              COCU                            COCUX                 180051
     I              RECE                            RECEX                 180051
     I              OMDT                            OMDTX                 180051
     I              NIPD                            NIPDX                 180051
     I              NMDT                            NMDTX                 180051
     I              APMI                            APMIX                 180051
     I              RSTM                            RSTMX                 180051
     I              RONS                            RONSX                 180051
     I              RIBN                            RIBNX                 180051
     I              RIBA                            RIBAX                 180051
     I              ROBN                            ROBNX                 180051
     I              ROCN                            ROCNX                 180051
     I              PSTM                            PSTMX                 180051
     I              PONS                            PONSX                 180051
     I              PIBN                            PIBNX                 180051
     I              PIBA                            PIBAX                 180051
     I              POBN                            POBNX                 180051
     I              POCN                            POCNX                 180051
     I              RCRN                            RCRNX                 180051
     I              RCRA                            RCRAX                 180051
     I              RVNO                            RVNOX                 180051
     I              AWBN                            AWBNX                 180051
     I              AWBA                            AWBAX                 180051
     I              BENN                            BENNX                 180051
     I              BENA                            BENAX                 180051
     I              DTP1                            DTP1X                 180051
     I              DTP2                            DTP2X                 180051
     I              DTP3                            DTP3X                 180051
     I              DTP4                            DTP4X                 180051
     I              DCHG                            DCHGX                 180051
     I              BTB1                            BTB1X                 180051
     I              BTB2                            BTB2X                 180051
     I              BTB3                            BTB3X                 180051
     I              BTB4                            BTB4X                 180051
     I              BTB5                            BTB5X                 180051
     I              BTB6                            BTB6X                 180051
     I              CVMR                            CVMRX                 180051
     I              PTFR                            PTFRX                 180051
     I              HLEX                            HLEXX                 180051
     I              FSRP                            FSRPX                 180051
     I              FSGN                            FSGNX                 180051
     I              FPRC                            FPRCX                 180051
     I              TCOF                            TCOFX                 180051
     I              ACPD                            ACPDX                 180051
     I              ACDA                            ACDAX                 180051
     I              ACAJ                            ACAJX                 180051
     I              ACAP                            ACAPX                 180051
     I              COFD                            COFDX                 180051
     I              COFM                            COFMX                 180051
     I              CFCD                            CFCDX                 180051
     I              NFRS                            NFRSX                 180051
     I              NFSN                            NFSNX                 180051
     I              NFPC                            NFPCX                 180051
     I              PDCF                            PDCFX                 180051
     I              FCTD                            FCTDX                 180051
     I              FWOD                            FWODX                 180051
     I              DFTP                            DFTPX                 180051
     I              DFST                            DFSTX                 180051
     I              MCRA                            MCRAX                 180051
     I              FCRA                            FCRAX                 180051
     I              PDDI                            PDDIX                 180051
     I              PTDI                            PTDIX                 180051
     I              GDPR                            GDPRX                 180051
     I              GDIN                            GDINX                 180051
     I              LNKS                            LNKSX                 180051
     I              MNSG                            MNSGX                 180051
     I              GASS                            GASSX                 180051
     I              GPRT                            GPRTX                 180051
     I              TOLN                            TOLNX                 180051
     I              LSTS                            LSTSX                 180051
     I              IUSR                            IUSRX                 180051
     I              AUSR                            AUSRX                 180051
     I              XUSR                            XUSRX                 180051
     I              RATF                            RATFX                 180051
     I              CNCF                            CNCFX                 180051
     I              PCRF                            PCRFX                 180051
     I              LPFI                            LPFIX                 180051
     I              PTFC                            PTFCX                 180051
     I              PTFT                            PTFTX                 180051
     I              PTFN                            PTFNX                 180051
     I              PCOB                            PCOBX                 180051
     I              LRLD                            LRLDX                 180051
     I              LMCD                            LMCDX                 180051
     I              OIDT                            OIDTX                 180051
     I              TMST                            CJTMST                                    CPK017
     I              LOIC                            LOICX                                     CER020
      *
     I*LTRIX**** NS       1 CH                                                              AR322732
      ***Transaction*index*header**************************************                     AR322732
     I**********                              1   1 RECID                                   AR322732
     I**********                              2   2 RCDTD                                   AR322732
     I**********                              3   80LNRFD                                   AR322732
     I**********                          P   9  110NORED                                   AR322732
     I**********                          P  12  140FLSZD                                   AR322732
     I**********                          P  15  170RRLCD                                   AR322732
     I**********                          P  18  200RRNAD                                   AR322732
     I**********                          P  21  230RRLXD                                   AR322732
     I**********                          P  24  260RRXPD                                   AR322732
     I**********                          P  27  290NLNRD                                   AR322732
     I**********                          P  30  320NLARD                                   AR322732
     I**********                             33  330STPID                                   AR322732
     I**********                          P  38  400TNLUD                                   AR322732
      *
     I********NS       1 CD                                                                 AR322732
      ***Transaction*index*detail**************************************                     AR322732
     I**********                              1   1 RECID                                   AR322732
     I**********                              2   2 RCDTD                                   AR322732
     I**********                              3   80LNRFD                                   AR322732
     I**********                              9  130VDATD                                   AR322732
     I**********                             14  160LASND                                   AR322732
     I**********                             17  17 CHTPD                                   AR322732
     I**********                             18  18 CNRQD                                   AR322732
     I**********                             19  19 CNPRD                                   AR322732
     I**********                             20  20 REPRD                                   AR322732
     I**********                             21  250RRLAD                                   AR322732
     I**********                             26  26 LADID                                   AR322732
     I**********                             27  270PRI1D                                   AR322732
     I**********                             32  34 BRCAD                                   AR322732
     I**********                          P  35  370RRNTD                                   AR322732
     I**********                          P  38  400TNLUD                                   AR322732
     I**********                             41  410PRI2D                                   AR322732
     I**********                             42  420PRI3D                                   AR322732
     I**********                             43  430PRI4D                                   AR322732
      *
     I********NS                                                                            AR322732
      ***Catch*all*****************************************************                     AR322732
     I**********                              1   1 RECID                                   AR322732
      *
     ILOAMSDKF
      ** Rename fields
     I              RECI                            RECIA
     I              LNRF                            LNRFA
     I              VDAT                            VDATA
     I              LASN                            LASNA
     I              AMTP                            AMTPA
     I              BRCA                            BRCAA
     I              CNUM                            CNUMA
     I              LSMD                            LSMDA                                   AR722666
     I/COPY WNCPYSRC,LEH00511
     I              ORED                            OREDA
     I              TNLU                            TNLUA
     I              GPRT                            GPRTA
     I              CHTP                            CHTPA                                     193944
     I/COPY WNCPYSRC,LEH00884
     I              AUTO                            AUTOA                                     205535
     I              SPI1                            SPI1A                                     206438
     I              SPI2                            SPI2A                                     206438
     I              SPI3                            SPI3A                                     206438
     I              TMST                            LKTMST                                    CPK017
     I              RONS                            LKRONS                                    238907
     I              PONS                            LKPONS                                    238907
      *                                                                   142522
     ILELOAM3F                                                            142522
      ** Rename fields                                                    142522
     I              RECI                            RECIA                 142522
     I              LNRF                            LNRFA                 142522
     I              VDAT                            VDATA                 142522
     I              LASN                            LASNA                 142522
     I              PRAM                            PRAMA                 157553
     I              AMTP                            AMTPA                 142522
     I              BRCA                            BRCAA                 142522
     I              CNUM                            CNUMA                 142522
     I              ORED                            OREDA                 142522
     I              TNLU                            TNLUA                 142522
     I              GPRT                            GPRTA                 142522
     I              NRLI                            NRLIA                 157553
     I              CHTP                            CHTPA                                     193944
     I              SPI1                            SPI1A                                     206438
     I              SPI2                            SPI2A                                     206438
     I              SPI3                            SPI3A                                     206438
     I/COPY WNCPYSRC,LEH00512
     I              TMST                            L3TMST                                    CPK017
     I              RONS                            L3RONS                                    238907
     I              PONS                            L3PONS                                    238907
      *
     ILELOAND0
      ** Rename fields for subfile use
     I              LNRF                            LNRFL
     I              PTYP                            PTYPL
     I              CNUM                            CNUML
     I              BRCA                            BRCAL
     I              VDAT                            VDATL
     I              MDAT                            MDATL
     I              CCY                             CCYL
     I              CPAM                            CPAML
     I              NOPS                            NOPSL
     I              LSTS                            LSTSL
     I              IUSR                            IUSRL
     I              AUSR                            AUSRL
     I              ORBR                            ORBRL                 CAP053
     I              RATF                            RATFL                                     202381
     I              TNLU                            TNLUL                 CLE033
     I              TMST                            L0TMST                                    CPK017
      *                                                                   CLE033
     IMLOANCLF                                                            CLE033
      ** Rename fields for subfile use                                    CLE033
     I              LNRF                            LNRFZ                 CLE033
     I              TMST                            TMSTZ                                     CLE042
      *
     ILELOAND1
      ** Rename fields for subfile use
     I              LNRF                            LNRFL
     I              PTYP                            PTYPL
     I              CNUM                            CNUML
     I              BRCA                            BRCAL
     I              VDAT                            VDATL
     I              MDAT                            MDATL
     I              CCY                             CCYL
     I              CPAM                            CPAML
     I              NOPS                            NOPSL
     I              LSTS                            LSTSL
     I              IUSR                            IUSRL
     I              AUSR                            AUSRL
     I              ORBR                            ORBRL                 CAP053
     I              RATF                            RATFL                                     202381
     I              TNLU                            TNLUL                 CLE033
     I              TMST                            L1TMST                                    CPK017
      *
     IFCLTYFMF
      ** Rename fields
     I              RECI                            RECIF
     I              CNUM                            CNUMF
     I              BRCA                            BRCAF
     I              FCCY                            FCCYF
     I              DTAP                            DTAPF
     I              DTEX                            DTEXF
     I              COMD                            COMDF                 121718
     I              CDTE                            CDTEF                 153787
     I              MCCY                            MCCYF
     I              MCSI                            MCSIF
     I              CRSK                            CRSKF
     I              NAR1                            NAR1F
     I              NAR2                            NAR2F
     I              NAR3                            NAR3F
     I              NAR4                            NAR4F
     I              ACOF                            ACOFF
     I              ORBR                            ORBRF
     I              ORED                            OREDF
     I              TNLU                            TNLUF                 154991
     I              SYIN                            SYINF
     I              XUSR                            XUSRF
     I              RCSI                            RCSIF                 124024
     I              OSDB                            OSDBF                 174984
     I              OMDB                            OMDBF                 174984
     I              RSTM                            RSTMF                 174984
     I              RONS                            RONSF                 174984
     I              RIBN                            RIBNF                 174984
     I              RIBA                            RIBAF                 174984
     I              ROBN                            ROBNF                 174984
     I              ROCN                            ROCNF                 174984
     I              PSTM                            PSTMF                 174984
     I              PONS                            PONSF                 174984
     I              PIBN                            PIBNF                 174984
     I              PIBA                            PIBAF                 174984
     I              POBN                            POBNF                 174984
     I              POCN                            POCNF                 174984
     I              RCRN                            RCRNF                 174984
     I              RCRA                            RCRAF                 174984
     I              RVNO                            RVNOF                 174984
     I              AWBN                            AWBNF                 174984
     I              AWBA                            AWBAF                 174984
     I              BENN                            BENNF                 174984
     I              BENA                            BENAF                 174984
     I              DTP1                            DTP1F                 174984
     I              DTP2                            DTP2F                 174984
     I              DTP3                            DTP3F                 174984
     I              DTP4                            DTP4F                 174984
     I              DCHG                            DCHGF                 174984
     I              BTB1                            BTB1F                 174984
     I              BTB2                            BTB2F                 174984
     I              BTB3                            BTB3F                 174984
     I              BTB4                            BTB4F                 174984
     I              BTB5                            BTB5F                 174984
     I              BTB6                            BTB6F                 174984
     I              CVMR                            CVMRF                 174984
     I              PCOB                            PCOBF                 174984
     I              SCCY                            SCCYF                 CEU004
     I              ICCY                            ICCYF                 CEU004
     I              REXR                            REXRF                                     CLE031
     I              REXI                            REXIF                                     CLE031
     I              PSCY                            PSCYF                                     CLE031
     I              PEXR                            PEXRF                                     CLE031
     I              PEXI                            PEXIF                                     CLE031
     I              OVAM                            OVAMF                                     CLE034
      *
     IFCLTYFNF
      ** Rename fields
     I              RECI                            RECIF
     I              CNUM                            CNUMF
     I              CALC                            CALCF
     I              ORED                            OREDF
     I              TNLU                            TNLUF                 154991
      *
     IPSOLDF
     I** Rename fields
     I              RECI                            PRECI
     I              OLNO                            POLNO
     I              MDAT                            PMDTE
     I              PTYP                            PPTYP
     I              LNKS                            PSLNKS                                    243770
      *
     ILEFCLTD0
      ** Rename fields
     I              RECI                            RECIF
     I              CNUM                            CNUMF
     I              BRCA                            BRCAF
     I              FCCY                            FCCYF
     I              DTAP                            DTAPF
     I              DTEX                            DTEXF
     I              CDTE                            CDTEF                 153787
     I              MCCY                            MCCYF
     I              MCSI                            MCSIF
     I              CRSK                            CRSKF
     I              NAR1                            NAR1F
     I              NAR2                            NAR2F
     I              NAR3                            NAR3F
     I              NAR4                            NAR4F
     I              ACOF                            ACOFF
     I              ORBR                            ORBRF
     I              ORED                            OREDF
     I              TNLU                            TNLUF                 154991
     I              SYIN                            SYINF
     I              XUSR                            XUSRF
     I              RCSI                            RCSIF                 124024
     I              COMD                            COMDF                 121718
     I              SCCY                            SCCYF                 CEU004
     I              ICCY                            ICCYF                 CEU004
     ILEFCLTD2                                                            154991
      ** Rename fields                                                    154991
     I              TNLU                            TNLUF                 154991
      *                                                                   CLE005
     ILEFCLTDD                                                                                190132
      *                                                                                       190132
      ** Rename fields                                                                        190132
      *                                                                                       190132
     I              CNUM                            CNUMB                                     190132
     I              FACT                            FACTB                                     190132
     I              FCNO                            FCNOB                                     190132
     I              FCCY                            FCCYB                                     194864
     I              TRCA                            TRCAB                                     190132
     I              AVLD                            AVLDB                                     190132
     I              FAMT                            FAMTB                                     190132
      *                                                                                       190132
     ILEFCLTDC                                                                                194864
      ** Rename fields                                                                        194864
     I              CNUM                            CNUMC                                     194864
     I              FACT                            FACTC                                     194864
     I              FCNO                            FCNOC                                     194864
     I              RUN0                            RUN0C                                     194864
     I              RUN1                            RUN1C                                     194864
     I              RUN2                            RUN2C                                     194864
     I              RUN3                            RUN3C                                     194864
     I              RUN4                            RUN4C                                     194864
     I              RUN5                            RUN5C                                     194864
     I              RUN6                            RUN6C                                     194864
     I              RUN7                            RUN7C                                     194864
     I              RUN8                            RUN8C                                     194864
     I              RUN9                            RUN9C                                     194864
     I              OAM1                            OAM1C                                     194864
     I              OAM2                            OAM2C                                     194864
     I              OAM3                            OAM3C                                     194864
     I              OAM4                            OAM4C                                     194864
     I              OAM5                            OAM5C                                     194864
     I              OAM6                            OAM6C                                     194864
     I              OAM7                            OAM7C                                     194864
     I              OAM8                            OAM8C                                     194864
     I              OAM9                            OAM9C                                     194864
     I              OA10                            OA10C                                     194864
      *                                                                                       194864
     ILEFCAMPF                                                            CLE005
      ** Rename fields                                                    CLE005
     I              RECI                            RECIC                 CLE005
     I              BRCA                            BRCAC                 CLE005
     I              CNUM                            CNUMC                 CLE005
     I              FACT                            FACTC                 CLE005
     I              FCNO                            FCNOC                 CLE005
     I              RVCR                            RVCRC                 CLE005
     I              ASTS                            ASTSC                 CLE005
     I              IUSR                            IUSRC                 CLE005
     I              AUSR                            AUSRC                 CLE005
     I              XUSR                            XUSRC                 CLE005
     I              CHTP                            CHTPC                 CLE005
     I              ORED                            OREDC                                     191152
      *                                                                   153787
     ILEFCAMD3                                                            153787
      ** Rename fields                                                    153787
     I              RECI                            RECIC                 153787
     I              BRCA                            BRCAC                 153787
     I              CNUM                            CNUMC                 153787
     I              FACT                            FACTC                 153787
     I              FCNO                            FCNOC                 153787
     I              RVCR                            RVCRC                 153787
     I              ASTS                            ASTSC                 153787
     I              IUSR                            IUSRC                 153787
     I              AUSR                            AUSRC                 153787
     I              XUSR                            XUSRC                 153787
     I              CHTP                            CHTPC                 153787
     I              ORED                            OREDC                                     191152
      *
     ILEILONP2                                                            CAP053
      ** Rename fields                                                    CAP053
     I              SLNRF                           ISLNRF                CAP053
     I              SCUST                           ISCUST                CAP053
     I              SFCUS                           ISFCUS                CAP053
     I              SFTYP                           ISFTYP                CAP053
     I              SFSEQ                           ISFSEQ                CAP053
     I              SBRCA                           ISBRCA                CAP053
     I              SLTYP                           ISLTYP                CAP053
     I              SSUTP                           ISSUTP                CAP053
     I              SOLNO                           ISOLNO                CAP053
     I              SPFRM                           ISPFRM                CAP053
     I              SMLNR                           ISMLNR                CAP053
     I              SCURR                           ISCURR                CAP053
     I              SCPAM                           ISCPAM                CAP053
     I              SDDAT                           ISDDAT                CAP053
     I              SAUTO                           ISAUTO                CAP053
     I              SVDAT                           ISVDAT                CAP053
     I              SRCSI                           ISRCSI                CAP053
     I              SMDAT                           ISMDAT                CAP053
     I              SAPMI                           ISAPMI                CAP053
     I              SMCRA                           ISMCRA                CAP053
     I              SRLDT                           ISRLDT                CAP053
     I              SRLFQ                           ISRLFQ                CAP053
     I              SRLDY                           ISRLDY                CAP053
     I              SDFTP                           ISDFTP                CAP053
     I              SDFST                           ISDFST                CAP053
     I              SLNKS                           ISLNKS                CAP053
     I              SPTFC                           ISPTFC                CAP053
     I              SPTFN                           ISPTFN                CAP053
     I              SPTFT                           ISPTFT                CAP053
     I              SASSN                           ISASSN                CAP053
     I              SBRTT                           ISBRTT                CAP053
     I              SCHIN                           ISCHIN                CAP053
     I              SRTSP                           ISRTSP                CAP053
     I              SSPIN                           ISSPIN                CAP053
     I              SNIDT                           ISNIDT                CAP053
     I              SIPFR                           ISIPFR                CAP053
     I              SIFDY                           ISIFDY                CAP053
     I              SCALC                           ISCALC                CAP053
     I              SIPRD                           ISIPRD                CAP053
     I              SMARG                           ISMARG                CAP053
     I              SNEGV                           ISNEGV                CAP053
     I              SWTRT                           ISWTRT                CAP053
     I              SWTIN                           ISWTIN                CAP053
     I              SINTC                           ISINTC                CAP053
     I              SRDFC                           ISRDFC                CAP053
     I              SADDI                           ISADDI                CAP053
     I              SREPT                           ISREPT                CAP053
     I              SRAMT                           ISRAMT                CAP053
     I              SFCRA                           ISFCRA                CAP053
     I              SNRPD                           ISNRPD                CAP053
     I              SRFRQ                           ISRFRQ                CAP053
     I              SRDYN                           ISRDYN                CAP053
     I              SBTIN                           ISBTIN                CAP053
     I              SBLDY                           ISBLDY                CAP053
     I              SPDDI                           ISPDDI                CAP053
     I              SGDIN                           ISGDIN                CAP053
     I              SGDPR                           ISGDPR                CAP053
     I              SPTDI                           ISPTDI                CAP053
     I              SACOF                           ISACOF                CAP053
     I              SLIND                           ISLIND                CAP053
     I              SFEEI                           ISFEEI                CAP053
     I              SORBR                           ISORBR                CAP053
     I              SCRSK                           ISCRSK                CAP053
     I              SDOCI                           ISDOCI                CAP053
     I              SBOKC                           ISBOKC                CAP053
     I              SFRBC                           ISFRBC                CAP053
     I              SSECI                           ISSECI                CAP053
     I              SACSQ                           ISACSQ                CAP053
     I              SPTFR                           ISPTFR                CAP053
     I              SNACD                           ISNACD                CAP053
     I              SPRFC                           ISPRFC                CAP053
     I              SNAR1                           ISNAR1                CAP053
     I              SBCXR                           ISBCXR                CAP053
     I              SBMIN                           ISBMIN                CAP053
     I              SNAR2                           ISNAR2                CAP053
     I              SNAR3                           ISNAR3                CAP053
     I              SFCXR                           ISFCXR                CAP053
     I              SFMIN                           ISFMIN                CAP053
     I              SNAR4                           ISNAR4                CAP053
     I              SRECE                           ISRECE                CAP053
     I              SCOCU                           ISCOCU                CAP053
     I              SFRSP                           ISFRSP                CAP053
     I              SOMDT                           ISOMDT                CAP053
     I              SFSGN                           ISFSGN                CAP053
     I              SFPRC                           ISFPRC                CAP053
     I              SSPI1                           ISSPI1                CAP053
     I              SSPI2                           ISSPI2                CAP053
     I              SSPI3                           ISSPI3                CAP053
     I              SADIF                           ISADIF                                    CLE028
     I              SADCF                           ISADCF                                    CLE028
     I              SCHGA                           ISCHGA                                    CLE028
     I              SICIF                           ISICIF                                    CLE028
     I              SFSCCY                          ISSCCY                                    CLE031
     I              SFREXR                          ISREXR                                    CLE031
     I              SFREXI                          ISREXI                                    CLE031
     I              SFPSCY                          ISPSCY                                    CLE031
     I              SFPEXR                          ISPEXR                                    CLE031
     I              SFPEXI                          ISPEXI                                    CLE031
     I              SFSTAL                          ISSTAL                                    CLE034
     I              SFBASR                          ISBASR                                    CLE036
     IHISTSHMF                                                                              AR740717
     I              RECI                            HRECI                                   AR740717
     I              RCDT                            HRCDT                                   AR740717
     I              BRCA                            HBRCA                                   AR740717
     I              CNUM                            HCNUM                                   AR740717
     I              LNRF                            HLNRF                                   AR740717
     I              VDAT                            HVDAT                                   AR740717
     I              PRSQ                            HPRSQ                                   AR740717
     I              LASN                            HLASN                                   AR740717
     I              FCUS                            HFCUS                                   AR740717
     I              FTYP                            HFTYP                                   AR740717
     I              FSEQ                            HFSEQ                                   AR740717
     I              PTYP                            HPTYP                                   AR740717
     I              CCY                             HCCY                                    AR740717
     I              AMTP                            HAMTP                                   AR740717
     I              PRAM                            HPRAM                                   AR740717
     I              BRTT                            HBRTT                                   AR740717
     I              BRTE                            HBRTE                                   AR740717
     I              RTSP                            HRTSP                                   AR740717
     I              SPIN                            HSPIN                                   AR740717
     I              CALC                            HCALC                                   AR740717
     I              WTIN                            HWTIN                                   AR740717
     I              REPT                            HREPT                                   AR740717
     I              INTC                            HINTC                                   AR740717
     I              LTYP                            HLTYP                                   AR740717
     I              SUTP                            HSUTP                                   AR740717
     I              TOTI                            HTOTI                                   AR740717
     I              FCLB                            HFCLB                                   AR740717
     I              ZZ011                           HZZ011                                  AR740717
     I              LCD                             HLCD                                    AR740717
     I              ZZ001                           HZZ001                                  AR740717
     I              FSRP                            HFSRP                                   AR740717
     I              FSGN                            HFSGN                                   AR740717
     I              TCOF                            HTCOF                                   AR740717
     I              FPRC                            HFPRC                                   AR740717
     I              CPAM                            HPPAM                                   AR740717
     I              AITC                            HAITC                                   AR740717
     I              INTR                            HINTR                                   AR740717
     I              AIAP                            HAIAP                                   AR740717
     I              IPRD                            HIPRD                                   AR740717
     I              ACDA                            HACDA                                   AR740717
     I              COFR                            HCOFR                                   AR740717
     I              ACAP                            HACAP                                   AR740717
     I              COFD                            HCOFD                                   AR740717
     I              AITN                            HAITN                                   AR740717
     I              AIAN                            HAIAN                                   AR740717
     I              IPRN                            HIPRN                                   AR740717
     I              FSPRAM                          HFSPRA                                  AR740717
     I              FSCPAM                          HFSCPA                                  AR740717
     I              CLAS                            HCLAS                                   AR740717
      *                                                                                     AR740717
     IHISTSHPF                                                                              AR740717
     I              RECI                            HRECI                                   AR740717
     I              RCDT                            HRCDT                                   AR740717
     I              BRCA                            HBRCA                                   AR740717
     I              CNUM                            HCNUM                                   AR740717
     I              LNRF                            HLNRF                                   AR740717
     I              VDAT                            HVDAT                                   AR740717
     I              PRSQ                            HPRSQ                                   AR740717
     I              LASN                            HLASN                                   AR740717
     I              FCUS                            HFCUS                                   AR740717
     I              FTYP                            HFTYP                                   AR740717
     I              FSEQ                            HFSEQ                                   AR740717
     I              PTYP                            HPTYP                                   AR740717
     I              CCY                             HCCY                                    AR740717
     I              AMTP                            HAMTP                                   AR740717
     I              PRAM                            HPRAM                                   AR740717
     I              INTA                            HINTA                                   AR740717
     I              WTXA                            HWTXA                                   AR740717
     I              FEAM                            HFEAM                                   AR740717
     I              FECD                            HFECD                                   AR740717
     I              WOIN                            HWOIN                                   AR740717
     I              EXVD                            HEXVD                                   AR740717
     I              LTYP                            HLTYP                                   AR740717
     I              SUTP                            HSUTP                                   AR740717
     I              ZZ013                           HZZ013                                  AR740717
     I              LCD                             HLCD                                    AR740717
     I              ZZ001                           HZZ001                                  AR740717
     I              COFA                            HCOFA                                   AR740717
     I              CPAM                            HPPAM                                   AR740717
     I              AITC                            HAITC                                   AR740717
     I              INTR                            HINTR                                   AR740717
     I              AIAP                            HAIAP                                   AR740717
     I              IPRD                            HIPRD                                   AR740717
     I              MNSG                            HMNSG                                   AR740717
     I              GASS                            HGASS                                   AR740717
     I              GPRT                            HGPRT                                   AR740717
     I              ROLN                            HROLN                                   AR740717
     I              ACDA                            HACDA                                   AR740717
     I              COFR                            HCOFR                                   AR740717
     I              ACAP                            HACAP                                   AR740717
     I              COFD                            HCOFD                                   AR740717
     I              REPI                            HREPI                                   AR740717
     I              CHDU                            HCHDU                                   AR740717
     I              AITN                            HAITN                                   AR740717
     I              AIAN                            HAIAN                                   AR740717
     I              IPRN                            HIPRN                                   AR740717
     I              INTN                            HINTN                                   AR740717
     I              FSPRAM                          HFSPRA                                  AR740717
     I              FSCPAM                          HFSCPA                                  AR740717
     I              CLAS                            HCLAS                                   AR740717
     IHISTSHQF                                                                              AR740717
     I              RECI                            HRECI                                   AR740717
     I              RCDT                            HRCDT                                   AR740717
     I              BRCA                            HBRCA                                   AR740717
     I              CNUM                            HCNUM                                   AR740717
     I              LNRF                            HLNRF                                   AR740717
     I              VDAT                            HVDAT                                   AR740717
     I              PRSQ                            HPRSQ                                   AR740717
     I              LASN                            HLASN                                   AR740717
     I              FCUS                            HFCUS                                   AR740717
     I              FTYP                            HFTYP                                   AR740717
     I              FSEQ                            HFSEQ                                   AR740717
     I              PTYP                            HPTYP                                   AR740717
     I              CCY                             HCCY                                    AR740717
     I              AMTP                            HAMTP                                   AR740717
     I              BRTT                            HBRTT                                   AR740717
     I              BRTE                            HBRTE                                   AR740717
     I              RTSP                            HRTSP                                   AR740717
     I              SPIN                            HSPIN                                   AR740717
     I              CALC                            HCALC                                   AR740717
     I              STAI                            HSTAI                                   AR740717
     I              PRINRO                          HPRINR                                  AR740717
     I              DISCRO                          HDISCR                                  AR740717
     I              ZZ020                           HZZ020                                  AR740717
     I              LCD                             HLCD                                    AR740717
     I              ZZ001                           HZZ001                                  AR740717
     I              FSRP                            HFSRP                                   AR740717
     I              FSGN                            HFSGN                                   AR740717
     I              IRCF                            HIRCF                                   AR740717
     I              FRCF                            HFRCF                                   AR740717
     I              FPRC                            HFPRC                                   AR740717
     I              CPAM                            HPPAM                                   AR740717
     I              AITC                            HAITC                                   AR740717
     I              INTR                            HINTR                                   AR740717
     I              AIAP                            HAIAP                                   AR740717
     I              IPRD                            HIPRD                                   AR740717
     I              MNSG                            HMNSG                                   AR740717
     I              RLCY                            HRLCY                                   AR740717
     I              ACDA                            HACDA                                   AR740717
     I              COFR                            HCOFR                                   AR740717
     I              ACAP                            HACAP                                   AR740717
     I              COFD                            HCOFD                                   AR740717
     I              AITN                            HAITN                                   AR740717
     I              AIAN                            HAIAN                                   AR740717
     I              IPRN                            HIPRN                                   AR740717
     I              FSCPAM                          HFSCPA                                  AR740717
     IFLDTX       DS                                                      186431
      ** Data Structure for LTRIX                                         186431
      *                                                                   186431
     I                                     *STATUS  TXSTS                 186431
      *                                                                   186431
     IA@CPY       DS
      * Copyright array
     I                                        1  80 CPY@
      *
     ILDA         DS                            256
      ** Local data area for database error details
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I                                      184 256 DBTXT
      *                                                                                       207689
      * OLNO field - alpha and numeric                                                        CSD027
     I            DS                                                                          CSD027
     I                                        1   6 OLNOA                                     CSD027
     I**********                              1   60OLNON                              CSD027 CLE148
     I                                        1   6 OLNON                                     CLE148
      *
      * Datastructure to hold input parameter for AOSVALR0.                                   207689
     I            DS                                                                          207689
     I                                        1  20 WPARM                                     207689
     I                                        1   5 WPARM1                                    207689
     I                                        6  10 WPARM2                                    207689
     I                                       11  15 WPARM3                                    207689
     I                                       16  20 WPARM4                                    207689
      *
     IPSDS       SDS
      ** Program Status Data Structure - gives Job/Workstation name and
      ** User ID
     I                                     *PROGRAM ##PGM
     I                                      244 253 WSID
     I                                      254 263 USER
     I/COPY WNCPYSRC,LE2030I002
      *
     IZMUSER      DS                             17
      ** Data area of menu user
     I                                       11  13 DBRN
      *
     I***********PINPP       DS                           1289            CEU004
     I***********PINPP       DS                           1295      CEU004160096
     I*PINPP****   DS                           1297               160096 CLE011
     I***PINPP**     DS                           1299                                 CLE011 CAS001
     I/COPY WNCPYSRC,LE2030I008
     IPINPP     E DSLEN1MFPD                                                                  CAS001
     I              QQPONS                          Q2PONS                                    CGL029
     I              QQRONS                          Q2RONS                                    CGL029
     I/COPY WNCPYSRC,LE2030I009
      ** Transmitted message format
     I                                        1   4 PMTYP
     I                                        5  20 PTUSR
     I                                       21  36 PTWID
     I                                       37  51 PTREF
     I                                       52  55 PTSEQ
     I                                       52  550W#SEQ                 122718
     I                                       56  56 PTACT
     I                                       57  64 PTDAT
     I                                       57  58 PTDT1
     I                                       59  60 PTDT2
     I                                       61  64 PTDT3
     I                                       65  72 PTTIM
     I***********                            73  75 PNPAR                 120002
     I***********                            76  80 PFILL                 120002
     I                                       73  76 PNPAR                 120002
     I***************************************77  80 PFILL          120002 CAP053
     I                                       77  77 PRPLC                 CAP053
     I                                       78  80 PFILL                 CAP053
     I                                       80  80 PPTIN                 152892
     I                                       81  86 PLNRF
     I                                       87  92 PCNMR
     I                                       93  95 PBRCH
     I                                       96  98 PORBR
     I                                       99 100 PLTYP
     I                                      101 102 PSUTP
     I                                      103 110 PDDAT
     I                                      103 104 PDDT1
     I                                      105 106 PDDT2
     I                                      111 118 PSTDT
     I                                      111 112 PSDT1
     I                                      113 114 PSDT2
     I                                      119 126 PMDAT
     I                                      119 120 PMDT1
     I                                      121 122 PMDT2
     I                                      127 132 PFCUS
     I                                      133 135 PFACT
     I                                      136 137 PFCNO
     I                                      138 140 PCCY
     I                                      141 154 PCPAM
     I                                      155 155 PAUTO
     I                                      156 156 PAPMI
     I                                      157 158 PBOKC
     I                                      159 162 PPTFR
     I                                      163 166 PPRFC
     I                                      167 168 PLASQ
     I                                      169 169 PINTC
     I                                      170 170 PADDI
     I                                      171 171 PCALC
     I                                      172 173 PBRTT
     I                                      174 185 PRTSP
     I                                      186 186 PSPIN
     I                                      187 187 PCHIN
     I                                      188 195 PMARG
     I                                      196 196 PNEGV
     I                                      197 197 PRCFC
     I                                      198 198 PWTIN
     I                                      199 210 PWTRT
     I                                      211 211 PINFQ
     I                                      212 213 PINDY
     I                                      214 221 PINDT
     I                                      214 215 PIDT1
     I                                      216 217 PIDT2
     I                                      222 222 PREPT
     I                                      223 236 PRPAM
     I                                      237 237 PRPFQ
     I                                      238 239 PRPDY
     I                                      240 247 PRPDT
     I                                      240 241 PPDT1
     I                                      242 243 PPDT2
     I                                      248 250 PLIND
     I                                      251 255 PFRBC
     I                                      256 257 PCRSK
     I                                      258 259 PACOF
     I                                      260 260 PNACD
     I                                      261 261 PFEEI
     I                                      262 262 PDOCI
     I                                      263 263 PSECI
     I                                      264 298 PNAR1
     I                                      299 333 PNAR2
     I                                      334 368 PNAR3
     I                                      369 403 PNAR4
     I                                      404 404 PBMIN
     I                                      405 418 PBCXR
     I                                      419 419 PFMIN
     I                                      420 433 PFCXR
     I                                      434 439 PRECE
     I                                      440 445 PCOCU
     I                                      446 453 PORMD
     I                                      454 454 PRLFQ
     I                                      455 456 PRLDY
     I                                      457 464 PRLDT
     I                                      457 458 PRDT1
     I                                      459 460 PRDT2
     I                                      465 465 PBTIN
     I                                      466 467 PBLDY
     I                                      468 468 PRCSI
     I                                      469 474 PORGB
     I                                      475 480 PORLN
     I                                      481 492 PFRSP
     I                                      493 493 PFSGN
     I                                      494 497 PFPRC
     I                                      498 527 PSPI1
     I                                      528 557 PSPI2
     I                                      558 587 PSPI3
     I                                      588 589 PPSTM
     I**********                            590 592 POSDB                                    BUG8832
     I**********                            590 604 PPONS                                     CAS011
     I**********                            605 612 PRVNO                                     CAS011
     I**********                            613 613 PCVMR                                     CAS011
     I**********                            614 619 PPOCN                                     CAS011
     I**********                            620 625 PPOBN                                     CAS011
     I**********                            626 633 PRCRN                                     CAS011
     I**********                            634 668 PRCRA                                     CAS011
     I**********                            669 676 PPIBN                                     CAS011
     I**********                            677 711 PPIBA                                     CAS011
     I**********                            712 719 PAWBN                                     CAS011
     I**********                            720 754 PAWBA                                     CAS011
     I**********                            755 762 PBENN                                     CAS011
     I**********                            763 797 PBENA                                     CAS011
     I**********                            798 799 PRSTM                                     CAS011
     I**********                            800 802 POMDB                                     CAS011
     I**********                            800 814 PRONS                                     CAS011
     I**********                            815 820 PROCN                                     CAS011
     I**********                            821 826 PROBN                                     CAS011
     I**********                            827 834 PRIBN                                     CAS011
     I**********                            835 869 PRIBA                                     CAS011
     I**********                            870 904 PDTP1                                     CAS011
     I**********                            905 939 PDTP2                                     CAS011
     I**********                            940 974 PDTP3                                     CAS011
     I**********                            9751009 PDTP4                                     CAS011
     I**********                           10101012 PDCHG                                     CAS011
     I**********                           10131047 PBTB1                                     CAS011
     I**********                           10481082 PBTB2                                     CAS011
     I**********                           10831117 PBTB3                                     CAS011
     I**********                           11181152 PBTB4                                     CAS011
     I**********                           11531187 PBTB5                                     CAS011
     I**********                           11881222 PBTB6                                     CAS011
     I**********                           12231223 PLNKS                                     CAS011
     I**********                           12241224 PGASS                                     CAS011
     I**********                           12251226 PDFTP                                     CAS011
     I**********                           12271228 PDFST                                     CAS011
     I**********                           12291229 PMCRA                                     CAS011
     I**********                           12301243 PFCRA                                     CAS011
     I**********                           12441244 PPDDI                                     CAS011
     I**********                           12451245 PPTDI                                     CAS011
     I**********                           12461247 PGDPR                                     CAS011
     I**********                           12481249 PGDIN                                     CAS011
     I**********                           12501250 PGNTF                                     CAS011
     I**********                           12511256 PTOLN                                     CAS011
     I**********                           12571266 PIUSR                                     CAS011
     I**********                           12671276 PAUSR                                     CAS011
     I**********                           12771286 PXUSR                                     CAS011
     I**********                           12871289 PPCOB                                     CAS011
     I**********                           12901292 PSCCY                              CEU004 CAS011
     I**********                           12931295 PICCY                              CEU004 CAS011
     I**********                           12961296 PRISK                              160096 CAS011
     I**********                           12971297 PCPSI                              160096 CAS011
     I**********                           12981299 PRFDY                              CLE011 CAS011
     I**********                           13001304 PYLDC                              CAS001 CAS011
     I**********                           13051309 PFYLD                              CAS001 CAS011
     I**********                           13101310 PADIF                              CLE028 CAS011
     I**********                           13111311 PADCF                              CLE028 CAS011
     I**********                           13121325 PCHGA                              CLE028 CAS011
     I**********                           13261326 PICIF                              CLE028 CAS011
     I**********                            590 610 PPONS                             CAS011 BUG9850
     I**********                            611 618 PRVNO                             CAS011 BUG9850
     I**********                            619 619 PCVMR                             CAS011 BUG9850
     I**********                            620 625 PPOCN                             CAS011 BUG9850
     I**********                            626 631 PPOBN                             CAS011 BUG9850
     I**********                            632 639 PRCRN                             CAS011 BUG9850
     I**********                            640 674 PRCRA                             CAS011 BUG9850
     I**********                            675 682 PPIBN                             CAS011 BUG9850
     I**********                            683 717 PPIBA                             CAS011 BUG9850
     I**********                            718 725 PAWBN                             CAS011 BUG9850
     I**********                            726 760 PAWBA                             CAS011 BUG9850
     I**********                            761 768 PBENN                             CAS011 BUG9850
     I**********                            769 803 PBENA                             CAS011 BUG9850
     I**********                            804 805 PRSTM                             CAS011 BUG9850
     I**********                            806 808 POMDB                             CAS011 BUG9850
     I**********                            806 826 PRONS                             CAS011 BUG9850
     I**********                            827 832 PROCN                             CAS011 BUG9850
     I**********                            833 838 PROBN                             CAS011 BUG9850
     I**********                            839 846 PRIBN                             CAS011 BUG9850
     I**********                            847 881 PRIBA                             CAS011 BUG9850
     I**********                            882 916 PDTP1                             CAS011 BUG9850
     I**********                            917 951 PDTP2                             CAS011 BUG9850
     I**********                            952 986 PDTP3                             CAS011 BUG9850
     I**********                            9871021 PDTP4                             CAS011 BUG9850
     I**********                           10221024 PDCHG                             CAS011 BUG9850
     I**********                           10251059 PBTB1                             CAS011 BUG9850
     I**********                           10601094 PBTB2                             CAS011 BUG9850
     I**********                           10951129 PBTB3                             CAS011 BUG9850
     I**********                           11301164 PBTB4                             CAS011 BUG9850
     I**********                           11651199 PBTB5                             CAS011 BUG9850
     I**********                           12001234 PBTB6                             CAS011 BUG9850
     I**********                           12351235 PLNKS                             CAS011 BUG9850
     I**********                           12361236 PGASS                             CAS011 BUG9850
     I**********                           12371238 PDFTP                             CAS011 BUG9850
     I**********                           12391240 PDFST                             CAS011 BUG9850
     I**********                           12411241 PMCRA                             CAS011 BUG9850
     I**********                           12421255 PFCRA                             CAS011 BUG9850
     I**********                           12561256 PPDDI                             CAS011 BUG9850
     I**********                           12571257 PPTDI                             CAS011 BUG9850
     I**********                           12581259 PGDPR                             CAS011 BUG9850
     I**********                           12601261 PGDIN                             CAS011 BUG9850
     I**********                           12621262 PGNTF                             CAS011 BUG9850
     I**********                           12631268 PTOLN                             CAS011 BUG9850
     I**********                           12691278 PIUSR                             CAS011 BUG9850
     I**********                           12791288 PAUSR                             CAS011 BUG9850
     I**********                           12891298 PXUSR                             CAS011 BUG9850
     I**********                           12991301 PPCOB                             CAS011 BUG9850
     I**********                           13021304 PSCCY                             CAS011 BUG9850
     I**********                           13051307 PICCY                             CAS011 BUG9850
     I**********                           13081308 PRISK                             CAS011 BUG9850
     I**********                           13091309 PCPSI                             CAS011 BUG9850
     I**********                           13101311 PRFDY                             CAS011 BUG9850
     I**********                           13121316 PYLDC                             CAS011 BUG9850
     I**********                           13171321 PFYLD                             CAS011 BUG9850
     I**********                           13221322 PADIF                             CAS011 BUG9850
     I**********                           13231323 PADCF                             CAS011 BUG9850
     I**********                           13241337 PCHGA                             CAS011 BUG9850
     I**********                           13381338 PICIF                             CAS011 BUG9850
     I                                      590 604 QPONS                                    BUG9850
     I                                      605 612 PRVNO                                    BUG9850
     I                                      613 613 PCVMR                                    BUG9850
     I                                      614 619 PPOCN                                    BUG9850
     I                                      620 625 PPOBN                                    BUG9850
     I                                      626 633 PRCRN                                    BUG9850
     I                                      634 668 PRCRA                                    BUG9850
     I                                      669 676 PPIBN                                    BUG9850
     I                                      677 711 PPIBA                                    BUG9850
     I                                      712 719 PAWBN                                    BUG9850
     I                                      720 754 PAWBA                                    BUG9850
     I                                      755 762 PBENN                                    BUG9850
     I                                      763 797 PBENA                                    BUG9850
     I                                      798 799 PRSTM                                    BUG9850
     I**********                            800 802 POMDB                            BUG9850 BUG8832
     I                                      800 814 QRONS                                    BUG9850
     I                                      815 820 PROCN                                    BUG9850
     I                                      821 826 PROBN                                    BUG9850
     I                                      827 834 PRIBN                                    BUG9850
     I                                      835 869 PRIBA                                    BUG9850
     I                                      870 904 PDTP1                                    BUG9850
     I                                      905 939 PDTP2                                    BUG9850
     I                                      940 974 PDTP3                                    BUG9850
     I                                      9751009 PDTP4                                    BUG9850
     I                                     10101012 PDCHG                                    BUG9850
     I                                     10131047 PBTB1                                    BUG9850
     I                                     10481082 PBTB2                                    BUG9850
     I                                     10831117 PBTB3                                    BUG9850
     I                                     11181152 PBTB4                                    BUG9850
     I                                     11531187 PBTB5                                    BUG9850
     I                                     11881222 PBTB6                                    BUG9850
     I                                     12231223 PLNKS                                    BUG9850
     I                                     12241224 PGASS                                    BUG9850
     I                                     12251226 PDFTP                                    BUG9850
     I                                     12271228 PDFST                                    BUG9850
     I                                     12291229 PMCRA                                    BUG9850
     I                                     12301243 PFCRA                                    BUG9850
     I                                     12441244 PPDDI                                    BUG9850
     I                                     12451245 PPTDI                                    BUG9850
     I                                     12461247 PGDPR                                    BUG9850
     I                                     12481249 PGDIN                                    BUG9850
     I                                     12501250 PGNTF                                    BUG9850
     I                                     12511256 PTOLN                                    BUG9850
     I                                     12571266 PIUSR                                    BUG9850
     I                                     12671276 PAUSR                                    BUG9850
     I                                     12771286 PXUSR                                    BUG9850
     I                                     12871289 PPCOB                                    BUG9850
     I                                     12901292 PSCCY                                    BUG9850
     I                                     12931295 PICCY                                    BUG9850
     I                                     12961296 PRISK                                    BUG9850
     I                                     12971297 PCPSI                                    BUG9850
     I                                     12981299 PRFDY                                    BUG9850
     I                                     13001304 PYLDC                                    BUG9850
     I                                     13051309 PFYLD                                    BUG9850
     I                                     13101310 PADIF                                    BUG9850
     I                                     13111311 PADCF                                    BUG9850
     I                                     13121325 PCHGA                                    BUG9850
     I                                     13261326 PICIF                                    BUG9850
     I                                     13271340 PFPAM                                    BUG9850
     I                                     13411354 PREXR                                    BUG9850
     I                                     13551355 PREXI                                    BUG9850
     I                                     13561358 PPSCY                                    BUG9850
     I                                     13591372 PPEXR                                    BUG9850
     I                                     13731373 PPEXI                                    BUG9850
     I                                     13741374 PSTAL                                    BUG9850
     I                                     13751377 POSDB                                    BUG8832
     I                                     13751395 PPONS                                    BUG9850
     I                                     13961398 POMDB                                    BUG8832
     I                                     13961416 PRONS                                    BUG9850
     I                                     14171428 PBASR                                     CER020
     I                                     14291429 PPPTF                                     CER020
     I                                     14301432 PLOIC                                     CER020
      *
     I/COPY WNCPYSRC,LE2030I003
     IPOUTP       DS                            172
     I/COPY WNCPYSRC,LE2030I004
      ** Returned message format
     I                                        1   4 PRMTP
     I                                        5  20 PRTUS
     I                                       21  36 PRTWS
     I                                       37  51 PRTRF
     I                                       52  55 PRTSQ
     I                                       56  56 PRTAC
     I                                       57  64 PRTDT
     I                                       65  72 PRTTM
     I*************                          73  75 PRPAR                 120002
     I*************                          76  80 PRFIL                 120002
     I                                       73  76 PRPAR                 120002
     I                                       77  80 PRFIL                 120002
     I                                       81  81 PRMSV
     I                                       82  88 PRMID
     I                                       89 166 PRMTX
     I                                      167 172 PRLON
     I/COPY WNCPYSRC,LE2030I005
      *
     I            DS
     I**********                              1  12 WOURS                                     CAS011
     I                                        1  18 WOURS                                     CAS011
     I                                        1   6 SSIX
     I**********                              7  10 SACD                                      CAS011
     I**********                             11  12 SASQ                                      CAS011
     I                                        7  16 SACD                                      CAS011
     I                                       17  18 SASQ                                      CAS011
     I                                        1   2 WSNOS
     I                                        1  10 ANMKEY
      *
     II@PARM      DS                            256
      ** Input parameters on call to AOPLCSR1
     I                                        1   1 I#PORS
     I                                        2   5 I#R997
     I                                        6  15 I#CUST
     I                                       16  18 I#BRCA
     I                                       19  20 I#BOOK
     I                                       21  24 I#PTFR
     I                                       25  34 I#CPGM
      *
     IO@PARM      DS                            256
      ** Output parameters on call to AOPLCSR1
     I                                        1   2 O#BOOK
     I                                        3   6 O#PTFR
     I                                        7  12 O#BICN
     I                                       13  22 O#CRNM
     I                                       23  24 O#ACOF
      *
     ISETLIB    E DSSETLIAB
     I              QQPONS                          Q1PONS                                    CGL029
     I              QQRONS                          Q1RONS                                    CGL029
      ** data structure for passing a parameter to synon screen
      ** handling program.
      *
     ISETLIZ    E DSSETLIAZ
      ** data structure for passing a parameter to synon screen
      ** handling program.
     I@PARM3    E DSSDSETLPD                                                                  222373
      *
     IZ#BSTS    E DSZ#BST
      ** before image of update to LE position files
      *
     IZ#ASTS    E DSZ#AST
      ** after image of update to LE position files
      *
     IZ#WSTS    E DSZ#WST
      ** work file of update to LE position files
      *
     IZ#BSTK      DS                           2048                                           220754
     IZ#ASTK      DS                           2048                                           220754
     ICLONQD    E DSLESTMP2PD                                                               AR820267
      ** Externally desc'd DS for screen Loans extension                                    AR820267
      *                                                                                     AR820267
     ICURREF    E DSCLOANCL
      ** holds the current loan record
     I              LCD                             LCDL
     I              TMST                            DSTMST                                    CPK017
     ICURRFK    E DSCLOANCK                                                                   220754
     I              RECI                            KRECI                                     220754
     I              LNRF                            KLNRF                                     220754
     I              RCDT                            KRCDT                                     220754
     I              MRIN                            KMRIN                                     220754
     I              ORED                            KORED                                     220754
     I              LCD                             KLCD                                      220754
     I              CHTP                            KCHTP                                     220754
     I              TNLU                            KTNLU                                     220754
     I              NLRA                            NLRAK                                     220754
     I              FRNT                            KFRNT                                     CPK018
     I              AFRT                            KAFRT                                     CPK018
     I              REPA                            KREPA                                     CPK018
     I              TMST                            KTMST                                     CPK018
      *
     I***********MAINRF      DS                           1278
     I*MAINRF******DS                           1290                      154991
     I*MAINRF***   DS                           1299               154991 CLE011
     I*MAINRF******DS                           1310                       CLE011             CLE028
     I*MAINRF      DS                           1375                                   CLE028 CLE031
     I*MAINRF******DS                           1560                                   CLE031 238657
     IMAINRF      DS                           1632                                           238657
     IMAINRK      DS                           1180                                           220754
      ** holds the main loan record (for parts purchased/sold)
      *
     I            DS
      ** Separate date values
     I                                        1   6 WDATE
     I                                        1   2 WDAT1
     I                                        3   4 WDAT2
     I                                        5   6 WDAT3
      *
     I            DS
      ** Separate time values
     I                                        1   60WTIME
     I                                        1   2 WTIM1
     I                                        3   4 WTIM2
     I                                        5   6 WTIM3
      *
     I            DS
      ** Format amount returned by standard subroutine
     I                                        1  22 ZOUT22
     I                                        1  21 ZOUT21
     I                                        1  20 ZOUT20
     I                                       21  21 ZNEG
      *
     I            DS
      ** Date format for test harness file
     I                                        1   8 WTDAT
     I                                        1   2 WTDT1
     I I            '/'                       3   3 WFIL1
     I                                        4   5 WTDT2
     I I            '/'                       6   6 WFIL2
     I                                        7   8 WTDT3
      *
     I            DS
      ** Time format for test harness file
     I                                        1   8 WTTIM
     I                                        1   2 WTTM1
     I I            ':'                       3   3 WFIL3
     I                                        4   5 WTTM2
     I I            ':'                       6   6 WFIL4
     I                                        7   8 WTTM3
     I/COPY WNCPYSRC,LE2030I006
      *                                                                   CSC011
      ** ISO format timestamp for 24/7 log                                CSC011
      ** Used as Key in APILOGL0                                          CSC011
     I            DS                                                      CSC011
     I                                        1  26 TSTISO                CSC011
     I                                        1   4 TSTYY                 CSC011
     I I            '-'                       5   5 TSTF1                 CSC011
     I                                        6   7 TSTMM                 CSC011
     I I            '-'                       8   8 TSTF2                 CSC011
     I                                        9  10 TSTDD                 CSC011
     I I            '-'                      11  11 TSTF3                 CSC011
     I                                       12  19 TSTTM                 CSC011
     I                                       12  13 TSTTM1                CSC011
     I I            '.'                      14  14 TSTF4                 CSC011
     I                                       15  16 TSTTM2                CSC011
     I I            '.'                      17  17 TSTF5                 CSC011
     I                                       18  19 TSTTM3                CSC011
     I I            '.'                      20  20 TSTF6                 CSC011
     I                                       21  26 TSTTM4                CSC011
      *                                                                   CSC011
     I            DS                                                      CSC011
      ** Data Structure to separate time for correct timestamp            CSC011
      **                                                                  CSC011
     I                                        1   8 WTSTM                 CSC011
     I                                        1   2 WTSHR                 CSC011
     I                                        3   4 WTSMN                 CSC011
     I                                        5   6 WTSSC                 CSC011
      *
     I            DS
      ** Data structure of rundates
     I                                    P   1   30RUN0
     I                                    P   4   60RUN1
     I                                    P   7   90RUN2
     I                                    P  10  120RUN3
     I                                    P  13  150RUN4
     I                                    P  16  180RUN5
     I                                    P  19  210RUN6
     I                                    P  22  240RUN7
     I                                    P  25  270RUN8
     I                                    P  28  300RUN9
     I                                    P   1  30 RUNS
      *
     I            DS
      ** Data structure of drawn amounts
     I                                    P   1   70OAM1
     I                                    P   8  140OAM2
     I                                    P  15  210OAM3
     I                                    P  22  280OAM4
     I                                    P  29  350OAM5
     I                                    P  36  420OAM6
     I                                    P  43  490OAM7
     I                                    P  50  560OAM8
     I                                    P  57  630OAM9
     I                                    P  64  700OA10
     I                                    P   1  70 OAM
      *
     I            DS                                                                          194864
      ** Data structure of rundates                                                           194864
     I                                    P   1   30RUN0C                                     194864
     I                                    P   4   60RUN1C                                     194864
     I                                    P   7   90RUN2C                                     194864
     I                                    P  10  120RUN3C                                     194864
     I                                    P  13  150RUN4C                                     194864
     I                                    P  16  180RUN5C                                     194864
     I                                    P  19  210RUN6C                                     194864
     I                                    P  22  240RUN7C                                     194864
     I                                    P  25  270RUN8C                                     194864
     I                                    P  28  300RUN9C                                     194864
     I                                    P   1  30 RUNC                                      194864
      *                                                                                       194864
     I            DS                                                                          194864
      ** Data structure of drawn amounts                                                      194864
     I                                    P   1   70OAM1C                                     194864
     I                                    P   8  140OAM2C                                     194864
     I                                    P  15  210OAM3C                                     194864
     I                                    P  22  280OAM4C                                     194864
     I                                    P  29  350OAM5C                                     194864
     I                                    P  36  420OAM6C                                     194864
     I                                    P  43  490OAM7C                                     194864
     I                                    P  50  560OAM8C                                     194864
     I                                    P  57  630OAM9C                                     194864
     I                                    P  64  700OA10C                                     194864
     I                                    P   1  70 OAMC                                      194864
      *                                                                                       194864
     I            DS
      ** Data structure of key list used in chaining to FCLTY
     I                                        1  12 FCTREC
     I**********                              1   60WFCNUM                                    CSD027
     I                                        1   6 WFCNUM                                    CSD027
     I                                        7   90WFFACT
     I                                       10  110WFFCNO
     I                                       12  12 WFRCTP
      *
     I            DS
      ** Data structure of key list used in chaining to LEREF
     I                                        1  17 LERFKY
     I**********                              1   60WCNUM                                     CSD027
     I                                        1   6 WCNUM                                     CSD027
     I                                        7   90WFACT
     I                                       10  110WFCNO
     I                                       12  17 SLNRF
      *
     I            DS
      ** Fields used in setting confirmation indicators (old record)
     I                                        1   50OMDAT
     I                                        6  100ONIDT
     I                                       11  150ONRPD
     I                                       16  170OIFDY
     I                                       18  18 OIPFR
     I                                       19  200ORDYN
     I                                       21  21 ORFRQ
     I                                       22  340ORAMT
     I                                       35  360OSDST
     I                                       37  38 STNOSX
     I**********                             37  48 OOSDA                                    BUG8832
     I**********                             49  58 OTSTN                                    BUG8832
     I**********                             59  68 OFACO                                    BUG8832
     I**********                             69  98 OSPI1                                    BUG8832
     I**********                             99 128 OSPI2                                    BUG8832
     I**********                            129 158 OSPI3                                    BUG8832
     I**********                             69 158 OSPI                                     BUG8832
     I                                       37  54 OOSDA                                    BUG8832
     I                                       55  64 OTSTN                                    BUG8832
     I                                       65  74 OFACO                                    BUG8832
     I                                       75 104 OSPI1                                    BUG8832
     I                                      105 134 OSPI2                                    BUG8832
     I                                      135 164 OSPI3                                    BUG8832
     I                                       75 164 OSPI                                     BUG8832
     I**********                            159 1600OMDST                                    BUG8832
     I**********                            161 162 MTNOSX                                   BUG8832
     I**********                            161 172 OOMDA                                    BUG8832
     I**********                            173 182 OTMAN                                    BUG8832
     I**********                            159 182 MATYX                                    BUG8832
     I**********                            183 1937OINTR                                    BUG8832
     I**********                            194 1980ORLDT                                    BUG8832
     I**********                            199 199 ORLFQ                                    BUG8832
     I**********                            200 2010ORLDY                                    BUG8832
     I                                      165 1660OMDST                                    BUG8832
     I                                      167 168 MTNOSX                                   BUG8832
     I                                      167 184 OOMDA                                    BUG8832
     I                                      185 194 OTMAN                                    BUG8832
     I                                      165 194 MATYX                                    BUG8832
     I                                      195 2057OINTR                                    BUG8832
     I                                      206 2100ORLDT                                    BUG8832
     I                                      211 211 ORLFQ                                    BUG8832
     I                                      212 2130ORLDY                                    BUG8832
     I                                        1  34 CONF1
     I                                        6  34 LINK1
     I**********                             35 158 CONF2                                    BUG8832
     I**********                            183 201 LINK2                                    BUG8832
     I                                       35 164 CONF2                                    BUG8832
     I                                      195 213 LINK2                                    BUG8832
      *
     I            DS
      ** Fields used in setting confirmation indicators (new record)
     I                                        1   50WSVMD
     I                                        6  100WSVID
     I                                       11  150WSVRP
     I                                       16  170WIFDY
     I                                       18  18 SIPFR
     I                                       19  200WRDYN
     I                                       21  21 SRFRQ
     I                                       22  340WSVRA
     I                                       35  360WSDST
     I                                       37  38 STNOS
     I**********                             37  48 WOSDA                                     CAS011
     I**********                             49  58 WTSTN                                     CAS011
     I**********                             59  68 WFACO                                     CAS011
     I**********                             69  98 SSPI1                                     CAS011
     I**********                             99 128 SSPI2                                     CAS011
     I**********                            129 158 SSPI3                                     CAS011
     I                                       37  54 WOSDA                                     CAS011
     I                                       55  64 WTSTN                                     CAS011
     I                                       65  74 WFACO                                     CAS011
     I                                       75 104 SSPI1                                     CAS011
     I                                      105 134 SSPI2                                     CAS011
     I                                      135 164 SSPI3                                     CAS011
     I**********                             69 158 SSPI                                      CAS011
     I                                       75 164 SSPI                                      CAS011
     I**********                            159 1600WMDST                                    BUG8832
     I**********                            161 162 MTNOS                                    BUG8832
     I**********                            161 172 WOMDA                                     CAS011
     I**********                            173 182 WTMAN                                     CAS011
     I**********                            159 182 WREC                                      CAS011
     I**********                            183 1937WINTT                                     CAS011
     I**********                            194 1980WSVRD                                     CAS011
     I**********                            199 199 SRLFQ                                     CAS011
     I**********                            200 2010WRLDY                                     CAS011
     I                                      165 1660WMDST                                    BUG8832
     I                                      167 168 MTNOS                                    BUG8832
     I**********                            161 178 WOMDA                             CAS011 BUG8832
     I**********                            179 188 WTMAN                             CAS011 BUG8832
     I**********                            159 188 WREC                              CAS011 BUG8832
     I**********                            189 1997WINTT                             CAS011 BUG8832
     I**********                            200 2040WSVRD                             CAS011 BUG8832
     I**********                            205 205 SRLFQ                             CAS011 BUG8832
     I**********                            206 2070WRLDY                             CAS011 BUG8832
     I                                      169 186 WOMDA                                    BUG8832
     I                                      187 196 WTMAN                                    BUG8832
     I                                      165 196 WREC                                     BUG8832
     I                                      197 2077WINTT                                    BUG8832
     I                                      208 2120WSVRD                                    BUG8832
     I                                      213 213 SRLFQ                                    BUG8832
     I                                      214 2150WRLDY                                    BUG8832
     I                                        1  34 CONFS1
     I                                        6  34 LINKS1
     I**********                             35 158 CONFS2                                   BUG8832
     I                                       35 164 CONFS2                                   BUG8832
     I**********                            183 201 LINKS2                                    CAS011
     I**********                            189 207 LINKS2                            CAS011 BUG8832
     I                                      197 214 LINKS2                                   BUG8832
      *
     I            DS
     I***********                             1   20PRANG                 168270
     I***********                             3   40WRANG                 168270
     I                                        1   2 PRANG                 168270
     I                                        3   4 WRANG                 168270
      *                                                                   120813
     ID#SLFC      DS                                                      120813
     I**********                              1   60S#FCUS                             120813 CSD027
     I                                        1   6 S#FCUS                                    CSD027
     I                                        7   90S#FTYP                120813
     I                                       10  110S#FSEQ                120813
      *                                                                   121142
     ID#CLON      DS                                                      121142
     I**********                              1   60WALON                              121142 CLE148
     I                                        1   6 WALON                                     CLE148
     I                                        7   7 WEPAR                 121142
     I/COPY WNCPYSRC,LEH00876
      *                                                                   157634
     IREPAY3      DS                                                                          217847
     I                                        1   6 SVDAT                                     217847
     I                                        7  20 SCPAM                                     217847
     I                                       21  26 SMDAT                                     217847
     I                                       27  27 SCALC                                     217847
     I                                       28  42 SRAMT                                     217847
     I                                       43  43 SREPT                                     217847
     I                                       44  44 SPDDI                                     217847
     I                                       45  50 SNRPD                                     217847
     I                                       51  52 SRDYN                                     217847
     I                                       53  53 SSPIN                                     217847
     I                                       54  65 SRTSP                                     217847
     I                                       66  67 SBRTT                                     217847
     IREPY3B      DS                                                                          217847
     I                                        1  68 WREPY3                                    217847
     I                                       28  42 WSRAMT                                    217847
     IKEY47       DS                                                      157634
     I                                        1   3 K#BRCA                157634
     I**********                              4   90K#PMFC                             157634 CSD027
     I                                        4   9 K#PMFC                                    CSD027
     I                                       10  120K#PMFT                157634
     I                                       13  140K#PMFN                157634
     I**********                             15  200K#CNUM                             157634 CSD027
     I                                       15  20 K#CNUM                                    CSD027
      *
     I/COPY QWINDSRC,LE2030GDTA
      ** Data to be passed to window program
      *
     ISCSARD    E DSSCSARDPD
      ** SAR details
      *
     ISDACOF    E DSSDACOFPD
      ** Account officer details
      *
     ISDALTN    E DSSDALTNPD
      ** Alternate names and addresses
      *
     ISDBANK    E DSSDBANKPD
      ** Bank details
      *
     ISDBOOK    E DSSDBOOKPD
      ** Book details
      *
     ISDBRCH    E DSSDBRCHPD
      ** Branch details
      *
     ISDBSRT    E DSSDBSRTPD
      ** Base rate codes
      *
     ISDCLND    E DSSDCLNDPD
      ** Customer lending ICD
      *
     ISDCTRY    E DSSDCTRYPD
      ** Country codes
      *
     ISDCURR    E DSSDCURRPD
      ** Currency details
      *
     ISDCUST    E DSSDCUSTPD
     I              QQDFAC                          Q1DFAC                                    CGL029
      ** Customer details
      *
     ISDDEAL    E DSSDDEALPD
      ** Dealing details
      *
     ISDGELR    E DSSDGELRPD
     I              QQACCD                          Q1ACCD                                    CGL029
      ** General ledger details
      *
     ISDINDS    E DSSDINDSPD
      ** Local industry codes
      *
     ISDLENO    E DSSDLENOPD
      ** Loan number ranges file
      *
     ISDLOAN    E DSSDLOANPD
      ** Loan type/subtype details
      *
     ISDMMOD    E DSSDMMODPD
      ** Midas modules details
      *
     ISDNOST    E DSSDNOSTPD
     I              QQACCD                          Q2ACCD                                    CGL029
      ** Nostro details
      *
     ISDPCAC    E DSSDPCACPD
      ** Profit centre accounting ICD
      *
     ISDPLCS    E DSSDPLCSPD
      ** Portfolio management customer details
      *
     ISDPORT    E DSSDPORTPD
      ** Portfolio ICD
      *
     ISDPRFC    E DSSDPRFCPD
      ** Profit centres
      *
     ISDRETL    E DSSDRETLPD
     I              QQACCD                          Q3ACCD                                    CGL029
      ** Retail ICD
      *
     ISDTRAD    E DSSDTRADPD
     I              QQACCD                          Q4ACCD                                    CGL029
      ** Trading details
      *
     ISDHEDG    E DSSDHEDGPD                                                                  232348
      ** External data structure for Midas Hedging ICD file                                   232348
      *                                                                                       232348
     IDSFDY     E DSDSFDY
      ** Short data structure for access objects
      *
     IDSSDY     E DSDSSDY
      ** Long data structure for access objects
      *
     IDSLDY     E DSDSLDY                                                 CPB001
      ** Very Long data structure for access objects                      CPB001
      *                                                                   CPB001
      * 24X7 Data Structure                                               CSC011
     ISC24X7    E DSSC24X7                                                CSC011
      *                                                                   CSC011
      * SDSTAT Data Structure                                             CSC011
     ISDSTAT    E DSSDSTAT                                                CSC011
      *                                                                   CSC011
     I*SDYLDC***E*DSSDYLDCPD**                   32                                    CAS001 CGP001
     I*SDYLDC** E DSSDYLDCPD                     42                                    CGP001 CRE026
     ISDYLDC    E DSSDYLDCPD                     91                                           CGP001
     I              FSYLDC                          FYLDC                                     CAS001
     I              FSCHTP                          FCHTP                                     232348
     I              FSYLDCA                         FYLDCA                                    CAS001
      ** Dummy record format for access to Yield Curve files                                  CAS001
      *                                                                                       CAS001
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      ** Midas Functions for Watch List Checking Details File                                 CSD015
      *                                                                                       CSD015
     ISDCWCD    E DSSDCWCDPD                                                                  CSD015
      ** Midas SD Watch List Configuration Data File                                          CSD015
      *                                                                                       CSD015
     IPSDWLT    E DSSDWLTOPD                                                                  CSD015
      ** Watch List Transaction details file                                                  CSD015
      *                                                                                       CSD015
      * DS for calculating PC reference                                   158046
     ILEALLO    E DSLEALLO                                                158046
     I/COPY WNCPYSRC,LEH00513
      *
      *
     IDATMSG      DS                                                      158056
     I                                        1   7 O#NIDT                158056
     I                                        8  14 O#NRPD                158056
      *                                                                   CAP053
      ** Header and Footer narratives in Mode 'F'                         CAP053
      *                                                                   CAP053
     I            DS                                                      CAP053
     I I            'CUSTOMER LOAN INPUT '    1  20 SHEAD                 CAP053
      ** Heading                                                          CAP053
     I I            'CUSTOMER LOAN REPAIR'   21  40 UHEADF                CAP053
      ** Heading in Mode 'F'                                              CAP053
      *                                                                   CAP053
     I            DS                                                      CAP053
     I I            'F9=Insert'               1   9 SF9INS                CAP053
     I I            'F12=Previous screen'    10  28 SF12PR                CAP053
      ** Footer                                                           CAP053
      *                                                                   CAP053
     ISACTNH      DS                                                      CAP053
     I I            'E,1..>4=Enquire'         1  15 SENQ                  CAP053
     I I            'A=Amend'                20  26 SAMD                  CAP053
     I I            'R=Reverse'              31  39 SREV                  CAP053
      ** Action code Header                                               CAP053
      *                                                                   CAP053
     IUACTNH      DS                                                      CAP053
     I I            'U=Amend'                 1   7 UAMD                  CAP053
     I I            'Q=Delete'               12  19 UDEL                  CAP053
      ** Action code Header in Mode 'F'                                   CAP053
      *                                                                                       CSD015
     IPXML        DS                           9999                                           CSD015
      ** 2ND PARAMETER in XML Format for Compliance Engine Program                            CSD015
      *                                                                   157749
     I              '123456789'           C         NUMS                  157749
      ** Number constant                                                  157749
      *                                                                   157749
     I/COPY WNCPYSRC,LE2030I001
     I/COPY ZSRSRC,ZCPDZ1
     I/COPY ZSRSRC,ZDATE9Z2
     I/COPY ZSRSRC,ZDAT10Z1
     I/COPY ZSRSRC,ZF2CI
     I/COPY ZSRSRC,ZFRPEDZ2
     I/COPY ZSRSRC,ZHOLI
     I/COPY ZSRSRC,ZINTDYZ1
     I/COPY ZSRSRC,ZTNLU1Z1
      /EJECT
      *****************************************************************
      *                   Index to subroutines                        *
      *  Main routine                                                 *
      *  SRINIT  -  Initial processing                                *
      *  SRDTL1  -  Process first detail screen                       *
      *  SRDTL2  -  Process second detail screen                      *
      *  SRDTL3  -  Process third detail screen - extended settlement *
      *  SREXST  -  Format fields for extended settlement             *
      *  SRSETT  -  Save fields received from settlement screen       *
      *  SRMFSC  -  Move file values to settlement screen             *
      *  SRDTSC  -  Move previously validated settlement values       *
      *  SRSHNM  -  Move customer number to shortname counterpart     *
      *  SRINST  -  Initialise extended sett fields to blanks         *
      *  SRDTL4  -  Process fourth detail screen                      *
      *  SRDTL5  -  Process fifth detail screen                       *
      *  SRWNDW  -  Window processing                                 *
      *  SRBTCH  -  Batch processing                                  *
      *  SRVAL1  -  Validate first detail screen                      *
      *  SRMATY  -  Further validation on maturity date               *
      *  SRSOLD  -  Further validation for parts sold                 *
      *  SRVAL2  -  Validate second detail screen                     *
      *  SRCINT  -  Calculate interest amount between value/mat date  *
      *  SRCL05  -  Validate CLE005 fields                            *
      *  SRVAL4  -  Validate fourth detail screen                     *
      *  SREXCH  -  Validate facility/base currency exchange rates    *
      *  SR2410  -  Validate settlement details                       *
      *  SRBPEX  -  Format extenced sett fields for batch/play modes  *
      *  SREXVL  -  Extra validation after extended settlement        *
      *  SRSTRT  -  Validate initial screen                           *
      *  SRSFIL  -  Subfile processing                                *
      *  SRVREV  -  Validate subfile entries                          *
      *  SRVSUB  -  Validate subfile entries                          *
      *  SRSPRO  -  Process each subfile request                      *
      *  SRREVR  -  Validate reverse action                           *
      *  SRAUTH  -  Validate authorisation action                     *
      *  SRCAUT  -  Check if user is authorised to the action         *
      *  SRLOAD  -  Load subfile records                              *
      *  SRINSC  -  Format screen fields for interactive/record mode  *
      *  SRINFM  -  Format screen fields for insert                   *
      *  SROTFM  -  Format screen fields for non-insert               *
      *  SRPLSC  -  Format screen fields for play mode                *
      *  SRBTSC  -  Format screen fields for batch mode               *
      *  SRINSR  -  Insert new records                                *
      *  SRUPDR  -  Update existing records                           *
      *  SRFEES  -  Update Fees File                                  *   CLE009
      *  SRDATA  -  Set up output fields for files                    *
      *  SRLONL  -  Format CLOAN A record for update                  *
      *  SRINAM  -  Format CLOAN A record for insert and amend        *
      *  SRLONK  -  Format CLOAN B record for update                  *
      *  SRRELL  -  Update related loan for parts sold                *
      *  SRTLOG  -  Chain to LTRIX header                             *
      *  SRGLOC  -  Get start and maturity settlements                *
      *  SRSLOC  -  Get settlement locations                          *
      *  SRFCLT  -  Update facilities file                            *
      *  SRCAUP  -  Update credit agreement/superfacility             *   CLE005
      *  SRFCUP  -  Prepare for facilities update                     *
      *  SRFUPD  -  Determine if adding to/subtracting from facility  *
      *  SRFEXP  -  Update exposure and availability array of facility*
      *  SRLREF  -  Update LEREF record/s                             *
      *  SRTRIX  -  Update transaction index                          *
      *  SRRSET  -  Reset LTRIX and update CLOAN trailer              *
      *  SRCKFR  -  Check if the Facility has been reactivated.       *   153787
      *  GLZSUB  -  Subtracts an amount from the total                *
      *  GLZADD  -  Adds an amount to the total                       *
      *  GLZSUM  -  Carries out the addition of the amounts           *
      *  SRSHDW  -  Update shadow files                               *
      *  SRTEST  -  Write to test harness file                        *
      *  SRWARN  -  Display warning message if loan is syndicated     *   159256
      *  CLEAR   -  Clears message from the program message queue     *
      *  ZASNMS  -  Sends message to the program message queue        *
      *  SRTEXT  -  Set up text from message file                     *   123998
      *  SRBERR  -  Format batch error details                        *
      *  SRCHCK  -  Check if Watch List Checking Engine Program needs *                       CSD015
      *             to be called                                      *                       CSD015
      *  SRWTCH  -  Set-up parameter for Compliance Engine program.   *                       CSD015
      *             Send transaction details to Compliance Watch by   *                       CSD015
      *             calling the Dummy program for OPM that will call  *                       CSD015
      *             the watch list engine.                            *                       CSD015
      *  SRFRMT  -  Convert Settlement Details to Customer Name and   *                       CSD015
      *             Address                                           *                       CSD015
      *  *PSSR   -  Error handling subroutine                         *
      *****************************************************************
      *
      ** Perform initial processing
      *
     C                     EXSR SRINIT
      *
      ** Perform different detailed processing
      *
     C           WFMT      DOWNE*BLANK
     C           WFMT      CASEQ'F0'      SRSTRT
     C           WFMT      CASEQ'S0'      SRSFIL
     C           WFMT      CASEQ'D1'      SRDTL1
     C           WFMT      CASEQ'D2'      SRDTL2
     C           WFMT      CASEQ'D3'      SRDTL3
     C           WFMT      CASEQ'D4'      SRDTL4
     C           WFMT      CASEQ'D5'      SRDTL5
     C           WFMT      CASEQ'WR'      SRINSR
     C           WFMT      CASEQ'UP'      SRUPDR
     C                     ENDCS
     C                     ENDDO
     C/COPY WNCPYSRC,LE2030C047
      *
      ** Close SD2400 program and end this program's processing
      *
     C           PMODE     IFNE 'B'                                       119594
     C           PMODE     ANDNE'P'                                       119594
     C                     MOVE 'T'       PMTERM
     C                     CALL 'SD2400'
     C                     PARM           PRTCD
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           SLNRF
     C                     PARM           @PARM3                                              222373
     C                     ROLBK                                                              227710
     C                     ENDIF                                          119594
      *
     C                     MOVE '1'       *INLR
      /EJECT
      *****************************************************************
      * SRINIT  -  Initial Processing                                 *
      * Called by: Main routine                                       *
      * Calls    : SRBTCH - Batch processing                          *
      *****************************************************************
     C           SRINIT    BEGSR
      *
      ** Set up copyright parameter
      *
     C                     MOVEACPY@      CPY2@  80
      *                                                                   125557
     C           *LIKE     DEFN RLDT      W#RLDT                          125557
     C           *LIKE     DEFN NIDT      W#NIDT                          125557
     C           *LIKE     DEFN NRPD      W@NRPD                          125557
     C           *LIKE     DEFN SFCRA     W@FCRA                          125258
     C           *LIKE     DEFN SRAMT     W@RAMT                          125258
     C           *LIKE     DEFN RSTM      W#RSTM                                              245297
     C           *LIKE     DEFN RONS      W#RONS                                              245297
     C           *LIKE     DEFN RIBN      W#RIBN                                              245297
     C           *LIKE     DEFN RIBA      W#RIBA                                              245297
     C           *LIKE     DEFN ROBN      W#ROBN                                              245297
     C           *LIKE     DEFN ROCN      W#ROCN                                              245297
     C           *LIKE     DEFN PSTM      W#PSTM                                              245297
     C           *LIKE     DEFN PONS      W#PONS                                              245297
     C           *LIKE     DEFN PIBN      W#PIBN                                              245297
     C           *LIKE     DEFN PIBA      W#PIBA                                              245297
     C           *LIKE     DEFN POBN      W#POBN                                              245297
     C           *LIKE     DEFN POCN      W#POCN                                              245297
     C           *LIKE     DEFN CVMR      W#CVMR                                              245297
     C           *LIKE     DEFN RCRN      W#RCRN                                              245297
     C           *LIKE     DEFN RCRA      W#RCRA                                              245297
     C           *LIKE     DEFN RVNO      W#RVNO                                              245297
     C           *LIKE     DEFN AWBN      W#AWBN                                              245297
     C           *LIKE     DEFN AWBA      W#AWBA                                              245297
     C           *LIKE     DEFN BENN      W#BENN                                              245297
     C           *LIKE     DEFN BENA      W#BENA                                              245297
     C           *LIKE     DEFN DTP1      W#DTP1                                              245297
     C           *LIKE     DEFN DTP2      W#DTP2                                              245297
     C           *LIKE     DEFN DTP3      W#DTP3                                              245297
     C           *LIKE     DEFN DTP4      W#DTP4                                              245297
     C           *LIKE     DEFN DCHG      W#DCHG                                              245297
     C           *LIKE     DEFN BTB1      W#BTB1                                              245297
     C           *LIKE     DEFN BTB2      W#BTB2                                              245297
     C           *LIKE     DEFN BTB3      W#BTB3                                              245297
     C           *LIKE     DEFN BTB4      W#BTB4                                              245297
     C           *LIKE     DEFN BTB5      W#BTB5                                              245297
     C           *LIKE     DEFN BTB6      W#BTB6                                              245297
     C           *LIKE     DEFN TNLUX     RRNTD                                             AR322732
      *                                                                   125557
     C                     MOVE *BLANKS   W#ACTN                          125557
     C                     MOVE *BLANKS   W@FCRA                          125258
     C                     MOVE *BLANKS   W@RAMT                          125258
     C                     MOVE *BLANKS   AUTOLN                                              207689
     C                     MOVE '0'       WSFILE  1                                           208725
      *
      ** Receive entry parameters
      *
     C           *ENTRY    PLIST
     C                     PARM           PMODE   1
     C                     PARM           PTYPE   4
     C                     PARM           PINPP
     C                     PARM           POUTP
     C                     PARM           PTMST  26                                           CLE034
      *
      ** Define data areas
      *
     C           *NAMVAR   DEFN           LDA
     C           *NAMVAR   DEFN           ZMUSER
     C           PMODE     IFNE 'B'
     C                     IN   ZMUSER
     C                     ENDIF
      *                                                                   CSC011
     C           *NAMVAR   DEFN           SDSTAT                          CSC011
     C*                                                                   CSC011
     C           *NAMVAR   DEFN           SC24X7                          CSC011
     C*                                                                   CSC011
      *
      ** Define parameter list for ZALIGN
      *
     C           PPAR1     PLIST
     C                     PARM *BLANKS   PRTCD
     C                     PARM           PSCRF  16
     C                     PARM           PNDEC   10
     C                     PARM           PNDIG   20
     C                     PARM *BLANKS   PRVAL  16
      *
      ** Define parameter list for AOSARDR0
      *
     C           PPAR2     PLIST
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
      *
      ** Define parameter list for AOCUSTR0
      *
     C           PPAR3     PLIST
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PCUST  10
     C                     PARM *BLANKS   PKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      ***Define*parameter*list*for*AOBRCHR0****************************   121783
      ** Define parameter list for AOBRCHR1                               121783
      *
     C           PPAR4     PLIST
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PBRCA   3
     C           SDBRCH    PARM SDBRCH    DSSDY
      *
      ** Define parameter list for AOCURRR0
      *
     C           PPAR5     PLIST
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PCURR   3
     C           SDCURR    PARM SDCURR    DSSDY
      *                                                                   CPB001
      ** Define parameter list for AOCUSTR1                               CPB001
      *                                                                   CPB001
     C           PPAR6     PLIST                                          CPB001
     C                     PARM *BLANKS   PRTCD                           CPB001
     C                     PARM '*KEY   ' POPTN                           CPB001
     C                     PARM           PCUST  10                       CPB001
     C                     PARM *BLANKS   PKYST   7                       CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
      *
      ** Key list for Facilities file
      *
     C           WKFAC     KLIST
     C                     KFLD           WFCNUM
     C                     KFLD           WFFACT  30
     C                     KFLD           WFFCNO  20
     C                     KFLD           WFRCTP  1
      *
      ** Key list for Facilities file (access of prime facility)
      *
     C           WKPRM     KLIST
     C                     KFLD           WFCNUM
     C                     KFLD           WFFACT
     C                     KFLD           WFFCNO
      *
      ** Key list for Fees file
      *
     C           WKFEE     KLIST
     C**********           KFLD           WFCNUM  60                                          CSD027
     C                     KFLD           WFCNUM  6                                           CSD027
     C                     KFLD           WFFACL  50
     C**********           KFLD           WFLOAN  60                                          CLE148
     C                     KFLD           WFLOAN  6                                           CLE148
      *
      ** Key list for LOAMS
      *
     C           WKLAM     KLIST
     C**********           KFLD           WLLOAN  60                                          CLE148
     C                     KFLD           WLLOAN  6                                           CLE148
     C                     KFLD           WLVDAT  50
     C                     KFLD           WLLASN  30
      *
      ** Key list for CLOAN
      *
     C           WKLON     KLIST
     C**********           KFLD           WALON   60                                          CLE148
     C                     KFLD           WALON   6                                           CLE148
     C                     KFLD           WEPAR   1
      *
      ** Key list for PSOLDLL
      *
     C           WKPAR     KLIST
     C**********           KFLD           LNRF                                                CSD027
     C                     KFLD           OLNOKA  6                                           CSD027
     C                     KFLD           WMDAT   50
      *
      ** Key list for PMPORTPD
      *
     C           WKPOR     KLIST
     C**********           KFLD           WPCNO   60                                          CSD027
     C                     KFLD           WPCNO   6                                           CSD027
     C                     KFLD           WPTFR   4
      *
      ** Key list for LEREF
      *
     C           WKREF     KLIST
     C**********           KFLD           WCNUM   60                                          CSD027
     C                     KFLD           WCNUM   6                                           CSD027
     C                     KFLD           WFACT   30
     C                     KFLD           WFCNO   20
     C**********           KFLD           WLNRF   60                                          CLE148
     C                     KFLD           WLNRF   6                                           CLE148
      *                                                                   CLE005
      ** Key list for Facility Amendments file                            CLE005
      *                                                                   CLE005
     C           WKFAM     KLIST                                          CLE005
     C                     KFLD           BRCAF                           CLE005
     C                     KFLD           CNUMF                           CLE005
     C                     KFLD           FACT                            CLE005
     C                     KFLD           FCNO                            CLE005
      *                                                                   153787
     C           WKFAM2    KLIST                                          153787
     C                     KFLD           CNUMF                           153787
     C                     KFLD           FACT                            153787
     C                     KFLD           FCNO                            153787
      *                                                                   120813
      * Key list for lepartl2 (sale of loan fac)                          120813
     C           K#PART    KLIST                                          120813
     C                     KFLD           PBRCA                           120813
     C                     KFLD           S#FCUS                          120813
     C                     KFLD           S#FTYP                          120813
     C                     KFLD           S#FSEQ                          120813
      *                                                                   120813
      * Key list for fclty (sale of loan fac)                             120813
     C           K#FCLT    KLIST                                          120813
     C                     KFLD           S#FCUS                          120813
     C                     KFLD           S#FTYP                          120813
     C                     KFLD           S#FSEQ                          120813
      *                                                                   157634
      * Key list for LEFCLTL2 (funding participant details)               157634
     C           K#FUND    KLIST                                          157634
     C                     KFLD           K#BRCA  3                       157634
     C**********           KFLD           K#PMFC  60                                   157634 CSD027
     C                     KFLD           K#PMFC  6                                           CSD027
     C                     KFLD           K#PMFT  30                      157634
     C                     KFLD           K#PMFN  20                      157634
     C**********           KFLD           K#CNUM  60                                   157634 CSD027
     C                     KFLD           K#CNUM  6                                           CSD027
      *                                                                   154991
      ** KLIST for LF/LEFEEDL2                                            154991
      *                                                                   154991
     C           LEFKEY    KLIST                                          154991
     C**********           KFLD           FCNUM   60                                   154991 CSD027
     C                     KFLD           FCNUM   6                                           CSD027
     C                     KFLD           FFACL   50                      154991
     C**********           KFLD           FLOAN   60                                   154991 CLE148
     C                     KFLD           FLOAN   6                                           CLE148
      *                                                                                       190132
      ** Key list for LF/LEFCLTLD (credit agreement facility file)                            190132
      *                                                                                       190132
     C           CRAKEY    KLIST                                                              190132
     C**********           KFLD           CANM    60                                   190132 CSD027
     C                     KFLD           CANM    6                                           CSD027
     C                     KFLD           CAFT    30                                          190132
     C                     KFLD           CAFN    20                                          190132
      *                                                                                       207689
      ** Key for accessing MCLONCL.                                                           207689
      *                                                                                       207689
     C           MLKEY     KLIST                                                              207689
     C                     KFLD           MLLNRF                                              207689
     C                     KFLD           MLRCDT                                              207689
      *                                                                   CSC011
      **  Used for APILOGL0                                               CSC011
      *                                                                   CSC011
     C           KAPLOG    KLIST                                          CSC011
     C                     KFLD           KMTYPE  8                       CSC011
     C                     KFLD           KFOID  20                       CSC011
     C                     KFLD           KTSTMP 26                       CSC011
     C/COPY WNCPYSRC,LEH00514
      *
     C           KASHF     KLIST                                                              CAS004
     C                     KFLD           KFSMOD  2                                           CAS004
     C**********           KFLD           KFSDLN  60                                   CAS004 CLE148
     C                     KFLD           KFSDLN  6                                           CLE148
      *                                                                                       CAS004
     C                     MOVE 'LE'      KFSMOD                                              CAS004
      *                                                                                       CAS004
      **  Used for SDCWHTL1                                                                   CSD015
      *                                                                                       CSD015
     C           KCWHT     KLIST                                                              CSD015
     C                     KFLD           K3FUNT  8                                           CSD015
     C                     KFLD           K3IDEN 40                                           CSD015
     C                     KFLD           K3BRCH  3                                           CSD015
      *                                                                                     AR740717
      ** Key list for HISTR                                                                 AR740717
      *                                                                                     AR740717
     C           KHISTR    KLIST                                                            AR740717
     C                     KFLD           KHBRCA  3                                         AR740717
     C                     KFLD           KHCNUM  6                                         AR740717
     C                     KFLD           KHLNRF  6                                         AR740717
     C                     KFLD           KHVDAT  50                                        AR740717
     C                     KFLD           KHPRSQ  20                                        AR740717
     C                     KFLD           KHLCD   50                                       AR1089839
     C                     KFLD           KHLASN  30                                        AR740717
      *                                                                                       CSD015
      ** Initialise LDA
      *
     C           *LOCK     IN   LDA
     C                     MOVEL'LE2030  'DBPGM
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD*ZEROS    DBASE
     C                     MOVE *BLANKS   DBTXT
     C                     OUT  LDA
      *
      ** Retrieve bank details
      *
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANKS   PRTCD   7
     C                     PARM '*FIRST ' POPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBANKPD'DBFILE           ************
     C                     Z-ADD1         DBASE            * DBERR 01 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     ENDIF
     C                     ENDIF
      *
      ** Retrieve telex notice days of local currency
      *
     C                     MOVE BJLCCY    PCURR
     C                     CALL 'AOCURRR0'PPAR5
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD26        DBASE            * DBERR 26 *
     C                     MOVELBJLCCY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     Z-ADDA6TXND    WTXND   20
      *
      ** Retrieve midas module details
      *
     C                     CALL 'AOMMODR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDMMODPD'DBFILE           ************
     C                     Z-ADD2         DBASE            * DBERR 02 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE '1'       *IN05                           CPB001
     C                     ENDIF                                          CPB001
      *
      ** Retrieve portfolio management ICD for portfolio module
      *
     C           BGPFMG    IFEQ 'Y'
     C                     MOVE '1'       *IN05
     C                     CALL 'AOPORTR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDPORT    PARM SDPORT    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDPORTPD'DBFILE           ************
     C                     Z-ADD3         DBASE            * DBERR 03 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Retrieve general ledger details
      *
     C**********           CALL 'AOGELRR0'                                                    CAS011
     C                     CALL 'AOGELRR1'                                                    CAS011
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C********** SDGELR    PARM SDGELR    DSFDY                                               CAS011
     C           SDGELR    PARM SDGELR    DSSDY                                               CAS011
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDGELRPD'DBFILE           ************
     C                     Z-ADD4         DBASE            * DBERR 04 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Retrieve lending ICD
      *
     C                     CALL 'AOCLNDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDCLND    PARM SDCLND    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCLNDPD'DBFILE           ************
     C                     Z-ADD5         DBASE            * DBERR 05 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C           BPGIAV    IFEQ 'Y'
     C                     MOVE '1'       *IN24
     C                     ENDIF
      *
      ** Retrieve retail details
      *
     C           BGRTBN    IFEQ 'Y'
     C           BGNXST    ANDEQ'Y'
     C                     CALL 'AORETLR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDRETL    PARM SDRETL    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDRETLPD'DBFILE           ************
     C                     Z-ADD6         DBASE            * DBERR 06 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Retrieve trading data
      *
     C                     CALL 'AOTRADR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDTRAD    PARM SDTRAD    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDTRADPD'DBFILE           ************
     C                     Z-ADD7         DBASE            * DBERR 07 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Retrieve dealing data
      *
     C**********           CALL 'AODEALR0'                                                    CAS011
     C                     CALL 'AODEALR1'                                                    CAS011
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C********** SDDEAL    PARM SDDEAL    DSFDY                                               CAS011
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CAS011
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDDEALPD'DBFILE           ************
     C                     Z-ADD8         DBASE            * DBERR 08 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *                                                                   CDE002
      ** Access SAR details file to determine if CDE002 is switched on    CDE002
      *                                                                   CDE002
     C                     CALL 'AOSARDR0'                                CDE002
     C                     PARM *BLANKS   PRTCD   7                       CDE002
     C                     PARM '*VERIFY' POPTN   7                       CDE002
     C                     PARM 'CDE002'  PSARD   6                       CDE002
     C           SCSARD    PARM SCSARD    DSFDY                           CDE002
      *                                                                   CDE002
     C                     MOVE 'N'       CDE002  1                       CDE002
     C           PRTCD     IFEQ *BLANKS                                   CDE002
     C                     MOVE 'Y'       CDE002                          CDE002
     C                     ENDIF                                          CDE002
      *                                                                                       CGL058
      ** Access SAR details file to determine if CGL058 is switched on                        CGL058
      *                                                                                       CGL058
     C                     CALL 'AOSARDR0'                                                    CGL058
     C                     PARM *BLANKS   PRTCD                                               CGL058
     C                     PARM '*VERIFY' POPTN                                               CGL058
     C                     PARM 'CGL058'  PSARD                                               CGL058
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL058
      *                                                                                       CGL058
     C                     MOVE 'N'       CGL058  1                                           CGL058
     C           PRTCD     IFEQ *BLANKS                                                       CGL058
     C                     MOVE 'Y'       CGL058                                              CGL058
     C                     ENDIF                                                              CGL058
      *
      ** Retrieve profit centre accounting ICD if analytical
      ** accounting is installed
      *
     C           BGN0ST    IFEQ 'Y'
     C                     CALL 'AOPCACR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDPCAC    PARM SDPCAC    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDPCACPD'DBFILE           ************
     C                     Z-ADD9         DBASE            * DBERR 09 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2030C067
      *
      ** Determine if Customer Lending Enhancements - Authorisation
      ** feature is installed
      *
     C                     MOVE 'CLE002'  PSARD
     C                     CALL 'AOSARDR0'PPAR2
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE002  1
     C                     ELSE
     C                     MOVE 'N'       CLE002
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD10        DBASE            * DBERR 10 *
     C                     MOVEL'CLE002'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Determine if Customer Lending Enhancements - Others
      ** feature is installed
      *
     C                     MOVE 'CLE005'  PSARD
     C                     CALL 'AOSARDR0'PPAR2
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE005  1
     C                     ELSE
     C                     MOVE 'N'       CLE005
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD11        DBASE            * DBERR 11 *
     C                     MOVEL'CLE005'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Determine if Customer Lending Enhancements - Past Due Account
      ** feature is installed
      *
     C                     MOVE 'CLE006'  PSARD
     C                     CALL 'AOSARDR0'PPAR2
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE006  1
     C                     MOVE '1'       *IN25
     C                     ELSE
     C                     MOVE 'N'       CLE006
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD31        DBASE            * DBERR 31 *
     C                     MOVEL'CLE006'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Determine if BLI Lending Enhancements feature is installed
      *
     C                     MOVE 'S01465'  PSARD
     C                     CALL 'AOSARDR0'PPAR2
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       S01465  1
     C                     MOVE '1'       *IN01
     C                     ELSE
     C                     MOVE 'N'       S01465
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD12        DBASE            * DBERR 12 *
     C                     MOVEL'S01465'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *                                                                   CLE007
      ** Determine if Customer Lending Enhancement - Others               CLE007
      ** feature is installed                                             CLE007
      *                                                                   CLE007
     C                     MOVE 'CLE007'  PSARD                           CLE007
     C                     CALL 'AOSARDR0'PPAR2                           CLE007
     C           PRTCD     IFEQ *BLANKS                                   CLE007
     C                     MOVE 'Y'       CLE007  1                       CLE007
     C                     MOVE 'CLE009'  PSARD                           CLE009
     C                     CALL 'AOSARDR0'PPAR2                           CLE009
      *                                                                   CLE009
      ** If CLE009 is installed, fill currency and their corresponding    CLE009
      ** telex notice days arrays                                         CLE009
      *                                                                   CLE009
     C           PRTCD     IFEQ *BLANKS                                   CLE009
     C                     MOVE 'Y'       CLE009  1                       CLE009
     C                     Z-ADD1         X       30                      CLE009
      *                                                                   CLE009
     C                     CALL 'AOCURRR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*FIRST ' POPTN                           CLE009
     C                     PARM           PCURR   3                       CLE009
     C           SDCURR    PARM SDCURR    DSSDY                           CLE009
      *                                                                   CLE009
     C                     MOVE A6CYCD    CYA,X                           CLE009
     C                     MOVE A6TXND    TND,X                           CLE009
      *                                                                   CLE009
     C           PRTCD     DOWNE'*EOF    '                                CLE009
     C                     ADD  1         X                               CLE009
      *                                                                   CLE009
     C                     CALL 'AOCURRR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*NEXT  ' POPTN                           CLE009
     C                     PARM           PCURR   3                       CLE009
     C           SDCURR    PARM SDCURR    DSSDY                           CLE009
      *                                                                   CLE009
     C           PRTCD     IFNE '*EOF    '                                CLE009
     C                     MOVE A6CYCD    CYA,X                           CLE009
     C                     MOVE A6TXND    TND,X                           CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDDO                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'N'       CLE009                          CLE009
      *                                                                   CLE009
     C           PRTCD     IFNE '*NRF    '                                CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE009
     C                     Z-ADD49        DBASE            * DBERR 49 *   CLE009
     C                     MOVEL'CLE009'  DBKEY            ************   CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE007
     C                     MOVE 'N'       CLE007                          CLE007
     C           PRTCD     IFNE '*NRF    '                                CLE007
     C           *LOCK     IN   LDA                                       CLE007
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE007
     C                     Z-ADD39        DBASE            * DBERR 39 *   CLE007
     C                     MOVEL'CLE007'  DBKEY            ************   CLE007
     C                     OUT  LDA                                       CLE007
     C                     EXSR *PSSR                                     CLE007
     C                     ENDIF                                          CLE007
     C                     ENDIF                                          CLE007
      *
      ** Determine if EMU LE Settlement Currency Conversion               CEU004
      ** Upgrade feature is installed                                     CEU004
      *                                                                   CEU004
     C                     MOVE 'CEU004'  PSARD                           CEU004
     C                     CALL 'AOSARDR0'PPAR2                           CEU004
     C           PRTCD     IFEQ *BLANKS                                   CEU004
     C                     MOVE 'Y'       CEU004  1                       CEU004
     C                     ELSE                                           CEU004
     C                     MOVE 'N'       CEU004                          CEU004
     C           PRTCD     IFNE '*NRF    '                                CEU004
     C           *LOCK     IN   LDA                                       CEU004
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU004
     C                     Z-ADD44        DBASE            * DBERR 44 *   CEU004
     C                     MOVEL'CEU004'  DBKEY            ************   CEU004
     C                     OUT  LDA                                       CEU004
     C                     EXSR *PSSR                                     CEU004
     C                     ENDIF                                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C/COPY WNCPYSRC,LE2030C003
      ** Determine if EMU Lending Multi-currency Rollover                 169212
      ** feature is installed                                             169212
      *                                                                   169212
     C                     MOVE 'CEU020'  PSARD                           169212
     C                     CALL 'AOSARDR0'PPAR2                           169212
     C           PRTCD     IFEQ *BLANKS                                   169212
     C                     MOVE 'Y'       CEU020  1                       169212
     C                     ELSE                                           169212
     C                     MOVE 'N'       CEU020                          169212
     C           PRTCD     IFNE '*NRF    '                                169212
     C           *LOCK     IN   LDA                                       169212
     C                     MOVEL'SCSARDPD'DBFILE           ************   169212
     C                     Z-ADD47        DBASE            * DBERR 47 *   169212
     C                     MOVEL'CEU020'  DBKEY            ************   169212
     C                     OUT  LDA                                       169212
     C                     EXSR *PSSR                                     169212
     C                     ENDIF                                          169212
     C                     ENDIF                                          169212
      *                                                                   169212
      ** Determine if Data Export for CCRM Limits is active               CDE001
      *                                                                   CDE001
     C                     MOVE 'CDE001'  PSARD                           CDE001
     C                     CALL 'AOSARDR0'PPAR2                           CDE001
     C           PRTCD     IFEQ *BLANKS                                   CDE001
     C                     MOVE 'Y'       CDE001  1                       CDE001
     C                     ELSE                                           CDE001
     C                     MOVE 'N'       CDE001                          CDE001
     C           PRTCD     IFNE '*NRF    '                                CDE001
     C           *LOCK     IN   LDA                                       CDE001
     C                     MOVEL'SCSARDPD'DBFILE           ************   CDE001
     C                     Z-ADD51        DBASE            * DBERR 51 *   CDE001
     C                     MOVEL'CDE001'  DBKEY            ************   CDE001
     C                     OUT  LDA                                       CDE001
     C                     EXSR *PSSR                                     CDE001
     C                     ENDIF                                          CDE001
     C                     ENDIF                                          CDE001
      *                                                                   CLE011
      ** Check if Rollover Rate Fixing Day Enhancement is switched on     CLE011
      *                                                                   CLE011
     C                     MOVEL'CLE011'  PSARD                           CLE011
     C                     CALL 'AOSARDR0'PPAR2                           CLE011
     C           PRTCD     IFEQ *BLANKS                                   CLE011
     C                     MOVE 'Y'       CLE011  1                       CLE011
     C                     ELSE                                           CLE011
     C                     MOVE 'N'       CLE011                          CLE011
     C           PRTCD     IFNE '*NRF    '                                CLE011
     C           *LOCK     IN   LDA                                       CLE011
     C                     MOVEL'SCSARDPD'DBFILE                          CLE011
     C                     Z-ADD52        DBASE                           CLE011
     C                     MOVEL'CLE011'  DBKEY                           CLE011
     C                     OUT  LDA                                       CLE011
     C                     EXSR *PSSR                                     CLE011
     C                     ENDIF                                          CLE011
     C                     ENDIF                                          CLE011
      *                                                                   CLE014
      ** Check if CLE014 is installed                                     CLE014
      *                                                                   CLE014
     C                     MOVE 'CLE014'  PSARD                           CLE014
     C                     CALL 'AOSARDR0'PPAR2                           CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CLE014  1                       CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CLE014                          CLE014
     C           PRTCD     IFNE '*NRF    '                                CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVEL'SCSARDPD'DBFILE                          CLE014
     C**********           Z-ADD52        DBASE                           CLE014              204073
     C                     Z-ADD56        DBASE                                               204073
     C                     MOVEL'CLE014'  DBKEY                           CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                                       CLE023
      ** Check if CLE023 is installed.                                                        CLE023
      *                                                                                       CLE023
     C                     MOVE 'CLE023'  PSARD                                               CLE023
     C                     CALL 'AOSARDR0'PPAR2                                               CLE023
     C           PRTCD     IFEQ *BLANKS                                                       CLE023
     C                     MOVE 'Y'       CLE023  1                                           CLE023
     C                     ELSE                                                               CLE023
     C                     MOVE 'N'       CLE023                                              CLE023
     C           PRTCD     IFNE '*NRF    '                                                    CLE023
     C           *LOCK     IN   LDA                                                           CLE023
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE023
     C                     Z-ADD55        DBASE                                               CLE023
     C                     MOVEL'CLE023'  DBKEY                                               CLE023
     C                     OUT  LDA                                                           CLE023
     C                     EXSR *PSSR                                                         CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
     C/COPY WNCPYSRC,LE2030C079
      *
      ** Determine if Lending API enhancements - Loans Input is active    CAP053
      *                                                                   CAP053
     C                     MOVE 'CAP053'  PSARD                           CAP053
     C                     CALL 'AOSARDR0'PPAR2                           CAP053
     C           PRTCD     IFEQ *BLANKS                                   CAP053
     C                     MOVE 'Y'       CAP053  1                       CAP053
     C                     ELSE                                           CAP053
     C                     MOVE 'N'       CAP053                          CAP053
     C           PRTCD     IFNE '*NRF    '                                CAP053
     C           *LOCK     IN   LDA                                       CAP053
     C                     MOVEL'SCSARDPD'DBFILE           ************   CAP053
     C**********           Z-ADD52        DBASE            **DBERR*52**   CAP053              204073
     C                     Z-ADD57        DBASE            * DBERR 57 *                       204073
     C                     MOVEL'CAP053'  DBKEY            ************   CAP053
     C                     OUT  LDA                                       CAP053
     C                     EXSR *PSSR                                     CAP053
     C                     ENDIF                                          CAP053
     C                     ENDIF                                          CAP053
      *                                                                                       CAS001
      ** Determine if CAS001 is installed                                                     CAS001
      *                                                                                       CAS001
     C                     CALL 'AOSARDR0'                                                    CAS001
     C                     PARM *BLANKS   PRTCD                                               CAS001
     C                     PARM '*VERIFY 'POPTN                                               CAS001
     C                     PARM 'CAS001'  PSARD                                               CAS001
     C           SCSARD    PARM SCSARD    DSSDY                                               CAS001
      *                                                                                       CAS001
     C           PRTCD     IFNE *BLANKS                                                       CAS001
     C           PRTCD     ANDNE'*NRF   '                                                     CAS001
     C           *LOCK     IN   LDA                                                           CAS001
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS001
     C**********           Z-ADD55        DBASE                                        CAS001 204073
     C                     Z-ADD58        DBASE                                               204073
     C                     MOVEL'CAS001'  DBKEY                                               CAS001
     C                     OUT  LDA                                                           CAS001
     C                     EXSR *PSSR                                                         CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           PRTCD     IFEQ *BLANKS                                                       CAS001
     C                     MOVE 'Y'       CAS001  1                                           CAS001
     C                     ELSE                                                               CAS001
     C                     MOVE 'N'       CAS001                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CLE031
      ** Determine if Lending Enhancements                                                    CLE031
      ** (CLE031) is switched on.                                                             CLE031
      *                                                                                       CLE031
     C                     CALL 'AOSARDR0'                                                    CLE031
     C                     PARM *BLANKS   PRTCD                                               CLE031
     C                     PARM '*VERIFY 'POPTN                                               CLE031
     C                     PARM 'CLE031'  PSARD                                               CLE031
     C           SCSARD    PARM SCSARD    DSSDY                                               CLE031
      *                                                                                       CLE031
     C           PRTCD     IFNE *BLANKS                                                       CLE031
     C           PRTCD     ANDNE'*NRF   '                                                     CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE031
     C                     Z-ADD67        DBASE                                               CLE031
     C                     MOVEL'CLE031'  DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PRTCD     IFEQ *BLANKS                                                       CLE031
     C                     MOVE 'Y'       CLE031  1                                           CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'N'       CLE031                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CSD015
      ** Access SAR Details to see if COMPLIANCE WATCH ENHANCEMENT (CSD015)                   CSD015
      ** is installed.                                                                        CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSD015  1                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY 'POPTN                                               CSD015
     C                     PARM 'CSD015'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE '*NRF    '                                                    CSD015
     C           PRTCD     ANDNE*BLANKS                                                       CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD56        DBASE                                               CSD015
     C                     MOVEL'CSD015'  DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access SAR Details to see if Concord Interface Development (CCF001)                  CSD015
      ** is installed.                                                                        CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CCF001  1                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY 'POPTN                                               CSD015
     C                     PARM 'CCF001'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CCF001                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE '*NRF    '                                                    CSD015
     C           PRTCD     ANDNE*BLANKS                                                       CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD57        DBASE                                               CSD015
     C                     MOVEL'CCF001'  DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
      ** Access Compliance Watch Configuration file to get the                                CSD015
      ** Private Customer Industry Codes                                                      CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCWCDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*FIRST ' POPTN                                               CSD015
     C           SDCWCD    PARM SDCWCD    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SDCWCDPD'DBFILE                                              CSD015
     C                     Z-ADD58        DBASE                                               CSD015
     C                     MOVELPOPTN     DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if function code is being monitored by compliance watch.                       CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*KEY   ' POPTN                                               CSD015
     C                     PARM 'LENDING' PFUNC   8                                           CSD015
     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE '*NRF    '                                                    CSD015
     C           PRTCD     ANDNE*BLANKS                                                       CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SDWLCCPD'DBFILE                                              CSD015
     C                     Z-ADD59        DBASE                                               CSD015
     C                     MOVELPFUNC     DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                   CAP053
      ** Check if CLE010 (Loan Manager) is switched on:                                       207689
      *                                                                                       207689
     C                     MOVEL'CLE010'  PSARD                                               207689
     C                     CALL 'AOSARDR0'PPAR2                                               207689
     C           PRTCD     IFEQ *BLANKS                                                       207689
     C                     MOVE 'Y'       CLE010  1                                           207689
     C                     ELSE                                                               207689
     C                     MOVE 'N'       CLE010                                              207689
     C           PRTCD     IFNE '*NRF    '                                                    207689
     C           *LOCK     IN   LDA                                                           207689
     C                     MOVEL'SCSARDPD'DBFILE                                              207689
     C                     Z-ADD65        DBASE                                               207689
     C                     MOVEL'CLE010'  DBKEY                                               207689
     C                     OUT  LDA                                                           207689
     C                     EXSR *PSSR                                                         207689
     C                     ENDIF                                                              207689
     C                     ENDIF                                                              207689
      *                                                                                       207689
      ** Check system value for automatic allocation of loan numbers.                         207689
      ** Set up parameter so access object checks System Value LoanNbrAutoAllocate            207689
     C                     MOVE *BLANKS   WPARM                                               207689
     C                     MOVEL'LoanN'   WPARM1                                              207689
     C                     MOVEL'brAut'   WPARM2                                              207689
     C                     MOVEL'oAllo'   WPARM3                                              207689
     C                     MOVEL'cate'    WPARM4                                              207689
     C                     MOVELWPARM     SVALK1                                              207689
      *                                                                                       258109
      ** Check system value for Rate fixing days default                                      258109
      *                                                                                       258109
     C                     MOVE *BLANKS   WPARM                                               258109
     C                     MOVEL'RateF'   WPARM1                                              258109
     C                     MOVEL'ixing'   WPARM2                                              258109
     C                     MOVEL'DaysD'   WPARM3                                              258109
     C                     MOVEL'fault'   WPARM4                                              258109
     C                     MOVELWPARM     SVALK2                                              258109
      *                                                                                       CLE148
     C                     MOVELSVALTX,1  SVALK3                                              CLE148
      *                                                                                       258109
      * Call Access object:                                                                   207689
     C                     CALL 'AOSVALR0'                                                    207689
     C                     PARM           RTNCDE  7                                           207689
     C                     PARM           SVALK1 20                                           207689
     C                     PARM           SVAL1 200                                           207689
     C                     PARM           SVALK2 20                                           207689
     C                     PARM           SVAL2 200                                           207689
     C                     PARM           SVALK3 20                                           207689
     C                     PARM           SVAL3 200                                           207689
     C                     PARM           SVALK4 20                                           207689
     C                     PARM           SVAL4 200                                           207689
     C                     PARM           SVALK5 20                                           207689
     C                     PARM           SVAL5 200                                           207689
     C                     PARM           SVALK6 20                                           207689
     C                     PARM           SVAL6 200                                           207689
     C                     PARM           SVALK7 20                                           207689
     C                     PARM           SVAL7 200                                           207689
     C                     PARM           SVALK8 20                                           207689
     C                     PARM           SVAL8 200                                           207689
     C                     PARM           SVALK9 20                                           207689
     C                     PARM           SVAL9 200                                           207689
     C                     PARM           SVALK0 20                                           207689
     C                     PARM           SVAL10200                                           207689
      * If the system value is not found then issue a database error                          207689
     C           RTNCDE    IFNE '        '                                                    207689
     C           *LOCK     IN   LDA                                                           207689
     C                     MOVEL'SDSVALPD'DBFILE                                              207689
     C                     Z-ADD66        DBASE                                               207689
     C                     MOVEL'SVALK1'  DBKEY                                               207689
     C                     OUT  LDA                                                           207689
     C                     EXSR *PSSR                                                         207689
     C                     ELSE                                                               207689
      * Isolate the first character of SVAL1 which should contain the value Y or N.           207689
     C                     MOVELSVAL1     WRK01   1        1 character fld                    207689
     C           WRK01     IFEQ 'N'                                                           207689
     C                     MOVE 'N'       AUTOLN  1                                           207689
     C                     ELSE                                                               207689
     C                     MOVE 'Y'       AUTOLN                                              207689
     C                     ENDIF                                                              207689
      *                                                                                       258109
      ** Default Rate fixing days from SDSVALPD                                               258109
      *                                                                                       258109
     C                     MOVELSVAL2     SVRFDY  2                                           258109
     C                     MOVELSVAL3     WALLOW  1                                           CLE148
     C                     ENDIF                                                              207689
      *                                                                                       207689
      ** Determine if CAS004 is installed                                                     CAS004
      *                                                                                       CAS004
     C                     CALL 'AOSARDR0'                                                    CAS004
     C                     PARM *BLANKS   PRTCD                                               CAS004
     C                     PARM '*VERIFY 'POPTN                                               CAS004
     C                     PARM 'CAS004'  PSARD                                               CAS004
     C           SCSARD    PARM SCSARD    DSSDY                                               CAS004
      *                                                                                       CAS004
     C           PRTCD     IFNE *BLANKS                                                       CAS004
     C           PRTCD     ANDNE'*NRF   '                                                     CAS004
     C           *LOCK     IN   LDA                                                           CAS004
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS004
     C                     Z-ADD56        DBASE                                               CAS004
     C                     MOVEL'CAS004'  DBKEY                                               CAS004
     C                     OUT  LDA                                                           CAS004
     C                     EXSR *PSSR                                                         CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           PRTCD     IFEQ *BLANKS                                                       CAS004
     C                     MOVE 'Y'       CAS004  1                                           CAS004
     C                     ELSE                                                               CAS004
     C                     MOVE 'N'       CAS004                                              CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Determine if Flat Rate Personal Loan (CLE028) is installed                           CLE028
      *                                                                                       CLE028
     C                     MOVE 'CLE028'  PSARD                                               CLE028
     C                     MOVE 'N'       CLE028  1                                           CLE028
      *                                                                                       CLE028
     C                     CALL 'AOSARDR0'PPAR2                                               CLE028
     C           PRTCD     IFEQ *BLANKS                                                       CLE028
     C                     MOVE 'Y'       CLE028                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           PRTCD     IFNE '*NRF    '                                                    CLE028
     C           PRTCD     ANDNE*BLANKS                                                       CLE028
     C           *LOCK     IN   LDA                                                           CLE028
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE028
     C                     Z-ADD56        DBASE                                               CLE028
     C                     MOVEL'CLE028'  DBKEY                                               CLE028
     C                     OUT  LDA                                                           CLE028
     C                     EXSR *PSSR                                                         CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CAS005
      ** Determine if CAS005 is installed                                                     CAS005
      *                                                                                       CAS005
     C                     CALL 'AOSARDR0'                                                    CAS005
     C                     PARM *BLANKS   PRTCD                                               CAS005
     C                     PARM '*VERIFY 'POPTN                                               CAS005
     C                     PARM 'CAS005'  PSARD                                               CAS005
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS005
      *                                                                                       CAS005
     C           PRTCD     IFNE *BLANKS                                                       CAS005
     C           PRTCD     ANDNE'*NRF   '                                                     CAS005
     C           *LOCK     IN   LDA                                                           CAS005
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS005
     C                     Z-ADD64        DBASE                                               CAS005
     C                     MOVEL'CAS005'  DBKEY                                               CAS005
     C                     OUT  LDA                                                           CAS005
     C                     EXSR *PSSR                                                         CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C           PRTCD     IFEQ *BLANKS                                                       CAS005
     C                     MOVE 'Y'       CAS005  1                                           CAS005
     C                     ELSE                                                               CAS005
     C                     MOVE 'N'       CAS005                                              CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CLE028
     C/COPY WNCPYSRC,LE2030C028
      ** Set up an array of branch internal customer
      ** If branch file is empty, report db error
      *
     C           *LOVAL    SETLLSDBRCHL5
     C                     READ SDBRCHL5                 89
     C           *IN89     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRCHL5'DBFILE           ************
     C                     Z-ADD33        DBASE            * DBERR 33 *
     C                     MOVEL'*FIRST  'DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C           *IN89     DOUEQ'1'
     C                     ADD  1         S       30
     C                     MOVE A8BICN    WBIC,S
     C                     READ SDBRCHL5                 89
     C                     ENDDO
     C                     ENDIF
      *
      ** Check type of processing
      *
     C                     SELEC
     C           PTYPE     WHEQ 'PTPU'
     C           PMTYP     OREQ 'PTPU'
     C                     MOVE '1'       *IN21
     C                     MOVE '0'       *IN24
     C           PTYPE     WHEQ 'PTSO'
     C           PMTYP     OREQ 'PTSO'
     C                     MOVE '1'       *IN22
     C                     MOVE '0'       *IN24
     C                     ENDSL
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           BPGIAV    ANDEQ'Y'                                       CLE005
     C                     MOVE '1'       *IN24                           CLE005
     C                     ENDIF                                          CLE005
      *
      ** Set up message file for screen error messages
      ** Set up fields for screen heading
      *
     C                     MOVEL'LERMSGF 'ZAMSGF
     C                     MOVE USER      SUSER
     C                     MOVE WSID      SWSID
     C                     MOVE BJMRDT    SRUNA
     C                     MOVE *ALL'0'   WVAL1  14
     C                     MOVE *ALL'0'   WVAL2A 16
     C                     MOVE *ALL'0'   WVAL2B 12
     C                     MOVE *ALL'0'   WVAL3  14
      *
      ** Determine if 24x7 Midas Availability active?                     CSC011
      *                                                                   CSC011
     C                     CALL 'AOSARDR0'                                CSC011
     C                     PARM *BLANK    @RTCD                           CSC011
     C                     PARM '*VERIFY' @OPTN                           CSC011
     C                     PARM 'CSC011'  @SARD                           CSC011
     C*                                                                   CSC011
     C           @RTCD     IFEQ *BLANKS                                   CSC011
     C                     MOVE 'Y'       CSC011  1                       CSC011
     C                     ELSE                                           CSC011
     C                     MOVE 'N'       CSC011                          CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C*                                                                   CSC011
     C* Is the support system on?                                         CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     Z-ADDS1DATE    WRNDAY  60                      CSC011
     C                     ELSE                                           CSC011
     C                     MOVE BJRDNB    WRNDAY                          CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
      ** Access Switchable Feature Details (CLE033)                       CLE033
      *                                                                   CLE033
     C                     MOVE 'N'       CLE033  1                       CLE033
      *                                                                   CLE033
     C                     CALL 'AOSARDR0'                                CLE033
     C                     PARM *BLANKS   @RTCD                           CLE033
     C                     PARM '*VERIFY '@OPTN                           CLE033
     C                     PARM 'CLE033'  @SARD                           CLE033
      *                                                                   CLE033
     C           @RTCD     IFEQ *BLANKS                                   CLE033
     C                     MOVE 'Y'       CLE033                          CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE033
      ** Check if CLE034 is on                                                                CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSARDR0'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM '*VERIFY' POPTN                                               CLE034
     C                     PARM 'CLE034'  PSARD                                               CLE034
      *                                                                                       CLE034
     C           PRTCD     IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'Y'       CLE034  1                                           CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'N'       CLE034                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE038
      ** Check if CLE038 is on                                                                CLE038
      *                                                                                       CLE038
     C           CLE034    IFEQ 'Y'                                                           CLE038
     C                     CALL 'AOSARDR0'                                                    CLE038
     C                     PARM *BLANKS   PRTCD                                               CLE038
     C                     PARM '*VERIFY' POPTN                                               CLE038
     C                     PARM 'CLE038'  PSARD                                               CLE038
      *                                                                                       CLE038
     C           PRTCD     IFEQ *BLANKS                                                       CLE038
     C                     MOVE 'Y'       CLE038  1                                           CLE038
     C                     ELSE                                                               CLE038
     C                     MOVE 'N'       CLE038                                              CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE036
      ** Check if CLE036 is on                                                                CLE036
      *                                                                                       CLE036
     C                     MOVE '0'       WIN05                                               CLE036
     C                     CALL 'AOSARDR0'                                                    CLE036
     C                     PARM *BLANKS   PRTCD                                               CLE036
     C                     PARM '*VERIFY' POPTN                                               CLE036
     C                     PARM 'CLE036'  PSARD                                               CLE036
      *                                                                                       CLE036
     C           PRTCD     IFEQ *BLANKS                                                       CLE036
     C                     MOVE 'Y'       CLE036  1                                           CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE 'N'       CLE036                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                    AR1067935
      ** CLE134 - Past Due Call Loans                                                      AR1067935
      *                                                                                    AR1067935
     C                     CALL 'AOSARDR0'                                                 AR1067935
     C                     PARM *BLANKS   PRTCD   7                                        AR1067935
     C                     PARM '*VERIFY' POPTN   7                                        AR1067935
     C                     PARM 'CLE134'  PSARD   6                                        AR1067935
     C           SCSARD    PARM SCSARD    DSFDY                                            AR1067935
      *                                                                                    AR1067935
     C                     MOVE 'N'       CLE134  1                                        AR1067935
     C           PRTCD     IFEQ *BLANKS                                                    AR1067935
     C                     MOVE 'Y'       CLE134                                           AR1067935
     C                     ENDIF                                                           AR1067935
     C/COPY WNCPYSRC,LEH00515
      *                                                                                       CLE034
      ** Check mode of processing
      *
     C                     SELEC
     C           PMODE     WHEQ 'I'
     C                     OPEN LE2030DF
     C                     MOVE 'F0'      WFMT
     C           PMODE     WHEQ 'F'                                       CAP053
     C                     OPEN LEILONL1                                  CAP053
     C                     OPEN LEILONL2                                  CAP053
     C                     OPEN LEILONLX                                  CAP053
     C                     OPEN LE2030DF                                  CAP053
     C                     MOVE 'S0'      WFMT                            CAP053
     C                     MOVE UHEADF    SHEAD                           CAP053
     C                     MOVE *BLANKS   SF9INS                          CAP053
     C                     MOVE *BLANKS   SF12PR                          CAP053
     C                     MOVE *BLANKS   SACTNH                          CAP053
     C                     MOVELUACTNH    SACTNH                          CAP053
     C           PMODE     WHEQ 'R'
     C                     OPEN LE2030DF
     C                     OPEN LE2030PD
     C                     MOVE 'F0'      WFMT
     C           PMODE     WHEQ 'P'
     C                     OPEN LE2030PD
     C                     EXSR SRBTCH
     C           PMODE     WHEQ 'B'
     C/COPY WNCPYSRC,LE2030C096
     C                     OPEN LEILONPD                                  CAP053
     C/COPY WNCPYSRC,LE2030C097
     C                     MOVELPTUSR     @USER
     C**********           Z-ADD1         @ZMGRP                                              CSF002
     C**********           MOVE PTYPE     @ZICDE                                              CSF002
     C                     MOVEL'00000'   UNQCDE                                              CSF002
     C           PTYPE     IFEQ 'PTPU'                                                        CSF002
     C                     MOVE '01807'   UNQCDE                                              CSF002
     C                     ENDIF                                                              CSF002
     C           PTYPE     IFEQ 'PTSO'                                                        CSF002
     C                     MOVE '01808'   UNQCDE                                              CSF002
     C                     ENDIF                                                              CSF002
     C           PTYPE     IFEQ 'PTFT'                                                        CSF002
     C                     MOVE '01810'   UNQCDE                                              CSF002
     C                     ENDIF                                                              CSF002
     C           PTYPE     IFEQ 'LOAN'                                                        CSF002
     C                     MOVE '01806'   UNQCDE                                              CSF002
     C                     ENDIF                                                              CSF002
     C                     EXSR SRBTCH
     C                     ENDSL
      *                                                                                       CAS009
      ** Determine if SAR CAS009 is installed                                                 CAS009
      *                                                                                       CAS009
     C                     CALL 'AOSARDR0'                                                    CAS009
     C                     PARM *BLANKS   @RTCD                                               CAS009
     C                     PARM '*VERIFY '@OPTN                                               CAS009
     C                     PARM 'CAS009'  @SARD                                               CAS009
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS009
      *                                                                                       CAS009
     C           @RTCD     IFNE *BLANKS                                                       CAS009
     C           @RTCD     ANDNE'*NRF   '                                                     CAS009
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS009
     C                     Z-ADD67        DBASE                                               CAS009
     C                     MOVEL'CAS009'  DBKEY                                               CAS009
     C                     EXSR *PSSR                                                         CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           @RTCD     IFEQ *BLANKS                                                       CAS009
     C                     MOVE 'Y'       CAS009  1                                           CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE 'N'       CAS009                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       232348
      ** Access object for Hedge ICD                                                          232348
     C           CAS009    IFEQ 'Y'                                                           232348
     C                     CALL 'AOHEDGR0'                                                    232348
     C                     PARM *BLANKS   @RTCD                                               232348
     C                     PARM '*VERIFY '@OPTN                                               232348
     C           SDHEDG    PARM SDHEDG    DSFDY                                               232348
      *                                                                                       232348
     C           @RTCD     IFNE *BLANKS                                                       232348
     C           *LOCK     IN   LDA                                                           232348
     C                     MOVEL'SDHEDGPD'DBFILE                                              232348
     C                     Z-ADD68        DBASE                                               232348
     C                     MOVEL@OPTN     DBKEY                                               232348
     C                     OUT  LDA                                                           232348
     C                     EXSR *PSSR                                                         232348
     C                     ENDIF                                                              232348
     C                     ENDIF                                                              232348
     C/COPY WNCPYSRC,LE2030C087
      *
     C                     MOVE *BLANKS   WREPY3 68                                           217847
      *                                                                                       217847
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRDTL1  -  Process first detail screen                        *
      * Called by: Main routine                                       *
      * Calls    : SRDTL3 - Process third detail screen - ext sett    *
      *            SRVAL1 - Validate first detail screen              *
      *            SREXVL - Extra validation after extended sett      *
      *            SRWNDW - Window processing                         *
      *            SRWARN - Display warning message if loan is synd.  *   159256
      *****************************************************************
     C           SRDTL1    BEGSR
      *
      ** Clear error fields/indicators and warning flags
      *
     C                     EXSR CLEAR
     C                     MOVE 'D1'      WWIND   2
     C                     MOVE *BLANK    WF14    1
     C                     MOVEAWVAL1     *IN,33
     C                     MOVEA'00000'   *IN,63
     C                     MOVE '0'       *IN15                           124001
     C                     MOVE '0'       *IN31                                               208725
     C                     MOVE *BLANK    WE003
     C                     MOVE *BLANK    WE009
     C                     MOVE *BLANK    WE012
     C                     MOVE *BLANK    WE020
     C                     MOVE *BLANK    WE021
     C                     MOVE *BLANK    WE034
     C                     MOVE *BLANK    WE045
     C                     MOVE *BLANK    WE078
     C                     MOVE *BLANK    WE232                           159256
     C                     MOVE *BLANK    WE510                           134725
     C                     MOVE *BLANK    WE513                                               194864
     C                     MOVE *BLANK    WERPA                                               CLE028
     C                     MOVE *BLANK    WEMDT                                             AR740107
     C                     MOVE *BLANK    WERPD                                             AR740107
      *                                                                   CLE011
      ** Display Rollover Fixing Days if CLE011 is installed,             CLE011
      ** and initialise error indicator                                   CLE011
      *                                                                   CLE011
     C           CLE011    IFEQ 'Y'                                       CLE011
     C                     MOVEA'10'      *IN,76                          CLE011
     C                     MOVE *BLANK    WE512   1                       CLE011
     C                     ENDIF                                          CLE011
      *                                                                                       CLE031
      ** If CLE031 is on, display SFCCY and SFCPAM fields                                     CLE031
      ** and initialise error indicator.                                                      CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *ON       *IN48                                               CLE031
     C                     MOVE *OFF      *IN49                                               CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *OFF      *IN48                                               CLE031
     C                     ENDIF                                                              CLE031
     C/COPY WNCPYSRC,LE2030C037
      *                                                                   121710
      *  If a loan is reversed, display message on first screen           121710
      *                                                                   121710
     C           PMODE     IFEQ 'I'                                       121710
     C           SACTN     ANDEQ'E'                                       121710
     C           RECI      ANDEQ'R'                                       121710
     C                     MOVE *ON       *IN75                           121710
     C                     ENDIF                                          121710
      *
      ** Issue warning if loan is a syndicated loan (if called from       159256
      ** subfile processing).                                             159256
      *                                                                   159256
     C           PMODE     IFEQ 'I'                                       159256
     C           WSFIL     ANDEQ'Y'                                       159256
     C           SACTN     ANDNE'I'                                       159256
     C           SACTN     ANDNE'E'                                       159256
     C           SACTN     ANDNE'1'                                       159256
     C                     EXSR SRWARN                                    159256
     C                     ENDIF                                          159256
      *                                                                   159256
      ** Issue warning if record to be deleted is a hedged item                               CAS004
      *                                                                                       CAS004
     C           CAS004    IFEQ 'Y'                                                           CAS004
     C           SACTN     ANDEQ'R'                                                           CAS004
     C                     MOVE LNRF      KFSDLN                                              CAS004
      *                                                                                       CAS004
     C           KASHF     SETLLASHTRNLA                                                      CAS004
     C           KASHF     READEASHTRNLA                 89                                   CAS004
      *                                                                                       CAS004
     C           *IN89     DOWEQ*OFF                                                          CAS004
      *                                                                                       CAS004
     C           FSHEDI    CHAINASHGLKL1             89                                       CAS004
      *                                                                                       CAS004
     C           *IN89     IFEQ *ON                                                           CAS004
     C           *LOCK     IN   LDA                                                           CAS004
     C                     MOVEL'ASHGLKPD'DBFILE                                              CAS004
     C                     Z-ADD57        DBASE                                               CAS004
     C                     MOVELFSHEDI    DBKEY                                               CAS004
     C                     OUT  LDA                                                           CAS004
     C                     EXSR *PSSR                                                         CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           FSHTID    IFEQ 'D'                                                           CAS004
     C           FSRECI    ANDEQ'D'                                                           CAS004
     C           FSHTID    OREQ 'D'                                                           CAS004
     C           FSRECI    ANDEQ'X'                                                           CAS004
     C                     MOVE 'W'       WRMSV                                               CAS004
     C                     MOVE 'Y'       WWARN                                               CAS004
     C                     MOVE 'LEM2000' ZAMSID                                              CAS004
     C                     EXSR ZASNMS                                                        CAS004
     C                     MOVE 'E'       WRMSV                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           KASHF     READEASHTRNLA                 89                                   CAS004
     C                     ENDDO                                                              CAS004
      *                                                                                       CAS004
     C                     ENDIF                                                              CAS004
      *********************************************************************            CLE028 218531
      ***Protect*Maturity*date*if*loan*processing*type*is*80*and***********            CLE028 218531
      ***action*is*amend***************************************************            CLE028 218531
      *********************************************************************            CLE028 218531
     C**********           MOVE '0'       *IN48                                        CLE028 218531
     C********** CLE028    IFEQ 'Y'                                                    CLE028 218531
     C********** SACTN     ANDEQ'A'                                                    CLE028 218531
     C********** WPRCS1    ANDEQ'Y'                                                    CLE028 218531
     C**********           MOVE '1'       *IN48                                        CLE028 218531
     C**********           ENDIF                                                       CLE028 218531
      ** Display first screen until fields are valid or another
      ** screen is requested
      ** Do not display 'F8=Amend' if user is not authorised to Amend.    183572
      *
     C                     MOVE *IN94     WIN94   1                       123295
     C           WSCRQ     IFEQ 'Y'                                       123295
     C           WF8       ANDEQ'Y'                                       183572
     C                     MOVE '1'       *IN94                           123295
     C                     ENDIF                                          123295
     C                     WRITELE2030F0
     C                     WRITELE2030F3
     C           WFMT      DOUNE'D1'
      *                                                                   CLE011
      ** Make sure that *IN76 is only used by CLE011 In LE2030F4          CLE011
     C           CLE011    IFEQ 'Y'                                       CLE011
     C                     MOVE *ON       *IN76                           CLE011
     C                     ELSE                                           CLE011
     C                     MOVE *OFF      *IN76                           CLE011
     C                     ENDIF                                          CLE011
      *                                                                   CLE011
     C           WSFILE    IFEQ '1'                                                           208725
     C           SACTN     ANDEQ'I'                                                           208725
     C                     MOVE '0'       *IN28                                               208725
     C                     MOVE '0'       *IN30                                               208725
     C                     MOVE '0'       *IN95                                               208725
     C                     ENDIF                                                              208725
     C                     MOVE *IN98     WTEMP   1                                           208725
     C           WINIT     IFEQ '1'                                                           208725
     C                     MOVE '1'       *IN98                                               208725
     C                     ENDIF                                                              208725
      *                                                                                       CLE034
      ****e-use*indicators*01*and*02*********************                            CLE034 BUG11371
      ** Re-use indicators 02 and 03                                                        BUG11371
      *                                                                                       CLE034
     C                     MOVE *IN02     WORK02  1                                           CLE034
     C                     MOVE *IN03     WORK03  1                                           CLE034
     C                     MOVE *OFF      *IN02                                             BUG11371
     C                     MOVE *OFF      *IN03                                             BUG11371
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE *ON       *IN03                                               CLE034
     C           WVSTAL    IFNE 'N'                                                           CLE034
     C                     MOVE *OFF      *IN02                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *ON       *IN02                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *OFF      *IN03                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       208725
     C                     WRITELE2030C1
     C                     EXFMTLE2030F4
      *                                                                                       CLE034
      ** Set indicators to previous values                                                    CLE034
      *                                                                                       CLE034
     C                     MOVE WORK02    *IN02                                               CLE034
     C                     MOVE WORK03    *IN03                                               CLE034
      *
     C           WINIT     IFEQ '1'                                                           208725
     C                     MOVE WTEMP     *IN98                                               208725
     C                     ENDIF                                                              208725
      **If*rollup*has*been*pressed*save*value*of*indicator*********121737 123857
      ***********                                                  121737 123857
     C************IN89     IFEQ *ON                                121737 123857
     C***********          MOVE 1         IN89    10               121737 123857
     C***********          ELSE                                    121737 123857
     C***********          MOVE 0         IN89                     121737 123857
     C***********          ENDIF                                   121737 123857
      ***********                                                  121737 123857
     C                     MOVE *OFF      *IN75                           121710
      *                                                                   121710
     C                     SELEC
      *
      ** ... F3 is pressed, exit program
      *
     C           *INKC     WHEQ '1'
     C                     MOVE *BLANK    WFMT
      *
      ** ... F12 is pressed, display initial screen or subfile screen
      *
     C           *INKL     WHEQ '1'
     C           WSFIL     IFEQ 'Y'
     C                     MOVE 'S0'      WFMT
     C                     ELSE
     C                     MOVE 'F0'      WFMT
     C                     ENDIF
     C                     EXSR CLEAR
     C                     Z-ADD0         WOSVAM                                              194864
     C                     Z-ADD0         WOSVVD                                              194864
     C                     Z-ADD0         WOSVFX                                              194864
     C                     MOVE *BLANK    W#ACTN                          125557
     C                     MOVE *BLANK    W#F8                            125557
     C                     MOVE *BLANK    WE232                           159256
      *
      ** ... F14 is pressed, ensure that detail screen is valid
      ** before proceeding to settlement instructions
      *
     C           *INKN     WHEQ '1'
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C           SACTN     OREQ 'X'
     C                     EXSR SRVAL1
     C                     ENDIF
     C           WERRF     IFEQ *BLANK
     C           WWARN     ANDEQ*BLANK
     C                     MOVE 'Y'       WF14
     C                     MOVE 'D3'      WFMT
     C                     EXSR SRDTL3
     C           WFMT      IFNE *BLANK
     C                     MOVE 'D1'      WFMT
     C                     ENDIF
     C                     ENDIF
      *
      ** ... F11 is pressed, authorise loan
      *
     C           *INKK     WHEQ '1'
     C           SACTN     IFNE 'X'
     C                     MOVEL'LEL0407' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     EXSR SRVAL1
     C                     EXSR SRVAL2
     C                     EXSR SRVAL4
     C           WERRF     IFEQ *BLANK
     C***********          MOVE 'UP'      WFMT                            123857
     C                     MOVE 'D3'      WFMT                            123857
     C                     MOVE 'Y'       WF11                            123857
     C                     ENDIF
     C                     ENDIF
      *
      ** ... F10 is pressed, delete loan
      *
     C           *INKJ     WHEQ '1'
     C           SACTN     IFNE 'R'
     C                     MOVEL'LEL0406' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     MOVE 'UP'      WFMT
      *                                                                   189824
      *        and display window                                         189824
      *                                                                   189824
     C                     EXSR SRWNDW                                    189824
      *                                                                   189824
      *          If F3 pressed, exit                                      189824
     C           #RTRN     IFEQ 'Y2U9999'                                 189824
     C                     MOVE '1'       *INKC                           189824
     C                     MOVE *BLANK    WFMT                            189824
     C                     ENDIF                                          189824
      *          If F12 pressed, display Detail screen 1                  189824
     C           #RTRN     IFEQ 'USR0790'                                 189824
     C                     MOVE 'D1'      WFMT                            189824
     C                     ENDIF                                          189824
      *          Display message                                          189824
     C           #RTRN     IFNE *BLANKS                                   189824
     C           #RTRN     ANDNE'Y2U9999'                                 189824
     C                     MOVEL#RTRN     ZAMSID                          189824
     C                     MOVEL'WNMSGF  'ZAMSGF                          189824
     C                     EXSR ZASNMS                                    189824
     C                     MOVE 'D1'      WFMT                            189824
     C                     MOVEL'LERMSGF' ZAMSGF                          189824
     C                     ENDIF                                          189824
      *       end of window display                                       189824
      *                                                                   189824
      *                                                                   153860
     C           *IN21     IFEQ '1'                                       153860
     C                     MOVELSPFRM     WSVCN                           153860
     C                     ELSE                                           153860
     C                     MOVELSCUST     WSVCN                           153860
     C                     ENDIF                                          153860
      *                                                                   153860
     C                     ENDIF
      *                                                                   123295
      ** ... F8 is pressed, switch to amend mode                          123295
      *                                                                   123295
     C           *INKH     WHEQ '1'                                       123295
     C                     MOVE 'A'       SACTN                           123295
     C                     MOVE '1'       *IN28                           123295
     C                     MOVEA'00'      *IN,94                          123295
     C                     MOVE *BLANK    WSCRQ                           123295
     C                     WRITELE2030F3                                  123295
     C***********PCRFL     IFNE *BLANKS                            123295 125545
     C***********          MOVE '1'       *IN47                    123295 125545
     C***********          ENDIF                                   123295 125545
      *                                                                   159256
      ** Issue warning if loan is a syndicated loan (if called from       159256
      ** subfile processing with option 1).                               159256
      *                                                                   159256
     C           PMODE     IFEQ 'I'                                       159256
     C           W#F8      ANDNE'Y'                                       159256
     C                     EXSR SRWARN                                    159256
     C                     ENDIF                                          159256
     C                     MOVE 'Y'       W#F8                            125557
      *
      ** ... Enter or rollup is pressed, validate screen entries
      ** when necessary, then show next screen
      *
     C                     OTHER
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C           SACTN     OREQ 'X'
     C                     EXSR SRVAL1
     C           WDTL3     IFEQ 'Y'
     C           PMERCD    ANDEQ*BLANKS
     C                     EXSR SREXVL
     C                     ENDIF
     C                     ENDIF
      *
     C           WERRF     IFEQ *BLANK
     C           WWARN     ANDEQ*BLANK
     C           W#ACTN    IFNE *BLANK                                    125557
     C                     MOVE 'D1'      WFMT                            125557
     C                     ELSE                                           125557
     C                     MOVE 'D2'      WFMT    2
     C                     MOVE 'D1'      WWRTRN  2
     C                     ENDIF                                          125557
     C***********          EXSR SRWNDW                                    121855
     C/COPY WNCPYSRC,LE2030C111
     C                     EXSR CLEAR
     C                     MOVE '0'       *IN44
     C                     MOVEAWVAL2A    *IN,47
     C                     MOVEAWVAL2B    *IN,68
      ***********                                                  121737 123857
      ***If*enter*has*been*pressed*when*amending*update*files*and*e121737 123857
      ***********                                                  121737 123857
     C***********PMODE     IFEQ 'I'                                121737 123857
     C***********SACTN     ANDEQ'A'                                121737 123857
     C***********IN89      ANDEQ0                                  121737 123857
     C***********          EXSR SREXST                             121737 123857
     C***********          EXSR SRSETT                             121737 123857
     C***********          EXSR SRGLOC                             121737 123857
     C***********          EXSR SREXVL                             121737 123857
     C***********          MOVE 'UP'      WFMT                     121737 123857
     C***********          ENDIF                                   121737 123857
      ***********                                                  121737 123857
     C           PMODE     IFEQ 'I'                                       125557
     C           SACTN     ANDEQ'A'                                       125557
     C           W#F8      ANDEQ'Y'                                       125557
     C                     EXSR SRVAL2                                    125557
     C                     EXSR SREXST                                    125557
     C                     EXSR SRSETT                                    125557
     C                     EXSR SRGLOC                                    125557
     C                     EXSR SREXVL                                    125557
     C                     EXSR SRVAL4                                    125557
     C           WERRF     IFEQ *BLANK                                    125557
     C           WWARN     ANDEQ*BLANK                                    125557
     C                     MOVE 'UP'      WFMT                            125557
     C                     MOVE *BLANK    W#ACTN                          125557
     C                     MOVE *BLANK    W#F8                            125557
     C                     ENDIF                                          125557
     C                     ENDIF                                          125557
      *                                                                   125557
     C                     ELSE
     C                     MOVE 'D1'      WFMT
     C                     ENDIF
      *
     C                     ENDSL
     C                     ENDDO
     C                     MOVE WIN94     *IN94                           123295
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRDTL2  -  Process second detail screen                       *
      * Called by: Main routine                                       *
      * Calls    : SRDTL3 - Process third detail screen - ext sett    *
      *            SRVAL2 - Validate second detail screen             *
      *            SREXVL - Extra validation after extended sett      *
      *            SRWNDW - Window processing                         *
      *            SRWARN - Display warning message if loan is synd.  *   159256
      *****************************************************************
     C           SRDTL2    BEGSR
      *
      ** Clear error fields/indicators and warning flags
      ** Save loan customer
      *
     C***********          MOVE *OFF      *IN89                    121737 123857
     C                     MOVE 'D2'      WWIND
     C                     MOVE *BLANK    WF14
     C                     MOVE *BLANK    WE022
     C                     MOVE *BLANK    WE504                           146834
     C                     MOVE *BLANK    WE027   1                       CDE002
      *                                                                                     AR847588
      ** Save the value of *IN40 before re-using it.                                        AR847588
      *                                                                                     AR847588
     C                     MOVE *IN40     IND40   1                                         AR847588
     C                     SETOF                     40                                     AR847588
      *                                                                                     AR847588
     C           CLE005    IFEQ 'Y'
     C           CLE007    ANDEQ'Y'                                       CLE007
     C                     MOVE '1'       *IN45
     C                     ENDIF
     C           SACTN     IFEQ 'X'                                       123857
     C           BPAURV    ANDEQ'Y'                                       123857
     C                     MOVE '1'       *IN18                           123857
     C                     ELSE                                           123857
     C                     MOVE '0'       *IN18                           123857
     C                     ENDIF                                          123857
     C                     MOVE *OFF      *IN76                           CLE011
     C                     MOVE '0'       *IN77                           123857
      *                                                                                       CLE028
      ** Initialise indicators used by CLE028.                                                CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     MOVEA'10000'   *IN,35                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** Protect following fields if loan processing type is 80 and                           CLE028
      ** action is amend                                                                      CLE028
      ** Add on Interest; Add on Charges; Charge Amount; Include Charges in Interest;         CLE028
      ** Loan Currency Repayment Amount; Facility Currency Repayment Amount;                  CLE028
      ** Repayment Date; Repayment Frequency; Repayment Day Number; Payment Due Day;          CLE028
      ** and Payment Taken Day                                                                CLE028
      *                                                                                       CLE028
     C                     MOVE '0'       *IN40                                               CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           SACTN     ANDEQ'A'                                                           CLE028
     C           WPRCS2    ANDEQ'Y'                                                           CLE028
     C                     MOVE '1'       *IN40                                               CLE028
     C                     ENDIF                                                              CLE028
      *
      ** Display second screen until fields are valid or another
      ** screen is requested
      ** Do not display 'F8=Amend' if user is not authorised to Amend.    183572
      *
     C                     MOVE *IN94     WIN94   1                       123295
     C           WSCRQ     IFEQ 'Y'                                       123295
     C           WF8       ANDEQ'Y'                                       183572
     C                     MOVE '1'       *IN94                           123295
     C                     ENDIF                                          123295
     C                     WRITELE2030F3
     C           WFMT      DOUNE'D2'
     C                     WRITELE2030C1
     C/COPY WNCPYSRC,LE2030C043
     C                     MOVE *IN89     WIN89   1                                           CLE015
     C                     MOVE '0'       *IN89                                               CLE015
     C           CLE007    IFEQ 'Y'                                                           CLE015
     C           CLE006    OREQ 'Y'                                                           CLE015
     C                     MOVE '1'       *IN89                                               CLE015
     C                     ENDIF                                                              CLE015
     C                     MOVE *IN90     WIN90   1                                           219695
     C                     MOVE '0'       *IN90                                               219695
     C           CLE028    IFEQ 'Y'                                                           219695
     C           PTYP      ANDEQ80                                                            219695
     C                     MOVE '1'       *IN90                                               219695
     C                     ENDIF                                                              219695
     C                     MOVE *IN04     WIN04   1                                           CLE036
     C                     MOVE *IN05     WIN05B  1                                           CLE036
     C                     MOVE WIN05     *IN05                                               CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     MOVE '1'       *IN04                                               CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE '0'       *IN04                                               CLE036
     C                     ENDIF                                                              CLE036
     C/COPY WNCPYSRC,LE2030C136
     C                     EXFMTLE2030F5
     C                     MOVE WIN89     *IN89                                               CLE015
     C                     MOVE WIN90     *IN90                                               219695
     C                     MOVE '0'       WIN05                                               CLE036
     C                     MOVE WIN05B    *IN05                                               CLE036
     C                     MOVE WIN04     *IN04                                               CLE036
     C/COPY WNCPYSRC,LE2030C044
     C                     EXSR CLEAR                                     125557
      *                                                                   125557
     C                     MOVELSNIDT     WNUM7                           125557
     C                     MOVELWNUM7     WALF6                           125557
     C                     MOVE SNIDT     ZDATE                           125557
     C                     EXSR ZDATE1                                    125557
     C                     Z-ADDZDAYNO    W#NIDT                          125557
      *                                                                   125557
     C                     MOVELSNRPD     WNUM7                           125557
     C                     MOVELWNUM7     WALF6                           125557
     C                     MOVE SNRPD     ZDATE                           125557
     C                     EXSR ZDATE1                                    125557
     C                     Z-ADDZDAYNO    W@NRPD                          125557
      *
      **If*rollup*has*been*pressed*save*value*of*indicator*********121737 123857
      ***********                                                  121737 123857
     C************IN89     IFEQ *ON                                121737 123857
     C***********          MOVE 1         IN89                     121737 123857
     C***********          ELSE                                    121737 123857
     C***********          MOVE 0         IN89                     121737 123857
     C***********          ENDIF                                   121737 123857
      ***********                                                  121737 123857
     C                     SELEC
      *
      ** ... F3 is pressed, exit program
      *
     C           *INKC     WHEQ '1'
     C                     MOVE *BLANK    WFMT
      *
      ** ... F12 or rolldown is pressed, display first detail screen
      *
     C           *INKL     WHEQ '1'
     C           *IN88     OREQ '1'
     C           W#ACTN    IFNE *BLANK                                    125557
      *                                                                   125557
      *  Action is 2 F12 is pressed return to prev screen                 125557
      *  Roll keys taken redisplay screen                                 125557
     C           *IN88     IFEQ *OFF                                      125557
     C                     MOVE *BLANK    W#ACTN                          125557
     C                     MOVE WWRTRN    WFMT                            125557
     C                     MOVE *BLANK    W#F8                            125557
     C                     MOVE *BLANK    WE232                           159256
     C                     ELSE                                           125557
     C                     MOVE 'D2'      WFMT                            125557
     C                     ENDIF                                          125557
      *                                                                   125557
      *  Action is A and F12/Roll back is pressed                         125557
      *                                                                   125557
     C                     ELSE                                           125557
     C                     MOVE 'D1'      WFMT
     C                     MOVE *BLANK    WE232                           159256
     C                     ENDIF                                          125557
     C                     EXSR CLEAR
      *
      ** ... F14 is pressed, ensure that detail screen is valid
      ** before proceeding to settlement instructions
      *
     C           *INKN     WHEQ '1'
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C           SACTN     OREQ 'X'
     C                     EXSR SRVAL2
     C                     ENDIF
     C           WERRF     IFEQ *BLANK
     C           WWARN     ANDEQ*BLANK
     C                     MOVE 'Y'       WF14
     C                     MOVE 'D3'      WFMT
     C                     EXSR SRDTL3
     C           WFMT      IFNE *BLANK
     C                     MOVE 'D2'      WFMT
     C                     ENDIF
     C                     ENDIF
      *
      ** ... F11 is pressed, authorise loan
      *
     C           *INKK     WHEQ '1'
     C           SACTN     IFNE 'X'
     C                     MOVEL'LEL0407' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     EXSR SRVAL2
     C                     EXSR SRVAL4
     C           WERRF     IFEQ *BLANK
     C***********          MOVE 'UP'      WFMT                            123857
     C                     MOVE 'D3'      WFMT                            123857
     C                     MOVE 'Y'       WF11                            123857
     C                     ENDIF
     C                     ENDIF
      *
      ** ... F10 is pressed, delete loan
      *
     C           *INKJ     WHEQ '1'
     C           SACTN     IFNE 'R'
     C                     MOVEL'LEL0406' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     MOVE 'UP'      WFMT
      *                                                                   189824
      *        and display window                                         189824
      *                                                                   189824
     C                     EXSR SRWNDW                                    189824
      *                                                                   189824
      *          If F3 pressed, exit                                      189824
     C           #RTRN     IFEQ 'Y2U9999'                                 189824
     C                     MOVE '1'       *INKC                           189824
     C                     MOVE *BLANK    WFMT                            189824
     C                     ENDIF                                          189824
      *          If F12 pressed, display Detail screen 2                  189824
     C           #RTRN     IFEQ 'USR0790'                                 189824
     C                     MOVE 'D2'      WFMT                            189824
     C                     ENDIF                                          189824
      *          Display message                                          189824
     C           #RTRN     IFNE *BLANKS                                   189824
     C           #RTRN     ANDNE'Y2U9999'                                 189824
     C                     MOVEL#RTRN     ZAMSID                          189824
     C                     MOVEL'WNMSGF  'ZAMSGF                          189824
     C                     EXSR ZASNMS                                    189824
     C                     MOVE 'D2'      WFMT                            189824
     C                     MOVEL'LERMSGF' ZAMSGF                          189824
     C                     ENDIF                                          189824
      *       end of window display                                       189824
      *                                                                   153860
     C           *IN21     IFEQ '1'                                       153860
     C                     MOVELSPFRM     WSVCN                           153860
     C                     ELSE                                           153860
     C                     MOVELSCUST     WSVCN                           153860
     C                     ENDIF                                          153860
      *                                                                   153860
     C                     ENDIF
      *                                                                   123295
      ** ... F8 is pressed, switch to amend mode                          123295
      *                                                                   123295
     C           *INKH     WHEQ '1'                                       123295
     C                     MOVE 'A'       SACTN                           123295
     C                     MOVE '1'       *IN28                           123295
     C                     MOVEA'00'      *IN,94                          123295
     C                     MOVE *BLANK    WSCRQ                           123295
     C                     WRITELE2030F3                                  123295
     C                     EXSR SRVAL1                                    123295
     C                     MOVE '0'       *IN47                           123295
     C                     MOVE '0'       *IN89                           123295
     C           CLE005    IFEQ 'Y'                                       123295
     C                     MOVE '1'       *IN45                           123295
     C                     ENDIF                                          123295
      *                                                                   159256
      ** Issue warning if loan is a syndicated loan (if called from       159256
      ** subfile processing with option 2).                               159256
      *                                                                   159256
     C           PMODE     IFEQ 'I'                                       159256
     C           W#F8      ANDNE'Y'                                       159256
     C                     MOVE SFCUS     FCUS                            159256
     C                     MOVE SFTYP     FTYP                            159256
     C                     MOVE SFSEQ     FSEQ                            159256
     C                     EXSR SRWARN                                    159256
     C                     ENDIF                                          159256
     C                     MOVE 'Y'       W#F8                            125557
      *
      ** ... Enter or rollup is pressed, validate screen entries
      ** when necessary, then display next screen
      *
     C                     OTHER
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C           SACTN     OREQ 'X'
     C                     EXSR SRVAL2
     C           WDTL3     IFEQ 'Y'
     C           PMERCD    ANDEQ*BLANKS
     C                     EXSR SREXVL
     C                     ENDIF
     C                     ENDIF
      *
     C           WERRF     IFEQ *BLANK
     C           WWARN     ANDEQ*BLANK
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C           SACTN     OREQ 'X'
     C           WDTL3     IFEQ 'Y'
     C           WEXER     ANDEQ*BLANK
     C                     MOVE 'D4'      WFMT
     C                     ELSE
     C                     MOVE 'D3'      WFMT
     C                     ENDIF
      ***********                                                  121737 123857
      ***If*enter*has*been*pressed*when*amending*update*files*and*e121737 123857
      ***********                                                  121737 123857
     C***********PMODE     IFEQ 'I'                                121737 123857
     C***********SACTN     ANDEQ'A'                                121737 123857
     C***********IN89      ANDEQ0                                  121737 123857
     C***********          EXSR SREXST                             121737 123857
     C***********          EXSR SRSETT                             121737 123857
     C***********          EXSR SRGLOC                             121737 123857
     C***********          EXSR SREXVL                             121737 123857
     C***********          MOVE 'UP'      WFMT                     121737 123857
     C***********          ENDIF                                   121737 123857
     C           PMODE     IFEQ 'I'                                       125557
     C           SACTN     ANDEQ'A'                                       125557
     C           W#F8      ANDEQ'Y'                                       125557
     C                     EXSR SRVAL1                                    125557
     C                     EXSR SREXST                                    125557
     C                     EXSR SRSETT                                    125557
     C                     EXSR SRGLOC                                    125557
     C                     EXSR SREXVL                                    125557
     C                     EXSR SRVAL4                                    125557
     C           WERRF     IFEQ *BLANK                                    125557
     C           WWARN     ANDEQ*BLANK                                    125557
     C           *IN88     ANDEQ*OFF                                      125557
     C                     MOVE 'UP'      WFMT                            125557
     C                     MOVE *BLANK    W#ACTN                          125557
     C                     MOVE *BLANK    W#F8                            125557
     C                     ELSE                                           125557
     C                     MOVE 'D2'      WFMT                            125557
     C                     ENDIF                                          125557
     C                     ENDIF                                          125557
      *                                                                   125557
      *
     C                     ELSE
     C           W#ACTN    IFNE *BLANK                                    125557
     C                     MOVE 'D2'      WFMT                            125557
     C                     ELSE                                           125557
     C                     MOVE 'D4'      WFMT
     C                     ENDIF                                          125557
     C                     ENDIF
     C***********          EXSR CLEAR                                     125557
      *
     C           W#ACTN    IFEQ *BLANK                                    125557
     C                     MOVE 'D2'      WWRTRN
     C                     ENDIF                                          125557
     C***********          EXSR SRWNDW                                    121855
     C                     ENDIF
      *
     C                     ENDSL
     C                     ENDDO
     C                     MOVE WIN94     *IN94                           123295
      *                                                                                     AR847588
      ** Restore the original value of *IN40                                                AR847588
      *                                                                                     AR847588
     C                     MOVE IND40     *IN40                                             AR847588
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRDTL3  -  Process third detail screen - extended settlement  *
      * Called by: Main routine                                       *
      *            SRDTL1 - Process first detail screen               *
      *            SRDTL2 - Process second detail screen              *
      *            SRDTL4 - Process fourth detail screen              *
      *            SRDTL5 - Process fifth detail screen               *
      * Calls    : SREXST - Format extended settlement fields         *
      *            SRSETT - Save fields from settlement screen        *
      *            SREXVL - Extra validation after extended sett      *
      *****************************************************************
     C           SRDTL3    BEGSR
      *
      ** Clear error indicators and warning flags
      *
     C                     EXSR CLEAR
     C                     MOVE *BLANKS   WE009
     C                     MOVE *BLANKS   WE012
     C                     MOVE *BLANKS   WE034
     C                     MOVE *BLANKS   WE045
     C                     MOVE *BLANKS   WE078
     C                     MOVE *BLANKS   WEXER
     C/COPY WNCPYSRC,LE2030C014
      *
     C           WFMT      DOUNE'D3'
     C                     EXSR SREXST
     C                     MOVE *BLANKS   PMTERM
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           SLNRF     IFEQ *BLANKS                                                       CLE034
     C********** SLNRF     OREQ *ZEROS                                                 CLE034 CLE148
     C                     MOVE 'Y'       WNOKEY  1                                           CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      * If CLE038 is off, set up parameters for call to LE2230:                               CLE038
      * (If CLE038 is on, they are set up in SREXST)                                          CLE038
     C           CLE038    IFNE 'Y'                                                           CLE038
     C                     MOVE 'LOAN'    PLTYPE                                              CLE038
     C                     Z-ADD0         PALAMT                                              CLE038
     C                     MOVE *BLANKS   PORED                                               CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
     C                     CALL 'LE2230'                                                      CLE034
     C**********           PARM 'LOAN'    PLTYPE  4                                    CLE034 CLE038
     C                     PARM           PLTYPE  4                                           CLE038
     C                     PARM           SLNRF                                               CLE034
     C                     PARM *BLANKS   PLAVDT  5                                           CLE034
     C                     PARM *BLANKS   PLASEQ  3                                           CLE034
     C                     PARM *BLANKS   PCUSTF  6                                           CLE034
     C                     PARM *BLANKS   PFACIF  5                                           CLE034
     C                     PARM *BLANKS   PFEESQ  2                                           CLE034
     C                     PARM           SETLIB                                              CLE034
     C                     PARM           SETLIZ                                              CLE034
     C                     PARM           PMODE                                               CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM *BLANKS   PERROR  1                                           CLE034
     C                     PARM *BLANKS   PWARN   1                                           CLE034
     C                     PARM *BLANKS   PSTNOS  1                                           CLE034
     C                     PARM *BLANKS   PSEAMD  1                                           CLE034
     C                     PARM *BLANKS   PNODET  1                                           CLE034
     C                     PARM *BLANKS   PRSCUR 60                                           CLE034
     C                     PARM *BLANKS   PRSLOC 60                                           CLE034
     C                     PARM *BLANKS   PPSCUR 60                                           CLE034
     C                     PARM *BLANKS   PPSLOC 60                                           CLE034
     C                     PARM *BLANKS   PCRFL                                               CLE034
     C                     PARM           PORED   5                                           CLE038
     C                     PARM           PALAMT 130                                          CLE038
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
     C/COPY WNCPYSRC,LE2030C029
     C                     CALL 'SD2400'
     C                     PARM           PRTCD
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           SLNRF
     C                     PARM           @PARM3                                              222373
     C/COPY WNCPYSRC,LE2030C030
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     SELEC
      *
      ** Terminate program if database error returned
      *
     C           PMDBSE    WHNE *ZERO
     C           *LOCK     IN   LDA
     C                     MOVELPMDBFL    DBFILE           ************
     C                     Z-ADDPMDBSE    DBASE            * DBERR XX *
     C                     MOVELPMDBKY    DBKEY            ************
     C                     MOVELPMDPGM    DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
      ** F3 is pressed, exit program
      *
     C           PMCMDP    WHEQ '03'
     C                     MOVE *BLANK    WFMT
     C           PMODE     IFNE 'B'                                                           227710
     C           PMODE     ANDNE'P'                                                           227710
     C                     ROLBK                                                              227710
     C                     ENDIF                                                              227710
      *
      ** F12 is pressed, return to previous screen
      *
     C           PMCMDP    WHEQ '12'
     C                     EXSR CLEAR
      *
      ** Settlement detail not in error or F12 is pressed without
      ** validation, proceed to the next extra validations
      *
     C           PMSDTV    IFEQ 'Y'
     C           PMSDTV    OREQ 'N'
     C           PMERCD    ANDEQ*BLANKS
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           PMSDTV    ANDEQ'N'                                                           CLE034
     C           PMERCD    ANDEQ*BLANKS                                                       CLE034
     C                     MOVE 'N'       SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     EXSR SRSETT
     C           WF14      IFEQ 'Y'
     C                     MOVE WWIND     WFMT
     C                     ELSE
     C                     MOVE 'D4'      WFMT
     C                     ENDIF
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C           SACTN     OREQ 'X'
     C                     EXSR SRGLOC
     C                     EXSR SREXVL
     C                     ENDIF
      *                                                                   123857
      ** If through because of F11, update file afterwards                123857
      *                                                                   123857
     C           WF11      IFEQ 'Y'                                       123857
     C           WERRF     IFNE 'Y'                                       123857
     C           WWARN     ANDNE'Y'                                       123857
     C                     MOVE 'UP'      WFMT                            123857
     C                     ENDIF                                          123857
     C           WWARN     IFEQ 'Y'                                       123857
     C           WWARX     IFEQ 'Y'                                       123857
     C                     MOVE 'UP'      WFMT                            123857
     C                     MOVE *BLANK    WWARX   1                       123857
     C                     ELSE                                           123857
     C                     MOVE 'Y'       WWARX                           123857
     C                     ENDIF                                          123857
     C                     ENDIF                                          123857
     C                     ENDIF                                          123857
      *                                                                   123857
     C                     ELSE
     C                     MOVE 'D2'      WFMT
     C                     MOVE 'Y'       WEXER   1
     C                     ENDIF
      *
      ** Display message informing the user that errors exist in sett
      *
     C           PMERCD    IFNE *BLANKS
     C                     MOVEL'LEL0025' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     ENDSL
     C                     MOVE 'Y'       WDTL3   1
     C                     MOVE 'N'       PMFRST
     C                     MOVE *BLANK    WF11    1                       123857
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SREXST  -  Format fields for extended settlement              *
      * Called by: SRDTL3 - Process 3rd detail screen - extended sett *
      *            SR2410 - Validate extended settlement              *
      * Calls    : SRBPEX - Format ext sett fields for batch/play     *
      *            SRMFSC - Move file values to settlement screen     *
      *            SRDTSC - Move previously validated sett values     *
      *            SRINST - Initialise extended sett fields to blanks *
      *****************************************************************
     C           SREXST    BEGSR
      *
      ** Processing for first entry on the settlement screen for
      ** the record
      *
     C           WDTL3     IFEQ *BLANKS
     C                     MOVE SACTN     PMACTC
     C           SACTN     IFEQ 'R'
     C                     MOVE 'D'       PMACTC
     C                     ENDIF
     C***                  MOVE 'MMLD'    PMCPGM                   S01518 135152
     C                     MOVE 'LEND'    PMCPGM                          135152
     C                     Z-ADD0         PMDBSE
     C                     MOVE *BLANKS   PMERCD
     C                     MOVE 'Y'       PMFRST
     C                     Z-ADDBJRDNB    PMRUND
     C                     Z-ADDBJBVPD    PMBVPD
      *
      ** ... retail function flags
      *
     C           BGRTBN    IFEQ 'Y'
     C                     MOVE 'Y'       PMRETP
     C                     ENDIF
     C           BMRANR    IFEQ 'Y'
     C                     MOVE 'Y'       PMRETS
     C                     ENDIF
     C                     MOVE BMACCD    PMPCYA
      *
      ** ... pay and settlement screens will be protected on enquiry,
      ** authorisation and reversal
      *
     C           SACTN     IFEQ 'E'
     C           SACTN     OREQ 'X'
     C           SACTN     OREQ 'R'
     C                     MOVE 'Y'       PMPRCV
     C                     MOVE 'Y'       PMPPAY
     C                     EXSR SRMFSC
      *
     C                     ELSE
     C                     MOVE 'N'       PMPRCV
     C                     MOVE 'N'       PMPPAY
      *
     C           SACTN     IFEQ 'A'
     C           VDAT      IFLT BJRDNB
     C           ORED      ANDLTBJRDNB
     C           *IN22     IFEQ *ON                                       158703
     C                     MOVE 'Y'       PMPRCV                          158703
     C                     ELSE                                           158703
     C                     MOVE 'Y'       PMPPAY
     C                     ENDIF                                          158703
     C                     ENDIF
      *
      ** ... if first time on extended settlement screen, or has not
      ** no successful validation yet, load settlement details from
      ** file values, otherwise, load the validated values.
      ** For batch processing, load from transmitted data
      ** For play processing, load from test harness file
      *
     C           WDTL5     IFEQ *BLANK
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C                     EXSR SRMFSC
     C                     ELSE
     C                     EXSR SRBPEX
     C                     ENDIF
      *
     C                     ELSE
     C                     EXSR SRDTSC
     C                     ENDIF
     C                     ENDIF
      *
      ** ... for insert, initialise SD2400 parameters
      ** For batch/play processing, get from test harness file or
      ** transmitted message format
      *
     C           SACTN     IFEQ 'I'
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C                     EXSR SRINST
     C                     ELSE
     C                     EXSR SRBPEX
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *
      ** Fields to be set up on every entry to the settlement screen
      *
     C                     MOVE SLTYP     PMTTYP
     C           *IN21     IFEQ '0'                                       158057
     C                     MOVELWSVCN     PMCSNM
     C                     ELSE                                           158057
     C                     MOVELSCUST     PMCSNM                          158057
     C                     END                                            158057
     C                     MOVE SBRCA     PMBRCA
     C                     MOVE SCURR     PMRCCY
     C                     MOVE SCURR     PMPCCY
     C                     MOVE *BLANK    PMFFND
     C                     MOVE *BLANK    PMCMDP
      *
      ** ... validation only flag
      *
     C           PMFRST    IFEQ 'N'
     C                     MOVE 'Y'       PMVALO
     C                     ELSE
     C                     MOVE 'N'       PMVALO
     C                     ENDIF
      *
      ** ... processing specific for each function
      *
     C                     SELEC
     C           SACTN     WHEQ 'E'
     C           SACTN     OREQ 'X'
     C           PMODE     ANDNE'B'                                       123227
     C           PMODE     ANDNE'P'                                       123227
     C           SACTN     OREQ 'R'
     C                     MOVE 'Y'       PMSDTV
     C                     Z-ADD0         PMDTRC
     C                     Z-ADD0         PMDTPY
     C           SACTN     IFNE 'R'
     C                     MOVE 'N'       PMVALO
     C                     ENDIF
     C           SACTN     IFEQ 'X'                                                           211871
     C                     MOVE 'Y'       PMVALO                                              211871
     C                     ENDIF                                                              211871
      *
     C           SACTN     WHEQ 'I'
     C           SACTN     OREQ 'A'
     C           SACTN     OREQ 'X'                                       123227
     C           PMODE     ANDEQ'B'                                       123227
     C           SACTN     OREQ 'X'                                       123227
     C           PMODE     ANDEQ'P'                                       123227
     C           SACTN     IFEQ 'I'
     C                     MOVE *BLANKS   PMERCD
     C                     ENDIF
      *
     C                     MOVE 'N'       PMSDTV
      *
      ** ... set up date of receipt, use next interest date if valid,
      ** otherwise, use repayment date if valid
      *
     C                     Z-ADD*ZERO     PMDTRC
     C           WSVRP     IFGT WSVID
     C           WSVRD     IFGT *ZERO
     C           *IN51     ANDEQ'0'
     C           WSVID     ANDGT*ZERO
     C                     Z-ADDWSVID     PMDTRC
     C                     ENDIF
     C                     ELSE
     C           *IN71     IFEQ '0'
     C           WSVRP     ANDGT*ZERO
     C                     Z-ADDWSVRP     PMDTRC
     C                     ENDIF
     C                     ENDIF
      *
      ** ... if date receipt still zero, use maturity date if valid,
      ** otherwise, use midas rundate
      *
     C           PMDTRC    IFEQ *ZERO
     C           *IN44     IFEQ '0'
     C           WSVMD     ANDGT*ZERO
     C                     Z-ADDWSVMD     PMDTRC
     C                     ELSE
     C                     Z-ADDBJRDNB    PMDTRC
     C                     ENDIF
     C                     ENDIF
      *
      ** .. set up date of payment
      *
     C           WSVVD     IFNE *ZERO
     C                     Z-ADDWSVVD     PMDTPY
     C                     ELSE
     C                     Z-ADDBJRDNB    PMDTPY
     C                     ENDIF
     C                     ENDSL
      *                                                                   CAP053
      ** Setup fields from invalid file, if in Repair mode                CAP053
      *                                                                   CAP053
     C           PMODE     IFEQ 'F'                                       CAP053
     C                     MOVE SFRSTM    PMRSTM                          CAP053
     C                     MOVELSFRONS    PMRONS    P                     CAP053
     C                     MOVELSFROBN    PAROBN    P                     CAP053
     C                     MOVELSFROCN    PAROCN    P                     CAP053
     C                     MOVELSFRIBN    PARIBN    P                     CAP053
     C                     MOVELSFRIBA    PMRIBA    P                     CAP053
     C                     MOVE SFPSTM    PMPSTM                          CAP053
     C                     MOVELSFPONS    PMPONS    P                     CAP053
     C                     MOVELSFPOBN    PAPOBN    P                     CAP053
     C                     MOVELSFPOCN    PAPOCN    P                     CAP053
     C                     MOVELSFPIBN    PAPIBN    P                     CAP053
     C                     MOVELSFPIBA    PMPIBA    P                     CAP053
     C                     MOVELSFRCRN    PARCRN    P                     CAP053
     C                     MOVELSFRCRA    PMRCRA    P                     CAP053
     C                     MOVELSFRVNO    PARVNO    P                     CAP053
     C                     MOVELSFAWBN    PAAWBN    P                     CAP053
     C                     MOVELSFAWBA    PMAWBA    P                     CAP053
     C                     MOVELSFBENN    PABENN    P                     CAP053
     C                     MOVELSFBENA    PMBENA    P                     CAP053
     C                     MOVELSFDTP1    PMDTP1    P                     CAP053
     C                     MOVELSFDTP2    PMDTP2    P                     CAP053
     C                     MOVELSFDTP3    PMDTP3    P                     CAP053
     C                     MOVELSFDTP4    PMDTP4    P                     CAP053
     C                     MOVELSFDCHG    PMDCHG    P                     CAP053
     C                     MOVELSFBTB1    PMBTB1    P                     CAP053
     C                     MOVELSFBTB2    PMBTB2    P                     CAP053
     C                     MOVELSFBTB3    PMBTB3    P                     CAP053
     C                     MOVELSFBTB4    PMBTB4    P                     CAP053
     C                     MOVELSFBTB5    PMBTB5    P                     CAP053
     C                     MOVELSFBTB6    PMBTB6    P                     CAP053
     C                     MOVELSFCVMR    PMCVMR    P                     CAP053
      *                                                                   CAP053
      ** Set Protect receipt instructions and Protect Payment             CAP053
      ** instructions flags to be 'N'.                                    CAP053
      *                                                                   CAP053
     C                     MOVE 'N'       PMPRCV                          CAP053
     C                     MOVE 'N'       PMPPAY                          CAP053
      *                                                                                       CLE031
      ** If CLE031 is switched on, set up fields from invalid data.                           CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE SFSCCY    PMRSCY                                              CLE031
     C                     MOVE SFPSCY    PMPSCY                                              CLE031
     C                     MOVE SFREXR    PMREXR                                              CLE031
     C                     MOVE SFPEXR    PMPEXR                                              CLE031
     C                     MOVE SFREXI    PMREXI                                              CLE031
     C                     MOVE SFPEXI    PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                          CAP053
      *                                                                                       CLE038
     C           CLE038    IFEQ 'Y'                         If CLE038 = Y                     CLE038
     C           SSTAL     ANDEQ'Y'                                                           CLE038
      *                                                                                       CLE038
     C           SACTN     IFEQ 'I'                                                           CLE038
     C                     MOVE BJRDNB    PORED                                               CLE038
     C                     ELSE                                                               CLE038
     C                     MOVE ORED      PORED                                               CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
     C           WSVAM     IFNE 0                                                             CLE038
     C                     Z-ADDWSVAM     PALAMT                                              CLE038
     C                     ELSE                                                               CLE038
      *                                                                                       CLE038
      ** If the principal amount is zero, it might be because it has                          CLE038
      ** not been validated yet. So calculate it now                                          CLE038
      *                                                                                       CLE038
     C                     MOVE SCURR     PCURR                                               CLE038
     C                     CALL 'AOCURRR0'PPAR5                                               CLE038
     C           PRTCD     IFNE *BLANKS                                                       CLE038
     C           *LOCK     IN   LDA                                                           CLE038
     C                     MOVEL'SDCURRPD'DBFILE                                              CLE038
     C                     Z-ADD68        DBASE                                               CLE038
     C                     MOVELSCURR     DBKEY                                               CLE038
     C                     OUT  LDA                                                           CLE038
     C                     EXSR *PSSR                                                         CLE038
     C                     ENDIF                                                              CLE038
     C                     Z-ADDA6NBDP    WCDPL                                               CLE038
     C                     Z-ADD*ZEROS    WSVAM  130                                          CLE038
     C                     MOVE *BLANKS   PSCRF                                               CLE038
     C                     MOVE SCPAM     PSCRF                                               CLE038
     C                     Z-ADDA6NBDP    PNDEC                                               CLE038
     C           13        SUB  A6NBDP    PNDIG                                               CLE038
     C                     CALL 'ZALIGN'  PPAR1                                               CLE038
     C                     MOVE PRVAL     PALAMT                                              CLE038
     C           PALAMT    IFEQ 0                                                             CLE038
      *                                                                                       CLE038
      ** If the facility currency principal amount is zero, it might be                       CLE038
      ** because have not validated this field yet. So calculate it now                       CLE038
      *                                                                                       CLE038
     C           WFCPAM    IFEQ 0                                                             CLE038
     C                     MOVE FCCYF     PCURR                                               CLE038
     C                     CALL 'AOCURRR0'PPAR5                                               CLE038
     C           PRTCD     IFNE *BLANKS                                                       CLE038
     C           *LOCK     IN   LDA                                                           CLE038
     C                     MOVEL'SDCURRPD'DBFILE                                              CLE038
     C                     Z-ADD68        DBASE                                               CLE038
     C                     MOVELFCCYF     DBKEY                                               CLE038
     C                     OUT  LDA                                                           CLE038
     C                     EXSR *PSSR                                                         CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
     C                     Z-ADD*ZEROS    WFCPAM 130                                          CLE038
     C                     Z-ADDA6NBDP    WFCNBP                                              CLE038
     C                     MOVE *BLANKS   PSCRF                                               CLE038
     C                     MOVE SFCPAM    PSCRF                                               CLE038
     C                     Z-ADDWFCNBP    PNDEC                                               CLE038
     C           13        SUB  WFCNBP    PNDIG                                               CLE038
     C                     CALL 'ZALIGN'  PPAR1                                               CLE038
     C                     MOVE PRVAL     WFCPAM                                              CLE038
     C                     ENDIF                                                              CLE038
     C           WFCPAM    IFEQ 0                                                             CLE038
     C                     Z-ADD0         PALAMT                                              CLE038
     C                     ELSE                                                               CLE038
      ** Else, convert Facility Ccy amount into loan currency:                                CLE038
      ** First convert facility currency exchange rate to file format                         CLE038
      *                                                                                       CLE038
     C           *IN22     IFEQ *ON                                                           CLE038
     C                     Z-ADDFCXRM     ZEXCH                                               CLE038
     C                     ELSE                                                               CLE038
     C                     MOVE *BLANKS   PSCRF                                               CLE038
     C                     MOVE SFCXR     PSCRF                                               CLE038
     C                     Z-ADD8         PNDEC                                               CLE038
     C                     Z-ADD5         PNDIG                                               CLE038
     C                     CALL 'ZALIGN'  PPAR1                                               CLE038
      *                                                                                       CLE038
      ** ... move output PRVAL to ZALIGN parameter ZEXCH.                                     CLE038
      *                                                                                       CLE038
     C                     MOVE PRVAL     ZEXCH                                               CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
     C                     MOVE SCURR     ZCCYI                                               CLE038
     C                     MOVE FCCYF     ZCCYO                                               CLE038
     C                     MOVE WFCNBP    ZCDPI                                               CLE038
     C                     MOVE WCDPL     ZCDPO                                               CLE038
     C                     Z-ADDWFCPAM    ZAMTCI                                              CLE038
      *                                                                                       CLE038
     C           *IN22     IFEQ *ON                                                           CLE038
     C           FMDIM     ANDEQ'D'                                                           CLE038
     C           *IN22     OREQ *OFF                                                          CLE038
     C           SFMIN     ANDEQ'D'                                                           CLE038
     C                     MOVE 'M'       ZMD                                                 CLE038
     C                     ELSE                                                               CLE038
     C                     MOVE 'D'       ZMD                                                 CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
      ** Convert facility currency principal amount to loan amount,                           CLE038
      ** and move into PALAMT parameter for call to LE2230.                                   CLE038
      *                                                                                       CLE038
     C                     EXSR ZCONV                                                         CLE038
     C                     Z-ADDZAMTCO    PALAMT                                              CLE038
     C                     ENDIF                                                              CLE038
     C                     ENDIF                                                              CLE038
     C                     ENDIF                                                              CLE038
      * Set up Loan/Part Sold parameter for call to LE2230                                    CLE038
     C           *IN22     IFEQ *ON                                                           CLE038
     C                     MOVE 'PTSO'    PLTYPE                                              CLE038
     C                     ELSE                                                               CLE038
     C                     MOVE 'LOAN'    PLTYPE                                              CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
     C                     ENDIF                           End CLE038 = Y                     CLE038
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSETT  -  Save fields received from settlement screen        *
      * Called by: SRDTL3 - Process 3rd detail screen - extended sett *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSETT    BEGSR
      *
      ** Save fields for the core CLOAN record
      *
     C           *IN22     IFEQ '0'                                       123227
     C                     MOVE PMPSTM    WSDST   20
     C                     MOVE PMRSTM    WMDST   20
     C**********           MOVE PMPONS    WOSDA  12                                           CAS011
     C**********           MOVE PMRONS    WOMDA  12                                           CAS011
     C                     MOVE PMPONS    WOSDA  18                                           CAS011
     C                     MOVE PMRONS    WOMDA  18                                           CAS011
     C                     MOVELPAAWBN    WTSTN  10
     C                     MOVELPARIBN    WTMAN  10
     C                     MOVE PMPOBR    WOSDB   3
     C                     MOVE PMROBR    WOMDB   3
     C                     ELSE                                           123227
     C                     MOVE PMRSTM    WSDST                           123227
     C                     MOVE PMPSTM    WMDST                           123227
     C                     MOVE PMRONS    WOSDA                           123227
     C                     MOVE PMPONS    WOMDA                           123227
     C                     MOVELPARIBN    WTSTN                           123227
     C                     MOVELPAAWBN    WTMAN                           123227
     C                     MOVE PMROBR    WOSDB                           123227
     C                     MOVE PMPOBR    WOMDB                           123227
     C                     ENDIF                                          123227
     C                     MOVELPABENN    WFACO  10
      *
      ** Save field values for re-amend
      *
     C                     Z-ADDPMRSTM    WRSTM   20
     C**********           MOVE PMRONS    WRONS  12                                           CAS011
     C                     MOVE PMRONS    WRONS  18                                           CAS011
     C                     MOVE PARIBN    WRIBN   8
     C                     MOVE PMRIBA    WRIBA  35
     C**********           MOVE PAROBN    WROBN   60                                          CSD027
     C**********           MOVE PAROCN    WROCN   60                                          CSD027
     C                     MOVE PAROBN    WROBN   6                                           CSD027
     C                     MOVE PAROCN    WROCN   6                                           CSD027
     C                     Z-ADDPMPSTM    WPSTM   20
     C**********           MOVE PMPONS    WPONS  12                                           CAS011
     C                     MOVE PMPONS    WPONS  18                                           CAS011
     C                     MOVE PAPIBN    WPIBN   8
     C                     MOVE PMPIBA    WPIBA  35
     C**********           MOVE PAPOBN    WPOBN   60                                          CSD027
     C**********           MOVE PAPOCN    WPOCN   60                                          CSD027
     C                     MOVE PAPOBN    WPOBN   6                                           CSD027
     C                     MOVE PAPOCN    WPOCN   6                                           CSD027
     C                     MOVE PMCVMR    WCVMR   1
     C                     MOVE PARCRN    WRCRN   8
     C                     MOVE PMRCRA    WRCRA  35
     C                     MOVE PARVNO    WRVNO   8
     C                     MOVE PAAWBN    WAWBN   8
     C                     MOVE PMAWBA    WAWBA  35
     C                     MOVE PABENN    WBENN   8
     C                     MOVE PMBENA    WBENA  35
     C                     MOVE PMDTP1    WDTP1  35
     C                     MOVE PMDTP2    WDTP2  35
     C                     MOVE PMDTP3    WDTP3  35
     C                     MOVE PMDTP4    WDTP4  35
     C                     MOVE PMDCHG    WDCHG   3
     C                     MOVE PMBTB1    WBTB1  35
     C                     MOVE PMBTB2    WBTB2  35
     C                     MOVE PMBTB3    WBTB3  35
     C                     MOVE PMBTB4    WBTB4  35
     C                     MOVE PMBTB5    WBTB5  35
     C                     MOVE PMBTB6    WBTB6  35
     C                     MOVE PMPOBR    WSOBR   3
     C                     MOVE PMROBR    WMOBR   3
      *
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE PMRSCY    WRSCY   3                       CEU004
     C                     MOVE PMPSCY    WPSCY   3                       CEU004
     C                     MOVE PMIC72    WIC72   3                       CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
      ** If CLE031 is switched on, save new fields PF/SETLIAZ.                                CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PMREXR    WREXR  14                                           CLE031
     C                     MOVE PMREXI    WREXI   1                                           CLE031
     C                     MOVE PMPEXR    WPEXR  14                                           CLE031
     C                     MOVE PMPEXI    WPEXI   1                                           CLE031
     C                     MOVE PMRSCY    WRSCY                                               CLE031
     C                     MOVE PMPSCY    WPSCY                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRMFSC  -  Move file values to settlement screen              *
      * Called by: SREXST - Format extended settlement fields         *
      * Calls    : SRSHNM - Move customer name to shortname           *
      *****************************************************************
     C           SRMFSC    BEGSR
      *
     C                     MOVELMAINRF    CURREF
     C                     Z-ADDRSTM      PMRSTM
     C                     MOVE RONS      PMRONS
     C                     MOVE RIBN      PARIBN
     C                     MOVE RIBA      PMRIBA
     C                     MOVE *BLANKS   PAROBN
     C********** ROBN      IFNE *ZEROS                                                        CSD027
     C           ROBN      IFNE *BLANKS                                                       CSD027
     C                     MOVE ROBN      PAROBN
     C                     ENDIF
     C                     MOVE *BLANKS   PAROCN
     C********** ROCN      IFNE *ZEROS                                                        CSD027
     C           ROCN      IFNE *BLANKS                                                       CSD027
     C                     MOVE ROCN      PAROCN
     C                     ENDIF
      *
     C                     Z-ADDPSTM      PMPSTM
     C                     MOVE PONS      PMPONS
     C                     MOVE PIBN      PAPIBN
     C                     MOVE PIBA      PMPIBA
     C                     MOVE *BLANKS   PAPOBN
     C********** POBN      IFNE *ZEROS                                                        CSD027
     C           POBN      IFNE *BLANKS                                                       CSD027
     C                     MOVE POBN      PAPOBN
     C                     ENDIF
     C                     MOVE *BLANKS   PAPOCN
     C********** POCN      IFNE *ZEROS                                                        CSD027
     C           POCN      IFNE *BLANKS                                                       CSD027
     C                     MOVE POCN      PAPOCN
     C                     ENDIF
      *
     C                     MOVE CVMR      PMCVMR
     C                     MOVE RCRN      PARCRN
     C                     MOVE RCRA      PMRCRA
     C                     MOVE RVNO      PARVNO
     C                     MOVE AWBN      PAAWBN
     C                     MOVE AWBA      PMAWBA
     C                     MOVE BENN      PABENN
     C                     MOVE BENA      PMBENA
     C                     MOVE DTP1      PMDTP1
     C                     MOVE DTP2      PMDTP2
     C                     MOVE DTP3      PMDTP3
     C                     MOVE DTP4      PMDTP4
     C                     MOVE DCHG      PMDCHG
     C                     MOVE BTB1      PMBTB1
     C                     MOVE BTB2      PMBTB2
     C                     MOVE BTB3      PMBTB3
     C                     MOVE BTB4      PMBTB4
     C                     MOVE BTB5      PMBTB5
     C                     MOVE BTB6      PMBTB6
     C           *IN22     IFEQ '0'                                       123227
     C                     MOVE OSDB      PMPOBR
     C                     MOVE OMDB      PMROBR
     C                     ELSE                                           123227
     C                     MOVE OSDB      PMROBR                          123227
     C                     MOVE OMDB      PMPOBR                          123227
     C                     ENDIF                                          123227
      *
     C                     EXSR SRSHNM
      *
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE SCCY      PMRSCY                          CEU004
     C                     MOVE SCCY      PMPSCY                          CEU004
     C                     MOVE ICCY      PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
      ** If CLE031 is switched on, move file values of new fields to                          CLE031
      ** to settlement screen.                                                                CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE REXR      ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMREXR                                              CLE031
      *                                                                                       CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE PEXR      ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMPEXR                                              CLE031
      *                                                                                       CLE031
     C                     MOVE REXI      PMREXI                                              CLE031
     C                     MOVE PEXI      PMPEXI                                              CLE031
     C                     MOVE SCCY      PMRSCY                                              CLE031
     C                     MOVE PSCY      PMPSCY                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRDTSC  -  Move previously validated settlement values        *
      * Called by: SREXST - Format extended settlement fields         *
      * Calls    : SRSHNM - Move customer number to shortname         *
      *****************************************************************
     C           SRDTSC    BEGSR
      *
     C                     Z-ADDWRSTM     PMRSTM
     C                     MOVE WRONS     PMRONS
     C                     MOVE WRIBN     PARIBN
     C                     MOVE WRIBA     PMRIBA
     C********** WROBN     IFNE *ZEROS                                                        CSD027
     C           WROBN     IFNE *BLANKS                                                       CSD027
     C                     MOVE WROBN     PAROBN
     C                     ELSE
     C                     MOVE *BLANKS   PAROBN
     C                     END
     C                     MOVE *BLANKS   PAROCN
     C********** WROCN     IFNE *ZEROS                                                        CSD027
     C           WROCN     IFNE *BLANKS                                                       CSD027
     C                     MOVE WROCN     PAROCN
     C                     ENDIF
      *
     C                     Z-ADDWPSTM     PMPSTM
     C                     MOVE WPONS     PMPONS
     C                     MOVE WPIBN     PAPIBN
     C                     MOVE WPIBA     PMPIBA
     C                     MOVE *BLANKS   PAPOBN
     C********** WPOBN     IFNE *ZEROS                                                        CSD027
     C           WPOBN     IFNE *BLANKS                                                       CSD027
     C                     MOVE WPOBN     PAPOBN
     C                     ENDIF
     C                     MOVE *BLANKS   PAPOCN
     C********** WPOCN     IFNE *ZEROS                                                        CSD027
     C           WPOCN     IFNE *BLANKS                                                       CSD027
     C                     MOVE WPOCN     PAPOCN
     C                     ENDIF
      *
     C                     MOVE WCVMR     PMCVMR
     C                     MOVE WRCRN     PARCRN
     C                     MOVE WRCRA     PMRCRA
     C                     MOVE WRVNO     PARVNO
     C                     MOVE WAWBN     PAAWBN
     C                     MOVE WAWBA     PMAWBA
     C                     MOVE WBENN     PABENN
     C                     MOVE WBENA     PMBENA
     C                     MOVE WDTP1     PMDTP1
     C                     MOVE WDTP2     PMDTP2
     C                     MOVE WDTP3     PMDTP3
     C                     MOVE WDTP4     PMDTP4
     C                     MOVE WDCHG     PMDCHG
     C                     MOVE WBTB1     PMBTB1
     C                     MOVE WBTB2     PMBTB2
     C                     MOVE WBTB3     PMBTB3
     C                     MOVE WBTB4     PMBTB4
     C                     MOVE WBTB5     PMBTB5
     C                     MOVE WBTB6     PMBTB6
     C                     MOVE WSOBR     PMPOBR
     C                     MOVE WMOBR     PMROBR
      *
     C                     EXSR SRSHNM
      *
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE WRSCY     PMRSCY                          CEU004
     C                     MOVE WPSCY     PMPSCY                          CEU004
     C                     MOVE WIC72     PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
      ** If CLE031 is switched on, move back saved values to fields                           CLE031
      ** in PF/SETLIAZ.                                                                       CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE WREXR     PMREXR                                              CLE031
     C                     MOVE WREXI     PMREXI                                              CLE031
     C                     MOVE WPEXR     PMPEXR                                              CLE031
     C                     MOVE WPEXI     PMPEXI                                              CLE031
     C                     MOVE WRSCY     PMRSCY                                              CLE031
     C                     MOVE WPSCY     PMPSCY                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSHNM  -  Move customer number to its shortname counterpart  *
      * Called by: SRMFSC - Move file values to settlement screen     *
      *            SRSTSC - Move previously validated sett values     *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSHNM    BEGSR
      *
     C                     MOVE *BLANKS   PMRIBN
     C                     MOVELPARIBN    PMRIBN
     C                     MOVE *BLANKS   PMROBN
     C                     MOVELPAROBN    PMROBN
     C                     MOVE *BLANKS   PMROCN
     C                     MOVELPAROCN    PMROCN
     C                     MOVE *BLANKS   PMPIBN
     C                     MOVELPAPIBN    PMPIBN
     C                     MOVE *BLANKS   PMPOBN
     C                     MOVELPAPOBN    PMPOBN
     C                     MOVE *BLANKS   PMPOCN
     C                     MOVELPAPOCN    PMPOCN
     C                     MOVE *BLANKS   PMRCRN
     C                     MOVELPARCRN    PMRCRN
     C                     MOVE *BLANKS   PMRVNO
     C                     MOVELPARVNO    PMRVNO
     C                     MOVE *BLANKS   PMAWBN
     C                     MOVELPAAWBN    PMAWBN
     C                     MOVE *BLANKS   PMBENN
     C                     MOVELPABENN    PMBENN
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRINST  -  Initialise settlement fields on insert             *
      * Called by: SREXST - Format extended settlement fields         *
      * Calls    : None                                               *
      *****************************************************************
     C           SRINST    BEGSR
      *
     C                     Z-ADD0         PMRSTM
     C                     MOVE *BLANKS   PMRONS
     C                     MOVE *BLANKS   PARIBN
     C                     MOVE *BLANKS   PMRIBN
     C                     MOVE *BLANKS   PMRIBA
     C                     MOVE *BLANKS   PAROBN
     C                     MOVE *BLANKS   PMROBN
     C                     MOVE *BLANKS   PAROCN
     C                     MOVE *BLANKS   PMROCN
     C                     Z-ADD0         PMPSTM
     C                     MOVE *BLANKS   PMPONS
     C                     MOVE *BLANKS   PAPIBN
     C                     MOVE *BLANKS   PMPIBN
     C                     MOVE *BLANKS   PMPIBA
     C                     MOVE *BLANKS   PAPOBN
     C                     MOVE *BLANKS   PMPOBN
     C                     MOVE *BLANKS   PAPOCN
     C                     MOVE *BLANKS   PMPOCN
     C                     MOVE *BLANKS   PMCVMR
     C                     MOVE *BLANKS   PARCRN
     C                     MOVE *BLANKS   PMRCRN
     C                     MOVE *BLANKS   PMRCRA
     C                     MOVE *BLANKS   PARVNO
     C                     MOVE *BLANKS   PMRVNO
     C                     MOVE *BLANKS   PAAWBN
     C                     MOVE *BLANKS   PMAWBN
     C                     MOVE *BLANKS   PMAWBA
     C                     MOVE *BLANKS   PABENN
     C                     MOVE *BLANKS   PMBENN
     C                     MOVE *BLANKS   PMBENA
     C                     MOVE *BLANKS   PMDTP1
     C                     MOVE *BLANKS   PMDTP2
     C                     MOVE *BLANKS   PMDTP3
     C                     MOVE *BLANKS   PMDTP4
     C                     MOVE *BLANKS   PMDCHG
     C                     MOVE *BLANKS   PMBTB1
     C                     MOVE *BLANKS   PMBTB2
     C                     MOVE *BLANKS   PMBTB3
     C                     MOVE *BLANKS   PMBTB4
     C                     MOVE *BLANKS   PMBTB5
     C                     MOVE *BLANKS   PMBTB6
     C                     MOVE *BLANKS   PMPOBR
     C                     MOVE *BLANKS   PMROBR
      *
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE *BLANKS   PMRSCY                          CEU004
     C                     MOVE *BLANKS   PMPSCY                          CEU004
     C                     MOVE *BLANKS   PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
      ** If CLE031 is switched on, initialise new fields from PF/SETLIAZ.                     CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     MOVE *BLANKS   PMREXI                                              CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     MOVE *BLANKS   PMPEXI                                              CLE031
     C                     MOVE *BLANKS   PMRSCY                                              CLE031
     C                     MOVE *BLANKS   PMPSCY                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRDTL4  -  Process fourth detail screen                       *
      * Called by: Main routine                                       *
      * Calls    : SRDTL3 - Process third detail screen - ext sett    *
      *            SRVAL4 - Validate third detail screen              *
      *            SRWNDW - Window processing                         *
      *****************************************************************
     C           SRDTL4    BEGSR
      *
      ** Clear error fields/indicators and warning flags
      *
     C***********          MOVE *OFF      *IN89                    121737 123857
     C                     MOVE 'D4'      WWIND
     C                     MOVE *BLANK    WF14
     C                     MOVEA'000000'  *IN,80
     C                     MOVEAWVAL3     *IN,07
     C                     MOVEA'00'      *IN,86
     C                     MOVE *BLANK    WE006
     C                     MOVE *BLANK    WE010
     C                     MOVE *BLANK    WE015
     C                     MOVE *BLANK    WE023
     C           WFUNP     IFEQ 'Y'
     C                     MOVE '1'       *IN43
     C                     ENDIF
     C           SACTN     IFEQ 'X'                                       123857
     C           BPAURV    ANDEQ'Y'                                       123857
     C                     MOVE '1'       *IN77                           123857
     C                     MOVE '1'       *IN18                           123857
     C                     ELSE                                           123857
     C                     MOVE '0'       *IN77                           123857
     C                     ENDIF                                          123857
      *
      ** Display third screen until fields are valid or another
      ** screen is requested
      ** Do not display 'F8=Amend' if user is not authorised to Amend.    183572
      *
     C                     MOVE *IN94     WIN94   1                       123295
     C           WSCRQ     IFEQ 'Y'                                       123295
     C           WF8       ANDEQ'Y'                                       183572
     C                     MOVE '1'       *IN94                           123295
     C                     ENDIF                                          123295
     C                     WRITELE2030F3
     C                     MOVE '0'       *IN18                           123857
     C           WFMT      DOUNE'D4'
      *                                                                                       CAS001
      ** When CAS001 enhancement is installed                                                 CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
      *                                                                                       CAS001
      ***Display*Yield*Curve*and*Forward*Yield*Curve*if****************                CAS001 CAS005
      ***loan*processing*subtype*is*not*defined*as*********************                CAS001 CAS005
      ***Guarantess*Issued.*Also*do*not*display*fields*if**************                CAS001 CAS005
      ***loan*is*not*linked*to*a*base*rate.****************************                CAS001 CAS005
      ** Display Yield Curve and Forward Yield Curve if                                       CAS005
      ** loan processing subtype is not defined as                                            CAS005
      ** Guarantees Issued. Display Forward Yield Curve                                       CAS005
      ** even if loan is not linked to a base rate.                                           CAS005
      *                                                                                       CAS001
     C                     MOVE *OFF      *IN41                                               CAS001
     C                     MOVE *OFF      *IN46                                               CAS001
      *                                                                                       CAS001
     C           SACTN     IFEQ 'I'                                                           CAS001
     C           AYLNPT    IFEQ 70                                                            CAS001
     C           AYLNPT    OREQ 71                                                            CAS001
     C           AYLNPT    OREQ 72                                                            CAS001
     C                     MOVE *ON       *IN41                                               CAS001
     C                     MOVE *ON       *IN46                                               CAS001
     C**********           ELSE                                                        CAS001 CAS005
     C********** SBRTT     IFEQ '00'                                                   CAS001 CAS005
     C********** SBRTT     OREQ *BLANKS                                                CAS001 CAS005
     C**********           MOVE *ON       *IN46                                        CAS001 CAS005
     C**********           ENDIF                                                       CAS001 CAS005
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           SACTN     IFNE 'I'                                                           CAS001
     C           PTYP      IFEQ 70                                                            CAS001
     C           PTYP      OREQ 71                                                            CAS001
     C           PTYP      OREQ 72                                                            CAS001
     C                     MOVE *ON       *IN41                                               CAS001
     C                     MOVE *ON       *IN46                                               CAS001
     C**********           ELSE                                                        CAS001 CAS005
     C********** SBRTT     IFEQ '00'                                                   CAS001 CAS005
     C********** SBRTT     OREQ *BLANKS                                                CAS001 CAS005
     C**********           MOVE *ON       *IN46                                        CAS001 CAS005
     C**********           ENDIF                                                       CAS001 CAS005
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ELSE                                                               CAS001
     C                     MOVE *ON       *IN41                                               CAS001
     C                     MOVE *ON       *IN46                                               CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     WRITELE2030C1
     C                     EXFMTLE2030F6
      *
      **If*rollup*has*been*pressed*save*value*of*indicator*********121737 123857
      ***********                                                  121737 123857
     C************IN89     IFEQ *ON                                121737 123857
     C***********          MOVE 1         IN89                     121737 123857
     C***********          ELSE                                    121737 123857
     C***********          MOVE 0         IN89                     121737 123857
     C***********          ENDIF                                   121737 123857
      ***********                                                  121737 123857
     C                     SELEC
      *
      ** ... F3 is pressed, exit program
      *
     C           *INKC     WHEQ '1'
     C                     MOVE *BLANK    WFMT
      *
      ** ... F12 or rolldown is pressed, display second detail screen
      *
     C           *INKL     WHEQ '1'
     C           *IN88     OREQ '1'
     C           W#ACTN    IFNE *BLANK                                    125557
      *                                                                   125557
      *  Action is 2 F12 is pressed return to subfile, Roll back taken    125557
      *  redisplay screen2                                                125557
     C           *IN88     IFEQ *OFF                                      125557
     C                     MOVE WWRTRN    WFMT                            125557
     C                     MOVE *BLANK    W#ACTN                          125557
     C                     MOVE *BLANK    W#F8                            125557
     C                     ELSE                                           125557
     C                     MOVE 'D4'      WFMT                            125557
     C                     ENDIF                                          125557
      *                                                                   125557
      *  Action is A and F12/Roll back is pressed                         125557
      *                                                                   125557
     C                     ELSE                                           125557
     C                     MOVE 'D2'      WFMT
     C                     MOVE *BLANK    WE034
     C                     MOVE *BLANK    WE078
     C                     ENDIF                                          125557
     C                     EXSR CLEAR
      *
      ** ... F14 is pressed, ensure that detail screen is valid
      ** before proceeding to settlement instructions
      *
     C           *INKN     WHEQ '1'
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C           SACTN     OREQ 'X'
     C                     EXSR SRVAL4
     C                     ENDIF
     C           WERRF     IFEQ *BLANK
     C           WWARN     ANDEQ*BLANK
     C                     MOVE 'Y'       WF14
     C                     MOVE 'D3'      WFMT
     C                     EXSR SRDTL3
     C           WFMT      IFNE *BLANK
     C                     MOVE 'D4'      WFMT
     C                     ENDIF
     C                     ENDIF
      *
      ** ... F11 is pressed, authorise loan
      *
     C           *INKK     WHEQ '1'
     C           SACTN     IFNE 'X'
     C                     MOVEL'LEL0407' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     EXSR SRVAL4
     C           WERRF     IFEQ *BLANK
     C***********          MOVE 'UP'      WFMT                            123857
     C                     MOVE 'D3'      WFMT                            123857
     C                     MOVE 'Y'       WF11                            123857
     C                     ENDIF
     C                     ENDIF
      *
      ** ... F10 is pressed, delete loan
      *
     C           *INKJ     WHEQ '1'
     C           SACTN     IFNE 'R'
     C                     MOVEL'LEL0406' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     MOVE 'UP'      WFMT
      *                                                                   189824
      *        and display window                                         189824
      *                                                                   189824
     C                     EXSR SRWNDW                                    189824
      *                                                                   189824
      *          If F3 pressed, exit                                      189824
     C           #RTRN     IFEQ 'Y2U9999'                                 189824
     C                     MOVE '1'       *INKC                           189824
     C                     MOVE *BLANK    WFMT                            189824
     C                     ENDIF                                          189824
      *          If F12 pressed, display Detail screen 4                  189824
     C           #RTRN     IFEQ 'USR0790'                                 189824
     C                     MOVE 'D4'      WFMT                            189824
     C                     ENDIF                                          189824
      *          Display message                                          189824
     C           #RTRN     IFNE *BLANKS                                   189824
     C           #RTRN     ANDNE'Y2U9999'                                 189824
     C                     MOVEL#RTRN     ZAMSID                          189824
     C                     MOVEL'WNMSGF  'ZAMSGF                          189824
     C                     EXSR ZASNMS                                    189824
     C                     MOVE 'D4'      WFMT                            189824
     C                     MOVEL'LERMSGF' ZAMSGF                          189824
     C                     ENDIF                                          189824
      *       end of window display                                       189824
      *                                                                   153860
     C           *IN21     IFEQ '1'                                       153860
     C                     MOVELSPFRM     WSVCN                           153860
     C                     ELSE                                           153860
     C                     MOVELSCUST     WSVCN                           153860
     C                     ENDIF                                          153860
      *                                                                   153860
     C                     ENDIF
      *                                                                   123295
      ** ... F8 is pressed, switch to amend mode                          123295
      *                                                                   123295
     C           *INKH     WHEQ '1'                                       123295
     C                     MOVE 'A'       SACTN                           123295
     C                     MOVE '1'       *IN28                           123295
     C                     MOVEA'00'      *IN,94                          123295
     C                     MOVE *BLANK    WSCRQ                           123295
     C                     WRITELE2030F3                                  123295
     C                     EXSR SRVAL1                                    123295
     C                     EXSR SRVAL2                                    123295
     C                     MOVEA'00000000'*IN,80                          123295
     C                     MOVE '0'       *IN89                           123295
     C           WFUNP     IFEQ 'Y'                                       123295
     C                     MOVE '1'       *IN43                           123295
     C                     ENDIF                                          123295
     C                     MOVE 'Y'       W#F8                            125557
      *
      ** ... Enter or rollup is pressed, validate screen entries
      ** when necessary, then display next screen (settlement screen
      ** will only be automatically displayed next if not enquire
      ** nor reverse
      *
     C                     OTHER
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C           SACTN     OREQ 'X'
     C                     EXSR SRVAL4
     C                     ENDIF
     C           WERRF     IFEQ *BLANK
     C           WWARN     ANDEQ*BLANK
     C           W#ACTN    IFNE *BLANK                                    125557
     C                     MOVE 'D4'      WFMT                            125557
     C                     ELSE                                           125557
     C                     MOVE 'D5'      WFMT
     C                     MOVE 'D4'      WWRTRN
     C                     ENDIF                                          125557
     C***********          EXSR SRWNDW                                    121855
     C                     EXSR CLEAR
      ***********                                                  121737 123857
      ***If*enter*has*been*pressed*when*amending*update*files*and*e121737 123857
      ***********                                                  121737 123857
     C***********PMODE     IFEQ 'I'                                121737 123857
     C***********SACTN     ANDEQ'A'                                121737 123857
     C***********IN89      ANDEQ0                                  121737 123857
     C***********          MOVE 'UP'      WFMT                     121737 123857
     C***********          ENDIF                                   121737 123857
      ***********                                                  121737 123857
     C           PMODE     IFEQ 'I'                                       125557
     C           SACTN     ANDEQ'A'                                       125557
     C           W#F8      ANDEQ'Y'                                       125557
     C                     EXSR SRVAL1                                    125557
     C                     EXSR SRVAL2                                    125557
     C                     EXSR SREXST                                    125557
     C                     EXSR SRSETT                                    125557
     C                     EXSR SRGLOC                                    125557
     C                     EXSR SREXVL                                    125557
     C           WERRF     IFEQ *BLANK                                    125557
     C           WWARN     ANDEQ*BLANK                                    125557
     C                     MOVE 'UP'      WFMT                            125557
     C                     MOVE *BLANK    W#ACTN                          125557
     C                     MOVE *BLANK    W#F8                            125557
     C                     ENDIF                                          125557
     C                     ENDIF                                          125557
      *                                                                   125557
     C                     ENDIF
      *
     C                     ENDSL
     C                     ENDDO
     C                     MOVE WIN94     *IN94                           123295
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRDTL5  -  Process fifth detail screen                        *
      * Called by: Main routine                                       *
      * Calls    : SREXST - Format extended settlement fields         *
      *            SRWNDW - Window processing                         *
      *****************************************************************
     C           SRDTL5    BEGSR
      *
      ** Display fifth screen until fields are valid or another
      ** screen is requested
      ** Do not display 'F8=Amend' if user is not authorised to Amend.    183572
      *
     C***********          MOVE *OFF      *IN89                    121737 123857
     C                     MOVE 'D5'      WWIND
     C                     MOVE 'Y'       WDTL5   1
     C                     MOVE *BLANK    WF14
     C                     MOVE *IN94     WIN94   1                       123295
     C           WSCRQ     IFEQ 'Y'                                       123295
     C           WF8       ANDEQ'Y'                                       183572
     C                     MOVE '1'       *IN94                           123295
     C                     ENDIF                                          123295
     C           SACTN     IFEQ 'X'                                       123857
     C           BPAURV    ANDEQ'Y'                                       123857
     C                     MOVE '1'       *IN18                           123857
     C                     ENDIF                                          123857
     C                     WRITELE2030F3
     C           WFMT      DOUNE'D5'
     C                     WRITELE2030C1
     C                     EXFMTLE2030F7
     C                     EXSR CLEAR
      *
     C                     SELEC
      *
      ** ... F3 is pressed, exit program
      *
     C           *INKC     WHEQ '1'
     C                     MOVE *BLANK    WFMT
      *
      ** ... F12 or rolldown is pressed, display settlement screen
      ** for insert or amend, otherwise, display third detail screen
      *
     C           *INKL     WHEQ '1'
     C           *IN88     OREQ '1'
     C           W#ACTN    IFNE *BLANK                                    125557
      *                                                                   125557
      *  Action is 2 F12 is pressed return to subfile, Roll back taken    125557
      *  redisplay screen2                                                125557
     C           *IN88     IFEQ *OFF                                      125557
     C                     MOVE WWRTRN    WFMT                            125557
     C                     MOVE *BLANK    W#ACTN                          125557
     C                     MOVE *BLANK    W#F8                            125557
     C                     ELSE                                           125557
     C                     MOVE 'D5'      WFMT                            125557
     C                     ENDIF                                          125557
      *                                                                   125557
      *  Action is A and F12/Roll back is pressed                         125557
      *                                                                   125557
     C                     ELSE                                           125557
     C                     MOVE 'D4'      WFMT
     C                     ENDIF                                          125557
     C                     EXSR CLEAR
      *
      ** ... F14 is pressed, display settlement instructions
      *
     C           *INKN     WHEQ '1'
     C                     MOVE 'Y'       WF14
     C                     MOVE 'D3'      WFMT
     C                     EXSR SRDTL3
     C           WFMT      IFNE *BLANK
     C                     MOVE 'D5'      WFMT
     C                     ENDIF
      *
      ** ... F11 is pressed, authorise loan
      *
     C           *INKK     WHEQ '1'
     C           SACTN     IFNE 'X'
     C                     MOVEL'LEL0407' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C***********          MOVE 'UP'      WFMT                            123857
     C                     MOVE 'D3'      WFMT                            123857
     C                     MOVE 'Y'       WF11                            123857
     C                     ENDIF
      *
      ** ... F10 is pressed, delete loan
      *
     C           *INKJ     WHEQ '1'
     C           SACTN     IFNE 'R'
     C                     MOVEL'LEL0406' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     MOVE 'UP'      WFMT
      *                                                                   189824
      *        and display window                                         189824
      *                                                                   189824
     C                     EXSR SRWNDW                                    189824
      *                                                                   189824
      *          If F3 pressed, exit                                      189824
     C           #RTRN     IFEQ 'Y2U9999'                                 189824
     C                     MOVE '1'       *INKC                           189824
     C                     MOVE *BLANK    WFMT                            189824
     C                     ENDIF                                          189824
      *          If F12 pressed, display Detail screen 5                  189824
     C           #RTRN     IFEQ 'USR0790'                                 189824
     C                     MOVE 'D5'      WFMT                            189824
     C                     ENDIF                                          189824
      *          Display message                                          189824
     C           #RTRN     IFNE *BLANKS                                   189824
     C           #RTRN     ANDNE'Y2U9999'                                 189824
     C                     MOVEL#RTRN     ZAMSID                          189824
     C                     MOVEL'WNMSGF  'ZAMSGF                          189824
     C                     EXSR ZASNMS                                    189824
     C                     MOVE 'D5'      WFMT                            189824
     C                     MOVEL'LERMSGF' ZAMSGF                          189824
     C                     ENDIF                                          189824
      *       end of window display                                       189824
      *                                                                   153860
     C           *IN21     IFEQ '1'                                       153860
     C                     MOVELSPFRM     WSVCN                           153860
     C                     ELSE                                           153860
     C                     MOVELSCUST     WSVCN                           153860
     C                     ENDIF                                          153860
      *                                                                   153860
     C                     ENDIF
      *                                                                   123295
      ** ... F8 is pressed, switch to amend mode                          123295
      *                                                                   123295
     C           *INKH     WHEQ '1'                                       123295
     C                     MOVE 'A'       SACTN                           123295
     C                     MOVE '1'       *IN28                           123295
     C                     MOVEA'00'      *IN,94                          123295
     C                     MOVE *BLANK    WSCRQ                           123295
     C                     WRITELE2030F3                                  123295
     C***********          EXSR SRVAL1                             123295 125557
     C***********          EXSR SRVAL2                             123295 125557
     C***********          EXSR SRVAL4                             123295 125557
     C                     MOVE '0'       *IN89                           123295
     C                     MOVE 'Y'       W#F8                            125557
      *
      ** ... Enter is pressed, prepare for update for insert and amend,
      ** or display error message for reversal and authorisation,
      ** or return to initial screen for enquiry
      *
     C                     OTHER
     C           PMODE     IFEQ 'I'                                       125557
     C           SACTN     ANDEQ'A'                                       125557
     C           W#F8      ANDEQ'Y'                                       125557
     C                     EXSR SRVAL1                                    125557
     C                     EXSR SRVAL2                                    125557
     C                     EXSR SREXST                                    125557
     C                     EXSR SRSETT                                    125557
     C                     EXSR SRGLOC                                    125557
     C                     EXSR SREXVL                                    125557
     C                     EXSR SRVAL4                                    125557
     C                     ENDIF                                          125557
     C*                                                                   189593
     C* Get the next available loan number                                189593
     C* if action is I and SLNRF still blank                              190420
     C* and if Loan Number Auto-Allocate either = 'Y',                                        207689
     C* or = 'N' but no loan ref. was input.                                                  207689
     C*                                                                   189593
     C           SACTN     IFEQ 'I'                                       189593
     C           SLNRF     ANDEQ*BLANKS                                   190420
     C           PMODE     ANDNE'B'                                       CLE031
      *                                                                                       207689
     C           AUTOLN    IFEQ 'N'                                                           207689
     C           SALON     ANDNE*BLANK                                                        207689
     C                     MOVE SALON     SLNRF                                               207689
     C                     ELSE                                                               207689
     C                     MOVELWRANG     PRANG                           189593
     C                     MOVELPRANG     PRANGW  20                      189593
     C                     MOVE PRANG     WWRANG  2                       189593
     C           PRANGW    IFLT 10                                        189593
     C                     MOVEL' '       WWRANG                          189593
     C                     END                                            189593
     C/COPY WNCPYSRC,LE2030C115
     C                     CALL 'AOLENOU0'                                189593
     C                     PARM *BLANKS   PRTCD                           189593
     C                     PARM '*KEY'    POPTN                           189593
     C                     PARM           WWRANG                          189593
     C           SDLENO    PARM SDLENO    DSFDY                           189593
     C/COPY WNCPYSRC,LE2030C116
     C           PRTCD     IFNE *BLANKS                                   189593
     C********** *LOCK     IN   LDA                                       189593              207689
     C**********           MOVEL'SDLENOPD'DBFILE           ************   189593              207689
     C**********           Z-ADD29        DBASE            * DBERR 29 *   189593              207689
     C**********           MOVELWWRANG    DBKEY            ************   189593              207689
     C**********           OUT  LDA                                       189593              207689
     C**********           EXSR *PSSR                                     189593              207689
      * If no loan number range was found for this loan type-subtype,                         207689
      * display an error message instead of a database error.                                 207689
     C                     MOVE '1'       *IN31                                               207689
     C           CLE010    IFEQ 'N'                                                           207689
     C           AUTOLN    IFEQ 'Y'                                                           207689
     C                     MOVEL'LEL0542' ZAMSID                                              207689
     C                     ELSE                            AUTOLN = 'N'                       207689
     C                     MOVEL'LEL0543' ZAMSID                                              207689
     C                     ENDIF                                                              207689
     C                     ELSE                            CLE010 is on.                      207689
     C                     MOVEL'LEL0561' ZAMSID                                              207689
     C                     ENDIF                                                              207689
     C                     EXSR ZASNMS                                                        207689
     C                     ITER                                                               207689
     C                     ENDIF                                          189593
     C********** F9NALN    SUB  1         F9NALN                                       193890 CLE148
     C**********           MOVE F9NALN    SLNRF                                        189593 CLE148
     C**********           Z-ADDF9NALN    WNALN   60                                   189593 CLE148
     C                     MOVE F9NALA    SLNRF                                               CLE148
     C                     MOVELF9NALA    WNALN   6                                           CLE148
     C                     MOVE WNALN     SLNRF                           189593
     C/COPY WNCPYSRC,LE2030C117
     C                     END                                            189593
      *                                                                                       208725
      ** Check that loan number has not been inserted by                                      208725
      ** another workstation.                                                                 208725
      *                                                                                       208725
     C                     ELSE                                                               208725
      *                                                                                       208725
     C           SACTN     IFEQ 'I'                                                           208725
     C           SLNRF     ANDNE*BLANKS                                                       208725
      *                                                                                       208725
     C                     MOVE SLNRF     WALON                                               208725
     C                     MOVE 'A'       WEPAR                                               208725
     C           WKLON     CHAINCLOAN               N89                                       208725
     C           *IN89     IFEQ '0'                                                           208725
     C                     MOVEL'LEL0563' ZAMSID                                              208725
     C                     EXSR ZASNMS                                                        208725
     C                     ENDIF                                                              208725
      *                                                                                       208725
     C                     ENDIF                                                              208725
      *                                                                                       207689
     C                     ENDIF                                                              207689
      *                                                                                       207689
     C*                                                                   189593
     C/COPY WNCPYSRC,LE2030C112
     C                     EXSR SRWNDW
     C/COPY WNCPYSRC,LE2030C113
     C           #RTRN     IFEQ *BLANK                                    123857
     C                     SELEC
     C           SACTN     WHEQ 'X'
     C********** BPAURV    IFEQ 'N'                                                    123857 197084
     C           BPAURV    IFNE 'Y'                                                           197084
     C                     MOVEL'LEL0030' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE                                           123857
     C                     MOVE 'UP'      WFMT                            123857
     C                     ENDIF                                          123857
     C           SACTN     WHEQ 'R'
     C                     MOVEL'LEL0031' ZAMSID
     C                     EXSR ZASNMS
     C           SACTN     WHEQ 'I'
     C           WERRF     IFEQ *BLANK                                                        208725
     C           WWARN     ANDEQ*BLANK                                                        208725
     C                     MOVE 'WR'      WFMT
     C                     ELSE                                                               208725
     C                     MOVE 'D5'      WFMT                                                208725
     C                     ENDIF                                                              208725
     C           SACTN     WHEQ 'A'
     C           W#ACTN    IFNE *BLANK                                    125557
     C           WERRF     IFEQ *BLANK                                    125557
     C           WWARN     ANDEQ*BLANK                                    125557
     C                     MOVE 'UP'      WFMT                            125557
     C                     MOVE *BLANK    W#ACTN                          125557
     C                     MOVE *BLANK    W#F8                            125557
     C                     ELSE                                           125557
     C                     MOVE 'D5'      WFMT                            125557
     C                     ENDIF                                          125557
     C                     ELSE                                           125557
     C                     MOVE 'UP'      WFMT
     C                     ENDIF                                          125557
     C                     OTHER
     C                     MOVE 'F0'      WFMT
     C                     ENDSL
     C                     ENDIF                                          123857
      *
     C                     ENDSL
     C                     ENDDO
     C                     MOVE WIN94     *IN94                           123295
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRWNDW  -  Window processing subroutine                       *
      * Called by: SRDTL1 - Process first detail screen               *
      *            SRDTL2 - Process second detail screen              *
      *            SRDTL3 - Process third detail screen               *
      *            SRDTL5 - Process fifth detail screen               *
      * Calls    : None                                               *
      *****************************************************************
     C           SRWNDW    BEGSR
      *
     C/COPY WNCPYSRC,LE2030MOV1
      *
      **  Call window manager WN0010
      *
     C                     CALL 'WN0010'
     C                     PARM 'LE2030'  #PGM   10
     C                     PARM           KEY     2
     C                     PARM SACTN     ACTION  1
     C                     PARM           DATA
     C                     PARM *BLANK    #RTRN   7
     C                     PARM           SPARE 256
      *
      ** Process return code
      *
     C/COPY WNCPYSRC,LE2030C016
     C                     SELEC
     C           #RTRN     WHEQ 'Y2U9999'
     C                     MOVE *BLANK    WFMT
     C           #RTRN     WHEQ 'USR0790'
     C                     MOVE WWIND     WFMT
     C           #RTRN     WHNE *BLANKS
     C                     MOVEL#RTRN     ZAMSID
     C***********          MOVEL'WNMSGF'  ZAMSGF                          122052
     C                     MOVEL'WNMSGF  'ZAMSGF                          122052
     C                     EXSR ZASNMS
     C                     MOVEL'LERMSGF' ZAMSGF
     C                     ENDSL
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRBTCH  -  Batch processing (without screen displays)         *
      * Called by: Main routine                                       *
      * Calls    : SRPLSC - Format screen fields for play mode        *
      *            SRBTSC - Format screen fields for batch mode       *
      *            SRBERR - Format batch error details                *
      *            SRCAUT - Check if user is authorised to the action *
      *            SRAUTH - Validate authorisation action             *
      *            SRREVR - Validate reversal action                  *
      *            SRVAL1 - Validate first detail screen              *
      *            SRVAL2 - Validate second detail screen             *
      *            SRVAL4 - Validate fourth detail screen             *
      *            SRSHDW - Update shadow files                       *
      *****************************************************************
     C           SRBTCH    BEGSR
      *
      ** If in PLAY mode, read LE2030PD
      *
     C                     MOVE 'E'       WRMSV   1
     C                     MOVE '0'       *IN89
     C           PMODE     IFEQ 'P'
     C                     READ LE2030PD                 89
     C                     ENDIF
      *
     C           *IN89     DOWEQ'0'
     C           PMODE     IFEQ 'P'
     C                     MOVE ACTN      SACTN
     C                     MOVE LNRFH     SLNRF
     C                     ELSE
     C                     MOVE PTACT     SACTN
     C                     MOVE PLNRF     SLNRF
     C                     ENDIF
      *
      ** Action code must be 'I', 'A', 'R' or 'X' only
      *
     C           SACTN     IFNE 'I'
     C           SACTN     ANDNE'A'
     C           SACTN     ANDNE'X'
     C           SACTN     ANDNE'R'
     C                     MOVEL'LEL0400' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** If not insert, loan must exist in file
      *
     C           SACTN     IFNE 'I'
      *
     C                     MOVE 'A'       WEPAR
     C                     MOVE SLNRF     WALON
     C           WKLON     CHAINCLOAN               N89
     C           *IN89     IFEQ '0'
     C                     MOVE 'B'       WEPAR
     C                     MOVE CCY       W#CCY                           125258
     C                     MOVE FCCY      W#FCY                           125258
     C                     MOVE FCRA      W@FCRA                          125258
     C                     MOVE RAMT      W@RAMT                          125258
     C           WKLON     CHAINCLOAN               N89
     C                     ENDIF
     C           *IN89     IFEQ '1'
     C                     MOVEL'LEL0024' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                                    AR1021136
      ** Do not allow amending loan with reference '000000'.                               AR1021136
      *                                                                                    AR1021136
     C           *IN89     IFEQ '0'                                                        AR1021136
     C           SLNRF     ANDEQ'000000'                                                   AR1021136
     C           SACTN     ANDEQ'A'                                                        AR1021136
     C           RECI      ANDEQ'D'                                                        AR1021136
     C                     MOVEL'5045917' ZAMSID                                           AR1021136
     C                     EXSR ZASNMS                                                     AR1021136
     C                     ENDIF                                                           AR1021136
      *                                                                                    AR1021136
     C/COPY WNCPYSRC,LE2030C092
      *
      ** If insert, loan reference must be left blank
      *
     C                     ELSE
     C********** SLNRF     IFNE *BLANKS                                                       257126
     C********** *IN21     ANDEQ'0'                                                    256730 257126
     C********** *IN22     ANDEQ'0'                                                    256730 257126
     C**********           MOVEL'LEL0401' ZAMSID                                              257126
     C**********           EXSR ZASNMS                                                        257126
     C**********           ENDIF                                                              257126
      *                                                                                       257126
      ** VALIDATE LOAN NUMBER                                                                 257126
      ** For insert, loan number must be left blank if system                                 257126
      ** value is set to 'Y' to auto-allocate loan numbers.                                   257126
      *                                                                                       257126
     C           AUTOLN    IFEQ 'Y'                                                           257126
     C           SACTN     IFEQ 'I'                                                           257126
     C           SALON     ANDNE*BLANKS                                                       257126
     C           SACTN     OREQ 'I'                                                           257126
     C           SLNRF     ANDNE*BLANKS                                                       257126
     C                     MOVEA'11'      *IN,30                                              257126
     C           CLE010    IFEQ 'Y'                                                           257126
     C                     MOVEL'LEL0401' ZAMSID                                              257126
     C                     ELSE                                                               257126
     C                     MOVEL'LEL0541' ZAMSID                                              257126
     C                     ENDIF                                                              257126
     C                     EXSR ZASNMS                                                        257126
     C                     ENDIF                                                              257126
      *                                                                                       257126
      * Else, system value allows user to input a loan number manually                        257126
     C                     ELSE                                                               257126
     C           SACTN     IFEQ 'I'                                                           257126
     C           SLNRF     ANDNE*BLANKS                                                       257126
      *                                                                                       257126
      * Check that loan number is between 000001 and 999998 inclusive                         257126
      * *                                                                                     257126
     C           WALLOW    IFEQ 'Y'                                                           CLE148
      *                                                                                       CLE148
     C                     MOVEL'LELOAN'  WCHR10                                              CLE148
     C                     MOVE 'ISO '    WCHR10                                              CLE148
     C                     CALL WCHR10                                                        CLE148
     C                     PARM SLNRF     PLNRF                                               CLE148
     C                     PARM *BLANKS   PVALID                                              CLE148
     C                     PARM *BLANK    PCHKD                                               CLE148
     C                     PARM *BLANKS   PDATA                                               CLE148
      *                                                                                       CLE148
     C           PVALID    IFNE *BLANKS                                                       CLE148
     C                     MOVEA'11'      *IN,30                                              CLE148
     C                     MOVEL'LEL0822' ZAMSID                                              CLE148
     C                     MOVELPDATA     ZAMSDA                                              CLE148
     C                     EXSR ZASNMS                                                        CLE148
     C                     ENDIF                                                              CLE148
      *                                                                                    AR1021136
     C           PVALID    IFEQ *BLANKS                                                    AR1021136
     C           SLNRF     IFEQ '000000'                                                   AR1021136
     C           SLNRF     OREQ '999999'                                                   AR1021136
     C                     MOVEA'11'      *IN,30                                           AR1021136
     C                     MOVEL'5045916' ZAMSID                                           AR1021136
     C                     EXSR ZASNMS                                                     AR1021136
     C                     ENDIF                                                           AR1021136
     C                     ENDIF                                                           AR1021136
      *                                                                                       CLE148
     C                     ELSE                                                               CLE148
      *                                                                                       CLE148
     C                     MOVELSLNRF     WNUM7                                               257126
     C                     MOVELWNUM7     WALF6                                               257126
     C           SLNRF     IFNE WALF6                                                         257126
     C           SLNRF     OREQ '      '                                                      257126
     C           SLNRF     OREQ '000000'                                                      257126
     C           SLNRF     ORGE '999999'                                                      257126
     C                     MOVEA'11'      *IN,30                                              257126
     C                     MOVEL'LEL0540' ZAMSID                                              257126
     C                     EXSR ZASNMS                                                        257126
     C                     ENDIF                                                              257126
      *                                                                                       CLE148
     C                     ENDIF                                                              CLE148
      *                                                                                       257126
      * Check that loan number has not already been used.                                     257126
      * First check for existence in live loans file:                                         257126
      *                                                                                       257126
     C                     MOVE SLNRF     WALON                                               257126
     C                     MOVE 'A'       WEPAR                                               257126
     C           WKLON     CHAINCLOAN               N89                                       257126
     C           *IN89     IFEQ '0'                                                           257126
     C                     MOVE '1'       *IN,31                                              257126
     C                     MOVEL'LEL0539' ZAMSID                                              257126
     C                     EXSR ZASNMS                                                        257126
     C                     ENDIF                                                              257126
      *                                                                                       257126
      * Then check for existence in matured loan file:                                        257126
      *                                                                                       257126
     C**********           MOVE SLNRF     MLLNRF  60                                   257126 CLE148
     C                     MOVE SLNRF     MLLNRF  6                                           CLE148
     C                     MOVE 'A'       MLRCDT  1                                           257126
     C           MLKEY     CHAINMLOAN               N89                                       257126
     C           *IN89     IFEQ '0'                                                           257126
     C                     MOVE '1'       *IN,31                                              257126
     C                     MOVEL'LEL0539' ZAMSID                                              257126
     C                     EXSR ZASNMS                                                        257126
     C                     ENDIF                                                              257126
      *                                                                                       257126
     C                     ENDIF                                                              257126
     C                     ENDIF                                                              257126
      *                                                                                       257126
     C                     ENDIF
      *
      ** Format screen details from test harness file (when in play
      ** mode) or from transmitted message (when in batch mode)
      *
     C           SACTN     IFEQ 'X'
     C           SACTN     OREQ 'R'
     C                     EXSR SROTFM
     C                     ELSE
     C           PMODE     IFEQ 'P'
     C                     EXSR SRPLSC
     C                     ELSE
      *                                                                   CAP053
      ** If action code is 'Amend' for Batch transaction, compare         CAP053
      ** Non-Amendable fields with value from file. If different          CAP053
      ** replace with value from file & flag as error.                    CAP053
     C           SACTN     IFEQ 'A'                                       CAP053
     C********** PRPLC     ANDEQ'B'                                                    CAP053 257126
     C           CAP053    ANDEQ'Y'                                       CAP053
      *                                                                   CAP053
      ** Move file fields to screen fields                                CAP053
     C                     EXSR SROTFM                                    CAP053
      *                                                                   CAP053
      ** Save Non-Amendable screen fields to work fields to be            CAP053
      ** used later for compare.                                          CAP053
     C                     EXSR SRSCWK                                    CAP053
      *                                                                   CAP053
      ** Clear screen fields                                              CAP053
     C                     EXSR SRINFM                                    CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
     C                     EXSR SRBTSC
      *                                                                   CAP053
      ** Compare values of Incoming fields with those of saved values     CAP053
     C           SACTN     IFEQ 'A'                                       CAP053
     C********** PRPLC     ANDEQ'B'                                                    CAP053 257126
     C           CAP053    ANDEQ'Y'                                       CAP053
     C                     EXSR SRCOMP                                    CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
     C                     ENDIF
     C                     ENDIF
      *
      ** Check user authority
      *
     C                     EXSR SRCAUT
      *
      ** Validate authorisation and reversal requests
      *
     C           SACTN     CASEQ'X'       SRAUTH
     C           SACTN     CASEQ'R'       SRREVR
     C                     ENDCS
      *
      ** Validate detail screens
      *
     C                     EXSR SRVAL1
     C                     EXSR SRVAL2
     C                     EXSR SR2410
     C                     EXSR SRVAL4
     C/COPY WNCPYSRC,LE2030C098
      *
      ** If no error encountered, update files
      *
     C           WERRF     IFEQ *BLANK
     C           SACTN     IFEQ 'I'
     C                     EXSR SRINSR
     C                     ELSE
     C                     EXSR SRUPDR
     C                     ENDIF
     C***********          EXSR SRSHDW                                                        217270
     C                     EXSR SRSHDW                                                        222709
     C                     ENDIF
      *
     C           SACTN     IFEQ 'I'
     C                     MOVE *BLANK    PRMSV
     C                     MOVE *BLANKS   PRMID
     C                     MOVE *BLANKS   PRMTX
     C                     MOVE SLNRF     PRLON
     C           PMODE     IFEQ 'P'
     C                     MOVELPRMSV     RMSV
     C                     MOVELZAMSID    RMID
     C                     MOVELZAMSTX    RMTX
     C***********          UPDATLE2030D0               89                 157761
     C                     UPDATLE2030D0                                  157761
     C                     ENDIF
     C                     ENDIF
      *
      ** If in batch mode, terminate processing
      ** Otherwise, read next LE2030PD record
      *
     C           PMODE     IFEQ 'B'
     C                     MOVE SLNRF     PRLON                           125029
     C                     LEAVE
     C                     ELSE
     C                     READ LE2030PD                 89
     C                     ENDIF
      *
     C                     ENDDO
      *                                                                   CDE001
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           CDE001    IFEQ 'Y'                                       CDE001
     C           PGNTF     ANDNE'Y'                                       CDE001
     C                     MOVELSLNRF     T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C                     PARM           T#TREF 20                       CDE001
     C                     PARM 'LOAN'    T#TCAT  4                       CDE001
     C                     PARM           RSRVID 10                                           CDE005
     C                     ENDIF                                          CDE001
      *
      ** Commit changes if not generated by principal transfer
      *
     C           PGNTF     IFNE 'Y'
     C           PMODE     ANDNE'B'                                       120002
     C                     COMIT
     C                     ENDIF
     C                     MOVE *BLANK    WFMT
      *
     C                     ENDSR
      /EJECT
      *****************************************************************   CAP053
      * SRSCWK  -  Save screen fields to work fields                  *   CAP053
      * Called by: SRBTCH - Batch processing                          *   CAP053
      *****************************************************************   CAP053
     C           SRSCWK    BEGSR                                          CAP053
      *                                                                   CAP053
     C                     MOVE SLNRF     ISLNRF                          CAP053
     C                     MOVE SCUST     ISCUST                          CAP053
     C                     MOVE SFCUS     ISFCUS                          CAP053
     C                     MOVE SFTYP     ISFTYP                          CAP053
     C                     MOVE SFSEQ     ISFSEQ                          CAP053
     C                     MOVE SBRCA     ISBRCA                          CAP053
     C                     MOVE SLTYP     ISLTYP                          CAP053
     C                     MOVE SSUTP     ISSUTP                          CAP053
     C                     MOVE SOLNO     ISOLNO                          CAP053
     C                     MOVE SPFRM     ISPFRM                          CAP053
     C                     MOVE SMLNR     ISMLNR                          CAP053
     C                     MOVE SCURR     ISCURR                          CAP053
     C                     MOVE SCPAM     ISCPAM                          CAP053
     C                     MOVE SDDAT     ISDDAT                          CAP053
     C                     MOVE SAUTO     ISAUTO                          CAP053
     C                     MOVE SVDAT     ISVDAT                          CAP053
     C                     MOVE SRCSI     ISRCSI                          CAP053
     C                     MOVE SMDAT     ISMDAT                          CAP053
     C                     MOVE SAPMI     ISAPMI                          CAP053
     C                     MOVE SMCRA     ISMCRA                          CAP053
     C                     MOVE SRLDT     ISRLDT                          CAP053
     C                     MOVE SRLFQ     ISRLFQ                          CAP053
     C                     MOVE SRLDY     ISRLDY                          CAP053
     C                     MOVE SDFTP     ISDFTP                          CAP053
     C                     MOVE SDFST     ISDFST                          CAP053
     C                     MOVE SLNKS     ISLNKS                          CAP053
     C                     MOVE SPTFC     ISPTFC                          CAP053
     C                     MOVE SPTFN     ISPTFN                          CAP053
     C                     MOVE SPTFT     ISPTFT                          CAP053
     C                     MOVE SASSN     ISASSN                          CAP053
      *                                                                   CAP053
     C                     MOVE SBRTT     ISBRTT                          CAP053
     C                     MOVE SCHIN     ISCHIN                          CAP053
     C                     MOVE SRTSP     ISRTSP                          CAP053
     C                     MOVE SSPIN     ISSPIN                          CAP053
     C                     MOVE SNIDT     ISNIDT                          CAP053
     C                     MOVE SIPFR     ISIPFR                          CAP053
     C                     MOVE SIFDY     ISIFDY                          CAP053
     C                     MOVE SCALC     ISCALC                          CAP053
     C                     MOVE SIPRD     ISIPRD                          CAP053
     C                     MOVE SMARG     ISMARG                          CAP053
     C                     MOVE SNEGV     ISNEGV                          CAP053
     C                     MOVE SWTRT     ISWTRT                          CAP053
     C                     MOVE SWTIN     ISWTIN                          CAP053
     C                     MOVE SINTC     ISINTC                          CAP053
     C                     MOVE SRDFC     ISRDFC                          CAP053
     C                     MOVE SADDI     ISADDI                          CAP053
     C                     MOVE SREPT     ISREPT                          CAP053
     C                     MOVE SRAMT     ISRAMT                          CAP053
     C                     MOVE SFCRA     ISFCRA                          CAP053
     C                     MOVE SNRPD     ISNRPD                          CAP053
     C                     MOVE SRFRQ     ISRFRQ                          CAP053
     C                     MOVE SRDYN     ISRDYN                          CAP053
     C                     MOVE SBTIN     ISBTIN                          CAP053
     C                     MOVE SBLDY     ISBLDY                          CAP053
     C                     MOVE SPDDI     ISPDDI                          CAP053
     C                     MOVE SGDIN     ISGDIN                          CAP053
     C                     MOVE SGDPR     ISGDPR                          CAP053
     C                     MOVE SPTDI     ISPTDI                          CAP053
      *                                                                   CAP053
     C                     MOVE SACOF     ISACOF                          CAP053
     C                     MOVE SLIND     ISLIND                          CAP053
     C                     MOVE SFEEI     ISFEEI                          CAP053
     C                     MOVE SORBR     ISORBR                          CAP053
     C                     MOVE SCRSK     ISCRSK                          CAP053
     C                     MOVE SDOCI     ISDOCI                          CAP053
     C                     MOVE SBOKC     ISBOKC                          CAP053
     C                     MOVE SFRBC     ISFRBC                          CAP053
     C                     MOVE SSECI     ISSECI                          CAP053
     C                     MOVE SACSQ     ISACSQ                          CAP053
     C                     MOVE SPTFR     ISPTFR                          CAP053
     C                     MOVE SNACD     ISNACD                          CAP053
     C                     MOVE SPRFC     ISPRFC                          CAP053
     C                     MOVE SNAR1     ISNAR1                          CAP053
     C                     MOVE SBCXR     ISBCXR                          CAP053
     C                     MOVE SBMIN     ISBMIN                          CAP053
     C                     MOVE SNAR2     ISNAR2                          CAP053
     C                     MOVE SNAR3     ISNAR3                          CAP053
     C                     MOVE SFCXR     ISFCXR                          CAP053
     C                     MOVE SFMIN     ISFMIN                          CAP053
     C                     MOVE SNAR4     ISNAR4                          CAP053
     C                     MOVE SRECE     ISRECE                          CAP053
     C                     MOVE SCOCU     ISCOCU                          CAP053
     C                     MOVE SFRSP     ISFRSP                          CAP053
     C                     MOVE SOMDT     ISOMDT                          CAP053
     C                     MOVE SFSGN     ISFSGN                          CAP053
     C                     MOVE SFPRC     ISFPRC                          CAP053
      *                                                                   CAP053
     C                     MOVE SSPI1     ISSPI1                          CAP053
     C                     MOVE SSPI2     ISSPI2                          CAP053
     C                     MOVE SSPI3     ISSPI3                          CAP053
      *                                                                   CAP053
      ** When CAS001 enhancement is installed                                                 CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVE #6YLDC    WYLDC   5                                           CAS001
     C                     MOVE #6FYLD    WFYLD   5                                           CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CLE028
      ** Setup Add on Interest, Add on Charges,                                               CLE028
      ** Charge Amount, and Include Charges in Interest                                       CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     MOVE SADIF     ISADIF                                              CLE028
     C                     MOVE SADCF     ISADCF                                              CLE028
     C                     MOVE SICIF     ISICIF                                              CLE028
     C                     MOVE SCHGA     ISCHGA                                              CLE028
     C                     ENDIF                                                              CLE028
      ** If CLE031 is switched on, also save new fields from PF/LEILONPD.                     CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE SFSCCY    ISSCCY                                              CLE031
     C                     MOVE SFREXR    ISREXR                                              CLE031
     C                     MOVE SFREXI    ISREXI                                              CLE031
     C                     MOVE SFPSCY    ISPSCY                                              CLE031
     C                     MOVE SFPEXR    ISPEXR                                              CLE031
     C                     MOVE SFPEXI    ISPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE SFSTAL    ISSTAL                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CAS001
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     MOVE SFBASR    ISBASR                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     ENDSR                                          CAP053
      /EJECT                                                              CAP053
      *****************************************************************   CAP053
      * SRCOMP  -  Compare values of Incoming fields with those of    *   CAP053
      *            saved values. If they are different replace with   *   CAP053
      *            value of file and flag as error.                   *   CAP053
      * Called by: SRBTCH - Batch processing                          *   CAP053
      *****************************************************************   CAP053
     C           SRCOMP    BEGSR                                          CAP053
      *                                                                   CAP053
      ** Set protect indicators and error Flag to 'N'                     CAP053
     C                     MOVE 'N'       WERRA   1                       CAP053
      *                                                                   CAP053
     C           CLE005    IFEQ 'Y'                                       CAP053
     C           CLE007    ANDEQ'Y'                                       CAP053
     C                     MOVE *ON       *IN45                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
     C           *IN21     IFEQ *ON                                       CAP053
     C           *IN22     OREQ *ON                                       CAP053
     C                     MOVE *ON       *IN23                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
     C           BGMBIN    IFEQ 'Y'                                       CAP053
     C                     MOVE *ON       *IN06                           CAP053
     C                     ENDIF                                          CAP053
     C           BKOBRU    IFEQ 'Y'                                       CAP053
     C                     MOVE *ON       *IN02                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
     C           BKPRCU    IFEQ 'N'                                       CAP053
     C                     MOVE *ON       *IN03                           CAP053
     C                     ENDIF                                          CAP053
     C           BKPRCU    IFEQ 'N'                                       CAP053
     C           BKPRCA    OREQ 'N'                                       CAP053
     C                     MOVE *ON       *IN04                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Loan Number                                                                  257126
     C           SLNRF     IFNE ISLNRF                                                        257126
     C                     MOVE ISLNRF    SLNRF                                               257126
     C                     MOVE 'Y'       WERRA                                               257126
     C                     ENDIF                                                              257126
      *                                                                                       257126
     C           SCUST     IFNE ISCUST                                                        257126
     C*          SFCUS     ANDNE*BLANKS                                                       257126
     C                     MOVE ISCUST    SCUST                                               257126
     C                     MOVE 'Y'       WERRA                                               257126
     C                     ENDIF                                                              257126
      *                                                                                       257126
      ** Compare Facility reference                                       CAP053
     C           SFCUS     IFNE ISFCUS                                    CAP053
     C                     MOVE ISFCUS    SFCUS                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Facility type                                            CAP053
     C           SFTYP     IFNE ISFTYP                                    CAP053
     C                     MOVE ISFTYP    SFTYP                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Facility sequence                                        CAP053
     C           SFSEQ     IFNE ISFSEQ                                    CAP053
     C                     MOVE ISFSEQ    SFSEQ                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Branch                                                   CAP053
     C           SBRCA     IFNE ISBRCA                                    CAP053
     C                     MOVE ISBRCA    SBRCA                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Loan type                                                CAP053
     C           SLTYP     IFNE ISLTYP                                    CAP053
     C                     MOVE ISLTYP    SLTYP                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Loan Sub type                                            CAP053
     C           SSUTP     IFNE ISSUTP                                    CAP053
     C                     MOVE ISSUTP    SSUTP                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Sale of loan                                             CAP053
     C           SOLNO     IFNE ISOLNO                                    CAP053
     C                     MOVE ISOLNO    SOLNO                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Purchased from                                           CAP053
     C           SPFRM     IFNE ISPFRM                                    CAP053
     C                     MOVE ISPFRM    SPFRM                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Mirror loan number                                       CAP053
     C           SMLNR     IFNE ISMLNR                                    CAP053
     C                     MOVE ISMLNR    SMLNR                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Currency                                                 CAP053
     C           SCURR     IFNE ISCURR                                    CAP053
     C                     MOVE ISCURR    SCURR                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Amount                                                   CAP053
     C           SCPAM     IFNE ISCPAM                                    CAP053
     C                     MOVE ISCPAM    SCPAM                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Deal Date                                                CAP053
     C           SDDAT     IFNE ISDDAT                                    CAP053
     C                     MOVE ISDDAT    SDDAT                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Start Date                                               CAP053
     C           SVDAT     IFNE ISVDAT                                    CAP053
     C                     MOVE ISVDAT    SVDAT                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Recourse indicator                                       CAP053
     C           SRCSI     IFNE ISRCSI                                    CAP053
     C                     MOVE ISRCSI    SRCSI                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Auto payment at maturity                                 CAP053
     C           *IN01     IFEQ *OFF                                      CAP053
     C           SAPMI     ANDNEISAPMI                                    CAP053
     C                     MOVE ISAPMI    SAPMI                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Rollover date                                            CAP053
     C           SRLDT     IFNE ISRLDT                                    CAP053
     C                     MOVE ISRLDT    SRLDT                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Rollover frequency                                       CAP053
     C           SRLFQ     IFNE ISRLFQ                                    CAP053
     C                     MOVE ISRLFQ    SRLFQ                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Rollover day number                                      CAP053
     C           SRLDY     IFNE ISRLDY                                    CAP053
     C                     MOVE ISRLDY    SRLDY                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Default participation loan type                          CAP053
     C           *IN22     IFEQ *ON                                       CAP053
     C           SDFTP     ANDNEISDFTP                                    CAP053
     C                     MOVE ISDFTP    SDFTP                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Default participation loan sub type                      CAP053
     C           *IN22     IFEQ *ON                                       CAP053
     C           SDFST     ANDNEISDFST                                    CAP053
     C                     MOVE ISDFST    SDFST                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Linked to syndicate                                      CAP053
     C           *IN21     IFEQ *OFF                                      CAP053
     C           *IN22     ANDEQ*OFF                                      CAP053
     C           SLNKS     ANDNEISLNKS                                    CAP053
     C                     MOVE ISLNKS    SLNKS                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Assignment                                               CAP053
     C           *IN21     IFEQ *OFF                                      CAP053
     C           SASSN     ANDNEISASSN                                    CAP053
     C                     MOVE ISASSN    SASSN                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Base rate                                                CAP053
     C           SBRTT     IFNE ISBRTT                                    CAP053
     C                     MOVE ISBRTT    SBRTT                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Base rate change indicator                               CAP053
     C           SCHIN     IFNE ISCHIN                                    CAP053
     C                     MOVE ISCHIN    SCHIN                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                                       CLE036
      ** Compare Base Rate                                                                    CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C           SBASR     IFNE ISBASR                                                        CLE036
     C                     MOVE ISBASR    SBASR                                               CLE036
     C                     MOVE 'Y'       WERRA                                               CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                   CAP053
      ** Compare Spread rate                                              CAP053
     C           SRTSP     IFNE ISRTSP                                    CAP053
     C                     MOVE ISRTSP    SRTSP                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Spread indicator                                         CAP053
     C           SSPIN     IFNE ISSPIN                                    CAP053
     C                     MOVE ISSPIN    SSPIN                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Interest basis                                           CAP053
     C           SCALC     IFNE ISCALC                                    CAP053
     C                     MOVE ISCALC    SCALC                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Interest                                                 CAP053
     C           SIPRD     IFNE ISIPRD                                    CAP053
     C                     MOVE ISIPRD    SIPRD                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Tax indicator                                            CAP053
     C           SWTIN     IFNE ISWTIN                                    CAP053
     C                     MOVE ISWTIN    SWTIN                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Capitalisation                                           CAP053
     C           SINTC     IFNE ISINTC                                    CAP053
     C                     MOVE ISINTC    SINTC                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Round-down                                               CAP053
     C           SRDFC     IFNE ISRDFC                                    CAP053
     C                     MOVE ISRDFC    SRDFC                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Accrual                                                  CAP053
     C           SADDI     IFNE ISADDI                                    CAP053
     C                     MOVE ISADDI    SADDI                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                                       CLE028
      ** When CLE028 is installed                                                             CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
      *                                                                                       CLE028
      ** Compare Add on Interest                                                              CLE028
     C           SADIF     IFNE ISADIF                                                        CLE028
     C                     MOVE ISADIF    SADIF                                               CLE028
     C                     MOVE 'Y'       WERRA                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** Compare Add on Charges                                                               CLE028
     C           SADCF     IFNE ISADCF                                                        CLE028
     C                     MOVE ISADCF    SADCF                                               CLE028
     C                     MOVE 'Y'       WERRA                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** Compare Charge Amount                                                                CLE028
     C           SCHGA     IFNE ISCHGA                                                        CLE028
     C                     MOVE ISCHGA    SCHGA                                               CLE028
     C                     MOVE 'Y'       WERRA                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** Compare Include Charges in Interest                                                  CLE028
     C           SICIF     IFNE ISICIF                                                        CLE028
     C                     MOVE ISICIF    SICIF                                               CLE028
     C                     MOVE 'Y'       WERRA                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
      *                                                                   CAP053
      ** Compare Repayment type                                           CAP053
     C           SREPT     IFNE ISREPT                                    CAP053
     C                     MOVE ISREPT    SREPT                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Facility currency repayment amount                       CAP053
     C           *IN25     IFEQ *OFF                                      CAP053
     C           CLE007    ANDEQ'N'                                                           CLE015
     C           SFCRA     ANDNEISFCRA                                    CAP053
     C                     MOVE ISFCRA    SFCRA                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Bill/Telex                                               CAP053
     C           *IN22     IFEQ *ON                                       CAP053
     C           SBTIN     ANDNEISBTIN                                    CAP053
     C                     MOVE ISBTIN    SBTIN                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Billing days                                             CAP053
     C           *IN22     IFEQ *ON                                       CAP053
     C           SBLDY     ANDNEISBLDY                                    CAP053
     C                     MOVE ISBLDY    SBLDY                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Payment due day                                          CAP053
     C           *IN45     IFEQ *OFF                                      CAP053
     C           SPDDI     ANDNEISPDDI                                    CAP053
     C                     MOVE ISPDDI    SPDDI                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Interest                                                 CAP053
     C           *IN45     IFEQ *OFF                                      CAP053
     C           SGDIN     ANDNEISGDIN                                    CAP053
     C                     MOVE ISGDIN    SGDIN                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Principal                                                CAP053
     C           *IN45     IFEQ *OFF                                      CAP053
     C           SGDPR     ANDNEISGDPR                                    CAP053
     C                     MOVE ISGDPR    SGDPR                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Payment taken day                                        CAP053
     C           *IN45     IFEQ *OFF                                      CAP053
     C           SPTDI     ANDNEISPTDI                                    CAP053
     C                     MOVE ISPTDI    SPTDI                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Industry                                                 CAP053
     C           *IN22     IFEQ *ON                                       CAP053
     C           SLIND     ANDNEISLIND                                    CAP053
     C                     MOVE ISLIND    SLIND                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Originating branch                                       CAP053
     C           *IN22     IFEQ *ON                                       CAP053
     C           *IN02     OREQ *OFF                                      CAP053
     C           *IN06     OREQ *OFF                                      CAP053
     C           SORBR     IFNE ISORBR                                    CAP053
     C                     MOVE ISORBR    SORBR                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Country of risk                                          CAP053
     C           *IN22     IFEQ *ON                                       CAP053
     C           SCRSK     ANDNEISCRSK                                    CAP053
     C                     MOVE ISCRSK    SCRSK                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare A/C seq no                                               CAP053
     C           SACSQ     IFNE ISACSQ                                    CAP053
     C                     MOVE ISACSQ    SACSQ                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Portfolio                                                CAP053
     C           *IN23     IFEQ *ON                                       CAP053
     C           *IN05     OREQ *OFF                                      CAP053
     C           SPTFR     IFNE ISPTFR                                    CAP053
     C                     MOVE ISPTFR    SPTFR                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Booking profit centre                                    CAP053
     C           *IN22     IFEQ *ON                                       CAP053
     C           *IN03     OREQ *ON                                       CAP053
     C           *IN04     OREQ *ON                                       CAP053
     C           SPRFC     IFNE ISPRFC                                    CAP053
     C                     MOVE ISPRFC    SPRFC                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
     C                     ENDIF                                          CAP053
      *                                                                                       CAS001
      ** When CAS001 enhancment is installed, compare yield curve and                         CAS001
      ** forward yield curve                                                                  CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C           *IN41     IFEQ *ON                                                           CAS001
     C           #6YLDC    ANDNEWYLDC                                                         CAS001
     C                     MOVE WYLDC     #6YLDC                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           *IN46     IFEQ *ON                                                           CAS001
     C           #6FYLD    ANDNEWFYLD                                                         CAS001
     C                     MOVE WFYLD     #6FYLD                                              CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                   CAP053
      ** Compare Base ccy                                                 CAP053
     C           SBCXR     IFNE ISBCXR                                    CAP053
     C                     MOVE ISBCXR    SBCXR                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Base ccy indicator                                       CAP053
     C           SBMIN     IFNE ISBMIN                                    CAP053
     C                     MOVE ISBMIN    SBMIN                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Facility ex                                              CAP053
     C           SFCXR     IFNE ISFCXR                                    CAP053
     C                     MOVE ISFCXR    SFCXR                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Facility indicator                                       CAP053
     C           SFMIN     IFNE ISFMIN                                    CAP053
     C                     MOVE ISFMIN    SFMIN                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Guarantee receiver                                       CAP053
     C           *IN24     IFEQ *OFF                                      CAP053
     C           SRECE     ANDNEISRECE                                    CAP053
     C                     MOVE ISRECE    SRECE                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
      ** Compare Customer confirmation                                    CAP053
     C           *IN01     IFEQ *OFF                                      CAP053
     C           SCOCU     ANDNEISCOCU                                    CAP053
     C                     MOVE ISCOCU    SCOCU                           CAP053
     C                     MOVE 'Y'       WERRA                           CAP053
     C                     ENDIF                                          CAP053
      *                                                                                       257126
     C           PMODE     IFEQ 'B'                                                           257126
     C                     MOVE ' '       WERRA                                               257126
     C                     ENDIF                                                              257126
      *                                                                   CAP053
      ** If Error set-up error message & write details to Invalid file    CAP053
     C           WERRA     IFEQ 'Y'                                       CAP053
     C                     MOVEL'LEA1043' ZAMSID                          CAP053
     C                     EXSR ZASNMS                                    CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
     C                     ENDSR                                          CAP053
      /EJECT                                                              CAP053
      *****************************************************************
      * SRVAL1  -  Validate first detail screen                       *
      * Called by: SRDTL1 - Process first detail screen               *
      *            SRBTCH - Batch processing                          *
      * Calls    : SRFEQV - Get facility currency equivalent          *
      *            SRMATY - Further validation on maturity date       *
      *            SRSOLD - Further validation for parts sold         *
      *            SRFEXP - Update exposure and availability array    *
      *****************************************************************
     C           SRVAL1    BEGSR
      *                                                                   122485
      * Retrieve previous settings for ACEI when amending a loan          122485
      *                                                                   122485
     C           SACTN     IFEQ 'A'                                       122485
     C                     MOVE ACEI      WACEI                           122485
     C                     ENDIF                                          122485
      *
     C                     MOVEAWVAL1     *IN,33
     C                     MOVEA'00000'   *IN,63
     C                     MOVEA'0'       *IN,29
     C                     MOVE '0'       *IN15                           124001
     C                     MOVE '0'       *IN31                                               208725
      *                                                                                       CLE031
      ** If CLE031 is on, initialise error indicator for facility                             CLE031
      ** currency principal amount. Also for validation flag.                                 CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *OFF      *IN49                                               CLE031
     C                     MOVE *OFF      WVALFC  1                                           CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     EXSR CLEAR
     C                     MOVE 'E'       WRMSV
     C***********SACTN     IFEQ 'A'                                       125545
     C***********PCRFL     ANDNE*BLANKS                                   125545
     C***********          MOVE '1'       *IN47                           125545
     C***********          ENDIF                                          125545
     C                     MOVE *BLANK    WCPRTR  1
     C                     MOVE *BLANK    WAGENT  6
     C**********           Z-ADD0         WCPMFC  60                                          CSD027
     C                     MOVE *BLANKS   WCPMFC  6                                           CSD027
     C                     Z-ADD0         WCPMFT  30
     C                     Z-ADD0         WCPMFN  20
      *                                                                                       208725
      ** VALIDATE LOAN NUMBER                                                                 208725
      ** For insert, loan number must be left blank if system                                 208725
      ** value is set to 'Y' to auto-allocate loan numbers.                                   208725
      *                                                                                       208725
     C           AUTOLN    IFEQ 'Y'                                                           208725
     C           SACTN     IFEQ 'I'                                                           208725
     C           SALON     ANDNE*BLANKS                                                       208725
     C           SACTN     OREQ 'I'                                                           208725
     C           SLNRF     ANDNE*BLANKS                                                       208725
     C                     MOVEA'11'      *IN,30                                              208725
     C           CLE010    IFEQ 'Y'                                                           208725
     C                     MOVEL'LEL0401' ZAMSID                                              208725
     C                     ELSE                                                               208725
     C                     MOVEL'LEL0541' ZAMSID                                              208725
     C                     ENDIF                                                              208725
     C                     EXSR ZASNMS                                                        208725
     C                     ENDIF                                                              208725
      *                                                                                       208725
      * Else, system value allows user to input a loan number manually                        208725
     C                     ELSE                                                               208725
     C           SACTN     IFEQ 'I'                                                           208725
     C           SLNRF     ANDNE*BLANKS                                                       208725
      *                                                                                       208725
      * Check that loan number is between 000001 and 999998 inclusive                         208725
      *                                                                                       208725
     C           WALLOW    IFEQ 'Y'                                                           CLE148
      *                                                                                       CLE148
     C                     MOVEL'LELOAN'  WCHR10                                              CLE148
     C                     MOVE 'ISO '    WCHR10                                              CLE148
     C                     CALL WCHR10                                                        CLE148
     C                     PARM SLNRF     PLNRF                                               CLE148
     C                     PARM *BLANKS   PVALID                                              CLE148
     C                     PARM *BLANK    PCHKD                                               CLE148
     C                     PARM *BLANKS   PDATA                                               CLE148
      *                                                                                       CLE148
     C           PVALID    IFNE *BLANKS                                                       CLE148
     C                     MOVEA'11'      *IN,30                                              CLE148
     C                     MOVEL'LEL0822' ZAMSID                                              CLE148
     C                     MOVELPDATA     ZAMSDA                                              CLE148
     C                     EXSR ZASNMS                                                        CLE148
     C                     ENDIF                                                              CLE148
      *                                                                                    AR1021136
     C           PVALID    IFEQ *BLANKS                                                    AR1021136
     C           SLNRF     IFEQ '000000'                                                   AR1021136
     C           SLNRF     OREQ '999999'                                                   AR1021136
     C                     MOVEA'11'      *IN,30                                           AR1021136
     C                     MOVEL'5045916' ZAMSID                                           AR1021136
     C                     EXSR ZASNMS                                                     AR1021136
     C                     ENDIF                                                           AR1021136
     C                     ENDIF                                                           AR1021136
      *                                                                                       CLE148
     C                     ELSE                                                               CLE148
      *                                                                                       CLE148
     C                     MOVELSLNRF     WNUM7                                               208725
     C                     MOVELWNUM7     WALF6                                               208725
     C           SLNRF     IFNE WALF6                                                         208725
     C           SLNRF     OREQ '      '                                                      208725
     C           SLNRF     OREQ '000000'                                                      208725
     C           SLNRF     ORGE '999999'                                                      208725
     C                     MOVEA'11'      *IN,30                                              208725
     C                     MOVEL'LEL0540' ZAMSID                                              208725
     C                     EXSR ZASNMS                                                        208725
     C                     ENDIF                                                              208725
      *                                                                                       CLE148
     C                     ENDIF                                                              CLE148
      *                                                                                       208725
      * Check that loan number has not already been used.                                     208725
      * First check for existence in live loans file:                                         208725
      *                                                                                       208725
     C                     MOVE SLNRF     WALON                                               208725
     C                     MOVE 'A'       WEPAR                                               208725
     C           WKLON     CHAINCLOAN               N89                                       208725
     C           *IN89     IFEQ '0'                                                           208725
     C                     MOVE '1'       *IN,31                                              208725
     C                     MOVEL'LEL0539' ZAMSID                                              208725
     C                     EXSR ZASNMS                                                        208725
     C                     ENDIF                                                              208725
      *                                                                                       208725
      * Then check for existence in matured loan file:                                        208725
      *                                                                                       208725
     C**********           MOVE SLNRF     MLLNRF  60                                   208725 CLE148
     C                     MOVE SLNRF     MLLNRF  6                                           CLE148
     C                     MOVE 'A'       MLRCDT  1                                           208725
     C           MLKEY     CHAINMLOAN               N89                                       208725
     C           *IN89     IFEQ '0'                                                           208725
     C                     MOVE '1'       *IN,31                                              208725
     C                     MOVEL'LEL0539' ZAMSID                                              208725
     C                     EXSR ZASNMS                                                        208725
     C                     ENDIF                                                              208725
      *                                                                                       208725
     C                     ENDIF                                                              208725
     C                     ENDIF                                                              208725
      *
      ** VALIDATE CUSTOMER/ORIGINAL BORROWER
      *
     C           SCUST     IFEQ *BLANKS
     C                     MOVE '1'       *IN33
     C                     MOVEL'LEL0178' ZAMSID
     C                     EXSR ZASNMS
      *
      ** ... must be a valid customer
      *
     C                     ELSE
     C                     MOVE SCUST     PCUST
     C                     CALL 'AOCUSTR0'PPAR3
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN33
     C                     MOVEL'LEL0034' ZAMSID
     C                     EXSR ZASNMS
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SCUST
     C                     ENDIF
     C                     ELSE
     C/COPY WNCPYSRC,LE2030C108
      *
      ** ... must not be a parent
      *
     C           *IN21     IFEQ '0'
     C                     MOVE BBCUST    WSVCN   6
     C                     ENDIF
     C                     MOVE *BLANKS   SCUST
     C                     MOVELBBCUST    SCUST
     C                     MOVE BBLICD    WLIND   3
     C           BBPAIN    IFEQ 'P'
     C                     MOVE '1'       *IN33
     C                     MOVEL'LEL0036' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CGL058
      ** Check if defaulting is to apply                                                      CGL058
      *                                                                                       CGL058
     C           CGL058    IFEQ 'Y'                                                           CGL058
     C           BGMBIN    ANDEQ'Y'                                                           CGL058
     C           SACTN     ANDEQ'I'                                                           CGL058
     C           *IN33     ANDEQ*OFF                                                          CGL058
      *                                                                                       CGL058
      ** Only default if booking/originating branch not entered                               CGL058
      *                                                                                       CGL058
     C           SBRCA     IFEQ *BLANK                                                        CGL058
     C           BKOBRU    OREQ 'Y'                                                           CGL058
     C           SORBR     ANDEQ*BLANK                                                        CGL058
      *                                                                                       CGL058
      ** Default booking branch if not enterd                                                 CGL058
      *                                                                                       CGL058
     C           SBRCA     IFEQ *BLANK                                                        CGL058
     C                     MOVE BBBRCD    SBRCA                                               CGL058
     C                     ENDIF                                                              CGL058
      *                                                                                       CGL058
      ** Default originatong branch if not enterd                                             CGL058
      *                                                                                       CGL058
     C           BKOBRU    IFEQ 'Y'                                                           CGL058
     C           SORBR     ANDEQ*BLANK                                                        CGL058
     C                     MOVE BBBRCD    SORBR                                               CGL058
     C                     ENDIF                                                              CGL058
      *                                                                                       CGL058
     C                     ENDIF                                                              CGL058
      *                                                                                       CGL058
     C                     ENDIF                                                              CGL058
      *                                                                                       CGL058
     C/COPY WNCPYSRC,LE2030C046
      *
      ** VALIDATE FACILITY (for loans and parts purchased)
      ** ... default to customer if blank
      *
     C           *IN22     IFEQ '0'
      *
     C                     DO
     C           SFCUS     IFEQ *BLANKS
     C***        *IN21     IFEQ '0'                                       134804
     C                     MOVELSCUST     SFCUS
     C***                  ELSE                                           134804
     C***********          MOVELSOLNO     SFCUS                           125184
     C           *IN21     IFEQ '1'                                       134804
     C                     MOVE *BLANKS   PCUST                           125184
     C                     MOVELSPFRM     PCUST                           125184
     C                     CALL 'AOCUSTR0'PPAR3                           125184
     C           PRTCD     IFEQ '*NOSEL  '                                125184
     C                     MOVE *BLANKS   SPFRM                           125184
     C                     ENDIF                                          125184
     C           PRTCD     IFEQ *BLANKS                                   125184
     C                     MOVE *BLANKS   SPFRM                           125184
     C                     MOVELBBCUST    SPFRM                           125184
     C                     ENDIF                                          125184
     C***                  MOVELSPFRM     SFCUS                    125184 134804
     C                     ENDIF
     C                     ENDIF
      *
      ** ... must be numeric
      *
     C**********           MOVELSFCUS     WNUM7   70                                          CSD027
     C**********           MOVELWNUM7     WALF6   6                                           CSD027
     C********** SFCUS     IFNE WALF6                                                         CSD027
     C**********           MOVE '1'       *IN34                                               CSD027
     C**********           MOVEL'LEL0134' ZAMSID                                              CSD027
     C**********           EXSR ZASNMS                                                        CSD027
     C**********           LEAVE                                                              CSD027
     C**********           ENDIF                                                              CSD027
      *
      ** ... facility must exist on facility file (both A and B recs)
      *
     C                     MOVE SFCUS     WFCNUM
     C                     MOVE SFTYP     WFFACT
     C                     MOVE SFSEQ     WFFCNO
     C                     MOVE 'A'       WFRCTP
     C           WKFAC     CHAINFCLTY               N89
      *                                                                   153787
      **  If Facility is either closed or expired, check for records      153787
      **  in PF/LEFCAMPD if it has been reactivated.                      153787
      *                                                                   153787
     C           *IN89     IFEQ *OFF                                      153787
     C                     EXSR SRCKFR                                    153787
     C                     ENDIF                                          153787
      *                                                                   153787
     C           *IN89     IFEQ '1'
     C************IN89     OREQ '0'                                       153786
     C***********SACTN     ANDEQ'I'                                       153786
     C***********RECIF     ANDNE'D'                                       153786
      *
     C************IN89     OREQ '0'                                       153786
     C***********SACTN     ANDEQ'A'                                       153786
     C***********RECIF     ANDNE'D'                                       153786
     C***********RECIF     ANDNE'E'                                       153786
     C                     MOVE '1'       *IN34
     C                     MOVEL'LEL0134' ZAMSID
     C                     EXSR ZASNMS
     C                     LEAVE
     C                     ENDIF
      *                                                                   185457
      ** Check if facility is multi-customer                              185457
      *                                                                   185457
     C           *IN89     IFEQ '0'                                       185457
     C           *IN34     ANDEQ'0'                                       185457
     C********** SCUST     ANDNESFCUS                                     185457              203794
     C           MCSIF     ANDNE'Y'                                       185457
     C           SCUST     IFNE SFCUS                                                         203794
     C           *IN21     ANDEQ'0'                                                           203794
     C                     MOVE '1'       *IN34                           185457
     C                     MOVEL'LEL0112' ZAMSID                          185457
     C                     EXSR ZASNMS                                    185457
     C                     LEAVE                                          185457
     C                     ENDIF                                                              203794
     C                     ENDIF                                          185457
      *                                                                   153787
      **  Skip this validation if fclty has been reactivated.             153787
      *                                                                   153786
     C           *IN89     IFEQ '0'                                       153786
     C           RECIF     ANDNE'D'                                       153786
     C           SACTN     ANDEQ'I'                                       153786
     C           WREAC     ANDEQ*OFF                                      153787
     C           *IN89     OREQ '0'                                       153786
     C           RECIF     ANDNE'D'                                       153786
     C           SACTN     ANDEQ'A'                                       153786
     C           WREAC     ANDEQ*OFF                                      153787
      *                                                                   153786
     C                     MOVELSLTYP     LTYP1   1                                         AR763386
      *                                                                                     AR763386
     C           RECIF     IFEQ 'E'                                       153786
     C           SACTN     IFEQ 'I'                                                           161824
     C           SACTN     OREQ 'A'                                                           161824
     C           SMDAT     ANDEQ*BLANKS                                                       161824
     C           LTYP1     ANDNE'X'                                                         AR763386
     C           LTYP1     ANDNE'Y'                                                         AR763386
     C           LTYP1     ANDNE'Z'                                                         AR763386
     C                     MOVEL'LEL0505' ZAMSID                          153786
     C                     MOVE '1'       *IN34                                               161824
     C                     EXSR ZASNMS                                                        161824
     C                     ENDIF                                                              161824
     C                     ELSE                                           153786
     C                     MOVEL'LEL0506' ZAMSID                          153786
     C**********           ENDIF                                                       153786 161824
     C                     MOVE '1'       *IN34                           153786
     C                     EXSR ZASNMS                                    153786
     C                     ENDIF                                          153786
     C                     LEAVE                                          153786
      *                                                                   153786
     C                     ENDIF                                          153786
      *
     C                     MOVE 'B'       WFRCTP
     C           WKFAC     CHAINFCLTY               N89
     C           *IN89     IFEQ '1'
     C************IN89     OREQ '0'                                       153786
     C***********SACTN     ANDEQ'I'                                       153786
     C***********RECIF     ANDNE'D'                                       153786
      *
     C************IN89     OREQ '0'                                       153786
     C***********SACTN     ANDEQ'A'                                       153786
     C***********RECIF     ANDNE'D'                                       153786
     C***********RECIF     ANDNE'E'                                       153786
     C                     MOVE '1'       *IN34
     C                     MOVEL'LEL0134' ZAMSID
     C                     EXSR ZASNMS
     C                     LEAVE
     C                     ENDIF
      *                                                                   153787
      **  Skip this validation if fclty has been reactivated.             153787
      *                                                                   153786
     C           *IN89     IFEQ '0'                                       153786
     C           RECIF     ANDNE'D'                                       153786
     C           SACTN     ANDEQ'I'                                       153786
     C           WREAC     ANDEQ*OFF                                      153787
     C           *IN89     OREQ '0'                                       153786
     C           RECIF     ANDNE'D'                                       153786
     C           SACTN     ANDEQ'A'                                       153786
     C           WREAC     ANDEQ*OFF                                      153787
      *                                                                   153786
     C                     MOVELSLTYP     LTYP1                                             AR763386
      *                                                                                     AR763386
     C           RECIF     IFEQ 'E'                                       153786
     C           SACTN     IFEQ 'I'                                                           161824
     C           SACTN     OREQ 'A'                                                           161824
     C           SMDAT     ANDEQ*BLANKS                                                       161824
     C           LTYP1     ANDNE'X'                                                         AR763386
     C           LTYP1     ANDNE'Y'                                                         AR763386
     C           LTYP1     ANDNE'Z'                                                         AR763386
     C                     MOVEL'LEL0505' ZAMSID                          153786
     C                     MOVE '1'       *IN34                                               161824
     C                     EXSR ZASNMS                                                        161824
     C                     ENDIF                                                              161824
     C                     ELSE                                           153786
     C                     MOVEL'LEL0506' ZAMSID                          153786
     C***********          ENDIF                                                       153786 161824
     C                     MOVE '1'       *IN34                           153786
     C                     EXSR ZASNMS                                    153786
     C                     ENDIF                                          153786
     C                     LEAVE                                          153786
      *                                                                   153786
     C                     ENDIF                                          153786
      *                                                                   128946
      **  Must not use Credit Agreements                                  128946
      *                                                                   128946
     C           *IN34     IFEQ '0'                                       128946
     C           TRCA      ANDEQ'CA'                                      128946
     C                     MOVE '1'       *IN34                           128946
     C                     MOVEL'LEL0497' ZAMSID                          128946
     C                     EXSR ZASNMS                                    128946
     C                     LEAVE                                          128946
     C                     ENDIF                                          128946
      *
     C           *IN34     IFEQ '0'
     C                     MOVE PRTR      WCPRTR
     C***********          MOVE CNUMF     WAGENT                          120392
     C                     MOVE ANUM      WAGENT                          120392
     C**********           Z-ADDPMFC      WCPMFC                                              CSD027
     C                     MOVE PMFC      WCPMFC                                              CSD027
     C                     Z-ADDPMFT      WCPMFT
     C**********           Z-ADDPMFN      WCPMFC                                              CSD027
     C                     MOVE PMFN      WCPMFC                                              CSD027
      *                                                                   121719
      * Save Permitted currencies against the multi-currency facility     121719
      *                                                                   121719
     C           CSEL      IFEQ 'Y'                                       121719
     C                     MOVEAALCY      WCY                             121719
     C                     ENDIF                                          121719
      *                                                                   121719
     C                     ENDIF
      *
     C                     ENDDO
      *                                                                                       CLE031
      ** If CLE031 is on, set flag WVALFC to determine if                                     CLE031
      ** facility currency validation is needed.                                              CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           *IN34     ANDEQ*OFF                                                          CLE031
     C                     MOVE *ON       WVALFC                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF
      *
      ** VALIDATE BRANCH CODE
      ** ... all validations relating to facility will be ignored
      ** for parts sold as it does not have the facility field
      *
      ** ... If branch is blank, set to default branch
      *
     C           SBRCA     IFEQ *BLANKS
     C           PMODE     ANDNE'B'
     C                     MOVE DBRN      SBRCA
     C                     ENDIF
      *
     C           BGMBIN    IFEQ 'Y'
      *
      ** ... If branch not entered and facility multi-branch indicator
      ** is 'N', use facility branch as default
      *
     C           SBRCA     IFEQ *BLANKS
     C           MBFC      ANDNE'Y'
     C           *IN34     ANDEQ'0'
     C           *IN22     ANDEQ'0'
     C                     MOVE BRCAF     SBRCA
     C                     ENDIF
      *
     C           SACTN     IFEQ 'I'
     C                     MOVE SBRCA     PBRCA
     C***********          CALL 'AOBRCHR0'PPAR4                           121783
     C                     CALL 'AOBRCHR1'PPAR4                           121783
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN35
     C                     MOVEL'LEL0103' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *BLANKS   WLCCD   3
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SBRCA
     C                     ENDIF
     C                     ELSE
     C                     MOVE A8LCCD    WLCCD
     C                     MOVE A8BRCD    SBRCA
      *
      ** ... Branch (input or default)/action must be valid for user
      ** ... except when loan is being created by a Principal Transfer.                       207676
      *
     C           PMODE     IFEQ 'B'
     C           PTYPE     IFNE 'PTFT'                                                        207676
     C                     CALL 'ZBACTBU'
     C                     PARM SACTN     @ZACTN
     C                     PARM A8BRCD    @ZBR
     C                     PARM           @USER  10
     C**********           PARM           @ZMGRP  40                                          CSF002
     C**********           PARM           @ZICDE  4                                           CSF002
     C                     PARM           UNQCDE 10                                           CSF002
     C                     PARM           @ERR
     C                     ENDIF                                                              207676
     C                     ELSE
     C                     CALL 'ZVACTBU'
     C                     PARM SACTN     @ZACTN
     C                     PARM A8BRCD    @ZBR
     C                     PARM           @ERR
     C                     ENDIF
     C           @ERR      IFEQ 1
     C                     MOVE '1'       *IN35
     C                     MOVEL'LEL0303' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C           @ERR      IFEQ 2
     C                     MOVE '1'       *IN35
     C                     MOVEL'LEL0304' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... If facility multi-branch is 'N', branch must be the same
      ** as the facility branch
      *
     C           *IN22     IFEQ '0'
     C           *IN34     ANDEQ'0'
     C           *IN35     ANDEQ'0'
     C           MBFC      ANDNE'Y'
     C           SBRCA     ANDNEBRCAF
     C                     MOVE '1'       *IN35
     C                     MOVEL'LEL0032' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** If originating branch not used or multibranching off,
      ** default originating branch to this valid value
      *
     C           *IN35     IFEQ '0'
     C           BKOBRU    IFEQ 'N'
     C           BGMBIN    OREQ 'N'
     C                     MOVE SBRCA     SORBR
     C                     ENDIF
     C                     ENDIF
      *
      ** If originating branch is blank and originating branch used
      ** default orig branch to either this branch or fac orig br
      *
     C           SORBR     IFEQ *BLANKS
     C           BKOBRU    ANDEQ'Y'
     C           *IN35     IFEQ '0'
     C                     MOVE SBRCA     SORBR
     C                     ELSE
     C           *IN34     IFEQ '0'
     C           *IN22     ANDEQ'0'
     C                     MOVE ORBRF     SORBR
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE LOAN TYPE/SUBTYPE
      *
     C/COPY WNCPYSRC,LE2030C004
     C                     MOVE SLTYP     PLNTY   2
     C                     MOVE SSUTP     PLNST   2
     C                     MOVE CLCLAS    PLNCL   4                                         BUG11642
     C                     CALL 'AOLOANR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PLNTY
     C                     PARM           PLNST
     C                     PARM           PLNCL                                             BUG11642
     C           SDLOAN    PARM SDLOAN    DSFDY
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN36
     C                     MOVEL'LEL0101' ZAMSID
     C                     EXSR ZASNMS
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SLTYP
     C                     MOVE *BLANKS   SSUTP
     C                     ENDIF
      *
      ** Processing type retrieved must be valid for the type of
      ** transaction entered
      *
     C                     ELSE
     C                     MOVE AYLNTY    SLTYP
     C                     MOVE AYLNST    SSUTP
     C                     Z-ADDAYLNPT    WLNPT   20
     C                     MOVE AYRANG    WRANG
     C/COPY WNCPYSRC,LE2030C114
     C                     SELEC
      *                                                                   CLE005
      ** For parts purchased, valid are 64, 65; morevoer if CLE005        CLE005
      ** is installed, 68 and 71 are also valid                           CLE005
      *                                                                   CLE005
     C           *IN21     WHEQ '1'
     C           WLNPT     IFNE 64
     C           WLNPT     ANDNE65
     C           WLNPT     ANDNE68                                        CLE005
     C           WLNPT     ANDNE71                                        CLE005
     C           WLNPT     OREQ 68                                        CLE005
     C           CLE005    ANDEQ'N'                                       CLE005
     C           WLNPT     OREQ 71                                        CLE005
     C           CLE005    ANDEQ'N'                                       CLE005
     C                     MOVE '1'       *IN36
     C                     ENDIF
     C           *IN22     WHEQ '1'
      *                                                                   CLE005
      ** For parts sold, valid are 66, 67;  moreover if CLE005            CLE005
      ** is installed, 69 and 72 are also valid                           CLE005
      *                                                                   CLE005
     C           WLNPT     IFNE 66
     C           WLNPT     ANDNE67
     C           WLNPT     ANDNE69                                        CLE005
     C           WLNPT     ANDNE72                                        CLE005
     C           WLNPT     OREQ 69                                        CLE005
     C           CLE005    ANDEQ'N'                                       CLE005
     C           WLNPT     OREQ 72                                        CLE005
     C           CLE005    ANDEQ'N'                                       CLE005
     C                     MOVE '1'       *IN36
     C                     ENDIF
     C                     OTHER
     C           WLNPT     IFNE 61
     C           WLNPT     ANDNE62
     C           WLNPT     ANDNE63
     C           WLNPT     ANDNE70
     C           CLE028    ANDEQ'N'                                                           CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           WLNPT     ANDNE61                                                            CLE028
     C           WLNPT     ANDNE62                                                            CLE028
     C           WLNPT     ANDNE63                                                            CLE028
     C           WLNPT     ANDNE70                                                            CLE028
     C           WLNPT     ANDNE80                                                            CLE028
     C                     MOVE '1'       *IN36
     C                     ENDIF
     C                     ENDSL
      *
     C           *IN36     IFEQ '1'
     C                     MOVEL'LEL0102' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** ...funding details for analytical accounting will be
      ** made available when the following are satisfied:
      ** for loans, when processing type is 61 or 62
      ** for parts purchased, when processing type is 64
      ** for parts sold, when processing type is 66
      ** Funding details for Revenue Analysis will be available for       CDE002
      ** all funding type loans i.e. processing types 61 to 69.           CDE002
      ** It should never be available for risk loans, types 70, 71        CDE002
      ** or 72 whether CDE002 is on or off.                               CDE002
      *
     C           BGN0ST    IFEQ 'Y'
     C           CDE002    OREQ 'Y'                                       CDE002
     C                     MOVE '1'       *IN96
      *
     C                     SELEC
     C           *IN21     WHEQ '1'
     C           WLNPT     IFNE 64
     C           WLNPT     ANDNE68                                        CLE005
     C           CDE002    ANDEQ'N'                                       CDE002
      *                                                                   CDE002
     C           WLNPT     ORNE 64                                        CDE002
     C           WLNPT     ANDNE65                                        CDE002
     C           WLNPT     ANDNE68                                        CDE002
     C           CDE002    ANDEQ'Y'                                       CDE002
     C           WLNPT     OREQ 68                                        CLE005
     C           CLE005    ANDEQ'N'                                       CLE005
     C                     MOVE '0'       *IN96
     C                     ENDIF
      *
     C           *IN22     WHEQ '1'
     C           WLNPT     IFNE 66
     C           WLNPT     ANDNE69                                        CLE005
     C********** WLNPT     ANDNE72                                 CLE005 CDE002
     C           CDE002    ANDEQ'N'                                       CDE002
      *                                                                   CDE002
     C           WLNPT     ORNE 66                                        CDE002
     C           WLNPT     ANDNE67                                        CDE002
     C           WLNPT     ANDNE69                                        CDE002
     C           CDE002    ANDEQ'Y'                                       CDE002
      *                                                                   CDE002
     C********** WLNPT     OREQ 72                                 CLE005 CDE002
     C********** W72TP     ANDNE'66'                               CLE005 CDE002
     C********** W72TP     ANDNE'69'                               CLE005 CDE002
     C           WLNPT     OREQ 69                                        CLE005
     C           CLE005    ANDEQ'N'                                       CLE005
     C********** WLNPT     OREQ 72                                 CLE005 CDE002
     C********** CLE005    ANDEQ'N'                                CLE005 CDE002
     C                     MOVE '0'       *IN96
     C                     ENDIF
      *
     C                     OTHER
     C           WLNPT     IFNE 61
     C           WLNPT     ANDNE62
     C           CDE002    ANDEQ'N'                                       CDE002
      *                                                                   CDE002
     C           WLNPT     ORNE 61                                        CDE002
     C           WLNPT     ANDNE62                                        CDE002
     C           WLNPT     ANDNE63                                        CDE002
     C           CDE002    ANDEQ'Y'                                       CDE002
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           WLNPT     ANDNE80                                                            CLE028
     C                     MOVE '0'       *IN96
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ENDIF
     C                     ENDSL
     C                     ENDIF
      *                                                                   128953
      **  Determine if loan type is allowed on facility                   128953
      *                                                                   128953
     C                     MOVEA*BLANKS   DRAW                            128953
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     MOVEADTPX      DRAW                                                CLE028
     C                     ELSE                                                               CLE028
     C                     MOVEADTPS      DRAW                            128953
     C                     ENDIF                                                              CLE028
     C                     Z-ADD1         W#NO    10                      128953
     C                     MOVE 'N'       W#FLAG  1                       128953
     C                     MOVE WLNPT     W#LNPT  2                       128953
      *                                                                   128953
     C********** W#NO      DOWLE5                                                      128953 CLE028
     C           W#NO      DOWLE6                                                             CLE028
     C           W#FLAG    ANDEQ'N'                                       128953
      *                                                                   128953
     C                     MOVE *BLANKS   W#LOK   3                       128953
     C           DRAW,W#NO CAT  W#LNPT    W#LOK                           128953
     C           W#LOK     LOKUPWDRPT                    97               128953
      *                                                                   128953
     C           *IN97     IFEQ '1'                                       128953
     C                     MOVE 'Y'       W#FLAG                          128953
     C                     ENDIF                                          128953
      *                                                                   128953
     C                     ADD  1         W#NO                            128953
      *                                                                   128953
     C                     ENDDO                                          128953
      *                                                                   128953
      **  Generate Message if Loan type is restricted on facility         128953
      *                                                                   128953
     C           W#FLAG    IFEQ 'N'                                       128953
     C           DTPS      ANDNE*BLANKS                                   128953
     C           CLE028    ANDEQ'N'                                                           CLE028
     C           W#FLAG    OREQ 'N'                                                           CLE028
     C           DTPX      ANDNE*BLANKS                                                       CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C                     MOVE '1'       *IN36                           128953
     C                     MOVEL'LEL0498' ZAMSID                          128953
     C                     EXSR ZASNMS                                    128953
     C                     ENDIF                                          128953
     C/COPY WNCPYSRC,LE2030C005
      *
      ** VALIDATE PURCHASED FROM (for parts purchased)
      *
     C           *IN21     IFEQ '1'
     C***********SOLNO     IFEQ *BLANKS                                   125184
     C           SPFRM     IFEQ *BLANKS                                   125184
     C                     MOVE '1'       *IN37
     C                     MOVEL'LEL0179' ZAMSID
     C                     EXSR ZASNMS
      *
      ** ... must be a valid customer
      *
     C                     ELSE
     C                     MOVE *BLANKS   PCUST
     C***********          MOVELSOLNO     PCUST                           125184
     C                     MOVELSPFRM     PCUST                           125184
     C                     CALL 'AOCUSTR0'PPAR3
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN37
     C                     MOVEL'LEL0034' ZAMSID
     C                     EXSR ZASNMS
     C           PRTCD     IFEQ '*NOSEL  '
     C***********          MOVE *BLANKS   SOLNO                           125184
     C                     MOVE *BLANKS   SPFRM                           125184
     C                     ENDIF
      *
      ** ... must not be a parent
      *
     C                     ELSE
     C***********          MOVE BBCUST    SOLNO                           125184
     C                     MOVE *BLANKS   SPFRM                           125184
     C                     MOVELBBCUST    SPFRM                           125184
     C                     MOVE BBCUST    WSVCN
     C           BBPAIN    IFEQ 'P'
     C                     MOVE '1'       *IN37
     C                     MOVEL'LEL0036' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** Original borrower must be different from purchased from
      ** customer
      *
     C           *IN33     IFEQ '0'
     C***********SCUST     ANDEQSOLNO                                     125184
     C           SCUST     ANDEQSPFRM                                     125184
     C                     MOVE '1'       *IN33
     C                     MOVEL'LEL0172' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                                       203794
      ** Purchased from should be equal to the facility customer when                         203794
      ** facility is not designated as muti-customer.                                         203794
      *                                                                                       203794
     C           SPFRM     IFNE SFCUS                                                         203794
     C           SCUST     ANDNESFCUS                                                         CLE031
     C           MCSIF     ANDNE'Y'                                                           203794
     C           SYINF     ANDNE'Y'                                                           203794
     C           *IN37     ANDEQ'0'                                                           203794
     C                     MOVE '1'       *IN34                                               203794
     C                     MOVEL'LEL0112' ZAMSID                                              203794
     C                     EXSR ZASNMS                                                        203794
     C                     ENDIF                                                              203794
     C                     ENDIF
     C                     ENDIF
      *
      ** If facility is not in error, for non-multi-customer facility,
      ** loan customer must equal facility customer
     C                     MOVE SBRCA     PBRCA                           120825
     C***********          CALL 'AOBRCHR0'PPAR4                    120825 121783
     C                     CALL 'AOBRCHR1'PPAR4                    120825 121783
     C                     MOVELA8SYCU    W#SYCU                          120825
      *
     C           *IN34     IFEQ '0'
     C           *IN22     ANDEQ'0'
     C           MCSIF     ANDNE'Y'
     C           SFCUS     ANDNEWSVCN
     C           SRCSI     ANDEQ'Y'                                       134804
     C********** SYINF     IFNE 'Y'                                       120825              203794
     C********** SYINF     OREQ 'Y'                                       120825              203794
     C           SYINF     IFEQ 'Y'                                                           203794
     C           WAGENT    ANDNEW#SYCU                                    120825
     C                     MOVE '1'       *IN34
     C                     MOVEL'LEL0135' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF                                          120825
     C                     ENDIF
      *                                                                   134804
     C           *IN34     IFEQ '0'                                       134804
     C           *IN21     ANDEQ'1'                                       134804
     C           *IN43     ANDEQ'0'                                       134804
     C           MCSIF     ANDNE'Y'                                       134804
     C           SFCUS     ANDNESCUST                                     134804
     C           SRCSI     ANDNE'Y'                                       134804
     C********** SYINF     IFNE 'Y'                                       134804              203794
     C********** SYINF     OREQ 'Y'                                       134804              203794
     C           SYINF     IFEQ 'Y'                                                           203794
     C           WAGENT    ANDNEW#SYCU                                    134804
     C                     MOVE '1'       *IN34                           134804
     C                     MOVEL'LEL0136' ZAMSID                          134804
     C                     EXSR ZASNMS                                    134804
     C                     ENDIF                                          134804
     C                     ENDIF                                          134804
      *                                                                   124001
      ** VALIDATE MIRROR LOAN NUMBER (for parts purchased)                124001
      ** validate only when facility is valid                             124001
      *                                                                   124001
     C                     MOVE *BLANK    MCRAM                                               202101
     C           *IN21     IFEQ '1'                                       124001
     C           *IN34     ANDEQ'0'                                       124001
     C           SMLNR     IFNE *BLANK                                    124001
     C********** SMLNR     ANDNE'000000'                                               125697 CLE148
      *                                                                   124001
      ** Must be blank for non-syndicated or non-agent facilities         124001
      *                                                                   124001
     C           SYINF     IFNE 'Y'                                       124001
     C           SYINF     OREQ 'Y'                                       124001
     C           WCPRTR    ANDNE'A'                                       124001
     C                     MOVE '1'       *IN15                           124001
     C                     MOVEL'LEL0093' ZAMSID                          124001
     C                     EXSR ZASNMS                                    124001
     C                     ENDIF                                          124001
      *                                                                   124001
      ** Must exist in the system as live                                 124001
      *                                                                   124001
     C           *IN15     IFEQ '0'                                       124001
     C                     MOVE SMLNR     WALON                           124001
     C                     MOVE 'A'       WEPAR                           124001
     C           WKLON     CHAINCLOAN               N89                   124001
     C           *IN89     IFEQ '0'                                       124001
     C           RECI      ANDNE'D'                                       124001
     C           PMODE     ANDNE'B'                                       124001
     C           *IN89     OREQ '1'                                       124001
     C                     MOVE '1'       *IN15                           124001
     C                     MOVEL'LEL0095' ZAMSID                          124001
     C                     EXSR ZASNMS                                    124001
      *                                                                                       202101
      ** Save MCRA of mirror loan number for later validation                                 202101
      *                                                                                       202101
     C                     ELSE                                                               202101
     C                     MOVE MCRA      MCRAM                                               202101
     C                     ENDIF                                          124001
     C                     ENDIF                                          124001
      *                                                                   124001
      ** With facility similar as the loan being entered                  124001
      *                                                                   124001
     C           *IN15     IFEQ '0'                                       124001
     C           WFCNUM    IFNE FCUS                                      124001
     C           WFFACT    ORNE FTYP                                      124001
     C           WFFCNO    ORNE FSEQ                                      124001
     C                     MOVE '1'       *IN15                           124001
     C                     MOVEL'LEL0096' ZAMSID                          124001
     C                     EXSR ZASNMS                                    124001
     C                     ENDIF                                          124001
     C                     ENDIF                                          124001
      *                                                                   124001
      ** Mandatory for agent facilities                                   124001
      *                                                                   124001
     C                     ELSE                                           124001
     C           SYINF     IFEQ 'Y'                                       124001
     C           WCPRTR    ANDEQ'A'                                       124001
     C                     MOVE '1'       *IN15                           124001
     C                     MOVEL'LEL0094' ZAMSID                          124001
     C                     EXSR ZASNMS                                    124001
     C                     ENDIF                                          124001
     C                     ENDIF                                          124001
     C                     MOVE MCRA      SVMCRA  1                       CLE034
     C                     MOVELMAINRF    CURREF                          124001
      *                                                                   124001
     C                     ENDIF                                          124001
      *
      ** VALIDATE SALE OF LOAN NUMBER (for parts sold)
      *
      *  If Parts sold is being reversed along with Parts purchased       122718
      *  and originating loan bypass validation for batch mode.           122718
      *                                                                   122718
     C           PMODE     IFEQ 'B'                                       122718
     C           SACTN     ANDEQ'R'                                       122718
     C           W#SEQ     ANDEQ1                                         122718
     C           PMODE     ORNE 'B'                                       122718
     C           PMODE     OREQ 'B'                                       122718
     C           SACTN     ANDNE'R'                                       122718
     C           PPCOB     ANDNE*BLANKS                                   CLE005
     C           PMODE     OREQ 'B'                                       CLE005
     C           PPCOB     ANDEQ*BLANKS                                   CLE005
      *                                                                   122718
     C           *IN22     IFEQ '1'
      *
     C           SOLNO     IFEQ *BLANKS
     C                     MOVE '1'       *IN37
     C                     MOVEL'LEL0123' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      *
      ** ... must be a valid loan processing type
      *
     C                     MOVE SOLNO     WALON
     C                     MOVE 'A'       WEPAR
      *                                                                                       245297
      ** Save the settlement details of the current loan under processing.                    245297
      *                                                                                       245297
     C                     Z-ADDRSTM      W#RSTM                                              245297
     C                     MOVE RONS      W#RONS                                              245297
     C                     MOVE RIBN      W#RIBN                                              245297
     C                     MOVE RIBA      W#RIBA                                              245297
     C                     MOVE *BLANKS   W#ROBN                                              245297
     C           ROBN      IFNE *ZEROS                                                        245297
     C                     MOVE ROBN      W#ROBN                                              245297
     C                     ENDIF                                                              245297
     C                     MOVE *BLANKS   W#ROCN                                              245297
     C           ROCN      IFNE *ZEROS                                                        245297
     C                     MOVE ROCN      W#ROCN                                              245297
     C                     ENDIF                                                              245297
     C                     Z-ADDPSTM      W#PSTM                                              245297
     C                     MOVE PONS      W#PONS                                              245297
     C                     MOVE PIBN      W#PIBN                                              245297
     C                     MOVE PIBA      W#PIBA                                              245297
     C                     MOVE *BLANKS   W#POBN                                              245297
     C           POBN      IFNE *ZEROS                                                        245297
     C                     MOVE POBN      W#POBN                                              245297
     C                     ENDIF                                                              245297
     C                     MOVE *BLANKS   W#POCN                                              245297
     C           POCN      IFNE *ZEROS                                                        245297
     C                     MOVE POCN      W#POCN                                              245297
     C                     ENDIF                                                              245297
     C                     MOVE CVMR      W#CVMR                                              245297
     C                     MOVE RCRN      W#RCRN                                              245297
     C                     MOVE RCRA      W#RCRA                                              245297
     C                     MOVE RVNO      W#RVNO                                              245297
     C                     MOVE AWBN      W#AWBN                                              245297
     C                     MOVE AWBA      W#AWBA                                              245297
     C                     MOVE BENN      W#BENN                                              245297
     C                     MOVE BENA      W#BENA                                              245297
     C                     MOVE DTP1      W#DTP1                                              245297
     C                     MOVE DTP2      W#DTP2                                              245297
     C                     MOVE DTP3      W#DTP3                                              245297
     C                     MOVE DTP4      W#DTP4                                              245297
     C                     MOVE DCHG      W#DCHG                                              245297
     C                     MOVE BTB1      W#BTB1                                              245297
     C                     MOVE BTB2      W#BTB2                                              245297
     C                     MOVE BTB3      W#BTB3                                              245297
     C                     MOVE BTB4      W#BTB4                                              245297
     C                     MOVE BTB5      W#BTB5                                              245297
     C                     MOVE BTB6      W#BTB6                                              245297
     C           WKLON     CHAINCLOAN               N89
      *                                                                                       245297
      ** Restore the settlement details of the original loan.                                 245297
      *                                                                                       245297
     C                     Z-ADDW#RSTM    RSTM                                                245297
     C                     MOVE W#RONS    RONS                                                245297
     C                     MOVE W#RIBN    RIBN                                                245297
     C                     MOVE W#RIBA    RIBA                                                245297
     C                     MOVE W#ROBN    ROBN                                                245297
     C                     MOVE W#ROCN    ROCN                                                245297
     C                     Z-ADDW#PSTM    PSTM                                                245297
     C                     MOVE W#PONS    PONS                                                245297
     C                     MOVE W#PIBN    PIBN                                                245297
     C                     MOVE W#PIBA    PIBA                                                245297
     C                     MOVE W#POBN    POBN                                                245297
     C                     MOVE W#POCN    POCN                                                245297
     C                     MOVE W#CVMR    CVMR                                                245297
     C                     MOVE W#RCRN    RCRN                                                245297
     C                     MOVE W#RCRA    RCRA                                                245297
     C                     MOVE W#RVNO    RVNO                                                245297
     C                     MOVE W#AWBN    AWBN                                                245297
     C                     MOVE W#AWBA    AWBA                                                245297
     C                     MOVE W#BENN    BENN                                                245297
     C                     MOVE W#BENA    BENA                                                245297
     C                     MOVE W#DTP1    DTP1                                                245297
     C                     MOVE W#DTP2    DTP2                                                245297
     C                     MOVE W#DTP3    DTP3                                                245297
     C                     MOVE W#DTP4    DTP4                                                245297
     C                     MOVE W#DCHG    DCHG                                                245297
     C                     MOVE W#BTB1    BTB1                                                245297
     C                     MOVE W#BTB2    BTB2                                                245297
     C                     MOVE W#BTB3    BTB3                                                245297
     C                     MOVE W#BTB4    BTB4                                                245297
     C                     MOVE W#BTB5    BTB5                                                245297
     C                     MOVE W#BTB6    BTB6                                                245297
     C           *IN89     IFEQ '0'
     C           RECI      ANDNE'D'
     C                     MOVE '1'       *IN89
     C                     ENDIF
     C           *IN89     IFEQ '1'
     C           SACTN     ANDEQ'A'
     C           RECI      ANDNE'M'
     C                     MOVE '1'       *IN89
     C                     ENDIF
      *
      ** ... loans must be of processing types 62,63,64,65 to be          CLE005
      ** sold; moreover if CLE005 is installed, those with processing     CLE005
      ** types 61, 68, 70 and 71 are also accepted                        CLE005
      *                                                                   CLE005
     C           *IN89     IFEQ '1'
     C           *IN89     OREQ '0'
     C           PTYP      ANDNE62
     C           PTYP      ANDNE63
     C           PTYP      ANDNE64
     C           PTYP      ANDNE65
     C           PTYP      ANDNE61                                        CLE005
     C           PTYP      ANDNE68                                        CLE005
     C           PTYP      ANDNE70                                        CLE005
     C           PTYP      ANDNE71                                        CLE005
     C                     MOVE '1'       *IN37
     C                     MOVEL'LEL0122' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                   CLE005
     C           *IN37     IFEQ '0'                                       CLE005
     C           CLE005    ANDEQ'N'                                       CLE005
     C           PTYP      IFEQ 61                                        CLE005
     C           PTYP      OREQ 68                                        CLE005
     C           PTYP      OREQ 70                                        CLE005
     C           PTYP      OREQ 71                                        CLE005
     C                     MOVE '1'       *IN37                           CLE005
     C                     MOVEL'LEL0122' ZAMSID                          CLE005
     C                     EXSR ZASNMS                                    CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   120813
      * Save sale of loan facility details                                120813
     C                     MOVE FCUS      S#FCUS                          120813
     C                     MOVE FTYP      S#FTYP                          120813
     C                     MOVE FSEQ      S#FSEQ                          120813
     C                     Z-ADDICBS      S#ICBS  10                      126623
     C                     Z-ADDPTYP      WPTYP   20                      161257
     C********** PTFC      IFNE 0                                                      216736 CSD027
     C           PTFC      IFNE *BLANKS                                                       CSD027
     C                     MOVEL'Y'       WPTF    1                                           216736
     C                     ELSE                                                               216736
     C                     MOVEL*BLANKS   WPTF                                                216736
     C                     ENDIF                                                              216736
     C                     ENDIF
      *                                                                                       CLE031
      ** If CLE031 is on, access facility details.                                            CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           *IN37     ANDEQ*OFF                                                          CLE031
     C                     MOVE FCUS      WFCNUM                                              CLE031
     C                     MOVE FTYP      WFFACT                                              CLE031
     C                     MOVE FSEQ      WFFCNO                                              CLE031
     C                     MOVE 'A'       WFRCTP                                              CLE031
     C           WKFAC     CHAINFCLTY               N89                                       CLE031
     C           *IN89     IFEQ *ON                                                           CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'FCLTY   'DBFILE                                              CLE031
     C                     Z-ADD71        DBASE                                               CLE031
     C                     MOVELFCTREC    DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *ON       WVALFC                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *
      ** ... parts sold must be 67 if related loan is 63 or 65
      ** otherwise, must be 66
      ** If CLE005 is installed, parts sold 69 is allowed for related     CLE005
      ** loans 61 or 68; parts sold 72 is allowed for related loans       CLE005
      ** of any type (excluding of course a parts sold)                   CLE005
      *
     C           *IN36     IFEQ '0'
     C           *IN37     ANDEQ'0'
     C           PTYP      IFEQ 63
     C           PTYP      OREQ 65
     C           WLNPT     IFNE 67
     C           WLNPT     ANDNE72                                        CLE005
     C                     MOVE '1'       *IN37
     C                     MOVEL'LEL0006' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C***********          ELSE
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C           PTYP      IFEQ 62                                        CLE005
     C           PTYP      OREQ 64                                        CLE005
     C           WLNPT     IFNE 66
     C           WLNPT     ANDNE72                                        CLE005
     C                     MOVE '1'       *IN37
     C                     MOVEL'LEL0006' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *                                                                   CLE005
     C           PTYP      IFEQ 61                                        CLE005
     C           PTYP      OREQ 68                                        CLE005
     C           WLNPT     IFNE 69                                        CLE005
     C           WLNPT     ANDNE72                                        CLE005
     C                     MOVE '1'       *IN37                           CLE005
     C                     MOVEL'LEL0006' ZAMSID                          CLE005
     C                     EXSR ZASNMS                                    CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C           PTYP      IFEQ 70                                        CLE005
     C           PTYP      OREQ 71                                        CLE005
     C           WLNPT     IFNE 72                                        CLE005
     C                     MOVE '1'       *IN37                           CLE005
     C                     MOVEL'LEL0006' ZAMSID                          CLE005
     C                     EXSR ZASNMS                                    CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      ** Funding participant details should also be made available        CLE005
      ** for participation sold in term and call loans                    CLE005
      ** Also, determine what processing type 72 is to be like            CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C***********BGN0ST    ANDEQ'Y'                                 CLE005142393
     C           WLNPT     ANDEQ72                                        CLE005
     C                     SELEC                                          CLE005
     C           PTYP      WHEQ 62                                        CLE005
     C           PTYP      OREQ 64                                        CLE005
     C                     MOVE '1'       *IN96                           CLE005
     C                     MOVE '66'      W72TP   2                       CLE005
     C           PTYP      WHEQ 61                                        CLE005
     C           PTYP      OREQ 68                                        CLE005
     C                     MOVE '1'       *IN96                           CLE005
     C                     MOVE '69'      W72TP   2                       CLE005
     C           PTYP      WHEQ 63                                        CLE005
     C           PTYP      OREQ 65                                        CLE005
     C                     MOVE '67'      W72TP                           CLE005
     C           PTYP      WHEQ 70                                        CLE005
     C           PTYP      OREQ 71                                        CLE005
     C                     MOVE '70'      W72TP                           CLE005
     C                     ENDSL                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      *  Risk loans do not use funding rates, so switch off *IN96                             199822
      *     to prevent these fields from being displayed                                      199822
     C           WLNPT     IFEQ 70                                                            199822
     C           WLNPT     OREQ 71                                                            199822
     C           WLNPT     OREQ 72                                                            199822
     C                     MOVE '0'       *IN96                                               199822
     C                     ENDIF                                                              199822
      *                                                                                       199822
     C                     ENDIF
      *                                                                   122718
     C                     ENDIF                                          122718
      *                                                                   122718
     C                     ENDIF                                          122718
      *                                                                   202401
      ** Need to save multi ccy rollover allowed indicator if             202401
      ** internal parts purchased                                         202401
      *                                                                   202401
     C           *IN21     IFEQ '1'                                       202401
     C           *IN15     ANDEQ'0'                                       202401
     C                     MOVE MCRA      MCRAM   1                       202401
     C                     ENDIF                                          202401
      *                                                                   122718
     C           *IN22     IFEQ '1'                                       122718
     C           LPFI      OREQ 'I'                                       202436
      *
      ** ... save fields of related reference for later validation
      ** and updates, then restore main loan details
      *
     C           *IN37     IFEQ '0'
     C                     MOVE CNUM      CNUMM   6
     C                     MOVE BRCA      BRCAM   3
     C                     MOVE CCY       CCYM    3
     C                     Z-ADDCPAM      CPAMM  130
     C                     Z-ADDDDAT      DDATM   50
     C                     Z-ADDVDAT      VDATM   50
     C                     Z-ADDMDAT      MDATM   50
     C                     Z-ADDPSAM      PSAMM  130
      *
     C                     MOVE FMIN      WFMIN
     C                     Z-ADDFCXR      WSVFX
     C**********           Z-ADDFCUS      FCUSM   60                                          CSD027
     C                     MOVE FCUS      FCUSM   6                                           CSD027
     C                     Z-ADDFTYP      FTYPM   30
     C                     Z-ADDFSEQ      FSEQM   20
     C                     Z-ADDFCXR      FCXRM  138
     C                     MOVE FMDI      FMDIM   1
     C                     MOVE ORBR      ORBRM   3
     C                     MOVE CRSK      CRSKM   2
     C**********           MOVE LIND      LINDM   3                                           CER020
     C                     MOVE LOIC      LOICM   3                                           CER020
     C                     MOVE PRFC      PRFCM   4
     C                     MOVE ACOF      ACOFM   2
     C                     MOVE FCCY      FCCYM   3
     C                     MOVE FCLB      FCLBM   3
     C                     MOVE MCRA      MCRAM   1                       120025
     C           LPFI      IFEQ 'I'                                       CLE034
     C           *IN21     ANDEQ'1'                                       CLE034
     C                     MOVELSVMCRA    MCRAM                           CLE034
     C                     ENDIF                                          CLE034
     C                     MOVE PTYP      PTYPM   20                      158863
      *                                                                   134725
      ** Save multi-ccy rollover details for later validation and         134725
      ** update                                                           134725
      *                                                                   134725
     C                     Z-ADDRLDT      RLDTM   50                      134725
     C           CLE006    IFEQ 'Y'                                       134725
     C                     MOVE SOLNO     WALON                           134725
     C                     MOVE 'B'       WEPAR                           134725
     C********** WKLON     CHAINCLOAN                89            134725 191800
     C           WKLON     CHAINCLOAN               N89                   191800
     C           *IN89     IFEQ '0'                                       134725
     C                     Z-ADDNBRA      NBRAM   20                      134725
     C                     Z-ADDNCAS      NCASM   10                      134725
     C                     MOVE NCHI      NCHIM   1                       134725
     C                     MOVE NCCY      NCCYM   3                       134725
     C                     Z-ADDNFCE      NFCEM  138                      134725
     C                     MOVE NFMD      NFMDM   1                       134725
     C                     Z-ADDNBCE      NBCEM  138                      134725
     C                     MOVE NBMD      NBMDM   1                       134725
     C                     MOVE NCCYM     PCURR                           134725
     C                     CALL 'AOCURRR0'PPAR5                           134725
     C                     Z-ADDA6NBDP    NBDPM   10                      134725
     C                     ENDIF                                          134725
     C                     ENDIF                                          134725
      *                                                                   134725
     C                     MOVELMAINRF    CURREF
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** VALIDATE CURRENCY
      ** ... validations relating to facility will be ignored for
      ** parts sold as it does not have this field
      *
     C                     MOVE SCURR     PCURR
     C                     CALL 'AOCURRR0'PPAR5
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN38
     C                     MOVEL'LEL0066' ZAMSID
     C                     EXSR ZASNMS
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SCURR
     C                     ENDIF
      *
      ** ... must be a dealing currency
      *
     C                     ELSE
     C                     MOVE A6CYCD    SCURR
     C           A6DLCI    IFNE 'Y'
     C                     MOVE '1'       *IN38
     C                     MOVEL'LEL0109' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *                                                                   169212
     C                     MOVE A6INCY    WINFL   1                       169212
      *
      ** ... If not a multi-currency facility, currency must equal
      ** the facility currency
      *
     C           *IN22     IFEQ '0'
     C           *IN34     ANDEQ'0'
     C           *IN38     ANDEQ'0'
     C           MCCYF     IFNE 'Y'
     C           SCURR     ANDNEFCCYF
     C                     MOVE '1'       *IN38
     C                     MOVEL'LEL0110' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *                                                                   121719
      *  If multi-currency and currency select indicators or on check     121719
      *  the currency entered is one of the permitted currencies on       121719
      *  the facility.                                                    121719
      *                                                                   121719
      *  Do not check when a parts sold is entered                        127120
      *                                                                   127120
     C           *IN38     IFEQ '0'                                       121719
     C           *IN22     ANDEQ'0'                                       127120
     C           MCCYF     ANDEQ'Y'                                       121719
     C           CSEL      ANDEQ'Y'                                       121719
     C           SCURR     ANDNEFCCYF                                     121719
     C                     Z-ADD0         X1      20                      121719
      *                                                                   121719
     C                     DO   9                                         121719
     C           SCURR     LOKUPWCY                      38               121719
     C                     ENDDO                                          121719
      *                                                                   121719
     C           *IN38     IFEQ *ON                                       121719
     C                     MOVE *OFF      *IN38                           121719
     C                     ELSE                                           121719
     C                     MOVE '1'       *IN38                           121719
     C                     MOVEL'LEL0174' ZAMSID                          121719
     C                     EXSR ZASNMS                                    121719
     C                     ENDIF                                          121719
      *                                                                   121719
     C                     ENDIF                                          121719
      *
      ** ... if no error, save some fields
      *
     C           *IN38     IFEQ '0'
     C                     MOVE A6MDIN    WSVIN   1
     C                     Z-ADDA6SPRT    WSVRT  138
     C                     Z-ADDA6NBDP    WCDPL   10
     C                     Z-ADDA6TXND    WSVTX   20
     C                     MOVE SCURR     W#CCY   3                       125258
     C                     MOVE FCCYF     W#FCY   3                       125258
     C                     ELSE
     C                     Z-ADD3         WCDPL
     C                     ENDIF
      *                                                                                       CLE023
      ** Save currency details.                                                               CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     MOVE PCURR     ZCCYI                                               CLE023
     C                     Z-ADDA6SPRT    ZRATE1                                              CLE023
     C                     MOVE A6MDIN    ZMDI1                                               CLE023
     C                     Z-ADDA6NBDP    ZCDPI                                               CLE023
     C                     ENDIF                                                              CLE023
      *
      ** VALIDATE AMOUNT OF LOAN
      *
      ** Validation for Principal Amount if CLE031 is not installed, or                       CLE031
      ** if it is and facility currency principal amount is blank, or                         CLE031
      ** if it is and action is not insert.                                                   CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'N'                                                           CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           SFCPAM    ANDEQ*BLANKS                                                       CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           SACTN     ANDNE'I'                                                           CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           PMODE     ANDEQ'B'                                                           CLE031
      *                                                                                       CLE031
     C                     Z-ADD*ZEROS    WSVAM  130
     C                     MOVE *BLANKS   PSCRF
     C                     MOVE SCPAM     PSCRF
     C                     Z-ADDWCDPL     PNDEC
     C           13        SUB  WCDPL     PNDIG
     C                     CALL 'ZALIGN'  PPAR1
     C                     MOVE PRVAL     WSVAM
      *                                                                   157553
      ** If loan is created by a Principal Transfer, validation           157553
      ** for the loan repayment amount should be against the amount       157553
      ** of the principal transfer record.                                157553
      *                                                                   157553
     C                     Z-ADDWSVAM     WSVAM2 130                      157553
      *                                                                   157553
     C           WSVAM     IFEQ 0                                         157553
     C**********           Z-ADDLNRF      WLLOAN                                       157553 CLE148
     C                     MOVELLNRF      WLLOAN                                              CLE148
     C                     Z-ADD0         WLVDAT                          157553
     C                     Z-ADD0         WLLASN                          157553
     C                     MOVEL'N'       EXIT1   1                       157553
      *                                                                   157553
     C           WKLAM     SETLLLELOAML3                                  157553
     C/COPY WNCPYSRC,LE2030C048
     C                     READ LELOAML3                 89               157553
     C/COPY WNCPYSRC,LE2030C049
     C           WLLOAN    DOWEQLNRFA                                     157553
     C           *IN89     ANDNE'1'                                       157553
     C           EXIT1     ANDNE'Y'                                       157553
     C           AMTPA     IFEQ 'PT'                                      157553
     C           RECIA     ANDEQ'D'                                       157553
     C           NRLIA     ANDEQ'Y'                                       157553
     C                     ADD  PRAMA     WSVAM2                          157553
     C                     MOVEL'Y'       EXIT1                           157553
     C                     ENDIF                                          157553
     C                     READ LELOAML3                 89               157553
     C                     ENDDO                                          157553
      *                                                                   157553
     C                     ENDIF                                          157553
      *                                                                   157553
     C           SCPAM     IFEQ *BLANKS
     C           PMODE     ANDNE'B'                                       159259
     C           WSVAM     OREQ *ZEROS
     C           SACTN     ANDEQ'I'
     C           PGNTF     ANDNE'Y'
     C           PMODE     ANDEQ'B'                                       159259
     C           *IN21     ANDEQ*OFF                                      159259
     C           *IN22     ANDEQ*OFF                                      159259
     C           WSVAM     OREQ *ZEROS                                    159259
     C           SACTN     ANDEQ'I'                                       159259
     C           PMODE     ANDNE'B'                                       159259
     C           PRTCD     ORNE *BLANKS
     C           SACTN     ANDEQ'I'                                       156497
     C                     MOVE '1'       *IN39
     C                     MOVEL'LEL0138' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** VALIDATE FACILITY CURRENCY PRINCIPAL AMOUNT                                          CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           SACTN     ANDEQ'I'                                                           CLE031
     C           WVALFC    ANDEQ*ON                                                           CLE031
      *                                                                                       CLE031
     C                     MOVE FCCYF     PCURR                                               CLE031
     C                     CALL 'AOCURRR0'PPAR5                                               CLE031
     C           PRTCD     IFNE *BLANKS                                                       CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'SDCURRPD'DBFILE                                              CLE031
     C                     Z-ADD68        DBASE                                               CLE031
     C                     MOVELFCCYF     DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVELFCCYF     SFCCY                                               CLE031
     C                     Z-ADDA6NBDP    WFCNBP  10                                          CLE031
     C                     Z-ADD*ZEROS    WFCPAM 130                                          CLE031
     C                     MOVE *BLANKS   PSCRF                                               CLE031
     C                     MOVE SFCPAM    PSCRF                                               CLE031
     C                     Z-ADDWFCNBP    PNDEC                                               CLE031
     C           13        SUB  WFCNBP    PNDIG                                               CLE031
     C                     CALL 'ZALIGN'  PPAR1                                               CLE031
     C                     MOVE PRVAL     WFCPAM                                              CLE031
      *                                                                                       CLE031
      ** ... when running interactively                                                       CLE031
      *                                                                                       CLE031
      ** Error if principal amount and facility currency principal amount                     CLE031
      ** are both blank                                                                       CLE031
      *                                                                                       CLE031
     C           PMODE     IFNE 'B'                                                           CLE031
     C           SCPAM     IFEQ *BLANK                                                        CLE031
     C           SFCPAM    ANDEQ*BLANK                                                        CLE031
     C                     MOVE '1'       *IN49                                               CLE031
     C**********           MOVEL'LEL0569' ZAMSID                                       CLE031 CAS011
     C                     MOVEL'LEL0802' ZAMSID                                              CAS011
     C                     EXSR ZASNMS                                                        CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Error if both principal amount and facility currency principal                       CLE031
      ** amount are not blank                                                                 CLE031
      *                                                                                       CLE031
     C           SCPAM     IFNE *BLANK                                                        CLE031
     C           SFCPAM    ANDNE*BLANK                                                        CLE031
     C                     MOVE '1'       *IN49                                               CLE031
     C**********           MOVEL'LEL0570' ZAMSID                                       CLE031 CAS011
     C                     MOVEL'LEL0803' ZAMSID                                              CAS011
     C                     EXSR ZASNMS                                                        CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** If principal amount is blank and facility currency is not                            CLE031
      ** blank, error if either error occurred during a call to ZALIGN                        CLE031
      ** or facility currency principal amount (WFCPAM) is 0.                                 CLE031
      *                                                                                       CLE031
     C           SCPAM     IFEQ *BLANKS                                                       CLE031
     C           SFCPAM    ANDNE*BLANKS                                                       CLE031
     C           PRTCD     ANDNE*BLANKS                                                       CLE031
     C           SCPAM     OREQ *BLANKS                                                       CLE031
     C           SFCPAM    ANDNE*BLANKS                                                       CLE031
     C           WFCPAM    ANDEQ*ZERO                                                         CLE031
     C                     MOVE '1'       *IN49                                               CLE031
     C                     MOVEL'LEL0138' ZAMSID                                              CLE031
     C                     EXSR ZASNMS                                                        CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       221941
      ** Error if facility and loan currencies are the same                                   221941
      *                                                                                       221941
     C           SCURR     IFEQ FCCYF                                                         221941
     C           WFCPAM    ANDNE*ZEROS                                                        221941
     C                     MOVE '1'       *IN49                                               221941
     C                     MOVEL'LEL0579' ZAMSID                                              221941
     C                     EXSR ZASNMS                                                        221941
     C                     ENDIF                                                              221941
      *                                                                                       CLE031
      ** ... when running in batch mode                                                       CLE031
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
      ** Error if error occurred during a call to ZALIGN and facility                         CLE031
      ** currency principal amount (WFCPAM) is not 0                                          CLE031
      ** Or error if facility currency principal amount (WFCPAM) is 0                         CLE031
      ** and principal amount is blanks or zeros                                              CLE031
      *                                                                                       CLE031
     C           PRTCD     IFNE *BLANKS                                                       CLE031
     C           WFCPAM    ANDNE*ZERO                                                         CLE031
     C           WFCPAM    OREQ *ZERO                                                         CLE031
     C           SCPAM     ANDEQ*BLANKS                                                       CLE031
     C           WFCPAM    OREQ *ZERO                                                         CLE031
     C           SCPAM     ANDEQ*ZEROS                                                        CLE031
     C                     MOVE '1'       *IN49                                               CLE031
     C                     MOVEL'LEL0138' ZAMSID                                              CLE031
     C                     EXSR ZASNMS                                                        CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PRTCD     IFEQ *BLANKS                                                       CLE031
     C           WFCPAM    ANDNE*ZERO                                                         CLE031
      *                                                                                       CLE031
      ** Convert facility currency exchange rate to file format                               CLE031
      *                                                                                       CLE031
     C                     MOVE *BLANKS   PSCRF                                               CLE031
     C                     MOVE SFCXR     PSCRF                                               CLE031
     C                     Z-ADD8         PNDEC                                               CLE031
     C                     Z-ADD5         PNDIG                                               CLE031
     C                     CALL 'ZALIGN'  PPAR1                                               CLE031
      *                                                                                       CLE031
      ** ... move output PRVAL to ZALIGN parameter ZEXCH.                                     CLE031
      *                                                                                       CLE031
     C                     MOVE PRVAL     ZEXCH                                               CLE031
     C                     MOVE SCURR     ZCCYI                                               CLE031
     C                     MOVE FCCYF     ZCCYO                                               CLE031
     C                     MOVE WFCNBP    ZCDPI                                               CLE031
     C                     MOVE WCDPL     ZCDPO                                               CLE031
     C                     Z-ADDWFCPAM    ZAMTCI                                              CLE031
     C           SFMIN     IFEQ 'D'                                                           CLE031
     C                     MOVE 'M'       ZMD                                                 CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'D'       ZMD                                                 CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Convert facility currency principal amount to loan amount.                           CLE031
      ** If Facility Exchange Rate is not equal to zero.                                    AR882700
      *                                                                                       CLE031
     C           ZEXCH     IFNE *ZERO                                                       AR882700
      *                                                                                     AR882700
     C                     EXSR ZCONV                                                         CLE031
     C                     Z-ADDZAMTCO    WCFCPA 130                                          CLE031
      *                                                                                       CLE031
      ** Error if converted amount (WCFCPA) is not equal to principal                         CLE031
      ** amount.                                                                              CLE031
      *                                                                                       CLE031
     C           WCFCPA    IFNE WSVAM                                                         CLE031
     C           SCURR     ANDNEFCCYF                                                         219069
     C                     MOVE SCURR     ZCCYO                                               225272
     C                     MOVE FCCYF     ZCCYI                                               225272
     C                     MOVE WFCNBP    ZCDPO                                               225272
     C                     MOVE WCDPL     ZCDPI                                               225272
     C                     Z-ADDWSVAM     ZAMTCI                                              225272
     C                     MOVE SFMIN     ZMD                                                 225272
      *                                                                                       225272
      ** Convert current principal amount to facility amount.                                 225272
      *                                                                                       225272
     C                     EXSR ZCONV                                                         225272
     C                     Z-ADDZAMTCO    WLCPAM 130                                          225272
     C           WLCPAM    IFNE WFCPAM                                                        225272
     C                     MOVE '1'       *IN49                                               CLE031
     C**********           MOVEL'LEL0567' ZAMSID                                       CLE031 CAS011
     C                     MOVEL'LEL0800' ZAMSID                                              CAS011
     C                     EXSR ZASNMS                                                        CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                     AR882700
     C                     ENDIF                                                            AR882700
      *                                                                                       221941
      ** Error if facility and loan currencies are the same                                   221941
      *                                                                                       221941
     C           SCURR     IFEQ FCCYF                                                         221941
     C           WCFCPA    ANDNE*ZEROS                                                        221941
     C                     MOVE '1'       *IN49                                               221941
     C                     MOVEL'LEL0579' ZAMSID                                              221941
     C                     EXSR ZASNMS                                                        221941
     C                     ENDIF                                                              225272
     C                     ENDIF                                                              221941
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *
      ** VALIDATE DEAL DATE
      *
     C**********           MOVELSDDAT     WNUM7                                               CSD027
     C**********           MOVELWNUM7     WALF6                                               CSD027
     C                     MOVELSDDAT     WNUM7   70                                          CSD027
     C                     MOVELWNUM7     WALF6   6                                           CSD027
     C                     MOVE SDDAT     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    WSVDD   50
     C           *IN99     IFEQ '1'
     C           SDDAT     ORNE WALF6
     C                     MOVE '1'       *IN40
     C                     MOVEL'LEL0026' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      *
      ** validate relationships if deal date is valid
      ** ... must be earlier than or equal to rundate (except for
      ** principal transfer)
      *
     C********** WSVDD     IFGT BJRDNB                                                        CSC011
     C           WSVDD     IFGT WRNDAY                                                        CSC011
     C           PMODE     IFEQ 'B'
     C           PGNTF     ANDEQ'Y'
     C           GPRT      OREQ 'Y'
     C                     ELSE
     C                     MOVE '1'       *IN40
     C                     MOVEL'LEL0027' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... must not be a holiday in local currency
      *
     C                     ELSE
     C                     Z-ADDWSVDD     ZDAYNO
     C                     MOVE BJLCCY    ZCCY
     C                     MOVE WLCCD     ZLOC
     C                     EXSR ZCHKH
     C           ZIND      IFEQ 'H'
     C           SACTN     ANDEQ'I'
     C           PMODE     IFEQ 'B'                                                           227374
     C           PGNTF     ANDEQ'Y'                                                           227374
     C           GPRT      OREQ 'Y'                                                           227374
     C                     ELSE                                                               227374
     C                     MOVE '1'       *IN40
     C                     MOVEL'LEL0029' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF                                                              227374
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** VALIDATE AUTO-SETTLE INDICATOR
      *
     C           SAUTO     IFEQ *BLANK
     C                     MOVE 'N'       SAUTO
     C                     ELSE
     C           SAUTO     IFNE 'Y'
     C           SAUTO     ANDNE'N'
     C                     MOVE '1'       *IN41
     C                     MOVEL'LEL0061' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *                                                                                       204347
      ** Check if Autosettle indicator has been changed on amend mode.                        204347
      *                                                                                       204347
     C                     MOVE 'N'       WAUTOA  1                                           204347
     C                     MOVE *BLANKS   WAUTOY  1                                           204347
     C           SACTN     IFEQ 'A'                                                           204347
     C           SAUTO     IFNE AUTO                                                          204347
     C           SAUTO     ANDNE*BLANKS                                                       204347
     C                     MOVE 'Y'       WAUTOA                                              204347
      *                                                                                       204347
      ** Check whether amendment is from AUTOSETTLE to NON-AUTOSETTLE                         204347
      ** or vice versa.                                                                       204347
      *                                                                                       204347
     C           AUTO      IFEQ 'Y'                                                           204347
     C           SAUTO     ANDEQ'N'                                                           204347
     C                     MOVE '1'       WAUTOY                                              204347
     C                     ELSE                                                               204347
     C                     MOVE '2'       WAUTOY                                              204347
     C                     ENDIF                                                              204347
     C                     ELSE                                                               204347
     C                     MOVE 'N'       WAUTOY                                              204347
     C                     ENDIF                                                              204347
     C                     ENDIF                                                              204347
      *
      ** ... cannot be 'Y' if stop accruals is set or amended today
      *
     C           SAUTO     IFEQ 'Y'
     C           SACTN     ANDEQ'A'
     C                     TESTB'3'       LONI           97
     C           *IN97     IFEQ '1'
     C                     TESTB'2'       ACEI       97
     C           *IN97     IFEQ '1'
     C                     MOVE '1'       *IN41
     C                     MOVEL'LEL0061' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CLE034
      ** Validate Settlement Allocation                                                       CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE 'Y'       WVSTAL  1                                           CLE034
      *                                                                                       CLE034
      ** Must be 'Y' or 'N', defaults to 'N' when left blank                                  CLE034
      *                                                                                       CLE034
     C           SSTAL     IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'N'       SSTAL                                               CLE034
     C                     ELSE                                                               CLE034
     C           SSTAL     IFNE 'Y'                                                           CLE034
     C           SSTAL     ANDNE'N'                                                           CLE034
     C                     MOVE 'N'       WVSTAL                                              CLE034
     C**********           MOVEL'LEL0568' ZAMSID                                       CLE034 CAS011
     C                     MOVEL'LEL0801' ZAMSID                                              CAS011
     C                     EXSR ZASNMS                                                        CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *
      ** VALIDATE VALUE DATE
      ** ... validations relating to facility will be ignored for
      ** parts sold as it does not have this field
      *
     C                     MOVELSVDAT     WNUM7
     C                     MOVELWNUM7     WALF6
     C                     MOVE SVDAT     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    WSVVD   50
     C           *IN99     IFEQ '1'
     C           SVDAT     ORNE WALF6
     C                     MOVE '1'       *IN42
     C                     MOVEL'LEL0150' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      *
      ** ... must be on or later than 'date approved' of facility
      *
     C           *IN22     IFEQ '0'
     C           *IN34     ANDEQ'0'
     C***********WSVVD     ANDLTDTAPF                                     120670
     C           WSVVD     IFLT DTAPF                                     120670
     C                     MOVE '1'       *IN42
     C                     MOVEL'LEL0233' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF                                          120670
      *                                                                   121718
      ** ... must be on or later than 'date committed' of facility        121718
      *                                                                   121718
     C           WSVVD     IFLT COMDF                                     121718
     C                     MOVE '1'       *IN42                           121718
     C                     MOVEL'LEL0237' ZAMSID                          121718
     C                     EXSR ZASNMS                                    121718
     C                     ENDIF                                          121718
      *                                                                   120670
      * Must not be later than 'Last Availability Date' of facility       120670
     C           WSVVD     IFGT AVLD                                      120670
     C           AVLD      ANDNE*ZERO                                     120670
      *************************************************************153787 156297
      ****Skip*this*validation*if*fclty*has*been*reactivated.******153787 156297
     C***********WREAC     ANDEQ*OFF                               153787 156297
     C           PMODE     IFEQ 'B'                                                           227374
     C           PGNTF     ANDEQ'Y'                                                           227374
     C           GPRT      OREQ 'Y'                                                           227374
     C                     ELSE                                                               227374
     C                     MOVE *ON       *IN42                           120670
     C                     MOVEL'LEL0236' ZAMSID                          120670
     C                     EXSR ZASNMS                                    120670
     C                     ENDIF                                                              227374
     C                     ENDIF                                          120670
      *                                                                   120670
     C           TRCA      IFEQ 'TR'                                                          190132
      *                                                                                       190132
     C           CRAKEY    CHAINLEFCLTLD             89                                       190132
      *                                                                                       190132
      ** If credit agreement facility record is not found, show                               190132
      ** error message.                                                                       190132
      *                                                                                       190132
     C           *IN89     IFEQ '1'                                                           190132
     C                     MOVE '1'       *IN34                                               190132
     C                     MOVEL'LEL0134' ZAMSID                                              190132
     C                     EXSR ZASNMS                                                        190132
     C                     ENDIF                                                              190132
      *                                                                                       190132
     C           WSVVD     IFGT AVLDB                                                         190132
     C           AVLDB     ANDNE0                                                             190132
     C                     MOVE '1'       *IN42                                               190132
     C                     MOVEL'LEL0518' ZAMSID                                              190132
     C                     EXSR ZASNMS                                                        190132
     C                     ENDIF                                                              190132
     C                     ENDIF                                                              190132
      *                                                                                       190132
     C                     ENDIF
      *
      ** ... deal date must be earlier than or equal to value date
      *
     C           WSVDD     IFGT WSVVD
     C                     MOVE '1'       *IN40
     C                     MOVEL'LEL0028' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *                                                                   159256
      ** ... issue warning if loan or part purchased is being inserted    159256
      **     against a syndicated facility.                               159256
      *                                                                   159256
     C                     MOVE *IN34     W1IN34  1                       159256
      *                                                                   159256
     C           PMODE     IFEQ 'I'                                       159256
     C           SACTN     ANDEQ'I'                                       159256
      *                                                                   159256
     C           W1IN34    IFEQ '0'                                       159256
     C           *IN22     ANDEQ'0'                                       159256
      *                                                                   159256
     C           WE232     IFEQ *BLANK                                    159256
     C           WE232     OREQ 'Y'                                       159256
     C           SFCUS     ANDNEW1CNUM                                    159256
     C           WE232     OREQ 'Y'                                       159256
     C           SFTYP     ANDNEW1FACT                                    159256
     C           WE232     OREQ 'Y'                                       159256
     C           SFSEQ     ANDNEW1FCNO                                    159256
     C                     MOVE SFCUS     W1CNUM  6                       159256
     C                     MOVE SFTYP     W1FACT  3                       159256
     C                     MOVE SFSEQ     W1FCNO  2                       159256
      *                                                                   159256
     C           SYINF     IFEQ 'Y'                                       159256
     C                     MOVE 'LEM0232' ZAMSID                          159256
     C                     EXSR ZASNMS                                    159256
     C                     MOVE 'Y'       WE232                           159256
     C                     MOVE 'Y'       WWARN                           159256
     C                     MOVE '1'       *IN,34                          159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDIF                                          159256
     C                     ENDIF                                          159256
      *
      ** ... issue a warning message if facility amount has been
      ** exceeded, (for loans and parts purchased)
      *
     C************IN34     IFEQ '0'                                       159256
     C           W1IN34    IFEQ '0'                                       159256
     C           *IN38     ANDEQ'0'                                       123859
     C           *IN39     ANDEQ'0'
     C           *IN42     ANDEQ'0'
     C           *IN22     ANDEQ'0'
     C           WSVAM     ANDGT*ZEROS
     C/COPY WNCPYSRC,LE2030C039
      *
      ** Check if this is an Internal Part Purchased.  If it is, amount   157634
      ** validation should be against the internal customer's facility.   157634
      ** (If IPP, Mirror Loan No. will be valid - *IN15 will be off).     157634
     C           *IN15     IFEQ *OFF                                      157634
     C           SMLNR     ANDNE*BLANKS                                   157634
     C********** SMLNR     ANDNE'000000'                                               CLE031 CLE148
     C***********          MOVE SBRCA     K#BRCA                   157634 201165
     C                     MOVE BRCAF     K#BRCA                          201165
     C                     MOVE SFCUS     K#PMFC                          157634
     C                     MOVE SFTYP     K#PMFT                          157634
     C                     MOVE SFSEQ     K#PMFN                          157634
     C                     MOVE A8BICN    K#CNUM                          157634
     C           K#FUND    CHAINLEFCLTL2             89                   157634
      *                                                                   157634
      ** If record not found, there is no Internal Participant - Error    159355
     C           *IN89     IFEQ *ON                                       157634
     C                     MOVE '1'       *IN34                           159355
     C                     MOVEL'LEL0293' ZAMSID                          159355
     C                     EXSR ZASNMS                                    159355
     C************LOCK     IN   LDA                                 157634159355
     C***********          MOVEL'LEFCLTL2'DBFILE           ******** 157634159355
     C***********          Z-ADD47        DBASE            * DBERR  157634159355
     C***********          MOVELKEY47     DBKEY            ******** 157634159355
     C***********          OUT  LDA                                 157634159355
     C***********          EXSR *PSSR                               157634159355
     C                     ELSE                                           157634
      *                                                                   157634
      ** If CHAIN was successful, must access FCLTYFN details too.        157634
      *                                                                   180051
     C           SACTN     IFEQ 'I'                                       180051
      *                                                                   180051
      ** Save value of *IN01                                              180051
      *                                                                   180051
     C                     MOVE *IN01     WIN01   1                       180051
     C                     MOVE '0'       *IN01                           180051
     C**********           MOVE SMLNR     WSMLNR  60                                   180051 CLE148
     C                     MOVE SMLNR     WSMLNR  6                                           CLE148
      *                                                                   180051
      ** Search for the mirror loan in CLOANCL and get the loan's         180051
      ** current principal amount and part sold amount.                   180051
      *                                                                   180051
     C           1         SETLLCLOANLJ                                   180051
     C                     READ CLOANLJ                  01               180051
      *                                                                   180051
     C           *IN01     DOWEQ'0'                                       180051
      *                                                                   180051
     C           WSMLNR    IFEQ LNRFX                                     180051
     C                     Z-ADDCPAMX     WCPAMX 130                      180051
     C                     Z-ADDPSAMX     WPSAMX 130                      180051
     C                     MOVE '1'       *IN01                           180051
     C                     ELSE                                           180051
     C                     READ CLOANLJ                  01               180051
     C                     ENDIF                                          180051
      *                                                                   180051
     C                     ENDDO                                          180051
      *                                                                   180051
     C                     MOVE '0'       *IN01                           180051
      *                                                                   180051
     C           WSMLNR    SETLLLOAMS                                     180051
     C           WSMLNR    READELOAMS                    01               180051
      *                                                                   180051
     C           *IN01     DOWEQ'0'                                       180051
     C           VDATA     ANDLEWSVVD                                     180051
      *                                                                   180051
     C           RECIA     IFEQ 'D'                                       180051
      *                                                                   180051
     C           AMTPA     IFEQ 'PI'                                      180051
     C           AMTPA     OREQ 'PT'                                      180051
     C                     ADD  PRAM      WCPAMX                          180051
     C                     ENDIF                                          180051
      *                                                                   180051
     C           AMTPA     IFEQ 'PF'                                      180051
     C           AMTPA     OREQ 'RE'                                      180051
     C           AUTO      ANDEQ'Y'                                       180051
     C           AMTPA     OREQ 'MR'                                      180051
     C                     SUB  PRAM      WCPAMX                          180051
     C                     ENDIF                                          180051
      *                                                                   180051
     C                     ENDIF                                          180051
      *                                                                   180051
     C           WSMLNR    READELOAMS                    01               180051
     C                     ENDDO                                          180051
      *                                                                   180051
      ** Search for loans attached to the mirror loan number to get the   181775
      ** loan's available amount to date.                                 181775
      *                                                                   181775
     C                     MOVE '0'       *IN01                           181775
     C           1         SETLLCLOANLJ                                   181775
     C                     READ CLOANLJ                  01               181775
      *                                                                   181775
     C           *IN01     DOWEQ'0'                                       181775
      *                                                                   181775
     C           RECIX     IFEQ 'D'                                       181775
      *                                                                   181775
     C********** WSMLNR    IFEQ OLNOX                                                  181775 CSD027
     C                     MOVE OLNOX     OLNOA                                               CSD027
     C           WSMLNR    IFEQ OLNON                                                         CSD027
     C           WSMLNR    OREQ MLNRX                                     181775
      *                                                                   181775
      ** Check for the amendments made against the participations sold    178920
      ** loan/ IPP loan.                                                  178920
      *                                                                   178920
     C                     MOVE '0'       *IN01                           178920
      *                                                                   178920
     C           LNRFX     SETLLLOAMS                                     178920
     C           LNRFX     READELOAMS                    01               178920
      *                                                                   178920
      ** Check the amendments for the loan with value date less than or   178920
      ** equal to the loan's (to be inserted) value date.                 178920
      *                                                                   178920
     C           *IN01     DOWEQ'0'                                       178920
     C           VDATA     ANDLEWSVVD                                     178920
      *                                                                   178920
     C           RECIA     IFEQ 'D'                                       178920
      *                                                                   178920
      ** for loans attached to the original/mirror loan, if amendment     178920
      ** type is PI, add the principal amount to the loan's CPAM then     178920
      ** add the same amount to the orignal/mirror loan's part sold       178920
      *                                                                   178920
     C           AMTPA     IFEQ 'PI'                                      178920
     C                     ADD  PRAM      CPAMX                           178920
     C                     ADD  PRAM      WPSAMX                          178920
     C                     ENDIF                                          178920
      *                                                                   178920
      ** If amendment type is PT, add the amount to the loan's CPAM       178920
      ** PSAM should not be updated because it was already updated in     178920
      ** menu PTMN.                                                       178920
      *                                                                   178920
     C           AMTPA     IFEQ 'PT'                                      178920
     C                     ADD  PRAM      CPAMX                           178920
     C                     ENDIF                                          178920
      *                                                                   178920
      ** If amendment type is PF, deduct the amount to the loan's CPAM    178920
      ** PSAM should not be updated because it was already updated in     178920
      ** menu PTMN.                                                       178920
      *                                                                   178920
     C           AMTPA     IFEQ 'PF'                                      178920
     C                     SUB  PRAM      CPAMX                           178920
     C                     ENDIF                                          178920
      *                                                                   178920
      ** If AMTP is MR/RE, deduct amount from loan's CPAM and from the    178920
      ** orginal/mirror loan's PSAM.                                      178920
      *                                                                   178920
     C           AMTPA     IFEQ 'RE'                                      178920
     C           AUTO      ANDEQ'Y'                                       178920
     C           AMTPA     OREQ 'MR'                                      178920
     C                     SUB  PRAM      CPAMX                           178920
     C                     SUB  PRAM      WPSAMX                          178920
     C                     ENDIF                                          178920
      *                                                                   178920
     C                     ENDIF                                          178920
      *                                                                   178920
     C           LNRFX     READELOAMS                    01               178920
     C                     ENDDO                                          178920
      *                                                                   178920
     C                     MOVE '0'       *IN01                           178920
      *                                                                   178920
     C           MDATX     IFLE WSVVD                                     181775
     C           MDATX     ANDGT0                                         181775
     C           AUTOX     ANDEQ'Y'                                       181775
      *                                                                   181775
      ** Subtract principal amount of maturing part sold loan from the    181775
      ** original loan's part sold amount.                                181775
      *                                                                   181775
     C           WPSAMX    SUB  CPAMX     WPSAMX                          181775
     C                     ENDIF                                          181775
     C                     ENDIF                                          181775
      *                                                                   181775
     C                     ENDIF                                          181775
      *                                                                   181775
     C                     READ CLOANLJ                  01               181775
     C                     ENDDO                                          181775
      *                                                                   181775
     C           WCPAMX    SUB  WPSAMX    WCPAMX                          180051
      *                                                                   180051
     C           WSVAM     IFGT WCPAMX                                    180051
     C                     MOVE '1'       *IN39                           180051
     C                     MOVEL'LEL0119' ZAMSID                          180051
     C                     EXSR ZASNMS                                    180051
     C                     ENDIF                                          180051
      *                                                                   180051
     C                     MOVE WIN01     *IN01                           180051
      *                                                                   180051
     C                     ENDIF                                          180051
      *                                                                   180051
     C                     MOVE CNUM      WFCNUM                          157634
     C                     MOVE FACT      WFFACT                          157634
     C                     MOVE FCNO      WFFCNO                          157634
     C                     MOVE 'B'       WFRCTP                          157634
     C           WKFAC     CHAINFCLTY               N89                   157634
     C                     ENDIF                                          157634
      *                                                                   157634
     C                     ENDIF                                          157634
      *                                                                   157634
     C                     MOVE FCCYF     PCURR
     C                     CALL 'AOCURRR0'PPAR5
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD34        DBASE            * DBERR 34 *
     C                     MOVELFCCYF     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** ... determine cross rate and mult/div indicator
      *
     C                     Z-ADDA6NBDP    WCDPF   10
      *                                                                                       CLE023
      ** Save currency details.                                                               CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     MOVE PCURR     ZCCYO                                               CLE023
     C                     Z-ADDA6SPRT    ZRATE2                                              CLE023
     C                     MOVE A6MDIN    ZMDI2                                               CLE023
     C                     Z-ADDA6NBDP    ZCDPO                                               CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C***********WSVIN     IFEQ 'M'                                       123227
     C                     SELEC                                          147999
     C           FCCYF     WHNE BJCYCD                                    147999
     C           A6MDIN    IFEQ 'M'                                       123227
     C***********A6SPRT    ANDNE1                                  152176 147999
     C***********A6MDIN    OREQ 'D'                                152176 147999
     C***********A6SPRT    ANDNE1                                  152176 147999
     C                     MOVE 'D'       WFMIN   1
     C                     ELSE
     C                     MOVE 'M'       WFMIN
     C                     ENDIF
     C           A6MDIN    IFEQ 'M'
     C           WSVIN     ANDEQ'M'
     C***********A6SPRT    ANDNE1                                  152176 147999
     C           A6MDIN    OREQ 'D'
     C           WSVIN     ANDEQ'D'
     C***********A6SPRT    ANDNE1                                  152176 147999
     C           A6SPRT    DIV  WSVRT     WSVFX     H
     C                     ELSE
     C           A6SPRT    MULT WSVRT     WSVFX     H
     C                     ENDIF
     C                     MOVE 'Y'       WFLAG                           147999
      *                                                                   152176
     C                     OTHER                                          147999
     C                     Z-ADDWSVRT     WSVFX                           147999
     C***********A6SPRT    IFEQ 1                                  152176 147999
     C***********WSVIN     ANDEQ'M'                                152176 147999
     C           WSVIN     IFEQ 'M'                                       147999
     C                     MOVE 'N'       WFLAG   1                       152176
     C                     MOVE 'M'       WFMIN                           147999
     C                     ELSE                                           152176
     C                     MOVE 'Y'       WFLAG                           152176
     C                     MOVE 'D'       WFMIN                           152176
     C                     ENDIF                                          152176
     C                     ENDSL                                          147999
      *
      ** Determine facility currency equivalent
      *
     C                     EXSR SRFEQV
     C                     MOVE FCCYF     ZCCY
     C                     MOVE ' '       ZFREQ
     C                     Z-ADD0         ZMDAY
     C                     Z-ADD99999     ENDAY
     C                     Z-ADDWSVVD     DAYNO
     C                     MOVE *BLANK    ZLOC
     C                     Z-ADDWOPAMF    FCBAL
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     ADD  WFLTIF    FCBAL                                               CLE028
     C                     ADD  WCHGAF    FCBAL                                               CLE028
     C                     ENDIF                                                              CLE028
     C                     MOVE 'A'       WFUPD
     C                     MOVE 'Y'       WFUAV
     C                     Z-ADDFCBAL     WRK13
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDWXSVAM    FXCBAL                                              CLE023
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     ADD  WFLTIF    FXCBAL                                              CLE028
     C                     ADD  WCHGAF    FXCBAL                                              CLE028
     C                     ENDIF                                                              CLE028
     C                     Z-ADDFXCBAL    WRK14                                               CLE023
     C                     ENDIF                                                              CLE023
     C           SACTN     IFEQ 'I'                                       125323
     C                     EXSR SRFEXP
     C                     ENDIF                                          125323
      *                                                                   CLE005
      ** ... consider facility amendments in determining facility         CLE005
      ***amount*if*CLE005*and*CLE006*are*installed***              CLE005 171863
      ** amount if CLE005 and CLE007 are installed                        171863
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C***********CLE006    ANDEQ'Y'                                CLE005 171863
     C           CLE007    ANDEQ'Y'                                       171863
     C           WKFAM     SETLLLEFCAML7                                  CLE005
     C           WKFAM     READELEFCAML7                 89               CLE005
     C           *IN89     DOWEQ'0'                                       CLE005
     C           VLDT      ANDLEWSVVD                                     CLE005
     C           FATP      IFEQ 'FI'                                      CLE005
     C                     ADD  AAMT      FAMT                            CLE005
     C                     ELSE                                           CLE005
     C                     SUB  AAMT      FAMT                            CLE005
     C                     ENDIF                                          CLE005
     C           WKFAM     READELEFCAML7                 89               CLE005
     C                     ENDDO                                          CLE005
     C                     ENDIF                                          CLE005
      *
     C           OVPC      ADD  100       WRK85   85
     C                     DIV  100       WRK85
     C                     MULT WRK85     FAMT      H
     C                     Z-ADD1         S
      *
     C           S         DOWLE10
     C           RUNS,S    ANDLEDTEXF
     C           RUNS,S    IFGE WSVVD
     C           FAMT      ANDLTOAM,S
     C           WREAC     ANDEQ*OFF                                      153787
     C           RUNS,S    ORGE WSVVD                                     153787
     C           FAMT      ANDLTWOAM                                      153787
     C           WREAC     ANDEQ*ON                                       153787
     C           WE003     IFEQ *BLANK
     C           WE003     OREQ 'Y'
     C           WSVAM     ANDNEW1AM
     C                     Z-ADDWSVAM     W1AM   130
     C                     MOVE 'Y'       WE003   1
     C                     MOVE 'W'       WRMSV
     C                     MOVE 'Y'       WWARN
     C                     MOVE '1'       *IN39
     C                     MOVEL'LEL0069' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'E'       WRMSV
     C                     LEAVE
     C                     ENDIF
     C           WREAC     IFEQ *ON                                       153787
     C                     LEAVE                                          153787
     C                     ENDIF                                          153787
     C                     ENDIF
     C                     ADD  1         S
     C                     ENDDO
     C/COPY WNCPYSRC,LE2030C038
      *
      ** Issue a warning message if loan amount will exceed the                               194864
      ** credit agreement facility amount                                                     194864
     C           TRCA      IFEQ 'TR'                                                          194864
     C           CRAKEY    CHAINLEFCLTLC             89                                       194864
      ** If credit agreement 'B' facility record is not found,                                194864
      ** show error message.                                                                  194864
     C           *IN89     IFEQ '1'                                                           194864
     C                     MOVE '1'       *IN34                                               194864
     C                     MOVEL'LEL0134' ZAMSID                                              194864
     C                     EXSR ZASNMS                                                        194864
     C                     ENDIF                                                              194864
      ** If found, validate if the loan amount will                                           194864
      ** make the Credit Agreement facility amount                                            194864
      ** to be exceeded.                                                                      194864
     C           *IN89     IFEQ '0'                                                           194864
     C           SACTN     ANDNE'I'                                                           194864
     C                     Z-ADD0         WTSUM  130                                          194864
     C                     Z-ADD1         S                                                   194864
     C           S         DOWLE10                                                            194864
     C           CRAKEY    CHAINLEFCLTLC             89                                       194864
     C                     Z-ADDOAMC,S    WTSUM                                               194864
      ** Validate the drawn amount against the Credit Agreement                               194864
      ** facility amount. Issue a warning message if CA has been                              194864
      ** exceeded.                                                                            194864
     C           RUNC,S    IFGE WSVVD                                                         194864
     C           WTSUM     ANDGTFAMTB                                                         194864
     C           WE513     IFEQ ' '                                                           194864
     C           WE513     OREQ 'Y'                                                           194864
     C           WSVAM     ANDNEWOSVAM                                                        194864
     C           WE513     OREQ 'Y'                                                           194864
     C           WSVVD     ANDNEWOSVVD                                                        194864
     C                     Z-ADDWSVAM     WOSVAM 130                                          194864
     C                     Z-ADDWSVVD     WOSVVD  50                                          194864
     C                     MOVE 'Y'       WE513   1                                           194864
     C                     MOVE 'W'       WRMSV                                               194864
     C                     MOVE 'Y'       WWARN                                               194864
     C                     MOVE '1'       *IN39                                               194864
     C                     MOVEL'LEL0520' ZAMSID                                              194864
     C                     EXSR ZASNMS                                                        194864
     C                     MOVE 'E'       WRMSV                                               194864
     C                     LEAVE                                                              194864
     C                     ENDIF                                                              194864
     C                     ENDIF                                                              194864
     C                     ADD  1         S                                                   194864
     C                     Z-ADD0         WTSUM                                               194864
     C                     ENDDO                                                              194864
     C                     ENDIF                                                              194864
     C                     ENDIF                                                              194864
      *                                                                                       194864
      ** If Internal Part. Purch., restore original borrower's facility   157634
      ** details.                                                         157634
     C           *IN15     IFEQ *OFF                                      157634
     C           SMLNR     ANDNE*BLANKS                                   157634
     C                     MOVE SFCUS     WFCNUM                          157634
     C                     MOVE SFTYP     WFFACT                          157634
     C                     MOVE SFSEQ     WFFCNO                          157634
     C                     MOVE 'A'       WFRCTP                          157634
     C           WKFAC     CHAINFCLTY               N89                   157634
     C                     ENDIF                                          157634
      *                                                                   157634
     C                     ENDIF
      *                                                                   122685
      *  Facility amount corrupted. Need to deduct amount after           122685
      *  validation.                                                      122685
      *                                                                   122685
     C                     MOVE 'Y'       NYET    1                       141200
      *                                                                   141200
     C                     MOVE 'S'       WFUPD                           122685
     C                     MOVE 'Y'       WFUAV                           122685
     C                     Z-ADDFCBAL     WRK13                           122685
     C                     EXSR SRFEXP                                    122685
      *                                                                   141200
     C                     MOVE 'N'       NYET    1                       141200
      *
      ** VALIDATE RECOURSE INDICATOR (for parts purchased/sold only)
      *
     C           *IN21     IFEQ '1'
     C           *IN22     OREQ '1'
     C           SRCSI     IFEQ *BLANK
     C                     MOVE 'N'       SRCSI
     C                     ELSE
     C           SRCSI     IFNE 'Y'
     C           SRCSI     ANDNE'N'
     C                     MOVE '1'       *IN43
     C                     MOVEL'LEL0173' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                   158856
      ** Do not allow recourse indicator = 'Y' if Risk Purchased/Sold     158856
      *                                                                   158856
     C********** *IN43     IFEQ '0'                                       158856            BUG22318
     C********** SRCSI     ANDEQ'Y'                                       158856            BUG22318
     C********** WLNPT     IFEQ 71                                        158856            BUG22318
     C********** WLNPT     OREQ 72                                        158856            BUG22318
     C**********           MOVE '1'       *IN43                           158856            BUG22318
     C**********           MOVEL'LEL0507' ZAMSID                          158856            BUG22318
     C**********           EXSR ZASNMS                                    158856            BUG22318
     C**********           ENDIF                                          158856            BUG22318
     C**********           ENDIF                                          158856            BUG22318
      *                                                                   158856
     C                     ENDIF
      *
     C                     ELSE
     C                     MOVE 'N'       SRCSI
     C                     ENDIF
      *
      ** VALIDATE MATURITY DATE
      *
     C                     Z-ADD*ZEROS    WSVMD
     C           SMDAT     IFNE *BLANKS
      *
      ** ... must be blank for call or demand loans during insert
      *
     C           SACTN     IFEQ 'I'
     C           WLNPT     ANDEQ61
     C           SACTN     OREQ 'I'                                       CLE005
     C           WLNPT     ANDEQ68                                        CLE005
     C           SACTN     OREQ 'I'                                       CLE005
     C           WLNPT     ANDEQ69                                        CLE005
     C           SACTN     OREQ 'I'                                       CLE005
     C           WLNPT     ANDEQ72                                        CLE005
     C           W72TP     ANDEQ'69'                                      CLE005
     C                     MOVE '1'       *IN44
     C                     MOVEL'LEL0130' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... must be numeric
      *
     C           *IN44     IFEQ '0'
     C                     MOVELSMDAT     WNUM7
     C                     MOVELWNUM7     WALF6
     C                     MOVE SMDAT     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    WSVMD   50
     C           *IN99     IFEQ '1'
     C           SMDAT     ORNE WALF6
     C                     MOVE '1'       *IN44
     C                     MOVEL'LEL0128' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** ... for non-call/demand loans, maturity date must be input
      *
     C                     ELSE
     C           *IN36     IFEQ '0'
     C           WLNPT     ANDNE61
     C           WLNPT     ANDNE68                                        CLE005
     C           WLNPT     ANDNE69                                        CLE005
     C           WLNPT     ANDNE72                                        CLE005
     C           *IN36     OREQ '0'                                       CLE005
     C           WLNPT     ANDEQ72                                        CLE005
     C           W72TP     ANDNE'69'                                      CLE005
     C                     MOVE '1'       *IN44
     C                     MOVEL'LEL0128' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** If maturity date is valid and non-zero, continue with the
      ** rest of the validation
      *
     C           *IN44     IFEQ '0'
     C           WSVMD     ANDNE*ZEROS
      *
      ** .. must be later than value date
      *
     C           *IN42     IFEQ '0'
     C           WSVMD     ANDLEWSVVD
     C                     MOVE '1'       *IN44
     C                     MOVEL'LEL0129' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... must be on or earlier than expiry date of facility
      *
     C           *IN22     IFEQ '0'
     C           *IN34     ANDEQ'0'
     C           WSVMD     ANDGTDTEXF
     C                     MOVE '1'       *IN44
     C                     MOVEL'LEL0234' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C           SACTN     IFNE 'I'
     C                     EXSR SRMATY
     C                     ENDIF
     C                     ENDIF
      *
     C/COPY WNCPYSRC,LE2030C088
      ** ADDITIONAL VALIDATION FOR PARTS SOLD
      ** ... when sale of loan number is valid
      *
     C           PMODE     IFEQ 'B'                                       122718
     C           SACTN     ANDEQ'R'                                       122718
     C           W#SEQ     ANDEQ1                                         122718
     C           PMODE     ORNE 'B'                                       122718
     C           PMODE     OREQ 'B'                                       122718
     C           SACTN     ANDNE'R'                                       122718
      *                                                                   122718
     C           *IN22     IFEQ '1'
     C           *IN37     ANDEQ'0'
     C                     EXSR SRSOLD
     C                     ENDIF
     C                     ENDIF                                          122718
      *
      ** VALIDATE AUTO-PAY AT MATURITY INDICATOR (for S01465)
      *
     C           S01465    IFEQ 'Y'
     C           SAPMI     IFNE *BLANK
     C           SAPMI     ANDNE'Y'
     C           SAPMI     ANDNE'N'
     C                     MOVE '1'       *IN45
     C                     MOVEL'LEL0111' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ***...*must*be*'Y'*for*guarantees******************                                     183896
      *
     C********** WLNPT     IFEQ 70                                                            183896
     C********** *IN34     ANDEQ'0'                                                           183896
     C********** SAPMI     ANDNE'Y'                                                           183896
     C********** SAPMI     ANDNE' '                                       158084              183896
     C********** WLNPT     OREQ 71                                        CLE005              183896
     C********** *IN34     ANDEQ'0'                                       CLE005              183896
     C********** SAPMI     ANDNE'Y'                                       CLE005              183896
     C********** SAPMI     ANDNE' '                                       158084              183896
     C**********           MOVE '1'       *IN45                                               183896
     C**********           MOVEL'LEL0037' ZAMSID                                              183896
     C**********           EXSR ZASNMS                                                        183896
     C**********           ENDIF                                                              183896
      *
      ** ... cannot be changed from 'Y' to 'N' if telex has been prod
      *
     C           *IN45     IFEQ '0'
     C           SACTN     ANDEQ'A'
     C           APMI      ANDEQ'Y'
     C           SAPMI     ANDEQ'N'
     C                     TESTB'1'       TLXI           97
     C           *IN97     IFEQ '1'
     C                     MOVE '1'       *IN45
     C**********           MOVEL'LEL0117' ZAMSID                                              204247
     C                     MOVEL'LEL0538' ZAMSID                                              204247
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
     C           *IN45     IFEQ '0'
     C           SAPMI     ANDEQ*BLANK
     C                     MOVE 'Y'       SAPMI
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE MULTI-CURRENCY ROLLOVERS ALLOWED
      ***(for*loans*and*parts*purchased)*******************************   120025
      ** ... must be 'Y' or 'N' when entered
      ** ... 'Y' is only for facilities defined as multi-currency
      ** ... for parts sold, default from original loan's value           120025
      *
     C************IN22     IFEQ '0'                                       120025
      *
     C           SMCRA     IFEQ *BLANK
     C                     MOVE 'N'       SMCRA
     C********** *IN22     IFEQ '1'                                                    120025 202101
     C           MCRAM     IFNE *BLANK                                                        202101
     C                     MOVE MCRAM     SMCRA                           120025
     C                     ENDIF                                          120025
     C                     ENDIF
      *
     C           SMCRA     IFNE 'Y'
     C           SMCRA     ANDNE'N'
     C           SMCRA     OREQ 'Y'
     C           MCCYF     ANDNE'Y'
     C           MCRAM     ANDEQ*BLANK                                                        202101
     C********** *IN22     ANDEQ'0'                                                    120025 202101
     C********** LPFI      ANDNE'I'                                                    192790 202101
     C********** SMCRA     OREQ 'Y'                                                    120025 192790
     C********** MCRAM     ANDNE'Y'                                                    120025 192790
     C********** *IN22     ANDEQ'1'                                                    120025 192790
     C                     MOVE '1'       *IN46
     C                     MOVEL'LEL0408' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                                       192790
      ** Check multi-currency indicator from its attached loan or                             192790
      ** facility and display another error message.                                          192790
      *                                                                                       192790
     C********** *IN22     IFEQ '1'                                                    192790 202101
     C********** LPFI      OREQ 'I'                                                    192790 202101
     C           MCRAM     IFNE *BLANK                                                        202101
     C           SMCRA     IFNE MCRAM                                                         192790
     C                     MOVE '1'       *IN46                                               192790
     C                     MOVEL'LEL0515' ZAMSID                                              192790
     C                     EXSR ZASNMS                                                        192790
     C                     ENDIF                                                              192790
     C                     ENDIF                                                              192790
      *                                                                   132162
      ** Allow a value of 'Y' only for loan processing types which        132162
      ** are allowed to have rollovers                                    132162
      ** Following code not valid anymore                                 202402
      *                                                                   132162
     C************IN46     IFEQ '0'                                                    132162 202402
     C***********SMCRA     ANDEQ'Y'                                                    132162 202402
     C***********WLNPT     IFEQ 61                                                     132162 202402
     C***********WLNPT     OREQ 70                                                     132162 202402
     C***********WLNPT     OREQ 68                                                     132162 202402
     C***********CLE005    ANDEQ'Y'                                                    132162 202402
     C***********WLNPT     OREQ 71                                                     132162 202402
     C***********CLE005    ANDEQ'Y'                                                    132162 202402
     C***********CEU020    IFEQ 'Y'                                                    169212 202402
     C***********WINFL     ANDNE'Y'                                                    169212 202402
     C***********CEU020    ORNE 'Y'                                                    169212 202402
     C***********          MOVE '1'       *IN46                                        132162 202402
     C***********          MOVEL'LEL0423' ZAMSID                                       132162 202402
     C***********          EXSR ZASNMS                                                 132162 202402
     C*********************ENDIF                                                       169212 202402
     C*********************ENDIF                                                       132162 202402
     C*********************ENDIF                                                       132162 202402
      *                                                                                       CLE028
      ** MULTI-CURRENCY ROLLOVERS ALLOWED may not be 'Y' for Flat Rate                        CLE028
      ** Personal Loans.                                                                      CLE028
      *                                                                                       CLE028
     C           *IN46     IFEQ '0'                                                           CLE028
     C           SMCRA     ANDEQ'Y'                                                           CLE028
     C           WLNPT     ANDEQ80                                                            CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C                     MOVE '1'       *IN46                                               CLE028
     C                     MOVEL'LEL0545' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDIF                                                              CLE028
      *
     C***********          ELSE                                           120025
     C***********          MOVE 'N'       SMCRA                           120025
     C***********          ENDIF                                          120025
      *
      ** MCRA should be 'Y' for Parts Sold if original loan has           134725
      ** multi-ccy details                                                134725
      *                                                                   134725
     C           *IN22     IFEQ '1'                                       134725
     C           SACTN     ANDEQ'I'                                       134725
     C           SMCRA     ANDEQ'N'                                       134725
     C           NCCYM     ANDNE*BLANKS                                   134725
     C           NCCYM     ANDNECCYM                                      162899
     C                     MOVE '1'       *IN46                           134725
     C                     MOVEL'LEL0509' ZAMSID                          134725
     C                     EXSR ZASNMS                                    134725
     C                     ENDIF                                          134725
      *                                                                   134725
     C                     Z-ADD*ZEROS    WSVRD                           158058
      *
      ** VALIDATE ROLLOVER DATE
      *
     C           SACTN     IFEQ 'I'                                       125468
      *                                                                   125468
     C                     Z-ADD*ZEROS    WSVRD
      *
      ****** must*be*blank*for*call/demand*loans,*discount*loans********* 144688
      ** ... must be blank for discount loans                             144688
      ** and participations
      *
     C           SRLDT     IFNE *BLANKS
     C                     DO
      *
     C***********WLNPT     IFEQ 61                                        144688
     C***********WLNPT     OREQ 63                                        144688
     C           WLNPT     IFEQ 63                                        144688
     C           SACTN     ANDEQ'I'
     C           WLNPT     OREQ 65
     C           SACTN     ANDEQ'I'                                       122098
     C           WLNPT     OREQ 67
     C           SACTN     ANDEQ'I'                                       122098
     C***********WLNPT     OREQ 70                                        144688
     C***********WLNPT     OREQ 68                                 CLE005 144688
     C***********WLNPT     OREQ 69                                 CLE005 144688
     C***********WLNPT     OREQ 71                                 CLE005 144688
     C           WLNPT     OREQ 72                                        CLE005
     C           W72TP     ANDNE'66'                                      CLE005
     C           W72TP     ANDNE'69'                                      152173
     C           W72TP     ANDNE'70'                                      144688
     C                     MOVE '1'       *IN63
     C                     MOVEL'LEL0272' ZAMSID
     C                     EXSR ZASNMS
     C                     LEAVE
     C                     ENDIF
      *
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           WLNPT     IFEQ 80                                                            CLE028
     C           SACTN     ANDEQ'I'                                                           CLE028
     C                     MOVE '1'       *IN63                                               CLE028
     C                     MOVEL'LEL0545' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     LEAVE                                                              CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     MOVELSRLDT     WNUM7
     C                     MOVELWNUM7     WALF6
     C                     MOVE SRLDT     ZDATE
     C                     EXSR ZDATE1
     C                     MOVE ZDAYNO    WSVRD   50
     C                     MOVE ZDAYNO    W#RLDT                          125557
     C           *IN99     IFEQ '1'
     C           SRLDT     ORNE WALF6
     C                     MOVE '1'       *IN63
     C                     MOVEL'LEL0151' ZAMSID
     C                     EXSR ZASNMS
     C                     LEAVE
     C                     ENDIF
      *
      ** Ensure that rollover date is not changed for discount loans
      *
     C           SACTN     IFEQ 'A'
     C           WLNPT     ANDEQ63
     C           WSVRD     ANDNERLDT
     C                     MOVE '1'       *IN63
     C                     MOVEL'LEL0272' ZAMSID
     C                     EXSR ZASNMS
     C                     LEAVE
     C                     ENDIF
      *
      ** ... must be greater than interest accrual control date
      *
     C                     MOVE '0'       WIN63   1
     C           SACTN     IFEQ 'I'
     C                     Z-ADDWSVVD     IACD
     C                     ENDIF
     C***********WSVRD     IFLE IACD                                      160946
     C           WSVRD     IFLT IACD                                      160946
     C                     MOVE '1'       WIN63
     C                     ENDIF
      *
      ** ... if rollover date has changed and loan is not a disc loan,
      ** and maturity date is entered,
      ** if new maturity date is entered, rollover date must be earlier
      ** than new mat date, else rollover date must be earlier than
      ** maturity date
      *
     C           WLNPT     IFNE 63
     C           WLNPT     ANDNE65                                        122098
     C           WLNPT     ANDNE67                                        122098
     C           SACTN     ORNE 'A'
     C           SACTN     ANDNE'X'                                       123857
     C           WSVRD     ORNE RLDT
      *
     C           WSVRD     IFGT IACD
     C           *IN44     ANDEQ'0'
     C           SMDAT     ANDNE*BLANKS
     C           SACTN     IFEQ 'I'                                                          BUG9850
     C                     Z-ADDWSVMD     W0MDT                                              BUG9850
     C                     ELSE                                                              BUG9850
     C           NMDT      IFGT *ZEROS
     C********** SACTN     ANDNE'I'                                                          BUG9850
     C                     Z-ADDNMDT      W0MDT
     C**********           ELSE                                                              BUG9850
     C**********           Z-ADDWSVMD     W0MDT                                              BUG9850
     C                     ENDIF
     C                     ENDIF                                                             BUG9850
     C           WSVRD     IFGE W0MDT
     C           WLNPT     IFNE 61                                        144688
     C           WLNPT     ORNE 68                                        144688
     C           WLNPT     ORNE 69                                        144688
     C                     MOVE '1'       WIN63
     C                     ELSE                                           144688
     C           W0MDT     IFNE 0                                         144688
     C                     MOVE '1'       WIN63                           144688
     C                     ENDIF                                          144688
     C                     ENDIF                                          144688
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C           WSVRD     IFGE DTEXF                                     144688
     C           WLNPT     IFEQ 61                                        144688
     C           WLNPT     OREQ 68                                        144688
     C           WLNPT     OREQ 69                                        144688
     C           W0MDT     IFEQ 0                                         144688
     C                     MOVE '1'       WIN63                           144688
     C                     ENDIF                                          144688
     C                     ENDIF                                          144688
     C                     ENDIF                                          144688
      *                                                                   144688
     C           WIN63     IFEQ '1'
     C                     MOVE '1'       *IN63
     C                     MOVEL'LEL0152' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                   134725
      ** Send warning msg if rollover date is different w/ sale of        134725
      ** loan w/ multi-ccy rollover details                               134725
      *                                                                   134725
     C           WSVRD     IFNE RLDTM                                     134725
     C           NCCYM     ANDNE*BLANKS                                   134725
     C           NCCYM     ANDNECCYM                                      134725
      *                                                                   134725
     C           WE510     IFEQ *BLANK                                    134725
     C           WE510     OREQ 'Y'                                       134725
     C           WSVRD     ANDNEW1RLDT                                    134725
     C                     Z-ADDWSVRD     W1RLDT  50                      134725
     C                     MOVE 'Y'       WE510   1                       134725
     C                     MOVE 'W'       WRMSV                           134725
     C                     MOVE 'Y'       WWARN                           134725
     C                     MOVE '1'       *IN63                           134725
     C                     MOVEL'LEL0510' ZAMSID                          134725
     C                     EXSR ZASNMS                                    134725
     C                     ENDIF                                          134725
     C                     ENDIF                                          134725
      *
     C                     ENDDO
     C                     ENDIF
      *                                                                   125468
     C                     ENDIF                                          125468
      *                                                                                       190016
      ** If action 'A' or 'X' set up field for later validation                               190016
      *                                                                                       190016
     C           SACTN     IFEQ 'A'                                                           190016
     C           SACTN     OREQ 'X'                                                           190016
     C                     Z-ADDRLDT      WSVRD                                               190016
     C                     ENDIF                                                              190016
      *
      ** VALIDATE  OLLOVER FREQUENCY AND DAY NUMBER
      ** ... rollover details to be validated only on insert
      *
     C           SACTN     IFEQ 'I'
      *
     C           SRLDT     IFEQ *BLANKS
     C           SRLFQ     ANDNE*BLANK
     C                     MOVE '1'       *IN64
     C                     MOVEL'LEL0273' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** Frequencies allowed are M,Q,X and Y
      ** Moreover, it must be a valid frequency for the facility to
      ** which the loan is being linked
      *
     C           SRLFQ     IFNE *BLANK
     C           SRLFQ     ANDNE'M'
     C           SRLFQ     ANDNE'Q'
     C           SRLFQ     ANDNE'X'
     C           SRLFQ     ANDNE'Y'
     C                     MOVE '1'       *IN64
     C                     MOVEL'LEL0055' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C           *IN22     IFEQ '0'
     C           SRLFQ     ANDNE*BLANK
     C           SRLFQ     SCAN RTPS:1                   87
     C           *IN87     IFEQ '0'
     C                     MOVE '1'       *IN64
     C                     MOVEL'LEL0410' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C           SRLFQ     IFEQ *BLANKS
     C           SRLDY     ANDNE*BLANKS
     C                     MOVE '1'       *IN65
     C                     MOVEL'LEL0277' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... defaults to the day number of rollover date
      *
     C           SRLDY     IFEQ *BLANK
     C           SRLFQ     IFNE *BLANK
     C           SRLDT     ANDNE*BLANK
     C           *IN63     ANDEQ'0'
     C           *IN64     ANDEQ'0'
     C                     MOVE SRLDT     WDATE
     C           BJDFIN    IFEQ 'M'
     C                     MOVE WDAT2     SRLDY
     C                     ELSE
     C                     MOVE WDAT1     SRLDY
     C                     ENDIF
     C                     ENDIF
      *
      ** ... must be numeric from 1 to 31
      *
     C                     ELSE
     C                     MOVELSRLDY     WNUM3
     C                     MOVELWNUM3     WALF2
     C           SRLDY     IFNE WALF2
     C           SRLDY     ORLT '01'
     C           SRLDY     ORGT '31'
     C                     MOVE '1'       *IN65
     C                     MOVEL'LEL0279' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                          145490
     C                     MOVE SRLDY     WRLDY   20
      *
      ** ... if rollover frequency is entered, next rollover date
      ** calculated should be on or earlier than maturity date
      *
     C           SACTN     IFEQ 'I'                                       125557
     C           WLNPT     IFNE 61
     C           WLNPT     ANDNE68                                        CLE005
     C           SRLDT     ANDNE*BLANKS
     C           SRLFQ     ANDNE*BLANK
     C           *IN63     ANDEQ'0'
     C           *IN64     ANDEQ'0'
     C           *IN65     ANDEQ'0'
     C           SMDAT     ANDNE*BLANKS
     C           *IN44     ANDEQ'0'
     C                     Z-ADDWSVRD     ZDAYNO
     C                     MOVE SRLFQ     ZFREQ
     C                     MOVE SCURR     ZCCY
     C                     MOVE SRLDY     ZMDAY
     C                     MOVE WLCCD     ZLOC
     C                     EXSR ZFREQB
     C           ZDAYNO    IFGT WSVMD
     C                     MOVE '1'       *IN64
     C                     MOVEL'LEL0054' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                          125557
      *
      ***...*if*rollover*date*is*entered*but*frequency*is*not**********   122650
      ***rollover*date*should*fall*in*the*irregular*rollover*period****   122650
      *
     C************IN63     IFEQ '0'                                       122650
     C************IN64     ANDEQ'0'                                       122650
     C************IN22     ANDEQ'0'                                       122650
     C***********SRLFQ     ANDEQ*BLANK                                    122650
     C***********          Z-ADDWSVVD     ZINDT   50                      122650
     C***********          Z-ADD*ZEROS    ZNYR    20                      122650
     C***********          Z-ADDRLPD      ZNMN    20                      122650
     C***********          Z-ADD*ZEROS    ZNDY    20                      122650
     C***********          EXSR ZCPD                                      122650
     C***********WSVRD     IFGT ZPDNO                                     122650
     C***********          MOVE '1'       *IN63                           122650
     C***********          MOVEL'LEL0409' ZAMSID                          122650
     C***********          EXSR ZASNMS                                    122650
     C***********          ENDIF                                          122650
     C***********          ENDIF                                          122650
      ***********                                                         145490
     C***********          ENDIF                                          145490
      *
      ** ... issue a warning message if rollover date is a holiday
      ** in loan currency
      *
     C           *IN63     IFEQ '0'
     C           SRLDT     ANDNE*BLANKS
     C                     Z-ADDWSVRD     ZDAYNO
     C                     MOVE SCURR     ZCCY
     C                     MOVE WLCCD     ZLOC
     C                     EXSR ZCHKH
      *
     C           ZIND      IFEQ 'H'
     C           WE009     IFEQ *BLANK
     C           WE009     OREQ 'Y'
     C           WSVRD     ANDNEW1RD
     C                     Z-ADDWSVRD     W1RD    50
     C                     MOVE 'Y'       WE009   1
     C                     MOVE '1'       *IN63
     C                     MOVE 'W'       WRMSV
     C                     MOVE 'Y'       WWARN
     C                     MOVEL'LEL0075' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'E'       WRMSV
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** ... for parts sold, determine if facility of original loan
      ** is syndicated
      *
     C                     MOVE *BLANK    WLPFI   1
     C                     MOVE *BLANK    WPASI   1                       147261
     C**********           Z-ADD*ZEROS    WPTFC   60                                          CSD027
     C                     MOVE *BLANKS   WPTFC   6                                           CSD027
     C                     Z-ADD*ZEROS    WPTFT   30
     C                     Z-ADD*ZEROS    WPTFN   20
      *
     C           *IN22     IFEQ '1'
     C           *IN37     ANDEQ'0'
     C                     MOVE FCUSM     WFCNUM
     C                     MOVE FTYPM     WFFACT
     C                     MOVE FSEQM     WFFCNO
     C                     MOVE 'A'       WFRCTP
     C           WKFAC     CHAINFCLTY               N89
      *                                                                   153787
     C           *IN89     IFEQ *OFF                                      153787
     C                     EXSR SRCKFR                                    153787
     C                     ENDIF                                          153787
      *                                                                   153787
     C           *IN89     IFEQ '1'
     C           *IN89     OREQ '0'
     C           RECIF     ANDNE'D'
     C           WREAC     ANDEQ*OFF                                      153787
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE           ************
     C                     Z-ADD35        DBASE            * DBERR 35 *
     C                     MOVELFCTREC    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *                                                                   CLE011
      ** Validate Rate fixing days                                        CLE011
      *                                                                   CLE011
     C           CLE011    IFEQ 'Y'                                       CLE011
      *                                                                   CLE011
     C                     MOVE *OFF      *IN77                           CLE011
      *                                                                   CLE011
     C           SRFDY     IFNE *BLANKS                                   CLE011
     C                     MOVE *BLANKS   PSCRF                           CLE011
     C                     MOVE SRFDY     PSCRF                           CLE011
     C                     Z-ADD0         PNDEC                           CLE011
     C                     Z-ADD2         PNDIG                           CLE011
      *                                                                   CLE011
     C                     CALL 'ZALIGN'  PPAR1                           CLE011
      *                                                                   CLE011
     C           PRTCD     IFNE *BLANKS                                   CLE011
     C                     MOVE *ON       *IN77                           CLE011
     C                     MOVEL'LEL0511' ZAMSID                          CLE011
     C                     EXSR ZASNMS                                    CLE011
     C                     ELSE                                           CLE011
     C                     MOVE PRVAL     SRFDY                           CLE011
     C                     ENDIF                                          CLE011
      *                                                                   CLE011
     C/COPY WNCPYSRC,LE2030C109
      ** If Rate Fix day is not entered, default to '02'                  CLE011
      *                                                                   CLE011
     C                     ELSE                                           CLE011
     C**********           MOVEL'02'      SRFDY                                        CLE011 258109
     C                     MOVELSVRFDY    SRFDY                                               258109
      *                                                                   CLE011
     C                     ENDIF                                          CLE011
     C/COPY WNCPYSRC,LE2030C110
      *                                                                   CLE011
      ** When loan is flagged as rate fixed and rate fixing days has      CLE011
      ** been amended, issue warning message                              CLE011
      *                                                                   CLE011
     C                     MOVELRFDY      WCHR02  2                       CLE011
      *                                                                   CLE011
     C           SACTN     IFEQ 'A'                                       CLE011
     C           RFRI      ANDEQ'Y'                                       CLE011
     C           SRFDY     ANDNEWCHR02                                    CLE011
     C           WE512     ANDEQ*BLANKS                                   CLE011
      *                                                                   CLE011
     C                     MOVEL*BLANKS   ZFIELD                          CLE011
     C                     MOVE RFRT      ZFIELD                          CLE011
     C                     Z-ADD7         ZADEC                           CLE011
      *                                                                   CLE011
     C                     CALL 'ZEDIT'                                   CLE011
     C                     PARM           ZFIELD                          CLE011
     C                     PARM           ZADEC                           CLE011
      *                                                                   CLE011
     C                     SELEC                                          CLE011
      *                                                                   CLE011
      ** Participation Purchased                                          CLE011
     C           *IN21     WHEQ *ON                                       CLE011
     C                     MOVEL'LEL0513' ZAMSID                          CLE011
      *                                                                   CLE011
      ** Participation Sold                                               CLE011
     C           *IN22     WHEQ *ON                                       CLE011
     C                     MOVEL'LEL0514' ZAMSID                          CLE011
      *                                                                   CLE011
      ** Loan                                                             CLE011
     C                     OTHER                                          CLE011
     C                     MOVEL'LEL0512' ZAMSID                          CLE011
     C                     ENDSL                                          CLE011
      *                                                                   CLE011
     C                     MOVE 'Y'       WE512                           CLE011
     C                     MOVE ZFIELD    WCHR12 12                       CLE011
     C                     MOVELWCHR12    ZAMSDA                          CLE011
     C                     EXSR ZASNMS                                    CLE011
     C                     MOVE *ON       *IN77                           CLE011
      *                                                                   CLE011
     C                     ENDIF                                          CLE011
      *                                                                   CLE011
     C                     ENDIF                                          CLE011
      *
      ** VALIDATE DEFAULT PARTICIPATION LOAN TYPE/SUBTYPE
      ** (for loans and parts purchased when facility is syndicated)
      *
     C           *IN22     IFEQ '0'
      *
      ** ... entry valid only when facility is syndicated
      *
     C           '?'       SCAN SDFTP:1                  87
     C           '?'       SCAN SDFST:1                  97
     C           SYINF     IFNE 'Y'
     C           SDFTP     IFNE *BLANKS
     C           SDFST     ORNE *BLANKS
     C                     MOVE '1'       *IN66
     C                     MOVEL'LEL0042' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** ... loan subtype must be entered if loan type is entered
      ** and likewise
      *
     C           *IN66     IFEQ '0'
     C           *IN87     ANDEQ'0'
     C           *IN97     ANDEQ'0'
     C           SDFTP     IFEQ *BLANKS
     C           SDFST     ANDNE*BLANKS
     C           SDFTP     ORNE *BLANKS
     C           SDFST     ANDEQ*BLANKS
     C                     MOVE '1'       *IN66
     C                     MOVEL'LEL0413' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... loan type must start with 'H, 'J' or 'K' if entered
      *
     C           *IN66     IFEQ '0'
     C           SDFTP     ANDNE*BLANKS
     C           1         SUBSTSDFTP:1   WFRST   1
     C           *IN87     IFEQ '0'
     C           *IN97     ANDEQ'0'
     C           WFRST     ANDNE'H'
     C           WFRST     ANDNE'J'
     C           WFRST     ANDNE'K'
     C                     MOVE '1'       *IN66
     C                     MOVEL'LEL0411' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** ... must form a valid loan type/subtype with processing type
      ** of a participations sold
      *
     C           *IN66     IFEQ '0'
     C           SDFTP     IFNE *BLANKS
     C           SDFST     ORNE *BLANKS
     C/COPY WNCPYSRC,LE2030C122
     C                     MOVE SDFTP     PLNTY
     C                     MOVE SDFST     PLNST
     C                     MOVE CLCLAS    PLNCL                                             BUG11642
     C                     CALL 'AOLOANR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PLNTY
     C                     PARM           PLNST
     C                     PARM           PLNCL                                             BUG11642
     C           SDLOAN    PARM SDLOAN    DSFDY
      *
     C                     SELEC
     C           PRTCD     WHEQ '*NOSEL'
     C                     MOVE *BLANKS   SDFTP
     C                     MOVE *BLANKS   SDFST
     C           PRTCD     WHNE *BLANKS
     C                     MOVE '1'       *IN66
     C                     MOVEL'LEL0412' ZAMSID
     C                     EXSR ZASNMS
     C           PRTCD     WHEQ *BLANKS
     C                     MOVE AYLNTY    SDFTP
     C                     MOVE AYLNST    SDFST
     C           AYLNPT    IFNE 66
     C           AYLNPT    ANDNE67
     C           AYLNPT    ANDNE69                                        CLE005
     C           AYLNPT    ANDNE72                                        CLE005
     C           WLNPT     OREQ 69                                        CLE005
     C           CLE005    ANDEQ'N'                                       CLE005
     C           WLNPT     OREQ 72                                        CLE005
     C           CLE005    ANDEQ'N'                                       CLE005
     C                     MOVE '1'       *IN66
     C                     MOVEL'LEL0047' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDSL
      *
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** VALIDATE LINKED TO SYNDICATE
      ** ... field entry is valid only for parts purchased and sold,
      ** when the facility is syndicated.
      *
     C           *IN21     IFEQ '1'
     C           *IN22     OREQ '1'
      *
     C           SYINF     IFNE 'Y'
     C           SLNKS     ANDNE*BLANK
     C                     MOVE '1'       *IN67
     C                     MOVEL'LEL0414' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... entry is mandatory if facility is syndicated
      *
     C           SYINF     IFEQ 'Y'
      *
     C           SLNKS     IFNE 'Y'
     C           SLNKS     ANDNE'N'
     C           SLNKS     ANDNE*BLANKS                                   120842
     C                     MOVE '1'       *IN67
     C                     MOVEL'LEL0415' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                   120842
     C           SLNKS     IFEQ *BLANKS                                   120842
     C                     MOVE 'N'       SLNKS                           120842
     C                     ENDIF                                          120842
      *                                                                   159256
      ** ... issue warning if part sold is being inserted against a       159256
      **     syndicated facility.                                         159256
      *                                                                   159256
     C           PMODE     IFEQ 'I'                                       159256
     C           SACTN     ANDEQ'I'                                       159256
     C           *IN22     ANDEQ'1'                                       159256
     C           SLNKS     ANDEQ'Y'                                       159256
      *                                                                   159256
     C           WE232     IFEQ *BLANK                                    159256
     C           WE232     OREQ 'Y'                                       159256
     C           SLNKS     ANDNEW1LNKS                                    159256
     C                     MOVE SLNKS     W1LNKS  1                       159256
      *                                                                   159256
     C           SYINF     IFEQ 'Y'                                       159256
     C                     MOVE 'LEM0232' ZAMSID                          159256
     C                     EXSR ZASNMS                                    159256
     C                     MOVE 'Y'       WE232                           159256
     C                     MOVE 'Y'       WWARN                           159256
     C                     MOVE '1'       *IN,67                          159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDIF                                          159256
     C                     ENDIF                                          159256
      *
      ** ... facility reference must be a prime facility
      *
     C           *IN34     IFEQ '0'
     C***********          MOVE CNUMF     WFCNUM                          120392
     C***********          MOVE FACT      WFFACT                          120392
     C***********          MOVE FCNO      WFFCNO                          120392
     C***********WKPRM     CHAINLEFCLTL4             89                   120392
     C                     MOVE '0'       *IN89                           124001
     C           WCPRTR    IFNE ' '                                       120392
     C           WCPRTR    ANDNE'A'                                       120392
     C                     MOVE '1'       *IN89                           120392
     C                     ENDIF                                          120392
     C           *IN89     IFEQ '1'                                       120392
     C                     MOVE '1'       *IN34
     C                     MOVEL'LEL0043' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
     C***********WERRF     IFEQ *BLANK                                    120392
     C***********          MOVE WSVCN     WCUST   60                      120392
     C************IN89     DOWEQ'0'                                       120392
     C***********WCUST     ANDNECNUMF                                     120392
     C***********WKPRM     READELEFCLTL4                 89               120392
     C***********          ENDDO                                          120392
      *
      ** ... get branch details of prime facility
      *
     C                     MOVE BRCAF     PBRCA
     C***********          CALL 'AOBRCHR0'PPAR4                           121783
     C                     CALL 'AOBRCHR1'PPAR4                           121783
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRCHPD'DBFILE           ************
     C                     Z-ADD36        DBASE            * DBERR 36 *
     C                     MOVELPBRCA     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *                                                                   120392
     C                     MOVE A8SYCU    W#SYCU  6                       120392
      *                                                                   120392
     C           WERRF     IFEQ *BLANK                                    120392
      *                                                                   120392
      ** For Participation Purchased where the bank is the Agent,         120392
      ** the funding participant customer must be the BICN.               120392
      *                                                                   120392
     C           *IN21     IFEQ '1'                                       120392
     C           WAGENT    ANDEQW#SYCU                                    120392
     C**********           MOVE A8BICN    WCUST   60                                   120392 CSD027
     C                     MOVE A8BICN    WCUST   6                                           CSD027
     C                     ELSE                                           120392
     C                     MOVE WSVCN     WCUST                           120392
     C                     ENDIF                                          120392
      *                                                                   120392
     C           *IN21     IFEQ '1'                                       120392
     C           WAGENT    ANDEQW#SYCU                                    120392
     C           *IN22     OREQ '1'                                       120392
      *                                                                   120392
     C                     MOVE BRCAF     WFBRCA  3                       128563
     C                     MOVE CNUMF     WFCNUM                          120392
     C                     MOVE FACT      WFFACT                          120392
     C                     MOVE FCNO      WFFCNO                          120392
     C           WKPRM     SETLLLEFCLTL4                                  120392
      *                                                                   120392
     C           *IN89     DOWEQ'0'                                       120392
     C           WCUST     ANDNECNUMF                                     120392
     C           *IN89     OREQ '0'                                       150748
     C           WCUST     ANDEQCNUMF                                     150748
     C           RECIF     ANDEQ'R'                                       150748
     C           WKPRM     READELEFCLTL4                 89               120392
     C                     ENDDO                                          120392
      *                                                                   120392
     C                     ENDIF                                          120392
      *                                                                   CLE005
      ** For a risk parts sold, customer must be a risk participant       CLE005
      ** starting not later than the value date of loan                   CLE005
      *                                                                   CLE005
     C                     MOVE *BLANK    WRISK   1                       CLE005
     C           *IN22     IFEQ '1'                                       CLE005
     C************IN89     ANDEQ'1'                                                    CLE005 216736
     C********** WPTF      ANDEQ'Y'                                                    216736 227711
     C           WPTF      ANDEQ*BLANKS                                                       227711
     C           WLNPT     ANDEQ72                                        CLE005
     C***********          MOVE BRCAF     PBRCA                    CLE005 128563
     C***********          MOVE CNUMF     S#FCUS                   CLE005 128563
     C***********          MOVE FACT      S#FTYP                   CLE005 128563
     C***********          MOVE FCNO      S#FSEQ                   CLE005 128563
     C                     MOVE WFBRCA    PBRCA                           128563
     C                     MOVE WFCNUM    S#FCUS                          128563
     C                     MOVE WFFACT    S#FTYP                          128563
     C                     MOVE WFFCNO    S#FSEQ                          128563
     C           K#PART    CHAINLEPARTD1             89                   CLE005
     C           *IN89     IFEQ '0'                                       CLE005
     C           WSVVD     ANDLTJDTE                                      CLE005
     C                     MOVE '1'       *IN89                           CLE005
     C                     ELSE                                           CLE005
     C                     MOVE 'Y'       WRISK                           CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *
      ** ... for an internal parts purchased, customer purchased from
      ***must*be*the*BICN*of*the*facility*branch***                       120392
      ** must be the Agent of the facility branch                         120392
      *
     C           *IN21     IFEQ '1'
     C           WAGENT    ANDEQW#SYCU                                    120392
     C           *IN89     IFEQ '0'
     C           PRTR      ANDNE'I'
     C           *IN89     OREQ '1'
     C                     MOVE '1'       *IN37
     C                     MOVEL'LEL0044' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C***********A8BICN    IFNE WSVCN                                     120002
     C***********          MOVE A8SYCU    W#SYCU  6                120002 120392
     C           W#SYCU    IFNE WSVCN                                     120002
     C                     MOVE '1'       *IN37
     C                     MOVEL'LEL0045' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** ... for a non-direct parts sold, loan customer must not be
      ** the BIC of the facility branch
      *
     C           *IN22     IFEQ '1'
     C           *IN89     IFEQ '0'
     C           BRCAF     ANDNESBRCA                                     201165
     C           PRTR      ANDNE'P'
     C           PRTR      ANDNE'I'                                       201165
     C           WLNPT     ANDNE72                                        CLE005
     C           *IN89     OREQ '0'                                       201165
     C           BRCAF     ANDEQSBRCA                                     201165
     C           PRTR      ANDNE'P'                                       201165
     C           WLNPT     ANDNE72                                        201165
     C           *IN89     OREQ '1'
     C                     MOVE '1'       *IN33
     C                     MOVEL'LEL0044' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C           A8BICN    IFEQ WSVCN
     C                     MOVE '1'       *IN33
     C                     MOVEL'LEL0046' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** ... save participant facility details if no error
      *
     C           WERRF     IFEQ *BLANK
     C           *IN21     IFEQ '1'                                       122685
     C           WAGENT    ANDEQW#SYCU                                    122685
     C************IN22     OREQ '1'                                 122685158047
     C           WRISK     OREQ *BLANK                                    CLE005
     C           *IN22     ANDEQ'1'                                       158047
     C                     MOVE PRTR      WLPFI
     C                     MOVE PASI      WPASI                           147261
     C**********           Z-ADDCNUMF     WPTFC                                               CSD027
     C                     MOVE CNUMF     WPTFC                                               CSD027
     C                     Z-ADDFACT      WPTFT
     C                     Z-ADDFCNO      WPTFN
     C                     ELSE                                           CLE005
     C                     MOVE *BLANK    WLPFI                           CLE005
     C           WRISK     IFEQ 'Y'                                       158047
     C                     MOVE 'R'       WLPFI                           158047
     C                     ENDIF                                          158047
     C**********           Z-ADD*ZEROS    WPTFC                                        CLE005 CSD027
     C                     MOVE *BLANKS   WPTFC                                               CSD027
     C                     Z-ADD*ZEROS    WPTFT                           CLE005
     C                     Z-ADD*ZEROS    WPTFN                           CLE005
     C                     ENDIF                                          122685
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE ASSIGNMENT (For Part. Purchase)
      *
     C           *IN21     IFEQ '1'
      *
      ** ... must be 'P', 'A' or blank
      *
     C           SASSN     IFNE 'P'
     C           SASSN     ANDNE'A'
     C           SASSN     ANDNE*BLANK
     C                     MOVE '1'       *IN29
     C                     MOVEL'LEL0084' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C           *IN29     IFEQ '0'
     C           SYINF     IFNE 'Y'
      *
      ** ... for participation purchased against non-syndicated
      **     facility, assignment flag must be 'P'
      *
     C           SASSN     IFEQ *BLANK
     C                     MOVE 'P'       SASSN
     C                     MOVE 'P'       GASS
     C                     ELSE
     C           SASSN     IFNE 'P'
     C                     MOVE '1'       *IN29
     C                     MOVEL'LEL0085' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
     C                     ELSE
      *
      ** ... for participation  purchased against syndicated
      **     facility, it will default to value on participant facility   147261
      *******facility,*it*will*default*to*'A'*if*purchased*from********   147261
      *******Agent,*otherwise*it*will*default*to*'P'*******************   147261
      *
     C           SASSN     IFEQ *BLANK
     C           *IN34     ANDEQ'0'
      *                                                                   147261
     C                     MOVE WPASI     SASSN                           147261
     C                     MOVE WPASI     GASS                            147261
      *
     C           WCPRTR    IFNE 'A'
     C           WCPRTR    ANDNE*BLANK                                    121141
     C                     MOVE WCPMFC    WFCNUM
     C                     MOVE WCPMFT    WFFACT
     C                     MOVE WCPMFN    WFFCNO
     C                     MOVE 'A'       WFRCTP
     C           WKFAC     CHAINFCLTY               N89
      *                                                                   153787
     C           *IN89     IFEQ *OFF                                      153787
     C                     EXSR SRCKFR                                    153787
     C                     ENDIF                                          153787
      *                                                                   153787
     C           *IN89     IFEQ '1'
     C           *IN89     OREQ '0'
     C           RECIF     ANDNE'D'
     C           WREAC     ANDEQ*OFF                                      153787
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE           ************
     C                     Z-ADD37        DBASE            * DBERR 37 *
     C                     MOVELFCTREC    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     MOVE CNUM      WAGENT
     C                     ENDIF
      *
     C***********WCPRTR    IFEQ *BLANKS                            121141 147261
     C***********          MOVE 'P'       SASSN                    121141 147261
     C***********          MOVE 'P'       GASS                     121141 147261
     C***********          ELSE                                    121141 147261
     C***********WAGENT    IFEQ SOLNO                                     125184
     C***********WAGENT    IFEQ SPFRM                              125184 147261
     C***********          MOVE 'A'       SASSN                           147261
     C***********          MOVE 'A'       GASS                            147261
     C***********          ELSE                                           147261
     C***********          MOVE 'P'       SASSN                           147261
     C***********          MOVE 'P'       GASS                            147261
     C***********          ENDIF                                          147261
     C***********          ENDIF                                   121141 147261
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *                                                                   120813
      * Derive value for Assignment (A or P), for part. sold,             120813
      * where inserting in interactive mode:-                             120813
      * Only perform if no other screen errors.                           120813
     C           PMODE     IFEQ 'I'                                       120813
     C           *IN22     ANDEQ*ON                                       120813
     C           SACTN     ANDEQ'I'                                       120813
     C           WERRF     ANDEQ*BLANK                                    120813
     C                     MOVE 'P'       SASSN                           120813
     C                     MOVE 'P'       GASS                            147261
      *                                                                   120813
      ****Set*to*'A'*if*syndicated*facility*and*one*of:-***********120813 147261
      *******1.*facility*of*sale*of*loan*number*is*Agent*facility,*120813 147261
      *******2.*assignment*exists*with*'introduced by'*=*agent*****120813 147261
      **     1. Default first to value on participant facility            147261
      *      2. Set to 'A' if syndicated facility and assignment          147261
      *         exists with 'introduced by' = agent                       147261
      *         and 'joining date' = start date of loan.                  120813
      *                                                                   147261
     C           SYINF     IFEQ 'Y'                                       120813
      *                                                                   120813
      * Get sale of loan facility for facility branch                     120813
     C           K#FCLT    CHAINFCLTYFMF            N89                   120813
      *                                                                   153787
     C           *IN89     IFEQ *OFF                                      153787
     C                     EXSR SRCKFR                                    153787
     C                     ENDIF                                          153787
      *                                                                   153787
     C           *IN89     IFEQ *ON                                       120813
     C           *IN89     OREQ *OFF                                      120813
     C           RECIF     ANDNE'D'                                       120813
     C           WREAC     ANDEQ*OFF                                      153787
     C           *LOCK     IN   LDA                                       120813
     C                     MOVEL'FCLTY'   DBFILE                          120813
     C**********           Z-ADD39        DBASE                           120813              204073
     C                     Z-ADD59        DBASE                                               204073
     C                     MOVELD#SLFC    DBKEY                           120813
     C                     OUT  LDA                                       120813
     C                     EXSR *PSSR                                     120813
     C                     ENDIF                                          120813
      *                                                                   120813
      * Get syndicate agent for sale of loan facility branch              120813
     C                     MOVE BRCAF     PBRCA                           120813
     C***********          CALL 'AOBRCHR0'PPAR4                    120813 121783
     C                     CALL 'AOBRCHR1'PPAR4                    120813 121783
     C           PRTCD     IFNE *BLANKS                                   120813
     C           *LOCK     IN   LDA                                       120813
     C                     MOVEL'SDBRCHPD'DBFILE                          120813
     C                     Z-ADD40        DBASE                           120813
     C                     MOVELPBRCA     DBKEY                           120813
     C                     OUT  LDA                                       120813
     C                     EXSR *PSSR                                     120813
     C                     ENDIF                                          120813
      *                                                                   120813
     C***********ANUM      IFEQ A8SYCU                             120813 147261
     C***********          MOVE 'A'       SASSN                    120813 147261
     C                     MOVE WPASI     SASSN                           147261
     C                     MOVE WPASI     GASS                            147261
      *                                                                   120813
     C***********          ELSE                                    120813 147261
     C           SASSN     IFNE 'A'                                       147261
     C           K#PART    CHAINLEPARTL2             89                   120813
     C           *IN89     DOWEQ*OFF                                      120813
     C           INUM      IFEQ ANUM                                      120813
     C           JDTE      ANDEQWSVVD                                     120813
     C                     MOVE 'A'       SASSN                           120813
     C                     MOVE 'A'       GASS                            147261
     C                     LEAVE                                          120813
     C                     ENDIF                                          120813
     C           K#PART    READELEPARTL2                 89               120813
     C                     ENDDO                                          120813
     C                     ENDIF                                          120813
      *                                                                   120813
     C                     ENDIF                                          120813
     C                     ENDIF                                          120813
      *
     C/COPY WNCPYSRC,LE2030C050
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRMATY  -  Further validation of maturity date for amend      *
      * Called by: SRVAL1 - Validate first detail screen              *
      * Calls    : None                                               *
      *****************************************************************
     C           SRMATY    BEGSR
      *
      ** ... for amended disc. loans, maturity date can be amended
      ** only to a date earlier than the original maturity date,
      ** unless it is for a discounted loan with rollover details
      *
     C           WLNPT     IFEQ 63
     C           WSVMD     IFGT MDAT
     C           WSVMD     ORLT MDAT
     C           RLDT      ANDNE*ZEROS
     C                     MOVE '1'       *IN44
     C***********          MOVEL'LEL0302' ZAMSID                          124727
     C                     MOVEL'LEL0097' ZAMSID                          124727
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *                                                                   165965
      ** ... discounted parts purchased cannot have their maturity        165965
      ** dates amended                                                    165965
      *                                                                   165965
     C           WLNPT     IFEQ 65                                        165965
     C           WSVMD     ANDNEMDAT                                      165965
     C                     MOVE '1'       *IN44                           165965
     C                     MOVEL'LEL0218' ZAMSID                          165965
     C                     EXSR ZASNMS                                    165965
     C                     ENDIF                                          165965
      *
      ** ... in amend mode where there are participants, loan maturity
      ** must be on or later than maturity date of participation
      ** (for loans and parts purchased)
      ** Only if not in batch mode or in batch mode but the loan is       124812
      ** linked to an unsyndicated facility                               124812
      *
     C           PMODE     IFNE 'B'                                       124812
     C           PMODE     OREQ 'B'                                       124812
     C           SYINF     ANDNE'Y'                                       124812
     C           *IN22     IFEQ '0'
     C           NOPS      IFGT *ZEROS
     C                     MOVE LNRF      OLNOKA                                              CSD027
     C                     Z-ADD99999     WMDAT
     C           WKPAR     SETLLPSOLDLL
     C                     READ PSOLDLL                  89
     C                     MOVE POLNO     OLNOA                                               CSD027
     C********** LNRF      IFEQ POLNO                                                         CSD027
     C           LNRF      IFEQ OLNON                                                         CSD027
     C           WSVMD     ANDLTPMDTE
     C                     MOVE '1'       *IN44
     C                     MOVEL'LEL0132' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     MOVELMAINRF    CURREF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                          124812
      *
      ** ... if maturity date is amended to be earlier than rundate
      ** generate a warning message
      *
     C           WSVMD     IFNE MDAT
     C********** WSVMD     ANDLTBJRDNB                                    CSC011
     C           WSVMD     ANDLTWRNDAY                                    CSC011
     C           WE020     IFEQ *BLANK
     C           WE020     OREQ 'Y'
     C           WSVMD     ANDNEW1MD
     C                     Z-ADDWSVMD     W1MD    50
     C                     MOVE 'Y'       WE020   1
     C                     MOVE 'W'       WRMSV
     C                     MOVE 'Y'       WWARN
     C                     MOVE '1'       *IN44
     C                     MOVEL'LEL0080' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'E'       WRMSV
     C                     ENDIF
     C                     ENDIF
      *
      ** ... maturity date must be later than interest, rollover and
      ** and repayment dates when amended
      *
     C           WSVMD     IFNE MDAT
      *
     C           *IN51     IFEQ '0'
     C           *IN63     ANDEQ'0'
     C           *IN71     ANDEQ'0'
     C***********WSVMD     IFLE RLDT                                      125557
     C***********WSVMD     ORLE NIDT                                      125557
     C***********WSVMD     ORLE NRPD                                      125557
     C           WSVMD     IFLE W#RLDT                                    125557
     C********** WSVMD     ORLE W#NIDT                                                 125557 193974
     C********** WSVMD     ORLE W@NRPD                                                 125557 193974
     C                     MOVE '1'       *IN44
     C                     MOVEL'LEL0131' ZAMSID
     C                     Z-ADDW#NIDT    ZDAYNO                          158056
     C                     EXSR ZDATE2                                    158056
     C                     MOVE ZADATE    O#NIDT                          158056
     C                     Z-ADDW@NRPD    ZDAYNO                          158056
     C                     EXSR ZDATE2                                    158056
     C                     MOVE ZADATE    O#NRPD                          158056
     C                     MOVELDATMSG    ZAMSDA                          158056
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *                                                                                     AR740107
      ** If maturity date is amended to be equal to Next Repayment                          AR740107
      ** date generate a warning message                                                    AR740107
      *                                                                                     AR740107
     C           *IN71     IFEQ '0'                                                         AR740107
     C           WSVMD     ANDEQW@NRPD                                                      AR740107
     C           WEMDT     IFEQ *BLANK                                                      AR740107
     C           WEMDT     OREQ 'Y'                                                         AR740107
     C                     MOVE 'Y'       WEMDT   1                                         AR740107
     C                     MOVE 'W'       WRMSV                                             AR740107
     C                     MOVE 'Y'       WWARN                                             AR740107
     C                     MOVE '1'       *IN44                                             AR740107
     C                     MOVEL'LEL0812' ZAMSID                                            AR740107
     C                     EXSR ZASNMS                                                      AR740107
     C                     MOVE 'E'       WRMSV                                             AR740107
     C                     ENDIF                                                            AR740107
     C                     ENDIF                                                            AR740107
      *
     C                     ENDIF
      *
      ** ... maturity date cannot be amended before last actioned event
      *
     C           SACTN     IFEQ 'A'
     C           WSVMD     IFLT IACD
     C                     MOVE '1'       *IN44
     C                     MOVEL'LEL0235' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                                     AR740717
      ** New maturity date cannot be less than last history event date                      AR740717
      *                                                                                     AR740717
     C                     MOVE SBRCA     KHBRCA                                            AR740717
     C                     MOVE CNUM      KHCNUM                                            AR740717
     C                     MOVE SLNRF     KHLNRF                                            AR740717
     C                     Z-ADD99999     KHVDAT                                            AR740717
     C                     Z-ADD99        KHPRSQ                                            AR740717
     C                     Z-ADD99999     KHLCD                                            AR1089839
     C                     Z-ADD999       KHLASN                                            AR740717
      *                                                                                     AR740717
     C           KHISTR    SETGTHISTR                                                       AR740717
     C                     READPHISTR               N    89                                 AR740717
      *                                                                                     AR740717
     C           *IN89     IFEQ '0'                                                         AR740717
     C           WSVMD     ANDLTHVDAT                                                       AR740717
     C           HLNRF     ANDEQKHLNRF                                                      AR740717
     C                     MOVE '1'       *IN44                                             AR740717
     C                     MOVEL'LEL0235' ZAMSID                                            AR740717
     C                     EXSR ZASNMS                                                      AR740717
     C                     ENDIF                                                            AR740717
      *
      ** ... if maturity date is changed and autosettle indicator is
      **     'N', set off maturity accounting indicator
      *
     C           WSVMD     IFNE MDAT
     C           AUTO      ANDEQ'N'
     C                     BITOF'2'       WACEI   1
     C                     ENDIF
     C                     ENDIF
      *                                                                                     AR722666
      ** Cannot amend maturity date to be later than the last loan                          AR722666
      ** amendment date or new maturity <> maturity from LS change.                         AR722666
      *                                                                                     AR722666
     C                     MOVE SLNRF     WLLOAN                                            AR722666
     C                     Z-ADD99999     WLVDAT                                            AR722666
     C                     Z-ADD99        WLLASN                                            AR722666
     C           WKLAM     SETGTLOAMS                                                       AR722666
     C                     READPLOAMS               N    89                                 AR722666
     C           *IN89     DOWEQ'0'                                                         AR722666
     C           LNRFA     ANDEQLNRF                                                        AR722666
      *                                                                                     AR722666
     C           RECIA     IFEQ 'D'                                                         AR722666
     C           WSVMD     IFLE VDATA                                                       AR740717
     C           AMTPA     ANDNE'RE'                                                        AR722666
      *                                                                                     AR740717
     C           AMTPA     IFEQ 'LS'                                                        AR740717
     C           AMTPA     OREQ 'SC'                                                        AR740717
     C           AMTPA     OREQ 'BC'                                                        AR740717
     C           AMTPA     OREQ 'SA'                                                        AR740717
     C           AMTPA     OREQ 'PI'                                                        AR740717
     C                     MOVE '1'       *IN44                                             AR722666
     C                     MOVE 'LEL0133' ZAMSID                                            AR722666
     C                     EXSR ZASNMS                                                      AR722666
     C                     LEAVE                                                            AR740717
     C                     ENDIF                                                            AR740717
      *                                                                                     AR740717
     C           WSVMD     IFLT VDATA                                                       AR740717
     C           AMTPA     IFEQ 'MR'                                                        AR740717
     C           AMTPA     OREQ 'PT'                                                        AR740717
     C           AMTPA     OREQ 'PF'                                                        AR740717
     C                     MOVE '1'       *IN44                                             AR740717
     C                     MOVE 'LEL0133' ZAMSID                                            AR740717
     C                     EXSR ZASNMS                                                      AR740717
     C                     LEAVE                                                            AR740717
     C                     ENDIF                                                            AR740717
     C                     ENDIF                                                            AR740717
     C                     ELSE                                                             AR722666
     C           AMTPA     IFEQ 'LS'                                                        AR722666
     C           WSVMD     ANDNELSMDA                                                       AR722666
     C                     MOVE '1'       *IN44                                             AR722666
     C                     MOVE '5045813' ZAMSID                                            AR722666
     C                     EXSR ZASNMS                                                      AR722666
     C                     LEAVE                                                            AR740717
     C                     ENDIF                                                            AR722666
     C                     ENDIF                                                            AR722666
     C                     ENDIF                                                            AR722666
      *                                                                                     AR722666
     C                     READPLOAMS               N    89                                 AR722666
     C                     ENDDO                                                            AR722666
      *
      ** ... cannot amend maturity date to be later than the last
      **     loan amendment date
      *
     C                     MOVE SLNRF     WLLOAN
     C                     Z-ADD99999     WLVDAT
     C                     Z-ADD99        WLLASN
     C           WKLAM     SETGTLOAMS
     C           *IN89     DOUEQ'1'
     C           RECIA     OREQ 'D'
     C***********          READPLOAMS                    89               142586
     C                     READPLOAMS               N    89               142586
     C                     ENDDO
      *                                                                                    AR740107A
      ** If Maturity Date is amended check if there is a                                   AR740107A
      ** Repayment schedule on the same day                                                AR740107A
      *                                                                                    AR740107A
     C                     MOVE SLNRF     WLLOAN                                           AR740107A
     C                     Z-ADD99999     WLVDAT                                           AR740107A
     C                     Z-ADD99        WLLASN                                           AR740107A
     C           WKLAM     SETGTLOAMS                                                      AR740107A
     C                     READPLOAMS               N    89                                AR740107A
      *                                                                                    AR740107A
     C           *IN89     DOWEQ'0'                                                        AR740107A
     C           LNRFA     ANDEQLNRF                                                       AR740107A
     C           VDATA     ANDGEWSVMD                                                      AR740107A
     C           RECIA     IFEQ 'D'                                                        AR740107A
     C           WSVMD     ANDEQVDATA                                                      AR740107A
     C           AMTPA     ANDEQ'RE'                                                       AR740107A
     C                     Z-ADDWSVMD     W1MD                                             AR740107A
     C                     MOVE 'W'       WRMSV                                            AR740107A
     C                     MOVE 'Y'       WWARN                                            AR740107A
     C                     MOVE '1'       *IN44                                            AR740107A
     C**********           MOVEL'LEL0813' ZAMSID                                 AR740107A AR1096933
     C                     MOVEL'5045918' ZAMSID                                           AR1096933
     C                     EXSR ZASNMS                                                     AR740107A
     C                     ENDIF                                                           AR740107A
      *                                                                                    AR740107A
     C                     READPLOAMS               N    89                                AR740107A
     C                     ENDDO                                                           AR740107A
      *
      ** ... generate a warning message if CLE005 is installed,
      **     otherwise, display an error message
      *
     C           *IN89     IFEQ '0'
     C           LNRFA     ANDEQLNRF
     C***********WSVMD     ANDLEVDATA                                     123906
     C           WSVMD     ANDLTVDATA                                     123906
     C           CLE005    IFEQ 'Y'
     C           CLE007    ANDEQ'Y'                                       CLE007
     C           WE021     IFEQ *BLANK
     C           WE021     OREQ 'Y'
     C           WSVMD     ANDNEW1MD
     C           WE021     OREQ 'Y'                                                           190638
     C           WSVMD     ANDEQW1MD                                                          190638
     C           WSVMD     ANDNEINDAT                                                         190638
     C                     Z-ADDWSVMD     INDAT   50                                          190638
     C                     Z-ADDWSVMD     W1MD
     C                     MOVE 'Y'       WE021   1
     C                     MOVE 'W'       WRMSV
     C                     MOVE 'Y'       WWARN
     C                     MOVE '1'       *IN44
     C                     MOVE 'LEL0081' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'E'       WRMSV
     C                     ENDIF
     C                     ELSE
     C                     MOVE '1'       *IN44
     C                     MOVE 'LEL0133' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ELSE                                                               190638
     C                     Z-ADDWSVMD     INDAT                                               190638
     C                     ENDIF
      *                                                                   154991
      ** Check that the Maturity date is greater than the End Dates       154991
      ** of any Fees attached to the Loan.                                154991
      *                                                                   154991
      ** Not applicable to Call/Demand Loans (PTYP 61) as these           154991
      ** have no Maturity Date.                                           154991
      *                                                                   154991
     C           WLNPT     IFNE 61                                        154991
      *                                                                   154991
     C                     MOVELSCUST     FCNUM                           154991
     C                     MOVELSALON     FLOAN                           154991
      *                                                                   154991
     C           LEFKEY    SETLLLEFEEDL2                                  154991
     C           LEFKEY    READELEFEEDL2                 89               154991
      *                                                                   154991
     C           *IN89     DOWEQ*OFF                                      154991
      *                                                                   154991
     C           WSVMD     IFLT FEPEND                                    154991
     C           FERECI    ANDNE'*'                                                         AR970786
     C                     MOVE 'LEL0202' ZAMSID                          154991
     C                     EXSR ZASNMS                                    154991
     C                     MOVE '1'       *IN44                           154991
     C                     LEAVE                                          154991
     C                     ENDIF                                          154991
      *                                                                   154991
     C           LEFKEY    READELEFEEDL2                 89               154991
     C                     ENDDO                                          154991
      *                                                                   154991
     C                     ENDIF                                          154991
      *
      ** Additional validation for processing type 80 if loan is for                          218531
      ** early maturity                                                                       218531
      *                                                                                       218531
     C           CLE028    IFEQ 'Y'                                                           218531
     C           WLNPT     ANDEQ80                                                            218531
     C           WSVMD     ANDNEMDAT                                                          218531
      *                                                                                       218531
     C                     MOVE 'N'       WPDUE   1                                           218531
     C           LNRF      SETLLLOAMS                                                         218531
     C           LNRF      READELOAMS                    01                                   218531
     C           *IN01     DOWEQ'0'                                                           218531
     C           AMTPA     IFEQ 'PD'                                                          218531
     C                     MOVE 'Y'       WPDUE                                               218531
     C                     ENDIF                                                              218531
     C           LNRF      READELOAMS                    01                                   218531
     C                     ENDDO                                                              218531
      *                                                                                       218531
     C           CPAM      IFLE 0                                                             218531
     C           WPDUE     ANDEQ'N'                                                           218531
     C           AITC      ADD  AIAP      WINOUT 130                                          218531
     C                     ADD  AIMN      WINOUT 130                                          218531
     C           ADIF      IFNE 'Y'                                                           218531
     C                     SUB  IPRD      WINOUT                                              218531
     C                     ENDIF                                                              218531
     C                     SUB  ICTD      WINOUT                                              218531
     C           WINOUT    IFGT 0                                                             218531
     C                     MOVE SMDATW    SMDAT                                               218531
     C                     MOVE *ON       *IN44                                               218531
     C                     MOVEL'LEL0576' ZAMSID                                              218531
     C                     EXSR ZASNMS                                                        218531
     C                     ENDIF                                                              218531
      *                                                                                       218531
     C                     ELSE                                                               218531
      *                                                                                       218531
     C                     MOVE SMDATW    SMDAT                                               218531
     C                     MOVE *ON       *IN44                                               218531
     C                     MOVEL'LEL0576' ZAMSID                                              218531
     C                     EXSR ZASNMS                                                        218531
     C                     ENDIF                                                              218531
     C                     ENDIF                                                              218531
      *                                                                                       218531
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRSOLD  -  Further validation for parts sold                  *
      * Called by: SRVAL1 - Validate first detail screen              *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSOLD    BEGSR
      *
      ** ... customer must not match customer of related loan
      *
     C           *IN33     IFEQ '0'
     C           WSVCN     ANDEQCNUMM
     C                     MOVE '1'       *IN33
     C                     MOVEL'LEL0121' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... branch must equal the branch of the related loan
      *
     C           *IN35     IFEQ '0'
     C           SBRCA     ANDNEBRCAM
     C                     MOVE '1'       *IN35
     C                     MOVEL'LEL0033' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... currency must equal the currency of the related loan
      *
     C           *IN38     IFEQ '0'
     C           SCURR     ANDNECCYM
     C                     MOVE '1'       *IN38
     C                     MOVEL'LEL0118' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... sum of the entry and the amount sold on the related loan
      ** should not exceed the current principal amount of the related
      ** loan on insert
      *
     C           WKEY      KLIST                                          138350
     C                     KFLD           BRCAM                           138350
     C                     KFLD           FCUSM                           138350
     C                     KFLD           FTYPM                           138350
     C                     KFLD           FSEQM                           138350
      *                                                                   138350
     C                     MOVE 'N'       WRISP                           138350
     C***********PTYP      IFEQ 72                                 138350 158863
     C           PTYPM     IFEQ 72                                        158863
     C           WLNPT     ANDEQ72                                        138350
     C           WKEY      CHAINLEPARTL1             89                   138350
     C           *IN89     IFEQ '0'                                       138350
     C                     MOVE 'Y'       WRISP   1                       138350
     C                     ENDIF                                          138350
     C                     ENDIF                                          138350
      *                                                                   138350
     C           SACTN     IFEQ 'I'
     C           *IN39     ANDEQ'0'
     C***********PTYP      ANDNE72                                 132559 158863
     C           PTYPM     ANDNE72                                        158863
     C           WLNPT     ANDNE72                                        132559
     C           SACTN     OREQ 'I'                                       138350
     C           *IN39     ANDEQ'0'                                       138350
     C           WRISP     ANDEQ'N'                                       138350
     C           PTYPM     ANDEQ72                                        158863
     C           WLNPT     ANDEQ72                                        158863
     C           SACTN     OREQ 'I'                                       158863
     C           *IN39     ANDEQ'0'                                       158863
     C           PTYPM     ANDEQ70                                        158863
     C           WLNPT     ANDEQ72                                        158863
     C           SACTN     OREQ 'I'                                       158863
     C           *IN39     ANDEQ'0'                                       158863
     C           PTYPM     ANDEQ71                                        158863
     C           WLNPT     ANDEQ72                                        158863
     C           PSAMM     ADD  WSVAM     WSVPA  130
      *                                                                   156136
      ** Include some loan amendments in computing the current            156136
      ** principal amount of the originating loan available for           156136
      ** part sold.                                                       156136
      *                                                                   156136
     C                     Z-ADDCPAMM     WCPAMM 130                      156136
     C                     MOVE SOLNO     WLLOAN                          156136
     C           WLLOAN    SETLLLOAMS                                     156136
     C           WLLOAN    READELOAMS                    89               156136
      *                                                                   156136
     C           *IN89     DOWEQ'0'                                       156136
     C           VDATA     ANDLEWSVVD                                     156136
      *                                                                   156136
     C           RECIA     IFEQ 'D'                                       156136
      *                                                                   156136
     C           AMTPA     IFEQ 'PI'                                      156136
     C           AMTPA     OREQ 'PT'                                      156136
     C                     ADD  PRAM      WCPAMM                          156136
     C                     ENDIF                                          156136
      *                                                                   156136
     C           AMTPA     IFEQ 'PF'                                      156136
     C           AMTPA     OREQ 'RE'                                      156136
     C           AUTO      ANDEQ'Y'                                       156136
     C           AMTPA     OREQ 'MR'                                      156136
     C                     SUB  PRAM      WCPAMM                          156136
      *                                                                   180051
      ** Saved part sold amount (WSVPA) should not be deducted with MR,   180051
      ** RE, or PF principal amount.  Deduction may cause WSVAM to be     180051
      ** greater than the available principal amount for part sold.       180051
      *                                                                   180051
     C**********           SUB  PRAM      WSVPA                    157636 180051
     C                     ENDIF                                          156136
      *                                                                   156136
     C                     ENDIF                                          156136
      *                                                                   156136
     C           WLLOAN    READELOAMS                    89               156136
     C                     ENDDO                                          156136
      *                                                                   181775
     C                     MOVE *IN01     WIN01                           181775
     C           1         SETLLCLOANLJ                                   181775
     C                     READ CLOANLJ                  01               181775
      *                                                                   181775
     C           *IN01     DOWEQ'0'                                       181775
      *                                                                   181775
     C           RECIX     IFEQ 'D'                                       181775
      *                                                                   181775
     C                     MOVE OLNOX     OLNOA                                               CSD027
     C********** WLLOAN    IFEQ OLNOX                                                  181775 CSD027
     C           WLLOAN    IFEQ OLNON                                                         CSD027
     C           WLLOAN    OREQ MLNRX                                     181775
      *                                                                   181775
      ** Check for the amendments made aginst the participations sold     178920
      ** loan/ IPP loan.                                                  178920
      *                                                                   178920
     C                     MOVE '0'       *IN01                           178920
      *                                                                   178920
     C           LNRFX     SETLLLOAMS                                     178920
     C           LNRFX     READELOAMS                    01               178920
      *                                                                   178920
      ** Check the amendments for the loan with value date less than or   178920
      ** equal to the loan's (to be inserted) value date.                 178920
      *                                                                   178920
     C           *IN01     DOWEQ'0'                                       178920
     C           VDATA     ANDLEWSVVD                                     178920
      *                                                                   178920
     C           RECIA     IFEQ 'D'                                       178920
      *                                                                   178920
      ** for loans attached to the original/mirror loan, if amendment     178920
      ** type is PI, add the principal amount to the loan's CPAM then     178920
      ** add the same amount to the orignal/mirror loan's part sold       178920
      *                                                                   178920
     C           AMTPA     IFEQ 'PI'                                      178920
     C                     ADD  PRAM      CPAMX                           178920
     C                     ADD  PRAM      WSVPA                           178920
     C                     ENDIF                                          178920
      *                                                                   178920
      ** If amendment type is PT, add the amount to the loan's CPAM       178920
      ** PSAM should not be updated because it was already updated in     178920
      ** menu PTMN.                                                       178920
      *                                                                   178920
     C           AMTPA     IFEQ 'PT'                                      178920
     C                     ADD  PRAM      CPAMX                           178920
     C                     ENDIF                                          178920
      *                                                                   178920
      ** If amendment type is PF, deduct the amount to the loan's CPAM    178920
      ** PSAM should not be updated because it was already updated in     178920
      ** menu PTMN.                                                       178920
      *                                                                   178920
     C           AMTPA     IFEQ 'PF'                                      178920
     C                     SUB  PRAM      CPAMX                           178920
     C                     ENDIF                                          178920
      *                                                                   178920
      ** If AMTP is MR/RE, deduct amount from loan's CPAM and from the    178920
      ** orginal/mirror loan's PSAM.                                      178920
      *                                                                   178920
     C           AMTPA     IFEQ 'RE'                                      178920
     C           AUTO      ANDEQ'Y'                                       178920
     C           AMTPA     OREQ 'MR'                                      178920
     C                     SUB  PRAM      CPAMX                           178920
     C                     SUB  PRAM      WSVPA                           178920
     C                     ENDIF                                          178920
      *                                                                   178920
     C                     ENDIF                                          178920
      *                                                                   178920
     C           LNRFX     READELOAMS                    01               178920
     C                     ENDDO                                          178920
      *                                                                   178920
     C                     MOVE '0'       *IN01                           178920
      *                                                                   178920
     C           MDATX     IFLE WSVVD                                     181775
     C           MDATX     ANDGT0                                         181775
     C           AUTOX     ANDEQ'Y'                                       181775
     C           WSVPA     SUB  CPAMX     WSVPA                           181775
     C                     ENDIF                                          181775
     C                     ENDIF                                          181775
      *                                                                   181775
     C                     ENDIF                                          181775
      *                                                                   181775
     C                     READ CLOANLJ                  01               181775
     C                     ENDDO                                          181775
      *                                                                   181775
     C                     MOVE WIN01     *IN01                           181775
      *                                                                   155721
      ** If called by principal transfer, validation is not needed        155721
      *                                                                   155721
     C           PGNTF     IFEQ 'Y'                                       155721
     C           PMODE     ANDEQ'B'                                       155721
     C                     ELSE                                           155721
     C***********WSVPA     IFGT CPAMM                                     156136
     C           WSVPA     IFGT WCPAMM                                    156136
     C                     MOVE '1'       *IN39
     C                     MOVEL'LEL0119' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF                                          155721
     C                     ENDIF
      *
      ** ... deal date must not be earlier than the deal date of the
      ** related loan
      *
     C           *IN40     IFEQ '0'
     C           WSVDD     ANDLTDDATM
     C                     MOVE '1'       *IN40
     C                     MOVEL'LEL0115' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... start date must not be earlier than the start date of the
      ** related loan
      *
     C           *IN42     IFEQ '0'
     C           WSVVD     ANDLTVDATM
     C                     MOVE '1'       *IN42
     C                     MOVEL'LEL0116' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... maturity date must not be later than maturity date of
      ** the related loan
      *
     C           *IN44     IFEQ '0'
     C           WSVMD     ANDGTMDATM
     C                     MOVE '1'       *IN44
     C                     MOVEL'LEL0117' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... maturity date of a discount parts sold must equal that
      ** of the related loan
      *
     C           PMODE     IFNE 'B'                                       125545
     C           PMODE     OREQ 'B'                                       125545
     C           SYINF     ANDNE'Y'                                       125545
     C           SACTN     IFEQ 'A'
     C           WLNPT     ANDEQ67
     C           WSVMD     ANDNEMDAT
     C           SACTN     OREQ 'A'                                       CLE005
     C           WLNPT     ANDEQ72                                        CLE005
     C           W72TP     ANDEQ'67'                                      CLE005
     C           WSVMD     ANDNEMDAT                                      CLE005
      *                                                                   165965
      ** Cannot early mature a disc loan with rollover details nor        165965
      ** can maturity date be extended                                    165965
      *                                                                   165965
     C           WSVMD     IFLT MDAT                                      165965
     C           RLDT      ANDNE*ZEROS                                    165965
     C           WSVMD     ORGT MDAT                                      165965
     C                     MOVE '1'       *IN44
     C***********          MOVEL'LEL0218' ZAMSID                          165965
     C                     MOVEL'LEL0097' ZAMSID                          165965
     C                     EXSR ZASNMS
     C                     ENDIF                                          165965
      *                                                                   165965
     C                     ENDIF
     C                     ENDIF                                          125545
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRVAL2  -  Validate second detail screen                      *
      * Called by: SRDTL2 - Process second detail screen              *
      *            SRBTCH - Batch processing                          *
      * Calls    : SRCINT - Calculate effective interest              *
      *            SRCL05 - Validate CLE005 fields                    *
      *****************************************************************
     C           SRVAL2    BEGSR
      *
     C                     MOVE '0'       *IN44
      *                                                                                       CLE028
      ** Initialise indicators used by CLE028.                                                CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     MOVEA'0000'    *IN,36                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     MOVEAWVAL2A    *IN,47
     C                     MOVEAWVAL2B    *IN,68
     C                     EXSR CLEAR
     C                     MOVE 'E'       WRMSV
     C/COPY WNCPYSRC,LE2030C118
      *
      ** VALIDATE BASE RATE TYPE
      *
     C                     Z-ADD*ZEROS    BASER
     C           SBRTT     IFEQ '00'
     C                     MOVE *BLANKS   SBRTT
     C                     ENDIF
      *
     C           SBRTT     IFNE *BLANKS
     C                     MOVE SCURR     PKEY1
     C                     MOVE SBRTT     PKEY2
     C                     CALL 'AOBSRTR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PKEY1   3
     C                     PARM           PKEY2   2
     C********** SDBSRT    PARM SDBSRT    DSFDY                                 CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                                 CSD006
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE BABSRC    SBRTT
     C                     ENDIF
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SBRTT
     C                     ENDIF
      *
      ** ... if not existing base rate code, or base rate change
      ** facility is not Y, or base rate currency is different from
      ** loan currency, invalidate entry
      *
     C           PRTCD     IFNE *BLANKS
     C********** BPBRCF    ORNE 'Y'                                                         AR826115
     C           BPBRCF    ORNE 'Y'                                                         MD034840
     C           *IN38     OREQ '0'
     C           SCURR     ANDNEBACYCD
     C                     MOVE '1'       *IN47
     C                     MOVEL'LEL0139' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
     C           *IN47     IFEQ '0'
     C           SBRTT     ANDNE*BLANKS
     C           BPBRCF    ANDEQ'Y'
     C           WSVVD     IFLT BAVDNR
     C                     Z-ADDBACBSR    BASER
     C                     ELSE
     C                     Z-ADDBANBRT    BASER  117
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE BASE RATE CHANGE INDICATOR
      *
      ** ... must be 'D', 'R', 'N' or ' '
      ** ... must be blank if base rate not entered or '00' on insert
      ****** must*not*be*'R'*(rollover*date)*for*call*loans************** 144688
      *
      ** For loans generated by Principal Transfers, default the base                         222575
      ** rate change indicator to that from the transfer originating                          222575
      ** loan.                                                                                222575
      *                                                                                       222575
     C           SCHIN     IFEQ *BLANKS                                                       222575
     C           PGNTF     ANDEQ'Y'                                                           222575
     C                     MOVELPTOLN     WALON                                               222575
     C                     MOVE 'A'       WEPAR                                               222575
     C           WKLON     CHAINCLOAN                89                                       222575
     C           *IN89     IFEQ '0'                                                           222575
     C                     MOVELCHIN      SCHIN                                               222575
     C                     ENDIF                                                              222575
     C                     ENDIF                                                              222575
      *                                                                                       222575
     C           SCHIN     IFNE *BLANK
     C           SCHIN     ANDNE'D'
     C           SCHIN     ANDNE'R'
     C           SCHIN     ANDNE'N'
      *
     C           SACTN     OREQ 'I'
     C           SBRTT     ANDEQ*BLANKS
     C           SCHIN     ANDNE*BLANK
     C           PMODE     ANDNE'B'                                       197449
      *
     C***********WLNPT     OREQ 61                                        144688
     C***********SCHIN     ANDEQ'R'                                       144688
      *                                                                   CLE005
     C***********WLNPT     OREQ 68                                 CLE005 144688
     C***********SCHIN     ANDEQ'R'                                CLE005 144688
     C                     MOVE '1'       *IN48
     C                     ENDIF
      *
      ** ... must be 'N' or blank for discounted loans/parts purhased/
      ** parts sold
      ** must be 'N' or blank for flat rate personal loans                                    CLE028
      *
     C           SCHIN     IFNE 'N'
     C           SCHIN     ANDNE*BLANK
     C           WLNPT     IFEQ 63
     C           WLNPT     OREQ 65
     C           WLNPT     OREQ 67
     C           WLNPT     OREQ 72                                        CLE005
     C           W72TP     ANDEQ'67'                                      CLE005
     C           WLNPT     OREQ 80                                                            CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C                     MOVE '1'       *IN48
     C                     ENDIF
     C                     ENDIF
      *
     C           *IN48     IFEQ '1'
     C           WLNPT     IFEQ 80                                                            CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C           SBRTT     ANDNE*BLANKS                                                       CLE028
     C                     MOVEL'LEL0554' ZAMSID                                              CLE028
     C                     ELSE                                                               CLE028
     C                     MOVEL'LEL0143' ZAMSID
     C                     ENDIF                                                              CLE028
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                                       CLE036
      ** VALIDATE BASE RATE                                                                   CLE036
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C           SBASR     IFNE *BLANKS                                                       CLE036
     C           SBRTT     IFEQ *BLANKS                                                       CLE036
     C                     MOVE '0'       WIN05   1                                           CLE036
     C                     MOVE *BLANKS   PSCRF                                               CLE036
     C                     MOVE SBASR     PSCRF                                               CLE036
     C                     Z-ADD4         PNDIG                                               CLE036
     C                     Z-ADD7         PNDEC                                               CLE036
     C                     CALL 'ZALIGN'  PPAR1                                               CLE036
     C                     MOVE PRVAL     BASER                                               CLE036
      *                                                                                       CLE036
     C           PRTCD     IFNE *BLANKS                                                       CLE036
     C                     MOVE '1'       WIN05   1                                           CLE036
     C                     MOVEL'LEL0577' ZAMSID                                              CLE036
     C                     EXSR ZASNMS                                                        CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     ELSE                                                               CLE036
      *                                                                                       CLE036
     C                     MOVE '1'       WIN05   1                                           CLE036
     C                     MOVE '1'       *IN47                                               CLE036
     C                     MOVEL'LEL0578' ZAMSID                                              CLE036
     C                     EXSR ZASNMS                                                        CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *
      ** VALIDATE SPREAD RATE
      *
     C                     MOVE *BLANKS   PSCRF
     C                     MOVE SRTSP     PSCRF
     C                     Z-ADD4         PNDIG
     C                     Z-ADD7         PNDEC
     C                     CALL 'ZALIGN'  PPAR1
     C                     MOVE PRVAL     WSVRS  117
      *
      ** ... if loan is not a guarantee and no base rate has been
      ** specified, spread rate must be entered
      *
     C           PRTCD     IFNE *BLANKS
     C           WLNPT     ORNE 70
     C           WLNPT     ANDNE71                                        CLE005
     C           WLNPT     ANDNE72                                        CLE005
     C           SBRTT     ANDEQ*BLANKS
     C           WSVRS     ANDEQ*ZEROS
     C           CLE036    ANDEQ'N'                                                           CLE036
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           WLNPT     ANDNE70                                                            CLE036
     C           WLNPT     ANDNE71                                                            CLE036
     C           WLNPT     ANDNE72                                                            CLE036
     C           SBRTT     ANDEQ*BLANKS                                                       CLE036
     C           SBASR     ANDEQ*BLANKS                                                       CLE036
     C           WSVRS     ANDEQ*ZEROS                                                        CLE036
     C***********WLNPT     OREQ 72                                 CLE005 160632
     C***********W72TP     ANDNE'70'                               CLE005 160632
     C***********SBRTT     ANDEQ*BLANKS                            CLE005 160632
     C***********WSVRS     ANDEQ*ZEROS                             CLE005 160632
     C                     MOVE '1'       *IN49
     C                     MOVEL'LEL0140' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                                     AR847588
      ** Validate spread rate sign.                                                         AR847588
      *                                                                                     AR847588
     C                     MOVE '0'       *IN90                                             AR847588
      *                                                                                     AR847588
      ** Spread rate sign must be blank if spread rate is blank.                            AR847588
      *                                                                                     AR847588
     C           SRTSP     IFEQ *BLANKS                                                     AR847588
     C           SRSGN     ANDNE*BLANKS                                                     AR847588
     C           SACTN     ANDEQ'I'                                                         AR847588
     C                     MOVE '1'       *IN90                                             AR847588
     C                     MOVEL'LEL0887' ZAMSID                                            AR847588
     C                     EXSR ZASNMS                                                      AR847588
     C                     ENDIF                                                            AR847588
      *                                                                                     AR847588
      ** Spread rate must be equal to either '+' or '-'.                                    AR847588
      *                                                                                     AR847588
     C           SACTN     IFEQ 'I'                                                         AR847588
     C           SRSGN     ANDNE*BLANKS                                                     AR847588
     C           SRTSP     ANDNE*BLANKS                                                     AR847588
     C           SRSGN     IFNE '-'                                                         AR847588
     C           SRSGN     ANDNE'+'                                                         AR847588
     C                     MOVE '1'       *IN90                                             AR847588
     C                     MOVEL'LEL0886' ZAMSID                                            AR847588
     C                     EXSR ZASNMS                                                      AR847588
     C                     ENDIF                                                            AR847588
     C                     ENDIF                                                            AR847588
      *
      ** VALIDATE SPREAD INDICATOR
      *
     C           SSPIN     IFEQ *BLANKS
     C           SBRTT     IFNE *BLANKS
     C           SRTSP     ORNE *BLANKS
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           SBASR     ANDNE*BLANKS                                                       CLE036
     C                     MOVE 'A'       SSPIN
     C                     ENDIF
     C                     ELSE
      *
     C           SSPIN     IFNE 'A'
     C           SSPIN     ANDNE'S'
     C           SSPIN     ANDNE'P'
      *
      ** ... must be blank if no base rate or spread rate is entered
      *
     C           SACTN     OREQ 'I'
     C***********SSPIN     ANDNE*BLANK                                    121890
     C           SBRTT     ANDEQ*BLANKS
     C           SSPIN     ANDNE'A'                                       121890
     C***********SRTSP     ANDEQ*BLANKS                                   121890
     C           CLE036    ANDEQ'N'                                                           CLE036
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           SBRTT     ANDEQ*BLANKS                                                       CLE036
     C           SSPIN     ANDNE'A'                                                           CLE036
     C           SBASR     ANDEQ*BLANKS                                                       CLE036
     C                     MOVE '1'       *IN50
     C                     MOVEL'LEL0142' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *                                                                                       206257
      ** Initialise WINTT to avoid its value from being used                                  206257
      ** by non-interest bearing loans                                                        206257
      *                                                                                       206257
     C                     Z-ADD0         WINTT                                               206257
      *                                                                                     AR847588
      ** Convert the spread rate to negative if spread rate sign is                         AR847588
      ** negative.                                                                          AR847588
      *                                                                                     AR847588
     C           SRSGN     IFEQ '-'                                                         AR847588
     C                     Z-SUBWSVRS     WSVRS                                             AR847588
     C                     ENDIF                                                            AR847588
      *
      ** Calculate effective interest rate
      *
     C                     SELEC
     C           SSPIN     WHEQ 'A'
     C           BASER     ADD  WSVRS     WINTT  117
     C           SSPIN     WHEQ 'S'
     C           BASER     SUB  WSVRS     WINTT
     C           SSPIN     WHEQ 'P'
     C           WSVRS     DIV  100       WRK139 139
     C           WRK139    MULT BASER     WINTT     H
     C***********BASER     ADD  WINTT     WINTT                                        221965 228328
     C                     ENDSL
      *
      ** VALIDATE INTEREST DATE
      *
     C                     Z-ADD*ZEROS    WSVID
     C           SNIDT     IFNE *BLANKS
     C                     DO
      *                                                                                    AR1067935
      ** Interest Payment Date must be blank for PDCL.                                     AR1067935
      *                                                                                    AR1067935
     C           CLE134    IFEQ 'Y'                                                        AR1067935
     C                     MOVELSLTYP     LTYP1                                            AR1067935
     C           LTYP1     IFEQ 'X'                                                        AR1067935
     C           LTYP1     OREQ 'Y'                                                        AR1067935
     C           LTYP1     OREQ 'Z'                                                        AR1067935
     C                     MOVE '1'       *IN51                                            AR1067935
     C                     MOVEL'5045904' ZAMSID                                           AR1067935
     C                     EXSR ZASNMS                                                     AR1067935
     C                     ENDIF                                                           AR1067935
     C                     ENDIF                                                           AR1067935
      *
     C                     MOVELSNIDT     WNUM7
     C                     MOVELWNUM7     WALF6
     C                     MOVE SNIDT     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    WSVID   50
     C                     Z-ADDZDAYNO    W#NIDT                          125557
     C           *IN99     IFEQ '1'
     C           SNIDT     ORNE WALF6
     C                     MOVE '1'       *IN51
     C                     MOVEL'LEL0144' ZAMSID
     C                     EXSR ZASNMS
     C                     LEAVE
     C                     ENDIF
      *
      ** ... must be greater than interest accrual control date
      *
     C                     MOVE '0'       WIN51   1
     C           SACTN     IFEQ 'I'
     C                     Z-ADDWSVVD     IACD
     C                     Z-ADD*ZERO     GDIN                            158264
     C                     ENDIF
     C           WSVID     IFLE IACD
      *                                                                   158264
      **  Consider the grace day period for the next interest date.       158264
      *                                                                   158264
     C           IACD      SUB  WSVID     WNUM1   20                      158264
     C           WNUM1     IFGT GDIN                                      158264
     C           GDIN      ANDGT*ZERO                                     158264
     C           GDIN      OREQ *ZERO                                     158264
     C                     MOVE '1'       WIN51
     C                     ENDIF                                          158264
     C                     ENDIF
      *
      ** ... if new maturity date is entered, interest date must be
      ** earlier than new maturity date, else, interest date must be
      ** earlier than maturity date entered
      *
     C           *IN44     IFEQ '0'
     C           SMDAT     ANDNE*BLANKS
     C           NMDT      IFGT *ZEROS
     C           SACTN     ANDNE'I'
     C                     Z-ADDNMDT      W0MDT
     C                     ELSE
     C                     Z-ADDWSVMD     W0MDT
     C                     ENDIF
     C           WSVID     IFGE W0MDT
     C                     MOVE '1'       WIN51
     C                     ENDIF
     C                     ENDIF
      *
     C           WIN51     IFEQ '1'
     C                     MOVE '1'       *IN51
     C                     MOVEL'LEL0145' ZAMSID
     C                     EXSR ZASNMS
     C                     LEAVE
     C                     ENDIF
      *
      ** ... must be blank for zero interest amounts and discount loans
      ** parts purchased and sold
      *
     C           WINTT     IFEQ *ZEROS
     C           WLNPT     OREQ 63
     C           WLNPT     OREQ 65
     C           WLNPT     OREQ 67
     C           WLNPT     OREQ 72                                        CLE005
     C           W72TP     ANDEQ'67'                                      CLE005
     C/COPY WNCPYSRC,LE2030C133
     C                     MOVE '1'       *IN51
     C                     MOVEL'LEL0159' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C/COPY WNCPYSRC,LE2030C134
      **  Next interest date must be the same as the rollover date                            190016
      **  if interest frequency = 'R'. If dates are different,                                190016
      **  display error message and highlight both fields.                                    190016
     C           SIPFR     IFEQ 'R'                                                           190016
     C           WSVID     ANDNEWSVRD                                                         190016
     C           SNIDT     ANDNE*BLANKS                                                       190016
     C                     MOVE '1'       *IN51                                               190016
     C                     MOVE '1'       *IN52                                               190016
     C                     MOVEL'LEL0516' ZAMSID                                              190016
     C                     EXSR ZASNMS                                                        190016
     C                     ENDIF                                                              190016
      *                                                                   146834
      ** Send warning message if interest payment date is earlier         146834
      ** than rundate.                                                    146834
      *                                                                   146834
     C           SACTN     IFEQ 'A'                                       146834
     C           SACTN     OREQ 'X'                                       146834
     C********** WSVID     IFLT BJRDNB                                                 146834 CSC011
     C********** ORED      ANDLTBJRDNB                                                 146834 CSC011
     C           WSVID     IFLT WRNDAY                                                        CSC011
     C           ORED      ANDLTWRNDAY                                                        CSC011
     C           WE504     IFEQ *BLANK                                    146834
     C           WE504     OREQ 'Y'                                       146834
     C           WSVID     ANDNEW1ID                                      146834
     C                     Z-ADDWSVID     W1ID                            146834
     C                     MOVE 'Y'       WE504   1                       146834
     C                     MOVE 'W'       WRMSV                           146834
     C                     MOVE 'Y'       WWARN                           146834
     C                     MOVE '1'       *IN51                           146834
     C                     MOVEL'LEL0504' ZAMSID                          146834
     C                     EXSR ZASNMS                                    146834
     C                     MOVE 'E'       WRMSV                           146834
     C                     ENDIF                                          146834
     C                     ENDIF                                          146834
     C                     ENDIF                                          146834
      *
      ** ... save the old value of the interest date                      142405
      *                                                                   142405
     C           SACTN     IFEQ 'I'                                       142405
     C                     Z-ADDWSVID     W#OIDT  50                      142405
     C                     ELSE                                           142405
     C           SACTN     IFEQ 'X'                                       142405
     C                     Z-ADDOIDT      W#OIDT                          142405
     C                     ELSE                                           142405
     C                     Z-ADDNIDT      W#OIDT                          142405
     C                     ENDIF                                          142405
     C                     ENDIF                                          142405
      *
     C                     ENDDO
     C                     ENDIF
      *
      ** VALIDATE INTEREST FREQUENCY
      *
     C           SNIDT     IFEQ *BLANKS
     C           SIPFR     ANDNE*BLANK
     C           SIPFR     ANDNE'R'                                                           190016
     C           SNIDT     OREQ *BLANKS                                                       190016
     C           SIPFR     ANDEQ'R'                                                           190016
     C           SRLDT     ANDEQ*BLANKS                                                       190016
     C                     MOVE '1'       *IN52
     C                     MOVEL'LEL0160' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      *
      ** ... valid frequency codes are W,F,M,T,Q,X,Y
      ** ... if CLE005 is installed, R is also valid
      *
     C           SIPFR     IFNE *BLANK
     C           SIPFR     LOKUPWFREQ                    89
     C           *IN89     IFEQ '0'
     C           SIPFR     ANDNE'R'                                       CLE005
     C/COPY WNCPYSRC,LE2030C107
     C           SIPFR     OREQ 'R'
     C           CLE005    ANDEQ'N'
     C/COPY WNCPYSRC,LE2030C106
     C                     MOVE '1'       *IN52
     C                     MOVEL'LEL0055' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE INTEREST DAY NUMBER
      ** ... defaults to day number in interest date if valid
      *
     C           SIFDY     IFEQ *BLANKS
     C           *IN51     IFEQ '0'
     C           *IN52     ANDEQ'0'
     C           SNIDT     ANDNE*BLANKS
     C           SIPFR     ANDNE*BLANKS
     C           SIPFR     ANDNE'W'
     C           SIPFR     ANDNE'F'
     C           SIPFR     ANDNE'R'                                       CLE005
     C/COPY WNCPYSRC,LE2030C132
     C                     MOVE SNIDT     WDATE
     C           BJDFIN    IFEQ 'M'
     C                     MOVE WDAT2     SIFDY
     C                     ELSE
     C                     MOVE WDAT1     SIFDY
     C                     ENDIF
     C                     ENDIF
      *
     C                     ELSE
      *
     C           SIPFR     IFEQ *BLANK
     C                     MOVE '1'       *IN53
     C                     MOVEL'LEL0277' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      *
     C/COPY WNCPYSRC,LE2030C123
      ** ... must be numeric, from 1 to 31
      *
     C                     MOVELSIFDY     WNUM3   30
     C                     MOVELWNUM3     WALF2   2
     C           SIFDY     IFNE WALF2
     C           SIFDY     ORLT '01'
     C           SIFDY     ORGT '31'
     C                     MOVE '1'       *IN53
     C                     MOVEL'LEL0279' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C/COPY WNCPYSRC,LE2030C124
     C                     ENDIF
     C                     ENDIF
     C                     MOVE SIFDY     WIFDY
      *
      ** ... Default interest details to rollover details if not
      ** entered
      *
     C           SACTN     IFEQ 'I'
     C           SRLDT     ANDNE*BLANKS
      *
      ** ... for insert, if interest payment details are blank, allow
      **     default of values held in rollover details provided:
      **       1) rollover details have been entered, and;
      **       2) processing type is 62 for loans;
      **          or processing type is 64 for parts purchased;           158059
      **          or processing type is 66 for parts sold;
      **       3) either interest rate or base rate type and spread
      **             have been entered, and;
      **       4) repayment type is '2' (int. on its own frequency)
     C*        5)   Rollover Date is not back-valued                      158059
      *        6) cont from 3); or base rate have been entered                                CLE036
      *
     C           SNIDT     ANDEQ*BLANKS
     C           SIPFR     ANDEQ*BLANKS
     C           SIFDY     ANDEQ*BLANKS
     C           SRLDT     ANDNE*BLANKS
     C           SREPT     ANDEQ'2'
     C           *IN47     ANDEQ'0'
     C           *IN49     ANDEQ'0'
      *
     C***        *IN21     IFEQ '0'                                       158059
     C           *IN21     IFEQ '1'                                       158059
     C           WLNPT     ANDEQ64                                        158059
     C***        *IN22     ANDEQ'0'                                       158059
     C           *IN22     OREQ '0'                                       158059
     C           *IN21     ANDEQ'0'                                       158059
     C           WLNPT     ANDEQ62
     C           *IN22     OREQ '1'
     C           WLNPT     ANDEQ66
     C           *IN22     OREQ '1'                                       CLE005
     C           WLNPT     ANDEQ69                                        CLE005
     C           *IN22     OREQ '1'                                       CLE005
     C           WLNPT     ANDEQ72                                        CLE005
     C           W72TP     ANDEQ'66'                                      CLE005
      *
     C           SBRTT     IFNE *BLANKS
     C           SRTSP     ORNE *BLANKS
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           SBASR     ANDNE*BLANKS                                                       CLE036
     C                     Z-ADDWSVRD     WSVID
     C                     MOVE SRLDT     SNIDT
     C                     MOVE SRLFQ     SIPFR
     C           SRLDY     IFNE *ZEROS
     C                     MOVE SRLDY     SIFDY
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *                                                                   CLE005
      ** Also on insert, if interest frequency is 'R' and rollover        CLE005
      ** date is input, overwrite interest date with rollover date        CLE005
      *                                                                   CLE005
     C           SACTN     IFEQ 'I'                                       CLE005
     C           SRLDT     ANDNE*BLANKS                                   CLE005
     C           SIPFR     ANDEQ'R'                                       CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C                     Z-ADDWSVRD     WSVID                           CLE005
     C                     MOVE SRLDT     SNIDT                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                                       190016
      ** Also, if User clears the Next Interest Payment date field                            190016
      ** whilst in Amend mode, and Interest Frequency = 'R', default                          190016
      ** the Rollover date to the Interest Date field.                                        190016
      *                                                                                       190016
     C           SACTN     IFEQ 'A'                                                           190016
     C           SRLDT     ANDNE*BLANKS                                                       190016
     C           SIPFR     ANDEQ'R'                                                           190016
     C           SNIDT     ANDEQ*BLANKS                                                       190016
     C           CLE005    ANDEQ'Y'                                                           190016
     C                     Z-ADDRLDT      WSVID                                               190016
     C                     MOVE SRLDT     SNIDT                                               190016
     C                     ENDIF                                                              190016
      *
      ** VALIDATE INTEREST CALCULATION BASIS
      ** ... defaults to the calculation basis specified against the
      ** facility to which it is being linked.                            126065
      ***facility*to*which*it*is*being*linked,*except*for*parts*sold***   126065
      *
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           WLNPT     ANDEQ80                                                            CLE028
      *                                                                                       CLE028
     C           SCALC     IFNE *BLANK                                                        CLE028
     C                     MOVE '1'       *IN54                                               CLE028
     C                     MOVEL'LEL0555' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDIF                                                              CLE028
     C                     ELSE                                                               CLE028
      *                                                                                       CLE028
     C           SCALC     IFEQ *BLANK
     C************IN22     ANDEQ'0'                                       126065
     C           *IN22     ANDEQ'0'                                       126623
     C           *IN34     ANDEQ'0'
     C           DICB      ANDNE*ZEROS                                    121711
     C***********CALCF     ANDNE*ZEROS                                    121711
     C***********          MOVE CALCF     SCALC                           121711
     C                     MOVE DICB      SCALC                           121711
     C                     ENDIF
      *                                                                   126623
      * For parts sold interest calculation defaults from sale of loan    126623
      * number.                                                           126623
      *                                                                   126623
     C           SCALC     IFEQ *BLANK                                    126623
     C           *IN22     ANDEQ'1'                                       126623
     C           S#ICBS    ANDNE*ZERO                                     126623
     C                     MOVE S#ICBS    SCALC                           126623
     C                     ENDIF                                          126623
      *                                                                   126623
     C           SCALC     IFLT '1'
     C           SCALC     ORGT '6'
     C                     MOVE '1'       *IN54
     C                     MOVEL'LEL0141' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C/COPY WNCPYSRC,LE2030C042
      *
      ** VALIDATE INTEREST/DISCOUNT AMOUNT
      *
      ** ... not in amend mode, interest should be valid numeric
      ** ... in amend mode, Rule of 78s is installed, loan processing                         219695
      ** type is '80' and Interest field is amendable, interest should                        219695
      ** be valid numeric.                                                                    219695
      *
     C           SACTN     IFEQ 'I'
     C           PMODE     ANDNE'B'
     C           SACTN     OREQ 'A'                                                           219695
     C           PMODE     ANDNE'B'                                                           219695
     C           CLE028    ANDEQ'Y'                                                           219695
     C           WPRCS2    ANDNE'Y'                                                           219695
     C           WLNPT     ANDEQ80                                                            219695
     C                     MOVEL*BLANK    WIPRD1  1                                           CLE028
     C                     MOVEL*BLANK    WIPR13 13                                           CLE028
     C                     MOVELSIPRD     WIPRD1                                              CLE028
     C                     MOVE SIPRD     WIPR13                                              CLE028
     C           CLE028    IFNE 'Y'                                                           CLE028
     C           WIPRD1    ANDEQ'*'                                                           CLE028
     C           WIPRD1    ORNE '*'                                                           CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           WIPRD1    ANDEQ'*'                                                           CLE028
     C           WIPR13    ANDNE*BLANK                                                        CLE028
     C                     MOVE *BLANKS   PSCRF
     C                     MOVE SIPRD     PSCRF
      *                                                                                       CLE031
      ** If CLE031 is on, facility currency is not equal to SCURR and                         CLE031
      ** principal amount is not inputted (WSVAM = 0), use facility                           CLE031
      ** currency number of places instead of WCDPL.                                          CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           SFCCY     ANDNESCURR                                                         CLE031
     C           WSVAM     ANDEQ*ZERO                                                         CLE031
     C                     Z-ADDWFCNBP    PNDEC                                               CLE031
     C           13        SUB  WFCNBP    PNDIG                                               CLE031
     C                     ELSE                                                               CLE031
     C                     Z-ADDWCDPL     PNDEC
     C           13        SUB  WCDPL     PNDIG
     C                     ENDIF                                                              CLE031
     C                     CALL 'ZALIGN'  PPAR1
     C                     MOVE PRVAL     WTOTI  130
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN55
     C                     MOVEL'LEL0146' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF                                                              CLE028
     C                     ENDIF
      *                                                    CSC011
      ** If the transaction has been performed in batch    CSC011
      ** default in the calculated interest amount.        CSC011
      *                                                    CSC011
     C           SACTN     IFEQ 'I'                        CSC011
     C           PMODE     ANDEQ'B'                        CSC011
     C           SACTN     OREQ 'A'                                                           217847
     C           ORED      ANDEQBJRDNB                                                        217847
     C           PMODE     ANDEQ'B'                                                           219695
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           WLNPT     ANDEQ80                                                            CLE028
     C                     EXSR SRCIN8                                                        CLE028
     C                     ELSE                                                               CLE028
     C                     EXSR SRCINT                     CSC011
     C                     ENDIF                                                              CLE028
      *                                                    CSC011
     C                     MOVE *BLANKS   ZFLD15           CSC011
     C                     MOVE WCHKI     ZFLD15           CSC011
     C                     Z-ADDWCDPL     ZDECS            CSC011
     C                     MOVE 'L'       ZECODE           CSC011
     C                     EXSR ZFRPED                     CSC011
     C           ZNEG      IFEQ '-'                        CSC011
     C                     MOVE ZOUT21    SIPRD            CSC011
     C                     ELSE                            CSC011
     C                     MOVE ZOUT20    SIPRD            CSC011
     C                     ENDIF                           CSC011
      *                                                    CSC011
     C                     ENDIF                           CSC011
      *                                                                                     AR847588
      ** Validate interest sign.                                                            AR847588
      *                                                                                     AR847588
     C                     SETOF                     40                                     AR847588
      *                                                                                     AR847588
      ** Interest sign must be blank if interest is blank.                                  AR847588
      *                                                                                     AR847588
     C           SACTN     IFEQ 'I'                                                         AR847588
     C           PMODE     ANDNE'B'                                                         AR847588
     C           SIPRD     ANDEQ*BLANKS                                                     AR847588
     C           INSGN     ANDNE*BLANKS                                                     AR847588
     C                     MOVE '1'       *IN40                                             AR847588
     C                     MOVEL'LEL0889' ZAMSID                                            AR847588
     C                     EXSR ZASNMS                                                      AR847588
     C                     ENDIF                                                            AR847588
      *                                                                                     AR847588
      ** Interest sign must be either '+' or '-'.                                           AR847588
      *                                                                                     AR847588
     C           SACTN     IFEQ 'I'                                                         AR847588
     C           PMODE     ANDNE'B'                                                         AR847588
     C           SIPRD     ANDNE*BLANKS                                                     AR847588
     C           INSGN     ANDNE*BLANKS                                                     AR847588
     C           INSGN     IFNE '-'                                                         AR847588
     C           INSGN     ANDNE'+'                                                         AR847588
     C                     MOVE '1'       *IN40                                             AR847588
     C                     MOVEL'LEL0888' ZAMSID                                            AR847588
     C                     EXSR ZASNMS                                                      AR847588
     C                     ENDIF                                                            AR847588
     C                     ENDIF                                                            AR847588
      *
      ** ... if amend, and loan is a discount loan, and it is an early
      ** repayment, recalculate interest amount
      *
     C           SACTN     IFEQ 'A'
     C           WLNPT     ANDEQ63
     C           *IN44     ANDEQ'0'
     C           WLNPT     OREQ 65                                                            195745
     C           SACTN     ANDEQ'A'                                                           195745
     C           *IN44     ANDEQ'0'                                                           195745
     C           WLNPT     OREQ 67                                                            195745
     C           SACTN     ANDEQ'A'                                                           195745
     C           *IN44     ANDEQ'0'                                                           195745
     C           WSVMD     IFLT MDAT
     C                     EXSR SRCINT
     C           ORTI      IFEQ *ZEROS
     C           ORMD      ANDEQ*ZEROS
     C********** ORED      ANDLTBJRDNB                                    CSC011
     C********** VDAT      ANDLTBJRDNB                                    CSC011
     C           ORED      ANDLTWRNDAY                                    CSC011
     C           VDAT      ANDLTWRNDAY                                    CSC011
     C                     Z-ADDTOTI      WORTI  130
     C                     MOVE MDAT      WORMD   50
     C                     ENDIF
      *
     C                     ELSE
     C                     Z-ADDORTI      WORTI
     C                     MOVE ORMD      WORMD
     C                     Z-ADDTOTI      WTOTI
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE MARGIN AND NEGATIVE INDICATOR
      *
     C                     MOVE *BLANKS   PSCRF
     C                     MOVELSMARG     PSCRF
     C                     Z-ADD5         PNDEC
     C                     Z-ADD2         PNDIG
     C                     CALL 'ZALIGN'  PPAR1
     C                     MOVE PRVAL     WSVMG   75
     C           PRTCD     IFEQ *BLANKS
      *
      ** ... send warning msg if margin is greater than effective
      ** interest or equal to blanks
      *
     C           WSVMG     IFGT WINTT
     C           SMARG     OREQ *BLANKS
      *                                                                   158856
      ** Only give warning msg for margin eq to blanks if not risk loan   158856
      *                                                                   158856
     C           WLNPT     ANDNE70                                        158856
     C           WLNPT     ANDNE71                                        158856
     C           WLNPT     ANDNE72                                        158856
      *                                                                   158856
     C           PRVAL     OREQ *ZEROS                                    158143
     C           WLNPT     ANDNE70                                        158856
     C           WLNPT     ANDNE71                                        158856
     C           WLNPT     ANDNE72                                        158856
      *                                                                   158856
     C           WE022     IFEQ *BLANK
     C           WE022     OREQ 'Y'
     C***********WSVMG     ANDNEW1MG                                      158143
     C***********          Z-ADDWSVMG     W1MG    75                      158143
     C           SMARG     ANDNEW1MG                                      158143
     C                     MOVELSMARG     W1MG    8                       158143
     C                     MOVE 'Y'       WE022   1
     C                     MOVE 'W'       WRMSV
     C                     MOVE 'Y'       WWARN
     C                     MOVE '1'       *IN56
     C                     MOVEL'LEL0082' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'E'       WRMSV
     C                     ELSE                                           158143
     C           PRVAL     IFEQ *ZEROS                                    158143
     C           SMARG     ANDNE*BLANKS                                   158143
     C                     MOVE *BLANKS   SMARG                           158143
     C                     MOVE 0         SMARG                           158143
     C                     ENDIF                                          158143
     C                     ENDIF
     C                     ENDIF                                          189591
     C           SNEGV     IFEQ 'Y'
     C                     Z-SUBWSVMG     WSVMG
     C                     ENDIF
     C**********           ENDIF                                          189591
      *
     C                     ELSE
     C                     MOVE '1'       *IN56
     C                     MOVEL'LEL0147' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... negative indicator must be 'Y' or blank
      ** ... must be blank if margin is blank
      *
     C           SNEGV     IFNE *BLANK
     C           SNEGV     ANDNE'Y'
     C           SMARG     OREQ *BLANKS
     C           SNEGV     ANDNE*BLANK
     C                     MOVE '1'       *IN57
     C                     MOVEL'LEL0148' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... Margin and negative indicator are non-amendable for
      ** discounted loans with input and value dates which are
      ** earlier than rundate
      *
     C           SACTN     IFEQ 'A'
     C********** ORED      ANDLTBJRDNB                                    CSC011
     C********** VDAT      ANDLTBJRDNB                                    CSC011
     C           ORED      ANDLTWRNDAY                                    CSC011
     C           VDAT      ANDLTWRNDAY                                    CSC011
     C           WLNPT     IFEQ 63
     C           WLNPT     OREQ 65
     C           WLNPT     OREQ 67
     C           WLNPT     OREQ 72                                        CLE005
     C           W72TP     ANDEQ'67'                                      CLE005
     C           WSVMG     IFGE *ZEROS
     C                     MOVE *BLANK    W1NEG   1
     C                     Z-ADDMARG      W1MAR   75
     C                     ELSE
     C                     MOVE 'Y'       W1NEG
     C                     Z-SUBMARG      W1MAR
     C                     ENDIF
      *
     C           WSVMG     IFNE W1MAR
      *                                                                   CDE002
     C           CDE002    IFEQ 'Y'                                       CDE002
      *                                                                   CDE002
     C           WE027     IFEQ *BLANK                                    CDE002
     C           WE027     OREQ 'Y'                                       CDE002
     C           WSVMG     ANDNEW1MARG                                    CDE002
      *                                                                   CDE002
     C                     Z-ADDWSVMG     W1MARG  75                      CDE002
     C                     MOVE 'Y'       WE027                           CDE002
     C                     MOVE 'W'       WRMSV                           CDE002
     C                     MOVE 'Y'       WWARN                           CDE002
     C                     MOVE *ON       *IN56                           CDE002
     C                     MOVEL'LEL0527' ZAMSID                          CDE002
     C                     EXSR ZASNMS                                    CDE002
      *                                                                   CDE002
     C                     ENDIF                                          CDE002
      *                                                                   CDE002
     C                     ELSE                                           CDE002
      *                                                                   CDE002
     C                     MOVE '1'       *IN56
     C                     MOVEL'LEL0350' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CDE002
     C                     ENDIF                                          CDE002
      *                                                                   CDE002
     C                     ENDIF
      *
     C           SNEGV     IFNE W1NEG
     C                     MOVE '1'       *IN57
     C                     MOVEL'LEL0351' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE WITHHOLDING TAX RATE
      *
     C                     MOVE *BLANKS   PSCRF
     C                     MOVELSWTRT     PSCRF
     C                     Z-ADD7         PNDEC
     C                     Z-ADD4         PNDIG
     C                     CALL 'ZALIGN'  PPAR1
     C                     MOVE PRVAL     WSVWT  117
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN58
     C                     MOVEL'LEL0153' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... must be blank for non-term loans or for term loans
      ** which are capitalising interest
      *
     C           WSVWT     IFNE *ZEROS
     C           WLNPT     IFNE 62
     C           WLNPT     ANDNE64
     C           WLNPT     ANDNE66
     C           WLNPT     ANDNE69                                        CLE005
     C           WLNPT     ANDNE72                                        CLE005
     C           WLNPT     OREQ 72                                        CLE005
     C           W72TP     ANDNE'66'                                      CLE005
     C           SINTC     OREQ 'Y'
     C                     MOVE '1'       *IN58
     C                     MOVEL'LEL0274' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** ... on amend, if withholding tax indicator is entered, so must
      ** be the rate, and likewise
      *
     C           SACTN     IFEQ 'A'
     C           WSVWT     IFNE *ZEROS
     C           SWTIN     ANDEQ*BLANK
     C           WSVWT     OREQ *ZEROS
     C           SWTIN     ANDNE*BLANK
     C                     MOVE '1'       *IN58
     C                     MOVEL'LEL0274' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE WITHHOLDING TAX INDICATOR
      ** ... only on insert
      *
     C           SACTN     IFEQ 'I'
     C           SWTIN     IFEQ *BLANK
     C           WSVWT     ANDNE*ZEROS
     C           SWTIN     ORNE *BLANK
     C           WSVWT     ANDEQ*ZEROS
     C           SWTIN     ORNE *BLANK
     C           SWTIN     ANDNE'R'
     C           SWTIN     ANDNE'N'
     C           SWTIN     ANDNE'G'
     C                     MOVE '1'       *IN59
     C                     MOVEL'LEL0154' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE CAPITALISATION INDICATOR
      *
     C           SACTN     IFEQ 'I'
     C           SNIDT     ANDEQ*BLANKS
     C           SINTC     ANDNE*BLANK
     C           SINTC     ANDNE'N'
     C                     MOVE '1'       *IN60
     C                     MOVEL'LEL0276' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      *
     C           SINTC     IFNE *BLANK
     C           SINTC     ANDNE'Y'
     C           SINTC     ANDNE'N'
     C                     MOVE '1'       *IN60
     C                     MOVEL'LEL0278' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      *
     C           SINTC     IFEQ *BLANK
     C           SNIDT     ANDNE*BLANKS
     C                     MOVE 'N'       SINTC
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           WLNPT     ANDEQ80                                                            CLE028
     C           SINTC     ANDEQ'Y'                                                           CLE028
     C                     MOVE '1'       *IN60                                               CLE028
     C                     MOVEL'LEL0556' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDIF                                                              CLE028
      *
      ** VALIDATE ROUND-DOWN INDICATOR
      ** ... validation carried out only on insert to avoid the field
      ** being flagged in error if round-down indicator of currency or
      ** branch code have since been changed from Y to N
      *
     C           SACTN     IFEQ 'I'
     C           SRDFC     IFNE *BLANK
     C           SRDFC     ANDNE'Y'
     C           SRDFC     ANDNE'N'
     C                     MOVE '1'       *IN61
     C                     MOVEL'LEL0307' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C           SRDFC     IFEQ *BLANK
     C                     MOVE 'N'       SRDFC
     C                     ENDIF
      *
      ** ... if 'Y', round down interest of loan currency and of branch
      ** must also be 'Y'
      *
     C           SRDFC     IFEQ 'Y'
     C           A6RDFC    IFEQ 'N'
     C                     MOVE '1'       *IN61
     C                     MOVEL'LEL0308' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C           A8RDFC    IFEQ 'N'
     C                     MOVE '1'       *IN61
     C                     MOVEL'LEL0309' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                                              217847
      *
      ** ... check that the interest entered is within the calculated
      ** amount to be within one unit of the currency specified.
      ** Do this if amount, value date, maturity date, base rate,
      ** spread rate, spread rate sign, interest basis, interest date,                      AR847588
      ** spread indicator and round-down indicator are valid.                               AR847588
      ***spread*rate,*interest*basis,*interest*date,*spread*indicator*                      AR847588
      ***and*round-down*indicator*are*valid***************************                      AR847588
      *
     C           SACTN     IFEQ 'I'                                                           217847
     C           SACTN     OREQ 'A'                                                           217847
     C           CLE028    ANDEQ'Y'                                                           217847
     C           ORED      ANDEQBJRDNB                                                        217847
     C           *IN39     IFEQ '0'
     C           *IN47     ANDEQ'0'
     C           *IN49     ANDEQ'0'
     C           *IN54     ANDEQ'0'
     C           *IN55     ANDEQ'0'
     C           *IN50     ANDEQ'0'
     C           *IN61     ANDEQ'0'
     C           *IN90     ANDEQ'0'                                                         AR847588
     C           WLNPT     ANDNE80                                                            CLE028
     C                     EXSR SRCINT
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE ACCRUAL INDICATOR
      *
     C           SADDI     IFEQ *BLANK
     C           BKALDI    IFEQ 'Y'
     C                     MOVE 'L'       SADDI
     C                     ELSE
     C                     MOVE 'F'       SADDI
     C                     ENDIF
      *
     C                     ELSE
     C           SADDI     IFNE 'F'
     C           SADDI     ANDNE'L'
     C           SADDI     ANDNE'B'
     C                     MOVE '1'       *IN62
     C                     MOVEL'LEL0312' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CLE028
      ** Validate the following if CLE028 is on.                                              CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
      *                                                                                       CLE028
      ** VALIDATE ADD ON INTEREST                                                             CLE028
      *                                                                                       CLE028
     C           SADIF     IFEQ *BLANK                                                        CLE028
     C                     MOVE 'N'       SADIF                                               CLE028
     C                     ELSE                                                               CLE028
     C                     SELEC                                                              CLE028
     C           WLNPT     WHNE 80                                                            CLE028
     C           SADIF     ANDEQ'Y'                                                           CLE028
     C                     MOVE '1'       *IN36                                               CLE028
     C                     MOVEL'LEL0546' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
      *                                                                                       CLE028
     C           SADIF     WHNE 'Y'                                                           CLE028
     C           SADIF     ANDNE'N'                                                           CLE028
     C                     MOVE '1'       *IN36                                               CLE028
     C                     MOVEL'LEL0547' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDSL                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** VALIDATE ADD ON CHARGES                                                              CLE028
      *                                                                                       CLE028
     C           SADCF     IFEQ *BLANK                                                        CLE028
     C                     MOVE 'N'       SADCF                                               CLE028
     C                     ELSE                                                               CLE028
     C                     SELEC                                                              CLE028
     C           WLNPT     WHNE 80                                                            CLE028
     C           SADCF     ANDEQ'Y'                                                           CLE028
     C                     MOVE '1'       *IN37                                               CLE028
     C                     MOVEL'LEL0548' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
      *                                                                                       CLE028
     C           SADCF     WHNE 'Y'                                                           CLE028
     C           SADCF     ANDNE'N'                                                           CLE028
     C                     MOVE '1'       *IN37                                               CLE028
     C                     MOVEL'LEL0549' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDSL                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** VALIDATE INCLUDE CHARGES ON INTEREST and                                             CLE028
      ** CHARGED AMOUNT                                                                       CLE028
      *                                                                                       CLE028
     C           SICIF     IFEQ *BLANKS                                                       CLE028
     C                     MOVE 'N'       SICIF                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     Z-ADD*ZEROS    WCHGA  130                                          CLE028
     C                     MOVE *BLANKS   PSCRF                                               CLE028
     C                     MOVE SCHGA     PSCRF                                               CLE028
     C                     Z-ADDWCDPL     PNDEC                                               CLE028
     C           13        SUB  WCDPL     PNDIG                                               CLE028
     C                     CALL 'ZALIGN'  PPAR1                                               CLE028
     C                     MOVE PRVAL     WCHGA                                               CLE028
      *                                                                                       CLE028
     C                     SELEC                                                              CLE028
      *                                                                                       CLE028
     C           SADCF     WHEQ 'Y'                                                           CLE028
      *                                                                                       CLE028
     C           SICIF     IFNE 'Y'                                                           CLE028
     C           SICIF     ANDNE'N'                                                           CLE028
     C                     MOVE '1'       *IN38                                               CLE028
     C                     MOVEL'LEL0550' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           SCHGA     IFEQ *BLANKS                                                       CLE028
     C           WCHGA     OREQ *ZEROS                                                        CLE028
     C           PRTCD     ORNE *BLANKS                                                       CLE028
     C                     MOVE '1'       *IN39                                               CLE028
     C                     MOVEL'LEL0552' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           SADCF     WHEQ 'N'                                                           CLE028
      *                                                                                       CLE028
     C           SICIF     IFNE 'N'                                                           CLE028
     C                     MOVE '1'       *IN38                                               CLE028
     C                     MOVEL'LEL0553' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           SCHGA     IFNE *BLANKS                                                       CLE028
     C           WCHGA     ANDNE*ZEROS                                                        CLE028
     C           PRTCD     ORNE *BLANKS                                                       CLE028
     C                     MOVE '1'       *IN39                                               CLE028
     C                     MOVEL'LEL0551' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ENDSL                                                              CLE028
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
      *
      ** VALIDATE REPAYMENT TYPE
      ** ... for non-discount loans or guarantees, default to 2
      *
     C           SREPT     IFEQ *BLANK
     C           SREPT     OREQ '0'                                       155102
     C           WLNPT     IFNE 63
     C           WLNPT     ANDNE65
     C           WLNPT     ANDNE67
     C***********WLNPT     ANDNE70                                        155102
     C***********WLNPT     ANDNE71                                 CLE005 155102
     C           WLNPT     ANDNE72                                        CLE005
     C           WLNPT     ANDNE80                                                            CLE028
     C           WLNPT     OREQ 72                                        CLE005
     C           W72TP     ANDNE'67'                                      CLE005
     C***********W72TP     ANDNE'70'                               CLE005 155102
     C           W72TP     ANDNE'63'                                      155102
     C           W72TP     ANDNE'65'                                      155102
     C                     MOVE '2'       SREPT
     C                     ENDIF
     C                     ENDIF
      *
      ** ... must be blank for guarantees & disc loans/parts purchased
      ** on insert
      *
     C           SACTN     IFEQ 'I'
     C           SREPT     ANDNE*BLANK
     C***********WLNPT     IFEQ 70                                        142388
     C***********WLNPT     OREQ 63                                        142388
     C           WLNPT     IFEQ 63                                        142388
     C           WLNPT     OREQ 65
     C           WLNPT     OREQ 67                                        CLE005
     C***********WLNPT     OREQ 71                                 CLE005 142388
     C***********WLNPT     OREQ 72                                 CLE005 142388
     C***********W72TP     ANDEQ'70'                               CLE005 142388
     C           WLNPT     OREQ 72                                        CLE005
     C           W72TP     ANDEQ'67'                                      CLE005
     C                     MOVE '1'       *IN68
     C                     MOVEL'LEL0267' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** ... must be '2' if call/demand loan and interest details input
      ** ... must not be '3' if withholding tax details entered
      ** ... must be numeric, from 1 to 3
      *
     C           WLNPT     IFEQ 61
     C           SACTN     IFEQ 'I'                                       CLE005
     C           SREPT     ANDNE'2'
      *                                                                   CLE005
     C           WLNPT     OREQ 68                                        CLE005
     C           SREPT     ANDNE'2'                                       CLE005
      *
     C           *IN58     OREQ '0'
     C           *IN59     ANDEQ'0'
     C           SWTRT     ANDNE*BLANKS
     C           SWTIN     ANDNE*BLANKS
     C           SREPT     ANDEQ'3'
      *
     C           SACTN     OREQ 'I'
     C           SREPT     ANDNE*BLANK
     C           SREPT     ANDNE'1'
     C           SREPT     ANDNE'2'
     C           SREPT     ANDNE'3'
     C                     MOVE '1'       *IN68
     C                     MOVEL'LEL0155' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF                                          158085
      *                                                                                       CLE028
      ** For flat rate personal loans, repayment type is mandatory and                        CLE028
      ** valid values are '1' and '3' only                                                    CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           WLNPT     ANDEQ80                                                            CLE028
     C           SREPT     IFNE '1'                                                           CLE028
     C           SREPT     ANDNE'3'                                                           CLE028
     C                     MOVE '1'       *IN68                                               CLE028
     C                     MOVEL'LEL0557' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** Add on interest only applicable if repayment type entered is '3'                     CLE028
      *                                                                                       CLE028
     C           SADIF     IFEQ 'Y'                                                           CLE028
     C           SREPT     ANDNE'3'                                                           CLE028
     C                     MOVE '1'       *IN68                                               CLE028
     C**********           MOVEL'LEL0569' ZAMSID                                       CLE028 CAS011
     C                     MOVEL'LEL0802' ZAMSID                                              CAS011
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *
      ** Interest payment date must be blank for repayment type 1 & 3
      *
     C           SREPT     IFNE '2'
     C           SREPT     ANDNE*BLANKS
     C           SNIDT     ANDNE*BLANKS
     C           *IN68     ANDEQ'0'
     C           *IN51     ANDEQ'0'
     C                     MOVE '1'       *IN51
     C                     MOVEL'LEL0144' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C****                 ENDIF                                   CLE005 158085
      *
      ** VALIDATE LOAN CURRENCY REPAYMENT AMOUNT
      ** ... must not be more than principal amount or must not change
      *
     C/COPY WNCPYSRC,LEH00877
     C                     Z-ADD*ZEROS    WSVRA
     C                     Z-ADD*ZEROS    WSVFA
     C                     MOVE *BLANKS   PSCRF
      *                                                                                    AR1067935
      ** Repayment Date must be blank for PDCL.                                            AR1067935
      *                                                                                    AR1067935
     C           CLE134    IFEQ 'Y'                                                        AR1067935
     C                     MOVELSLTYP     LTYP1                                            AR1067935
     C           LTYP1     IFEQ 'X'                                                        AR1067935
     C           LTYP1     OREQ 'Y'                                                        AR1067935
     C           LTYP1     OREQ 'Z'                                                        AR1067935
     C           SRAMT     IFNE *BLANKS                                                    AR1067935
     C                     MOVE '1'       *IN69                                            AR1067935
     C                     MOVEL'5045906' ZAMSID                                           AR1067935
     C                     EXSR ZASNMS                                                     AR1067935
     C                     ENDIF                                                           AR1067935
     C                     ENDIF                                                           AR1067935
     C                     ENDIF                                                           AR1067935
      *                                                                                       CLE028
      ** Allow '*' to be entered in the Loan Currency Repayment Amount field,                 CLE028
      ** This will be defaulted later on.                                                     CLE028
      *                                                                                       CLE028
     C                     MOVEL*BLANK    WRAMT1  1                                           CLE028
     C                     MOVEL*BLANK    WRAM14 14                                           CLE028
     C                     MOVELSRAMT     WRAMT1                                              CLE028
     C                     MOVE SRAMT     WRAM14                                              CLE028
     C           WRAMT1    IFNE '*'                                                           CLE028
     C           WRAMT1    OREQ '*'                                                           CLE028
     C           CLE028    ANDNE'Y'                                                           CLE028
     C           WRAMT1    OREQ '*'                                                           CLE028
     C           WRAM14    ANDNE*BLANK                                                        CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C           WLNPT     OREQ 63                                                            CLE028
     C           WLNPT     OREQ 65                                                            CLE028
     C           WLNPT     OREQ 67                                                            CLE028
     C           WLNPT     OREQ 72                                                            CLE028
     C           W72TP     ANDEQ'67'                                                          CLE028
     C                     MOVE SRAMT     PSCRF
     C                     MOVE WCDPL     PNDEC
     C           13        SUB  WCDPL     PNDIG
     C                     CALL 'ZALIGN'  PPAR1
     C                     MOVE PRVAL     WSVRA  130
     C           PRTCD     IFNE *BLANKS
     C           *IN39     OREQ '0'
     C***********WSVRA     ANDGTWSVAM                                     157553
     C           WSVRA     ANDGTWSVAM2                                    157553
     C                     MOVE '1'       *IN69
     C                     MOVEL'LEL0156' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF                                                              CLE028
      *                                                                   CLE005
      ** Missed out in original copy, discounts and guarantees are        CLE005
      ** not allowed to have repayments                                   CLE005
      *                                                                   CLE005
     C           SRAMT     IFNE *BLANKS                                   CLE005
     C           WSVRA     ANDNE*ZEROS                                    CLE005
     C           WLNPT     IFEQ 63                                        CLE005
     C           WLNPT     OREQ 65                                        CLE005
     C           WLNPT     OREQ 67                                        CLE005
     C***********WLNPT     OREQ 70                                 CLE005 142388
     C***********WLNPT     OREQ 71                                 CLE005 142388
     C           WLNPT     OREQ 72                                        CLE005
     C           W72TP     ANDEQ'67'                                      CLE005
     C***********WLNPT     OREQ 72                                 CLE005 142388
     C***********W72TP     ANDEQ'70'                               CLE005 142388
     C                     MOVE '1'       *IN69                           CLE005
     C                     MOVEL'LEL0156' ZAMSID                          CLE005
     C                     EXSR ZASNMS                                    CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
     C/COPY WNCPYSRC,LEH00883
      *
      ** VALIDATE FACILITY CURRENCY REPAYMENT AMOUNT
      ***(for*loans*and*parts*purchased)*******************************   120025
      ** ... when facility details are valid
      *
     C************IN22     IFEQ '0'                                       120025
     C***********CLE006    ANDEQ'Y'                                       120025
     C           CLE006    IFEQ 'Y'                                       120025
     C/COPY WNCPYSRC,LE2030C045
     C           *IN22     IFEQ '0'
     C                     MOVE FCCYF     PCURR
     C                     ELSE                                           120025
     C                     MOVE FCCYM     PCURR                           120025
     C                     ENDIF                                          120025
     C                     CALL 'AOCURRR0'PPAR5
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD13        DBASE            * DBERR 13 *
     C                     MOVELFCCYF     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** ... must be valid in facility currency
      *
     C                     MOVE *BLANKS   PSCRF
     C                     MOVE SFCRA     PSCRF
     C                     MOVE A6NBDP    PNDEC
     C           13        SUB  A6NBDP    PNDIG
     C                     CALL 'ZALIGN'  PPAR1
     C                     MOVE PRVAL     WSVFA  130
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN70
     C                     MOVEL'LEL0416' ZAMSID
     C                     EXSR ZASNMS
      *
      ** ... must not be more than the loan amount
      *
     C                     ELSE
     C***********FCCYF     IFNE SCURR                                     120025
     C           PCURR     IFNE SCURR                                     120025
     C                     Z-ADDA6SPRT    ZRATE1 138
     C                     MOVE A6MDIN    ZMDI1   1
     C                     Z-ADDWSVRT     ZRATE2 138
     C                     MOVE WSVIN     ZMDI2   1
     C                     EXSR ZXRATE
      *
     C***********          MOVE FCCYF     ZCCYI                           120025
     C                     MOVE PCURR     ZCCYI                           120025
     C                     MOVE SCURR     ZCCYO
     C                     MOVE A6NBDP    ZCDPI
     C                     MOVE WCDPL     ZCDPO
     C                     Z-ADDWSVFA     ZAMTCI
     C                     Z-ADDZRATEX    ZEXCH
     C                     MOVE ZMDIX     ZMD
     C                     EXSR ZCONV
     C                     ELSE
     C                     Z-ADDWSVFA     ZAMTCO
     C                     ENDIF
      *
     C***********ZAMTCO    IFGT WSVAM                                     157553
     C           ZAMTCO    IFGT WSVAM2                                    157553
     C                     MOVE '1'       *IN70
     C                     MOVEL'LEL0416' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *                                                                   CLE005
      ** Missed out in original copy, discounts and guarantees are        CLE005
      ** not allowed to have repayments                                   CLE005
      *                                                                   CLE005
     C***********SFCRA     IFNE *BLANKS                            CLE005 125258
     C***********WSVFA     ANDNE*ZEROS                             CLE005 125258
     C           WLNPT     IFEQ 63                                        CLE005
     C           WLNPT     OREQ 65                                        CLE005
     C***********WLNPT     OREQ 66                                 133865 142002
     C           WLNPT     OREQ 67                                        CLE005
     C***********WLNPT     OREQ 69                                 133865 142002
     C           WLNPT     OREQ 70                                        CLE005
     C           WLNPT     OREQ 71                                        CLE005
     C           WLNPT     OREQ 72                                        CLE005
     C***********W72TP     ANDNE'67'                               CLE005 146745
     C***********W72TP     ANDNE'70'                               CLE005 146745
     C           W72TP     ANDEQ'67'                                      146745
     C           WLNPT     OREQ 72                                        146745
     C           W72TP     ANDEQ'70'                                      146745
     C           SFCRA     IFNE *BLANKS                                   125258
     C           WSVFA     ANDNE*ZEROS                                    125258
     C                     MOVE '1'       *IN70                           CLE005
     C                     MOVEL'LEL0416' ZAMSID                          CLE005
     C                     EXSR ZASNMS                                    CLE005
     C                     ENDIF                                          CLE005
      *                                                                   125258
      *  For other loan types repayments allowed dependent on the ccy     125258
      *  of the loan and fclty. If equal then no fclty allowed otherwise  125258
      *  loan and fclty repayment necessary.                              125258
      *                                                                   125258
     C                     ELSE                                           125258
      *                                                                   125258
     C/COPY WNCPYSRC,LE2030C020
     C           W#CCY     IFEQ FCCYF                                     125258
     C           W@FCRA    IFNE SFCRA                                     125258
     C           SFCRA     ANDNE*BLANK                                    125258
     C                     MOVE '1'       *IN70                           125258
     C                     MOVEL'LEL0175' ZAMSID                          125258
     C                     EXSR ZASNMS                                    125258
     C                     ENDIF                                          125258
      *                                                                   125258
     C                     ELSE                                           125258
      *                                                                   125258
     C           W@RAMT    IFNE SRAMT                                     125258
     C           SRAMT     IFNE *BLANK                                    125258
     C           SFCRA     ANDEQ*BLANK                                    125258
     C           WSVRA     ORNE *ZEROS                                    125258
     C           WSVFA     ANDEQ*ZEROS                                    125258
     C                     MOVE '1'       *IN70                           125258
     C                     MOVEL'LEL0175' ZAMSID                          125258
     C                     EXSR ZASNMS                                    125258
     C                     ENDIF                                          125258
     C                     ENDIF                                          125258
      *                                                                   125258
     C           W@FCRA    IFNE SFCRA                                     125258
     C           SFCRA     IFNE *BLANK                                    125258
     C           SRAMT     ANDEQ*BLANK                                    125258
     C           WSVFA     ORNE *ZEROS                                    125258
     C           WSVRA     ANDEQ*ZEROS                                    125258
     C                     MOVE '1'       *IN70                           125258
     C                     MOVEL'LEL0175' ZAMSID                          125258
     C                     EXSR ZASNMS                                    125258
     C                     ENDIF                                          125258
      *                                                                   133865
      ** ... must be the equivalent of the loan currency repayment amount 133865
      ** in the facility currency allowing for the exchange rate tolerance133865
      *                                                                   133865
     C           WSVRA     MULT .75       WSVRAM 130                      133865
     C           WSVRA     MULT 1.25      WSVRAP 130                      133865
     C           ZAMTCO    IFLT WSVRAM                                    133865
     C           ZAMTCO    ORGT WSVRAP                                    133865
     C                     MOVE 'W'       WRMSV                                               227114
     C                     MOVE 'Y'       WWARN                                               227114
     C                     MOVE '1'       *IN70                           133865
     C                     MOVEL'LEL0503' ZAMSID                          133865
     C                     EXSR ZASNMS                                    133865
     C                     MOVE 'E'       WRMSV                                               227114
     C                     ENDIF                                          133865
     C                     ENDIF                                          125258
      *                                                                   133865
     C/COPY WNCPYSRC,LE2030C021
     C                     ENDIF                                          125258
     C                     ENDIF                                          CLE005
      *
     C                     ENDIF
      *
      ** VALIDATE REPAYMENT DATE
      *
     C                     Z-ADD*ZEROS    WSVRP
     C           SNRPD     IFNE *BLANKS
     C                     DO
      *                                                                                    AR1067935
      ** Must be blank for PDCL.                                                           AR1067935
      *                                                                                    AR1067935
     C           CLE134    IFEQ 'Y'                                                        AR1067935
     C                     MOVELSLTYP     LTYP1                                            AR1067935
     C           LTYP1     IFEQ 'X'                                                        AR1067935
     C           LTYP1     OREQ 'Y'                                                        AR1067935
     C           LTYP1     OREQ 'Z'                                                        AR1067935
     C                     MOVE '1'       *IN71                                            AR1067935
     C                     MOVEL'5045905' ZAMSID                                           AR1067935
     C                     EXSR ZASNMS                                                     AR1067935
     C                     ENDIF                                                           AR1067935
     C                     ENDIF                                                           AR1067935
      *                                                                                    AR1067935
      *
     C                     MOVELSNRPD     WNUM7
     C                     MOVELWNUM7     WALF6
     C                     MOVE SNRPD     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    WSVRP   50
     C                     Z-ADDZDAYNO    W@NRPD                          125557
     C           *IN99     IFEQ '1'
     C           SNRPD     ORNE WALF6
     C                     MOVE '1'       *IN71
     C                     MOVEL'LEL0157' ZAMSID
     C                     EXSR ZASNMS
     C                     LEAVE
     C                     ENDIF
      *
      ** ... must be greater than interest accrual control date
      *
     C                     MOVE '0'       WIN71   1
     C           SACTN     IFEQ 'I'
     C                     Z-ADDWSVVD     IACD
     C                     Z-ADD*ZERO     GDIN                            158264
     C                     Z-ADD*ZERO     GDPR                            158264
     C                     ENDIF
     C           WSVRP     IFLE IACD
      *                                                                   158264
      **  Consider the grace day period for the next repayment date.      158264
      *                                                                   158264
     C           IACD      SUB  WSVRP     WNUM2   20                      158264
     C           GDIN      IFGT GDPR                                      158264
     C                     Z-ADDGDPR      WNUM4   20                      158264
     C                     ELSE                                           158264
     C                     Z-ADDGDIN      WNUM4                           158264
     C                     ENDIF                                          158264
     C           SREPT     IFEQ '2'                                       158264
     C           WNUM2     IFGT GDPR                                      158264
     C           GDPR      ANDGT*ZERO                                     158264
     C           GDPR      OREQ *ZERO                                     158264
     C                     MOVE '1'       WIN71
     C                     ENDIF                                          158264
     C                     ELSE                                           158264
     C           WNUM2     IFGT WNUM4                                     158264
     C           WNUM4     ANDGT*ZERO                                     158264
     C           WNUM4     OREQ *ZERO                                     158264
     C                     MOVE '1'       WIN71                           158264
     C                     ENDIF                                          158264
     C                     ENDIF                                          158264
     C                     ENDIF
      *
      ** ... if new maturity date is entered, repayment date must be
      ** earlier than new maturity date, else, repayment date must be
      ** earlier than maturity date
      *
     C           WSVRP     IFGT IACD
     C           *IN44     ANDEQ'0'
     C           SMDAT     ANDNE*BLANKS
     C           NMDT      IFGT *ZEROS
     C           SACTN     ANDNE'I'
     C                     Z-ADDNMDT      W0MDT   50
     C                     ELSE
     C                     Z-ADDWSVMD     W0MDT
     C                     ENDIF
     C********** WSVRP     IFGE W0MDT                                                         241648
     C           WSVRP     IFGT W0MDT                                                         241648
     C                     MOVE '1'       WIN71
     C                     ENDIF
     C                     ENDIF
      *                                                                                     AR740107
      ** If Next repayment date is amended equal to Maturity date                           AR740107
      ** generate a warning message.                                                        AR740107
      *                                                                                     AR740107
     C           WSVRP     IFNE W@NRPD                                                      AR740107
     C           WSVRP     ANDEQW0MDT                                                       AR740107
     C           WERPD     IFEQ *BLANK                                                      AR740107
     C           WERPD     OREQ 'Y'                                                         AR740107
     C                     MOVE 'Y'       WERPD   1                                         AR740107
     C                     MOVE 'W'       WRMSV                                             AR740107
     C                     MOVE 'Y'       WWARN                                             AR740107
     C                     MOVE '1'       *IN71                                             AR740107
     C**********           MOVEL'LEL0813' ZAMSID                                  AR740107 AR1096933
     C                     MOVEL'5045918' ZAMSID                                           AR1096933
     C                     EXSR ZASNMS                                                      AR740107
     C                     MOVE 'E'       WRMSV                                             AR740107
     C                     ENDIF                                                            AR740107
     C                     ENDIF                                                            AR740107
      *
     C           WIN71     IFEQ '1'
     C                     MOVE '1'       *IN71
      *                                                                   159215
     C           SACTN     IFEQ 'I'                                       159215
     C                     MOVEL'LEL0158' ZAMSID
     C                     ELSE                                           159215
     C                     MOVEL'LEL0508' ZAMSID                          159215
     C                     ENDIF                                          159215
      *                                                                   159215
     C                     EXSR ZASNMS
     C                     LEAVE
     C                     ENDIF
      *                                                                                       220514
      ** If Rule of 78s is installed, loan processing type is '80'                            220514
      ** and Repayment Date Field is amendable,  the First Repayment Da                       220514
      ** te must fall within the following range:                                             220514
      ** Rep Freq   No. of Days from the Start Date                                           220514
      **    W            14                                                                   220514
      **    F            28                                                                   220514
      **    S            30                                                                   220514
      **    M            60                                                                   220514
      **    T           120                                                                   220514
      **    Q           180                                                                   220514
      **    X           360                                                                   220514
      **    Y           720                                                                   220514
      *                                                                                       220514
     C           CLE028    IFEQ 'Y'                                                           220514
     C           WLNPT     ANDEQ80                                                            220514
     C           SACTN     IFEQ 'I'                                                           220514
     C           SACTN     OREQ 'A'                                                           220514
     C           WPRCS2    ANDNE'Y'                                                           220514
     C           WSVRP     SUB  WSVVD     WDAYS   50                                          220514
     C           SRFRQ     IFEQ 'W'                                                           220514
     C           WDAYS     ANDGT14                                                            220514
     C           SRFRQ     OREQ 'F'                                                           220514
     C           WDAYS     ANDGT28                                                            220514
     C           SRFRQ     OREQ 'S'                                                           220514
     C           WDAYS     ANDGT30                                                            220514
     C           SRFRQ     OREQ 'M'                                                           220514
     C           WDAYS     ANDGT60                                                            220514
     C           SRFRQ     OREQ 'T'                                                           220514
     C           WDAYS     ANDGT120                                                           220514
     C           SRFRQ     OREQ 'Q'                                                           220514
     C           WDAYS     ANDGT180                                                           220514
     C           SRFRQ     OREQ 'X'                                                           220514
     C           WDAYS     ANDGT360                                                           220514
     C           SRFRQ     OREQ 'Y'                                                           220514
     C           WDAYS     ANDGT720                                                           220514
     C                     MOVE '1'       *IN71                                               220514
     C                     MOVEL'LEL0577' ZAMSID                                              220514
     C                     EXSR ZASNMS                                                        220514
     C                     LEAVE                                                              220514
     C                     ENDIF                                                              220514
     C                     ENDIF                                                              220514
     C                     ENDIF                                                              220514
      *                                                                                       220514
     C/COPY WNCPYSRC,LE2030C022
      *
      ** ... must be blank if repayment amount is zero
      ** ... must be entered if repayment amount is entered
      *
     C           *IN69     IFEQ '0'
     C/COPY WNCPYSRC,LEH00878
     C           WRAMT1    ANDNE'*'                                                           CLE028
     C***********SRAMT     IFEQ *BLANKS                                   157749
     C***********SNRPD     ANDNE*BLANKS                                   157749
     C***********SRAMT     ORNE *BLANKS                                   157749
     C***********SNRPD     ANDEQ*BLANKS                                   157749
     C                     MOVEASRAMT     AMTAB                           157749
     C                     MOVEANUMS      NUM                             157749
     C                     Z-ADD1         CNT     20                      157749
      *                                                                   157749
     C           CNT       DOWLE15                                        157749
     C           AMTAB,CNT LOKUPNUM                      69               157749
      *                                                                   157749
     C           *IN69     IFEQ *ON                                       157749
     C                     Z-ADD15        CNT                             157749
     C                     ENDIF                                          157749
      *                                                                   157749
     C                     ADD  1         CNT                             157749
     C                     ENDDO                                          157749
      *                                                                   157749
     C           *IN69     IFEQ *OFF                                      157749
     C                     MOVE '1'       *IN71
     C                     MOVEL'LEL0200' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     MOVE *OFF      *IN69                           157749
     C                     ENDIF
      *
     C/COPY WNCPYSRC,LE2030C023
     C                     ENDDO
      *                                                                   157749
     C                     ELSE                                           157749
     C/COPY WNCPYSRC,LE2030C024
      *                                                                   157749
     C           *IN69     IFEQ '0'                                       157749
     C           WRAMT1    ANDNE'*'                                                           CLE028
     C/COPY WNCPYSRC,LE2030C026
     C                     MOVEANUMS      NUM                             157749
     C                     MOVEASRAMT     AMTAB                           157749
     C                     Z-ADD1         CNT     20                      157749
      *                                                                   157749
     C           CNT       DOWLE15                                        157749
     C           AMTAB,CNT LOKUPNUM                      69               157749
      *                                                                   157749
     C           *IN69     IFEQ *ON                                       157749
     C                     Z-ADD15        CNT                             157749
     C                     ENDIF                                          157749
      *                                                                   157749
     C                     ADD  1         CNT                             157749
     C                     ENDDO                                          157749
      *                                                                   157749
     C           *IN69     IFEQ *ON                                       157749
     C/COPY WNCPYSRC,LE2030C027
     C                     MOVE '1'       *IN71                           157749
     C                     MOVEL'LEL0200' ZAMSID                          157749
     C                     EXSR ZASNMS                                    157749
     C                     MOVE *OFF      *IN69                           157749
     C                     ENDIF                                          157749
     C                     ENDIF                                          157749
     C/COPY WNCPYSRC,LE2030C025
      *                                                                   157749
     C                     ENDIF
      *
      ** VALIDATE REPAYMENT FREQUENCY/DAY NUMBER
      *
     C           CLE028    IFEQ 'N'                                                           CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           WLNPT     ANDNE80                                                            CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           WLNPT     ANDEQ80                                                            CLE028
     C           SACTN     ANDEQ'I'                                                           CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           WLNPT     ANDEQ80                                                            CLE028
     C           SACTN     ANDEQ'A'                                                           CLE028
     C           WPRCS2    ANDNE'Y'                                                           CLE028
     C           SRFRQ     IFNE *BLANK
     C           SNRPD     IFEQ *BLANKS
     C                     MOVE '1'       *IN72
     C                     MOVEL'LEL0201' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      *
     C           SRFRQ     LOKUPWFREQ                    89
     C           *IN89     IFEQ '0'
     C/COPY WNCPYSRC,LE2030C125
     C                     MOVE '1'       *IN72
     C                     MOVEL'LEL0055' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
     C                     ELSE
      *                                                                                       CLE028
      ** Repayment frequency mandatory for flat rate personal loans                           CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           WLNPT     ANDEQ80                                                            CLE028
     C           SACTN     IFEQ 'I'                                                           CLE028
     C           SACTN     OREQ 'A'                                                           CLE028
     C           WPRCS2    ANDNE'Y'                                                           CLE028
     C                     MOVE '1'       *IN72                                               CLE028
     C                     MOVEL'LEL0558' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           SRDYN     IFNE *BLANKS
     C                     MOVE '1'       *IN73
     C                     MOVEL'LEL0277' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** ... must be numeric from 1 to 31
      *
     C           *IN73     IFEQ '0'
     C           SRDYN     ANDNE*BLANKS
     C                     MOVELSRDYN     WNUM3
     C                     MOVELWNUM3     WALF2
     C           SRDYN     IFNE WALF2
     C           SRDYN     ORLT '01'
     C           SRDYN     ORGT '31'
     C                     MOVE '1'       *IN73
     C                     MOVEL'LEL0279' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** ... day number must be left blank for W or F (weekly/every
      ** two weeks)
      *
     C           *IN72     IFEQ '0'
     C           *IN73     ANDEQ'0'
     C           SRDYN     ANDNE*BLANKS
     C           SRFRQ     IFEQ 'W'
     C           SRFRQ     OREQ 'F'
     C/COPY WNCPYSRC,LE2030C126
     C                     MOVE '1'       *IN73
     C                     MOVEL'LEL0056' ZAMSID
     C                     EXSR ZASNMS
     C/COPY WNCPYSRC,LE2030C135
     C                     ENDIF
     C                     ENDIF
      *
      ** ... if repayment day number is blank, default to repay day
      *
     C           SRDYN     IFEQ *BLANKS
     C           SRFRQ     ANDNE*BLANK
     C           SRFRQ     ANDNE*BLANK
     C           SRFRQ     ANDNE'W'
     C           SRFRQ     ANDNE'F'
     C/COPY WNCPYSRC,LE2030C127
     C           *IN71     ANDEQ'0'
     C           *IN72     ANDEQ'0'
     C           *IN73     ANDEQ'0'
     C                     MOVE SNRPD     WDATE
     C           BJDFIN    IFEQ 'M'
     C                     MOVE WDAT2     SRDYN
     C                     ELSE
     C                     MOVE WDAT1     SRDYN
     C                     ENDIF
     C                     ENDIF
     C                     MOVE SRDYN     WRDYN
     C                     ENDIF                                                              CLE028
     C/COPY WNCPYSRC,LEH00602
      *                                                                                       CLE028
      ** For flat rate personal loans, if insert check that interest                          CLE028
      ** entered is within the calculated amount to be within                                 CLE028
      ** one unit of the currency specified.                                                  CLE028
      ** Do this if amount, maturity date, base rate, spread rate,                            CLE028
      ** interest basis, repayment frequency, repayment date,                                 CLE028
      ** repayment day in month, include charges in interest,                                 CLE028
      ** charge amount, currency, and location are valid                                      CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           WLNPT     ANDEQ80                                                            CLE028
     C           *IN39     ANDEQ'0'                                                           CLE028
     C           *IN44     ANDEQ'0'                                                           CLE028
     C           *IN47     ANDEQ'0'                                                           CLE028
     C           *IN49     ANDEQ'0'                                                           CLE028
     C           *IN54     ANDEQ'0'                                                           CLE028
     C           *IN55     ANDEQ'0'                                                           CLE028
     C           *IN69     ANDEQ'0'                                                           CLE028
     C           *IN72     ANDEQ'0'                                                           CLE028
     C           *IN71     ANDEQ'0'                                                           CLE028
     C           *IN73     ANDEQ'0'                                                           CLE028
     C           *IN38     ANDEQ'0'                                                           CLE028
     C           SACTN     IFEQ 'I'                                                           CLE028
     C           SACTN     OREQ 'A'                                                           CLE028
     C           WPRCS2    ANDNE'Y'                                                           CLE028
     C                     EXSR SRCIN8                                                        CLE028
     C                     ELSE                                                               CLE028
     C                     Z-ADDFLTI      WTOTI                                               CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           *IN39     IFEQ '0'                                                           CLE028
     C           *IN44     ANDEQ'0'                                                           CLE028
     C           *IN47     ANDEQ'0'                                                           CLE028
     C           *IN49     ANDEQ'0'                                                           CLE028
     C           *IN54     ANDEQ'0'                                                           CLE028
     C           *IN55     ANDEQ'0'                                                           CLE028
     C           *IN68     ANDEQ'0'                                                           CLE028
     C           *IN69     ANDEQ'0'                                                           CLE028
     C           *IN72     ANDEQ'0'                                                           CLE028
     C           *IN71     ANDEQ'0'                                                           CLE028
     C           *IN73     ANDEQ'0'                                                           CLE028
     C           *IN38     ANDEQ'0'                                                           CLE028
     C           WLNPT     ANDNE63                                                            CLE028
     C           WLNPT     ANDNE65                                                            CLE028
     C           WLNPT     ANDNE67                                                            CLE028
     C           WPRCS2    IFNE 'Y'                                                           CLE028
     C           PMODE     ANDNE'B'                                                           260514
     C                     EXSR SRCRPA                                                        CLE028
     C                     Z-ADDWSVRP     WFRPD   50                                          CLE028
     C                     ELSE                                                               CLE028
     C                     Z-ADDFRPD      WFRPD                                               CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *
      ** VALIDATE BILL/TELEX INDICATOR (for loans and parts purch)
      *
     C           *IN22     IFEQ '0'
     C           SBTIN     IFEQ *BLANK
     C                     MOVE BPBTIN    SBTIN
     C                     ENDIF
     C           SBTIN     IFNE 'B'
     C           SBTIN     ANDNE'T'
     C           SBTIN     ANDNE'N'
     C                     MOVE '1'       *IN74
     C                     MOVEL'LEL0169' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE BILLING DAYS (for loans and parts purchased)
      *
     C           *IN22     IFEQ '0'
     C/COPY WNCPYSRC,LE2030C137
     C           SBLDY     IFEQ *BLANKS
     C           *IN74     ANDEQ'0'
     C           SBTIN     IFEQ 'N'
     C                     MOVE '00'      SBLDY
     C                     ELSE
     C                     MOVE BPDBDY    SBLDY
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2030C089
      *
      ** ... must be 0 if bill/telex indicator is 'N'
      ** ... must be from 1 to 28 if bill/telex indicator is 'B'
      ** ... must be from 1 to 9 if bill/telex indicator is 'T'
      *
     C           SBTIN     IFEQ 'N'
     C           SBLDY     ANDNE'00'
      *
     C           SBTIN     OREQ 'B'
     C           SBLDY     ANDGT'28'
     C           SBTIN     OREQ 'B'
     C           SBLDY     ANDLT'01'
      *
     C           SBTIN     OREQ 'T'
     C           SBLDY     ANDGT'09'
     C           SBTIN     OREQ 'T'
     C           SBLDY     ANDLT'01'
     C/COPY WNCPYSRC,LE2030C138
      *
     C                     MOVE '1'       *IN75
     C                     MOVEL'LEL0170' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE CLE005 FIELDS, PAYMENT TAKEN/DUE DAY AND GRACE DAYS
      ** FOR INTEREST/REPAYMENT
      *
     C           CLE005    IFEQ 'Y'
     C                     EXSR SRCL05
     C                     ENDIF
      *
     C                     ENDSR
     C/COPY WNCPYSRC,LEH00879
      /EJECT
      *****************************************************************
      * SRCINT  -  Calculate interest amount between value date       *
      *            and maturity date                                  *
      * Called by: SRVAL1 - Validate first detail screen              *
      * Calls    : None                                               *
      *****************************************************************
     C           SRCINT    BEGSR
      *
     C                     Z-ADDWSVVD     ZIBEG
     C           SACTN     IFEQ 'A'
     C           WLNPT     ANDEQ63
     C                     Z-ADDSLID      ZIBEG
     C                     ENDIF
     C                     MOVE SCALC     ZICALC
     C                     Z-ADDWSVMD     ZIEND
     C           ZIEND     IFEQ *ZEROS
     C           WSVVD     ADD  1         ZIEND
     C                     ENDIF
      *
      ** Accrual on first/last day indicator for loans
      *
     C           *IN21     IFEQ '0'
     C           *IN22     ANDEQ'0'
     C           SADDI     IFEQ 'B'
     C           SACTN     IFEQ 'A'
     C           WLNPT     ANDEQ63
     C           IACD      IFEQ WSVVD
     C           ZIEND     ADD  1         ZIEND
     C                     ENDIF
     C                     ELSE
     C           ZIEND     ADD  1         ZIEND
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** If CLE031 is on, facility currency is not equal to SCURR and                         CLE031
      ** principal amount is not inputted (WSVAM = 0), use facility                           CLE031
      ** currency principal amount instead of WSVAM.                                          CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           SFCCY     ANDNESCURR                                                         CLE031
     C           WSVAM     ANDEQ*ZERO                                                         CLE031
     C                     Z-ADDWFCPAM    ZIAMT                                               CLE031
     C                     ELSE                                                               CLE031
     C                     Z-ADDWSVAM     ZIAMT
     C                     ENDIF                                                              CLE031
     C                     Z-ADDWINTT     ZIRATE
     C/COPY WNCPYSRC,LE2030C017
     C                     EXSR GLINTC
     C/COPY WNCPYSRC,LE2030C018
      *
      ** Round down interest if requested on amend of a discounted loan
      *
     C           SACTN     IFEQ 'A'
     C           WLNPT     ANDEQ63
     C           SRDFC     IFEQ 'N'
     C                     Z-ADDZINTR     WTOTI     H
     C                     ELSE
     C                     Z-ADDZINTR     WTOTI
     C                     ENDIF
     C                     ENDIF
      *
      ** For insert Only
      *
     C           SACTN     IFEQ 'I'
      *
      ** Round down interest if requested
      *
     C                     MOVE *BLANK    WSUB    1
     C           SRDFC     IFEQ 'N'
     C                     Z-ADDZINTR     WCHKI  130H
     C                     ELSE
     C                     Z-ADDZINTR     WCHKI
     C                     ENDIF
     C           WCHKI     IFLT *ZEROS
     C                     Z-SUBWCHKI     WCHKI
     C                     MOVE 'Y'       WSUB
     C                     ENDIF
      *
      ** For batch mode, interest is the calculated interest
      ** and no need to validate
      *
     C           PMODE     IFEQ 'B'
     C/COPY WNCPYSRC,LE2030C006
     C                     Z-ADDWCHKI     WTOTI
     C                     ELSE
      *
     C           WTOTI     SUB  WCHKI     WCHK2  130
     C           WCHK2     IFLT *ZEROS
     C                     Z-SUBWCHK2     WCHK2
     C                     ENDIF
      *
      ** Check that the calculated amount should be within one unit
      ** of the currency specified
      ** If entry is invalid, display the calculated discount or
      ** interest
      *
      ** If '*' is entered in the interest/discount amount field default the                  CLE028
      ** calculated interest to SIPRD                                                         CLE028
      *                                                                                       CLE028
     C           WIPRD1    IFEQ '*'                                                           CLE028
     C                     Z-ADDZINTR     WTOTI                                               CLE028
     C                     MOVE *BLANKS   ZFLD15                                              CLE028
     C                     MOVE WCHKI     ZFLD15                                              CLE028
     C                     MOVE 'L'       ZECODE                                              CLE028
     C                     Z-ADDWCDPL     ZDECS                                               CLE028
     C                     EXSR ZFRPED                                                        CLE028
     C           ZNEG      IFEQ '-'                                                           CLE028
     C                     MOVE ZOUT21    SIPRD                                               CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE ZOUT20    SIPRD                                               CLE028
     C                     ENDIF                                                              CLE028
     C                     MOVE 'Y'       WWARN                                               CLE028
      *                                                                                       CLE028
     C                     ELSE                                                               CLE028
      *                                                                                       CLE028
     C           WCHK2     IFGT 1
     C           WDINT     ANDNE'N'                                                           CLE031
     C***********          MOVEL'LEL0146' ZAMSID                          123859
     C***********          EXSR ZASNMS                                    123859
     C           WLNPT     IFEQ 63
     C           WLNPT     OREQ 65
     C           WLNPT     OREQ 67
     C           WLNPT     OREQ 72                                        CLE005
     C           W72TP     ANDEQ'67'                                      CLE005
     C                     MOVEL'LEL0003' ZAMSID
     C                     ELSE
     C                     MOVEL'LEL0004' ZAMSID
     C                     ENDIF
     C                     MOVE *BLANKS   ZFLD15
      *                                                                                     AR847588
      ** Display calculated interest as negative if it is negative.                         AR847588
      *                                                                                     AR847588
     C           WSUB      IFEQ 'Y'                                                         AR847588
     C                     Z-SUBWCHKI     WCHKI                                             AR847588
     C                     ENDIF                                                            AR847588
     C                     MOVE *BLANKS   ZAMSDA                                            AR847588
      *                                                                                     AR847588
     C                     MOVE WCHKI     ZFLD15
      *                                                                                       CLE031
      ** If CLE031 is on, facility currency is not equal to SCURR and                         CLE031
      ** principal amount is not inputted (WSVAM = 0), use facility                           CLE031
      ** currency number of places instead of WCDPL.                                          CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           SFCCY     ANDNESCURR                                                         CLE031
     C           WSVAM     ANDEQ*ZERO                                                         CLE031
     C                     Z-ADDWFCNBP    ZDECS                                               CLE031
     C                     ELSE                                                               CLE031
     C                     Z-ADDWCDPL     ZDECS
     C                     ENDIF                                                              CLE031
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZFRPED
     C           ZNEG      IFEQ '-'
     C                     MOVELZOUT21    ZAMSDA
     C                     ELSE
     C                     MOVELZOUT20    ZAMSDA
     C                     ENDIF
     C                     MOVE '1'       *IN55
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                                     AR847588
      ** If calculated sign is negative and interest sign is not equal                      AR847588
      ** to '-', show the correct interest.                                                 AR847588
      *                                                                                     AR847588
     C           WSUB      IFEQ 'Y'                                                         AR847588
     C           INSGN     ANDNE'-'                                                         AR847588
      *                                                                                     AR847588
      ** If the calculated interest is positive and the interest sign                       AR847588
      ** is '-', show the correct interest.                                                 AR847588
      *                                                                                     AR847588
     C           WSUB      ORNE 'Y'                                                         AR847588
     C           WCHKI     ANDNE*ZERO                                                       AR847588
     C           INSGN     ANDNE'+'                                                         AR847588
     C           INSGN     ANDNE*BLANKS                                                     AR847588
     C                     MOVE '1'       *IN40                                             AR847588
      *                                                                                     AR847588
      ** Show the calculated interest only if there is no error on                          AR847588
      ** interest validation to prevent it from showing the message                         AR847588
      ** twice.                                                                             AR847588
      *                                                                                     AR847588
     C           *IN55     IFEQ '0'                                                         AR847588
     C           WLNPT     IFEQ 63                                                          AR847588
     C           WLNPT     OREQ 65                                                          AR847588
     C           WLNPT     OREQ 67                                                          AR847588
     C           WLNPT     OREQ 72                                                          AR847588
     C           W72TP     ANDEQ'67'                                                        AR847588
     C                     MOVEL'LEL0003' ZAMSID                                            AR847588
     C                     ELSE                                                             AR847588
     C                     MOVEL'LEL0004' ZAMSID                                            AR847588
     C                     ENDIF                                                            AR847588
     C                     MOVE *BLANKS   ZFLD15                                            AR847588
      *                                                                                     AR847588
     C           WSUB      IFEQ 'Y'                                                         AR847588
     C                     Z-SUBWCHKI     WCHKI                                             AR847588
     C                     ENDIF                                                            AR847588
      *                                                                                     AR847588
     C                     MOVE WCHKI     ZFLD15                                            AR847588
     C                     Z-ADDWCDPL     ZDECS                                             AR847588
     C                     MOVE 'L'       ZECODE                                            AR847588
     C                     EXSR ZFRPED                                                      AR847588
     C           ZNEG      IFEQ '-'                                                         AR847588
     C                     MOVELZOUT21    ZAMSDA                                            AR847588
     C                     ELSE                                                             AR847588
     C                     MOVELZOUT20    ZAMSDA                                            AR847588
     C                     ENDIF                                                            AR847588
     C                     MOVE '1'       *IN40                                             AR847588
     C                     EXSR ZASNMS                                                      AR847588
     C                     ENDIF                                                            AR847588
     C                     ENDIF                                                            AR847588
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
      *
     C           *IN55     IFEQ '0'
     C           WSUB      ANDEQ'Y'
     C                     Z-SUBWTOTI     WTOTI
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT                                                                                  CLE028
      *****************************************************************                       CLE028
      * SRCIN8  -  Calculate interest amount for Flat Rate Personal   *                       CLE028
      *            Loans                                              *                       CLE028
      * Called by: SRVAL2 - Validate second detail screen             *                       CLE028
      * Calls    : INRP78 - Calculate total flat interest & principal *                       CLE028
      *                     repayment based on Rule of 78             *                       CLE028
      *****************************************************************                       CLE028
     C           SRCIN8    BEGSR                                                              CLE028
      *                                                                                       CLE028
     C                     Z-ADDWSVVD     ZIBEG                                               CLE028
     C                     MOVE SCALC     ZICALC                                              CLE028
     C                     Z-ADDWSVMD     ZIEND                                               CLE028
      *                                                                                       CLE028
      ** For flat rate personal loans use INRP78 subroutine                                   CLE028
      ** to compute the interest rate                                                         CLE028
      *                                                                                       CLE028
     C                     Z-ADDZIEND     W78MDT                                              CLE028
     C                     Z-ADDWSVAM     W78PRN                                              CLE028
     C                     Z-ADDWINTT     W78IRT                                              CLE028
     C                     MOVE SRFRQ     W78RPF                                              CLE028
     C                     Z-ADDWSVRP     W78RPD                                              CLE028
     C                     MOVE SRDYN     W78RPM                                              CLE028
     C                     MOVE SICIF     W78ICI                                              CLE028
     C                     Z-ADDWCHGA     W78CGA                                              CLE028
     C                     MOVE W#CCY     W78CCY                                              CLE028
     C                     MOVE *BLANKS   W78LCN                                              CLE028
     C                     EXSR INRP78                                                        CLE028
     C                     Z-ADDW78INT    ZINTR                                               CLE028
     C                     Z-ADDW78RPY    WRPYA  130H                                         CLE028
      *                                                                                       CLE028
      ** Recompute flat rate interest when amending flat rate personal loans                  CLE028
      *                                                                                       CLE028
     C********** SACTN     IFEQ 'A'                                                    CLE028 219695
     C********** SRDFC     IFEQ 'N'                                                    CLE028 219695
     C**********           Z-ADDZINTR     WTOTI     H                                  CLE028 219695
     C**********           ELSE                                                        CLE028 219695
     C**********           Z-ADDZINTR     WTOTI                                        CLE028 219695
     C**********           ENDIF                                                       CLE028 219695
     C**********           ENDIF                                                       CLE028 219695
      *                                                                                       CLE028
      ** Validate interest for insert only                                                    CLE028
      *                                                                                       CLE028
     C           SACTN     IFEQ 'I'                                                           CLE028
     C           SACTN     OREQ 'A'                                                           219695
     C           WPRCS2    ANDNE'Y'                                                           219695
      *                                                                                       CLE028
     C                     MOVE *BLANK    WSUB    1                                           CLE028
     C                     Z-ADDZINTR     WCHKI  130H                                         CLE028
     C           WCHKI     IFLT *ZEROS                                                        CLE028
     C                     Z-SUBWCHKI     WCHKI                                               CLE028
     C                     MOVE 'Y'       WSUB                                                CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** For batch mode, interest is the calculated interest                                  CLE028
      ** and no need to validate                                                              CLE028
      *                                                                                       CLE028
     C           PMODE     IFEQ 'B'                                                           CLE028
     C                     Z-ADDWCHKI     WTOTI                                               CLE028
     C                     ELSE                                                               CLE028
      *                                                                                       CLE028
     C           WTOTI     SUB  WCHKI     WCHK2  130                                          CLE028
     C           WCHK2     IFLT *ZEROS                                                        CLE028
     C                     Z-SUBWCHK2     WCHK2                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** Check that the calculated amount should be within one unit                           CLE028
      ** of the currency specified                                                            CLE028
      ** If entry is invalid, display the calculated discount or                              CLE028
      ** interest                                                                             CLE028
      *                                                                                       CLE028
      ** If '*' is entered in the interest/discount amount field default the                  CLE028
      ** calculated interest to SIPRD                                                         CLE028
      *                                                                                       CLE028
     C           WIPRD1    IFEQ '*'                                                           CLE028
     C                     Z-ADDZINTR     WTOTI  130H                                         CLE028
     C                     MOVE *BLANKS   ZFLD15                                              CLE028
     C                     MOVE WTOTI     ZFLD15                                              CLE028
     C                     MOVE 'L'       ZECODE                                              CLE028
     C                     Z-ADDWCDPL     ZDECS                                               CLE028
     C                     EXSR ZFRPED                                                        CLE028
     C           ZNEG      IFEQ '-'                                                           CLE028
     C                     MOVE ZOUT21    SIPRD                                               CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE ZOUT20    SIPRD                                               CLE028
     C                     ENDIF                                                              CLE028
     C                     MOVE 'Y'       WWARN                                               CLE028
      *                                                                                       CLE028
     C                     ELSE                                                               CLE028
      *                                                                                       CLE028
     C           WCHK2     IFGT 1                                                             CLE028
     C                     MOVEL'LEL0004' ZAMSID                                              CLE028
     C                     MOVE *BLANKS   ZFLD15                                              CLE028
     C                     MOVE WCHKI     ZFLD15                                              CLE028
     C                     Z-ADDWCDPL     ZDECS                                               CLE028
     C                     MOVE 'L'       ZECODE                                              CLE028
     C                     EXSR ZFRPED                                                        CLE028
     C           ZNEG      IFEQ '-'                                                           CLE028
     C                     MOVELZOUT21    ZAMSDA                                              CLE028
     C                     ELSE                                                               CLE028
     C                     MOVELZOUT20    ZAMSDA                                              CLE028
     C                     ENDIF                                                              CLE028
     C                     MOVE '1'       *IN55                                               CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           *IN55     IFEQ '0'                                                           CLE028
     C           WSUB      ANDEQ'Y'                                                           CLE028
     C                     Z-SUBWTOTI     WTOTI                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ENDSR                                                              CLE028
      *****************************************************************                       CLE028
      /EJECT                                                                                  CLE028
      *****************************************************************                       CLE028
      * INRP78  -  Calculate total flat interest & principal          *                       CLE028
      *            repayment based on Rule of 78                      *                       CLE028
      * Called by: SRCIN8 - Calculate interest amount for flat rate   *                       CLE028
      *            personal loans                                     *                       CLE028
      * Calls    : None                                               *                       CLE028
      *****************************************************************                       CLE028
      *                                                                                       CLE028
     C           INRP78    BEGSR                                                              CLE028
      *                                                                                       CLE028
      ** Define input and output fields                                                       CLE028
      *                                                                                       CLE028
     C                     Z-ADDW78MDT    W78MDT  50                                          CLE028
     C                     Z-ADDW78PRN    W78PRN 150                                          CLE028
     C                     Z-ADDW78IRT    W78IRT 117                                          CLE028
     C                     MOVE W78RPF    W78RPF  1                                           CLE028
     C                     Z-ADDW78RPD    W78RPD  50                                          CLE028
     C                     Z-ADDW78RPM    W78RPM  20                                          CLE028
     C                     MOVE W78ICI    W78ICI  1                                           CLE028
     C                     Z-ADDW78CGA    W78CGA 150                                          CLE028
     C                     MOVE W78CCY    W78CCY  3                                           CLE028
     C                     MOVE W78LCN    W78LCN  3                                           CLE028
     C                     Z-ADDW78INT    W78INT 309                                          CLE028
     C                     Z-ADDW78RPY    W78RPY 309                                          CLE028
     C**********           Z-ADDW78NPY    W78NPY  50                                 CLE028 BUG21845
     C**********           Z-ADDW78NPY    W78NPY 156                              BUG21845 BUG21845A
     C                     Z-ADDW78NPY    W78NPY 309                                       BUG21845A
     C                     Z-ADDW78PYR    W78PYR  30                                          CLE028
      *                                                                                       CLE028
      ** Compute for the total number of payments during the life of                          CLE028
      ** the loan, depending on the repayment frequency                                       CLE028
      *                                                                                       CLE028
     C                     Z-ADD1         W78NPY                                              CLE028
     C                     Z-ADDW78RPD    ZDAYNO                                              CLE028
     C                     MOVE W78RPF    ZFREQ                                               CLE028
     C                     Z-ADDW78RPM    ZMDAY                                               CLE028
     C                     MOVE W78CCY    ZCCY                                                CLE028
     C                     MOVE W78LCN    ZLOC                                                CLE028
     C                     EXSR ZFREQB                                                        CLE028
     C           ZDAYNO    DOWLTW78MDT                                                        CLE028
     C           ZDAYNO    ANDGEW78RPD                                                      AR830785
     C                     ADD  1         W78NPY                                              CLE028
     C                     EXSR ZFREQB                                                        CLE028
     C                     ENDDO                                                              CLE028
      *                                                                                       CLE028
      ** Add 1 to total number of payments to include repayment on                            CLE028
      ** maturity date                                                                        CLE028
      *                                                                                       CLE028
     C                     ADD  1         W78NPY                                              CLE028
      *                                                                                     BUG21845
      ** Disregard previous calculation for W78NPY to include decimals                      BUG21845
      *                                                                                     BUG21845
     C                     Z-ADD0         W78NPY                                            BUG21845
     C           W78MDT    SUB  WSVVD     WDAYT   50                                        BUG21845
      *                                                                                       CLE028
      ** Compute for the number of payments per year                                          CLE028
      *                                                                                       CLE028
     C                     SELEC                                                              CLE028
     C           W78RPF    WHEQ 'W'                                                           CLE028
     C                     Z-ADD52        W78PYR                                              CLE028
     C**********           Z-ADD7         WDAY    30                              BUG21845 BUG21845A
     C           W78RPF    WHEQ 'F'                                                           CLE028
     C                     Z-ADD26        W78PYR                                              CLE028
     C**********           Z-ADD14        WDAY                                    BUG21845 BUG21845A
     C           W78RPF    WHEQ 'M'                                                           CLE028
     C                     Z-ADD12        W78PYR                                              CLE028
     C**********           Z-ADD30        WDAY                                    BUG21845 BUG21845A
     C           W78RPF    WHEQ 'T'                                                           CLE028
     C                     Z-ADD6         W78PYR                                              CLE028
     C**********           Z-ADD60        WDAY                                    BUG21845 BUG21845A
     C           W78RPF    WHEQ 'Q'                                                           CLE028
     C                     Z-ADD4         W78PYR                                              CLE028
     C**********           Z-ADD90        WDAY                                    BUG21845 BUG21845A
     C           W78RPF    WHEQ 'X'                                                           CLE028
     C                     Z-ADD2         W78PYR                                              CLE028
     C**********           Z-ADD180       WDAY                                    BUG21845 BUG21845A
     C           W78RPF    WHEQ 'Y'                                                           CLE028
     C                     Z-ADD1         W78PYR                                              CLE028
     C**********           Z-ADD360       WDAY                                    BUG21845 BUG21845A
     C           W78RPF    WHEQ 'S'                                                           217847
     C                     Z-ADD24        W78PYR                                              217847
     C**********           Z-ADD15        WDAY                                    BUG21845 BUG21845A
     C                     ENDSL                                                              CLE028
      *                                                                                     BUG21845
     C           360       DIV  W78PYR    WDAY    96                                       BUG21845A
     C           WDAYT     DIV  WDAY      W78NPY                                            BUG21845
      *                                                                                       CLE028
      ** Compute for the interest                                                             CLE028
      *                                                                                       CLE028
     C           W78ICI    IFEQ 'Y'                                                           CLE028
     C                     ADD  W78CGA    W78PRN                                              CLE028
     C                     ENDIF                                                              CLE028
     C           W78NPY    DIV  W78PYR    W78INT                                              CLE028
      *                                                                                       222972
      ** Compute for Total intest using Net Treasury Rate                                     222972
      *                                                                                       222972
     C           CAS005    IFEQ 'Y'                                                           222972
      *                                                                                       222972
     C                     Z-ADDW78INT    W78IN2 309                                          222972
      *                                                                                       222972
     C           W78IRT    SUB  MARG      WMARG   75                                          222972
     C                     MULT WMARG     W78INT                                              222972
     C                     DIV  100       W78INT                                              222972
     C                     MULT W78PRN    W78INT    H                                         222972
     C                     Z-ADDW78INT    TOTN                                                222972
      *                                                                                       222972
     C                     Z-ADDW78IN2    W78INT                                              222972
      *                                                                                       222972
     C                     ENDIF                                                              222972
      *                                                                                       222972
     C                     MULT W78IRT    W78INT                                              CLE028
     C                     DIV  100       W78INT                                              CLE028
     C                     MULT W78PRN    W78INT    H                                         CLE028
      *                                                                                       CLE028
      ** Compute for the loan amount                                                          CLE028
      *                                                                                       CLE028
     C           SREPT     IFEQ '3'                                                           CLE028
     C           SREPT     OREQ '1'                                                           CLE028
     C           SADIF     ANDEQ'Y'                                                           CLE028
     C           W78PRN    ADD  W78INT    WLNAMT 309                                          CLE028
     C                     ELSE                                                               CLE028
     C                     Z-ADDW78PRN    WLNAMT                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           W78ICI    IFNE 'Y'                                                           CLE028
     C                     ADD  W78CGA    WLNAMT                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** Compute for the principal repayment                                                  CLE028
      *                                                                                       CLE028
     C           WLNAMT    DIV  W78NPY    W78RPY    H                                         CLE028
      *                                                                                       CLE028
     C                     ENDSR                                                              CLE028
      *****************************************************************                       CLE028
      /EJECT                                                                                  CLE028
      *****************************************************************                       CLE028
      * SRCRPA  -  Calculate repayment amount                         *                       CLE028
      * Called by: SRVAL2 - Validate second detail screen             *                       CLE028
      * Calls    : None                                               *                       CLE028
      *****************************************************************                       CLE028
      *                                                                                       CLE028
     C           SRCRPA    BEGSR                                                              CLE028
      *                                                                                       CLE028
      ** For flat rate personal loan use previously calculated repayment                      CLE028
      ** amount                                                                               CLE028
      *                                                                                       CLE028
     C                     Z-ADD*ZEROS    WCRPYA 130                                          CLE028
     C           WLNPT     IFEQ 80                                                            CLE028
     C                     Z-ADDWRPYA     WCRPYA                                              CLE028
      *                                                                                       CLE028
     C                     ELSE                                                               CLE028
      *                                                                                       CLE028
      ** Compute for the total number of payments during the life of                          CLE028
      ** the loan, depending on the repayment frequency                                       CLE028
      ** do not compute if repayment frequency not available                                  CLE028
      *                                                                                       CLE028
     C           WSVRP     IFNE *ZEROS                                                        CLE028
     C           SRFRQ     ANDNE*BLANKS                                                       CLE028
     C           WSVMD     ANDNE0                                                             CLE028
     C                     Z-ADD1         WTNPY   50                                          CLE028
     C                     Z-ADDWSVRP     ZDAYNO                                              CLE028
     C                     MOVE SRFRQ     ZFREQ                                               CLE028
     C                     MOVE SRDYN     ZMDAY                                               CLE028
     C                     MOVE W#CCY     ZCCY                                                CLE028
     C                     MOVE *BLANKS   ZLOC                                                CLE028
     C                     EXSR ZFREQB                                                        CLE028
     C           ZDAYNO    DOWLTWSVMD                                                         CLE028
     C           ZDAYNO    ANDGEWSVRP                                                       AR830785
     C                     ADD  1         WTNPY                                               CLE028
     C                     EXSR ZFREQB                                                        CLE028
     C                     ENDDO                                                              CLE028
      *                                                                                       CLE028
      ** Add 1 to total number of payments to include repayment on                            CLE028
      ** maturity date                                                                        CLE028
      *                                                                                       CLE028
     C                     ADD  1         WTNPY                                               CLE028
      *                                                                                       CLE028
      ** Compute for the principal repayment                                                  CLE028
      *                                                                                       CLE028
     C           SREPT     IFEQ '1'                                                           CLE028
     C           SREPT     OREQ '2'                                                           CLE028
     C           WSVAM     DIV  WTNPY     W78RPY    H                                         CLE028
     C                     ELSE                                                               CLE028
      *                                                                                       CLE028
     C           SREPT     IFEQ '3'                                                           CLE028
     C           WSVAM     ADD  WTOTI     W78RPY                                              CLE028
     C           W78RPY    DIV  WTNPY     W78RPY    H                                         CLE028
     C                     MOVELREPAY3    WREP3A 68                                           217847
     C                     MOVE SRFRQ     WREP3A                                              217847
     C           WREP3A    IFNE WREPY3                                                        217847
     C                     EXSR SRREP3                                                        CLE028
     C                     ELSE                                                               217847
     C                     Z-ADDWREPYA    W78RPY    H                                         217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     Z-ADDW78RPY    WCRPYA                                              CLE028
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** If '*' is entered in the repayment amount field default                              CLE028
      ** the repayment amount computed to the screen. Else,                                   CLE028
      ** check that the calculated amount should be within one unit                           CLE028
      ** of the currency specified                                                            CLE028
      ** If entry is invalid, display the calculated loan currency                            CLE028
      ** repayment amount in the error message                                                CLE028
      *                                                                                       CLE028
     C           WCRPYA    IFNE 0                                                             CLE028
      *                                                                                       CLE028
     C           WRAMT1    IFEQ '*'                                                           CLE028
      *                                                                                       CLE028
     C                     MOVE *BLANKS   ZFLD15                                              CLE028
     C                     MOVE WCRPYA    ZFLD15                                              CLE028
     C                     MOVE 'L'       ZECODE                                              CLE028
     C                     Z-ADDWCDPL     ZDECS                                               CLE028
     C                     EXSR ZFRPED                                                        CLE028
     C           ZNEG      IFEQ '-'                                                           CLE028
     C                     MOVE ZOUT21    SRAMT                                               CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE ZOUT20    SRAMT                                               CLE028
     C                     ENDIF                                                              CLE028
     C                     MOVELSRAMT     WSRAMT 15                                           217847
     C                     Z-ADDWCRPYA    WSVRA                                               CLE028
     C                     MOVE 'Y'       WWARN                                               CLE028
      *                                                                                       CLE028
     C                     ELSE                                                               CLE028
      *                                                                                       CLE028
     C           WSVRA     SUB  WCRPYA    WCHK3  130                                          CLE028
     C           WCHK3     IFLE *ZEROS                                                        CLE028
     C                     Z-SUBWCHK3     WCHK3                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           WCHK3     IFGT 1                                                             CLE028
      *                                                                                       CLE028
     C           WERPA     IFEQ *BLANK                                                        CLE028
     C           WERPA     OREQ 'Y'                                                           CLE028
     C           WSVRA     ANDNEPWSVRA                                                        CLE028
     C                     Z-ADDWSVRA     PWSVRA 130                                          CLE028
     C                     MOVE 'Y'       WERPA   1                                           CLE028
     C                     MOVE 'W'       WRMSV                                               CLE028
     C                     MOVE 'Y'       WWARN                                               CLE028
     C                     MOVE '1'       *IN69                                               CLE028
     C                     MOVEL'LEL0559' ZAMSID                                              CLE028
     C                     MOVE *BLANKS   ZFLD15                                              CLE028
     C                     MOVE WCRPYA    ZFLD15                                              CLE028
     C                     MOVE 'L'       ZECODE                                              CLE028
     C                     Z-ADDWCDPL     ZDECS                                               CLE028
     C                     EXSR ZFRPED                                                        CLE028
     C           ZNEG      IFEQ '-'                                                           CLE028
     C                     MOVELZOUT21    ZAMSDA                                              CLE028
     C                     ELSE                                                               CLE028
     C                     MOVELZOUT20    ZAMSDA                                              CLE028
     C                     ENDIF                                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ELSE                                                               CLE028
      *                                                                                       CLE028
     C           WRAMT1    IFEQ '*'                                                           CLE028
     C                     MOVE '1'       *IN69                                               CLE028
     C                     MOVEL'LEL0560' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ENDSR                                                              CLE028
      /EJECT                                                                                  CLE028
      *****************************************************************                       CLE028
      * SRREP3  -  CALCULATE REPAYMENT AMOUNT FOR REPAYMENT TYPE 3    *                       CLE028
      *            FOR NON-FLAT RATE PERSONAL LOANS.                  *                       CLE028
      * CALLED BY: SRVAL2 - VALIDATE SECOND DETAIL SCREEN             *                       CLE028
      * CALLS    : NONE                                               *                       CLE028
      *****************************************************************                       CLE028
      *                                                                                       CLE028
     C           SRREP3    BEGSR                                                              CLE028
      *                                                                                       CLE028
     C                     Z-ADD*ZEROS    WDUMMY  90                                          217847
     C                     Z-ADD*ZEROS    WODIFF 309                                          217847
     C                     Z-ADDWSVAM     HCPAM  180                                          217847
     C                     Z-ADD*ZEROS    WTOTIN 309                                          217847
     C                     MOVE 'N'       ADDI1   1                                           217847
     C                     MOVE 'N'       SUBI1   1                                           217847
     C                     MOVE 'N'       ADDI5   1                                           217847
     C                     MOVE 'N'       SUBI5   1                                           217847
     C                     MOVE 'N'       ADDI10  1                                           217847
     C                     MOVE 'N'       SUBI10  1                                           217847
     C                     MOVE 'N'       ADD100  1                                           217847
     C                     MOVE 'N'       SUB100  1                                           217847
     C                     MOVE 'N'       ADD1K   1                                           217847
     C                     MOVE 'N'       SUB1K   1                                           217847
     C                     MOVE 'N'       ADD10K  1                                           217847
     C                     MOVE 'N'       SUB10K  1                                           217847
     C                     MOVE 'N'       AD100K  1                                           217847
     C                     MOVE 'N'       SU100K  1                                           217847
     C                     MOVE 'N'       USE10K  1                                           217847
     C                     MOVE 'N'       USE1K   1                                           217847
     C                     MOVE 'N'       USE100  1                                           217847
     C                     MOVE 'N'       USE10   1                                           217847
     C                     MOVE 'N'       USE5    1                                           217847
     C                     MOVE 'N'       USE1    1                                           217847
      *                                                                                       217847
     C                     SELEC                                                              217847
     C           SRFRQ     WHEQ 'W'                                                           217847
     C           WINTT     DIV  5200      MI     159                                          217847
     C           SRFRQ     WHEQ 'F'                                                           217847
     C           WINTT     DIV  2600      MI                                                  217847
     C           SRFRQ     WHEQ 'M'                                                           217847
     C           WINTT     DIV  1200      MI                                                  217847
     C           SRFRQ     WHEQ 'T'                                                           217847
     C           WINTT     DIV  600       MI                                                  217847
     C           SRFRQ     WHEQ 'Q'                                                           217847
     C           WINTT     DIV  400       MI                                                  217847
     C           SRFRQ     WHEQ 'X'                                                           217847
     C           WINTT     DIV  200       MI                                                  217847
     C           SRFRQ     WHEQ 'Y'                                                           217847
     C           WINTT     DIV  100       MI                                                  217847
     C           SRFRQ     WHEQ 'S'                                                           217847
     C           WINTT     DIV  2400      MI                                                  217847
     C                     ENDSL                                                              217847
      *                                                                                       217847
     C                     Z-ADD1         BASE   159                                          217847
     C           1         ADD  MI        MBASE  159                                          217847
     C                     Z-ADD*ZEROS    IND    159                                          217847
     C           IND       DOWLTWTNPY                                                         217847
     C                     ADD  1         IND    159                                          217847
     C           BASE      MULT MBASE     BASE                                                217847
     C                     ENDDO                                                              217847
     C           1         DIV  BASE      BASE                                                217847
     C           1         SUB  BASE      BASE                                                217847
     C           HCPAM     MULT MI        WORK1  309                                          217847
     C           WORK1     DIV  BASE      WORK1                                               217847
     C                     Z-ADDWORK1     W78RPY    H                                         217847
      *                                                                                       217847
     C                     Z-ADDW78RPY    WREPYA 152                                          CLE028
     C                     Z-ADD*ZEROS    WOUTPR 309                                          CLE028
     C                     Z-ADDW@NRPD    WFREND  50                                          CLE028
     C                     MOVE 'N'       REPIND  1                                           217847
      *                                                                                       CLE028
     C           WTOTPR    DOUEQWSVAM                                                         CLE028
     C           WOLRPA    OREQ WNWRPA                                                        CLE028
     C           REPIND    OREQ 'Y'                                                           217847
     C                     Z-ADDWSVAM     WOUTPR                                              CLE028
     C                     Z-ADD*ZEROS    WTOTPR 130                                          CLE028
     C           SACTN     IFEQ 'I'                                                           CLE028
     C                     Z-ADDWSVVD     WFRBEG  50                                          CLE028
     C                     ELSE                                                               CLE028
     C                     Z-ADDSLID      WFRBEG                                              CLE028
     C                     ENDIF                                                              CLE028
     C                     Z-ADDW@NRPD    WFREND  50                                          CLE028
      *                                                                                       CLE028
     C**********           Z-ADD1         WCTR    20                                   CLE028 216443
     C                     Z-ADD1         WCTR    50                                          216443
     C           WCTR      DOWLEWTNPY                                                         CLE028
     C           WFREND    ORLE WSVMD                                                         CLE028
     C           WFREND    ANDGEW@NRPD                                                      AR830785
      *                                                                                       CLE028
      ** COMPUTE FOR THE INTEREST TO BE REPAID USING WORK OUTSTANDING PRINCIPAL               CLE028
      *                                                                                       CLE028
     C                     Z-ADDWOUTPR    ZIAMT                                               CLE028
     C                     Z-ADDWINTT     ZIRATE                                              CLE028
     C                     MOVE SCALC     ZICALC                                              CLE028
     C                     Z-ADDWFRBEG    ZIBEG                                               CLE028
     C                     Z-ADDWFREND    ZIEND                                               CLE028
      *                                                                                       CLE028
     C           ZIEND     IFEQ *ZEROS                                                        CLE028
     C           WSVVD     ADD  1         ZIEND                                               CLE028
     C                     ELSE                                                               CLE028
     C           ZIEND     IFGT WSVMD                                                         CLE028
     C                     Z-ADDWSVMD     ZIEND                                               CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           WOUTPR    IFGT *ZEROS                                                        217847
     C                     EXSR GLINTC                                                        CLE028
     C                     Z-ADDZINTR     WINTRP 163H                                         CLE028
     C                     ELSE                                                               217847
     C                     Z-ADD*ZEROS    WINTRP                                              217847
     C                     ENDIF                                                              217847
     C                     ADD  WINTRP    WTOTIN                                              217847
     C           WTOTIN    SUB  WREPYA    WTOTIN                                              217847
     C           WTOTIN    IFLT *ZEROS                                                        217847
     C                     Z-SUBWTOTIN    WPRNRP 163                                          217847
     C                     Z-ADD*ZEROS    WTOTIN                                              217847
     C                     ELSE                                                               217847
     C                     Z-ADD*ZEROS    WPRNRP                                              217847
     C                     ENDIF                                                              217847
      *                                                                                       CLE028
     C********** WREPYA    SUB  WINTRP    WPRNRP 163                                   CLE028 217847
     C           WPRNRP    IFGT *ZEROS                                                        217847
     C                     ADD  WPRNRP    WTOTPR    H                                         CLE028
     C                     SUB  WPRNRP    WOUTPR                                              CLE028
     C                     ENDIF                                                              217847
      *                                                                                       CLE028
      ** COMPUTE NUMBER OF DAYS PER PAYMENT PERIOD                                            CLE028
      *                                                                                       CLE028
     C                     Z-ADDWFREND    ZDAYNO                                              CLE028
     C                     MOVE SRFRQ     ZFREQ                                               CLE028
     C                     MOVE SRDYN     ZMDAY                                               CLE028
     C                     MOVE SCURR     ZCCY                                                CLE028
     C                     MOVE WLCCD     ZLOC                                                CLE028
     C                     EXSR ZFREQB                                                        CLE028
     C                     Z-ADDWFREND    WFRBEG                                              CLE028
     C                     SELEC                                                              217847
     C           SPDDI     WHEQ 'P'                                                           217847
     C                     EXSR ZBKDT                                                         217847
     C           SPDDI     WHEQ 'N'                                                           217847
     C           SPDDI     OREQ *BLANK                                                        217847
     C                     EXSR ZFWDT                                                         217847
     C           SPDDI     WHEQ 'A'                                                           217847
     C                     Z-ADDZDAYNO    ZDYNBR                                              217847
     C           SPDDI     WHEQ 'M'                                                           217847
     C                     EXSR ZDATE2                                                        217847
     C           *IN98     IFEQ *OFF                                                          217847
     C                     MOVE ZDATE     MMYY    40P                                         217847
     C                     MOVELMMYY      MMNLCD  20P                                         217847
     C                     ELSE                                                               217847
     C                     MOVELZDATE     MMNLCD    P                                         217847
     C                     ENDIF                                                              217847
     C                     Z-ADDZDAYNO    @DAYNO  50                                          217847
     C                     EXSR ZFWDT                                                         217847
     C                     Z-ADDZDYNBR    ZDAYNO                                              217847
     C                     EXSR ZDATE2                                                        217847
     C           *IN98     IFEQ *OFF                                                          217847
     C                     MOVE ZDATE     MMYY      P                                         217847
     C                     MOVELMMYY      MMNWKD  20P                                         217847
     C                     ELSE                                                               217847
     C                     MOVELZDATE     MMNWKD    P                                         217847
     C                     ENDIF                                                              217847
     C           MMNLCD    IFNE MMNWKD                                                        217847
     C                     Z-ADD@DAYNO    ZDAYNO                                              217847
     C                     EXSR ZBKDT                                                         217847
     C                     ENDIF                                                              217847
     C                     ENDSL                                                              217847
      *                                                                                       217847
     C                     Z-ADDZDAYNO    WFREND                                              CLE028
     C                     ADD  1         WCTR                                                CLE028
     C                     ENDDO                                                              CLE028
      *                                                                                       CLE028
     C                     Z-ADD*ZEROS    WTOTIN                                              217847
     C           WTOTPR    IFNE WSVAM                                                         CLE028
     C                     ADD  1         WDUMMY                                              217847
     C           WSVAM     SUB  WTOTPR    WDIFF  309                                          CLE028
     C********** WDIFF     DIV  WTNPY     WADJM  309H                                  CLE028 217847
     C                     Z-ADDWOLRPA    WOOLRA 309                                          217847
     C                     Z-ADDWREPYA    WOLRPA 130H                                         CLE028
      *                                                                                       217847
     C           WODIFF    IFLT *ZEROS                                                        217847
     C           WDIFF     ANDGT*ZEROS                                                        217847
     C           AD100K    ANDEQ'Y'                                                           217847
     C           SU100K    ANDEQ'Y'                                                           217847
     C           USE10K    ANDNE'Y'                                                           217847
     C           USE1K     ANDNE'Y'                                                           217847
     C           USE100    ANDNE'Y'                                                           217847
     C           USE10     ANDNE'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C           WODIFF    ORGT *ZEROS                                                        217847
     C           WDIFF     ANDLT*ZEROS                                                        217847
     C           AD100K    ANDEQ'Y'                                                           217847
     C           SU100K    ANDEQ'Y'                                                           217847
     C           USE10K    ANDNE'Y'                                                           217847
     C           USE1K     ANDNE'Y'                                                           217847
     C           USE100    ANDNE'Y'                                                           217847
     C           USE10     ANDNE'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C                     MOVE 'Y'       USE10K                                              217847
     C           WODIFF    IFLT *ZEROS                                                        217847
     C                     Z-SUBWODIFF    WDIFF3 309                                          217847
     C           WDIFF3    IFGT WDIFF                                                         217847
     C                     Z-ADDWOLRPA    WREPYA                                              217847
     C                     ELSE                                                               217847
     C                     Z-ADDWOOLRA    WREPYA                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
     C           WDIFF     IFLT *ZEROS                                                        217847
     C                     Z-SUBWDIFF     WDIFF4 309                                          217847
     C           WDIFF4    IFGT WODIFF                                                        217847
     C                     Z-ADDWOOLRA    WREPYA                                              217847
     C                     ELSE                                                               217847
     C                     Z-ADDWOLRPA    WREPYA                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
      *                                                                                       217847
     C           WODIFF    IFLT *ZEROS                                                        217847
     C           WDIFF     ANDGT*ZEROS                                                        217847
     C           ADD10K    ANDEQ'Y'                                                           217847
     C           SUB10K    ANDEQ'Y'                                                           217847
     C           USE1K     ANDNE'Y'                                                           217847
     C           USE100    ANDNE'Y'                                                           217847
     C           USE10     ANDNE'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C           WODIFF    ORGT *ZEROS                                                        217847
     C           WDIFF     ANDLT*ZEROS                                                        217847
     C           ADD10K    ANDEQ'Y'                                                           217847
     C           SUB10K    ANDEQ'Y'                                                           217847
     C           USE1K     ANDNE'Y'                                                           217847
     C           USE100    ANDNE'Y'                                                           217847
     C           USE10     ANDNE'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C                     MOVE 'Y'       USE1K                                               217847
     C           WODIFF    IFLT *ZEROS                                                        217847
     C                     Z-SUBWODIFF    WDIFF3                                              217847
     C           WDIFF3    IFGT WDIFF                                                         217847
     C                     Z-ADDWOLRPA    WREPYA                                              217847
     C                     ELSE                                                               217847
     C                     Z-ADDWOOLRA    WREPYA                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
     C           WDIFF     IFLT *ZEROS                                                        217847
     C                     Z-SUBWDIFF     WDIFF4                                              217847
     C           WDIFF4    IFGT WODIFF                                                        217847
     C                     Z-ADDWOOLRA    WREPYA                                              217847
     C                     ELSE                                                               217847
     C                     Z-ADDWOLRPA    WREPYA                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
      *                                                                                       217847
     C           WODIFF    IFLT *ZEROS                                                        217847
     C           WDIFF     ANDGT*ZEROS                                                        217847
     C           ADD1K     ANDEQ'Y'                                                           217847
     C           SUB1K     ANDEQ'Y'                                                           217847
     C           USE100    ANDNE'Y'                                                           217847
     C           USE10     ANDNE'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C           WODIFF    ORGT *ZEROS                                                        217847
     C           WDIFF     ANDLT*ZEROS                                                        217847
     C           ADD1K     ANDEQ'Y'                                                           217847
     C           SUB1K     ANDEQ'Y'                                                           217847
     C           USE100    ANDNE'Y'                                                           217847
     C           USE10     ANDNE'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C                     MOVE 'Y'       USE100                                              217847
     C           WODIFF    IFLT *ZEROS                                                        217847
     C                     Z-SUBWODIFF    WDIFF3                                              217847
     C           WDIFF3    IFGT WDIFF                                                         217847
     C                     Z-ADDWOLRPA    WREPYA                                              217847
     C                     ELSE                                                               217847
     C                     Z-ADDWOOLRA    WREPYA                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
     C           WDIFF     IFLT *ZEROS                                                        217847
     C                     Z-SUBWDIFF     WDIFF4                                              217847
     C           WDIFF4    IFGT WODIFF                                                        217847
     C                     Z-ADDWOOLRA    WREPYA                                              217847
     C                     ELSE                                                               217847
     C                     Z-ADDWOLRPA    WREPYA                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
      *                                                                                       217847
     C           WODIFF    IFLT *ZEROS                                                        217847
     C           WDIFF     ANDGT*ZEROS                                                        217847
     C           ADD100    ANDEQ'Y'                                                           217847
     C           SUB100    ANDEQ'Y'                                                           217847
     C           USE10     ANDNE'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C           WODIFF    ORGT *ZEROS                                                        217847
     C           WDIFF     ANDLT*ZEROS                                                        217847
     C           ADD100    ANDEQ'Y'                                                           217847
     C           SUB100    ANDEQ'Y'                                                           217847
     C           USE10     ANDNE'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C                     MOVE 'Y'       USE10                                               217847
     C           WODIFF    IFLT *ZEROS                                                        217847
     C                     Z-SUBWODIFF    WDIFF3                                              217847
     C           WDIFF3    IFGT WDIFF                                                         217847
     C                     Z-ADDWOLRPA    WREPYA                                              217847
     C                     ELSE                                                               217847
     C                     Z-ADDWOOLRA    WREPYA                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
     C           WDIFF     IFLT *ZEROS                                                        217847
     C                     Z-SUBWDIFF     WDIFF4                                              217847
     C           WDIFF4    IFGT WODIFF                                                        217847
     C                     Z-ADDWOOLRA    WREPYA                                              217847
     C                     ELSE                                                               217847
     C                     Z-ADDWOLRPA    WREPYA                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
      *                                                                                       217847
     C           WODIFF    IFLT *ZEROS                                                        217847
     C           WDIFF     ANDGT*ZEROS                                                        217847
     C           ADDI10    ANDEQ'Y'                                                           217847
     C           SUBI10    ANDEQ'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C           WODIFF    ORGT *ZEROS                                                        217847
     C           WDIFF     ANDLT*ZEROS                                                        217847
     C           ADDI10    ANDEQ'Y'                                                           217847
     C           SUBI10    ANDEQ'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C                     MOVE 'Y'       USE5                                                217847
     C           WODIFF    IFLT *ZEROS                                                        217847
     C                     Z-SUBWODIFF    WDIFF3                                              217847
     C           WDIFF3    IFGT WDIFF                                                         217847
     C                     Z-ADDWOLRPA    WREPYA                                              217847
     C                     ELSE                                                               217847
     C                     Z-ADDWOOLRA    WREPYA                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
     C           WDIFF     IFLT *ZEROS                                                        217847
     C                     Z-SUBWDIFF     WDIFF4                                              217847
     C           WDIFF4    IFGT WODIFF                                                        217847
     C                     Z-ADDWOOLRA    WREPYA                                              217847
     C                     ELSE                                                               217847
     C                     Z-ADDWOLRPA    WREPYA                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
      *                                                                                       217847
     C           WODIFF    IFLT *ZEROS                                                        217847
     C           WDIFF     ANDGT*ZEROS                                                        217847
     C           ADDI5     ANDEQ'Y'                                                           217847
     C           SUBI5     ANDEQ'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C           WODIFF    ORGT *ZEROS                                                        217847
     C           WDIFF     ANDLT*ZEROS                                                        217847
     C           ADDI5     ANDEQ'Y'                                                           217847
     C           SUBI5     ANDEQ'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C                     MOVE 'Y'       USE1                                                217847
     C           WODIFF    IFLT *ZEROS                                                        217847
     C                     Z-SUBWODIFF    WDIFF3                                              217847
     C           WDIFF3    IFGT WDIFF                                                         217847
     C                     Z-ADDWOLRPA    WREPYA                                              217847
     C                     ELSE                                                               217847
     C                     Z-ADDWOOLRA    WREPYA                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
     C           WDIFF     IFLT *ZEROS                                                        217847
     C                     Z-SUBWDIFF     WDIFF4                                              217847
     C           WDIFF4    IFGT WODIFF                                                        217847
     C                     Z-ADDWOOLRA    WREPYA                                              217847
     C                     ELSE                                                               217847
     C                     Z-ADDWOLRPA    WREPYA                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
      *                                                                                       217847
     C           WODIFF    IFLT *ZEROS                                                        217847
     C           WDIFF     ANDGT*ZEROS                                                        217847
     C           ADDI1     ANDEQ'Y'                                                           217847
     C           SUBI1     ANDEQ'Y'                                                           217847
     C           WODIFF    ORGT *ZEROS                                                        217847
     C           WDIFF     ANDLT*ZEROS                                                        217847
     C           ADDI1     ANDEQ'Y'                                                           217847
     C           SUBI1     ANDEQ'Y'                                                           217847
     C                     MOVE 'Y'       REPIND                                              217847
     C           WODIFF    IFLT *ZEROS                                                        217847
     C                     Z-SUBWODIFF    WDIFF3                                              217847
     C           WDIFF3    IFGT WDIFF                                                         217847
     C                     Z-ADDWOLRPA    WREPYA                                              217847
     C                     ELSE                                                               217847
     C                     Z-ADDWOOLRA    WREPYA                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
     C           WDIFF     IFLT *ZEROS                                                        217847
     C                     Z-SUBWDIFF     WDIFF4                                              217847
     C           WDIFF4    IFGT WODIFF                                                        217847
     C                     Z-ADDWOOLRA    WREPYA                                              217847
     C                     ELSE                                                               217847
     C                     Z-ADDWOLRPA    WREPYA                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
      *                                                                                       217847
     C           REPIND    IFNE 'Y'                                                           217847
     C           WDIFF     IFGT *ZEROS                                                        217847
      *                                                                                       217847
     C                     SELEC                                                              217847
     C           WDIFF     WHGT 10000000                                                      217847
     C           USE10K    ANDNE'Y'                                                           217847
     C           USE1K     ANDNE'Y'                                                           217847
     C           USE100    ANDNE'Y'                                                           217847
     C           USE10     ANDNE'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C                     ADD  100000    WREPYA                                              217847
     C                     MOVE 'Y'       AD100K                                              217847
     C           WDIFF     WHGT 1000000                                                       217847
     C           USE1K     ANDNE'Y'                                                           217847
     C           USE100    ANDNE'Y'                                                           217847
     C           USE10     ANDNE'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C                     ADD  10000     WREPYA                                              217847
     C                     MOVE 'Y'       ADD10K                                              217847
     C                     MOVE 'Y'       USE10K                                              217847
     C           WDIFF     WHGT 100000                                                        217847
     C           USE100    ANDNE'Y'                                                           217847
     C           USE10     ANDNE'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C                     ADD  1000      WREPYA                                              217847
     C                     MOVE 'Y'       ADD1K                                               217847
     C                     MOVE 'Y'       USE1K                                               217847
     C           WDIFF     WHGT 10000                                                         217847
     C           USE10     ANDNE'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C                     ADD  100       WREPYA                                              217847
     C                     MOVE 'Y'       ADD100                                              217847
     C                     MOVE 'Y'       USE100                                              217847
     C           WDIFF     WHGT 1000                                                          217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C                     ADD  10        WREPYA                                              217847
     C                     MOVE 'Y'       ADDI10                                              217847
     C                     MOVE 'Y'       USE10                                               217847
     C           WDIFF     WHGT 500                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C                     ADD  5         WREPYA                                              217847
     C                     MOVE 'Y'       ADDI5                                               217847
     C                     MOVE 'Y'       USE5                                                217847
     C                     OTHER                                                              217847
     C                     ADD  1         WREPYA                                              217847
     C                     MOVE 'Y'       ADDI1                                               217847
     C                     MOVE 'Y'       USE1                                                217847
     C                     ENDSL                                                              217847
      *                                                                                       217847
     C                     ELSE                                                               217847
      *                                                                                       217847
     C                     SELEC                                                              217847
     C           WDIFF     WHLT -10000000                                                     217847
     C           USE10K    ANDNE'Y'                                                           217847
     C           USE1K     ANDNE'Y'                                                           217847
     C           USE100    ANDNE'Y'                                                           217847
     C           USE10     ANDNE'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C                     SUB  100000    WREPYA                                              217847
     C                     MOVE 'Y'       SU100K                                              217847
     C           WDIFF     WHLT -1000000                                                      217847
     C           USE1K     ANDNE'Y'                                                           217847
     C           USE100    ANDNE'Y'                                                           217847
     C           USE10     ANDNE'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C                     SUB  10000     WREPYA                                              217847
     C                     MOVE 'Y'       SUB10K                                              217847
     C                     MOVE 'Y'       USE10K                                              217847
     C           WDIFF     WHLT -100000                                                       217847
     C           USE100    ANDNE'Y'                                                           217847
     C           USE10     ANDNE'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C                     SUB  1000      WREPYA                                              217847
     C                     MOVE 'Y'       SUB1K                                               217847
     C                     MOVE 'Y'       USE1K                                               217847
     C           WDIFF     WHLT -10000                                                        217847
     C           USE10     ANDNE'Y'                                                           217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C                     SUB  100       WREPYA                                              217847
     C                     MOVE 'Y'       SUB100                                              217847
     C                     MOVE 'Y'       USE100                                              217847
     C           WDIFF     WHLT -1000                                                         217847
     C           USE5      ANDNE'Y'                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C                     SUB  10        WREPYA                                              217847
     C                     MOVE 'Y'       SUBI10                                              217847
     C                     MOVE 'Y'       USE10                                               217847
     C           WDIFF     WHLT 500                                                           217847
     C           USE1      ANDNE'Y'                                                           217847
     C                     SUB  5         WREPYA                                              217847
     C                     MOVE 'Y'       SUBI5                                               217847
     C                     MOVE 'Y'       USE5                                                217847
     C                     OTHER                                                              217847
     C                     SUB  1         WREPYA                                              217847
     C                     MOVE 'Y'       SUBI1                                               217847
     C                     MOVE 'Y'       USE1                                                217847
     C                     ENDSL                                                              217847
      *                                                                                       217847
     C                     ENDIF                                                              217847
     C                     ENDIF                                                              217847
      *                                                                                       217847
     C                     Z-ADDWDIFF     WODIFF 309                                          217847
     C**********           ADD  WADJM     WREPYA                                       CLE028 217847
     C                     Z-ADDWREPYA    WNWRPA 130H                                         CLE028
      *                                                                                       217847
     C           WDIFF     IFLT *ZEROS                                                        217847
     C                     Z-SUBWDIFF     WDIFF2 309                                          217847
     C                     ELSE                                                               217847
     C                     Z-ADDWDIFF     WDIFF2                                              217847
     C                     ENDIF                                                              217847
     C           WDIFF2    IFLT 5                                                             217847
     C                     MOVE 'Y'       REPIND                                              217847
     C                     ENDIF                                                              217847
      *                                                                                       217847
     C                     Z-ADDWREPYA    WNWRPA 130H                                         CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDDO                                                              CLE028
     C                     Z-ADDWREPYA    W78RPY    H                                         CLE028
     C                     MOVELWREP3A    WREPY3                                              217847
      *                                                                                       217847
     C                     ENDSR                                                              CLE028
      *****************************************************************                       CLE028
      /EJECT
      *****************************************************************
      * SRCL05  -  Validate CLE005 fields                             *
      * Called by: SRVAL2 - Validate second detail screen             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRCL05    BEGSR
      *
      ** VALIDATE PAYMENT DUE DAY (if CLE005 is installed)
      ** ... entry is allowed only for repayment type '2'
      ** Entry now allowed for types '1' and '3' also.                    154221
      *
     C           SREPT     IFEQ '2'
     C           *IN68     ANDEQ'0'                                       CLE005
     C           SREPT     OREQ '1'                                       154221
     C           *IN68     ANDEQ'0'                                       154221
     C           SREPT     OREQ '3'                                       154221
     C           *IN68     ANDEQ'0'                                       154221
     C           SPDDI     IFEQ *BLANK
     C***********          MOVE 'A'       SPDDI                           144089
     C           CLE028    IFNE 'Y'                                                           220514
     C           CLE028    OREQ 'Y'                                                           220514
     C           WLNPT     ANDNE80                                                            220514
     C                     MOVE 'M'       SPDDI                           144089
     C                     ELSE                                                               220514
     C                     MOVE 'A'       SPDDI                                               220514
     C                     ENDIF                                                              220514
     C/COPY WNCPYSRC,LE2030C119
     C                     ELSE
     C           CLE028    IFNE 'Y'                                                           220514
     C           CLE028    OREQ 'Y'                                                           220514
     C           WLNPT     ANDNE80                                                            220514
     C           SPDDI     IFNE 'A'
     C           SPDDI     ANDNE'P'
     C           SPDDI     ANDNE'N'
     C           SPDDI     ANDNE'M'                                       144089
     C                     MOVE '1'       *IN79
     C                     MOVEL'LEL0419' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ELSE                                                               220514
     C           SPDDI     IFNE 'A'                                                           220514
     C                     MOVE '1'       *IN79                                               220514
     C                     MOVEL'LEL0578' ZAMSID                                              220514
     C                     EXSR ZASNMS                                                        220514
     C                     ENDIF                                                              220514
     C                     ENDIF                                                              220514
     C                     ENDIF
      *
     C                     ELSE
     C           SPDDI     IFNE *BLANK
     C           SREPT     ANDNE'1'                                       154221
     C           SREPT     ANDNE'2'                                       154221
     C           SREPT     ANDNE'3'                                       154221
     C                     MOVE '1'       *IN79
     C                     MOVEL'LEL0422' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE PAYMENT TAKEN DAY (if CLE005 is installed)
      ** ... entry is allowed only for repayment type '2' if payment
      ** is due on actual date
      ** ... also allow entry of 'M' when payment due is modified.        144089
      ** Entry now allowed for types '1' and '3' also.                    154221
      *
     C           SREPT     IFEQ '2'
     C           SPDDI     ANDEQ'A'
     C           *IN68     ANDEQ'0'                                       CLE005
     C           SREPT     OREQ '1'                                       154221
     C           SPDDI     ANDEQ'A'                                       154221
     C           *IN68     ANDEQ'0'                                       154221
     C           SREPT     OREQ '3'                                       154221
     C           SPDDI     ANDEQ'A'                                       154221
     C           *IN68     ANDEQ'0'                                       154221
     C           SPTDI     IFEQ *BLANK
     C                     MOVE 'M'       SPTDI
     C/COPY WNCPYSRC,LE2030C120
     C                     ELSE
     C           SPTDI     IFNE 'P'
     C           SPTDI     ANDNE'N'
     C           SPTDI     ANDNE'M'
     C                     MOVE '1'       *IN76
     C                     MOVEL'LEL0420' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
     C                     ELSE
     C           SREPT     IFEQ '2'                                       144089
     C           SPDDI     ANDEQ'M'                                       144089
     C           *IN68     ANDEQ'0'                                       144089
     C           SREPT     OREQ '1'                                       154221
     C           SPDDI     ANDEQ'M'                                       154221
     C           *IN68     ANDEQ'0'                                       154221
     C           SREPT     OREQ '3'                                       154221
     C           SPDDI     ANDEQ'M'                                       154221
     C           *IN68     ANDEQ'0'                                       154221
     C           SPTDI     IFEQ *BLANK                                    144089
     C                     MOVE 'M'       SPTDI                           144089
     C                     ELSE                                           144089
     C           SPTDI     IFNE 'M'                                       144089
     C                     MOVE '1'       *IN76                           144089
     C                     MOVEL'LEL0425' ZAMSID                          144089
     C                     EXSR ZASNMS                                    144089
     C                     ENDIF                                          144089
     C                     ENDIF                                          144089
     C                     ELSE                                           144089
      *                                                                   155936
     C           SREPT     IFEQ '2'                                       155936
     C           SPDDI     ANDEQ'P'                                       155936
     C           *IN68     ANDEQ'0'                                       155936
     C           SREPT     OREQ '1'                                       154221
     C           SPDDI     ANDEQ'P'                                       154221
     C           *IN68     ANDEQ'0'                                       154221
     C           SREPT     OREQ '3'                                       154221
     C           SPDDI     ANDEQ'P'                                       154221
     C           *IN68     ANDEQ'0'                                       154221
     C           SPTDI     IFEQ *BLANK                                    155936
     C                     MOVE 'P'       SPTDI                           155936
     C                     ELSE                                           155936
     C           SPTDI     IFNE 'P'                                       155936
     C                     MOVE '1'       *IN76                           155936
     C                     MOVEL'LEL0425' ZAMSID                          155936
     C                     EXSR ZASNMS                                    155936
     C                     ENDIF                                          155936
     C                     ENDIF                                          155936
      *                                                                   155936
     C                     ELSE                                           155936
      *                                                                   155936
     C           SREPT     IFEQ '2'                                       155936
     C           SPDDI     ANDEQ'N'                                       155936
     C           *IN68     ANDEQ'0'                                       155936
     C           SREPT     OREQ '1'                                       154221
     C           SPDDI     ANDEQ'N'                                       154221
     C           *IN68     ANDEQ'0'                                       154221
     C           SREPT     OREQ '3'                                       154221
     C           SPDDI     ANDEQ'N'                                       154221
     C           *IN68     ANDEQ'0'                                       154221
     C           SPTDI     IFEQ *BLANK                                    155936
     C                     MOVE 'N'       SPTDI                           155936
     C                     ELSE                                           155936
     C           SPTDI     IFNE 'N'                                       155936
     C                     MOVE '1'       *IN76                           155936
     C                     MOVEL'LEL0425' ZAMSID                          155936
     C                     EXSR ZASNMS                                    155936
     C                     ENDIF                                          155936
     C                     ENDIF                                          155936
      *                                                                   155936
     C                     ELSE                                           155936
      *                                                                   155936
     C           SPTDI     IFNE *BLANK
     C           SREPT     ANDNE'1'                                       154221
     C           SREPT     ANDNE'2'                                       154221
     C           SREPT     ANDNE'3'                                       154221
     C                     MOVE '1'       *IN76
     C                     MOVEL'LEL0421' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF                                          144089
     C                     ENDIF
     C                     ENDIF                                          155936
     C                     ENDIF                                          155936
      *
      ** VALIDATE GRACE DAYS FOR REPAYMENT (if CLE005 is installed)
      ** ... defaults to grace days from lending ICD if blank
      *
     C           SGDIN     IFEQ *BLANK
     C                     MOVE BPGRIR    SGDIN
     C/COPY WNCPYSRC,LE2030C128
     C                     ELSE
     C/COPY WNCPYSRC,LE2030C129
     C                     MOVELSGDIN     WNUM3
     C                     MOVELWNUM3     WALF2
     C           SGDIN     IFNE WALF2
     C                     MOVE '1'       *IN77
     C                     MOVEL'LEL0417' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
     C           SGDPR     IFEQ *BLANK
     C                     MOVE BPGRPR    SGDPR
     C/COPY WNCPYSRC,LE2030C130
     C                     ELSE
     C/COPY WNCPYSRC,LE2030C131
     C                     MOVELSGDPR     WNUM3
     C                     MOVELWNUM3     WALF2
     C           SGDPR     IFNE WALF2
     C                     MOVE '1'       *IN78
     C                     MOVEL'LEL0418' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2030C084
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRVAL4  -  Validate fourth detail screen                      *
      * Called by: SRDTL4 - Process fourth detail screen              *
      *            SRBTCH - Batch processing                          *
      * Calls    : None                                               *
      *****************************************************************
     C           SRVAL4    BEGSR
      *
     C                     MOVEA'000000'  *IN,80
     C                     MOVEAWVAL3     *IN,07
     C                     MOVEA'00'      *IN,86
     C                     EXSR CLEAR
     C                     MOVE 'E'       WRMSV
     C                     MOVE *BLANKS   WANUM   6                       161257
      *
      ** VALIDATE ACCOUNT OFFICER
      ** ... defaults to account officer of related loan for parts sold
      ** ... defaults to account officer of facility if not parts sold
      *
     C           SACOF     IFEQ *BLANKS
     C           *IN22     IFEQ '0'
     C/COPY WNCPYSRC,LE2030C080
     C                     MOVE ACOFF     SACOF
     C/COPY WNCPYSRC,LE2030C081
     C                     ELSE
     C                     MOVE ACOFM     SACOF
     C                     ENDIF
      *                                                                   161257
      ** Loans entered against a syndicated facility                      161257
      *                                                                   161257
     C           SYINF     IFEQ 'Y'                                       161257
     C           *IN22     IFEQ '0'                                       161257
     C                     MOVE WAGENT    WANUM                           161257
     C                     ELSE                                           161257
     C                     MOVE ANUM      WANUM                           161257
     C                     ENDIF                                          161257
     C           WANUM     IFEQ W#SYCU                                    161257
     C                     MOVE *BLANKS   PCUST                           161257
     C                     MOVE WANUM     PCUST                           161257
      *                                                                   161257
      ** Default agent customer account officer into primary loan and     161257
      ** part sold against the primary loan. When loan entered is an      161257
      ** internal parts purchased or part sold against an IPP, default    161257
      ** account officer of the facility customer.                        161257
      *                                                                   161257
     C                     SELEC                                          161257
     C           *IN21     WHEQ '1'                                       161257
     C                     MOVE PMFC      PCUST                           161257
     C           *IN22     WHEQ '1'                                       161257
     C           WPTYP     ANDEQ64                                        161257
     C           *IN22     OREQ '1'                                       161257
     C           WPTYP     ANDEQ65                                        161257
     C           *IN22     OREQ '1'                                       161257
     C           WPTYP     ANDEQ68                                        161257
     C           CLE005    ANDEQ'Y'                                       161257
     C           *IN22     OREQ '1'                                       161257
     C           WPTYP     ANDEQ71                                        161257
     C           CLE005    ANDEQ'Y'                                       161257
     C                     MOVE CNUMF     PCUST                           161257
     C                     ENDSL                                          161257
      *                                                                   161257
     C                     CALL 'AOCUSTR0'PPAR3                           161257
     C           PRTCD     IFNE *BLANKS                                   161257
     C           *LOCK     IN   LDA                                       161257
     C                     MOVEL'SDCUSTPD'DBFILE           ************   161257
     C                     Z-ADD17        DBASE            * DBERR 17 *   161257
     C                     MOVELPCUST     DBKEY            ************   161257
     C                     OUT  LDA                                       161257
     C                     EXSR *PSSR                                     161257
     C                     ENDIF                                          161257
     C                     MOVE BBACOC    SACOF                           161257
     C                     ENDIF                                          161257
     C                     ENDIF                                          161257
      *                                                                   161257
     C                     ELSE
      *
     C                     MOVE SACOF     PACOC
     C                     CALL 'AOACOFR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PACOC   2
     C           SDACOF    PARM SDACOF    DSFDY
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN80
     C                     MOVEL'LEL0171' ZAMSID
     C                     EXSR ZASNMS
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SACOF
     C                     ENDIF
     C                     ELSE
     C                     MOVE AZACOC    SACOF
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2030C078
      *
      ** VALIDATE INDUSTRY (for loans and parts purchased)
      ** ... defaults to local industry code of customer
      *
     C           *IN22     IFEQ '0'
     C           SLIND     IFEQ *BLANKS
     C                     MOVE WLIND     SLIND
     C                     ELSE
      *
     C                     MOVE SLIND     PLICD
     C                     CALL 'AOINDSR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PLICD   3
     C           SDINDS    PARM SDINDS    DSFDY
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN81
     C                     MOVEL'LEL0166' ZAMSID
     C                     EXSR ZASNMS
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SLIND
     C                     ENDIF
     C                     ELSE
     C                     MOVE AOLICD    SLIND
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE FEES
      *
     C           SFEEI     IFEQ *BLANK
     C                     MOVE 'N'       SFEEI
     C                     ELSE
     C           SFEEI     IFNE 'Y'
     C           SFEEI     ANDNE'N'
     C                     MOVE '1'       *IN82
     C                     MOVEL'LEL0164' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE ORIGINATING BRANCH
      ** ... validated only if multi-branching and originating branch
      ** are being used (for loans and parts purchased)
      *
     C           *IN22     IFEQ '0'
     C           BKOBRU    ANDEQ'Y'
     C           BGMBIN    ANDEQ'Y'
     C           SORBR     IFEQ *BLANKS
     C                     MOVE SBRCA     SORBR
     C                     ENDIF
     C                     MOVE SORBR     PBRCA
     C***********          CALL 'AOBRCHR0'PPAR4                           121783
     C                     CALL 'AOBRCHR1'PPAR4                           121783
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN83
     C                     MOVEL'LEL0311' ZAMSID
     C                     EXSR ZASNMS
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SORBR
     C                     ENDIF
     C                     ELSE
     C                     MOVE A8BRCD    SORBR
     C                     ENDIF
      *
      ** ... validate against user
      *
     C           BKOBUV    IFEQ 'Y'
     C                     MOVE SORBR     @ZBR
      *
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBOBU'
     C                     PARM           @ZBR
     C                     PARM           @USER
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVOBU'
     C                     PARM           @ZBR
     C                     PARM           @ERR
     C                     ENDIF
      *
     C                     SELEC
     C           @ERR      WHEQ 1
     C                     MOVE '1'       *IN83
     C                     MOVEL'LEL0305' ZAMSID
     C                     EXSR ZASNMS
     C           @ERR      WHEQ 2
     C                     MOVE '1'       *IN83
     C                     MOVEL'LEL0306' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDSL
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE COUNTRY OF RISK (for loans and parts purchased)
      ** ... defaults to country of facility
      *
     C           *IN22     IFEQ '0'
     C           SCRSK     IFEQ *BLANKS
     C                     MOVE CRSKF     SCRSK
      *
     C                     ELSE
     C                     MOVE SCRSK     PCNCD
     C                     CALL 'AOCTRYR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PCNCD   2
     C           SDCTRY    PARM SDCTRY    DSFDY
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN84
     C                     MOVEL'LEL0167' ZAMSID
     C                     EXSR ZASNMS
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SCRSK
     C                     ENDIF
     C                     ELSE
     C                     MOVE A4CNCD    SCRSK
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE DOCUMENTS
      *
     C           SDOCI     IFEQ *BLANK
     C                     MOVE 'N'       SDOCI
     C                     ELSE
     C           SDOCI     IFNE 'Y'
     C           SDOCI     ANDNE'N'
     C                     MOVE '1'       *IN85
     C                     MOVEL'LEL0163' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE BOOK CODE
      *
     C           SBOKC     IFEQ *BLANKS
     C                     MOVE BPDBKC    SBOKC
     C                     ELSE
     C                     MOVE SBOKC     PBKCD   2
     C                     CALL 'AOBOOKR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PBKCD
     C           SDBOOK    PARM SDBOOK    DSFDY
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN20
     C                     MOVEL'LEL0292' ZAMSID
     C                     EXSR ZASNMS
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SBOKC
     C                     ENDIF
     C                     ELSE
     C                     MOVE BDBKCD    SBOKC
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE FRB CODE
      *
     C                     MOVELSFRBC     WNUM6   60
     C                     MOVELWNUM6     WALF5   5
     C           SFRBC     IFNE *BLANKS
     C           SFRBC     IFNE WALF5
     C           WNUM6     OREQ *ZEROS
     C                     MOVE '1'       *IN19
     C                     MOVEL'LEL0165' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE SECURED
      *
     C           SSECI     IFEQ *BLANK
     C                     MOVE 'N'       SSECI
     C                     ELSE
     C           SSECI     IFNE 'Y'
     C           SSECI     ANDNE'N'
     C                     MOVE '1'       *IN18
     C                     MOVEL'LEL0162' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE PROFIT CENTRE (for loans and parts purchased)
      *
     C           *IN22     IFEQ '0'
     C           BKPRCU    IFEQ 'Y'
     C           BKPRCA    ANDEQ'Y'
     C           BKPRCU    OREQ 'Y'
     C           SACTN     ANDEQ'I'
      *
      ** ... must be existing in profit centre's file, if entered
      *
     C           SPRFC     IFNE *BLANKS
     C                     MOVE SPRFC     PPCCD   4
     C                     CALL 'AOPRFCR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY    'POPTN
     C                     PARM           PPCCD
     C           SDPRFC    PARM SDPRFC    DSFDY
     C           PRTCD     IFNE *BLANK
     C                     MOVE '1'       *IN17
     C                     MOVEL'LEL0310' ZAMSID
     C                     EXSR ZASNMS
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SPRFC
     C                     ENDIF
     C                     ELSE
     C                     MOVE DSPCCD    SPRFC
     C                     MOVE DSLFPC    WLFPC   4
     C                     MOVE DSFFPC    WFFPC   4
     C                     ENDIF
      *
      ** ... otherwise, extract default profit centre if default flag
      ** is switched on
      *
     C                     ELSE
     C           BKPCDU    IFEQ 'Y'
     C                     MOVELSLTYP     PTRTP
     C                     MOVELSSUTP     PSUTP
     C                     MOVELSBRCA     PBRAN
     C                     MOVELUSER      PUSER
     C                     MOVELSACOF     PACOF
     C                     MOVELWSVCN     PCNUM
     C                     CALL 'AOPRFMR0'
     C                     PARM *BLANKS   PRTNC   1
     C************         PARM *BLANKS   PBOOK   2                       176510
     C                     PARM SBOKC     PBOOK   2                       176510
     C                     PARM           PTRTP   5
     C                     PARM           PSUTP   2
     C                     PARM           PBRAN   3
     C                     PARM *BLANKS   PDEPT   3
     C                     PARM           PUSER  10
     C                     PARM           PACOF   2
     C                     PARM           PCNUM   6
     C                     PARM *BLANKS   PPRFC   4
     C                     MOVELPPRFC     SPRFC                           177012
     C           PRTNC     IFEQ '2'
     C                     MOVE '1'       *IN17
     C                     MOVEL'LEL0310' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2030C002
      *
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE PORTFOLIO REFERENCE (for loans)
      *
     C                     MOVE 'N'       WPTCS   1
     C                     MOVE *BLANKS   WPTFR                                               211253
     C           BGPFMG    IFEQ 'Y'
     C           *IN21     ANDEQ'0'
     C           *IN22     ANDEQ'0'
     C           BGN4ST    ANDNE'Y'                                       CPB001
      *
     C                     MOVELFCPORS    I#PORS
     C                     MOVELFCR997    I#R997
     C                     MOVELWSVCN     I#CUST
     C                     MOVELSBRCA     I#BRCA
     C                     MOVELSBOKC     I#BOOK
     C                     MOVELSPTFR     I#PTFR
     C                     MOVEL*BLANKS   I#CPGM
      *
     C                     CALL 'AOPLCSR1'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           I@PARM
     C                     PARM *BLANKS   O@PARM
     C           SDPLCS    PARM SDPLCS    DSFDY
      *
      ** ... no error, and book code/portfolio reference are blank,
      ** set to default values from the file
      *
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       WPTCS
     C           FCPORS    IFEQ 'B'
     C           SBOKC     ANDEQ*BLANKS
     C                     MOVE O#BOOK    SBOKC
     C                     ENDIF
     C           SPTFR     IFEQ *BLANKS
     C                     MOVE O#PTFR    SPTFR
     C                     ENDIF
      *
      ** ... check if reference is a live record, or if not, check
      ** if it refers to the '9997' reference
      *
     C                     MOVELQBCUST    WPCNO
     C                     MOVELSPTFR     WPTFR
     C           WKPOR     CHAINPMPORTPD             89
     C           *IN89     IFEQ '1'
     C           *IN89     OREQ '0'
     C           PNRECI    ANDNE'D'
     C           SPTFR     IFNE FCR997
     C                     MOVE '1'       *IN16
     C                     MOVEL'LEL0490' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** if existing, send warning if portfolio is closed
      *
     C                     ELSE
     C           PNDPCL    IFGT *ZEROS
     C           WE023     IFEQ *BLANK
     C           WE023     OREQ 'Y'
     C           SPTFR     ANDNEW1PR
     C                     MOVE SPTFR     W1PR    4
     C                     MOVE 'Y'       WE023   1
     C                     MOVE 'W'       WRMSV
     C                     MOVE 'Y'       WWARN
     C                     MOVE '1'       *IN16
     C                     MOVEL'LEL0083' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'E'       WRMSV
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** ... process errors from AOPLCSR1
      *
     C                     ELSE
     C                     SELEC
     C           PRTCD     WHEQ 'PMA0008'
     C           SPTFR     ANDNE*BLANKS
     C           PRTCD     OREQ 'PMA0009'
     C           SPTFR     ANDNE*BLANKS
     C                     MOVE '1'       *IN16
     C                     MOVEL'LEL0489' ZAMSID
     C                     EXSR ZASNMS
     C           PRTCD     WHEQ 'PMA0010'
     C                     MOVE '1'       *IN16
     C                     MOVEL'LEL0493' ZAMSID
     C                     EXSR ZASNMS
     C           PRTCD     WHEQ 'PMA0010'
     C                     MOVE '1'       *IN16
     C                     MOVEL'LEL0494' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDSL
     C                     ENDIF
      *
      ** ... bank portfolio is supported but book and portfolio
      ** reference do not match as per PF/SDBOOKPD
      *
     C           FCPORS    IFEQ 'B'
     C           SBOKC     ANDNE*BLANKS
     C           SPTFR     ANDNE*BLANKS
     C           SPTFR     ANDNEO#PTFR
     C                     MOVE '1'       *IN16
     C                     MOVEL'LEL0495' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C           SPTFR     IFEQ FCR997
     C           SPTFR     OREQ *BLANKS
     C           WPTCS     ANDEQ'Y'
     C                     MOVE '9997'    WPTFR   4
     C                     ELSE
     C                     MOVE SPTFR     WPTFR
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                   CPB001
      *** Check Portfolio Reference if Private Banking Module is Active   CPB001
      *                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C           *IN21     ANDEQ'0'                                       CPB001
     C           *IN22     ANDEQ'0'                                       CPB001
      *                                                                   CPB001
     C                     MOVE 'N'       WWCSPT  1                       CPB001
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C                     MOVELFCPORS    I#PORS                          CPB001
     C                     MOVELFCR997    I#R997                          CPB001
     C                     MOVELWSVCN     I#CUST                          CPB001
     C                     MOVELSBRCA     I#BRCA                          CPB001
     C                     MOVELSBOKC     I#BOOK                          CPB001
     C                     MOVELSPTFR     I#PTFR                          CPB001
     C                     MOVEL*BLANKS   I#CPGM                          CPB001
      *                                                                   CPB001
     C                     CALL 'AOPLCSR1'                                CPB001
     C                     PARM *BLANKS   PRTCD                           CPB001
     C                     PARM '*KEY   ' POPTN                           CPB001
     C                     PARM           I@PARM                          CPB001
     C                     PARM *BLANKS   O@PARM                          CPB001
     C           SDPLCS    PARM SDPLCS    DSFDY                           CPB001
     C           PRTCD     IFEQ *BLANKS                                   CPB001
     C                     MOVE 'Y'       WWCSPT  1                       CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
      *                                                                   CPB001
     C                     MOVELWSVCN     PCUST     P                     CPB001
     C                     CALL 'AOCUSTR1'PPAR6                           CPB001
      *                                                                   CPB001
     C           PRTCD     IFEQ *BLANKS                                   CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C                     MOVE 'Y'       WWCSPT  1                       CPB001
     C                     ENDIF                                          CPB001
      *                                                                   CPB001
      *** If Portfolio Reference is Blank, this one must be defaulted     CPB001
      *                                                                   CPB001
     C           SPTFR     IFEQ *BLANKS                                   CPB001
     C           WWCSPT    ANDEQ'Y'                                       CPB001
     C                     MOVE WSVCN     WPCNO                           CPB001
     C           WPCNO     SETLLPMPORTPD                                  CPB001
     C           WPCNO     READEPMPORTPD                 89               CPB001
     C           *IN89     IFEQ *OFF                                      CPB001
     C           PNRECI    ANDEQ'D'                                       CPB001
     C                     MOVE PNPTFR    SPTFR                           CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
      *                                                                   CPB001
      ** ... check if reference is a live record                          CPB001
      *                                                                   CPB001
     C           SPTFR     IFNE *BLANKS                                   CPB001
     C           WWCSPT    ANDEQ'Y'                                       CPB001
     C                     MOVELWSVCN     WPCNO                           CPB001
     C                     MOVELSPTFR     WPTFR                           CPB001
     C           WKPOR     CHAINPMPORTPD             89                   CPB001
     C           *IN89     IFEQ '1'                                       CPB001
     C           *IN89     OREQ '0'                                       CPB001
     C           PNRECI    ANDNE'D'                                       CPB001
     C                     MOVE '1'       *IN16                           CPB001
     C                     MOVEL'LEL0490' ZAMSID                          CPB001
     C                     EXSR ZASNMS                                    CPB001
      *                                                                   CPB001
      ** if existing, send warning if portfolio is closed                 CPB001
      *                                                                   CPB001
     C                     ELSE                                           CPB001
     C           PNDPCL    IFGT *ZEROS                                    CPB001
     C           WE023     IFEQ *BLANK                                    CPB001
     C           WE023     OREQ 'Y'                                       CPB001
     C           SPTFR     ANDNEW1PR                                      CPB001
     C                     MOVE SPTFR     W1PR    4                       CPB001
     C                     MOVE 'Y'       WE023   1                       CPB001
     C                     MOVE 'W'       WRMSV                           CPB001
     C                     MOVE 'Y'       WWARN                           CPB001
     C                     MOVE '1'       *IN16                           CPB001
     C                     MOVEL'LEL0083' ZAMSID                          CPB001
     C                     EXSR ZASNMS                                    CPB001
     C                     MOVE 'E'       WRMSV                           CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
      *                                                                   CPB001
      ** Portfolio Entered but not PB or PM customer                      CPB001
      *                                                                   CPB001
     C           SPTFR     IFNE *BLANKS                                   CPB001
     C           WWCSPT    ANDNE'Y'                                       CPB001
     C                     MOVE '1'       *IN16                           CPB001
     C                     MOVEL'LEL0490' ZAMSID                          CPB001
     C                     EXSR ZASNMS                                    CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
      *
      ** VALIDATE ALTERNATE NAME AND ADDRESS
      *
     C           SNACD     IFEQ *BLANK
     C                     MOVE 'B'       SNACD
     C                     ENDIF
      *
     C           SNACD     IFNE 'B'
     C           *IN33     ANDEQ'0'
     C                     MOVELWSVCN     PCUST
     C                     MOVE SNACD     PADCD
     C                     CALL 'AOALTNR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PCUST
     C                     PARM           PADCD   1
     C           SDALTN    PARM SDALTN    DSSDY
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE BCADCD    SNACD
     C                     ENDIF
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SNACD
     C                     ENDIF
      *
     C           PRTCD     IFNE *BLANKS
     C           SNACD     OREQ 'A'
     C           *IN15     OREQ '0'
     C           WSVCN     ANDNEBCCUST
     C                     MOVE '1'       *IN15
     C                     MOVEL'LEL0168' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2030C040
      *
      ** VALIDATE A/C SEQUENCE NUMBER
      *
     C           SACSQ     IFEQ *BLANKS
     C           SACSQ     OREQ '00'
     C                     MOVE '01'      SACSQ
     C                     ELSE
     C                     MOVELSACSQ     WNUM3
     C                     MOVELWNUM3     WALF2
     C           SACSQ     IFNE WALF2
     C           WNUM3     OREQ *ZEROS
     C                     MOVE '1'       *IN14
     C                     MOVEL'LEL0137' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2030C041
      *
      ** VALIDATE FACILITY CURRENCY EXCHANGE RATE/INDICATOR  AND
      ** BASE CURRENCY EXCHANGE RATE/INDICATOR
      ** ... only when insert mode and facility and currency
      ** details are valid
      *
     C           SACTN     IFEQ 'I'
     C           *IN34     ANDEQ'0'
     C           *IN38     ANDEQ'0'
     C                     EXSR SREXCH
     C                     ENDIF
      *
      ** VALIDATE GUARANTEE RECEIVER
      *
     C           BPGIAV    IFEQ 'Y'
      *
      ** ... must be entered and valid for loan processing type 70
      *
     C           WLNPT     IFEQ 70
     C           WLNPT     OREQ 71                                        CLE005
     C           WLNPT     OREQ 72                                        CLE005
     C           W72TP     ANDEQ'70'                                      CLE005
     C           SRECE     IFEQ *BLANKS
     C/COPY WNCPYSRC,LEH00507
     C                     MOVE '1'       *IN09
     C                     MOVEL'LEL0016' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C/COPY WNCPYSRC,LEH00508
     C                     MOVE *BLANKS   PCUST
     C                     MOVELSRECE     PCUST
     C                     CALL 'AOCUSTR0'PPAR3
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN09
     C                     MOVEL'LEL0015' ZAMSID
     C                     EXSR ZASNMS
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SRECE
     C                     ENDIF
     C                     ELSE
     C                     MOVE *BLANKS   SRECE
     C                     MOVELBBCUST    SRECE
     C                     ENDIF
     C/COPY WNCPYSRC,LEH00509
     C                     ENDIF
      *
      ** ... must be blank for loan processing types other than 70
      *
     C                     ELSE
     C           SRECE     IFNE *BLANKS
     C                     MOVE '1'       *IN09
     C                     MOVEL'LEL0017' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** VALIDATE CUSTOMER CONFIRMATION
      *
     C           S01465    IFEQ 'Y'
      *
      ** ... must be numeric value existing in customer's file
      *
     C           SCOCU     IFNE *BLANKS
     C**********           MOVELSCOCU     WNUM7                                               CSD027
     C**********           MOVELWNUM7     WALF6                                               CSD027
     C                     MOVE *BLANKS   PCUST
     C                     MOVELSCOCU     PCUST
     C                     CALL 'AOCUSTR0'PPAR3
     C           PRTCD     IFNE *BLANKS
     C           PKYST     OREQ '*CSHT  '                                                     CSD027
     C                     MOVE '1'       *IN08
     C                     MOVEL'LEL0014' ZAMSID
     C                     EXSR ZASNMS
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SCOCU
     C                     ENDIF
     C                     ELSE
     C                     MOVE BBCUST    SCOCU
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** VALIDATE FUNDING DETAILS
      ** ... only if analytical accounting is being used
      ** or revenue analysis is installed                                 CDE002
      *
     C           BGN0ST    IFEQ 'Y'
     C           WFUNP     ANDEQ*BLANK
     C           CDE002    OREQ 'Y'                                       CDE002
     C           WFUNP     ANDEQ*BLANK                                    CDE002
      *
      ** ... If Funding Spread/Rate field has not been entered, sign
      ** and profit centre must be left blank
      *
     C                     Z-ADD0         WFSRP
     C           SFRSP     IFEQ *BLANKS
     C           SFSGN     IFNE *BLANKS
     C                     MOVE '1'       *IN87
     C                     MOVEL'LEL0012' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C           SFPRC     IFNE *BLANKS
     C                     MOVE '1'       *IN07
     C                     MOVEL'LEL0009' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     ELSE
      *
      ** Validate Funding Spread/Rate.
      *
     C                     MOVE *BLANKS   PSCRF
     C                     MOVE SFRSP     PSCRF
     C                     Z-ADD4         PNDIG
     C                     Z-ADD7         PNDEC
     C                     CALL 'ZALIGN'  PPAR1
     C                     MOVE PRVAL     WFSRP  117
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN86
     C                     MOVEL'LEL0010' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** Validate Funding Spread/Rate Sign
      *
     C           SFSGN     IFNE *BLANK
     C           SFSGN     ANDNE'+'
     C           SFSGN     ANDNE'-'
     C                     MOVE '1'       *IN87
     C                     MOVEL'LEL0011' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** ... If the Funding Spread/Rate and Sign are both valid,
      ** determine the actual funding rate.
      *
     C           *IN86     IFEQ '0'
     C           *IN87     ANDEQ'0'
     C           SFRSP     ANDNE*BLANKS
      *
     C                     SELEC
     C           SFSGN     WHEQ '+'
     C           WINTT     ADD  WFSRP     WAFSRP
     C           SFSGN     WHEQ '-'
     C           WINTT     SUB  WFSRP     WAFSRP
     C                     OTHER
     C                     Z-ADDWFSRP     WAFSRP 117
     C                     ENDSL
      *
      ** ... Compute the maximum and minimum allowable amount based on
      ** tolerance for Funding Rate.
      *
     C           BGN0ST    IFEQ 'Y'                                       CDE002
     C           FTTFRT    DIV  100       WTRATE  32
      *
     C           1         ADD  WTRATE    WMAXTL  42
     C           WINTT     MULT WMAXTL    WMAXRT 117H
      *
     C           1         SUB  WTRATE    WMINTL  42
     C           WINTT     MULT WMINTL    WMINRT 117
      *
      ** ... If the Actual Funding Rate is greater the the maximum or
      ** less than the minimum amount, display warning message
      *
     C           WAFSRP    IFGT WMAXRT
     C           WAFSRP    ORLT WMINRT
     C           WE010     IFEQ *BLANK
     C           WE010     OREQ 'Y'
     C           WAFSRP    ANDNEW1FR
     C                     Z-ADDWAFSRP    W1FR   117
     C                     MOVE 'Y'       WE010   1
     C                     MOVE 'W'       WRMSV
     C                     MOVE 'Y'       WWARN
     C                     MOVE '1'       *IN86
     C                     MOVEL'LEL0076' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'E'       WRMSV
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                          CDE002
      *
     C                     ENDIF
      *
      ** Validate Funding Profit Centre
      *
     C           SFPRC     IFNE *BLANKS
     C                     MOVE SFPRC     PPCCD
     C                     CALL 'AOPRFCR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY    'POPTN
     C                     PARM           PPCCD
     C           SDPRFC    PARM SDPRFC    DSFDY
     C           PRTCD     IFNE *BLANK
     C                     MOVE '1'       *IN07
     C                     MOVEL'LEL0002' ZAMSID
     C                     EXSR ZASNMS
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SFPRC
     C                     ENDIF
     C                     ELSE
      *
      ** ... Profit centre must allow direct funding
      *
     C                     MOVE DSPCCD    SFPRC
     C           DSDFPR    IFEQ 'N'
     C                     MOVE '1'       *IN07
     C                     MOVEL'LEL0008' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** ... If funding profit centre is blank and spread/rate is
      ** entered, default to value from booking profit centre
      *
     C           SFPRC     IFEQ *BLANKS
     C           SFRSP     ANDNE*BLANKS
     C           *IN86     ANDEQ'0'
     C           BGN0ST    ANDEQ'Y'                                       CDE002
      *
     C           SPRFC     IFEQ *BLANKS
     C                     MOVE '1'       *IN07
     C                     MOVEL'LEL0007' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      *
     C           *IN17     IFEQ '0'
     C           SCURR     IFEQ BJLCCY
     C                     MOVE WLFPC     SFPRC
     C                     ELSE
     C                     MOVE WFFPC     SFPRC
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                                       CAS001
      ** When CAS001 enhancement is installed, validate yield curve                           CAS001
      ** forward yield curve                                                                  CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
      *                                                                                       CAS001
      ** Access the loan type/subtype details                                                 CAS001
      *                                                                                       CAS001
     C                     MOVE SLTYP     PLNTY                                               CAS001
     C                     MOVE SSUTP     PLNST                                               CAS001
     C                     MOVE CLCLAS    PLNCL                                             BUG11642
     C/COPY WNCPYSRC,LE2030C121
     C                     CALL 'AOLOANR0'                                                    CAS001
     C                     PARM *BLANKS   PRTCD                                               CAS001
     C                     PARM '*KEY   ' POPTN                                               CAS001
     C                     PARM           PLNTY                                               CAS001
     C                     PARM           PLNST                                               CAS001
     C                     PARM           PLNCL                                             BUG11642
     C           SDLOAN    PARM SDLOAN    DSFDY                                               CAS001
      *                                                                                       CAS001
     C                     MOVE *OFF      *IN62                                               CAS001
     C                     MOVE *OFF      *IN64                                               CAS001
      *                                                                                       CAS001
      ** Yield Curve Validation                                                               CAS001
      *                                                                                       CAS001
     C           *IN41     IFEQ *OFF                                                          CAS001
      *                                                                                       CAS001
      ** If entered, check if valid Yield Curve                                               CAS001
      *                                                                                       CAS001
     C           #6YLDC    IFNE *BLANKS                                                       CAS001
      *                                                                                       CAS001
     C                     CALL 'AOYLDCR0'                                                    CAS001
     C                     PARM '*BLANKS' PRTCD                                               CAS001
     C                     PARM '*KEY   ' POPTN                                               CAS001
     C                     PARM #6YLDC    PPYLDC  5                                           CAS001
     C           SDYLDC    PARM SDYLDC    DSSDY                                               CAS001
      *                                                                                       CAS001
     C           PRTCD     IFEQ '*NRF   '                                                     CAS001
     C                     MOVE *ON       *IN62                                               CAS001
     C                     MOVEL'LEL0532' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ELSE                                                               CAS001
     C                     MOVELPPYLDC    #6YLDC                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** If no selection was made, default to the value of the Yield                          CAS001
      ** Curve for the loan type/subtype                                                      CAS001
      *                                                                                       CAS001
     C           #6YLDC    IFEQ *BLANKS                                                       CAS001
     C           PPYLDC    ANDEQ*BLANKS                                                       CAS001
      *                                                                                       CAS001
      ** Check if Yield Curve Mandatory flag is 'Y'.                                          CAS001
      ** Generate error if no default value set in loan                                       CAS001
      ** type/subtype file.                                                                   CAS001
      *                                                                                       CAS001
     C           AYYLDM    IFEQ 'Y'                                                           CAS001
     C           AYYLDC    ANDEQ*BLANKS                                                       CAS001
     C                     MOVE *ON       *IN62                                               CAS001
     C                     MOVEL'LEL0536' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     MOVE AYYLDC    #6YLDC                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Yield Curve is not entered                                                           CAS001
      *                                                                                       CAS001
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
      ** Check if Yield Curve Mandatory flag is 'Y'.                                          CAS001
      ** Generate error if no default value set in loan                                       CAS001
      ** type/subtype file.                                                                   CAS001
      *                                                                                       CAS001
     C           AYYLDM    IFEQ 'Y'                                                           CAS001
     C           AYYLDC    ANDEQ*BLANKS                                                       CAS001
     C                     MOVE *ON       *IN62                                               CAS001
     C                     MOVEL'LEL0536' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     MOVE AYYLDC    #6YLDC                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Forward Yield Curve Validation                                                       CAS001
      *                                                                                       CAS001
     C           *IN46     IFEQ *OFF                                                          CAS001
      *                                                                                       CAS001
      ** If entered, check if valid Yield Curve                                               CAS001
      *                                                                                       CAS001
     C           #6FYLD    IFNE *BLANKS                                                       CAS001
      *                                                                                       CAS001
     C                     CALL 'AOYLDCR0'                                                    CAS001
     C                     PARM '*BLANKS' PRTCD                                               CAS001
     C                     PARM '*KEY   ' POPTN                                               CAS001
     C                     PARM #6FYLD    PPYLDC                                              CAS001
     C           SDYLDC    PARM SDYLDC    DSSDY                                               CAS001
      *                                                                                       CAS001
      ** No record found                                                                      CAS001
     C           PRTCD     IFEQ '*NRF   '                                                     CAS001
     C                     MOVE *ON       *IN64                                               CAS001
     C                     MOVEL'LEL0535' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
      ** If no selection was made, default to the value of the Forward                        CAS001
      ** Yield Curve for the loan type/subtype                                                CAS001
      *                                                                                       CAS001
     C           PRTCD     IFEQ '*NOSEL '                                                     CAS001
      *                                                                                       CAS001
      ** Check if Yield Curve Mandatory flag is 'Y'.                                          CAS001
      ** Generate error if no default value set in loan                                       CAS001
      ** type/subtype file.                                                                   CAS001
      *                                                                                       CAS001
     C           AYYLDM    IFEQ 'Y'                                                           CAS001
     C           AYFYLD    ANDEQ*BLANKS                                                       CAS001
     C           CAS005    ANDNE'Y'                                                           CAS005
     C           AYFYCM    OREQ 'Y'                                                           CAS005
     C           AYFYLD    ANDEQ*BLANKS                                                       CAS005
     C           CAS005    ANDEQ'Y'                                                           CAS005
     C                     MOVE *ON       *IN64                                               CAS001
     C                     MOVEL'LEL0531' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     MOVE AYFYLD    #6FYLD                                              CAS001
      *                                                                                       CAS001
      ** Access yield curves file to get the details                                          CAS001
      *                                                                                       CAS001
     C           #6FYLD    IFNE *BLANK                                                        CAS001
     C           CAS005    ANDNE'Y'                                                           CAS005
     C                     CALL 'AOYLDCR0'                                                    CAS001
     C                     PARM '*BLANKS' PRTCD                                               CAS001
     C                     PARM '*KEY   ' POPTN                                               CAS001
     C                     PARM #6FYLD    PPYLDC                                              CAS001
     C           SDYLDC    PARM SDYLDC    DSSDY                                               CAS001
      *                                                                                       CAS001
      ** No record found                                                                      CAS001
      *                                                                                       CAS001
     C           PRTCD     IFEQ '*NRF   '                                                     CAS001
     C                     MOVE *ON       *IN64                                               CAS001
     C                     MOVEL'LEL0535' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     MOVELPPYLDC    #6FYLD                                              CAS001
      *                                                                                       CAS005
      ** If CAS005 is installed,must accept any curve type of any                             CAS005
      ** interpolation method for forward yield curve.  Hence, these                          CAS005
      ** validations are no longer needed.                                                    CAS005
      *                                                                                       CAS005
     C           CAS005    IFNE 'Y'                                                           CAS005
      *                                                                                       CAS001
      ** Error if Non Zero-coupon Yield Curve                                                 CAS001
      ** And Non Swap Rate Yield Curve.                                                       228390
      *                                                                                       CAS001
     C           FSYLDT    IFNE 'Z'                                                           CAS001
     C           FSYLDT    ANDNE'S'                                                           228390
     C                     MOVE *ON       *IN64                                               CAS001
     C                     MOVEL'LEL0533' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Error if Interpolation Method is neither 'Y' nor 'R'                                 CAS001
      *                                                                                       CAS001
     C           FSINTP    IFNE 'Y'                                                           CAS001
     C           FSINTP    ANDNE'R'                                                           CAS001
     C                     MOVE *ON       *IN64                                               CAS001
     C                     MOVEL'LEL0534' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Forward Yield Curve not entered                                                      CAS001
      *                                                                                       CAS001
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
      ** Check if Yield Curve Mandatory flag is 'Y'.                                          CAS001
      ** Generate error if no default value set in loan                                       CAS001
      ** type/subtype file.                                                                   CAS001
      *                                                                                       CAS001
     C           AYYLDM    IFEQ 'Y'                                                           CAS001
     C           AYFYLD    ANDEQ*BLANKS                                                       CAS001
     C           CAS005    ANDNE'Y'                                                           CAS005
     C           AYFYCM    OREQ 'Y'                                                           CAS005
     C           AYFYLD    ANDEQ*BLANKS                                                       CAS005
     C           CAS005    ANDEQ'Y'                                                           CAS005
     C                     MOVE *ON       *IN64                                               CAS001
     C                     MOVEL'LEL0531' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     MOVE AYFYLD    #6FYLD                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS005
      ** If CAS005 is installed.                                                              CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
      *                                                                                       CAS005
      ** Reval curve must have a value if the Forward curve is populated.                     CAS005
      *                                                                                       CAS005
     C           #6YLDC    IFEQ *BLANKS                                                       CAS005
     C           #6FYLD    ANDNE*BLANKS                                                       CAS005
     C                     MOVE *ON       *IN62                                               CAS005
     C                     MOVEL'LEL0566' ZAMSID                                              CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SREXCH  -  Validate facility currency and base currency       *
      *            exchange rates and indicators                      *
      * Called by: SRVAL4 - Validate fourth detail screen             *
      * Calls    : None                                               *
      *****************************************************************
     C           SREXCH    BEGSR
      *
      ** VALIDATE FACILITY CURRENCY EXCHAGE RATE/INDICATOR
      ** (for loans and parts purchased)
      *
     C           *IN22     IFEQ '0'
      *
      ** ... must be blank of loan and facility currencies are the same
      *
     C           SCURR     IFEQ FCCYF
     C           SFCXR     ANDNE*BLANKS
     C                     MOVE '1'       *IN13
     C                     MOVEL'LEL0282' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** Facility currency indicator
      ** ... must be blank if loan and facility currencies are the same
      ** ... must be entered if facility currency rate is entered,
      ** and likewise
      ** ... must be 'M' or 'D' if entered
      *
     C           SCURR     IFEQ FCCYF
     C           SFMIN     ANDNE*BLANKS
      *
     C           SFCXR     ORNE *BLANKS
     C           SFMIN     ANDEQ*BLANKS
     C           SFCXR     OREQ *BLANKS
     C           SFMIN     ANDNE*BLANKS
      *
     C           SFMIN     ORNE *BLANKS
     C           SFMIN     ANDNE'M'
     C           SFMIN     ANDNE'D'
     C                     MOVE '1'       *IN12
     C                     MOVEL'LEL0291' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... retrieve facility details for default/conversion
      *
     C                     MOVE FCCYF     PCURR
     C                     CALL 'AOCURRR0'PPAR5
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD16        DBASE            * DBERR 16 *
     C                     MOVELFCCYF     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** ... determine cross rate and mult/div indicator
      *
     C                     Z-ADDA6NBDP    WCDPF   10
     C***********WSVIN     IFEQ 'M'                                       123227
     C                     SELEC                                          147999
     C           FCCYF     WHNE BJCYCD                                    147999
     C           A6MDIN    IFEQ 'M'                                       123227
     C***********A6SPRT    ANDNE1                                  152176 147999
     C***********A6MDIN    OREQ 'D'                                152176 147999
     C***********A6SPRT    ANDNE1                                  152176 147999
     C                     MOVE 'D'       WMINX   1
     C                     ELSE
     C                     MOVE 'M'       WMINX
     C                     ENDIF
     C           A6MDIN    IFEQ 'M'
     C           WSVIN     ANDEQ'M'
     C***********A6SPRT    ANDNE1                                  152176 147999
     C           A6MDIN    OREQ 'D'
     C           WSVIN     ANDEQ'D'
     C***********A6SPRT    ANDNE1                                  152176 147999
     C           A6SPRT    DIV  WSVRT     WSPOT  138H
     C                     ELSE
     C           A6SPRT    MULT WSVRT     WSPOT     H
     C                     ENDIF
     C                     MOVE 'Y'       WFLAG                           147999
      *                                                                   152176
     C                     OTHER                                          147999
     C                     Z-ADDWSVRT     WSPOT                           147999
     C***********A6SPRT    IFEQ 1                                  152176 147999
     C***********WSVIN     ANDEQ'M'                                152176 147999
     C           WSVIN     IFEQ 'M'                                       147999
     C                     MOVE 'N'       WFLAG                           152176
     C                     MOVE 'M'       WMINX                           147999
     C                     ELSE                                           152176
     C                     MOVE 'Y'       WFLAG                           152176
     C                     MOVE 'D'       WMINX                           152176
     C                     ENDIF                                          152176
     C                     ENDSL                                          147999
      *
      ** ... default rate and indicator if rate is blank
      *
     C           *IN12     IFEQ '0'
     C           *IN13     ANDEQ'0'
      *
     C                     MOVE SFMIN     WFMIN   1
     C           SFCXR     IFEQ *BLANKS
     C                     Z-ADDWSPOT     WSVFX
     C                     MOVE WMINX     WFMIN
     C           SCURR     IFNE FCCYF
     C                     MOVE WMINX     SFMIN
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE WSPOT     ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SFCXR
     C                     ENDIF
      *
      ** .. otherwise, must be a valid rate
      *
     C                     ELSE
     C                     MOVE *BLANKS   PSCRF
     C                     MOVE SFCXR     PSCRF
     C                     Z-ADD8         PNDEC
     C                     Z-ADD5         PNDIG
     C                     CALL 'ZALIGN'  PPAR1
     C                     MOVE PRVAL     WSVFX  138
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN13
     C                     MOVEL'LEL0283' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      * Else, FCXR rate must be validated further:                                            199985
      *  If facility currency is an 'in' ccy & loan ccy is EUR,                               199985
     C           A6INCY    IFEQ 'Y'                                                           199985
     C           W#CCY     ANDEQBKEURO                                                        199985
      *...or if facility currency & loan ccy are 'in' currencies                              199985
     C           A6INCY    OREQ 'Y'                                                           199985
     C           WINFL     ANDEQ'Y'                                                           199985
      *...or if facility currency is EUR and loan ccy is 'in',                                199985
     C           FCCYF     OREQ BKEURO                                                        199985
     C           WINFL     ANDEQ'Y'                                                           199985
      ** Facility Ccy equivalent rate must be amount defaulted                                199985
     C           WSPOT     IFNE WSVFX                                                         199985
     C                     MOVE '1'       *IN13                                               199985
     C                     MOVEL'LEL0528' ZAMSID                                              199985
     C                     EXSR ZASNMS                                                        199985
     C                     ENDIF                                                              199985
      ** Else, currencies are not 'In' or EUR, so user can choose rate                        199985
     C                     ELSE                                                               199985
      *                                                                                     AR882700
      ** Send error message if Facility Currency Exchange Rate                              AR882700
      ** is equal to zero                                                                   AR882700
      *                                                                                     AR882700
     C           WSVFX     IFEQ *ZERO                                                       AR882700
     C                     MOVE '1'       *IN13                                             AR882700
     C                     MOVEL'LEL0814' ZAMSID                                            AR882700
     C                     EXSR ZASNMS                                                      AR882700
     C                     ELSE                                                             AR882700
      *
      ** ... warning message will be sent if rate is not within 25%
      ** of the rate calculated by the program
      *
     C           SFMIN     IFNE WMINX
     C           1         DIV  WSPOT     WSPOT     H
     C                     ENDIF
     C           WSPOT     MULT .75       WRATM  138H
     C           WSPOT     MULT 1.25      WRATP  138H
     C           WSVFX     IFLT WRATM
     C           WSVFX     ORGT WRATP
      *
     C           WE015     IFEQ *BLANK
     C           WE015     OREQ 'Y'
     C           WSVFX     ANDNEW1FX
     C                     Z-ADDWSVFX     W1FX   138
     C                     MOVE 'Y'       WE015   1
     C                     MOVE 'W'       WRMSV
     C                     MOVE 'Y'       WWARN
     C                     MOVE '1'       *IN13
     C                     MOVEL'LEL0079' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'E'       WRMSV
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF                                                            AR882700
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      ** Issue a warning message if loan amount will exceed the                               194864
      ** credit agreement facility amount                                                     194864
     C           TRCA      IFEQ 'TR'                                                          194864
      ** If found, validate if the loan amount will                                           194864
      ** make the Credit Agreement facility amount                                            194864
      ** to be exceeded.                                                                      194864
     C                     Z-ADD0         WTSUM  130                                          194864
     C                     Z-ADD1         S                                                   194864
     C           S         DOWLE10                                                            194864
     C           CRAKEY    CHAINLEFCLTLC             89                                       194864
      ** If loan ccy is equal to the Credit Agreement ccy,                                    194864
      ** add the loan amount to the outstanding drawn amount                                  194864
     C           SCURR     IFEQ FCCYB                                                         194864
     C           OAMC,S    ADD  WSVAM     WTSUM                                               194864
     C                     ELSE                                                               194864
      ** If Loan ccy is not equal to Credit Agreement                                         194864
      ** ccy, convert the Loan amount to Credit Agreeement                                    194864
      ** ccy equivalent.                                                                      194864
     C                     EXSR CONVCA                                                        194864
     C           OAMC,S    ADD  INCAMT    WTSUM                                               194864
     C                     ENDIF                                                              194864
      ** Validate the drawn amount against the Credit Agreement                               194864
      ** facility amount. Issue a warning message if CA has been                              194864
      ** exceeded.                                                                            194864
     C           RUNC,S    IFGE WSVVD                                                         194864
     C           WTSUM     ANDGTFAMTB                                                         194864
     C           WE513     IFEQ ' '                                                           194864
     C           WE513     OREQ 'Y'                                                           194864
     C           WSVAM     ANDNEWOSVAM                                                        194864
     C           WE513     OREQ 'Y'                                                           194864
     C           WSVVD     ANDNEWOSVVD                                                        194864
     C           WE513     OREQ 'Y'                                                           194864
     C           WSVFX     ANDNEWOSVFX                                                        194864
     C                     Z-ADDWSVAM     WOSVAM 130                                          194864
     C                     Z-ADDWSVVD     WOSVVD  50                                          194864
     C                     Z-ADDWSVFX     WOSVFX 138                                          194864
     C                     MOVE 'Y'       WE513   1                                           194864
     C                     MOVE 'W'       WRMSV                                               194864
     C                     MOVE 'Y'       WWARN                                               194864
     C                     MOVE '1'       *IN13                                               194864
     C                     MOVEL'LEL0520' ZAMSID                                              194864
     C                     EXSR ZASNMS                                                        194864
     C                     MOVE 'E'       WRMSV                                               194864
     C                     LEAVE                                                              194864
     C                     ENDIF                                                              194864
     C                     ENDIF                                                              194864
     C                     ADD  1         S                                                   194864
     C                     Z-ADD0         WTSUM                                               194864
     C                     ENDDO                                                              194864
     C                     ENDIF                                                              194864
     C                     ENDIF                                                              194864
     C                     ENDIF
      *
      ** VALIDATE BASE CURRENCY EQUIVALENT RATE/INDICATOR
      *
      ** ... must be blank if loan and base currencies are the same
      *
     C           SCURR     IFEQ BJCYCD
     C           SBCXR     ANDNE*BLANKS
     C                     MOVE '1'       *IN11
     C                     MOVEL'LEL0280' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** Base currency indicator
      ** ... must be blank if loan and base currencies are the same
      ** ... must be entered if base currency rate is entered,
      ** and likewise
      ** ... must be 'M' or 'D' if entered
      *
     C           SCURR     IFEQ BJCYCD
     C           SBMIN     ANDNE*BLANKS
      *
     C           *IN13     OREQ '0'
     C           SBCXR     ANDNE*BLANKS
     C           SBMIN     ANDEQ*BLANKS
     C           SBCXR     OREQ *BLANKS
     C           SBMIN     ANDNE*BLANKS
      *
     C           SBMIN     ORNE *BLANKS
     C           SBMIN     ANDNE'M'
     C           SBMIN     ANDNE'D'
     C                     MOVE '1'       *IN10
     C                     MOVEL'LEL0290' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** ... default rate and indicator if rate is blank
      *
     C                     MOVE SBMIN     WBMIN   1
     C           SBCXR     IFEQ *BLANKS
     C                     Z-ADDWSVRT     WSVBX
     C                     MOVE WSVIN     WBMIN
     C           SCURR     IFNE BJCYCD
     C                     MOVE WSVIN     SBMIN
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE WSVRT     ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SBCXR
     C                     ENDIF
      *
      ** ... otherwise, must be numeric
      *
     C                     ELSE
     C                     MOVE *BLANKS   PSCRF
     C                     MOVE SBCXR     PSCRF
     C                     Z-ADD8         PNDEC
     C                     Z-ADD5         PNDIG
     C                     CALL 'ZALIGN'  PPAR1
     C                     MOVE PRVAL     WSVBX  138
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN11
     C                     MOVEL'LEL0281' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      *
      ** ... warning message will be sent if rate is not within 25%
      ** of the rate calculated by the program
      *
     C           SBMIN     IFEQ WSVIN
     C                     Z-ADDWSVRT     WSPOT
     C                     ELSE
     C           1         DIV  WSVRT     WSPOT     H
     C                     ENDIF
     C           WSPOT     MULT .75       WRATM  138H
     C           WSPOT     MULT 1.25      WRATP  138H
      *
     C           WSVBX     IFLT WRATM
     C           WSVBX     ORGT WRATP
     C           WE006     IFEQ *BLANK
     C           WE006     OREQ 'Y'
     C           WSVBX     ANDNEW1BX
     C                     Z-ADDWSVBX     W1BX   138
     C                     MOVE 'Y'       WE006   1
     C                     MOVE 'W'       WRMSV
     C                     MOVE 'Y'       WWARN
     C                     MOVE '1'       *IN11
     C                     MOVEL'LEL0072' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'E'       WRMSV
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SR2410  -  Validate settlement details                        *
      * Called by: SRBTCH - Batch processing                          *
      * Calls    : SREXST - Format fields for extended settlement     *
      *            SRSETT - Save fields from settlement screen        *
      *            SREXVL - Extra validation after extended sett      *
      *****************************************************************
     C           SR2410    BEGSR
      *
      ** Set up fields on call to SD2410 for settlement validation
      *
     C                     EXSR SREXST
      *                                                                   CLE033
      * Settlement method 09 requires the branch code                     CLE033
      *                                                                   CLE033
     C           CLE033    IFEQ 'Y'                                       CLE033
     C           PMRSTM    ANDEQ09                                        CLE033
     C           CLE033    OREQ 'Y'                                       CLE033
     C           PMPSTM    ANDEQ09                                        CLE033
      *********************DO*NOTHING*                                    CLE033
     C                     ELSE                                           CLE033
      *
      ** Process settlement branch only if method 05 and multibranching
      *
     C           BGMBIN    IFEQ 'Y'
     C           PMRSTM    IFNE 05
     C           PMPRCV    IFEQ 'N'
     C           PMACTC    ORNE 'A'
     C                     MOVE *BLANKS   PMROBR
     C                     ENDIF
     C                     ENDIF
      *
     C           PMPSTM    IFNE 05
     C           PMPPAY    IFEQ 'N'
     C           PMACTC    ORNE 'A'
     C                     MOVE *BLANKS   PMPOBR
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF                                          CLE033
      *                                                                   CLE033
      ** Protect settle instructions if outside of backvalue period.
      ** This means that some fields will not be validated
      *
     C           PMRUND    SUB  PMBVPD    WSTART  50
     C           PMDTPY    IFLT WSTART
     C           PMDTPY    ANDNE0
     C                     MOVE 'Y'       PMPPAY
     C                     END
     C           PMDTRC    IFLT WSTART
     C           PMDTRC    ANDNE0
     C                     MOVE 'Y'       PMPRCV
     C                     END
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           SLNRF     IFEQ *BLANKS                                                       CLE034
     C********** SLNRF     OREQ *ZEROS                                                 CLE034 CLE148
     C                     MOVE 'Y'       WNOKEY  1                                           CLE034
     C                     ENDIF                                                              CLE034
      * If CLE038 is off, set up parameters for call to LE2230:                               CLE038
      * (If CLE038 is on, they are set up in SREXST)                                          CLE038
     C           CLE038    IFNE 'Y'                                                           CLE038
     C                     MOVE 'LOAN'    PLTYPE                                              CLE038
     C                     Z-ADD0         PALAMT                                              CLE038
     C                     MOVE *BLANKS   PORED                                               CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE034
     C                     CALL 'LE2230'                                                      CLE034
     C**********           PARM 'LOAN'    PLTYPE                                       CLE034 CLE038
     C                     PARM           PLTYPE  4                                           CLE038
     C                     PARM           SLNRF                                               CLE034
     C                     PARM *BLANKS   PLAVDT                                              CLE034
     C                     PARM *BLANKS   PLASEQ                                              CLE034
     C                     PARM *BLANKS   PCUSTF                                              CLE034
     C                     PARM *BLANKS   PFACIF                                              CLE034
     C                     PARM *BLANKS   PFEESQ                                              CLE034
     C                     PARM           SETLIB                                              CLE034
     C                     PARM           SETLIZ                                              CLE034
     C                     PARM           PMODE                                               CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM *BLANKS   PERROR                                              CLE034
     C                     PARM *BLANKS   PWARN                                               CLE034
     C                     PARM *BLANKS   PSTNOS                                              CLE034
     C                     PARM *BLANKS   PSEAMD                                              CLE034
     C                     PARM *BLANKS   PNODET                                              CLE034
     C                     PARM *BLANKS   PRSCUR                                              CLE034
     C                     PARM *BLANKS   PRSLOC                                              CLE034
     C                     PARM *BLANKS   PPSCUR                                              CLE034
     C                     PARM *BLANKS   PPSLOC                                              CLE034
     C                     PARM *BLANKS   PCRFL                                               CLE034
     C                     PARM           PORED   5                                           CLE038
     C                     PARM           PALAMT 130                                          CLE038
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *
      ** Call settlement validation program
      *
     C/COPY WNCPYSRC,LE2030C031
     C                     CALL 'SD2410'
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           @PARM3                                              222373
     C/COPY WNCPYSRC,LE2030C032
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *
      ** Terminate program if database error returned
      *
     C           PMDBSE    IFNE *ZERO
     C           *LOCK     IN   LDA
     C                     MOVELPMDBFL    DBFILE           ************
     C                     Z-ADDPMDBSE    DBASE            * DBERR XX *
     C                     MOVELPMDBKY    DBKEY            ************
     C                     MOVELPMDPGM    DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Settlement detail not in error, proceed with holiday checking
      *
     C           PMERCD    IFEQ *BLANKS
     C                     EXSR SRSETT
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C           SACTN     OREQ 'X'
     C           *IN38     IFEQ '0'
     C                     EXSR SRGLOC
     C                     EXSR SREXVL
     C                     ENDIF
     C                     ENDIF
      *
      ** Settlement detail in error
      *
     C                     ELSE
     C***********          MOVEL'LEL0025' ZAMSID                          123801
     C           3         SUBSTPMERCD:1  WSERR   3                       123801
     C                     MOVEL'ESM0'    ZAMSID                          123801
     C                     MOVE WSERR     ZAMSID                          123801
     C                     MOVEL'DRSMM   'ZAMSGF                          123801
     C                     EXSR ZASNMS
     C                     MOVEL'LERMSGF' ZAMSGF                          152323
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRBPEX  -  Format extended settlement fields for batch/play   *
      * Called by: SR2410 - Validate extended settlement              *
      * Calls    : None                                               *
      *****************************************************************
     C           SRBPEX    BEGSR
      *
      ** For batch mode
      *
     C           PMODE     IFEQ 'B'
     C                     MOVE PRSTM     PMRSTM
     C***********          MOVE PRONS     PMRONS                          CEU004
     C***********          MOVELPRONS     PMRONS                   CEU004 162648
      *                                                                                       257126
     C           PMRSTM    IFEQ 05                                                            257126
     C                     MOVE PRONS     PMRONS                          162648
     C                     ELSE                                                               257126
     C                     MOVELPRONS     PMRONS                                              257126
     C                     ENDIF                                                              257126
      *                                                                                       257126
     C                     MOVE PRIBN     PARIBN
     C                     MOVE PRIBA     PMRIBA
     C                     MOVE PROBN     PAROBN
     C                     MOVE PROCN     PAROCN
     C                     MOVE PPSTM     PMPSTM
     C***********          MOVE PPONS     PMPONS                          CEU004
     C***********          MOVELPPONS     PMPONS                   CEU004 162648
     C           PMPSTM    IFEQ 05                                                            257126
     C                     MOVE PPONS     PMPONS                          162648
     C                     ELSE                                                               257126
     C                     MOVELPPONS     PMPONS                                              257126
     C                     ENDIF                                                              257126
     C                     MOVE PPIBN     PAPIBN
     C                     MOVE PPIBA     PMPIBA
     C                     MOVE PPOBN     PAPOBN
     C                     MOVE PPOCN     PAPOCN
      *
     C                     MOVE PCVMR     PMCVMR
     C                     MOVE PRCRN     PARCRN
     C                     MOVE PRCRA     PMRCRA
     C                     MOVE PRVNO     PARVNO
     C                     MOVE PAWBN     PAAWBN
     C                     MOVE PAWBA     PMAWBA
     C                     MOVE PBENN     PABENN
     C                     MOVE PBENA     PMBENA
     C                     MOVE PDTP1     PMDTP1
     C                     MOVE PDTP2     PMDTP2
     C                     MOVE PDTP3     PMDTP3
     C                     MOVE PDTP4     PMDTP4
     C                     MOVE PDCHG     PMDCHG
     C                     MOVE PBTB1     PMBTB1
     C                     MOVE PBTB2     PMBTB2
     C                     MOVE PBTB3     PMBTB3
     C                     MOVE PBTB4     PMBTB4
     C                     MOVE PBTB5     PMBTB5
     C                     MOVE PBTB6     PMBTB6
      *                                                                   167146
      ** Get data directly from message format                            167146
      *                                                                   167146
     C************IN22     IFEQ '0'                                123227 167146
     C**********           MOVE POSDB     PMPOBR                                            AR548562
     C**********           MOVE POMDB     PMROBR                                            AR548562
     C***********          ELSE                                    123227 167146
     C***********          MOVE POSDB     PMROBR                   123227 167146
     C***********          MOVE POMDB     PMPOBR                   123227 167146
     C***********          ENDIF                                   123227 167146
      *
      ** Check if receipt settlement is protected                                           AR548562
      *                                                                                     AR548562
     C           PMPRCV    IFNE 'Y'                                                         AR548562
     C                     MOVE POMDB     PMROBR                                            AR548562
     C                     ENDIF                                                            AR548562
      *                                                                                     AR548562
      ** Check if payment settlement is protected                                           AR548562
      *                                                                                     AR548562
     C           PMPPAY    IFNE 'Y'                                                         AR548562
     C                     MOVE POSDB     PMPOBR                                            AR548562
     C                     ENDIF                                                            AR548562
      *                                                                                     AR548562
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE PSCCY     PMRSCY                          CEU004
     C                     MOVE PSCCY     PMPSCY                          CEU004
     C                     MOVE PICCY     PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
      ** If CLE031 is switched on..                                                           CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PSCCY     PMRSCY                                              CLE031
     C                     MOVE N1REXR    PMREXR                                              CLE031
     C           N1REXR    IFNE *BLANKS                                                       CLE031
     C                     MOVE *BLANKS   PSCRF                                               CLE031
     C                     MOVE N1REXR    PSCRF                                               CLE031
     C                     Z-ADD8         PNDEC                                               CLE031
     C                     Z-ADD5         PNDIG                                               CLE031
     C                     CALL 'ZALIGN'  PPAR1                                               CLE031
     C                     Z-ADD*ZEROS    WSEXR                                               CLE031
     C                     MOVELPRVAL     WSEXR                                               CLE031
     C           PRTCD     IFNE *BLANKS                                                       CLE031
     C           WSEXR     OREQ *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE N1REXI    PMREXI                                              CLE031
     C           N1REXI    IFEQ 'N'                                                           CLE031
     C                     MOVE *BLANKS   PMREXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE N1PSCY    PMPSCY                                              CLE031
     C                     MOVE N1PEXR    PMPEXR                                              CLE031
     C           N1PEXR    IFNE *BLANKS                                                       CLE031
     C                     MOVE *BLANKS   PSCRF                                               CLE031
     C                     MOVE N1PEXR    PSCRF                                               CLE031
     C                     Z-ADD8         PNDEC                                               CLE031
     C                     Z-ADD5         PNDIG                                               CLE031
     C                     CALL 'ZALIGN'  PPAR1                                               CLE031
     C                     Z-ADD*ZEROS    WSEXR                                               CLE031
     C                     MOVELPRVAL     WSEXR                                               CLE031
     C           PRTCD     IFNE *BLANKS                                                       CLE031
     C           WSEXR     OREQ *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE N1PEXI    PMPEXI                                              CLE031
     C           N1PEXI    IFEQ 'N'                                                           CLE031
     C                     MOVE *BLANKS   PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     EXSR SRSHNM
      *
      ** For play mode
      *
     C                     ELSE
     C                     MOVE RSTMH     PMRSTM
     C                     MOVE RONSH     PMRONS
     C                     MOVELRIBNH     PARIBN
     C                     MOVE RIBAH     PMRIBA
     C                     MOVELROBNH     PAROBN
     C                     MOVELROCNH     PAROCN
     C                     MOVELPSTMH     PMPSTM
     C                     MOVE PONSH     PMPONS
     C                     MOVELPIBNH     PAPIBN
     C                     MOVE PIBAH     PMPIBA
     C                     MOVELPOBNH     PAPOBN
     C                     MOVELPOCNH     PAPOCN
      *
     C                     MOVE CVMRH     PMCVMR
     C                     MOVELRCRNH     PARCRN
     C                     MOVE RCRAH     PMRCRA
     C                     MOVELRVNOH     PARVNO
     C                     MOVELAWBNH     PAAWBN
     C                     MOVE AWBAH     PMAWBA
     C                     MOVELBENNH     PABENN
     C                     MOVE BENAH     PMBENA
     C                     MOVE DTP1H     PMDTP1
     C                     MOVE DTP2H     PMDTP2
     C                     MOVE DTP3H     PMDTP3
     C                     MOVE DTP4H     PMDTP4
     C                     MOVE DCHGH     PMDCHG
     C                     MOVE BTB1H     PMBTB1
     C                     MOVE BTB2H     PMBTB2
     C                     MOVE BTB3H     PMBTB3
     C                     MOVE BTB4H     PMBTB4
     C                     MOVE BTB5H     PMBTB5
     C                     MOVE BTB6H     PMBTB6
     C           *IN22     IFEQ '0'                                       123227
     C                     MOVE OSDBH     PMPOBR
     C                     MOVE OMDBH     PMROBR
     C                     ELSE                                           123227
     C                     MOVE OSDBH     PMROBR                          123227
     C                     MOVE OMDBH     PMPOBR                          123227
     C                     ENDIF                                          123227
      *
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE SCCYH     PMRSCY                          CEU004
     C                     MOVE SCCYH     PMPSCY                          CEU004
     C                     MOVE ICCYH     PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
      ** If CLE031 is switched on..                                                           CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE SCCYH     PMRSCY                                              CLE031
     C                     MOVE REXRH     PMREXR                                              CLE031
     C                     MOVE REXIH     PMREXI                                              CLE031
     C                     MOVE PSCYH     PMPSCY                                              CLE031
     C                     MOVE PEXRH     PMPEXR                                              CLE031
     C                     MOVE PEXIH     PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     EXSR SRSHNM
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SREXVL  -  Extra validation after extended settlement         *
      * Called by: SRDLT4 - Process fourth detail screen - ext sett   *
      *            SR2410 - Validate settlement details on batch/play *
      * Calls    : SRGLOC - Get start and maturity date settlement    *
      *****************************************************************
     C           SREXVL    BEGSR
      *
      ** Validate next interest payment date
      *
     C           WWIND     IFNE 'D1'
     C                     MOVE 'E'       WRMSV
     C           SACTN     IFEQ 'I'                                       125557
     C           SIPFR     IFNE *BLANK
     C           SMDAT     ANDNE*BLANKS
     C           *IN44     ANDEQ'0'
      *
      ** ... If interest frequency is entered, next interest date
      ** calculated should be on or earlier than maturity date
      ** N.B. do not do this when frequency = "R"                         152618
      ** Do not calc/validate next frequency if this is a transfer.       152618
      *
     C           SNIDT     IFNE *BLANKS
     C           *IN51     ANDEQ'0'
     C           *IN52     ANDEQ'0'
     C           *IN53     ANDEQ'0'
     C           SIPFR     ANDNE'R'                                       152618
      *                                                                   152618
      ** and this is not a transfer.                                      152618
      *                                                                   152618
     C           PGNTF     IFNE 'Y'                                       152618
     C           PMODE     ANDNE'B'                                       152618
      *                                                                   152618
     C                     Z-ADDWSVID     ZDAYNO
     C                     MOVE SIPFR     ZFREQ
     C                     MOVE SCURR     ZCCY
     C                     MOVE SIFDY     ZMDAY
     C                     MOVE W@MDSL    ZLOC
     C                     EXSR ZFREQB
     C           ZDAYNO    IFGT WSVMD
     C                     MOVE '1'       *IN64
     C                     MOVEL'LEL0054' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                   152618
     C                     ENDIF                                          152618
      *                                                                   152618
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate next repayment date
      *
     C           SRFRQ     IFNE *BLANK
     C           SMDAT     ANDNE*BLANKS
     C           *IN44     ANDEQ'0'
      *
      ** ... If repayment frequency is entered, next repayment date
      ** calculated should be on or earlier than maturity date
      *
     C           SNRPD     IFNE *BLANKS
     C           *IN71     ANDEQ'0'
     C           *IN72     ANDEQ'0'
     C           *IN73     ANDEQ'0'
     C                     Z-ADDWSVRP     ZDAYNO
     C                     MOVE SRFRQ     ZFREQ
     C                     MOVE SCURR     ZCCY
     C                     MOVE SRDYN     ZMDAY
     C                     MOVE W@MDSL    ZLOC
     C                     EXSR ZFREQB
     C           ZDAYNO    IFGT WSVMD
     C                     MOVE '1'       *IN72
     C                     MOVEL'LEL0054' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                          125557
      *
     C                     ENDIF
      *
      ** Holiday validations if loan currency is valid
      ** Test loan currency holiday for settlements 01, 07 and 08
      ** Otherwise, test for local currency holidays
      *
     C           *IN38     IFEQ '0'
      *
      ** Test value date for holiday
      *
     C           *IN42     IFEQ '0'
     C           SVDAT     ANDNE*BLANKS
     C                     Z-ADDWSVVD     ZDAYNO
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           PTYP      IFEQ 66                                                            CLE034
     C           PTYP      OREQ 67                                                            CLE034
     C           PTYP      OREQ 69                                                            CLE034
     C           PTYP      OREQ 72                                                            CLE034
     C                     MOVEAPRSCUR    ACUR                                                CLE034
     C                     MOVEAPRSLOC    ALOC                                                CLE034
     C                     ELSE                                                               CLE034
     C                     MOVEAPPSCUR    ACUR                                                CLE034
     C                     MOVEAPPSLOC    ALOC                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE *ON       *IN97                                               CLE034
     C           ACUR,1    IFEQ *BLANKS                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE BJSLCD    ALOC,1                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *
     C           WSDST     IFEQ 1
     C           WSDST     OREQ 7
     C           WSDST     OREQ 8
     C                     MOVE '1'       *IN97
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           PMPSCY    ANDNE*BLANKS                                   CEU004
     C***********          MOVE PMPSCY    ZCCY                                         CEU004 CLE034
     C                     MOVE PMPSCY    ACUR,1                                              CLE034
     C                     ELSE                                           CEU004
     C***********          MOVE SCURR     ZCCY                                                CLE034
     C                     MOVE SCURR     ACUR,1                                              CLE034
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C***********          MOVE W@SDSL    ZLOC                                                CLE034
     C                     MOVE W@SDSL    ALOC,1                                              CLE034
     C                     ELSE
     C                     MOVE '0'       *IN97
     C***********          MOVE BJLCCY    ZCCY                                                CLE034
     C***********          MOVE BJSLCD    ZLOC                                                CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE BJSLCD    ALOC,1                                              CLE034
     C                     ENDIF
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD1         WX      20                                          CLE034
     C           WX        DOWLE20                                                            CLE034
     C                     MOVE ACUR,WX   ZCCY                                                CLE034
     C                     MOVE ALOC,WX   ZLOC                                                CLE034
      *                                                                                       CLE034
     C           ZCCY      IFNE *BLANKS                                                       CLE034
      *
     C                     EXSR ZCHKH
     C           ZIND      IFEQ 'H'
     C           WE012     IFEQ *BLANK
     C           WE012     OREQ 'Y'
     C           WSVVD     ANDNEW1VD
     C                     Z-ADDWSVVD     W1VD    50
     C                     MOVE 'Y'       WE012   1
     C                     MOVE '1'       *IN42
     C                     MOVE 'W'       WRMSV
     C                     MOVE 'Y'       WWARN
     C           *IN97     IFEQ '1'
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVEL'LEL0501' ZAMSID                          CEU004
     C                     ELSE                                           CEU004
     C                     MOVEL'LEL0067' ZAMSID
     C                     ENDIF                                          CEU004
     C                     ELSE
     C                     MOVEL'LEL0068' ZAMSID
     C                     ENDIF
     C                     EXSR ZASNMS
     C                     MOVE 'E'       WRMSV
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                                              CLE034
     C                     ADD  1         WX                                                  CLE034
     C                     ENDDO                                                              CLE034
     C                     ENDIF
      *
      ** Test maturity date for holiday
      *
     C           *IN44     IFEQ '0'
     C           SMDAT     ANDNE*BLANKS
     C                     Z-ADDWSVMD     ZDAYNO
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           PTYP      IFEQ 66                                                            CLE034
     C           PTYP      OREQ 67                                                            CLE034
     C           PTYP      OREQ 69                                                            CLE034
     C           PTYP      OREQ 72                                                            CLE034
     C                     MOVEAPPSCUR    ACUR                                                CLE034
     C                     MOVEAPPSLOC    ALOC                                                CLE034
     C                     ELSE                                                               CLE034
     C                     MOVEAPRSCUR    ACUR                                                CLE034
     C                     MOVEAPRSLOC    ALOC                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE *ON       *IN97                                               CLE034
     C           ACUR,1    IFEQ *BLANKS                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE BJSLCD    ALOC,1                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *
     C           WMDST     IFEQ 1
     C           WMDST     OREQ 7
     C           WMDST     OREQ 8
     C                     MOVE '1'       *IN97
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           PMPSCY    ANDNE*BLANKS                                   CEU004
     C***********          MOVE PMPSCY    ZCCY                                         CEU004 CLE034
     C                     MOVE PMPSCY    ACUR,1                                              CLE034
     C                     ELSE                                           CEU004
     C***********          MOVE SCURR     ZCCY                                                CLE034
     C                     MOVE SCURR     ACUR,1                                              CLE034
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C***********          MOVE W@MDSL    ZLOC                                                CLE034
     C                     MOVE W@SDSL    ALOC,1                                              CLE034
     C                     ELSE
     C                     MOVE '0'       *IN97
     C***********          MOVE BJLCCY    ZCCY                                                CLE034
     C***********          MOVE BJSLCD    ZLOC                                                CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE BJSLCD    ALOC,1                                              CLE034
     C                     ENDIF
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD1         WX                                                  CLE034
     C           WX        DOWLE20                                                            CLE034
     C                     MOVE ACUR,WX   ZCCY                                                CLE034
     C                     MOVE ALOC,WX   ZLOC                                                CLE034
      *                                                                                       CLE034
     C           ZCCY      IFNE *BLANKS                                                       CLE034
      *
     C                     EXSR ZCHKH
     C           ZIND      IFEQ 'H'
     C           WE045     IFEQ *BLANK
     C           WE045     OREQ 'Y'
     C           WSVMD     ANDNEW1MD
     C                     Z-ADDWSVMD     W1MD    50
     C                     MOVE 'Y'       WE045   1
     C                     MOVE '1'       *IN44
     C                     MOVE 'W'       WRMSV
     C                     MOVE 'Y'       WWARN
     C           *IN97     IFEQ '1'
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVEL'LEL0502' ZAMSID                          CEU004
     C                     ELSE                                           CEU004
     C                     MOVEL'LEL0070' ZAMSID
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C                     ELSE
     C                     MOVEL'LEL0071' ZAMSID
     C                     ENDIF
     C                     EXSR ZASNMS
     C                     MOVE 'E'       WRMSV
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                                              CLE034
     C                     ADD  1         WX                                                  CLE034
     C                     ENDDO                                                              CLE034
     C                     ENDIF
      *
      ** Test interest payment date for holiday
      *
     C           WWIND     IFNE 'D1'
      *
     C           *IN51     IFEQ '0'
     C           SNIDT     ANDNE*BLANKS
     C                     Z-ADDWSVID     ZDAYNO
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           PTYP      IFEQ 66                                                            CLE034
     C           PTYP      OREQ 67                                                            CLE034
     C           PTYP      OREQ 69                                                            CLE034
     C           PTYP      OREQ 72                                                            CLE034
     C                     MOVEAPPSCUR    ACUR                                                CLE034
     C                     MOVEAPPSLOC    ALOC                                                CLE034
     C                     ELSE                                                               CLE034
     C                     MOVEAPRSCUR    ACUR                                                CLE034
     C                     MOVEAPRSLOC    ALOC                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE *ON       *IN97                                               CLE034
     C           ACUR,1    IFEQ *BLANKS                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE BJSLCD    ALOC,1                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *
     C           WMDST     IFEQ 1
     C           WMDST     OREQ 7
     C           WMDST     OREQ 8
     C                     MOVE '1'       *IN97
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           PMPSCY    ANDNE*BLANKS                                   CEU004
     C***********          MOVE PMPSCY    ZCCY                                         CEU004 CLE034
     C                     MOVE PMPSCY    ACUR,1                                              CLE034
     C                     ELSE                                           CEU004
     C***********          MOVE SCURR     ZCCY                                                CLE034
     C                     MOVE SCURR     ACUR,1                                              CLE034
     C                     ENDIF                                          CEU004
     C***********          MOVE W@MDSL    ZLOC                                                CLE034
     C                     MOVE W@SDSL    ALOC,1                                              CLE034
     C                     ELSE
     C                     MOVE '0'       *IN97
     C***********          MOVE BJLCCY    ZCCY                                                CLE034
     C***********          MOVE BJSLCD    ZLOC                                                CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE BJSLCD    ALOC,1                                              CLE034
     C                     ENDIF
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD1         WX                                                  CLE034
     C           WX        DOWLE20                                                            CLE034
     C                     MOVE ACUR,WX   ZCCY                                                CLE034
     C                     MOVE ALOC,WX   ZLOC                                                CLE034
      *                                                                                       CLE034
     C           ZCCY      IFNE *BLANKS                                                       CLE034
      *
     C                     EXSR ZCHKH
     C           ZIND      IFEQ 'H'
     C           WE078     IFEQ *BLANK
     C           WE078     OREQ 'Y'
     C           WSVID     ANDNEW1ID
     C                     Z-ADDWSVID     W1ID    50
     C                     MOVE 'Y'       WE078   1
     C                     MOVE '1'       *IN51
     C                     MOVE 'W'       WRMSV
     C                     MOVE 'Y'       WWARN
     C           *IN97     IFEQ '1'
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVEL'LEL0499' ZAMSID                          CEU004
     C                     ELSE                                           CEU004
     C                     MOVEL'LEL0073' ZAMSID
     C                     ENDIF                                          CEU004
     C                     ELSE
     C                     MOVEL'LEL0074' ZAMSID
     C                     ENDIF
     C                     EXSR ZASNMS
     C                     MOVE 'E'       WRMSV
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                                              CLE034
     C                     ADD  1         WX                                                  CLE034
     C                     ENDDO                                                              CLE034
     C                     ENDIF
      *
      ** Test repayment date for holiday
      *
     C           *IN71     IFEQ '0'
     C           SNRPD     ANDNE*BLANKS
     C                     Z-ADDWSVRP     ZDAYNO
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           PTYP      IFEQ 66                                                            CLE034
     C           PTYP      OREQ 67                                                            CLE034
     C           PTYP      OREQ 69                                                            CLE034
     C           PTYP      OREQ 72                                                            CLE034
     C                     MOVEAPPSCUR    ACUR                                                CLE034
     C                     MOVEAPPSLOC    ALOC                                                CLE034
     C                     ELSE                                                               CLE034
     C                     MOVEAPRSCUR    ACUR                                                CLE034
     C                     MOVEAPRSLOC    ALOC                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE *ON       *IN97                                               CLE034
     C           ACUR,1    IFEQ *BLANKS                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE BJSLCD    ALOC,1                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *
     C           WMDST     IFEQ 1
     C           WMDST     OREQ 7
     C           WMDST     OREQ 8
     C                     MOVE '1'       *IN97
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           PMPSCY    ANDNE*BLANKS                                   CEU004
     C***********          MOVE PMPSCY    ZCCY                                         CEU004 CLE034
     C                     MOVE PMPSCY    ACUR,1                                              CLE034
     C                     ELSE                                           CEU004
     C***********          MOVE SCURR     ZCCY                                                CLE034
     C                     MOVE SCURR     ACUR,1                                              CLE034
     C                     ENDIF                                          CEU004
     C***********          MOVE W@MDSL    ZLOC                                                CLE034
     C                     MOVE W@SDSL    ALOC,1                                              CLE034
     C                     ELSE
     C                     MOVE '0'       *IN97
     C***********          MOVE BJLCCY    ZCCY                                                CLE034
     C***********          MOVE BJSLCD    ZLOC                                                CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE BJSLCD    ALOC,1                                              CLE034
     C                     ENDIF
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD1         WX                                                  CLE034
     C           WX        DOWLE20                                                            CLE034
     C                     MOVE ACUR,WX   ZCCY                                                CLE034
     C                     MOVE ALOC,WX   ZLOC                                                CLE034
      *                                                                                       CLE034
     C           ZCCY      IFNE *BLANKS                                                       CLE034
      *
     C                     EXSR ZCHKH
     C           ZIND      IFEQ 'H'
     C           WE034     IFEQ *BLANK
     C           WE034     OREQ 'Y'
     C           WSVRP     ANDNEW1RP
     C                     Z-ADDWSVRP     W1RP    50
     C                     MOVE 'Y'       WE034   1
     C                     MOVE '1'       *IN71
     C                     MOVE 'W'       WRMSV
     C                     MOVE 'Y'       WWARN
     C           *IN97     IFEQ '1'
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVEL'LEL0500' ZAMSID                          CEU004
     C                     ELSE                                           CEU004
     C                     MOVEL'LEL0077' ZAMSID
     C                     ENDIF                                          CEU004
     C                     ELSE
     C                     MOVEL'LEL0078' ZAMSID
     C                     ENDIF
     C                     EXSR ZASNMS
     C                     MOVE 'E'       WRMSV
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                                              CLE034
     C                     ADD  1         WX                                                  CLE034
     C                     ENDDO                                                              CLE034
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *
      ** Return to detail screen 2 if errors exist
      *
     C           WERRF     IFEQ 'Y'
     C           WWARN     OREQ 'Y'
     C                     MOVE 'D2'      WFMT
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSTRT  -  Validate initial screen                            *
      * Called by: Main routine                                       *
      * Calls    : SRCAUT - Check if user is authorised to the action *
      *            SRVREV - Validate review fields                    *
      *            SRINSC - Format screen fields from CLOAN file      *
      *            SRWARN - Display warning message if loan is synd.  *   159256
      *****************************************************************
     C           SRSTRT    BEGSR
      *
     C           WFINL     IFEQ *BLANK
     C           WERRF     ANDEQ*BLANK
     C                     EXSR CLEAR
     C                     ENDIF
     C           CLE002    IFEQ 'Y'
     C                     MOVE '1'       *IN34
     C                     ENDIF
     C                     MOVE 'N'       WAUTOA                                              204347
     C                     MOVE *BLANKS   WAUTOY                                              204347
     C                     MOVE *BLANK    WSFIL   1
     C                     MOVEA'0000'    *IN,30
     C                     CLEARLE2030F1
     C                     MOVE 'N'       SRAUT
     C                     MOVE 'E'       WRMSV
     C                     MOVE '0'       WINIT   1                                           208725
      *
      ** Display initial screen until F3 is pressed or subfile
      ** processing is requested
      *
     C                     WRITELE2030F0
     C           WFMT      DOUNE'F0'
     C                     WRITELE2030C1
     C                     EXFMTLE2030F1
      *
     C           *INKC     IFEQ '1'
     C                     MOVE *BLANKS   WFMT
     C                     LEAVE
     C                     ENDIF
      *
     C                     MOVEA'0000'    *IN,30
     C                     EXSR CLEAR
     C/COPY WNCPYSRC,LE2030C007
      *
      ** If entered, action codes must be I, E, A, X and R only
      *
     C           SACTN     IFNE *BLANK
     C           SACTN     ANDNE'I'
     C           SACTN     ANDNE'E'
     C           SACTN     ANDNE'A'
     C           SACTN     ANDNE'X'
     C           SACTN     ANDNE'R'
     C           SACTN     ANDNE'1'                                       123295
     C           SACTN     ANDNE'2'                                       123295
     C           SACTN     ANDNE'3'                                       123295
     C           SACTN     ANDNE'4'                                       123295
     C                     MOVE '1'       *IN30
     C                     MOVEL'LEL0021' ZAMSID
     C                     EXSR ZASNMS
     C                     ITER
     C                     ENDIF
      *
      ** If action code is blank, validate review fields
      ** If valid, proceed to subfile display
      *
     C           SACTN     IFEQ *BLANK
     C                     EXSR SRVREV
     C                     ENDIF
     C           WERRF     IFNE *BLANK
     C                     ITER
     C                     ENDIF
      *
      ** For insert, loan number must be left blank
      ** if system value is set to 'Y' to Auto-allocate loan numbers.                         207689
      *
     C           AUTOLN    IFEQ 'Y'                                                           207689
     C                     MOVE '1'       WINIT                                               211489
     C           SACTN     IFEQ 'I'
     C           SALON     ANDNE*BLANKS
     C/COPY WNCPYSRC,LE2030C035
     C                     MOVEA'11'      *IN,30
     C           CLE010    IFEQ 'Y'                                                           207689
     C                     MOVEL'LEL0401' ZAMSID
     C                     ELSE                                                               207689
     C                     MOVEL'LEL0541' ZAMSID                                              207689
     C                     ENDIF                                                              207689
     C                     EXSR ZASNMS
     C                     ITER
     C                     ENDIF
      *                                                                                       207689
      * Else, system value allows user to input a loan number manually                        207689
     C                     ELSE                                                               207689
     C           SACTN     IFEQ 'I'                                                           207689
     C           SALON     ANDNE*BLANKS                                                       207689
      *                                                                                       207689
      * Check that loan number is between 000001 and 999998 inclusive                         207689
      *                                                                                       207689
     C           WALLOW    IFEQ 'Y'                                                           CLE148
      *                                                                                       CLE148
     C                     MOVEL'LELOAN'  WCHR10                                              CLE148
     C                     MOVE 'ISO '    WCHR10                                              CLE148
     C                     CALL WCHR10                                                        CLE148
     C                     PARM SALON     PLNRF                                               CLE148
     C                     PARM *BLANKS   PVALID                                              CLE148
     C                     PARM *BLANK    PCHKD                                               CLE148
     C                     PARM *BLANKS   PDATA                                               CLE148
      *                                                                                       CLE148
     C           PVALID    IFNE *BLANKS                                                       CLE148
     C                     MOVEA'11'      *IN,30                                              CLE148
     C                     MOVEL'LEL0822' ZAMSID                                              CLE148
     C                     MOVELPDATA     ZAMSDA                                              CLE148
     C                     EXSR ZASNMS                                                        CLE148
     C                     ITER                                                               CLE148
     C                     ENDIF                                                              CLE148
      *                                                                                    AR1021136
     C           PVALID    IFEQ *BLANKS                                                    AR1021136
     C           SALON     IFEQ '000000'                                                   AR1021136
     C           SALON     OREQ '999999'                                                   AR1021136
     C                     MOVEA'11'      *IN,30                                           AR1021136
     C                     MOVEL'5045916' ZAMSID                                           AR1021136
     C                     EXSR ZASNMS                                                     AR1021136
     C                     ITER                                                            AR1021136
     C                     ENDIF                                                           AR1021136
     C                     ENDIF                                                           AR1021136
      *                                                                                       CLE148
     C                     ELSE                                                               CLE148
      *                                                                                       CLE148
     C                     MOVELSALON     WNUM7                                               207689
     C                     MOVELWNUM7     WALF6                                               207689
     C           SALON     IFNE WALF6                                                         207689
     C           SALON     OREQ '      '                                                      207689
     C           SALON     OREQ '000000'                                                      207689
     C           SALON     ORGE '999999'                                                      207689
     C                     MOVEA'11'      *IN,30                                              207689
     C                     MOVEL'LEL0540' ZAMSID                                              207689
     C                     EXSR ZASNMS                                                        207689
     C                     ITER                                                               207689
     C                     ENDIF                                                              207689
      *                                                                                       CLE148
     C                     ENDIF                                                              CLE148
      *                                                                                       207689
      * Check that loan number has not already been used.                                     207689
      * First check for existence in live loans file:                                         207689
      *                                                                                       207689
     C                     MOVE SALON     WALON                                               207689
     C                     MOVE 'A'       WEPAR                                               207689
     C           WKLON     CHAINCLOAN               N89                                       207689
     C           *IN89     IFEQ '0'                                                           207689
     C                     MOVE '1'       *IN,31                                              207689
     C                     MOVEL'LEL0539' ZAMSID                                              207689
     C                     EXSR ZASNMS                                                        207689
     C                     ITER                                                               207689
     C                     ENDIF                                                              207689
      *                                                                                       207689
      * Then check for existence in matured loan file:                                        207689
      *                                                                                       207689
     C**********           MOVE SALON     MLLNRF  60                                   207689 CLE148
     C                     MOVE SALON     MLLNRF  6                                           CLE148
     C                     MOVE 'A'       MLRCDT  1                                           207689
     C           MLKEY     CHAINMLOAN               N89                                       207689
     C           *IN89     IFEQ '0'                                                           207689
     C                     MOVE '1'       *IN,31                                              207689
     C                     MOVEL'LEL0539' ZAMSID                                              207689
     C                     EXSR ZASNMS                                                        207689
     C                     ITER                                                               207689
     C                     ENDIF                                                              207689
      *                                                                                       207689
      * If the loan reference field is valid, continue processing:                            207689
      *                                                                                       207689
     C           *IN30     IFEQ '0'                                                           207689
     C           *IN31     ANDEQ'0'                                                           207689
     C                     MOVE SALON     SLNRF                                               207689
     C                     MOVE '1'       WINIT                                               208725
     C                     ENDIF                                                              207689
      *                                                                                       207689
     C                     ENDIF                                                              207689
     C                     ENDIF                                                              207689
     C/COPY WNCPYSRC,LE2030C036
      *
      ** For amend, enquire, authorise and reverse, loan must exist
      ** as live
      *
     C           SACTN     IFEQ 'A'
     C           SACTN     OREQ 'E'
     C           SACTN     OREQ 'X'
     C           SACTN     OREQ 'R'
     C           SACTN     ORGE '1'                                       123295
     C           SACTN     ANDLE'4'                                       123295
      *
     C           WALLOW    IFEQ 'Y'                                                           CLE148
     C                     MOVEL'LELOAN'  WCHR10 10                                           CLE148
     C                     MOVE 'ISO '    WCHR10                                              CLE148
     C                     CALL WCHR10                                                        CLE148
     C                     PARM SALON     PLNRF   6                                           CLE148
     C                     PARM *BLANKS   PVALID  6                                           CLE148
     C                     PARM *BLANK    PCHKD   1                                           CLE148
     C                     PARM *BLANKS   PDATA   2                                           CLE148
     C                     ELSE                                                               CLE148
     C                     MOVELSALON     WNUM7
     C                     MOVELWNUM7     WALF6
     C                     ENDIF                                                              CLE148
      *                                                                                       CLE148
     C           SALON     IFEQ *BLANK
     C           SALON     ORNE WALF6
     C           WALLOW    ANDEQ'N'                                                           CLE148
     C           PVALID    ORNE *BLANKS                                                       CLE148
     C           WALLOW    ANDEQ'Y'                                                           CLE148
     C                     MOVE '1'       *IN31
     C**********           MOVEL'LEL0022' ZAMSID                                              CLE148
     C           WALLOW    IFEQ 'N'                                                           CLE148
     C                     MOVEL'LEL0824' ZAMSID                                              CLE148
     C                     ELSE                                                               CLE148
     C                     MOVEL'LEL0822' ZAMSID                                              CLE148
     C                     MOVELPDATA     ZAMSDA                                              CLE148
     C                     ENDIF                                                              CLE148
     C                     EXSR ZASNMS
     C                     ELSE
      *
     C                     MOVE 'A'       WEPAR
     C                     MOVE SALON     WALON
     C           WKLON     CHAINCLOAN               N89
     C                     MOVE *IN89     WIN89   1
     C                     MOVE RECI      WRECI   1
     C                     MOVE 'B'       WEPAR
     C           WKLON     CHAINCLOAN               N89
     C           *IN89     IFEQ '1'
     C           WIN89     OREQ '1'
     C                     MOVEA'11'      *IN,30
     C                     MOVEL'LEL0024' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                                    AR1021136
      ** Do not allow amendment for loan with reference '000000'                           AR1021136
      *                                                                                    AR1021136
     C                     MOVE 'N'       INVLON  1                                        AR1021136
     C           *IN89     IFEQ '0'                                                        AR1021136
     C           WIN89     ANDEQ'0'                                                        AR1021136
     C           WALON     ANDEQ'000000'                                                   AR1021136
     C           SACTN     ANDEQ'A'                                                        AR1021136
     C           RECI      ANDNE'R'                                                        AR1021136
     C           WRECI     ANDNE'R'                                                        AR1021136
     C                     MOVE 'Y'       INVLON                                           AR1021136
     C                     MOVE '1'       *IN31                                            AR1021136
     C                     MOVEL'5045917' ZAMSID                                           AR1021136
     C                     EXSR ZASNMS                                                     AR1021136
     C                     ENDIF                                                           AR1021136
      *                                                                                    AR1021136
     C/COPY WNCPYSRC,LE2030C139
      *                                                                                       CLE028
      ** For flat rate personal loans, if Amend protect fields                                CLE028
      ** on screen 1 and 2                                                                    CLE028
      *
      ** Inform user if loan is matured or reversed
      *
     C           *IN89     IFEQ '0'
     C           RECI      ANDNE'D'
     C           SACTN     ANDNE'E'
     C           SACTN     ANDNE'1'                                       123295
     C           SACTN     ANDNE'2'                                       123295
     C           SACTN     ANDNE'3'                                       123295
     C           SACTN     ANDNE'4'                                       123295
     C           INVLON    ANDNE'Y'                                                        AR1021136
     C           WIN89     OREQ '0'
     C           WRECI     ANDNE'D'
     C           SACTN     ANDNE'E'
     C           SACTN     ANDNE'1'                                       123295
     C           SACTN     ANDNE'2'                                       123295
     C           SACTN     ANDNE'3'                                       123295
     C           SACTN     ANDNE'4'                                       123295
     C           INVLON    ANDNE'Y'                                                        AR1021136
      *
     C           WRECI     IFEQ 'R'
     C           RECI      OREQ 'R'
     C                     MOVEA'11'      *IN,30
     C                     MOVEL'LEL0040' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C           WRECI     IFEQ 'M'
     C           RECI      OREQ 'M'
      *                                                                   131253
     C           RATF      IFNE 'Y'                                       131253
     C           CLE005    ORNE 'Y'                                       131253
     C                     MOVEA'11'      *IN,30
     C                     MOVEL'LEL0041' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF                                          131253
      *                                                                   131253
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
     C           WERRF     IFNE *BLANK
     C                     ITER
     C                     ENDIF
      *                                                                   132558
      * If a loan has been created by P.T. only allow user to enquire     132558
      * on loan if the run date equals orig entry date. Authorisation     132558
      * should be from the Principal Transfer screen not through loans    132558
      * input.                                                            132558
      *                                                                   132558
     C***********SACTN     IFNE 'E'                                132558 140825
     C***********SACTN     ANDNE'I'                                132558 140825
     C***********SACTN     ANDNE*BLANKS                            132558 140825
      *                                                                   132558
     C***********GPRT      IFEQ 'Y'                                132558 140825
     C***********ORED      ANDEQBJRDNB                             132558 140825
     C***********          MOVE '1'       *IN30                    132558 140825
     C***********          MOVEL'LEL0424' ZAMSID                   132558 140825
     C***********          EXSR ZASNMS                             132558 140825
     C***********          ENDIF                                   132558 140825
      *                                                                   132558
     C***********          ENDIF                                   132558 140825
      *
      ** Check if action code is valid
      *
     C           SACTN     IFNE *BLANK
     C                     EXSR SRCAUT
     C                     ENDIF
     C           WERRF     IFNE *BLANK
     C                     ITER
     C                     ENDIF
      *
      ** Processing type of loan must be valid for the menu accessed
      *
     C           SACTN     IFNE 'I'
     C           SACTN     ANDNE*BLANK
     C                     SELEC
      *
     C           PTYPE     WHEQ 'LOAN'
     C           PTYP      ANDNE61
     C           PTYP      ANDNE62
     C           PTYP      ANDNE63
     C           PTYP      ANDNE70
     C           CLE028    ANDEQ'N'                                                           CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           PTYPE     ANDEQ'LOAN'                                                        CLE028
     C           PTYP      ANDNE61                                                            CLE028
     C           PTYP      ANDNE62                                                            CLE028
     C           PTYP      ANDNE63                                                            CLE028
     C           PTYP      ANDNE70                                                            CLE028
     C           PTYP      ANDNE80                                                            CLE028
     C                     MOVEA'11'      *IN,30
     C                     MOVEL'LEL0161' ZAMSID
     C                     EXSR ZASNMS
      *
      ** For parts purchased, valid are 64, 65;  Moreover if CLE005       CLE005
      ** is installed, 68 and 71 are also valid                           CLE005
      *                                                                   CLE005
     C           PTYPE     WHEQ 'PTPU'
     C           PTYP      ANDNE64
     C           PTYP      ANDNE65
     C           PTYP      ANDNE68                                        CLE005
     C           PTYP      ANDNE71                                        CLE005
     C           PTYPE     OREQ 'PTPU'                                    CLE005
     C           PTYP      ANDEQ68                                        CLE005
     C           CLE005    ANDEQ'N'                                       CLE005
     C           PTYPE     OREQ 'PTPU'                                    CLE005
     C           PTYP      ANDEQ71                                        CLE005
     C           CLE005    ANDEQ'N'                                       CLE005
     C                     MOVEA'11'      *IN,30
     C                     MOVEL'LEL0161' ZAMSID
     C                     EXSR ZASNMS
      *
      ** For parts sold, valid are 66, 67;  Moreover if CLE005            CLE005
      ** is installed, 69 and 72 are also valid                           CLE005
      *                                                                   CLE005
     C           PTYPE     WHEQ 'PTSO'
     C           PTYP      ANDNE66
     C           PTYP      ANDNE67
     C           PTYP      ANDNE69                                        CLE005
     C           PTYP      ANDNE72                                        CLE005
     C           PTYPE     OREQ 'PTSO'                                    CLE005
     C           PTYP      ANDEQ69                                        CLE005
     C           CLE005    ANDEQ'N'                                       CLE005
     C           PTYPE     OREQ 'PTSO'                                    CLE005
     C           PTYP      ANDEQ72                                        CLE005
     C           CLE005    ANDEQ'N'                                       CLE005
     C                     MOVEA'11'      *IN,30
     C                     MOVEL'LEL0161' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDSL
     C                     ENDIF
     C           WERRF     IFNE *BLANK
     C                     ITER
     C                     ENDIF
      *
      ** Check authorisation and reversal requests
      *
     C                     SELEC
     C           SACTN     WHEQ 'X'
     C                     EXSR SRAUTH
     C           SACTN     WHEQ 'R'
     C                     MOVELCURREF    MAINRF
     C                     EXSR SRREVR
     C                     MOVELMAINRF    CURREF
     C                     ENDSL
     C           WERRF     IFNE *BLANK
     C                     ITER
     C                     ENDIF
      *                                                                   159256
      ** Issue warning if changing a syndicated transaction.              159256
      *                                                                   159256
     C           PMODE     IFEQ 'I'                                       159256
     C           SACTN     ANDNE'I'                                       159256
     C           SACTN     ANDNE'E'                                       159256
     C           SACTN     ANDNE*BLANK                                    159256
     C                     EXSR SRWARN                                    159256
     C           WE232     IFNE *BLANK                                    159256
     C                     ITER                                           159256
     C                     ENDIF                                          159256
     C                     ENDIF                                          159256
      *
      ** Prepare detail screen for display
      *
     C           SACTN     IFNE *BLANK
     C                     MOVE 'F0'      WWRTRN
     C                     EXSR SRINSC
     C                     ELSE
     C                     MOVE 'S0'      WFMT
     C                     ENDIF
      *                                                                   125557
     C                     MOVE 'N'       W#F8    1                       125557
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSFIL  -  Subfile processing                                 *
      * Called by: Main processing                                    *
      * Calls    : SRLOAD - Load subfile records                      *
      *            SRVREV - Validate review fields                    *
      *            SRVSUB - Validate subfile entries                  *
      *            SRINSC - Format screen fields from CLOAN file      *
      *            SRSPRO - Process each subfile request              *
      *****************************************************************
     C           SRSFIL    BEGSR
      *
     C                     MOVE '0'       *IN86
     C                     MOVE '0'       *IN88
     C                     MOVE '0'       *IN33
     C                     MOVE 'N'       W#F8                            125557
     C                     MOVE '0'       WSFILE                                              208725
      *
      ** Determine whether authorised action is to be displayed
      *
     C                     SELEC
     C           *IN21     WHEQ '1'
     C           BPPPAU    IFEQ 'Y'
     C           CLE002    ANDEQ'Y'                                       155610
     C                     MOVE '1'       *IN35
     C                     ENDIF
     C           *IN22     WHEQ '1'
     C           BPPSAU    IFEQ 'Y'
     C           CLE002    ANDEQ'Y'                                       155610
     C                     MOVE '1'       *IN35
     C                     ENDIF
     C                     OTHER
     C           BPLOAU    IFEQ 'Y'
     C           CLE002    ANDEQ'Y'                                       155610
     C                     MOVE '1'       *IN35
     C                     ENDIF
     C                     ENDSL
     C           CLE002    IFEQ 'Y'
     C                     MOVE '1'       *IN34
     C                     ENDIF
      *
      ** Load subfile records, then display screen
      *
     C                     EXSR SRLOAD
     C                     WRITELE2030F0
     C                     WRITELE2030F2
      *
     C           WFMT      DOUNE'S0'
     C                     WRITELE2030C1
     C                     EXFMTLE2030C0
     C                     MOVEA'00'      *IN,32
     C                     SELEC
      *
      ** ... F3 is pressed, end processing
      *
     C           *INKC     WHEQ '1'
     C                     MOVE *BLANK    WFMT
      *
      ** ... F12 is pressed, return to initial screen
      *
     C           *INKL     WHEQ '1'
     C           PMODE     IFNE 'F'                                       CAP053
     C                     MOVE 'F0'      WFMT
     C                     EXSR CLEAR
     C                     ENDIF                                          CAP053
      *
      ** ... F9 is pressed, process insert request
      *
     C           *INKI     WHEQ '1'
     C           PMODE     IFNE 'F'                                       CAP053
     C                     MOVE '1'       WSFILE  1                                           208725
     C                     MOVE 'Y'       WSFIL
     C                     MOVE 'S0'      WWRTRN
     C                     MOVE 'I'       SACTN
     C                     EXSR SRINSC
     C                     ENDIF                                          CAP053
      *
      ** ... F5 is pressed, re-display screen with refreshed details
      ** ... when selection (review from) is changed, re-select
      ** records for display
      *
     C           *INKE     WHEQ '1'
     C           SRLON     ORNE WSLON
     C           SRAUT     ORNE WSAUT
      *
     C                     EXSR CLEAR
     C           SRAUT     IFEQ *BLANK
     C                     MOVE WSAUT     SRAUT
     C                     ENDIF
     C                     EXSR SRVREV
     C           WERRF     IFEQ *BLANK
     C                     MOVE '0'       *IN88
     C                     EXSR SRLOAD
     C                     ENDIF
      *
      ** ... Rollup key is pressed, load next page of records
      *
     C           *IN88     WHEQ '1'
     C                     EXSR SRLOAD
      *
      ** ... ENTER key is pressed, validate and process subfile entries
      *
     C                     OTHER
     C           *IN93     IFEQ '0'
     C                     EXSR SRVSUB
     C           WERRF     IFEQ *BLANK
     C                     MOVE 'S0'      WWRTRN                          125557
     C                     EXSR SRSPRO
     C                     ENDIF
     C                     ENDIF
     C                     ENDSL
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRVREV  -  Validate review from entries                       *
      * Called by: SRSTRT - Validate initial screen                   *
      *            SRSFIL - Subfile processing                        *
      * Calls    : None                                               *
      *****************************************************************
     C           SRVREV    BEGSR
      *
      ** Requiring authorisation must be Y or N
      *
     C           SRAUT     IFNE 'Y'
     C           SRAUT     ANDNE'N'
     C           PMODE     ANDNE'F'                                       CAP053
     C                     MOVE '1'       *IN32
     C                     MOVEL'LEL0020' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** Loan number must be numeric
      *
     C           SRLON     IFNE *BLANKS
     C                     MOVELSRLON     WNUM7
     C                     MOVELWNUM7     WALF6
     C           SRLON     IFNE WALF6
     C                     MOVE '1'       *IN33
     C                     MOVEL'LEL0038' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRVSUB  -  Validate subfile entries                           *
      * Called by: SRSFIL - Subfile processing                        *
      * Calls    : SRCAUT - Check user authority                      *
      *          : SRAUTH - Validate authorisation action             *
      *          : SRREVR - Validate reverse action                   *
      *****************************************************************
     C           SRVSUB    BEGSR
      *
     C                     EXSR CLEAR
     C                     MOVE 'Y'       WFRST   1
     C                     MOVE 'E'       WRMSV
     C                     READCLE2030S0                 87
     C           *IN87     DOWEQ'0'
     C                     MOVE '0'       *IN94
     C                     MOVE '0'       *IN30
     C/COPY WNCPYSRC,LE2030C008
      *
      ** Valid action codes are 'E','A','X' and 'R' only
      ** For repair (Mode = F) they are U and Q.                          CAP053
      *
     C           SLSEL     IFNE *BLANKS
     C           SLSEL     ANDNE'E'
     C           SLSEL     ANDNE'A'
     C           SLSEL     ANDNE'X'
     C           SLSEL     ANDNE'R'
     C           SLSEL     ANDNE'1'                                       123295
     C           SLSEL     ANDNE'2'                                       123295
     C           SLSEL     ANDNE'3'                                       123295
     C           SLSEL     ANDNE'4'                                       123295
     C           PMODE     ANDNE'F'                                       CAP053
     C           SLSEL     ORNE 'U'                                       CAP053
     C           SLSEL     ANDNE'Q'                                       CAP053
     C           SLSEL     ANDNE*BLANKS                                   202537
     C           PMODE     ANDEQ'F'                                       CAP053
     C           WFRST     IFEQ 'Y'
     C                     Z-ADDSRRN      SRNBR
     C                     MOVE *BLANK    WFRST
     C                     ENDIF
     C                     MOVE '1'       *IN94
     C                     MOVE '1'       *IN,30
     C           PMODE     IFEQ 'F'                                       CAP053
     C                     MOVEL'LEA1044' ZAMSID                          CAP053
     C                     ELSE                                           CAP053
     C                     MOVEL'LEL0013' ZAMSID
     C                     ENDIF                                          CAP053
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                   132558
      * If a loan has been created by P.T. only allow user to enquire     132558
      * on loan if the run date equals orig entry date. Authorisation     132558
      * should be from the Principal Transfer screen not through loans    132558
      * input.                                                            132558
      *                                                                   132558
     C***********SLSEL     IFNE 'E'                                132558 140825
     C***********SLSEL     ANDNE*BLANKS                            132558 140825
      *                                                                   132558
     C***********H#GPRT    IFEQ 'Y'                                132558 140825
     C***********H#ORED    ANDEQBJRDNB                             132558 140825
     C***********          MOVE '1'       *IN94                    132558 140825
     C***********          MOVE '1'       *IN30                    132558 140825
     C***********          MOVEL'LEL0424' ZAMSID                   132558 140825
     C***********          EXSR ZASNMS                             132558 140825
     C***********          ENDIF                                   132558 140825
      *                                                                   132558
     C***********          ENDIF                                   132558 140825
      *
      ** Check user authority to the action code.  Also validate
      ** authorisation and reversal requests
      *
     C           SLSEL     IFNE *BLANK
     C           WERRF     IFEQ *BLANK
      *                                                                   CAP053
     C           SLSEL     IFEQ 'Q'                                       CAP053
     C                     EXSR INVLTM                                    CAP053
     C                     ENDIF                                          CAP053
      *                                                                   CAP053
     C           PMODE     IFEQ 'F'                                       CAP053
     C                     MOVELSSTAT     SACTN                           CAP053
     C                     ELSE                                           CAP053
     C                     MOVE SLSEL     SACTN
     C                     END                                            CAP053
     C                     MOVE SSBRC     BRCA
     C                     MOVE SSORB     ORBR                            CAP053
     C                     EXSR SRCAUT
     C                     Z-ADDSNOPS     NOPS
     C                     MOVE SIUSR     IUSR
     C                     MOVE SAUSR     AUSR
     C                     MOVE SINDS     LSTS
     C                     MOVE SLOAN     LNRF
     C                     MOVE SCNUM     CNUM
     C           SACTN     CASEQ'X'       SRAUTH                          CAP053
     C           SACTN     CASEQ'R'       SRREVR                          CAP053
     C***********SLSEL     CASEQ'X'       SRAUTH                          CAP053
     C***********SLSEL     CASEQ'R'       SRREVR                          CAP053
     C                     ENDCS
     C                     ENDIF
     C           WERRF     IFNE *BLANK
     C           WFRST     ANDEQ'Y'
     C                     Z-ADDSRRN      SRNBR
     C                     MOVE *BLANK    WFRST
     C                     ENDIF
     C           SLSEL     IFNE 'Q'                                       CAP053
     C                     MOVE '1'       *IN94
     C                     ENDIF                                          CAP053
     C                     ENDIF
      *
     C                     UPDATLE2030S0
     C                     READCLE2030S0                 87
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT                                                              CAP053
      *****************************************************************   CAP053
     C           INVLTM    BEGSR                                          CAP053
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
      *                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     MOVE 'Y'       SUPSYS  1                       CSC011
     C                     ELSE                                           CSC011
     C                     MOVE 'N'       SUPSYS                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     CALL 'LE2031'                                  CAP053
      *                                                                   CAP053
      * INPUTS                                                            CAP053
      * Invalid file name                                                 CAP053
     C                     PARM 'LEILONPD'INVFIL  8                       CAP053
      *                                                                   CAP053
      * Repair Number                                                     CAP053
     C                     PARM XREPN     IREPN   50                      CAP053
      *                                                                   CAP053
      **Support*System On                                          CSC011 222373
     C**********           PARM SUPSYS    SUPSYS                   CSC011 222373
      **********                                                   CSC011 222373
      **Front*Office ID / PC Transaction Reference                 CSC011 222373
     C**********           PARM STNRF     STNRF                    CSC011 222373
      **********                                                   CSC011 222373
      **Transaction Timestamp                                      CSC011 222373
     C**********           PARM STMST     STMST                    CSC011 222373
      **********                                                   CSC011 222373
     C                     ENDSR                                          CAP053
      *****************************************************************   CAP053
      /EJECT
      *****************************************************************
      * SRSPRO  -  Process each subfile request                       *
      * Called by: SRSFIL - Subfile processing                        *
      * Calls    : SRINSC - Format screen fields from CLOAN file      *
      *            SRDTL1 - Process first detail screen               *
      *            SRDTL2 - Process second detail screen              *
      *            SRDTL3 - Process third detail screen               *
      *            SRDTL4 - Process fourth detail screen              *
      *            SRDTL5 - Process fifth detail screen - ext sett    *
      *            SRINSR - Insert record in CLOAN and/or LE2030PD    *
      *            SRUPDR - Amend existing CLOAN record               *
      *****************************************************************
     C           SRSPRO    BEGSR
      *
     C                     MOVE *IN92     WIN92
     C                     MOVE *IN93     WIN93
     C                     MOVE *IN34     WIN34   1
     C                     MOVE *IN35     WIN35   1
     C                     MOVE 'Y'       WSFIL
     C                     MOVE '0'       *IN30
     C                     EXSR CLEAR
      *
      ** Process each subfile request
      *
     C                     Z-ADD1         SRRN
     C                     READCLE2030S0                 87
     C           *IN87     DOWEQ'0'
     C                     MOVE '0'       *IN94
     C                     MOVE 'D1'      WFMT
     C           PMODE     IFEQ 'F'                                       CAP053
     C                     MOVELSSTAT     SACTN                           CAP053
     C                     ELSE                                           CAP053
     C                     MOVE SLSEL     SACTN
     C                     ENDIF                                          CAP053
      *
      ** Retrieve loan details for screen processing
      *
     C                     MOVE 'A'       WEPAR
     C                     MOVE SLOAN     WALON
     C           WKLON     CHAINCLOAN               N89
     C                     MOVE *IN89     WIN89   1
     C                     MOVE RECI      WRECI   1
     C                     MOVE 'B'       WEPAR
     C           WKLON     CHAINCLOAN               N89
     C           WIN89     IFEQ '0'                                                           202381
     C           RECI      ANDEQ'M'                                                           202381
     C           RATF      ANDEQ'Y'                                                           202381
     C                     ELSE                                                               202381
     C           WIN89     IFEQ '1'
     C           SACTN     ANDNE'I'                                       CAP053
     C           *IN89     OREQ '1'
     C           SACTN     ANDNE'I'                                       CAP053
     C           WIN89     OREQ '0'
     C           WRECI     ANDNE'D'
     C           SACTN     ANDNE'E'
     C           *IN89     OREQ '0'
     C           RECI      ANDNE'D'
     C           SACTN     ANDNE'E'
     C                     MOVE '1'       *IN30
     C                     MOVEL'LEL0039' ZAMSID
     C                     EXSR ZASNMS
     C                     LEAVE
     C                     ENDIF
     C                     ENDIF                                                              202381
      *
     C                     EXSR SRINSC
     C                     MOVE SLOAN     SLNRF
      *
      ** Go through each screen needed by the loan
      *
     C           WFMT      DOUEQ'F0'
     C           WFMT      OREQ 'S0'
     C           WFMT      OREQ *BLANKS
     C           WFMT      CASEQ'D1'      SRDTL1
     C           WFMT      CASEQ'D2'      SRDTL2
     C           WFMT      CASEQ'D3'      SRDTL3
     C           WFMT      CASEQ'D4'      SRDTL4
     C           WFMT      CASEQ'D5'      SRDTL5
     C           WFMT      CASEQ'WR'      SRINSR
     C           WFMT      CASEQ'UP'      SRUPDR
     C                     ENDCS
     C                     ENDDO
      *
      ** If detail screen has been exited,
      ** (1) for F3, return to main menu
      ** (2) for F12, return to subfile screen with action on current
      **     record cancelled (ie blank)
      ** (3) if error exists, return to subfile but highlight error
      ** (4) no error, blank out action code of selected record and
      **     process next changed record
      *
     C                     SELEC
     C           WFMT      WHEQ *BLANKS
     C                     LEAVE
     C           *INKL     WHEQ '1'
     C                     Z-ADDSRRN      SRNBR
     C                     MOVE *BLANK    SLSEL
     C                     UPDATLE2030S0
     C                     LEAVE
     C           WFINL     WHEQ 'Y'
     C           WERRF     ANDEQ'Y'
     C                     Z-ADDSRRN      SRNBR
     C                     MOVE '1'       *IN94
     C                     UPDATLE2030S0
     C                     LEAVE
     C                     OTHER
     C                     Z-ADDSRRN      SRNBR
     C                     MOVE *BLANK    SLSEL
     C                     UPDATLE2030S0
     C                     ENDSL
      *
     C                     READCLE2030S0                 87
     C                     ENDDO
      *
      ** Re-load subfile to reflect insertions/amendments/reversals
      ** when records have been successfully processed
      *
     C           WFMT      IFNE *BLANK
     C                     MOVE WIN34     *IN34
     C                     MOVE WIN35     *IN35
     C                     MOVE WIN86     *IN86
     C                     MOVE WIN92     *IN92
     C                     MOVE WIN93     *IN93
     C                     MOVE 'S0'      WFMT
     C           *IN30     IFEQ '0'
     C           *IN94     ANDEQ'0'
     C           *INKL     IFEQ '0'
     C                     MOVE '0'       *IN88
     C                     EXSR SRLOAD
     C                     ELSE
     C                     EXSR CLEAR
     C                     ENDIF
     C                     ENDIF
      *
     C                     WRITELE2030F0
     C                     WRITELE2030F2
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRREVR  -  Validate reverse action                            *
      * Called by: SRSTRT - Validate initial screen                   *
      *            SRVSUB - Validate subfile                          *
      *            SRBTCH - Batch processing                          *
      * Calls    : None                                               *
      *****************************************************************
     C           SRREVR    BEGSR
      *
      ** Check if unactioned loan amendments still exists for the loan
      *
     C**********           Z-ADDLNRF      WLLOAN                                              CLE148
     C                     MOVELLNRF      WLLOAN                                              CLE148
     C                     Z-ADD*ZEROS    WLVDAT
     C                     Z-ADD*ZEROS    WLLASN
     C           WKLAM     SETLLLOAMS
     C           *IN89     DOUEQ'1'
     C           LNRFA     ORGT WLLOAN
     C***********          READ LOAMS                    89               142586
     C                     READ LOAMS               N    89               142586
     C           *IN89     IFEQ '0'
     C           LNRFA     ANDEQWLLOAN
     C           RECIA     ANDEQ'D'
     C                     MOVEA'11'      *IN,30
     C                     MOVEL'LEL0063' ZAMSID
     C                     EXSR ZASNMS
     C                     LEAVE
     C                     ENDIF
     C                     ENDDO
      *
      ** Check if outstanding fees still exists for the loan
      *
     C**********           Z-ADDCNUM      WFCNUM                                              CSD027
     C                     MOVE CNUM      WFCNUM                                              CSD027
     C                     Z-ADD*ZEROS    WFFACL
     C**********           Z-ADDLNRF      WFLOAN                                              CLE148
     C                     MOVELLNRF      WFLOAN                                              CLE148
     C           WKFEE     SETLLLEFEEDL1
     C           *IN89     DOUEQ'1'
     C           FECNUM    ORGT WFCNUM
     C                     READ LEFEEDL1                 89
     C           *IN89     IFEQ '0'
     C           FECNUM    ANDEQWFCNUM
     C           FELOAN    ANDEQWFLOAN
     C           FERECI    ANDEQ'D'
     C                     MOVEA'11'      *IN,30
     C                     MOVEL'LEL0065' ZAMSID
     C                     EXSR ZASNMS
     C                     LEAVE
     C                     ENDIF
     C                     ENDDO
      *
      ** Check if outstanding parts sold still exists for the loan
      *
     C           PMODE     IFNE 'B'                                       121142
     C           NOPS      IFGT 0
     C                     MOVEA'11'      *IN,30
     C                     MOVEL'LEL0064' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF                                          121142
      *                                                                   132568
      *  Reset the prime facility reference                               132568
      *                                                                   132568
     C           PMODE     IFEQ 'B'                                       132568
     C                     MOVE PLNRF     WALON                           132568
     C                     MOVE 'A'       WEPAR                           132568
     C           WKLON     CHAINCLOAN               N89                   132568
     C                     ENDIF                                          132568
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRAUTH  -  Validate authorisation action                      *
      * Called by: SRSTRT - Validate initial screen                   *
      *            SRVSUB - Validate subfile                          *
      *            SRBTCH - Batch processing                          *
      * Calls    : None                                               *
      *****************************************************************
     C           SRAUTH    BEGSR
      *
      ** If authorisation feature (CLE002) is not installed
      ** authorisation action is not allowed
      *
     C           CLE002    IFEQ 'N'
     C                     MOVEA'11'      *IN,30
     C                     MOVEL'LEL0402' ZAMSID
     C                     EXSR ZASNMS
      *
      ** If authorisation feature is installed,
      **   (1) authorisation must be set as needed in order to continue
      **   (2) authorising user must be different from the insert and
      **         amend users
      **   (3) status of loan must be complete or requiring re-authori-
      **         sation
      *
     C                     ELSE
      *
     C                     MOVE *BLANK    WAERR   1
     C                     SELEC
     C           *IN21     WHEQ '1'
     C           BPPPAU    IFNE 'Y'
     C                     MOVE 'Y'       WAERR
     C                     ENDIF
     C           *IN22     WHEQ '1'
     C           BPPSAU    IFNE 'Y'
     C                     MOVE 'Y'       WAERR
     C                     ENDIF
     C                     OTHER
     C           BPLOAU    IFNE 'Y'
     C                     MOVE 'Y'       WAERR
     C                     ENDIF
     C                     ENDSL
      *
     C           WAERR     IFEQ 'Y'
     C                     MOVEA'11'      *IN,30
     C                     MOVEL'LEL0403' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C           USER      IFEQ IUSR
     C           USER      OREQ AUSR
     C                     MOVEA'11'      *IN,30
     C                     MOVEL'LEL0404' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C           LSTS      IFNE 'C'
     C           LSTS      ANDNE'R'
     C           PGNTF     IFNE 'Y'                                       158082
     C           PMODE     ANDNE'B'                                       158082
     C                     MOVEA'11'      *IN,30
     C                     MOVEL'LEL0405' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF                                          158082
     C/COPY WNCPYSRC,LE2030C070
      *                                                                   140825
     C           USER      IFNE AUSR                                      140825
     C           USER      ANDNEAUSR                                      140825
     C           PTYPE     ANDEQ'LOAN'                                    140825
     C                     MOVEL*BLANK    WERR    1                       140825
     C**********           Z-ADDLNRF      WLONO   60                                   140825 CLE148
     C**********           Z-ADDWLONO     WLLOAN                                       140825 CLE148
     C                     MOVELLNRF      WLONO   6                                           CLE148
     C                     MOVELWLONO     WLLOAN                                              CLE148
     C                     Z-ADD0         WLVDAT                          140825
     C                     Z-ADD0         WLLASN                          140825
     C           WLONO     CHAINLELOANL0             89                   140825
     C           GPRT      IFEQ 'Y'                                       140825
     C                     MOVEL'PT'      WAMTP                           140825
     C                     ELSE                                           140825
     C                     MOVEL'PF'      WAMTP                           140825
     C                     ENDIF                                          140825
     C           WKLAM     SETLLLOAMS                                     140825
     C           *IN89     DOUEQ'1'                                       140825
     C           LNRFA     ORNE WLLOAN                                    140825
     C           AMTPA     OREQ WAMTP                                     140825
     C***********          READ LOAMS                    89        140825 142522
     C                     READ LOAMS               N    89               142522
     C                     ENDDO                                          140825
     C           *IN89     IFEQ '0'                                       140825
     C           LNRFA     ANDEQWLLOAN                                    140825
     C           AMTPA     ANDEQWAMTP                                     140825
     C           USER      IFEQ IUSR                                      140825
     C           USER      OREQ AUSR                                      140825
     C                     MOVEL'Y'       WERR                            140825
     C                     ENDIF                                          140825
     C           ROLN      CHAINLELOANL0             89                   140825
     C           *IN89     IFEQ '0'                                       140825
     C           USER      ANDEQIUSRL                                     140825
     C           *IN89     OREQ '0'                                       140825
     C           USER      ANDEQAUSRL                                     140825
     C                     MOVEL'Y'       WERR                            140825
     C                     ENDIF                                          140825
     C                     ENDIF                                          140825
     C           WERR      IFEQ 'Y'                                       140825
     C                     MOVEA'11'      *IN,30                          140825
     C                     MOVEL'LEL0404' ZAMSID                          140825
     C                     EXSR ZASNMS                                    140825
     C                     ENDIF                                          140825
     C***********WLONO     CHAINLELOANL0             89            140825 155773
     C                     MOVE 'A'       WEPAR                           155773
     C**********           Z-ADDWLONO     WALON                                        155773 CLE148
     C                     MOVELWLONO     WALON                                               CLE148
     C********** WKLON     CHAINCLOAN                89            155773 191800
     C           WKLON     CHAINCLOAN               N89                   191800
     C                     ENDIF                                          140825
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CSD015
      ** If Compliance Watch Enhancement (CSD015) is installed, Watch                         CSD015
      ** List Checking Applied and Authorization is allowed....                               CSD015
      ** If 24x7 Midas Availability is not installed or it is installed and                   CSD015
      ** in the main system...                                                                CSD015
      ** Determine  if there is a pending case.                                               CSD015
      ** If there no pending case or case has been temporarily released,                      CSD015
      ** continue normal processing.  Otherwise send error message.                           CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C           WAERR     ANDNE'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
     C                     MOVEL'CLOANCL' K3FUNT                                              CSD015
     C                     MOVELLNRF      K3IDEN                                              CSD015
     C                     MOVELBRCA      K3BRCH                                              CSD015
     C                     MOVE *IN89     WIND89  1                                           CSD015
     C           KCWHT     CHAINSDCWHTL1             89                                       CSD015
     C           *IN89     IFEQ *OFF                                                          CSD015
     C           W3TREL    ANDNE'Y'                                                           CSD015
     C                     MOVEL'LEL0564' ZAMSID                                              CSD015
     C                     MOVE *ON       *IN30                                               CSD015
     C                     MOVE *ON       *IN31                                               CSD015
     C                     EXSR ZASNMS                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVE WIND89    *IN89                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                    AR1021136
     C           *IN30     IFEQ '0'                                                        AR1021136
     C           *IN31     ANDEQ'0'                                                        AR1021136
     C           WLONO     ANDEQ'000000'                                                   AR1021136
     C           SACTN     ANDEQ'X'                                                        AR1021136
     C           CHTP      ANDNE'R'                                                        AR1021136
     C                     MOVE '11'      *IN,30                                           AR1021136
     C                     MOVEL'5045917' ZAMSID                                           AR1021136
     C                     EXSR ZASNMS                                                     AR1021136
     C                     ENDIF                                                           AR1021136
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRCAUT  -  Check if user is authorised to the action          *
      * Called by: SRSTRT - Validate initial screen                   *
      *            SRBTCH - Batch processing                          *
      * Calls    : None                                               *
      *****************************************************************
     C           SRCAUT    BEGSR
     C/COPY WNCPYSRC,LE2030C009
      *                                                                   123295
     C                     MOVE SACTN     WACTN   1                       123295
     C           SACTN     IFGE '1'                                       123295
     C           SACTN     ANDLE'4'                                       123295
     C                     MOVE SACTN     W#ACTN  1                       125557
     C                     MOVE 'E'       SACTN                           123295
     C                     ENDIF                                          123295
      *
      ** For single branch system, check if user is authorised to the
      ** action
      *
     C                     Z-ADD0         @ERR
     C           BGMBIN    IFEQ 'N'
      *
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBACTU'
     C                     PARM SACTN     @ZACTN
     C                     PARM           @USER
     C**********           PARM           @ZMGRP                                              CSF002
     C**********           PARM           @ZICDE                                              CSF002
     C                     PARM           UNQCDE                                              CSF002
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVACTU'
     C                     PARM SACTN     @ZACTN
     C                     PARM           @ERR
     C                     ENDIF
      *
     C           @ERR      IFNE 0
     C                     MOVE '1'       *IN30
     C                     MOVEL'LEL0302' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** For multibranching system, and action codes not I, branch code
      ** on loans file must be valid for user
      ** ... except when loan is being authorised for a Principal Transfer.                   211587
      *
     C           BGMBIN    IFEQ 'Y'
     C           SACTN     ANDNE'I'
     C           *IN30     ANDEQ'0'
     C                     MOVE SACTN     @ZACTN
     C                     MOVE BRCA      @ZBR
      *
     C           PMODE     IFEQ 'B'
     C           PTYPE     IFNE 'PTFT'                                                        211587
     C                     CALL 'ZBACTBU'
     C                     PARM           @ZACTN
     C                     PARM           @ZBR
     C                     PARM           @USER
     C**********           PARM           @ZMGRP                                              CSF002
     C**********           PARM           @ZICDE                                              CSF002
     C                     PARM           UNQCDE 10                                           CSF002
     C                     PARM           @ERR
     C                     ENDIF                                                              211587
     C                     ELSE
     C                     CALL 'ZVACTBU'
     C                     PARM           @ZACTN  1
     C                     PARM           @ZBR    3
     C                     PARM           @ERR    10
     C                     ENDIF
      *
     C           @ERR      IFEQ 1
     C                     MOVEA'11'      *IN,30
     C                     MOVEL'LEL0303' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C           @ERR      IFEQ 2
     C                     MOVEA'11'      *IN,30
     C                     MOVEL'LEL0304' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                   183572
      ** If action code not = 'A', check user's authority to action       183572
      ** code 'A' (for future reference).                                 183572
      *                                                                   183572
     C           SACTN     IFNE 'A'                                       183572
     C           *IN30     ANDEQ'0'                                       183572
     C                     MOVE 'A'       @ZACTN                          183572
      *                                                                   183572
     C           PMODE     IFEQ 'B'                                       183572
     C                     CALL 'ZBACTBU'                                 183572
     C                     PARM           @ZACTN                          183572
     C                     PARM           @ZBR                            183572
     C                     PARM           @USER                           183572
     C**********           PARM           @ZMGRP                                       183572 CSF002
     C**********           PARM           @ZICDE                                       183572 CSF002
     C                     PARM           UNQCDE                                              CSF002
     C                     PARM           @ERR                            183572
     C                     ELSE                                           183572
     C                     CALL 'ZVACTBU'                                 183572
     C                     PARM           @ZACTN                          183572
     C                     PARM           @ZBR                            183572
     C                     PARM           @ERR                            183572
     C                     ENDIF                                          183572
      *                                                                   183572
     C           @ERR      IFEQ 0                                         183572
     C                     MOVE 'Y'       WF8     1                       183572
     C                     ELSE                                           183572
     C                     MOVE 'N'       WF8                             183572
     C                     ENDIF                                          183572
      *                                                                   183572
     C                     ELSE                                           183572
     C                     MOVE 'N'       WF8                             183572
     C                     ENDIF                                          183572
      *                                                                   183572
     C                     ENDIF
      *
      ** For multibranching system, and action codes A/R, originating
      ** branch on loans file must be valid for user
      *
     C           WERRF     IFEQ *BLANK
     C           BGMBIN    ANDEQ'Y'
     C           SACTN     ANDNE'I'
     C           SACTN     ANDNE'E'
     C           BKOBUV    ANDEQ'Y'
     C           BKOBRU    ANDEQ'Y'
      *
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBOBU'
     C                     PARM ORBR      @ZOBRX
     C                     PARM           @USER
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVOBU'
     C                     PARM ORBR      @ZOBRX  3
     C                     PARM           @ERR
     C                     ENDIF
      *
     C           @ERR      IFEQ 1
     C                     MOVEA'11'      *IN,30
     C                     MOVEL'LEL0305' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C           @ERR      IFEQ 2
     C                     MOVEA'11'      *IN,30
     C                     MOVEL'LEL0306' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2030C010
      *                                                                   123295
     C                     MOVE WACTN     SACTN                           123295
     C/COPY WNCPYSRC,LE2030C011
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRLOAD  -  Load subfile records                               *
      * Called by: SRSFIL - Subfile processing                        *
      * Calls    : None                                               *
      *****************************************************************
     C           SRLOAD    BEGSR
      *
      ** Retrieve from either of 2 files, depending on user input
      ** Position and read only if rollup is not pressed
      *
     C                     MOVE *IN86     WIN86   1
     C                     MOVE '0'       *IN30
     C                     Z-ADD*ZEROS    WSCTR   20
     C**********           MOVE SRLON     WKSLN   60                                          CLE148
     C                     MOVE SRLON     WKSLN   6                                           CLE148
     C                     MOVE SRLON     WSLON   6
     C                     MOVE SRAUT     WSAUT   1
      *
     C           *IN88     IFEQ '0'
     C                     MOVE '1'       *IN92
     C                     WRITELE2030C0
     C                     MOVEA'00'      *IN,92
     C                     Z-ADD*ZEROS    SRRN    40
      *
     C           PMODE     IFEQ 'F'                                       CAP053
     C           WKSLN     SETLLLEILONP1                                  CAP053
     C                     READ LEILONP1                 86               CAP053
     C                     ELSE                                           CAP053
     C           SRAUT     IFEQ 'Y'
     C           WKSLN     SETLLLELOAND1
     C                     READ LELOAND1                 86
     C                     ELSE
     C           WKSLN     SETLLLELOAND0
     C                     READ LELOAND0                 86
     C                     ENDIF
     C                     ENDIF                                          CAP053
     C                     ELSE
     C                     Z-ADDWSRRN     SRRN
     C                     ENDIF
      *
     C           *IN86     DOWEQ'0'
     C           WSCTR     ANDLT11
     C                     MOVE *BLANK    WSELR   1
      *
      ** Loans displayed must correspond to loan type
      *
     C                     SELEC
     C           PTYPE     WHEQ 'LOAN'
     C           PTYPL     IFEQ 61
     C           PTYPL     OREQ 62
     C           PTYPL     OREQ 63
     C           PTYPL     OREQ 70
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           PTYPL     ANDEQ80                                                            CLE028
     C                     MOVE 'Y'       WSELR
     C                     ENDIF
      *
     C           PTYPE     WHEQ 'PTPU'
     C           PTYPL     IFEQ 64
     C           PTYPL     OREQ 65
     C           PTYPL     OREQ 68                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYPL     OREQ 71                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C                     MOVE 'Y'       WSELR
     C                     ENDIF
      *
     C           PTYPE     WHEQ 'PTSO'
     C           PTYPL     IFEQ 66
     C           PTYPL     OREQ 67
     C           PTYPL     OREQ 69                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYPL     OREQ 72                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C                     MOVE 'Y'       WSELR
     C                     ENDIF
     C                     ENDSL
      *
      ** User must also have access to the loan's branch
      *
     C           WSELR     IFEQ 'Y'
     C           BGMBIN    ANDEQ'Y'
     C                     Z-ADD*ZERO     @ERR
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBBBU'
     C                     PARM BRCAL     @ZBR
     C                     PARM           @USER
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVBBU'
     C                     PARM BRCAL     @ZBR
     C                     PARM           @ERR
     C                     ENDIF
     C           @ERR      IFNE *ZERO
     C                     MOVE *BLANK    WSELR
     C                     ENDIF
     C                     ENDIF
      *
      ** If loan type is satisfied, format subfile screen fields
      *
     C           WSELR     IFEQ 'Y'
     C                     ADD  1         WSCTR
      *
     C           WSCTR     IFLE 10
      *
      ** Initialise all subfile fields
      *
     C                     MOVE IUSRL     SIUSR
     C                     MOVE AUSRL     SAUSR
     C                     MOVE LSTSL     SINDS
     C                     Z-ADDNOPSL     SNOPS
     C                     MOVE BRCAL     SSBRC
     C                     MOVE ORBRL     SSORB                           CAP053
      *
     C                     MOVE *BLANKS   SLSEL
     C                     MOVE *BLANKS   SLOAN
     C                     MOVE *BLANKS   SCNUM
     C                     MOVE *BLANKS   SVDTE
     C                     MOVE *BLANKS   SMDTE
     C                     MOVE *BLANKS   SAMNT
     C                     MOVE *BLANKS   SLCCY
     C                     MOVE *BLANKS   SSTAT
      *
     C                     ADD  1         SRRN
     C           PMODE     IFEQ 'F'                                       CAP053
     C                     MOVE SLNRF     SLOAN                           CAP053
     C                     MOVELSCUST     SCNUM                           CAP053
     C                     MOVELSVDAT     SVDTE                           CAP053
     C                     MOVELSMDAT     SMDTE                           CAP053
     C                     MOVELSCURR     SLCCY                           CAP053
     C                     MOVELSCPAM     SAMNT                           CAP053
     C                     MOVELSACTN     SSTAT                           CAP053
     C                     MOVE *BLANK    H#GPRT                          CAP053
     C                     Z-ADD*ZERO     H#ORED                          CAP053
     C                     ELSE                                           CAP053
     C                     MOVE LNRFL     SLOAN
     C                     MOVE GPRT      H#GPRT                          132558
     C                     Z-ADDORED      H#ORED                          132558
     C/COPY WNCPYSRC,LE2030C071
     C           *IN21     IFEQ '0'
     C                     MOVELCNUML     SCNUM
     C                     ELSE
     C                     MOVELOLNO      SCNUM
     C                     ENDIF
      *                                                                   126274
      ** Access the Customer Details file for Shortname                   126274
      *                                                                   126274
     C                     CALL 'AOCUSTR0'                                126274
     C                     PARM '       ' PRTCD                           126274
     C                     PARM '*KEY   ' POPTN                           126274
     C                     PARM SCNUM     PCUST                           126274
     C                     PARM           PKYST                           126274
     C           SDCUST    PARM SDCUST    DSSDY                           126274
     C                     MOVE *BLANKS   SCSNM                           126274
     C           PRTCD     IFEQ *BLANKS                                   126274
     C                     MOVE BBCSSN    SCSNM                           126274
     C                     ELSE                                           126274
     C                     MOVE 'Unknown' SCSNM                           126274
     C                     ENDIF                                          126274
      *
      ** Format start date
      *
     C                     Z-ADDVDATL     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SVDTE
      *
      ** Format maturity date
      *
     C           MDATL     IFNE *ZEROS
     C                     Z-ADDMDATL     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SMDTE
     C                     ENDIF
      *
      ** Get ccy decimal places for the display of amount
      *
     C                     MOVE CCYL      PCURR
     C                     CALL 'AOCURRR0'PPAR5
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD14        DBASE            * DBERR 14 *
     C                     MOVELCCY       DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Format amount and currency
     C/COPY WNCPYSRC,LE2030C074
      *
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE CPAML     ZFLD15 150
     C                     Z-ADDA6NBDP    ZDECS   10
     C                     MOVE 'L'       ZECODE  1
     C                     EXSR ZFRPED
     C           ZNEG      IFEQ '-'
     C                     MOVE ZOUT21    SAMNT
     C                     ELSE
     C                     MOVE ZOUT20    SAMNT
     C                     ENDIF
     C/COPY WNCPYSRC,LE2030C075
     C                     MOVE CCYL      SLCCY
      *
      ** Format loan status
      *
     C                     SELEC
     C           LSTSL     WHEQ 'C'
     C***********          MOVELWSTAT,5   SSTAT                           123998
     C                     MOVEL'LEL0089' ZAMSID                          123998
     C           LSTSL     WHEQ 'R'
     C***********          MOVELWSTAT,6   SSTAT                           123998
     C                     MOVEL'LEL0090' ZAMSID                          123998
     C           LSTSL     WHEQ 'A'
     C***********          MOVELWSTAT,7   SSTAT                           123998
     C                     MOVEL'LEL0091' ZAMSID                          123998
     C           LSTSL     WHEQ 'D'
     C***********          MOVELWSTAT,8   SSTAT                           123998
     C                     MOVEL'LEL0092' ZAMSID                          123998
     C                     ENDSL
     C           RATFL     IFEQ 'Y'                                                           202381
     C           LSTSL     IFEQ 'C'                                                           202381
     C           LSTSL     OREQ 'R'                                                           202381
     C                     MOVEL'LEL0537' ZAMSID                                              202381
     C                     ENDIF                                                              202381
     C                     ENDIF                                                              202381
     C                     EXSR SRTEXT                                    123998
     C                     MOVELZAMSTX    SSTAT                           123998
     C                     MOVE *BLANKS   ZAMSID                          123998
     C                     ENDIF                                          CAP053
      *
     C                     WRITELE2030S0
     C                     ENDIF
     C                     ENDIF
      *
      ** Read next record
      *
     C           WSCTR     IFLE 10
     C           PMODE     IFEQ 'F'                                       CAP053
     C                     READ LEILONP1                 86               CAP053
     C                     ELSE                                           CAP053
     C           SRAUT     IFEQ 'Y'
     C                     READ LELOAND1                 86
     C                     ELSE
     C                     READ LELOAND0                 86
     C                     ENDIF
     C                     ENDIF                                          CAP053
     C                     ENDIF
      *
     C                     ENDDO
      *
      ** If no subfile record is selected, set on indicator
      *
     C                     MOVE *IN86     WIN86
     C                     Z-ADDSRRN      WSRRN   40
     C                     Z-ADDSRRN      SRNBR
     C**********           MOVE LNRF      WKSLN   60                                          CLE148
     C                     MOVE LNRF      WKSLN   6                                           CLE148
     C           WSCTR     IFEQ 0
     C                     MOVE '1'       *IN93
     C                     MOVEL'LEL0019' ZAMSID
     C                     EXSR ZASNMS
     C                     WRITELE2030F0
     C                     WRITELE2030F2
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRINSC  -  Format screen fields from CLOAN file when in       *
      *            record or interactive mode                         *
      * Called by: SRSTRT - Validate initial screen                   *
      *            SRSFIL - Subfile processing                        *
      *            SRSPRO - Process each subfile request              *
      * Calls    : SRINFM - Format screen details for insert          *
      *            SROTFM - Format screen details for non-insert      *
      *****************************************************************
     C           SRINSC    BEGSR
      *
      ** Clear error flags and indicators
      *
     C                     MOVE *BLANK    WSCRQ   1                       123295
     C                     MOVE *BLANK    WF11                            123857
     C                     MOVE *BLANK    WDTL3
     C                     MOVE *BLANK    WDTL5
     C                     MOVE 'D1'      WFMT
     C                     MOVEA'000'     *IN,26
     C                     MOVEA'00'      *IN,95
     C                     MOVE *BLANK    WFINL
     C                     MOVE '0'       *IN23
     C                     MOVE '0'       *IN47                           123295
      *
      ** Make portfolio reference unavailable for participations
      *
     C           *IN21     IFEQ '1'
     C           *IN22     OREQ '1'
     C                     MOVE '1'       *IN23
     C                     ENDIF
      *
      ** Seton indicators to determine action type
      *
     C                     SELEC
     C           SACTN     WHEQ 'R'
     C                     MOVE '1'       *IN27
     C                     MOVE '1'       *IN95
     C           SACTN     WHEQ 'E'
     C                     MOVE '1'       *IN95
     C           SACTN     WHEQ 'X'
     C                     MOVE '1'       *IN26
     C                     MOVE '1'       *IN95
     C           SACTN     WHEQ 'A'
     C                     MOVE '1'       *IN28
     C           SACTN     WHEQ 'I'
     C***********          MOVE '1'       *IN25                           120813
     C           SACTN     WHGE '1'                                       123295
     C           SACTN     ORLE '4'                                       123295
     C                     SELEC                                          123295
     C           SACTN     WHEQ '1'                                       123295
     C                     MOVE 'D1'      WFMT                            123295
     C           SACTN     WHEQ '2'                                       123295
     C                     MOVE 'D2'      WFMT                            123295
     C                     MOVE '0'       *IN44                           123295
     C                     MOVEAWVAL2A    *IN,47                          123295
     C                     MOVEAWVAL2B    *IN,68                          123295
     C           SACTN     WHEQ '3'                                       123295
     C                     MOVE 'D4'      WFMT                            123295
     C                     MOVEA'000000'  *IN,80                          123295
     C                     MOVEAWVAL3     *IN,07                          123295
     C                     MOVEA'00'      *IN,86                          123295
     C           SACTN     WHEQ '4'                                       123295
     C                     MOVE 'D5'      WFMT                            123295
     C                     ENDSL                                          123295
     C                     MOVE 'Y'       WSCRQ                           123295
     C                     MOVE '1'       *IN95                           123295
     C                     MOVE 'E'       SACTN                           123295
     C                     OTHER
     C                     MOVE '0'       *IN95
     C                     ENDSL
      *
      ** Seton indicators if multibranching is used and if analytical
      ** accounting is required, or if originating branch is used
      ** (protect fields when not being used)
      *
     C           BGMBIN    IFEQ 'Y'
     C                     MOVE '1'       *IN06
     C                     ENDIF
     C           BGN0ST    IFEQ 'Y'
     C           CDE002    OREQ 'Y'                                       CDE002
     C                     MOVE '1'       *IN96
     C                     MOVE *BLANK    WFUNP   1
     C                     ENDIF
     C           BKOBRU    IFEQ 'Y'
     C                     MOVE '1'       *IN02
     C                     ENDIF
      *
      ** Seton indicators if profit centre is being used and when
      ** it is non-amendable
      *
     C                     MOVEA'00'      *IN,03
     C           BKPRCU    IFEQ 'N'
     C                     MOVE '1'       *IN03
     C                     ENDIF
     C           BKPRCU    IFEQ 'N'
     C           BKPRCA    OREQ 'N'
     C           SACTN     IFNE 'I'
     C                     MOVE '1'       *IN04
     C                     ENDIF
     C                     ENDIF
      *                                                                   123857
      ** Set on indicator that will disable F11 on auth. as needed        123857
      *                                                                   123857
     C           SACTN     IFEQ 'X'                                       123857
     C           BPAURV    ANDEQ'Y'                                       123857
     C                     MOVE '1'       *IN18                           123857
     C                     ENDIF                                          123857
      *
     C           SACTN     IFEQ 'I'
     C                     EXSR SRINFM
     C                     ELSE
     C                     EXSR SROTFM
     C                     ENDIF
      *                                                                   CAP053
      * Overwrite screen fields with fields from invalid file             CAP053
      *                                                                   CAP053
     C           PMODE     IFEQ 'F'                                       CAP053
     C           XREPN     CHAINLEILONP2             99                   CAP053
     C           SACTN     CASEQ'I'       SSINDI                          CAP053
     C           SACTN     CASEQ'A'       SSINDA                          CAP053
     C                     ENDCS                                          CAP053
     C                     ENDIF                                          CAP053
      *
     C                     ENDSR
      /EJECT                                                              CAP053
      *****************************************************************   CAP053
      * SCREEN SETUP FROM INVALID DATA - INSERT                           CAP053
      *****************************************************************   CAP053
     C           SSINDI    BEGSR                                          CAP053
     C                     MOVE ISLNRF    SLNRF                           CAP053
     C                     MOVE ISCUST    SCUST                           CAP053
     C                     MOVE ISFCUS    SFCUS                           CAP053
     C                     MOVE ISFTYP    SFTYP                           CAP053
     C                     MOVE ISFSEQ    SFSEQ                           CAP053
     C                     MOVE ISBRCA    SBRCA                           CAP053
     C                     MOVE ISLTYP    SLTYP                           CAP053
     C                     MOVE ISSUTP    SSUTP                           CAP053
     C                     MOVE ISOLNO    SOLNO                           CAP053
     C                     MOVE ISPFRM    SPFRM                           CAP053
     C                     MOVE ISMLNR    SMLNR                           CAP053
     C                     MOVE ISCURR    SCURR                           CAP053
     C                     MOVE ISCPAM    SCPAM                           CAP053
     C                     MOVE ISDDAT    SDDAT                           CAP053
     C                     MOVE ISAUTO    SAUTO                           CAP053
     C                     MOVE ISVDAT    SVDAT                           CAP053
     C                     MOVE ISRCSI    SRCSI                           CAP053
     C                     MOVE ISMDAT    SMDAT                           CAP053
     C                     MOVE ISAPMI    SAPMI                           CAP053
     C                     MOVE ISMCRA    SMCRA                           CAP053
     C                     MOVE ISRLDT    SRLDT                           CAP053
     C                     MOVE ISRLFQ    SRLFQ                           CAP053
     C                     MOVE ISRLDY    SRLDY                           CAP053
     C                     MOVE ISDFTP    SDFTP                           CAP053
     C                     MOVE ISDFST    SDFST                           CAP053
     C                     MOVE ISLNKS    SLNKS                           CAP053
     C                     MOVE ISPTFC    SPTFC                           CAP053
     C                     MOVE ISPTFN    SPTFN                           CAP053
     C                     MOVE ISPTFT    SPTFT                           CAP053
     C                     MOVE ISASSN    SASSN                           CAP053
      *                                                                   CAP053
     C                     MOVE ISBRTT    SBRTT                           CAP053
     C                     MOVE ISCHIN    SCHIN                           CAP053
     C                     MOVE ISRTSP    SRTSP                           CAP053
     C                     MOVE ISSPIN    SSPIN                           CAP053
     C                     MOVE ISNIDT    SNIDT                           CAP053
     C                     MOVE ISIPFR    SIPFR                           CAP053
     C                     MOVE ISIFDY    SIFDY                           CAP053
     C                     MOVE ISCALC    SCALC                           CAP053
     C                     MOVE ISIPRD    SIPRD                           CAP053
     C                     MOVE ISMARG    SMARG                           CAP053
     C                     MOVE ISNEGV    SNEGV                           CAP053
     C                     MOVE ISWTRT    SWTRT                           CAP053
     C                     MOVE ISWTIN    SWTIN                           CAP053
     C                     MOVE ISINTC    SINTC                           CAP053
     C                     MOVE ISRDFC    SRDFC                           CAP053
     C                     MOVE ISADDI    SADDI                           CAP053
     C                     MOVE ISREPT    SREPT                           CAP053
     C                     MOVE ISRAMT    SRAMT                           CAP053
     C                     MOVE ISFCRA    SFCRA                           CAP053
     C                     MOVE ISNRPD    SNRPD                           CAP053
     C                     MOVE ISRFRQ    SRFRQ                           CAP053
     C                     MOVE ISRDYN    SRDYN                           CAP053
     C                     MOVE ISBTIN    SBTIN                           CAP053
     C                     MOVE ISBLDY    SBLDY                           CAP053
     C                     MOVE ISPDDI    SPDDI                           CAP053
     C                     MOVE ISGDIN    SGDIN                           CAP053
     C                     MOVE ISGDPR    SGDPR                           CAP053
     C                     MOVE ISPTDI    SPTDI                           CAP053
      *                                                                   CAP053
     C                     MOVE ISACOF    SACOF                           CAP053
     C                     MOVE ISLIND    SLIND                           CAP053
     C                     MOVE ISFEEI    SFEEI                           CAP053
     C                     MOVE ISORBR    SORBR                           CAP053
     C                     MOVE ISCRSK    SCRSK                           CAP053
     C                     MOVE ISDOCI    SDOCI                           CAP053
     C                     MOVE ISBOKC    SBOKC                           CAP053
     C                     MOVE ISFRBC    SFRBC                           CAP053
     C                     MOVE ISSECI    SSECI                           CAP053
     C                     MOVE ISACSQ    SACSQ                           CAP053
     C                     MOVE ISPTFR    SPTFR                           CAP053
     C                     MOVE ISNACD    SNACD                           CAP053
     C                     MOVE ISPRFC    SPRFC                           CAP053
     C                     MOVE ISNAR1    SNAR1                           CAP053
     C                     MOVE ISBCXR    SBCXR                           CAP053
     C                     MOVE ISBMIN    SBMIN                           CAP053
     C                     MOVE ISNAR2    SNAR2                           CAP053
     C                     MOVE ISNAR3    SNAR3                           CAP053
     C                     MOVE ISFCXR    SFCXR                           CAP053
     C                     MOVE ISFMIN    SFMIN                           CAP053
     C                     MOVE ISNAR4    SNAR4                           CAP053
     C                     MOVE ISRECE    SRECE                           CAP053
     C                     MOVE ISCOCU    SCOCU                           CAP053
     C                     MOVE ISFRSP    SFRSP                           CAP053
     C                     MOVE ISOMDT    SOMDT                           CAP053
     C                     MOVE ISFSGN    SFSGN                           CAP053
     C                     MOVE ISFPRC    SFPRC                           CAP053
      *                                                                   CAP053
     C                     MOVE ISSPI1    SSPI1                           CAP053
     C                     MOVE ISSPI2    SSPI2                           CAP053
     C                     MOVE ISSPI3    SSPI3                           CAP053
      *                                                                                       CAS001
      ** When CAS001 enhancement is installed                                                 CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVE WYLDC     #6YLDC                                              CAS001
     C                     MOVE WFYLD     #6FYLD                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Setup Add on Interest, Add on Charges,                                               CLE028
      ** Charge Amount, and Include Charges in Interest                                       CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     MOVE ISADIF    SADIF                                               CLE028
     C                     MOVE ISADCF    SADCF                                               CLE028
     C                     MOVE ISICIF    SICIF                                               CLE028
     C                     MOVE ISCHGA    SCHGA                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** If CLE031 is switched on, move back saved values to PF/LEILONPD.                     CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE ISSCCY    SFSCCY                                              CLE031
     C                     MOVE ISREXR    SFREXR                                              CLE031
     C                     MOVE ISREXI    SFREXI                                              CLE031
     C                     MOVE ISPSCY    SFPSCY                                              CLE031
     C                     MOVE ISPEXR    SFPEXR                                              CLE031
     C                     MOVE ISPEXI    SFPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE ISSTAL    SFSTAL                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE031
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     MOVE ISBASR    SFBASR                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     ENDSR                                          CAP053
      *****************************************************************   CAP053
      /EJECT                                                              CAP053
      *****************************************************************   CAP053
      * SCREEN SETUP FROM INVALID DATA - AMEND                            CAP053
      *****************************************************************   CAP053
     C           SSINDA    BEGSR                                          CAP053
     C                     MOVE ISAUTO    SAUTO                           CAP053
     C                     MOVE ISMDAT    SMDAT                           CAP053
     C                     MOVE ISAPMI    SAPMI                           CAP053
     C                     MOVE ISMCRA    SMCRA                           CAP053
     C                     MOVE ISDFTP    SDFTP                           CAP053
     C                     MOVE ISDFST    SDFST                           CAP053
      *                                                                   CAP053
     C                     MOVE ISNIDT    SNIDT                           CAP053
     C                     MOVE ISIPFR    SIPFR                           CAP053
     C                     MOVE ISIFDY    SIFDY                           CAP053
     C                     MOVE ISMARG    SMARG                           CAP053
     C                     MOVE ISNEGV    SNEGV                           CAP053
     C                     MOVE ISWTRT    SWTRT                           CAP053
     C                     MOVE ISRAMT    SRAMT                           CAP053
     C                     MOVE ISFCRA    SFCRA                           CAP053
     C                     MOVE ISNRPD    SNRPD                           CAP053
     C                     MOVE ISRFRQ    SRFRQ                           CAP053
     C                     MOVE ISRDYN    SRDYN                           CAP053
     C                     MOVE ISBTIN    SBTIN                           CAP053
     C                     MOVE ISBLDY    SBLDY                           CAP053
      *                                                                   CAP053
     C                     MOVE ISACOF    SACOF                           CAP053
     C                     MOVE ISLIND    SLIND                           CAP053
     C                     MOVE ISFEEI    SFEEI                           CAP053
     C                     MOVE ISORBR    SORBR                           CAP053
     C                     MOVE ISCRSK    SCRSK                           CAP053
     C                     MOVE ISDOCI    SDOCI                           CAP053
     C                     MOVE ISBOKC    SBOKC                           CAP053
     C                     MOVE ISFRBC    SFRBC                           CAP053
     C                     MOVE ISSECI    SSECI                           CAP053
     C                     MOVE ISNACD    SNACD                           CAP053
     C                     MOVE ISPRFC    SPRFC                           CAP053
     C                     MOVE ISNAR1    SNAR1                           CAP053
     C                     MOVE ISNAR2    SNAR2                           CAP053
     C                     MOVE ISNAR3    SNAR3                           CAP053
     C                     MOVE ISNAR4    SNAR4                           CAP053
     C                     MOVE ISCOCU    SCOCU                           CAP053
      *                                                                   CAP053
     C                     MOVE ISSPI1    SSPI1                           CAP053
     C                     MOVE ISSPI2    SSPI2                           CAP053
     C                     MOVE ISSPI3    SSPI3                           CAP053
      *                                                                                       CAS001
      ** When CAS001 enhancement is installed                                                 CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVE WYLDC     #6YLDC                                              CAS001
     C                     MOVE WFYLD     #6FYLD                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Setup Add on Interest, Add on Charges,                                               CLE028
      ** Charge Amount, and Include Charges in Interest                                       CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     MOVE ISADIF    SADIF                                               CLE028
     C                     MOVE ISADCF    SADCF                                               CLE028
     C                     MOVE ISICIF    SICIF                                               CLE028
     C                     MOVE ISCHGA    SCHGA                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** If CLE031 is switched on, move back saved values to PF/LEILONPD.                     CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE ISSCCY    SFSCCY                                              CLE031
     C                     MOVE ISREXR    SFREXR                                              CLE031
     C                     MOVE ISREXI    SFREXI                                              CLE031
     C                     MOVE ISPSCY    SFPSCY                                              CLE031
     C                     MOVE ISPEXR    SFPEXR                                              CLE031
     C                     MOVE ISPEXI    SFPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE ISSTAL    SFSTAL                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE031
     C                     ENDSR                                          CAP053
      *****************************************************************   CAP053
      /EJECT
      *****************************************************************
      * SRINFM  -  Format screen for insert                           *
      * Called by: SRINSC - Format screen fields for processing       *
      * Calls    : None                                               *
      *****************************************************************
     C           SRINFM    BEGSR
      *
      ** Just setup defaults for insert, the rest leave blank
      *
     C           S01465    IFEQ 'Y'
     C                     MOVE BPDASI    SAUTO
     C                     ELSE
     C                     MOVE 'N'       SAUTO
     C                     ENDIF
      *
     C                     MOVE *BLANKS   MAINRF
     C           SALON     IFEQ *BLANKS                                                       208725
     C           SACTN     ANDEQ'I'                                                           208725
     C                     MOVE *BLANKS   SLNRF
     C                     ENDIF                                                              208725
     C                     MOVE *BLANKS   SLSTS
     C                     MOVE *BLANKS   SCUST
     C                     MOVE *BLANKS   SFCUS
     C                     MOVE *BLANKS   SFTYP
     C                     MOVE *BLANKS   SFSEQ
     C                     MOVE *BLANKS   SBRCA
     C                     MOVE *BLANKS   SLTYP
     C                     MOVE *BLANKS   SSUTP
     C                     MOVE *BLANKS   SOLNO
     C                     MOVE *BLANKS   SPFRM                           125184
     C                     MOVE *BLANKS   SMLNR                           124001
     C                     MOVE *BLANKS   SCURR
     C                     MOVE *BLANKS   SCPAM
     C                     MOVE *BLANKS   SDDAT
     C                     MOVE *BLANKS   SVDAT
     C                     MOVE *BLANKS   SRCSI
     C                     MOVE *BLANKS   SMDAT
     C                     MOVE *BLANKS   SAPMI
     C                     MOVE *BLANKS   SMCRA
     C                     MOVE *BLANKS   SBRTT
     C                     MOVE *BLANKS   SCHIN
     C                     MOVE *BLANKS   SRTSP
     C                     MOVE *BLANKS   SSPIN
     C                     MOVE *BLANKS   SNIDT
     C                     MOVE *BLANKS   SIPFR
     C                     MOVE *BLANKS   SIFDY
     C                     MOVE *BLANKS   SCALC
     C                     MOVE *BLANKS   SIPRD
     C                     MOVE *BLANKS   SMARG
     C                     MOVE *BLANKS   SNEGV
     C                     MOVE *BLANKS   SWTRT
     C                     MOVE *BLANKS   SINTC
     C                     MOVE *BLANKS   SRDFC
     C                     MOVE *BLANKS   SADDI
     C                     MOVE *BLANKS   MCRAM                                               202917
      *
     C                     MOVE *BLANKS   SRLDT
     C                     MOVE *BLANKS   SRLFQ
     C                     MOVE *BLANKS   SRLDY
     C                     MOVE *BLANKS   SDFTP
     C                     MOVE *BLANKS   SDFST
     C                     MOVE *BLANKS   SPTFC                           120813
     C                     MOVE *BLANKS   SPTFT                           120813
     C                     MOVE *BLANKS   SPTFN                           120813
     C                     MOVE *BLANKS   SLNKS
     C                     MOVE *BLANKS   SASSN
     C                     MOVE *BLANKS   SREPT
     C                     MOVE *BLANKS   SRAMT
     C                     MOVE *BLANKS   SFCRA
     C                     MOVE *BLANKS   SNRPD
     C                     MOVE *BLANKS   SRFRQ
     C                     MOVE *BLANKS   SRDYN
     C                     MOVE *BLANKS   SBTIN
     C                     MOVE *BLANKS   SBLDY
     C/COPY WNCPYSRC,LE2030C090
     C                     MOVE *BLANKS   SPTDI
     C                     MOVE *BLANKS   SGDIN
     C                     MOVE *BLANKS   SGDPR
     C                     MOVE *BLANKS   SPDDI
      *
     C                     MOVE *BLANKS   SACOF
     C                     MOVE *BLANKS   SLIND
     C                     MOVE *BLANKS   SFEEI
     C                     MOVE *BLANKS   SORBR
     C                     MOVE *BLANKS   SCRSK
     C                     MOVE *BLANKS   SDOCI
     C                     MOVE *BLANKS   SBOKC
     C                     MOVE *BLANKS   SFRBC
     C                     MOVE *BLANKS   SSECI
     C                     MOVE *BLANKS   SORBR
     C                     MOVE *BLANKS   SPRFC
     C                     MOVE *BLANKS   SPTFR
     C                     MOVE *BLANKS   SNACD
     C                     MOVE *BLANKS   SACSQ
     C                     MOVE *BLANKS   SNAR1
     C                     MOVE *BLANKS   SFCXR
     C                     MOVE *BLANKS   SFMIN
     C                     MOVE *BLANKS   SNAR2
     C                     MOVE *BLANKS   SNAR3
     C                     MOVE *BLANKS   SBCXR
     C                     MOVE *BLANKS   SBMIN
     C                     MOVE *BLANKS   SNAR4
     C                     MOVE *BLANKS   SRECE
     C                     MOVE *BLANKS   SCOCU
     C                     MOVE *BLANKS   SFRSP
     C                     MOVE *BLANKS   SOMDT
     C                     MOVE *BLANKS   SFSGN
     C                     MOVE *BLANKS   SFPRC
      *
     C                     MOVE *BLANKS   SSPI1
     C                     MOVE *BLANKS   SSPI2
     C                     MOVE *BLANKS   SSPI3
     C/COPY WNCPYSRC,LE2030C082
      *                                                                   CLE011
     C           CLE011    IFEQ 'Y'                                       CLE011
     C                     MOVE *BLANKS   SRFDY                           CLE011
     C                     ENDIF                                          CLE011
      *                                                                                       CAS001
      ** When CAS001 enhancement is installed                                                 CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVE *BLANKS   #6YLDC                                              CAS001
     C                     MOVE *BLANKS   #6FYLD                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     MOVE *BLANKS   SADIF                                               CLE028
     C                     MOVE *BLANKS   SADCF                                               CLE028
     C                     MOVE *BLANKS   SCHGA                                               CLE028
     C                     MOVE *BLANKS   SICIF                                               CLE028
     C                     ENDIF                                                              CLE028
      *
      ** If CLE031 is on, initialise SFCPAM and SFCCY.                                        CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   SFCCY                                               CLE031
     C                     MOVE *BLANKS   SFCPAM                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE *BLANK    SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     MOVE *BLANK    SBASR                                               CLE036
     C                     MOVE '0'       WIN05                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE034
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SROTFM  -  Format screen for non-insert                       *
      * Called by: SRINSC - Format screen fields for processing       *
      * Calls    : None                                               *
      *****************************************************************
     C           SROTFM    BEGSR
      *
      ** Save current loan record to avoid being overridden
      ** Save transaction number of last update for record locking chec
      *
     C                     MOVELCURREF    MAINRF
     C                     MOVELCURRFK    MAINRK                                              220754
     C                     Z-ADDTNLU      WTNLU   50
      *                                                                                     AR847588
      ** Clear the interest sign before setting up the screen details.                      AR847588
      *                                                                                     AR847588
     C                     MOVE *BLANKS   INSGN                                             AR847588
     C/COPY WNCPYSRC,LEH00880
      *                                                                                       CLE028
     C                     MOVE 'N'       WPRCS1  1                                           CLE028
     C                     MOVE 'N'       WPRCS2  1                                           CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           *IN89     ANDEQ'0'                                                           CLE028
     C           RECI      ANDEQ'D'                                                           CLE028
     C           SACTN     ANDEQ'A'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           VDAT      ANDLTBJRDNB                                                        CLE028
     C           ORED      ANDNEBJRDNB                                                        CLE028
     C                     MOVE 'Y'       WPRCS1                                              CLE028
     C                     MOVE 'Y'       WPRCS2                                              CLE028
     C                     ENDIF                                                              CLE028
      *
      ** Set up fields for first detail screen
      *
      ** ... loan reference
      *
     C                     SELEC
     C           RECI      WHEQ 'M'                                       CLE005
     C                     MOVEL'LEL0496' ZAMSID                          CLE005
     C           LSTS      WHEQ 'C'
     C***********          MOVELWSTAT,1   SLSTS                           123998
     C                     MOVEL'LEL0098' ZAMSID                          123998
     C           LSTS      WHEQ 'R'
     C***********          MOVELWSTAT,2   SLSTS                           123998
     C                     MOVEL'LEL0086' ZAMSID                          123998
     C           LSTS      WHEQ 'A'
     C***********          MOVELWSTAT,3   SLSTS                           123998
     C                     MOVEL'LEL0087' ZAMSID                          123998
     C           LSTS      WHEQ 'D'
     C***********          MOVELWSTAT,4   SLSTS                           123998
     C                     MOVEL'LEL0088' ZAMSID                          123998
     C                     ENDSL
     C                     EXSR SRTEXT                                    123998
     C                     MOVELZAMSTX    SLSTS                           123998
     C                     MOVE *BLANKS   ZAMSID                          123998
      *
     C           PMODE     IFNE 'B'                                       121142
     C           PMODE     ANDNE'P'                                       121142
     C                     MOVE SALON     SLNRF
     C                     ENDIF                                          121142
     C           *IN21     IFEQ '1'
     C                     MOVELOLNO      SCUST
     C                     ELSE
     C                     MOVELCNUM      SCUST
     C                     ENDIF
     C                     MOVE FCUS      SFCUS
     C                     MOVE FTYP      SFTYP
     C                     MOVE FSEQ      SFSEQ
     C                     MOVE BRCA      SBRCA
     C                     MOVE LTYP      SLTYP
     C                     MOVE SUTP      SSUTP
     C                     MOVE *BLANKS   SMLNR                           124001
      *
     C                     SELEC
     C           *IN21     WHEQ '1'
     C***********          MOVE CNUM      SOLNO                           125184
     C                     MOVELCNUM      SPFRM                           125184
     C********** MLNR      IFNE *ZEROS                                                 124001 CLE148
     C           MLNR      IFNE *BLANKS                                                       CLE148
     C                     MOVE MLNR      SMLNR                           124001
     C                     ENDIF                                          124001
     C           *IN22     WHEQ '1'
     C                     MOVE OLNO      SOLNO
     C                     OTHER
     C                     MOVE *BLANKS   SOLNO
     C                     MOVE *BLANKS   SPFRM                           125184
     C                     ENDSL
      *                                                                                       CLE031
      ** If CLE031 is on, format facility currency and its principal amount.                  CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE SFCUS     WFCNUM                                              CLE031
     C                     MOVE SFTYP     WFFACT                                              CLE031
     C                     MOVE SFSEQ     WFFCNO                                              CLE031
     C                     MOVE 'A'       WFRCTP                                              CLE031
     C           WKFAC     CHAINFCLTY               N89                                       CLE031
     C           *IN89     IFEQ *ON                                                           CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'FCLTY   'DBFILE                                              CLE031
     C                     Z-ADD70        DBASE                                               CLE031
     C                     MOVELFCTREC    DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           MCCYF     IFEQ 'Y'                                                           CLE031
     C                     MOVE FCCY      PCURR                                               CLE031
     C                     CALL 'AOCURRR0'PPAR5                                               CLE031
     C           PRTCD     IFNE *BLANKS                                                       CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'SDCURRPD'DBFILE                                              CLE031
     C                     Z-ADD69        DBASE                                               CLE031
     C                     MOVELPCCY      DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE FCCY      SFCCY                                               CLE031
      *                                                                                       CLE031
     C                     MOVE *BLANKS   ZFLD15                                              CLE031
     C                     MOVE FPAM      ZFLD15                                              CLE031
     C                     Z-ADDA6NBDP    ZDECS                                               CLE031
     C                     MOVE 'L'       ZECODE                                              CLE031
     C                     EXSR ZFRPED                                                        CLE031
     C           ZNEG      IFEQ '-'                                                           CLE031
     C                     MOVE ZOUT21    SFCPAM                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE ZOUT20    SFCPAM                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *
      ** ... loan details
      *
     C                     MOVE CCY       PCURR
     C                     CALL 'AOCURRR0'PPAR5
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD15        DBASE            * DBERR 15 *
     C                     MOVELPCCY      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     MOVE CCY       SCURR
     C/COPY WNCPYSRC,LE2030C076
      *
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE CPAM      ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZFRPED
     C           ZNEG      IFEQ '-'
     C                     MOVE ZOUT21    SCPAM
     C                     ELSE
     C                     MOVE ZOUT20    SCPAM
     C                     ENDIF
     C/COPY WNCPYSRC,LE2030C077
      *
     C                     Z-ADDDDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SDDAT
     C                     MOVE AUTO      SAUTO
      *
     C                     Z-ADDVDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SVDAT
     C                     MOVE RCSI      SRCSI
      *
     C                     MOVE *BLANKS   SMDAT
     C           MDAT      IFNE *ZEROS
     C                     Z-ADDMDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SMDAT
     C                     MOVE ZDATE     SMDATW  6                                           218531
     C                     ENDIF
     C                     MOVE APMI      SAPMI
     C                     MOVE MCRA      SMCRA
      *                                                                                       CLE031
      ** If CLE031 is switched on..                                                           CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE FPAMH     SFCPAM                                              CLE031
     C                     ENDIF                                                              CLE031
      *
      ** ... rollover details
      *
     C                     MOVE *BLANKS   SRLDT
     C           RLDT      IFNE *ZEROS
     C                     MOVE RLDT      ZDAYNO
     C                     MOVE RLDT      W#RLDT                          125557
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SRLDT
     C                     ENDIF
     C                     MOVE RLFQ      SRLFQ
     C                     MOVE *BLANKS   SRLDY
     C           RLDY      IFNE *ZEROS
     C                     MOVE RLDY      SRLDY
     C                     ENDIF
      *                                                                   CLE011
      ** If CLE011 is installed, setup rollover fixed days                CLE011
      *                                                                   CLE011
     C           CLE011    IFEQ 'Y'                                       CLE011
     C                     MOVELRFDY      SRFDY                           CLE011
     C                     ENDIF                                          CLE011
     C/COPY WNCPYSRC,LE2030C099
      *                                                                                       CLE028
      ** If CLE028 is installed, setup Add on Interest, Add on Charges,                       CLE028
      ** Charge Amount, and Include Charges in Interest                                       CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
      *                                                                                       CLE028
     C                     MOVE ADIF      SADIF                                               CLE028
     C                     MOVE ADCF      SADCF                                               CLE028
     C                     MOVE ICIF      SICIF                                               CLE028
     C                     MOVE *BLANKS   ZFLD15                                              CLE028
     C                     MOVE CHGA      ZFLD15                                              CLE028
     C                     Z-ADDA6NBDP    ZDECS                                               CLE028
     C                     MOVE 'L'       ZECODE                                              CLE028
     C                     EXSR ZFRPED                                                        CLE028
     C           ZNEG      IFEQ '-'                                                           CLE028
     C                     MOVE ZOUT21    SCHGA                                               CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE ZOUT20    SCHGA                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
      *
      ** ... syndicated loan details
      *
     C                     MOVE DFTP      SDFTP
     C                     MOVE DFST      SDFST
     C                     MOVE LNKS      SLNKS
     C                     MOVE GASS      SASSN
     C                     MOVE *BLANKS   SPTFC                           120813
     C                     MOVE *BLANKS   SPTFT                           120813
     C                     MOVE *BLANKS   SPTFN                           120813
     C********** PTFC      IFNE *ZEROS                                                 120813 CSD027
     C           PTFC      IFNE *BLANKS                                                       CSD027
     C                     MOVE PTFC      SPTFC                           120813
     C                     MOVE PTFT      SPTFT                           120813
     C                     MOVE PTFN      SPTFN                           120813
     C                     ENDIF                                          120813
     C***********SACTN     IFEQ 'A'                                123295 125545
     C***********PCRFL     ANDNE*BLANKS                            123295 125545
     C***********          MOVE '1'       *IN47                    123295 125545
     C***********          ENDIF                                   123295 125545
      *
      ** Set up fields for second detail screen
      *
      ** ... interest details
      *
     C                     MOVE *BLANKS   SBRTT
     C                     MOVE *BLANK    SCHIN
     C           BRTT      IFNE *ZEROS
     C                     MOVE BRTT      SBRTT
     C***********          MOVE CHIN      SCHIN                           180654
     C                     ENDIF
     C                     MOVE CHIN      SCHIN                           180654
      *                                                                                       CLE036
      ** Set up Base rate field if CLE036 is installed                                        CLE036
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     MOVE *BLANKS   SBASR                                               CLE036
     C           BASR      IFNE *ZEROS                                                        CLE036
     C           BRTT      ANDEQ*ZEROS                                                        CLE036
     C                     MOVE *BLANKS   ZFIELD                                              CLE036
     C                     MOVE BRTE      ZFIELD                                              CLE036
     C                     Z-ADD7         ZADEC                                               CLE036
     C                     EXSR ZEDIT                                                         CLE036
     C                     MOVE ZFIELD    SBASR                                               CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *
     C                     MOVE *BLANKS   SRTSP
     C                     MOVE *BLANK    SSPIN
     C                     MOVE *BLANKS   SRSGN                                             AR847588
     C           RTSP      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
      *                                                                                     AR847588
      ** Put '-' on spread rate sign and get the reciprocal of spread                       AR847588
      ** if spread is negative. This is for display purposes.                               AR847588
      *                                                                                     AR847588
     C           RTSP      IFLT 0                                                           AR847588
     C                     Z-SUBRTSP      RTSP                                              AR847588
     C                     MOVE '-'       SRSGN                                             AR847588
     C                     ENDIF                                                            AR847588
      *                                                                                     AR847588
     C                     MOVE RTSP      ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SRTSP
     C                     MOVE SPIN      SSPIN
     C                     ENDIF
      *
     C                     MOVE *BLANKS   SNIDT
     C           NIDT      IFNE *ZEROS
     C                     MOVE NIDT      ZDAYNO
     C                     MOVE NIDT      W#NIDT                          125557
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SNIDT
     C                     ENDIF
     C                     MOVE IPFR      SIPFR
     C                     MOVE *BLANKS   SIFDY
     C           IFDY      IFNE *ZEROS
     C                     MOVE IFDY      SIFDY
     C                     ENDIF
      *
     C           ICBS      IFEQ *ZERO                                                         CLE028
     C                     MOVE *BLANKS   SCALC                                               CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE ICBS      SCALC
     C                     ENDIF                                                              CLE028
     C                     MOVE *BLANKS   ZFLD15
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C                     MOVE FLTI      ZFLD15                                              CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE TOTI      ZFLD15
     C                     ENDIF                                                              CLE028
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZFRPED
     C           ZNEG      IFEQ '-'
     C                     MOVE ZOUT21    SIPRD
     C                     ELSE
     C                     MOVE ZOUT20    SIPRD
     C                     ENDIF
      *
      ** To make sure negative indicator has a 'Y' value when             189591
      ** margin is less than zero                                         189591
      *                                                                   189591
     C                     MOVE *BLANKS   SNEGV                           189591
     C           MARG      IFLT *ZEROS                                    189591
     C                     MOVE 'Y'       SNEGV                           189591
     C                     Z-SUBMARG      MARG                            189591
     C                     ENDIF                                          189591
      *                                                                   189591
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE MARG      ZFIELD
     C                     Z-ADD5         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SMARG
     C**********           MOVE *BLANKS   SNEGV                           189591
     C********** MARG      IFLT *ZEROS                                    189591
     C**********           MOVE 'Y'       SNEGV                           189591
     C**********           ENDIF                                          189591
      *
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE WTRT      ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SWTRT
     C                     MOVE WTIN      SWTIN
      *
     C                     MOVE INTC      SINTC
     C                     MOVE RDFC      SRDFC
     C                     MOVE ADDI      SADDI
      *
      ** ... repayment details
      *
     C                     MOVE REPT      SREPT
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE RAMT      ZFLD15
     C                     MOVE 'L'       ZECODE
     C                     Z-ADDA6NBDP    ZDECS
     C                     EXSR ZFRPED
     C           ZNEG      IFEQ '-'
     C                     MOVE ZOUT21    SRAMT
     C                     ELSE
     C                     MOVE ZOUT20    SRAMT
     C                     ENDIF
     C                     MOVE SRAMT     W@RAMT                          125258
      *
      * For facility repayment amount need to retrieve fclty ccy not      127124
      * loan ccy for formatting amount.                                   127124
      *                                                                   127124
     C                     MOVE FCCY      PCURR                           127124
     C                     CALL 'AOCURRR0'PPAR5                           127124
     C           PRTCD     IFNE *BLANKS                                   127124
     C           *LOCK     IN   LDA                                       127124
     C                     MOVEL'SDCURRPD'DBFILE           ************   127124
     C**********           Z-ADD44        DBASE            **DBERR*44**   127124              204073
     C                     Z-ADD60        DBASE            * DBERR 60 *                       204073
     C                     MOVELFCCY      DBKEY            ************   127124
     C                     OUT  LDA                                       127124
     C                     EXSR *PSSR                                     127124
     C                     ENDIF                                          127124
      *                                                                   127124
      *
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE FCRA      ZFLD15
     C                     MOVE 'L'       ZECODE                          127124
     C                     Z-ADDA6NBDP    ZDECS                           127124
     C                     EXSR ZFRPED
     C           ZNEG      IFEQ '-'
     C                     MOVE ZOUT21    SFCRA
     C                     ELSE
     C                     MOVE ZOUT20    SFCRA
     C                     ENDIF
     C                     MOVE SFCRA     W@FCRA                          125258
     C                     MOVE *BLANKS   SNRPD
     C           NRPD      IFNE *ZEROS
     C                     Z-ADDNRPD      ZDAYNO
     C                     Z-ADDNRPD      W@NRPD                          125557
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SNRPD
     C                     ENDIF
     C                     MOVE RFRQ      SRFRQ
     C                     MOVE *BLANKS   SRDYN
     C           RDYN      IFNE *ZEROS
     C                     MOVE RDYN      SRDYN
     C                     ENDIF
      *
     C                     MOVE BTIN      SBTIN
     C                     MOVE *BLANKS   SBLDY
     C/COPY WNCPYSRC,LE2030C140
     C           BLDY      IFNE *ZEROS
     C                     MOVE BLDY      SBLDY
     C                     ENDIF
     C                     MOVE PTDI      SPTDI
     C                     MOVE *BLANKS   SGDIN
     C           GDIN      IFNE *ZEROS
     C                     MOVE GDIN      SGDIN
     C                     ENDIF
     C                     MOVE *BLANKS   SGDPR
     C           GDPR      IFNE *ZEROS
     C                     MOVE GDPR      SGDPR
     C                     ENDIF
     C                     MOVE PDDI      SPDDI
      *
      ** Set up fields for third detail screen
      *
      ** ... management information details
      *
     C                     MOVE ACOF      SACOF
     C                     MOVE *BLANKS   SLIND
     C********** LIND      IFNE *ZEROS                                                        CER020
     C           LOIC      IFNE *BLANKS                                                       CER020
     C**********           MOVE LIND      SLIND                                               CER020
     C                     MOVE LOIC      SLIND                                               CER020
     C                     ENDIF
      *
     C                     TESTB'2'       RELI           97
     C           *IN97     IFEQ '1'
     C                     MOVE 'Y'       SFEEI
     C                     ELSE
     C                     MOVE 'N'       SFEEI
     C                     ENDIF
      *
     C                     MOVE ORBR      SORBR
     C                     MOVE CRSK      SCRSK
     C                     TESTB'1'       RELI           97
     C           *IN97     IFEQ '1'
     C                     MOVE 'Y'       SDOCI
     C                     ELSE
     C                     MOVE 'N'       SDOCI
     C                     ENDIF
      *
     C                     MOVE BOKC      SBOKC
     C                     MOVE *BLANKS   SFRBC
     C           FRBC      IFNE *ZEROS
     C                     MOVE FRBC      SFRBC
     C                     ENDIF
     C                     TESTB'0'       RELI           97
     C           *IN97     IFEQ '1'
     C                     MOVE 'Y'       SSECI
     C                     ELSE
     C                     MOVE 'N'       SSECI
     C                     ENDIF
     C                     MOVE PRFC      SPRFC
      *
      ** ... convert portfolio reference '9997' if necessary
      ** Set it protected if amend and original entry date not
      ** equal to rundate
      ** Portfolio reference is not available for participations
      *
     C           *IN23     IFEQ '0'
     C                     MOVE *BLANKS   SPTFR
     C           PTFR      IFNE *BLANKS
     C           PTFR      IFNE '9997'
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE PTFR      SPTFR
     C                     ELSE
     C                     MOVE FCR997    SPTFR
     C                     ENDIF
     C                     ENDIF
     C           SACTN     IFEQ 'A'
     C           ORED      ANDNEBJRDNB
     C                     MOVE '1'       *IN23
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVE NACD      SNACD
     C                     MOVE LASQ      SACSQ
      *
      ** ... loan description and rates information
      *
     C                     MOVE NAR1      SNAR1
     C                     MOVE NAR2      SNAR2
     C                     MOVE NAR3      SNAR3
     C                     MOVE NAR4      SNAR4
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE FCXR      ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SFCXR
     C                     MOVE FMDI      SFMIN
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE BCXR      ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SBCXR
     C                     MOVE BMDI      SBMIN
      *
     C                     MOVE *BLANKS   SRECE
     C           *IN24     IFEQ '1'
     C********** RECE      IFNE *ZEROS                                                        CSD027
     C           RECE      IFNE *BLANKS                                                       CSD027
     C                     MOVELRECE      SRECE
     C                     ENDIF
     C                     ENDIF
      *
      ** ... BLI lending enhancement fields
      *
     C           S01465    IFEQ 'Y'
     C                     MOVE *BLANKS   SCOCU
     C********** COCU      IFNE *ZEROS                                                        CSD027
     C           COCU      IFNE *BLANKS                                                       CSD027
     C                     MOVE COCU      SCOCU
     C                     ENDIF
     C                     MOVE *BLANKS   SOMDT
     C           OMDT      IFNE *ZEROS
     C                     Z-ADDOMDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SOMDT
     C                     ENDIF
     C                     ENDIF
      *
      ** Analytical accounting fields
      *
     C                     MOVE *BLANKS   SFRSP                                               200031
     C                     MOVE *BLANKS   SFSGN                                               200031
     C                     MOVE *BLANKS   SFPRC                                               200031
      *                                                                                       200031
     C           BGN0ST    IFEQ 'Y'
     C           CDE002    OREQ 'Y'                                       CDE002
     C           PTYP      ANDLT70                                                            208221
     C           PTYP      IFEQ 61
     C           PTYP      OREQ 62
     C           PTYP      OREQ 64
     C           PTYP      OREQ 66
     C           PTYP      OREQ 68                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      OREQ 69                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      OREQ 63                                        CDE002
     C           CDE002    ANDEQ'Y'                                       CDE002
     C           PTYP      OREQ 65                                        CDE002
     C           CDE002    ANDEQ'Y'                                       CDE002
     C           PTYP      OREQ 67                                        CDE002
     C           CDE002    ANDEQ'Y'                                       CDE002
      *
     C           ORED      IFNE BJRDNB
     C                     MOVE 'Y'       WFUNP
     C                     ENDIF
     C**********           MOVE *BLANKS   SFRSP                                               200031
     C           FSRP      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE FSRP      ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SFRSP
     C                     ENDIF
     C                     MOVE FSGN      SFSGN
     C                     MOVE FPRC      SFPRC
      *
     C                     ELSE
     C                     MOVE '0'       *IN96
     C                     ENDIF
     C                     ENDIF
      *
      ** Set up fields for third detail screen
      *
     C                     MOVE SPI1      SSPI1
     C                     MOVE SPI2      SSPI2
     C                     MOVE SPI3      SSPI3
      *                                                                                       CAS001
      ** When CAS001 enhancement is installed                                                 CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVE FSYLDC    #6YLDC                                              CAS001
     C                     MOVE FSFYLD    #6FYLD                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE STAL      SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C/COPY WNCPYSRC,LE2030C083
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRPLSC  -  Format screen fields from test harness file when   *
      *            in play mode                                       *
      * Called by: SRBTCH - Batch processing                          *
      * Calls    : None                                               *
      *****************************************************************
     C           SRPLSC    BEGSR
      *
      ** Save current loan record to avoid being overridden
      ** Save transaction number of last update for record locking chec
      *
     C           SACTN     IFNE 'I'
     C                     MOVELCURREF    MAINRF
     C                     MOVELCURRFK    MAINRK                                              220754
     C                     Z-ADDTNLU      WTNLU   50
     C/COPY WNCPYSRC,LE2030C103
     C                     ENDIF
      *
      ** Set up fields for first detail screen
      *
      ** ... loan reference
      *
     C           *IN21     IFEQ '1'
     C                     MOVE ORGB      SCUST
     C                     MOVE MLNRH     SMLNR                           124001
     C                     ELSE
     C                     MOVE CNMR      SCUST
     C                     ENDIF
     C                     MOVE FCUSH     SFCUS
     C                     MOVELFCTN      SFTYP
     C                     MOVE FCTN      SFSEQ
     C                     MOVE BRCA      SBRCA
     C                     MOVE LTYP      SLTYP
     C                     MOVE SUTP      SSUTP
     C                     MOVE *BLANKS   SOLNO
     C           *IN21     IFEQ '1'
     C                     MOVELOLNOH     SPFRM                           125184
     C                     ENDIF                                          125184
     C************IN22     OREQ '1'                                       125184
     C           *IN22     IFEQ '1'                                       125184
     C                     MOVE OLNOH     SOLNO
     C                     ENDIF
      *
      ** ... loan details
      *
     C                     MOVE CCY       SCURR
     C                     MOVE CPAMH     SCPAM
     C                     MOVE DDATH     SDDAT
     C                     MOVE RCSI      SRCSI
     C                     MOVE AUTO      SAUTO
     C                     MOVE STDTH     SVDAT
     C                     MOVE MDATH     SMDAT
     C                     MOVE APMI      SAPMI
     C                     MOVE MCRA      SMCRA
      *                                                                                       CLE031
      ** If CLE031 is switched on..                                                           CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE FPAMH     SFCPAM                                              CLE031
     C                     ENDIF                                                              CLE031
      *
      ** ... rollover details
      *
     C                     MOVE RLDTH     SRLDT
     C                     MOVE RLFQ      SRLFQ
     C                     MOVE RLDYH     SRLDY
      *                                                                   CLE011
      ** Setup rollover fix days if CLE011 is installed                   CLE011
      *                                                                   CLE011
     C           CLE011    IFEQ 'Y'                                       CLE011
     C                     MOVE RFDY      SRFDY                           CLE011
     C                     ENDIF                                          CLE011
      *                                                                                       CLE028
      ** If CLE028 is installed, setup Add on Interest, Add on Charges,                       CLE028
      ** Charge Amount, and Include Charges in Interest                                       CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
      *                                                                                       CLE028
     C                     MOVE ADIF      SADIF                                               CLE028
     C                     MOVE ADCF      SADCF                                               CLE028
     C                     MOVE ICIF      SICIF                                               CLE028
     C                     MOVE *BLANKS   ZFLD15                                              CLE028
     C                     MOVE CHGA      ZFLD15                                              CLE028
     C                     Z-ADDA6NBDP    ZDECS                                               CLE028
     C                     MOVE 'L'       ZECODE                                              CLE028
     C                     EXSR ZFRPED                                                        CLE028
     C           ZNEG      IFEQ '-'                                                           CLE028
     C                     MOVE ZOUT21    SCHGA                                               CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE ZOUT20    SCHGA                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
      *
      ** ... syndicated loan details
      *
     C                     MOVE DFTP      SDFTP
     C                     MOVE DFST      SDFST
     C                     MOVE LNKS      SLNKS
     C                     MOVE GASS      SASSN
      *
      ** Set up fields for second detail screen
      *
      ** ... interest details
      *
     C                     MOVE *BLANKS   SBRTT
     C                     MOVE *BLANKS   SCHIN
     C           BRTTH     IFNE *BLANKS
     C           BRTTH     ANDNE'00'
     C                     MOVE BRTTH     SBRTT
     C***********          MOVE CHIN      SCHIN                           180654
     C                     ENDIF
     C                     MOVE CHIN      SCHIN                           180654
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     MOVE BASRH     SBASR                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     MOVE RTSPH     SRTSP
     C                     MOVE SPIN      SSPIN
     C                     MOVE NIDTH     SNIDT
     C                     MOVE IPFR      SIPFR
     C                     MOVE IFDYH     SIFDY
     C                     MOVE CALCH     SCALC
     C                     MOVE DISC      SIPRD
     C                     MOVE MARGH     SMARG
     C                     MOVE NEGV      SNEGV
     C                     MOVE WTRTH     SWTRT
     C                     MOVE WTIN      SWTIN
     C                     MOVE INTC      SINTC
     C           SNIDT     IFEQ *BLANKS
     C                     MOVE *BLANKS   SINTC
     C                     ENDIF
     C                     MOVE RCFC      SRDFC
     C                     MOVE ADDI      SADDI
      *
      ** ... repayment details
      *
     C                     MOVE REPTH     SREPT
     C                     MOVE RPAM      SRAMT
     C                     MOVE FCRAH     SFCRA
     C                     MOVE RPDT      SNRPD
     C                     MOVE RPFQ      SRFRQ
     C                     MOVE RPDY      SRDYN
     C                     MOVE BTIN      SBTIN
     C                     MOVE BLDYH     SBLDY
     C                     MOVE PTDI      SPTDI
     C                     MOVE GDINH     SGDIN
     C                     MOVE GDPRH     SGDPR
     C                     MOVE PDDI      SPDDI
      *
      ** Set up fields for third detail screen
      *
      ** ... management information details
      *
     C                     MOVE ACOF      SACOF
     C**********           MOVE LINDH     SLIND                                               CER020
     C                     MOVE LOICH     SLIND                                               CER020
     C                     MOVE FEEI      SFEEI
     C                     MOVE ORBR      SORBR
     C                     MOVE CRSK      SCRSK
     C                     MOVE DOCI      SDOCI
     C                     MOVE BOKC      SBOKC
     C                     MOVE FRBCH     SFRBC
     C                     MOVE SECI      SSECI
     C                     MOVE PRFC      SPRFC
      *
      ** ... convert portfolio reference '9997' if necessary
      *
     C                     MOVE *BLANKS   SPTFR
     C           PTFR      IFNE *BLANKS
     C           PTFR      IFNE '9997'
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE PTFR      SPTFR
     C                     ELSE
     C                     MOVE FCR997    SPTFR
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVE NACD      SNACD
     C                     MOVE LASQH     SACSQ
      *
      ** ... loan description and rates information
      *
     C                     MOVE NARR1     SNAR1
     C                     MOVE NARR2     SNAR2
     C                     MOVE NARR3     SNAR3
     C                     MOVE NARR4     SNAR4
     C                     MOVE FCXRH     SFCXR
     C                     MOVE FMIN      SFMIN
     C                     MOVE BCXRH     SBCXR
     C                     MOVE BMIN      SBMIN
      *
     C                     MOVE RECEH     SRECE
     C                     MOVE COCUH     SCOCU
     C                     MOVE FRSP      SFRSP
     C                     MOVE FSGN      SFSGN
     C                     MOVE FPRC      SFPRC
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE STAL      SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CAS001
      ** When CAS001 enhancement is installed                                                 CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVE FSYLDC    #6YLDC                                              CAS001
     C                     MOVE FSFYLD    #6FYLD                                              CAS001
     C                     ENDIF                                                              CAS001
      *
      ** Set up fields for last detail screen
      *
     C                     MOVE SPI1      SSPI1
     C                     MOVE SPI2      SSPI2
     C                     MOVE SPI3      SSPI3
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRBTSC  -  Format screen fields from transmitted message      *
      *            when in batch mode                                 *
      * Called by: SRBTCH - Batch processing                          *
      * Calls    : None                                               *
      *****************************************************************
     C           SRBTSC    BEGSR
      *
      ** Save current loan record to avoid being overridden
      ** Save transaction number of last update for record locking chec
      *
     C           SACTN     IFNE 'I'
     C                     MOVELCURREF    MAINRF
     C                     MOVELCURRFK    MAINRK                                              220754
     C                     Z-ADDTNLU      WTNLU   50
     C/COPY WNCPYSRC,LE2030C105
     C                     ENDIF
     C/COPY WNCPYSRC,LE2030C104
      *
      ** Set up fields for first detail screen
      *
     C           *IN21     IFEQ '1'
     C                     MOVELPORGB     SCUST
     C                     ELSE
     C                     MOVELPCNMR     SCUST
     C                     ENDIF
      *
     C                     MOVE *BLANKS   SFCUS
     C           PFCUS     IFNE '000000'
     C                     MOVE PFCUS     SFCUS
     C                     ENDIF
     C                     MOVE *BLANKS   SFTYP
     C           PFACT     IFNE '000'
     C                     MOVE PFACT     SFTYP
     C                     ENDIF
     C                     MOVE *BLANKS   SFSEQ
     C           PFCNO     IFNE '00'
     C                     MOVE PFCNO     SFSEQ
     C                     ENDIF
      *
     C                     MOVE PBRCH     SBRCA
     C                     MOVE PLTYP     SLTYP
     C                     MOVE PSUTP     SSUTP
     C                     SELEC
     C           *IN21     WHEQ '1'
     C***********          MOVE PCNMR     SOLNO                           125184
     C                     MOVELPCNMR     SPFRM                           125184
     C                     MOVE PORLN     SMLNR                           124001
     C           *IN22     WHEQ '1'
     C                     MOVE PORLN     SOLNO
     C                     OTHER
     C                     MOVE *BLANKS   SOLNO
     C                     MOVE *BLANKS   SPFRM                           125184
     C                     ENDSL
      *
      ** ... loan details
      *
     C                     MOVE PCCY      SCURR
     C                     MOVE PCPAM     SCPAM
     C                     MOVE PRCSI     SRCSI
     C                     MOVE PAUTO     SAUTO
     C                     MOVE PAPMI     SAPMI
     C                     MOVE PMCRA     SMCRA
      *                                                                                       CLE031
      ** If CLE031 is switched on..                                                           CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE N1FPAM    SFCPAM                                              CLE031
     C                     ENDIF                                                              CLE031
      *
     C                     MOVE PDDAT     ZWYYYY
     C           BJDFIN    IFEQ 'M'
     C                     MOVE PDDT1     ZWMTH
     C                     MOVE PDDT2     ZWDAY
     C                     ELSE
     C                     MOVE PDDT1     ZWDAY
     C                     MOVE PDDT2     ZWMTH
     C                     ENDIF
     C                     EXSR ZDAT10
     C                     Z-ADDZZMDNO    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SDDAT
      *
     C                     MOVE PSTDT     ZWYYYY
     C           BJDFIN    IFEQ 'M'
     C                     MOVE PSDT1     ZWMTH
     C                     MOVE PSDT2     ZWDAY
     C                     ELSE
     C                     MOVE PSDT1     ZWDAY
     C                     MOVE PSDT2     ZWMTH
     C                     ENDIF
     C                     EXSR ZDAT10
     C                     Z-ADDZZMDNO    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SVDAT
      *
     C                     MOVE *BLANKS   SMDAT
     C           PMDAT     IFNE *BLANKS
     C                     MOVE PMDAT     ZWYYYY
     C           BJDFIN    IFEQ 'M'
     C                     MOVE PMDT1     ZWMTH
     C                     MOVE PMDT2     ZWDAY
     C                     ELSE
     C                     MOVE PMDT1     ZWDAY
     C                     MOVE PMDT2     ZWMTH
     C                     ENDIF
     C                     EXSR ZDAT10
     C                     Z-ADDZZMDNO    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SMDAT
     C                     ENDIF
      *
      ** ... rollover details
      *
     C                     MOVE *BLANKS   SRLDT
     C           PRLDT     IFNE *BLANKS
     C                     MOVE PRLDT     ZWYYYY
     C           BJDFIN    IFEQ 'M'
     C                     MOVE PRDT1     ZWMTH
     C                     MOVE PRDT2     ZWDAY
     C                     ELSE
     C                     MOVE PRDT1     ZWDAY
     C                     MOVE PRDT2     ZWMTH
     C                     ENDIF
     C                     EXSR ZDAT10
     C                     Z-ADDZZMDNO    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SRLDT
     C                     ENDIF
      *
     C                     MOVE PRLFQ     SRLFQ
     C                     MOVE *BLANKS   SRLDY
     C           PRLDY     IFNE '00'
     C                     MOVE PRLDY     SRLDY
     C                     ENDIF
      *                                                                   CLE011
      ** Setup rollover fix days if CLE011 is installed                   CLE011
      *                                                                   CLE011
     C           CLE011    IFEQ 'Y'                                       CLE011
     C                     MOVE PRFDY     SRFDY                           CLE011
     C                     ENDIF                                          CLE011
     C/COPY WNCPYSRC,LE2030C100
      *                                                                                       CLE028
      ** If CLE028 is installed, setup Add on Interest, Add on Charges,                       CLE028
      ** Charge Amount, and Include Charges in Interest                                       CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
      *                                                                                       CLE028
     C                     MOVE PADIF     SADIF                                               CLE028
     C                     MOVE PADCF     SADCF                                               CLE028
     C                     MOVE PICIF     SICIF                                               CLE028
     C                     MOVE PCHGA     SCHGA                                               CLE028
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
      *
      ** ... syndicated loan details
      *
     C                     MOVE PDFTP     SDFTP
     C                     MOVE PDFST     SDFST
     C                     MOVE PLNKS     SLNKS
     C                     MOVE PGASS     SASSN
      *
      ** Set up fields for second detail screen
      *
      ** ... interest details
      *
     C                     MOVE *BLANKS   SBRTT
     C                     MOVE *BLANKS   SCHIN
     C           PBRTT     IFNE *BLANKS
     C           PBRTT     ANDNE'00'
     C                     MOVE PBRTT     SBRTT
     C***********          MOVE PCHIN     SCHIN                           180654
     C                     MOVE PCHIN     SCHIN                                               223619
     C                     ENDIF
     C**********           MOVE PCHIN     SCHIN                                        180654 223619
     C                     MOVE PRTSP     SRTSP
     C                     MOVE PSPIN     SSPIN
      *                                                                                       CLE036
      ** Blank out specific base rate if not zeros                                            CLE036
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     MOVE N1BASR    SBASR                                               CLE036
     C                     Z-ADD*ZEROS    WBASR  117                                          CLE036
     C                     MOVE *BLANKS   PSCRF                                               CLE036
     C                     MOVE SBASR     PSCRF                                               CLE036
     C                     Z-ADD4         PNDIG                                               CLE036
     C                     Z-ADD7         PNDEC                                               CLE036
     C                     CALL 'ZALIGN'  PPAR1                                               CLE036
     C                     MOVE PRVAL     WBASR                                               CLE036
     C           WBASR     IFEQ *ZEROS                                                        CLE036
     C           PRTCD     ANDEQ*BLANKS                                                       CLE036
     C                     MOVE *BLANKS   SBASR                                               CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *
     C                     MOVE *BLANKS   SNIDT
     C           PINDT     IFNE *BLANKS
     C                     MOVE PINDT     ZWYYYY
     C           BJDFIN    IFEQ 'M'
     C                     MOVE PIDT1     ZWMTH
     C                     MOVE PIDT2     ZWDAY
     C                     ELSE
     C                     MOVE PIDT1     ZWDAY
     C                     MOVE PIDT2     ZWMTH
     C                     ENDIF
     C                     EXSR ZDAT10
     C                     Z-ADDZZMDNO    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SNIDT
     C                     ENDIF
      *
     C                     MOVE PINFQ     SIPFR
     C                     MOVE *BLANKS   SIFDY
     C           SIFDY     IFNE '00'
     C                     MOVE PINDY     SIFDY
     C                     ENDIF
      *
     C                     MOVE PCALC     SCALC
     C                     MOVE *BLANKS   SIPRD
     C                     MOVE PMARG     SMARG
     C                     MOVE PNEGV     SNEGV
     C                     MOVE PWTRT     SWTRT
     C                     MOVE PWTIN     SWTIN
     C                     MOVE PINTC     SINTC
     C           SNIDT     IFEQ *BLANKS
     C                     MOVE *BLANKS   SINTC
     C                     ENDIF
     C                     MOVE PRCFC     SRDFC
     C                     MOVE PADDI     SADDI
      *
      ** ... repayment details
      *
     C                     MOVE PRPAM     SRAMT
     C                     MOVE PREPT     SREPT
     C                     MOVE PFCRA     SFCRA
      *                                                                   125258
      * Set up field for validation for batch mode                        125258
     C           SACTN     IFEQ 'I'                                       125258
     C***********          MOVE '0.00'    W@FCRA                    125258157675
     C***********          MOVE '0.00'    W@RAMT                    125258157675
     C                     MOVE PFCRA     W@FCRA                          157675
     C                     MOVE PRPAM     W@RAMT                          157675
     C                     ENDIF                                          125258
      *                                                                   125258
      * Format values from cloancl for amend                              125258
     C           SACTN     IFEQ 'A'                                       125258
     C                     MOVE W#CCY     PCURR                           125258
     C                     CALL 'AOCURRR0'PPAR5                           125258
     C           PRTCD     IFNE *BLANKS                                   125258
     C           *LOCK     IN   LDA                                       125258
     C                     MOVEL'SDCURRPD'DBFILE           ************   125258
     C                     Z-ADD45        DBASE            * DBERR 45 *   125258
     C                     MOVELW#CCY     DBKEY            ************   125258
     C                     OUT  LDA                                       125258
     C                     EXSR *PSSR                                     125258
     C                     ENDIF                                          125258
      *                                                                   125258
     C                     MOVE *BLANKS   ZFLD15                          125258
     C                     MOVE W@RAMT    ZFLD15                          125258
     C                     MOVE 'L'       ZECODE                          125258
     C                     Z-ADDA6NBDP    ZDECS                           125258
     C                     EXSR ZFRPED                                    125258
     C           ZNEG      IFEQ '-'                                       125258
     C                     MOVE ZOUT21    W@RAMT                          125258
     C                     ELSE                                           125258
     C                     MOVE ZOUT20    W@RAMT                          125258
     C                     ENDIF                                          125258
      *                                                                   125258
     C                     MOVE W#FCY     PCURR                           125258
     C                     CALL 'AOCURRR0'PPAR5                           125258
     C           PRTCD     IFNE *BLANKS                                   125258
     C           *LOCK     IN   LDA                                       125258
     C                     MOVEL'SDCURRPD'DBFILE           ************   125258
     C                     Z-ADD46        DBASE            * DBERR 46 *   125258
     C                     MOVELW#FCY     DBKEY            ************   125258
     C                     OUT  LDA                                       125258
     C                     EXSR *PSSR                                     125258
     C                     ENDIF                                          125258
      *                                                                   125258
     C                     MOVE *BLANKS   ZFLD15                          125258
     C                     MOVE W@FCRA    ZFLD15                          125258
     C                     MOVE 'L'       ZECODE                          125258
     C                     Z-ADDA6NBDP    ZDECS                           125258
     C                     EXSR ZFRPED                                    125258
     C           ZNEG      IFEQ '-'                                       125258
     C                     MOVE ZOUT21    W@FCRA                          125258
     C                     ELSE                                           125258
     C                     MOVE ZOUT20    W@FCRA                          125258
     C                     ENDIF                                          125258
     C                     ENDIF                                          125258
      *
     C                     MOVE *BLANKS   SNRPD
     C           PRPDT     IFNE *BLANKS
     C                     MOVE PRPDT     ZWYYYY
     C           BJDFIN    IFEQ 'M'
     C                     MOVE PPDT1     ZWMTH
     C                     MOVE PPDT2     ZWDAY
     C                     ELSE
     C                     MOVE PPDT1     ZWDAY
     C                     MOVE PPDT2     ZWMTH
     C                     ENDIF
     C                     EXSR ZDAT10
     C                     Z-ADDZZMDNO    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SNRPD
     C                     ENDIF
      *
     C                     MOVE PRPFQ     SRFRQ
     C                     MOVE *BLANKS   SRDYN
     C           PRPDY     IFNE '00'
     C                     MOVE PRPDY     SRDYN
     C                     ENDIF
      *
     C                     MOVE PBTIN     SBTIN
     C                     MOVE PBLDY     SBLDY
     C                     MOVE PPTDI     SPTDI
     C                     MOVE PGDIN     SGDIN
     C                     MOVE PGDPR     SGDPR
     C                     MOVE PPDDI     SPDDI
      *
      ** Set up fields for third detail screen
      *
      ** ... management information details
      *
     C                     MOVE PACOF     SACOF
     C                     MOVE *BLANKS   SLIND
     C           PLIND     IFNE '000'
     C                     MOVE PLIND     SLIND
     C                     ENDIF
     C                     MOVE PFEEI     SFEEI
     C                     MOVE PORBR     SORBR
     C                     MOVE PCRSK     SCRSK
     C                     MOVE PDOCI     SDOCI
     C                     MOVE PBOKC     SBOKC
     C                     MOVE *BLANKS   SFRBC
     C           PFRBC     IFNE '00000'
     C                     MOVE PFRBC     SFRBC
     C                     ENDIF
     C                     MOVE PSECI     SSECI
     C                     MOVE PPRFC     SPRFC
     C                     MOVE PNACD     SNACD
     C                     MOVE PLASQ     SACSQ
      *
      ** ... convert portfolio reference '9997' if necessary
      *
     C                     MOVE *BLANKS   SPTFR
     C           PPTFR     IFNE *BLANKS
     C           PPTFR     IFNE '9997'
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE PPTFR     SPTFR
     C                     ELSE
     C                     MOVE FCR997    SPTFR
     C                     ENDIF
     C                     ENDIF
      *
      ** ... loan description and rates information
      *
     C                     MOVE PNAR1     SNAR1
     C                     MOVE PNAR2     SNAR2
     C                     MOVE PNAR3     SNAR3
     C                     MOVE PNAR4     SNAR4
     C                     MOVE PFCXR     SFCXR
     C                     MOVE PFMIN     SFMIN
     C                     MOVE PBCXR     SBCXR
     C                     MOVE PBMIN     SBMIN
     C                     MOVE *BLANKS   SRECE
     C           PRECE     IFNE '000000'
     C                     MOVE PRECE     SRECE
     C                     ENDIF
     C                     MOVE *BLANKS   SCOCU
     C           PCOCU     IFNE '000000'
     C                     MOVE PCOCU     SCOCU
     C                     ENDIF
     C                     MOVE PFRSP     SFRSP
     C                     MOVE PFSGN     SFSGN
     C                     MOVE PFPRC     SFPRC
      *
      ** Set up fields for the last detail screen
      *
     C                     MOVE PSPI1     SSPI1
     C                     MOVE PSPI2     SSPI2
     C                     MOVE PSPI3     SSPI3
      *                                                                                       CAS001
      ** When CAS001 enhancement is installed                                                 CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVE PYLDC     #6YLDC                                              CAS001
     C                     MOVE PFYLD     #6FYLD                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE N1STAL    SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
      *
      ** Set up returned message format
      *
     C                     CLEARPOUTP
     C                     MOVE PMTYP     PRMTP
     C                     MOVE PTUSR     PRTUS
     C                     MOVE PTWID     PRTWS
     C                     MOVE PTREF     PRTRF
     C                     MOVE PTSEQ     PRTSQ
     C                     MOVE PTACT     PRTAC
     C                     MOVE PTDAT     PRTDT
     C                     MOVE PTTIM     PRTTM
     C                     MOVE PNPAR     PRPAR
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRINSR  -  Insert new records                                 *
      * Called by: Main processing                                    *
      *            SRBTCH - Batch processing                          *
      * Calls    : SRDATA - Set up output fields for files            *
      *            SRLONL - Format CLOAN A record for update          *
      *            SRLONK - Format CLOAN B record for update          *
      *            SRTEST - Write to test harness file                *
      *            SRRELL - Update related loan for parts sold        *
      *            SRTLOG - Chain to LTRIX header                     *
      *            SRFCLT - Update facilities file                    *
      *            SRLREF - Update LEREF record                       *
      *            SRTRIX - Update transaction index                  *
      *            SRLFMT - Format CLOAN file fields                  *
      *            SRSHDW - Update shadow files                       *
      *            SRFEES - Update Fees file                          *   CLE009
      *****************************************************************
     C           SRINSR    BEGSR
      *
     C                     CLEARCLOANCLF
     C                     CLEARCLOANCKF
     C                     EXSR SRDATA
     C/COPY WNCPYSRC,LE2030C015
      *
      ** Get the next available loan number
      ** if SLNRF still blank at this stage                               190420
      *
     C           SLNRF     IFEQ *BLANKS                                   190420
     C**********           Z-ADDWRANG     PRANG                           168270
     C**********           MOVE WRANG     PRANG                    168270 190420
     C                     MOVELWRANG     PRANG                           190420
     C                     MOVELPRANG     PRANGW  20                      190420
     C                     MOVE PRANG     WWRANG  2                       190420
     C           PRANGW    IFLT 10                                        190420
     C                     MOVEL' '       WWRANG                          190420
     C                     END                                            190420
     C                     CALL 'AOLENOU0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY'    POPTN
     C                     PARM           PRANG
     C/COPY WNCPYSRC,LE2030C051
     C           SDLENO    PARM SDLENO    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDLENOPD'DBFILE           ************
     C**********           Z-ADD29        DBASE            **DBERR*29**                       204073
     C                     Z-ADD61        DBASE            * DBERR 61 *                       204073
     C                     MOVELWRANG     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C********** F9NALN    SUB  1         F9NALN                                       204073 CLE148
     C**********           MOVE F9NALN    SLNRF                                               CLE148
     C**********           Z-ADDF9NALN    WNALN   60                                   CLE005 CLE148
     C                     MOVE F9NALA    SLNRF                                               CLE148
     C                     MOVELF9NALA    WNALN   6                                           CLE148
     C                     MOVE WNALN     SLNRF                           CLE005
     C                     ENDIF                                          190420
      *                                                                   190420
     C/COPY WNCPYSRC,LE2030C012
      *                                                                                       CSD015
      ** Check if WATCH LIST CHECKING ENGINE PROGRAM must be called.                          CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       WATCH   1                                           CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
     C                     EXSR SRCHCK                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *
      ** Write CLOAN A and CLOAN B records
      *****************************************************************                CAS009 232314
     C***********CAS009    IFEQ 'Y'                                                    CAS009 232314
      *****************************************************************                CAS009 232314
      ***Update*Total*Fees/Discount/Premium*if*Discounted*Loan*********                CAS009 232314
      *****************************************************************                CAS009 232314
     C***********WLNPT     IFEQ 63                                                     CAS009 232314
     C***********WLNPT     OREQ 65                                                     CAS009 232314
     C***********WLNPT     OREQ 67                                                     CAS009 232314
     C***********          Z-ADDWTOTI     TFDP                                         CAS009 232314
     C***********          Z-ADDWTOTI     TFDPA                                        CAS009 232314
     C***********          ENDIF                                                       CAS009 232314
      *****************************************************************                CAS009 232314
     C***********          ENDIF                                                       CAS009 232314
      *
     C                     EXSR SRLONL
     C***********          WRITECLOANCLF               89                 157761
      *                                                                                       CSD015
      ** Call WATCH LIST CHECKING ENGINE PROGRAM.                                             CSD015
      *                                                                                       CSD015
     C           WATCH     IFEQ 'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     WRITECLOANCLF                                  157761
      *                                                                                       261338
     C           PMODE     IFEQ 'B'                                                           261338
     C                     MOVE LNRF      LQLNRF                                              261338
     C                     MOVE BRCA      LQBRCA                                              261338
     C                     MOVE FRNT      LQFRID                                              261338
     C                     WRITECLONLQD0                                                      261338
     C                     MOVE A8ZONE    ZONE                                              AR705865
     C                     MOVE LNRF      DDLNRF                                            AR705865
     C                     WRITETGZCLPD0                                                    AR705865
     C                     ENDIF                                                              261338
      *                                                                                       261338
     C/COPY WNCPYSRC,LE2030C141
     C                     EXSR SRLONK
     C***********          WRITECLOANCKF               89                 157761
     C                     WRITECLOANCKF                                  157761
     C                     MOVELCURREF    MAINRF
     C                     MOVELCURRFK    MAINRK                                              220754
      *                                                                                       CLE034
      ** Update the Settlement Allocations table                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
     C           SACTN     ANDEQ'I'                                                           CLE034
     C           WNOKEY    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALU0'                                                    CLE034
     C                     PARM PMODE     PRTCD                                               CLE034
     C                     PARM 'LOAN'    PLTYPE                                              CLE034
     C                     PARM 'U'       PACTN   1                                           CLE034
     C                     PARM           SLNRF                                               CLE034
     C                     PARM *ZEROS    PLAVDT                                              CLE034
     C                     PARM *ZEROS    PLASEQ                                              CLE034
     C                     PARM *ZEROS    PCUSTF                                              CLE034
     C                     PARM *ZEROS    PFACIF                                              CLE034
     C                     PARM *ZEROS    PFEESQ                                              CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM           PCRFL                                               CLE034
      *                                                                                       CLE034
     C           PRTCD     IFEQ '*ERROR '                                                     CLE034
     C           PRTCD     OREQ '*NRF   '                                                     CLE034
     C           PRTCD     OREQ '*ACTION'                                                     CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVEL'LESTALPD'DBFILE                                              CLE034
     C                     MOVELPTMST     DBKEY                                               CLE034
     C                     Z-ADD73        DBASE                                               CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
     C/COPY WNCPYSRC,LE2030C069
      *
      ** Update related loan record for parts sold
      ** or an internal parts purchased                                   124001
      *
     C           *IN22     IFEQ '1'
     C           *IN21     OREQ '1'                                       124001
     C********** MLNR      ANDNE*ZEROS                                                 124001 CLE148
     C           MLNR      ANDNE*BLANKS                                                       CLE148
     C                     EXSR SRRELL
     C                     ENDIF
      *
      ** Update FCLTY, LEREF, LTRIX, CLOAN trailer
      ** Update LTRIX only when loan is authorised upon insert
      *
      ** Obtain last transaction number                                   186431
      *                                                                   186431
     C                     EXSR ZTNLU1                                    186431
      *                                                                   186431
     C**********           EXSR SRTLOG                                                      AR322732
     C                     EXSR SRFCLT
     C                     EXSR SRLREF
     C           CLE002    IFEQ 'N'
     C           PMODE     OREQ 'B'                                       122651
     C           PPTIN     ANDEQ*BLANK                                    152892
     C           PPTIN     OREQ 'T'                                       152892
     C           BPTPAU    ANDNE'Y'                                       152892
     C           PMODE     OREQ 'I'                                                           209887
     C           BPLOAU    ANDNE'Y'                                                           209887
     C           PMODE     OREQ 'I'                                                           209887
     C           BPPPAU    ANDNE'Y'                                                           209887
     C           PMODE     OREQ 'I'                                                           209887
     C           BPPSAU    ANDNE'Y'                                                           209887
     C                     MOVEL'Y'       CNRQD                                               209887
     C                     EXSR SRTRIX
     C                     ENDIF
     C                     EXSR SRRSET
      *                                                                   CLE009
      ** If CLE009 is installed, update Fees file                         CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     EXSR SRFEES                                    CLE009
     C                     ENDIF                                          CLE009
      *
      ** Write a record in the test harness file when in record mode
      *
     C           PMODE     IFEQ 'R'
     C                     MOVELMAINRF    CURREF
     C                     EXSR SRTEST
     C                     ENDIF
      *
      * If Support System active, write transaction to 24x7 log           CSC011
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C*                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
      *                                                                   CSC011
      * Convert Loan to PINPP format                                      CSC011
     C                     EXSR LOG247                                    CSC011
      *                                                                   CSC011
      * Write valid Loan in PINPP format to 24x7 Log File                 CSC011
     C                     MOVE 'V'       LOGVAL  1                       CSC011
     C                     EXSR APLGTR                                    CSC011
     C                     COMIT                                          CSC011
      *                                                                   CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
      ** Output loan number inserted
      *
     C                     MOVE 'W'       WRMSV
     C                     MOVEL'LEL0001' ZAMSID
     C                     MOVELSLNRF     ZAMSDA
     C                     EXSR ZASNMS
     C                     MOVE 'E'       WRMSV
     C/COPY WNCPYSRC,LE2030C001
      *
      ** Update shadow files
      *
     C                     MOVE *BLANKS   Z#BSTS
     C                     MOVELMAINRF    Z#ASTS
     C                     MOVE *BLANKS   Z#BSTK                                              220754
     C                     MOVELMAINRK    Z#ASTK                                              220754
      ******************************************************************************** 175451 217270
      ***Update*on*shadow*files*when*in*batch*mode*were*already*done****************** 175451 217270
      ***in*SRBTCH.******************************************************************* 175451 217270
      ******************************************************************************** 175451 217270
      *                                                                                       222709
      ** Update on shadow files when in batch mode were already done                          222709
      ** in SRBTCH.                                                                           222709
      *                                                                                       222709
     C***********PMODE     IFNE 'B'                                                    175451 217270
     C           PMODE     IFNE 'B'                                                           222709
     C                     EXSR SRSHDW
     C                     ENDIF                                                              222709
     C***********          ENDIF                                                       175451 217270
      *                                                                   CAP053
      * Delete invalid record                                             CAP053
      *                                                                   CAP053
     C           PMODE     IFEQ 'F'                                       CAP053
     C           XREPN     CHAINLEILONDL             99                   CAP053
     C                     DELETLEILONDL                                  CAP053
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C*                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     EXSR LOGDEL                                    CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     END                                            CAP053
     C/COPY WNCPYSRC,LE2030C013
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRUPDR  -  Amend existing records                             *
      * Called by: SRBTCH - Batch processing                          *
      * Calls    : SRDATA - Set up output fields for files            *
      *            SRLONL - Format CLOAN A record for update          *
      *            SRLONK - Format CLOAN B record for update          *
      *            SRTEST - Write to test harness file                *
      *            SRRELL - Update related loan for parts sold        *
      *            SRTLOG - Chain to LTRIX header                     *
      *            SRFCLT - Update facilities file                    *
      *            SRLREF - Update LEREF record                       *
      *            SRTRIX - Update transaction index                  *
      *            SRLFMT - Format CLOAN file fields                  *
      *            SRSHDW - Update shadow files                       *
      *            SRFEES - Update Fees file                          *   CLE009
      *****************************************************************
     C           SRUPDR    BEGSR
      *
     C/COPY WNCPYSRC,LEH00516
     C                     MOVE 'B'       WEPAR
     C                     MOVE SLNRF     WALON
     C           WKLON     CHAINCLOAN               N89
      *                                                                   121142
     C           *IN89     IFEQ *ON                                       121142
     C           *LOCK     IN   LDA                                       121142
     C                     MOVEL'CLOAN   'DBFILE                          121142
     C                     Z-ADD41        DBASE                           121142
     C                     MOVELD#CLON    DBKEY                           121142
     C                     OUT  LDA                                       121142
     C                     EXSR *PSSR                                     121142
     C                     ENDIF                                          121142
      *
      ** Determine if record has been updated by another workstation
      *
     C           WTNLU     IFNE TNLU
     C                     MOVEL'LEL0005' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'F0'      WFMT
     C                     ELSE
      *
      ** Update CLOAN A and B records
      *
     C                     MOVE 'A'       WEPAR
     C           WKLON     CHAINCLOAN                89
      *                                                                   121142
     C           *IN89     IFEQ *ON                                       121142
     C           *LOCK     IN   LDA                                       121142
     C                     MOVEL'CLOAN   'DBFILE                          121142
     C                     Z-ADD42        DBASE                           121142
     C                     MOVELD#CLON    DBKEY                           121142
     C                     OUT  LDA                                       121142
     C                     EXSR *PSSR                                     121142
     C                     ENDIF                                          121142
      *                                                                   121142
     C/COPY WNCPYSRC,LE2030C101
      *                                                                                     AR819476
     C                     MOVE 'N'       MDAT00  1                                         AR819476
     C                     MOVELLTYP      LTYP1                                             AR819476
     C           CLE134    IFEQ 'Y'                                                         AR819476
     C           MDAT      ANDEQ0                                                           AR819476
     C           LTYP1     IFEQ 'X'                                                         AR819476
     C           LTYP1     OREQ 'Y'                                                         AR819476
     C           LTYP1     OREQ 'Z'                                                         AR819476
     C                     MOVE 'Y'       MDAT00                                            AR819476
     C                     Z-ADDBJRDNB    MDAT                                              AR819476
     C                     ENDIF                                                            AR819476
     C                     ENDIF                                                            AR819476
      *                                                                                     AR819476
     C                     MOVELCURREF    Z#BSTS
      *                                                                                     AR819476
     C           MDAT00    IFEQ 'Y'                                                         AR819476
     C                     Z-ADD0         MDAT                                              AR819476
     C                     ENDIF                                                            AR819476
      *                                                                                     AR819476
     C                     MOVELCURRFK    Z#BSTK                                              220754
      *                                                                                       CSD015
      ** Check if WATCH LIST CHECKING ENGINE PROGRAM must be called.                          CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       WATCH                                               CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
     C                     EXSR SRCHCK                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     EXSR SRDATA
      *****************************************************************                CAS009 232314
     C********** CAS009    IFEQ 'Y'                                                    CAS009 232314
      *****************************************************************                CAS009 232314
      ***Update*Total*Fees/Discount/Premium*if*Discounted*Loan*********                CAS009 232314
      *****************************************************************                CAS009 232314
     C********** WLNPT     IFEQ 63                                                     CAS009 232314
     C********** WLNPT     OREQ 65                                                     CAS009 232314
     C********** WLNPT     OREQ 67                                                     CAS009 232314
      *****************************************************************                CAS009 232314
      ***If*maturity*date*is*amended*on*date*of*input..****************                CAS009 232314
      *****************************************************************                CAS009 232314
     C********** WSVMD     IFNE MDAT                                                   CAS009 232314
     C********** ORED      ANDEQBJRDNB                                                 CAS009 232314
     C**********           SUB  TOTI      TFDP                                         CAS009 232314
     C**********           SUB  TOTI      TFDPA                                        CAS009 232314
     C**********           ADD  WTOTI     TFDP                                         CAS009 232314
     C**********           ADD  WTOTI     TFDPA                                        CAS009 232314
     C**********           ENDIF                                                       CAS009 232314
     C**********           ENDIF                                                       CAS009 232314
      *****************************************************************                CAS009 232314
     C**********           ENDIF                                                       CAS009 232314
      *****************************************************************                CAS009 232314
     C                     EXSR SRLONL
     C/COPY WNCPYSRC,LE2030C091
      *                                                                                       CSD015
      ** Call WATCH LIST CHECKING ENGINE PROGRAM.                                             CSD015
      *                                                                                       CSD015
     C           WATCH     IFEQ 'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C***********          UPDATCLOANCLF               89                 157761
     C                     UPDATCLOANCLF                                  157761
     C/COPY WNCPYSRC,LE2030C033
     C                     MOVELCURREF    MAINRF
      *                                                                                     AR819476
     C                     MOVELLTYP      LTYP1                                             AR819476
     C           CLE134    IFEQ 'Y'                                                         AR819476
     C           MDAT      ANDEQ0                                                           AR819476
     C           LTYP1     IFEQ 'X'                                                         AR819476
     C           LTYP1     OREQ 'Y'                                                         AR819476
     C           LTYP1     OREQ 'Z'                                                         AR819476
     C                     Z-ADDBJRDNB    MDAT                                              AR819476
     C                     ENDIF                                                            AR819476
     C                     ENDIF                                                            AR819476
      *                                                                                     AR819476
     C                     MOVELCURREF    Z#ASTS
     C                     MOVELLSTS      WLSTS   1                       140825
      *
     C                     MOVE 'B'       WEPAR
     C           WKLON     CHAINCLOAN                89
      *                                                                   121142
     C           *IN89     IFEQ *ON                                       121142
     C           *LOCK     IN   LDA                                       121142
     C                     MOVEL'CLOAN   'DBFILE                          121142
     C                     Z-ADD43        DBASE                           121142
     C                     MOVELD#CLON    DBKEY                           121142
     C                     OUT  LDA                                       121142
     C                     EXSR *PSSR                                     121142
     C                     ENDIF                                          121142
      *                                                                   121142
     C                     EXSR SRLONK
     C***********          UPDATCLOANCKF               89                 157761
     C                     UPDATCLOANCKF                                  157761
     C                     MOVELCURRFK    MAINRK                                              220754
     C                     MOVELCURRFK    Z#ASTK                                              220754
      *
      ** Update related loan for parts sold on reversal
      ** or reversal of an internal parts purchased                       124001
      *
     C           *IN22     IFEQ '1'
     C           SACTN     ANDEQ'R'
     C           *IN21     OREQ '1'                                       124001
     C********** MLNR      ANDNE*ZEROS                                                 124001 CLE148
     C           MLNR      ANDNE*BLANKS                                                       CLE148
     C           SACTN     ANDEQ'R'                                       124001
     C                     EXSR SRRELL
     C                     MOVELMAINRF    CURREF
     C                     ENDIF
      *
      ** Update FCLTY, LEREF, LTRIX and CLOAN trailer
      ** Except on amend of principal transfer
      *
     C           SACTN     IFEQ 'A'
     C           PMODE     ANDEQ'B'
     C           PGNTF     ANDEQ'Y'
     C                     ELSE
      *
     C                     SELEC
     C           SACTN     WHEQ 'X'
      *                                                                   186431
      ** Obtain last transaction number                                   186431
      *                                                                   186431
     C                     EXSR ZTNLU1                                    186431
      *                                                                   186431
     C**********           EXSR SRTLOG                                                      AR322732
     C                     EXSR SRTRIX
     C                     EXSR SRRSET
      *                                                                   CLE009
      ** If CLE009 is installed, update fees file                         CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     EXSR SRFEES                                    CLE009
     C                     ENDIF                                          CLE009
      *
     C           SACTN     WHEQ 'A'
      *                                                                   186431
      ** Obtain last transaction number                                   186431
      *                                                                   186431
     C                     EXSR ZTNLU1                                    186431
      *                                                                   186431
     C**********           EXSR SRTLOG                                                      AR322732
     C                     EXSR SRFCLT
     C           CLE002    IFEQ 'N'
     C           PMODE     OREQ 'B'                                       122651
     C           PMODE     OREQ 'I'                                                          209887
     C                     MOVEL'Y'       CNRQD                                              209887
     C                     EXSR SRTRIX
     C                     ENDIF
     C                     EXSR SRRSET
      *                                                                   CLE009
      ** If CLE009 is installed, update fees file                         CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     EXSR SRFEES                                    CLE009
     C                     ENDIF                                          CLE009
      *
     C                     OTHER
      *                                                                   186431
      ** Obtain last transaction number                                   186431
      *                                                                   186431
     C                     EXSR ZTNLU1                                    186431
      *                                                                   186431
     C**********           EXSR SRTLOG                                                      AR322732
     C                     EXSR SRFCLT
     C                     EXSR SRLREF
     C           CLE002    IFEQ 'N'
     C           XUSR      ORNE *BLANKS
     C           PMODE     OREQ 'B'                                       122651
     C                     EXSR SRTRIX
     C                     ENDIF
     C                     EXSR SRRSET
      *                                                                   CLE009
      ** If CLE009 is installed, update fees file                         CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     EXSR SRFEES                                    CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDSL
     C                     ENDIF
      *
      ** Write to test harness file when in record mode
      *
     C           PMODE     IFEQ 'R'
     C                     MOVELMAINRF    CURREF
     C                     EXSR SRTEST
     C                     ENDIF
      *                                                                   CSC011
      * If Support System active, write transaction to 24x7 log           CSC011
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C*                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
      *                                                                   CSC011
      * Convert Loan to PINPP format                                      CSC011
     C                     EXSR LOG247                                    CSC011
      *                                                                   CSC011
      * Write valid Loan in PINPP format to 24x7 Log File                 CSC011
     C                     MOVE 'V'       LOGVAL  1                       CSC011
     C                     EXSR APLGTR                                    CSC011
     C                     COMIT                                          CSC011
      *                                                                   CSC011
     C                     ENDIF                                          CSC011
      *
      ** Update shadow files, except on amend of principal transfer
      ** when part of a principal transfer unit of work                                       223592
      *
     C           SACTN     IFEQ 'A'
     C********** PMODE     ANDEQ'B'                                                           212288
     C           PGNTF     ANDEQ'Y'
     C           N1PPTF    ANDEQ'Y'                                                           223592
     C                     ELSE
     C           PMODE     IFNE 'B'                                                           212288
     C                     EXSR SRSHDW
     C                     ENDIF                                                              212288
     C                     ENDIF
      *                                                                                       CLE034
      ** Update the Settlement Allocations table                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
     C           SACTN     ANDEQ'R'                                                           CLE034
     C********** SLNRF     IFNE *ZEROS                                                 CLE034 CLE148
     C********** SLNRF     ANDNE*BLANKS                                                CLE034 CLE148
     C           SLNRF     IFNE *BLANKS                                                       CLE148
     C                     MOVELSTAMP,1   PTMST                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALU0'                                                    CLE034
     C                     PARM PMODE     PRTCD                                               CLE034
     C                     PARM 'LOAN'    PLTYPE                                              CLE034
     C                     PARM 'D'       PACTN                                               CLE034
     C                     PARM           SLNRF                                               CLE034
     C                     PARM *ZEROS    PLAVDT                                              CLE034
     C                     PARM *ZEROS    PLASEQ                                              CLE034
     C                     PARM *ZEROS    PCUSTF                                              CLE034
     C                     PARM *ZEROS    PFACIF                                              CLE034
     C                     PARM *ZEROS    PFEESQ                                              CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM           PCRFL                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF
      *                                                                   CAP053
      * Delete invalid record                                             CAP053
      *                                                                   CAP053
     C           PMODE     IFEQ 'F'                                       CAP053
     C           XREPN     CHAINLEILONDL             99                   CAP053
     C                     DELETLEILONDL                                  CAP053
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     EXSR LOGDEL                                    CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     END                                            CAP053
      *
      ** Amendment or Authorisation is done through Principal Transfer    140825
      ** Maintenance                                                      140825
      *                                                                   140825
     C           PTYPE     IFEQ 'PTFT'                                    140825
     C           GPRT      ANDEQ'Y'                                       140825
     C**********           Z-ADDTOLN      WALON                                        140825 CLE148
     C                     MOVELTOLN      WALON                                               CLE148
     C                     MOVE 'A'       WEPAR                           140825
     C           WKLON     CHAINCLOAN                89                   140825
     C           *IN89     IFEQ '0'                                       140825
     C           RECI      ANDEQ'D'                                       140825
      *                                                                                       CSD015
      ** If Compliance Watch Enhancement (CSD015) is installed and Watch                      CSD015
      ** List Checking Applied...                                                             CSD015
      ** If 24x7 Midas Availability is not installed or it is installed and                   CSD015
      ** in the main system...                                                                CSD015
      ** Determine  if there is a pending case.                                               CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   WCHCK   1                                           CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
     C                     MOVEL'CLOANCL' K3FUNT                                              CSD015
     C                     MOVELLNRF      K3IDEN                                              CSD015
     C                     MOVELBRCA      K3BRCH                                              CSD015
     C                     MOVE *IN89     WIND89                                              CSD015
     C           KCWHT     CHAINSDCWHTL1             89                                       CSD015
     C           *IN89     IFEQ *OFF                                                          CSD015
     C                     MOVE 'Y'       WCHCK                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVE WIND89    *IN89                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     SELEC                                          140825
      *                                                                                       CSD015
      ** If Action Code is 'X',                                                               CSD015
      ** If there no pending case or case has been temporarily released,                      CSD015
      ** continue normal processing.  Otherwise send error message.                           CSD015
      *                                                                                       CSD015
     C           SACTN     WHEQ 'X'                                                           CSD015
     C           W3TREL    ANDNE'Y'                                                           CSD015
     C           WCHCK     ANDEQ'Y'                                                           CSD015
     C                     MOVEL'LEL0564' ZAMSID                                              CSD015
     C                     MOVE *ON       *IN30                                               CSD015
     C                     MOVE *ON       *IN31                                               CSD015
     C                     EXSR ZASNMS                                                        CSD015
     C           SACTN     WHEQ 'X'                                       140825
     C           USER      ANDNEIUSR                                      140825
     C           USER      ANDNEAUSR                                      140825
     C                     MOVELWLSTS     LSTS                            140825
     C                     MOVELUSER      XUSR                            140825
     C                     UPDATCLOANCLF                                  140825
     C           SACTN     WHEQ 'X'                                       140825
     C           USER      ANDEQIUSR                                      140825
     C           SACTN     OREQ 'X'                                       140825
     C           USER      ANDEQAUSR                                      140825
     C                     MOVEA'11'      *IN,30                          140825
     C                     MOVEL'LEL0404' ZAMSID                          140825
     C                     EXSR ZASNMS                                    140825
     C           SACTN     WHEQ 'A'                                       140825
     C                     MOVELWLSTS     LSTS                            140825
     C                     MOVELUSER      AUSR                            140825
     C                     UPDATCLOANCLF                                  140825
     C                     ENDSL                                          140825
     C                     ENDIF                                          140825
     C                     ENDIF                                          140825
      *                                                                   140825
      ** Amendment or Authorisation is done through Customer Loan         140825
      ** Maintenance                                                      140825
      *                                                                   140825
     C           PTYPE     IFEQ 'LOAN'                                    140825
     C           SACTN     ANDEQ'A'                                       140825
     C           PTYPE     OREQ 'LOAN'                                    140825
     C           SACTN     ANDEQ'X'                                       140825
     C                     MOVELLSTS      WLSTS                           140825
     C**********           Z-ADDLNRF      WLONO                                        140825 CLE148
     C**********           Z-ADDLNRF      WLLOAN                                       140825 CLE148
     C                     MOVELLNRF      WLONO                                               CLE148
     C                     MOVELLNRF      WLLOAN                                              CLE148
     C                     Z-ADD0         WLVDAT                          140825
     C                     Z-ADD0         WLLASN                          140825
     C           GPRT      IFEQ 'Y'                                       140825
     C                     MOVEL'PT'      WAMTP   2                       140825
     C                     MOVEL'PF'      WAMTPA  2                       140825
     C                     ELSE                                           140825
     C                     MOVEL'PF'      WAMTP                           140825
     C                     MOVEL'PT'      WAMTPA                          140825
     C                     ENDIF                                          140825
     C***********WKLAM     SETLLLOAMS                              140825 142522
     C           WKLAM     SETLLLELOAML3                                  142522
     C           *IN89     DOUEQ'1'                                       140825
     C           LNRFA     ORNE WLLOAN                                    140825
     C           AMTPA     OREQ WAMTP                                     140825
     C***********          READ LOAMS                    89        140825 142522
     C                     READ LELOAML3                 89               142522
     C                     ENDDO                                          140825
     C           *IN89     IFEQ '0'                                       140825
     C           AMTPA     ANDEQWAMTP                                     140825
     C           LNRFA     ANDEQWLLOAN                                    140825
     C                     MOVELWLSTS     ASTS                            140825
     C                     SELEC                                          140825
     C           SACTN     WHEQ 'A'                                       140825
     C                     MOVELUSER      AUSR                            140825
     C                     OTHER                                          140825
     C                     MOVELUSER      XUSR                            140825
     C                     ENDSL                                          140825
     C***********          UPDATLOAMSDKF                           140825 142522
     C                     UPDATLELOAM3F                                  142522
     C**********           Z-ADDROLN      WLLOAN                                       140825 CLE148
     C                     MOVELROLN      WLLOAN                                              CLE148
     C***********WKLAM     SETLLLOAMS                              140825 142522
     C           WKLAM     SETLLLELOAML3                                  142522
     C           *IN89     DOUEQ'1'                                       140825
     C           LNRFA     ORNE WLLOAN                                    140825
     C           AMTPA     OREQ WAMTPA                                    140825
     C***********          READ LOAMS                    89        140825 142522
     C                     READ LELOAML3                 89               142522
     C                     ENDDO                                          140825
     C           *IN89     IFEQ '0'                                       140825
     C           AMTPA     ANDEQWAMTPA                                    140825
     C           LNRFA     ANDEQWLLOAN                                    140825
     C                     MOVELWLSTS     ASTS                            140825
     C                     SELEC                                          140825
     C           SACTN     WHEQ 'A'                                       140825
     C                     MOVELUSER      AUSR                            140825
     C                     OTHER                                          140825
     C                     MOVELUSER      XUSR                            140825
     C                     ENDSL                                          140825
     C***********          UPDATLOAMSDKF                           140825 142522
     C                     UPDATLELOAM3F                                  142522
     C                     MOVEL'A'       WEPAR                           140825
     C**********           Z-ADDLNRFA     WALON                                        140825 CLE148
     C                     MOVELLNRFA     WALON                                               CLE148
     C           WKLON     CHAINCLOAN                89                   140825
     C           *IN89     IFEQ '0'                                       140825
     C           RECI      ANDEQ'D'                                       140825
     C                     MOVELWLSTS     LSTS                            140825
     C                     SELEC                                          140825
     C           SACTN     WHEQ 'A'                                       140825
     C                     MOVELUSER      AUSR                            140825
     C                     OTHER                                          140825
     C                     MOVELUSER      XUSR                            140825
     C                     ENDSL                                          140825
     C                     UPDATCLOANCLF                                  140825
     C                     ENDIF                                          140825
     C                     ENDIF                                          140825
     C                     ENDIF                                          140825
      *                                                                   CDE001
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           CDE001    IFEQ 'Y'                                       CDE001
     C                     MOVELSLNRF     T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C                     PARM           T#TREF 20                       CDE001
     C                     PARM 'LOAN'    T#TCAT  4                       CDE001
     C                     PARM           RSRVID 10                                           CDE005
     C                     ENDIF                                          CDE001
      *                                                                   CDE001
     C           PMODE     IFNE 'B'                                       142522
     C                     COMIT                                          142522
     C                     ENDIF                                          142522
     C                     ENDIF                                          140825
     C*                                                                   140825
     C/COPY WNCPYSRC,LE2030C034
     C                     ENDSR
     C/COPY WNCPYSRC,LE2030C072
      *****************************************************************   CLE009
      * SRFEES  -  Update Fees File                                   *   CLE009
      * Called by: SRINSR - Insert records in files                   *   CLE009
      *            SRUPDR - Update records in files                   *   CLE009
      * Calls    : None                                               *   CLE009
      *****************************************************************   CLE009
     C           SRFEES    BEGSR                                          CLE009
      *                                                                   CLE009
      ** If authorisation switchable feature is on and action code        CLE009
      ** is insert or amend and a parts purchased is being inputted and   CLE009
      ** parts purchased authorisations is required                       CLE009
      *                                                                   CLE009
     C           CLE002    IFEQ 'Y'                                       CLE009
     C           SACTN     ANDNE'X'                                       CLE009
     C           SACTN     ANDNE'R'                                       CLE009
     C           *IN21     ANDEQ*ON                                       CLE009
     C           BPPPAU    ANDEQ'Y'                                       CLE009
      *                                                                   CLE009
      ** ...or authorisation switchable feature is on and action code     CLE009
      ** is insert or amend and a parts sold is being inputted and        CLE009
      ** parts sold authorisations is required                            CLE009
      *                                                                   CLE009
     C           CLE002    OREQ 'Y'                                       CLE009
     C           SACTN     ANDNE'X'                                       CLE009
     C           SACTN     ANDNE'R'                                       CLE009
     C           *IN22     ANDEQ*ON                                       CLE009
     C           BPPSAU    ANDEQ'Y'                                       CLE009
      *                                                                   CLE009
      ** ...or authorisation switchable feature is on and action code     CLE009
      ** is insert or amend and a loan is being inputted and loans        CLE009
      ** authorisations is required                                       CLE009
      *                                                                   CLE009
     C           CLE002    OREQ 'Y'                                       CLE009
     C           SACTN     ANDNE'X'                                       CLE009
     C           SACTN     ANDNE'R'                                       CLE009
     C           *IN21     ANDEQ*OFF                                      CLE009
     C           *IN22     ANDEQ*OFF                                      CLE009
     C           BPLOAU    ANDEQ'Y'                                       CLE009
      *                                                                   CLE009
     C**********           Z-ADD0         WKLNRF  60                                   CLE009 CLE148
     C                     MOVEL*BLANKS   WKLNRF  6                                           CLE148
      *                                                                   CLE009
      ** If action code is insert                                         CLE009
      *                                                                   CLE009
     C           SACTN     IFEQ 'I'                                       CLE009
      *                                                                   CLE009
      ** Write a record to Loan Fee Index File                            CLE009
      *                                                                   CLE009
     C                     MOVE SLNRF     WKLNRF                          CLE009
     C**********           Z-ADDWKLNRF    FLLNRF                                       CLE009 CLE148
     C                     MOVELWKLNRF    FLLNRF                                              CLE148
     C                     MOVE *BLANKS   FLAUTH                          CLE009
     C                     MOVE WKSWRI    FLSWRI                          CLE009
     C                     WRITELEFELND0                                  CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** If action code is amend                                          CLE009
      *                                                                   CLE009
     C           SACTN     IFEQ 'A'                                       CLE009
      *                                                                   CLE009
      ** Chain to Loan Fee Index File with loan number                    CLE009
      *                                                                   CLE009
     C                     MOVE SLNRF     WKLNRF                          CLE009
     C           WKLNRF    CHAINLEFELNL0             89                   CLE009
      *                                                                   CLE009
      ** If record not found                                              CLE009
      *                                                                   CLE009
     C           *IN89     IFEQ *ON                                       CLE009
      *                                                                   CLE009
      ** Write a record to Loan Fee Index File                            CLE009
      *                                                                   CLE009
     C                     MOVE SLNRF     WKLNRF                          CLE009
     C**********           Z-ADDWKLNRF    FLLNRF                                       CLE009 CLE148
     C                     MOVELWKLNRF    FLLNRF                                              CLE148
     C                     MOVE 'Y'       FLAUTH                          CLE009
     C                     MOVE WKSWRI    FLSWRI                          CLE009
     C                     WRITELEFELND0                                  CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** If work regeneration indicator is changed and regeneration       CLE009
      ** indicator is blank                                               CLE009
      *                                                                   CLE009
     C           WKSWRI    IFEQ 'C'                                       CLE009
     C           FLSWRI    ANDEQ*BLANKS                                   CLE009
      *                                                                   CLE009
      ** Update the record to Loan Fee Index File                         CLE009
      *                                                                   CLE009
     C                     MOVE WKSWRI    FLSWRI                          CLE009
     C                     UPDATLEFELND0                                  CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** If action code is authorise                                      CLE009
      *                                                                   CLE009
     C           SACTN     IFEQ 'X'                                       CLE009
      *                                                                   CLE009
      ** Chain to Loan Fee Index File with loan number                    CLE009
      *                                                                   CLE009
     C                     MOVE SLNRF     WKLNRF                          CLE009
     C           WKLNRF    CHAINLEFELNL0             89                   CLE009
      *                                                                   CLE009
      ** If record is found                                               CLE009
      *                                                                   CLE009
     C           *IN89     IFEQ *OFF                                      CLE009
      *                                                                   CLE009
      ** Update the record to Loan Fee Index File                         CLE009
      *                                                                   CLE009
     C                     MOVE FLSWRI    WKSWRI                          CLE009
     C                     MOVE 'Y'       FLAUTH                          CLE009
     C                     UPDATLEFELND0                                  CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** If action code is reverse                                        CLE009
      *                                                                   CLE009
     C           SACTN     IFEQ 'R'                                       CLE009
      *                                                                   CLE009
      ** Chain to Loan Fee Index File with loan number                    CLE009
      *                                                                   CLE009
     C                     MOVE SLNRF     WKLNRF                          CLE009
     C           WKLNRF    CHAINLEFELNL0             89                   CLE009
      *                                                                   CLE009
      ** If record is found                                               CLE009
      *                                                                   CLE009
     C           *IN89     IFEQ *OFF                                      CLE009
      *                                                                   CLE009
      ** If authorised is blank                                           CLE009
      *                                                                   CLE009
     C           FLAUTH    IFEQ *BLANKS                                   CLE009
     C                     MOVE *BLANKS   WKSWRI                          CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** If work regeneration indicator is blank                          CLE009
      *                                                                   CLE009
     C           WKSWRI    IFEQ *BLANKS                                   CLE009
     C                     MOVE FLSWRI    WKSWRI                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** If work regeneration indicator is changed                        CLE009
      *                                                                   CLE009
     C           WKSWRI    IFEQ 'C'                                       CLE009
      *                                                                   CLE009
      ** Check if the facility has an associated fee                      CLE009
      *                                                                   CLE009
     C                     MOVE WFFACT    CHFACT  3                       CLE009
     C                     MOVE WFFCNO    CHFCNO  2                       CLE009
     C           CHFACT    CAT  CHFCNO    CHFACL  5                       CLE009
     C                     MOVE CHFACL    WFFACL                          CLE009
     C**********           Z-ADD0         WFLOAN                                       CLE009 CLE148
     C                     MOVEL*BLANK    WFLOAN                                              CLE148
     C           WKFEE     SETLLLEFEEDL1                                  CLE009
     C           WKFEE     READELEFEEDL1                 89               CLE009
      *                                                                   CLE009
      ** Do while an associated fee exists                                CLE009
      *                                                                   CLE009
     C           *IN89     DOWEQ*OFF                                      CLE009
      *                                                                   CLE009
      ** If the fee is a confirmed calculated fee and swift               CLE009
      ** regeneration indicator is not 'I', 'B', 'H'                      CLE009
      *                                                                   CLE009
     C           FEAUTO    IFEQ 'Y'                                       CLE009
     C           FECALT    ANDNE*BLANKS                                   CLE009
     C           FESWRI    ANDNE'I'                                       CLE009
     C           FESWRI    ANDNE'B'                                       CLE009
     C           FESWRI    ANDNE'H'                                       CLE009
      *                                                                   CLE009
      ** Set currency to fee currency                                     CLE009
      ** Set day to run date                                              CLE009
      ** Set number of working days to telex notice days                  CLE009
      *                                                                   CLE009
     C                     MOVE FEFCCY    ZCCY                            CLE009
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           PTFI      IFNE *BLANKS                                                       CLE034
     C                     MOVE 'E'       WSTMA                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'S'       WSTMA                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE FELOAN    PLOAN                                               CLE034
     C                     MOVE FECNUM    PCUSTN                                              CLE034
     C                     MOVE FEFACL    PFACL                                               CLE034
     C                     MOVE FEFSEQ    PFSEQ                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALR1'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM '*TXDT  ' POPTN                                               CLE034
     C                     PARM           BJRDNB                                              CLE034
     C                     PARM *ZERO     PPROT   20                                          CLE034
     C                     PARM           WSTMA   1                                           CLE034
     C                     PARM           FEFCCY                                              CLE034
     C                     PARM 'N'       PNOSCK  1                                           CLE034
     C                     PARM 'FEES'    PLTYPE                                              CLE034
     C                     PARM           PLOAN   6                                           CLE034
     C                     PARM *BLANKS   PLAVDT                                              CLE034
     C                     PARM *BLANKS   PLASEQ                                              CLE034
     C                     PARM           PCUSTN  6                                           CLE034
     C                     PARM           PFACL   5                                           CLE034
     C                     PARM           PFSEQ   2                                           CLE034
     C                     PARM *ZERO     PTXDT   50                                          CLE034
     C                     PARM *BLANK    PNOSTR  1                                           CLE034
      *                                                                                       CLE034
     C           PRTCD     IFNE *BLANKS                                                       CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVEL'LESTALPD'DBFILE                                              CLE034
     C                     MOVELPLOAN     DBKEY                                               CLE034
     C                     Z-ADD72        DBASE                                               CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     Z-ADDPTXDT     TXDT                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
     C                     Z-ADDBJRDNB    ZDAYNO                          CLE009
     C                     Z-ADD1         X                               CLE009
      *                                                                                       CLE031
      ** If CLE031 is on then use correct currency to access AONOSTR0                         CLE031
      *                                                                                       CLE031
     C                     MOVE FEFCCY    WKCCY   3                                           CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
      *                                                                                       CLE031
     C           PTFI      IFEQ 'P'                                                           CLE031
     C           FEPSCY    IFNE *BLANKS                                                       CLE031
     C                     MOVE FEPSCY    WKCCY                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE FESCCY    WKCCY                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVE WKCCY     ZCCY                                                CLE031
     C                     MOVE WKCCY     PCURR                                               CLE031
      *                                                                                       CLE031
     C***********FEFCCY    LOKUPCYA,X                    69                            CLE009 CLE031
     C           WKCCY     LOKUPCYA,X                    69                                   CLE031
     C                     MOVE *OFF      *IN69                           CLE009
     C                     MOVE TND,X     ZNRDYS                          CLE009
      *                                                                   CLE009
      ** If Fee Settlement type is '01', '02', '07', '08' or '12'         CLE009
      *                                                                   CLE009
     C           FESTTL    IFEQ 01                                        CLE009
     C           FESTTL    OREQ 02                                        CLE009
     C           FESTTL    OREQ 07                                        CLE009
     C           FESTTL    OREQ 08                                        CLE009
     C           FESTTL    OREQ 12                                        CLE009
      *                                                                   CLE009
     C                     CALL 'AONOSTR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*KEY   ' POPTN                           CLE009
     C                     PARM           PCUSN   6                       CLE009
     C**********           PARM FEFCCY    PCURR                                        CLE009 CLE036
     C                     PARM           PCURR                                               CLE036
     C**********           PARM           PACCD   4                                    CLE009 CAS011
     C                     PARM           PACCD  10                                           CAS011
     C                     PARM           PACSN   2                       CLE009
     C                     PARM FEOURS    PNONB   2                       CLE009
     C                     PARM           PBRCA                           CLE009
     C                     PARM           PCSSN  10                       CLE009
     C                     PARM           PPNOI   1                       CLE009
     C           SDNOST    PARM SDNOST    DSFDY                           CLE009
      *                                                                   CLE009
     C           PRTCD     IFNE *BLANKS                                   CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVEL'AONOSTR0'DBFILE           ************   CLE009
     C                     Z-ADD50        DBASE            * DBERR 50 *   CLE009
     C                     MOVELFEFCCY    DBKEY            ************   CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** Set Location to Nostro Location                                  CLE009
      *                                                                   CLE009
     C                     MOVE A7NOSN    ZLOC                            CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
     C                     MOVE *BLANKS   ZLOC                            CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** Calculate number of working days forward                         CLE009
      *                                                                   CLE009
     C                     EXSR ZFWDT                                     CLE009
      *                                                                   CLE009
      ** Set Telex Notice date to day number                              CLE009
      *                                                                   CLE009
     C                     Z-ADDZDYNBR    TXDT    50                      CLE009
     C                     ENDIF                                                              CLE034
      *                                                                   CLE009
      ** If next payment date is before or equals to Telex Notice date    CLE009
      ** and Next Payment Telex indicator is set to 'Y'                   CLE009
      *                                                                   CLE009
     C           FENPYD    IFLE TXDT                                      CLE009
     C           FEPPTI    ANDEQ'Y'                                       CLE009
      *                                                                   CLE009
      ** Update Fees file                                                 CLE009
      *                                                                   CLE009
     C                     MOVE 'A'       FESWRI                          CLE009
     C                     UPDATLEFEEDF                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** If end date is before or equals to Telex Notice date and End     CLE009
      ** Telex indicator is set to 'Y'                                    CLE009
      *                                                                   CLE009
     C           FEPEND    IFLE TXDT                                      CLE009
     C           FEEPTI    ANDEQ'Y'                                       CLE009
      *                                                                   CLE009
      ** Update Fees file                                                 CLE009
      *                                                                   CLE009
     C                     MOVE 'A'       FESWRI                          CLE009
     C                     UPDATLEFEEDF                                   CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C           WKFEE     READELEFEEDL1                 89               CLE009
     C                     ENDDO                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     MOVE *BLANKS   WKSWRI                          CLE009
      *                                                                   CLE009
     C                     ENDSR                                          CLE009
      /EJECT                                                              CLE009
      /EJECT
      *****************************************************************
      * SRDATA  -  Set up output fields for files                     *
      * Called by: SRINSR - Insert records in files                   *
      *            SRUPDR - Update records in files                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRDATA    BEGSR
      *
     C                     EXSR CLEAR
     C                     MOVE *BLANK    WTRIX   1
     C                     MOVE 'Y'       WFINL   1
      *
      ** Move some fields in data structure for confirmation checks
      *
     C           SACTN     IFNE 'I'
     C                     Z-ADDMDAT      OMDAT
     C                     Z-ADDNIDT      ONIDT
     C                     Z-ADDNRPD      ONRPD
     C                     Z-ADDIFDY      OIFDY
     C                     MOVE IPFR      OIPFR
     C                     Z-ADDRDYN      ORDYN
     C                     MOVE RFRQ      ORFRQ
     C                     Z-ADDRAMT      ORAMT
     C                     Z-ADDSDST      OSDST
     C                     MOVE OSDA      OOSDA
     C                     MOVE TSTN      OTSTN
     C                     MOVE FACO      OFACO
     C                     MOVE SPI1      OSPI1
     C                     MOVE SPI2      OSPI2
     C                     MOVE SPI3      OSPI3
     C                     Z-ADDMDST      OMDST
     C                     MOVE OMDA      OOMDA
     C                     MOVE TMAN      OTMAN
     C                     Z-ADDCPAM      WCPAM  130
     C                     Z-ADDOMDT      OOMDT   50
     C                     Z-ADDINTR      OINTR
     C                     Z-ADDRLDT      ORLDT
     C                     MOVE RLFQ      ORLFQ
     C                     Z-ADDRLDY      ORLDY
     C                     ENDIF
      *
      ** Bit settings
      *
     C                     BITOF'01234567'WBOFF   1
      *
      ** ... secured/document/fees
      *
     C                     MOVE WBOFF     WRELI   1
     C           SSECI     IFEQ 'Y'
     C                     BITON'0'       WRELI
     C                     ENDIF
     C           SDOCI     IFEQ 'Y'
     C                     BITON'1'       WRELI
     C                     ENDIF
     C           SFEEI     IFEQ 'Y'
     C                     BITON'2'       WRELI
     C                     ENDIF
      *
      ** ... save start and maturity settlement for reversals and
      ** authorisations
      *
     C                     SELEC
     C           SACTN     WHEQ 'R'
     C           SACTN     OREQ 'X'
     C                     MOVE SDST      WSDST
     C                     MOVE MDST      WMDST
      *
      ** ... loan indicators for insert
      *
     C           SACTN     WHEQ 'I'
     C                     MOVE WBOFF     WLONI   1
     C                     BITON'0'       WLONI
     C           WLNPT     IFNE 63
     C           WLNPT     ANDNE65
     C           WLNPT     ANDNE67
     C           WLNPT     ANDNE72                                        CLE005
     C           WLNPT     OREQ 72                                        CLE005
     C           W72TP     ANDNE'67'                                      CLE005
     C                     BITON'2'       WLONI
     C                     ENDIF
      *
      ** ... customer bills for amend
      *
     C           SACTN     WHEQ 'A'
     C                     MOVE CBLI      WCBLI   1
     C           WSVID     IFNE NIDT
     C                     TESTB'0'       CBLI           87
     C           *IN87     IFEQ '1'
     C                     BITON'1'       WCBLI
     C                     ENDIF
     C                     ENDIF
      *
     C           WSVRP     IFNE NRPD
     C           WSVRP     OREQ NRPD
     C           WSVRA     ANDNERAMT
     C                     TESTB'2'       CBLI           87
     C           *IN87     IFEQ '1'
     C                     BITON'3'       WCBLI
     C                     ENDIF
     C                     ENDIF
      *
     C           WSVMD     IFEQ *ZEROS
     C                     TESTB'4'       CBLI           87
     C           *IN87     IFEQ '0'                                                           204024
     C                     TESTB'5'       CBLI           87                                   204024
     C                     ENDIF                                                              204024
     C           *IN87     IFEQ '1'
     C                     BITOF'45'      WCBLI
     C                     ENDIF
     C                     ENDIF
      *
     C           WSVMD     IFNE MDAT
     C           WSVMD     ANDNE*ZEROS                                                        204024
     C                     TESTB'4'       CBLI           87
     C           *IN87     IFEQ '1'
     C                     BITON'5'       WCBLI
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSL
      *
      ** Set confirmation indicators on CLOAN file and confirmation
      ** required indicator on LTRIX if loan will be authorised
      *
     C**********           MOVE 'N'       CNRQD                                             AR322732
     C                     MOVE 'N'       CNRQD   1                                         AR322732
     C                     SELEC
      *
      ** ... when loan has not been authorised, request confirmation
      ** if settlement instruction is entered, then set off
      ** confirmations
      *
     C           SACTN     WHEQ 'I'
     C           CLE002    ANDEQ'N'
     C           SACTN     OREQ 'X'
     C           CLE002    ANDEQ'Y'
     C           XUSR      ANDEQ*BLANKS
      *                                                                   142225
      * (Check for loans inserted from Loan Manager)                      142225
     C           SACTN     OREQ 'I'                                       142225
     C           PMODE     ANDEQ'B'                                       142225
      *
     C                     MOVE WBOFF     WCNFI   1
     C                     MOVE 'Y'       CNRQD
     C           BLL2II    IFEQ 'Y'
     C           WSDST     ANDEQ*ZEROS
     C           WMDST     ANDEQ*ZEROS
     C           SSTAL     ANDEQ'Y'                                                           CLE034
     C           BLL2II    OREQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
     C           PNODET    ANDEQ'Y'                                                           CLE034
     C                     MOVE 'N'       CNRQD
     C                     ENDIF
      *
      ** ... for reverse, if confirmation control is ON, request
      ** confirmation and set off commencement indicator
      *
     C           SACTN     WHEQ 'R'
     C                     MOVE CNFI      WCNFI
     C                     TESTB'1'       CNFI           87
     C           *IN87     IFEQ '1'
     C                     BITOF'0'       WCNFI
     C                     MOVE 'Y'       CNRQD
     C                     ENDIF
      *
      ** ... when loan has been authorised, then changed and
      ** re-authorised, no check is necessary if there are no
      ** settlement instructions in both before and after status of
      ** of the loan and original entry date equals rundate
      *
     C           SACTN     WHEQ 'A'
     C           CLE002    ANDEQ'N'
     C           SACTN     OREQ 'X'
     C           CLE002    ANDEQ'Y'
     C           XUSR      ANDNE*BLANKS
      *                                                                   142225
      * (Check for amendments from Loan Manager)                          142225
     C           SACTN     OREQ 'A'                                       142225
     C           PMODE     ANDEQ'B'                                       142225
      *
     C                     MOVE CNFI      WCNFI
      *                                                                                       CLE034
     C           CLE034    IFEQ 'N'                                                           CLE034
     C           CLE034    OREQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'N'                                                           CLE034
     C           BLL2II    IFNE 'Y'
     C           SDST      ORNE *ZEROS
     C           MDST      ORNE *ZEROS
     C           WSDST     ORNE *ZEROS
     C           WMDST     ORNE *ZEROS
     C           ORED      ORNE BJRDNB
     C                     MOVE 'Y'       WPROC   1                                           CLE034
     C                     ELSE                                                               CLE034
     C           BLL2II    IFNE 'Y'                                                           CLE034
     C           PNODET    ORNE 'Y'                                                           CLE034
     C           ORED      ORNE BJRDNB                                                        CLE034
     C                     MOVE 'Y'       WPROC                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WPROC     IFEQ 'Y'                                                           CLE034
      *                                                                                       209887
      ** Initialise work fields to prevent previous values from being                         209887
      ** carried on the current loan.                                                         209887
      *                                                                                       209887
     C                     MOVE *BLANKS   WCSET                                               209887
     C                     MOVE *BLANKS   WMSET                                               209887
      *
      ** ... check if any of the following fields have been altered
      ** - settlement instructions, interest pay details, repayment
      ** details or maturity date
      *
     C           CONF1     IFNE CONFS1
     C                     MOVE 'Y'       WCSET   1
     C                     ELSE
     C           CONF2     IFEQ CONFS2
     C                     MOVE 'Y'       WMSET   1
     C                     ENDIF
     C                     ENDIF
      *
      ** ... if changes have been made, check that settlement method is
      ** not 04, and if it is, check that only 'OURS' has changed
      *
     C           WCSET     IFEQ *BLANK
     C           WMSET     ANDEQ*BLANK
     C                     MOVE 'Y'       WMSET
     C                     MOVE 'Y'       WCSET
     C           SDST      IFNE 04
     C           WSDST     ORNE 04
     C           OSPI      ORNE SSPI
     C                     MOVE *BLANK    WMSET
     C                     ENDIF
     C                     ENDIF
      *
     C           WMSET     IFEQ 'Y'
     C           MATYX     IFEQ WREC
     C           MDST      OREQ 04
     C           WMDST     ANDEQ04
     C                     MOVE *BLANK    WCSET
     C                     ENDIF
     C                     ENDIF
      *
      ** ... request confirmation if any of the above have been
      ** altered, then set of commencement indicators
      *                                                                                       209887
      ** Request for confirmation if in Authorisation mode                                    209887
      ** because WCSET will always be equal to *BLANK if CLE002 is                            209887
      ** switched on.                                                                         209887
      *
     C           WCSET     IFEQ 'Y'
     C           SACTN     OREQ 'X'                                                           209887
     C********** *IN21     ANDEQ'0'                                                           209887
     C********** *IN22     ANDEQ'0'                                                           209887
     C********** ORED      OREQ BJRDNB                                                        209887
     C********** ORED      ORLT BJRDNB                                                        209887
     C********** VDAT      ANDGEBJRDNB                                                        209887
     C                     MOVE 'Y'       CNRQD
     C                     BITOF'0'       WCNFI
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF                                                              CLE034
     C                     ENDSL
      *
     C                     ENDSR                                       ***
      /EJECT
      *****************************************************************
      * SRLONL  -  Format CLOANCL fields for update                   *
      * Called by: SRINSR - Insert records in files                   *
      *            SRUPDR - Update records in files                   *
      * Calls    : SRINAM - Format CLOANCL fields for insert and amend*
      *****************************************************************
     C           SRLONL    BEGSR
      *                                                                   122685
      ** Save some fields for later facility update checks                122685
      *                                                                   122685
     C           *LIKE     DEFN MDAT      W#MDAT                          122685
     C           *LIKE     DEFN NRPD      W#NRPD                          122685
     C           *LIKE     DEFN RAMT      W#RAMT                          122685
     C           *LIKE     DEFN RFRQ      W#RFRQ                          122685
     C           *LIKE     DEFN RDYN      W#RDYN                          122685
     C           *LIKE     DEFN ADIF      W#ADIF                                              CLE028
     C           *LIKE     DEFN ADCF      W#ADCF                                              CLE028
     C           *LIKE     DEFN FLTI      W#FLTI                                              CLE028
     C           *LIKE     DEFN CHGA      W#CHGA                                              CLE028
     C                     Z-ADDMDAT      W#MDAT                          122685
     C                     Z-ADDNRPD      W#NRPD                          122685
     C                     Z-ADDRAMT      W#RAMT                          122685
     C                     MOVE RFRQ      W#RFRQ                          122685
     C                     Z-ADDRDYN      W#RDYN                          122685
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C                     MOVE ADIF      W#ADIF                                              CLE028
     C                     MOVE ADCF      W#ADCF                                              CLE028
     C                     Z-ADDFLTI      W#FLTI                                              CLE028
     C                     Z-ADDCHGA      W#CHGA                                              CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE *BLANK    W#ADIF                                              CLE028
     C                     MOVE *BLANK    W#ADCF                                              CLE028
     C                     Z-ADD*ZEROS    W#FLTI                                              CLE028
     C                     Z-ADD*ZEROS    W#CHGA                                              CLE028
     C                     ENDIF                                                              CLE028
      *
     C           PMODE     IFEQ 'B'
     C                     MOVE PPCOB     PCOBL
     C                     ELSE
     C                     MOVE *BLANKS   PCOBL
     C                     ENDIF
      *
     C           PMODE     IFNE 'B'
     C           SACTN     ANDEQ'I'
     C           PMODE     OREQ 'B'                                       150744
     C           PGNTF     ANDEQ'Y'                                       150744
     C           SACTN     ANDEQ'I'                                       150744
      *                                                                   154711
      ** If inserted from Midas due to a Principal Transfer, allocate     154711
      ** PC reference number...                                           154711
     C***********PPTIN     IFEQ 'T'                                 154711158582
     C           PPTIN     ANDEQ'T'                                       158582
     C                     MOVE SBRCA     PBRCA
     C***********          CALL 'AOBRCHR0'PPAR4                           121783
     C                     CALL 'AOBRCHR1'PPAR4                           121783
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRCHPD'DBFILE           ************
     C                     Z-ADD38        DBASE            * DBERR 38 *
     C                     MOVELPBRCA     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVELA8MQSM    W#1ST3  3
     C***                  MOVELW#1ST3    PCRFL     P                     158046
     C********** *NAMVAR   DEFN           LEALLO                                       158046 CLE148
     C********** *LOCK     IN   LEALLO                                                 158046 CLE148
     C********** PCLAST    ADD  1         PCNEXT  80                                   158046 CLE148
     C                     CALL 'LEALLO'                                                      CLE148
     C                     PARM *BLANKS   PRTCD   7                                           CLE148
     C                     PARM 'Y'       PUPDT   1                                           CLE148
     C                     PARM *BLANKS   PCLAST                                              CLE148
     C                     PARM *BLANKS   PCNEXT  8                                           CLE148
      *                                                                                       CLE148
     C                     MOVE PCNEXT    W1ST11 11                       158046
     C                     MOVELW#1ST3    W1ST11                          158046
     C                     MOVELW1ST11    PCRFL                           158046
     C                     MOVE '0001'    PCRFL                           158046
     C**********           Z-ADDPCNEXT    PCLAST                                       158046 CLE148
     C**********           OUT  LEALLO                                                 158046 CLE148
     C                     ENDIF
      *                                                                   158582
     C                     ENDIF                                          158582
      *                                                                   154711
      ** ...else PC reference no. already allocated by Loan Manager.      154711
     C***********          ELSE                                     154711158582
     C           SACTN     IFEQ 'I'                                       158582
     C           PMODE     ANDEQ'B'                                       158582
     C           PGNTF     ANDEQ'Y'                                       158582
     C           PPTIN     ANDNE'T'                                       158582
     C                     MOVELPTREF     PCRFL                           154711
      *                                                                   154711
     C                     ENDIF                                          154711
      *                                                                   154711
     C***********          ENDIF                                          158582
      *
     C                     EXSR ZTNLU1
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
      *                                                                                       232348
      ** Only process EIR cost accounting if loan's value date is same                        232348
      ** as or after the non-linear amortisation cut-off date                                 232348
     C           VDAT      ANDGEFSNLAC                                                        232348
      *                                                                                       232348
     C           WLNPT     IFNE 70                                                            CAS009
     C           WLNPT     ANDNE71                                                            CAS009
     C           WLNPT     ANDNE72                                                            CAS009
      *                                                                                       CAS009
     C                     MOVE *BLANK    WADJP   1                                           CAS009
     C                     MOVE *BLANK    WDELR   1                                           CAS009
      *                                                                                       CAS009
     C           IFDY      IFNE 0                                                             CAS009
     C                     MOVE IFDY      AIFDY   2                                           CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE *BLANKS   AIFDY                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           RDYN      IFNE 0                                                             CAS009
     C                     MOVE RDYN      ARDYN   2                                           CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE *BLANKS   ARDYN                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Need to recalculate the EIR of the original loan when                                CAS009
      ** it is sold (or if the Part Sold is deleted).                                         CAS009
      *                                                                                       CAS009
     C           WLNPT     IFEQ 66                                                            CAS009
     C           WLNPT     OREQ 67                                                            CAS009
     C           WLNPT     OREQ 69                                                            CAS009
     C           WLNPT     OREQ 72                                                            CAS009
     C           SACTN     IFEQ 'I'                                                           CAS009
     C           SACTN     OREQ 'R'                                                           CAS009
     C**********           MOVE SOLNO     WTRAN   60                                   CAS009 CLE148
     C                     MOVE SOLNO     WTRAN   6                                           CLE148
     C                     Z-ADDWSVVD     WVALD   50                                          CAS009
     C                     EXSR SEIRI1                                                        CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Need to recalculate the EIR of the loan on amend.                                    CAS009
      *                                                                                       CAS009
     C           SACTN     IFEQ 'A'                                                           CAS009
      *                                                                                       CAS009
      ** EIR of the amended Loan                                                              CAS009
      *                                                                                       CAS009
     C           WSVID     IFNE NIDT                                                          CAS009
     C           SIPFR     ORNE IPFR                                                          CAS009
     C           SIFDY     ORNE AIFDY                                                         CAS009
     C**********           Z-ADDLNRF      WTRAN                                        CAS009 CLE148
     C                     MOVELLNRF      WTRAN                                               CLE148
     C                     SELEC                                                              CAS009
     C           NIDT      WHEQ 0                                                             CAS009
     C           WSVID     ANDNE0                                                             CAS009
     C           WSVID     ORNE 0                                                             CAS009
     C           WSVID     ANDLTNIDT                                                          CAS009
     C           WSVID     OREQ NIDT                                                          CAS009
     C                     Z-ADDWSVID     WVALD                                               CAS009
     C           WSVID     WHEQ 0                                                             CAS009
     C           NIDT      ANDNE0                                                             CAS009
     C           NIDT      ORNE 0                                                             CAS009
     C           NIDT      ANDLTWSVID                                                         CAS009
     C           WSVID     OREQ NIDT                                                          CAS009
     C                     Z-ADDNIDT      WVALD                                               CAS009
     C                     ENDSL                                                              CAS009
     C                     EXSR SEIRI1                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           WSVRP     IFNE NRPD                                                          CAS009
     C           SRFRQ     ORNE RFRQ                                                          CAS009
     C           SRDYN     ORNE ARDYN                                                         CAS009
     C           WSVRA     ORNE RAMT                                                          CAS009
     C           WSVFA     ORNE FCRA                                                          CAS009
     C**********           Z-ADDLNRF      WTRAN                                        CAS009 CLE148
     C                     MOVELLNRF      WTRAN                                               CLE148
     C                     SELEC                                                              CAS009
     C           NRPD      WHEQ 0                                                             CAS009
     C           WSVRP     ANDNE0                                                             CAS009
     C           WSVRP     ORNE 0                                                             CAS009
     C           WSVRP     ANDLTNRPD                                                          CAS009
     C           WSVRP     OREQ NRPD                                                          CAS009
     C                     Z-ADDWSVRP     WVALD                                               CAS009
     C           WSVRP     WHEQ 0                                                             CAS009
     C           NRPD      ANDNE0                                                             CAS009
     C           NRPD      ORNE 0                                                             CAS009
     C           NRPD      ANDLTWSVRP                                                         CAS009
     C           WSVRP     OREQ NRPD                                                          CAS009
     C                     Z-ADDNRPD      WVALD                                               CAS009
     C                     ENDSL                                                              CAS009
     C                     EXSR SEIRI1                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           WSVMD     IFNE MDAT                                                          CAS009
     C**********           Z-ADDLNRF      WTRAN                                        CAS009 CLE148
     C                     MOVELLNRF      WTRAN                                               CLE148
     C                     SELEC                                                              CAS009
     C           MDAT      WHEQ 0                                                             CAS009
     C           WSVMD     ANDNE0                                                             CAS009
     C           WSVMD     ORNE 0                                                             CAS009
     C           WSVMD     ANDLTMDAT                                                          CAS009
     C           WSVMD     OREQ MDAT                                                          CAS009
     C                     Z-ADDWSVMD     WVALD                                               CAS009
     C           WSVMD     WHEQ 0                                                             CAS009
     C           MDAT      ANDNE0                                                             CAS009
     C           MDAT      ORNE 0                                                             CAS009
     C           MDAT      ANDLTWSVMD                                                         CAS009
     C           WSVMD     OREQ MDAT                                                          CAS009
     C                     Z-ADDMDAT      WVALD                                               CAS009
     C                     ENDSL                                                              CAS009
     C                     MOVE 'Y'       WADJP                                               CAS009
     C                     EXSR SEIRI1                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** EIR of the original Loan                                                             CAS009
      *                                                                                       CAS009
     C           WLNPT     IFEQ 66                                                            CAS009
     C           WLNPT     OREQ 67                                                            CAS009
     C           WLNPT     OREQ 69                                                            CAS009
     C           WLNPT     OREQ 72                                                            CAS009
      *                                                                                       CAS009
     C           WSVID     IFNE NIDT                                                          CAS009
     C           SIPFR     ORNE IPFR                                                          CAS009
     C           SIFDY     ORNE AIFDY                                                         CAS009
     C                     MOVE SOLNO     WTRAN                                               CAS009
     C                     SELEC                                                              CAS009
     C           NIDT      WHEQ 0                                                             CAS009
     C           WSVID     ANDNE0                                                             CAS009
     C           WSVID     ORNE 0                                                             CAS009
     C           WSVID     ANDLTNIDT                                                          CAS009
     C           WSVID     OREQ NIDT                                                          CAS009
     C                     Z-ADDWSVID     WVALD                                               CAS009
     C           WSVID     WHEQ 0                                                             CAS009
     C           NIDT      ANDNE0                                                             CAS009
     C           NIDT      ORNE 0                                                             CAS009
     C           NIDT      ANDLTWSVID                                                         CAS009
     C           WSVID     OREQ NIDT                                                          CAS009
     C                     Z-ADDNIDT      WVALD                                               CAS009
     C                     ENDSL                                                              CAS009
     C                     EXSR SEIRI1                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           WSVRP     IFNE NRPD                                                          CAS009
     C           SRFRQ     ORNE RFRQ                                                          CAS009
     C           SRDYN     ORNE ARDYN                                                         CAS009
     C           WSVRA     ORNE RAMT                                                          CAS009
     C           WSVFA     ORNE FCRA                                                          CAS009
     C                     MOVE SOLNO     WTRAN                                               CAS009
     C                     SELEC                                                              CAS009
     C           NRPD      WHEQ 0                                                             CAS009
     C           WSVRP     ANDNE0                                                             CAS009
     C           WSVRP     ORNE 0                                                             CAS009
     C           WSVRP     ANDLTNRPD                                                          CAS009
     C           WSVRP     OREQ NRPD                                                          CAS009
     C                     Z-ADDWSVRP     WVALD                                               CAS009
     C           WSVRP     WHEQ 0                                                             CAS009
     C           NRPD      ANDNE0                                                             CAS009
     C           NRPD      ORNE 0                                                             CAS009
     C           NRPD      ANDLTWSVRP                                                         CAS009
     C           WSVRP     OREQ NRPD                                                          CAS009
     C                     Z-ADDNRPD      WVALD                                               CAS009
     C                     ENDSL                                                              CAS009
     C                     EXSR SEIRI1                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           WSVMD     IFNE MDAT                                                          CAS009
     C                     MOVE SOLNO     WTRAN                                               CAS009
     C                     SELEC                                                              CAS009
     C           MDAT      WHEQ 0                                                             CAS009
     C           WSVMD     ANDNE0                                                             CAS009
     C           WSVMD     ORNE 0                                                             CAS009
     C           WSVMD     ANDLTMDAT                                                          CAS009
     C           WSVMD     OREQ MDAT                                                          CAS009
     C                     Z-ADDWSVMD     WVALD                                               CAS009
     C           WSVMD     WHEQ 0                                                             CAS009
     C           MDAT      ANDNE0                                                             CAS009
     C           MDAT      ORNE 0                                                             CAS009
     C           MDAT      ANDLTWSVMD                                                         CAS009
     C           WSVMD     OREQ MDAT                                                          CAS009
     C                     Z-ADDMDAT      WVALD                                               CAS009
     C                     ENDSL                                                              CAS009
     C                     MOVE 'Y'       WADJP                                               CAS009
     C                     EXSR SEIRI1                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     SELEC
      *
      ** Insert processing
      *
     C           SACTN     WHEQ 'I'
      *
     C                     MOVE 'D'       RECI
     C                     MOVE SLNRF     LNRF
     C                     MOVE 'A'       RCDT
     C                     Z-ADD1         MRIN
     C                     Z-ADDWLNPT     PTYP
     C                     MOVE WSVCN     CNUM
      *
     C                     MOVE SBRCA     BRCA
     C                     MOVE SLTYP     LTYP
     C                     MOVE SSUTP     SUTP
     C                     Z-ADDWSVDD     DDAT
     C                     Z-ADDWSVVD     VDAT
     C                     MOVE SACSQ     LASQ
      *
     C                     MOVE SCURR     CCY
     C                     Z-ADDWSVAM     CPAM
      *                                                                                       CLE031
      ** If CLE031 is on, facility currency is not equal to SCURR and                         CLE031
      ** principal amount is not inputted (WSVAM = 0), convert                                CLE031
      ** facility currency principal amount to loan currency amount.                          CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           PMODE     IFNE 'B'                                                           CLE031
     C           SFCCY     ANDNESCURR                                                         CLE031
     C           WSVAM     ANDEQ*ZERO                                                         CLE031
     C***********PMODE     OREQ 'B'                                                    CLE031 226238
     C***********SFCCY     ANDNESCURR                                                  CLE031 226238
     C***********WFCPAM    ANDNE*ZERO                                                  CLE031 226238
      *                                                                                       CLE031
      ** Convert facility currency exchange rate to file format                               CLE031
      *                                                                                       CLE031
     C           *IN22     IFEQ *ON                                                           CLE031
     C                     Z-ADDFCXRM     ZEXCH                                               CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   PSCRF                                               CLE031
     C                     MOVE SFCXR     PSCRF                                               CLE031
     C                     Z-ADD8         PNDEC                                               CLE031
     C                     Z-ADD5         PNDIG                                               CLE031
     C                     CALL 'ZALIGN'  PPAR1                                               CLE031
      *                                                                                       CLE031
      ** ... move output PRVAL to ZALIGN parameter ZEXCH.                                     CLE031
      *                                                                                       CLE031
     C                     MOVE PRVAL     ZEXCH                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE SCURR     ZCCYI                                               CLE031
     C                     MOVE FCCYF     ZCCYO                                               CLE031
     C                     MOVE WFCNBP    ZCDPI                                               CLE031
     C                     MOVE WCDPL     ZCDPO                                               CLE031
     C                     Z-ADDWFCPAM    ZAMTCI                                              CLE031
     C           *IN22     IFEQ *ON                                                           CLE031
     C           FMDIM     ANDEQ'D'                                                           CLE031
     C           *IN22     OREQ *OFF                                                          CLE031
     C           SFMIN     ANDEQ'D'                                                           CLE031
     C                     MOVE 'M'       ZMD                                                 CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'D'       ZMD                                                 CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Convert facility currency principal amount to loan amount,                           CLE031
      ** update current principal amount with the converted amount                            CLE031
      ** and update facility currency principal amount with WFCPAM.                           CLE031
      *                                                                                       CLE031
     C                     EXSR ZCONV                                                         CLE031
     C                     Z-ADDZAMTCO    WCFCPA                                              CLE031
     C                     Z-ADDWCFCPA    CPAM                                                CLE031
     C                     Z-ADDWFCPAM    FPAM                                                CLE031
     C                     ENDIF                                                              CLE031
     C           PMODE     IFEQ 'B'                                                           226238
     C           SFCCY     ANDNESCURR                                                         226238
     C           WFCPAM    ANDNE*ZERO                                                         226238
     C                     Z-ADDWFCPAM    FPAM                                                226238
     C                     ENDIF                                                              226238
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVE SINTC     INTC
     C           SINTC     IFEQ *BLANK
     C                     MOVE 'N'       INTC
     C                     ENDIF
     C                     Z-ADDWINTT     INTR
     C                     Z-ADDINTR      OINTR                           CPL002
     C                     MOVE SBRTT     BRTT
     C                     Z-ADDBASER     BRTE
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C           BRTT      ANDEQ0                                                             CLE036
     C                     Z-ADDBASER     BASR                                                CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     Z-ADDWSVRS     RTSP
     C                     MOVE SSPIN     SPIN
      *
      ** Default SPIN to 'A' if risk loan with no interest details:                           206257
      *                                                                                       206257
     C           SSPIN     IFEQ *BLANKS                                                       206257
     C           SBRTT     ANDEQ*BLANKS                                                       206257
     C           SRTSP     ANDEQ*BLANKS                                                       206257
     C           WLNPT     IFEQ 70                                                            206257
     C           WLNPT     OREQ 71                                                            206257
     C           WLNPT     OREQ 72                                                            206257
     C                     MOVE 'A'       SPIN                                                206257
     C                     ENDIF                                                              206257
     C                     ENDIF                                                              206257
      *                                                                                       206257
     C                     MOVE SCHIN     CHIN
     C           SCHIN     IFEQ *BLANK
      *                                                                                       CLE031
      ** If CLE031 is on, facility currency is not equal to SCURR and                         CLE031
      ** principal amount is not inputted (WSVAM = 0), recalculate                            CLE031
      ** total interest. WDINT is a flag not to display interest                              CLE031
      ** calculated by the system. Save calculated interest to WTOTI.                         CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           SFCCY     ANDNESCURR                                                         CLE031
     C           WSVAM     ANDEQ*ZERO                                                         CLE031
     C                     Z-ADDCPAM      WSVAM                                               CLE031
     C                     MOVE 'N'       WDINT   1                                           CLE031
     C                     EXSR SRCINT                                                        CLE031
     C                     MOVE *BLANK    WDINT                                               CLE031
     C                     Z-ADDWCHKI     WTOTI                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           WLNPT     IFEQ 63
     C           WLNPT     OREQ 65
     C           WLNPT     OREQ 67
     C           WLNPT     OREQ 72                                        CLE005
     C           W72TP     ANDEQ'67'                                      CLE005
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           WLNPT     ANDEQ80                                                            CLE028
     C                     MOVE 'N'       CHIN
     C                     ELSE
     C/COPY WNCPYSRC,LE2030C085
     C                     MOVE 'D'       CHIN
     C/COPY WNCPYSRC,LE2030C086
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVE SWTIN     WTIN
     C                     MOVE SREPT     REPT
     C           SREPT     IFEQ *BLANK
     C                     MOVE '0'       REPT
     C                     ENDIF
     C                     Z-ADDWSVBX     BCXR
     C                     Z-ADDWSVRD     RLDT
     C                     MOVE SRLFQ     RLFQ
     C                     MOVE SRLDY     RLDY
     C                     MOVE SRDFC     RDFC
     C                     MOVE WBMIN     BMDI
     C                     MOVE SCALC     ICBS
     C                     Z-ADDWSVVD     SLID
     C                     Z-ADDWSVVD     DLRC
     C                     Z-ADDWSVVD     IACD
     C                     MOVE WLONI     LONI
     C                     Z-ADDBJRDNB    ORED
     C                     MOVE SADDI     ADDI
     C           BGN0ST    IFEQ 'Y'
     C           CDE002    OREQ 'Y'                                       CDE002
     C                     Z-ADDWSVVD     FCTD
     C                     ENDIF
      *
     C                     MOVE WBOFF     ACEI
     C                     MOVE WBOFF     CBLI
     C                     MOVE WBOFF     TLXI
     C           PMODE     IFEQ 'B'                                       120002
     C                     MOVE PIUSR     IUSR                            120002
     C                     MOVE PAUSR     AUSR                            120002
     C                     MOVE PXUSR     XUSR                            120002
     C                     ELSE                                           120002
     C                     MOVE USER      IUSR
     C                     ENDIF                                          120002
      *
      ** ... automatic authorised status if CLE002 is not installed
      ** or if authorisation of that kind of loan is not allowed
      *
     C                     MOVE 'A'       LSTS
     C           CLE002    IFEQ 'Y'
     C           PMODE     ANDNE'B'                                       120278
     C           *IN21     IFEQ '1'
     C           BPPPAU    ANDEQ'Y'
     C           *IN22     OREQ '1'
     C           BPPSAU    ANDEQ'Y'
     C           *IN21     OREQ '0'
     C           *IN22     ANDEQ'0'
     C           BPLOAU    ANDEQ'Y'
     C***********PMODE     ANDNE'B'                                120002 120278
     C                     MOVE 'C'       LSTS
     C                     ENDIF
     C                     ENDIF
      *                                                                   123227
      ** If created by principal transfer, check authorisation            123227
      *                                                                   123227
     C           CLE002    IFEQ 'Y'                                       123227
     C           PMODE     ANDEQ'B'                                       123227
     C           PPCOB     IFEQ *BLANKS                                   123227
     C           BPTPAU    ANDEQ'Y'                                       123227
     C                     MOVE 'C'       LSTS                            123227
     C                     ENDIF                                          123227
     C                     ENDIF                                          123227
     C/COPY WNCPYSRC,LE2030C073
      *
      ** ... for parts sold, get the values of some fields from
      ** the related loan, otherwise get them from screen entries
      *
     C           *IN22     IFEQ '1'
     C                     MOVE SOLNO     OLNO
     C                     MOVE 'N'       BTIN
     C                     Z-ADD*ZEROS    BLDY
     C/COPY WNCPYSRC,LE2030C093
     C**********           Z-ADDFCUSM     FCUS                                                CSD027
     C                     MOVE FCUSM     FCUS                                                CSD027
     C                     Z-ADDFTYPM     FTYP
     C                     Z-ADDFSEQM     FSEQ
     C**********           MOVE LINDM     LIND                                                CER020
     C                     MOVE LOICM     LOIC                                                CER020
     C                     MOVE CRSKM     CRSK
     C                     MOVE ORBRM     ORBR
     C                     Z-ADDFCXRM     FCXR
     C                     MOVE FMDIM     FMDI
     C                     MOVE FCCYM     FCCY
     C                     MOVE FCLBM     FCLB
      *                                                                   134725
      ** Move multi-ccy rollover details of sale of loan number to        134725
      ** Parts Sold.                                                      134725
      *                                                                   134725
     C           RLDTM     IFNE *ZEROS                                    134725
     C           NCCYM     ANDNE*BLANKS                                   134725
     C           NCCYM     ANDNECCYM                                      162899
      *                                                                   134725
     C           WSVRD     IFEQ 0                                         134725
     C                     Z-ADDRLDTM     RLDT                            134725
     C                     ENDIF                                          134725
     C                     MOVE NCCYM     NCCY                            134725
     C                     Z-ADDNFCEM     NFCE                            134725
     C                     MOVE NFMDM     NFMD                            134725
     C                     Z-ADDNBCEM     NBCE                            134725
     C                     MOVE NBMDM     NBMD                            134725
     C           NBRAM     IFNE *ZEROS                                    134725
     C                     Z-ADDNBRAM     NBRA                            134725
     C                     Z-ADDNCASM     NCAS                            134725
     C                     MOVE NCHIM     NCHI                            134725
     C                     ENDIF                                          134725
     C                     Z-ADDFCXRM     ZRATE1                          134725
     C                     MOVE FMDIM     ZMDI1                           134725
     C                     MOVE NFMDM     ZMDI2                           134725
     C                     Z-ADDNFCEM     ZRATE2                          134725
     C                     EXSR ZXRATE                                    134725
     C                     Z-ADDA6NBDP    ZCDPI                           134725
     C                     Z-ADDNBDPM     ZCDPO                           134725
     C                     Z-ADDWSVAM     ZAMTCI                          134725
     C                     Z-ADD*ZEROS    ZAMTCO                          134725
     C                     Z-ADDZRATEX    ZEXCH                           134725
     C                     MOVE ZMDIX     ZMD                             134725
     C                     EXSR ZCONV                                     134725
     C                     Z-ADDZAMTCO    NCPA                            134725
      *                                                                   134725
     C           WSVRA     IFNE *ZEROS                                    134725
     C           WSVRP     ANDLERLDTM                                     134725
     C                     Z-ADDWSVRA     ZAMTCI                          134725
     C                     EXSR ZCONV                                     134725
     C                     Z-ADDZAMTCO    NLRA                            134725
     C                     ENDIF                                          134725
     C                     ENDIF                                          134725
      *                                                                   134725
     C                     ELSE
     C                     MOVE SFCUS     FCUS
     C                     MOVE SFTYP     FTYP
     C                     MOVE SFSEQ     FSEQ
     C                     Z-ADDWSVFX     FCXR
     C                     MOVE WFMIN     FMDI
     C                     MOVE FCCYF     FCCY
     C                     MOVE BRCAF     FCLB
     C                     ENDIF
     C           *IN21     IFEQ '1'                                       124001
     C                     MOVE SMLNR     MLNR                            124001
     C                     ENDIF                                          124001
      *
     C                     MOVE SLNKS     LNKS
     C                     MOVE 'N'       GPRT
     C           PGNTF     IFEQ 'Y'
     C                     MOVE 'Y'       GPRT
     C                     ENDIF
     C                     MOVE WLPFI     LPFI
     C**********           Z-ADDWPTFC     PTFC                                                CSD027
     C                     MOVE WPTFC     PTFC                                                CSD027
     C                     Z-ADDWPTFT     PTFT
     C                     Z-ADDWPTFN     PTFN
     C                     MOVE SASSN     GASS                            120813
      *                                                                   CLE011
      ** Move display field of Rate fixing days to file field             CLE011
      *                                                                   CLE011
     C           CLE011    IFEQ 'Y'                                       CLE011
     C                     MOVELSRFDY     RFDY                            CLE011
     C                     ENDIF                                          CLE011
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C                     Z-ADDCPAM      FSCPAM                                              CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE SSTAL     STAL                                                CLE034
     C                     ENDIF                                                              CLE034
      *
     C                     EXSR SRINAM
      *
      ** Amend processing
      *
     C           SACTN     WHEQ 'A'
      *
     C                     MOVELLSWS      WLSWS   2
     C                     MOVELLSWC      WLSWC   2
     C           WLSWC     IFEQ *BLANKS
     C                     Z-ADD*ZEROS    LSWC
     C                     ENDIF
     C           WLSWS     IFEQ *BLANKS
     C                     Z-ADD*ZEROS    LSWS
     C                     ENDIF
      *                                                                   157756
      ** If next interest payment date is amended and is less than        157756
      ** the maturity date, reset bit 2(interest) of telex indicator      157756
      ** to generate new message.                                         157756
      *                                                                   157756
     C           SNIDT     IFNE *BLANK                                    157756
     C           SAUTO     ANDEQ'Y'                                       157756
     C           SAUTO     ANDEQAUTO                                      157756
     C           WSVID     ANDNENIDT                                      157756
     C           WSVID     ANDLTWSVMD                                     157756
     C           BJRDNB    ANDGTORED                                      157756
     C                     BITOF'2'       TLXI                            157756
     C                     ENDIF                                          157756
      *                                                                   157756
      ** If next repayment date is amended and is less than               157756
      ** the maturity date, reset bit 3(repayment) of telex indicator     157756
      ** to generate new message.                                         157756
      *                                                                   157756
     C           SNRPD     IFNE *BLANK                                    157756
     C           SAUTO     ANDEQ'Y'                                       157756
     C           SAUTO     ANDEQAUTO                                      157756
     C           WSVRP     ANDNENRPD                                      157756
     C           WSVRP     ANDLTWSVMD                                     157756
     C           BJRDNB    ANDGTORED                                      157756
     C                     BITOF'3'       TLXI                            157756
     C                     ENDIF                                          157756
      *                                                                   157756
      ** If maturity is amended and is less than the maturity date        157756
      ** (early mature), reset bit 1(Maturity) of field TLXI to gene -    157756
      ** rate new message.                                                157756
      *                                                                   157756
     C           SMDAT     IFNE *BLANK                                    157756
     C           SAUTO     ANDEQ'Y'                                       157756
     C           SAUTO     ANDEQAUTO                                      157756
     C           WSVMD     ANDLTMDAT                                      157756
     C           BJRDNB    ANDGTORED                                      157756
     C                     BITOF'1'       TLXI                            157756
     C                     ENDIF                                          157756
      *
     C                     MOVE WACEI     ACEI
     C                     MOVE WCBLI     CBLI
     C           WLNPT     IFEQ 63
     C                     Z-ADDWORMD     ORMD
     C                     Z-ADDWORTI     ORTI
     C                     ENDIF
     C           S01465    IFEQ 'Y'
     C           WSVMD     ANDNEMDAT
     C                     Z-ADDMDAT      OMDT
     C                     ENDIF
     C           PMODE     IFEQ 'B'                                       120002
     C                     MOVE PAUSR     AUSR                            120002
     C                     MOVE PXUSR     XUSR                            120002
     C                     ELSE                                           120002
     C                     MOVE USER      AUSR
     C                     ENDIF                                          120002
      *
      ** ... automatic authorised status if CLE002 is not installed
      ** or if authorisation of that kind of loan is not allowed
      *
     C           CLE002    IFEQ 'Y'
     C           PMODE     ANDNE'B'                                       120002
      *
     C           *IN21     IFEQ '1'
     C           BPPPAU    ANDEQ'Y'
     C           *IN22     OREQ '1'
     C           BPPSAU    ANDEQ'Y'
     C           *IN21     OREQ '0'
     C           *IN22     ANDEQ'0'
     C           BPLOAU    ANDEQ'Y'
      *
     C           LSTS      IFEQ 'A'
     C           LSTS      OREQ 'R'                                       194509
     C                     MOVE 'R'       LSTS
     C                     ELSE
     C                     MOVE 'C'       LSTS
     C                     ENDIF
      *
     C                     ELSE
     C                     MOVE 'A'       LSTS
     C                     ENDIF
      *
      ** Consider principal transfer authorisation                        123227
      *                                                                   123227
     C                     ELSE
     C                     SELEC                                          123227
     C           CLE002    WHEQ 'N'                                       123227
     C           BPTPAU    OREQ 'N'                                       123227
     C           PMODE     OREQ 'B'                                       123227
     C           PPCOB     ANDNE*BLANKS                                   123227
     C                     MOVE 'A'       LSTS
     C           LSTS      WHEQ 'A'                                       123227
     C           LSTS      OREQ 'R'                                       194509
     C                     MOVE 'R'       LSTS                            123227
     C                     OTHER                                          123227
     C                     MOVE 'C'       LSTS                            123227
     C                     ENDSL                                          123227
     C                     ENDIF
      *                                                                   CLE011
      ** Move display field of Rate fixing days to file field             CLE011
      *                                                                   CLE011
     C           CLE011    IFEQ 'Y'                                       CLE011
     C                     MOVELSRFDY     RFDY                            CLE011
     C                     ENDIF                                          CLE011
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE SSTAL     STAL                                                CLE034
     C                     ENDIF                                                              CLE034
      *
     C/COPY WNCPYSRC,LE2030C102
      ***...*loan*will*be*unlinked*if*any*of*the*financial*information*   153663
      ***has*been*changed:*interest,*rollover*and*repayment*details****   153663
      *
     C***********PMODE     IFEQ 'B'                                 125545153663
     C***********W#SEQ     ANDGT1                                   125545132564
     C***********W#SEQ     ANDEQ1                                   132564153663
     C***********PMODE     ORNE 'B'                                 125545153663
     C***********LNKS      IFEQ 'Y'                                 125545153663
     C***********LINK1     IFNE LINKS1                                    153663
     C***********LINK2     ORNE LINKS2                                    153663
     C***********          MOVE 'N'       LNKS                            153663
     C***********          ELSE                                           153663
     C***********          MOVE SLNKS     LNKS                            153663
     C***********          ENDIF                                          153663
     C***********          ELSE                                           153663
     C***********          MOVE SLNKS     LNKS                            153663
     C***********          ENDIF                                          153663
     C***********          ELSE                                     125545153663
     C                     MOVE SLNKS     LNKS                            125545
     C***********          ENDIF                                    125545153663
      *
     C                     EXSR SRINAM
      *
      ** Reversal processing
      *
     C           SACTN     WHEQ 'R'
     C                     MOVE 'R'       RECI
     C***********          MOVE 'D'       LSTS                            120002
     C                     MOVE 'A'       LSTS                            120002
     C                     MOVE WCNFI     CNFI                            155674
      *
      ** Authorisation processing
      *
     C           SACTN     WHEQ 'X'
     C                     MOVE 'A'       LSTS
     C                     MOVE USER      XUSR
     C                     Z-ADDNIDT      OIDT    50                      142405
     C                     ENDSL
      *
      ** Set up common fields
      *
      *  Do not save last change type as authorisation (X)                122649
      *                                                                   122649
     C           SACTN     IFNE 'X'                                       122649
     C                     MOVE SACTN     CHTP
     C                     ENDIF                                          122649
      *                                                                   122649
     C                     Z-ADDNATN      TNLU
     C           PMODE     IFEQ 'B'
     C                     MOVE PTDT3     ZWYYYY
     C           BJDFIN    IFEQ 'M'
     C                     MOVE PTDT1     ZWMTH
     C                     MOVE PTDT2     ZWDAY
     C                     ELSE
     C                     MOVE PTDT1     ZWDAY
     C                     MOVE PTDT2     ZWMTH
     C                     ENDIF
     C                     EXSR ZDAT10
     C**********           Z-ADDZZMDNO    LCD                                     MD035570
     C                     Z-ADDBJRDNB    LCD                                     MD035570
     C           PGNTF     IFNE 'Y'
     C***********          MOVE 'S'       MNSG                            122461
     C                     MOVE PTREF     PCRFL                           150744
     C                     ENDIF
     C                     MOVE PTOLN     TOLN
     C***********          MOVE PTREF     PCRFL                           150744
      *
     C                     ELSE
     C                     Z-ADDBJRDNB    LCD
     C                     ENDIF
      *                                                                   122461
      * Setting of 'manual/system generated' flag.                        122461
     C                     SELEC                                          122461
     C           SACTN     WHEQ 'X'                                       122461
     C           PMODE     WHEQ 'B'                                       122461
     C           W#SEQ     ANDNE1                                         122461
     C           PPTIN     ANDNE'T'                                       122461
     C                     MOVE 'S'       MNSG                            122461
     C                     OTHER                                          122461
     C                     MOVE 'M'       MNSG                            122461
     C                     ENDSL                                          122461
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRINAM  -  Format CLOANCL fields for insert and amend         *
      * Called by: SRLONL - Format CLOANCL fields for update          *
      * Calls    : None                                               *
      *****************************************************************
     C           SRINAM    BEGSR
      *
     C                     Z-ADDWSVMD     MDAT
     C                     Z-ADDWSVMG     MARG
     C                     Z-ADDWSVWT     WTRT
     C                     Z-ADDWSVRA     RAMT
     C                     Z-ADDWSVRP     NRPD
     C                     MOVE SRFRQ     RFRQ
     C                     MOVE SRDYN     RDYN
     C                     MOVE SACOF     ACOF
     C                     MOVE SNACD     NACD
     C                     MOVE WRELI     RELI
     C                     MOVE SAUTO     AUTO
     C                     Z-ADDWSDST     SDST
     C                     MOVE WOSDA     OSDA
     C                     MOVE WTSTN     TSTN
     C                     Z-ADDWMDST     MDST
     C                     MOVE WOMDA     OMDA
     C                     MOVE WTMAN     TMAN
     C                     MOVE WFACO     FACO
     C           PMPPAY    IFNE 'Y'                                                         AR548562
     C                     MOVE WOSDB     OSDB
     C                     ENDIF                                                            AR548562
      *                                                                                     AR548562
     C           PMPRCV    IFNE 'Y'                                                         AR548562
     C                     MOVE WOMDB     OMDB
     C                     ENDIF                                                            AR548562
      *                                                                                     AR548562
     C                     Z-ADDW#OIDT    OIDT                            142405
      *
     C                     MOVE SRCSI     RCSI
     C                     MOVE SIPFR     IPFR
      *                                                                                       CLE031
      ** If CLE031 is on, facility currency is not equal to SCURR and                         CLE031
      ** principal amount is not inputted (WSVAM = 0), recalculate                            CLE031
      ** total interest. WDINT is a flag not to display interest                              CLE031
      ** calculated by the system. Save calculated interest to WTOTI.                         CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           SFCCY     ANDNESCURR                                                         CLE031
     C           WSVAM     ANDEQ*ZERO                                                         CLE031
     C                     Z-ADDCPAM      WSVAM                                               CLE031
     C                     MOVE 'N'       WDINT   1                                           CLE031
     C                     EXSR SRCINT                                                        CLE031
     C                     MOVE *BLANK    WDINT                                               CLE031
     C                     Z-ADDWCHKI     WTOTI                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           WLNPT     IFEQ 63
     C           WLNPT     OREQ 65
     C           WLNPT     OREQ 67
     C           WLNPT     OREQ 72                                        CLE005
     C           W72TP     ANDEQ'67'                                      CLE005
     C           PMODE     IFEQ 'B'
     C           PGNTF     ANDNE'Y'
     C           PMODE     ORNE 'B'
     C                     Z-ADDWTOTI     TOTI
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CLE028
      ** For flat rate personal loans update total flat interest field (FLTI)                 CLE028
      ** with the computed interest                                                           CLE028
      *                                                                                       CLE028
     C           WLNPT     IFEQ 80                                                            CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C                     Z-ADDWTOTI     FLTI                                                CLE028
     C                     Z-ADDWFRPD     FRPD                                                CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     Z-ADDWSVID     NIDT
     C                     MOVE SIFDY     IFDY
     C                     MOVE WCNFI     CNFI
     C                     Z-ADDNATN      TNLU
     C                     MOVE SBOKC     BOKC
     C                     Z-ADDWSVID     IBDT
     C                     Z-ADDWSVRP     RBDT
      *
      ** ... Fields for BLI Lending Enhancement (S01465)
      *
     C           BPGIAV    IFEQ 'Y'
     C           SRECE     ANDNE*BLANKS
     C/COPY WNCPYSRC,LEH00549
     C                     MOVELSRECE     RECE
     C                     ENDIF
     C           S01465    IFEQ 'Y'
     C                     MOVE SCOCU     COCU
     C                     MOVE SAPMI     APMI
     C                     ENDIF
      *                                                                                       CLE028
      ** Move Add on Interest, Add on Charges, Charge Amount and                              CLE028
      ** Include Charges in Interest from display field to file field                         CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           SACTN     IFEQ 'I'                                                           CLE028
     C           SACTN     OREQ 'A'                                                           CLE028
     C           WPRCS2    ANDNE'Y'                                                           CLE028
     C                     MOVE SADIF     ADIF                                                CLE028
     C                     MOVE SADCF     ADCF                                                CLE028
     C                     Z-ADDWCHGA     CHGA                                                CLE028
     C                     MOVE SICIF     ICIF                                                CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *
      ** ... Extended settlement details
      *
     C                     Z-ADDPMRSTM    RSTM
     C                     MOVE PMRONS    RONS
     C                     MOVE PARIBN    RIBN
     C                     MOVE PMRIBA    RIBA
     C                     MOVE PAROBN    ROBN
     C                     MOVE PAROCN    ROCN
     C                     Z-ADDPMPSTM    PSTM
     C                     MOVE PMPONS    PONS
     C                     MOVE PAPIBN    PIBN
     C                     MOVE PMPIBA    PIBA
     C                     MOVE PAPOBN    POBN
     C                     MOVE PAPOCN    POCN
     C                     MOVE PARCRN    RCRN
     C                     MOVE PMRCRA    RCRA
     C                     MOVE PARVNO    RVNO
     C                     MOVE PAAWBN    AWBN
     C                     MOVE PMAWBA    AWBA
     C                     MOVE PABENN    BENN
     C                     MOVE PMBENA    BENA
     C                     MOVE PMDTP1    DTP1
     C                     MOVE PMDTP2    DTP2
     C                     MOVE PMDTP3    DTP3
     C                     MOVE PMDTP4    DTP4
     C                     MOVE PMDCHG    DCHG
     C                     MOVE PMBTB1    BTB1
     C                     MOVE PMBTB2    BTB2
     C                     MOVE PMBTB3    BTB3
     C                     MOVE PMBTB4    BTB4
     C                     MOVE PMBTB5    BTB5
     C                     MOVE PMBTB6    BTB6
     C                     MOVE PMCVMR    CVMR
     C                     MOVE WPTFR     PTFR
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
      *                                                                                       191152
      ** Check whether the loan being processed is parts. sold                                191152
      *                                                                                       191152
     C           *IN22     IFEQ '0'                                                           191152
     C                     MOVE PMRSCY    SCCY                                                191152
     C                     ELSE                                                               191152
     C                     MOVE PMPSCY    SCCY                            CEU004
     C                     ENDIF                                                              191152
     C                     MOVE PMIC72    ICCY                            CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
      ** If CLE031 is switched on, update REXR, REXI, PEXR, PEXI,                             CLE031
      ** and PSCY.                                                                            CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     Z-ADD*ZERO     WSEXR  138                                          CLE031
     C                     Z-ADD8         PNDEC                                               CLE031
     C                     Z-ADD5         PNDIG                                               CLE031
     C                     MOVE *BLANKS   PSCRF                                               CLE031
     C                     MOVE PMREXR    PSCRF                                               CLE031
     C                     CALL 'ZALIGN'  PPAR1                                               CLE031
     C                     MOVE PRVAL     WSEXR                                               CLE031
     C                     Z-ADDWSEXR     REXR                                                CLE031
     C                     MOVE PMREXI    REXI                                                CLE031
      *                                                                                       CLE031
     C                     MOVE PMRSCY    SCCY                                                CLE031
      *                                                                                       CLE031
     C                     MOVE *BLANKS   PSCRF                                               CLE031
     C                     MOVE PMPEXR    PSCRF                                               CLE031
     C                     CALL 'ZALIGN'  PPAR1                                               CLE031
     C                     Z-ADD*ZERO     WSEXR                                               CLE031
     C                     MOVE PRVAL     WSEXR                                               CLE031
     C                     Z-ADDWSEXR     PEXR                                                CLE031
     C                     MOVE PMPEXI    PEXI                                                CLE031
      *                                                                                       CLE031
     C                     MOVE PMPSCY    PSCY                                                CLE031
     C                     ENDIF                                                              CLE031
      *
      ** ... Additional fields for analytical accounting
      ** Related fields should be updated only if analytical                                  204786
      ** accounting is installed and fields are not protected.                                204786
      *
     C           BGN0ST    IFEQ 'Y'                                                           204786
     C           WFUNP     ANDEQ*BLANK                                                        204786
      *                                                                                       204786
     C                     Z-ADDWFSRP     FSRP
     C                     MOVE SFSGN     FSGN
     C                     MOVE SFPRC     FPRC
      *                                                                                       204786
     C                     ENDIF                                                              204786
      *                                                                   CDE002
     C           CDE002    IFEQ 'Y'                                       CDE002
     C           PTYP      ANDLT70                                                            208221
      *                                                                   CDE002
     C           SACTN     IFEQ 'I'                                       CDE002
     C           FSRP      ANDEQ0                                         CDE002
      *                                                                   CDE002
     C           INTR      SUB  WSVMG     FSRP                            CDE002
     C           FSRP      IFLT *ZERO                                     CDE002
     C                     Z-ADD0         FSRP                            CDE002
     C                     ENDIF                                          CDE002
      *                                                                   CDE002
     C                     ENDIF                                          CDE002
      *                                                                   CDE002
     C                     ENDIF                                          CDE002
      *
      ** ... Syndicated loans details
      *
     C                     MOVE SDFTP     DFTP
     C                     MOVE SDFST     DFST
     C                     MOVE SMCRA     MCRA
     C                     MOVE WSVFA     FCRA
     C                     MOVE SPDDI     PDDI
     C                     MOVE SPTDI     PTDI
     C                     MOVE SGDPR     GDPR
     C                     MOVE SGDIN     GDIN
     C***********          MOVE 'M'       MNSG                            122461
     C           BPCONR    IFEQ 'Y'
     C                     MOVE 'N'       CNCF
     C                     ELSE
     C                     MOVE *BLANK    CNCF
     C                     ENDIF
      *
      ** ... set up fields depending on processing type
      *
     C           *IN22     IFEQ '0'
     C                     MOVE SBTIN     BTIN
     C                     MOVE SBLDY     BLDY
     C/COPY WNCPYSRC,LE2030C094
     C**********           MOVE SLIND     LIND                                                CER020
     C                     MOVE SLIND     LOIC                                                CER020
     C                     MOVE SCRSK     CRSK
     C                     MOVE SPRFC     PRFC
     C                     MOVE SORBR     ORBR
     C                     ENDIF
     C           *IN21     IFEQ '1'
     C                     MOVELSCUST     OLNO
     C                     ENDIF
     C           *IN22     IFEQ '1'
     C                     MOVE PRFCM     PRFC
     C                     ENDIF
      *                                                                                       CAS001
      ** When CAS001 enhancement is installed                                                 CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVE #6YLDC    FSYLDC                                              CAS001
     C                     MOVE #6FYLD    FSFYLD                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       225491
     C           PMODE     IFEQ 'B'                                                           225491
     C           PGNTF     ANDEQ'Y'                                                           225491
     C           SACTN     ANDEQ'I'                                                           225491
     C           PPTIN     ANDEQ'T'                                                           225491
      *                                                                                       225491
      ** If inserted due to a Principal Transfer, allocate Timestamp:                         225491
     C                     CALL 'ZAGENTS'                                                     225491
     C                     PARM           NEWTIM 26                                           225491
     C                     MOVELNEWTIM    CLTMST                                              225491
     C                     MOVELNEWTIM    CKTMST                                              225491
     C                     ENDIF                                                              225491
      *                                                                                      BUG4524
     C           CKTMST    IFEQ *BLANK                                                       BUG4524
     C                     MOVELSTAMP,1   CKTMST                                             BUG4524
     C                     ENDIF                                                             BUG4524
     C           CLTMST    IFEQ *BLANK                                                       BUG4524
     C                     MOVELSTAMP,1   CLTMST                                             BUG4524
     C                     ENDIF                                                             BUG4524
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRLONK  -  Format CLOANCK fields for update                   *
      * Called by: SRINSR - Insert record in files                    *
      *            SRUPDR - Amend existing record in files            *
      * Calls    : None                                               *
      *****************************************************************
     C           SRLONK    BEGSR
      *
      ** Set up fields common to insert and amend
      *
     C                     SELEC
     C           SACTN     WHEQ 'I'
     C           SACTN     OREQ 'A'
     C                     MOVE SNAR1     NAR1
     C                     MOVE SNAR2     NAR2
     C                     MOVE SNAR3     NAR3
     C                     MOVE SNAR4     NAR4
     C                     MOVE SFRBC     FRBC
     C                     MOVE SSPI1     SPI1
     C                     MOVE SSPI2     SPI2
     C                     MOVE SSPI3     SPI3
      *
      ** Set up fields for insert only
      *
     C           SACTN     IFEQ 'I'
     C                     MOVE 'D'       RECI
     C                     MOVE SLNRF     LNRF
     C                     MOVE 'B'       RCDT
     C                     Z-ADD4         MRIN
     C                     Z-ADDWSVAM     OPAM
     C***                  Z-ADDBJRDNB    ORED                            158054
     C                     Z-ADDBJRDNB    OREDK                           158054
     C***********PMODE     IFEQ 'I'                                 158051158050
     C           PMODE     IFEQ 'I'                                                           218581
     C           3         SUBSTPCRFL     RPCR      P                     121970
     C***********PMODE     IFEQ 'I'                                                    158050 218581
     C********** *LOCK     IN   LEALLO                                                 158046 CLE148
     C********** PCLAST    ADD  1         PCNEXT  80                                   158046 CLE148
     C                     CALL 'LEALLO'                                                      CLE148
     C                     PARM *BLANKS   PRTCD                                               CLE148
     C                     PARM 'Y'       PUPDT                                               CLE148
     C                     PARM *BLANKS   PCLAST                                              CLE148
     C                     PARM *BLANKS   PCNEXT                                              CLE148
      *                                                                                       CLE148
     C                     MOVE PCNEXT    W1ST11                          158046
     C                     MOVELW#1ST3    W1ST11                          158046
     C                     MOVELW1ST11    RPCR                            158046
     C                     MOVE '0001'    RPCR                            158046
     C**********           Z-ADDPCNEXT    PCLAST                                       158046 CLE148
     C**********           OUT  LEALLO                                                 158046 CLE148
     C                     ENDIF                                          158051
     C                     MOVE 'A'       RSTS                            123021
     C                     ENDIF
      *
      ** Change record id for reversal
      *
     C           SACTN     WHEQ 'R'
     C                     MOVE 'R'       RECI
     C                     ENDSL
      *
      ** Set up common fields
      *
     C                     Z-ADDBJRDNB    LCD
      *                                                                   122649
      *  Do not save last change type as authorisation (X)                122649
      *                                                                   122649
     C           SACTN     IFNE 'X'                                       122649
     C                     MOVE SACTN     CHTP
     C                     ENDIF                                          122649
      *                                                                   122649
     C                     Z-ADDNATN      TNLU
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRRELL  -  Update related loan record for parts sold          *
      * Called by: SRINSR - Insert records in files                   *
      *            SRUPDR - Update records in files                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRRELL    BEGSR
      *
     C***********PTYP      IFNE 72                                 132559 158863
     C           PTYPM     IFNE 72                                        158863
     C           WLNPT     ANDNE72                                        132559
     C           WRISP     OREQ 'N'                                       138350
     C           PTYPM     ANDEQ72                                        158863
     C           WLNPT     ANDEQ72                                        158863
     C           PTYPM     OREQ 70                                        158863
     C           WLNPT     ANDEQ72                                        158863
     C           PTYPM     OREQ 71                                        158863
     C           WLNPT     ANDEQ72                                        158863
     C                     MOVE 'A'       WEPAR
     C           *IN22     IFEQ '1'                                       124001
     C                     MOVE SOLNO     WALON
     C                     ELSE                                           124001
     C                     MOVE SMLNR     WALON                           124001
     C                     ENDIF                                          124001
     C           WKLON     CHAINCLOAN                89
     C           *IN89     IFEQ '1'
     C           *IN89     OREQ '0'
     C           RECI      ANDNE'D'
     C           PMODE     ANDNE'B'                                       123471
     C           *LOCK     IN   LDA
     C                     MOVEL'CLOAN   'DBFILE           ************
     C                     Z-ADD32        DBASE            * DBERR 32 *
     C                     MOVELSOLNO     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Update parts sold amount and number of parts sold
      *
     C           SACTN     IFEQ 'I'
     C                     ADD  WSVAM     PSAM
     C                     ADD  1         NOPS
     C                     ELSE
     C                     SUB  WCPAM     PSAM
     C                     SUB  1         NOPS
     C                     ENDIF
     C                     Z-ADDBJRDNB    LCD
     C           CHTP      IFNE 'R'                                       158087
     C                     MOVE 'A'       CHTP
     C                     ENDIF                                          158087
     C                     Z-ADDNATN      TNLU
      *
     C***********          UPDATCLOANCLF               89                 157761
     C                     UPDATCLOANCLF                                  157761
      *
      ** Move back details of parts sold
      *
     C                     MOVELMAINRF    CURREF
     C                     ENDIF                                          132559
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRTLOG  -  Chain to LTRIX header                              *
      * Called by: SRINSR - Insert records in files                   *
      *            SRUPDR - Update records in files                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRTLOG    BEGSR
      *
      ** Obtain last transaction number
      *
     C**********           EXSR ZTNLU1                                    186431
      *
      ** Chain to transaction header to test whether full
      *
     C**********           Z-ADD1         LXRRN   50                                        AR322732
     C********** LXRRN     CHAINLTRIX               N89                                     AR322732
     C************IN89     IFEQ '0'                                       130173
     C**********           Z-ADDRRNAD     WRRNA   50                                        AR322732
     C***********RRNAD     IFGT FLSZD                                     130173
     C***********          MOVE '1'       *INU8                           130173
     C***********          MOVE '1'       *INLR                           130173
     C***********          RETRN                                          130173
     C***********          ENDIF                                          130173
      *
     C***********          ENDIF                                          130173
     C********** *IN89     IFEQ '1'                                                  130173 AR322732
     C********** RRNAD     ORGT FLSZD                                                130173 AR322732
     C********** *LOCK     IN   LDA                                                         AR322732
     C**********           MOVEL'LTRIX   'DBFILE           ************                     AR322732
     C**********           Z-ADD21        DBASE            * DBERR 21 *                     AR322732
     C**********           MOVELLXRRN     DBKEY            ************                     AR322732
     C**********           OUT  LDA                                                         AR322732
     C**********           EXSR *PSSR                                                       AR322732
     C**********           ENDIF                                                            AR322732
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRGLOC  -  Get start and maturity date settlement             *
      * Called by: SREXVL - Check dates for holidays                  *
      * Calls    : SRSLOC - Determine settlement locations            *
      *****************************************************************
     C           SRGLOC    BEGSR
      *
      ** For type 01,02,07,08 or 12, settlement location is determined
      ** by the nostro branch
      *
     C                     MOVE *BLANKS   W@SDSL  3
     C                     MOVE *BLANKS   W@MDSL  3
      *
      ** Get start settlement location
      *
     C                     MOVE 'S'       WTYPE   1                                           CLE031
      *                                                                                       CLE034
     C           CLE034    IFEQ 'N'                                                           CLE034
     C           SSTAL     OREQ 'N'                                                           CLE034
     C           WSDST     LOKUPWNOST                    97
     C           *IN97     IFEQ '1'
     C                     MOVE WOSDA     WOURS
     C                     EXSR SRSLOC
     C                     MOVE W@STBL    W@SDSL
     C                     ENDIF
      *
      ** Get maturity settlement location
      *
     C                     MOVE 'E'       WTYPE                                               CLE031
     C           WMDST     LOKUPWNOST                    97
     C           *IN97     IFEQ '1'
     C                     MOVE WOMDA     WOURS
     C                     EXSR SRSLOC
     C                     MOVE W@STBL    W@MDSL
     C                     ENDIF
     C                     ENDIF                                                              CLE034
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSLOC  -  Determine settlement locations                     *
      * Called by: SRGLOC - Get start and maturity date settlements   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSLOC    BEGSR
      *
     C                     MOVE *BLANKS   W@STBL
      *
     C                     MOVE WSNOS     PNONB
      *
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           PMPSCY    ANDNE*BLANKS                                   CEU004
     C                     MOVE PMPSCY    PCURR                           CEU004
     C                     ELSE                                           CEU004
     C                     MOVE SCURR     PCURR
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
     C                     MOVE SCURR     PCURR                                               CLE031
     C           WTYPE     IFEQ 'S'                                                           CLE031
      *                                                                                       CLE031
     C           *IN22     IFEQ *ON                                                           CLE031
     C           PMRSCY    ANDNE*BLANKS                                                       CLE031
     C                     MOVE PMRSCY    PCURR                                               CLE031
     C                     ENDIF                                                              CLE031
     C           *IN22     IFEQ *OFF                                                          CLE031
     C           PMRSCY    ANDNE*BLANKS                                                       CLE031
     C                     MOVE PMPSCY    PCURR                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
     C           *IN22     IFEQ *ON                                                           CLE031
     C           PMRSCY    ANDNE*BLANKS                                                       CLE031
     C                     MOVE PMPSCY    PCURR                                               CLE031
     C                     ENDIF                                                              CLE031
     C           *IN22     IFEQ *OFF                                                          CLE031
     C           PMRSCY    ANDNE*BLANKS                                                       CLE031
     C                     MOVE PMRSCY    PCURR                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     CALL 'AONOSTR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PCUSN   6
     C                     PARM           PCURR
     C**********           PARM           PACCD   4                                           CAS011
     C                     PARM           PACCD                                               CAS011
     C                     PARM           PACSN   2
     C                     PARM           PNONB   2
     C                     PARM           PBRCA
     C                     PARM           PCSSN  10
     C                     PARM           PPNOI   1
     C           SDNOST    PARM SDNOST    DSFDY
     C           WSNOS     IFEQ '?'
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE A7NOSN    W@STBL  3
     C                     MOVELPNONB     WSNOS
     C                     ENDIF
     C                     ELSE
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE A7NOSN    W@STBL
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRFCLT  -  Update facilities file                             *
      * Called by: SRINSR - Insert records in files                   *
      *            SRUPDR - Update records in files                   *
      * Calls    : SRFCUP - Prepare for facilities update             *
      *            SRCAUP - Update credit agreements/superfacility    *   CLE005
      *****************************************************************
     C           SRFCLT    BEGSR
      *
      ** Retrieve facilities detail A record
      *
     C**********           Z-ADDFCUS      WFCNUM                                              CSD027
     C                     MOVE FCUS      WFCNUM                                              CSD027
     C                     Z-ADDFTYP      WFFACT
     C                     Z-ADDFSEQ      WFFCNO
      *
     C                     MOVE 'A'       WFRCTP
     C           WKFAC     CHAINFCLTY                89
      *                                                                   153787
     C           *IN89     IFEQ *OFF                                      153787
     C                     EXSR SRCKFR                                    153787
     C                     ENDIF                                          153787
      *                                                                   153787
     C           *IN89     IFEQ '1'
     C           *IN89     OREQ '0'
     C           RECIF     ANDNE'D'
     C           RECIF     ANDNE'E'
     C           WREAC     ANDEQ*OFF                                      153787
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE           ************
     C                     Z-ADD22        DBASE            * DBERR 22 *
     C                     MOVELFCTREC    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Retrieve facilities detail B record
      *
     C                     MOVE 'B'       WFRCTP
     C           WKFAC     CHAINFCLTY                89
     C           *IN89     IFEQ '1'
     C           *IN89     OREQ '0'
     C           RECIF     ANDNE'D'
     C           RECIF     ANDNE'E'
     C           WREAC     ANDEQ*OFF                                      153787
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE           ************
     C                     Z-ADD23        DBASE            * DBERR 23 *
     C                     MOVELFCTREC    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** If linked to participant facility, first update is for the
      ** prime facility
      *
     C                     MOVE MCSIF     WMCSI   1
     C                     MOVE *BLANK    WPRME   1
     C                     MOVE *BLANK    WPART   1
     C           LPFI      IFNE *BLANK
     C                     MOVE 'Y'       WPRME
     C                     ENDIF
      *
      ** Prepare for facility updates
      *
     C                     EXSR SRFCUP
      *                                                                   CLE014
      ** Save the revolving credit indicator of the facility              CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C                     MOVE RVCR      WRVCR   1                       CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE005
      ** If the facility has a credit agreement/super facility, update    CLE005
      ** it the same way                                                  CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C********** CLE006    ANDEQ'Y'                                CLE005 185035
     C           TRCA      ANDEQ'TR'                                      CLE005
     C                     MOVE LPFI      W0LPFI  1                       CLE005
     C**********           Z-ADDPTFC      W0PTFC  60                                   CLE005 CSD027
     C                     MOVE PTFC      W0PTFC  6                                           CSD027
     C                     Z-ADDPTFT      W0PTFT  30                      CLE005
     C                     Z-ADDPTFN      W0PTFN  20                      CLE005
     C                     EXSR SRCAUP                                    CLE005
     C                     MOVE W0LPFI    LPFI                            CLE005
     C**********           Z-ADDW0PTFC    PTFC                                         CLE005 CSD027
     C                     MOVE W0PTFC    PTFC                                                CSD027
     C                     Z-ADDW0PTFT    PTFT                            CLE005
     C                     Z-ADDW0PTFN    PTFN                            CLE005
     C                     ENDIF                                          CLE005
      *
      ** If linked to participant facility, update participant facility
      *
     C***********LPFI      IFNE *BLANK                                    158052
     C           LPFI      IFNE *BLANK                                    158052
     C           LPFI      ANDNE'R'                                       158052
     C                     MOVE *BLANK    WPRME
     C                     MOVE 'Y'       WPART
     C**********           Z-ADDPTFC      WFCNUM                                              CSD027
     C                     MOVE PTFC      WFCNUM                                              CSD027
     C                     Z-ADDPTFT      WFFACT
     C                     Z-ADDPTFN      WFFCNO
     C                     MOVE 'A'       WFRCTP
     C           WKFAC     CHAINFCLTY                89
     C           *IN89     IFEQ '1'
     C           *IN89     OREQ '0'
     C           RECIF     ANDNE'D'
     C           RECIF     ANDNE'E'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE           ************
     C                     Z-ADD27        DBASE            * DBERR 27 *
     C                     MOVELFCTREC    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Retrieve facilities detail B record
      *
     C                     MOVE 'B'       WFRCTP
     C           WKFAC     CHAINFCLTY                89
     C           *IN89     IFEQ '1'
     C           *IN89     OREQ '0'
     C           RECIF     ANDNE'D'
     C           RECIF     ANDNE'E'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE           ************
     C                     Z-ADD28        DBASE            * DBERR 28 *
     C                     MOVELFCTREC    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Prepare for participant facility update
      *
     C                     EXSR SRFCUP
      *                                                                   CLE005
      ***If*the*facility*has*a*credit*agreement/super*facility,*updCLE005 145826
      ***it*the*same*way*******************************************CLE005 145826
      *                                                                   CLE005
     C***********CLE005    IFEQ 'Y'                                CLE005 145826
     C***********CLE006    ANDEQ'Y'                                CLE005 145826
     C***********TRCA      ANDEQ'TR'                               CLE005 145826
     C***********          EXSR SRCAUP                             CLE005 145826
     C***********          ENDIF                                   CLE005 145826
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT                                                              CLE005
      *****************************************************************   CLE005
      * SRCAUP  -  Update credit agreement/superfacility              *   CLE005
      * Called by: SRFCLT - Update facilities file                    *   CLE005
      * Calls    : SRFCUP - Prepare for facilities update             *   CLE005
      *****************************************************************   CLE005
     C           SRCAUP    BEGSR                                          CLE005
      *                                                                   CLE005
      ** Retrieve facilities detail A record                              CLE005
      *                                                                   CLE005
     C                     MOVE FCCYF     WFCCYF  3                       CLE005
     C                     MOVE CMDI      WFCMDI  1                       CLE005
     C                     Z-ADDCAXR      WFCAXR 138                      CLE005
     C**********           Z-ADDCANM      WFCNUM                                       CLE005 CSD027
     C                     MOVE CANM      WFCNUM                                              CSD027
     C                     Z-ADDCAFT      WFFACT                          CLE005
     C                     Z-ADDCAFN      WFFCNO                          CLE005
     C                     MOVE 'A'       WFRCTP                          CLE005
     C           WKFAC     CHAINFCLTY                89                   CLE005
     C           *IN89     IFEQ '1'                                       CLE005
     C           *IN89     OREQ '0'                                       CLE005
     C           RECIF     ANDNE'D'                                       CLE005
     C           RECIF     ANDNE'E'                                       CLE005
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVEL'FCLTY   'DBFILE           ************   CLE005
     C**********           Z-ADD40        DBASE            **DBERR*40**   CLE005              204073
     C                     Z-ADD62        DBASE            * DBERR 62 *                       204073
     C                     MOVELFCTREC    DBKEY            ************   CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      ** Retrieve facilities detail B record                              CLE005
      *                                                                   CLE005
     C                     MOVE 'B'       WFRCTP                          CLE005
     C           WKFAC     CHAINFCLTY                89                   CLE005
     C           *IN89     IFEQ '1'                                       CLE005
     C           *IN89     OREQ '0'                                       CLE005
     C           RECIF     ANDNE'D'                                       CLE005
     C           RECIF     ANDNE'E'                                       CLE005
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVEL'FCLTY   'DBFILE           ************   CLE005
     C**********           Z-ADD41        DBASE            **DBERR*41**   CLE005              204073
     C                     Z-ADD63        DBASE            * DBERR 63 *                       204073
     C                     MOVELFCTREC    DBKEY            ************   CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE014
      ** If the revolving credit indicator is 'T', use the tranche's      CLE014
      ** revolving credit indicator                                       CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           RVCR      ANDEQ'T'                                       CLE014
     C                     MOVE WRVCR     RVCR                            CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE005
      ** Prepare for credit agreement/superfacility update                CLE005
      *                                                                   CLE005
     C                     MOVE 'Y'       WTRCA   1                       CLE005
     C                     EXSR SRFCUP                                    CLE005
     C                     MOVE *BLANK    WTRCA                           CLE005
      *                                                                   CLE005
     C                     ENDSR                                          CLE005
      /EJECT
      *****************************************************************
      * SRFCUP  -  Prepare for facilities updates                     *
      * Called by: SRFCLT - Update facilities file                    *
      * Calls    : SRFEXP - Update exposure and availabiliyt of FCLTY *
      *            SRFEQV - Get facility currency equivalent          *
      *            SRFUPD - Determine id add to or sub from facility  *
      *****************************************************************
     C           SRFCUP    BEGSR
      *
     C           WTRCA     IFEQ *BLANK                                    CLE005
     C           WTRCA     OREQ 'Y'                                       CLE005
     C           FCCYF     ANDNEWFCCYF                                    CLE005
      *                                                                   CLE005
     C           WTRCA     IFEQ 'Y'                                       CLE005
     C                     MOVE WFCCYF    PCURR                           CLE005
     C                     ELSE                                           CLE005
     C                     MOVE SCURR     PCURR
     C                     ENDIF                                          CLE005
     C                     CALL 'AOCURRR0'PPAR5
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD24        DBASE            * DBERR 24 *
     C                     MOVELSCURR     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     Z-ADDA6NBDP    WCDPL
      *                                                                                       CLE023
      ** Save currency details.                                                               CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     MOVE PCURR     ZCCYI                                               CLE023
     C                     Z-ADDA6SPRT    ZRATE1                                              CLE023
     C                     MOVE A6MDIN    ZMDI1                                               CLE023
     C                     Z-ADDA6NBDP    ZCDPI                                               CLE023
     C                     ENDIF                                                              CLE023
      *
     C           WTRCA     IFEQ 'Y'                                       CLE005
     C                     MOVE FCCYF     PCURR                           CLE005
     C                     ELSE                                           CLE005
     C                     MOVE FCCY      PCURR
     C                     ENDIF                                          CLE005
     C                     CALL 'AOCURRR0'PPAR5
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD25        DBASE            * DBERR 25 *
     C                     MOVELFCCY      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     Z-ADDA6NBDP    WCDPF
      *                                                                                       CLE023
      ** Save currency details.                                                               CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     MOVE PCURR     ZCCYO                                               CLE023
     C                     Z-ADDA6SPRT    ZRATE2                                              CLE023
     C                     MOVE A6MDIN    ZMDI2                                               CLE023
     C                     Z-ADDA6NBDP    ZCDPO                                               CLE023
     C                     ENDIF                                                              CLE023
      *                                                                   141200
     C           WFMIN     IFEQ *BLANKS                                   145826
     C           A6MDIN    IFEQ 'M'                                       141200
     C                     MOVE 'D'       WFMIN                           141200
     C                     ELSE                                           141200
     C                     MOVE 'M'       WFMIN                           141200
     C                     ENDIF                                          141200
     C                     ENDIF                                          145826
      *
      ** Convert amounts into facility currency equivalent
      *
     C                     EXSR SRFEQV
     C                     ENDIF                                          CLE005
      *
     C                     DO
      *
      ** If sold with recourse, do not update exposure and availability
      ** For syndicated loans, do not update prime facility if sold       122685
      ** with recourse                                                    122685
      ** Do not update prime facility for Internal parts purchased        141200
      *
     C           *IN22     IFEQ '1'
     C           RCSI      ANDEQ'Y'
     C***********WPRME     ANDEQ*BLANK                             122685 141200
     C           WPART     ANDEQ*BLANK                                    122685
     C           RCSI      OREQ 'Y'                                       122685
     C           WPRME     ANDEQ'Y'                                       122685
     C           *IN21     OREQ '1'                                       141200
     C           WPRME     ANDEQ'Y'                                       141200
     C           LPFI      ANDEQ'I'                                       141200
     C                     LEAVE
     C                     ENDIF
      *
      ** Update file for value date
      ** Disregard facility/commitment indicator check                    122685
      *
     C************IN22     IFEQ '0'                                       122685
     C************IN22     OREQ '1'                                       122685
     C***********FCTI      ANDNE'C'                                       122685
     C                     MOVE 'Y'       WFUAV   1
     C***********          ELSE                                           122685
     C***********          MOVE 'N'       WFUAV                           122685
     C***********          ENDIF                                          122685
      *
     C                     MOVE FCCYF     ZCCY
     C                     MOVE ' '       ZFREQ
     C                     Z-ADD0         ZMDAY
     C                     Z-ADD99999     ENDAY
      *
      ** ... for insert
      *
     C           SACTN     IFEQ 'I'
      *                                                                   141200
     C           *IN22     IFEQ '1'                                       141200
     C           WPART     ANDEQ*BLANKS                                   141200
     C           NYET      ANDNE'Y'                                       141200
     C                     MOVE 'N'       WFUAV                           141200
     C                     ENDIF                                          141200
      *                                                                   141200
     C                     MOVE '1'       WUPDT   1
     C                     EXSR SRFUPD
     C                     Z-ADDWSVVD     DAYNO   50
     C                     MOVE *BLANK    ZLOC
     C                     Z-ADDWOPAMF    FCBAL  130
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     ADD  WFLTIF    FCBAL                                               CLE028
     C                     ADD  WCHGAF    FCBAL                                               CLE028
     C                     ENDIF                                                              CLE028
     C                     Z-ADDFCBAL     WRK13
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDWXSVAM    FXCBAL 130                                          CLE023
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     ADD  WFLTIF    FXCBAL                                              CLE028
     C                     ADD  WCHGAF    FXCBAL                                              CLE028
     C                     ENDIF                                                              CLE028
     C                     Z-ADDFXCBAL    WRK14  130                                          CLE023
     C                     ENDIF                                                              CLE023
     C                     EXSR SRFEXP
     C                     ENDIF
      *
      ** ... for reversal
      *
     C           SACTN     IFEQ 'R'
      *                                                                   157535
     C           *IN22     IFEQ '1'                                       157535
     C           WPART     ANDEQ*BLANKS                                   157535
     C           NYET      ANDNE'Y'                                       157535
     C                     MOVE 'N'       WFUAV                           157535
     C                     ENDIF                                          157535
      *                                                                   157535
     C                     MOVE '2'       WUPDT
     C                     EXSR SRFUPD
     C                     Z-ADDVDAT      DAYNO
     C                     MOVE *BLANK    ZLOC
     C                     Z-ADDCPAMF     FCBAL
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C                     ADD  FLTIF     FCBAL                                               CLE028
     C                     ADD  CHGAF     FCBAL                                               CLE028
     C                     ENDIF                                                              CLE028
     C                     Z-ADDFCBAL     WRK13  130
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDWXCPAM    FXCBAL                                              CLE023
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C                     ADD  FLTIF     FXCBAL                                              CLE028
     C                     ADD  CHGAF     FXCBAL                                              CLE028
     C                     ENDIF                                                              CLE028
     C                     Z-ADDFXCBAL    WRK14                                               CLE023
     C                     ENDIF                                                              CLE023
     C                     EXSR SRFEXP
     C                     ENDIF
      *
      ** Determine if update for repayments necessary
      ** (for loans and parts purchased)
      *
     C************IN22     IFEQ '0'                                       122685
     C                     MOVE 'N'       WFUAV
     C           RVCR      IFEQ 'Y'
     C                     MOVE 'Y'       WFUAV
     C                     ENDIF
     C***********          ENDIF                                          122685
      *
      ** If no change, do not update exposure and availability
      ** Need to use work fields for old values as CLOAN has been         122685
      ** updated at this point                                            122685
      *
     C           SACTN     IFEQ 'A'
     C***********WSVRP     ANDEQNRPD                                      122685
     C***********RAMTF     ANDEQWRAMTF                                    122685
     C***********RFRQ      ANDEQSRFRQ                                     122685
     C***********RDYN      ANDEQWRDYN                                     122685
     C***********WSVMD     ANDEQMDAT                                      122685
     C           NRPD      ANDEQW#NRPD                                    122685
     C           WRAMTF    ANDEQRAMT1                                     122685
     C           RFRQ      ANDEQW#RFRQ                                    122685
     C           RDYN      ANDEQW#RDYN                                    122685
     C           MDAT      ANDEQW#MDAT                                    122685
     C           ADIF      ANDEQW#ADIF                                                        CLE028
     C           ADCF      ANDEQW#ADCF                                                        CLE028
     C           WAUTOA    ANDEQ'N'                                                           204347
     C                     LEAVE
     C                     ENDIF
      *
      ** Update file for repayment (non-insert transaction)
      *
     C           SACTN     IFNE 'I'
     C           SACTN     ANDNE'R'                                                           204347
     C           AUTO      ANDNE'N'                                                           204347
     C           SACTN     OREQ 'R'                                                           204347
     C           AUTO      ANDEQ'Y'                                                           204347
     C           SACTN     OREQ 'A'                                                           204347
     C           WAUTOA    ANDEQ'Y'                                                           204347
      *                                                                   157535
     C           *IN22     IFEQ '1'                                       157535
     C           WPART     ANDEQ*BLANKS                                   157535
     C           NYET      ANDNE'Y'                                       157535
     C                     MOVE 'N'       WFUAV                           157535
     C                     ENDIF                                          157535
      *                                                                   157535
     C                     MOVE '1'       WUPDT
     C                     EXSR SRFUPD
      *                                                                                       CLE028
      ** Include interest and charge during exposure update                                   CLE028
      ** when add on interest or add on charge is set to 'Y'                                  CLE028
      ** for flat rate personal loans                                                         CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           VDAT      ANDLEBJRDNB                                                        CLE028
     C           ORED      ANDEQBJRDNB                                                        CLE028
      *                                                                                       CLE028
     C                     Z-ADDVDAT      ZDAYNO                                              CLE028
     C                     Z-ADD*ZERO     FCBAL                                               CLE028
     C                     MOVE *BLANK    ZFREQ                                               CLE028
      *                                                                                       CLE028
      ** Change in interest add on indicator                                                  CLE028
      *                                                                                       CLE028
     C           ADIF      IFNE W#ADIF                                                        CLE028
     C           ADIF      IFEQ 'Y'                                                           CLE028
     C                     ADD  FLTIF     FCBAL                                               CLE028
     C                     ELSE                                                               CLE028
     C                     SUB  W#FLIF    FCBAL                                               CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** Change in charge add on indicator                                                    CLE028
      *                                                                                       CLE028
     C           ADCF      IFNE W#ADCF                                                        CLE028
     C           ADCF      IFEQ 'Y'                                                           CLE028
     C                     ADD  CHGAF     FCBAL                                               CLE028
     C                     ELSE                                                               CLE028
     C                     SUB  W#CHGF    FCBAL                                               CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     Z-ADDFCBAL     WRK13                                               CLE028
     C                     EXSR SRFEXP                                                        CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C***********MDAT      IFEQ *ZEROS                                    122685
     C           W#MDAT    IFEQ *ZEROS                                    122685
     C                     Z-ADD99999     ENDAY
     C                     ELSE
     C***********          Z-ADDMDAT      ENDAY   50                      122685
     C                     Z-ADDW#MDAT    ENDAY   50                      122685
     C                     ENDIF
     C***********          Z-ADDNRPD      DAYNO                           122685
     C***********          MOVE RFRQ      ZFREQ                           122685
     C***********          MOVE RDYN      ZMDAY                           122685
     C***********          Z-ADDRAMTF     FCBAL                           122685
     C                     Z-ADDW#NRPD    DAYNO                           122685
     C                     MOVE W#RFRQ    ZFREQ                           122685
     C                     MOVE W#RDYN    ZMDAY                           122685
     C                     Z-ADDRAMT1     FCBAL                           122685
     C                     Z-ADDCPAMF     WRK13
     C                     MOVE *BLANK    ZLOC
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDWXRAMT    FXCBAL                                              CLE023
     C                     Z-ADDWXCPAM    WRK14                                               CLE023
     C                     ENDIF                                                              CLE023
     C                     EXSR SRFEXP
     C                     Z-ADDWRK13     MATAM1 130
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDWRK14     WMATM1 130                                          CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF
      *
      ** Update file for repayment (for non-reversal transactions)
      *
     C           WAUTOA    IFEQ 'N'                                                           204347
      *                                                                                       204347
      ** Do not include newly inserted loan that has a non-autosettle                         204347
      ** indicator.                                                                           204347
      *                                                                                       204347
     C           SACTN     IFNE 'R'
     C           SACTN     ANDNE'I'                                                           204347
     C********** AUTO      ANDNE'N'                                                    204347 207595
     C           SACTN     OREQ 'I'                                                           204347
     C           AUTO      ANDEQ'Y'                                                           204347
      *                                                                   143772
     C           *IN22     IFEQ '1'                                       143772
     C           WPART     ANDEQ*BLANKS                                   143772
     C           NYET      ANDNE'Y'                                       143772
     C                     MOVE 'N'       WFUAV                           143772
     C                     ENDIF                                          143772
      *                                                                   143772
     C                     MOVE '2'       WUPDT
     C                     EXSR SRFUPD
     C           WSVMD     IFEQ *ZEROS
     C                     Z-ADD99999     ENDAY
     C                     ELSE
     C                     Z-ADDWSVMD     ENDAY
     C                     ENDIF
     C                     Z-ADDWSVRP     DAYNO
     C                     MOVE SRFRQ     ZFREQ
     C                     MOVE WRDYN     ZMDAY
     C                     Z-ADDWRAMTF    FCBAL
     C                     Z-ADDWOPAMF    WRK13
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     ADD  WFLTIF    WRK13                                               CLE028
     C                     ADD  WCHGAF    WRK13                                               CLE028
     C                     ENDIF                                                              CLE028
     C                     MOVE *BLANK    ZLOC
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDWXSVRA    FXCBAL                                              CLE023
     C                     Z-ADDWXSVAM    WRK14                                               CLE023
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C                     ADD  WFLTIF    WRK14                                               CLE028
     C                     ADD  WCHGAF    WRK14                                               CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE023
     C                     EXSR SRFEXP
     C                     Z-ADDWRK13     MATAM2 130
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDWRK14     WMATM2 130                                          CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF
     C                     ENDIF                                                              204347
      *
      ** Update file for maturity date (for non-insert transactions)
      *
     C                     MOVE ' '       ZFREQ
     C                     Z-ADD0         ZMDAY
     C           SACTN     IFNE 'I'
     C***********MDAT      ANDNE*ZEROS                                    122685
     C           W#MDAT    ANDNE*ZEROS                                    122685
      *                                                                                       206235
      ** If loan is not autosettled, exposure should be updated only                          206235
      ** for future projections after the next working day.                                   206235
      *                                                                                       206235
     C           W#MDAT    IFLE BJDNWD                                                        206235
     C           AUTO      ANDEQ'Y'                                                           206235
     C           W#MDAT    ORGT BJDNWD                                                        206235
     C           SACTN     IFNE 'R'                                                           204347
     C           SACTN     OREQ 'R'                                                           204347
     C           AUTO      ANDEQ'Y'                                                           204347
     C                     MOVE '1'       WUPDT
     C                     EXSR SRFUPD
     C***********          Z-ADDMDAT      DAYNO                           122685
     C***********          Z-ADDMDAT      ENDAY                           122685
      *                                                                                       190640
      ** A revolving-credit facility should become available again                            190640
      ** on the loan's maturity date, rather than the day after                               190640
      *                                                                                       190640
     C********** W#MDAT    IFGT BJRDNB                                    158055              190640
     C**********           ADD  1         W#MDAT                          127169              190640
     C**********           END                                            158055              190640
     C                     Z-ADDW#MDAT    DAYNO                           122685
     C                     Z-ADDW#MDAT    ENDAY                           122685
     C                     MOVE *BLANK    ZLOC
     C                     Z-ADDMATAM1    FCBAL
     C                     Z-ADDMATAM1    WRK13
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDWMATM1    FXCBAL                                              CLE023
     C                     Z-ADDWMATM1    WRK14                                               CLE023
     C                     ENDIF                                                              CLE023
     C                     EXSR SRFEXP
     C********** W#MDAT    IFGT BJRDNB                                    158055              190640
     C**********           SUB  1         W#MDAT                          127169              190640
     C**********           END                                            158055              190640
     C                     ENDIF
     C                     ENDIF                                                              204347
     C                     ENDIF                                                              206235
      *
      ** Update file for maturity date (for non-reversal transactions)
      *
     C           SACTN     IFNE 'R'
     C           WSVMD     ANDNE*ZEROS
      *                                                                                       206235
      ** If loan is not autosettled, exposure should be updated only                          206235
      ** for future projections after the next working day.                                   206235
      *                                                                                       206235
     C           WSVMD     IFLE BJDNWD                                                        206235
     C           AUTO      ANDEQ'Y'                                                           206235
     C           WSVMD     ORGT BJDNWD                                                        206235
     C           SACTN     IFNE 'I'                                                           204347
     C           SACTN     OREQ 'I'                                                           204347
     C           AUTO      ANDEQ'Y'                                                           204347
     C                     MOVE '2'       WUPDT
     C                     EXSR SRFUPD
      *                                                                                       190640
      ** A revolving-credit facility should become available again                            190640
      ** on the loan's maturity date, rather than the day after                               190640
      *                                                                                       190640
     C********** WSVMD     IFGT BJRDNB                                    158055              190640
     C**********           ADD  1         WSVMD                           127169              190640
     C**********           END                                            158055              190640
     C                     Z-ADDWSVMD     DAYNO
     C                     Z-ADDWSVMD     ENDAY
     C                     MOVE *BLANK    ZLOC
     C                     Z-ADDMATAM2    FCBAL
     C                     Z-ADDMATAM2    WRK13
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDWMATM2    FXCBAL                                              CLE023
     C                     Z-ADDWMATM2    WRK14                                               CLE023
     C                     ENDIF                                                              CLE023
      * Check if this is a matured loan which has been reactivated                            205535
     C           MATAM2    IFEQ 0                                                             205535
     C           RECI      ANDEQ'M'                                                           205535
     C           RATF      ANDEQ'Y'                                                           205535
     C           WTRCA     ANDNE'Y'                                                           206578
     C**********           Z-ADDLNRF      WLLOAN                                       205535 CLE148
     C                     MOVELLNRF      WLLOAN                                              CLE148
     C           WLLOAN    SETLLLOAMS                                                         205535
     C           WLLOAN    READELOAMS                    89                                   205535
     C           *IN89     DOWEQ'0'                                                           205535
     C           AMTPA     IFEQ 'MR'                                                          205535
     C           PAST      ANDEQ'Y'                                                           205535
     C           RECIA     ANDEQ'D'                                                           205535
      * Convert negative MR amount to positive facility currency amt:                         206443
     C                     Z-SUBPRAM      PRAM1  130       PRAM was neg.                      206443
     C                     EXSR SRFEQV                                                        206443
     C**********           Z-SUBPRAM      WRK13                                        205535 206443
     C                     Z-ADDPRAMF     WRK13                                               206443
     C                     Z-ADDWRK13     FCBAL                                               205535
      *                                                                                       206443
     C           CLE023    IFEQ 'Y'                                                           206443
     C                     Z-ADDWXPRAM    FXCBAL                                              206443
     C                     Z-ADDWXPRAM    WRK14                                               206443
     C                     ENDIF                                                              206443
      *                                                                                       206443
     C                     MOVE '1'       *IN89                                               205535
     C                     ENDIF                                                              205535
     C           WLLOAN    READELOAMS                    89                                   205535
     C                     ENDDO                                                              205535
     C                     ENDIF                                                              205535
      *                                                                                       205535
     C                     EXSR SRFEXP
     C********** WSVMD     IFGT BJRDNB                                    158055              190640
     C**********           SUB  1         WSVMD                           127169              190640
     C**********           END                                            158055              190640
     C                     ENDIF
     C                     ENDIF                                                              204347
     C                     ENDIF                                                              206235
      *
     C                     ENDDO
      *
      ** Update facilities file - B record
      *
     C                     MOVE BJRDNB    LCD
     C                     MOVE 'A'       CHTP
     C                     Z-ADDNATN      TNLU
     C***********          UPDATFCLTYFNF               89                 157761
     C                     UPDATFCLTYFNF                                  157761
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRFEQV  -  Get facility equivalent of amounts                 *
      * Called by: SRVAL1 - Validate first detail screen              *
      *            SRFCUP - Prepare for facilities update             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRFEQV    BEGSR
      *
     C           WCDPF     SUB  WCDPL     CX      10
     C                     ADD  4         CX
      *                                                                                       CLE023
      ** If CLE023 is ON, get cross rate of currencies spot.                                  CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     EXSR ZXRATE                                                        CLE023
     C                     Z-ADDZRATEX    ZEXCH                                               CLE023
     C                     MOVE ZMDIX     ZMD                                                 CLE023
      * If loan is in base currency, use spot rate.                                           207964
     C           ZCCYI     IFEQ BJCYCD                                                        CLE023
     C                     Z-ADDZRATE2    ZEXCH                                               207964
     C           ZMDI2     IFEQ 'D'                                                           207964
     C                     MOVE 'M'       ZMD                                                 CLE023
     C                     ELSE                                                               207964
     C                     MOVE 'D'       ZMD                                                 207964
     C                     ENDIF                                                              207964
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C           WTRCA     IFEQ *BLANK                                    CLE005
      *
      ** ... for insert
      *
     C           SACTN     IFEQ 'I'
     C           WFLAG     IFEQ 'Y'                                       152176
     C           WFLAG     OREQ *BLANK                                                        203092
     C           *IN22     ANDEQ'1'                                                           203092
     C           WFMIN     IFEQ 'D'
     C           WSVFX     DIV  POWER,CX  WFCXRT 159H
     C           1         DIV  WFCXRT    WFCXRT
     C                     ELSE
     C           WSVFX     MULT POWER,CX  WFCXRT    H
     C                     ENDIF
     C                     ELSE                                           152176
     C           WSVFX     MULT POWER,CX  WFCXRT    H                     152176
     C                     ENDIF                                          152176
      *
      ** ... for non-insert
      *
     C                     ELSE
      *                                                                                       CLE023
      ** If CLE023 is installed and there is a rollover of facility                           CLE023
      ** exchange rate where rollover date is less than or equal to                           CLE023
      ** rundate.                                                                             CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           W#RLDT    ANDNE0                                                             CLE023
     C           W#RLDT    ANDLTBJRDNB                                                        CLE023
     C           NFCE      ANDNE0                                                             CLE023
     C           NCCY      ANDEQ*BLANKS                                                       CLE023
     C           NFMD      IFEQ 'D'                                                           CLE023
     C********** CPAM      DIV  NFCE      CPAMF     H                                  CLE023 203795
     C********** RAMT      DIV  NFCE      RAMTF     H                                  CLE023 203795
     C********** W#RAMT    DIV  NFCE      RAMT1     H                                  CLE023 203795
     C           NFCE      DIV  POWER,CX  WNFCE  159H                                         203795
     C           1         DIV  WNFCE     WNFCE                                               203795
     C                     ELSE                                                               CLE023
     C********** CPAM      MULT NFCE      CPAMF     H                                  CLE023 203795
     C********** RAMT      MULT NFCE      RAMTF     H                                  CLE023 203795
     C********** W#RAMT    MULT NFCE      RAMT1     H                                  CLE023 203795
     C           NFCE      MULT POWER,CX  WNFCE     H                                         203795
     C                     ENDIF                                                              CLE023
     C           CPAM      MULT WNFCE     CPAMF     H                                         203795
     C           RAMT      MULT WNFCE     RAMTF     H                                         203795
     C           W#RAMT    MULT WNFCE     RAMT1     H                                         203795
     C           PRAM1     MULT WNFCE     PRAMF     H                                         206443
      *                                                                                       CLE028
      ** Include interest and charge during exposure update                                   CLE028
      ** when add on interest or add on charge is set to 'Y'                                  CLE028
      ** for flat rate personal loans                                                         CLE028
      *                                                                                       CLE028
     C                     Z-ADD*ZEROS    FLTIF                                               CLE028
     C                     Z-ADD*ZEROS    W#FLIF                                              CLE028
     C                     Z-ADD*ZEROS    CHGAF                                               CLE028
     C                     Z-ADD*ZEROS    W#CHGF                                              CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           VDAT      ANDLEBJRDNB                                                        CLE028
     C           ORED      ANDEQBJRDNB                                                        CLE028
     C           ADIF      IFEQ 'Y'                                                           CLE028
     C           FLTI      MULT WNFCE     FLTIF  130H                                         CLE028
     C           W#FLTI    MULT WNFCE     W#FLIF 130H                                         CLE028
     C                     ENDIF                                                              CLE028
     C           ADCF      IFEQ 'Y'                                                           CLE028
     C           CHGA      MULT WNFCE     CHGAF  130H                                         CLE028
     C           W#CHGA    MULT WNFCE     W#CHGF 130H                                         CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE023
     C                     ELSE                                                               CLE023
     C           FMDI      IFEQ 'D'
     C           FCXR      DIV  POWER,CX  WFCXRT    H
     C           1         DIV  WFCXRT    WFCXRT
     C                     ELSE
     C           FCXR      MULT POWER,CX  WFCXRT    H
     C                     ENDIF
     C           CPAM      MULT WFCXRT    CPAMF  130H
     C           RAMT      MULT WFCXRT    RAMTF  130H
     C           W#RAMT    MULT WFCXRT    RAMT1  130H                     122685
     C           PRAM1     MULT WFCXRT    PRAMF  130H                                         206443
      *                                                                                       CLE028
      ** Include interest and charge during exposure update                                   CLE028
      ** when add on interest or add on charge is set to 'Y'                                  CLE028
      ** for flat rate personal loans                                                         CLE028
      *                                                                                       CLE028
     C                     Z-ADD*ZEROS    FLTIF                                               CLE028
     C                     Z-ADD*ZEROS    W#FLIF                                              CLE028
     C                     Z-ADD*ZEROS    CHGAF                                               CLE028
     C                     Z-ADD*ZEROS    W#CHGF                                              CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           VDAT      ANDLEBJRDNB                                                        CLE028
     C           ORED      ANDEQBJRDNB                                                        CLE028
     C           ADIF      IFEQ 'Y'                                                           CLE028
     C           FLTI      MULT WFCXRT    FLTIF     H                                         CLE028
     C           W#FLTI    MULT WFCXRT    W#FLIF    H                                         CLE028
     C                     ENDIF                                                              CLE028
     C           ADCF      IFEQ 'Y'                                                           CLE028
     C           CHGA      MULT WFCXRT    CHGAF     H                                         CLE028
     C           W#CHGA    MULT WFCXRT    W#CHGF    H                                         CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
      ** If CLE023 is ON convert amounts using spot rate.                                     CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDCPAM      ZAMTCI                                              CLE023
     C                     EXSR ZCONV                                                         CLE023
     C                     Z-ADDZAMTCO    WXCPAM 130                                          CLE023
     C                     Z-ADDW#RAMT    ZAMTCI                                              CLE023
     C                     EXSR ZCONV                                                         CLE023
     C                     Z-ADDZAMTCO    WXRAMT 130                                          CLE023
      *                                                                                       CLE028
      ** Include interest and charge during exposure update                                   CLE028
      ** when add on interest or add on charge is set to 'Y'                                  CLE028
      ** for flat rate personal loans                                                         CLE028
      *                                                                                       CLE028
     C                     Z-ADD*ZEROS    FLTIF                                               CLE028
     C                     Z-ADD*ZEROS    W#FLIF                                              CLE028
     C                     Z-ADD*ZEROS    CHGAF                                               CLE028
     C                     Z-ADD*ZEROS    W#FLIF                                              CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           VDAT      ANDLEBJRDNB                                                        CLE028
     C           ORED      ANDEQBJRDNB                                                        CLE028
     C           ADIF      IFEQ 'Y'                                                           CLE028
     C                     Z-ADDFLTI      ZAMTCI                                              CLE028
     C                     EXSR ZCONV                                                         CLE028
     C                     Z-ADDZAMTCO    FLTIF                                               CLE028
     C                     Z-ADDW#FLTI    ZAMTCI                                              CLE028
     C                     EXSR ZCONV                                                         CLE028
     C                     Z-ADDZAMTCO    W#FLIF                                              CLE028
     C                     ENDIF                                                              CLE028
     C           ADCF      IFEQ 'Y'                                                           CLE028
     C                     Z-ADDCHGA      ZAMTCI                                              CLE028
     C                     EXSR ZCONV                                                         CLE028
     C                     Z-ADDZAMTCO    CHGAF                                               CLE023
     C                     Z-ADDW#CHGA    ZAMTCI                                              CLE028
     C                     EXSR ZCONV                                                         CLE028
     C                     Z-ADDZAMTCO    W#CHGF                                              CLE023
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      *                                                                                       206443
     C                     Z-ADDPRAM1     ZAMTCI                                              206443
     C                     EXSR ZCONV                                                         206443
     C                     Z-ADDZAMTCO    WXPRAM 130                                          206443
      *                                                                                       206443
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF
      *
      ** ... for non-reversal
      *
     C           SACTN     IFNE 'R'
      *                                                                                       CLE023
      ** If rollover date is less than or equal to the repayment date                         CLE023
      ** and there is a rollover of facility exchange rate, use the                           CLE023
      ** new facility exchange rate defined.                                                  CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           W#RLDT    ANDNE0                                                             CLE023
     C           W#RLDT    ANDLTBJRDNB                                                        CLE023
     C           NFCE      ANDNE0                                                             CLE023
     C           NCCY      ANDEQ*BLANKS                                                       CLE023
     C           NFMD      IFEQ 'D'                                                           CLE023
     C********** WSVAM     DIV  NFCE      WOPAMF    H                                  CLE023 203795
     C********** WSVRA     DIV  NFCE      WRAMTF    H                                  CLE023 203795
     C           NFCE      DIV  POWER,CX  WNFCE     H                                         203795
     C           1         DIV  WNFCE     WNFCE                                               203795
     C                     ELSE                                                               CLE023
     C********** WSVAM     MULT NFCE      WOPAMF    H                                  CLE023 203795
     C********** WSVRA     MULT NFCE      WRAMTF    H                                  CLE023 203795
     C           NFCE      MULT POWER,CX  WNFCE     H                                         203795
     C                     ENDIF                                                              CLE023
     C           WSVAM     MULT WNFCE     WOPAMF    H                                         203795
     C           WSVRA     MULT WNFCE     WRAMTF    H                                         203795
      *                                                                                       CLE028
      ** Include interest and charge during exposure update                                   CLE028
      ** when add on interest or add on charge is set to 'Y'                                  CLE028
      ** for flat rate personal loans                                                         CLE028
      *                                                                                       CLE028
     C                     Z-ADD*ZEROS    WFLTIF                                              CLE028
     C                     Z-ADD*ZEROS    WCHGAF                                              CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           SADIF     IFEQ 'Y'                                                           CLE028
     C           WTOTI     MULT WNFCE     WFLTIF 130H                                         CLE028
     C                     ENDIF                                                              CLE028
     C           SADCF     IFEQ 'Y'                                                           CLE028
     C           WCHGA     MULT WNFCE     WCHGAF 130H                                         CLE028
     C                     ENDIF                                                              CLE028
     C                     ADD  WFLTIF    WOPAMF                                              CLE028
     C                     ADD  WCHGAF    WOPAMF                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE023
     C                     ELSE                                                               CLE023
     C           WSVAM     MULT WFCXRT    WOPAMF 130H
     C           WSVRA     MULT WFCXRT    WRAMTF 130H
      *                                                                                       CLE028
      ** Include interest and charge during exposure update                                   CLE028
      ** when add on interest or add on charge is set to 'Y'                                  CLE028
      ** for flat rate personal loans                                                         CLE028
      *                                                                                       CLE028
     C                     Z-ADD*ZEROS    WFLTIF                                              CLE028
     C                     Z-ADD*ZEROS    WCHGAF                                              CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           SADIF     IFEQ 'Y'                                                           CLE028
     C           WTOTI     MULT WFCXRT    WFLTIF    H                                         CLE028
     C                     ENDIF                                                              CLE028
     C           SADCF     IFEQ 'Y'                                                           CLE028
     C           WCHGA     MULT WFCXRT    WCHGAF    H                                         CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
      ** If CLE023 is ON convert amounts using spot rate.                                     CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDWSVAM     ZAMTCI                                              CLE023
     C                     EXSR ZCONV                                                         CLE023
     C                     Z-ADDZAMTCO    WXSVAM 130                                          CLE023
     C                     Z-ADDWSVRA     ZAMTCI                                              CLE023
     C                     EXSR ZCONV                                                         CLE023
     C                     Z-ADDZAMTCO    WXSVRA 130                                          CLE023
      *                                                                                       CLE028
      ** Include interest and charge during exposure update                                   CLE028
      ** when add on interest or add on charge is set to 'Y'                                  CLE028
      ** for flat rate personal loans                                                         CLE028
      *                                                                                       CLE028
     C                     Z-ADD*ZEROS    WFLTIF                                              CLE028
     C                     Z-ADD*ZEROS    WCHGAF                                              CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           SADIF     IFEQ 'Y'                                                           CLE028
     C                     Z-ADDWTOTI     ZAMTCI                                              CLE028
     C                     EXSR ZCONV                                                         CLE028
     C                     Z-ADDZAMTCO    WFLTIF                                              CLE028
     C                     ENDIF                                                              CLE028
     C           SADCF     IFEQ 'Y'                                                           CLE028
     C                     Z-ADDWCHGA     ZAMTCI                                              CLE028
     C                     EXSR ZCONV                                                         CLE028
     C                     Z-ADDZAMTCO    WCHGAF                                              CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF
      *                                                                   CLE005
      ** Get loan amount in credit agreement currency                     CLE005
      *                                                                   CLE005
     C                     ELSE                                           CLE005
     C           WFCMDI    IFEQ 'D'                                       CLE005
     C           WFCAXR    DIV  POWER,CX  WFCXRT 159H                     CLE005
     C           1         DIV  WFCXRT    WFCXRT                          CLE005
     C                     ELSE                                           CLE005
     C           WFCAXR    MULT POWER,CX  WFCXRT    H                     CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     MULT WFCXRT    CPAMF  130H                     CLE005
     C                     MULT WFCXRT    RAMTF  130H                     CLE005
     C                     MULT WFCXRT    RAMT1  130H                                         194715
     C                     MULT WFCXRT    WOPAMF 130H                     CLE005
     C                     MULT WFCXRT    WRAMTF 130H                     CLE005
     C                     MULT WFCXRT    PRAMF  130H                                         206443
      *                                                                                       CLE023
      ** If CLE023 is on, calculate amounts using spot rate.                                  CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDWXCPAM    ZAMTCI                                              CLE023
     C                     EXSR ZCONV                                                         CLE023
     C                     Z-ADDZAMTCO    WXCPAM                                              CLE023
     C                     Z-ADDWXRAMT    ZAMTCI                                              CLE023
     C                     EXSR ZCONV                                                         CLE023
     C                     Z-ADDZAMTCO    WXRAMT                                              CLE023
     C                     Z-ADDWXSVAM    ZAMTCI                                              CLE023
     C                     EXSR ZCONV                                                         CLE023
     C                     Z-ADDZAMTCO    WXSVAM                                              CLE023
     C                     Z-ADDWXSVRA    ZAMTCI                                              CLE023
     C                     EXSR ZCONV                                                         CLE023
     C                     Z-ADDZAMTCO    WXSVRA                                              CLE023
      *                                                                                       206443
     C                     Z-ADDWXPRAM    ZAMTCI                                              206443
     C                     EXSR ZCONV                                                         206443
     C                     Z-ADDZAMTCO    WXPRAM                                              206443
      *                                                                                       206443
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                          CLE005
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRFUPD  -  Determine if adding to or subtracting from facility*
      * Called by: SRFCUP - Prepare for facilities update             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRFUPD    BEGSR
      *
      ** First case, add to facility exposure and oustanding amount if:
      ** (1) normal loan
      ** (2) non-syndicated parts purchased
      ** (3) syndicated parts purchased for the participant facility
      ** (4) syndicated psold for the participant facility
      ** If not any of the above, subtract from exposure and
      **   outstanding amount
      *
     C                     MOVE *BLANK    WNOUP   1                                           CLE023
     C           WUPDT     IFEQ '1'
     C                     SELEC
      *
      ** ... parts purchased
      *
     C           *IN21     WHEQ '1'
     C           WPRME     IFEQ 'Y'
      *                                                                                       204347
     C           WAUTOY    IFEQ '2'                                                           204347
     C                     MOVE 'A'       WFUPD                                               204347
     C                     ELSE                                                               204347
     C                     MOVE 'S'       WFUPD   1
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     MOVE 'Y'       WNOUP                                               CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              204347
      *                                                                                       204347
     C                     ELSE
      *                                                                                       204347
     C           WAUTOY    IFEQ '2'                                                           204347
     C                     MOVE 'S'       WFUPD                                               204347
     C           CLE023    IFEQ 'Y'                                                           204347
     C                     MOVE 'Y'       WNOUP                                               204347
     C                     ENDIF                                                              204347
     C                     ELSE                                                               204347
     C                     MOVE 'A'       WFUPD
     C                     ENDIF                                                              204347
      *                                                                                       204347
     C                     ENDIF
      *
      ** ... parts sold
      *
     C           *IN22     WHEQ '1'
     C           WPART     IFEQ 'Y'
      *                                                                                       204347
     C           WAUTOY    IFEQ '2'                                                           204347
     C                     MOVE 'S'       WFUPD                                               204347
     C           CLE023    IFEQ 'Y'                                                           204347
     C                     MOVE 'Y'       WNOUP                                               204347
     C                     ENDIF                                                              204347
     C                     ELSE                                                               204347
     C                     MOVE 'A'       WFUPD
     C                     ENDIF                                                              204347
      *                                                                                       204347
     C                     ELSE
      *                                                                                       204347
     C           WAUTOY    IFEQ '2'                                                           204347
     C                     MOVE 'A'       WFUPD                                               204347
     C                     ELSE                                                               204347
     C                     MOVE 'S'       WFUPD
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     MOVE 'Y'       WNOUP                                               CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              204347
      *                                                                                       204347
     C                     ENDIF
      *
      ** ... normal loan
      *
     C                     OTHER
     C           WAUTOY    IFEQ '2'                                                           204347
     C                     MOVE 'S'       WFUPD                                               204347
     C                     ELSE                                                               204347
     C                     MOVE 'A'       WFUPD
     C                     ENDIF                                                              204347
     C                     ENDSL
      *
      ** For the second case, processing would be the exact opposite
      ** of the first case
      *
     C                     ELSE
      *
      ** ... parts purchased
      *
     C                     SELEC
     C           *IN21     WHEQ '1'
     C           WPRME     IFEQ 'Y'
     C                     MOVE 'A'       WFUPD
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     MOVE 'Y'       WNOUP                                               CLE023
     C                     ENDIF                                                              CLE023
     C                     ELSE
     C                     MOVE 'S'       WFUPD
     C                     ENDIF
      *
      ** ... parts sold
      *
     C           *IN22     WHEQ '1'
     C           WPART     IFEQ 'Y'
     C                     MOVE 'S'       WFUPD
     C                     ELSE
     C                     MOVE 'A'       WFUPD
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     MOVE 'Y'       WNOUP                                               CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF
      *
      ** ... normal loan
      *
     C                     OTHER
     C                     MOVE 'S'       WFUPD
     C                     ENDSL
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRFEXP  -  Update exposure and availability array of facility *
      * Called by: SRFCLT - Update facilities file                    *
      * Calls    : None                                               *
      *****************************************************************
     C           SRFEXP    BEGSR
      *
     C           DAYNO     IFNE *ZEROS
     C           ZFREQ     DOUEQ*BLANK
      *
     C                     Z-ADD1         Z       20
     C           DAYNO     LOKUPRUNS,Z               86  86
     C           *IN86     IFEQ '1'
     C           DAYNO     ANDGTENDAY
     C           *IN86     OREQ '0'
     C                     LEAVE
     C                     ENDIF
      *
      ** Do not update if amount is negative
      *
     C                     SUB  FCBAL     WRK13      86  86
     C           WRK13     IFLT *ZEROS
     C                     ADD  WRK13     FCBAL      86
     C                     Z-ADD*ZEROS    WRK13
     C                     ENDIF
     C           *IN86     IFEQ '0'
     C                     LEAVE
     C                     ENDIF
      *
      ** Update exposure if earlier than or equal to rundate
      ** Do not update exposure of an internal parts purchased for
      ** participant facility
      *
     C           WNOUP     IFNE 'Y'                                                           CLE023
     C           DAYNO     IFLE BJRDNB
     C           RECI      ANDNE'M'                                                           205535
     C           WFUPD     IFEQ 'S'
     C                     SUB  FCBAL     CAMD
     C                     ELSE
     C                     ADD  FCBAL     CAMD
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                                              CLE023
      *                                                                   CLE009
      ** If CLE009 is installed, set Work Regeneration Indicator to       CLE009
      ** changed                                                          CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     MOVE 'C'       WKSWRI  1                       CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      *
      ** Prevent update of availability if:
      ** (1) customer is a branch internal customer for parts purchased
      **       and sold
      ***(2)*update*prime*facility*for*syndicated*loans************       122685
      *
     C           *IN21     IFEQ '1'
     C           *IN22     OREQ '1'
     C**********           MOVE WSVCN     @CUST   60                                          CSD027
     C                     MOVE WSVCN     @CUST   6                                           CSD027
     C           @CUST     LOKUPWBIC,1                   86
     C           *IN86     IFEQ '1'
     C                     MOVE 'N'       WFUAV
     C                     ENDIF
     C                     ENDIF
      *
     C***********WPRME     IFEQ 'Y'                                       122685
     C***********          MOVE 'N'       WFUAV                           122685
     C***********          ENDIF                                          122685
      *
      ** Update outstanding amounts
      *
     C           WNOUP     IFNE 'Y'                                                           CLE023
     C           WFUAV     IFEQ 'Y'
     C           SMDAT     IFEQ *BLANKS                                   125027
     C                     Z-ADD99999     WSVMD                           125027
     C                     ENDIF                                          125027
     C                     Z-ADDFCBAL     WFCBL1 130                                          204347
     C           Z         DOWLE10
      * Do not update beyond the expiry date of the facility        168879
     C********** RUNS,Z    ANDLTDTEXF                               168879                    204708
     C           RUNS,Z    ANDLEDTEXF                                                         204708
     C***********RUNS,Z    ANDLEWSVMD                               125027127169
      *                                                                                       204347
     C           WUPDT     IFEQ '1'                                                           205249
     C           RUNS,Z    IFGE WSVMD                                                         204347
     C           WAUTOA    ANDEQ'N'                                                           204347
     C           SACTN     ANDEQ'A'                                                           204347
     C                     Z-ADD0         FCBAL                                               204347
     C                     ENDIF                                                              204347
      *                                                                                       204347
     C                     ELSE                                                               205249
     C           RUNS,Z    IFGE W#MDAT                                                        205249
     C           WAUTOA    ANDEQ'N'                                                           205249
     C           SACTN     ANDEQ'A'                                                           205249
     C                     Z-ADD0         FCBAL                                               205249
     C                     ENDIF                                                              205249
     C                     ENDIF                                                              205249
      *                                                                                       205249
     C           W#MDAT    IFLE RUNS,Z                                                        205535
     C           RECI      ANDEQ'M'                                                           205535
     C           Z         ANDEQ1                                                             205535
     C                     ADD  1         Z                                                   205535
     C                     ENDIF                                                              205535
     C           WFUPD     IFEQ 'S'
     C           OAM,Z     SUB  FCBAL     OAM,Z
     C                     ELSE
     C           OAM,Z     ADD  FCBAL     OAM,Z
     C                     ENDIF
     C           Z         ADD  1         Z
     C                     ENDDO
     C                     Z-ADDWFCBL1    FCBAL                                               204347
     C                     Z-ADDFCBAL     WOAM   130                      153787
     C                     ENDIF
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
      ** If CLE023 is on, update Current Exposure based on spot rate.                         CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     SUB  FXCBAL    WRK14      86  86                                   CLE023
     C           WRK14     IFLT *ZEROS                                                        CLE023
     C                     ADD  WRK14     FXCBAL     86                                       CLE023
     C                     Z-ADD*ZEROS    WRK14                                               CLE023
     C                     ENDIF                                                              CLE023
     C           *IN86     IFEQ '0'                                                           CLE023
     C                     LEAVE                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C           DAYNO     IFLE BJRDNB                                                        CLE023
     C           WFUPD     IFEQ 'S'                                                           CLE023
     C                     SUB  FXCBAL    CEXP                                                CLE023
     C                     ELSE                                                               CLE023
     C                     ADD  FXCBAL    CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF                                                              CLE023
      *
      ** Increase DAYNO by frequency code
      *
     C           ZFREQ     IFNE *BLANK
     C                     Z-ADDDAYNO     ZDAYNO
     C                     EXSR ZFREQB
     C                     Z-ADDZDAYNO    DAYNO
     C                     ENDIF
      *
     C                     ENDDO
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRLREF  -  Update LEREF record/s                              *
      * Called by: SRINSR - Insert records in files                   *
      *            SRUPDR - Update records in files                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRLREF    BEGSR
      *
      ** Create just one record for a non-multi customer facility or
      ** or when customer equals that of the facility
      ** Otherwise, create two records
      ** Checking if should create just one record does not depend on     124001
      ** multi-customer anymore as is the amendment for syndication       124001
      *
     C                     MOVE *BLANK    WONER
     C           SACTN     IFEQ 'I'
     C                     MOVE WSVCN     WCNUM
     C                     MOVE SFCUS     CNUMF
     C**********           Z-ADDCNUM      W#CNUM                                       121142 CSD027
     C                     MOVE CNUM      W#CNUM                                              CSD027
     C***********WMCSI     IFNE 'Y'                                       124001
     C***********WMCSI     OREQ 'Y'                                       124001
     C***********CNUMF     ANDEQWCNUM                                     124001
     C           CNUMF     IFEQ WCNUM                                     124001
     C                     MOVE 'Y'       WONER   1
     C                     ENDIF
      *
     C                     ELSE
     C**********           Z-ADDCNUM      WCNUM                                               CSD027
     C**********           Z-ADDCNUM      W#CNUM  60                                   121142 CSD027
     C                     MOVE CNUM      WCNUM                                               CSD027
     C                     MOVE CNUM      W#CNUM  6                                           CSD027
     C           FCUS      IFEQ WCNUM
     C                     MOVE 'Y'       WONER   1
     C                     ELSE                                           121142
     C                     MOVE SFCUS     WCNUM                           121142
     C                     ENDIF
     C                     ENDIF
      *
      ** For parts sold, only one record will always be processed
      *
     C           *IN22     IFEQ '1'
     C**********           Z-ADDCNUM      WCNUM                                        123471 CSD027
     C                     MOVE CNUM      WCNUM                                               CSD027
     C                     MOVE 'Y'       WONER
     C                     MOVE *ZEROS    SFTYP
     C                     MOVE *ZEROS    SFSEQ
     C                     ENDIF
      *
     C                     MOVE SFTYP     WFACT
     C                     MOVE SFSEQ     WFCNO
     C                     MOVE SLNRF     WLNRF
     C           WKREF     CHAINLEREF                89
      *
      ** Create/delete the one record for the loan
      *
     C           WONER     IFEQ 'Y'
      *
     C           SACTN     IFEQ 'I'
     C           *IN89     ANDEQ'0'
     C           RECI      ANDEQ'D'
     C           SACTN     OREQ 'R'
     C           *IN89     ANDEQ'1'
     C           SACTN     OREQ 'R'
     C           *IN89     ANDEQ'0'
     C           RECI      ANDNE'D'
     C           *LOCK     IN   LDA
     C                     MOVEL'LEREF   'DBFILE           ************
     C                     Z-ADD18        DBASE            * DBERR 17 *
     C                     MOVELLERFKY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           SACTN     IFEQ 'I'
     C                     MOVE 'D'       RECI
     C**********           Z-ADDWCNUM     CNUM                                                CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C                     MOVE SFTYP     FACT
     C                     MOVE SFSEQ     FCNO
     C                     MOVE SLNRF     LNNO
     C                     MOVE *BLANK    FLIN
     C                     MOVE *BLANK    ZZ001
     C***********          WRITELEREFD1F               89                 157761
     C                     WRITELEREFD1F                                  157761
     C                     ELSE
     C                     MOVE 'R'       RECI
     C***********          UPDATLEREFD1F               89                 157761
     C                     UPDATLEREFD1F                                  157761
     C           *IN89     IFEQ *OFF                                      122384
     C                     MOVE 'W'       WRMSV                           122384
     C                     MOVEL'LEL0190' ZAMSID                          122384
     C                     EXSR ZASNMS                                    122384
     C                     MOVE 'E'       WRMSV                           122384
     C                     ENDIF                                          122384
     C                     ENDIF
      *
      ** Create two records on LEREF for multi-customer facility
      ** with facility customer different from loan customer
      *
     C                     ELSE
      *
     C           SACTN     IFEQ 'I'
     C           *IN89     ANDEQ'0'
     C           RECI      ANDEQ'D'
     C           SACTN     OREQ 'R'
     C           *IN89     ANDEQ'1'
     C           SACTN     OREQ 'R'
     C           *IN89     ANDEQ'0'
     C           RECI      ANDNE'D'
     C           *LOCK     IN   LDA
     C                     MOVEL'LEREF   'DBFILE           ************
     C                     Z-ADD19        DBASE            * DBERR 19 *
     C                     MOVELLERFKY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** ... create/delete first record
      *
     C           SACTN     IFEQ 'I'
     C                     MOVE 'D'       RECI
     C***********          Z-ADDWCNUM     CNUM                            121715
     C                     MOVE SFCUS     CNUM                            121715
     C                     MOVE SFTYP     FACT
     C                     MOVE SFSEQ     FCNO
     C                     MOVE SLNRF     LNNO
     C                     MOVE 'F'       FLIN
     C***********          WRITELEREFD1F               89                 157761
     C                     WRITELEREFD1F                                  157761
     C                     ELSE
     C                     MOVE 'R'       RECI
     C***********          UPDATLEREFD1F               89                 157761
     C                     UPDATLEREFD1F                                  157761
     C                     ENDIF
      *
     C**********           Z-ADDW#CNUM    WCNUM                                        121142 CSD027
     C                     MOVE W#CNUM    WCNUM                                               CSD027
     C                     Z-ADD*ZEROS    WFACT
     C                     Z-ADD*ZEROS    WFCNO
     C           WKREF     CHAINLEREF                89
     C           SACTN     IFEQ 'I'
     C           *IN89     ANDEQ'0'
     C           RECI      ANDEQ'D'
     C           SACTN     OREQ 'R'
     C           *IN89     ANDEQ'1'
     C           SACTN     OREQ 'R'
     C           *IN89     ANDEQ'0'
     C           RECI      ANDNE'D'
     C           *LOCK     IN   LDA
     C                     MOVEL'LEREF   'DBFILE           ************
     C                     Z-ADD20        DBASE            * DBERR 20 *
     C                     MOVELLERFKY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** ... create/delete second record
      *
     C           SACTN     IFEQ 'I'
     C                     MOVE 'D'       RECI
     C**********           Z-ADDWCNUM     CNUM                                                CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C                     Z-ADD*ZEROS    FACT
     C                     Z-ADD*ZEROS    FCNO
     C                     MOVE SLNRF     LNNO
     C                     MOVE 'L'       FLIN
     C***********          WRITELEREFD1F               89                 157761
     C                     WRITELEREFD1F                                  157761
     C                     ELSE
     C                     MOVE 'R'       RECI
     C***********          UPDATLEREFD1F               89                 157761
     C                     UPDATLEREFD1F                                  157761
     C           *IN89     IFEQ *OFF                                      122384
     C                     MOVE 'W'       WRMSV                           122384
     C                     MOVEL'LEL0190' ZAMSID                          122384
     C                     EXSR ZASNMS                                    122384
     C                     MOVE 'E'       WRMSV                           122384
     C                     ENDIF                                          122384
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRTRIX  -  Update transaction index                           *
      * Called by: SRINSR - Insert records in files                   *
      *            SRUPDR - Update records in files                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRTRIX    BEGSR
      *
      ** Settlement type must be 01,02,07,08 or 12 and loan must not
      ** be a risk loan
      *
     C                     MOVE '0'       *IN86
     C           WLNPT     IFNE 70
     C           WLNPT     ANDNE71                                        CLE005
     C           WLNPT     ANDNE72                                        CLE005
     C           WLNPT     OREQ 72                                        CLE005
     C           W72TP     ANDNE'70'                                      CLE005
      *                                                                                       CLE034
     C           CLE034    IFEQ 'N'                                                           CLE034
     C           SSTAL     OREQ 'N'                                                           CLE034
     C           WSDST     LOKUPWNOST                    86
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
     C           PSTNOS    ANDEQ'Y'                                                           CLE034
     C                     MOVE *ON       *IN86                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF
      *
      ** Set pay/receive indicators
      *
     C**********           MOVE RRNAD     LXRRN                                             AR322732
     C********** LXRRN     CHAINLTRIX                89                   186431
      *                                                                   186431
     C**********           MOVE *IN74     IN74    1                                  186431 AR322732
     C**********           MOVE '0'       *IN74                                      186431 AR322732
     C**********           MOVE '1'       TXERR   1                                  186431 AR322732
      *                                                                   186431
     C********** LXRRN     CHAINLTRIX                8974                            186431 AR322732
      *                                                                   186431
     C********** *IN74     DOWEQ'1'                                                  186431 AR322732
     C********** TXERR     ANDEQ'1'                                                  186431 AR322732
     C********** RECID     ORNE *BLANK                                               186431 AR322732
      *                                                                   186431
     C**********           Z-ADDTXSTS     SVSTS   50                                 186431 AR322732
     C**********           UNLCKLTRIX                                                186431 AR322732
     C********** SVSTS     IFEQ 1218                                                 186431 AR322732
     C********** *IN74     OREQ '0'                                                  186431 AR322732
     C********** RECID     ANDNE*BLANK                                               186431 AR322732
     C**********           EXSR SRTLOG                                                 186431 257126
     C**********           ADD  1         RRNAD                                      257126 AR322732
     C**********           Z-ADDRRNAD     WRRNA                                      257126 AR322732
     C**********           MOVE RRNAD     LXRRN                                      186431 AR322732
     C********** LXRRN     CHAINLTRIX                8974                            186431 AR322732
      *                                                                   186431
     C**********           ELSE                                                      186431 AR322732
      *                                                                   186431
     C**********           MOVE '0'       TXERR                                      186431 AR322732
     C**********           ENDIF                                                     186431 AR322732
      *                                                                   186431
     C**********           ENDDO                                                     186431 AR322732
     C**********           MOVE IN74      *IN74                                      186431 AR322732
     C**********           EXSR CLEAR                                                186431 AR322732
      *                                                                   186431
     C********** TXERR     IFEQ '0'                                                  186431 AR322732
     C********** *LOCK     IN   LDA                                                  186431 AR322732
     C**********           MOVEL'LTRIX   'DBFILE           ************              186431 AR322732
     C**********           Z-ADD53        DBASE            * DBERR 53 *              186431 AR322732
     C**********           MOVELLXRRN     DBKEY            ************              186431 AR322732
     C**********           OUT  LDA                                                  186431 AR322732
     C**********           EXSR *PSSR                                                186431 AR322732
     C**********           ENDIF                                                     186431 AR322732
      *                                                                   186431
     C**********           Z-ADD0         PRI1D                                             AR322732
     C**********           Z-ADD0         PRI2D                                             AR322732
     C**********           Z-ADD0         PRI3D                                             AR322732
     C**********           Z-ADD0         PRI4D                                             AR322732
     C**********           MOVE WSVVD     VDATD                                             AR322732
      *                                                                                     AR322732
     C                     Z-ADD0         PRI1D   10                                        AR322732
     C                     Z-ADD0         PRI2D   10                                        AR322732
     C                     Z-ADD0         PRI3D   10                                        AR322732
     C                     Z-ADD0         PRI4D   10                                        AR322732
     C                     MOVE WSVVD     VDATD   50                                        AR322732
      *
     C           SACTN     IFNE 'R'
     C           *IN86     ANDEQ'1'
      *
      ** Set value date then derive test date
      *
     C                     MOVE BJLCCY    ZCCY1
     C                     MOVE BJSLCD    ZLOC1
     C                     Z-ADDWTXND     ZNRDYS
     C                     MOVE BJLCCY    ZCCY2
     C                     MOVE BJSLCD    ZLOC2
     C                     Z-ADDBJRDNB    ZDAYNO
      *
      ** If start settlement type is 01,07 or 08 use loan currency
      *
     C           WSDST     IFEQ 01
     C           WSDST     OREQ 07
     C           WSDST     OREQ 08
     C           CLE034    OREQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
     C                     Z-ADDWSVTX     ZNRDYS
     C                     MOVE SCURR     ZCCY2
     C                     MOVE *BLANK    ZLOC2
     C                     ENDIF
     C                     EXSR ZF2C
      *
      ** Compare value date to rundate and test date
      *
     C           WSVVD     IFGE BJRDNB
     C           WSVVD     ANDLEZDYNBR
     C                     Z-ADD1         PRI1D
     C                     ENDIF
      *
      ** For S01465 (BLI Lending Enhancement)
      *
     C           S01465    IFEQ 'Y'
      *
      ** Set on maturity date pay/receive if
      **    1. auto pay at maturity is Y
      **  + 2. maturity date is within telex notice days
      *
     C           SAPMI     IFEQ 'Y'
     C           WSVMD     ANDLEZDYNBR
     C           WSVMD     ANDNE*ZEROS
     C                     Z-ADD1         PRI2D
     C                     ENDIF
      *
      ** Set on interest date pay/receive if
      **    1. interest date is within telex notice days
      **  + 2. interest date is not zero
      **  + 3. interest date has changed
      **  + 4. interest date is same as original maturity date
      **  + 5. not backvalued
      *
     C           WSVID     IFLE ZDYNBR
     C           WSVID     ANDNE*ZEROS
     C           WSVID     ANDNEONIDT
     C           WSVID     ANDEQOOMDT
     C           OOMDT     ANDGEBJRDNB
     C           PMODE     ANDEQ'B'                                       142405
     C           WSVID     ORLE ZDYNBR                                    142405
     C           WSVID     ANDNE*ZEROS                                    142405
     C           WSVID     ANDEQOOMDT                                     142405
     C           OOMDT     ANDGEBJRDNB                                    142405
     C           WSVID     ANDNEW#OIDT                                    142405
     C           PMODE     ANDNE'B'                                       142405
     C                     Z-ADD1         PRI3D
     C                     ENDIF
      *
      ** Set on repayment date pay/receive if
      **    1. repayment date is within telex notice days
      **  + 2. repayment date is not zero
      **  + 3. repayment date has changed
      **  + 4. repayment date is same as original maturity date
      **  + 5. not back-valued
      *
     C           WSVRP     IFLE ZDYNBR
     C           WSVRP     ANDNE*ZEROS
     C           WSVRP     ANDNEONRPD
     C           WSVRP     ANDEQOOMDT
     C           OOMDT     ANDGEBJRDNB
     C                     Z-ADD1         PRI4D
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *
      ** Update LTRIX detail record
      *
      *  For authorisation do not update last change type as 'X'          122649
      *                                                                   122649
     C                     MOVE *BLANKS   W#ACTN                          123789
     C           SACTN     IFEQ 'X'                                       122649
     C                     MOVE SACTN     W#ACTN  1                       123789
     C                     MOVE CHTP      SACTN                           122649
     C                     ENDIF                                          122649
      *                                                                   122649
     C                     EXCPTTRXDTL
     C**********           MOVE 'Y'       WTRIX                                             AR322732
      *                                                                   123789
     C           W#ACTN    IFEQ 'X'                                       123789
     C                     MOVE W#ACTN    SACTN                           123789
     C                     MOVE *BLANKS   W#ACTN                          126310
     C                     ENDIF                                          123789
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRRSET  -  Reset LTRIX and update CLOAN trailer               *
      * Called by: SRINSR - Insert records in files                   *
      *            SRUPDR - Update records in files                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRRSET    BEGSR
      *
      ** Access LTRIX header record and update relevant fields if
      ** LTRIX details has been updated
      *
     C********** WTRIX     IFEQ 'Y'                                                         AR322732
     C**********           Z-ADD1         LXRRN                                             AR322732
     C********** LXRRN     CHAINLTRIX                89                                     AR322732
     C**********           ADD  1         NORED                                             AR322732
     C**********           ADD  1         RRNAD                                               257126
     C**********           ADD  1         WRRNA                                      257126 AR322732
     C**********           Z-ADDWRRNA     RRNAD                                      257126 AR322732
     C**********           ADD  1         NLNRD                                             AR322732
      *
      ** Update and log LTRIX header
      *
     C**********           EXCPTTRXHDR                                                      AR322732
     C**********           ENDIF                                                            AR322732
      *
      ** Update CLOAN trailer on insert or reversal
      *
     C           SACTN     IFNE 'A'
     C           SACTN     ANDNE'X'                                       123789
      *
      ** Access trailer record
      *
     C                     MOVE 'Z'       WEPAR
     C                     MOVE '999999'  WALON
     C                     MOVE '999999Z' WLTRL   7
     C           WKLON     CHAINCLOAN                89
     C           *IN89     IFEQ '1'
     C           *IN89     OREQ '0'
     C           RECI      ANDNE'T'
     C           *LOCK     IN   LDA
     C                     MOVEL'CLOAN   'DBFILE           ************
     C                     Z-ADD30        DBASE            * DBERR 30 *
     C                     MOVELWLTRL     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Set up relevant total fields
      *
     C           SACTN     IFEQ 'I'
     C                     ADD  2         NORE
     C                     ADD  2         NINS
     C                     ADD  2         NLRA
     C                     ELSE
     C                     ADD  2         NDEL
     C                     SUB  2         NLRA
     C                     ENDIF
      *
      ** Set up amount fields for insert
      *
     C           SACTN     IFEQ 'I'
     C           WSVAM     DIV  1000      ZZAMT  153
     C           ZZAMT     IFLT *ZEROS
     C                     Z-SUBZZAMT     ZZAMT
     C                     ENDIF
      *
     C                     Z-ADDVRIF      ZZTOTI
     C                     Z-ADDVRIL      ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    VRIF
     C                     Z-ADDZZTOTD    VRIL
     C           WSVAM     DIV  1000      ZZAMT
     C           ZZAMT     IFLT *ZEROS
     C                     Z-SUBZZAMT     ZZAMT
     C                     ENDIF
      *
     C                     Z-ADDVLAF      ZZTOTI
     C                     Z-ADDVLAL      ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    VLAF
     C                     Z-ADDZZTOTD    VLAL
      *
      ** Set up amount fields for reversal
      *
     C                     ELSE
     C           CPAM      DIV  1000      ZZAMT
     C           ZZAMT     IFLT *ZEROS
     C                     Z-SUBZZAMT     ZZAMT
     C                     ENDIF
      *
     C                     Z-ADDVRDF      ZZTOTI
     C                     Z-ADDVRDL      ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    VRDF
     C                     Z-ADDZZTOTD    VRDL
     C           CPAM      DIV  1000      ZZAMT
     C           ZZAMT     IFLT *ZEROS
     C                     Z-SUBZZAMT     ZZAMT
     C                     ENDIF
      *
     C                     Z-ADDVLAF      ZZTOTI
     C                     Z-ADDVLAL      ZZTOTD
     C                     EXSR GLZSUB
     C                     Z-ADDZZTOTI    VLAF
     C                     Z-ADDZZTOTD    VLAL
     C                     ENDIF
      *
      ** Update CLOAN trailer
      *
     C                     Z-ADDBJRDNB    LCD
     C           SACTN     IFNE 'X'                                       CLE005
     C                     MOVE SACTN     CHTP
     C                     ENDIF                                          CLE005
     C                     Z-ADDNATN      TNLU
     C                     UPDATCLOANZ1F
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT                                                              153787
      *****************************************************************   153787
      *  SRCKFR  -  Check if the Facility has been reactivated.       *   153787
      *  Called by: SRVAL1 - Validate first detail screen             *   153787
      *             SRFCLT - Update facilities file                   *   153787
      *  Calls    : None                                              *   153787
      *****************************************************************   153787
     C           SRCKFR    BEGSR                                          153787
      *                                                                   153787
     C                     MOVE *OFF      WREAC   1                       153787
      *                                                                   153787
     C           RECIF     IFEQ 'C'                                       153787
     C           RECIF     OREQ 'E'                                       153787
      *                                                                   153787
     C           WKFAM2    SETLLLEFCAML3                                  153787
     C           WKFAM2    READELEFCAML3                 89               153787
      *                                                                   153787
     C           *IN89     DOWEQ*OFF                                      153787
     C           WREAC     ANDEQ*OFF                                      153787
     C           RECIC     IFEQ 'D'                                       153787
     C           FATP      ANDEQ'FR'                                      153787
     C                     Z-ADDAAMT      FAMT                            153787
     C                     Z-ADDNDEX      DTEXF                           153787
     C                     MOVE *ON       WREAC                           153787
      *                                                                                       218753
      ** If Last Availability Date has not yet been amended,                                  218753
      ** use the new expiry date from the Reactivation instead.                               218753
     C           AVLD      IFLT BJRDNB                                                        218753
     C                     Z-ADDNDEX      AVLD                                                218753
     C                     ENDIF                                                              218753
      *                                                                                       218753
     C                     ENDIF                                          153787
     C           WKFAM2    READELEFCAML3                 89               153787
     C                     ENDDO                                          153787
      *                                                                   153787
     C                     ENDIF                                          153787
      *                                                                   153787
     C                     MOVE *OFF      *IN89                           153787
      *                                                                   153787
     C                     ENDSR                                          153787
      /EJECT
      *****************************************************************
      * GLZSUB  -  Subtracts an amount (ZZAMT) from the total         *
      * Called by: SRRSET - Reset LTRIX and update CLOAN trailer      *
      * Calls    : GLZADD - Adds an amount to the total               *
      *****************************************************************
     C           GLZSUB    BEGSR
      *
      ** Just reverse the 'sign' and add
      *
     C                     Z-SUBZZAMT     ZZAMT
     C                     EXSR GLZADD
     C                     Z-SUBZZAMT     ZZAMT
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * GLZADD  -  Adds an amount (ZZAMT) to the total (ZZTOTI,ZZTOTD)*
      * Called by: SRRSET - Reset LTRIX and update CLOAN trailer      *
      * Calls    : GLZSUM - Carries out the addition of the amounts   *
      *****************************************************************
     C           GLZADD    BEGSR
      *
     C           ZZAMT     IFNE *ZERO
      *
      ** Split ZZAMT into integer and decimal fields
      *
     C                     Z-ADDZZAMT     ZZAMTI 150
     C                     MOVE ZZAMT     ZZAMTD  30
      *
      ** Both ZZAMTI and ZZAMTD contain a 'sign' zone now
      *
     C                     EXSR GLZSUM
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * GLZSUM  -  Carries out the addition of the amounts            *
      * Called by: GLZADD - Adds an amount to the total               *
      * Calls    : None                                               *
      *****************************************************************
     C           GLZSUM    BEGSR
      *
      ** Save values of indicators to be used in the program
      *
     C                     MOVE *IN91     WIN91   1
     C                     MOVE *IN92     WIN92   1
     C                     MOVE *IN93     WIN93   1
     C                     MOVE *IN94     WIN94   1
     C                     MOVE *IN95     WIN95   1
     C                     MOVE *IN96     WIN96   1
     C                     SETOF                     919293
     C                     SETOF                     949599
      *
      ** Determine sign of ZZAMTI and ZZAMTD, 92 if neg
      *
     C           ZZAMTI    COMP 0                      9293
     C   93      ZZAMTD    COMP 0                      9293
     C   93                GOTO ZZSEND                     ZERO BYPASS
      *
      ** Determine sign of ZZTOTI and ZZTOTD, 91 if neg
      *
     C           ZZTOTI    COMP 0                      9193
     C   93      ZZTOTD    COMP 0                      9193
      *
      ** If ZZTOTAL is zero, return ZZAMOUNT
      *
     C   93                Z-ADDZZAMTI    ZZTOTI 150
     C   93                Z-ADDZZAMTD    ZZTOTD  30
     C   93                GOTO ZZSEND                     ZERO BYPASS
      *
      ** If signs differ, bypass overflow checks
      *
     C   91N92
     CORN91 92             GOTO ZZOFPS
     C*
     C           ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     C           ZZWK2     COMP 999                  93    '93' = CARRY
     C  N93      ZZWK2     COMP -999                   93    INTO INTEGER.
     C*
     C   93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
     C      93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
     C   93      ZZTOTI    ADD  ZZWK3     ZZWK3
     C  N93      ZZTOTI    ADD  ZZAMTI    ZZWK3
      *
      ** If the modulus of ZZWK3 is lt mod. ZZTOTI then O/F has occured
      *
     C  N92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     C   92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     C  N99                Z-ADDZZWK2     ZZTOTD
     C  N99                Z-ADDZZWK3     ZZTOTI
      *
      ** If O/F zeroise ZZAMT, Ind '99' set and ZZTOT fields left intact
      *
     C   99                Z-ADD0         ZZAMT  153
     C                     GOTO ZZSEND
      *
      ** The 'signs' are different
      *
     C           ZZOFPS    TAG
      *
      ** If ZZAMT was negative, make it pos. to como with ZZTOT
      *
     C   92                Z-SUBZZAMTI    ZZAMTI 150
     C   92                Z-SUBZZAMTD    ZZAMTD  30
      *
      ** If ZZTOT was negative, make it pos. to comp with ZZAMT.
      *
     C   91                Z-SUBZZTOTI    ZZTOTI
     C   91                Z-SUBZZTOTD    ZZTOTD
      *
      ** Both ZZAMT and ZZTOT are now positive
      *
     C           ZZTOTI    COMP ZZAMTI               93  95
     C   95      ZZTOTD    COMP ZZAMTD               93  95
      *
      ** If ZZTOT eq. ZZAMT return ZERO.
      *
     C   95                Z-ADD0         ZZTOTI
     C   95                Z-ADD0         ZZTOTD
     C   95                GOTO ZZSEND
      *
      ** If ZZTOT gt. ZZAMT.
      *
     C   93      ZZAMTD    COMP ZZTOTD               94
     C   93 94   ZZTOTI    SUB  1         ZZTOTI
     C   93 94   ZZTOTD    ADD  1000      ZZWK2
     C   93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     C   93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     C   93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
      *
      ** If ZZAMT gt. ZZTOT.
      *
     C  N93      ZZTOTD    COMP ZZAMTD               94
     C  N93 94   ZZAMTI    SUB  1         ZZWK3  150
     C  N93 94   ZZAMTD    ADD  1000      ZZWK2
     C  N93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     C  N93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     C  N93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     C  N93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
      *
      ** Reverse sign of ZZTOT if larger I/P fields were negative
      *
     C                     SETOF                     94
     C   93 91
     CORN93 92             SETON                     94
     C   94                Z-SUBZZTOTI    ZZTOTI
     C   94                Z-SUBZZTOTD    ZZTOTD
      *
      ** Restore sign of ZZAMTI & ZZAMTD if it was reversed
      *
     C   92                Z-SUBZZAMTI    ZZAMTI
     C   92                Z-SUBZZAMTD    ZZAMTD
     C           ZZSEND    TAG
      *
      **   If ZZTOTD is zero, and ZZTOTI is neg. set up ZZNEGD.
      *
     C                     SETOF                     96
     C           ZZTOTD    COMP 0                        91
     C   91      ZZTOTI    COMP 0                      96
     C   96                MOVE '.000-'   ZZNEGD  5
      *
      ** Restore previous indicator values
      *
     C                     MOVE WIN91     *IN91
     C                     MOVE WIN92     *IN92
     C                     MOVE WIN93     *IN93
     C                     MOVE WIN94     *IN94
     C                     MOVE WIN95     *IN95
     C                     MOVE WIN96     *IN96
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSHDW  -  Update shadow files                                *
      * Called by: Main routine                                       *
      *            SRBTCH - Batch processing                          *
      *            SRSPRO - Subfile processing                        *
      *            SRINSR - Insert records in files                   *
      *            SRUPDR - Update records in files                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSHDW    BEGSR
      *
      ** Do on-line updates to PRONO, MEMOS, OLPOS and RSACMTPD
      ** only if not a Guarantee loan, if its a Guarantee loan then       175450
      ** it should have an interest payment date.                         175450
      *                                                                   122960
     C           SACTN     IFEQ 'I'                                                           201672
     C           SACTN     OREQ 'A'                                                           201672
     C           SACTN     OREQ 'R'                                                           201672
     C           PTYP      IFEQ 61                                        175450
     C           PTYP      OREQ 62                                        175450
     C           PTYP      OREQ 63                                        175450
     C           PTYP      OREQ 64                                        175450
     C           PTYP      OREQ 65                                        175450
     C           PTYP      OREQ 66                                        175450
     C           PTYP      OREQ 67                                        175450
     C           PTYP      OREQ 68                                        175450
     C           PTYP      OREQ 69                                        175450
     C           PTYP      OREQ 70                                        175450
     C           NIDT      ANDNE0                                         175450
     C           PTYP      OREQ 71                                        175450
     C           NIDT      ANDNE0                                         175450
     C           PTYP      OREQ 72                                        175450
     C           NIDT      ANDNE0                                         175450
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           PMODE     IFEQ 'B'                                       122960
     C                     MOVE '*LEBTCH' PRTCD                           122960
     C                     ELSE                                           122960
     C                     MOVE *BLANKS   PRTCD                           122960
     C                     ENDIF                                          122960
      *
     C                     CALL 'AOOULEU0'
     C***********          PARM *BLANKS   PRTCD                           122960
     C                     PARM           PRTCD                           122960
     C                     PARM           Z#BSTS
     C                     PARM           Z#ASTS
     C                     PARM           Z#WSTS
     C                     PARM           Z#BSTK                                              220754
     C                     PARM           Z#ASTK                                              220754
     C                     PARM *BLANKS   CLONQD                                            AR820267
      *
     C           PRTCD     IFEQ '*ERROR*'
     C           PRTCD     OREQ '*RECLCK'                                                   AR868380
     C                     EXSR *PSSR
     C                     END
      *                                                                                       201672
     C           MDAT      IFNE 0                                                             201672
     C                     MOVELLNRF      OLNRF                                               201672
     C                     Z-ADDOMDAT     #OMDAT                                              201672
     C                     CALL 'LE2032 '                                                     201672
     C**********           PARM           OLNRF   60                                   201672 CLE148
     C                     PARM           OLNRF   6                                           CLE148
     C                     PARM           MDAT                                                201672
     C                     PARM           #OMDAT  50                                          201672
     C                     PARM *BLANKS   PRTCD                                             AR868380
      *                                                                                     AR868380
     C           PRTCD     IFEQ '*RECLCK'                                                   AR868380
     C                     EXSR *PSSR                                                       AR868380
     C                     ENDIF                                                            AR868380
     C                     ENDIF                                                              201672
     C                     ENDIF                                          175450
     C                     ENDIF                                                              201672
     C/COPY WNCPYSRC,LE2030C068
      *                                                                   CDE001
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           CDE001    IFEQ 'Y'                                       CDE001
     C                     MOVELSLNRF     T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C                     PARM           T#TREF 20                       CDE001
     C                     PARM 'LOAN'    T#TCAT  4                       CDE001
     C                     PARM           RSRVID 10                                           CDE005
     C                     ENDIF                                          CDE001
      *
      ** If not in batch mode or play mode, commit updates
      *
     C           PMODE     IFNE 'B'
     C***********PMODE     ANDNE'P'                                       120121
     C                     COMIT
     C                     ENDIF
      *
      ** Return to initial screen or subfile screen
      *
     C                     MOVE 'F0'      WFMT
     C           WSFIL     IFEQ 'Y'
     C                     MOVE 'S0'      WFMT
     C                     ENDIF
     C           CLE002    IFEQ 'Y'
     C                     MOVE '1'       *IN34
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRTEST  -  Write to test harness file LE2030PD                *
      * Called by: SRINSR - Insert records in files                   *
      *            SRUPDR - Update existing records in files          *
      * Calls    : None                                               *
      *****************************************************************
     C           SRTEST    BEGSR
      *
      ** Set up key fields (date and time stamps, loan and action)
      *
     C           SACTN     IFEQ 'X'
     C           SACTN     OREQ 'R'
     C                     CLEARLE2030D0
     C                     ENDIF
      *
     C                     Z-ADDBJRDNB    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     WDATE
     C                     MOVE WDAT1     WTDT1
     C                     MOVE WDAT2     WTDT2
     C                     MOVE WDAT3     WTDT3
     C                     MOVE WTDAT     DTST
      *
     C                     TIME           WTIME
     C                     MOVE WTIM1     WTTM1
     C                     MOVE WTIM2     WTTM2
     C                     MOVE WTIM3     WTTM3
     C                     MOVE WTTIM     TMST
      *
     C           SACTN     IFNE 'I'
     C                     MOVE SLNRF     LNRFH
     C                     ENDIF
     C                     MOVE SACTN     ACTN
      *
      ** Format detail fields for insert and amend
      ** Some fields have been formatted on update to CLOANCL
      *
     C           SACTN     IFEQ 'A'
     C           SACTN     OREQ 'I'
     C           *IN21     IFEQ '1'
     C                     MOVE SCUST     ORGB
     C                     ELSE
     C                     MOVE SCUST     CNMR
     C                     ENDIF
      *
     C                     MOVE SFCUS     FCUSH
     C                     MOVELSFTYP     FCTN
     C                     MOVE SFSEQ     FCTN
     C                     MOVE SDDAT     DDATH
     C                     MOVE SVDAT     STDTH
     C                     MOVE SMDAT     MDATH
     C                     MOVE SCPAM     CPAMH
     C                     MOVE SACSQ     LASQH
     C                     MOVE SCALC     CALCH
     C                     MOVE SBRTT     BRTTH
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     MOVE SBASR     BASRH                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     MOVE SRTSP     RTSPH
     C                     MOVE SIPRD     DISC
     C                     MOVE SRLDT     RLDTH
     C                     MOVE SRLDY     RLDYH
     C                     MOVE SMARG     MARGH
     C                     MOVE SNEGV     NEGV
     C                     MOVE SNIDT     NIDTH
     C                     MOVE SIFDY     IFDYH
     C                     MOVE SWTRT     WTRTH
     C                     MOVE SREPT     REPTH
     C                     MOVE SRAMT     RPAM
     C                     MOVE SNRPD     RPDT
     C                     MOVE SRFRQ     RPFQ
     C                     MOVE SRDYN     RPDY
     C                     MOVE SBLDY     BLDYH
     C                     MOVE SSECI     SECI
     C                     MOVE SDOCI     DOCI
     C                     MOVE SFEEI     FEEI
     C                     MOVE SFRBC     FRBCH
     C**********           MOVE SLIND     LINDH                                               CER020
     C                     MOVE SLIND     LOICH   3                                           CER020
     C                     MOVE SBCXR     BCXRH
     C                     MOVE SBMIN     BMIN
     C                     MOVE SFCXR     FCXRH
     C                     MOVE SFMIN     FMIN
      *
      ** BLI Lending Enhancement (S01465) fields
      *
     C           S01465    IFEQ 'Y'
     C                     MOVE SRECE     RECEH
     C                     MOVE SCOCU     COCUH
     C                     ENDIF
      *
     C                     MOVE SNAR1     NARR1
     C                     MOVE SNAR2     NARR2
     C                     MOVE SNAR3     NARR3
     C                     MOVE SNAR4     NARR4
     C                     MOVE SRDFC     RCFC
     C           *IN22     IFEQ '1'                                       125184
     C                     MOVE SOLNO     OLNOH
     C                     ENDIF                                          125184
     C           *IN21     IFEQ '1'                                       125184
     C                     MOVELSPFRM     OLNOH                           125184
     C                     ENDIF                                          125184
     C                     MOVE SFRSP     FRSP
      *
      ** Extended settlement details
      *
     C                     MOVELWOSDB     OSDBH
     C                     MOVELWOMDB     OMDBH
     C                     MOVELRSTM      RSTMH
     C                     MOVELRONS      RONSH
     C                     MOVELRIBN      RIBNH
     C                     MOVELRIBA      RIBAH
     C                     MOVELROBN      ROBNH
     C                     MOVELROCN      ROCNH
     C                     MOVELPSTM      PSTMH
     C                     MOVELPONS      PONSH
     C                     MOVELPIBN      PIBNH
     C                     MOVELPIBA      PIBAH
     C                     MOVELPOBN      POBNH
     C                     MOVELPOCN      POCNH
     C                     MOVELRCRN      RCRNH
     C                     MOVELRCRA      RCRAH
     C                     MOVELRVNO      RVNOH
     C                     MOVELAWBN      AWBNH
     C                     MOVELAWBA      AWBAH
     C                     MOVELBENN      BENNH
     C                     MOVELBENA      BENAH
     C                     MOVELDTP1      DTP1H
     C                     MOVELDTP2      DTP2H
     C                     MOVELDTP3      DTP3H
     C                     MOVELDTP4      DTP4H
     C                     MOVELDCHG      DCHGH
     C                     MOVELBTB1      BTB1H
     C                     MOVELBTB2      BTB2H
     C                     MOVELBTB3      BTB3H
     C                     MOVELBTB4      BTB4H
     C                     MOVELBTB5      BTB5H
     C                     MOVELBTB6      BTB6H
     C                     MOVELCVMR      CVMRH
      *
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE SCCY      SCCYH                           CEU004
     C                     MOVE ICCY      ICCYH                           CEU004
     C                     ENDIF                                          CEU004
      *
      ** Syndication details
      *
     C                     MOVE SFCRA     FCRAH
     C                     MOVE SGDPR     GDPRH
     C                     MOVE SGDIN     GDINH
     C                     ENDIF
      *                                                                                       CAS001
      ** When CAS001 enhancement is installed                                                 CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVE #6YLDC    FSYLDC                                              CAS001
     C                     MOVE #6FYLD    FSFYLD                                              CAS001
     C                     ENDIF                                                              CAS001
      *
     C***********          WRITELE2030D0               89                 157761
     C                     WRITELE2030D0                                  157761
      *
     C                     ENDSR
      /EJECT
      *****************************************************************   159256
      * SRWARN   - Send a warning message if a syndicated loan is     *   159256
      *            being amended, reversed or authorised directly on  *   159256
      *            Midas as Loan Manager should be used to take       *   159256
      *            advantage of the autogeneration process.           *   159256
      * Called by: SRSTRT, SRDETL1, SRDETL2                           *   159256
      * Calls    : None                                               *   159256
      *****************************************************************   159256
     C           SRWARN    BEGSR                                          159256
      *                                                                   159256
      ** Only issue the warning once for the same transaction.            159256
      *                                                                   159256
     C           WE232     IFEQ *BLANK                                    159256
     C           WE232     OREQ 'Y'                                       159256
     C           SLNRF     ANDNEW1LNRF                                    159256
     C                     MOVELSLNRF     W1LNRF  6                       159256
      *                                                                   159256
      ** Warn if participation linked to a syndicate                      159256
      *                                                                   159256
     C           PTYP      IFEQ 64                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYP      OREQ 65                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYP      OREQ 66                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYP      OREQ 67                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYP      OREQ 68                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYP      OREQ 69                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYP      OREQ 71                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYP      OREQ 72                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C                     MOVE 'LEM0232' ZAMSID                          159256
     C                     EXSR ZASNMS                                    159256
     C                     MOVE 'Y'       WE232   1                       159256
      *                                                                   159256
      ** If transaction selected from subfile.                            159256
      *                                                                   159256
     C           WSFIL     IFEQ 'Y'                                       159256
     C                     MOVE 'Y'       WWARN                           159256
      *                                                                   159256
      ** If participation purchased, warn against facility reference      159256
      *                                                                   159256
     C           *IN22     IFEQ '0'                                       159256
     C                     MOVE '1'       *IN,34                          159256
      *                                                                   159256
      ** If participation sold, warn against linked to syndicate          159256
      *                                                                   159256
     C                     ELSE                                           159256
     C                     MOVE '1'       *IN,67                          159256
     C                     ENDIF                                          159256
      *                                                                   159256
      ** If transaction selected on initial screen, warn against the      159256
      ** action and the loan reference.                                   159256
      *                                                                   159256
     C                     ELSE                                           159256
     C                     MOVEA'11'      *IN,30                          159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ELSE                                           159256
      *                                                                   159256
     C                     MOVE *BLANKS   WE232                           159256
      *                                                                   159256
      ** Warn if loan or direct participation purchased but facility      159256
      ** is syndicated.                                                   159256
      *                                                                   159256
     C           PTYP      IFEQ 61                                        159256
     C           PTYP      OREQ 62                                        159256
     C           PTYP      OREQ 63                                        159256
     C           PTYP      OREQ 64                                        159256
     C           LNKS      ANDNE'Y'                                       159256
     C           PTYP      OREQ 65                                        159256
     C           LNKS      ANDNE'Y'                                       159256
     C           PTYP      OREQ 68                                        159256
     C           LNKS      ANDNE'Y'                                       159256
     C           PTYP      OREQ 70                                        159256
     C           PTYP      OREQ 71                                        159256
     C           LNKS      ANDNE'Y'                                       159256
      *                                                                   159256
     C                     MOVE 'A'       WFRCTP                          159256
     C                     MOVE FCUS      WFCNUM                          159256
     C                     MOVE FTYP      WFFACT                          159256
     C                     MOVE FSEQ      WFFCNO                          159256
      *                                                                   159256
     C********** WKFAC     CHAINFCLTY                89            159256 181084
     C           WKFAC     CHAINFCLTY               N89                   181084
     C           SYINF     IFEQ 'Y'                                       159256
     C                     MOVE 'LEM0232' ZAMSID                          159256
     C                     EXSR ZASNMS                                    159256
     C                     MOVE 'Y'       WE232                           159256
      *                                                                   159256
      ** If transaction selected from subfile, warn against the           159256
      ** facility reference.                                              159256
      *                                                                   159256
     C           WSFIL     IFEQ 'Y'                                       159256
     C                     MOVE 'Y'       WWARN                           159256
     C                     MOVE '1'       *IN,34                          159256
      *                                                                   159256
      ** If transaction selected on initial screen, warn against the      159256
      ** action and the loan reference.                                   159256
      *                                                                   159256
     C                     ELSE                                           159256
     C                     MOVEA'11'      *IN,30                          159256
     C                     ENDIF                                          159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ELSE                                           159256
      *                                                                   159256
     C                     MOVE *BLANKS   WE232                           159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDSR                                          159256
      *                                                                   159256
      *****************************************************************
      * CLEAR   -  Clears the message queue                           *
      * Called by: All validation subroutines                         *
      * Calls    : Y2CLMSC                                            *
      *****************************************************************
     C           CLEAR     BEGSR
      *
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
      *
     C                     MOVE *BLANK    WERRF   1
     C                     MOVE *BLANK    WWARN   1
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *  ZASNMS - Sends messages to the program's message queue       *
      *  Called by: Almost all screens with validation                *
      *  Calls    : None                                              *
      *****************************************************************
     C           ZASNMS    BEGSR
      *
     C           PRMSV     IFNE 'D'                                       120121
     C           WRMSV     IFNE 'W'
     C                     MOVE 'Y'       WERRF
     C                     MOVE 'E'       PRMSV
     C                     ELSE
     C                     MOVE 'W'       PRMSV
     C                     ENDIF
     C                     ENDIF                                          120121
      *
     C           PMODE     IFEQ 'B'
     C           PMODE     OREQ 'P'
     C                     EXSR SRBERR
      *
     C                     ELSE
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message Id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C                     PARM           ZAMSTP  7        Message type.
     C                     ENDIF
      *
     C           ZAEXIT    ENDSR
      /EJECT                                                              123998
      *****************************************************************   123998
      * SRTEXT  -  Set up text from message file                      *   123998
      * Called by: All subroutines setting of texts                   *   123998
      * Calls    : None                                               *   123998
      *****************************************************************   123998
     C           SRTEXT    BEGSR                                          123998
      *                                                                   123998
     C                     CALL 'Y2RVMGC'                                 123998
     C                     PARM *BLANKS   PRTCD                           123998
     C                     PARM           ZAMSID           Message Id.    123998
     C                     PARM           ZAMSGF           Message file.  123998
     C                     PARM           ZAMSDA           Message data.  123998
     C                     PARM           ZAMSTX           Messge text    123998
      *                                                                   123998
     C                     ENDSR                                          123998
      /EJECT
      *****************************************************************
      * SRBERR  -  Set up batch error details                         *
      * Called by: ZASNMS - Sends messages to the program msgq        *
      * Calls    : None                                               *
      *****************************************************************
     C           SRBERR    BEGSR
      *
     C                     CALL 'Y2RVMGC'
     C                     PARM           PRTCD
     C                     PARM           ZAMSID           Message Id.
     C                     PARM           ZAMSGF           Message file.
     C                     PARM           ZAMSDA           Message data.
     C                     PARM           ZAMSTX132        Messge text
      *                                                                   120468
      *  Include DUMP here for problems during batch and play modes.      120468
      *                                                                   120468
     C***********WWARN     IFNE 'Y'                                120468 121142
     C***********WRMSV     ORNE 'W'                                120468 121142
     C           PRMSV     IFEQ 'E'                                       121142
     C           PRPLC     IFEQ 'B'                                       CAP053
     C           CAP053    ANDEQ'Y'                                       CAP053
     C                     CALL 'LEC0215'                                 CAP053
     C                     PARM           XREPN                           CAP053
      *                                                                   CAP053
      ** Set up invalid file fields                                       CAP053
      *                                                                   CAP053
     C                     MOVELZAMSID    XMSID                           CAP053
     C                     MOVELPLNRF     LNRFL                           CAP053
     C                     Z-ADD61        PTYPL                           CAP053
     C                     MOVELPTUSR     IUSRL                           CAP053
     C                     MOVEL*BLANK    LSTSL                           CAP053
     C                     Z-ADD*ZERO     NOPSL                           CAP053
     C                     MOVELPBRCH     BRCAL                           CAP053
     C                     MOVELPORBR     ORBRL                           CAP053
      *                                                                   CAP053
      ** Set up SD2400 invalid file fields                                CAP053
      *                                                                   CAP053
     C                     MOVELPMRSTM    SFRSTM    P                     CAP053
     C                     MOVELPMRONS    SFRONS    P                     CAP053
     C                     MOVELPAROBN    SFROBN    P                     CAP053
     C                     MOVELPAROCN    SFROCN    P                     CAP053
     C                     MOVELPARIBN    SFRIBN    P                     CAP053
     C                     MOVELPMRIBA    SFRIBA    P                     CAP053
     C                     MOVELPMPSTM    SFPSTM    P                     CAP053
     C                     MOVELPMPONS    SFPONS    P                     CAP053
     C                     MOVELPAPOBN    SFPOBN    P                     CAP053
     C                     MOVELPAPOCN    SFPOCN    P                     CAP053
     C                     MOVELPAPIBN    SFPIBN    P                     CAP053
     C                     MOVELPMPIBA    SFPIBA    P                     CAP053
     C                     MOVELPARCRN    SFRCRN    P                     CAP053
     C                     MOVELPMRCRA    SFRCRA    P                     CAP053
     C                     MOVELPARVNO    SFRVNO    P                     CAP053
     C                     MOVELPAAWBN    SFAWBN    P                     CAP053
     C                     MOVELPMAWBA    SFAWBA    P                     CAP053
     C                     MOVELPABENN    SFBENN    P                     CAP053
     C                     MOVELPMBENA    SFBENA    P                     CAP053
     C                     MOVELPMDTP1    SFDTP1    P                     CAP053
     C                     MOVELPMDTP2    SFDTP2    P                     CAP053
     C                     MOVELPMDTP3    SFDTP3    P                     CAP053
     C                     MOVELPMDTP4    SFDTP4    P                     CAP053
     C                     MOVELPMDCHG    SFDCHG    P                     CAP053
     C                     MOVELPMBTB1    SFBTB1    P                     CAP053
     C                     MOVELPMBTB2    SFBTB2    P                     CAP053
     C                     MOVELPMBTB3    SFBTB3    P                     CAP053
     C                     MOVELPMBTB4    SFBTB4    P                     CAP053
     C                     MOVELPMBTB5    SFBTB5    P                     CAP053
     C                     MOVELPMBTB6    SFBTB6    P                     CAP053
     C                     MOVELPMCVMR    SFCVMR    P                     CAP053
     C                     MOVELPMBTB6    SFBTB6    P                     CAP053
     C                     MOVELPMIC72    SFICCY    P                     CAP053
      *                                                                                       CLE031
      ** If CLE031 is switched on, set up the following fields:                               CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PMRSCY    SFSCCY                                              CLE031
     C                     MOVE PMPSCY    SFPSCY                                              CLE031
     C                     MOVE PMREXR    SFREXR                                              CLE031
     C                     MOVE PMPEXR    SFPEXR                                              CLE031
     C                     MOVE PMREXI    SFREXI                                              CLE031
     C                     MOVE PMPEXI    SFPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C*                                                                   CSC011
     C           PCRFL     IFEQ *BLANKS                                   CSC011
     C                     MOVELPTREF     STNRF                           CSC011
     C                     ELSE                                           CSC011
     C                     MOVELPCRFL     STNRF                           CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C           PTDAT     IFEQ *BLANKS                                   CSC011
     C           PTTIM     OREQ *BLANKS                                   CSC011
     C                     CALL 'ZAGENTS'                                 CSC011
     C                     PARM ZATMST    ZATMST 26                       CSC011
     C                     MOVE ZATMST    TSTISO                          CSC011
     C                     ELSE                                           CSC011
     C                     MOVE PTDT1     TSTDD                           CSC011
     C                     MOVE PTDT2     TSTMM                           CSC011
     C                     MOVE PTDT3     TSTYY                           CSC011
     C                     MOVE PTTIM     WTSTM                           CSC011
     C                     MOVE WTSHR     TSTTM1                          CSC011
     C                     MOVE WTSMN     TSTTM2                          CSC011
     C                     MOVE WTSSC     TSTTM3                          CSC011
     C                     MOVE '000000'  TSTTM4                          CSC011
     C                     ENDIF                                          CSC011
     C                     MOVE TSTISO    STMST                           CSC011
      *                                                                   CAP053
     C                     WRITELEILONP0                                  CAP053
      *                                                                   CSC011
      * If Support System active, write transaction to 24x7 log           CSC011
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
      *                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
      *                                                                   CSC011
      * Convert Loan to PINPP format                                      CSC011
     C                     EXSR LOG247                                    CSC011
      *                                                                   CSC011
      * Write invalid Loan in LEF1MF format to 24x7 Log File              CSC011
     C                     MOVE 'I'       LOGVAL  1                       CSC011
     C                     EXSR APLGTR                                    CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     COMIT                                          CAP053
     C                     ELSE                                           CAP053
      *                                                                   CAP053
     C                     DUMP                                           120468
     C                     ENDIF                                          CAP053
     C                     ENDIF                                          120468
      *
      ** If batch mode, set up details of returned message format
      ** otherwise update message severity/id/text of test harness file
      *
     C           PMODE     IFEQ 'B'
      *                                                                   120002
      ** Set up returned message format                                   120002
      *                                                                   120002
     C***********          CLEARPOUTP                              120002 120278
     C                     MOVE PMTYP     PRMTP                           120002
     C                     MOVE PTUSR     PRTUS                           120002
     C                     MOVE PTWID     PRTWS                           120002
     C                     MOVE PTREF     PRTRF                           120002
     C                     MOVE PTSEQ     PRTSQ                           120002
     C                     MOVE PTACT     PRTAC                           120002
     C                     MOVE PTDAT     PRTDT                           120002
     C                     MOVE PTTIM     PRTTM                           120002
     C                     MOVE PNPAR     PRPAR                           120002
     C           PPCOB     IFNE *BLANKS                                   123227
     C                     MOVE SLNRF     PRLON                           120002
     C                     ENDIF                                          123227
     C                     MOVELZAMSID    PRMID
     C                     MOVELZAMSTX    PRMTX
     C                     ELSE
     C                     MOVELPRMSV     RMSV
     C                     MOVELZAMSID    RMID
     C                     MOVELZAMSTX    RMTX
     C           PRMSV     IFEQ 'E'
     C***********          UPDATLE2030D0               89                 157761
     C                     UPDATLE2030D0                                  157761
     C                     ROLBK
     C                     ENDIF
     C                     ENDIF
      *                                                                   CAP053
      * If not a warning error, in batch mode, and repair in back-office  CAP053
      *                                                                   CAP053
     C           PRMSV     IFEQ 'E'                                       CAP053
     C           PMODE     ANDEQ'B'                                       CAP053
     C           PRPLC     ANDEQ'B'                                       CAP053
     C           CAP053    ANDEQ'Y'                                       CAP053
     C                     MOVEL*BLANK    PRMSV                           CAP053
     C                     MOVE '1'       *INLR                           CAP053
     C                     RETRN                                          CAP053
     C                     ENDIF                                          CAP053
      *
      ** If not a warning error, stop validation and return
      ** For batch mode, update LDA before returning
      *
     C           PRMSV     IFEQ 'E'
     C           PRMSV     OREQ 'D'                                       120121
      *
     C           PMODE     IFEQ 'B'
     C           *LOCK     IN   LDA
     C                     MOVELZAMSID    DBKEY
     C                     MOVEL'LERMSGF' DBFILE
     C                     MOVELZAMSTX    DBTXT
     C                     OUT  LDA
     C                     ENDIF
      *
     C                     MOVE '1'       *INLR
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************   CSC011
      *                                                                   CSC011
      *  LOG247  -  Convert fields to the format required to be       *   CSC011
      *             written to the 24x7 Midas Availability Log        *   CSC011
      *  Called by: SRUPDT                                            *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           LOG247    BEGSR                                          CSC011
      *                                                                   CSC011
     C           PMODE     IFNE 'B'                                       CSC011
     C                     CLEARPINPP                                     CSC011
     C                     MOVE PTYPE     PMTYP                           CSC011
     C                     MOVE USER      PTUSR                           CSC011
     C                     MOVE WSID      PTWID                           CSC011
     C                     MOVE SACTN     PTACT                           CSC011
     C*                                                                   CSC011
     C                     CALL 'ZAGENTS'                                 CSC011
     C                     PARM ZATMST    ZATMST 26                       CSC011
     C                     MOVE ZATMST    TSTISO                          CSC011
     C*                                                                   CSC011
     C           PTDAT     IFEQ *BLANKS                                   CSC011
     C                     MOVE TSTDD     PTDT1                           CSC011
     C                     MOVE TSTMM     PTDT2                           CSC011
     C                     MOVE TSTYY     PTDT3                           CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     MOVELTSTTM1    WSTM1   40                      CSC011
     C                     MOVE TSTTM2    WSTM1                           CSC011
     C                     MOVELTSTTM3    WSTM2   40                      CSC011
     C                     MOVELTSTTM4    WSTM3   20                      CSC011
     C                     MOVELWSTM1     PTTIM                           CSC011
     C                     MOVE WSTM3     WSTM2                           CSC011
     C                     MOVE WSTM2     PTTIM                           CSC011
     C*                                                                   CSC011
     C                     MOVE PRPAR     PNPAR                           CSC011
     C                     MOVE PRPLC     PRPLC                           CSC011
     C                     MOVE PFILL     PFILL                           CSC011
     C                     MOVE PPTIN     PPTIN                           CSC011
     C                     MOVE SLNRF     PLNRF                           CSC011
     C                     MOVE SCUST     PCNMR                           CSC011
     C                     MOVE SORBR     PORBR                           CSC011
     C                     MOVE SLTYP     PLTYP                           CSC011
     C                     MOVE SSUTP     PSUTP                           CSC011
     C                     MOVELSDDAT     PDDAT                           CSC011
     C                     MOVELSMDAT     PMDAT                           CSC011
     C                     MOVE SFCUS     PFCUS                           CSC011
     C                     MOVE SFTYP     PFACT                           CSC011
     C                     MOVE SFSEQ     PFCNO                           CSC011
     C                     MOVE SCURR     PCCY                            CSC011
     C                     MOVE SCPAM     PCPAM                           CSC011
     C                     MOVE SAUTO     PAUTO                           CSC011
     C                     MOVE SAPMI     PAPMI                           CSC011
     C                     MOVE SBOKC     PBOKC                           CSC011
     C                     MOVE SPTFR     PPTFR                           CSC011
     C                     MOVE SPRFC     PPRFC                           CSC011
     C                     MOVE SACSQ     PLASQ                           CSC011
     C                     MOVE SINTC     PINTC                           CSC011
     C                     MOVE SADDI     PADDI                           CSC011
     C                     MOVE SCALC     PCALC                           CSC011
     C                     MOVE SBRTT     PBRTT                           CSC011
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     MOVE SBASR     N1BASR                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     MOVE SRTSP     PRTSP                           CSC011
     C                     MOVE SSPIN     PSPIN                           CSC011
     C                     MOVE SCHIN     PCHIN                           CSC011
     C                     MOVE SMARG     PMARG                           CSC011
     C*                                                                   CSC011
     C                     MOVE SNEGV     PNEGV                           CSC011
     C                     MOVE SRDFC     PRCFC                           CSC011
     C                     MOVE SWTIN     PWTIN                           CSC011
     C                     MOVE SWTRT     PWTRT                           CSC011
     C                     MOVE SIPFR     PINFQ                           CSC011
     C                     MOVE SIFDY     PINDY                           CSC011
     C                     MOVELSNIDT     PINDT                           CSC011
     C                     MOVE SREPT     PREPT                           CSC011
     C                     MOVE SRAMT     PRPAM                           CSC011
     C                     MOVE SRFRQ     PRPFQ                           CSC011
     C                     MOVE SRDYN     PRPDY                           CSC011
     C                     MOVELSNRPD     PRPDT                           CSC011
     C**********           MOVE SLIND     PLIND                                        CSC011 CER020
     C                     MOVE SLIND     PLOIC                                               CER020
     C                     MOVE SFRBC     PFRBC                           CSC011
     C                     MOVE SCRSK     PCRSK                           CSC011
     C                     MOVE SACOF     PACOF                           CSC011
     C                     MOVE SNACD     PNACD                           CSC011
     C                     MOVE SFEEI     PFEEI                           CSC011
     C                     MOVE SDOCI     PDOCI                           CSC011
     C                     MOVE SSECI     PSECI                           CSC011
     C                     MOVE SNAR1     PNAR1                           CSC011
     C                     MOVE SNAR2     PNAR2                           CSC011
     C                     MOVE SNAR3     PNAR3                           CSC011
     C                     MOVE SNAR4     PNAR4                           CSC011
     C                     MOVE SBMIN     PBMIN                           CSC011
     C                     MOVE SBCXR     PBCXR                           CSC011
     C                     MOVE SFMIN     PFMIN                           CSC011
     C                     MOVE SFCXR     PFCXR                           CSC011
     C                     MOVE SRECE     PRECE                           CSC011
     C                     MOVE SCOCU     PCOCU                           CSC011
     C*                                                                   CSC011
     C                     MOVE SRLFQ     PRLFQ                           CSC011
     C                     MOVE SRLDY     PRLDY                           CSC011
     C                     MOVELSRLDT     PRLDT                           CSC011
     C                     MOVE SBTIN     PBTIN                           CSC011
     C                     MOVE SBLDY     PBLDY                           CSC011
     C                     MOVE SRCSI     PRCSI                           CSC011
     C                     MOVE SCUST     PORGB                           CSC011
     C                     MOVE SMLNR     PORLN                           CSC011
     C                     MOVE SFRSP     PFRSP                           CSC011
     C                     MOVE SFSGN     PFSGN                           CSC011
     C                     MOVE SFPRC     PFPRC                           CSC011
     C                     MOVE SSPI1     PSPI1                           CSC011
     C                     MOVE SSPI2     PSPI2                           CSC011
     C                     MOVE SSPI3     PSPI3                           CSC011
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE SSTAL     N1STAL                                              CLE034
     C                     ENDIF                                                              CLE034
     C                     MOVE PMPSTM    PPSTM                           CSC011
     C                     MOVE PMPOBR    POSDB                           CSC011
     C                     MOVE PMPONS    PPONS                           CSC011
     C                     MOVE PARVNO    PRVNO                           CSC011
     C                     MOVE PMCVMR    PCVMR                           CSC011
     C                     MOVE PAPOCN    PPOCN                           CSC011
     C                     MOVE PAPOBN    PPOBN                           CSC011
     C                     MOVE PARCRN    PRCRN                           CSC011
     C                     MOVE PMRCRA    PRCRA                           CSC011
     C                     MOVE PAPIBN    PPIBN                           CSC011
     C                     MOVE PMPIBA    PPIBA                           CSC011
     C                     MOVE PAAWBN    PAWBN                           CSC011
     C                     MOVE PMAWBA    PAWBA                           CSC011
     C                     MOVE PABENN    PBENN                           CSC011
     C                     MOVE PMBENA    PBENA                           CSC011
     C                     MOVE PMRSTM    PRSTM                           CSC011
     C                     MOVE PMROBR    POMDB                           CSC011
     C*                                                                   CSC011
     C                     MOVE PMRONS    PRONS                           CSC011
     C                     MOVE PAROCN    PROCN                           CSC011
     C                     MOVE PAROBN    PROBN                           CSC011
     C                     MOVE PARIBN    PRIBN                           CSC011
     C                     MOVE PMRIBA    PRIBA                           CSC011
     C                     MOVE PMDTP1    PDTP1                           CSC011
     C                     MOVE PMDTP2    PDTP2                           CSC011
     C                     MOVE PMDTP3    PDTP3                           CSC011
     C                     MOVE PMDTP4    PDTP4                           CSC011
     C                     MOVE SLNKS     PLNKS                           CSC011
     C                     MOVE SASSN     PGASS                           CSC011
     C                     MOVE SDFTP     PDFTP                           CSC011
     C                     MOVE SDFST     PDFST                           CSC011
     C                     MOVE SMCRA     PMCRA                           CSC011
     C                     MOVE SFCRA     PFCRA                           CSC011
     C                     MOVE SPDDI     PPDDI                           CSC011
     C                     MOVE SPTDI     PPTDI                           CSC011
     C                     MOVE SGDPR     PGDPR                           CSC011
     C                     MOVE SGDIN     PGDIN                           CSC011
     C                     MOVE TOLN      PTOLN                           CSC011
     C                     MOVE IUSR      PIUSR                           CSC011
     C                     MOVE AUSR      PAUSR                           CSC011
     C                     MOVE XUSR      PXUSR                           CSC011
     C                     MOVE PCOBL     PPCOB                           CSC011
     C                     MOVE PMRSCY    PSCCY                           CSC011
     C                     MOVE PMIC72    PICCY                           CSC011
     C                     MOVE SRFDY     PRFDY                           CSC011
     C*                                                                   CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     ENDSR                                          CSC011
      *                                                                   CSC011
      /EJECT                                                              CSC011
      *****************************************************************   CSC011
      *  APLGTR  -  Write facility transaction to the 24X7 Midas      *   CSC011
      *             availability Log File                             *   CSC011
      *  Called by: SRINSR, SRUPDR, SRBERR                            *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           APLGTR    BEGSR                                          CSC011
      *                                                                   CSC011
     C                     MOVELPINPP     APTRAN                          CSC011
     C                     MOVE TSTISO    APSTMS                          CSC011
     C                     MOVEL'LE'      W#MSGT  6                       CSC011
     C                     MOVE PMTYP     W#MSGT                          CSC011
     C                     MOVELW#MSGT    APMTYP                          CSC011
     C                     MOVE '  '      APMTYP                          CSC011
      *                                                                   CSC011
     C           PCRFL     IFEQ *BLANKS                                   CSC011
     C                     MOVELPTREF     APSOFC                          CSC011
     C                     ELSE                                           CSC011
     C                     MOVELPCRFL     APSOFC                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
      ** If timestamp field is blank, then call ZAGENTS to set it up      CSC011
      *                                                                   CSC011
     C           APSTMS    IFEQ *BLANKS                                   CSC011
     C                     CALL 'ZAGENTS'                                 CSC011
     C                     PARM ZATMST    ZATMST 26                       CSC011
     C                     MOVE ZATMST    APSTMS                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C           LOGVAL    IFEQ 'V'                                       CSC011
     C                     OPEN APVLOGPD                                  CSC011
     C                     WRITEAPVLOGD0                                  CSC011
     C                     CLOSEAPVLOGPD                                  CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C           LOGVAL    IFEQ 'I'                                       CSC011
     C                     OPEN APILOGPD                                  CSC011
     C                     WRITEAPILOGD0                                  CSC011
     C                     CLOSEAPILOGPD                                  CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     ENDSR                                          CSC011
      *                                                                   CSC011
      /EJECT                                                              CSC011
      *****************************************************************   CSC011
      *  LOGDEL  -  Delete record from 24x7 Midas availability log    *   CSC011
      *             file                                              *   CSC011
      *  Called by: SRWRIT, SRUPDR                                    *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           LOGDEL    BEGSR                                          CSC011
      *                                                                   CSC011
     C                     MOVEL'LE'      W#MSGT                          CSC011
     C                     MOVE PMTYP     W#MSGT                          CSC011
     C                     MOVELW#MSGT    KMTYPE                          CSC011
     C                     MOVE '  '      KMTYPE                          CSC011
     C                     MOVELSTNRF     KFOID                           CSC011
     C                     MOVE STMST     KTSTMP                          CSC011
      *                                                                   CSC011
     C                     OPEN APILOGL0                                  CSC011
     C           KAPLOG    CHAINAPILOGX0             99                   CSC011
     C           *IN99     IFEQ *OFF                                      CSC011
     C                     DELETAPILOGX0                                  CSC011
     C                     ENDIF                                          CSC011
     C                     CLOSEAPILOGL0                                  CSC011
      *                                                                   CSC011
     C                     ENDSR                                          CSC011
      *                                                                   CSC011
      /EJECT                                                              CSC011
     C/COPY WNCPYSRC,LEH00517
      /TITLE Set EIR Indicators                                                               CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  SEIRI1 - Set EIR Indicators to re-calculate.                 *                       CAS009
      *                                                               *                       CAS009
      *  Called By: SRLONL                                            *                       CAS009
      *  Calls:                                                       *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
      *                                                                                       CAS009
     C           SEIRI1    BEGSR                                                              CAS009
      *                                                                                       CAS009
     C                     MOVE *IN81     SVIN81  1                                           CAS009
      *                                                                                       CAS009
     C           WTRAN     CHAINLEEIRDD5             81                                       CAS009
      *                                                                                       CAS009
     C           *IN81     IFEQ '0'                                                           CAS009
     C           WVALD     ANDLEEIENDT                                                        CAS009
      *                                                                                       CAS009
     C                     MOVE 'Y'       EIRCAL                                              CAS009
      *                                                                                       CAS009
     C           WDELR     IFEQ 'Y'                                                           CAS009
     C           WADJP     OREQ 'Y'                                                           CAS009
     C                     MOVE 'Y'       EIADJP                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     UPDATLEEIRDD5                                                      CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     MOVE SVIN81    *IN81                                               CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      /EJECT                                                                                  CAS009
      *****************************************************************
      * CONVCA  -  Covert the loan amount to Credit Agreement Amount  *                       194864
      * Called by: SRVAL1 - First screen input validation             *                       194864
      * Calls    : None                                               *                       194864
      *****************************************************************                       194864
     C           CONVCA    BEGSR                                                              194864
      ** Get the no. of dec. pos. of the facility ccy                                         194864
     C                     MOVE FCCYF     PCURR                                               194864
     C                     CALL 'AOCURRR0'PPAR5                                               194864
     C                     Z-ADDA6NBDP    WTRDP   10                                          194864
      ** Get the correct decimal position.                                                    194864
     C           WTRDP     SUB  WCDPL     CX      10                                          194864
     C                     ADD  4         CX                                                  194864
      ** If Amend, use the Facility Exchange Rate from the                                    194864
      ** Loan file.                                                                           194864
     C           SACTN     IFNE 'I'                                                           194864
     C           SACTN     IFNE 'R'                                                           194864
     C           FMDI      IFEQ 'D'                                                           194864
     C           FCXR      DIV  POWER,CX  SPRT1                                               194864
     C           1         DIV  SPRT1     SPRT1                                               194864
     C                     ELSE                                                               194864
     C           FCXR      MULT POWER,CX  SPRT1                                               194864
     C                     ENDIF                                                              194864
      ** Convert principal amount to facility ccy equivalent                                  194864
     C           WSVAM     MULT SPRT1     TRAMT  130H                                         194864
     C                     ENDIF                                                              194864
     C                     ELSE                                                               194864
      ** If Insert, use the calculated spot rate WSVFX                                        194864
     C           WFMIN     IFEQ 'D'                                                           194864
     C           WSVFX     DIV  POWER,CX  SPRT1                                               194864
     C           1         DIV  SPRT1     SPRT1                                               194864
     C                     ELSE                                                               194864
     C           WSVFX     MULT POWER,CX  SPRT1                                               194864
     C                     ENDIF                                                              194864
     C           WSVAM     MULT SPRT1     TRAMT                                               194864
     C                     ENDIF                                                              194864
      ** Get the CA ccy no. of decimal place                                                  194864
     C                     MOVE FCCYB     PCURR                                               194864
     C                     CALL 'AOCURRR0'PPAR5                                               194864
     C                     Z-ADDA6NBDP    WCADP   10                                          194864
      ** Get the correct decimal position.                                                    194864
     C           WCADP     SUB  WTRDP     CX      10                                          194864
     C                     ADD  4         CX                                                  194864
     C           CMDI      IFEQ 'D'                                                           194864
     C           CAXR      DIV  POWER,CX  SPRT1  138H                                         194864
     C           1         DIV  SPRT1     SPRT1                                               194864
     C                     ELSE                                                               194864
     C           CAXR      MULT POWER,CX  SPRT1                                               194864
     C                     ENDIF                                                              194864
      ** Convert the loan amount to Credit Agreement ccy                                      194864
      ** equivalent.                                                                          194864
     C           TRAMT     MULT SPRT1     INCAMT 130H                                         194864
     C                     ENDSR                                                              194864
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *  SRCHCK  - Check if Watch List Checking Engine Program needs  *                       CSD015
      *            to be called                                       *                       CSD015
      *                                                               *                       CSD015
      *  Called by: SRINSR, SRUPDR                                    *                       CSD015
      *  Calls    : None                                              *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRCHCK    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Initialization                                                                       CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       W3UNCF                                              CSD015
     C                     MOVE 'N'       WRONSX  1                                           CSD015
     C                     MOVE 'N'       WRIBNX  1                                           CSD015
     C                     MOVE 'N'       WROBNX  1                                           CSD015
     C                     MOVE 'N'       WROCNX  1                                           CSD015
     C                     MOVE 'N'       WPONSX  1                                           CSD015
     C                     MOVE 'N'       WPIBNX  1                                           CSD015
     C                     MOVE 'N'       WPOBNX  1                                           CSD015
     C                     MOVE 'N'       WPOCNX  1                                           CSD015
     C                     MOVE 'N'       WRCRNX  1                                           CSD015
     C                     MOVE 'N'       WRVNOX  1                                           CSD015
     C                     MOVE 'N'       WAWBNX  1                                           CSD015
     C                     MOVE 'N'       WBENNX  1                                           CSD015
     C                     MOVE 'N'       WDTPXX  1                                           CSD015
      *                                                                                       CSD015
     C           SACTN     IFEQ 'A'                                                           CSD015
     C                     MOVEL'CLOANCL' K3FUNT                                              CSD015
     C                     MOVELLNRF      K3IDEN                                              CSD015
     C                     MOVELBRCA      K3BRCH                                              CSD015
     C                     MOVE *IN89     WIND89                                              CSD015
     C           KCWHT     CHAINSDCWHTL1             89                                       CSD015
     C                     MOVE WIND89    *IN89                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receipt Nostro                                                                       CSD015
      *                                                                                       CSD015
     C           PMRONS    IFNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PMRONS    ORNE RONS                                                          CSD015
     C                     MOVE 'Y'       WRONSX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receipt Intermediary Bank + Account Line                                             CSD015
      *                                                                                       CSD015
     C           PARIBN    IFNE *BLANKS                                                       CSD015
     C           PMRIBA    ORNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PARIBN    ORNE RIBN                                                          CSD015
     C           PARIBN    ANDNE*BLANKS                                                       CSD015
     C           PMRIBA    ORNE RIBA                                                          CSD015
     C           PMRIBA    ANDNE*BLANKS                                                       CSD015
     C                     MOVE 'Y'       WRIBNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receipt Ordering Bank                                                                CSD015
      *                                                                                       CSD015
     C           PAROBN    IFNE *BLANKS                                                       CSD015
     C                     MOVELROBN      WAROBN  6                                           CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PAROBN    ORNE WAROBN                                                        CSD015
     C                     MOVE 'Y'       WROBNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receipt Ordering Customer                                                            CSD015
      *                                                                                       CSD015
     C           PAROCN    IFNE *BLANKS                                                       CSD015
     C                     MOVELROCN      WAROCN  6                                           CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PAROCN    ORNE WAROCN                                                        CSD015
     C                     MOVE 'Y'       WROCNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay Nostro                                                                           CSD015
      *                                                                                       CSD015
     C           PMPONS    IFNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PMPONS    ORNE PONS                                                          CSD015
     C                     MOVE 'Y'       WPONSX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay Intermediary Bank + Account Line                                                 CSD015
      *                                                                                       CSD015
     C           PAPIBN    IFNE *BLANKS                                                       CSD015
     C           PMPIBA    ORNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PAPIBN    ORNE PIBN                                                          CSD015
     C           PAPIBN    ANDNE*BLANKS                                                       CSD015
     C           PMPIBA    ORNE PIBA                                                          CSD015
     C           PMPIBA    ANDNE*BLANKS                                                       CSD015
     C                     MOVE 'Y'       WPIBNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay Ordering Bank                                                                    CSD015
      *                                                                                       CSD015
     C           PAPOBN    IFNE *BLANKS                                                       CSD015
     C                     MOVELPOBN      WAPOBN  6                                           CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PAPOBN    ORNE WAPOBN                                                        CSD015
     C                     MOVE 'Y'       WPOBNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay Ordering Customer                                                                CSD015
      *                                                                                       CSD015
     C           PAPOCN    IFNE *BLANKS                                                       CSD015
     C                     MOVELPOCN      WAPOCN  6                                           CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PAPOCN    ORNE WAPOCN                                                        CSD015
     C                     MOVE 'Y'       WPOCNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver Correspondent + Account Line                                                CSD015
      *                                                                                       CSD015
     C           PARCRN    IFNE *BLANKS                                                       CSD015
     C           PMRCRA    ORNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PARCRN    ORNE RCRN                                                          CSD015
     C           PARCRN    ANDNE*BLANKS                                                       CSD015
     C           PMRCRA    ORNE RCRA                                                          CSD015
     C           PMRCRA    ANDNE*BLANKS                                                       CSD015
     C                     MOVE 'Y'       WRCRNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver                                                                             CSD015
      *                                                                                       CSD015
     C           PARVNO    IFNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PARVNO    ORNE RVNO                                                          CSD015
     C                     MOVE 'Y'       WRVNOX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Account with Bank + Account Line                                                     CSD015
      *                                                                                       CSD015
     C           PAAWBN    IFNE *BLANKS                                                       CSD015
     C           PMAWBA    ORNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PAAWBN    ORNE AWBN                                                          CSD015
     C           PAAWBN    ANDNE*BLANKS                                                       CSD015
     C           PMAWBA    ORNE AWBA                                                          CSD015
     C           PMAWBA    ANDNE*BLANKS                                                       CSD015
     C                     MOVE 'Y'       WAWBNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              OSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Beneficiary + Account Line                                                           CSD015
      *                                                                                       CSD015
     C           PABENN    IFNE *BLANKS                                                       CSD015
     C           PMBENA    ORNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PABENN    ORNE BENN                                                          CSD015
     C           PABENN    ANDNE*BLANKS                                                       CSD015
     C           PMBENA    ORNE BENA                                                          CSD015
     C           PMBENA    ANDNE*BLANKS                                                       CSD015
     C                     MOVE 'Y'       WBENNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Details of Payment                                                                   CSD015
      *                                                                                       CSD015
     C           PMDTP1    IFNE *BLANKS                                                       CSD015
     C           PMDTP2    ORNE *BLANKS                                                       CSD015
     C           PMDTP3    ORNE *BLANKS                                                       CSD015
     C           PMDTP4    ORNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PMDTP1    ORNE DTP1                                                          CSD015
     C           PMDTP1    ANDNE*BLANKS                                                       CSD015
     C           PMDTP2    ORNE DTP2                                                          CSD015
     C           PMDTP2    ANDNE*BLANKS                                                       CSD015
     C           PMDTP3    ORNE DTP3                                                          CSD015
     C           PMDTP3    ANDNE*BLANKS                                                       CSD015
     C           PMDTP4    ORNE DTP4                                                          CSD015
     C           PMDTP4    ANDNE*BLANKS                                                       CSD015
     C                     MOVE 'Y'       WDTPXX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *  SRWTCH  - Set-up parameter for Compliance Engine program.    *                       CSD015
      *            Send transaction details to Compliance Watch by    *                       CSD015
      *            calling the Dummy program for OPM that will call   *                       CSD015
      *            the watch list engine.                             *                       CSD015
      *                                                               *                       CSD015
      *  Called by: SRINSR, SRUPDR                                    *                       CSD015
      *  Calls    : SRFRMT, SDWLCLOP                                  *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Set-up parameter for Compliance Engine Program                                       CSD015
      *                                                                                       CSD015
      ** 1st Parameter                                                                        CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   W4IDEN                                              CSD015
     C                     MOVE *BLANKS   W4ITEM                                              CSD015
     C                     MOVE *BLANKS   W4BRCH                                              CSD015
     C                     MOVE *BLANKS   W4SYSM                                              CSD015
     C                     MOVE *BLANKS   W4FUNT                                              CSD015
     C                     MOVE *BLANKS   W4CNUM                                              CSD015
     C                     MOVE *BLANKS   W4CTYP                                              CSD015
     C                     MOVE *BLANKS   W4CUST                                              CSD015
     C                     Z-ADD*ZERO     W4DDAT                                              CSD015
     C                     Z-ADD*ZERO     W4VDAT                                              CSD015
     C                     Z-ADD*ZERO     W4MDAT                                              CSD015
     C                     MOVE *BLANKS   W4DEN1                                              CSD015
     C                     MOVE *BLANKS   W4DEN2                                              CSD015
     C                     Z-ADD*ZERO     W4AMT1                                              CSD015
     C                     Z-ADD*ZERO     W4AMT2                                              CSD015
      *                                                                                       CSD015
      ** Identifier                                                                           CSD015
      *                                                                                       CSD015
     C                     MOVELLNRF      W4IDEN                                              CSD015
      *                                                                                       CSD015
      ** If generated by Principal Transfer, Item Type Code is 'LEPTFR'.                      CSD015
      ** Otherwise, LE + PTYP.                                                                CSD015
      *                                                                                       CSD015
     C           PTYPE     IFEQ 'PTFT'                                                        CSD015
     C           GPRT      ANDEQ'Y'                                                           CSD015
     C                     MOVE 'LEPTFR'  W4ITEM                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELPTYP      WWPTYP  2                                           CSD015
     C           'LE'      CAT  WWPTYP:0  W4ITEM                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Branch                                                                               CSD015
      *                                                                                       CSD015
     C                     MOVELBRCA      W4BRCH                                              CSD015
      *                                                                                       CSD015
      ** System                                                                               CSD015
      *                                                                                       CSD015
     C                     MOVELLIBR      W4SYSM                                              CSD015
      *                                                                                       CSD015
      ** Function Type                                                                        CSD015
      *                                                                                       CSD015
     C                     MOVEL'CLOANCL' W4FUNT                                              CSD015
      *                                                                                       CSD015
      ** Counter Party Number                                                                 CSD015
      *                                                                                       CSD015
     C                     MOVELCNUM      W4CNUM                                              CSD015
      *                                                                                       CSD015
     C                     MOVELCNUM      PCUST                                               CSD015
     C                     CALL 'AOCUSTR0'PPAR3                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SDCUSTPD'DBFILE                                              CSD015
     C                     Z-ADD60        DBASE                                               CSD015
     C                     MOVELPCUST     DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Counterparty Type                                                                    CSD015
      *                                                                                       CSD015
      *                                                                                       CSD015
      ** If Concord Interface Development is installed                                        CSD015
      **    If Corporate Customer is 'Y', set Counterparty Type to 'C'                        CSD015
      **    Else, Counterparty Type to 'I'                                                    CSD015
      *                                                                                       CSD015
     C           CCF001    IFEQ 'Y'                                                           CSD015
     C           BBCRPC    IFEQ 'Y'                                                           CSD015
     C                     MOVE 'C'       W4CTYP                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
      ** ELSE,                                                                                CSD015
      **    If Local Industry Code is not blank and it is not equal to a                      CSD015
      **    any of the five Private Customer Industry Code, set CounterParty                  CSD015
      **    Type to 'C'                                                                       CSD015
      **     Else, set Counterparty Type to 'I'.                                              CSD015
      *                                                                                       CSD015
     C           BBLICD    IFNE *BLANKS                                                       CSD015
     C           BBLICD    ANDNEW1IND1                                                        CSD015
     C           BBLICD    ANDNEW1IND2                                                        CSD015
     C           BBLICD    ANDNEW1IND3                                                        CSD015
     C           BBLICD    ANDNEW1IND4                                                        CSD015
     C           BBLICD    ANDNEW1IND5                                                        CSD015
     C                     MOVE 'C'       W4CTYP                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Counter Party Name                                                                   CSD015
      *                                                                                       CSD015
     C           BBCRNM    CAT  BBCRTN    W4CUST                                              CSD015
      *                                                                                       CSD015
      ** Deal Date                                                                            CSD015
      *                                                                                       CSD015
     C                     Z-ADDDDAT      W4DDAT                                              CSD015
      *                                                                                       CSD015
      ** Value Date                                                                           CSD015
      *                                                                                       CSD015
     C                     Z-ADDVDAT      W4VDAT                                              CSD015
      *                                                                                       CSD015
      ** Maturity Date                                                                        CSD015
      *                                                                                       CSD015
     C                     Z-ADDMDAT      W4MDAT                                              CSD015
      *                                                                                       CSD015
      ** Denomination Side 1                                                                  CSD015
      *                                                                                       CSD015
     C                     MOVELCCY       W4DEN1                                              CSD015
      *                                                                                       CSD015
      ** Denomination Side 2                                                                  CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   W4DEN2                                              CSD015
      *                                                                                       CSD015
      ** Amount Side 1                                                                        CSD015
      *                                                                                       CSD015
     C                     Z-ADDCPAM      W4AMT1                                              CSD015
      *                                                                                       CSD015
      ** Amount Side 2                                                                        CSD015
      *                                                                                       CSD015
     C                     Z-ADD0         W4AMT2                                              CSD015
      *                                                                                       CSD015
      ** 2nd Parameter                                                                        CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PXML                                                CSD015
      *                                                                                       CSD015
      ** Receipt Nostro                                                                       CSD015
      *                                                                                       CSD015
     C           WRONSX    IFEQ 'Y'                                                           CSD015
     C                     MOVELRONS      PINP1                                               CSD015
     C           SCCY      IFNE *BLANKS                                                       CSD015
     C                     MOVELSCCY      PCCY                                                CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELCCY       PCCY                                                CSD015
     C                     ENDIF                                                              CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,1:0 PXML                                                CSD015
     C           PXML      CAT  POUT1:0   PXML                                                CSD015
     C           PXML      CAT  CLTAG,1:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receipt Intermediary Bank + Account Line                                             CSD015
      *                                                                                       CSD015
     C           WRIBNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELRIBN      PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,2:0 PXML                                                CSD015
     C           PXML      CAT  POUT1:0   PXML                                                CSD015
     C           PXML      CAT  RIBA:0    PXML                                                CSD015
     C           PXML      CAT  CLTAG,2:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receipt Ordering Bank                                                                CSD015
      *                                                                                       CSD015
     C           WROBNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELROBN      PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,3:0 PXML                                                CSD015
     C           PXML      CAT  POUT1:0   PXML                                                CSD015
     C           PXML      CAT  CLTAG,3:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receipt Ordering Customer                                                            CSD015
      *                                                                                       CSD015
     C           WROCNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELROCN      PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,4:0 PXML                                                CSD015
     C           PXML      CAT  POUT1:0   PXML                                                CSD015
     C           PXML      CAT  CLTAG,4:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay Nostro                                                                           CSD015
      *                                                                                       CSD015
     C           WPONSX    IFEQ 'Y'                                                           CSD015
     C                     MOVELPONS      PINP1                                               CSD015
     C                     MOVELCCY       PCCY                                                CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,5:0 PXML                                                CSD015
     C           PXML      CAT  POUT1:0   PXML                                                CSD015
     C           PXML      CAT  CLTAG,5:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay Intermediary Bank + Account Line                                                 CSD015
      *                                                                                       CSD015
     C           WPIBNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELPIBN      PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,6:0 PXML                                                CSD015
     C           PXML      CAT  POUT1:0   PXML                                                CSD015
     C           PXML      CAT  PIBA:0    PXML                                                CSD015
     C           PXML      CAT  CLTAG,6:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay Ordering Bank                                                                    CSD015
      *                                                                                       CSD015
     C           WPOBNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELPOBN      PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,7:0 PXML                                                CSD015
     C           PXML      CAT  POUT1:0   PXML                                                CSD015
     C           PXML      CAT  CLTAG,7:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay Ordering Customer                                                                CSD015
      *                                                                                       CSD015
     C           WPOCNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELPOCN      PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,8:0 PXML                                                CSD015
     C           PXML      CAT  POUT1:0   PXML                                                CSD015
     C           PXML      CAT  CLTAG,8:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver Correspondent + Account Line                                                CSD015
      *                                                                                       CSD015
     C           WRCRNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELRCRN      PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,9:0 PXML                                                CSD015
     C           PXML      CAT  POUT1:0   PXML                                                CSD015
     C           PXML      CAT  RCRA:0    PXML                                                CSD015
     C           PXML      CAT  CLTAG,9:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver                                                                             CSD015
      *                                                                                       CSD015
     C           WRVNOX    IFEQ 'Y'                                                           CSD015
     C                     MOVELRVNO      PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,10:0PXML                                                CSD015
     C           PXML      CAT  POUT1:0   PXML                                                CSD015
     C           PXML      CAT  CLTAG,10:0PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Account with Bank + Account Line                                                     CSD015
      *                                                                                       CSD015
     C           WAWBNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELAWBN      PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,11:0PXML                                                CSD015
     C           PXML      CAT  POUT1:0   PXML                                                CSD015
     C           PXML      CAT  AWBA:0    PXML                                                CSD015
     C           PXML      CAT  CLTAG,11:0PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Beneficiary + Account Line                                                           CSD015
      *                                                                                       CSD015
     C           WBENNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELBENN      PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,12:0PXML                                                CSD015
     C           PXML      CAT  POUT1:0   PXML                                                CSD015
     C           PXML      CAT  BENA:0    PXML                                                CSD015
     C           PXML      CAT  CLTAG,12:0PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Details of Payment                                                                   CSD015
      *                                                                                       CSD015
     C           WDTPXX    IFEQ 'Y'                                                           CSD015
     C           PXML      CAT  OPTAG,13:0PXML                                                CSD015
     C           PXML      CAT  DTP1:0    PXML                                                CSD015
     C           PXML      CAT  DTP2:1    PXML                                                CSD015
     C           PXML      CAT  DTP3:1    PXML                                                CSD015
     C           PXML      CAT  DTP4:1    PXML                                                CSD015
     C           PXML      CAT  CLTAG,13:0PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Send Transaction Details to Compliance Watch by Calling the                          CSD015
      ** Dummy program that will call the watch list enqine.                                  CSD015
      *                                                                                       CSD015
     C                     CALL 'SDWLCLOP'                                                    CSD015
     C                     PARM           PSDWLT                                              CSD015
     C                     PARM           PXML                                                CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *  SRFRMT  - Convert Settlement Details to Customer Name and    *                       CSD015
      *            Address                                            *                       CSD015
      *                                                               *                       CSD015
      *  Called by: SRWTCH                                            *                       CSD015
      *  Calls    : SDCWLFMT                                          *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRFRMT    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
      *                                                                                       CSD015
     C                     CALL 'SDCWLFMT'                                                    CSD015
     C                     PARM           PRTCD   7                                           CSD015
     C                     PARM           PINP1  35                                           CSD015
     C                     PARM           PINP2  35                                           CSD015
     C                     PARM           PINP3  35                                           CSD015
     C                     PARM           PINP4  35                                           CSD015
     C                     PARM           PINP5  35                                           CSD015
     C                     PARM           PINP6  35                                           CSD015
     C                     PARM           PCCY    3                                           CSD015
     C                     PARM           POUT1 216                                           CSD015
     C                     PARM           POUT2   6                                           CSD015
      *                                                                                       CSD015
      ** Initialize to blanks the input parameters.                                           CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PINP1                                               CSD015
     C                     MOVE *BLANKS   PINP2                                               CSD015
     C                     MOVE *BLANKS   PINP3                                               CSD015
     C                     MOVE *BLANKS   PINP4                                               CSD015
     C                     MOVE *BLANKS   PINP5                                               CSD015
     C                     MOVE *BLANKS   PINP6                                               CSD015
     C                     MOVE *BLANKS   PCCY                                                CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *****************************************************************
     C           *PSSR     BEGSR
      *
     C           PMODE     IFNE 'B'                                       120121
     C                     ROLBK
     C                     ENDIF                                          120121
      *
     C                     MOVE '1'       *INU7                           120121
     C                     MOVE '1'       *INU8                           120121
      *                                                                   120121
     C           @RUN      IFEQ *BLANK
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           PMODE     OREQ 'F'                                       CAP053
     C                     CALL 'DBERRCTL'
     C                     ENDIF
     C                     ENDIF
      *
     C           PMODE     IFEQ 'B'
     C           PMODE     OREQ 'P'
     C                     MOVE 'D'       PRMSV
     C                     MOVEL'LEL0035 'ZAMSID
     C           PRTCD     IFEQ '*RECLCK'                                                   AR868380
     C                     MOVEL'LEL0817 'ZAMSID                                            AR868380
     C                     ENDIF                                                            AR868380
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     RETRN
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
     C/COPY ZSRSRC,GLINTCZ1
      /EJECT
     C/COPY ZSRSRC,ZACCH
      /EJECT
     C/COPY ZSRSRC,ZCPDZ2
      /EJECT
     C/COPY ZSRSRC,ZCHKH
      /EJECT
     C/COPY ZSRSRC,ZCONVZ1
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE9Z3
      /EJECT
     C/COPY ZSRSRC,ZDAT10Z2
      /EJECT
     C/COPY ZSRSRC,ZEDITZ2
      /EJECT
     C/COPY ZSRSRC,ZF2C
      /EJECT
     C/COPY ZSRSRC,ZFREQBZ2
      /EJECT
     C/COPY ZSRSRC,ZFRPEDZ3
      /EJECT
     C/COPY ZSRSRC,ZINTDYZ2
      /EJECT
     C/COPY ZSRSRC,ZTNLU1Z2
      /EJECT
     C/COPY ZSRSRC,ZXRATEZ1
      /EJECT
     C/COPY ZSRSRC,ZFWDT                                                  CLE009
      /EJECT                                                                                  217847
     C/COPY ZSRSRC,ZBKDT                                                                      217847
     C/COPY WNCPYSRC,LE2030C019
      /EJECT                                                              CLE009
      *
      ** Update LTRIX header record
      *
     O*LTRIX**** E                TRXHDR                                                    AR322732
     O**********               NORED     11P                                                AR322732
     O**********               RRNAD     20P                                                AR322732
     O**********               NLNRD     29P                                                AR322732
     O**********               NATN      40P                                                AR322732
      *
      ** Update LTRIX detail record
      *
     O********E*               TRXDTL                                                       AR322732
     OLTRIX   EADD             TRXDTL                                                       AR322732
     O                                    2 'DL'
     O                         SLNRF      8
     O                         VDATD     13
     O                                   16 '000'
     O                         SACTN     17
     O                         CNRQD     18
     O                                   19 'N'
     O                                   20 ' '
     O                                   25 '00001'
     O                                   26 'N'
     O                         PRI1D     27
     O                         SBRCA     34
     O**********               RRNAD     37P                                                AR322732
     O                         RRNTD     37P                                                AR322732
     O                         NATN      40P
     O                 01      PRI2D     41
     O                 01      PRI3D     42
     O                 01      PRI4D     43
     O                                   44 ' '                                             AR322732
     O                                   45 ' '                                             AR322732
      /EJECT
      *                                                                                       CLE028
      ** Elements of Array WDRPT amended to include 'F80'.                                    CLE028
      *                                                                                       CLE028
** CPY@  **      Copyright statement
(c) Misys International Banking Systems Ltd. 2001
** WNOST **      Table of settlements through nostros
0102070812
** WFREQ **      Table of frequency codes for interests and repayments
WFMTQXY
** WDRPT **      Table of Facility's Drawing Types and Loan Processing Types
C61
C68
C69
T62
T64
T66
D63
D65
D67
R70
R71
R72
F80                                                                                           CLE028
** STAMP - Dummy timestamp                                                                    CLE034
0001-01-01-00.00.00.000000                                                                    CLE034
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
** OPTAG - OPEN TAGS for XML                                                                  CSD015
<Receipt Nostro>                                                                              CSD015
<Receipt Intermed Bank>                                                                       CSD015
<Receipt Ordering Bank>                                                                       CSD015
<Receipt Ordering Cust>                                                                       CSD015
<Payment Nostro>                                                                              CSD015
<Payment Intermed Bank>                                                                       CSD015
<Payment Ordering Bank>                                                                       CSD015
<Payment Ordering Cust>                                                                       CSD015
<Receiver Correspondent>                                                                      CSD015
<Receiver>                                                                                    CSD015
<Account With Bank>                                                                           CSD015
<Beneficiary>                                                                                 CSD015
<Details Of Payment>                                                                          CSD015
** CLTAG - CLOSE TAGS for XML                                                                 CSD015
</Receipt Nostro>                                                                             CSD015
</Receipt Intermed Bank>                                                                      CSD015
</Receipt Ordering Bank>                                                                      CSD015
</Receipt Ordering Cust>                                                                      CSD015
</Payment Nostro>                                                                             CSD015
</Payment Intermed Bank>                                                                      CSD015
</Payment Ordering Bank>                                                                      CSD015
</Payment Ordering Cust>                                                                      CSD015
</Receiver Correspondent>                                                                     CSD015
</Receiver>                                                                                   CSD015
</Account With Bank>                                                                          CSD015
</Beneficiary>                                                                                CSD015
</Details Of Payment>                                                                         CSD015
** SVALTX - System Value Key text                                                             CLE148
LoanAlphaAllow                                                                                CLE148
