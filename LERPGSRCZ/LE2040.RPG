     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Loans amendment input')                       *
/*OVRF*: OVRDBF FILE(LOAMD) TOFILE(LOAMS) SHARE(*NO)                : *
/*OVR *: OVRDBF FILE(LEILAMLX) TOFILE(LEILAML2) SHARE(*NO)          : *
      *****************************************************************
      *                                                               *
      *  Midas - Customer Lending Module                              *
      *                                                               *
      *  LE2040 - Loan Amendments Input                               *
      *                                                               *
      *  Function:  This is a new program for Loan, Participation     *
      *             Purchased and Participation Sold.  This could be  *
      *             run in any of the five modes available, depending *
      *             on the parameter passed to it.                    *
      *               1. Interactive ('I') - called from the Midas    *
      *                    Transaction Input menu                     *
      *               2. Record ('R') - Run interactively but updates *
      *                    are done to a new 'test harness' file      *
      *               3. Play ('P') - Run interactively but data is   *
      *                    read from the 'test harness' file          *
      *               4. Batch ('B') - Run in batch and called by a   *
      *                    communications control program             *
      *               5. Fix/Repair ('F') - called from the Midas     *         CAP061
      *                    Transaction Input menu                     *         CAP061
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. CER050             Date 16Jun19               *
      *                 MD046248           Date 27Oct17               *
      *                 CLE141             Date 08Feb16               *
      *                 AR847588           Date 10Mar15               *
      *                 MD023787           Date 29Apr14               *
      *                 CSD095             Date 08Apr14               *
      *                 AR868380           Date 11Jun13               *
      *                 AR870590           Date 29Nov12               *
      *                 AR996895           Date 25Nov12               *
      *                 AR632104           Date 02Oct12               *
      *                 AR637996           Date 01Aug12               *
      *                 AR656363           Date 01Aug12               *
      *                 AR548031A          Date 01Aug12               *
      *                 AR548031           Date 01Aug12               *
      *                 AR400813           Date 01Aug12               *
      *                 AR314017           Date 01Aug12               *
      *                 262461A            Date 01Aug12               *
      *                 262461             Date 01Aug12               *
      *                 CLE134             Date 01Aug12               *
      *                 AR322732           Date 23Jul12               *
      *                 CLE148             Date 23Jul12               *
      *                 CRE073             Date 06Dec10               *
      *                 CLE143             Date 06Dec10               *
      *                 CLE139             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      *                 CER047             Date 19May08               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 256822             Date 30Sep08               *
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 BUG8900            Date 20Oct05               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 227712             Date 01Jun04               *
      *                 227710             Date 21May04               *
      *                 227165             Date 18May04               *
      *                 CLE038             Date 11May04               *
      *                 228214             Date 05Jul04               *
      *                 225605             Date 01Apr04               *
      *                 CLE036             Date 21Oct03               *
      *                 CIR013             Date 25Apr05               *
      *                 233545             Date 18May05               *
      *                 CAS011             Date 16May05               *
      *                 232348             Date 21Feb05               *
      *                 CAS009             Date 04May04               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 28Oct03               *
      *                 221926             Date 07Oct03               *
      *                 221924             Date 07Oct03               *
      *                 CAP075             Date 08Aug02               *
      *                 CAP074             Date 08Aug02               *
      *                 CAP073             Date 08Aug02               *
      *                 CDE005             Date 23Sep02
      *                 CLE029             Date 04Sep02               *
      *                 219140             Date 25Jun03               *
      *                 CLE034             Date 05May03               *
      *                 217459             Date 30Apr03               *
      *                 217232             Date 24Apr03               *
      *                 CLE033             Date 10Apr03               *
      *                 216067             Date 20Mar03               *
      *                 CLE031             Date 11Feb03               *
      *                 CSF002             Date 11Aug03               *
      *                 CAS005             Date 16Dec02               *
      *                 CSD015             Date 14Oct02               *
      *                 CLE028             Date 27Jun02               *
      *                 CAS004             Date 26Jun02               *
      *                 216466             Date 03Jun03               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 214893             Date 18Feb03               *
      *                 212297             Date 10Jan03               *
      *                 203291             Date 08Jan03               *
      *                 204211             Date 06Jan03               *
      *                 197348             Date 06Jan03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 203330             Date 10Oct02               *
      *                 210317             Date 18Sep02               *
      *                 208436             Date 08Nov02               *
      *                 207629             Date 23Aug02               *
      *                 204452             Date 03May02               *
      *                 201672             Date 29Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 01Jul02               *
      *                 CAP068             Date 25Jun02               *
      *                 203795             Date 19Mar02               *
      *                 201851             Date 11Jan01               *
      *                 CLE023             Date 19Nov01               *
      *                 202587             Date 22Feb02               *
      *                 CSC011             Date 12Feb02               *
      *                 202539             Date 31JAN02               *
      *                 200967             Date 18Feb01               *
      *                 185822             Date 29Aug01               *
      *                 186579             Date 28Nov00               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 197031             Date 24Aug01               *
      *                 CAP061             Date 31May01               *
      *                 186431             Date 19Jul01               *
      *                 180044             Date 19Jul01               *
      *                 CDE002             Date 04Apr00               *
      *                 CLE014             Date 20Mar01               *
      *                 193861             Date 30May01               *
      *                 186706             Date 09Mar01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 15May01               *
      *                 189911             Date 14Feb01               *
      *                 189827             Date 12Feb01               *
      *                 189826             Date 12Feb01               *
      *                 189825             Date 12Feb01               *
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CRT004             DATE 04MAY00               *
      *                 152931             Date 31Aug00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 175450             Date 09Mar00               *
      *                 CIR004             Date 20Jan00               *
      *                 CDE001             Date 12Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 172289             Date 29Dec99               *
      *                 169698             Date 02Dec99               *
      *                 169232             Date 11Nov99               *
      *                 163973             Date 12Jul99               *
      *                 CLE009             Date 25May99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 162602             Date 18Jun99               *
      *                 161350             Date 16Jun99               *
      *                 161036             Date 24May99               *
      *                 159256             Date 11May99               *
      *                 159690             Date 30Apr99               *
      *                 159095             Date 04May99               *
      *                 157303             Date 30Mar99               *
      *                 152678             Date 29Mar99               *
      *                 158207 (BT0428)    Date 14NOV97               *
      *                 158205 (BT0417)    Date 15NOV97               *
      *                 158203 (BT0495)    Date 31Dec97               *
      *                 158177 (BT0506)    Date 10Apr98               *
      *                 158200 (E44896)    Date 14Jan98               *
      *                 158198 (E45509)    Date 13MAY98               *
      *                 157056             Date 17Mar99               *
      *                 157547 (E45541)    Date 19Mar99               *
      *                 155931             Date 02Mar99               *
      *                 155106             Date 10Mar99               *
      *                 156036             Date 25Feb99               *
      *                 155570             Date 25Feb99               *
      *                 155610             Date 26Feb99               *
      *                 154799             Date 24Feb99               *
      *                 151295             Date 18Feb99               *
      *                 153663             Date 21Jan99               *
      *                 150799             Date 15Dec98               *
      *                 149500             Date 04Dec98               *
      *                 145631             Date 21Oct98               *
      *                 144096             Date 30Oct98               *
      *                 143802             Date 23Oct98               *
      *                 143789             Date 23Nov98               *
      *                 143772             Date 14Oct98               *
      *                 143071             Date 25Sep98               *
      *                 143004             Date 22Sep98               *
      *                 142588             Date 15Sep98               *
      *                 141464             Date 18Feb99               *
      *                 140817             Date 15Feb98               *
      *                 139308             Date 12Feb99               *
      *                 138866             Date 12Feb99               *
      *                 135349             Date 15Feb99               *
      *                 135152             Date 11Feb99               *
      *                 135148             Date 11Feb99               *
      *                 134799             Date 10Feb99               *
      *                 132947             Date 05Feb99               *
      *                 131253             Date 04Feb99               *
      *                 126379             Date 02Feb99               *
      *                 122461             Date 16Feb99               *
      *                 144915             Date 28Oct98               *
      *                 147281             Date 13Nov98               *
      *                 CEU020             Date 13Mar98               *
      *                 CEU004             Date 29MAR98               *
      *                 131971             Date 12Mar98               *
      *                 131209             Date 27Feb98               *
      *                 127996             Date 22Dec97               *
      *                 CLE005             Date 22May97               *
      *                 127289             Date 08DEC97               *
      *                 126903             Date 01Dec97               *
      *                 125186             Date 27Nov97 (Re-Open)     *
      *                 126383             Date 25NOV97               *
      *                 126309             Date 20NOV97               *
      *                 126274             Date 20NOV97               *
      *                 125972             Date 18NOV97               *
      *                 125186             Date 05NOV97               *
      *                 123857             Date 05NOV97 (Re-Open)     *
      *                 123857             Date 03NOV97 (Re-Open)     *
      *                 123857             Date 24OCT97               *
      *                 124740             Date 23Oct97               *
      *                 123699             Date 21Oct97               *
      *                 122685             Date 10Oct97               *
      *                 123998             Date 07Oct97               *
      *                 123801             Date 06Oct97               *
      *                 123789             Date 03Oct97               *
      *                 123227             Date 19Sep97               *
      *                 123177             Date 19Sep97               *
      *                 123055             Date 16Sep97               *
      *                 123018             Date 15Sep97               *
      *                 122960             Date 15Sep97               *
      *                 122889             Date 11Sep97               *
      *                 122141             Date 26AUG97               *
      *                 122109             Date 26AUG97               *
      *                 121783             Date 14AUG97               *
      *                 121840             Date 14AUG97               *
      *                 121061             Date 17JUL97               *
      *                 120023             Date 10JUL97               *
      *                 120468             Date 09JUL97               *
      *                 120002             Date 07JUL97               *
      *                 119594             Date 20JUN97               *
      *                 115570             Date 17Mar97               *
      *                 115208             DATE 07Mar97               *
      *                 115134             DATE 26Feb97               *
      *                 CLE003             Date 14May96               *
      *                 CLE004 *Create     Date 02Dec96               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE141 - Currency and Location Business Day Convention       *
      *           (Recompile)                                         *
      *  AR847588 - Enable system to accept negative spread rate.     *
      *           - Applied for MD033488                              *
      *  MD023787 - Add parameter on AOOULAU0.                        *
      *  CSD095 - Allow Deal Sub-Type and Branch for MM and FX SSIs   *
      *           (Recompile)                                         *
      *  AR868380 - APISERVER on LCKW status. Return *RECLCK to       *
      *             calling program if file locking occurred on       *
      *             online position files. (Child: AR868381)          *
      *  AR870590 - FOOB on LE0370AU due to trailer imbalance.        *
      *             For API, check file status of chain to LOAMSZ1    *
      *             and issue rollback when error occurred.           *
      *             (Child: AR870591)                                 *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  AR632104 - Autosettlement 'C' when subtype change is present.*
      *             Do not allow LS deletion in case of absence of    *
      *             PDCL details in the previous type/subtype of loan.*
      *             (Child: AR632105)                                 *
      *  AR637996 - LELAPI:  Problem reported under 2366 /M01666      *
      *             /438397 to be investigared by CORE                *
      *           - Continuation of AR548031. Redefine OURS and AKEY  *
      *             data structures to use the 10-digit account code. *
      *             (Child: AR637997)                                 *
      *  AR656363 - PDCL input cycle creation, negative facility amt  *
      *           - Do not update exposure for PI attached to PDCL    *
      *             fee or interest and facility utilisation No.      *
      *             (Child: AR656364)                                 *
      *  AR548031A - Reopen other data structures are not in synch    *
      *             (Child: AR548032)                                 *
      *  AR548031 - P2: CLE134 API: LELAPI wrong interpretation       *
      *             of A1PONS field (Child: AR548032)                 *
      *  AR400813 - Error processing LELAPI message. Our nostro       *
      *             (payment) invalid - see second leveltext (513:28) *
      *           - Error in settlement when processing Principal In- *
      *             crease. Ensure that correct settlement account    *
      *             will be processed for settlement type 14. Also    *
      *             ensure that PF/CLOAMSQD will be updated when pro- *
      *             cessing transactions inserted via API.            *
      *             (Child: AR400814)                                 *
      *  AR314017 - PONS/RONS warning if changed with LEACCNPD records*
      *             (Child: AR314018)                                 *
      *  262461A - (Reopen) - Error LER5573 should not be output if   *
      *           Loan type starts by X, Y or Z.                      *
      *  262461 - if auto-settle is 'C' chck that PDCL Loan type      *
      *           subtype is defined.                                 *
      *  CLE134 - Past Due Call Loan Processing                       *
      *         - Warning Msg for Original Loan Amendments            *
      *  AR322732 - LEC0212A and APISERVER locks LTRIX file.          *
      *           - Prevent LTRIX RRN 1 from being locked.            *
      *  CLE148 - Alpha Loan Reference                                *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CLE143 - Original Loan Contract Date & Effective Interest    *
      *           Rate (Recompile)                                    *
      *  CLE139 - Lending Fee Capitalisation (Recompile)              *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CER047 - German Features LF037-00 Reporting §24c             *
      *           (Recompile)                                         *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  256822 - Pass Loan Class as parameter to AOLOANR0.           *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  BUG8900 - Parameter size mismatch.                           *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  227712 - Use the sequence number of the loan amendment, not  *
      *           the sequence number of the trailer, 999, for calling*
      *           AOSTALU0 for deleting settlement allocations on     *
      *           reverse                                             *
      *  227710 - If F3 is pressed in the settlement programs, ensure *
      *           that all database changes are rolled back.          *
      *  227165 - Include 'LAPD' in the list of possible return types *
      *  CLE038 - Lending Enhancement for Nordea: Allocation by Amount*
      *  228214 - Only access participant facility if it is a         *
      *           participation                                       *
      *  225605 - When accessing the facility to check the last       *
      *           availability date should check the participants     *
      *           facility                                            *
      *  CLE036 - Lending Enhancements for Nordea Phase 1 Priority 2  *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *  233545 - Cut-off Date (Recompile)                            *
      *  CAS011 - EIR/AC Accounting Upgrade to MP1                    *
      *  232348 - Introduce cut-off date for non-linear amortisation  *
      *  CAS009 - Effective Interest Rate/Amortised Cost Accounting   *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter mismatch.                                 *
      *  221926 - Should only be able to enter Special Ins for PI.    *
      *  221924 - Should only be able to select Sett Alln for PI.     *
      *  CAP074 - Lending API enhancements - Loans input.             *
      *  CAP073 - Lending API enhancements - Facility Input           *
      *  CDE005 - Reservation ID                                      *
      *  CLE029 - Addition of Severity code and Limit ID to FCLTYFM   *
      *  219140 - U8 should be set off at beginning of program        *
      *           This is to make sure that the check on U8 is correct*
      *  CLE034 - Lending Enhancements.                               *
      *  217459 - GL account movement not written correctly on        *
      *           amendment of settlement instructions                *
      *  217232 - Loan amendments maintenance updates file if F3 is   *
      *           taken                                               *
      *  CLE033 - Settlement method 09                                *
      *  216067 - If batch mode do not cause d/b error when System    *
      *           Value LoanCustOriginPurch not present. Instead      *
      *           default to 'P' (purchased from customer)            *
      *  CLE031 - Lending Enhancements.                               *
      *  CSF002 - Global layer.                                       *
      *           - Replace previous ZBACT* parameters with the new   *
      *             unique code.                                      *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  CAS004 - Hedge Accounting Phase A (Recompile)                *
      *  216466 - No validation for currency when loan amendment      *
      *           value date is equal to rollover date.
      *  214893 - Warning message LEA1036 appears even if funding rate*
      *           is within tolerance allowed & can't be overridden   *
      *           during authorisation. If user presses F12 from the  *
      *           subfile, & then tries to authorise from the initial *
      *           screen, the wrong loan details are displayed.       *
      *  212297 - Funding spread/rate is not displayed if record was  *
      *           selected from the subfile.                          *
      *  203291 - Settlement details are taken from the loan. But for *
      *           Settlement Method 04, 'Our Account' field should be *
      *           blank. Only fill 'Our Account' if SDST is not 04.   *
      *  204211 - Settlement account wrongly set-up. Branch is blank. *
      *  197348 - Clear settlement details during insert mode.        *
      *  203330 - Error message is not being returned when in batch   *
      *           mode.                                               *
      *  210317 - Double assignment to new member corrupts syndicate  *
      *  208436 - Past Dues disappear from Subfile after enquiring on *
      *           a Spread Change, because TAMT is zero.              *
      *  207629 - Check System Value LoanCustOriginPurch to decide if *
      *           original borrower should be input as the customer of*
      *           a Part Purchased, instead of 'Purchased From' num.  *
      *  204452 - Recompiled due to changed PF/LEFEED.                *
      *  201672 - Calculate projected interest and principal on       *
      *           maturity.                                           *
      *  CPK015 - Release 4.01 Packaging:                             *
      *           - A default timestamp string is required for WRITE. *
      *  CAP068 - Recompiled for changes to FCLTYFM and FCLTYFN.      *
      *  203795 - Convert amount using the correct new facility exch  *
      *           rate if the rollover date is less than or equal     *
      *           the transactions's value date.                      *
      *           Also ensure that message format in sync with file   *
      *           layout.                                             *
      *  201851 - Current Amount Drawn of Credit Agreement is wrong   *
      *           when principal increase is reversed.                *
      *  CLE023 - Lending Facility History Improvements.              *
      *  202587 - Repair location needs to be checked - not mode.     *
      *           for this part of CAP061 processing.                 *
      *  CSC011 - 24x7 Midas Availability                             *
      *  202539 - Allow program dump if CAP061 not switched on.       *
      *  200967 - Newly inserted base rate code not accepted as input *
      *  185822 - Allow insert of loan sub-type change for risk loans.*
      *  186579 - Spread/rate is blank when tried to authorise a      *
      *           deal.  Thus, if rate is zeroised, ensure that SRTSP *
      *           screen field would have a zero value instead of     *
      *           blank.                                              *
      *  197031 - 'F10=Delete' should be displayed in loan amendment  *
      *            maintenance screen. Fix is to condition SACTN and  *
      *            AMTP to be 'R' and ''PI' respectively before       *
      *            executing fixes done by 186706 to allow the newly  *
      *            introduced function done for 180044.               *
      *  CAP061 - Lending API enhancements - Loans Amendment          *
      *  186431 - Added processing to handle LTRIX record locks.      *
      *  180044 - Allow reversal of past due records in the Loan      *
      *           Amendments Maintenance menu.                        *
      *  CDE002 - Revenue Analysis                                    *
      *  CLE014 - Customer Driven Lending Enhancements                *
      *  193861 - Amendment of the amount of a Principal Transfer     *
      *           (allowed on date of entry) failing to update        *
      *           trailer, causing FooB in LE0320                     *
      *  186706 - Initialise settlement details upon reversal of a    *
      *           PI loan amendment so as to generate proper account  *
      *           postings.                                           *
      *  CSD006 - Use long DS with SDBSRTPD.                          *
      *  189911 - Pgm msg queue not cleared when subfile is displayed *
      *  189827 - Wrong error message sent when date is a holiday     *
      *  189826 - Sequence must be known before window called         *
      *           (in insert mode)                                    *
      *  189825 - Ensure correct message file is used                 *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
      *  CRT004 - Cashier Midas TCP/IP interface.                     *
      *             Recompiled over SDBRCHPD Changes                  *
     F*  152931 - Funding Spread/Rate becomes zero when Rate/Spread   *
     F*           is zero in Loan Amendment.                          *
      *  175450 - Shadow files should not be updated for Risk Loan.   *
      *  CIR004 - Dealing Calculation Method Change.                  *
      *         - Recompiled due to GLINTC and ZINTDY changes         *
      *  CDE001 - Data Export - CCRM Limits                           *
      *  172289 - If F12 pressed in extended settlements screen before*
      *           validation then previous screen was not displayed.  *
      *  169698 - User allowed to authorise transacions by pressing   *
      *           'Enter'. Code amended so 'F11' needs to be pressed  *
      *           if field BPAURV = 'N'.                              *
      *  169232 - QFCLTY should not update the OAM fields beyond the  *
      *           expiry date of the facility.                        *
      *  163973 - Principal Increase in one branch posted settlement  *
      *           to suspense.                                        *
      *  CLE009 - LE I/C Swift Message Generation for Fees            *
      *  162602 - Loan Amendments for principal transfer have no PC   *
      *           reference                                           *
     F*  161350 - four steps for this fix:                            *
     F*         - Validation introduced by 147281 to be removed ie    *
     F*           prevention of Loan amendments for multi ccy roll    *
     F*           overs post roll date.                               *
     F*         - Allow loan amend for multi ccy rollovers prior to   *
     F*           roll date with original loan currency.              *
     F*         - Allow loan amendment for multi currency rollovers   *
     F*           post roll date with new currency                    *
     F*         - Use parameter @OPTN value *VERIFY not *KEY for call *
     F*           to AOCURRR0 as *KEY Causes DB error.                *
      *  161036 - 1. Code in srvali moved to srvalf, so that it gets  *
      *           done when a record is actioned from the subfile.    *
      *           2. Remove code which disallows amendment of         *
      *           records with processing types 70, 71, 72.           *
      *           3. Branch on settlement account is not shown.       *
      *  159256 - Send interactive warning message if syndicated      *
      *           loan is amended via Midas.                          *
      *  159690 - Settlements on principal increase defaults to the   *
      *           internal customer of the wrong branch.              *
      *  159095 - Incorrect GASS value when loan amendment is         *
      *           generated by assignment                             *
      *  157303 - Future valued PI gives exceed facility warning err. *
      *           even if facility availability can still accomodate  *
      *           transaction.                                        *
      *  152678 - Pay/receive indicator on ltrix is only updated      *
      *           for payment instructions.                           *
      *  158207 - F12 from SD2400 updating directly on authorize
      *         - must go back to main screen first
      *         - Also, if status is 'R' on amend, should remain as
      *           'R' not revert back to 'C'
      *  158205 - We must not validate amounts on authorize as
      *           they are already included on LOAMSDK
      *  158203 - If a loan amendment is amended before it has ever   *
      *           been authorized, the LTRIX change type is written   *
      *           as 'A'. this is incorrect, should be 'I' (as per    *
      *           Dealing module)                                     *
      *  158177 - All transactions input through Midas must have      *
      *           a full PC reference                                 *
      *  158200 - The loan subtype did not reflect the new one for    *
      *           action code 'E', 'X' and 'R'.                       *
      *  158198 - CONFIRMATION NOT BEING PRODUCED FOR AN AUTHORISED   *
      *           LOAN AMENDMENT OF AN UNAUTHORISED LOAN.             *
      *  157056 - Principal Transfer should compute for interest      *
      *           rate and amount even if receiving loan is           *
      *           new (PINRLI = 'Y').                                 *
      *  157547 - RECEIPT INSTR. NOT GETTING UPDATED FOR PART SOLD IN *
      *           'I' MODE.
      *  155931 - Settlement branch is cleared when f12 is the        *
      *           first action on the extended settlement screen.     *
      *  155106 - Database error processing not standard.             *
      *  156036 - Rejection of loan amendments entered on Midas but   *
      *           authorised on Loan Manager.                         *
      *  155570 - Conditioning incorrect for update of ltrix.         *
      *  155610 - Authorisation processing incorrect if CLE002 is     *
      *           off as manual ICD flags are still on.               *
      *  154799 - Recompiled due to changes in /COPY,ZACCH            *
      *  151295 - Problems authorising repayment schedules            *
      *           Recompiled due to changes in ZCHKH                  *
      *  153663 - Automatic unlinking no longer required.             *
      *  150799 - Database error 038 when entering a principal        *
      *           increase against a participation purchased.         *
      *  149500 - No warning when PI on partsold will exceed          *
      *           loan amount.                                        *
      *  145631 - Inserting/Amending User being overwritten with      *
      *           original loan details. Also can not authorise       *
      *           a principal increase.                               *
      *  144096 - Records written to ltrix before transaction is      *
      *           authorised; also blank sequence number written.     *
      *  143802 - Total Part Sold Amount on main loan increased when  *
      *           Principal Increase is processed which is an         *
      *           Assignment.                                         *
      *  143789 - Defaulting of field 56 from loan record incorrect.  *
      *  143772 - Exposure and Availability problem.                  *
      *  143071 - The Std settlement instructions should default      *
      *           first when entering a principal increase, then      *
      *           default is to the loan.                             *
      *  143004 - Details on the screen change everytime ENTER key    *
      *           is pressed during authorisation                     *
      *  142588 - Principal Increase entered on Loan Manager drops    *
      *           link.                                               *
      *  141464 - Change to get principle increase SWIFT payments     *
      *           when input on the PC.                               *
      *  140817 - Remove restriction that if a rollover date exists   *
      *           on the term loan, can not change the loan type      *
      *           to call as rollovers can now be done on call loans. *
      *  139308 - Cannot Amend or Reverse PTMN.                       *
      *  138866 - Include interest amount in the Principal Transfer   *
      *           confirmation.                                       *
      *  135349 - Amount sold is not being updated when a principal   *
      *           transfer of the part sold amount occured.           *
      *  135152 - There needs to be a separate standard settlement    *
      *           instruction transaction type for Lending - use of   *
      *           'MM' is not sufficiently flexible                   *
      *  135148 - SETP on some PT/PF LOAMS gets set to zero.          *
      *  134799 - Cannot authorise a PI when a warning message is     *
      *           displayed.                                          *
      *  132947 - The Last Availability date needs to be checked when *
      *           inserting a PI.                                     *
      *  131253 - Accept amendment when CLE005 is *ON and RATF in     *
      *           CLOANCL is 'Y' even if RECI is 'M'.                 *
      *  126379 - For principal increase settlement details should    *
      *           default from the loan.                              *
      *  122461 - Correct the setting of 'manual/system generated'    *
      *           flag. Where the transaction is from loan manager,   *
      *           (but not the first message in the unit of work),    *
      *           set to 'S'; otherwise set to 'M'.                   *
      *  144915 - Recompiled due to changes in LF/CLOAN.              *
      *  147281 - Multi-ccy rollover should not be allowed if past    *
      *           due payments or future dated loan amendments except *
      *           for repayment schedule exists.                      *
      *  CEU020 - EMU Lending Multi-currency Rollvoer                 *
      *  CEU004 - LE Settlement Ccy Conversion Upgrade to DBA R2.0    *
      *  131971 - If LTRIX is full for batch mode the program does not*
      *           processs the PC messages correctly. This should be  *
      *           treated as a DB error.                              *
      *  131209 - The century part of the maturity date is not removed*
      *           when it it moved to the screen field form the PC    *
      *           message.                                            *
      *  127996 - Cannot authorise a Base rate change which is        *
      *           backvalued past the limit.                          *
      *  CLE005 - Customer Lending Enhancements - Tranche 3           *
      *  127289 - Loan sub type is incorrect for enquiry and          *
      *           authorisation modes.                                *
      *  126903 - Spread rate changes not shown on Loan activity      *
      *           enquiry because IRCF field is not set up correctly. *
      *  126383 - In enquiry mode cannot tell if a loan is reversed.  *
      *  126309 - Pay/Recs not being produced                         *
      *           (i)  Last Change Type is not written to LOAMSDK for *
      *                insert or amend.                               *
      *           (ii) Loan Amendment indicators not initialized      *
      *                correctly on insert.                           *
      *           (iii) Last Change Type incorrectly written as 'X'   *
      *                 to LTRIX when authorizing.                    *
      *  126274 - The subfile review screen should show the customer  *
      *           short name.                                         *
      *  125972 - FACO is set incorrectly on LOAMSDK                  *
      *  125186 - Allow receive settlement input for parts sold       *
      *  123857 - Additional authorisation option, to use F11 or go   *
      *           through all screens and pressing ENTER on the last  *
      *           screen.                                             *
      *  124740 - Maturity date set to Zero after COB was run         *
      *  123699 - Settlement account and branch not set correctly.    *
      *  122685 - Incorrect update of facility availability amount    *
      *  123998 - Texts should be coming from message subfile         *
      *  123801 - Return exact settlement detail error in batch mode  *
      *  123789 - File control out of balance                         *
      *  123227 - Principal transfer authorisation to use BPTPAU flag *
      *  123177 - Unlink from a syndicate only when linked            *
      *  123055 - F12, no validation from extended settlements screen *
      *           writes a record.                                    *
      *  123018 - Sub type not shown for enquiry mode.                *
      *  122960 - Use first parameter of positions update program     *
      *           to suppress rollback in batch mode.                 *
      *  122889 - Program should not roll back in batch mode.         *
      *  122141 - Do not unlink the loan from the syndicate if this   *
      *           is a syndicated loan amendment, (ie part of a unit  *
      *           of work).                                           *
      *  122109 - PC transaction ref is not set in interactive mode   *
      *           due to confusion with 'if..' construct.             *
      *  121783 - Call new access object AOBRCHR1 instead of AOBRCHR0 *
      *           (uses the long data structure DSSDY)                *
      *  121840 - Loan amendments sent from the PC are not            *
      *           automatically authorised.                           *
      *  121061 - Cannot input a principal increase prior to rollover *
      *           date.                                               *
      *  120023 - F12 in settlements screen in enquiry or reverse     *
      *           mode does not exit.                                 *
      *         - When amount not entered on 'PI' error messages not  *
      *           is sync.                                            *
      *  120468 - Include a DUMP in SRBERR subroutine for Batch and   *
      *           Play modes.                                         *
      *  120002 - If processing in batch mode, then status of         *
      *           transaction should always be set to 'A'.            *
      *         - Number of items in batch on return message is       *
      *           corrupted.                                          *
      *         - program perform COMIT operation while in batch mode *
      *  119594 - SD2400 should not be called when running in         *
      *           Batch or Play mode.                                 *
      *  115570 - Key in 115208 not set up correctly.                 *
      *  115208 - Validation for LS's and SA's should take account    *
      *           of the record value-dated before and after the      *
      *           current entry.                                      *
      *  115134 - Backvaluation to Start Date must be allowed when    *
      *            CLE003 active.                                     *
      *  CLE003 - Backvaluation in Customer Lending Enhancements      *
      *  CLE004 - Customer Lending Enhancements - Syndications.       *
      *                                                               *
      *****************************************************************
     FLE2040DFCF  E                    WORKSTN                        UC
     F                                        SRRN  KSFILE LE2040S0
     FLE2040PDUF  E                    DISK         KINFSR *PSSR A    UC
     FCLOAN   UF  E           K        DISK         KINFSR *PSSR
     F                                              KCOMIT
     F            CLOANHHF                          KIGNORE
     F            CLOANZ1F                          KIGNORE
      **  24/7 Midas Availability log file                                CSC011
     FAPILOGL0UF  E           K        DISK                           UC  CSC011
     F            APILOGD0                          KRENAMEAPILOGX0       CSC011
     F*                                                                   CSC011
      **  24/7 Midas Availability log files                               CSC011
     FAPVLOGPDO   E                    DISK                           UC  CSC011
     F                                              KCOMIT                CSC011
     FAPILOGPDO   E                    DISK                           UC  CSC011
     F                                              KCOMIT                CSC011
     FLOAMS   UF  E           K        DISK         KINFSR *PSSR A
     F                                              KCOMIT
     FLOAMD   IF  E           K        DISK
     F            LOAMSDKF                          KRENAMELOAMSD
     F            LOAMSDHF                          KIGNORE
     F            LOAMSZ1F                          KIGNORE
     F***LTRIX***UF  F      43            DISK         KINFSR *PSSR                         AR322732
     FLTRIX   O   F      45            DISK         KINFSR *PSSR A                          AR322732
     F                                              KCOMIT
     F                                              KINFDS FLDTX          186431
     FFCLTY   UF  E           K        DISK         KINFSR *PSSR
     F                                              KCOMIT
     F            FCLTYHHF                          KIGNORE
     F            FCLTYZZF                          KIGNORE
     F*LELOAML0IF***E*****     K        DISK                              180044
     FLELOAML8IF  E           K        DISK                               180044
     F            LOAMSDKF                          KRENAMELELOAMD0
     FLELOAML1IF  E           K        DISK
     F            LOAMSDKF                          KRENAMELELOAMD1
     FLELOAML4IF  E           K        DISK                               149500
     F            LOAMSDKF                          KRENAMELELOAMD4       149500
     FSDBSHSL1IF  E           K        DISK                               CLE003
     FPSOLD   IF  E           K        DISK                               149500
     F            CLOANCLF                          KRENAMEPSOLDF         149500
      *
     FLEFCAML6IF  E           K        DISK                               157303
      ** Facility Amendments File - Live                                  157303
      *                                                                   157303
     FLEFEEDL1UF  E           K        DISK         KINFSR *PSSR          CLE009
     F                                              KCOMIT                CLE009
      *                                                                   CLE009
     FLEFELAL0UF  E           K        DISK         KINFSR *PSSR A        CLE009
     F                                              KCOMIT                CLE009
     F/COPY WNCPYSRC,LEH00580
     FLEILAMPDO   E                    DISK                           UC  CAP061
     F                                              KCOMIT                CAP061
     FLEILAML1IF  E           K        DISK                           UC  CAP061
     F            LEILAMP0                          KRENAMELEILAMP1       CAP061
     FLEILAML2IF  E           K        DISK                           UC  CAP061
     F            LEILAMP0                          KRENAMELEILAMP2       CAP061
     FLEILAMLXUF  E           K        DISK                      A    UC  CAP061
     F            LEILAMP0                          KRENAMELEILAMDL       CAP061
     F                                              KCOMIT                CAP061
     FCLOANL5 IF  E           K        DISK         KINFSR *PSSR          210317
     F            CLOANCLF                          KRENAMECLOAN5F        210317
     F/COPY WNCPYSRC,LEH00518
      *                                                                                       CSD015
      **  Compliance Watch Hit List File                                                      CSD015
     FSDCWHTL1IF  E           K        DISK                                                   CSD015
      *                                                                                       CSD015
     FLEEIRDL5UF  E           K        DISK         KCOMIT                                    CAS009
     F            LEEIRDD0                          KRENAMELEEIRDD5                           CAS009
      *                                                                                       CLE134
      ** Past Due Call Loan - CLE134                                                          CLE134
      *                                                                                       CLE134
     FLEPDUEL2IF  E           K        DISK                                                   CLE134
      *                                                                                       CLE134
     FLEPDUFL2IF  E           K        DISK                                                   CLE134
      *                                                                                       CLE134
     FCLOAMSQDO   E                    DISK         KCOMIT                                  AR400813
      *                                                                                     AR400813
      ** LE Loan Amendments Extension File                                                  AR400813
      *                                                                                     AR400813
     F/COPY WNCPYSRC,LE2040F001
      /SPACE 3
      *****************************************************************
      *                                                               *
      *    F U N C T I O N   O F   I N D I C A T O R S                *
      *                                                               *
      *    09           Chain for SDCWHTL1                            *                       CSD015
      *    11           SFLCLR                                        *
      *    12           SFLDSPCTL                                     *
      *    18           Protect Special Instrustions fields           *
      *    13           Display 'Page Keys'                           *
      *    19           SFLEND at Loan Subfile Control                *
      *    20           SFLNXTCHG                                     *
      *    21           ROLLUP                                        *
      *    22           Protect Detail screen fields                  *
      *    23           Loan Sub-type                                 *
      *    24           Do not output last sequence no. allocated for *
      *                 Loan Amendment just entered                   *
      *    25           F9 pressed from subfile screen                *
      *    26           Authorisation - F11                           *
      *    27           Deletion - F10                                *
      *    28           Settlements - F14                             *
      *    29           Authorisation required                        *
      *    30           Invalid action code                           *
      *    31           Invalid Loan no.                              *
      *    32           Invalid Amendment type                        *
      *    33           Invalid Value date                            *
      *    34           Invalid Sequence no.                          *
      *    35           Invalid loan no. to review from               *
      *    36           Invalid Require Authorisation field           *
      *    37           Invalid Customer number                       *
      *    38           Invalid Base rate                             *
      *    39           Invalid Rate/Spread                           *
      *    40           Invalid Currency                              *
      *    41           Invalid Amount                                *
      *    42           Invalid Stop Accruals                         *
      *    43           Invalid Default Participation Loan Type       *
      *    44           Invalid Default Participation Loan Subtype    *
      *    45           Invalid Special Instructions                  *
      *    46           Invalid Loan Subtype                          *
      *    47           Invalid Maturity Date                         *
      *    48           Error on Value Date in Detail Screen          *
      *    49           Invalid Selection field                       *
      *    50           Default Part. Loan type/subtype displayed     *
      *    51           Display Funding Spread/Rate                   *
      *    52           Invalid Funding Spread/Rate entered           *
      *    53           Perform tolerance check                       *
      *    54           No previous 'SC' loan amendment               *
      *    55           No previous 'BC' loan amendment               *
      *    56           Invalid Settlement Allocation                 *                       CLE034
      *    60           Change heading, F keys, options on subfile    *   CAP061
      *    61           Error with amendment code on detail screen    *   CAP061
      *    69           LOKUP currency array                          *   CLE009
      *    79           Fail on CHAIN/READ commands                   *
      *    75           Loam Amendment Reversed sign                  *   126383
      *    76           CLE034 is installed                           *                       CLE034
      *    80           EOF on subfile read                           *
      *    81           F11 is not needed for authorisation           *   123857
      *    82           Chain to CLOAN to increase Part Sold amount   *   143802
      *    88           CHAIN to LEFELAL0                             *   CLE009
      *    89           READE to LEFEEDL1                             *   CLE009
      *    93           Work Indicator                                *   CLE003
      *    94           Work Indicator                                *   149500
      *                                                               *
      *****************************************************************
      /EJECT
     E                    STAMP   1   1 26                                                    CPK015
      ** Array containing dummy timestamp                                                     CPK015
      *                                                                                       CSD015
     E                    CWA     1  26 25                                                    CSD015
      ** Array used in Midas Compliance Watch                                                 CSD015
      *                                                                                       CSD015
     E                    CPY@    1   1 80
     E***********         STAT    1   4 16                                123998
     E**********          LATP    1   5 21                                180044
     E                    LATP    1   6 21                                180044
     E**********          POWR    1   7  7 3             CCY CONVERSIONS                      CLE023
     E                    POWER   1   7  7 3                                                  CLE023
     E                    OAM        10 13 0             AMTS.OUTSTANDING
     E                    OAB        10 13 0             AMTS FOR OUTPUT
     E                    WOAM       10 13 0                              157303
     E                    RUN        10  5 0A            DATES FOR OAM
     E                    CYA       150  3                                CLE009
      ** Currencies array                                                 CLE009
     E                    TND       150  1 0                              CLE009
      ** Telex Notice Days array                                          CLE009
      *                                                                   CLE009
     E/COPY ZSRSRC,ZALIGNZ1
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZHOLE
     E/COPY ZSRSRC,ZDATE9Z1                                               138866
     E/COPY WNCPYSRC,LE2040E001
      *                                                                                       CLE034
     E                    ACUR       20  3                                                    CLE034
      ** Array of Currencies                                                                  CLE034
      *                                                                                       CLE034
     E                    ALOC       20  3                                                    CLE034
      ** Array of Locations                                                                   CLE034
      *                                                                                       CSD015
     E                    WLF        12 35                                                    CSD015
      **  Watch List Fields Array.                                                            CSD015
      *
      /SPACE 3
     ILE2040D0                                                                                CLE031
     I              REXR                            REXRK                                     CLE031
     I              PEXR                            PEXRK                                     CLE031
     I              REXI                            REXIK                                     CLE031
     I              PEXI                            PEXIK                                     CLE031
     ICLOANCLF
      ** Rename fields for loans file - A
     I              RECI                            RECIA                 131253
     I              PTYP                            PTYPA
     I              LTYP                            LTYPA
     I              SUTP                            SUTPA
     I              AUTO                            AUTOC
     I              FCUS                            FCUSC
     I              FTYP                            FTYPC
     I              FSEQ                            FSEQC
     I              CCY                             CCYD
     I              LCD                             LCDA
     I              CHTP                            CHTPA
     I              TNLU                            TNLUA
     I              FCLB                            FCLBC
     I              RCSI                            RCSIC
     I              IUSR                            IUSRC                 145631
     I              AUSR                            AUSRC                 145631
     I              XUSR                            XUSRC                 145631
     I              STAL                            STALC                                     221924
     I              TMST                            XTMST                 CAP074
     I              CLAS                            LCLAS                                     256822
     I/COPY WNCPYSRC,LEH01093
      *
     ICLOANCKF
      ** Rename fields for loans file - B
     I              NLRA                            NLRAK
     I              ECIN                            ECINK                 CEU020
     I              TMST                            TMSTK                 CAP074
      *                                                                   CAP074
     ICLOAN5F                                                             CAP074
      ** Rename fields for cloanl5f format                                CAP074
     I              TMST                            XTMST                 CAP074
      *
     ILOAMSDKF
     I              PCRF                            PCRFK
     I              PCOB                            PCOBK
     I              TMST                            PTMST                 CAP075
      *                                                                   126309
     ILOAMSZ1F                                                            126309
     I              CHTP                            CHTPZ                 126309
      *
     ILELOAMD0
      ** Rename fields for subfile use
      ** Some extra renames for CAP061 processing                         CAP061
     I              LNRF                            FLNRF
     I              CNUM                            FCNUM
     I              LASN                            FLASN
     I              VDAT                            FVDAT
     I              AMTP                            FAMTP
     I              ASTS                            FASTS
     I              IUSR                            FIUSR
     I              AUSR                            FAUSR
     I              BRCA                            FBRCA
     I              LTYP                            FLTYP                 CAP061
     I              SUTP                            FSUTP                 CAP061
     I              LSMD                            FLSMD                 CAP061
     I              BRTT                            FBRTT                 CAP061
     I              RTSP                            FRTSP                 CAP061
     I              CCY                             FCCY                  CAP061
     I              TAMT                            FTAMT                 CAP061
     I              STAI                            FSTAI                 CAP061
     I              FSRP                            FFSRP                 CAP061
     I              DFTP                            FDFTP                 CAP061
     I              SPI1                            FSPI1                 CAP061
     I              SPI2                            FSPI2                 CAP061
     I              DFST                            FDFST                 CAP061
     I              SPI3                            FSPI3                 CAP061
     I              STAL                            FSTAL                                     CLE034
     I              TMST                            FTMST                                     CLE029
      *
     ILELOAMD1
      ** Rename fields for subfile use
     I              LNRF                            FLNRF
     I              CNUM                            FCNUM
     I              LASN                            FLASN
     I              VDAT                            FVDAT
     I              AMTP                            FAMTP
     I              ASTS                            FASTS
     I              IUSR                            FIUSR
     I              AUSR                            FAUSR
     I              BRCA                            FBRCA
     I              TMST                            FTMST                 CAP075
      *                                                                   149500
     ILELOAMD4                                                            149500
      ** Rename fields for LELOAMD4                                       149500
     I              RECI                            RECIW                 149500
     I              LNRF                            LNRFW                 149500
     I              VDAT                            VDATW                 149500
     I              LASN                            LASNW                 149500
     I              AMTP                            AMTPW                 149500
     I              PRAM                            PRAMW                 149500
     I              ASTS                            ASTSW                 149500
      *                                                                   CAP061
     ILEILAMP2                                                            CAP061
      ** Rename fields                                                    CAP061
     I              XMSID                           IXMSID                CAP061
     I              WLSNA                           IWLSNA                CAP061
     I              SACTN                           ISACTN                CAP061
     I              SLOAN                           ISLOAN                CAP061
     I              SATYP                           ISATYP                CAP061
     I              SBRAT                           ISBRAT                CAP061
     I              SVDAT                           ISVDAT                CAP061
     I              SSEQN                           ISSEQN                CAP061
     I              SCNUM                           ISCNUM                CAP061
     I              SLTYP                           ISLTYP                CAP061
     I              SSTYP                           ISSTYP                CAP061
     I              SMDAT                           ISMDAT                CAP061
     I              SRTSP                           ISRTSP                CAP061
     I              SCURR                           ISCURR                CAP061
     I              SAMNT                           ISAMNT                CAP061
     I              SSTPA                           ISSTPA                CAP061
     I              SFRAT                           ISFRAT                CAP061
     I              SDFTP                           ISDFTP                CAP061
     I              SDFST                           ISDFST                CAP061
     I              SSPI1                           ISSPI1                CAP061
     I              SSPI2                           ISSPI2                CAP061
     I              SSPI3                           ISSPI3                CAP061
     I              SFSCCY                          ISFSCY                                    CLE031
     I              SFPSCY                          ISFPCY                                    CLE031
     I              SFREXR                          ISREXR                                    CLE031
     I              SFPEXR                          ISPEXR                                    CLE031
     I              SFPEXI                          ISPEXI                                    CLE031
     I              SFREXI                          ISREXI                                    CLE031
     I              SFSTAL                          ISSTAL                                    CLE034
      *                                                                   159690
     ILOAMSD                                                              159690
      ** Rename fields for LOAMSD                                         159690
     I              BRCA                            BRCAL                 159690
     I              TMST                            BTMST                 CAP075
     I/COPY WNCPYSRC,LEH01094
     IFCLTYFMF                                                            158207
      ** Rename fields to avoid clash                                     158207
     I              CNUM                            CNUMF                 158207
     I              OSDB                            OSDBF                                     204211
     I              OMDB                            OMDBF                                     204211
     IFCLTYFNF                                                            158207
      ** Rename fields to avoid clash                                     158207
     I              CNUM                            CNUMF                 158207
     ILEFEEDF                                                                                 204211
      ** Rename fields to avoid clash                                                         204211
     I              OSDB                            OSDBL                                     204211
     I              OMDB                            OMDBL                                     204211
     ILEPDUED0                                                                                CLE134
      *                                                                                       CLE134
      ** Midas LE Customer lending loans by LNRF                                              CLE134
      *                                                                                       CLE134
     I              YTKPACL                         YKPACL                                    CLE134
     I              YTKPABR                         YKPABR                                    CLE134
     I              YTKPAAC                         YKPAAC                                    CLE134
     I              YTKPASE                         YKPASE                                    CLE134
     I              YTKPACY                         YKPACY                                    CLE134
     I              YTKIACL                         YKIACL                                    CLE134
     I              YTKIABR                         YKIABR                                    CLE134
     I              YTKIAAC                         YKIAAC                                    CLE134
     I              YTKIASE                         YKIASE                                    CLE134
     I              YTKIACY                         YKIACY                                    CLE134
      *                                                                                       CLE134
     ILEPDUFD0                                                                                CLE134
      *                                                                                       CLE134
      ** Midas LE Customer lending fees by LNRF                                               CLE134
      *                                                                                       CLE134
     I              YTKPACL                         YKPACL                                    CLE134
     I              YTKPABR                         YKPABR                                    CLE134
     I              YTKPAAC                         YKPAAC                                    CLE134
     I              YTKPASE                         YKPASE                                    CLE134
     I              YTKPACY                         YKPACY                                    CLE134
      *                                                                                       CLE134
     I/COPY WNCPYSRC,LEH01096
     IPSOLDF                                                                                  CAP074
      ** Rename fields to avoid clash                                                         CAP074
     I              TMST                            PTMST                                     CAP074
      *
      ** Loan transactions index file - Header record
      *
     I*LTRIX***NS       1 CH                                                                AR322732
     I**********                              1   1 RECI                                    AR322732
     I**********                              2   2 RCDT                                    AR322732
     I**********                              3   80LNRF                                    AR322732
     I**********                          P   9  110NORE                                    AR322732
     I**********                          P  12  140FLSZ                                    AR322732
     I**********                          P  15  170RRLC                                    AR322732
     I**********                          P  18  200RRNA                                    AR322732
     I**********                          P  21  230RRLX                                    AR322732
     I**********                          P  24  260RRXP                                    AR322732
     I**********                          P  27  290NLNR                                    AR322732
     I**********                          P  30  320NLAR                                    AR322732
     I**********                             33  330STPI                                    AR322732
     I**********                          P  38  400TNLU                                    AR322732
      *
      ** Loan transactions index file - Detail record
      *
     I*LTRIX***NS       1 CD   2 CA                                                         AR322732
     I*******OR*       1 CD   2 CL                                                          AR322732
     I**********                              1   1 RECI                                    AR322732
     I**********                              2   2 RCDT                                    AR322732
     I**********                              3   80LNRF                                    AR322732
     I**********                              9  130VDAT                                    AR322732
     I**********                             14  160LASN                                    AR322732
     I**********                             17  17 CHTP                                    AR322732
     I**********                             18  18 CNRQ                                    AR322732
     I**********                             19  19 CNPR                                    AR322732
     I**********                             20  20 REPR                                    AR322732
     I**********                             21  250RRLA                                    AR322732
     I**********                             26  26 LADI                                    AR322732
     I**********                             27  270PRI1                                    AR322732
     I**********                          P  35  370RRNT                                    AR322732
     I**********                          P  38  400TNLU                                    AR322732
      *
      ** Loans transactions index file - Catchall
      *
     I********NS                                                                            AR322732
     I**********                              1   1 RECI                                    AR322732
      *
      *
     IA@CPY       DS
      * Copyright array
     I                                        1  80 CPY@
      *
     I            DS
     I                                        1  12 FCLKEY
     I**********                              1   60WFCNM                                     CSD027
     I                                        1   6 WFCNM                                     CSD027
     I                                        7   90WFACT
     I                                       10  110WFNUM
     I                                       12  12 WFRTP
      *
     I            DS
     I                                        1  12 LONKEY
     I**********                              1   60WLOAN                                     CLE148
     I                                        1   6 WLOAN                                     CLE148
     I                                        7   90WVDAT
     I                                       10  110WSEQN
      *
     I            DS
     I                                    P   1   30RUN0
     I                                    P   4   60RUN1
     I                                    P   7   90RUN2
     I                                    P  10  120RUN3
     I                                    P  13  150RUN4
     I                                    P  16  180RUN5
     I                                    P  19  210RUN6
     I                                    P  22  240RUN7
     I                                    P  25  270RUN8
     I                                    P  28  300RUN9
     I                                    P   1  30 RUN
      *
     I            DS
     I                                    P   1   70OAM1
     I                                    P   8  140OAM2
     I                                    P  15  210OAM3
     I                                    P  22  280OAM4
     I                                    P  29  350OAM5
     I                                    P  36  420OAM6
     I                                    P  43  490OAM7
     I                                    P  50  560OAM8
     I                                    P  57  630OAM9
     I                                    P  64  700OA10
     I                                    P   1  70 OAM
      *
     ILDA         DS                            256
      ** Local data area for database error details
      *
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      *
     IPSDS       SDS
      *
      ** Program Status Data Structure - gives Job/Workstation name and
      ** User ID
      *
     I                                     *PROGRAM ##PGM
     I                                      244 253 WSID
     I                                      254 263 USER
     I/COPY WNCPYSRC,LE2040I002
      *
     I            DS
      **   USED IN SETTLE SUBROUTINE.
     I**********                              1  12 OURS                                    AR637996
     I                                        1  18 OURS                                    AR637996
     I                                        1   6 SSIX
     I**********                              7  10 SACD                                    AR637996
     I**********                             11  12 SASQ                                    AR637996
     I                                        7  16 SACD                                    AR637996
     I                                       17  18 SASQ                                    AR637996
     I                                        1   2 SNOS
     I                                        1  10 ANMKEY
      **   USED TO ACCESS ACCOUNT MASTER.
     I**********                             13  30 AKEY                                    AR637996
     I**********                             13  18 ACUS                                    AR637996
     I***********                            19  21 ICCY                  CEU004
     I**********                             22  25 AACD                                    AR637996
     I**********                             26  27 AASQ                                    AR637996
     I**********                             28  30 BRCDAC                                  AR637996
     I                                       19  39 AKEY                                    AR637996
     I                                       19  24 ACUS                                    AR637996
     I                                       25  34 AACD                                    AR637996
     I                                       35  36 AASQ                                    AR637996
     I                                       37  39 BRCDAC                                  AR637996
      **   SETTLEMENT DETAILS FOR OUTPUT.
      **   - EXCLUDING SETTLE. BRANCH
      *
     I**********                             31  64 OTIST                                   AR548031
     I**********                             31  70 OTIST                          AR548031 AR637996
     I**********                             31  32 TYPE                                    AR637996
     I**********                             33  44 OTOURS                                  AR548031
     I**********                             45  54 THRS                                    AR548031
     I**********                             55  64 OTFACO                                  AR548031
     I**********                             65  69 SPEC5                                   AR548031
     I**********                             70  72 SPEC3                                   AR548031
     I**********                             73  78 SPEC6                                   AR548031
     I**********                             73  81 SPEC9                                   AR548031
     I**********                             82  94 SPEC13                                  AR548031
     I**********                             79  94 SPEC16                                  AR548031
     I**********                             73  94 SPEC22                                  AR548031
     I**********                             33  50 OTOURS                         AR548031 AR637996
     I**********                             51  60 THRS                           AR548031 AR637996
     I**********                             61  70 OTFACO                         AR548031 AR637996
     I**********                             71  75 SPEC5                          AR548031 AR637996
     I**********                             76  78 SPEC3                          AR548031 AR637996
     I**********                             79  84 SPEC6                          AR548031 AR637996
     I**********                             79  87 SPEC9                          AR548031 AR637996
     I**********                             88 100 SPEC13                         AR548031 AR637996
     I**********                             85 100 SPEC16                         AR548031 AR637996
     I**********                             79 100 SPEC22                         AR548031 AR637996
     I                                       40  79 OTIST                                   AR637996
     I                                       40  41 TYPE                                    AR637996
     I                                       42  59 OTOURS                                  AR637996
     I                                       60  69 THRS                                    AR637996
     I                                       70  79 OTFACO                                  AR637996
     I                                       80  84 SPEC5                                   AR637996
     I                                       85  87 SPEC3                                   AR637996
     I                                       88  93 SPEC6                                   AR637996
     I                                       88  96 SPEC9                                   AR637996
     I                                       97 109 SPEC13                                  AR637996
     I                                       94 109 SPEC16                                  AR637996
     I                                       88 109 SPEC22                                  AR637996
      *                                                                                       207629
      ** Datastructure to hold input parameter for AOSVALR0.                                  207629
     I            DS                                                                          207629
     I                                        1  20 WPARM                                     207629
     I                                        1   5 WPARM1                                    207629
     I                                        6  10 WPARM2                                    207629
     I                                       11  15 WPARM3                                    207629
     I                                       16  20 WPARM4                                    207629
      *
     I            DS
      *   LAST INPUT DATA - MAIN LOAN AMEND
     I                                        1   50LCD
     I                                        6   6 CHTP
     I                                        7  110TNLU
     I                                        1  11 LSTC
     I                                       12  160LCDS
     I                                       17  17 CHTPS
     I                                       18  220TNLUS
     I                                       12  22 LSTCS
     I***   LAST UPDATE DATA - RELATED LOAN
     I                                       23  270LCDA
     I                                       28  28 CHTPA
     I                                       29  330TNLUA
     I                                       23  33 LSTCA
     I                                       34  380LCDT
     I                                       39  39 CHTPT
     I                                       40  440TNLUT
     I                                       34  44 LSTCT
      *
     I***PINPP       DS                            940                    CEU004
     I**PINPP       DS                            946              CEU004 143802
     I**PINPP       DS                            947              143802 203795
     IPINPP     E DSLEA1MFPD                                              203795
      ** Transmitted message format
     I                                        1   4 PIMTYP
     I                                        5  20 PITUSR
     I                                       21  36 PITWST
     I                                       37  51 PITREF
     I                                       52  55 PITSEQ
     I                                       52  550P#TSEQ                122141
     I                                       56  56 PITACT
     I                                       57  64 PITDST
     I                                       65  72 PITTST
     I***********                            73  75 PINPAR                120002
     I***********                            76  78 PINNLR                120002
     I***********                            79  80 PIFIL2                120002
     I                                       73  76 PINPAR                120002
     I***************************************77  80 PIFIL2          120002CAP061
     I                                       77  77 PIPLC                 CAP061
     I                                       78  80 PFILL2                CAP061
     I                                       80  80 PIPTIN                144096
     I                                       81  86 PILOAN
     I                                       87  94 PIVDAT
     I                                       95  97 PIAMSQ
     I                                       98 103 PICSNO
     I                                      104 106 PICURR
     I                                      107 120 PIPAMT
     I                                      121 122 PIBSRT
     I                                      123 134 PIRTSP
     I                                      135 135 PISTAC
     I                                      136 143 PIMATD
     I                                      144 145 PILTYP
     I                                      146 147 PILSTP
     I                                      148 159 PIFRAT
     I                                      160 249 PISPEI
     I                                      160 189 PISPI1
     I                                      190 219 PISPI2
     I                                      220 249 PISPI3
     I                                      250 251 PIPSTM
     I**********                            252 266 PIPONS                                   BUG8900
     I**********                            255 266 P#PONS                            123699 BUG8900
     I                                      252 266 QIPONS                                   BUG8900
     I                                      255 266 Q#PONS                                   BUG8900
     I                                      267 274 PIPREC
     I                                      275 275 PICVMR
     I                                      276 281 PIPOCN
     I                                      282 287 PIPOBN
     I                                      288 295 PIRCRN
     I                                      296 330 PIRCRA
     I                                      331 338 PIPIBN
     I                                      339 373 PIPIBA
     I                                      374 381 PIAWBN
     I                                      382 416 PIAWBA
     I                                      417 424 PIBENN
     I                                      425 459 PIBENA
     I                                      460 461 PIRSTM
     I**********                            462 476 PIRONS                                   BUG8900
     I**********                            465 476 P#RONS                            123699 BUG8900
     I                                      462 476 QIRONS                                   BUG8900
     I                                      465 476 Q#RONS                                   BUG8900
     I                                      477 482 PIROCN
     I                                      483 488 PIROBN
     I                                      489 496 PIRIBN
     I                                      497 531 PIRIBA
     I                                      532 671 PIDTPA
     I                                      532 566 PIDTP1
     I                                      567 601 PIDTP2
     I                                      602 636 PIDTP3
     I                                      637 671 PIDTP4
     I                                      672 674 PIDCHG
     I                                      675 884 PIBTBA
     I                                      675 709 PIBTB1
     I                                      710 744 PIBTB2
     I                                      745 779 PIBTB3
     I                                      780 814 PIBTB4
     I                                      815 849 PIBTB5
     I                                      850 884 PIBTB6
     I                                      885 886 PIDFTP
     I                                      887 888 PIDFST
     I                                      889 889 PINRLI
     I                                      890 895 PIROLN
     I                                      896 898 PIROAS
     I                                      899 901 PIROBR
     I                                      902 907 PIROCU
     I                                      908 917 PIIUSR
     I                                      918 927 PIAUSR
     I                                      928 937 PIXUSR
     I                                      938 940 PIPCOB
     I                                      941 943 PISCCY                CEU004
     I                                      944 946 PIICCY                CEU004
     I                                      947 947 PIGASS                143802
     I                                      948 962 PIXREF                210317
     I                                      963 976 PIREXR                                    CLE031
     I                                      977 977 PIREXI                                    CLE031
     I                                      978 980 PIPSCY                                    CLE031
     I                                      981 994 PIPEXR                                    CLE031
     I                                      995 995 PIPEXI                                    CLE031
     I                                      996 996 PISTAL                                    CLE034
     I                                      9971017 PIPONS                                   BUG8900
     I                                     10001017 P#PONS                                   BUG8900
     I                                     10181038 PIRONS                                   BUG8900
     I                                     10211038 P#RONS                                   BUG8900
     I/COPY WNCPYSRC,LEH01114
      *
     IPOUTP       DS                            192
      ** Return message format
     I                                        1   4 POMTYP
     I                                        5  20 POTUSR
     I                                       21  36 POTWST
     I                                       37  51 POTREF
     I                                       52  55 POTSEQ
     I                                       56  56 POTACT
     I                                       57  64 POTDST
     I                                       65  72 POTTST
     I***********                            73  75 PONPAR                120002
     I***********                            76  78 PONLON                120002
     I***********                            79  80 POFIL2                120002
     I                                       73  76 PONPAR                120002
     I                                       77  80 POFIL2                120002
     I                                       81  81 POMSVR
     I                                       82  88 POMSID
     I                                       89 166 POMSTX
     I                                      167 172 POLOAN
     I                                      173 180 POVDAT
     I                                      181 183 POAMSQ
     I                                      184 189 POROLN
     I                                      190 192 POROAS
      *
      ** Compliance Engine Free Format String Parameter.                                      CSD015
     IPARMDS      DS                           9999                                           CSD015
      *                                                                                       CSD015
     I            DS
     I                                        1   6 WDATE
     I                                        1   2 WDD
     I                                        3   4 WMM
     I                                        5   6 WYY
      *
     I            DS
     I                                        1   6 WTIMEA
     I                                        1   2 WHH
     I                                        3   4 WNN
     I                                        5   6 WSS
      *
     I            DS
     I                                        1   8 WPITDS
     I                                        1   2 WPIDD
     I                                        3   4 WPIMM
     I                                        5   6 WPICC                 CSC011
     I                                        7   8 WPIYY
      *
     I            DS
     I**********                              1 158 WSCRNA                                    CLE034
     I/COPY WNCPYSRC,LEH01115
     I                                        1 159 WSCRNA                                    CLE034
     I/COPY WNCPYSRC,LEH01116
     I                                        1  10 SCNUM
     I                                       11  12 SLTYP
     I                                       13  14 SSTYP
     I                                       15  20 SMDAT
     I                                       21  22 SBRAT
     I                                       23  34 SRTSP
     I                                       35  37 SCURR
     I                                       38  51 SAMNT
     I/COPY WNCPYSRC,LEH01117
     I                                       52  52 SSTPA
     I                                       53  54 SDFTP
     I                                       55  56 SDFST
     I                                       57  86 SSPI1
     I                                       87 116 SSPI2
     I                                      117 146 SSPI3
     I                                      147 158 SFRAT
     I                                      159 159 SSTAL                                     CLE034
     I/COPY WNCPYSRC,LEH01118
      *
     I            DS
     I                                        1   7 SCRREV
     I                                        1   6 SRLON
     I                                        7   7 SRAUT
     I/COPY WNCPYSRC,LEH01360
      *
     IZ#BSTS    E DSZ#BST
     IZ#ASTS    E DSZ#AST
     IZ#WSTS    E DSZ#WST
      ** External data structures for update of PRONO, MEMOS etc.
      *
     I            DS
      ** Fields used for update of MEMOS, PRONO etc.
     I                                        1 256 Z#ADTA
     I                                        1   1 SHRECI
     I                                        2   7 SHLNRF
     I                                        8  120SHVDAT
     I                                       13  150SHLASN
     I                                       21  220SHPTYP
     I                                       23  24 SHAMTP
     I                                    P  29  347SHRTSP
     I                                       35  37 SHCCY
     I                                    P  38  440SHPRAM
     I                                       73  75 SHBRCA
     I                                       82  820SHREPT
     I**********                             85 118 SHTIST                                 AR548031A
     I**********                             85  86 SHTYPE                          217459 AR548031A
     I**********                             87  98 SHOURS                          217459 AR548031A
     I**********                             99 108 SHTHRS                          217459 AR548031A
     I**********                            109 118 SHFACO                          217459 AR548031A
     I                                       85 124 SHTIST                                 AR548031A
     I                                       85  86 SHTYPE                                 AR548031A
     I                                       87 104 SHOURS                                 AR548031A
     I                                      105 114 SHTHRS                                 AR548031A
     I                                      115 124 SHFACO                                 AR548031A
     I                                      253 253 SHINTC
      *
     I                                      257 512 Z#ADTB
     I                                      261 263 SHOSBR
     I                                      317 317 SHCHTP
     I                                    P 318 3200SHTNLU                                    CLE033
      *                                                                   CEU004
     I                                     10251280 Z#ADTE                CEU004
     I                                     10611063 SHSCCY                CEU004
     I                                     10641066 SHICCY                CEU004
     I                                    P106910758SHREXR                                    CLE031
     I                                     10761076 SHREXI                                    CLE031
     I                                     10771079 SHPSCY                                    CLE031
     I                                    P108010868SHPEXR                                    CLE031
     I                                     10871087 SHPEXI                                    CLE031
     I                                     10881088 SHSTAL                                    CLE034
      *                                                                   CSC011
     I            DS                                                      CSC011
      ** ISO format timestamp for 24/7 log                                CSC011
      ** Used as Key in APILOGL0                                          CSC011
     I                                        1  26 TSTISO                CSC011
     I                                        1   4 TSTYY                 CSC011
     I I            '-'                       5   5 TSTF1                 CSC011
     I                                        6   7 TSTMM                 CSC011
     I I            '-'                       8   8 TSTF2                 CSC011
     I                                        9  10 TSTDD                 CSC011
     I I            '-'                      11  11 TSTF3                 CSC011
     I                                       12  19 TSTTM                 CSC011
     I                                       12  13 TSTTM1                CSC011
     I I            '.'                      14  14 TSTF4                 CSC011
     I                                       15  16 TSTTM2                CSC011
     I I            '.'                      17  17 TSTF5                 CSC011
     I                                       18  19 TSTTM3                CSC011
     I I            '.'                      20  20 TSTF6                 CSC011
     I                                       21  26 TSTTM4                CSC011
      *                                                                   CSC011
     I            DS                                                      CSC011
      ** Data Structure to separate time for correct timestamp            CSC011
      **                                                                  CSC011
     I                                        1   8 WTSTM                 CSC011
     I                                        1   2 WTSHR                 CSC011
     I                                        3   4 WTSMN                 CSC011
     I                                        5   6 WTSSC                 CSC011
      *                                                                   CSC011
     ISC24X7    E DSSC24X7                                                CSC011
      * 24X7 Data Structure                                               CSC011
      *                                                                   CSC011
     ISDSTAT    E DSSDSTAT                                                CSC011
      * SDSTAT Data Structure                                             CSC011
      *                                                                   CSC011
     I/COPY WNCPYSRC,LE2040I001
      *
     ISCSARD    E DSSCSARDPD
      ** SAR details
     I              LCD                             LCDX
      *
     IFLDTX       DS                                                      186431
      ** Data Structure for PF/LTRIX                                      186431
      *                                                                   186431
     I                                     *STATUS  TXSTS                 186431
      *                                                                   186431
     ISDBANK    E DSSDBANKPD
      ** Bank details
      *
     ISDCLND    E DSSDCLNDPD
      ** Customer lending ICD
      *
     ISDTRAD    E DSSDTRADPD
      ** Trading Details
      *
     ISDDEAL    E DSSDDEALPD
     I              QQACCD                          Q1ACCD                                    CGL029
      ** Dealing details
      *
     ISDCURR    E DSSDCURRPD
      ** Currency Details
      *
     ISDCUST    E DSSDCUSTPD
      ** Customer Details
      *
     ISDMMOD    E DSSDMMODPD
      ** Midas modules details
      *
     ISDRETL    E DSSDRETLPD
     I              QQACCD                          Q2ACCD                                    CGL029
      ** Retail ICD Details
      *
     ISDBSRT    E DSSDBSRTPD
      ** Base Rate Details
      *
     ISDLOAN    E DSSDLOANPD
      ** Loan Type/Subtype
      *
     ISDBRCH    E DSSDBRCHPD
     I              QQDFAC                          Q1DFAC                                    CGL029
      ** Branch Details
      *
     ISDPCAC    E DSSDPCACPD
      ** PCA ICD Details
      *
     ISDGELR    E DSSDGELRPD                                              CEU020
     I              QQACCD                          Q3ACCD                                    CGL029
      ** GL ICD Details                                                   CEU020
      *                                                                   CEU020
     ISDEXST    E DSSDEXSTPD                                              143071
      ** External DS for Extended settlement Instruction.                 143071
      *                                                                   143071
     ISDHEDG    E DSSDHEDGPD                                                                  232348
      ** External data structure for Midas Hedging ICD file                                   232348
      *                                                                                       232348
     IDSFDY     E DSDSFDY
      ** Short data structure for access objects
      *
     IDSSDY     E DSDSSDY
      ** Long data structure for access objects
      *                                                                   158177
      * DS for calculating PC reference                                   158177
     ILEALLO    E DSLEALLO                                                158177
      *
     ISETLIB    E DSSETLIAB
     I              QQPONS                          Q1PONS                                    CGL029
     I              QQRONS                          Q1RONS                                    CGL029
      ** data structure for passing a parameter to synon screen
      *  handling program.
      *
     ISETLIZ    E DSSETLIAZ
      ** data structure for passing a parameter to synon screen
      *  handling program.
     I@PARM3    E DSSDSETLPD                                                                  222373
      *
     ISDNOST    E DSSDNOSTPD                                              CLE009
     I              QQACCD                          Q4ACCD                                    CGL029
      *                                                                   CLE009
      ** Nostro details                                                   CLE009
      *                                                                   CLE009
     I/COPY WNCPYSRC,LEH00519
     ISDCWCD    E DSSDCWCDPD                                                                  CSD015
      ** Compliance Watch List Configuration Data                                             CSD015
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      ** Midas Functions for Watch List Checking Deatils File                                 CSD015
      *                                                                                       CSD015
     ICWLCDS    E DSSDWLTOPD                                                                  CSD015
      ** Watch List Tranaction Details File                                                   CSD015
      *                                                                                       CSD015
     IL2040F    E DSLE2040PD
     I              REXR                            REXRK                                     CLE031
     I              PEXR                            PEXRK                                     CLE031
     I              REXI                            REXIK                                     CLE031
     I              PEXI                            PEXIK                                     CLE031
      *
     I                                      229 469 WSSTL1
     I                                      470 717 WSSTL2
     I                                      718 788 WSSTL3
      *
     IL2040S      DS                            905
      *                                                                                       CLE148
      ** System value                                                                         CLE148
     I              'LoanAlphaAllow'      C         SYSVAL                                    CLE148
      *
     I/COPY QWINDSRC,LE2040GDTA
     I/COPY ZSRSRC,ZHOLI
     I/COPY ZSRSRC,ZTNLU1Z1
     I/COPY ZSRSRC,ZINTDYZ1                                               138866
     I/COPY ZSRSRC,ZDATE9Z2                                               138866
     I/COPY ZSRSRC,ZDAT10Z1                                               138866
      /EJECT
      *****************************************************************
      *                   Index to subroutines                        *
      *  Main routine                                                 *
      *  SRINIT  -  Initial processing                                *
      *  SRBTCH  -  Batch Processing                                  *
      *  SRSCWK  -  Save screen fields to work fields                 *   CAP061
      *  SRFISC  -  Move file fields to screen fields                 *   CAP061
      *  SRCOMP  -  Compare values of incoming fields with those      *   CAP061
      *             of saved values.                                  *   CAP061
      *  SRWTCH  -  Performs the Watch list processing.               *                       CSD015
      *  SRCWP2  -  Set up the 2nd parameter for Compliance Watch.    *                       CSD015
      *  SRBSET  -  Format Extended Settlement Fields for Batch/Play  *
      *  SRSTRT  -  Start of processing for Screen Validation         *
      *  SRVALI  -  Validate Initial Screen                           *
      *  SRSDET  -  Setup Detail Screens                              *
      *  SRINS1  -  Initialise all screen fields                      *
      *  SRMOVF  -  Move file fields to screen fields                 *
      *  SRDET1  -  First Detail Screen                               *
      *  SRDET2  -  Second Detail Screen                              *
      *  SRFXST  -  Format Extended Settlement Fields                 *
      *  SRWRIT  -  Write a new record in file                        *
      *  SRUPDT  -  Update record                                     *
      *  SRFEES  -  Update Fees File                                  *   CLE009
      *  SRSUBF  -  Subfile Processing                                *
      *  SRLOAD  -  Load subfile records                              *
      *  SRSINS  -  Initialise Subfile fields                         *
      *  SRSCLR  -  Subfile Clear                                     *
      *  SRSFMT  -  Format Subfile fields                             *
      *  SRSVAL  -  Subfile Validation                                *
      *  SRPROC  -  Subfile Detail Processing                         *
      *  SRSSET  -  Set-up other fields for Detail Processing         *
      *  SRREVW  -  Set Loan no. from Review from                     *
      *  SRSREV  -  Select records from Review fields                 *
      *  SRAUTH  -  Validate authorisation action                     *
      *  SRUAUT  -  Check if user is authorised to the action         *
      *  SRVALF  -  Validate Detail Screen Fields                     *
      *  SRTRAL  -  Update Loan Amendments Trailer File               *
      *  SRLTRX  -  Update Loan Transaction Index Detail (LTRIX)      *
      *  SRCLON  -  Update Customer Loan File                         *
      *  SRFCLT  -  Update Faclity File                               *
      *  SRUPCA  -  Update credit agreement/superfacility             *   CLE005
      *  SRSHAD  -  Retrieve parameter fields for Shadow Update       *
      *  SRUSHD  -  Update Shadow Record                              *
      *  SRLSPR  -  Loan Sub-Type Amendment Processing                *
      *  FCLTSR  -  Evaluate Facility Exposure                        *
      *  SRSETL  -  Set Up Data Received from SD2400                  *
      *  SRAVAL  -  Additional Validation Dependent on Settlement Ins.*
      *  QFCLTY  -  Update Exposure Array                             *
      *  SRSCP   -  Subroutine to process 'SC' loan amendment         *
      *  SRBCP   -  Subroutine to process 'BC' loan amendment         *
      *  SRTOLC  -  Subroutine to check funding rate/spread tolerance *
      *  SRTAMT  -  Accumulate total amount sold for the orig loan    *   149500
      *  SRWIND  -  Window Processing                                 *
      *  SREND   -  End program                                       *
      *  CLEAR   -  Clears message from the program message queue     *
      *  GLZADD  -  Subroutine to add an amount to the total          *
      *  GLZSUB  -  Subroutine to subtract an amount to the total     *
      *  GLZSUM  -  Subroutine to carry out the additon for subroutine*
      *  SRPOUT  -  Return message Format (For Batch only)            *
      *  SRWARN  -  Display warning message if loan is syndicated     *   159256
      *  ZASNMS  -  Sends message to the program message queue        *
      *  SRTEXT  -  Set up text from message file                     *   123998
      *  SRBERR  -  Sends error messages for Batch records            *
      *  *PSSR   -  Error handling subroutine                         *
      *****************************************************************
      *
      ** Perform initial processing
      *
     C                     EXSR SRINIT
      *
      ** Perform different detailed processing
      *
     C           WFMT      DOWNE*BLANK
     C           WFMT      CASEQ'F0'      SRSTRT
     C           WFMT      CASEQ'S0'      SRSUBF
     C           WFMT      CASEQ'D1'      SRDET1
     C           WFMT      CASEQ'D2'      SRDET2
     C           WFMT      CASEQ'WR'      SRWRIT
     C           WFMT      CASEQ'UP'      SRUPDT
     C           WFMT      CASEQ'DL'      SRDLT                           CAP061
     C                     ENDCS
     C                     ENDDO
      *                                                                                       CLE034
     C           CLE034    IFNE 'Y'                                                           CLE034
     C           SSTAL     ORNE 'Y'                                                           CLE034
      *
      ** Close SD2400 program and end this program's processing
      *
     C           PMODE     IFNE 'B'                                       119594
     C           PMODE     ANDNE'P'                                       119594
     C                     MOVE 'T'       PMTERM
     C                     CALL 'SD2400'
     C                     PARM           PRTCD
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           PSLNRF
     C                     PARM           @PARM3                                              222373
     C/COPY WNCPYSRC,LE2040C024
     C                     ENDIF                                          119594
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
     C           PMODE     IFNE 'B'                                                           227710
     C           PMODE     ANDNE'P'                                                           227710
     C                     ROLBK                                                              227710
     C                     ENDIF                                                              227710
      *
      ** Terminate program
      *
     C                     MOVE '1'       *INLR
      /EJECT
      *****************************************************************
      * SRINIT  -  Initial Processing                                 *
      * Called by: Main routine                                       *
      * Calls    : SRBTCH - Batch Processing                          *
      *            SRPOUT - Return message Format (For Batch only)    *
      *****************************************************************
     C           SRINIT    BEGSR
      *
      ** Set up copyright parameter
      *
     C                     MOVEACPY@      CPY2@  80
     C                     SETOF                     U7U8                                     219140
      *
     C                     MOVELWSID      W#JOB   7
      *
      ** Receive entry parameters
      *
     C           *ENTRY    PLIST
     C                     PARM           PMODE   1
     C                     PARM           PINPP
     C                     PARM           POUTP
     C                     PARM           PTMST  26                                           CLE034
      *
      ** Define dataara LDA
      *
     C           *NAMVAR   DEFN           LDA
     C*                                                                   CSC011
     C           *NAMVAR   DEFN           SDSTAT                          CSC011
     C*                                                                   CSC011
     C           *NAMVAR   DEFN           SC24X7                          CSC011
     C*                                                                   CSC011
      *
      ** Initialise LDA
      *
     C           *LOCK     IN   LDA
     C                     MOVEL'LE2040'  DBPGM
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD*ZEROS    DBASE
     C                     OUT  LDA
      *
      ** Retrieve bank details
      *
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANKS   PRTCD   7
     C                     PARM '*FIRST ' POPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBANKPD'DBFILE           ************
     C                     Z-ADD1         DBASE            * DBERR 01 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVELBJRDNB    RUND    50
     C                     MOVELBJLCCY    LOCY    3
     C                     Z-ADDBJBVPD    BVLP    30
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98            MMDDYY
     C                     ENDIF
      *
      ** Retrieve midas module details
      *
     C                     CALL 'AOCLNDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C********** SDCLND    PARM SDCLND    DSFDY                                               CLE134
     C           SDCLND    PARM SDCLND    DSSDY                                               CLE134
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCLNDPD'DBFILE           ************
     C                     Z-ADD2         DBASE            * DBERR 02 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *                                                                   123857
      ** Set on indicator that will disable F11 on auth. as needed        123857
      *                                                                   123857
     C           BPAURV    IFEQ 'Y'                                       123857
     C                     MOVE *ON       *IN81                           123857
     C                     ENDIF                                          123857
      *
      ** Retrieve Trading details
      *
     C                     CALL 'AOTRADR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDTRAD    PARM SDTRAD    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDTRADPD'DBFILE           ************
     C                     Z-ADD3         DBASE            * DBERR 03 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Retrieve Dealing details
      *
     C**********           CALL 'AODEALR0'                                                    CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C********** SDDEAL    PARM SDDEAL    DSFDY                                               CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDDEALPD'DBFILE           ************
     C                     Z-ADD4         DBASE            * DBERR 04 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Retrieve Local Currency details
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*BLANK  'PRTCD
     C                     PARM '*KEY    'POPTN
     C                     PARM LOCY      PCURR
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD5         DBASE            * DBERR 05 *
     C                     MOVELLOCY      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     Z-ADDA6TXND    TNOTL   10
      *
      ** Retrieve midas module details
      *
     C                     CALL 'AOMMODR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDMMODPD'DBFILE           ************
     C                     Z-ADD6         DBASE            * DBERR 06 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVELBGMBIN    MBIN    1
      *
      ** Retrieve retail details
      *
     C           BGRTBN    IFEQ 'Y'
     C                     CALL 'AORETLR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDRETL    PARM SDRETL    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDRETLPD'DBFILE           ************
     C                     Z-ADD7         DBASE            * DBERR 07 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     MOVE 'Y'       PMRETP
     C                     MOVE BMRANR    PMRETS
     C                     MOVELBMACCD    PMPCYA
     C                     ENDIF
     C/COPY WNCPYSRC,LE2040C008
      *
      ** Determine if Customer Lending Enhancements - Authorisation
      ** feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'CLE002'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE002  1
     C                     ELSE
     C                     MOVE 'N'       CLE002
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD8         DBASE            * DBERR 08 *
     C                     MOVEL'CLE002'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Determine if Customer Lending Enhancements - Backvaluations
      ** feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'CLE003'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE003  1
     C                     ELSE
     C                     MOVE 'N'       CLE003
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD9         DBASE            * DBERR 09 *
     C                     MOVEL'CLE003'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Determine if Customer Lending Enhancements - Syndications
      ** feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'CLE004'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE004  1
     C                     ELSE
     C                     MOVE 'N'       CLE004
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD10        DBASE            * DBERR 10 *
     C                     MOVEL'CLE004'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Determine if Customer Lending Enhancements - Others
      ** feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'CLE005'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE005  1
     C                     ELSE
     C                     MOVE 'N'       CLE005
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD11        DBASE            * DBERR 11 *
     C                     MOVEL'CLE005'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *                                                                   CLE009
     C                     CALL 'AOSARDR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*KEY   ' POPTN                           CLE009
     C                     PARM 'CLE007'  PSARD   6                       CLE009
     C           SCSARD    PARM SCSARD    DSFDY                           CLE009
     C           PRTCD     IFEQ *BLANKS                                   CLE009
     C                     MOVE 'Y'       CLE007  1                       CLE009
     C                     CALL 'AOSARDR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*KEY   ' POPTN                           CLE009
     C                     PARM 'CLE009'  PSARD   6                       CLE009
     C           SCSARD    PARM SCSARD    DSFDY                           CLE009
      *                                                                   CLE009
      ** If CLE009 is installed, fill currency and their corresponding    CLE009
      ** telex notice days arrays                                         CLE009
      *                                                                   CLE009
     C           PRTCD     IFEQ *BLANKS                                   CLE009
     C                     MOVE 'Y'       CLE009  1                       CLE009
     C                     Z-ADD1         X       30                      CLE009
      *                                                                   CLE009
     C                     CALL 'AOCURRR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*FIRST ' POPTN                           CLE009
     C                     PARM           PCURR   3                       CLE009
     C           SDCURR    PARM SDCURR    DSSDY                           CLE009
      *                                                                   CLE009
     C                     MOVE A6CYCD    CYA,X                           CLE009
     C                     MOVE A6TXND    TND,X                           CLE009
      *                                                                   CLE009
     C           PRTCD     DOWNE'*EOF    '                                CLE009
     C                     ADD  1         X                               CLE009
      *                                                                   CLE009
     C                     CALL 'AOCURRR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*NEXT  ' POPTN                           CLE009
     C                     PARM           PCURR   3                       CLE009
     C           SDCURR    PARM SDCURR    DSSDY                           CLE009
      *                                                                   CLE009
     C           PRTCD     IFNE '*EOF    '                                CLE009
     C                     MOVE A6CYCD    CYA,X                           CLE009
     C                     MOVE A6TXND    TND,X                           CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDDO                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'N'       CLE009                          CLE009
      *                                                                   CLE009
     C           PRTCD     IFNE '*NRF    '                                CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE009
     C                     Z-ADD50        DBASE            * DBERR 50 *   CLE009
     C                     MOVEL'CLE009'  DBKEY            ************   CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'N'       CLE007                          CLE009
     C           PRTCD     IFNE '*NRF    '                                CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE009
     C                     Z-ADD51        DBASE            * DBERR 51 *   CLE009
     C                     MOVEL'CLE007'  DBKEY            ************   CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                                       CLE033
      ** Access Switchable Feature Details (CLE033)                                           CLE033
      *                                                                                       CLE033
     C                     MOVE 'N'       CLE033  1                                           CLE033
      *                                                                                       CLE033
     C                     CALL 'AOSARDR0'                                                    CLE033
     C                     PARM *BLANKS   @RTCD                                               CLE033
     C                     PARM '*VERIFY '@OPTN                                               CLE033
     C                     PARM 'CLE033'  @SARD                                               CLE033
      *                                                                                       CLE033
     C           @RTCD     IFEQ *BLANKS                                                       CLE033
     C                     MOVE 'Y'       CLE033                                              CLE033
     C                     ENDIF                                                              CLE033
      *
     C                     CALL 'AOSARDR0'                                CEU004
     C                     PARM *BLANKS   PRTCD                           CEU004
     C                     PARM '*KEY   ' POPTN                           CEU004
     C                     PARM 'CEU004'  PSARD   6                       CEU004
     C           SCSARD    PARM SCSARD    DSFDY                           CEU004
     C           PRTCD     IFEQ *BLANKS                                   CEU004
     C                     MOVE 'Y'       CEU004  1                       CEU004
     C                     ELSE                                           CEU004
     C                     MOVE 'N'       CEU004                          CEU004
     C           PRTCD     IFNE '*NRF    '                                CEU004
     C           *LOCK     IN   LDA                                       CEU004
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU004
     C                     Z-ADD42        DBASE            * DBERR 42 *   CEU004
     C                     MOVEL'CEU004'  DBKEY            ************   CEU004
     C                     OUT  LDA                                       CEU004
     C                     EXSR *PSSR                                     CEU004
     C                     ENDIF                                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
      ** Access SAR details file to see if Customer Lending                                   CLE031
      ** Enhancements - settlement of other currencies allowed.                               CLE031
      *                                                                                       CLE031
     C                     CALL 'AOSARDR0'                                                    CLE031
     C                     PARM *BLANK    PRTCD                                               CLE031
     C                     PARM '*KEY   ' POPTN                                               CLE031
     C                     PARM 'CLE031'  PSARD   6                                           CLE031
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE031
      *                                                                                       CLE031
     C                     MOVE 'N'       CLE031                                              CLE031
     C           PRTCD     IFEQ *BLANK                                                        CLE031
     C                     MOVE 'Y'       CLE031  1                                           CLE031
     C                     ELSE                                                               CLE031
     C           PRTCD     IFNE '*NRF   '                                                     CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'SCSARDPD'DBFILE           ************                       CLE031
     C                     Z-ADD13        DBASE            * DBERR 13 *                       CLE031
     C                     MOVEL'CLE031'  DBKEY            ************                       CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                   CEU020
     C                     CALL 'AOSARDR0'                                CEU020
     C                     PARM *BLANKS   PRTCD                           CEU020
     C                     PARM '*VERIFY' POPTN                           CEU020
     C                     PARM 'CEU020'  PSARD   6                       CEU020
     C           SCSARD    PARM SCSARD    DSFDY                           CEU020
     C           PRTCD     IFEQ *BLANKS                                   CEU020
     C                     MOVE 'Y'       CEU020  1                       CEU020
     C                     ELSE                                           CEU020
     C                     MOVE 'N'       CEU020                          CEU020
     C           PRTCD     IFNE '*NRF    '                                CEU020
     C           *LOCK     IN   LDA                                       CEU020
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU020
     C                     Z-ADD43        DBASE            * DBERR 43 *   CEU020
     C                     MOVEL'CEU020'  DBKEY            ************   CEU020
     C                     OUT  LDA                                       CEU020
     C                     EXSR *PSSR                                     CEU020
     C                     ENDIF                                          CEU020
     C                     ENDIF                                          CEU020
     C/COPY WNCPYSRC,LE2040C013
      *                                                                   CEU020
      ** Access General Ledger Details if CEU020 is on                    CEU020
      *                                                                   CEU020
     C           CEU020    IFEQ 'Y'                                       CEU020
      *                                                                   CEU020
     C**********           CALL 'AOGELRR0'                                CEU020              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   PRTCD                           CEU020
     C                     PARM '*FIRST ' POPTN                           CEU020
     C********** SDGELR    PARM SDGELR    DSFDY                           CEU020              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *                                                                   CEU020
     C           PRTCD     IFNE *BLANKS                                   CEU020
     C           *LOCK     IN   LDA                                       CEU020
     C                     MOVEL'*FIRST'  DBKEY            ************   CEU020
     C                     MOVEL'SDGELRPD'DBFILE           ************   CEU020
     C                     Z-ADD44        DBASE            * DBERR 44 *   CEU020
     C                     OUT  LDA                        ************   CEU020
     C                     EXSR *PSSR                                     CEU020
     C                     ENDIF                                          CEU020
     C                     ENDIF                                          CEU020
      *                                                                   CEU020
      ** Determine if Data Export for CCRM Limits is active               CDE001
      *                                                                   CDE001
     C                     CALL 'AOSARDR0'                                CDE001
     C                     PARM *BLANKS   PRTCD                           CDE001
     C                     PARM '*VERIFY' POPTN                           CDE001
     C                     PARM 'CDE001'  PSARD                           CDE001
     C           PRTCD     IFEQ *BLANKS                                   CDE001
     C                     MOVE 'Y'       CDE001  1                       CDE001
     C                     ELSE                                           CDE001
     C                     MOVE 'N'       CDE001                          CDE001
     C           PRTCD     IFNE '*NRF    '                                CDE001
     C           *LOCK     IN   LDA                                       CDE001
     C                     MOVEL'SCSARDPD'DBFILE           ************   CDE001
     C                     Z-ADD45        DBASE            * DBERR 45 *   CDE001
     C                     MOVEL'CDE001'  DBKEY            ************   CDE001
     C                     OUT  LDA                                       CDE001
     C                     EXSR *PSSR                                     CDE001
     C                     ENDIF                                          CDE001
     C                     ENDIF                                          CDE001
      *                                                                   CDE002
      ** Access SAR details file to determine if CDE002 is switched on    CDE002
      *                                                                   CDE002
     C                     CALL 'AOSARDR0'                                CDE002
     C                     PARM *BLANKS   PRTCD   7                       CDE002
     C                     PARM '*VERIFY' POPTN   7                       CDE002
     C                     PARM 'CDE002'  PSARD   6                       CDE002
     C           SCSARD    PARM SCSARD    DSFDY                           CDE002
      *                                                                   CDE002
     C                     MOVE 'N'       CDE002  1                       CDE002
     C           PRTCD     IFEQ *BLANKS                                   CDE002
     C                     MOVE 'Y'       CDE002                          CDE002
     C                     ENDIF                                          CDE002
      *                                                                   CLE014
      ** Check if CLE014 is installed                                     CLE014
      *                                                                   CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM *BLANKS   PRTCD                           CLE014
     C                     PARM '*VERIFY' POPTN                           CLE014
     C                     PARM 'CLE014'  PSARD                           CLE014
      *                                                                   CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CLE014  1                       CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CLE014                          CLE014
     C           PRTCD     IFNE '*NRF    '                                CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVEL'SCSARDPD'DBFILE                          CLE014
     C                     Z-ADD53        DBASE                           CLE014
     C                     MOVEL'CLE014'  DBKEY                           CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                                       CLE023
      ** Check if CLE023 is installed.                                                        CLE023
      *                                                                                       CLE023
     C                     CALL 'AOSARDR0'                                                    CLE023
     C                     PARM *BLANKS   PRTCD                                               CLE023
     C                     PARM '*VERIFY' POPTN                                               CLE023
     C                     PARM 'CLE023'  PSARD                                               CLE023
      *                                                                                       CLE023
     C           PRTCD     IFEQ *BLANKS                                                       CLE023
     C                     MOVE 'Y'       CLE023  1                                           CLE023
     C                     ELSE                                                               CLE023
     C                     MOVE 'N'       CLE023                                              CLE023
     C           PRTCD     IFNE '*NRF    '                                                    CLE023
     C           *LOCK     IN   LDA                                                           CLE023
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE023
     C                     Z-ADD55        DBASE                                               CLE023
     C                     MOVEL'CLE023'  DBKEY                                               CLE023
     C                     OUT  LDA                                                           CLE023
     C                     EXSR *PSSR                                                         CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE034
      ** Check if CLE034 is installed.                                                        CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSARDR0'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM '*VERIFY' POPTN                                               CLE034
     C                     PARM 'CLE034'  PSARD                                               CLE034
      *                                                                                       CLE034
     C           PRTCD     IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'Y'       CLE034  1                                           CLE034
     C                     MOVEL*ON       *IN76                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'N'       CLE034                                              CLE034
     C                     MOVEL*OFF      *IN76                                               CLE034
     C           PRTCD     IFNE '*NRF    '                                                    CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE034
     C                     Z-ADD56        DBASE                                               CLE034
     C                     MOVEL'CLE034'  DBKEY                                               CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Check if CLE036 is installed.                                                        CLE036
      *                                                                                       CLE036
     C                     CALL 'AOSARDR0'                                                    CLE036
     C                     PARM *BLANKS   PRTCD                                               CLE036
     C                     PARM '*VERIFY' POPTN                                               CLE036
     C                     PARM 'CLE036'  PSARD                                               CLE036
      *                                                                                       CLE036
     C           PRTCD     IFEQ *BLANKS                                                       CLE036
     C                     MOVE 'Y'       CLE036  1                                           CLE036
     C                     MOVEL*ON       *IN05                                               CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE 'N'       CLE036                                              CLE036
     C           PRTCD     IFNE '*NRF    '                                                    CLE036
     C           *LOCK     IN   LDA                                                           CLE036
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE036
     C                     Z-ADD57        DBASE                                               CLE036
     C                     MOVEL'CLE036'  DBKEY                                               CLE036
     C                     OUT  LDA                                                           CLE036
     C                     EXSR *PSSR                                                         CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
      ** Check if CLE038 is installed.                                                        CLE038
      *                                                                                       CLE038
     C                     CALL 'AOSARDR0'                                                    CLE038
     C                     PARM *BLANKS   PRTCD                                               CLE038
     C                     PARM '*VERIFY' POPTN                                               CLE038
     C                     PARM 'CLE038'  PSARD                                               CLE038
      *                                                                                       CLE038
     C           PRTCD     IFEQ *BLANKS                                                       CLE038
     C                     MOVE 'Y'       CLE038  1                                           CLE038
     C                     ELSE                                                               CLE038
     C                     MOVE 'N'       CLE038                                              CLE038
     C           PRTCD     IFNE '*NRF    '                                                    CLE038
     C           *LOCK     IN   LDA                                                           CLE038
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE038
     C                     Z-ADD58        DBASE                                               CLE038
     C                     MOVEL'CLE038'  DBKEY                                               CLE038
     C                     OUT  LDA                                                           CLE038
     C                     EXSR *PSSR                                                         CLE038
     C                     ENDIF                                                              CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
     C/COPY WNCPYSRC,LE2040C027
      *                                                                                       CSD015
      ** Determine if Compliance Watch Enhancedment - CSD015                                  CSD015
      ** feature is installed.                                                                CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY 'POPTN                                               CSD015
     C                     PARM 'CSD015'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD56        DBASE                                               CSD015
     C                     MOVEL'CSD015'  DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015  1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'N'       CSD015                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Determine if Function Code is being monitored by                                     CSD015
      ** Compliance Watch.                                                                    CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*KEY    'POPTN                                               CSD015
     C                     PARM 'LENDING 'PFUNC   8                                           CSD015
     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SDWLCCPD'DBFILE                                              CSD015
     C                     Z-ADD57        DBASE                                               CSD015
     C                     MOVELPFUNC     DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCWCDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*FIRST  'POPTN                                               CSD015
     C           SDCWCD    PARM SDCWCD    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SDCWCDPD'DBFILE                                              CSD015
     C                     Z-ADD59        DBASE                                               CSD015
     C                     MOVELPOPTN     DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Determine if Cncord Interface Development  - CCF001                                  CSD015
      ** feature is installed.                                                                CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY 'POPTN                                               CSD015
     C                     PARM 'CCF001'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD58        DBASE                                               CSD015
     C                     MOVEL'CCF001'  DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CCF001  1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'N'       CCF001                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      *                                                                   CDE001
      ** Check if authorisation is required
      *
     C           BPLMAU    IFEQ 'Y'
     C           CLE002    ANDEQ'Y'                                       155610
     C                     MOVE '1'       *IN29
     C                     ENDIF
     C/COPY WNCPYSRC,LE2040C001
      *
      **  If Analytical Accounting Module is switched on, access
      **  profit centre accounting details
      *
     C           BGN0ST    IFEQ 'Y'
     C                     CALL 'AOPCACR0'
     C                     PARM '*DBERR  'PRTCD
     C                     PARM '*FIRST  'POPTN
     C           SDPCAC    PARM SDPCAC    DSFDY
     C                     ENDIF
      *                                                                   CAP061
      ** Determine if Customer Lending Enhancements - Lending API         CAP061
      ** enhancements feature is installed                                CAP061
      *                                                                   CAP061
     C                     CALL 'AOSARDR0'                                CAP061
     C                     PARM *BLANKS   PRTCD                           CAP061
     C                     PARM '*KEY   ' POPTN                           CAP061
     C                     PARM 'CAP061'  PSARD   6                       CAP061
     C           SCSARD    PARM SCSARD    DSFDY                           CAP061
     C           PRTCD     IFEQ *BLANKS                                   CAP061
     C                     MOVE 'Y'       CAP061  1                       CAP061
     C                     ELSE                                           CAP061
     C                     MOVE 'N'       CAP061                          CAP061
     C           PRTCD     IFNE '*NRF    '                                CAP061
     C           *LOCK     IN   LDA                                       CAP061
     C                     MOVEL'SCSARDPD'DBFILE           ************   CAP061
     C                     Z-ADD47        DBASE            * DBERR 47 *   CAP061
     C                     MOVEL'CAP061'  DBKEY            ************   CAP061
     C                     OUT  LDA                                       CAP061
     C                     EXSR *PSSR                                     CAP061
     C                     ENDIF                                          CAP061
     C                     ENDIF                                          CAP061
     C/COPY WNCPYSRC,LEH00581
      *                                                                                       207629
      ** Check System Value: Use Original Borrower or Purchased From?                         207629
      ** Set up parameter so access object checks LoanCustOriginPurch                         207629
     C                     MOVE *BLANKS   WPARM                                               207629
     C                     MOVEL'LoanC'   WPARM1                                              207629
     C                     MOVEL'ustOr'   WPARM2                                              207629
     C                     MOVEL'iginP'   WPARM3                                              207629
     C                     MOVEL'urch'    WPARM4                                              207629
     C                     MOVELWPARM     SVALK1                                              207629
      * Call Access object:                                                                   207629
     C                     CALL 'AOSVALR0'                                                    207629
     C                     PARM           RTNCDE  7                                           207629
     C                     PARM           SVALK1 20                                           207629
     C                     PARM           SVAL1 200                                           207629
     C                     PARM           SVALK2 20                                           207629
     C                     PARM           SVAL2 200                                           207629
     C                     PARM           SVALK3 20                                           207629
     C                     PARM           SVAL3 200                                           207629
     C                     PARM           SVALK4 20                                           207629
     C                     PARM           SVAL4 200                                           207629
     C                     PARM           SVALK5 20                                           207629
     C                     PARM           SVAL5 200                                           207629
     C                     PARM           SVALK6 20                                           207629
     C                     PARM           SVAL6 200                                           207629
     C                     PARM           SVALK7 20                                           207629
     C                     PARM           SVAL7 200                                           207629
     C                     PARM           SVALK8 20                                           207629
     C                     PARM           SVAL8 200                                           207629
     C                     PARM           SVALK9 20                                           207629
     C                     PARM           SVAL9 200                                           207629
     C                     PARM           SVALK0 20                                           207629
     C                     PARM           SVAL10200                                           207629
      * If the system value is not found then issue a database error                          207629
      * unless batch mode, in which case default value to 'P'                                 216067
     C           RTNCDE    IFNE '        '                                                    207629
     C           PMODE     IFEQ 'B'                                                           216067
     C                     MOVE 'P'       PPCUST                                              216067
     C                     ELSE                                                               216067
     C           *LOCK     IN   LDA                                                           207629
     C                     MOVEL'SDSVALPD'DBFILE           ************                       207629
     C                     Z-ADD46        DBASE            * DBERR 46 *                       207629
     C                     MOVEL'SVALK1'  DBKEY            ************                       207629
     C                     OUT  LDA                                                           207629
     C                     EXSR *PSSR                                                         207629
     C                     ENDIF                                                              216067
     C                     ELSE                                                               207629
      * Isolate the first character of SVAL1 which = 'P' or 'O'.                              207629
     C                     MOVELSVAL1     WRK01   1        1 character fld                    207629
     C           WRK01     IFEQ 'O'                                                           207629
     C                     MOVE 'O'       PPCUST  1                                           207629
     C                     ELSE                                                               207629
     C                     MOVE 'P'       PPCUST                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
      *                                                                   134799
     C                     Z-ADD0         W#CNT                           134799
      *                                                                   CSC011
      ** Determine if 24x7 Midas Availability active?                     CSC011
      *                                                                   CSC011
     C                     CALL 'AOSARDR0'                                CSC011
     C                     PARM *BLANKS   PRTCD                           CSC011
     C                     PARM '*VERIFY' POPTN                           CSC011
     C                     PARM 'CSC011'  PSARD                           CSC011
     C           PRTCD     IFEQ *BLANKS                                   CSC011
     C                     MOVE 'Y'       CSC011  1                       CSC011
     C                     ELSE                                           CSC011
     C                     MOVE 'N'       CSC011                          CSC011
     C           PRTCD     IFNE '*NRF    '                                CSC011
     C           *LOCK     IN   LDA                                       CSC011
     C                     MOVEL'SCSARDPD'DBFILE           ************   CSC011
     C                     Z-ADD17        DBASE            * DBERR 17 *   CSC011
     C                     MOVEL'CSC011'  DBKEY            ************   CSC011
     C                     OUT  LDA                                       CSC011
     C                     EXSR *PSSR                                     CSC011
     C                     ENDIF                                          CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C*                                                                   CSC011
     C* Is the support system on?                                         CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     Z-ADDS1DATE    WRNDAY  60                      CSC011
     C                     ELSE                                           CSC011
     C                     MOVE BJRDNB    WRNDAY                          CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
      ** Determine if Flat Rate Personal Loans (Rule of 78s) is                               CLE028
      ** installed                                                                            CLE028
      *                                                                                       CLE028
     C                     CALL 'AOSARDR0'                                                    CLE028
     C                     PARM *BLANKS   PRTCD                                               CLE028
     C                     PARM '*VERIFY' POPTN                                               CLE028
     C                     PARM 'CLE028'  PSARD                                               CLE028
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE028
      *                                                                                       CLE028
     C           PRTCD     IFNE *BLANKS                                                       CLE028
     C           PRTCD     ANDNE'*NRF   '                                                     CLE028
     C           *LOCK     IN   LDA                                                           CLE028
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE028
     C                     Z-ADD54        DBASE                                               CLE028
     C                     MOVELPSARD     DBKEY                                               CLE028
     C                     OUT  LDA                                                           CLE028
     C                     EXSR *PSSR                                                         CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           PRTCD     IFEQ *BLANKS                                                       CLE028
     C                     MOVE 'Y'       CLE028  1                                           CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE 'N'       CLE028                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CAS009
      ** Determine if SAR CAS009 is installed                                                 CAS009
      *                                                                                       CAS009
     C                     CALL 'AOSARDR0'                                                    CAS009
     C                     PARM *BLANKS   @RTCD                                               CAS009
     C                     PARM '*VERIFY '@OPTN                                               CAS009
     C                     PARM 'CAS009'  @SARD                                               CAS009
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS009
      *                                                                                       CAS009
     C           @RTCD     IFNE *BLANKS                                                       CAS009
     C           @RTCD     ANDNE'*NRF   '                                                     CAS009
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS009
     C                     Z-ADD67        DBASE                                               CAS009
     C                     MOVEL'CAS009'  DBKEY                                               CAS009
     C                     EXSR *PSSR                                                         CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           @RTCD     IFEQ *BLANKS                                                       CAS009
     C                     MOVE 'Y'       CAS009  1                                           CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE 'N'       CAS009                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       232348
      ** Access object for Hedge ICD                                                          232348
      *                                                                                       232348
     C           CAS009    IFEQ 'Y'                                                           232348
     C                     CALL 'AOHEDGR0'                                                    232348
     C                     PARM *BLANKS   @RTCD                                               232348
     C                     PARM '*VERIFY '@OPTN                                               232348
     C           SDHEDG    PARM SDHEDG    DSFDY                                               232348
      *                                                                                       232348
     C           @RTCD     IFNE *BLANKS                                                       232348
     C           *LOCK     IN   LDA                                                           232348
     C                     MOVEL'SDHEDGPD'DBFILE                                              232348
     C                     Z-ADD68        DBASE                                               232348
     C                     MOVEL@OPTN     DBKEY                                               232348
     C                     OUT  LDA                                                           232348
     C                     EXSR *PSSR                                                         232348
     C                     ENDIF                                                              232348
     C                     ENDIF                                                              232348
     C/COPY WNCPYSRC,LEH00520
      *                                                                                       CLE148
      ** Check System Value: LoanAlphaAllow                                                   CLE148
      *                                                                                       CLE148
     C                     MOVEL*BLANKS   SVALK1                                              CLE148
     C                     MOVELSYSVAL    SVALK1                                              CLE148
      *                                                                                       CLE148
     C                     CALL 'AOSVALR0'                                                    CLE148
     C                     PARM           RTNCDE  7                                           CLE148
     C                     PARM           SVALK1 20                                           CLE148
     C                     PARM           SVAL1 200                                           CLE148
     C                     PARM           SVALK2 20                                           CLE148
     C                     PARM           SVAL2 200                                           CLE148
     C                     PARM           SVALK3 20                                           CLE148
     C                     PARM           SVAL3 200                                           CLE148
     C                     PARM           SVALK4 20                                           CLE148
     C                     PARM           SVAL4 200                                           CLE148
     C                     PARM           SVALK5 20                                           CLE148
     C                     PARM           SVAL5 200                                           CLE148
     C                     PARM           SVALK6 20                                           CLE148
     C                     PARM           SVAL6 200                                           CLE148
     C                     PARM           SVALK7 20                                           CLE148
     C                     PARM           SVAL7 200                                           CLE148
     C                     PARM           SVALK8 20                                           CLE148
     C                     PARM           SVAL8 200                                           CLE148
     C                     PARM           SVALK9 20                                           CLE148
     C                     PARM           SVAL9 200                                           CLE148
     C                     PARM           SVALK0 20                                           CLE148
     C                     PARM           SVAL10200                                           CLE148
      *                                                                                       CLE148
      ** If the system value is not found then issue a database error                         CLE148
      *                                                                                       CLE148
     C           RTNCDE    IFNE '        '                                                    CLE148
     C           *LOCK     IN   LDA                                                           CLE148
     C                     MOVEL'SDSVALPD'DBFILE                                              CLE148
     C                     Z-ADD48        DBASE                                               CLE148
     C                     MOVEL'SVALK1'  DBKEY                                               CLE148
     C                     OUT  LDA                                                           CLE148
     C                     EXSR *PSSR                                                         CLE148
      *                                                                                       CLE148
     C                     ELSE                                                               CLE148
     C                     MOVELSVAL1     WALLOW  1                                           CLE148
     C                     ENDIF                                                              CLE148
      *                                                                                       CLE134
      ** CLE134 - Past Due Call Loans                                                         CLE134
      *                                                                                       CLE134
     C                     MOVE 'N'       CLE134  1                                           CLE134
     C                     CALL 'AOSARDR0'                                                    CLE134
     C                     PARM *BLANKS   @RTCD                                               CLE134
     C                     PARM '*VERIFY '@OPTN                                               CLE134
     C                     PARM 'CLE134'  @SARD                                               CLE134
      *                                                                                       CLE134
     C           @RTCD     IFEQ *BLANKS                                                       CLE134
     C                     MOVE 'Y'       CLE134                                              CLE134
     C                     ENDIF                                                              CLE134
      *
      ** Set up key fields
      *
     C           KLAKEY    KLIST
     C**********           KFLD           WKLNR   60                                          CLE148
     C                     KFLD           WKLNR   6                                           CLE148
     C                     KFLD           WKVDT   50
     C                     KFLD           WKLSN   30
      *
     C           KLKEY     KLIST
     C                     KFLD           WKLNR
     C                     KFLD           WRCDT   1
      *
     C           KFCLT     KLIST
     C**********           KFLD           WFCNM   60                                          CSD027
     C                     KFLD           WFCNM   6                                           CSD027
     C                     KFLD           WFACT   30
     C                     KFLD           WFNUM   20
     C                     KFLD           WFRTP   1
      *
     C           KLELOM    KLIST
     C**********           KFLD           WMLNO   60                                          CLE148
     C                     KFLD           WMLNO   6                                           CLE148
     C                     KFLD           WMVDT   50
     C                     KFLD           WMLSN   30
      *                                                                                       CLE134
     C           KLOAN     KLIST                                                              CLE134
     C                     KFLD           WKLN2   6                                           CLE134
      *                                                                   CLE003
      ** KLIST for Base Rate History File                                 CLE003
      *                                                                   CLE003
     C           BCKEY     KLIST                                          CLE003
     C                     KFLD           CRCY                            CLE003
     C                     KFLD           BCCOD                           CLE003
      *                                                                   157303
      ** Keylist for facility amendments file                             157303
      *                                                                   157303
     C           KEYFLA    KLIST                                          157303
     C                     KFLD           WFCNM                           157303
     C                     KFLD           WFACT                           157303
     C                     KFLD           WFNUM                           157303
      *                                                                   115570
     C           K#LM11    KLIST                                          115570
     C**********           KFLD           WKLNR   60                                   115570 CLE148
     C                     KFLD           WKLNR   6                                           CLE148
     C                     KFLD           WKVDT   50                      115570
      *                                                                   CLE009
      ** Keylist for loan amendment fee index file                        CLE009
      *                                                                   CLE009
     C           KIDXF     KLIST                                          CLE009
     C**********           KFLD           WKLOAN  60                                   CLE009 CLE148
     C                     KFLD           WKLOAN  6                                           CLE148
     C                     KFLD           WKDAY   50                      CLE009
     C                     KFLD           WKSEQN  30                      CLE009
      *                                                                   CLE009
      ** Key list for Fees file                                           CLE009
      *                                                                   CLE009
     C           WKFEE     KLIST                                          CLE009
     C**********           KFLD           WFCNM   60                                   CLE009 CSD027
     C                     KFLD           WFCNM   6                                           CSD027
     C                     KFLD           WFFACL  50                      CLE009
     C**********           KFLD           WFLOAN  60                                   CLE009 CLE148
     C                     KFLD           WFLOAN  6                                           CLE148
      *                                                                   CSC011
      **  Used for APILOGL0                                               CSC011
      *                                                                   CSC011
     C           KAPLOG    KLIST                                          CSC011
     C                     KFLD           KMTYPE  8                       CSC011
     C                     KFLD           KFOID  20                       CSC011
     C                     KFLD           KTSTMP 26                       CSC011
     C/COPY WNCPYSRC,LEH00521
      *                                                                   CSC011
      **  Used for Compliance Watch                                                           CSD015
      *                                                                                       CSD015
     C           KCWHT     KLIST                                                              CSD015
     C                     KFLD           KFUNT   8                                           CSD015
     C                     KFLD           KIDEN  40                                           CSD015
     C                     KFLD           KBRCH   3                                           CSD015
      *
     C                     BITOF'01234567'BIT     1
     C                     MOVEL'LERMSGF 'ZAMSGF
      *
      ** Check mode of processing
      *
     C           PMODE     IFEQ 'F'                                       CAP061
     C                     OPEN LEILAML1                                  CAP061
     C                     OPEN LEILAML2                                  CAP061
     C                     OPEN LEILAMLX                                  CAP061
     C                     OPEN LE2040DF                                  CAP061
     C                     MOVE 'S0'      WFMT                            CAP061
     C                     SETON                     60                   CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C                     OPEN LE2040DF
     C                     MOVEL'F0'      WFMT    2
     C                     ENDIF
      *
     C                     MOVE *BLANK    WMTYP   4
      *
     C           PIMTYP    IFEQ 'LABC'
     C           PIMTYP    OREQ 'LALS'
     C           PIMTYP    OREQ 'LAPF'
     C           PIMTYP    OREQ 'LAPI'
     C           PIMTYP    OREQ 'LAPT'
     C           PIMTYP    OREQ 'LASA'
     C           PIMTYP    OREQ 'LASC'
     C           PIMTYP    OREQ 'LAPD'                                                        227165
     C                     MOVELPIMTYP    WMTYP
     C                     ENDIF
      *
     C           PMODE     IFEQ 'R'
     C           PMODE     OREQ 'P'
     C                     OPEN LE2040PD
     C                     ENDIF
      *
     C           PMODE     IFEQ 'B'
     C           PMODE     OREQ 'P'
      *
     C           PMODE     IFEQ 'B'
      *
     C           CAP061    IFEQ 'Y'                                       CAP061
     C                     OPEN LEILAMPD                                  CAP061
     C                     OPEN LEILAMLX                                  CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C           PIMTYP    IFEQ 'LABC'
     C           PIMTYP    OREQ 'LALS'
     C           PIMTYP    OREQ 'LAPI'
     C           PIMTYP    OREQ 'LASA'
     C           PIMTYP    OREQ 'LASC'
     C**********           MOVEL'LALM'    @ZICDE                                              CSF002
     C                     MOVE '01809'   UNQCDE                                              CSF002
     C                     ELSE
     C**********           MOVEL'PTFT'    @ZICDE                                              CSF002
     C                     MOVE '01810'   UNQCDE                                              CSF002
     C                     ENDIF
     C**********           Z-ADD1         @ZMGRP                                              CSF002
     C                     MOVEL'00000'   UNQCDE                                              CSF002
     C                     MOVELPITUSR    @USER
     C                     ENDIF
      *
     C                     EXSR SRBTCH
      *                                                                   CDE001
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           CDE001    IFEQ 'Y'                                       CDE001
     C           AMTP      ANDNE'PT'                                      CDE001
     C           AMTP      ANDNE'PF'                                      CDE001
     C                     MOVELSLOAN     T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C                     PARM           T#TREF 20                       CDE001
     C                     PARM 'LOAN'    T#TCAT  4                       CDE001
     C                     PARM *BLANKS   RSRVID 10                       CDE005
     C                     ENDIF                                          CDE001
      *
     C           AMTP      IFNE 'PT'
     C           AMTP      ANDNE'PF'
     C           PMODE     ANDNE'B'                                       120002
     C                     COMIT
     C                     ENDIF
      *
      ** Return Message Format for Batch mode
      *
     C                     EXSR SRPOUT
      *                                                                   CAP061
      ** Call routine to output error detail to file                      CAP061
      *                                                                   CAP061
     C           CAP61E    IFEQ 'Y'                                       CAP061
     C           CAP061    ANDEQ'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C                     EXSR ERROUT                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     MOVE '1'       *INLR
     C                     RETRN
     C                     ENDIF
      *
     C                     MOVE '1'       *IN24
     C                     MOVEL'F0'      WWRTRN  2
     C           SACTN     IFEQ 'R'                                                           197031
     C           AMTP      ANDEQ'PI'                                                          197031
     C                     MOVE '0'       *IN15                           186706
     C                     ELSE                                                               197031
     C                     MOVE '1'       *IN15                                               197031
     C                     ENDIF                                                              197031
      *
     C/COPY WNCPYSRC,LE2040C031
     C                     ENDSR
     C/COPY WNCPYSRC,LE2040C018
      /EJECT
      *****************************************************************
      * SRBTCH  -  Batch Processing                                   *
      * Called by: Main routine                                       *
      * Calls    : SRINS1 - Initialise all screen fields              *
      *            SRFISC - Move file fields to screen fields         *   CAP061
      *            SRSCWK - Save screen fields to work fields         *   CAP061
      *            SRCOMP - Compare values of incoming fields with    *   CAP061
      *                     those of saved values.                    *   CAP061
      *            SRVALI - Validate Initial Screen                   *
      *            SRVALF - Validate Detail Screen Fields             *
      *            SRBSET - Format Extd. Settl. Fields for Batch/Play *
      *            SRWRIT - Write a new record in file                *
      *            SRUPDT - Update record                             *
      *****************************************************************
     C           SRBTCH    BEGSR
      *
     C           PMODE     IFEQ 'P'
     C                     READ LE2040PD                 79
     C                     ENDIF
      *
     C           *IN79     DOWEQ'0'
      *
      ** Initialise all screen and work fields
      *
     C                     EXSR SRINS1
      *
      ** Move file fields to screen fields if mode is PLAY
      *
     C           PMODE     IFEQ 'P'
      *
     C                     Z-ADDVDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     SVDAT
     C                     MOVE ACTN      SACTN
     C                     MOVE LNRF      SLOAN
     C           LASN      IFNE 0
     C                     MOVE LASN      SSEQN
     C                     ELSE
     C                     MOVE *BLANK    SSEQN
     C                     ENDIF
     C                     MOVE AMTP      SATYP
     C           PTYPA     IFEQ 64                                                            207629
     C           PTYPA     OREQ 65                                                            207629
     C           PTYPA     OREQ 68                                                            207629
     C           PTYPA     OREQ 71                                                            207629
      *If the loan is a Participation Purchased, & System Value                               207629
      * LoanCustOriginPurch = 'O', use Original Borrower:                                     207629
     C           PPCUST    IFEQ 'O'                                                           207629
     C                     MOVELOLNO      SCNUM                                               207629
      * Else, use 'Purchased from' customer number.                                           207629
     C                     ELSE                                                               207629
     C                     MOVELCNUM      SCNUM                                               207629
     C                     ENDIF                                                              207629
      * Else, loan is not a Part Purchased:                                                   207629
     C                     ELSE                                                               207629
     C                     MOVELCNUM      SCNUM
     C                     ENDIF                                                              207629
     C                     MOVE CCY       SCURR
     C           TAMT      IFNE 0
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*BLANK  'PRTCD
     C                     PARM '*KEY    'POPTN
     C                     PARM SCURR     PCURR
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD36        DBASE            * DBERR 36 *
     C                     MOVELCCY       DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE TAMT      ZFIELD
     C/COPY WNCPYSRC,LEH01119
     C                     Z-ADDA6NBDP    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SAMNT
     C                     ELSE
     C                     MOVE *BLANK    SAMNT
     C                     ENDIF
     C           BRTT      IFNE 0
     C                     MOVE BRTT      SBRAT
     C                     ELSE
     C                     MOVE *BLANK    SBRAT
     C                     ENDIF
     C           RTSP      IFNE 0
     C                     MOVE RTSP      SRTSP
     C                     ELSE
     C                     MOVE *BLANK    SRTSP
     C                     ENDIF
     C                     MOVE STAI      SSTPA
     C                     MOVE STAL      SSTAL                                               CLE034
     C           LSMD      IFNE 0
     C                     MOVE LSMD      SMDAT
     C                     ELSE
     C                     MOVE *BLANK    SMDAT
     C                     ENDIF
     C           FSRP      IFNE 0
     C                     MOVE FSRP      SFRAT
     C                     ELSE
     C                     MOVE *BLANK    SFRAT
     C                     ENDIF
     C                     MOVE LTYP      SLTYP
     C                     MOVE SUTP      SSTYP
     C                     MOVE DFTP      SDFTP
     C                     MOVE DFST      SDFST
     C                     MOVELSPI1      SSPI1
     C                     MOVELSPI2      SSPI2
     C                     MOVELSPI3      SSPI3
      *
      ** Save the whole test harness file
      *
     C                     MOVE L2040F    L2040S
      *
      ** Save Settlement details
      *
     C                     MOVE WSSTL1    WSAVS1241
     C                     MOVE WSSTL2    WSAVS2248
     C                     MOVE WSSTL3    WSAVS3 71
      *
     C                     ENDIF
      *
      ** If Mode = Batch, Action = Amend and CAP061 is on                 CAP061
      ** move file fields to screen fields.                               CAP061
      ** move screen fields to save fields.                               CAP061
      ** clear screen fields.                                             CAP061
      ** Should check repair location not mode !!                         202587
     C***********PMODE     IFEQ 'B'                                 CAP061202587
     C           PIPLC     IFEQ 'B'                                       202587
     C           PITACT    ANDEQ'A'                                       CAP061
     C           CAP061    ANDEQ'Y'                                       CAP061
     C                     EXSR SRFISC                                    CAP061
     C                     EXSR SRSCWK                                    CAP061
     C                     EXSR SRINS1                                    CAP061
     C                     ENDIF                                          CAP061
      *
      ** Move fields coming from input parameter in screen fields
      *
     C           PMODE     IFEQ 'B'
      *
     C                     MOVE PIVDAT    WPITDS
     C                     MOVELWPIDD     WFLD4   4
     C                     MOVE WPIMM     WFLD4
     C                     MOVELWFLD4     WFLD6   6
     C                     MOVE WPIYY     WFLD6
     C                     MOVELWFLD6     SVDAT
      *
     C           PITACT    IFEQ 'I'
     C                     SELEC
     C           WMTYP     WHEQ 'LABC'
     C                     MOVE 'BC'      SATYP
     C           WMTYP     WHEQ 'LALS'
     C                     MOVE 'LS'      SATYP
     C           WMTYP     WHEQ 'LAPI'
     C                     MOVE 'PI'      SATYP
     C           WMTYP     WHEQ 'LASA'
     C                     MOVE 'SA'      SATYP
     C           WMTYP     WHEQ 'LASC'
     C                     MOVE 'SC'      SATYP
     C                     ENDSL
     C                     ELSE
     C                     MOVE *BLANK    SATYP
     C                     ENDIF
      *
      ** For Transfer of Principal, amendment type is retrieved for types
      ** of actions
      *
     C           WMTYP     IFEQ 'LAPT'
     C                     MOVE 'PT'      SATYP
     C                     ENDIF
     C           WMTYP     IFEQ 'LAPF'
     C                     MOVE 'PF'      SATYP
     C                     ENDIF
      *
     C                     MOVE PITACT    SACTN
     C           PILOAN    IFEQ *BLANKS                                   210317
     C           PIXREF    CHAINCLOANL5              79                   210317
     C           *IN79     IFEQ *OFF                                      210317
     C                     MOVE LNRF      PILOAN                          210317
     C                     ENDIF                                          210317
     C                     ENDIF                                          210317
     C                     MOVE PILOAN    SLOAN
      *                                                                   CAP061
      ** If this is zero, blank it.                                       CAP061
      *                                                                   CAP061
     C           PIAMSQ    IFEQ '000'                                     CAP061
     C           CAP061    ANDEQ'Y'                                       CAP061
     C                     MOVE *BLANKS   SSEQN                           CAP061
     C                     ELSE                                           CAP061
     C                     MOVE PIAMSQ    SSEQN
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     MOVE PICSNO    SCNUM
     C                     MOVE PICURR    SCURR
     C                     MOVE PIPAMT    SAMNT
     C/COPY WNCPYSRC,LEH01120
      *                                                                   CAP061
      ** If this is zero, blank it.                                       CAP061
      *                                                                   CAP061
     C           PIBSRT    IFEQ '00'                                      CAP061
     C           CAP061    ANDEQ'Y'                                       CAP061
     C                     MOVE *BLANKS   SBRAT                           CAP061
     C                     ELSE                                           CAP061
     C                     MOVE PIBSRT    SBRAT
     C                     ENDIF                                          CAP061
     C                     MOVE PIRTSP    SRTSP
      *                                                                                       CLE036
      ** For a base rate change, do not allow a zero rate/spread field:                       CLE036
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C           SATYP     ANDEQ'BC'                                                          CLE036
     C                     Z-ADD*ZEROS    W1SPRT 117                                          CLE036
     C                     MOVE *BLANK    ZFIELD                                              CLE036
     C                     MOVELSRTSP     ZFIELD                                              CLE036
     C                     Z-ADD7         ZADEC                                               CLE036
     C                     Z-ADD4         ZADIG                                               CLE036
     C                     EXSR ZALIGN                                                        CLE036
     C                     MOVE ZFIELD    W1SPRT                                              CLE036
     C           W1SPRT    IFEQ *ZEROS                                                        CLE036
     C           *IN99     ANDEQ'0'                                                           CLE036
     C                     MOVE *BLANKS   SRTSP                                               CLE036
     C                     MOVE '1'       *IN39                                               CLE036
     C                     MOVEL'LEA0200' ZAMSID                                              CLE036
     C                     EXSR ZASNMS                                                        CLE036
      *                                                                                       CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     MOVE PISTAC    SSTPA
     C***********          MOVE PIMATD    SMDAT                           131209
      *                                                                   131209
     C                     MOVE PIMATD    WPITDS                          131209
     C                     MOVELWPIDD     WFLD4                           131209
     C                     MOVE WPIMM     WFLD4                           131209
     C                     MOVELWFLD4     WFLD6                           131209
     C                     MOVE WPIYY     WFLD6                           131209
     C                     MOVELWFLD6     SMDAT                           131209
      *                                                                   131209
     C                     MOVE PILTYP    SLTYP
     C                     MOVE PILSTP    SSTYP
     C                     MOVE PIFRAT    SFRAT
     C                     MOVE PIDFTP    SDFTP
     C                     MOVE PIDFST    SDFST
     C                     MOVE PISPI1    SSPI1
     C                     MOVE PISPI2    SSPI2
     C                     MOVE PISPI3    SSPI3
      *
     C                     MOVE PITUSR    WTUSR  16
     C                     MOVE PITWST    WTWST  16
     C                     MOVE PITREF    WTREF  15
     C                     MOVE PITSEQ    WTSEQ   4
     C                     MOVE PITDST    WTDST   8
     C                     MOVE PITTST    WTTST   8
     C                     MOVE PIVDAT    WPVDAT  8
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVELPISTAL    SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF
      *                                                                   CAP061
      ** Should check repair location not mode !!                         202587
     C***********PMODE     IFEQ 'B'                                 CAP061202587
     C           PIPLC     IFEQ 'B'                                       202587
     C           PITACT    ANDEQ'A'                                       CAP061
     C           CAP061    ANDEQ'Y'                                       CAP061
     C                     EXSR SRCOMP                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      *
      ** No validation for Principal Transfer
      *
     C           SATYP     IFNE 'PT'
     C           SATYP     ANDNE'PF'
      *
      ** Validate action code
      *
     C                     EXSR SRVALI
      *                                                                   CAP061
      ** Only proceed with processing if there was no error in            CAP061
      ** validation.                                                      CAP061
      *                                                                   CAP061
     C           CAP61E    IFEQ 'Y'                                       CAP061
     C           CAP061    ANDEQ'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C                     GOTO CP61ER                                    CAP061
     C                     ENDIF                                          CAP061
      *
      ** Retrieve Participant Facility indiator and its
      ** Prime customer no, faclity type and facility no.
      *
     C                     MOVELFCUSC     WFCNM
     C                     MOVELFTYPC     WFACT
     C                     MOVELFSEQC     WFNUM
     C                     MOVE 'A'       WFRTP
      *
     C           KFCLT     CHAINFCLTY               N79
      *
     C           *IN79     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE           ************
     C                     Z-ADD35        DBASE            * DBERR 35 *
     C                     MOVELFCLKEY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Chain to loan amendments file again to retrieve
      ** other information
      *
     C                     MOVE SLOAN     WKLNR
     C                     MOVE VDAYNO    WKVDT
     C                     MOVE SSEQN     WKLSN
      *
     C           KLAKEY    CHAINLOAMD                79
      *
      ** Validate detail screen
      *
     C           SACTN     IFEQ 'I'
     C                     EXSR SRVALF
     C                     ENDIF
      *                                                                                     AR632104
      **  Check on reverse action if loan type/subtype on loan level                        AR632104
      **  has undefined PDCL details.                                                       AR632104
      *                                                                                     AR632104
     C           CLE134    IFEQ 'Y'                                                         AR632104
     C                     MOVELLTYPA     WLTYP                                             AR632104
      *                                                                                     AR632104
     C           AUTOC     IFEQ 'C'                                                         AR632104
     C           WLTYP     ANDNE'X'                                                         AR632104
     C           WLTYP     ANDNE'Y'                                                         AR632104
     C           WLTYP     ANDNE'Z'                                                         AR632104
      *                                                                                     AR632104
     C           SACTN     IFEQ 'R'                                                         AR632104
     C           SATYP     ANDEQ'LS'                                                        AR632104
     C                     MOVE LTYPA     ATCD                                              AR632104
     C                     MOVE SUTPA     AUCD                                              AR632104
     C                     MOVE LCLAS     PLNCL                                             AR632104
     C                     CALL 'AOLOANR0'                                                  AR632104
     C                     PARM '*BLANKS' PRTCD                                             AR632104
     C                     PARM '*KEY'    POPTN                                             AR632104
     C                     PARM           ATCD                                              AR632104
     C                     PARM           AUCD                                              AR632104
     C                     PARM           PLNCL                                             AR632104
     C           SDLOAN    PARM SDLOAN    DSFDY                                             AR632104
     C           AYPPLT    IFEQ *BLANKS                                                     AR632104
     C           AYPPLS    OREQ *BLANKS                                                     AR632104
     C           AYIPLT    OREQ *BLANKS                                                     AR632104
     C           AYIPLS    OREQ *BLANKS                                                     AR632104
     C                     MOVE '1'       *IN46                                             AR632104
     C                     MOVEL'5045817' ZAMSID                                            AR632104
     C                     EXSR ZASNMS                                                      AR632104
     C                     ENDIF                                                            AR632104
     C                     ENDIF                                                            AR632104
      *                                                                                     AR632104
     C                     ENDIF                                                            AR632104
      *                                                                                     AR632104
     C                     ENDIF                                                            AR632104
      *                                                                   CAP061
      ** Only proceed with processing if there was no error in            CAP061
      ** validation.                                                      CAP061
      *                                                                   CAP061
     C           CAP61E    IFEQ 'Y'                                       CAP061
     C           CAP061    ANDEQ'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C                     GOTO CP61ER                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   163973
      ** Set up a flag for parts sold                                     163973
      *                                                                   163973
     C                     MOVE *BLANK    WSOLD                           163973
     C           PTYPA     IFEQ 66                                        163973
     C           PTYPA     OREQ 67                                        163973
     C           PTYPA     OREQ 69                                        163973
     C           CLE005    ANDEQ'Y'                                       163973
     C           PTYPA     OREQ 72                                        163973
     C           CLE005    ANDEQ'Y'                                       163973
     C                     MOVE 'Y'       WSOLD                           163973
     C                     ENDIF                                          163973
      *
      ** Validate Settlement details
      *
     C           SACTN     IFEQ 'I'
     C           SATYP     ANDEQ'PI'
     C           SACTN     OREQ 'A'
     C           SATYP     ANDEQ'PI'
      *
      ** Format Extended Settlement fields for Batch and Play
      *
     C                     EXSR SRBSET
     C/COPY WNCPYSRC,LE2040C002
      *
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
      ** For inserts, the loan amendment sequence number can be zero.                         CLE034
      ** This is not a problem. The first settlement allocation record                        CLE034
      ** written by LE2230 will be given a timestamp and used on all                          CLE034
      ** the other settlement allocation records.                                             CLE034
      *                                                                                       CLE034
     C           SSEQN     IFEQ *BLANKS                                                       CLE034
     C           SSEQN     OREQ *ZEROS                                                        CLE034
      *                                                                                       CLE034
     C                     MOVEL'Y'       WNKEY                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE SVDAT     ZDATE                                               CLE034
     C                     EXSR ZDATE1                                                        CLE034
     C                     MOVELZDAYNO    PVDAT                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'LE2230'                                                      CLE034
     C                     PARM 'LAPI'    PTYPE                                               CLE034
     C                     PARM           SLOAN                                               CLE034
     C                     PARM           PVDAT                                               CLE034
     C                     PARM           SSEQN                                               CLE034
     C                     PARM *BLANKS   PCNUM                                               CLE034
     C                     PARM *BLANKS   PFACL                                               CLE034
     C                     PARM *BLANKS   PFESQ                                               CLE034
     C                     PARM           SETLIB                                              CLE034
     C                     PARM           SETLIZ                                              CLE034
     C                     PARM           PMODE                                               CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM *BLANKS   PERRF                                               CLE034
     C                     PARM *BLANKS   PWARN                                               CLE034
     C                     PARM *BLANKS   PSNOS                                               CLE034
     C                     PARM *BLANKS   PSAMD                                               CLE034
     C                     PARM *BLANKS   PNDET                                               CLE034
     C                     PARM *BLANKS   PRCCY                                               CLE034
     C                     PARM *BLANKS   PRLOC                                               CLE034
     C                     PARM *BLANKS   PPCCY                                               CLE034
     C                     PARM *BLANKS   PPLOC                                               CLE034
     C                     PARM           PCRFK                                               CLE034
     C                     PARM           WORED                                               CLE038
     C                     PARM           WALAM                                               CLE038
      *                                                                                       CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'SD2410'
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           @PARM3                                              222373
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C/COPY WNCPYSRC,LE2040C003
      *
      ** If database error terminate processing
      *
     C           PMDBSE    IFNE 0
     C           *LOCK     IN   LDA
     C                     MOVELPMDBFL    DBFILE           ************
     C                     Z-ADDPMDBSE    DBASE            * DBERR XX *
     C                     MOVELPMDBKY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           PMERCD    IFNE *BLANK
     C***********          MOVEL'LEA1020' ZAMSID                          123801
     C           3         SUBSTPMERCD:1  WSERR   3                       123801
     C                     MOVEL'ESM0'    ZAMSID                          123801
     C                     MOVE WSERR     ZAMSID                          123801
     C                     MOVEL'DRSMM   'ZAMSGF                          123801
     C                     EXSR ZASNMS
     C                     MOVEL'LERMSGF 'ZAMSGF                          189825
      *                                                                   CAP061
      ** Only proceed with processing if there was no error in            CAP061
      ** validation.                                                      CAP061
      *                                                                   CAP061
     C           CAP61E    IFEQ 'Y'                                       CAP061
     C           CAP061    ANDEQ'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
      *                                                                   CAP061
      ** Set up file fields                                               CAP061
      *                                                                   CAP061
     C                     MOVELPMRSTM    SFRSTM    P                     CAP061
     C                     MOVELPMRONS    SFRONS    P                     CAP061
     C                     MOVELPAROBN    SFROBN    P                     CAP061
     C                     MOVELPAROCN    SFROCN    P                     CAP061
     C                     MOVELPARIBN    SFRIBN    P                     CAP061
     C                     MOVELPMRIBA    SFRIBA    P                     CAP061
     C                     MOVELPMPSTM    SFPSTM    P                     CAP061
     C                     MOVELPMPONS    SFPONS    P                     CAP061
     C                     MOVELPAPOBN    SFPOBN    P                     CAP061
     C                     MOVELPAPOCN    SFPOCN    P                     CAP061
     C                     MOVELPAPIBN    SFPIBN    P                     CAP061
     C                     MOVELPMPIBA    SFPIBA    P                     CAP061
     C                     MOVELPARCRN    SFRCRN    P                     CAP061
     C                     MOVELPMRCRA    SFRCRA    P                     CAP061
     C                     MOVELPARVNO    SFRVNO    P                     CAP061
     C                     MOVELPAAWBN    SFAWBN    P                     CAP061
     C                     MOVELPMAWBA    SFAWBA    P                     CAP061
     C                     MOVELPABENN    SFBENN    P                     CAP061
     C                     MOVELPMBENA    SFBENA    P                     CAP061
     C                     MOVELPMDTP1    SFDTP1    P                     CAP061
     C                     MOVELPMDTP2    SFDTP2    P                     CAP061
     C                     MOVELPMDTP3    SFDTP3    P                     CAP061
     C                     MOVELPMDTP4    SFDTP4    P                     CAP061
     C                     MOVELPMDCHG    SFDCHG    P                     CAP061
     C                     MOVELPMBTB1    SFBTB1    P                     CAP061
     C                     MOVELPMBTB2    SFBTB2    P                     CAP061
     C                     MOVELPMBTB3    SFBTB3    P                     CAP061
     C                     MOVELPMBTB4    SFBTB4    P                     CAP061
     C                     MOVELPMBTB5    SFBTB5    P                     CAP061
     C                     MOVELPMBTB6    SFBTB6    P                     CAP061
     C                     MOVELPMCVMR    SFCVMR    P                     CAP061
     C                     MOVELPMBTB6    SFBTB6    P                     CAP061
     C                     MOVELPMIC72    SFICCY    P                     CAP061
      *                                                                   CAP061
     C                     GOTO CP61ER                                    CAP061
      *                                                                   CAP061
     C                     ELSE                                           CAP061
      *                                                                   CAP061
      ** If there wasn't an error, clear file fields                      CAP061
      *                                                                   CAP061
     C                     MOVE *BLANKS   SFRSTM                          CAP061
     C                     MOVE *BLANKS   SFRONS                          CAP061
     C                     MOVE *BLANKS   SFROBN                          CAP061
     C                     MOVE *BLANKS   SFROCN                          CAP061
     C                     MOVE *BLANKS   SFRIBN                          CAP061
     C                     MOVE *BLANKS   SFRIBA                          CAP061
     C                     MOVE *BLANKS   SFPSTM                          CAP061
     C                     MOVE *BLANKS   SFPONS                          CAP061
     C                     MOVE *BLANKS   SFPOBN                          CAP061
     C                     MOVE *BLANKS   SFPOCN                          CAP061
     C                     MOVE *BLANKS   SFPIBN                          CAP061
     C                     MOVE *BLANKS   SFPIBA                          CAP061
     C                     MOVE *BLANKS   SFRCRN                          CAP061
     C                     MOVE *BLANKS   SFRCRA                          CAP061
     C                     MOVE *BLANKS   SFRVNO                          CAP061
     C                     MOVE *BLANKS   SFAWBN                          CAP061
     C                     MOVE *BLANKS   SFAWBA                          CAP061
     C                     MOVE *BLANKS   SFBENN                          CAP061
     C                     MOVE *BLANKS   SFBENA                          CAP061
     C                     MOVE *BLANKS   SFDTP1                          CAP061
     C                     MOVE *BLANKS   SFDTP2                          CAP061
     C                     MOVE *BLANKS   SFDTP3                          CAP061
     C                     MOVE *BLANKS   SFDTP4                          CAP061
     C                     MOVE *BLANKS   SFDCHG                          CAP061
     C                     MOVE *BLANKS   SFBTB1                          CAP061
     C                     MOVE *BLANKS   SFBTB2                          CAP061
     C                     MOVE *BLANKS   SFBTB3                          CAP061
     C                     MOVE *BLANKS   SFBTB4                          CAP061
     C                     MOVE *BLANKS   SFBTB5                          CAP061
     C                     MOVE *BLANKS   SFBTB6                          CAP061
     C                     MOVE *BLANKS   SFCVMR                          CAP061
     C                     MOVE *BLANKS   SFBTB6                          CAP061
     C                     MOVE *BLANKS   SFICCY                          CAP061
      *                                                                   CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *                                                                   123699
     C                     EXSR SRSETL                                    123699
      *
      ** Retrieve Loans and Settl. Detail for type PT and PF,
      ** Loans/Settl. details were not retrieve because no
      ** validation is required for this types
      *
     C           SATYP     IFEQ 'PT'
     C           SATYP     OREQ 'PF'
      *
     C                     MOVE SVDAT     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    VDAYNO
     C                     Z-ADDVDAYNO    WKVDT
     C                     MOVE PIAMSQ    WKLSN
      *
      *
     C***********          MOVELPILOAN    WKLNR                           139308
     C***********          MOVE 'A'       WRCDT                           139308
     C***********KLKEY     CHAINCLOAN               N79                   139308
     C***********          MOVE BRCA      WLBRC                           139308
     C***********          MOVE CNUM      WLCNO                           139308
     C***********PINRLI    IFEQ 'N'                                138866 157056
     C***********SATYP     ANDEQ'PF'                               138866 157056
     C                     MOVE PIROLN    WKLNR                           138866
     C                     MOVE 'A'       WRCDT                           138866
     C           KLKEY     CHAINCLOAN               N79                   138866
     C***********          ENDIF                                   138866 157056
     C                     Z-ADDRTSP      W#RTSP 117                      138866
     C                     Z-ADDBRTE      W#BRTE 117                      138866
     C                     MOVELSPIN      W#SPIN  1                       138866
     C                     Z-ADDICBS      W#CALC  10                      138866
     C                     Z-ADDWKVDT     W#BEG   50                      138866
     C                     Z-ADDMDAT      W#END   50                      138866
     C           ADDI      IFEQ 'B'                                       138866
     C                     ADD  1         W#END                           138866
     C                     END                                            138866
      *                                                                   138866
      ** Calculate effective interest rate                                138866
      *                                                                   138866
     C                     SELEC                                          138866
     C           SPIN      WHEQ 'A'                                       138866
     C           BRTE      ADD  RTSP      W#RATE 117                      138866
     C           SPIN      WHEQ 'S'                                       138866
     C           BRTE      SUB  RTSP      W#RATE                          138866
     C           SPIN      WHEQ 'P'                                       138866
     C           RTSP      DIV  100       WRK139 139                      138866
     C           WRK139    MULT BRTE      W#RATE    H                     138866
     C                     ENDSL                                          138866
      *                                                                   139308
     C                     MOVELPILOAN    WKLNR                           139308
     C                     MOVE 'A'       WRCDT                           139308
     C           KLKEY     CHAINCLOAN               N79                   139308
     C                     MOVE BRCA      WLBRC                           139308
     C                     MOVE CNUM      WLCNO                           139308
      *
      ** Get currency decimal places
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM PICURR    PCURR
     C           SDCURR    PARM SDCURR    DSSDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD37        DBASE            * DBERR 37 *
     C                     MOVELPICURR    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Format amount to midas format
      *
     C                     Z-ADDA6NBDP    CDP     10
     C                     Z-ADDCDP       CDPL    10
     C                     Z-ADDCDP       ZADEC
     C           13        SUB  CDP       ZADIG
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE PIPAMT    ZFIELD
     C                     EXSR ZALIGN
     C           *IN99     IFNE '1'
     C                     MOVE ZFIELD    WPAMTF 130
     C                     ENDIF
      *
     C           KLAKEY    CHAINLOAMS               N79
     C                     MOVE LSTC      LSTCS
      *
     C                     EXSR SRBSET
     C                     ENDIF
      *
      ** Write to Loan Amendments file for action Insert
      *
     C           SACTN     IFEQ 'I'
     C                     EXSR SRWRIT
     C                     ENDIF
      *
      ** Update Loan Amendments file for action Amend, Authorise and
      ** Reverse
      *
     C           SACTN     IFEQ 'A'
     C           SACTN     OREQ 'X'
     C           SACTN     OREQ 'R'
     C                     EXSR SRUPDT
     C                     ENDIF
      *
      ** Peform Increase Part Sold amount on Master Loan subroutine       143802
      *                                                                   143802
     C                     EXSR SRUPPS                                    143802
      *                                                                   CAP061
      ** Tag for error in validation                                      CAP061
      *                                                                   CAP061
     C           CP61ER    TAG                                            CAP061
      *                                                                   143802
     C           PMODE     IFEQ 'B'
     C                     MOVE '1'       *IN79
     C                     ENDIF
      *
     C           *IN79     IFEQ '0'
     C                     READ LE2040PD                 79
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************   CAP061
      * SRFISC  -  Move file fields to screen fields                  *   CAP061
      * Called by: SRBTCH - Batch processing                          *   CAP061
      *****************************************************************   CAP061
      *                                                                   CAP061
     C           SRFISC    BEGSR                                          CAP061
      *                                                                   CAP061
      *                                                                   CAP061
      ** KLIST for file LELOAML0                                          CAP061
      *                                                                   CAP061
     C                     MOVE PILOAN    WMLNO                           CAP061
     C                     MOVE PIVDAT    WMVDT                           CAP061
     C                     MOVE PIAMSQ    WMLSN                           CAP061
      *                                                                   CAP061
     C           KLELOM    CHAINLELOAMD0             79                   CAP061
      *                                                                   CAP061
     C           *IN79     IFEQ *OFF                                      CAP061
      *                                                                   CAP061
     C                     Z-ADDFVDAT     ZDAYNO                          CAP061
     C                     EXSR ZDATE2                                    CAP061
     C                     MOVELZDATE     SVDAT                           CAP061
     C                     MOVE FLNRF     SLOAN                           CAP061
     C           FLASN     IFNE 0                                         CAP061
     C                     MOVE FLASN     SSEQN                           CAP061
     C                     ELSE                                           CAP061
     C                     MOVE *BLANK    SSEQN                           CAP061
     C                     ENDIF                                          CAP061
     C                     MOVE FAMTP     SATYP                           CAP061
     C                     MOVELFCNUM     SCNUM                           CAP061
     C                     MOVE FCCY      SCURR                           CAP061
     C           FTAMT     IFNE 0                                         CAP061
      *                                                                   CAP061
     C                     CALL 'AOCURRR0'                                CAP061
     C                     PARM '*BLANK  'PRTCD                           CAP061
     C                     PARM '*KEY    'POPTN                           CAP061
     C                     PARM SCURR     PCURR                           CAP061
     C           SDCURR    PARM SDCURR    DSSDY                           CAP061
      *                                                                   CAP061
     C           PRTCD     IFNE *BLANKS                                   CAP061
     C           *LOCK     IN   LDA                                       CAP061
     C                     MOVEL'SDCURRPD'DBFILE           ************   CAP061
     C                     Z-ADD36        DBASE            * DBERR 36 *   CAP061
     C                     MOVELFCCY      DBKEY            ************   CAP061
     C                     OUT  LDA                                       CAP061
     C                     EXSR *PSSR                                     CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     MOVE FTAMT     ZFIELD                          CAP061
     C/COPY WNCPYSRC,LEH01121
     C                     Z-ADDA6NBDP    ZADEC                           CAP061
     C                     EXSR ZEDIT                                     CAP061
     C                     MOVE ZFIELD    SAMNT                           CAP061
     C                     ELSE                                           CAP061
     C                     MOVE *BLANK    SAMNT                           CAP061
     C                     ENDIF                                          CAP061
     C           FBRTT     IFNE 0                                         CAP061
     C                     MOVE FBRTT     SBRAT                           CAP061
     C                     ELSE                                           CAP061
     C                     MOVE *BLANK    SBRAT                           CAP061
     C                     ENDIF                                          CAP061
     C           FRTSP     IFNE 0                                         CAP061
     C                     MOVE FRTSP     SRTSP                           CAP061
     C                     ELSE                                           CAP061
     C                     MOVE *BLANK    SRTSP                           CAP061
     C                     ENDIF                                          CAP061
     C                     MOVE FSTAI     SSTPA                           CAP061
     C           FLSMD     IFNE 0                                         CAP061
     C                     MOVE FLSMD     SMDAT                           CAP061
     C                     ELSE                                           CAP061
     C                     MOVE *BLANK    SMDAT                           CAP061
     C                     ENDIF                                          CAP061
     C           FFSRP     IFNE 0                                         CAP061
     C                     MOVE FFSRP     SFRAT                           CAP061
     C                     ELSE                                           CAP061
     C                     MOVE *BLANK    SFRAT                           CAP061
     C                     ENDIF                                          CAP061
     C                     MOVE FLTYP     SLTYP                           CAP061
     C                     MOVE FSUTP     SSTYP                           CAP061
     C                     MOVE FDFTP     SDFTP                           CAP061
     C                     MOVE FDFST     SDFST                           CAP061
     C                     MOVELFSPI1     SSPI1                           CAP061
     C                     MOVELFSPI2     SSPI2                           CAP061
     C                     MOVELFSPI3     SSPI3                           CAP061
      *                                                                                       CLE034
      ** If CLE034 is installed, move Settlement allocation field                             CLE034
      ** to screen field.                                                                     CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVELFSTAL     SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDSR                                          CAP061
      /EJECT                                                              CAP061
      *****************************************************************   CAP061
      * SRSCWK  -  Save screen fields to work fields                  *   CAP061
      * Called by: SRBTCH - Batch processing                          *   CAP061
      *****************************************************************   CAP061
      *                                                                   CAP061
     C           SRSCWK    BEGSR                                          CAP061
      *                                                                   CAP061
      ** Amendment type                                                   CAP061
     C                     MOVE FAMTP     ISATYP                          CAP061
      *                                                                   CAP061
      ** Sequence                                                         CAP061
     C                     MOVE FLASN     ISSEQN                          CAP061
      *                                                                   CAP061
      ** Value date                                                       CAP061
     C                     MOVE FVDAT     ISVDAT                          CAP061
      *                                                                   CAP061
      ** Customer                                                         CAP061
     C                     MOVE FCNUM     ISCNUM                          CAP061
      *                                                                   CAP061
      ** Loan type                                                        CAP061
     C                     MOVE FLTYP     ISLTYP                          CAP061
      *                                                                   CAP061
      ** Sub type                                                         CAP061
     C                     MOVE FSUTP     ISSTYP                          CAP061
      *                                                                   CAP061
      ** Maturity date                                                    CAP061
     C                     MOVE FLSMD     ISMDAT                          CAP061
      *                                                                   CAP061
      ** Base rate                                                        CAP061
     C                     MOVE FBRTT     ISBRAT                          CAP061
      *                                                                   CAP061
      ** Rate/Spread                                                      CAP061
     C                     MOVE FRTSP     ISRTSP                          CAP061
      *                                                                   CAP061
      ** Currency                                                         CAP061
     C                     MOVE FCCY      ISCURR                          CAP061
      *                                                                   CAP061
      ** Total amount                                                     CAP061
     C                     MOVE FTAMT     ISAMNT                          CAP061
     C/COPY WNCPYSRC,LEH01122
      *                                                                   CAP061
      ** Stop accruals indicator                                          CAP061
     C                     MOVE FSTAI     ISSTPA                          CAP061
      *                                                                   CAP061
      ** Funding spread/rate                                              CAP061
     C                     MOVE FFSRP     ISRTSP                          CAP061
      *                                                                   CAP061
      ** Default participation                                            CAP061
     C                     MOVE FDFTP     ISDFTP                          CAP061
      *                                                                   CAP061
      ** Loan type                                                        CAP061
     C                     MOVE FSPI1     ISSPI1                          CAP061
      *                                                                   CAP061
      ** Loan type                                                        CAP061
     C                     MOVE FSPI2     ISSPI2                          CAP061
      *                                                                   CAP061
      ** Default participation                                            CAP061
     C                     MOVE FDFST     ISDFST                          CAP061
      *                                                                   CAP061
      ** Loan type                                                        CAP061
     C                     MOVE FSPI3     ISSPI3                          CAP061
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVELFSTAL     ISSTAL                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   CAP061
     C                     ENDSR                                          CAP061
      /EJECT                                                              CAP061
      *****************************************************************   CAP061
      * SRCOMP  -  Compare values of Incoming fields with those of    *   CAP061
      *            saved values. If they are different replace with   *   CAP061
      *            value of file and flag as error.                   *   CAP061
      * Called by: SRBTCH - Batch processing                          *   CAP061
      *****************************************************************   CAP061
      *                                                                   CAP061
     C           SRCOMP    BEGSR                                          CAP061
      *                                                                   CAP061
      ** Set protect indicators and error Flag to 'N'                     CAP061
     C                     MOVE 'N'       WERRA   1                       CAP061
      *                                                                   CAP061
      ** Amendment type                                                   CAP061
     C           SATYP     IFNE ISATYP                                    CAP061
     C                     MOVE ISATYP    SATYP                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Sequence                                                         CAP061
     C           SSEQN     IFNE ISSEQN                                    CAP061
     C                     MOVE ISSEQN    SSEQN                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Value date                                                       CAP061
     C           SVDAT     IFNE ISVDAT                                    CAP061
     C                     MOVE ISVDAT    SVDAT                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Customer                                                         CAP061
     C           SCNUM     IFNE ISCNUM                                    CAP061
     C                     MOVE ISCNUM    SCNUM                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Loan type                                                        CAP061
     C           SLTYP     IFNE ISLTYP                                    CAP061
     C                     MOVE ISLTYP    SLTYP                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Sub type                                                         CAP061
     C           SSTYP     IFNE ISSTYP                                    CAP061
     C                     MOVE ISSTYP    SSTYP                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Maturity date                                                    CAP061
     C           SMDAT     IFNE ISMDAT                                    CAP061
     C                     MOVE ISMDAT    SMDAT                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Base rate                                                        CAP061
     C           SBRAT     IFNE ISBRAT                                    CAP061
     C                     MOVE ISBRAT    SBRAT                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Rate/Spread                                                      CAP061
     C           SRTSP     IFNE ISRTSP                                    CAP061
     C                     MOVE ISRTSP    SRTSP                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Currency                                                         CAP061
     C           SCURR     IFNE ISCURR                                    CAP061
     C                     MOVE ISCURR    SCURR                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Total amount                                                     CAP061
     C           SAMNT     IFNE ISAMNT                                    CAP061
     C                     MOVE ISAMNT    SAMNT                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Stop accruals indicator                                          CAP061
     C           SSTPA     IFNE ISSTPA                                    CAP061
     C                     MOVE ISSTPA    SSTPA                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Funding spread/rate                                              CAP061
     C           SRTSP     IFNE ISRTSP                                    CAP061
     C                     MOVE ISRTSP    SRTSP                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     IFEQ ISSTAL                                                        CLE034
     C                     MOVELISSTAL    SSTAL                                               CLE034
     C                     MOVE 'Y'       WERRA                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   CAP061
      ** Default participation                                            CAP061
     C           SDFTP     IFNE ISDFTP                                    CAP061
     C                     MOVE ISDFTP    SDFTP                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Loan type                                                        CAP061
     C           SSPI1     IFNE ISSPI1                                    CAP061
     C                     MOVE ISSPI1    SSPI1                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Loan type                                                        CAP061
     C           SSPI2     IFNE ISSPI2                                    CAP061
     C                     MOVE ISSPI2    SSPI2                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Default participation                                            CAP061
     C           SDFST     IFNE ISDFST                                    CAP061
     C                     MOVE ISDFST    SDFST                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Loan type                                                        CAP061
     C           SSPI3     IFNE ISSPI3                                    CAP061
     C                     MOVE ISSPI3    SSPI3                           CAP061
     C                     MOVE 'Y'       WERRA                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** If Error set-up error message & write details to Invalid file    CAP061
     C           WERRA     IFEQ 'Y'                                       CAP061
     C                     MOVEL'LEA1043' ZAMSID                          CAP061
     C                     EXSR ZASNMS                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDSR                                          CAP061
      /EJECT                                                              CAP061
      *****************************************************************
      * SRBSET  -  Format Extended Settlement Fields for Batch/Play   *
      * Called by: Main routine                                       *
      * Calls    : None                                               *
      *****************************************************************
     C           SRBSET    BEGSR
      *
      ** Format for Batch mode
      *
     C           PMODE     IFEQ 'B'
      *
     C           SATYP     IFEQ 'PT'                                      125186
     C           SATYP     OREQ 'PF'                                      125186
     C           WSOLD     OREQ *BLANK                                    125186
     C                     Z-ADD0         PMRSTM
     C                     MOVELPIPSTM    PMPSTM
      *                                                                   123699
     C           PIPSTM    IFEQ '05'                                      123699
     C           CLE033    OREQ 'Y'                                                           CLE033
     C           PIPSTM    ANDEQ'09'
     C                     MOVELPIPONS    PMPOBR                          123699
     C                     MOVE PIPONS    PMPONS
     C                     ELSE                                           123699
     C                     MOVELP#PONS    PMPONS                          123699
     C           PIPSTM    IFEQ '14'                                                        AR400813
     C                     MOVELPIPONS    PMPONS                                            AR400813
     C                     ENDIF                                                            AR400813
     C                     ENDIF                                          123699
      *                                                                   123699
     C                     MOVELPIRCRN    PMRCRN
     C                     MOVELPIRCRN    PARCRN
     C                     MOVELPIRCRA    PMRCRA
     C                     MOVELPIPIBN    PMPIBN
     C                     MOVELPIPIBN    PAPIBN
     C                     MOVELPIPIBA    PMPIBA
     C                     MOVELPIPOCN    PMPOCN
     C                     MOVELPIPOCN    PAPOCN
     C                     MOVELPIPOBN    PMPOBN
     C                     MOVELPIPOBN    PAPOBN
     C                     MOVELPIPREC    PMRVNO
     C                     MOVELPIPREC    PARVNO
     C                     MOVELPIAWBN    PMAWBN
     C                     MOVELPIAWBN    PAAWBN
     C                     MOVELPIAWBA    PMAWBA
     C                     MOVELPIBENN    PMBENN
     C                     MOVELPIBENN    PABENN
     C                     MOVELPIBENA    PMBENA
     C                     MOVELPIDTP1    PMDTP1
     C                     MOVELPIDTP2    PMDTP2
     C                     MOVELPIDTP3    PMDTP3
     C                     MOVELPIDTP4    PMDTP4
     C                     MOVELPIDCHG    PMDCHG
     C                     MOVELPIBTB1    PMBTB1
     C                     MOVELPIBTB2    PMBTB2
     C                     MOVELPIBTB3    PMBTB3
     C                     MOVELPIBTB4    PMBTB4
     C                     MOVELPIBTB5    PMBTB5
     C                     MOVELPIBTB6    PMBTB6
     C                     MOVELPICVMR    PMCVMR
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELPISCCY    PMPSCY                          CEU004
     C                     MOVELPIICCY    PMIC72                          CEU004
     C                     ENDIF                                          CEU004
     C                     ENDIF                                          125186
      *
      ** For Principal transfers, retrieve receive settlement
      *
     C           SATYP     IFEQ 'PT'
     C           SATYP     OREQ 'PF'
     C           WSOLD     OREQ 'Y'                                       125186
     C                     MOVELPIRSTM    PMRSTM
     C***********          Z-ADD0         PMPSTM                   125186 135148
      *                                                                   123699
     C           PIRSTM    IFEQ '05'                                      123699
     C           CLE033    OREQ 'Y'                                                           CLE033
     C           PIRSTM    ANDEQ'09'                                                          CLE033
     C                     MOVELPIRONS    PMROBR                          123699
     C                     MOVE PIRONS    PMRONS
     C                     ELSE                                           123699
     C                     MOVELP#RONS    PMRONS                          123699
     C           PIRSTM    IFEQ '14'                                                        AR400813
     C                     MOVELPIRONS    PMRONS                                            AR400813
     C                     ENDIF                                                            AR400813
     C                     ENDIF                                          123699
      *                                                                   123699
     C                     MOVELPIROBN    PMROBN
     C                     MOVELPIROBN    PAROBN
     C                     MOVELPIROCN    PMROCN
     C                     MOVELPIROCN    PAROCN
     C                     MOVELPIRIBN    PMRIBN
     C                     MOVELPIRIBN    PARIBN
     C                     MOVELPIRIBA    PMRIBA
     C                     ENDIF
      *                                                                   135148
      ** Set PMPSTM to zero only if amendment type is not 'PT' or 'PF'    135148
      ** and loan is Parts Sold                                           135148
      *                                                                   135148
     C           SATYP     IFNE 'PT'                                      135148
     C           SATYP     ANDNE'PF'                                      135148
     C           WSOLD     ANDEQ'Y'                                       135148
     C                     Z-ADD0         PMPSTM                          135148
     C                     ENDIF                                          135148
      *
     C                     MOVE SACTN     PMACTC
     C           SACTN     IFEQ 'R'
     C                     MOVE 'D'       PMACTC
     C                     ENDIF
     C***                  MOVEL'MMLD'    PMCPGM                          135152
     C                     MOVEL'LEND'    PMCPGM                          135152
     C                     MOVE *BLANK    PMCMDP
     C                     Z-ADD0         PMDBSE
     C                     MOVE *BLANKS   PMERCD
     C                     MOVE 'Y'       PMFRST
     C                     Z-ADDRUND      PMRUND
     C                     Z-ADDBVLP      PMBVPD
      *                                                                                       CLE031
      ** Determine if pay settlement should be protected                                      CLE031
      *                                                                                       CLE031
     C           SACTN     IFEQ 'E'                                                           CLE031
     C           SACTN     OREQ 'R'                                                           CLE031
     C           SACTN     OREQ 'X'                                                           CLE031
     C                     MOVE 'Y'       PMPPAY                                              CLE031
     C                     MOVE 'Y'       PMPRCV                                              CLE031
     C                     MOVE 'N'       PMVALO                                              CLE031
      *                                                                                       CLE031
      ** Settlement detail valid flag, date of receipt and payment                            CLE031
      *                                                                                       CLE031
     C                     MOVE VDAYNO    PMDTRC                                              CLE031
     C                     MOVE VDAYNO    PMDTPY                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PTYPA     IFEQ 66                                                            CLE031
     C           PTYPA     OREQ 67                                                            CLE031
     C           PTYPA     OREQ 69                                                            CLE031
     C           CLE005    ANDEQ'Y'                                                           CLE031
     C           PTYPA     OREQ 72                                                            CLE031
     C           CLE005    ANDEQ'Y'                                                           CLE031
     C                     MOVE 'Y'       WSOLD                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           SACTN     IFEQ 'I'                                                           CLE031
     C           SACTN     OREQ 'A'                                                           CLE031
     C           WSOLD     IFEQ 'Y'                                                           CLE031
     C                     MOVE 'N'       PMPRCV                                              CLE031
     C                     MOVE 'Y'       PMPPAY                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'N'       PMPPAY                                              CLE031
     C                     MOVE 'Y'       PMPRCV                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE 'N'       PMSDTV                                              CLE031
      *                                                                                       CLE031
      ** Set up date of receipt for Insert or Amend                                           CLE031
      *                                                                                       CLE031
     C                     Z-ADD*ZERO     PMDTRC                                              CLE031
     C                     Z-ADD*ZERO     PMDTPY                                              CLE031
     C           SACTN     IFEQ 'A'                                                           CLE031
     C                     MOVE VDAYNO    PMDTRC                                              CLE031
     C                     MOVE VDAYNO    PMDTPY                                              CLE031
     C           VDAT      IFLT RUND                                                          CLE031
     C           ORED      ANDLTRUND                                                          CLE031
     C                     MOVE 'Y'       PMPPAY                                              CLE031
     C                     MOVE 'Y'       PMPRCV                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *
     C                     MOVE SATYP     PMTTYP
      *                                                                                       CLE038
     C                     EXSR SRBYAM                                                        CLE038
      *                                                                                       CLE038
     C                     MOVELSCNUM     PMCSNM
     C                     MOVELBRCA      PMBRCA
     C                     MOVE VDAYNO    PMDTRC
     C                     MOVE VDAYNO    PMDTPY
     C                     MOVE SCURR     PMRCCY
     C                     MOVE SCURR     PMPCCY
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELPISCCY    PMRSCY                          CEU004
     C                     ENDIF                                          CEU004
      *
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELPISCCY    PMRSCY                                              CLE031
     C                     MOVELPIPSCY    PMPSCY                                              CLE031
     C                     MOVELPIREXR    PMREXR                                              CLE031
     C           PIREXR    IFNE *BLANKS                                                       CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE PIREXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     MOVE *OFF      *IN99                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
     C                     Z-ADD*ZEROS    WSEXR  140                                          CLE031
     C                     MOVE ZFIELD    WSEXR                                               CLE031
     C           *IN99     IFEQ *ON                                                           CLE031
     C           WSEXR     OREQ *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELPIPEXR    PMPEXR                                              CLE031
     C           PIPEXR    IFNE *BLANKS                                                       CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE PIPEXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     MOVE *OFF      *IN99                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
     C                     Z-ADD*ZEROS    WSEXR                                               CLE031
     C                     MOVE ZFIELD    WSEXR                                               CLE031
     C           *IN99     IFEQ *ON                                                           CLE031
     C           WSEXR     OREQ *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELPIREXI    PMREXI                                              CLE031
     C           PIREXI    IFEQ 'N'                                                           CLE031
     C                     MOVE *BLANKS   PMREXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELPIPEXI    PMPEXI                                              CLE031
     C           PIPEXI    IFEQ 'N'                                                           CLE031
     C                     MOVE *BLANKS   PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *
     C                     ENDIF
      *
      ** Format for Play mode
      *
     C           PMODE     IFEQ 'P'
      *
     C                     MOVE WSAVS1    WSSTL1
     C                     MOVE WSAVS2    WSSTL2
     C                     MOVE WSAVS3    WSSTL3
      *
     C                     Z-ADD0         PMRSTM
     C                     MOVELPSTM      PMPSTM
     C                     MOVELPONS      PMPONS
     C                     MOVELRCRN      PMRCRN
     C                     MOVELRCRN      PARCRN
     C                     MOVELRCRA      PMRCRA
     C                     MOVELPIBN      PMPIBN
     C                     MOVELPIBN      PAPIBN
     C                     MOVELPIBA      PMPIBA
     C                     MOVELPOCN      PMPOCN
     C                     MOVELPOCN      PAPOCN
     C                     MOVELPOBN      PMPOBN
     C                     MOVELPOBN      PAPOBN
     C                     MOVELRVNO      PMRVNO
     C                     MOVELRVNO      PARVNO
     C                     MOVELAWBN      PMAWBN
     C                     MOVELAWBN      PAAWBN
     C                     MOVELAWBA      PMAWBA
     C                     MOVELBENN      PMBENN
     C                     MOVELBENN      PABENN
     C                     MOVELBENA      PMBENA
     C                     MOVELDTP1      PMDTP1
     C                     MOVELDTP2      PMDTP2
     C                     MOVELDTP3      PMDTP3
     C                     MOVELDTP4      PMDTP4
     C                     MOVELDCHG      PMDCHG
     C                     MOVELBTB1      PMBTB1
     C                     MOVELBTB2      PMBTB2
     C                     MOVELBTB3      PMBTB3
     C                     MOVELBTB4      PMBTB4
     C                     MOVELBTB5      PMBTB5
     C                     MOVELBTB6      PMBTB6
     C                     MOVELCVMR      PMCVMR
      *                                                                   125186
     C                     MOVELRSTM      PMRSTM                          125186
     C                     MOVELRONS      PMRONS                          125186
     C                     MOVELRIBN      PARIBN                          125186
     C                     MOVELRIBN      PMRIBN                          125186
     C                     MOVELROBN      PAROBN                          125186
     C                     MOVELROBN      PMROBN                          125186
     C                     MOVELROCN      PAROCN                          125186
     C                     MOVELROCN      PMROCN                          125186
      *
     C                     MOVE SACTN     PMACTC
     C           SACTN     IFEQ 'R'
     C                     MOVE 'D'       PMACTC
     C                     ENDIF
     C***                  MOVEL'MMLD'    PMCPGM                          135152
     C                     MOVEL'LEND'    PMCPGM                          135152
     C                     MOVE *BLANK    PMCMDP
     C                     Z-ADD0         PMDBSE
     C                     MOVE *BLANKS   PMERCD
     C                     MOVE 'Y'       PMFRST
     C                     Z-ADDRUND      PMRUND
     C                     Z-ADDBVLP      PMBVPD
      *
     C                     MOVE SATYP     PMTTYP
     C                     MOVELSCNUM     PMCSNM
     C                     MOVELBRCA      PMBRCA
     C                     MOVE VDAYNO    PMDTRC
     C                     MOVE VDAYNO    PMDTPY
     C                     MOVE SCURR     PMRCCY
     C                     MOVE SCURR     PMPCCY
      *
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           WSOLD     IFEQ 'Y'                                       CEU004
     C                     MOVE SCCY      PMRSCY                          CEU004
     C                     ELSE                                           CEU004
     C                     MOVE SCCY      PMPSCY                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y '                                                          CLE031
     C           WSOLD     IFEQ 'Y'                                                           CLE031
     C                     MOVE SCCY      PMRSCY                                              CLE031
     C                     MOVE REXI      PMREXI                                              CLE031
     C                     MOVE *BLANKS   PMPSCY                                              CLE031
     C                     MOVE *BLANKS   PMPEXI                                              CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C           REXR      IFEQ 0                                                             CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE REXR      ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMREXR                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
     C                     MOVE PSCY      PMPSCY                                              CLE031
     C                     MOVE PEXI      PMPEXI                                              CLE031
     C                     MOVE *BLANKS   PMRSCY                                              CLE031
     C                     MOVE *BLANKS   PMREXI                                              CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C           PEXR      IFEQ 0                                                             CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE PEXR      ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMPEXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSTRT  -  Start of processing for Screen Validation          *
      * Called by: Main routine                                       *
      * Calls    : SRINS1 - Initialise all screen fields              *
      *            CLEAR  - Clears the Message Queue                  *
      *            SRVALI - Validate Initial Screen                   *
      *            SRVALF - Validate Detail Screen Fields             *
      *            SRSDET - Setup Detail Screens                      *
      *            SRWARN - Display warning message if loan is synd.  *   159256
      *****************************************************************
     C           SRSTRT    BEGSR
      *
      ** Initialise all screen and work fields
      *
     C                     EXSR SRINS1
      *                                                                   189911
      ** Clear pgm msg queue if no error                                  189911
      *                                                                   189911
     C           WERRF     IFEQ *BLANK                                    189911
     C                     EXSR CLEAR                                     189911
     C                     ENDIF                                          189911
      *
      ** Display first screen while F0
      *
     C           WFMT      DOWEQ'F0'
     C                     WRITELE2040F0
     C                     WRITELE2040C1
     C                     EXFMTLE2040F1
      *
     C                     EXSR CLEAR
      *
     C                     MOVEA'001'     *IN,22
     C                     MOVEA'000'     *IN,26
     C                     MOVEA'00000'   *IN,30
     C                     MOVEA'00'      *IN,35
      *
      ** Exit this subroutine if F3 pressed
      *
     C           *INKC     IFEQ '1'
     C                     MOVE *BLANK    WFMT
     C                     LEAVE
     C                     ENDIF
      *
      ** Return to subfile screen if called from subfile screen
      *
     C           *INKL     IFEQ '1'
     C           *IN25     ANDEQ'1'
     C                     MOVE 'S0'      WFMT
     C                     LEAVE
     C                     ENDIF
     C/COPY WNCPYSRC,LE2040C011
      *
      ** Validate Initial Screen
      *
     C                     EXSR SRVALI
      *                                                                   159256
      ** Issue warning if changing a syndicated transaction.              159256
      *                                                                   159256
     C           SACTN     IFNE 'E'                                       159256
     C           SACTN     ANDNE*BLANK                                    159256
     C                     EXSR SRWARN                                    159256
     C                     ENDIF                                          159256
      *
      ** Dispay subfile if no error and action code is blank
      *
     C           *IN25     IFEQ '0'
     C           WERRF     IFEQ *BLANK
     C           SACTN     ANDEQ*BLANK
     C                     MOVE 'S0'      WFMT
     C                     ENDIF
     C                     ENDIF
      *
     C           WERRF     IFEQ *BLANK
     C           SACTN     ANDNE*BLANK
     C                     MOVE 'D1'      WFMT
     C                     ENDIF
      *                                                                   159256
      ** If warning, then remain on initial screen even if no other       159256
      ** errors. Highlight action and loan number.                        159256
      *                                                                   159256
     C           WE232     IFNE *BLANK                                    159256
     C                     MOVE 'F0'      WFMT                            159256
     C                     MOVEA'11'      *IN,30                          159256
     C           SACTN     IFNE 'I'                                       159256
     C           WERRF     ANDEQ*BLANK                                    159256
     C                     MOVE *BLANKS   SATYP                           159256
     C                     ENDIF                                          159256
     C                     ENDIF                                          159256
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRVALI  -  Validate Initial Screen                            *
      * Called by: Main processing                                    *
      * Calls    : SRUAUT - Check if user is authorised to the action *
      *            SRAUTH - Validate authorisation action             *
      *****************************************************************
     C           SRVALI    BEGSR
      *
      ** Validate action code
      *
     C           SACTN     IFNE *BLANK
      *
      ** Action code must be I, E, A, X or R
      *
     C           SACTN     IFNE 'I'
     C           SACTN     ANDNE'E'
     C           SACTN     ANDNE'A'
     C           SACTN     ANDNE'X'
     C           SACTN     ANDNE'R'
     C                     MOVE '1'       *IN30
     C                     MOVEL'LEA0021' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
      *                                                                                       CLE148
     C           WALLOW    IFEQ 'N'                                                           CLE148
      *
      ** Validate loan number
      *
     C                     MOVE *BLANK    ZFIELD
     C                     MOVELSLOAN     ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD6         ZADIG
     C                     EXSR ZALIGN
      *
      ** Entry is not a live loan
      *
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN31
     C                     MOVEL'LEA0025' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
      *                                                                                       CLE148
     C                     ELSE                                                               CLE148
      *                                                                                       CLE148
      ** Call program 'LELOANISO' to validate the number                                      CLE148
      *                                                                                       CLE148
     C                     MOVEL'LELOAN'  WCHR10 10                                           CLE148
     C                     MOVE 'ISO '    WCHR10                                              CLE148
     C                     CALL WCHR10                                                        CLE148
     C                     PARM SLOAN     PLNRF   6                                           CLE148
     C                     PARM *BLANKS   PVALID  6                                           CLE148
     C                     PARM *BLANKS   PCHKD   1                                           CLE148
     C                     PARM *BLANKS   PDATA   2                                           CLE148
      *                                                                                       CLE148
     C           PVALID    IFNE *BLANKS                                                       CLE148
     C                     MOVE '1'       *IN31                                               CLE148
     C                     MOVEL'LEL0822' ZAMSID                                              CLE148
     C                     MOVELPDATA     ZAMSDA                                              CLE148
     C                     EXSR ZASNMS                                                        CLE148
     C                     GOTO EXVALI                                                        CLE148
     C                     ENDIF                                                              CLE148
      *                                                                                       CLE148
     C                     ENDIF                                                              CLE148
      *
      ** Entry is not a valid loan
      *
     C                     MOVE SLOAN     WKLNR
     C                     MOVE 'A'       WRCDT
      *
     C********** WKLNR     IFEQ 0                                                             CLE148
     C           WKLNR     IFEQ *BLANK                                                        CLE148
     C                     MOVE '1'       *IN31
     C                     MOVEL'LEA0030' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
      *
      ** Loan must exist in loans file
      *
     C           KLKEY     CHAINCLOAN               N79
     C           *IN79     IFEQ '1'
     C                     MOVE '1'       *IN31
     C                     MOVEL'LEA0025' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ELSE
      *
      ** Save some file fields from loans file
      *
     C**********           MOVE LNRF      CLNRF   60                                          CLE148
     C                     MOVE LNRF      CLNRF   6                                           CLE148
     C                     MOVE BRCA      WLBRC   3
     C                     MOVE VDAT      VDATX   50
     C**********           MOVE CNUM      WLCNO   60                                          CSD027
     C                     MOVE CNUM      WLCNO   6                                           CSD027
     C                     MOVE CCYD      WLCUR   3
     C                     MOVE LTYPA     SLTYP
     C                     MOVE SUTPA     SSTYP                           CSC011
     C                     MOVE LPFI      WLPFI   1
     C**********           Z-ADDPTFC      WPTFC   60                                          CSD027
     C                     MOVE PTFC      WPTFC   6                                           CSD027
     C                     Z-ADDPTFT      WPTFT   30
     C                     Z-ADDPTFN      WPTFN   20
     C                     Z-ADDRLDT      WRLDT   50                      CEU020
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     Z-ADDBASR      WLBASR 117                                          CLE036
     C                     ENDIF                                                              CLE036
      *                                                                   CAP061
      ** If CAP061 is turned on and in batch mode, also save some other   CAP061
      ** fields.                                                          CAP061
      *                                                                   CAP061
     C           PMODE     IFEQ 'B'                                       CAP061
     C           CAP061    ANDEQ'Y'                                       CAP061
     C                     MOVE ORBR      SVORBR  3                       CAP061
     C                     MOVE LSTS      SVLSTS  1                       CAP061
     C                     MOVE MDAT      SVMDAT  50                      CAP061
     C                     ENDIF                                          CAP061
      *                                                                   126379
     C                     EXSR SRSAVE                                    126379
      ***********                                                   125186161036
      ***Set*up*a*flag*for*parts*sold*******************************125186161036
      ***********                                                   125186161036
     C***********          MOVE *BLANK    WSOLD                     125186161036
     C***********PTYPA     IFEQ 66                                  125186161036
     C***********PTYPA     OREQ 67                                  125186161036
     C***********PTYPA     OREQ 69                                  125186161036
     C***********CLE005    ANDEQ'Y'                                 125186161036
     C***********PTYPA     OREQ 72                                  125186161036
     C***********CLE005    ANDEQ'Y'                                 125186161036
     C***********          MOVE 'Y'       WSOLD                     125186161036
     C***********          ENDIF                                    125186161036
      ***********                                                   143071161036
      ***Set*up*a*flag*for*parts*purchased*and*save*original*borrowe143071161036
      ***********                                                   143071161036
     C***********          MOVE *BLANK    WPURC   1                 143071161036
     C***********PTYPA     IFEQ 64                                  143071161036
     C***********PTYPA     OREQ 65                                  143071161036
     C***********PTYPA     OREQ 68                                  143071161036
     C***********CLE005    ANDEQ'Y'                                 143071161036
     C***********PTYPA     OREQ 71                                  143071161036
     C***********CLE005    ANDEQ'Y'                                 143071161036
     C***********          MOVE 'Y'       WPURC                     143071161036
     C***********          MOVE OLNO      WOLNO   60                143071161036
     C***********          ENDIF                                    143071161036
      ***********                                                   CLE005161036
     C***********          Z-ADD0         WSPTYP                    CLE005161036
      ***********                                                   CLE005161036
      ****For*type*72*get*processing*type*of*loan*sold**************CLE005161036
      ***********                                                   CLE005161036
     C***********PTYPA     IFEQ 72                                  CLE005161036
     C***********CLE005    ANDEQ'Y'                                 CLE005161036
      ***********                                                   CLE005161036
     C***********          MOVE OLNO      WSOLNO  60                CLE005161036
     C***********          MOVE WSOLNO    WKLNR                     CLE005161036
     C***********          MOVE 'A'       WRCDT                     CLE005161036
     C***********KLKEY     CHAINCLOAN               N79             CLE005161036
      ***********                                                   CLE005161036
     C************IN79     IFEQ '1'                                 CLE005161036
     C************LOCK     IN   LDA                                 CLE005161036
     C***********          MOVEL'CLOAN   'DBFILE           *********CLE005161036
     C***********          Z-ADD40        DBASE            * DBERR 4CLE005161036
     C***********          MOVELWSOLNO    DBKEY            *********CLE005161036
     C***********          OUT  LDA                                 CLE005161036
     C***********          EXSR *PSSR                               CLE005161036
     C***********          ENDIF                                    CLE005161036
      ***********                                                   CLE005161036
     C***********PTYPA     IFEQ 63                                  CLE005161036
     C***********PTYPA     OREQ 65                                  CLE005161036
     C***********          Z-ADD67        WSPTYP  20                CLE005161036
     C***********          ENDIF                                    CLE005161036
      ***********                                                   CLE005161036
     C***********PTYPA     IFEQ 62                                  CLE005161036
     C***********PTYPA     OREQ 64                                  CLE005161036
     C***********          Z-ADD66        WSPTYP  20                CLE005161036
     C***********          ENDIF                                    CLE005161036
      ***********                                                   CLE005161036
     C***********PTYPA     IFEQ 61                                  CLE005161036
     C***********PTYPA     OREQ 68                                  CLE005161036
     C***********          Z-ADD69        WSPTYP  20                CLE005161036
     C***********          ENDIF                                    CLE005161036
      ***********                                                   CLE005161036
     C***********PTYPA     IFEQ 70                                  CLE005161036
     C***********PTYPA     OREQ 71                                  CLE005161036
     C***********          Z-ADD70        WSPTYP  20                CLE005161036
     C***********          ENDIF                                    CLE005161036
      ***********                                                   CLE005161036
      ***Rechain*Loans*file*to*get*back*current*loan*details********CLE005161036
      ***********                                                   CLE005161036
     C***********          MOVE SLOAN     WKLNR                     CLE005161036
     C***********          MOVE 'A'       WRCDT                     CLE005161036
     C***********KLKEY     CHAINCLOAN               N79             CLE005161036
      ***********                                                   CLE005161036
     C************IN79     IFEQ '1'                                 CLE005161036
     C************LOCK     IN   LDA                                 CLE005161036
     C***********          MOVEL'CLOAN   'DBFILE           *********CLE005161036
     C***********          Z-ADD41        DBASE            * DBERR 4CLE005161036
     C***********          MOVELWSOLNO    DBKEY            *********CLE005161036
     C***********          OUT  LDA                                 CLE005161036
     C***********          EXSR *PSSR                               CLE005161036
     C***********          ENDIF                                    CLE005161036
      ***********                                                   CLE005161036
     C***********          ENDIF                                    CLE005161036
      *                                                                   CEU020
      ** Chain to Loans file to get additional fields from detail b       CEU020
      **    if CEU020 is on                                               CEU020
      *                                                                   CEU020
     C           CEU020    IFEQ 'Y'                                       CEU020
      *                                                                   CEU020
     C                     MOVE SLOAN     WKLNR                           CEU020
     C                     MOVE 'B'       WRCDT                           CEU020
     C           KLKEY     CHAINCLOAN               N79                   CEU020
      *                                                                   CEU020
     C           *IN79     IFEQ '1'                                       CEU020
     C           *LOCK     IN   LDA                                       CEU020
     C                     MOVEL'CLOAN   'DBFILE           ************   CEU020
     C                     Z-ADD41        DBASE            * DBERR 41 *   CEU020
     C                     MOVELSLOAN     DBKEY            ************   CEU020
     C                     OUT  LDA                                       CEU020
     C                     EXSR *PSSR                                     CEU020
     C                     ENDIF                                          CEU020
      *                                                                   CEU020
     C                     MOVE NCCY      WNCCY   3                       CEU020
      *                                                                   CEU020
     C                     ENDIF                                          CEU020
      *
      **  If Analytical Accounting is on and the Loan Amendment type is
      **  a Spread Change and the loan was directly funded, enable
      **  'Funding Spread/Rate' field.
      **  or Revenue Analysis is on and the Loan Amendment type is        CDE002
      **  a Spread Change, enable 'Funding Spread/Rate' field.            CDE002
      *
     C           BGN0ST    IFEQ 'Y'
     C           SATYP     ANDEQ'SC'
     C           FPRC      ANDNE*BLANKS
     C           CDE002    OREQ 'Y'                                       CDE002
     C           SATYP     ANDEQ'SC'                                      CDE002
     C                     MOVE '1'       *IN51
     C                     ELSE
     C                     MOVE '0'       *IN51
     C                     ENDIF
      *
      **  Save some CLOAN details for calculation of effective rates
      *
     C********** RTSP      DIV  10000000  WCRTSP 117                                          214893
     C                     Z-ADDRTSP      WCRTSP 117                                          214893
     C                     MOVE BRTT      WCBRTT  2
     C                     MOVE SPIN      WCSPIN  1
     C                     Z-ADDFSRP      WCFSRP 117
     C                     MOVE FSGN      WCFSGN  1
     C                     MOVE FPRC      WCFPRC  4
      *
     C                     ENDIF
      *
      ** Check if reverse loan
      *
     C           RECIA     IFEQ 'R'                                       131253
     C***********RECI      IFEQ 'R'                                       131253
     C                     MOVE '1'       *IN30
     C                     MOVE '1'       *IN31
     C                     MOVEL'LEA0025' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
      *
      ** Check if matured loan
      *
     C           RECIA     IFEQ 'M'                                       131253
     C***********RECI      IFEQ 'M'                                       131253
      *                                                                   131253
     C           RATF      IFNE 'Y'                                       131253
     C           CLE005    ORNE 'Y'                                       131253
     C                     MOVE '1'       *IN30
     C                     MOVE '1'       *IN31
     C                     MOVEL'LEA0025' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF                                          131253
      *
     C                     ENDIF
      *
      ***If*processing*type*of*loan*is*70*use*of*action*A*not*allowed*****161036
      ***********                                                         161036
     C***********PTYPA     IFEQ 70                                  CLE005161036
     C***********SACTN     ANDEQ'A'                                       161036
     C***********PTYPA     OREQ 71                                  CLE005161036
     C***********SACTN     ANDEQ'A'                                       161036
     C***********CLE005    ANDEQ'Y'                                       161036
     C***********PTYPA     OREQ 72                                  CLE005161036
     C***********SACTN     ANDEQ'A'                                 CLE005161036
     C***********CLE005    ANDEQ'Y'                                 CLE005161036
     C***********          MOVE '1'       *IN30                           161036
     C***********          MOVE '1'       *IN31                           161036
     C***********          MOVEL'LEA0025' ZAMSID                          161036
     C***********          EXSR ZASNMS                                    161036
     C***********          GOTO EXVALI                                    161036
     C***********          ENDIF                                          161036
     C/COPY WNCPYSRC,LE2040C012
      *
      ** Validate Value date
      *
     C                     MOVELSVDAT     NUM7    70
     C                     MOVELNUM7      ALF6    6
     C           SVDAT     IFEQ ALF6
     C                     MOVE SVDAT     ZDATE
     C                     EXSR ZDATE1
     C                     ELSE
     C                     MOVE '1'       *IN33
     C                     MOVEL'LEA0105' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
      *
      ** Error if date not later than start date, or later than
      ** Maturity date
      *
     C                     Z-ADDZDAYNO    VDAYNO  50
      *
     C           SACTN     IFEQ 'I'
     C           VDAYNO    IFLE VDAT
     C           CLE003    ANDNE'Y'                                       115134
     C           VDAYNO    ORLT VDAT                                      115134
     C           CLE003    ANDEQ'Y'                                       115134
     C           MDAT      ORGT 0
     C           VDAYNO    ANDGEMDAT
     C/COPY WNCPYSRC,LE2040C028
     C                     MOVE '1'       *IN33
     C                     MOVEL'LEA0106' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
     C                     ENDIF
      *                                                                   CLE014
      ** Check if value date falls between the multi-currency rollover    CLE014
      ** date and the next working day                                    CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           WRLDT     IFNE *ZEROS                                    CLE014
     C           WLCUR     ANDNEWNCCY                                     CLE014
      *                                                                   CLE014
     C                     EXSR SRVMCD                                    CLE014
      *                                                                   CLE014
     C           VDAYNO    IFGT WRLDT                                     CLE014
     C           VDAYNO    ANDLTWNMCD                                     CLE014
     C                     MOVE *ON       *IN33                           CLE014
     C                     MOVE 'LEA1100' ZAMSID                          CLE014
     C                     EXSR ZASNMS                                    CLE014
     C                     GOTO EXVALI                                    CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** Check if value date is back valued and rollover date exist       CLE014
      *                                                                   CLE014
     C********** VDAYNO    IFLE BJRDNB                             CLE014 CSC011
     C           VDAYNO    IFLE WRNDAY                                    CSC011
     C           WNCCY     ANDNE*BLANKS                                   CLE014
     C           WRLDT     ANDNE*ZEROS                                    CLE014
     C                     MOVE *ON       *IN33                           CLE014
     C                     MOVE 'LEA1101' ZAMSID                          CLE014
     C                     EXSR ZASNMS                                    CLE014
     C                     GOTO EXVALI                                    CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ENDIF                                          CLE014
      **********                                                147281    161350
     C********** CEU020    IFEQ 'Y'                             147281    161350
     C********** NCCY      ANDNE*BLANKS                         147281    161350
     C********** NCCY      ANDNECCYD                            147281    161350
     C********** VDAYNO    ANDGTRLDT                            147281    161350
     C**********           MOVE '1'       *IN33                 147281    161350
     C**********           MOVE '1'       *IN31                 147281    161350
     C**********           MOVEL'LEA0115' ZAMSID                147281    161350
     C**********           EXSR ZASNMS                          147281    161350
     C**********           GOTO EXVALI                          147281    161350
     C**********           ENDIF                                147281    161350
      *                                                                   132947
      * If amendment type is principal increase the value date must       132947
      * not be later than the Last Available date                         132947
      *                                                                   132947
     C           SATYP     IFEQ 'PI'                                      132947
     C           SACTN     ANDEQ'I'                                       132947
      *                                                                   132947
     C***********          Z-ADDFCUSC     WFCNM                                        132947 225605
     C***********          Z-ADDFTYPC     WFACT                                        132947 225605
     C***********          Z-ADDFSEQC     WFNUM                                        132947 225605
     C           LPFI      IFEQ 'I'                                                           228214
     C           LPFI      OREQ 'P'                                                           228214
     C                     MOVELPTFC      WFCNM                                               225605
     C                     MOVELPTFT      WFACT                                               225605
     C                     MOVELPTFN      WFNUM                                               225605
     C                     ELSE                                                               228214
     C**********           Z-ADDFCUSC     WFCNM                                        228214 CSD027
     C                     MOVE FCUSC     WFCNM                                               CSD027
     C                     Z-ADDFTYPC     WFACT                                               228214
     C                     Z-ADDFSEQC     WFNUM                                               228214
     C                     ENDIF                                                              228214
     C                     MOVE 'A'       WFRTP                           132947
      *                                                                   132947
     C           KFCLT     CHAINFCLTY               N79                   132947
      *                                                                   132947
     C           *IN79     IFEQ '1'                                       132947
     C           *LOCK     IN   LDA                                       132947
     C                     MOVEL'FCLTY   'DBFILE           ************   132947
     C                     Z-ADD42        DBASE            * DBERR 42 *   132947
     C                     MOVELFCLKEY    DBKEY            ************   132947
     C                     OUT  LDA                                       132947
     C                     EXSR *PSSR                                     132947
     C                     ENDIF                                          132947
      *                                                                   132947
     C           VDAYNO    IFGT AVLD                                      132947
     C                     MOVE '1'       *IN33                           132947
     C                     MOVEL'LEA0109' ZAMSID                          132947
     C                     EXSR ZASNMS                                    132947
     C                     GOTO EXVALI                                    132947
     C                     ENDIF                                          132947
      *                                                                   132947
     C                     ENDIF                                          132947
      *
      ** If insert screen amendment type must be entered
      ** else amendment type must be blank
      ** IF INSERT AND LOAN SUBTYPE AMENDMENT FURTHER CHECKING
      *
     C           SACTN     IFEQ 'I'
      *
      ** Validate loan amendment type
      *
     C           SATYP     IFEQ *BLANKS
     C                     MOVE '1'       *IN32
     C                     MOVEL'LEA0181' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
      *
      ** Initialise settlement type to blanks                                                 197348
      *                                                                                       197348
     C                     MOVE *BLANKS   OTIST                                               197348
     C                     MOVE *BLANKS   OOSBR                                               197348
      *                                                                                       197348
     C           SATYP     IFEQ 'LS'
      *
      ** Value date must = rundate
      *
     C           CLE003    IFNE 'Y'                                       CLE003
     C           VDAYNO    IFNE RUND
     C                     MOVE '1'       *IN32
     C                     MOVEL'LEA0114' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
     C                     ENDIF                                          CLE003
      *
      *****************************************************************                       185822
      ***If*processing*type*=*70*LS*amendment*Is*not*valid*************                       185822
      *****************************************************************                       185822
     C********** PTYPA     IFEQ 70                                                            185822
     C********** PTYPA     OREQ 71                                                            185822
     C********** CLE005    ANDEQ'Y'                                                           185822
     C********** PTYPA     OREQ 72                                                     CLE005 185822
     C********** CLE005    ANDEQ'Y'                                                    CLE005 185822
     C**********           MOVE '1'       *IN32                                               185822
     C**********           MOVEL'LEA0514' ZAMSID                                              185822
     C**********           EXSR ZASNMS                                                        185822
     C**********           GOTO EXVALI                                                        185822
     C**********           ENDIF                                                              185822
      *
     C                     MOVE '1'       *IN23
      *
      ** IF NO ERROR SETON FIELD CONDITIONING INDICATOR FOR NEXT SCREEN
      ** IF NOT LS AMENDMENT CHECK VALID ENTRY AND SET OFF CONDITIONING
      ** INDICATOR FOR LS FIELDS
      *
     C                     ELSE
      *
     C                     MOVE '0'       *IN23
      *
     C           SATYP     IFNE 'PI'
     C           SATYP     ANDNE'SC'
     C           SATYP     ANDNE'BC'
     C           SATYP     ANDNE'SA'
     C                     MOVE '1'       *IN32
     C                     MOVEL'LEA0183' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
     C                     ENDIF
      *
      ** If action is not insert, amendment type must be blank
      *
     C                     ELSE
     C           SATYP     IFNE *BLANK
     C                     MOVE '1'       *IN32
     C                     MOVEL'LEA0513' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
     C                     ENDIF
      *
     C           SACTN     IFEQ 'I'
      *                                                                                       CLE028
      ** When CLE028 is installed, Amendment type 'BC', 'PI' and 'SC'                         CLE028
      ** are not allowed for flat rate personal loans                                         CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYPA     ANDEQ80                                                            CLE028
     C           SATYP     IFEQ 'BC'                                                          CLE028
     C           SATYP     OREQ 'PI'                                                          CLE028
     C           SATYP     OREQ 'SC'                                                          CLE028
     C                     MOVE '1'       *IN32                                               CLE028
     C                     MOVEL'LEA1104' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *
      ** For loan type 'PI' allow processing type 61, 62, 64, 66
      ** or 70
      *
     C           SATYP     IFEQ 'PI'
     C           PTYPA     IFNE 61
     C           PTYPA     ANDNE62
     C           PTYPA     ANDNE64
     C           PTYPA     ANDNE66
     C           PTYPA     ANDNE70
     C           CLE005    ANDNE'Y'
     C           PTYPA     ORNE 61
     C           PTYPA     ANDNE62
     C           PTYPA     ANDNE64
     C           PTYPA     ANDNE66
     C           PTYPA     ANDNE70
     C           PTYPA     ANDNE68
     C           PTYPA     ANDNE69
     C           PTYPA     ANDNE71
     C           PTYPA     ANDNE72
     C           CLE005    ANDEQ'Y'
     C                     MOVE '1'       *IN32
     C                     MOVEL'LEA0184' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
     C                     ENDIF
      *
      ** For type BC and SC, Discount loan not allowed
      *
     C           SATYP     IFEQ 'BC'
     C           SATYP     OREQ 'SC'
     C           PTYPA     IFNE 61
     C           PTYPA     ANDNE62
     C           PTYPA     ANDNE64
     C           PTYPA     ANDNE66
     C           PTYPA     ANDNE70
     C           CLE005    ANDNE'Y'
     C           PTYPA     ORNE 61
     C           PTYPA     ANDNE62
     C           PTYPA     ANDNE64
     C           PTYPA     ANDNE66
     C           PTYPA     ANDNE70
     C           PTYPA     ANDNE68
     C           PTYPA     ANDNE69
     C           PTYPA     ANDNE71
     C           PTYPA     ANDNE72
     C           CLE005    ANDEQ'Y'
     C                     MOVE '1'       *IN32
     C                     MOVEL'LEA1037' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
     C                     ENDIF
      *
      ** For loan type 'SA' allow processing type 61, 62, 64, 66 or 70
      *
     C           SATYP     IFEQ 'SA'
      *                                                                                       CLE028
      ** Allow SA amendment only if add on interest is not 'Y'                                CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYPA     ANDEQ80                                                            CLE028
     C           ADIF      IFEQ 'Y'                                                           CLE028
     C                     MOVE 'N'       WALWSA  1                                           CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE 'Y'       WALWSA                                              CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           PTYPA     IFNE 61
     C           PTYPA     ANDNE62
     C           PTYPA     ANDNE64
     C           PTYPA     ANDNE66
     C           PTYPA     ANDNE70
     C           CLE005    ANDNE'Y'
     C           WALWSA    ANDNE'Y'                                                           CLE028
     C           PTYPA     ORNE 61
     C           PTYPA     ANDNE62
     C           PTYPA     ANDNE64
     C           PTYPA     ANDNE66
     C           PTYPA     ANDNE70
     C           PTYPA     ANDNE68
     C           PTYPA     ANDNE69
     C           PTYPA     ANDNE71
     C           PTYPA     ANDNE72
     C           CLE005    ANDEQ'Y'
     C           WALWSA    ANDNE'Y'                                                           CLE028
     C                     MOVE '1'       *IN32
     C                     MOVEL'LEA1001' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
      *
      ** Must equal to run date
      *
     C           CLE003    IFNE 'Y'                                       CLE003
     C           VDAYNO    IFNE RUND
     C                     MOVE '1'       *IN33
     C                     MOVEL'LEA0114' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
     C                     ENDIF                                          CLE003
      *
     C           AUTOC     IFNE 'N'
     C                     MOVE '1'       *IN32
     C                     MOVEL'LEA0185' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Check that no other loans for same date with same type
      *
     C           SATYP     IFNE 'PI'
      *
     C                     MOVE SLOAN     WKLNR
     C                     MOVE VDAYNO    WKVDT
     C                     MOVE '000'     WKLSN
     C                     MOVE '0'       *IN79
      *
     C           KLAKEY    SETLLLOAMD
      *
     C           *IN79     DOWEQ'0'
     C                     READ LOAMD                    79
     C           *IN79     IFEQ '1'
     C           WKLNR     ORNE LNRF
     C           VDAYNO    ORNE VDAT
     C                     LEAVE
     C                     ENDIF
      *
     C           SATYP     IFEQ AMTP
     C           RECI      ANDEQ'D'
     C                     MOVE '1'       *IN32
     C                     MOVE '1'       *IN33
     C                     MOVEL'LEA0177' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
     C                     ENDDO
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Validate Sequence Number
      *
     C           SACTN     IFNE 'I'
     C           SSEQN     ANDEQ*BLANK
     C                     MOVE '1'       *IN34
     C                     MOVEL'LEA0107' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
      *
     C           SACTN     IFEQ 'I'
     C           SSEQN     ANDNE*BLANK
     C                     MOVE '1'       *IN34
     C                     MOVEL'LEA0108' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
      *
      ** Check sequence no. if numeric
      *
     C           SACTN     IFNE 'I'
     C                     MOVELSSEQN     NUM4    40
     C                     MOVELNUM4      ALF3    3
      *
     C           SSEQN     IFNE ALF3
     C                     MOVE '1'       *IN34
     C                     MOVEL'LEA0031' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ELSE
      *
     C           SSEQN     IFEQ '000'
     C                     MOVE '1'       *IN34
     C                     MOVEL'LEA0031' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
     C                     ENDIF
      *
      ** Chain to loan amendments file
      *
     C                     MOVE SLOAN     WKLNR
     C                     MOVE VDAYNO    WKVDT
     C                     MOVE SSEQN     WKLSN
      *
     C           KLAKEY    CHAINLOAMD                79
      *
     C           *IN79     IFEQ '1'
     C           RECI      ORNE 'D'
     C           RECI      ANDNE'R'
     C                     MOVE '1'       *IN31
     C                     MOVE '1'       *IN33
     C                     MOVE '1'       *IN34
     C                     MOVEL'LEA0176' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
      *                                                                   CLE005
     C                     ELSE                                           CLE005
      *                                                                   CLE005
      ** If loan amendment exists, check if loan processing type          CLE005
      ** is valid when CLE005 is ON/OFF.                                  CLE005
      *                                                                   CLE005
      ** For loan type 'PI' allow processing type 61, 62, 64, 66          CLE005
      ** or 70                                                            CLE005
      *                                                                   CLE005
     C           AMTP      IFEQ 'PI'                                      CLE005
     C           PTYPA     IFNE 61                                        CLE005
     C           PTYPA     ANDNE62                                        CLE005
     C           PTYPA     ANDNE64                                        CLE005
     C           PTYPA     ANDNE66                                        CLE005
     C           PTYPA     ANDNE70                                        CLE005
     C           CLE005    ANDNE'Y'                                       CLE005
     C           PTYPA     ORNE 61                                        CLE005
     C           PTYPA     ANDNE62                                        CLE005
     C           PTYPA     ANDNE64                                        CLE005
     C           PTYPA     ANDNE66                                        CLE005
     C           PTYPA     ANDNE70                                        CLE005
     C           PTYPA     ANDNE68                                        CLE005
     C           PTYPA     ANDNE69                                        CLE005
     C           PTYPA     ANDNE71                                        CLE005
     C           PTYPA     ANDNE72                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C                     MOVEA'11'      *IN,30                          CLE005
     C                     MOVEL'LEA0184' ZAMSID                          CLE005
     C                     EXSR ZASNMS                                    CLE005
     C                     GOTO EXVALI                                    CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      ** For type BC and SC, Discount loan not allowed                    CLE005
      *                                                                   CLE005
     C           AMTP      IFEQ 'BC'                                      CLE005
     C           AMTP      OREQ 'SC'                                      CLE005
     C           PTYPA     IFNE 61                                        CLE005
     C           PTYPA     ANDNE62                                        CLE005
     C           PTYPA     ANDNE64                                        CLE005
     C           PTYPA     ANDNE66                                        CLE005
     C           PTYPA     ANDNE70                                        CLE005
     C           CLE005    ANDNE'Y'                                       CLE005
     C           PTYPA     ORNE 61                                        CLE005
     C           PTYPA     ANDNE62                                        CLE005
     C           PTYPA     ANDNE64                                        CLE005
     C           PTYPA     ANDNE66                                        CLE005
     C           PTYPA     ANDNE70                                        CLE005
     C           PTYPA     ANDNE68                                        CLE005
     C           PTYPA     ANDNE69                                        CLE005
     C           PTYPA     ANDNE71                                        CLE005
     C           PTYPA     ANDNE72                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C                     MOVEA'11'      *IN,30                          CLE005
     C                     MOVEL'LEA1037' ZAMSID                          CLE005
     C                     EXSR ZASNMS                                    CLE005
     C                     GOTO EXVALI                                    CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      ** For loan type 'SA' allow processing type 61, 62, 64, 66 or 70    CLE005
      *                                                                   CLE005
     C           AMTP      IFEQ 'SA'                                      CLE005
      *                                                                                       CLE028
      ** Allow SA amendment only if add on interest is not 'Y'                                CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYPA     ANDEQ80                                                            CLE028
     C           ADIF      IFEQ 'Y'                                                           CLE028
     C                     MOVE 'N'       WALWSA  1                                           CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE 'Y'       WALWSA                                              CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           PTYPA     IFNE 61                                        CLE005
     C           PTYPA     ANDNE62                                        CLE005
     C           PTYPA     ANDNE64                                        CLE005
     C           PTYPA     ANDNE66                                        CLE005
     C           PTYPA     ANDNE70                                        CLE005
     C           CLE005    ANDNE'Y'                                       CLE005
     C           WALWSA    ANDNE'Y'                                                           CLE028
     C           PTYPA     ORNE 61                                        CLE005
     C           PTYPA     ANDNE62                                        CLE005
     C           PTYPA     ANDNE64                                        CLE005
     C           PTYPA     ANDNE66                                        CLE005
     C           PTYPA     ANDNE70                                        CLE005
     C           PTYPA     ANDNE68                                        CLE005
     C           PTYPA     ANDNE69                                        CLE005
     C           PTYPA     ANDNE71                                        CLE005
     C           PTYPA     ANDNE72                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           WALWSA    ANDNE'Y'                                                           CLE028
     C                     MOVEA'11'      *IN,30                          CLE005
     C                     MOVEL'LEA1001' ZAMSID                          CLE005
     C                     EXSR ZASNMS                                    CLE005
     C                     GOTO EXVALI                                    CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF
      *
     C           RECI      IFEQ 'R'
     C           SACTN     ANDNE'E'
     C                     MOVE '1'       *IN31
     C                     MOVE '1'       *IN33
     C                     MOVE '1'       *IN34
     C                     MOVEL'LEA1002' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
      *
     C                     MOVE LAIN      OLAIN   1
     C                     MOVE AMTP      SATYP
     C                     MOVE LSTC      LSTCS
      *
      **  Test if conf. & msg. seq. nos. blank
      **  Zeroise blank fields, else leave
      *
     C                     MOVE LSWC      LSWCA   3
     C           LSWCA     IFEQ ' '
     C                     Z-ADD0         WOLSWC  30       OUTPUT
     C                     ELSE
     C                     Z-ADDLSWC      WOLSWC  30       OUTPUT
     C                     ENDIF
      *
     C                     MOVE LSWS      LSWSA   3
     C           LSWSA     IFEQ ' '
     C                     Z-ADD0         WOLSWS  30       OUTPUT
     C                     ELSE
     C                     Z-ADDLSWS      WOLSWS  30       OUTPUT
     C                     ENDIF
      *
      ** If invalid loan amendment type, output error message
      *
     C           AMTP      IFEQ 'PD'
     C           SACTN     IFEQ 'A'                                       180044
     C           SACTN     OREQ 'X'                                       180044
     C           SACTN     OREQ 'I'                                       180044
     C                     MOVEL'LEA1003' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF                                          180044
     C                     ENDIF
      *                                                                   180044
      ** If amendment type is PD and action code is reversal and          180044
      ** repayment was inserted against it (TAMT is less than or equal    180044
      ** to zero), do not allow reversal of PD record.                    180044
      *                                                                   180044
     C           AMTP      IFEQ 'PD'                                      180044
     C           SACTN     ANDEQ'R'                                       180044
     C           TAMT      ANDLE0                                         180044
     C                     MOVEL'LEA1041' ZAMSID                          180044
     C                     EXSR ZASNMS                                    180044
     C                     GOTO EXVALI                                    180044
     C                     ENDIF                                          180044
      *
      ** If amendment type is repayment schedule, output error message
      *
     C           AMTP      IFEQ 'RE'
     C                     MOVEL'LEA1004' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
      *
      ** If amendment type is manual repayments, output error message
      *
     C           AMTP      IFEQ 'MR'
     C                     MOVEL'LEA1005' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
      *
      **  Can only do these if it's a Loan Sub-type amendment
      *
     C           AMTP      IFNE 'LS'
     C           PTYPA     IFEQ 63
     C           PTYPA     OREQ 65
     C           PTYPA     OREQ 67
     C                     MOVEL'LEA1006' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
     C                     ENDIF
      *
      ** If amendment is LS convert maturity date
      *
     C           AMTP      IFEQ 'LS'
     C                     MOVE '1'       *IN23
     C                     Z-ADDLSMD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     WMDAT1  6
     C                     ELSE
     C                     MOVE '0'       *IN23
     C                     ENDIF
      *
     C           SACTN     IFEQ 'A'
     C           PMODE     ANDNE'B'                                       156036
     C           SATYP     IFNE 'PI'
     C                     MOVEL'LEA0056' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
     C                     ENDIF
      *
      **  Enable funding spread/rate field if Analytical Accounting is
      **  installed and loan amendment is 'SC'
      **  or enable funding spread/rate field if Revenue Analysis is      CDE002
      **  installed and loan amendment is 'SC'                            CDE002
      *
     C           BGN0ST    IFEQ 'Y'
     C           SATYP     ANDEQ'SC'
     C           FPRC      ANDNE*BLANKS
     C           CDE002    OREQ 'Y'                                       CDE002
     C           SATYP     ANDEQ'SC'                                      CDE002
     C                     MOVE '1'       *IN51
     C                     ELSE
     C                     MOVE '0'       *IN51
     C                     ENDIF
     C                     ENDIF
      *                                                                   CLE003
     C           CLE003    IFEQ 'Y'                                       CLE003
     C           *LIKE     DEFN G0HIDT    VADAT                           CLE003
     C                     Z-ADDZDAYNO    VADAT                           CLE003
     C                     ENDIF                                          CLE003
      *
      ** Check user/action/branch authority
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C                     EXSR SRUAUT
     C                     ENDIF
      *
      ** If action code is 'X', execute Authorisation Processing
      *
     C           SACTN     IFEQ 'X'
     C           WERRF     ANDEQ*BLANK
     C                     EXSR SRAUTH
     C                     ENDIF
      *
      ** If action code is blank, validate Requiring Authority
      *
     C                     ELSE
      *
      ** Requiring Authorisation field must be 'Y' or 'N' only
      *
     C           SRAUT     IFNE 'Y'
     C           SRAUT     ANDNE'N'
     C                     MOVE '1'       *IN36
     C                     MOVEL'LEA1011' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
      *
      ** Other fields should be blank
      *
     C           SLOAN     IFNE *BLANK
     C                     MOVE '1'       *IN31
     C                     ENDIF
     C           SATYP     IFNE *BLANK
     C                     MOVE '1'       *IN32
     C                     ENDIF
     C           SVDAT     IFNE *BLANK
     C                     MOVE '1'       *IN33
     C                     ENDIF
     C           SVDAT     IFNE *BLANK
     C                     MOVE '1'       *IN34
     C                     ENDIF
      *
     C           *IN31     IFEQ '1'
     C           *IN32     OREQ '1'
     C           *IN33     OREQ '1'
     C           *IN34     OREQ '1'
     C                     MOVEL'LEA1031' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
      *
      ** Validate Review from Loan No. field
      *
     C           SRLON     IFNE *BLANK
     C                     MOVELSRLON     NUM7
     C                     MOVELNUM7      ALF6
      *
     C           SRLON     IFNE ALF6
     C                     MOVE '1'       *IN35
     C                     MOVEL'LEA1035' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO EXVALI
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LEH00607
      *
     C                     ENDIF
      *
     C           EXVALI    ENDSR
      *****************************************************************   CLE014
      /EJECT                                                              CLE014
      *****************************************************************   CLE014
      * SRVMCD  -  Validate Value date against multi-currency rollover*   CLE014
      *            date                                               *   CLE014
      *                                                               *   CLE014
      * Called by: SRVALI                                             *   CLE014
      *                                                               *   CLE014
      * Calls    : ZFWDT                                              *   CLE014
      *                                                               *   CLE014
      *****************************************************************   CLE014
     C           SRVMCD    BEGSR                                          CLE014
      *                                                                   CLE014
     C                     Z-ADDWRLDT     ZDAYNO                          CLE014
     C                     MOVE BJLCCY    ZCCY                            CLE014
     C                     MOVE *BLANKS   ZLOC                            CLE014
     C                     Z-ADD1         ZNRDYS                          CLE014
     C                     EXSR ZFWDT                                     CLE014
     C                     Z-ADDZDYNBR    WNMCD   50                      CLE014
      *                                                                   CLE014
     C                     ENDSR                                          CLE014
      *****************************************************************   CLE014
      /EJECT
      *****************************************************************
      * SRSDET  -  Setup Detail Screens                               *
      * Called by: Main processing                                    *
      * Calls    : SRMOVF - Move file fields to screen fields         *
      *            SRWARN - Display warning message if loan is synd.  *   159256
      *****************************************************************
     C           SRSDET    BEGSR
      *
      ** Protect Detail screen fields for action codes Delete,
      ** Enquire and Authorise
      *
     C           SACTN     IFEQ 'A'
     C           SACTN     OREQ 'R'
     C           SACTN     OREQ 'E'
     C           SACTN     OREQ 'X'
     C                     MOVE '1'       *IN18
     C                     MOVE '1'       *IN22
     C                     ENDIF
      *                                                                   126383
      *  If a loan is reversed, display message on first screen           126383
      *                                                                   126383
     C           PMODE     IFEQ 'I'                                       126383
     C           SACTN     ANDEQ'E'                                       126383
     C           RECIA     ANDEQ'R'                                       131253
     C***********RECI      ANDEQ'R'                                126383 131253
     C                     MOVE *ON       *IN75                           126383
     C                     ENDIF                                          126383
      *                                                                   159256
      ** Issue warning if loan is a syndicated loan (if called from       159256
      ** subfile processing).                                             159256
      *                                                                   159256
     C           SACTN     IFNE 'E'                                       159256
     C           SACTN     ANDNE'I'                                       159256
     C           WWRTRN    ANDEQ'S0'                                      159256
     C                     EXSR SRWARN                                    159256
     C                     ENDIF                                          159256
      *
      ** Do not protect Special Instructions fields for amend, insert
      *
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C                     MOVE '0'       *IN18
     C                     ENDIF
      *
      ** Display F10 for action code Reverse
      *
     C           SACTN     IFEQ 'R'
     C                     MOVE '1'       *IN27
     C           AMTP      IFEQ 'PI'                                                          197031
     C           WSD       ANDEQ' '                                                           197031
     C                     MOVE '0'       *IN15                                               197031
     C                     ELSE                                                               197031
     C                     MOVE '1'       *IN15                                               197031
     C                     ENDIF                                                              197031
     C                     ENDIF
      *
      ** Display F11 for action code Authorise
      *
     C           SACTN     IFEQ 'X'
     C                     MOVE '1'       *IN26
     C                     ENDIF
      *
      ** Move file fields to screen fields if action is not Insert
      *
     C           SACTN     IFNE 'I'
     C           WSCRNB    ANDEQ*BLANKS                                   172289
      *                                                                   CAP061
      ** ... and not in Fix/Repair mode                                   CAP061
      *                                                                   CAP061
     C           PMODE     ANDNE'F'                                       CAP061
     C                     EXSR SRMOVF
     C                     ENDIF
      *
      ** Set up Status field
      *
     C           SACTN     IFNE 'I'
     C                     SELEC
     C           ASTS      WHEQ 'C'
     C***********          MOVELSTAT,1    SSTAT                           123998
     C                     MOVEL'LEA0060' ZAMSID                          123998
     C           ASTS      WHEQ 'R'
     C***********          MOVELSTAT,2    SSTAT                           123998
     C                     MOVEL'LEA0061' ZAMSID                          123998
     C           ASTS      WHEQ 'A'
     C***********          MOVELSTAT,3    SSTAT                           123998
     C                     MOVEL'LEA0062' ZAMSID                          123998
     C           ASTS      WHEQ 'D'
     C***********          MOVELSTAT,4    SSTAT                           123998
     C                     MOVEL'LEA0063' ZAMSID                          123998
     C                     ENDSL
      *                                                                   123998
     C           ASTS      IFNE ' '                                       180044
     C                     EXSR SRTEXT                                    123998
     C                     MOVELZAMSTX    SSTAT                           123998
     C                     MOVE *BLANKS   ZAMSID                          123998
     C                     ELSE                                           180044
     C                     MOVE *BLANKS   SSTAT                           180044
     C                     ENDIF                                          180044
      *                                                                   123998
     C                     ELSE
     C                     MOVE *BLANK    SSTAT
     C                     ENDIF
      *
      ** Enable F14 for Loan Amendment type PI
      *
     C           SATYP     IFEQ 'PI'
     C                     MOVE '1'       *IN28
     C                     ENDIF
      *
      ** Disable F14 if Warning message displayed after Settlement
      *
     C           WACCPT    IFEQ 'Y'
     C           SACTN     ANDEQ'I'
     C                     MOVE '0'       *IN28
     C                     ENDIF
      *
      ** Determine if Facility for this loan is syndicated
      *
      ** Set up key using alternate field if in Fix/Repair mode.          CAP061
      *                                                                   CAP061
     C           PMODE     IFNE 'F'                                       CAP061
     C                     MOVELFCUSC     WFCNM
     C                     ELSE                                           CAP061
     C                     MOVELSCUST     WFCNM                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     MOVELFTYPC     WFACT
     C                     MOVELFSEQC     WFNUM
     C                     MOVE 'A'       WFRTP
      *
     C           KFCLT     CHAINFCLTY               N79
      *
     C           *IN79     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE           ************
     C                     Z-ADD17        DBASE            * DBERR 17 *
     C                     MOVELFCLKEY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C           SYIN      IFEQ 'Y'
     C           SATYP     ANDEQ'LS'
     C                     MOVE '1'       *IN50
     C                     ENDIF
     C                     ENDIF
      *
      ** Chain to loan amendments file again to retrieve
      ** settlement details
      *
      ** Only chain if not in Fix/Repair mode.                            CAP061
      *                                                                   CAP061
     C           PMODE     IFNE 'F'                                       CAP061
      *                                                                   CAP061
     C                     MOVE SLOAN     WKLNR
     C                     MOVE VDAYNO    WKVDT
     C                     MOVE SSEQN     WKLSN
      *
     C           KLAKEY    CHAINLOAMD                79
      *
     C           SACTN     IFEQ 'X'                                       158200
     C           SACTN     OREQ 'E'                                       158200
     C           SACTN     OREQ 'R'                                       158200
     C                     MOVE SUTP      SSTYP                           158200
     C                     END                                            158200
      *                                                                   CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Overwrite screen fields with fields from invalid file, if in     CAP061
      ** 'Fix/Repair' mode                                                CAP061
      *                                                                   CAP061
     C           PMODE     IFEQ 'F'                                       CAP061
      *                                                                   CAP061
      ** Only do this if not just returned from detail page two.          CAP061
      *                                                                   CAP061
     C           LSTSCR    IFNE 'D2'                                      CAP061
      *                                                                   CAP061
     C           XREPN     CHAINLEILAMP2             99                   CAP061
     C                     EXSR SETSIN                                    CAP061
      *                                                                   CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Set up flag to indicate last screen was detail screen 1          CAP061
      *                                                                   CAP061
     C           PMODE     IFEQ 'F'                                       CAP061
     C                     MOVE 'D1'      LSTSCR  2                       CAP061
     C                     ENDIF                                          CAP061
      *                                                                   158200
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRINS1  -  Initialise all screen fields                       *
      * Called by: SRSTRT - Start processing                          *
      * Calls    : None                                               *
      *****************************************************************
     C           SRINS1    BEGSR
      *
     C                     MOVE USER      SUSER
     C                     MOVE BJMRDT    SRUNA
     C                     MOVE WSID      SWSID
     C           *IN25     IFEQ '0'
     C                     MOVE *BLANK    SACTN
     C                     ELSE
     C                     MOVE 'I'       SACTN
     C                     ENDIF
     C                     MOVE *BLANK    SLOAN
     C                     MOVE *BLANK    SATYP
     C                     MOVE *BLANK    SVDAT
     C                     MOVE *BLANK    SSEQN
     C                     MOVE *BLANK    SRLON
     C                     MOVE 'N'       SRAUT
     C                     MOVE *BLANK    SSTAT
     C                     MOVE *BLANK    SCNUM
     C                     MOVE *BLANK    SBRAT
     C                     MOVE *BLANK    SRTSP
     C                     MOVE *BLANKS   SFRAT                           CDE002
     C                     MOVE *BLANK    SCURR
     C                     MOVE *BLANK    SAMNT
     C                     MOVE *BLANK    SSTPA
     C                     MOVE *BLANK    SSTAL                                               CLE034
     C                     MOVE *BLANK    SDFTP
     C                     MOVE *BLANK    SDFST
     C                     MOVE *BLANK    SSPI1
     C                     MOVE *BLANK    SSPI2
     C                     MOVE *BLANK    SSPI3
     C                     MOVE *BLANK    SSTYP
     C                     MOVE *BLANK    SMDAT
     C                     MOVE 'Y'       PMFRST
     C                     MOVE *BLANK    FLG1    1
     C                     MOVE *BLANK    WWERR   1
     C                     MOVE *BLANK    WWFLG   1
     C                     MOVE *BLANK    WSKIP   1
     C                     MOVE *BLANK    WACCPT  1
     C                     MOVE *BLANK    WSCRNB
     C                     MOVE *BLANK    WSD     1
     C                     MOVE *BLANKS   SRSGN                                             AR847588
     C                     MOVE *BLANK    WE232                                               214893
     C                     MOVE *BLANK    WE1036                                              214893
     C                     MOVE *BLANK    SWEFFR                                              214893
     C                     MOVE *BLANK    SWEFIR                                              214893
      *
     C/COPY WNCPYSRC,LEH01123
     C                     MOVE '0'       *IN14                                             AR847588
     C                     MOVEA'00'      *IN,22
     C                     MOVEA'000'     *IN,26
     C                     MOVEA'00000'   *IN,30
     C                     MOVEA'00000'   *IN,35
     C                     MOVEA'00000'   *IN,40
     C                     MOVEA'000'     *IN,45
     C                     MOVEA'00'      *IN,49
     C                     MOVEA'0000'    *IN,52
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRMOVF  -  Move file fields to screen fields                  *
      * Called by: Main processing                                    *
      * Calls    : None                                               *
      *****************************************************************
     C           SRMOVF    BEGSR
      *
     C                     MOVE LNRF      SLOAN
     C                     MOVE AMTP      SATYP
     C                     Z-ADDVDAT      ZDAYNO
     C                     Z-ADDVDAT      VADAT                           127996
     C                     EXSR ZDATE2
     C                     MOVELZDATE     SVDAT
     C                     Z-ADDLSMD      ZDAYNO                          123857
     C                     EXSR ZDATE2                                    123857
     C                     MOVELZDATE     SMDAT                           123857
     C                     MOVE LASN      SSEQN
      *                                                                                       207629
     C           PTYPA     IFEQ 64                                                            207629
     C           PTYPA     OREQ 65                                                            207629
     C           PTYPA     OREQ 68                                                            207629
     C           PTYPA     OREQ 71                                                            207629
      *                                                                                       207629
      * If the loan is a Participation Purchased, & System Value                              207629
      * LoanCustOriginPurch = 'O', use Original Borrower:                                     207629
     C           PPCUST    IFEQ 'O'                                                           207629
     C                     MOVELOLNO      SCNUM                                               207629
      ** Else, use 'Purchased from' customer number.                                          207629
     C                     ELSE                                                               207629
     C                     MOVELCNUM      SCNUM                                               207629
     C                     ENDIF                                                              207629
      *                                                                                       207629
      ** Else, loan is not a Part Purchased:                                                  207629
     C                     ELSE                                                               207629
     C                     MOVELCNUM      SCNUM
     C                     ENDIF                                                              207629
     C                     MOVE SUTP      SSTYP                           127289
     C           BRTT      IFEQ 0
     C                     MOVE *BLANK    SBRAT
     C                     ELSE
     C                     MOVE BRTT      SBRAT
     C                     ENDIF
     C           RTSP      IFEQ 0
      ** When rate is zeroised, ensure that SRTSP will have a zero        186579
      ** value instead of blank.                                          186579
     C           SATYP     IFEQ 'SC'                                      186579
     C           IRCF      ANDEQ'Y'                                                           214893
     C           SACTN     IFEQ 'E'                                       186579
     C           SACTN     OREQ 'X'                                       186579
     C           SACTN     OREQ 'R'                                       186579
     C                     MOVE RTSP      ZFIELD                          186579
     C                     Z-ADD7         ZADEC                           186579
     C                     EXSR ZEDIT                                     186579
     C                     MOVE ZFIELD    SRTSP                           186579
     C                     ELSE                                           186579
     C                     MOVE *BLANK    SRTSP
     C                     END                                            186579
     C                     END                                            186579
     C                     ELSE
      *                                                                                     AR847588
      ** Move '-' to SRSGN for display.                                                     AR847588
      *                                                                                     AR847588
     C           RTSP      IFLT 0                                                           AR847588
     C                     Z-SUBRTSP      RTSP                                              AR847588
     C                     MOVE '-'       SRSGN                                             AR847588
     C                     ENDIF                                                            AR847588
      *                                                                                     AR847588
     C                     MOVE RTSP      ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SRTSP
     C                     ENDIF
      *                                                                                       212297
      ** Check if the Funding Rate should be displayed:                                       212297
     C           BGN0ST    IFEQ 'Y'                                                           212297
     C           SATYP     ANDEQ'SC'                                                          212297
     C           FPRC      ANDNE*BLANKS                                                       212297
     C           CDE002    OREQ 'Y'                                                           212297
     C           SATYP     ANDEQ'SC'                                                          212297
     C                     MOVE '1'       *IN51                                               212297
     C                     ELSE                                                               212297
     C                     MOVE '0'       *IN51                                               212297
     C                     ENDIF                                                              212297
      *                                                                                       212297
     C           *IN51     IFEQ '1'                                       CDE002
     C           FSRP      IFEQ 0                                         CDE002
     C                     MOVE *BLANKS   SFRAT                           CDE002
     C                     ELSE                                           CDE002
     C                     MOVE FSRP      ZFIELD                          CDE002
     C                     Z-ADD7         ZADEC                           CDE002
     C                     EXSR ZEDIT                                     CDE002
     C                     MOVE ZFIELD    SFRAT                           CDE002
     C                     ENDIF                                          CDE002
     C                     ENDIF                                          CDE002
     C                     MOVE CCY       SCURR
     C           TAMT      IFEQ 0
     C                     MOVE *BLANK    SAMNT
     C                     ELSE
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*BLANK  'PRTCD
     C                     PARM '*KEY    'POPTN
     C                     PARM CCY       PCURR
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD16        DBASE            * DBERR 16 *
     C                     MOVELCCY       DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE TAMT      ZFIELD
     C/COPY WNCPYSRC,LEH01124
     C                     Z-ADDA6NBDP    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SAMNT
     C                     ENDIF
     C                     MOVE STAI      SSTPA
     C                     MOVE DFTP      SDFTP
     C                     MOVE DFST      SDFST
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVELSTAL      SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           PMERCD    IFEQ *BLANK
     C                     MOVE SPI1      SSPI1
     C                     MOVE SPI2      SSPI2
     C                     MOVE SPI3      SSPI3
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRDET1  -  First Detail Screen                                *
      * Called by: Main processing                                    *
      * Calls    : SRSDET - Setup Detail Screens                      *
      *            CLEAR  - Clears message from the pgm message queue *
      *            SRVALF - Validate Detail Screen Fields             *
      *            SRWIND - Window Processing                         *
      *****************************************************************
     C           SRDET1    BEGSR
      *                                                                   126383
     C                     MOVE *OFF      *IN75                           126383
      *
      ** Set-up screen fields
      *
     C                     EXSR SRSDET
      *
     C           WFMT      DOWEQ'D1'
      *
     C                     WRITELE2040C1
     C                     WRITELE2040F3
     C                     EXFMTLE2040F4
      *                                                                                       217232
      ** F3 taken?                                                                            217232
     C           *INKC     IFEQ '1'                                                           217232
     C                     MOVE *BLANK    WFMT                                                217232
     C                     LEAVE                                                              217232
     C                     ENDIF                                                              217232
      *                                                                                       217232
      ** F12 taken?                                                                           217232
     C           *INKL     IFEQ '1'                                                           217232
     C                     MOVE WWRTRN    WFMT                                                217232
     C/COPY WNCPYSRC,LE2040C025                                                               217232
     C                     EXSR CLEAR                                                         CLE036
     C                     LEAVE                                                              217232
     C                     ENDIF                                                              217232
      *                                                                   123857
      *  Allow user to authorise and exit if warning message is           123857
      *  displayed when enter key is used for authorisation               123857
      *                                                                   123857
     C           SACTN     IFEQ 'X'                                       123857
     C           *IN81     ANDEQ*ON                                       123857
     C***        WWFLG     ANDEQ'Y'                                123857 158207
     C                     MOVE 'Y'       W#EXIT  1                       123857
     C                     MOVE 'UP'      WFMT                            123857
     C                     ENDIF                                          123857
      *                                                                   123857
      *  Allow user to authorise and exit if warning message is           123857
      *  displayed when F11 key is used for authorisation                 123857
      *                                                                   123857
     C           *INKK     IFEQ '1'                                       123857
     C           W#EXIT    ANDEQ'Y'                                       123857
     C                     MOVE 'UP'      WFMT                            123857
     C                     ENDIF                                          123857
      *                                                                   172289
      * If validation has been carried out & nothing else has changed     172289
      * allow the user to 'enter' the transaction and exit.               172289
      *                                                                   172289
     C           SACTN     IFEQ 'A'                                       172289
     C           #VALID    ANDEQ'Y'                                       172289
     C           *INKN     ANDEQ'0'                                       172289
     C           WSCRNA    ANDEQWSCRNB                                    172289
     C                     MOVE 'Y'       W#EXIT  1                       172289
     C                     MOVE 'UP'      WFMT                            172289
     C                     MOVE 'N'       #VALID                          172289
     C                     LEAVE                                          172289
     C                     ENDIF                                          172289
      *                                                                   172289
     C           SACTN     IFEQ 'I'                                       172289
     C           #VALID    ANDEQ'Y'                                       172289
     C           *INKN     ANDEQ'0'                                       172289
     C           WSCRNA    ANDEQWSCRNB                                    172289
     C                     MOVE 'Y'       W#EXIT  1                       172289
     C                     MOVE 'WR'      WFMT                            172289
     C                     MOVE 'N'       #VALID                          172289
     C                     LEAVE                                          172289
     C                     ENDIF                                          172289
      *
      ** Check if warning error is outstanding
      *
     C                     MOVE *BLANK    WSKIP
     C           WWFLG     IFEQ 'Y'
     C           WERRF     ANDNE'Y'
     C           WSCRNA    IFEQ WSCRNB
     C                     MOVE 'Y'       WSKIP
     C                     MOVE *BLANK    WWFLG
     C                     ENDIF
     C                     ENDIF
      *
     C                     EXSR CLEAR
      *
     C                     MOVEA'00000'   *IN,37
     C                     MOVEA'00000'   *IN,42
     C                     MOVEA'00'      *IN,47
     C                     MOVEA'0000'    *IN,52
     C                     MOVE '0'       *IN14                                             AR847588
     C                     MOVE *OFF      *IN56                                               CLE034
     C/COPY WNCPYSRC,LEH01126
      *
     C********** *INKC     IFEQ '1'                                                           217232
     C**********           MOVE *BLANK    WFMT                                                217232
     C**********           LEAVE                                                              217232
     C**********           ENDIF                                                              217232
      **********                                                                              217232
     C********** *INKL     IFEQ '1'                                                           217232
     C**********           MOVE WWRTRN    WFMT                                                217232
     C*COPY*WNCPYSRC,LE2040C025                                                               217232
     C**********           LEAVE                                                              217232
     C**********           ENDIF                                                              217232
     C                     MOVE 'N'       #VALID                          172289
      *
      ** Validate first details screen inputs if action is I, A
      *
     C           SACTN     IFEQ 'I'
     C           WSKIP     ANDEQ*BLANK
     C           SACTN     OREQ 'A'
     C           WSKIP     ANDEQ*BLANK
     C           SACTN     OREQ 'X'                                       123857
     C                     EXSR SRVALF
      *                                                                                       CLE034
      ** Validate Settlement allocation                                                       CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
      *                                                                                       CLE034
     C           SSTAL     IFEQ *BLANKS                                                       CLE034
     C                     MOVEL'N'       SSTAL                                               CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C           SSTAL     IFNE 'Y'                                                           CLE034
     C           SSTAL     ANDNE'N'                                                           CLE034
     C                     MOVE *ON       *IN56                                               CLE034
     C                     MOVEL'LEA1104' ZAMSID                                              CLE034
     C                     EXSR ZASNMS                                                        CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       221924
     C           SSTAL     IFEQ 'Y'                                                           221924
     C           SATYP     ANDNE'PI'                                                          221924
     C                     MOVE *ON       *IN56                                               221924
     C                     MOVEL'LEA1104' ZAMSID                                              221924
     C                     EXSR ZASNMS                                                        221924
     C                     ENDIF                                                              221924
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           WWFLG     IFEQ 'Y'
     C           WERRF     ANDNE'Y'
     C**********           MOVE WSCRNA    WSCRNB158                                           CLE034
     C/COPY WNCPYSRC,LEH01125
     C                     MOVE WSCRNA    WSCRNB159                                           CLE034
     C/COPY WNCPYSRC,LEH01127
     C                     MOVE 'D1'      WFMT
     C                     ITER
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate if F10 pressed
      *
     C           *INKJ     IFEQ '1'
     C           WERRF     ANDEQ*BLANK
     C           SACTN     IFNE 'R'
     C                     MOVEL'LEA1015' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     MOVE 'UP'      WFMT
     C           SACTN     IFEQ 'R'                                                           197031
     C           AMTP      ANDEQ'PI'                                                          197031
     C                     MOVE '0'       *IN15                           186706
     C                     ELSE                                                               197031
     C                     MOVE '1'       *IN15                                               197031
     C                     ENDIF                                                              197031
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate if F11 pressed
      *
     C           *INKK     IFEQ '1'
     C           WERRF     ANDEQ*BLANK
     C           W#EXIT    ANDNE'Y'                                       123857
     C           SACTN     IFNE 'X'
     C                     MOVEL'LEA1016' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C           AMTP      IFEQ 'PI'                                      123857
     C                     MOVE 'D2'      WFMT                            123857
     C***********          EXSR SRDET2                             123857 143004
     C                     ENDIF                                          123857
     C           WWFLG     IFEQ *BLANK                                    123857
     C           WERRF     ANDEQ*BLANK                                    123857
     C                     MOVE 'UP'      WFMT
     C                     ELSE                                           123857
     C                     MOVE 'Y'       W#EXIT                          123857
     C                     ENDIF                                          123857
     C                     ENDIF
     C                     ENDIF
      *
      ** Process Extended Settlement if F14 or Enter pressed
      *
     C           *INKN     IFEQ '1'
     C           WERRF     ANDEQ*BLANK
     C           WERRF     OREQ *BLANK
     C           SATYP     ANDEQ'PI'
     C           *INKJ     ANDEQ'0'
     C           *INKK     ANDEQ'0'
     C           WACCPT    ANDEQ*BLANK
     C           SACTN     ANDNE'E'
     C                     MOVE 'D2'      WFMT
      *
     C           WSD       IFEQ 'Y'
     C           SACTN     ANDEQ'X'
     C           *INKN     ANDNE'1'                                       172289
     C           WSD       OREQ 'Y'
     C           SACTN     ANDEQ'R'
     C           *INKN     ANDNE'1'                                       172289
     C                     MOVE 'D1'      WFMT
     C                     ENDIF
     C           WSD       IFEQ 'Y'                                       145631
     C           SACTN     ANDEQ'X'                                       145631
     C           SATYP     ANDEQ'PI'                                      145631
     C           *INKN     ANDEQ'0'                                       145631
     C           *IN81     IFEQ '1'                                       169698
     C                     MOVE 'UP'      WFMT                            169698
     C                     ELSE                                           169698
     C           *INKK     IFEQ '1'                                       169698
     C                     MOVE 'UP'      WFMT                            145631
     C                     ENDIF                                          169698
     C                     ENDIF                                          169698
     C                     ENDIF                                          145631
      *
     C                     ENDIF
      *
      ** Enter pressed on enquire will get you back to initial
      ** or subfile screen
      *
     C           WERRF     IFEQ *BLANK
     C           SATYP     ANDEQ'PI'
     C           *INKJ     ANDEQ'0'
     C           *INKK     ANDEQ'0'
     C           *INKN     ANDEQ'0'
     C           WACCPT    ANDEQ*BLANK
     C           SACTN     ANDEQ'E'
     C           WWBACK    IFEQ 'SP'
     C                     MOVE 'SP'      WFMT
     C                     ELSE
     C                     MOVE WWRTRN    WFMT
     C                     ENDIF
     C                     ENDIF
      *
      ** Enter pressed after Warning error shown after settlement
      ** screen
      *
     C           WERRF     IFEQ *BLANK
     C           SATYP     ANDEQ'PI'
     C           *INKJ     ANDEQ'0'
     C           *INKK     ANDEQ'0'
     C           *INKN     ANDEQ'0'
     C           WACCPT    ANDEQ'Y'
     C           SACTN     IFEQ 'I'
     C                     MOVE 'WR'      WFMT
     C                     ENDIF
     C           SACTN     IFEQ 'A'
     C                     MOVE 'UP'      WFMT
     C                     ENDIF
     C                     ENDIF
      *
      ** Write/Update non-PI Loan Amendments
      *
     C           WERRF     IFEQ *BLANK
     C           SATYP     ANDNE'PI'
     C           *INKJ     ANDEQ'0'
     C           *INKK     ANDEQ'0'
     C           *INKN     ANDEQ'0'
      *
     C                     SELEC
     C           SACTN     WHEQ 'I'
     C                     MOVE 'WR'      WFMT
     C           SACTN     WHEQ 'E'
     C           WWBACK    IFEQ 'SP'
     C                     MOVE 'SP'      WFMT
     C                     ELSE
     C                     MOVE WWRTRN    WFMT
     C                     ENDIF
     C                     ENDSL
      *
     C                     ENDIF
      *
      ** Window Processing
      *
     C           WWFLG     IFEQ *BLANK
     C           WERRF     ANDEQ*BLANK
     C           WACCPT    ANDEQ*BLANK
     C/COPY WNCPYSRC,LE2040C019
     C                     EXSR SRWIND
     C                     ENDIF
      *                                                                   123857
      *  If no errors found do not show extended settlements for          123857
      *  amendment types other than PI and authorise.                     123857
      *                                                                   123857
     C           SACTN     IFEQ 'X'                                       123857
     C           *IN81     ANDEQ*ON                                       123857
     C           WWFLG     ANDNE'Y'                                       123857
     C           WERRF     ANDNE'Y'                                       123857
     C           W#EXIT    ANDNE'Y'                                       123857
     C           AMTP      ANDNE'PI'                                      123857
     C                     MOVE 'UP'      WFMT                            123857
     C                     ENDIF                                          123857
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRDET2  -  Second Detail Screen                               *
      * Called by: Main processing                                    *
      * Calls    : SRFXST - Format Extended Settlement Fields         *
      *            SRSETL - Set up Data Received from SD2400          *
      *            SRAVAL - Addtl Validation dependent of Settl. Ins. *
      *****************************************************************
     C           SRDET2    BEGSR
      *
     C           WFMT      DOWEQ'D2'
      *
      ** Set on Settlement Details flag and Format fields for
      *  Extended Settlement
      *
     C                     MOVE 'Y'       WSD
     C                     MOVE *BLANK    WACCPT
     C                     EXSR SRFXST
     C/COPY WNCPYSRC,LE2040C004
      *                                                                   CAP061
      ** Setup fields from invalid file, if in Fix/Repair mode            CAP061
      *                                                                   CAP061
     C           PMODE     IFEQ 'F'                                       CAP061
      *                                                                   CAP061
     C                     MOVE SFRSTM    PMRSTM                          CAP061
     C                     MOVELSFRONS    PMRONS    P                     CAP061
     C                     MOVELSFROBN    PAROBN    P                     CAP061
     C                     MOVELSFROCN    PAROCN    P                     CAP061
     C                     MOVELSFRIBN    PARIBN    P                     CAP061
     C                     MOVELSFRIBA    PMRIBA    P                     CAP061
     C                     MOVE SFPSTM    PMPSTM                          CAP061
     C                     MOVELSFPONS    PMPONS    P                     CAP061
     C                     MOVELSFPOBN    PAPOBN    P                     CAP061
     C                     MOVELSFPOCN    PAPOCN    P                     CAP061
     C                     MOVELSFPIBN    PAPIBN    P                     CAP061
     C                     MOVELSFPIBA    PMPIBA    P                     CAP061
     C                     MOVELSFRCRN    PARCRN    P                     CAP061
     C                     MOVELSFRCRA    PMRCRA    P                     CAP061
     C                     MOVELSFRVNO    PARVNO    P                     CAP061
     C                     MOVELSFAWBN    PAAWBN    P                     CAP061
     C                     MOVELSFAWBA    PMAWBA    P                     CAP061
     C                     MOVELSFBENN    PABENN    P                     CAP061
     C                     MOVELSFBENA    PMBENA    P                     CAP061
     C                     MOVELSFDTP1    PMDTP1    P                     CAP061
     C                     MOVELSFDTP2    PMDTP2    P                     CAP061
     C                     MOVELSFDTP3    PMDTP3    P                     CAP061
     C                     MOVELSFDTP4    PMDTP4    P                     CAP061
     C                     MOVELSFDCHG    PMDCHG    P                     CAP061
     C                     MOVELSFBTB1    PMBTB1    P                     CAP061
     C                     MOVELSFBTB2    PMBTB2    P                     CAP061
     C                     MOVELSFBTB3    PMBTB3    P                     CAP061
     C                     MOVELSFBTB4    PMBTB4    P                     CAP061
     C                     MOVELSFBTB5    PMBTB5    P                     CAP061
     C                     MOVELSFBTB6    PMBTB6    P                     CAP061
     C                     MOVELSFCVMR    PMCVMR    P                     CAP061
      *                                                                   CAP061
      ** Set Protect receipt instructions and Protect Payment             CAP061
      ** instructions flags to be 'N'.                                    CAP061
      *                                                                   CAP061
     C                     MOVE 'N'       PMPRCV                          CAP061
     C                     MOVE 'N'       PMPPAY                          CAP061
      *                                                                   CAP061
     C                     ENDIF                                          CAP061
      *
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
      ** For inserts, the loan amendment sequence number can be zero.                         CLE034
      ** This is not a problem. The first settlement allocation record                        CLE034
      ** written by LE2230 will be given a timestamp and used on all                          CLE034
      ** the other settlement allocation records.                                             CLE034
      *                                                                                       CLE034
     C           SSEQN     IFEQ *BLANKS                                                       CLE034
     C           SSEQN     OREQ *ZEROS                                                        CLE034
      *                                                                                       CLE034
     C                     MOVEL'Y'       WNKEY   1                                           CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE SVDAT     ZDATE                                               CLE034
     C                     EXSR ZDATE1                                                        CLE034
     C                     MOVELZDAYNO    PVDAT                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'LE2230'                                                      CLE034
     C                     PARM 'LAPI'    PTYPE   4                                           CLE034
     C                     PARM           SLOAN                                               CLE034
     C                     PARM           PVDAT                                               CLE034
     C                     PARM           SSEQN                                               CLE034
     C                     PARM *BLANKS   PCNUM   6                                           CLE034
     C                     PARM *BLANKS   PFACL   5                                           CLE034
     C                     PARM *BLANKS   PFESQ   2                                           CLE034
     C                     PARM           SETLIB                                              CLE034
     C                     PARM           SETLIZ                                              CLE034
     C                     PARM           PMODE                                               CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM *BLANKS   PERRF   1                                           CLE034
     C                     PARM *BLANKS   PWARN   1                                           CLE034
     C                     PARM *BLANKS   PSNOS   1                                           CLE034
     C                     PARM *BLANKS   PSAMD   1                                           CLE034
     C                     PARM *BLANKS   PNDET   1                                           CLE034
     C                     PARM *BLANKS   PRCCY  60                                           CLE034
     C                     PARM *BLANKS   PRLOC  60                                           CLE034
     C                     PARM *BLANKS   PPCCY  60                                           CLE034
     C                     PARM *BLANKS   PPLOC  60                                           CLE034
     C                     PARM           PCRFK                                               CLE034
     C                     PARM           WORED                                               CLE038
     C                     PARM           WALAM                                               CLE038
      *                                                                                       CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'SD2400'
     C                     PARM           PRCODE  7
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           PSLNRF  6
     C                     PARM           @PARM3                                              222373
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C/COPY WNCPYSRC,LE2040C005
      *
      ** If database error terminate processing
      *
     C           PMDBSE    IFNE 0
     C           *LOCK     IN   LDA
     C                     MOVELPMDBFL    DBFILE           ************
     C                     Z-ADDPMDBSE    DBASE            * DBERR XX *
     C                     MOVELPMDBKY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     SELEC
     C           PMCMDP    WHEQ '03'
     C                     MOVE *BLANK    WFMT
     C           PMODE     IFNE 'B'                                                           227710
     C           PMODE     ANDNE'P'                                                           227710
     C                     ROLBK                                                              227710
     C                     ENDIF                                                              227710
      *
     C           PMCMDP    WHEQ '12'
     C/COPY WNCPYSRC,LE2040C020
      *
     C           PMSDTV    IFEQ 'Y'
     C           PMSDTV    OREQ 'N'
     C           PMERCD    ANDEQ*BLANK
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           PMSDTV    ANDEQ'N'                                                           CLE034
     C           PMERCD    ANDEQ*BLANKS                                                       CLE034
     C                     MOVE 'N'       SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
     C***********SACTN     ANDNE'R'                                CLE005 134799
     C***********SACTN     ANDNE'E'                                CLE005 134799
     C***********SACTN     ANDNE'X'                                CLE005 134799
      *
     C                     EXSR SRSETL
     C                     EXSR SRAVAL
      *
     C***********          MOVE 'D1'      WFMT                      120023123055
     C***********          MOVE 'F0'      WFMT                     123055 172289
     C                     MOVE 'D1'      WFMT                            172289
      *                                                                   123055
     C           SACTN     IFEQ 'I'
     C           PMSDTV    ANDEQ'Y'                                       123055
     C************         MOVE 'WR'      WFMT                            172289
     C                     MOVE 'D1'      WFMT                            172289
     C                     ENDIF
      *
     C           SACTN     IFEQ 'A'
     C************         MOVE 'UP'      WFMT                            172289
     C                     MOVE 'D1'      WFMT                            172289
     C                     ENDIF
      *                                                                   172289
      * If settlement details were validated, set on '#VALID' flag.       172289
     C           PMSDTV    IFEQ 'Y'                                       172289
     C                     MOVE 'Y'       #VALID  1                       172289
     C                     ENDIF                                          172289
      *                                                                   172289
     C           SACTN     IFEQ 'R'                                       172289
     C                     MOVE 'D1'      WFMT                            172289
     C           SACTN     IFEQ 'R'                                                           197031
     C           AMTP      ANDEQ'PI'                                                          197031
     C                     MOVE '1'       *IN15                           186706
     C                     ELSE                                                               197031
     C                     MOVE '0'       *IN15                                               197031
     C                     ENDIF                                                              197031
     C                     ENDIF                                          172289
      *                                                                   123857
     C           SACTN     IFEQ 'X'                                       123857
     C           *IN81     ANDEQ*ON                                       123857
     C***                  MOVE 'UP'      WFMT                     123857 158207
     C                     MOVE 'D1'      WFMT                            158207
     C************         WRITELE2040C1                           158207 145631
     C************         WRITELE2040F3                           158207 145631
     C************         EXFMTLE2040F4                           158207 145631
     C************INKC     IFEQ '1'                                158207 145631
     C************         MOVE *BLANK    WFMT                     158207 145631
     C************         LEAVE                                   158207 145631
     C************         ENDIF                                   158207 145631
     C************INKL     IFEQ '1'                                158207 145631
     C************         MOVE 'S0'      WFMT                     158207 145631
     C************         LEAVE                                   158207 145631
     C************         ENDIF                                   158207 145631
     C************         MOVE 'UP'      WFMT                     158207 145631
     C                     ENDIF                                          123857
      *
      ** Redisplay Detail screen if Warning message exists
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           WWFLG     IFEQ 'Y'
     C           WERRF     ANDNE'Y'
     C                     MOVE WSCRNA    WSCRNB
     C                     MOVE 'D1'      WFMT
     C                     MOVE 'Y'       WACCPT
     C                     MOVE '1'       *IN22
     C                     ENDIF
     C                     ENDIF
      * Save copy of detail screen to check for any changes later.        172289
     C                     MOVE WSCRNA    WSCRNB                          172289
      *
      ** Return to first screen if action is Authorise                    143004
      *                                                                   143004
     C           SACTN     IFEQ 'X'                                       143004
     C                     MOVE 'D1'      WFMT                            143004
     C                     MOVE 'N'       PMFRST                          143004
     C                     ENDIF                                          143004
      *                                                                   143004
     C                     ELSE
      *
     C                     MOVE 'D1'      WFMT
     C                     MOVE 'N'       PMFRST
      *
     C           PMERCD    IFNE *BLANK
     C                     MOVEL'LEA1020' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSL
      *
     C                     ENDDO
      *                                                                   CAP061
      ** Set up flag to indicate last screen was detail screen 2          CAP061
      *                                                                   CAP061
     C           PMODE     IFEQ 'F'                                       CAP061
     C                     MOVE 'D2'      LSTSCR  2                       CAP061
     C                     ENDIF                                          CAP061
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRFXST  -  Format Extended Settlement Fields                  *
      * Called by: Main processing                                    *
      * Calls    : None                                               *
      *****************************************************************
      *
     C           SRFXST    BEGSR
      *
     C           SACTN     IFNE 'E'
     C           SACTN     ANDNE'R'
      *
     C                     MOVE VDAYNO    PMDTRC
     C                     MOVE VDAYNO    PMDTPY
     C                     ENDIF
      *
      ** Set up remaining communication fileds
      *
      **  Call to access object if extended settlement instructions       143071
      *   exist.                                                          143071
     C                     MOVE 'N'       EXDTA   1                       143071
      *                                                                   143071
      ** If loan is parts purch, move original borrower                   143071
      *                                                                   143071
     C           WPURC     IFEQ 'Y'                                       143071
     C                     MOVELWOLNO     @CUST                           143071
     C                     ELSE                                           143071
     C                     MOVELW#CUST    @CUST                           143071
     C                     ENDIF                                          143071
      *                                                                   143071
     C                     MOVELSCURR     @CYCD                           143071
     C                     MOVEL'LE'      @TRTY                           143071
      *                                                                   143071
     C                     CALL 'AOEXSTR0'                                143071
     C                     PARM *BLANKS   @RTCD   7                       143071
     C                     PARM '*KEY   ' @OPTN   7                       143071
     C                     PARM           @CYCD   3                       143071
     C                     PARM           @CUST   6                       143071
     C                     PARM           @TRTY   2                       143071
     C           SDEXST    PARM SDEXST    DSSDY                           143071
      *                                                                   143071
     C           @RTCD     IFNE *BLANKS                                   143071
      *                                                                   143071
     C                     MOVE 'AT'      @TRTY                           143071
     C                     CALL 'AOEXSTR0'                                143071
     C                     PARM *BLANKS   @RTCD                           143071
     C                     PARM '*KEY   ' @OPTN                           143071
     C                     PARM           @CYCD   3                       143071
     C                     PARM           @CUST   6                       143071
     C                     PARM           @TRTY   2                       143071
     C           SDEXST    PARM SDEXST    DSSDY                           143071
      *                                                                   143071
     C                     ENDIF                                          143071
      *                                                                   143071
     C           @RTCD     IFEQ *BLANKS                                   143071
     C                     MOVE 'Y'       EXDTA                           143071
     C                     ENDIF                                          143071
      *                                                                   143071
      * If loan has settlement details these should be used as default    126379
      * values on ext settlement screen SD2400 ( for insert use Amend     126379
      * action).                                                          126379
      *                                                                   126379
     C           SACTN     IFEQ 'I'                                       126379
     C                     MOVE 'A'       PMACTC                          126379
     C                     ELSE                                           126379
     C                     MOVE SACTN     PMACTC
     C                     ENDIF                                          126379
      *                                                                   126379
     C           SACTN     IFEQ 'R'
     C                     MOVE 'D'       PMACTC
     C                     ENDIF
     C                     MOVEL'MMLD'    PMCPGM
     C***                  MOVEL'MMLD'    PMCPGM                          135152
     C                     MOVEL'LEND'    PMCPGM                          135152
     C                     MOVE *BLANK    PMCMDP
     C                     Z-ADD0         PMDBSE
     C                     Z-ADDRUND      PMRUND
     C                     Z-ADDBVLP      PMBVPD
      *
     C           PMFRST    IFEQ 'Y'
     C                     MOVE 'N'       PMVALO
     C                     MOVE *BLANKS   PMERCD
     C                     ELSE
     C                     MOVE 'Y'       PMVALO
     C                     ENDIF
      *
      ** Determine if pay settlement should be protected
      *
     C           SACTN     IFEQ 'E'
     C           SACTN     OREQ 'R'
     C           SACTN     OREQ 'X'
     C                     MOVE 'Y'       PMPPAY
     C                     MOVE 'Y'       PMPRCV                          125186
     C                     MOVE 'N'       PMVALO
      *
      ** Settlement detail valid flag, date of receipt and payment
      *
     C                     MOVE VDAYNO    PMDTRC
     C                     MOVE VDAYNO    PMDTPY
     C                     ENDIF
      *
     C           PTYPA     IFEQ 66                                        125186
     C           PTYPA     OREQ 67                                        125186
     C           PTYPA     OREQ 69                                        125186
     C           CLE005    ANDEQ'Y'                                       125186
     C           PTYPA     OREQ 72                                        125186
     C           CLE005    ANDEQ'Y'                                       125186
     C                     MOVE 'Y'       WSOLD                           125186
     C                     ENDIF                                          125186
      *
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C           WSOLD     IFEQ 'Y'                                       125186
     C                     MOVE 'N'       PMPRCV                          125186
     C                     MOVE 'Y'       PMPPAY                          125186
     C                     ELSE                                           125186
     C                     MOVE 'N'       PMPPAY
     C                     MOVE 'Y'       PMPRCV                          125186
     C                     ENDIF                                          125186
     C                     MOVE 'N'       PMSDTV
      *
      ** Set up date of receipt for Insert or Amend
      *
     C                     Z-ADD*ZERO     PMDTRC
     C                     Z-ADD*ZERO     PMDTPY
     C           SACTN     IFEQ 'A'
     C                     MOVE VDAYNO    PMDTRC
     C                     MOVE VDAYNO    PMDTPY
     C           VDAT      IFLT RUND
     C           ORED      ANDLTRUND
     C                     MOVE 'Y'       PMPPAY
     C                     MOVE 'Y'       PMPRCV                          125186
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVE SATYP     PMTTYP
      *                                                                                       CLE038
     C                     EXSR SRBYAM                                                        CLE038
      *                                                                                       CLE038
     C                     MOVELSCNUM     PMCSNM
     C                     MOVELBRCA      PMBRCA
     C                     MOVE VDAYNO    PMDTRC
     C                     MOVE VDAYNO    PMDTPY
     C                     MOVE SCURR     PMRCCY
     C                     MOVE SCURR     PMPCCY
     C***********          MOVE 'Y'       PMPRCV                          125186
     C                     MOVE 'N'       PMSDTV
      *
     C           SACTN     IFNE 'I'
     C           PMERCD    IFEQ *BLANK
      *
      ** Set up payment settlement details
      *
     C                     MOVELPSTM      PMPSTM
     C                     MOVELPONS      PMPONS
      *                                                                   123699
     C***********PSTM      IFEQ 5                                   123699155931
     C           WSOLD     IFEQ 'Y'                                       161036
     C                     MOVE OSBR      PMROBR                          161036
     C                     ELSE                                           161036
     C                     MOVE OSBR      PMPOBR                          123699
     C                     ENDIF                                          161036
     C***********          ELSE                                     123699155931
     C***********          MOVE *BLANKS   PMPOBR                    123699155931
     C***********          ENDIF                                    123699155931
      *                                                                   123699
     C                     MOVELRCRN      PMRCRN
     C                     MOVELRCRN      PARCRN
     C                     MOVELRCRA      PMRCRA
     C                     MOVELPIBN      PMPIBN
     C                     MOVELPIBN      PAPIBN
     C                     MOVELPIBA      PMPIBA
     C                     MOVELPOCN      PMPOCN
     C                     MOVELPOCN      PAPOCN
     C                     MOVELPOBN      PMPOBN
     C                     MOVELPOBN      PAPOBN
     C                     MOVELRCRN      PMRCRN
     C                     MOVELRCRN      PARCRN
     C                     MOVELRCRA      PMRCRA
     C                     MOVELRVNO      PMRVNO
     C                     MOVELRVNO      PARVNO
     C                     MOVELAWBN      PMAWBN
     C                     MOVELAWBN      PAAWBN
     C                     MOVELAWBA      PMAWBA
     C                     MOVELBENN      PMBENN
     C                     MOVELBENN      PABENN
     C                     MOVELBENA      PMBENA
     C                     MOVELDTP1      PMDTP1
     C                     MOVELDTP2      PMDTP2
     C                     MOVELDTP3      PMDTP3
     C                     MOVELDTP4      PMDTP4
     C                     MOVELDCHG      PMDCHG
     C                     MOVELBTB1      PMBTB1
     C                     MOVELBTB2      PMBTB2
     C                     MOVELBTB3      PMBTB3
     C                     MOVELBTB4      PMBTB4
     C                     MOVELBTB5      PMBTB5
     C                     MOVELBTB6      PMBTB6
     C                     MOVELCVMR      PMCVMR
      *                                                                   125186
     C                     MOVELRSTM      PMRSTM                          125186
     C                     MOVELRONS      PMRONS                          125186
     C                     MOVELRIBN      PARIBN                          125186
     C                     MOVELRIBN      PMRIBN                          125186
     C                     MOVELROBN      PAROBN                          125186
     C                     MOVELROBN      PMROBN                          125186
     C                     MOVELROCN      PAROCN                          125186
     C                     MOVELROCN      PMROCN                          125186
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
      *                                                                   CEU004
     C           WSOLD     IFEQ 'Y'                                       CEU004
     C                     MOVE SCCY      PMRSCY                          CEU004
     C                     ELSE                                           CEU004
     C                     MOVE SCCY      PMPSCY                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C                     MOVE ICCY      PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y '                                                          CLE031
     C           WSOLD     IFEQ 'Y'                                                           CLE031
     C                     MOVE SCCY      PMRSCY                                              CLE031
     C                     MOVE REXI      PMREXI                                              CLE031
     C                     MOVE *BLANKS   PMPSCY                                              CLE031
     C                     MOVE *BLANKS   PMPEXI                                              CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C           REXR      IFEQ 0                                                             CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE REXR      ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMREXR                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
     C                     MOVE PSCY      PMPSCY                                              CLE031
     C                     MOVE PEXI      PMPEXI                                              CLE031
     C                     MOVE *BLANKS   PMRSCY                                              CLE031
     C                     MOVE *BLANKS   PMREXI                                              CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C           PEXR      IFEQ 0                                                             CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE PEXR      ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMPEXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF
      *
     C                     ELSE
      *
     C           PMFRST    IFEQ 'Y'
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE *BLANKS   PMPSCY                          CEU004
     C                     MOVE *BLANKS   PMRSCY                          CEU004
     C                     MOVE *BLANKS   PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   125186
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   PMPSCY                                              CLE031
     C                     MOVE *BLANKS   PMRSCY                                              CLE031
     C                     MOVE *BLANK    PMREXI                                              CLE031
     C                     MOVE *BLANK    PMPSCY                                              CLE031
     C                     MOVE *BLANK    PMPEXR                                              CLE031
     C                     MOVE *BLANK    PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVEL*BLANKS   PMPSTM                          125186
     C                     MOVEL*BLANKS   PMPONS                          125186
     C                     MOVEL*BLANKS   PMPOBR                          125186
     C                     MOVEL*BLANKS   PMPIBN                          125186
     C                     MOVEL*BLANKS   PAPIBN                          125186
     C                     MOVEL*BLANKS   PMRSTM                          125186
     C                     MOVEL*BLANKS   PMRONS                          125186
     C                     MOVEL*BLANKS   PMROBR                          125186
     C                     MOVEL*BLANKS   PMRIBN                          125186
     C                     MOVEL*BLANKS   PARIBN                          125186
      *                                                                   125186
     C           WSOLD     IFEQ *BLANK                                    125186
     C           SDST      IFNE 0
     C                     MOVE SDST      PMPSTM
     C                     ELSE
     C                     MOVE 0         PMPSTM
     C                     ENDIF
      *                                                                                       203291
     C           SDST      IFNE 04                                                            203291
     C                     MOVELOSDA      PMPONS
     C                     END                                                                203291
     C***********SDST      IFEQ 5                                         155931
     C                     MOVE OSDB      PMPOBR
     C***********          ELSE                                           155931
     C***********          MOVE *BLANKS   PMPOBR                          155931
     C***********          ENDIF                                          155931
     C***********          MOVELTSTN      PMPIBN                          143789
     C                     MOVELW#PIBN    PMPIBN                          143789
     C                     MOVELPMPIBN    PAPIBN
      *                                                                   125186
     C                     ELSE                                           125186
     C           SDST      IFNE 0                                         125186
     C                     MOVE SDST      PMRSTM                          125186
     C                     ELSE                                           125186
     C                     MOVE 0         PMRSTM                          125186
     C                     ENDIF                                          125186
      *                                                                                       203291
     C           SDST      IFNE 04                                                            203291
     C                     MOVELOSDA      PMRONS                          125186
     C                     END                                                                203291
     C***********SDST      IFEQ 5                                   125186155931
     C                     MOVE OSDB      PMROBR                          125186
     C***********          ELSE                                     125186155931
     C***********          MOVE *BLANKS   PMROBR                    125186155931
     C***********          ENDIF                                    125186155931
     C***********          MOVELTSTN      PMRIBN                    125186143789
     C***********          MOVELPMPIBN    PARIBN                    125186143789
     C                     MOVELW#RIBN    PMRIBN                          143789
     C                     MOVELPMRIBN    PARIBN                          143789
     C                     ENDIF                                          125186
      *
      ** Blank out payment settlement details
      *
     C                     MOVE *BLANKS   PMPOCN
     C                     MOVE *BLANKS   PAPOCN
     C                     MOVE *BLANKS   PMPOBN
     C                     MOVE *BLANKS   PAPOBN
     C                     MOVE *BLANKS   PMRCRN
     C                     MOVE *BLANKS   PARCRN
     C                     MOVE *BLANKS   PMRCRA
     C                     MOVE *BLANKS   PMPIBA
     C                     MOVE *BLANKS   PMRVNO
     C                     MOVE *BLANKS   PARVNO
     C                     MOVE *BLANKS   PMAWBN
     C                     MOVE *BLANKS   PAAWBN
     C                     MOVE *BLANKS   PMAWBA
     C                     MOVE *BLANKS   PMBENN
     C                     MOVE *BLANKS   PABENN
     C                     MOVE *BLANKS   PMBENA
     C                     MOVE *BLANKS   PMDTP1
     C                     MOVE *BLANKS   PMDTP2
     C                     MOVE *BLANKS   PMDTP3
     C                     MOVE *BLANKS   PMDTP4
     C                     MOVE *BLANKS   PMDCHG
     C                     MOVE *BLANKS   PMBTB1
     C                     MOVE *BLANKS   PMBTB2
     C                     MOVE *BLANKS   PMBTB3
     C                     MOVE *BLANKS   PMBTB4
     C                     MOVE *BLANKS   PMBTB5
     C                     MOVE *BLANKS   PMBTB6
     C                     MOVE *BLANKS   PMCVMR
      *                                                                   125186
      ** Set up/blank out receive settlement details for parts sold       125186
      *                                                                   125186
     C                     MOVE *BLANKS   PAROBN                          125186
     C                     MOVE *BLANKS   PMROBN                          125186
     C                     MOVE *BLANKS   PAROCN                          125186
     C                     MOVE *BLANKS   PMROCN                          125186
      *                                                                   125186
     C           EXDTA     IFNE 'Y'                                       143071
     C           WSOLD     IFEQ *BLANK                                    126379
     C                     MOVELW#POCN    PAPOCN                          126379
     C                     MOVELW#POBN    PAPOBN                          126379
     C                     MOVELW#PIBA    PMPIBA                          126379
     C                     MOVELW#RCRN    PARCRN                          126379
     C                     MOVELW#RCRA    PMRCRA                          126379
     C                     MOVELW#RVNO    PARVNO                          126379
     C                     MOVELW#AWBN    PAAWBN                          126379
     C                     MOVELW#AWBA    PMAWBA                          126379
     C                     MOVELW#BENN    PABENN                          126379
     C                     MOVELW#BENA    PMBENA                          126379
     C                     MOVELW#DTP1    PMDTP1                          126379
     C                     MOVELW#DTP2    PMDTP2                          126379
     C                     MOVELW#DTP3    PMDTP3                          126379
     C                     MOVELW#DTP4    PMDTP4                          126379
     C                     MOVELW#DCHG    PMDCHG                          126379
     C                     MOVELW#BTB1    PMBTB1                          126379
     C                     MOVELW#BTB2    PMBTB2                          126379
     C                     MOVELW#BTB3    PMBTB3                          126379
     C                     MOVELW#BTB4    PMBTB4                          126379
     C                     MOVELW#BTB5    PMBTB5                          126379
     C                     MOVELW#BTB6    PMBTB6                          126379
     C                     MOVELW#CVMR    PMCVMR                          126379
      *                                                                   126379
     C                     ELSE                                           126379
     C                     MOVELW#ROBN    PAROBN                          126379
     C                     MOVELW#ROCN    PAROCN                          126379
     C                     MOVELW#RIBA    PMRIBA                          126379
     C                     ENDIF                                          126379
      *                                                                   143071
      ** Default settlement details to Standard Settlement Instructions   143071
      *                                                                   143071
     C                     ELSE                                           143071
      *                                                                   143071
     C           WSOLD     IFEQ *BLANK                                    143071
     C                     MOVELBYPSTY    PMPSTM                          143071
     C                     MOVELBYPONO    PMPONS                          143071
     C                     MOVELBYOPBR    PMPOBR                          143071
     C                     MOVELBYPOCS    PAPOCN                          143071
     C                     MOVELBYPIBN    PAPIBN                          143071
     C                     MOVELBYPOBN    PAPOBN                          143071
     C                     MOVELBYPIBA    PMPIBA                          143071
     C                     MOVELBYRCNO    PARCRN                          143071
     C                     MOVELBYRCAL    PMRCRA                          143071
     C                     MOVELBYRCNB    PARVNO                          143071
     C                     MOVELBYACBN    PAAWBN                          143071
     C                     MOVELBYACBL    PMAWBA                          143071
     C                     MOVELBYBYNB    PABENN                          143071
     C                     MOVELBYBACL    PMBENA                          143071
     C                     MOVELBYDPY1    PMDTP1                          143071
     C                     MOVELBYDPY2    PMDTP2                          143071
     C                     MOVELBYDPY3    PMDTP3                          143071
     C                     MOVELBYDPY4    PMDTP4                          143071
     C                     MOVELBYDECG    PMDCHG                          143071
     C                     MOVELBYBBI1    PMBTB1                          143071
     C                     MOVELBYBBI2    PMBTB2                          143071
     C                     MOVELBYBBI3    PMBTB3                          143071
     C                     MOVELBYBBI4    PMBTB4                          143071
     C                     MOVELBYBBI5    PMBTB5                          143071
     C                     MOVELBYBBI6    PMBTB6                          143071
     C                     MOVELBYCVMR    PMCVMR                          143071
      *                                                                   143071
     C                     ELSE                                           143071
     C                     MOVELBYRSTY    PMRSTM                          143071
     C                     MOVE BYRONO    PMRONS                          143071
     C                     MOVE BYORBR    PMROBR                          143071
     C                     MOVELBYROBN    PAROBN                          143071
     C                     MOVELBYROCS    PAROCN                          143071
     C                     MOVE BYRIBN    PARIBN                          143071
     C                     MOVELBYRIBL    PMRIBA                          143071
     C                     ENDIF                                          143071
     C                     ENDIF                                          143071
      *                                                                   126379
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRWRIT  -  Write a new record in file                         *
      * Called by: Main                                               *
      * Calls    : SRSHAD - Retrieve parm fields for Shadow Update    *
      *            SRTRAL - Update Loan Amendments Trailer File       *
      *            SRLTRX - Update Loan Trans. Index (LTRIX)          *
      *            SRCLON - Update Loans File                         *
      *            SRFCLT - Update Faclity File                       *
      *            SRUSHD - Update Shadow Files                       *
      *            SRFEES - Update Fees File                          *   CLE009
      *****************************************************************
     C           SRWRIT    BEGSR
      *
      ** Find next available sequence no. for insert
      *
     C                     Z-ADD0         WLSN    30
     C                     MOVE SLOAN     WKLNR
     C                     Z-ADDVDAYNO    WKVDT
     C                     Z-ADD0         WKLSN
     C           KLAKEY    SETLLLOAMD
     C                     Z-ADD0         LASNP   30
      *
     C                     READ LOAMD                    79
      *
     C           *IN79     DOWEQ'0'
     C           RECI      IFEQ 'T'
     C                     LEAVE
     C                     ENDIF
     C           WKLNR     IFNE LNRF
     C           WKVDT     ORNE VDAT
     C                     LEAVE
     C                     ENDIF
     C                     Z-ADDLASN      LASNP
     C                     READ LOAMD                    79
     C                     ENDDO
      *
     C           LASNP     ADD  1         WLSN
     C/COPY WNCPYSRC,LE2040C026
      *
      ** Obtain last transaction number and prepare standard
      *
     C                     EXSR ZTNLU1
      *
      ** Move screen fields to file fields
      *
     C           PMODE     IFEQ 'P'
     C           PMODE     OREQ 'B'
      *                                                                   163973
     C           WSOLD     IFEQ 'Y'                                       163973
     C                     MOVE PMRSTM    TYPE                            163973
     C                     MOVE PMRONS    OTOURS                          163973
     C                     MOVELPMROBR    OOSBR                           163973
     C           PMRSTM    IFEQ 14                                                          AR400813
     C                     MOVELPMRONS    OTOURS                                            AR400813
     C                     ENDIF                                                            AR400813
     C                     ELSE                                           163973
     C                     MOVE PMPSTM    TYPE
     C                     MOVE PMPONS    OTOURS
     C           PMPSTM    IFEQ 14                                                          AR400813
     C                     MOVELPMPONS    OTOURS                                            AR400813
     C                     ENDIF                                                            AR400813
     C                     ENDIF                                          163973
      *                                                                   163973
     C                     MOVE PAPIBN    THRS
     C***********          MOVE PABENN    OTFACO                          125972
     C                     MOVELPABENN    OTFACO                          125972
     C                     ENDIF
      *
     C           PMODE     IFEQ 'I'                                       157547
     C           WSOLD     ANDEQ'Y'                                       157547
     C                     MOVE PMRSTM    TYPE                            157547
     C                     MOVE PMRONS    OTOURS                          157547
     C                     MOVELPMROBR    OOSBR                           157547
     C                     END                                            157547
     C*                                                                   157547
     C                     MOVE 'D'       RECI
     C                     MOVE SLOAN     LNRF
     C                     Z-ADDVDAYNO    VDAT
     C                     MOVE WLSN      LASN
     C                     MOVE '2'       MRIN
     C                     MOVE LTYPA     LTYP
     C           *IN23     IFEQ '0'
     C                     MOVE SUTPA     SUTP
     C                     MOVE PTYPA     PTYP
     C                     ELSE
     C                     MOVE SSTYP     SUTP
     C                     MOVE AYLNPT    PTYP
     C                     ENDIF
     C                     MOVE SATYP     AMTP
     C                     MOVE '00'      PRSQ
     C           SATYP     IFEQ 'BC'
     C                     MOVE SBRAT     BRTT
     C                     ELSE
     C                     Z-ADD0         BRTT
     C                     ENDIF
     C           SATYP     IFEQ 'SC'
     C           SATYP     OREQ 'BC'                                                          CLE036
      *                                                                                     AR847588
      ** Convert WSPRT to negative if spread rate sign is negative.                         AR847588
      *                                                                                     AR847588
     C           SRSGN     IFEQ '-'                                                         AR847588
     C                     Z-SUBWSPRT     WSPRT                                             AR847588
     C                     ENDIF                                                            AR847588
      *                                                                                     AR847588
     C                     Z-ADDWSPRT     RTSP
     C                     ELSE
     C                     Z-ADD0         RTSP
     C                     ENDIF
     C                     MOVE SCURR     CCY
     C           SATYP     IFEQ 'PI'
     C                     Z-ADDWLAMT     PRAM
     C                     Z-ADDWLAMT     TAMT
     C                     ELSE
     C                     Z-ADD0         PRAM
     C                     Z-ADD0         TAMT
     C           SATYP     IFEQ 'PT'
     C           SATYP     OREQ 'PF'
     C                     MOVE WPAMTF    PRAM
     C                     MOVE WPAMTF    TAMT
     C                     ENDIF
     C                     ENDIF
     C                     Z-ADD0         INTA
     C                     Z-ADD0         WTXA
     C                     Z-ADD0         FEAM
     C                     MOVELWLBRC     BRCA
     C                     MOVE WLCNO     CNUM
     C                     Z-ADD0         REPT
     C                     MOVE 'Y'       AUTO
     C                     MOVE SSTPA     STAI
     C                     MOVE TYPE      SETP
     C                     MOVELOTOURS    OSAC
     C                     MOVELTHRS      TSEN
     C                     MOVELOTFACO    FACO
     C                     MOVELSSPI1     SPI1
     C                     MOVELSSPI2     SPI2
     C                     MOVELSSPI3     SPI3
     C***********          MOVE OLAIN     LAIN                            126309
     C                     MOVE BIT       LAIN                            126309
     C           SATYP     IFEQ 'BC'
     C                     Z-ADDWBASR     BRTE
     C                     ELSE
     C                     Z-ADD0         BRTE
     C                     ENDIF
     C                     MOVE *BLANK    SPIN
     C                     Z-ADD0         CALC
     C                     MOVE *BLANK    WTIN
     C                     MOVE 'A'       LLAG
     C                     MOVE *BLANK    LWOI
     C                     Z-ADD0         XAVD
     C                     Z-ADD0         XASQ
     C**********           Z-ADDFCUSC     FCUS                                                CSD027
     C                     MOVE FCUSC     FCUS                                                CSD027
     C                     Z-ADDFTYPC     FTYP
     C                     Z-ADDFSEQC     FSEQ
     C**********           Z-ADD0         RLON                                                CSD027
     C                     MOVE *BLANKS   RLON                                                CSD027
     C                     Z-ADD0         FECD
     C                     MOVE BIT       PONI
     C                     Z-ADD0         LSWCC
     C                     Z-ADD0         LSWSC
     C                     MOVELOOSBR     OSBR
     C           *IN23     IFEQ '1'
     C***********          Z-ADDLSMD      LSMD                            124740
     C                     MOVE SMDAT     ZDATE                           124740
     C                     EXSR ZDATE1                                    124740
     C                     Z-ADDZDAYNO    LSMD                            124740
     C                     ELSE
     C                     Z-ADD0         LSMD
     C                     ENDIF
     C                     MOVE FCLBC     FCLB
     C                     Z-ADDRUND      ORED
     C                     Z-ADDRUND      LCD
     C                     MOVE 'I'       CHTP
     C                     Z-ADDNATN      TNLU
     C                     Z-ADDWFRAT     FSRP
     C                     MOVE WFSGN     FSGN
     C                     MOVE WCFPRC    FPRC
     C                     Z-ADD0         COFA
     C                     MOVE WIRCF     IRCF
     C                     MOVE WFRCF     FRCF
      *
     C           PMODE     IFEQ 'B'
     C                     MOVE PIPCOB    PCOBK
     C                     ELSE
     C                     MOVE *BLANKS   PCOBK
     C                     ENDIF
      *
      ** Settlement details
      *
     C           WSD       IFEQ *BLANK
     C           PMODE     ANDEQ'I'
     C           WSD       OREQ *BLANK
     C           PMODE     ANDEQ'R'
     C                     CLEARSETLIB
     C                     ENDIF
      *
     C                     Z-ADDPMRSTM    RSTM
     C                     MOVE PMRONS    RONS
     C                     MOVE PARIBN    RIBN
     C                     MOVE PMRIBA    RIBA
     C                     MOVE PAROBN    ROBN
     C                     MOVE PAROCN    ROCN
     C                     MOVE PMPSTM    PSTM
     C                     MOVE PMPONS    PONS
     C                     MOVE PAPIBN    PIBN
     C                     MOVE PMPIBA    PIBA
     C                     MOVE PAPOBN    POBN
     C                     MOVE PAPOCN    POCN
     C                     MOVE PARCRN    RCRN
     C                     MOVE PMRCRA    RCRA
     C                     MOVE PARVNO    RVNO
     C                     MOVE PAAWBN    AWBN
     C                     MOVE PMAWBA    AWBA
     C                     MOVE PABENN    BENN
     C                     MOVE PMBENA    BENA
     C                     MOVE PMDTP1    DTP1
     C                     MOVE PMDTP2    DTP2
     C                     MOVE PMDTP3    DTP3
     C                     MOVE PMDTP4    DTP4
     C                     MOVE PMDCHG    DCHG
     C                     MOVE PMBTB1    BTB1
     C                     MOVE PMBTB2    BTB2
     C                     MOVE PMBTB3    BTB3
     C                     MOVE PMBTB4    BTB4
     C                     MOVE PMBTB5    BTB5
     C                     MOVE PMBTB6    BTB6
     C                     MOVE PMCVMR    CVMR
     C                     MOVE PMPEXI    PEXI                                                CLE031
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE WSCCY     SCCY                            CEU004
     C                     MOVE PMIC72    ICCY                            CEU004
     C                     ENDIF                                          CEU004
      *
     C                     MOVE SDFTP     DFTP
     C                     MOVE SDFST     DFST
     C                     MOVE 'M'       MNSG
     C           PMODE     IFEQ 'B'                                       159095
     C                     MOVE PIGASS    GASS                            159095
     C                     ELSE                                           159095
     C                     MOVE 'N'       GASS
     C                     ENDIF                                          159095
     C                     MOVE 'N'       GPRT
     C                     MOVE 'N'       NRLI
     C**********           Z-ADD0         ROLN                                                CLE148
     C                     MOVEL*BLANKS   ROLN                                                CLE148
     C                     Z-ADD0         ROSN
     C**********           Z-ADD0         RORC                                                CSD027
     C                     MOVE *BLANKS   RORC                                                CSD027
     C                     MOVE *BLANK    ROBR
     C                     MOVE *BLANK    PDGN
     C                     MOVE *BLANK    GRIN
     C                     MOVE *BLANK    RLCY
     C                     Z-ADD0         PNAM
     C                     MOVE *BLANKS   FRCY                                                CLE036
     C                     Z-ADD0         FRAM                                                CLE036
     C                     Z-ADD0         FINT                                                CLE036
     C                     Z-ADD0         FTXA                                                CLE036
     C                     Z-ADD0         FTOT                                                CLE036
     C                     Z-ADD0         FPEN                                                CLE036
     C                     MOVE *BLANK    PAST
     C           BPLMAU    IFEQ 'N'
     C           CLE002    OREQ 'N'                                       CLE005
     C                     MOVE 'A'       ASTS
     C                     ELSE
     C                     MOVE 'C'       ASTS
     C                     ENDIF
     C           PMODE     IFEQ 'B'                                       120002
     C                     MOVE PIIUSR    IUSR                            120002
     C                     MOVE PIAUSR    AUSR                            120002
     C                     MOVE PIXUSR    XUSR                            120002
     C                     ELSE                                           120002
     C                     MOVELUSER      IUSR
     C                     MOVE *BLANK    AUSR
     C                     MOVE *BLANK    XUSR
     C                     ENDIF                                          120002
      *
      ** If mode is 'B'...
      *
     C           PMODE     IFEQ 'B'
      *                                                                   121840
      *  In batch mode loan amendments should automatically be            121840
      *  authorised                                                       121840
      *  except when coming from principal transfer on Midas side         123227
      *                                                                   121840
     C           PIPCOB    IFNE *BLANKS                                   123227
     C           BPTPAU    OREQ 'N'                                       123227
     C           CLE002    OREQ 'N'                                       155610
     C                     MOVE 'A'       ASTS                            121840
     C                     ELSE                                           123227
     C                     MOVE 'C'       ASTS                            123227
     C                     ENDIF                                          123227
      *
      ** Set up Original Entry Date, and Last Change Date
      *
     C                     MOVE PITDST    WPITDS
     C                     MOVELWPIDD     WFLD4   4
     C                     MOVE WPIMM     WFLD4
     C                     MOVELWFLD4     WFLD6   6
     C                     MOVE WPIYY     WFLD6
     C                     MOVELWFLD6     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    ORED
     C                     Z-ADDZDAYNO    LCD
      *                                                                   122109
     C                     MOVE PINRLI    NRLI                            122109
     C                     MOVE PIROLN    ROLN                            122109
     C                     MOVE PIROAS    ROSN                            122109
     C                     MOVE PIROCU    RORC                            122109
     C                     MOVE PIROBR    ROBR                            122109
      *                                                                   122109
     C           SATYP     IFNE 'PT'                                      122109
     C           SATYP     ANDNE'PF'                                      122109
     C***********          MOVE 'S'       MNSG                      122109122461
     C                     ELSE                                           122109
     C                     MOVE 'Y'       GPRT                            122109
     C                     ENDIF                                          122109
      *                                                                   122109
     C***********          ENDIF                                   122109 123789
      *                                                                   122461
     C           P#TSEQ    IFNE 1                                         122461
     C           PIPTIN    ANDNE'T'                                       122461
     C                     MOVE 'S'       MNSG                            122461
     C                     ENDIF                                          122461
      *
      ** Set up Last Change Type and PC transaction reference
      *
     C           PITACT    IFNE 'X'                                       123789
     C                     MOVE PITACT    CHTP
     C                     ENDIF                                          123789
     C                     ENDIF                                          123789
      *
     C           PMODE     IFNE 'B'
     C           SACTN     ANDEQ'I'
     C           PMODE     OREQ 'B'                                       162602
     C           SACTN     ANDEQ'I'                                       162602
     C           PIPTIN    ANDEQ'T'                                       162602
     C                     MOVE BRCA      PBRCA
     C***********          CALL 'AOBRCHR0'                                121783
     C                     CALL 'AOBRCHR1'                                121783
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PBRCA
     C           SDBRCH    PARM SDBRCH    DSSDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRCHPD'DBFILE           ************
     C                     Z-ADD39        DBASE            * DBERR 39 *
     C                     MOVELBRCA      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVELA8MQSM    W#1ST3  3
     C***                  MOVELW#1ST3    PCRFK     P                     158177
     C********** *NAMVAR   DEFN           LEALLO                                       158177 CLE148
     C********** *LOCK     IN   LEALLO                                                 158177 CLE148
     C********** PCLAST    ADD  1         PCNEXT  80                                   158177 CLE148
     C                     CALL 'LEALLO'                                                      CLE148
     C                     PARM *BLANKS   PRTCD   7                                           CLE148
     C                     PARM 'Y'       PUPDT   1                                           CLE148
     C                     PARM *BLANKS   PCLAST                                              CLE148
     C                     PARM *BLANKS   PCNEXT  8                                           CLE148
      *                                                                                       CLE148
     C                     MOVE PCNEXT    W1ST11 11                       158177
     C                     MOVELW#1ST3    W1ST11                          158177
     C                     MOVELW1ST11    PCRFK                           158177
     C                     MOVE '0001'    PCRFK                           158177
     C**********           Z-ADDPCNEXT    PCLAST                                       158177 CLE148
     C**********           OUT  LEALLO                                                 158177 CLE148
     C                     ENDIF
     C                     ELSE
     C           PMODE     IFEQ 'B'
     C                     MOVELPITREF    PCRFK
     C                     ENDIF
     C                     ENDIF
      ***********                                                         122109
     C***********          MOVE PINRLI    NRLI                            122109
     C***********          MOVE PIROLN    ROLN                            122109
     C***********          MOVE PIROAS    ROSN                            122109
     C***********          MOVE PIROCU    RORC                            122109
     C***********          MOVE PIROBR    ROBR                            122109
      ***********                                                         122109
     C***********SATYP     IFNE 'PT'                                      122109
     C***********SATYP     ANDNE'PF'                                      122109
     C***********          MOVE 'S'       MNSG                            122109
     C***********          ELSE                                           122109
     C***********          MOVE 'Y'       GPRT                            122109
     C***********          ENDIF                                          122109
      ***********                                                         122109
     C***********          ENDIF                                          122109
      *                                                                   135349
      ** If amendment type is 'PF' or a 'PT save loan number and amend-   135349
      ** ment type to work field.                                         135349
      *                                                                   135349
     C           AMTP      IFEQ 'PF'                                      135349
     C           AMTP      OREQ 'PT'                                      135349
     C**********           MOVE LNRF      WLNNM   60                                   135349 CLE148
     C                     MOVE LNRF      WLNNM   6                                           CLE148
     C                     MOVE AMTP      WAMTP   2                       135349
     C                     ENDIF                                          135349
     C           CEU020    IFEQ 'Y'                                       CEU020
     C                     MOVE 'N'       ECIN                            CEU020
     C                     ENDIF                                          CEU020
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
      *                                                                                       232348
      ** Only process EIR cost accounting if loan's value date is same                        232348
      ** as or after the non-linear amortisation cut-off date                                 232348
     C           VDAT      ANDGEFSNLAC                                                        232348
      *                                                                                       CAS009
     C                     MOVE *BLANK    WADJP   1                                           CAS009
     C                     MOVE *BLANK    WDELR   1                                           CAS009
      *                                                                                       CAS009
      ** Need to recalculate the EIR of a loan on amendment.                                  CAS009
      *                                                                                       CAS009
     C           SATYP     IFEQ 'PF'                                                          CAS009
     C           SATYP     OREQ 'PT'                                                          CAS009
     C           SATYP     OREQ 'PI'                                                          CAS009
     C           SATYP     OREQ 'SA'                                                          CAS009
     C**********           Z-ADDLNRF      WTRAN   60                                   CAS009 CLE148
     C                     MOVELLNRF      WTRAN   6                                           CLE148
     C                     Z-ADDVDAT      WVALD   50                                          CAS009
     C                     EXSR SEIRI1                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           SATYP     IFEQ 'SC'                                                          CAS009
     C           SATYP     OREQ 'BC'                                                          CAS009
     C**********           Z-ADDLNRF      WTRAN                                        CAS009 CLE148
     C                     MOVELLNRF      WTRAN                                               CLE148
     C                     Z-ADDVDAT      WVALD                                               CAS009
     C                     MOVE 'Y'       WADJP                                               CAS009
     C                     EXSR SEIRI1                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *
      ** Write a new record to file LOAMS
      *
     C           SATYP     IFEQ 'PT'                                      138866
     C           SATYP     OREQ 'PF'                                      138866
     C                     Z-ADDW#RTSP    RTSP                            138866
     C                     Z-ADDW#BRTE    BRTE                            138866
     C                     MOVELW#SPIN    SPIN                            138866
     C                     Z-ADDW#CALC    CALC                            138866
     C                     Z-ADDW#BEG     ZIBEG                           138866
     C                     Z-ADDW#END     ZIEND                           138866
     C                     Z-ADDW#CALC    ZICALC                          138866
     C                     Z-ADDW#RATE    ZIRATE                          138866
     C                     Z-ADDPRAM      ZIAMT                           138866
     C                     EXSR GLINTC                                    138866
     C                     Z-ADDZINTR     INTA                            138866
     C                     ENDIF                                          138866
      *                                                                                       CSD015
      ** Call  SRWTCH if watch list checking is apllied.                                      CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C           AMTP      ANDEQ'PI'                                                          CSD015
      *                                                                                       CSD015
     C                     MOVEA*BLANKS   WLF,1                                               CSD015
     C                     MOVEL'N'       WNBLNK  1                                           CSD015
      *                                                                                       CSD015
     C           RONS      IFNE *BLANKS                                                       CSD015
     C           RIBN      ORNE *BLANKS                                                       CSD015
     C********** ROBN      ORNE *ZERO                                                  CSD015 CSD027
     C********** ROCN      ORNE *ZERO                                                  CSD015 CSD027
     C           ROBN      ORNE *BLANKS                                                       CSD027
     C           ROCN      ORNE *BLANKS                                                       CSD027
     C           PONS      ORNE *BLANKS                                                       CSD015
     C           PIBN      ORNE *BLANKS                                                       CSD015
     C********** POBN      ORNE *ZERO                                                  CSD015 CSD027
     C********** POCN      ORNE *ZERO                                                  CSD015 CSD027
     C           POBN      ORNE *BLANKS                                                       CSD027
     C           POCN      ORNE *BLANKS                                                       CSD027
     C           RCRN      ORNE *BLANKS                                                       CSD015
     C           RVNO      ORNE *BLANKS                                                       CSD015
     C           AWBN      ORNE *BLANKS                                                       CSD015
     C           BENN      ORNE *BLANKS                                                       CSD015
     C           DTP1      ORNE *BLANKS                                                       CSD015
     C           DTP2      ORNE *BLANKS                                                       CSD015
     C           DTP3      ORNE *BLANKS                                                       CSD015
     C           DTP4      ORNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C                     MOVEL'Y'       WDTPC                                               CSD015
      *                                                                                       CSD015
     C                     MOVELRONS      WLF,1                                               CSD015
     C                     MOVELRIBN      WLF,2                                               CSD015
     C                     MOVELROBN      WLF,3                                               CSD015
     C                     MOVELROCN      WLF,4                                               CSD015
     C                     MOVELPONS      WLF,5                                               CSD015
     C                     MOVELPIBN      WLF,6                                               CSD015
     C                     MOVELPOBN      WLF,7                                               CSD015
     C                     MOVELPOCN      WLF,8                                               CSD015
     C                     MOVELRCRN      WLF,9                                               CSD015
     C                     MOVELRVNO      WLF,10                                              CSD015
     C                     MOVELAWBN      WLF,11                                              CSD015
     C                     MOVELBENN      WLF,12                                              CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PMREXR    REXR                                                CLE031
     C                     MOVE PMPEXR    PEXR                                                CLE031
     C                     MOVE PMREXI    REXI                                                CLE031
     C                     MOVE PMPEXI    PEXI                                                CLE031
     C                     MOVE PMPSCY    PSCY                                                CLE031
     C                     MOVE PMRSCY    SCCY                                                CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE SSTAL     STAL                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C/COPY ZSRSRC,DFTTSTAMPC                                             CLE029
     C                     MOVELTSTAMP    PTMST                           CLE029
     C                     WRITELOAMSDKF               79
      *                                                                                     AR400813
      ** Setup fields for CLOAMSQD                                                          AR400813
      *                                                                                     AR400813
     C           PMODE     IFEQ 'B'                                                         AR400813
      *                                                                                     AR400813
     C                     MOVE LNRF      AMLNRF                                            AR400813
     C                     MOVE VDAT      AMVDAT                                            AR400813
     C                     MOVE LASN      AMLASN                                            AR400813
     C                     MOVE BRCA      AMBRCA                                            AR400813
     C                     WRITELOAMSQD0                                                    AR400813
      *                                                                                     AR400813
     C                     ENDIF                                                            AR400813
      *                                                                                       CLE034
      ** After LOAMSDK has been written to, need to update the                                CLE034
      ** settlement allocations table.                                                        CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           STAL      ANDEQ'Y'                                                           CLE034
     C           SACTN     ANDEQ'I'                                                           CLE034
     C           WNKEY     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALU0'                                                    CLE034
     C                     PARM PMODE     PRTCD                                               CLE034
     C                     PARM 'LAPI  '  PTYPE                                               CLE034
     C                     PARM 'U'       PACTN   1                                           CLE034
     C                     PARM           LNRF                                                CLE034
     C                     PARM           VDAT                                                CLE034
     C                     PARM           LASN                                                CLE034
     C                     PARM *BLANKS   PCNUM                                               CLE034
     C                     PARM *BLANKS   PFACL                                               CLE034
     C                     PARM *BLANKS   PFESQ                                               CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM           PCRFK                                               CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C/COPY WNCPYSRC,LE2040C021
     C           *LIKE     DEFN LASN      W#LASN                          144096
     C                     Z-ADDLASN      W#LASN                          144096
      *
      ** Pass Parameter fields for Shadow update
      *
      ** Update on shadow files should only be done if not a Risk loan    175450
      *                                                                   175450
     C           PTYP      IFNE 70                                        175450
     C           PTYP      ANDNE71                                        175450
     C           PTYP      ANDNE72                                        175450
     C           SATYP     IFNE 'PT'
     C           SATYP     ANDNE'PF'
      *
     C                     EXSR SRSHAD
     C                     MOVE Z#ADTA    Z#ADT1
     C                     MOVE Z#ADTB    Z#ADT2
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           CLE031    OREQ 'Y'                                                           CLE031
     C                     MOVE Z#ADTE    Z#ADT5                          CEU004
     C                     ENDIF                                          CEU004
      *
     C                     MOVE '0'       *IN24
     C                     MOVELWLSN      WLSNA
     C                     ENDIF
     C                     ENDIF                                          175450
      *
      ** Write a new record in file LE2040PD if mode is 'R'
      *
     C           PMODE     IFEQ 'R'
      *
     C                     Z-ADDRUND      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     WDATE
     C                     MOVELWDD       WFLD3A  3
     C                     MOVE '/'       WFLD3A
     C                     MOVELWMM       WFLD3B  3
     C                     MOVE '/'       WFLD3B
     C                     MOVELWFLD3A    WFLD6A  6
     C                     MOVE WFLD3B    WFLD6A
     C                     MOVELWFLD6A    WDTST   8
     C                     MOVE WYY       WDTST
     C                     MOVELWDTST     DTST
      *
     C                     TIME           WTIME   60
     C                     MOVELWTIME     WTIMEA  6
     C                     MOVELWHH       WFLD3A  3
     C                     MOVE ':'       WFLD3A
     C                     MOVELWNN       WFLD3B  3
     C                     MOVE ':'       WFLD3B
     C                     MOVELWFLD3A    WFLD6A  6
     C                     MOVE WFLD3B    WFLD6A
     C                     MOVELWFLD6A    WTMST   8
     C                     MOVE WSS       WTMST
     C                     MOVELWTMST     TMST
      *
     C                     MOVELSACTN     ACTN
     C                     MOVE *BLANK    MSVR
     C                     MOVE *BLANK    MSID
     C                     MOVE *BLANK    MSTX
     C                     Z-ADD0         LASN
      *
      ** Save test harness record for later update after COMIT
      *
     C                     MOVE L2040F    L2040S
     C                     ENDIF
      *
      ** Update Loan Amend. Trailer file, LTRIX, Loans file,
      ** Facility and Shadow Files
      *
     C           *IN79     IFEQ '0'
     C                     EXSR SRTRAL
     C                     EXSR SRLTRX
     C           SATYP     IFNE 'PT'
     C           SATYP     ANDNE'PF'
     C                     EXSR SRCLON
     C                     EXSR SRFCLT
      *                                                                   CLE009
      ** If CLE009 is installed, update fees file                         CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     EXSR SRFEES                                    CLE009
     C                     ENDIF                                          CLE009
      *
      ** Update on shadow files should only be done if not a Risk loan    175450
      *                                                                   175450
     C           PTYP      IFNE 70                                        175450
     C           PTYP      ANDNE71                                        175450
     C           PTYP      ANDNE72                                        175450
     C                     EXSR SRUSHD
     C                     ENDIF                                          175450
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LEH00582
      *                                                                   CSC011
      * If Support System active, write transaction to 24x7 log           CSC011
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C*                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
      *                                                                   CSC011
      * Convert Loan Amendment to PINPP format                            CSC011
     C                     EXSR LOG247                                    CSC011
      *                                                                   CSC011
      * Write valid Loan Amendment in PINPP format to 24x7 Log File       CSC011
     C                     MOVE 'V'       LOGVAL  1                       CSC011
     C                     EXSR APLGTR                                    CSC011
     C                     COMIT                                          CSC011
      *                                                                   CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
      *
      ** COMMIT if no errors
      *
     C           *IN79     IFEQ '0'
      *                                                                   CDE001
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           CDE001    IFEQ 'Y'                                       CDE001
     C                     MOVELSLOAN     T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C                     PARM           T#TREF 20                       CDE001
     C                     PARM 'LOAN'    T#TCAT  4                       CDE001
     C                     PARM *BLANKS   RSRVID 10                       CDE005
     C                     ENDIF                                          CDE001
      *
     C           PMODE     IFNE 'B'
     C***********PMODE     ANDNE'P'                                       120002
     C                     COMIT
     C                     ENDIF
      *
      ** Write a new record to test harness file
      *
     C           PMODE     IFEQ 'R'
     C                     MOVE L2040S    L2040F
     C                     WRITELE2040D0               79
     C                     ENDIF
      *
     C                     MOVE 'F0'      WFMT
     C                     ENDIF
     C/COPY WNCPYSRC,LE2040C006
      *                                                                   CAP061
      ** Delete invalid record after insert                               CAP061
      *                                                                   CAP061
     C           PMODE     IFEQ 'F'                                       CAP061
     C           XREPN     CHAINLEILAMDL             99                   CAP061
     C                     DELETLEILAMDL                                  CAP061
     C                     COMIT                                          CAP061
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     EXSR LOGDEL                                    CSC011
     C                     ENDIF                                          CSC011
     C/COPY WNCPYSRC,LEH00522
     C*                                                                   CSC011
     C                     END                                            CAP061
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRUPDT  -  Update record                                      *
      * Called by: Main                                               *
      * Calls    : SRSHAD - Retrieve param fields for Shadow Update   *
      *            SRTRAL - Update Loan Amendments Trailer File       *
      *            SRLTRX - Update Loan Trans. Index (LTRIX)          *
      *            SRCLON - Update Loans File                         *
      *            SRFCLT - Update Faclity File                       *
      *            SRUSHD - Update Shadow Files                       *
      *            SRFEES - Update Fees File                          *   CLE009
      *****************************************************************
     C           SRUPDT    BEGSR
     C/COPY WNCPYSRC,LEH00523
      *
      ** Check whether amended by another work station
      *
     C           KLAKEY    CHAINLOAMS                79
     C*                                                                   143802
     C**Save principal amount in case action is amendment of assignment   143802
     C*                                                                   143802
     C           *LIKE     DEFN PRAM      W#PRLA                          143802
     C                     Z-ADD0         W#PRLA                          143802
     C                     MOVE PRAM      W#PRLA                          143802
      *
     C           LSTC      IFNE LSTCS
     C                     MOVEL'LEA1033' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'D1'      WFMT
     C                     GOTO EXUPD
     C                     ENDIF
      *
      ** Update on shadow files should only be done if not a Risk loan    175450
      *                                                                   175450
     C           PTYP      IFNE 70                                        175450
     C           PTYP      ANDNE71                                        175450
     C           PTYP      ANDNE72                                        175450
     C           SATYP     IFNE 'PT'
     C           SATYP     ANDNE'PF'
     C                     EXSR SRSHAD
     C                     MOVE SETP      SHTYPE                                              217459
     C                     MOVELOSAC      SHOURS                                              217459
     C                     MOVELTSEN      SHTHRS                                              217459
     C                     MOVELFACO      SHFACO                                              217459
     C                     MOVE Z#ADTA    Z#BDT1
     C                     MOVE Z#ADTB    Z#BDT2
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           CLE031    OREQ 'Y'                                                           CLE031
     C                     MOVE Z#ADTE    Z#BDT5                          CEU004
     C                     ENDIF                                          CEU004
     C                     ENDIF
     C                     ENDIF                                          175450
      *
      ** Obtain last transaction number and prepare standard
      *
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      TNLU
      *
      ** Set up the following fields for action Amend
      *
     C           SACTN     IFEQ 'A'
      *                                                                                       CSD015
      **  Check if before and after image of the record of LOAMSDK                            CSD015
      **  is different.                                                                       CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       WDIFF   1                                           CSD015
     C                     MOVE 'N'       WDTPC   1                                           CSD015
     C                     MOVE ROBN      WROBN   6                                           CSD015
     C                     MOVE ROCN      WROCN   6                                           CSD015
     C                     MOVE POBN      WPOBN   6                                           CSD015
     C                     MOVE POCN      WPOCN   6                                           CSD015
      *                                                                                       CSD015
      **  Settlement Fields                                                                   CSD015
      *                                                                                       CSD015
     C                     MOVEA*BLANKS   WLF,1                                               CSD015
      *                                                                                       CSD015
     C           RONS      IFNE PMRONS                                                        CSD015
     C                     MOVELPMRONS    WLF,1                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RIBN      IFNE PARIBN                                                        CSD015
     C                     MOVELPARIBN    WLF,2                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           WROBN     IFNE PAROBN                                                        CSD015
     C                     MOVELPAROBN    WLF,3                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           WROCN     IFNE PAROCN                                                        CSD015
     C                     MOVELPAROCN    WLF,4                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PONS      IFNE PMPONS                                                        CSD015
     C                     MOVELPMPONS    WLF,5                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PIBN      IFNE PAPIBN                                                        CSD015
     C                     MOVELPAPIBN    WLF,6                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           WPOBN     IFNE PAPOBN                                                        CSD015
     C                     MOVELPAPOBN    WLF,7                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           WPOCN     IFNE PAPOCN                                                        CSD015
     C                     MOVELPAPOCN    WLF,8                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RCRN      IFNE PARCRN                                                        CSD015
     C                     MOVELPARCRN    WLF,9                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RVNO      IFNE PARVNO                                                        CSD015
     C                     MOVELPARVNO    WLF,10                                              CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           AWBN      IFNE PAAWBN                                                        CSD015
     C                     MOVELPAAWBN    WLF,11                                              CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           BENN      IFNE PABENN                                                        CSD015
     C                     MOVELPABENN    WLF,12                                              CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           DTP1      IFNE PMDTP1                                                        CSD015
     C           DTP2      ORNE PMDTP2                                                        CSD015
     C           DTP3      ORNE PMDTP3                                                        CSD015
     C           DTP4      ORNE PMDTP4                                                        CSD015
     C                     MOVE 'Y'       WDTPC                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVELSSPI1     SPI1
     C                     MOVELSSPI2     SPI2
     C                     MOVELSSPI3     SPI3
     C                     MOVELOOSBR     OSBR
     C                     MOVE 'A'       CHTP
     C           PMODE     IFEQ 'B'                                       120002
     C                     MOVE PIAUSR    AUSR                            120002
     C                     MOVE PIXUSR    XUSR                            120002
     C                     ELSE                                           120002
     C                     MOVELUSER      AUSR
     C                     ENDIF                                          120002
     C                     MOVE OLAIN     LAIN
     C                     Z-ADDWOLSWC    LSWCC
     C                     Z-ADDWOLSWS    LSWSC
      *                                                                   123227
      ** Consider Principal transfer flag on amend of such                123227
      *                                                                   123227
     C           PMODE     IFEQ 'B'                                       123227
     C           PIPCOB    ANDEQ*BLANKS                                   123227
     C                     SELEC                                          123227
     C           BPTPAU    WHEQ 'N'                                       123227
     C           CLE002    OREQ 'N'                                       155610
     C                     MOVE 'A'       ASTS                            123227
     C           ASTS      WHEQ 'A'                                       123227
     C                     MOVE 'R'       ASTS                            123227
      *                                                                   158207
      * Status 'R' should remain as 'R' on amend                          158207
     C           ASTS      WHEQ 'R'                                       158207
     C                     OTHER                                          123227
     C                     MOVE 'C'       ASTS                            123227
     C                     ENDSL                                          123227
     C                     ELSE                                           123227
      *                                                                   123227
     C           BPLMAU    IFEQ 'N'
     C           CLE002    OREQ 'N'                                       155610
     C                     MOVE 'A'       ASTS
     C                     ELSE
     C           ASTS      IFEQ 'A'
     C                     MOVE 'R'       ASTS
      *                                                                   158207
      * Status 'R' should remain as 'R' on amend                          158207
     C                     ELSE                                           158207
     C           ASTS      IFEQ 'R'                                       158207
     C                     ELSE
     C                     MOVE 'C'       ASTS
     C                     ENDIF                                          158207
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                          123227
      *
      ** Settlement details
      *
     C                     Z-ADDPMRSTM    RSTM
     C                     MOVE PMRONS    RONS
     C                     MOVE PARIBN    RIBN
     C                     MOVE PMRIBA    RIBA
     C                     MOVE PAROBN    ROBN
     C                     MOVE PAROCN    ROCN
     C                     MOVE PMPSTM    PSTM
     C                     MOVE PMPONS    PONS
     C                     MOVE PAPIBN    PIBN
     C                     MOVE PMPIBA    PIBA
     C                     MOVE PAPOBN    POBN
     C                     MOVE PAPOCN    POCN
     C                     MOVE PARCRN    RCRN
     C                     MOVE PMRCRA    RCRA
     C                     MOVE PARVNO    RVNO
     C                     MOVE PAAWBN    AWBN
     C                     MOVE PMAWBA    AWBA
     C                     MOVE PABENN    BENN
     C                     MOVE PMBENA    BENA
     C                     MOVE PMDTP1    DTP1
     C                     MOVE PMDTP2    DTP2
     C                     MOVE PMDTP3    DTP3
     C                     MOVE PMDTP4    DTP4
     C                     MOVE PMDCHG    DCHG
     C                     MOVE PMBTB1    BTB1
     C                     MOVE PMBTB2    BTB2
     C                     MOVE PMBTB3    BTB3
     C                     MOVE PMBTB4    BTB4
     C                     MOVE PMBTB5    BTB5
     C                     MOVE PMBTB6    BTB6
     C                     MOVE PMCVMR    CVMR
     C                     MOVE TYPE      SETP                            152678
     C                     MOVELOTOURS    OSAC                                                217459
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE WSCCY     SCCY                            CEU004
     C                     MOVE PMIC72    ICCY                            CEU004
     C                     ENDIF                                          CEU004
      *
     C                     ENDIF
      *
      ** Set up the following fields for Authorisation
      *
     C           SACTN     IFEQ 'X'
     C           BPLMAU    ANDEQ'Y'
     C                     MOVE 'A'       ASTS
     C                     MOVELUSER      XUSR
     C                     ENDIF
      *
      ** Set up the following fields for reverse Amend
      *
     C           SACTN     IFEQ 'R'
     C                     MOVE 'R'       RECI
     C                     MOVE 'R'       CHTP
     C                     MOVE 'D'       ASTS
     C                     Z-ADDRUND      LCD                             180044
     C                     Z-ADDWOLSWC    LSWCC
     C                     Z-ADDWOLSWS    LSWSC
     C                     ENDIF
      *
      ** Set up the Last Change Date field if mode is 'B'
      *
     C           PMODE     IFEQ 'B'
      *
     C           PIPCOB    IFNE *BLANKS                                   123227
     C           SACTN     OREQ 'X'                                       123227
     C           SACTN     OREQ 'R'                                       123227
     C                     MOVE 'A'       ASTS                            120002
     C                     ENDIF                                          123227
     C                     MOVE PITDST    WPITDS
     C                     MOVELWPIDD     WFLD4   4
     C                     MOVE WPIMM     WFLD4
     C                     MOVELWFLD4     WFLD6   6
     C                     MOVE WPIYY     WFLD6
     C                     MOVELWFLD6     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    LCD
      *
      ** Set up Last Change Type and PC transaction reference
      *
     C           PITACT    IFNE 'X'                                       123789
     C                     MOVE PITACT    CHTP
     C                     ENDIF                                          123789
      *
     C           SATYP     IFEQ 'PT'
     C           SATYP     OREQ 'PF'
      *                                                                   135349
      ** Move previous transferred amount to WPRAM work field             135349
      *                                                                   135349
     C                     MOVE PRAM      WPRAM  130                      135349
     C                     MOVE WPAMTF    PRAM
     C                     MOVE WPAMTF    TAMT
     C                     MOVE PINRLI    NRLI
     C                     MOVE PIROLN    ROLN
     C                     MOVE PIROAS    ROSN
     C                     MOVE PIROCU    RORC
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                   122461
      * Setting of 'manual/system generated' flag.                        122461
     C                     SELEC                                          122461
     C           SACTN     WHEQ 'X'                                       122461
     C           PMODE     WHEQ 'B'                                       122461
     C           PIPTIN    ANDNE'T'                                       122461
     C           P#TSEQ    ANDNE1                                         122461
     C                     MOVE 'S'       MNSG                            122461
     C                     OTHER                                          122461
     C                     MOVE 'M'       MNSG                            122461
     C                     ENDSL                                          122461
      *                                                                   122461
     C           SATYP     IFEQ 'PT'                                      138866
     C           SACTN     ANDEQ'A'                                       138866
     C           SATYP     OREQ 'PF'                                      138866
     C           SACTN     ANDEQ'A'                                       138866
     C                     SELEC                                          138866
     C           SPIN      WHEQ 'A'                                       138866
     C           BRTE      ADD  RTSP      W#RATE 117                      138866
     C           SPIN      WHEQ 'S'                                       138866
     C           BRTE      SUB  RTSP      W#RATE                          138866
     C           SPIN      WHEQ 'P'                                       138866
     C           RTSP      DIV  100       WRK139 139                      138866
     C           WRK139    MULT BRTE      W#RATE    H                     138866
     C                     ENDSL                                          138866
     C                     Z-ADDW#BEG     ZIBEG                           138866
     C                     Z-ADDW#END     ZIEND                           138866
     C                     Z-ADDCALC      ZICALC                          138866
     C                     Z-ADDW#RATE    ZIRATE                          138866
     C                     Z-ADDPRAM      ZIAMT                           138866
     C                     EXSR GLINTC                                    138866
     C                     Z-ADDZINTR     INTA                            138866
     C                     ENDIF                                          138866
      *                                                                   135349
      ** If amendment type is 'PF' or a 'PT' save loan number and amend   135349
      ** ment type to work field.                                         135349
      *                                                                   135349
     C           AMTP      IFEQ 'PF'                                      135349
     C           AMTP      OREQ 'PT'                                      135349
     C                     MOVE LNRF      WLNNM                           135349
     C                     MOVE AMTP      WAMTP                           135349
     C                     ENDIF                                          135349
     C           CEU020    IFEQ 'Y'                                       CEU020
     C                     MOVE 'N'       ECIN                            CEU020
     C                     ENDIF                                          CEU020
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PMREXR    REXR                                                CLE031
     C                     MOVE PMPEXR    PEXR                                                CLE031
     C                     MOVE PMREXI    REXI                                                CLE031
     C                     MOVE PMPEXI    PEXI                                                CLE031
     C                     MOVE PMPSCY    PSCY                                                CLE031
     C                     MOVE PMRSCY    SCCY                                                CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE SSTAL     STAL                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CSD015
      ** Call  SRWTCH if watch list checking is apllied.                                      CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C           AMTP      ANDEQ'PI'                                                          CSD015
     C           SACTN     ANDEQ'A'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
      *                                                                                       CSD015
     C                     MOVE *OFF      *IN09                                               CSD015
     C                     MOVEL*BLANKS   KFUNT                                               CSD015
     C                     MOVEL*BLANKS   KIDEN                                               CSD015
     C                     MOVEL*BLANKS   KBRCH                                               CSD015
     C                     MOVEL*BLANKS   WKIDEN                                              CSD015
     C                     MOVEL*BLANKS   WLNRF                                               CSD015
     C                     MOVEL*BLANKS   WKVDAT                                              CSD015
     C                     MOVEL*BLANKS   WLASN                                               CSD015
      *                                                                                       CSD015
     C                     MOVEL'LOAMSDK' KFUNT                                               CSD015
     C                     MOVE LNRF      WLNRF   6                                           CSD015
     C                     MOVE VDAT      WKVDAT  5                                           CSD015
     C                     MOVE LASN      WLASN   3                                           CSD015
     C           WLNRF     CAT  WKVDAT:0  WKIDEN 40                                           CSD015
     C                     CAT  WLASN:0   WKIDEN                                              CSD015
     C                     MOVELWKIDEN    KIDEN                                               CSD015
     C                     MOVELBRCA      KBRCH                                               CSD015
     C           KCWHT     CHAINSDCWHTL1             09                                       CSD015
      *                                                                                       CSD015
     C           *IN09     IFEQ *OFF                                                          CSD015
     C           W3UNCF    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     MOVELRONS      WLF,1                                               CSD015
     C                     MOVELRIBN      WLF,2                                               CSD015
     C                     MOVELROBN      WLF,3                                               CSD015
     C                     MOVELROCN      WLF,4                                               CSD015
     C                     MOVELPONS      WLF,5                                               CSD015
     C                     MOVELPIBN      WLF,6                                               CSD015
     C                     MOVELPOBN      WLF,7                                               CSD015
     C                     MOVELPOCN      WLF,8                                               CSD015
     C                     MOVELRCRN      WLF,9                                               CSD015
     C                     MOVELRVNO      WLF,10                                              CSD015
     C                     MOVELAWBN      WLF,11                                              CSD015
     C                     MOVELBENN      WLF,12                                              CSD015
     C                     EXSR SRWTCH                                                        CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           WDIFF     IFEQ 'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
      *                                                                                       232348
      ** Only process EIR cost accounting if loan's value date is same                        232348
      ** as or after the non-linear amortisation cut-off date                                 232348
     C           VDAT      ANDGEFSNLAC                                                        232348
      *                                                                                       CAS009
     C                     MOVE *BLANK    WADJP                                               CAS009
     C                     MOVE *BLANK    WDELR                                               CAS009
      *                                                                                       CAS009
      ** Need to recalculate the EIR of a loan on amendment.                                  CAS009
      *                                                                                       CAS009
     C           SATYP     IFEQ 'PF'                                                          CAS009
     C           SATYP     OREQ 'PT'                                                          CAS009
     C           SATYP     OREQ 'PI'                                                          CAS009
     C           SATYP     OREQ 'SA'                                                          CAS009
     C**********           Z-ADDLNRF      WTRAN                                        CAS009 CLE148
     C                     MOVELLNRF      WTRAN                                               CLE148
     C                     Z-ADDVDAT      WVALD                                               CAS009
     C                     EXSR SEIRI1                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           SATYP     IFEQ 'SC'                                                          CAS009
     C           SATYP     OREQ 'BC'                                                          CAS009
     C           SACTN     IFEQ 'R'                                                           CAS009
     C                     MOVE 'Y'       WDELR                                               CAS009
     C                     ENDIF                                                              CAS009
     C**********           Z-ADDLNRF      WTRAN                                        CAS009 CLE148
     C                     MOVELLNRF      WTRAN                                               CLE148
     C                     Z-ADDVDAT      WVALD                                               CAS009
     C                     MOVE 'Y'       WADJP                                               CAS009
     C                     EXSR SEIRI1                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *
      ** Update record of LOAMS
      *
     C                     UPDATLOAMSDKF               79
     C                     Z-ADDLASN      W#LASN                          144096
     C                     Z-ADDVDAT      W#VDAT  50                                          227712
      *
      ** Retrieve parameter fields for Shadow update
      *
      *                                                                   175450
      ** Update on shadow files should only be done if not a Risk loan    175450
      *                                                                   175450
     C           PTYP      IFNE 70                                        175450
     C           PTYP      ANDNE71                                        175450
     C           PTYP      ANDNE72                                        175450
     C           SATYP     IFNE 'PT'
     C           SATYP     ANDNE'PF'
     C                     EXSR SRSHAD
     C                     MOVE Z#ADTA    Z#ADT1
     C                     MOVE Z#ADTB    Z#ADT2
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           CLE031    OREQ 'Y'                                                           CLE031
     C                     MOVE Z#ADTE    Z#ADT5                          CEU004
     C                     ENDIF                                          CEU004
     C                     ENDIF
     C                     ENDIF                                          175450
      *
      ** Write a new record in file LE2040PD if mode is 'R'
      *
     C           PMODE     IFEQ 'R'
      *
     C                     Z-ADDRUND      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     WDATE
     C                     MOVELWDD       WFLD3A  3
     C                     MOVE '/'       WFLD3A
     C                     MOVELWMM       WFLD3B  3
     C                     MOVE '/'       WFLD3B
     C                     MOVELWFLD3A    WFLD6A  6
     C                     MOVE WFLD3B    WFLD6A
     C                     MOVELWFLD6A    WDTST   8
     C                     MOVE WYY       WDTST
     C                     MOVELWDTST     DTST
      *
     C                     TIME           WTIME   60
     C                     MOVELWTIME     WTIMEA  6
     C                     MOVELWHH       WFLD3A  3
     C                     MOVE ':'       WFLD3A
     C                     MOVELWNN       WFLD3B  3
     C                     MOVE ':'       WFLD3B
     C                     MOVELWFLD3A    WFLD6A  6
     C                     MOVE WFLD3B    WFLD6A
     C                     MOVELWFLD6A    WTMST   8
     C                     MOVE WSS       WTMST
     C                     MOVELWTMST     TMST
      *
     C           SACTN     IFEQ 'A'
     C           SACTN     OREQ 'X'
     C           SACTN     OREQ 'R'
     C                     MOVE SACTN     ACTN
     C                     MOVE *BLANK    MSVR
     C                     MOVE *BLANK    MSID
     C                     MOVE *BLANK    MSTX
     C                     ENDIF
      *
      ** Save test harness record for later update after COMIT
      *
     C                     MOVE L2040F    L2040S
     C                     ENDIF
      *
      ** Update Loan Amend. Trailer file, LTRIX, Loans file,
      ** Facility and Shadow Files
      *
     C           *IN79     IFEQ '0'
     C                     EXSR SRTRAL
     C                     EXSR SRLTRX
     C           SATYP     IFNE 'PT'
     C           SATYP     ANDNE'PF'
     C                     EXSR SRCLON
     C                     EXSR SRFCLT
      *                                                                   CLE009
      ** If CLE009 is installed, update fees file                         CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     EXSR SRFEES                                    CLE009
     C                     ENDIF                                          CLE009
      *
      ** Update on shadow files should only be done if not a Risk loan    175450
      *                                                                   175450
     C           PTYP      IFNE 70                                        175450
     C           PTYP      ANDNE71                                        175450
     C           PTYP      ANDNE72                                        175450
     C                     EXSR SRUSHD
     C                     ENDIF
     C                     ENDIF                                          175450
     C                     ENDIF
      *                                                                                       CLE034
      ** After LOAMSDK has been updated, if the action is delete need                         CLE034
      ** to update the settlement allocation table to reverse the                             CLE034
      ** the settlement allocation for this transaction.                                      CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           STAL      ANDEQ'Y'                                                           CLE034
     C           SACTN     ANDEQ'R'                                                           CLE034
     C********** LASN      IFNE *ZEROS                                                 CLE034 227712
     C           W#LASN    IFNE *ZEROS                                                        227712
     C                     MOVELSTAMP,1   PTMST                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     MOVELW#LASN    W#LAS2  3                                           227712
     C                     MOVELW#VDAT    W#VDT2  5                                           227712
      *                                                                                       CLE034
     C                     CALL 'AOSTALU0'                                                    CLE034
     C                     PARM PMODE     PRTCD                                               CLE034
     C                     PARM 'LAPI  '  PTYPE                                               CLE034
     C                     PARM 'D'       PACTN                                               CLE034
     C**********           PARM           LNRF                                         CLE034 227712
     C**********           PARM           VDAT                                         CLE034 227712
     C                     PARM           W#VDT2                                              227712
     C                     PARM           W#LAS2                                              227712
     C                     PARM           LASN                                                CLE034
     C                     PARM *BLANKS   PCNUM                                               CLE034
     C                     PARM *BLANKS   PFACL                                               CLE034
     C                     PARM *BLANKS   PFESQ                                               CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM           PCRFK                                               CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C/COPY WNCPYSRC,LE2040C022
      *                                                                   CSC011
      * If Support System active, write transaction to 24x7 log           CSC011
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C*                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
      *                                                                   CSC011
      * Convert Loan Amendment to PINPP format                            CSC011
     C                     EXSR LOG247                                    CSC011
      *                                                                   CSC011
      * Write valid Loan Amendment in PINPP format to 24x7 Log File       CSC011
     C                     MOVE 'V'       LOGVAL  1                       CSC011
     C                     EXSR APLGTR                                    CSC011
     C                     COMIT                                          CSC011
      *                                                                   CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
      *
      ** COMMIT if no errors
      *
     C           *IN79     IFEQ '0'
      *                                                                   CDE001
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           CDE001    IFEQ 'Y'                                       CDE001
     C                     MOVELSLOAN     T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C                     PARM           T#TREF 20                       CDE001
     C                     PARM 'LOAN'    T#TCAT  4                       CDE001
     C                     PARM *BLANKS   RSRVID 10                       CDE005
     C                     ENDIF                                          CDE001
      *
     C           PMODE     IFNE 'B'
     C***********PMODE     ANDNE'P'                                       120002
     C                     COMIT
     C                     ENDIF
      *
      ** Write a new record to test harness file
      *
     C           PMODE     IFEQ 'R'
     C                     MOVE L2040S    L2040F
     C                     MOVE *BLANK    AMTP
     C                     WRITELE2040D0               79
     C                     ENDIF
      *
     C                     MOVE 'F0'      WFMT
     C                     ENDIF
     C/COPY WNCPYSRC,LE2040C007
      *
     C           EXUPD     ENDSR
     C/COPY WNCPYSRC,LEH00583
      *****************************************************************                       CSD015
      *  SRWTCH  -  Performs the Watch list processing.               *                       CSD015
      *  Called by: SRWRIT, SRUPDT                                    *                       CSD015
      *  Calls    : SRCWP2                                            *                       CSD015
      *****************************************************************                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** PARAMETER 2:                                                                         CSD015
     C                     MOVE *BLANKS   PARMDS                                              CSD015
     C                     Z-ADD0         WID     20                                          CSD015
      *                                                                                       CSD015
     C           WID       DOUEQ12                                                            CSD015
     C                     ADD  1         WID                                                 CSD015
     C                     MOVELWLF,WID   PINP1                                               CSD015
      *                                                                                       CSD015
     C           WLF,WID   IFNE *BLANKS                                                       CSD015
     C           WLF,WID   ANDNE'000000'                                                      CSD015
      *                                                                                       CSD015
     C           SCCY      IFNE *BLANKS                                                       CSD015
     C                     MOVELSCCY      PCCY                                                CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELCCY       PCCY                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     CALL 'SDCWLFMT'                                                    CSD015
     C                     PARM           PRTCD   7                                           CSD015
     C                     PARM           PINP1  35                                           CSD015
     C                     PARM *BLANKS   PINP2  35                                           CSD015
     C                     PARM *BLANKS   PINP3  35                                           CSD015
     C                     PARM *BLANKS   PINP4  35                                           CSD015
     C                     PARM *BLANKS   PINP5  35                                           CSD015
     C                     PARM *BLANKS   PINP6  35                                           CSD015
     C                     PARM           PCCY    3                                           CSD015
     C                     PARM           POUT  216                                           CSD015
     C                     PARM           PCNUM   6                                           CSD015
      *                                                                                       CSD015
     C           POUT      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCWP2                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
      ** Add the Payment Details.                                                             CSD015
      *                                                                                       CSD015
     C           DTP1      IFNE *BLANKS                                                       CSD015
     C           DTP2      ORNE *BLANKS                                                       CSD015
     C           DTP3      ORNE *BLANKS                                                       CSD015
     C           DTP4      ORNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           WDTPC     IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     CAT  CWA,25:0  PARMDS                                              CSD015
     C                     CAT  DTP1:0    PARMDS                                              CSD015
     C                     CAT  DTP2:1    PARMDS                                              CSD015
     C                     CAT  DTP3:1    PARMDS                                              CSD015
     C                     CAT  DTP4:1    PARMDS                                              CSD015
     C                     CAT  CWA,26:0  PARMDS                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      **  Set up parameter 1 and send details to engine only if                               CSD015
      **  PARMDS is not empty.                                                                CSD015
      *                                                                                       CSD015
     C           PARMDS    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
      ** PARAMETER 1:                                                                         CSD015
      ** Item Type Code                                                                       CSD015
     C                     MOVEL'LEAMD'   W4ITEM                                              CSD015
      *                                                                                       CSD015
      ** Identifier                                                                           CSD015
     C                     MOVEL*BLANKS   WLNRF                                               CSD015
     C                     MOVEL*BLANKS   WKVDAT                                              CSD015
     C                     MOVEL*BLANKS   WLASN                                               CSD015
     C                     MOVEL*BLANKS   W4IDEN                                              CSD015
      *                                                                                       CSD015
     C                     MOVE LNRF      WLNRF                                               CSD015
     C                     MOVE VDAT      WKVDAT                                              CSD015
     C                     MOVE LASN      WLASN                                               CSD015
     C           WLNRF     CAT  WKVDAT:0  W4IDEN                                              CSD015
     C                     CAT  WLASN:0   W4IDEN                                              CSD015
      *                                                                                       CSD015
      ** Branch                                                                               CSD015
     C                     MOVELBRCA      W4BRCH                                              CSD015
      *                                                                                       CSD015
      ** System                                                                               CSD015
      ** If Midas 24x7 is installed, use Main system prefix otherwise use system prefix       CSD015
     C           CSC011    IFEQ 'Y'                                                           CSD015
     C                     MOVE S1MAIN    W4SYSM                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE LIBR      W4SYSM                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Function Type                                                                        CSD015
     C                     MOVEL'LOAMSDK' W4FUNT                                              CSD015
      *                                                                                       CSD015
      ** Counter Party Details                                                                CSD015
     C                     MOVE PCNUM     WCNUM   6                                           CSD015
     C                     CALL 'AOCUSTR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*KEY   ' POPTN                                               CSD015
     C                     PARM WCNUM     PCUST                                               CSD015
     C                     PARM           PKYST                                               CSD015
     C           SDCUST    PARM SDCUST    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C           BBCRNM    CAT  BBCRTN    W4CUST                                              CSD015
     C                     MOVE PCNUM     W4CNUM                                              CSD015
      *                                                                                       CSD015
     C           CCF001    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           BBCRPC    IFEQ 'Y'                                                           CSD015
     C                     MOVE 'C'       W4CTYP                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           BBLICD    IFNE *BLANK                                                        CSD015
     C           BBLICD    ANDNEW1IND1                                                        CSD015
     C           BBLICD    ANDNEW1IND2                                                        CSD015
     C           BBLICD    ANDNEW1IND3                                                        CSD015
     C           BBLICD    ANDNEW1IND4                                                        CSD015
     C           BBLICD    ANDNEW1IND5                                                        CSD015
     C                     MOVE 'C'       W4CTYP                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Deal Date                                                                            CSD015
     C                     MOVE *ZERO     W4DDAT                                              CSD015
      *                                                                                       CSD015
      ** Value Date                                                                           CSD015
     C                     MOVE VDAT      W4VDAT                                              CSD015
      *                                                                                       CSD015
      ** Maturity Date                                                                        CSD015
     C                     MOVE *ZERO     W4MDAT                                              CSD015
      *                                                                                       CSD015
      ** Denomination Side                                                                    CSD015
     C                     MOVELCCY       W4DEN1                                              CSD015
     C                     MOVEL*BLANKS   W4DEN2                                              CSD015
      *                                                                                       CSD015
      ** Amount Side                                                                          CSD015
     C                     MOVE TAMT      W4AMT1                                              CSD015
     C                     MOVE *ZERO     W4AMT2                                              CSD015
      *                                                                                       CSD015
      ** Send transaction details to Compliance Watch by calling SDWLCLOP                     CSD015
      *                                                                                       CSD015
     C                     CALL 'SDWLCLOP'                                                    CSD015
     C                     PARM           CWLCDS                                              CSD015
     C                     PARM           PARMDS                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      *  SRCWP2  -  Set up the 2nd parameter for Compliance Watch.    *                       CSD015
      *  Called by: SRUPDT                                            *                       CSD015
      *  Calls    : None                                              *                       CSD015
      *****************************************************************                       CSD015
     C           SRCWP2    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C           WID       MULT 2         CLS     20                                          CSD015
     C           CLS       SUB  1         OPN     20                                          CSD015
      *                                                                                       CSD015
     C                     MOVELCWA,OPN   WOPN   25                                           CSD015
     C                     MOVELCWA,CLS   WCLS   25                                           CSD015
      *                                                                                       CSD015
     C           PARMDS    CAT  WOPN:0    PARMDS                                              CSD015
     C                     CAT  POUT:0    PARMDS                                              CSD015
      *                                                                                       CSD015
     C                     SELEC                                                              CSD015
     C           WID       WHEQ 2                                                             CSD015
     C                     CAT  RIBA:0    PARMDS                                              CSD015
     C           WID       WHEQ 6                                                             CSD015
     C                     CAT  PIBA:0    PARMDS                                              CSD015
     C           WID       WHEQ 9                                                             CSD015
     C                     CAT  RCRA:0    PARMDS                                              CSD015
     C           WID       WHEQ 11                                                            CSD015
     C                     CAT  AWBA:0    PARMDS                                              CSD015
     C           WID       WHEQ 12                                                            CSD015
     C                     CAT  BENA:0    PARMDS                                              CSD015
     C                     ENDSL                                                              CSD015
      *                                                                                       CSD015
     C                     CAT  WCLS:0    PARMDS                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************   CLE009
      * SRFEES  -  Update Fees File                                   *   CLE009
      * Called by: SRWRIT - Write a new record in file                *   CLE009
      *            SRUPDT - Update records                            *   CLE009
      * Calls    : None                                               *   CLE009
      *****************************************************************   CLE009
     C           SRFEES    BEGSR                                          CLE009
      *                                                                   CLE009
      ** If authorisation switchable feature is on and action code        CLE009
      ** is insert or amend and Loans amendment authorisations is         CLE009
      ** required                                                         CLE009
      *                                                                   CLE009
     C           CLE002    IFEQ 'Y'                                       CLE009
     C           SACTN     ANDNE'X'                                       CLE009
     C           SACTN     ANDNE'R'                                       CLE009
     C           BPLMAU    ANDEQ'Y'                                       CLE009
      *                                                                   CLE009
      ** If action code is insert                                         CLE009
      *                                                                   CLE009
     C           SACTN     IFEQ 'I'                                       CLE009
      *                                                                   CLE009
      ** Write a record to Loan Amendment Fee Index File                  CLE009
      *                                                                   CLE009
     C                     MOVE SLOAN     FFLNRF                          CLE009
     C                     Z-ADDVDAYNO    FFVDAT                          CLE009
     C                     MOVE WLSN      FFLASN                          CLE009
     C                     MOVE *BLANKS   FFAUTH                          CLE009
     C                     MOVE WKSWRI    FFSWRI                          CLE009
     C                     WRITELEFELAD0                                  CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** If action code is amend                                          CLE009
      *                                                                   CLE009
     C           SACTN     IFEQ 'A'                                       CLE009
      *                                                                   CLE009
      ** Chain to Loan Amendment Fee Index File                           CLE009
      *                                                                   CLE009
     C                     MOVE SLOAN     WKLOAN                          CLE009
     C                     Z-ADDVDAYNO    WKDAY                           CLE009
     C                     MOVE SSEQN     WKSEQN                          CLE009
     C           KIDXF     CHAINLEFELAL0             88                   CLE009
      *                                                                   CLE009
      ** If record not found                                              CLE009
      *                                                                   CLE009
     C           *IN88     IFEQ *ON                                       CLE009
      *                                                                   CLE009
      ** Write a record to Loan Fee Index File                            CLE009
      *                                                                   CLE009
     C                     MOVE SLOAN     FFLNRF                          CLE009
     C                     Z-ADDVDAYNO    FFVDAT                          CLE009
     C                     MOVE SSEQN     FFLASN                          CLE009
     C                     MOVE 'Y'       FFAUTH                          CLE009
     C                     MOVE WKSWRI    FFSWRI                          CLE009
     C                     WRITELEFELAD0                                  CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** If work regeneration indicator is changed and regeneration       CLE009
      ** indicator is blank                                               CLE009
      *                                                                   CLE009
     C           WKSWRI    IFEQ 'C'                                       CLE009
     C           FFSWRI    ANDEQ*BLANKS                                   CLE009
      *                                                                   CLE009
      ** Update the record to Loan Amendment Fee Index File               CLE009
      *                                                                   CLE009
     C                     MOVE WKSWRI    FFSWRI                          CLE009
     C                     UPDATLEFELAD0                                  CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** If action code is authorise                                      CLE009
      *                                                                   CLE009
     C           SACTN     IFEQ 'X'                                       CLE009
      *                                                                   CLE009
      ** Chain to Loan Amendment Fee Index File                           CLE009
      *                                                                   CLE009
     C                     MOVE SLOAN     WKLOAN                          CLE009
     C                     Z-ADDVDAYNO    WKDAY                           CLE009
     C                     MOVE SSEQN     WKSEQN                          CLE009
     C           KIDXF     CHAINLEFELAL0             88                   CLE009
      *                                                                   CLE009
      ** If record is found                                               CLE009
      *                                                                   CLE009
     C           *IN88     IFEQ *OFF                                      CLE009
      *                                                                   CLE009
      ** Update the record to Loan Amendment Fee Index File               CLE009
      *                                                                   CLE009
     C                     MOVE FFSWRI    WKSWRI                          CLE009
     C                     MOVE 'Y'       FFAUTH                          CLE009
     C                     UPDATLEFELAD0                                  CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** If action code is reverse                                        CLE009
      *                                                                   CLE009
     C           SACTN     IFEQ 'R'                                       CLE009
      *                                                                   CLE009
      ** Chain to Loan Amendment Fee Index File                           CLE009
      *                                                                   CLE009
     C                     MOVE SLOAN     WKLOAN                          CLE009
     C                     Z-ADDVDAYNO    WKDAY                           CLE009
     C                     MOVE SSEQN     WKSEQN                          CLE009
     C           KIDXF     CHAINLEFELAL0             88                   CLE009
      *                                                                   CLE009
      ** If record is found                                               CLE009
      *                                                                   CLE009
     C           *IN88     IFEQ *OFF                                      CLE009
      *                                                                   CLE009
      ** If authorised is blank                                           CLE009
      *                                                                   CLE009
     C           FFAUTH    IFEQ *BLANKS                                   CLE009
     C                     MOVE *BLANKS   WKSWRI                          CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** If work regeneration indicator is blank                          CLE009
      *                                                                   CLE009
     C           WKSWRI    IFEQ *BLANKS                                   CLE009
     C                     MOVE FFSWRI    WKSWRI                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** If work regeneration indicator is changed                        CLE009
      *                                                                   CLE009
     C           WKSWRI    IFEQ 'C'                                       CLE009
      *                                                                   CLE009
      ** Check if the facility has an associated fee                      CLE009
      *                                                                   CLE009
     C                     MOVE WFACT     CHFACT  3                       CLE009
     C                     MOVE WFNUM     CHFCNO  2                       CLE009
     C           CHFACT    CAT  CHFCNO    CHFACL  5                       CLE009
     C                     MOVE CHFACL    WFFACL                          CLE009
     C**********           Z-ADD0         WFLOAN                                       CLE009 CLE148
     C                     MOVEL*BLANKS   WFLOAN                                              CLE148
     C           WKFEE     SETLLLEFEEDL1                                  CLE009
     C           WKFEE     READELEFEEDL1                 89               CLE009
      *                                                                   CLE009
      ** Do while an associated fee exists                                CLE009
      *                                                                   CLE009
     C           *IN89     DOWEQ*OFF                                      CLE009
      *                                                                   CLE009
      ** If the fee is a confirmed calculated fee and swift               CLE009
      ** regeneration indicator is not 'I', 'B', 'H'                      CLE009
      *                                                                   CLE009
     C                     MOVE FEAUTO    WWAUTO  1                                           CLE134
     C           WWAUTO    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C                     MOVE 'Y'       WWAUTO  1                                           CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C********** FEAUTO    IFEQ 'Y'                                                    CLE009 CLE134
     C           WWAUTO    IFEQ 'Y'                                                           CLE134
     C           FECALT    ANDNE*BLANKS                                   CLE009
     C           FESWRI    ANDNE'I'                                       CLE009
     C           FESWRI    ANDNE'B'                                       CLE009
     C           FESWRI    ANDNE'H'                                       CLE009
      *                                                                   CLE009
      ** Set currency to fee currency                                     CLE009
      ** Set day to run date                                              CLE009
      ** Set number of working days to telex notice days                  CLE009
      *                                                                   CLE009
     C                     MOVE FEFCCY    ZCCY                            CLE009
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
      ** Set-up Start/Maturity indicator.                                                     CLE034
      *                                                                                       CLE034
     C           PTFI      IFNE *BLANK                                                        CLE034
     C                     MOVEL'E'       WSTMT   1                                           CLE034
     C                     ELSE                                                               CLE034
     C                     MOVEL'S'       WSTMT                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALR1'                                                    CLE034
     C                     PARM           PRTCD                                               CLE034
     C                     PARM '*TXDT  ' POPTN                                               CLE034
     C                     PARM           BJRDNB                                              CLE034
     C                     PARM           PPTYP   20                                          CLE034
     C                     PARM           WSTMT                                               CLE034
     C                     PARM           FEFCCY                                              CLE034
     C                     PARM 'N'       PNCHK   1                                           CLE034
     C                     PARM 'FEES'    PTYPE                                               CLE034
     C                     PARM           FELOAN                                              CLE034
     C                     PARM *BLANKS   PVDAT   5                                           CLE034
     C                     PARM *BLANKS   PLASN   3                                           CLE034
     C                     PARM           FECNUM                                              CLE034
     C                     PARM           FEFACL                                              CLE034
     C                     PARM           FEFSEQ                                              CLE034
     C                     PARM *ZEROS    PTNDT   50                                          CLE034
     C                     PARM *BLANK    PNOST   1                                           CLE034
      *                                                                                       CLE034
     C                     Z-ADDPTNDT     TXDT                                                CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     Z-ADDBJRDNB    ZDAYNO                          CLE009
     C                     Z-ADD1         X                               CLE009
      *                                                                                       CLE031
      ** If feature CLE031 is on use correct currency to access AONOSTR0                      CLE031
      *                                                                                       CLE031
     C                     MOVE FEFCCY    WKCCY   3                                           CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
      *                                                                                       CLE031
     C           PTFI      IFEQ 'P'                                                           CLE031
     C           FEPSCY    IFNE *BLANKS                                                       CLE031
     C                     MOVE FEPSCY    WKCCY                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ELSE                                                               CLE031
     C           FEPSCY    IFNE *BLANKS                                                       CLE031
     C                     MOVE FESCCY    WKCCY                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVE WKCCY     ZCCY                                                CLE031
     C                     MOVE WKCCY     PCURR                                               CLE031
      *                                                                                       CLE031
     C********** FEFCCY    LOKUPCYA,X                    69                            CLE009 CLE031
     C           WKCCY     LOKUPCYA,X                    69                                   CLE031
     C                     MOVE *OFF      *IN69                           CLE009
     C                     MOVE TND,X     ZNRDYS                          CLE009
      *                                                                   CLE009
      ** If Fee Settlement type is '01', '02', '07', '08' or '12'         CLE009
      *                                                                   CLE009
     C           FESTTL    IFEQ 01                                        CLE009
     C           FESTTL    OREQ 02                                        CLE009
     C           FESTTL    OREQ 07                                        CLE009
     C           FESTTL    OREQ 08                                        CLE009
     C           FESTTL    OREQ 12                                        CLE009
      *                                                                   CLE009
     C                     CALL 'AONOSTR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*KEY   ' POPTN                           CLE009
     C                     PARM           PCUSN   6                       CLE009
     C                     PARM FEFCCY    PCURR                           CLE009
     C**********           PARM           PACCD   4                                    CLE009 CAS011
     C                     PARM           PACCD  10                                           CAS011
     C                     PARM           PACSN   2                       CLE009
     C                     PARM FEOURS    PNONB   2                       CLE009
     C                     PARM           PBRCA                           CLE009
     C                     PARM           PCSSN  10                       CLE009
     C                     PARM           PPNOI   1                       CLE009
     C           SDNOST    PARM SDNOST    DSFDY                           CLE009
      *                                                                   CLE009
     C           PRTCD     IFNE *BLANKS                                   CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVEL'AONOSTR0'DBFILE           ************   CLE009
     C                     Z-ADD52        DBASE            * DBERR 52 *   CLE009
     C                     MOVELFEFCCY    DBKEY            ************   CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** Set Location to Nostro Location                                  CLE009
      *                                                                   CLE009
     C                     MOVE A7NOSN    ZLOC                            CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
     C                     MOVE *BLANKS   ZLOC                            CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** Calculate number of working days forward                         CLE009
      *                                                                   CLE009
     C                     EXSR ZFWDT                                     CLE009
      *                                                                   CLE009
      ** Set Telex Notice date to day number                              CLE009
      *                                                                   CLE009
     C                     Z-ADDZDYNBR    TXDT    50                      CLE009
      *                                                                   CLE009
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** If next payment date is before or equals to Telex Notice date    CLE009
      ** and Next Payment Telex indicator is set to 'Y'                   CLE009
      *                                                                   CLE009
     C           FENPYD    IFLE TXDT                                      CLE009
     C           FEPPTI    ANDEQ'Y'                                       CLE009
      *                                                                   CLE009
      ** Update Fees file                                                 CLE009
      *                                                                   CLE009
     C                     MOVE 'A'       FESWRI                          CLE009
     C                     UPDATLEFEEDF                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** If end date is before or equals to Telex Notice date and End     CLE009
      ** Telex indicator is set to 'Y'                                    CLE009
      *                                                                   CLE009
     C           FEPEND    IFLE TXDT                                      CLE009
     C           FEEPTI    ANDEQ'Y'                                       CLE009
      *                                                                   CLE009
      ** Update Fees file                                                 CLE009
      *                                                                   CLE009
     C                     MOVE 'A'       FESWRI                          CLE009
     C                     UPDATLEFEEDF                                   CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C           WKFEE     READELEFEEDL1                 89               CLE009
     C                     ENDDO                                          CLE009
     C/COPY WNCPYSRC,LEH00741
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     MOVE *BLANKS   WKSWRI                          CLE009
      *                                                                   CLE009
     C                     ENDSR                                          CLE009
      /EJECT
      *****************************************************************
      * SRSUBF  -  Subfile Processing                                 *
      * Called by: Main routine                                       *
      * Calls    : SRSINS - Initialise all Screen Fields              *
      *            SRSCLR - Subfile Clear                             *
      *            SRREVW - Set Loan no. from Review from             *
      *            SRLOAD - Load Subfile Records                      *
      *            SRSVAL - Subfile Validation                        *
      *            SRSREV - Select Records from Review Fields         *
      *            CLEAR  - Clears message from the pgm message queue *
      *****************************************************************
     C           SRSUBF    BEGSR
      *
      ** Restore the Authorised selection after F9 pressed
      *
     C           WWRTRN    IFEQ 'S0'
     C                     MOVE WRAUT     SRAUT
     C                     ENDIF
     C                     MOVE SCRREV    SAVREV  7
      *
      ** Initialise subfile fields
      *
     C                     EXSR SRSINS
     C                     EXSR SRSCLR
      *
      ** Set Review from Loan no.
      *
     C                     EXSR SRREVW
      *
      ** Load subfile
      *
     C                     EXSR SRLOAD
      *
     C           WFMT      DOWEQ'S0'
     C                     WRITELE2040F2
     C                     WRITELE2040C1
     C                     EXFMTLE2040C0
      *
     C                     EXSR CLEAR
      *
     C                     SELEC
     C           *INKC     WHEQ '1'
     C                     MOVE *BLANK    WFMT
      *
     C           *INKL     WHEQ '1'
     C                     MOVE 'F0'      WFMT
     C                     MOVE 'F0'      WWRTRN
     C                     MOVE '0'       *IN25
      * As user pressed F12, clear subfile fields:                                            214893
     C                     EXSR SRSINS                                                        214893
      *
      ** F9 pressed for Insert
      *
     C           *INKI     WHEQ '1'
     C                     MOVE 'S0'      WWRTRN
     C                     MOVE 'F0'      WFMT
     C                     MOVE '1'       *IN25
     C                     MOVE SRAUT     WRAUT   1
      *
     C           *INKE     WHEQ '1'
     C                     EXSR SRSINS
     C                     EXSR SRSCLR
      *
      ** Set Review from Loan no.
      *
     C                     EXSR SRREVW
     C                     EXSR SRLOAD
      *
     C                     MOVE SCRREV    SAVREV
      *
     C           *IN21     WHEQ '1'
     C                     EXSR SRSINS
     C                     EXSR SRLOAD
      *
     C                     OTHER
      *
      ** Priority on Review from fields: if this is entered, process
      ** this request
      *
     C           SCRREV    IFNE SAVREV
     C                     EXSR SRSREV
     C                     ELSE
     C                     EXSR SRSVAL
     C                     ENDIF
      *
     C                     ENDSL
      *                                                                   CAP061
      ** If in fix mode and 'D'elete option taken, set up selection       CAP061
      ** If in fix mode and Q for delete option taken then set up         CAP061
      ** selection for delete subroutine.                                 CAP061
      *                                                                   CAP061
     C           PMODE     IFEQ 'F'                                       CAP061
     C           SLSEL     ANDEQ'Q'                                       CAP061
     C                     MOVE 'DL'      WFMT      P                     CAP061
     C                     ENDIF                                          CAP061
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRLOAD  -  Load subfile records                               *
      * Called by: SRSUBF - Subfile processing                        *
      * Calls    : SRSFMT - Format Subfile Fields                     *
      *****************************************************************
     C           SRLOAD    BEGSR
      *
     C           *IN80     IFEQ '1'
     C                     MOVEL'LEA1030' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       *IN12
     C                     ELSE
      *
     C                     MOVE '0'       *IN12
     C                     Z-ADD1         WCTR    20
     C                     Z-ADDSRRN      SRECN
      *
     C           *IN80     DOWEQ'0'
     C           WCTR      ANDLE10
     C                     MOVE 'A'       WRCDT                                               207629
     C                     MOVE FLNRF     WKLNR                                               207629
     C           KLKEY     CHAINCLOAN               N79                                       207629
      *                                                                   CLE005
     C           PTYP      IFNE 68                                        CLE005
     C           PTYP      ANDNE69                                        CLE005
     C           PTYP      ANDNE71                                        CLE005
     C           PTYP      ANDNE72                                        CLE005
     C           CLE005    ANDEQ'N'                                       CLE005
     C           CLE005    OREQ 'Y'                                       CLE005
      *
      ** Format Subfile fields and write into subfile if
      ***Amendment*type*is*either*PI,*SC*BC,*SA*or*LS******************   180044
      ** Amendment type is either PI, SC, BC, SA, LS or PD                180044
      *
     C           FAMTP     IFEQ 'PI'
     C           FAMTP     OREQ 'SC'
     C           FAMTP     OREQ 'BC'
     C           FAMTP     OREQ 'SA'
     C           FAMTP     OREQ 'LS'
      *                                                                   CAP061
      ** Include types 'PF' and 'PT' if in Fix/Repair mode.               CAP061
      *                                                                   CAP061
     C           FAMTP     OREQ 'PF'                                      CAP061
     C           PMODE     ANDEQ'F'                                       CAP061
     C           FAMTP     OREQ 'PT'                                      CAP061
     C           PMODE     ANDEQ'F'                                       CAP061
     C           FAMTP     OREQ 'PD'                                      180044
     C********** TAMT      ANDGT0                                                      180044 208436
     C           FTAMT     ANDGT0                                                             208436
      *
      ** User must have access to the branch of the loan on display
      *
     C                     Z-ADD*ZERO     @ERR
     C           BGMBIN    IFEQ 'Y'
     C           PMODE     IFEQ 'B'
     C           W#JOB     ANDEQ'LEC2010'
     C                     CALL 'ZBBBU'
     C                     PARM FBRCA     @ZBR
     C                     PARM           @USER
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVBBU'
     C                     PARM FBRCA     @ZBR
     C                     PARM           @ERR
     C                     ENDIF
     C                     ENDIF
      *
     C           @ERR      IFEQ *ZERO
     C                     EXSR SRSFMT
      *
     C                     WRITELE2040S0
     C                     ADD  1         SRRN
     C                     ADD  1         WCTR
      *
     C                     ENDIF
     C                     ENDIF
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *
     C           PMODE     IFEQ 'F'                                       CAP061
     C                     READ LEILAMP1                 80               CAP061
     C                     ELSE                                           CAP061
     C           SRAUT     IFEQ 'Y'
     C                     READ LELOAML1                 80
     C                     ELSE
     C**********           READ LELOAML0                 80               180044
     C                     READ LELOAML8                 80               180044
     C                     ENDIF
     C                     ENDIF                                          CAP061
      *
      ** User must have access to the branch of the loan on display
      *
     C           *IN80     IFEQ '0'
     C           BGMBIN    ANDEQ'Y'
     C           PMODE     IFEQ 'B'
     C           W#JOB     ANDEQ'LEC2010'
     C                     CALL 'ZBBBU'
     C                     PARM FBRCA     @ZBR
     C                     PARM           @USER
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVBBU'
     C                     PARM FBRCA     @ZBR
     C                     PARM           @ERR
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDDO
     C                     ENDIF
      *
      ** Check if no records selected
      *
     C           WCTR      IFEQ 1
     C                     MOVEL'LEA1030' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       *IN12
     C                     ENDIF
      *
      ** Check if next record is valid for display, this is to
      ** condition enabling/disabling ROLLUP
      *
     C           *IN80     DOWEQ'0'
     C           FAMTP     ANDNE'PI'
     C           FAMTP     ANDNE'SC'
     C           FAMTP     ANDNE'BC'
     C           FAMTP     ANDNE'SA'
     C           FAMTP     ANDNE'LS'
     C           FAMTP     ANDNE'PD'                                      180044
     C           *IN80     OREQ '0'
     C           @ERR      ANDNE*ZERO
      *
     C           PMODE     IFEQ 'F'                                       CAP061
     C                     READ LEILAMP1                 80               CAP061
     C                     ELSE                                           CAP061
     C           SRAUT     IFEQ 'Y'
     C                     READ LELOAML1                 80
     C                     ELSE
     C**********           READ LELOAML0                 80               180044
     C                     READ LELOAML8                 80               180044
     C                     ENDIF
     C                     ENDIF                                          CAP061
      *                                                                   CLE005
     C           PTYP      IFNE 68                                        CLE005
     C           PTYP      ANDNE69                                        CLE005
     C           PTYP      ANDNE71                                        CLE005
     C           PTYP      ANDNE72                                        CLE005
     C           CLE005    ANDEQ'N'                                       CLE005
     C           CLE005    OREQ 'Y'                                       CLE005
      *
      ** User must have access to the branch of the loan on display
      *
     C           *IN80     IFEQ '0'
     C           BGMBIN    ANDEQ'Y'
     C           PMODE     IFEQ 'B'
     C           W#JOB     ANDEQ'LEC2010'
     C                     CALL 'ZBBBU'
     C                     PARM FBRCA     @ZBR
     C                     PARM           @USER
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVBBU'
     C                     PARM FBRCA     @ZBR
     C                     PARM           @ERR
     C                     ENDIF
     C                     ENDIF
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
     C                     ENDDO
      *
     C           *IN80     IFEQ '1'
      *
      ** Set on Subfile end indicator
      *
     C                     MOVE '1'       *IN19
      *
      ** Do not display 'Page key' for one-page subfile
      *
     C           SRRN      IFLE 11
     C                     MOVE '0'       *IN13
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSINS  -  Initialise Subfile fields                          *
      * Called by: SRVAL1 - Validate initial screen                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSINS    BEGSR
      *
      ** Initialise subfile
      *
     C                     MOVE *BLANKS   SLSEL
     C                     MOVE *BLANKS   SLNRF
     C                     MOVE *BLANKS   SCUST
     C                     MOVE *BLANKS   SAMTP
     C                     MOVE *BLANKS   SSQNO
     C                     MOVE *BLANKS   SVLDT
     C                     MOVE *BLANKS   SLSTA
     C                     MOVE *BLANKS   SLMTP
     C                     MOVE *BLANKS   SIUSR
     C                     MOVE *BLANKS   SAUSR
     C                     MOVE *BLANKS   SBRCA
     C                     MOVE *BLANKS   SASTS
     C                     Z-ADD0         SLDTE
     C                     MOVE '1'       *IN13
     C                     MOVE '0'       *IN19
     C                     MOVE '0'       *IN49
     C                     MOVE *BLANKS   WE232                                               214893
     C                     MOVE *BLANKS   WE1036                                              214893
     C                     Z-ADD0         SWEFFR                                              214893
     C                     Z-ADD0         SWEFIR                                              214893
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSCLR  -  Subfile Clear                                      *
      * Called by: SRVAL1 - Validate initial screen                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSCLR    BEGSR
      *
     C                     MOVE '1'       *IN11
     C                     WRITELE2040C0
     C                     MOVE '00'      *IN,11
      *
     C                     Z-ADD1         SRRN    40
      *                                                                   CAP061
      ** Set up screen fields missed by going straight to subfile         CAP061
      *                                                                   CAP061
     C           PMODE     IFEQ 'F'                                       CAP061
     C                     MOVE USER      SUSER                           CAP061
     C                     MOVE BJMRDT    SRUNA                           CAP061
     C                     MOVE WSID      SWSID                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     WRITELE2040F0
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSFMT  -  Format Subfile fields                              *
      * Called by: SRVAL1 - Validate initial screen                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSFMT    BEGSR
      *
      ** If in Fix/Repair mode, use fields from invalid file...           CAP061
      *                                                                   CAP061
     C           PMODE     IFEQ 'F'                                       CAP061
      *                                                                   CAP061
      ** Set up screen fields missed by going straight to subfile         CAP061
      *                                                                   CAP061
     C                     MOVE USER      SUSER                           CAP061
     C                     MOVE BJMRDT    SRUNA                           CAP061
     C                     MOVE WSID      SWSID                           CAP061
      *                                                                   CAP061
      ** Set up other screen fields from invalid file                     CAP061
      *                                                                   CAP061
     C                     MOVE SLNRF     FLNRF                           CAP061
     C                     MOVE SCUSTN    FCNUM                           CAP061
     C                     MOVE SCUSTN    SCUST                           CAP061
      *                                                                   CAP061
      ** Access the Customer Details file for Shortname                   CAP061
      *                                                                   CAP061
     C                     CALL 'AOCUSTR0'                                CAP061
     C                     PARM '       ' PRTCD                           CAP061
     C                     PARM '*KEY   ' POPTN                           CAP061
     C                     PARM SCUSTN    PCUST                           CAP061
     C                     PARM           PKYST                           CAP061
     C           SDCUST    PARM SDCUST    DSSDY                           CAP061
     C                     MOVE *BLANKS   SCSNM                           CAP061
     C           PRTCD     IFEQ *BLANKS                                   CAP061
     C                     MOVE BBCSSN    SCSNM                           CAP061
     C                     ELSE                                           CAP061
     C                     MOVE 'Unknown' SCSNM                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Set up other 'file' fields from screen erorr file.               CAP061
      *                                                                   CAP061
     C                     MOVE SSQNO     FLASN                           CAP061
      *                                                                   CAP061
     C                     MOVE SVDAT     ZDATE                           CAP061
     C                     EXSR ZDATE1                                    CAP061
     C                     Z-ADDZDAYNO    FVDAT                           CAP061
      *                                                                   CAP061
     C                     Z-ADDFVDAT     ZDAYNO                          CAP061
     C                     EXSR ZDATE2                                    CAP061
     C                     MOVELZADATE    SVLDT                           CAP061
     C                     MOVE FVDAT     WKVDAT                                              CSD015
      *                                                                   CAP061
     C                     MOVE FAMTP     SLMTP                           CAP061
     C                     MOVELSIUSR     FIUSR                           CAP061
     C                     MOVELSAUSR     FAUSR                           CAP061
     C                     MOVELFBRCA     SBRCA                           CAP061
     C                     MOVELFASTS     SASTS                           CAP061
      *                                                                   CAP061
      ** Set up saved field, as the data is SCRREV is overwritten         CAP061
      ** by file fields.                                                  CAP061
      *                                                                   CAP061
     C                     MOVE SCRREV    SAVREV                          CAP061
      *                                                                   CAP061
      ** ... otherwise use original processing.                           CAP061
      *                                                                   CAP061
     C                     ELSE                                           CAP061
      *                                                                   CAP061
     C                     MOVE FLNRF     SLNRF
     C           PTYPA     IFEQ 64                                                            207629
     C           PTYPA     OREQ 65                                                            207629
     C           PTYPA     OREQ 68                                                            207629
     C           PTYPA     OREQ 71                                                            207629
      *If the loan is a Participation Purchased, & System Value                               207629
      * LoanCustOriginPurch = 'O', use Original Borrower:                                     207629
     C           PPCUST    IFEQ 'O'                                                           207629
     C                     MOVE OLNO      SCUST                                               207629
     C                     ELSE                                                               207629
      * Else, use 'Purchased from' customer number.                                           207629
     C                     MOVE FCNUM     SCUST                                               207629
     C                     ENDIF                                                              207629
      *                                                                                       207629
     C                     ELSE                                                               207629
      * Else, loan is not a Part Purchased:                                                   207629
     C                     MOVE FCNUM     SCUST
     C                     ENDIF                                                              207629
      *                                                                   126274
      ** Access the Customer Details file for Shortname                   126274
      *                                                                   126274
     C                     CALL 'AOCUSTR0'                                126274
     C                     PARM '       ' PRTCD                           126274
     C                     PARM '*KEY   ' POPTN                           126274
     C                     PARM SCUST     PCUST                           126274
     C                     PARM           PKYST                           126274
     C           SDCUST    PARM SDCUST    DSSDY                           126274
     C                     MOVE *BLANKS   SCSNM                           126274
     C           PRTCD     IFEQ *BLANKS                                   126274
     C                     MOVE BBCSSN    SCSNM                           126274
     C                     ELSE                                           126274
     C                     MOVE 'Unknown' SCSNM                           126274
     C                     ENDIF                                          126274
     C                     MOVE FLASN     SSQNO
     C                     Z-ADDFVDAT     SLDTE
     C                     Z-ADDFVDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    SVLDT
     C                     MOVE FAMTP     SLMTP
     C                     MOVELFIUSR     SIUSR
     C                     MOVELFAUSR     SAUSR
     C                     MOVELFBRCA     SBRCA
     C                     MOVELFASTS     SASTS
      *                                                                   CAP061
     C                     ENDIF                                          CAP061
      *
     C                     SELEC
     C           FAMTP     WHEQ 'PI'
     C                     MOVELLATP,1    SAMTP
     C           FAMTP     WHEQ 'SC'
     C                     MOVELLATP,2    SAMTP
     C           FAMTP     WHEQ 'BC'
     C                     MOVELLATP,3    SAMTP
     C           FAMTP     WHEQ 'SA'
     C                     MOVELLATP,4    SAMTP
     C           FAMTP     WHEQ 'LS'
     C                     MOVELLATP,5    SAMTP
     C           FAMTP     WHEQ 'PD'                                      180044
     C                     MOVELLATP,6    SAMTP                           180044
     C                     ENDSL
      *
     C                     SELEC
     C           FASTS     WHEQ 'C'
     C***********          MOVELSTAT,1    SLSTA                           123998
     C                     MOVEL'LEA0060' ZAMSID                          123998
     C           FASTS     WHEQ 'R'
     C***********          MOVELSTAT,2    SLSTA                           123998
     C                     MOVEL'LEA0061' ZAMSID                          123998
     C           FASTS     WHEQ 'A'
     C***********          MOVELSTAT,3    SLSTA                           123998
     C                     MOVEL'LEA0062' ZAMSID                          123998
     C                     ENDSL
      *                                                                   123998
     C           FASTS     IFNE ' '                                       180044
     C                     EXSR SRTEXT                                    123998
     C                     MOVELZAMSTX    SLSTA                           123998
     C                     ELSE                                           180044
     C                     MOVE *BLANK    SLSTA                           180044
     C                     ENDIF                                          180044
     C                     MOVE *BLANKS   ZAMSID                          123998
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSVAL  -  Subfile Validation                                 *
      * Called by: SRVAL1 - Validate initial screen                   *
      * Calls    : SRUAUT - Check if user is authorised to the action *
      *            SRAUTH - Validate authorisation action             *
      *            SRPROC - Subfile Detail Processing                 *
      *****************************************************************
     C           SRSVAL    BEGSR
      *
     C                     Z-ADDSRRN      WSRRN   40
     C                     MOVE 'S0'      WWRTRN
     C           SACTN     IFEQ 'R'                                                           197031
     C           AMTP      ANDEQ'PI'                                                          197031
     C                     MOVE '0'       *IN15                           186706
     C                     ELSE                                                               197031
     C                     MOVE '1'       *IN15                                               197031
     C                     ENDIF                                                              197031
      *
      ** Read changed records in subfile
      *
     C                     MOVE *BLANK    WSFER   1
     C                     MOVE *BLANK    WFRST   1
      *
     C           *IN12     IFEQ '0'
     C                     READCLE2040S0                 79
     C                     ELSE
     C                     MOVE '1'       *IN79
     C                     ENDIF
      *
     C           *IN79     DOWEQ'0'
     C                     MOVE '0'       *IN20
     C                     MOVE '0'       *IN49
      *
     C           SLSEL     IFNE *BLANK
     C                     MOVE '1'       *IN20
      *                                                                   123998
      *  Retrieve text for SLSTA comparison                               123998
     C                     MOVEL'LEA0062' ZAMSID                          123998
     C                     EXSR SRTEXT                                    123998
     C                     MOVE *BLANKS   ZAMSID                          123998
      *                                                                   CAP061
      ** If in fix mode, only 'U' and 'Q' actions allowed...              CAP061
      *                                                                   CAP061
     C           PMODE     IFEQ 'F'                                       CAP061
      *                                                                   CAP061
     C           SLSEL     IFNE 'U'                                       CAP061
     C           SLSEL     ANDNE'Q'                                       CAP061
      *                                                                   CAP061
      ** Set up message ID and send message.                              CAP061
      *                                                                   CAP061
     C                     MOVE '1'       *IN49                           CAP061
     C                     MOVE 'Y'       WSFER                           CAP061
     C                     MOVEL'LEA1044' ZAMSID                          CAP061
     C                     EXSR ZASNMS                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** ... otherwise all actions are allowed.                           CAP061
      *                                                                   CAP061
     C                     ELSE                                           CAP061
      *
      ** Valid actions are E, A, R, and X (for unauthorised loan)
      *
     C           SLSEL     IFNE 'E'
     C           SLSEL     ANDNE'A'
     C           SLSEL     ANDNE'X'
     C           SLSEL     ANDNE'R'
     C           SLSEL     OREQ 'X'
     C***********SLSTA     ANDEQSTAT,3                                    123998
     C           SLSTA     ANDEQZAMSTX                                    123998
      *                                                                   CAP061
     C                     MOVE '1'       *IN49
     C                     MOVE 'Y'       WSFER
     C                     MOVEL'LEA1034' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                   CAP061
     C                     ENDIF                                          CAP061
      *                                                                   123998
     C                     MOVE *BLANKS   ZAMSTX                          123998
      *
     C           SLSEL     IFEQ 'A'
     C           SLMTP     ANDNE'PI'
      *                                                                   CAP061
      ** Only fail this validation if not in Fix/Repair mode.             CAP061
      *                                                                   CAP061
     C           PMODE     IFNE 'F'                                       CAP061
      *                                                                   CAP061
     C                     MOVE '1'       *IN49
     C                     MOVE 'Y'       WSFER
     C                     MOVEL'LEA0056' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
      *
     C           PMODE     IFEQ 'F'                                       CAP061
     C                     SELEC                                          CAP061
     C           SLSEL     WHEQ 'U'                                       CAP061
     C                     MOVE 'A'       SACTN                           CAP061
     C           SLSEL     WHEQ 'Q'                                       CAP061
     C                     MOVE 'D'       SACTN                           CAP061
     C                     ENDSL                                          CAP061
     C                     ELSE                                           CAP061
     C                     MOVELSLSEL     SACTN
     C                     ENDIF                                          CAP061
     C                     MOVELSIUSR     IUSR
     C                     MOVELSAUSR     AUSR
     C                     MOVELSBRCA     BRCA
     C                     MOVELSASTS     ASTS
      *
      ** Check user/action/branch authority
      *
     C           *IN49     IFEQ '0'
     C                     EXSR SRUAUT
     C                     ENDIF
      *
      ** If action code is 'X', execute Authorisation Processing
      *
     C           SLSEL     IFEQ 'X'
     C           *IN49     ANDEQ'0'
     C                     EXSR SRAUTH
     C                     ENDIF
      *
      ** Save rel. record no. of first record in error
      *
     C           WFRST     IFEQ *BLANK
     C           *IN49     ANDEQ'1'
     C                     Z-ADDSRRN      SRECN
     C                     MOVE 'Y'       WFRST
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     UPDATLE2040S0
     C                     READCLE2040S0                 79
     C                     ENDDO
      *
     C           WSFER     IFEQ *BLANK
      *                                                                   CAP061
      ** If in fix mode and 'Q' for delete option taken, do delete        CAP061
      ** processing, otherwise process as normal.                         CAP061
      *                                                                   CAP061
     C           PMODE     IFEQ 'F'                                       CAP061
     C           SLSEL     ANDEQ'Q'                                       CAP061
     C                     MOVE 'N'       DOTHIS  1                       CAP061
     C                     ELSE                                           CAP061
     C                     MOVE 'Y'       DOTHIS  1                       CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C           DOTHIS    IFEQ 'Y'                                       CAP061
     C                     EXSR SRPROC
     C                     ENDIF                                          CAP061
     C                     ENDIF
      *
      ** Restore next available RRN
      *
     C                     Z-ADDWSRRN     SRRN    40
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRPROC  -  Subfile Detail Processing                          *
      * Called by: SRVAL1 - Validate initial screen                   *
      * Calls    : ZASNMS                                             *
      *            SRSSET - Set-up other fields for Detail Processing *
      *            SRSREV - Select Records from Review Fields         *
      *****************************************************************
     C           SRPROC    BEGSR
      *
      ** Save review from field and select authorised field
      *
     C                     MOVE SRLON     WRLON   6
     C                     MOVE SRAUT     WRAUT   1
      *
      ** Read changed records in subfile
      *
     C           *IN12     IFEQ '0'
     C                     READCLE2040S0                 79
     C                     MOVE 'D1'      WFMT
     C                     ENDIF
      *
     C           *IN79     DOWEQ'0'
     C           WFMT      ANDNE*BLANK
     C           WFMT      ANDNE'S0'
      *
      ** Set-up other fields for Detail Processing
      *
      ** ... if not in Fix/Repair mode                                    CAP061
      *                                                                   CAP061
     C           PMODE     IFNE 'F'                                       CAP061
     C                     EXSR SRSSET
     C                     ELSE                                           CAP061
     C                     EXSR SRIN2                                     CAP061
     C                     ENDIF                                          CAP061
      *
     C           WFMT      DOUEQ'F0'
     C           WFMT      OREQ 'S0'
     C           WFMT      OREQ *BLANK
     C           WFMT      OREQ 'SP'
      *
     C           WFMT      CASEQ'D1'      SRDET1
     C           WFMT      CASEQ'D2'      SRDET2
     C           WFMT      CASEQ'WR'      SRWRIT
     C           WFMT      CASEQ'UP'      SRUPDT
     C                     ENDCS
     C                     ENDDO
      *
      ** Blank out selection field
      *
     C                     MOVE *BLANK    SLSEL
     C                     UPDATLE2040S0
      *
      ** Reset WFMT indicator and Read next change record
      *
     C           WFMT      IFNE *BLANK
     C           WFMT      ANDNE'S0'
     C                     MOVE 'D1'      WFMT
     C                     READCLE2040S0                 79
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     MOVE WRLON     SRLON
     C                     MOVE WRAUT     SRAUT
      *
      ** Reload subfile if no more changed record to read
      *
     C           *IN79     IFEQ '1'
      *
     C                     EXSR SRSREV
      *
     C           *IN35     IFEQ '0'
     C           *IN36     ANDEQ'0'
     C                     Z-ADDSRRN      WSRRN
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVE *BLANK    WWBACK  2
     C           WFMT      IFNE *BLANK
     C                     MOVE 'S0'      WFMT
     C                     ENDIF
     C                     Z-ADD1         SRECN
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSSET  -  Set-up other fields for Detail Processing          *
      * Called by: SRVAL1 - Validate initial screen                   *
      * Calls    : SRINS1 - Initialise all screen fields              *
      *****************************************************************
     C           SRSSET    BEGSR
      *
     C                     EXSR SRINS1
      *
     C                     MOVE SLSEL     SACTN
     C                     MOVE SLNRF     SLOAN
     C                     Z-ADDSLDTE     VDAYNO
     C                     MOVE SLMTP     SATYP
     C                     MOVE SSQNO     SSEQN
     C                     MOVE SLNRF     WKLNR
     C                     MOVE 'A'       WRCDT
     C                     MOVE 'SP'      WWBACK
      *
      ** Loan must exist in loans file
      *
     C           KLKEY     CHAINCLOAN               N79
      *
      ** Save some file fields from loans file
      *
     C           *IN79     IFEQ '0'
     C**********           MOVE LNRF      CLNRF   60                                          CLE148
     C                     MOVE LNRF      CLNRF   6                                           CLE148
     C                     MOVE BRCA      WLBRC   3
     C                     MOVE VDAT      VDATX   50
     C**********           MOVE CNUM      WLCNO   60                                          CSD027
     C                     MOVE CNUM      WLCNO   6                                           CSD027
     C                     MOVE CCYD      WLCUR   3
     C                     MOVE LTYPA     SLTYP
     C***********          MOVE SUTPA     SSTYP                    123018 127289
     C                     ENDIF
      *
     C                     MOVE SLOAN     WKLNR
     C                     Z-ADDSLDTE     WKVDT
     C                     MOVE SSQNO     WKLSN
      *
     C           KLAKEY    CHAINLOAMD                79
      *
     C                     MOVE LAIN      OLAIN   1
     C                     MOVE AMTP      SATYP
     C                     MOVE LSTC      LSTCS
     C*****                MOVE SUTP      SSTYP                    127289 158200
      *                                                                   158200
     C           SACTN     IFEQ 'X'                                       158200
     C           SACTN     OREQ 'E'                                       158200
     C           SACTN     OREQ 'R'                                       158200
     C                     MOVE SUTP      SSTYP                           158200
     C                     END                                            158200
      *
      **  Test if conf. & msg. seq. nos. blank
      **  Zeroise blank fields, else leave
      *
     C                     MOVE LSWC      LSWCA   3
     C           LSWCA     IFEQ ' '
     C                     Z-ADD0         WOLSWC  30       OUTPUT
     C                     ELSE
     C                     Z-ADDLSWC      WOLSWC  30       OUTPUT
     C                     ENDIF
      *
     C                     MOVE LSWS      LSWSA   3
     C           LSWSA     IFEQ ' '
     C                     Z-ADD0         WOLSWS  30       OUTPUT
     C                     ELSE
     C                     Z-ADDLSWS      WOLSWS  30       OUTPUT
     C                     ENDIF
      *
      ** If amendment is LS convert maturity date
      *
     C           AMTP      IFEQ 'LS'
     C                     MOVE '1'       *IN23
     C                     Z-ADDLSMD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     WMDAT1  6
     C                     ELSE
     C                     MOVE '0'       *IN23
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRREVW  -  Set Loan no. from Review from                      *
      * Called by: SRVAL1 - Validate initial screen                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRREVW    BEGSR
      *
      ** Set default value for Req. authorisation,
      ** and Review from field
      *
     C           SRAUT     IFEQ *BLANK
     C                     MOVE 'N'       SRAUT
     C                     ENDIF
      *
     C           SRLON     IFEQ *BLANK
     C**********           Z-ADD0         WKLNR                                               CLE148
     C                     MOVEL*BLANK    WKLNR                                               CLE148
     C                     ELSE
     C                     MOVE SRLON     WKLNR
     C                     ENDIF
      *
     C                     Z-ADD0         WKVDT
     C                     Z-ADD0         WKLSN
      *
      ** If in Fix/Repair mode, setup logical key and get first record    CAP061
      *                                                                   CAP061
     C           PMODE     IFEQ 'F'                                       CAP061
     C                     MOVELSRLON     WKSLN   6                       CAP061
     C           WKSLN     SETLLLEILAMP1                                  CAP061
     C                     READ LEILAMP1                 80               CAP061
      *                                                                   CAP061
      ** ... otherwise do original processing                             CAP061
      *                                                                   CAP061
     C                     ELSE                                           CAP061
     C           SRAUT     IFEQ 'Y'
     C           KLAKEY    SETLLLELOAML1
     C                     READ LELOAML1                 80
     C                     ELSE
     C********** KLAKEY    SETLLLELOAML0                                  180044
     C**********           READ LELOAML0                 80               180044
     C           KLAKEY    SETLLLELOAML8                                  180044
     C                     READ LELOAML8                 80               180044
     C                     ENDIF
     C                     ENDIF                                          CAP061
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSREV  -  Select records from Review fields                  *
      * Called by: SRSUBF - Main Subfile Processing                   *
      *            SRPROC - Subfile Detail Processing                 *
      * Calls    : SRSINS - Initialise all Screen Fields              *
      *            SRSCLR - Subfile Clear                             *
      *            SRREVW - Set Loan no. from Review from             *
      *            SRLOAD - Load Subfile Records                      *
      *****************************************************************
     C           SRSREV    BEGSR
      *
     C                     MOVE '0'       *IN35
     C                     MOVE '0'       *IN36
      *
      ** Validate Review from Loan No. field
      *
     C           SRLON     IFNE *BLANK
     C                     MOVELSRLON     NUM7
     C                     MOVELNUM7      ALF6
      *
     C           SRLON     IFNE ALF6
     C                     MOVE '1'       *IN35
     C                     MOVEL'LEA1035' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** Requiring Authorisation field must be 'Y', 'N' on blank
      *
     C           SRAUT     IFNE 'Y'
     C           SRAUT     ANDNE'N'
     C           SRAUT     ANDNE*BLANK
     C                     MOVE '1'       *IN36
     C                     MOVEL'LEA1011' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** Initialise and Clear subfile for reload
      *
     C           *IN35     IFEQ '0'
     C           *IN36     ANDEQ'0'
      *                                                                   CAP061
      ** If in Fix/Repair mode, ensure that messages are cleared.         CAP061
      *                                                                   CAP061
     C           PMODE     IFEQ 'F'                                       CAP061
     C                     EXSR CLEAR                                     CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     EXSR SRSINS
     C                     EXSR SRSCLR
     C                     EXSR SRREVW
     C                     EXSR SRLOAD
     C                     MOVE SCRREV    SAVREV
     C                     Z-ADD1         SRECN
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRAUTH  -  Validate authorisation action                      *
      * Called by: SRVAL1 - Validate initial screen                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRAUTH    BEGSR
      *                                                                                       CSD015
      ** Save loan amendment fields into a work variable                                      CSD015
      *                                                                                       CSD015
     C                     MOVEL*BLANKS   WLNRF                                               CSD015
     C                     MOVEL*BLANKS   WKVDAT                                              CSD015
     C                     MOVEL*BLANKS   WLASN                                               CSD015
     C                     MOVE LNRF      WLNRF                                               CSD015
     C                     MOVE VDAT      WKVDAT                                              CSD015
     C                     MOVE LASN      WLASN                                               CSD015
      *
      ** LOAN MUST EXIST IN LOAN FILE                                     158198
      *                                                                   158198
     C           SLNRF     IFNE *BLANK                                    158198
     C                     MOVE SLNRF     WKLNR                           158198
     C                     MOVE 'A'       WRCDT                           158198
     C           KLKEY     CHAINCLOAN               N79                   158198
     C           *IN79     IFEQ '1'                                       158198
     C                     MOVE '1'       *IN31                           158198
     C                     MOVEL'LEA0025' ZAMSID                          158198
     C                     EXSR ZASNMS                                    158198
     C                     ELSE                                                               214893
      *                                                                                       214893
      **  Save some CLOAN details for calculation of effective rates                          214893
      *                                                                                       214893
     C                     Z-ADDRTSP      WCRTSP 117                                          214893
     C                     MOVE BRTT      WCBRTT  2                                           214893
     C                     MOVE SPIN      WCSPIN  1                                           214893
     C                     Z-ADDFSRP      WCFSRP 117                                          214893
     C                     MOVE FSGN      WCFSGN  1                                           214893
     C                     MOVE FPRC      WCFPRC  4                                           214893
      *                                                                                       214893
     C                     ENDIF                                          158198
     C                     ENDIF                                          158198
      *
      *
      ** If authorisation feature (CLE002) is not installed
      ** authorisation action is not allowed
      *
     C           CLE002    IFEQ 'N'
     C           WFMT      IFEQ 'F0'
     C                     MOVEA'11'      *IN,30
     C                     ELSE
     C                     MOVE '1'       *IN49
     C                     MOVE 'Y'       WSFER
     C                     ENDIF
     C                     MOVEL'LEA1021' ZAMSID
     C                     EXSR ZASNMS
      *
      ** If authorisation feature is installed
      *
     C                     ELSE
      *
     C           BPLMAU    IFEQ 'N'
     C           WFMT      IFEQ 'F0'
     C                     MOVEA'1'       *IN,30
     C                     ELSE
     C                     MOVE '1'       *IN49
     C                     MOVE 'Y'       WSFER
     C                     ENDIF
     C                     MOVEL'LEA1022' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      *
      ** If Watch List Checking Applied                                                       CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
      ** If 24X7 is not installed or the suport system is off.                                CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
      *                                                                                       CSD015
      ** If record exits in SDWHTPD, check status.                                            CSD015
      *                                                                                       CSD015
     C                     MOVE *OFF      *IN09                                               CSD015
     C                     MOVEL*BLANKS   KFUNT                                               CSD015
     C                     MOVEL*BLANKS   KIDEN                                               CSD015
     C                     MOVEL*BLANKS   KBRCH                                               CSD015
     C                     MOVEL*BLANKS   WKIDEN                                              CSD015
      *                                                                                       CSD015
     C                     MOVEL'LOAMSDK' KFUNT                                               CSD015
     C           WFMT      IFEQ 'S0'                                                          CSD015
     C                     MOVELSLNRF     WLNRF                                               CSD015
     C                     MOVE SLDTE     WKVDAT                                              CSD015
     C                     MOVE SSQNO     WLASN                                               CSD015
     C                     ENDIF                                                              CSD015
     C           WLNRF     CAT  WKVDAT:0  WKIDEN                                              CSD015
     C                     CAT  WLASN:0   WKIDEN                                              CSD015
     C                     MOVELWKIDEN    KIDEN                                               CSD015
     C                     MOVELBRCA      KBRCH                                               CSD015
     C           KCWHT     CHAINSDCWHTL1             09                                       CSD015
      *                                                                                       CSD015
     C           *IN09     IFEQ *OFF                                                          CSD015
     C           W3TREL    ANDNE'Y'                                                           CSD015
     C                     MOVEL'LEL0564' ZAMSID                                              CSD015
      *                                                                                       CSD015
     C           WFMT      IFEQ 'F0'                                                          CSD015
     C                     MOVE '1'       *IN30                                               CSD015
     C                     MOVE '1'       *IN31                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE '1'       *IN49                                               CSD015
     C                     MOVE 'Y'       WSFER                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     EXSR ZASNMS                                                        CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** ORIGINAL LOAN MUST BE AUTHORISED                                 158198
      *
     C                     MOVE LSTS      WLSTS   1                       158198
     C           WLSTS     IFNE 'A'                                       158198
     C           WFMT      IFEQ 'F0'                                      158198
     C                     MOVEA'11'      *IN,30                          158198
     C                     ELSE                                           158198
     C                     MOVE '1'       *IN49                           158198
     C                     MOVE 'Y'       WSFER                           158198
     C                     ENDIF                                          158198
     C                     MOVEL'LEA1039' ZAMSID                          158198
     C                     EXSR ZASNMS                                    158198
     C                     ENDIF                                          158198
      *
      ** Authorising user must be different from the insert and
      ** amend users
     C/COPY WNCPYSRC,LE2040C016
      *
     C           USER      IFEQ IUSR
     C           USER      OREQ AUSR
     C           WFMT      IFEQ 'F0'
     C                     MOVEA'11'      *IN,30
     C                     ELSE
     C                     MOVE '1'       *IN49
     C                     MOVE 'Y'       WSFER
     C                     ENDIF
     C                     MOVEL'LEA1023' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C/COPY WNCPYSRC,LE2040C017
      *
      ** Status of loan must be complete or requiring re-authori-
      ** sation
      *
     C           ASTS      IFNE 'C'
     C           ASTS      ANDNE'R'
     C           WFMT      IFEQ 'F0'
     C                     MOVEA'11'      *IN,30
     C                     ELSE
     C                     MOVE '1'       *IN49
     C                     MOVE 'Y'       WSFER
     C                     ENDIF
     C                     MOVEL'LEA1024' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRUAUT  -  Check if user is authorised to the action          *
      * Called by: SRVAL1 - Validate initial screen                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRUAUT    BEGSR
      *
      ** For single branch system, check if user is authorised to the
      ** action
      *
     C                     Z-ADD0         @ERR
     C           MBIN      IFEQ 'N'
     C           PMODE     IFEQ 'B'
     C           W#JOB     ANDEQ'LEC2010'
     C                     CALL 'ZBACTU'
     C                     PARM SACTN     @ZACTN
     C                     PARM           @USER
     C**********           PARM           @ZMGRP                                              CSF002
     C**********           PARM           @ZICDE                                              CSF002
     C                     PARM           UNQCDE                                              CSF002
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVACTU'
     C                     PARM SACTN     @ZACTN
     C                     PARM           @ERR
     C                     ENDIF
     C           @ERR      IFNE 0
     C           WFMT      IFEQ 'F0'
     C                     MOVE '1'       *IN30
     C                     ELSE
     C                     MOVE '1'       *IN49
     C                     MOVE 'Y'       WSFER
     C                     ENDIF
     C                     MOVEL'LEA0302' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** For multibranching system, and action codes A/E/R/X, branch code
      ** on loans file must be valid for user
      *
     C           WERRF     IFEQ *BLANK
     C           MBIN      ANDEQ'Y'
     C           SACTN     ANDNE'I'
      *
     C           PMODE     IFEQ 'B'
     C           W#JOB     ANDEQ'LEC2010'
     C                     CALL 'ZBACTBU'
     C                     PARM SACTN     @ZACTN
     C                     PARM BRCA      @ZBR
     C                     PARM           @USER  10
     C**********           PARM           @ZMGRP  40                                          CSF002
     C**********           PARM           @ZICDE  4                                           CSF002
     C                     PARM           UNQCDE 10                                           CSF002
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVACTBU'
     C                     PARM SACTN     @ZACTN  1
     C                     PARM BRCA      @ZBR    3
     C                     PARM           @ERR    10
     C                     ENDIF
     C           @ERR      IFEQ 1
     C           WFMT      IFEQ 'F0'
     C                     MOVEA'11'      *IN,30
     C                     ELSE
     C                     MOVE '1'       *IN49
     C                     MOVE 'Y'       WSFER
     C                     ENDIF
     C                     MOVEL'LEA0303' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C           @ERR      IFEQ 2
     C           WFMT      IFEQ 'F0'
     C                     MOVEA'11'      *IN,30
     C                     ELSE
     C                     MOVE '1'       *IN49
     C                     MOVE 'Y'       WSFER
     C                     ENDIF
     C                     MOVEL'LEA0304' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRVALF  -  Validate Detail Screen Fields                      *
      * Called by: SRDET1                                             *
      * Calls    : SRLSPR - Loan Sub-Type Amendment Processing        *
      *            FCLTSR - Evaluate Facility Exposure                *
      *            SRSCP  - Subroutine to process 'SC' loan amendment *
      *            SRBCP  - Subroutine to process 'BC' loan amendment *
      *****************************************************************
     C           SRVALF    BEGSR
      *                                                                   161036
      ** Set up a flag for parts sold                                     161036
      *                                                                   161036
     C                     MOVE *BLANK    WSOLD                           161036
     C           PTYPA     IFEQ 66                                        161036
     C           PTYPA     OREQ 67                                        161036
     C           PTYPA     OREQ 69                                        161036
     C           CLE005    ANDEQ'Y'                                       161036
     C           PTYPA     OREQ 72                                        161036
     C           CLE005    ANDEQ'Y'                                       161036
     C                     MOVE 'Y'       WSOLD                           161036
     C                     ENDIF                                          161036
      *                                                                   161036
      ** Set up a flag for parts purchased and save original borrower     161036
      *                                                                   161036
     C                     MOVE *BLANK    WPURC   1                       161036
     C           PTYPA     IFEQ 64                                        161036
     C           PTYPA     OREQ 65                                        161036
     C           PTYPA     OREQ 68                                        161036
     C           CLE005    ANDEQ'Y'                                       161036
     C           PTYPA     OREQ 71                                        161036
     C           CLE005    ANDEQ'Y'                                       161036
     C                     MOVE 'Y'       WPURC                           161036
     C**********           MOVE OLNO      WOLNO   60                                   161036 CSD027
     C                     MOVE OLNO      WOLNO   6                                           CSD027
     C                     ENDIF                                          161036
      *                                                                   161036
     C                     Z-ADD0         WSPTYP                          161036
      *                                                                   161036
      *   For type 72 get processing type of loan sold                    161036
      *                                                                   161036
     C           PTYPA     IFEQ 72                                        161036
     C           CLE005    ANDEQ'Y'                                       161036
      *                                                                   161036
     C**********           MOVE OLNO      WSOLNO  60                                   161036 CSD027
     C                     MOVE OLNO      WSOLNO  6                                           CSD027
     C                     MOVE WSOLNO    WKLNR                           161036
     C                     MOVE 'A'       WRCDT                           161036
     C           KLKEY     CHAINCLOAN               N79                   161036
      *                                                                   161036
     C           *IN79     IFEQ '1'                                       161036
     C           *LOCK     IN   LDA                                       161036
     C                     MOVEL'CLOAN   'DBFILE                          161036
     C                     Z-ADD40        DBASE                           161036
     C                     MOVELWSOLNO    DBKEY                           161036
     C                     OUT  LDA                                       161036
     C                     EXSR *PSSR                                     161036
     C                     ENDIF                                          161036
      *                                                                   161036
     C           PTYPA     IFEQ 63                                        161036
     C           PTYPA     OREQ 65                                        161036
     C                     Z-ADD67        WSPTYP  20                      161036
     C                     ENDIF                                          161036
      *                                                                   161036
     C           PTYPA     IFEQ 62                                        161036
     C           PTYPA     OREQ 64                                        161036
     C                     Z-ADD66        WSPTYP  20                      161036
     C                     ENDIF                                          161036
      *                                                                   161036
     C           PTYPA     IFEQ 61                                        161036
     C           PTYPA     OREQ 68                                        161036
     C                     Z-ADD69        WSPTYP  20                      161036
     C                     ENDIF                                          161036
      *                                                                   161036
     C           PTYPA     IFEQ 70                                        161036
     C           PTYPA     OREQ 71                                        161036
     C                     Z-ADD70        WSPTYP  20                      161036
     C                     ENDIF                                          161036
      *                                                                   161036
      ** Rechain Loans file to get back current loan details              161036
      *                                                                   161036
     C                     MOVE SLOAN     WKLNR                           161036
     C                     MOVE 'A'       WRCDT                           161036
     C           KLKEY     CHAINCLOAN               N79                   161036
      *                                                                   161036
     C           *IN79     IFEQ '1'                                       161036
     C           *LOCK     IN   LDA                                       161036
     C                     MOVEL'CLOAN   'DBFILE                          161036
     C                     Z-ADD41        DBASE                           161036
     C                     MOVELWSOLNO    DBKEY                           161036
     C                     OUT  LDA                                       161036
     C                     EXSR *PSSR                                     161036
     C                     ENDIF                                          161036
      *                                                                   161036
     C                     ENDIF                                          161036
      *
     C           SACTN     IFNE 'A'
      *                                                                   CAP061
      ** If in Fix/Repair mode, check value date and amendment type as    CAP061
      ** these may have been changed on the detail screen.                CAP061
      *                                                                   CAP061
     C           PMODE     IFEQ 'F'                                       CAP061
      *                                                                   CAP061
      ** Validate value date.                                             CAP061
      *                                                                   CAP061
     C                     MOVELSVDAT     NUM7    70                      CAP061
     C                     MOVELNUM7      ALF6    6                       CAP061
      *                                                                   CAP061
     C           SVDAT     IFEQ ALF6                                      CAP061
     C                     MOVE SVDAT     ZDATE                           CAP061
     C                     EXSR ZDATE1                                    CAP061
     C                     ELSE                                           CAP061
     C                     MOVE '1'       *IN48                           CAP061
     C                     MOVEL'LEA0105' ZAMSID                          CAP061
     C                     EXSR ZASNMS                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Error if date not later than start date, or later than           CAP061
      ** Maturity date                                                    CAP061
      *                                                                   CAP061
     C                     Z-ADDZDAYNO    VDAYNO  50                      CAP061
      *                                                                   CAP061
     C           VDAYNO    IFLE VDAT                                      CAP061
     C           CLE003    ANDNE'Y'                                       CAP061
     C           VDAYNO    ORLT VDAT                                      CAP061
     C           CLE003    ANDEQ'Y'                                       CAP061
     C           MDAT      ORGT 0                                         CAP061
     C           VDAYNO    ANDGEMDAT                                      CAP061
     C                     MOVE '1'       *IN48                           CAP061
     C                     MOVEL'LEA0106' ZAMSID                          CAP061
     C                     EXSR ZASNMS                                    CAP061
     C                     ELSE                                           CAP061
     C                     MOVE '0'       *IN48                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** Validate amendment type.                                         CAP061
      *                                                                   CAP061
     C           SATYP     IFNE 'PI'                                      CAP061
     C           SATYP     ANDNE'SC'                                      CAP061
     C           SATYP     ANDNE'BC'                                      CAP061
     C           SATYP     ANDNE'SA'                                      CAP061
     C           SATYP     ANDNE'PT'                                      CAP061
     C           SATYP     ANDNE'PF'                                      CAP061
     C                     MOVE '1'       *IN61                           CAP061
     C                     MOVEL'LEA1042' ZAMSID                          CAP061
     C                     EXSR ZASNMS                                    CAP061
     C                     ELSE                                           CAP061
     C                     MOVE '0'       *IN61                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF                                          CAP061
      *                                                                   123857
      *  For Authorisation save extended settlements values before        123857
      *  the chain to FCLTY                                               123857
      *                                                                   123857
     C           SACTN     IFEQ 'X'                                       123857
     C           *IN81     ANDEQ*ON                                       123857
     C                     EXSR SRSAVE                                    123857
     C                     ENDIF                                          123857
      *
      ** Reset Warning flag
      *
     C                     MOVE *BLANK    WWFLG
      *
      ** VALIDATE CUSTOMER
      *
      ** Customer must not be blank
      *
     C           SCNUM     IFEQ *BLANK
     C                     MOVE '1'       *IN37
     C                     MOVEL'LEA0178' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
      *
      ** Customer must exist Customer File
      *
     C           *IN37     IFEQ '0'
     C                     MOVELSCNUM     PCUST
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PCUST  10
     C                     PARM *BLANKS   PKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
     C                     MOVELPCUST     SCNUM
      *
     C           PRTCD     IFNE *BLANK
     C                     MOVE '1'       *IN37
     C                     MOVEL'LEA0034' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SCNUM
     C                     ENDIF
     C                     ELSE                                           143071
     C/COPY WNCPYSRC,LE2040C009
     C                     MOVE BBCUST    W#CUST  6                       143071
     C/COPY WNCPYSRC,LE2040C010
     C                     ENDIF
     C                     ENDIF
      *
      ** Customer must not be a parent
      *
     C           *IN37     IFEQ '0'
     C           BBPAIN    ANDEQ'P'
     C                     MOVE '1'       *IN37
     C                     MOVEL'LEA0036' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
      *
      ** Entered customer must equal customer in related loan
      *
     C           *IN37     IFEQ '0'
      *                                                                                       207629
     C           PTYPA     IFEQ 64                                                            207629
     C           PTYPA     OREQ 65                                                            207629
     C           PTYPA     OREQ 68                                                            207629
     C           PTYPA     OREQ 71                                                            207629
      *If the loan is a Participation Purchased, & System Value                               207629
      * LoanCustOriginPurch = 'O', use Original Borrower:                                     207629
     C           PPCUST    IFEQ 'O'                                                           207629
     C                     MOVE OLNO      WLCNOA                                              207629
      * Else, use 'Purchased from' customer number.                                           207629
     C                     ELSE                                                               207629
     C                     MOVE WLCNO     WLCNOA                                              207629
     C                     ENDIF                                                              207629
      * Else, loan is not a Part Purchased:                                                   207629
     C                     ELSE                                                               207629
     C                     MOVE WLCNO     WLCNOA  6
     C                     ENDIF                                                              207629
      *                                                                                       207629
     C           BBCUST    IFNE WLCNOA
     C                     MOVE '1'       *IN37
     C                     MOVEL'LEA0104' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
     C                     ENDIF
      *
      ** Loan Sub-type amendment processing
      *
     C           SATYP     IFEQ 'LS'
     C                     EXSR SRLSPR
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
      *
      ** VALIDATE BASE RATE
      *
     C           SBRAT     IFEQ *BLANK
     C           SATYP     IFEQ 'BC'
     C           CLE036    ANDEQ'N'                                                           CLE036
     C                     MOVE '1'       *IN38
     C                     MOVEL'LEA0193' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
      *                                                                                       CLE036
      ** If CLE036 is on and amendment type is 'BC', either                                   CLE036
      ** Base Rate Code or Rate/Spread must be entered                                        CLE036
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C           SATYP     ANDEQ'BC'                                                          CLE036
     C           SRTSP     ANDEQ*BLANKS                                                       CLE036
     C                     MOVE *ON       *IN38                                               CLE036
     C                     MOVE *ON       *IN39                                               CLE036
     C                     MOVEL'LEA0198' ZAMSID                                              CLE036
     C                     EXSR ZASNMS                                                        CLE036
      *                                                                                       CLE036
      ** Check for error in batch, and end validation if one has                              CLE036
      ** occurred.                                                                            CLE036
      *                                                                                       CLE036
     C           CAP061    IFEQ 'Y'                                                           CLE036
     C           PMODE     ANDEQ'B'                                                           CLE036
     C           CAP61E    ANDEQ'Y'                                                           CLE036
     C                     GOTO CAP61V                                                        CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     ELSE
     C           SATYP     IFNE 'BC'
     C                     MOVE '1'       *IN38
     C                     MOVEL'LEA0194' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C           SATYP     ANDEQ'BC'                                                          CLE036
     C           SRTSP     ANDNE*BLANKS                                                       CLE036
     C                     MOVE *ON       *IN38                                               CLE036
     C                     MOVE *ON       *IN39                                               CLE036
     C                     MOVEL'LEA0198' ZAMSID                                              CLE036
     C                     EXSR ZASNMS                                                        CLE036
      *                                                                                       CLE036
      ** Check for error in batch, and end validation if one has                              CLE036
      ** occurred.                                                                            CLE036
      *                                                                                       CLE036
     C           CAP061    IFEQ 'Y'                                                           CLE036
     C           PMODE     ANDEQ'B'                                                           CLE036
     C           CAP61E    ANDEQ'Y'                                                           CLE036
     C                     GOTO CAP61V                                                        CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF
      *
      ** Check Base rate entered on Base Rate file
      *
     C           *IN40     IFEQ '0'
     C           *IN38     ANDEQ'0'
     C           SBRAT     ANDNE*BLANK
     C                     CALL 'AOBSRTR0'
     C                     PARM '*BLANKS' PRTCD
     C                     PARM '*KEY    'POPTN
     C                     PARM SCURR     PCURR   3
     C           SBRAT     PARM SBRAT     PBRAT   2
     C********** SDBSRT    PARM SDBSRT    DSFDY                                 CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                                 CSD006
      *
     C           PRTCD     IFEQ *BLANK
     C                     MOVELBACBSR    WCBSR  117
     C                     MOVELBANBRT    WNBRT  117
     C                     MOVELBAVDNR    WVDNR   50
     C                     MOVELBAVDRC    WVDRC   50
     C                     ELSE
     C                     MOVE '1'       *IN38
     C                     MOVEL'LEA0139' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANK    SBRAT
     C                     ENDIF
     C                     ENDIF
      *
      ** If base rate is going to change on or before value date of
      ** loan amendment, then use new base rate
      *
     C           *IN38     IFEQ '0'
     C           VDAYNO    IFLT WVDNR
     C                     Z-ADDWCBSR     WBASR  117
     C                     ELSE
     C                     Z-ADDWNBRT     WBASR  117
     C                     ENDIF
     C                     ENDIF
      *
      ** Entry to this field is forbidden if base rate change
      ** facility indicator is not set to 'Y'
      *
     C           *IN38     IFEQ '0'
     C           BPBRCF    ANDNE'Y'
     C                     MOVE '1'       *IN38
     C                     MOVEL'LEA1010' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE RATE/SPREAD
      ** Field must not be blank for type 'SC' if Analytical
      ** Accounting is not installed
      *
     C                     Z-ADD*ZEROS    WSPRT                                               CLE036
     C           SRTSP     IFEQ *BLANK
     C           SATYP     IFEQ 'SC'
     C           *IN51     ANDEQ'0'
     C                     MOVE '1'       *IN39
     C                     MOVEL'LEA0186' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
     C                     ELSE
     C           SATYP     IFNE 'SC'
     C           CLE036    ANDEQ'N'                                                           CLE036
     C                     MOVE '1'       *IN39
     C                     MOVEL'LEA0187' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
      *                                                                                       CLE036
      ** If CLE036 is on, Rate/Spread must be blank if                                        CLE036
      ** amendment type not 'BC' or 'SC'                                                      CLE036
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C           SATYP     ANDNE'SC'                                                          CLE036
     C           SATYP     ANDNE'BC'                                                          CLE036
     C                     MOVE *ON       *IN39                                               CLE036
     C                     MOVEL'LEA0199' ZAMSID                                              CLE036
     C                     EXSR ZASNMS                                                        CLE036
      *                                                                                       CLE036
      ** Check for error in batch, and end validation if one has                              CLE036
      ** occurred.                                                                            CLE036
      *                                                                                       CLE036
     C           CAP061    IFEQ 'Y'                                                           CLE036
     C           PMODE     ANDEQ'B'                                                           CLE036
     C           CAP61E    ANDEQ'Y'                                                           CLE036
     C                     GOTO CAP61V                                                        CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
      ** For a base rate change, do not allow a zero rate/spread field:                       CLE036
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C           SATYP     ANDEQ'BC'                                                          CLE036
     C                     Z-ADD*ZEROS    W1SPRT 117                                          CLE036
     C                     MOVE *BLANK    ZFIELD                                              CLE036
     C                     MOVELSRTSP     ZFIELD                                              CLE036
     C                     Z-ADD7         ZADEC                                               CLE036
     C                     Z-ADD4         ZADIG                                               CLE036
     C                     EXSR ZALIGN                                                        CLE036
     C                     MOVE ZFIELD    W1SPRT                                              CLE036
     C           W1SPRT    IFEQ *ZEROS                                                        CLE036
     C           *IN99     ANDEQ'0'                                                           CLE036
     C                     MOVE '1'       *IN39                                               CLE036
     C                     MOVEL'LEA0200' ZAMSID                                              CLE036
     C                     EXSR ZASNMS                                                        CLE036
      *                                                                                       CLE036
      ** Check for error in batch, and end validation if one has                              CLE036
      ** occurred.                                                                            CLE036
      *                                                                                       CLE036
     C           CAP061    IFEQ 'Y'                                                           CLE036
     C           PMODE     ANDEQ'B'                                                           CLE036
     C           CAP61E    ANDEQ'Y'                                                           CLE036
     C                     GOTO CAP61V                                                        CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     ENDIF
      *
     C           *IN38     IFEQ '0'
     C           *IN39     ANDEQ*OFF                                                          CLE036
     C           SATYP     ANDEQ'SC'
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           *IN38     ANDEQ*OFF                                                          CLE036
     C           *IN39     ANDEQ*OFF                                                          CLE036
     C           SATYP     ANDEQ'BC'                                                          CLE036
     C           SRTSP     ANDNE*BLANKS                                                       CLE036
     C                     MOVE *BLANK    ZFIELD
     C                     MOVELSRTSP     ZFIELD
     C                     Z-ADD7         ZADEC
     C                     Z-ADD4         ZADIG
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN39
     C                     MOVEL'LEA0188' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ELSE
     C                     MOVE ZFIELD    WSPRT  117
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     MOVE ZFIELD    WBASR                                               CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF
     C                     ENDIF
      *                                                                                     AR847588
      ** Validate Spread Rate Sign. If not an SC, spread rate sign is                       AR847588
      ** forbidden.                                                                         AR847588
      *                                                                                     AR847588
     C           SRSGN     IFNE *BLANKS                                                     AR847588
     C           SATYP     ANDNE'SC'                                                        AR847588
     C                     MOVE '1'       *IN14                                             AR847588
     C                     MOVEL'LEA1629' ZAMSID                                            AR847588
     C                     EXSR ZASNMS                                                      AR847588
     C                     ENDIF                                                            AR847588
      *                                                                                     AR847588
      ** If it is an SC, spread rate must be '-' or '+'.                                    AR847588
      *                                                                                     AR847588
     C           SATYP     IFEQ 'SC'                                                        AR847588
     C           SRSGN     ANDNE*BLANKS                                                     AR847588
     C           SRSGN     IFNE '-'                                                         AR847588
     C           SRSGN     ANDNE'+'                                                         AR847588
     C                     MOVE '1'       *IN14                                             AR847588
     C                     MOVEL'LEA1628' ZAMSID                                            AR847588
     C                     EXSR ZASNMS                                                      AR847588
     C                     ENDIF                                                            AR847588
     C                     ENDIF                                                            AR847588
      *
      ** VALIDATE CURRENCY
      *
     C           SCURR     IFEQ *BLANK
     C                     MOVE '1'       *IN40
     C                     MOVEL'LEA0175' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
      *
      ** Check currency in Currency file
      *
     C           *IN40     IFEQ '0'
     C                     CALL 'AOCURRR0'
     C                     PARM '*BLANK  'PRTCD
      *                                                                   161350
      *** Move *VERIFY to @OPTN parameter as we want to determine         161350
      *** whether the currency is valid                                   161350
      *                                                                   161350
     C**********           PARM '*KEY    'POPTN                           161350
     C                     PARM '*VERIFY 'POPTN                           161350
     C           SCURR     PARM SCURR     PCURR   3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN40
     C                     MOVEL'LEA1009' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANK    SCURR
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *                                                                   161350
      *** Determine whether the switchable feature Multi Currency         161350
      *** Rollover (CEU020) is switched on and whether the Loan has       161350
      *** Rollover details, indicated by the rollover date                161350
      *                                                                   161350
     C           *IN40     IFEQ '0'                                       161350
      *                                                                   161350
     C           CEU020    IFEQ 'Y'                                       161350
     C           RLDT      IFNE 0                                         161350
      *                                                                   161350
      *** If the rollover date is later than the value date of the loan   161350
      *** amendment then ensure that the loan amendment is using the      161350
      *** original loan currency                                          161350
      *                                                                   161350
     C********** RLDT      IFGT VDAYNO                                                 161350 216466
     C           RLDT      IFGE VDAYNO                                                        216466
     C           SCURR     IFNE WLCUR                                     161350
     C                     MOVE '1'       *IN40                           161350
      *                                                                   161350
      *** Message 0189 to say that the Loan amendment currency is         161350
      *** not equal to the original Loan currency                         161350
      *                                                                   161350
     C                     MOVEL'LEA0189' ZAMSID                          161350
     C                     EXSR ZASNMS                                    161350
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF                                          161350
     C                     ENDIF                                          161350
      *                                                                   161350
      *** If the rollover date is earlier than the value date of the      161350
      *** loan amendment then ensure that the loan amendment is           161350
      *** using the rollover ccy, if entered                              161350
      *                                                                   161350
      *** This is only possible for an IN ccy which has started it's      161350
      *** transition period on or before the rollover date.  These        161350
      *** loans can only roll over to EUR (Checked in LE0070)             161350
      *                                                                   161350
     C           RLDT      IFLT VDAYNO                                    161350
     C           NCCY      IFNE *BLANKS                                   161350
      *                                                                   161350
     C           SCURR     IFNE NCCY                                      161350
     C           CLE014    ANDEQ'N'                                       CLE014
     C                     MOVE '1'       *IN40                           161350
      *                                                                   161350
      *** Message 0115 to say that the Loan amendment currency is         161350
      *** not equal to the Rollover Loan currency                         161350
      *                                                                   161350
     C                     MOVEL'LEA0115' ZAMSID                          161350
     C                     EXSR ZASNMS                                    161350
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF                                          161350
      *                                                                   CLE014
      ** If CLE014 is installed, currency must be in the loan currency    CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           SCURR     ANDNEWLCUR                                     CLE014
     C                     MOVE *ON       *IN40                           CLE014
     C                     MOVEL'LEA0189' ZAMSID                          CLE014
     C                     EXSR ZASNMS                                    CLE014
     C                     ENDIF                                          CLE014
      *                                                                   161350
     C                     ELSE                                           161350
      *                                                                   161350
     C           SCURR     IFNE WLCUR                                     161350
     C                     MOVE '1'       *IN40                           161350
      *                                                                   161350
      *** Message 0189 to say that the Loan amendment currency is         161350
      *** not equal to the original Loan currency                         161350
      *                                                                   161350
     C                     MOVEL'LEA0189' ZAMSID                          161350
     C                     EXSR ZASNMS                                    161350
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF                                          161350
     C                     ENDIF                                          161350
      *                                                                   161350
     C                     ENDIF                                          161350
      *                                                                   161350
     C                     ENDIF                                          161350
      *                                                                   161350
      *** If the Switchable feature Multi Currency Rollover (CEU020)      161350
      *** is switched on and there are no rollover details then           161350
      *** Validate against the original Loan currency                     161350
      *                                                                   161350
     C           RLDT      IFEQ 0                                         161350
      *                                                                   161350
     C           SCURR     IFNE WLCUR                                     161350
     C                     MOVE '1'       *IN40                           161350
      *                                                                   161350
      *** Message 0189 to say that the Loan amendment currency is         161350
      *** not equal to the original Loan currency                         161350
      *                                                                   161350
     C                     MOVEL'LEA0189' ZAMSID                          161350
     C                     EXSR ZASNMS                                    161350
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF                                          161350
      *                                                                   161350
     C                     ENDIF                                          161350
     C                     ENDIF                                          161350
      *                                                                   161350
      *** For non CEU020 loan amends ensure that the loan amendment       161350
      *** is using the original loan currency                             161350
      *                                                                   161350
     C           CEU020    IFNE 'Y'                                       161350
     C           SCURR     IFNE WLCUR                                     161350
     C                     MOVE '1'       *IN40                           161350
      *                                                                   161350
      *** Message 0189 to say that the Loan amendment currency is         161350
      *** not equal to the original Loan currency                         161350
      *                                                                   161350
     C                     MOVEL'LEA0189' ZAMSID                          161350
     C                     EXSR ZASNMS                                    161350
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF                                          161350
     C                     ENDIF                                          161350
      *                                                                   161350
     C                     ENDIF                                          161350
      *                                                                   161350
      ***********                                                  CEU020 147281
      ***Initialise*value*of*WCCYFL*to*blank*if*CEU020*is*installedCEU020 147281
      ***********                                                  CEU020 147281
     C***********CEU020    IFEQ 'Y'                                CEU020 147281
     C***********          MOVE 'N'       WCCYFL  1                CEU020 147281
      ***********                                                  CEU020 147281
      ***Check*SDCURRPD*to*know*if*WLCUR*is*on*'in'*Ccy*if*CEU020  CEU020 147281
      ***********                                                  CEU020 147281
     C***********SCURR     IFEQ BKEURO                             CEU020 147281
      ***********                                                  CEU020 147281
     C***********          CALL 'AOCURRR0'                         CEU020 147281
     C***********          PARM '*BLANK  'PRTCD                    CEU020 147281
     C***********          PARM '*KEY    'POPTN                    CEU020 147281
     C***********WLCUR     PARM WLCUR     PCURR   3                CEU020 147281
     C***********SDCURR    PARM SDCURR    DSSDY                    CEU020 147281
      ***********                                                  CEU020 147281
     C***********PRTCD     IFNE *BLANKS                            CEU020 147281
     C***********          MOVE '1'       *IN40                    CEU020 147281
     C***********          MOVEL'LEA1009' ZAMSID                   CEU020 147281
     C***********          EXSR ZASNMS                             CEU020 147281
     C***********PRTCD     IFEQ '*NOSEL  '                         CEU020 147281
     C***********          MOVE *BLANK    SCURR                    CEU020 147281
     C***********          ENDIF                                   CEU020 147281
     C***********          ELSE                                    CEU020 147281
      ***********                                                  CEU020 147281
     C***********A6INCY    IFEQ 'Y'                                CEU020 147281
     C***********SCURR     ANDEQBKEURO                             CEU020 147281
     C***********VDAYNO    ANDGEWRLDT                              CEU020 147281
     C***********VDAYNO    ANDGEA6TPSD                             CEU020 147281
     C***********          MOVE 'Y'       WCCYFL                   CEU020 147281
     C***********          ENDIF                                   CEU020 147281
      ***********                                                  CEU020 147281
     C***********          ENDIF                                   CEU020 147281
     C***********          ENDIF                                   CEU020 147281
     C***********          ENDIF                                   CEU020 147281
      ***********                                                         161350
      ***Currency must be the same as Loan currency                       161350
      ***********                                                         161350
     C********** *IN40     IFEQ '0'                                       161350
     C********** SCURR     ANDNEWLCUR                                     161350
     C***********WCCYFL    ANDEQ'N'                                CEU020 147281
     C**********           MOVE '1'       *IN40                           161350
     C**********           MOVEL'LEA0189' ZAMSID                          161350
     C**********           EXSR ZASNMS                                    161350
     C**********           ENDIF                                          161350
      *                                                                   120023
      ** VALIDATE LOAN AMENDMENT AMOUNT                                   120023
      *                                                                   120023
     C           SAMNT     IFEQ *BLANK                                    120023
     C           SATYP     IFEQ 'PI'                                      120023
     C                     MOVE '1'       *IN41                           120023
     C                     MOVEL'LEA0190' ZAMSID                          120023
     C                     EXSR ZASNMS                                    120023
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF                                          120023
     C                     ELSE                                           120023
     C           SATYP     IFNE 'PI'                                      120023
     C                     MOVE '1'       *IN41                           120023
     C                     MOVEL'LEA0191' ZAMSID                          120023
     C                     EXSR ZASNMS                                    120023
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF                                          120023
     C                     ENDIF                                          120023
      *                                                                   120023
     C                     Z-ADD0         WLAMT                           120023
      *                                                                   120023
     C           *IN41     IFEQ '0'                                       120023
     C           SATYP     ANDEQ'PI'                                      120023
     C           *IN40     ANDEQ'0'                                       120023
     C/COPY WNCPYSRC,LEH01128
      *                                                                   120023
      ** Get currency decimal places                                      120023
      *                                                                   120023
     C                     CALL 'AOCURRR0'                                120023
     C                     PARM *BLANKS   PRTCD                           120023
     C                     PARM '*KEY   ' POPTN                           120023
     C                     PARM SCURR     PCURR                           120023
     C           SDCURR    PARM SDCURR    DSSDY                           120023
     C           PRTCD     IFNE *BLANKS                                   120023
     C           *LOCK     IN   LDA                                       120023
     C                     MOVEL'SDCURRPD'DBFILE           ************   120023
     C                     Z-ADD12        DBASE            * DBERR 12 *   120023
     C                     MOVELCCY       DBKEY            ************   120023
     C                     OUT  LDA                                       120023
     C                     EXSR *PSSR                                     120023
     C                     ENDIF                                          120023
      *                                                                                       CLE023
      ** Save currency details.                                                               CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     MOVE PCURR     WCCYL   3                                           CLE023
     C                     Z-ADDA6SPRT    WSPRTL 138                                          CLE023
     C                     MOVE A6MDIN    WMDINL  1                                           CLE023
     C                     Z-ADDA6NBDP    WCDPL   10                                          CLE023
     C                     ENDIF                                                              CLE023
      *                                                                   120023
     C                     Z-ADDA6NBDP    CDP     10                      120023
     C                     Z-ADDCDP       CDPL    10                      120023
     C                     Z-ADDCDP       ZADEC                           120023
     C           13        SUB  CDP       ZADIG                           120023
     C                     MOVE *BLANK    ZFIELD                          120023
     C                     MOVE SAMNT     ZFIELD                          120023
     C                     EXSR ZALIGN                                    120023
     C           *IN99     IFNE '1'                                       120023
     C                     MOVE ZFIELD    WLAMT  130                      120023
     C/COPY WNCPYSRC,LEH01129
     C           SATYP     IFEQ 'PI'                                      120023
     C           WLAMT     ANDEQ0                                         120023
     C                     MOVE '1'       *IN41                           120023
     C                     MOVEL'LEA0190' ZAMSID                          120023
     C                     EXSR ZASNMS                                    120023
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF                                          120023
     C                     ELSE                                           120023
     C                     MOVE '1'       *IN41                           120023
     C                     MOVEL'LEA0192' ZAMSID                          120023
     C                     EXSR ZASNMS                                    120023
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF                                          120023
      *                                                                   149500
      ** Check amount against the current principal amount of OLNO        149500
      ** Only if amendment is against a participation sold                150799
      *                                                                   150799
     C           PTYPA     IFNE 64                                        150799
     C           PTYPA     ANDNE65                                        150799
     C           PTYPA     ANDNE68                                        150799
     C           PTYPA     ANDNE71                                        150799
      *                                                                   149500
     C           *IN41     IFEQ '0'                                       149500
     C           SACTN     ANDNE'X'                                       149500
     C********** OLNO      ANDNE*ZERO                                                  149500 CSD027
     C           OLNO      ANDNE*BLANKS                                                       CSD027
     C           SATYP     ANDEQ'PI'                                      149500
     C**********           MOVE OLNO      WKLNR2  60                                   149500 CSD027
     C                     MOVE OLNO      WKLNR2  6                                           CSD027
     C                     MOVE OLNO      WKLNR                           149500
     C                     MOVE 'A'       WRCDT                           149500
     C           KLKEY     CHAINCLOAN               N79                   149500
     C           *IN79     IFEQ '1'                                       149500
     C           *LOCK     IN   LDA                                       149500
     C                     MOVEL'CLOAN   'DBFILE           ************   149500
     C                     Z-ADD38        DBASE            * DBERR 38 *   149500
     C                     MOVELWKLNR     DBKEY            ************   149500
     C                     OUT  LDA                                       149500
     C                     EXSR *PSSR                                     149500
     C                     ENDIF                                          149500
      *                                                                   149500
     C                     Z-ADDCPAM      WCPAM  130                      149500
      *                                                                   149500
      ** Accumulate total amount sold for the orig loan.                  149500
      *                                                                   149500
     C                     EXSR SRTAMT                                    149500
     C           WTAMT     IFGT WCPAM                                     149500
     C           W#CNT     ANDEQ0                                         149500
     C                     MOVE '1'       *IN41                           149500
     C                     MOVE 'Y'       WWERR                           149500
     C                     Z-ADD1         W#CNT                           149500
     C                     MOVEL'LEA1040' ZAMSID                          149500
     C                     EXSR ZASNMS                                    149500
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     MOVE *BLANK    WWERR                           149500
     C                     ENDIF                                          149500
      *                                                                   149500
      ** Restore original value of CLOAN fields to that of SLOAN.         149500
      *                                                                   149500
     C                     MOVE SLOAN     WKLNR                           149500
     C                     MOVE 'A'       WRCDT                           149500
     C           KLKEY     CHAINCLOAN               N79                   149500
     C           *IN79     IFEQ '1'                                       149500
     C           *LOCK     IN   LDA                                       149500
     C                     MOVEL'CLOAN   'DBFILE           ************   149500
     C                     Z-ADD43        DBASE            * DBERR 43 *   149500
     C                     MOVELWKLNR     DBKEY            ************   149500
     C                     OUT  LDA                                       149500
     C                     EXSR *PSSR                                     149500
     C                     ENDIF                                          149500
     C                     ENDIF                                          149500
      *                                                                   150799
     C                     ENDIF                                          150799
      *                                                                   120023
      ** Check amount against facility file for over facility position    120023
      *                                                                   120023
     C           *IN41     IFEQ '0'                                       120023
     C           SACTN     ANDNE'X'                                       158205
     C/COPY WNCPYSRC,LE2040C015
     C                     MOVELFCUSC     WFCNM                           120023
     C                     MOVELFTYPC     WFACT                           120023
     C                     MOVELFSEQC     WFNUM                           120023
     C                     MOVE 'A'       WFRTP                           120023
      *                                                                   120023
     C           KFCLT     CHAINFCLTY               N79                   120023
      *                                                                   120023
     C           *IN79     IFEQ '1'                                       120023
     C           *LOCK     IN   LDA                                       120023
     C                     MOVEL'FCLTY   'DBFILE           ************   120023
     C                     Z-ADD13        DBASE            * DBERR 13 *   120023
     C                     MOVELFCLKEY    DBKEY            ************   120023
     C                     OUT  LDA                                       120023
     C                     EXSR *PSSR                                     120023
     C                     ENDIF                                          120023
      *                                                                   120023
      ** Facility - B                                                     120023
      *                                                                   120023
     C                     MOVE 'B'       WFRTP                           120023
     C           KFCLT     CHAINFCLTY               N79                   120023
      *                                                                   120023
     C           *IN79     IFEQ '1'                                       120023
     C           *LOCK     IN   LDA                                       120023
     C                     MOVEL'FCLTY   'DBFILE           ************   120023
     C                     Z-ADD14        DBASE            * DBERR 14 *   120023
     C                     MOVELFCLKEY    DBKEY            ************   120023
     C                     OUT  LDA                                       120023
     C                     EXSR *PSSR                                     120023
     C                     ENDIF                                          120023
      *                                                                   120023
      ** Use Facility CCY to pick facility decimal positions              120023
      *                                                                   120023
     C                     CALL 'AOCURRR0'                                120023
     C                     PARM *BLANKS   PRTCD                           120023
     C                     PARM '*KEY   ' POPTN                           120023
     C                     PARM FCCY      PCURR                           120023
     C           SDCURR    PARM SDCURR    DSSDY                           120023
     C           PRTCD     IFNE *BLANKS                                   120023
     C           *LOCK     IN   LDA                                       120023
     C                     MOVEL'SDCURRPD'DBFILE           ************   120023
     C                     Z-ADD15        DBASE            * DBERR 15 *   120023
     C                     MOVELCCY       DBKEY            ************   120023
     C                     OUT  LDA                                       120023
     C                     EXSR *PSSR                                     120023
     C                     ENDIF                                          120023
      *                                                                                       CLE023
      ** Save currency details.                                                               CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     MOVE PCURR     WCCYF   3                                           CLE023
     C                     Z-ADDA6SPRT    WSPRTF 138                                          CLE023
     C                     MOVE A6MDIN    WMDINF  1                                           CLE023
     C                     Z-ADDA6NBDP    WCDPF   10                                          CLE023
     C                     ENDIF                                                              CLE023
      *                                                                   120023
     C                     Z-ADDA6NBDP    CDPF    10                      120023
      *                                                                                     AR656363
     C           CLE134    IFEQ 'Y'                                                         AR656363
     C                     MOVE 'Y'       WEXPO   1                                         AR656363
     C                     EXSR PDCLPI                                                      AR656363
     C                     ENDIF                                                            AR656363
      *                                                                                     AR656363
     C                     EXSR FCLTSR                                    120023
      *                                                                   120023
     C           OVPC      ADD  100       WK85    85                      120023
     C           WK85      DIV  100       WK85                            120023
     C           FAMT      MULT WK85      FAMT      H                     120023
      *                                                                   157303
      ** Check if there are facility amendments                           157303
      *                                                                   157303
     C                     EXSR FCLTAM                                    157303
      *                                                                   157303
     C                     Z-ADD0         W#CNT                           157303
     C                     Z-ADD1         L       20                      120023
      *                                                                   120023
      ** Send warning message if loan amount causes facility amount       120023
      ** to be exceeded. Seton warning flag WWFLG in ZASNMS               120023
      *                                                                   120023
     C           L         DOWLE10                                        120023
     C***********FAMT      IFLT OAM,L                              120023 157303
     C           FAMT      IFLT WOAM,L                                    157303
     C           W#CNT     ANDEQ0                                         134799
     C                     MOVE '1'       *IN41                           120023
     C                     MOVE 'Y'       WWERR                           120023
     C                     Z-ADD1         W#CNT   10                      134799
     C                     MOVEL'LEA1029' ZAMSID                          120023
     C                     EXSR ZASNMS                                    120023
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     MOVE *BLANK    WWERR                           120023
     C                     LEAVE                                          120023
     C                     ENDIF                                          120023
     C           L         ADD  1         L                               120023
     C                     ENDDO                                          120023
     C/COPY WNCPYSRC,LE2040C014
      *                                                                   120023
     C                     ENDIF                           *IN41          120023
     C                     ENDIF                           *IN41          120023
     C/COPY WNCPYSRC,LEH01130
      *                                                                   CLE003
      **  EXTRA VALIDATION FOR VALUE DATE. CHECK TO SEE IF THERE IS A     CLE003
      **  BASE RATE FOR THE PERIOD OF THE BACKVALUATION.                  CLE003
      *                                                                   CLE003
     C           CLE003    IFEQ 'Y'                                       CLE003
     C           *LIKE     DEFN G0CYCD    CRCY                            CLE003
     C           *LIKE     DEFN G0BSRC    BCCOD                           CLE003
     C                     MOVELSCURR     CRCY                            CLE003
     C                     MOVELSBRAT     BCCOD                           CLE003
      *                                                                   CLE003
     C           SATYP     IFEQ 'BC'                                      CLE003
     C           SCURR     ANDNE*BLANKS                                   CLE003
     C           SBRAT     ANDNE*BLANKS                                   CLE003
     C           BCKEY     CHAINSDBSHSL1             93                   CLE003
      *                                                                   CLE003
      * IF THE NEW VALUE DATE IS NOT EQUAL TO THE VALUE ON THE HISTORY    CLE003
      * FILE, CHECK THAT A RATE EXISTS FOR THE CURRENCY AND CODE          CLE003
      * BEFORE THE NEW DATE. IF NOT THEN ENTRY IS NOT VALID.              CLE003
      *                                                                   CLE003
     C           *IN93     IFEQ *ON                                       CLE003
      *                                                                                       200967
      ** Check if the rate exists in SDBSRTPD for the currency and the                        200967
      ** code.  Also check if dates are valid.                                                200967
      *                                                                                       200967
     C                     CALL 'AOBSRTR0'                                                    200967
     C                     PARM *BLANKS   PRTCD                                               200967
     C                     PARM '*KEY    'POPTN                                               200967
     C                     PARM CRCY      PCURR                                               200967
     C                     PARM SBRAT     PBRAT                                               200967
     C           SDBSRT    PARM SDBSRT    DSFDY                                               200967
     C                     ENDIF                                                              200967
      *                                                                                       200967
     C           PRTCD     IFNE *BLANKS                                                       200967
     C           VADAT     ORLT BAVDNR                                                        200967
     C           VADAT     ANDNE*ZEROS                                                        200967
     C           *IN93     ANDEQ'1'                                                           200967
     C           VADAT     ORLT G0HIDT                                    CLE003
     C           VADAT     ANDNE*ZEROS                                                        200967
     C           *IN93     ANDNE'1'                                                           200967
     C                     MOVEL'LEA1038' ZAMSID                          CLE003
     C                     EXSR ZASNMS                                    CLE003
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CLE003
     C                     ENDIF                                          CLE003
     C                     ENDIF                                          CLEE03
     C                     ENDIF                                          CLE003
      *
      ** EXTRA VALIDATION FOR VALUE DATE
      *
      ** Calculate Back value limit
      *
     C           RUND      SUB  BJBVPD    WBKLIM  50
      *
      *  An amendment cannot be earlier than a Multi-currency             121061
      *  Rollover date.                                                   121061
      *                                                                   121061
     C           CLE003    IFEQ 'Y'
     C***********VDAYNO    IFLT RLDT                                      121061
     C           VDAYNO    IFLT LMCD                                      121061
     C                     MOVE '1'       *IN48
     C                     MOVEL'LEA1032' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
     C                     ELSE
      *
     C           SLID      IFLT WBKLIM
     C           VDAYNO    IFLT SLID
     C                     MOVE '1'       *IN48
     C                     MOVEL'LEA0111' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
     C                     ELSE
     C           VDAYNO    IFLT WBKLIM
     C                     MOVE '1'       *IN48
     C                     MOVEL'LEA0111' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** Check if date is earlier or the same as Last Rate Change Date
      *
     C           *IN33     IFEQ '0'
     C           SATYP     IFEQ 'BC'
     C           VDAYNO    ANDLEDLRC
     C           SATYP     OREQ 'SC'
     C           VDAYNO    ANDLEDLRC
     C                     MOVE '1'       *IN48
     C                     MOVEL'LEA0112' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
     C                     ENDIF
      *
      ** If base rate is going to change today then also prohibit
      ** back valued amendments
      *
     C           *IN33     IFEQ '0'
     C           *IN40     IFEQ '0'
     C           *IN38     ANDEQ'0'
     C           SATYP     ANDEQ'BC'
      *
     C           WVDNR     IFEQ RUND
     C           VDAYNO    IFLT WVDNR
     C                     MOVE '1'       *IN48
     C                     MOVEL'LEA0113' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
     C                     ENDIF
      *
     C           *IN33     IFEQ '0'
     C           VDAYNO    ANDLTWVDRC
     C                     MOVE '1'       *IN48
     C                     MOVEL'LEA0113' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** VALIDATE STOP ACCRUALS
      *
     C           SSTPA     IFEQ *BLANK
     C           SATYP     IFEQ 'SA'
     C                     MOVE '1'       *IN42
     C                     MOVEL'LEA0195' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
     C                     ELSE
      *
     C           SSTPA     IFNE 'Y'
     C           SSTPA     ANDNE'N'
     C                     MOVE '1'       *IN42
     C                     MOVEL'LEA1007' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
      *
     C           *IN42     IFEQ '0'
     C           SATYP     ANDNE'SA'
     C                     MOVE '1'       *IN42
     C                     MOVEL'LEA0196' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Check Stop accrual BIT on file
      *
     C           *IN42     IFEQ '0'
     C           SSTPA     ANDNE*BLANK
      *                                                                   115208
      * Get previous and next Stop Accrual amendments.                    115208
      * If a previous Stop Accrual amendment exists, then the value of    115208
      * the flag cannot be the same as that entered;                      115208
      * otherwise, check against the original bit setting as below.       115208
      * In addition, the entered Stop Accrual cannot be equal to the      115208
      * flag on the next Stop Accrual amendment, if this exists.          115208
     C                     MOVE *BLANKS   P#STAI  1                       115208
     C                     MOVE *BLANKS   N#STAI  1                       115208
      *                                                                   115208
     C                     MOVE SLOAN     WKLNR                           115570
     C                     MOVE VDAYNO    WKVDT                           115208
      *                                                                   115208
      * Get previous stop accrual amendment.                              115208
     C           K#LM11    SETLLLOAMD                                     115208
     C           WKLNR     REDPELOAMD                    92               115570
     C           *IN92     DOWEQ*OFF                                      115208
      *                                                                   115208
     C           RECI      IFEQ 'D'                                       115208
     C           AMTP      ANDEQ'SA'                                      115208
     C                     MOVE STAI      P#STAI                          115208
     C                     LEAVE                                          115208
     C                     ENDIF                                          115208
      *                                                                   115208
     C           WKLNR     REDPELOAMD                    92               115570
     C                     ENDDO                                          115208
      *                                                                   115208
      * Get next stop accrual amendment.                                  115208
     C           K#LM11    SETGTLOAMD                                     115208
     C           WKLNR     READELOAMD                    92               115570
     C           *IN92     DOWEQ*OFF                                      115208
      *                                                                   115208
     C           RECI      IFEQ 'D'                                       115208
     C           AMTP      ANDEQ'SA'                                      115208
     C                     MOVE STAI      N#STAI                          115208
     C                     LEAVE                                          115208
     C                     ENDIF                                          115208
      *                                                                   115208
     C           WKLNR     READELOAMD                    92               115570
     C                     ENDDO                                          115208
      *                                                                   115208
      * Check previous is not the same as entered.                        115208
     C           P#STAI    IFNE *BLANKS                                   115208
     C           P#STAI    COMP 'Y'                      79               115208
     C                     ELSE                                           115208
     C                     TESTB'3'       LONI           79
     C                     ENDIF                                          115208
      *
     C           *IN79     IFEQ '1'
     C           SSTPA     ANDEQ'Y'
     C                     MOVE '1'       *IN42
     C                     MOVEL'LEA0197' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
      *
     C           *IN79     IFEQ '0'
     C           SSTPA     ANDNE'Y'
     C                     MOVE '1'       *IN42
     C                     MOVEL'LEA1008' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
      *                                                                   115208
      * Check next is not the same as entered.                            115208
     C           *IN42     IFEQ '0'                                       115208
     C           N#STAI    IFNE *BLANKS                                   115208
     C           N#STAI    COMP 'Y'                      79               115208
      *                                                                   115208
     C           *IN79     IFEQ '1'                                       115208
     C           SSTPA     ANDEQ'Y'                                       115208
     C                     MOVE '1'       *IN42                           115208
     C                     MOVEL'LEA0197' ZAMSID                          115208
     C                     EXSR ZASNMS                                    115208
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF                                          115208
      *                                                                   115208
     C           *IN79     IFEQ '0'                                       115208
     C           SSTPA     ANDNE'Y'                                       115208
     C                     MOVE '1'       *IN42                           115208
     C                     MOVEL'LEA1008' ZAMSID                          115208
     C                     EXSR ZASNMS                                    115208
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF                                          115208
     C                     ENDIF                                          115208
     C                     ENDIF                                          115208
      *
     C                     ENDIF
      *
      **  Initialise funding info fields
      *
     C                     Z-ADD0         WFRAT  117
     C                     MOVE *BLANKS   WFSGN   1
     C                     MOVE *BLANKS   WIRCF   1
     C                     MOVE *BLANKS   WFRCF   1
      *
      **  If Analytical Accounting is available and loan amendment type
      **  is 'SC' and loan is directly funded, perform Spread Change
      **  processing
      *
     C************IN51     IFEQ '1'                                       126903
     C                     EXSR SRSCP
     C***********          ENDIF                                          126903
      *
      **  If Analytical Accounting is available and loan amendment type
      **  is 'BC' and loan is directly funded, perform Base Rate Code
      **  Change processing
      **  or Revenue Analysis is installed and loan amendment type        CDE002
      **  is 'BC', perform Base Rate Code Change processing               CDE002
      *
     C           BGN0ST    IFEQ 'Y'
     C           SATYP     ANDEQ'BC'
     C           WCFPRC    ANDNE*BLANKS
     C           CDE002    OREQ 'Y'                                       CDE002
     C           SATYP     ANDEQ'BC'                                      CDE002
     C                     EXSR SRBCP
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
      *
      ** Validate Default Participation Loan Type/Subtype
      ** if syndication indicator is ON
      *
     C           SYIN      IFEQ 'Y'
     C           SDFTP     ANDNE*BLANK
     C           SYIN      OREQ 'Y'
     C           SDFST     ANDNE*BLANK
      *
      ** VALIDATE DEFAULT PARTICIPATION LOAN TYPE
      *
     C           SDFTP     IFNE *BLANK
     C                     MOVELSDFTP     WTP1    1
     C           WTP1      IFNE 'H'
     C           WTP1      ANDNE'J'
     C           WTP1      ANDNE'K'
     C           WTP1      ANDNE'?'
     C                     MOVE '1'       *IN43
     C                     MOVEL'LEA1012' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
     C                     ENDIF
      *
      ** VALIDATE DEFAULT PARTICIPATION LOAN SUBTYPE
      *
     C           SDFST     IFNE *BLANK
     C           SDFTP     ANDEQ*BLANK
     C                     MOVELSDFST     WST1    1
     C           WST1      IFNE '?'
     C                     MOVE '1'       *IN44
     C                     MOVEL'LEA1013' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
     C                     ENDIF
      *
     C           *IN43     IFEQ '0'
     C           *IN44     ANDEQ'0'
     C                     MOVE LCLAS     PLNCL   4                                           256822
     C                     CALL 'AOLOANR0'
     C                     PARM '*BLANK  'PRTCD
     C                     PARM '*KEY    'POPTN
     C           SDFTP     PARM SDFTP     PLNTP   2
     C           SDFST     PARM SDFST     PLNST   2
     C                     PARM           PLNCL                                               256822
     C           SDLOAN    PARM SDLOAN    DSSDY
      *
     C           PRTCD     IFNE *BLANKS
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SDFTP
     C                     MOVE *BLANKS   SDFST
     C                     ELSE
     C                     MOVE '1'       *IN43
     C                     MOVE '1'       *IN44
     C                     MOVEL'LEA1014' ZAMSID
     C                     EXSR ZASNMS
      *                                                                   CAP061
      ** Check for error in batch, and end validation if one has          CAP061
      ** occurred.                                                        CAP061
      *                                                                   CAP061
     C           CAP061    IFEQ 'Y'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           CAP61E    ANDEQ'Y'                                       CAP061
     C                     GOTO CAP61V                                    CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                                       221924
     C           SSPI1     IFNE *BLANKS                                                       221924
     C           SATYP     ANDNE'PI'                                                          221924
     C           SSPI2     ORNE *BLANKS                                                       221924
     C           SATYP     ANDNE'PI'                                                          221924
     C           SSPI3     ORNE *BLANKS                                                       221924
     C           SATYP     ANDNE'PI'                                                          221924
     C                     MOVE *ON       *IN45                                               221924
     C                     MOVEL'LEA1105' ZAMSID                                              221924
     C                     EXSR ZASNMS                                                        221924
      *                                                                                       221924
      ** Check for error in batch, and end validation if one has                              221924
      ** occurred.                                                                            221924
      *                                                                                       221924
     C           CAP061    IFEQ 'Y'                                                           221924
     C           PMODE     ANDEQ'B'                                                           221924
     C           CAP61E    ANDEQ'Y'                                                           221924
     C                     GOTO CAP61V                                                        221924
     C                     ENDIF                                                              221924
     C                     ENDIF                                                              221924
      *                                                                   123857
      *  For Authorisation restore extended settlement valuse after       123857
      *  the chain to FCLTY                                               123857
      *                                                                   123857
     C           SACTN     IFEQ 'X'                                       123857
     C           *IN81     ANDEQ*ON                                       123857
     C                     EXSR SRREST                                    123857
     C                     ENDIF                                          123857
      *                                                                   123857
     C                     ENDIF                           SACTN NE A
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           AUTOC     ANDEQ'C'                                                           CLE134
      *                                                                                       CLE134
     C           SATYP     IFEQ 'BC'                                                          CLE134
     C           SATYP     OREQ 'PI'                                                          CLE134
     C           SATYP     OREQ 'SC'                                                          CLE134
      *                                                                                       CLE134
      ** Warning only if we have existing PDCLs on file                                       CLE134
      *                                                                                       CLE134
     C                     MOVE SLOAN     WKLN2                                               CLE134
     C           KLOAN     SETLLLEPDUED0                                                      CLE134
     C********** KLOAN     READELEPDUFD0               9999                          CLE134 AR314017
     C           KLOAN     READELEPDUED0               9999                                 AR314017
     C           *IN99     IFEQ *ON                                                           CLE134
     C********** KLOAN     SETLLLEPDUED0                                             CLE134 AR314017
     C           KLOAN     SETLLLEPDUFD0                                                    AR314017
     C           KLOAN     READELEPDUFD0               9999                                   CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           *IN99     IFEQ *OFF                                                          CLE134
     C                     MOVE '1'       *IN41                                               CLE134
     C                     MOVE 'Y'       WWERR                                               CLE134
     C                     Z-ADD1         W#CNT   10                                          CLE134
     C                     MOVEL'LER5582' ZAMSID                                              CLE134
     C                     EXSR ZASNMS                                                        CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** Check for error in batch, and end validation if one has                              CLE134
      ** occurred.                                                                            CLE134
      *                                                                                       CLE134
     C           CAP061    IFEQ 'Y'                                                           CLE134
     C           PMODE     ANDEQ'B'                                                           CLE134
     C           CAP61E    ANDEQ'Y'                                                           CLE134
     C                     GOTO CAP61V                                                        CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE134
      *                                                                   CAP061
      ** Tag to allow escape from vaidation if an error is found in       CAP061
      ** batch mode.                                                      CAP061
      *                                                                   CAP061
     C           CAP61V    TAG                                            CAP061
      *
     C                     ENDSR
      /EJECT
      *****************************************************************                     AR656363
      * SRPDCLPI Check if loan has FAMU N/Y                           *                     AR656363
      *****************************************************************                     AR656363
     C           PDCLPI    BEGSR                                                            AR656363
      *                                                                                     AR656363
      ** Proceed only if Amendment Type is PI and for Interest(Y) or Fee(Z)                 AR656363
      *                                                                                     AR656363
     C           SATYP     IFEQ 'PI'                                                        AR656363
     C           AUTOC     ANDEQ'C'                                                         AR656363
      *                                                                                     AR656363
     C           WLTYP     IFEQ 'Y'                                                         AR656363
     C           FAMU      ANDEQ'N'                                                         AR656363
     C           WLTYP     OREQ 'Z'                                                         AR656363
     C           FAMU      ANDEQ'N'                                                         AR656363
     C                     MOVE 'N'       WEXPO                                             AR656363
     C                     ENDIF                                                            AR656363
      *                                                                                     AR656363
     C                     ENDIF                                                            AR656363
      *                                                                                     AR656363
     C                     ENDSR                                                            AR656363
      *****************************************************************
      * SRTRAL  -  Update Loan Amendments Trailer File                *
      * Called by: Main routine                                       *
      * Calls    : GLZADD - Subr. to add an amount to the total       *
      *            GLZSUB - Subr. to subtract an amount to the total  *
      *****************************************************************
     C           SRTRAL    BEGSR
      *
      ** Update Loan Amendments Trailer, No action for amendments
      **   also needed for Principal Transfer amend                       193861
      *
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'R'
     C           SACTN     OREQ 'A'                                       193861
      *
     C                     MOVE '999999'  WKLNR
     C                     MOVE '99999'   WKVDT
     C                     MOVE '999'     WKLSN
      *
     C********** KLAKEY    CHAINLOAMS                79                                     AR870590
     C           KLAKEY    CHAINLOAMS                7901                                   AR870590
      *
     C           *IN79     IFEQ '1'
     C           *IN01     OREQ '1'                                                         AR870590
     C           *LOCK     IN   LDA
     C                     MOVEL'LOAMS   'DBFILE           ************
     C                     Z-ADD18        DBASE            * DBERR 18 *
     C                     MOVEL'999999'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C           SACTN     IFEQ 'A'                                       193861
     C**                                                                  193861
     C           SATYP     IFEQ 'PT'                                      193861
     C           SATYP     OREQ 'PF'                                      193861
     C           PRAM      SUB  WPRAM     PTDIFF 130                      193861
     C           PTDIFF    IFNE 0                                         193861
     C                     MOVE PTDIFF    ZZAMT                           193861
     C                     Z-ADDVRAF      ZZTOTI                          193861
     C                     Z-ADDVRAL      ZZTOTD                          193861
     C                     EXSR GLZADD                                    193861
     C                     Z-ADDZZTOTI    VRAF                            193861
     C                     Z-ADDZZTOTD    VRAL                            193861
     C                     Z-ADDVRRF      ZZTOTI                          193861
     C                     Z-ADDVRRL      ZZTOTD                          193861
     C                     EXSR GLZADD                                    193861
     C                     Z-ADDZZTOTI    VRRF                            193861
     C                     Z-ADDZZTOTD    VRRL                            193861
     C                     END                                            193861
     C                     END                                            193861
     C**                                                                  193861
      ** Action not Amend                                                 193861
     C                     ELSE                                           193861
     C**                                                                  193861
      *
      ** Action not Reversal
      *
     C           SACTN     IFNE 'R'
     C           NORE      ADD  1         NORE
     C           NINS      ADD  1         NINS
     C           NLRA      ADD  1         NLRA
      *
     C           SATYP     IFEQ 'PI'
     C           SATYP     OREQ 'PT'                                      123789
     C           SATYP     OREQ 'PF'                                      123789
     C           SATYP     IFEQ 'PI'                                      123789
     C                     MOVE WLAMT     ZZAMT
     C/COPY WNCPYSRC,LEH01131
     C                     ELSE                                           123789
     C                     MOVE WPAMTF    ZZAMT                           123789
     C                     ENDIF                                          123789
     C                     Z-ADDVRIF      ZZTOTI
     C                     Z-ADDVRIL      ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    VRIF
     C                     Z-ADDZZTOTD    VRIL
     C                     Z-ADDVRRF      ZZTOTI
     C                     Z-ADDVRRL      ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    VRRF
     C                     Z-ADDZZTOTD    VRRL
     C                     ENDIF
     C                     ELSE
      *
      ** Reverse action code
      *
      ** Need to use TAMT now, since we can reverse PDs                   180044
      *                                                                   180044
     C**********           MOVE PRAM      ZZAMT                           180044
     C                     MOVE TAMT      ZZAMT                           180044
     C           NDEL      ADD  1         NDEL
     C           NLRA      SUB  1         NLRA
      *
     C           SATYP     IFEQ 'PI'
     C           SATYP     OREQ 'PT'                                      123789
     C           SATYP     OREQ 'PF'                                      123789
     C           SATYP     OREQ 'PD'                                      180044
     C/COPY WNCPYSRC,LEH01132
     C                     Z-ADDVRDF      ZZTOTI
     C                     Z-ADDVRDL      ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    VRDF
     C                     Z-ADDZZTOTD    VRDL
     C                     Z-ADDVRRF      ZZTOTI
     C                     Z-ADDVRRL      ZZTOTD
     C                     EXSR GLZSUB
     C                     Z-ADDZZTOTI    VRRF
     C                     Z-ADDZZTOTD    VRRL
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                          193861
     C                     Z-ADDNATN      TNLU
      *
     C                     UPDATLOAMSZ1F
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRLTRX  -  Update Loan Transaction Index Detail (LTRIX)       *
      * Called by: Main routine                                       *
      * Calls    : None                                               *
      *****************************************************************
     C           SRLTRX    BEGSR
      *
      ** Update LTRIX if amendment type is PI, PT or PF only, and action
      ** is authorisation or reversal
      *
     C           SATYP     IFEQ 'PI'
     C           SACTN     ANDEQ'X'
     C           BPLMAU    ANDEQ'Y'
     C           SATYP     OREQ 'PI'
     C           SACTN     ANDEQ'I'
     C           BPLMAU    ANDEQ'N'
     C           SATYP     OREQ 'PI'                                      155570
     C           SACTN     ANDEQ'A'                                       155570
     C           BPLMAU    ANDEQ'N'                                       155570
      *
     C           SATYP     OREQ 'PT'
     C           SACTN     ANDEQ'X'
     C           BPTPAU    ANDEQ'Y'
     C           SATYP     OREQ 'PT'
     C           SACTN     ANDEQ'I'
     C           BPTPAU    ANDEQ'N'
     C           SATYP     OREQ 'PT'                                      155570
     C           SACTN     ANDEQ'A'                                       155570
     C           BPTPAU    ANDEQ'N'                                       155570
      *
     C           SATYP     OREQ 'PF'
     C           SACTN     ANDEQ'X'
     C           BPTPAU    ANDEQ'Y'
     C           SATYP     OREQ 'PF'
     C           SACTN     ANDEQ'I'
     C           BPTPAU    ANDEQ'N'
     C           SATYP     OREQ 'PF'                                      155570
     C           SACTN     ANDEQ'A'                                       155570
     C           BPTPAU    ANDEQ'N'                                       155570
      *
     C           SATYP     OREQ 'PI'
     C           SACTN     ANDEQ'R'
     C           BPLMAU    ANDEQ'Y'
     C           XUSR      ANDNE*BLANK
     C           SATYP     OREQ 'PI'
     C           SACTN     ANDEQ'R'
     C           BPLMAU    ANDEQ'N'
      *
     C           SATYP     OREQ 'PT'
     C           SACTN     ANDEQ'R'
     C           BPTPAU    ANDEQ'Y'
     C           XUSR      ANDNE*BLANK
     C           SATYP     OREQ 'PT'
     C           SACTN     ANDEQ'R'
     C           BPTPAU    ANDEQ'N'
      *
     C           SATYP     OREQ 'PF'
     C           SACTN     ANDEQ'R'
     C           BPTPAU    ANDEQ'Y'
     C           XUSR      ANDNE*BLANK
     C           SATYP     OREQ 'PF'
     C           SACTN     ANDEQ'R'
     C           BPTPAU    ANDEQ'N'
      *
     C           PMODE     OREQ 'B'                                       141464
     C           SATYP     ANDEQ'PI'                                      141464
     C           PMODE     OREQ 'B'                                       141464
     C           SATYP     ANDEQ'PF'                                      141464
     C           PIPTIN    ANDNE'T'                                       144096
     C           PMODE     OREQ 'B'                                       141464
     C           SATYP     ANDEQ'PT'                                      141464
     C           PIPTIN    ANDNE'T'                                       144096
      *                                                                   141464
     C**********           MOVE '1'       *IN17                                      186431 AR322732
     C**********           MOVE '0'       *IN79                                      186431 AR322732
      *                                                                   186431
     C********** *IN17     DOUEQ'0'                                                  186431 AR322732
     C********** RECI      ANDEQ*BLANK                                               186431 AR322732
     C********** *IN79     OREQ '1'                                                  186431 AR322732
      *                                                                   186431
     C**********           Z-ADD1         LXRRN   50                                        AR322732
      *
      ** Access LTRIX header
      *
     C********** LXRRN     CHAINLTRIX               N79                                     AR322732
      *
     C********** *IN79     IFEQ '0'                                                         AR322732
     C********** RECI      IFEQ 'H'                                                         AR322732
     C***********RRNA      ANDGTFLSZ                                      131971
     C********** RRNA      IFGT FLSZ                                                 131971 AR322732
     C**********           MOVE '1'       *INU8                                             AR322732
     C***********          MOVE '1'       *INLR                           131971
     C***********          RETRN                                          131971
     C**********           ENDIF                                                            AR322732
     C**********           ELSE                                                             AR322732
     C**********           MOVE *ON       *IN79                                      131971 AR322732
     C**********           ENDIF                                                     131971 AR322732
     C**********           ENDIF                                                     131971 AR322732
      *                                                                   131971
     C********** *IN79     IFEQ *ON                                                  131971 AR322732
     C********** *INU8     OREQ *ON                                                  131971 AR322732
     C********** *LOCK     IN   LDA                                                         AR322732
     C**********           MOVEL'LTRIX   'DBFILE           ************                     AR322732
     C**********           Z-ADD19        DBASE            * DBERR 19 *                     AR322732
     C**********           MOVELLXRRN     DBKEY            ************                     AR322732
     C**********           OUT  LDA                                                         AR322732
     C**********           EXSR *PSSR                                                       AR322732
     C**********           ENDIF                                                            AR322732
      *
     C**********           MOVE RRNA      LXRRN                                             AR322732
      *
     C********** LXRRN     CHAINLTRIX                79                   186431
     C********** LXRRN     CHAINLTRIX                7917                            186431 AR322732
      *                                                                   186431
     C********** *IN17     IFEQ '1'                                                  186431 AR322732
     C********** TXSTS     IFEQ 1218                                                 186431 AR322732
     C**********           UNLCKLTRIX                                                186431 AR322732
     C**********           EXSR CLEAR                                                186431 AR322732
     C**********           ELSE                                                      186431 AR322732
     C**********           MOVE '1'       *IN79                                      186431 AR322732
     C**********           ENDIF                                                     186431 AR322732
     C**********           ENDIF                                                     186431 AR322732
      *                                                                   186431
     C**********           ENDDO                                                     186431 AR322732
      *                                                                   186431
     C********** *IN79     IFEQ '1'                                                         AR322732
     C********** *LOCK     IN   LDA                                                         AR322732
     C**********           MOVEL'LTRIX   'DBFILE           ************                     AR322732
     C**********           Z-ADD20        DBASE            * DBERR 20 *                     AR322732
     C**********           MOVELLXRRN     DBKEY            ************                     AR322732
     C**********           OUT  LDA                                                         AR322732
     C**********           EXSR *PSSR                                                       AR322732
     C**********           ENDIF                                                            AR322732
      *
     C**********           Z-ADD0         PRI1                                              AR322732
     C                     Z-ADD0         PRI1    10                                        AR322732
      *
      ** Check settlement type
      *
     C***********PSTM      IFEQ 01                                        152678
     C***********PSTM      OREQ 02                                        152678
     C***********PSTM      OREQ 07                                        152678
     C***********PSTM      OREQ 08                                        152678
     C***********PSTM      OREQ 12                                        152678
      *                                                                                       CLE034
      ** Initialise Work Process Field, then add enhancement for CLE034.                      CLE034
      *                                                                                       CLE034
     C                     MOVE *BLANK    WPROC   1                                           CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
     C           PSNOS     ANDEQ'Y'                                                           CLE034
     C                     MOVEL'Y'       WPROC                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** If CLE034 is ON and STAL is 'N' or if CLE034 is OFF.                                 CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'N'                                                           CLE034
     C           CLE034    OREQ 'N'                                                           CLE034
     C           SETP      IFEQ 01                                        152678
     C           SETP      OREQ 02                                        152678
     C           SETP      OREQ 07                                        152678
     C           SETP      OREQ 08                                        152678
     C           SETP      OREQ 12                                        152678
     C                     MOVEL'Y'       WPROC                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** If Work process field is 'Y', do neccesary processing.                               CLE034
      *                                                                                       CLE034
     C           WPROC     IFEQ 'Y'                                                           CLE034
      *
      ** Obtain lowest telex notice days between loan & local CCY
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*BLANK  'PRTCD
     C                     PARM '*KEY    'POPTN
     C                     PARM SCURR     PCURR
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD21        DBASE            * DBERR 21 *
     C                     MOVELSCURR     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Default to local CCY for telex notice calculation
      *
     C                     Z-ADDTNOTL     ZNRDYS
     C                     Z-ADDRUND      ZDAYNO
     C                     MOVE LOCY      ZCCY
      *                                                                                       CLE034
      ** If CLE034 is ON and STAL is 'N' or if CLE034 is OFF.                                 CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'N'                                                           CLE034
     C           CLE034    OREQ 'N'                                                           CLE034
      *
      ** For settlement types 01, 07, & 08 use loan currency instead
      *
     C***********PSTM      IFEQ 01                                        152678
     C***********PSTM      OREQ 07                                        152678
     C***********PSTM      OREQ 08                                        152678
     C           SETP      IFEQ 01                                        152678
     C           SETP      OREQ 07                                        152678
     C           SETP      OREQ 08                                        152678
     C                     Z-ADDA6TXND    ZNRDYS
     C                     MOVE SCURR     ZCCY
     C                     ENDIF
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** If CLE034 is ON and STAL = 'Y'                                                       CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
     C                     Z-ADDA6TXND    ZNRDYS                                              CLE034
     C                     MOVE SCURR     ZCCY                                                CLE034
     C                     ENDIF                                                              CLE034
      *
     C                     EXSR ZFWDT
      *
     C           VDAYNO    IFLE ZDYNBR
     C           VDAYNO    IFGE RUND
     C                     Z-ADD1         PRI1
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                   158203
      * Interactive mode - if action is authorize and amendment           158203
      * status is complete, then for LTRIX purposes should be             158203
      * treated as an insert regardless of whether last change type       158203
      * is insert or amend, since it can never have been authorized       158203
      * previously (and hence never appeared on LTRIX)                    158203
     C                     MOVE *BLANK    CHTPSV                          158203
      *                                                                   158203
     C           SACTN     IFEQ 'X'                                       158203
     C           ASTS      ANDEQ'C'                                       158203
     C                     MOVE CHTP      CHTPSV  1                       158203
     C                     MOVE 'I'       CHTP                            158203
     C                     ENDIF                                          158203
      *                                                                   158203
      *
      ** Update LTRIX detail record
      *
     C                     Z-ADD0         RRNA    50                                        AR322732
     C                     EXCPTLTRIXD
      *
      ** Get header record
      *
     C**********           Z-ADD1         LXRRN                                             AR322732
     C********** LXRRN     CHAINLTRIX                79                                     AR322732
      *
     C********** *IN79     IFEQ '1'                                                         AR322732
     C********** *LOCK     IN   LDA                                                         AR322732
     C**********           MOVEL'LTRIX   'DBFILE           ************                     AR322732
     C**********           Z-ADD22        DBASE            * DBERR 22 *                     AR322732
     C**********           MOVELLXRRN     DBKEY            ************                     AR322732
     C**********           OUT  LDA                                                         AR322732
     C**********           EXSR *PSSR                                                       AR322732
     C**********           ENDIF                                                            AR322732
      *
      ** Update relevant control fields
      *
     C********** NORE      ADD  1         NORE                                              AR322732
     C********** RRNA      ADD  1         RRNA                                              AR322732
     C********** NLAR      ADD  1         NLAR                                              AR322732
      *
     C**********           EXCPTLTRIXH                                                      AR322732
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRCLON  -  Update Customer Loans Detail                       *
      * Called by: Main routine                                       *
      * Calls    : None                                               *
      *****************************************************************
     C           SRCLON    BEGSR
      *
      ** Update CLOAN file to unlink Loan to syndication and
      ** Consolidated confirmation
      *
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'R'
      *
     C                     MOVE SLOAN     WKLNR
     C                     MOVE 'A'       WRCDT
      *
     C           KLKEY     CHAINCLOAN                79
     C           *IN79     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'CLOAN   'DBFILE           ************
     C                     Z-ADD34        DBASE            * DBERR 34 *
     C                     MOVELSLOAN     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C***********LNKS      IFEQ 'Y'                                 123177153663
     C***********PMODE     IFNE 'B'                                 122141153663
     C***********P#TSEQ    ORLE 1                                   122141153663
     C***********          MOVE 'N'       LNKS                            153663
     C***********          ENDIF                                    122141153663
     C***********          ENDIF                                    123177153663
     C           BPCONR    IFEQ 'Y'
     C                     MOVE 'N'       CNCF
     C                     ELSE
     C                     MOVE *BLANK    CNCF
     C                     ENDIF
      *
     C                     UPDATCLOANCLF               79
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRFCLT  -  Update Faclity File                                *
      * Called by: Main routine                                       *
      * Calls    : FCLTSR - Evaluate Facility Exposure                *
      *****************************************************************
     C           SRFCLT    BEGSR
      *
     C                     MOVE 'N'       WPART   1
      *                                                                   143772
     C                     MOVE LPFI      WLPFI   1                       143772
      *
      ** Update Facility for type 'PI', for Insert and Reverse only
      *
     C           SACTN     IFEQ 'I'
     C           SATYP     ANDEQ'PI'
     C           SACTN     OREQ 'R'
     C           SATYP     ANDEQ'PI'
      *
     C           SACTN     IFEQ 'R'
     C                     MOVELFCUSC     WFCNM
     C                     MOVELFTYPC     WFACT
     C                     MOVELFSEQC     WFNUM
     C                     MOVE 'A'       WFRTP
      *
     C           KFCLT     CHAINFCLTY               N79
      *
     C           *IN79     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE           ************
     C                     Z-ADD24        DBASE            * DBERR 24 *
     C                     MOVELFCLKEY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM SCURR     PCURR
     C           SDCURR    PARM SDCURR    DSSDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD25        DBASE            * DBERR 25 *
     C                     MOVELSCURR     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     Z-ADDA6NBDP    CDPL    10
      *                                                                                       CLE023
      ** Save currency details.                                                               CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     MOVE PCURR     WCCYL                                               CLE023
     C                     Z-ADDA6SPRT    WSPRTL                                              CLE023
     C                     MOVE A6MDIN    WMDINL                                              CLE023
     C                     Z-ADDA6NBDP    WCDPL                                               CLE023
     C                     ENDIF                                                              CLE023
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM FCCY      PCURR
     C           SDCURR    PARM SDCURR    DSSDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD26        DBASE            * DBERR 26 *
     C                     MOVELFCCY      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     Z-ADDA6NBDP    CDPF    10
      *                                                                                       CLE023
      ** Save currency details.                                                               CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     MOVE PCURR     WCCYF                                               CLE023
     C                     Z-ADDA6SPRT    WSPRTF                                              CLE023
     C                     MOVE A6MDIN    WMDINF                                              CLE023
     C                     Z-ADDA6NBDP    WCDPF                                               CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF
      *
     C                     MOVELFCUSC     WFCNM
     C                     MOVELFTYPC     WFACT
     C                     MOVELFSEQC     WFNUM
     C                     MOVE 'B'       WFRTP
      *
     C           KFCLT     CHAINFCLTY                79
      *
     C           *IN79     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE           ************
     C                     Z-ADD27        DBASE            * DBERR 27 *
     C                     MOVELFCLKEY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           CLE134    IFEQ 'Y'                                                         AR656363
     C                     MOVE 'Y'       WEXPO                                             AR656363
     C                     EXSR PDCLPI                                                      AR656363
     C                     ENDIF                                                            AR656363
      *                                                                                     AR656363
     C                     EXSR FCLTSR
     C                     Z-ADDOAM       OAB
     C                     Z-ADDCAMD      OCAMD  130
      *
     C                     MOVE OAB       OAM
     C                     Z-ADDOCAMD     CAMD
     C                     Z-ADDRUND      LCD
     C                     MOVE 'A'       CHTP
     C                     Z-ADDNATN      TNLU
      *
     C                     UPDATFCLTYFNF               79
      *                                                                   CLE005
     C           TRCA      IFEQ 'TR'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C                     EXSR SRUPCA                                    CLE005
     C                     ENDIF                                          CLE005
      *
      ** Update also Participant's facility if a Particpant or Internal
      ** facility
      *
     C           WLPFI     IFNE *BLANK
     C           WLPFI     ANDNE'R'                                       142588
      *
     C                     MOVE 'Y'       WPART   1
     C***********          MOVELWPTFC     WFCNM                           143772
     C***********          MOVELWPTFT     WFACT                           143772
     C***********          MOVELWPTFN     WFNUM                           143772
     C                     MOVELPTFC      WFCNM                           143772
     C                     MOVELPTFT      WFACT                           143772
     C                     MOVELPTFN      WFNUM                           143772
     C                     MOVE 'A'       WFRTP
      *
     C           KFCLT     CHAINFCLTY               N79
      *
     C           *IN79     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE           ************
     C                     Z-ADD28        DBASE            * DBERR 28 *
     C                     MOVELFCLKEY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM FCCY      PCURR
     C           SDCURR    PARM SDCURR    DSSDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD29        DBASE            * DBERR 29 *
     C                     MOVELFCCY      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     Z-ADDA6NBDP    CDPF    10
      *                                                                                       CLE023
      ** Save currency details.                                                               CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     MOVE PCURR     WCCYF                                               CLE023
     C                     Z-ADDA6SPRT    WSPRTF                                              CLE023
     C                     MOVE A6MDIN    WMDINF                                              CLE023
     C                     Z-ADDA6NBDP    WCDPF                                               CLE023
     C                     ENDIF                                                              CLE023
      *
     C                     MOVE 'B'       WFRTP
     C           KFCLT     CHAINFCLTY                79
      *
     C           *IN79     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE           ************
     C                     Z-ADD30        DBASE            * DBERR 30 *
     C                     MOVELFCLKEY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           CLE134    IFEQ 'Y'                                                         AR656363
     C                     MOVE 'Y'       WEXPO                                             AR656363
     C                     EXSR PDCLPI                                                      AR656363
     C                     ENDIF                                                            AR656363
      *                                                                                     AR656363
     C                     EXSR FCLTSR
     C                     Z-ADDOAM       OAB
     C                     Z-ADDCAMD      OCAMD  130
      *
     C                     MOVE OAB       OAM
     C                     Z-ADDOCAMD     CAMD   130
     C                     Z-ADDRUND      LCD
     C                     MOVE 'A'       CHTP
     C                     Z-ADDNATN      TNLU
      *
     C                     UPDATFCLTYFNF               79
      *                                                                   CLE005
     C           TRCA      IFEQ 'TR'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C                     EXSR SRUPCA                                    CLE005
     C                     ENDIF                                          CLE005
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT                                                              CLE005
      *****************************************************************   CLE005
      * SRUPCA  -  Update of credit agreement/superfacility           *   CLE005
      * Called by: SRFCLT                                             *   CLE005
      * Calls    : FCLTSR                                             *   CLE005
      *****************************************************************   CLE005
     C           SRUPCA    BEGSR                                          CLE005
      *                                                                   CLE014
      ** Save the revolving credit indicator of the tranche               CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C                     MOVE RVCR      WRVCR   1                       CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE005
      ** Whenever the facility utilisation is updated for a tranche,      CLE005
      ** update the credit agreement/superfacility as well                CLE005
      *                                                                   CLE005
     C                     MOVE FCCY      WTCCY   3                       CLE005
     C                     MOVELCANM      WFCNM                           CLE005
     C                     MOVELCAFT      WFACT                           CLE005
     C                     MOVELCAFN      WFNUM                           CLE005
     C                     MOVE 'A'       WFRTP                           CLE005
      *                                                                   CLE005
     C                     MOVE CMDI      WCMDI   1                       CLE005
     C                     Z-ADDCAXR      WCAXR  138                      CLE005
      *                                                                   CLE005
     C           KFCLT     CHAINFCLTY               N79                   CLE005
      *                                                                   CLE005
     C           *IN79     IFEQ '1'                                       CLE005
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVEL'FCLTY   'DBFILE           ************   CLE005
     C                     Z-ADD31        DBASE            * DBERR 31 *   CLE005
     C                     MOVELFCLKEY    DBKEY            ************   CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     MOVE 'B'       WFRTP                           CLE005
     C           KFCLT     CHAINFCLTY                79                   CLE005
      *                                                                   CLE005
     C           *IN79     IFEQ '1'                                       CLE005
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVEL'FCLTY   'DBFILE           ************   CLE005
     C                     Z-ADD33        DBASE            * DBERR 33 *   CLE005
     C                     MOVELFCLKEY    DBKEY            ************   CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      ** If tranche and superfacility currencies are different, get       CLE005
      ** superfacility currency details                                   CLE005
      *                                                                   CLE005
     C           WTCCY     IFNE FCCY                                      CLE005
     C                     CALL 'AOCURRR0'                                CLE005
     C                     PARM *BLANKS   PRTCD                           CLE005
     C                     PARM '*KEY   ' POPTN                           CLE005
     C                     PARM FCCY      PCURR                           CLE005
     C           SDCURR    PARM SDCURR    DSSDY                           CLE005
     C           PRTCD     IFNE *BLANKS                                   CLE005
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVEL'SDCURRPD'DBFILE           ************   CLE005
     C                     Z-ADD32        DBASE            * DBERR 32 *   CLE005
     C                     MOVELFCCY      DBKEY            ************   CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
      *                                                                                       CLE023
      ** Save currency details and obtain the cross exchange rate.                            CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     MOVE WCCYF     ZCCYI                                               CLE023
     C                     Z-ADDWSPRTF    ZRATE1                                              CLE023
     C                     MOVE WMDINF    ZMDI1                                               CLE023
     C                     Z-ADDWCDPF     ZCDPI                                               CLE023
     C                     MOVE PCURR     ZCCYO                                               CLE023
     C                     Z-ADDA6SPRT    ZRATE2                                              CLE023
     C                     MOVE A6MDIN    ZMDI2                                               CLE023
     C                     MOVE A6NBDP    ZCDPO                                               CLE023
     C                     EXSR ZXRATE                                                        CLE023
     C                     Z-ADDZRATEX    ZEXCH                                               CLE023
     C                     MOVE ZMDIX     ZMD                                                 CLE023
     C                     ENDIF                                                              CLE023
      *                                                                   CLE005
      ** Convert facility amount to credit facility currency              CLE005
      *                                                                   CLE005
     C                     Z-ADDA6NBDP    CDPC    10                      CLE005
     C           CDPC      SUB  CDPF      CX                              CLE005
     C           CX        ADD  4         CX                              CLE005
     C           WCMDI     IFEQ 'D'                                       CLE005
     C********** WCAXR     DIV  POWR,CX   OFCXRT    H                                  CLE005 CLE023
     C           WCAXR     DIV  POWER,CX  OFCXRT    H                                  CLE005 CLE023
     C           1         DIV  OFCXRT    OFCXRT                          CLE005
     C                     ELSE                                           CLE005
     C********** WCAXR     MULT POWR,CX   OFCXRT    H                                  CLE005 CLE023
     C           WCAXR     MULT POWER,CX  OFCXRT    H                                  CLE005 CLE023
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C           SACTN     IFEQ 'I'                                       CLE005
     C           FCBAL     MULT OFCXRT    ILAAMF 130H                     CLE005
      *                                                                                       CLE023
      ** If CLE023 is ON convert amount using spot rate.                                      CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDWXAAMF    ZAMTCI                                              CLE023
     C                     EXSR ZCONV                                                         CLE023
     C                     Z-ADDZAMTCO    WXAAMF                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                          CLE005
     C           SACTN     IFEQ 'R'                                       CLE005
     C********** PRAM      MULT OFCXRT    ILAAMF    H                                  CLE005 201851
     C           FCBAL     MULT OFCXRT    ILAAMF    H                                         201851
      *                                                                                       CLE023
      ** If CLE023 is ON convert amount using spot rate.                                      CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDWXAAMF    ZAMTCI                                              CLE023
     C                     EXSR ZCONV                                                         CLE023
     C                     Z-ADDZAMTCO    WXAAMF                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE014
      ** Restore the revolving credit indicator                           CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           RVCR      ANDEQ'T'                                       CLE014
     C                     MOVE WRVCR     RVCR                            CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE005
      ** Update facility exposure and availability                        CLE005
      *                                                                   CLE005
     C                     MOVE 'Y'       WTRCA   1                       CLE005
      *                                                                                     AR656363
     C           CLE134    IFEQ 'Y'                                                         AR656363
     C                     MOVE 'Y'       WEXPO   1                                         AR656363
     C                     EXSR PDCLPI                                                      AR656363
     C                     ENDIF                                                            AR656363
      *                                                                                     AR656363
     C                     EXSR FCLTSR                                    CLE005
     C                     Z-ADDOAM       OAB                             CLE005
     C                     Z-ADDCAMD      OCAMD  130                      CLE005
      *                                                                   CLE005
     C                     MOVE OAB       OAM                             CLE005
     C                     Z-ADDOCAMD     CAMD   130                      CLE005
     C                     Z-ADDRUND      LCD                             CLE005
     C                     MOVE 'A'       CHTP                            CLE005
     C                     Z-ADDNATN      TNLU                            CLE005
      *                                                                   CLE005
     C                     UPDATFCLTYFNF               79                 CLE005
     C                     MOVE *BLANK    WTRCA                           CLE005
      *                                                                   CLE005
     C                     ENDSR                                          CLE005
      /EJECT
      *****************************************************************
      * SRSHAD  -  Retrieve parameter fields for Shadow Update        *
      * Called by: Main routine                                       *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSHAD    BEGSR
      *
     C                     MOVE RECI      SHRECI
     C                     MOVE LNRF      SHLNRF
     C                     Z-ADDVDAT      SHVDAT
     C                     Z-ADDLASN      SHLASN
     C                     MOVE PTYP      SHPTYP
     C                     MOVE AMTP      SHAMTP
     C                     Z-ADDRTSP      SHRTSP
     C                     MOVE CCY       SHCCY
     C                     Z-ADDPRAM      SHPRAM
     C                     MOVE BRCA      SHBRCA
     C                     Z-ADD0         SHREPT
     C                     MOVE OTIST     SHTIST
     C                     MOVE *BLANK    SHINTC
      *
     C                     MOVE OSBR      SHOSBR
     C                     MOVE CHTP      SHCHTP
      *                                                                                       CLE033
     C                     Z-ADDNATN      SHTNLU                                              CLE033
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE SCCY      SHSCCY                          CEU004
     C                     MOVE ICCY      SHICCY                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE SCCY      SHSCCY                                              CLE031
     C                     MOVE ICCY      SHICCY                                              CLE031
     C                     Z-ADDREXR      SHREXR                                              CLE031
     C                     MOVE REXI      SHREXI                                              CLE031
     C                     MOVE PSCY      SHPSCY                                              CLE031
     C                     Z-ADDPEXR      SHPEXR                                              CLE031
     C                     MOVE PEXI      SHPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE STAL      SHSTAL                                              CLE034
     C                     ENDIF                                                              CLE034
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRUSHD  -  Update Shadow Record                               *
      * Called by: Main routine                                       *
      * Calls    : None                                               *
      *****************************************************************
     C           SRUSHD    BEGSR
      *
      ** Do On-line updates
      *
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C           SACTN     OREQ 'R'
     C           AMTP      IFEQ 'PI'
      *                                                                   122960
     C           PMODE     IFEQ 'B'                                       122960
     C                     MOVE '*LEBTCH' ##RTCD                          122960
     C                     ELSE                                           122960
     C                     MOVE *BLANKS   ##RTCD                          122960
     C                     ENDIF                                          122960
      *
     C                     CALL 'AOOULAU0'
     C                     PARM           ##RTCD  7
     C                     PARM           Z#BSTS
     C                     PARM           Z#ASTS
     C                     PARM           Z#WSTS
     C                     PARM *BLANKS   PDCLI   1                                         MD023787
      *
     C           ##RTCD    IFEQ '*ERROR*'
     C           ##RTCD    OREQ '*RECLCK'                                                   AR868380
     C           *LOCK     IN   LDA                                       155106
     C                     MOVEL'AOOULAU0'DBFILE           ************   155106
     C                     Z-ADD38        DBASE            * DBERR 38 *   155106
     C                     MOVEL##RTCD    DBKEY            ************   155106
     C                     OUT  LDA                                       155106
     C                     EXSR *PSSR                                     155106
     C***********          MOVE '1'       *INU8                           155106
     C***********          MOVE '1'       *INU7                           155106
     C***********          MOVE *BLANK    WFMT                            155106
     C                     ENDIF
     C/COPY WNCPYSRC,LE2040C023
      *
     C                     ENDIF
      *                                                                                       201672
     C                     MOVELLNRF      OLNRF                                               201672
     C                     MOVELSHVDAT    OVDAT                                               201672
     C                     MOVELSHLASN    OLASN                                               201672
     C                     MOVELPRAM      OMPRAM                                              201672
     C                     CALL 'LE2041  '                                                    201672
     C**********           PARM           OLNRF   60                                   201672 CLE148
     C                     PARM           OLNRF   6                                           CLE148
     C                     PARM           OVDAT   50                                          201672
     C                     PARM           OLASN   30                                          201672
     C                     PARM           OMPRAM 130                                          201672
     C                     PARM           AMTP                                                201672
     C                     PARM           SACTN                                               201672
     C                     PARM *BLANKS   ##RTCD                                            AR868380
      *                                                                                     AR868380
     C           ##RTCD    IFEQ '*RECLCK'                                                   AR868380
     C                     EXSR *PSSR                                                       AR868380
     C                     ENDIF                                                            AR868380
     C                     ENDIF
      *
     C                     MOVE 'F0'      WFMT
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRLSPR  -  Loan Sub-Type Amendment Processing                 *
      * Called by: Main routine                                       *
      * Calls    : None                                               *
      *****************************************************************
     C           SRLSPR    BEGSR
      *
      **  Keep Original Loan Type for further reference.
      *
     C           *IN46     IFEQ '0'
     C                     MOVE *BLANKS   INLTYP  2
     C                     MOVE LTYPA     INLTYP
     C                     ENDIF
      *                                                                   115208
      * Get previous and next Sub-Type amendments.                        115208
      * If a previous sub-type exists, check that this is not equal to    115208
      * the entered sub-type; otherwise, the entered sub-type is checked  115208
      * against the original sub-type.                                    115208
      * In addition, the entered sub-type cannot be equal to the next     115208
      * sub-type, if this exists.                                         115208
     C                     MOVE *BLANKS   P#SUTP  2                       115208
     C                     MOVE *BLANKS   N#SUTP  2                       115208
      *                                                                   115208
     C                     MOVE SLOAN     WKLNR                           115570
     C                     MOVE VDAYNO    WKVDT                           115208
      *                                                                   115208
      * Get previous sub-type amendment.                                  115208
     C           K#LM11    SETLLLOAMD                                     115208
     C           WKLNR     REDPELOAMD                    92               115570
     C           *IN92     DOWEQ*OFF                                      115208
      *                                                                   115208
     C           RECI      IFEQ 'D'                                       115208
     C           AMTP      ANDEQ'LS'                                      115208
     C                     MOVE SUTP      P#SUTP                          115208
     C                     LEAVE                                          115208
     C                     ENDIF                                          115208
      *                                                                   115208
     C           WKLNR     REDPELOAMD                    92               115570
     C                     ENDDO                                          115208
      *                                                                   115208
      * Get next sub-type amendment.                                      115208
     C           K#LM11    SETGTLOAMD                                     115208
     C           WKLNR     READELOAMD                    92               115570
     C           *IN92     DOWEQ*OFF                                      115208
      *                                                                   115208
     C           RECI      IFEQ 'D'                                       115208
     C           AMTP      ANDEQ'LS'                                      115208
     C                     MOVE SUTP      N#SUTP                          115208
     C                     LEAVE                                          115208
     C                     ENDIF                                          115208
      *                                                                   115208
     C           WKLNR     READELOAMD                    92               115570
     C                     ENDDO                                          115208
      *                                                                   115208
     C           CAS009    IFEQ 'Y'                                                           CAS009
      *                                                                                       CAS009
     C                     MOVE LTYPA     ATCD    2                                           CAS009
     C                     MOVE SUTPA     AUCD    2                                           CAS009
     C                     MOVE LCLAS     PLNCL                                               256822
     C                     CALL 'AOLOANR0'                                                    CAS009
     C                     PARM '*BLANKS' PRTCD                                               CAS009
     C                     PARM '*KEY   ' POPTN                                               CAS009
     C                     PARM           ATCD                                                CAS009
     C                     PARM           AUCD                                                CAS009
     C                     PARM           PLNCL                                               256822
     C           SDLOAN    PARM SDLOAN    DSFDY                                               CAS009
     C           PRTCD     IFEQ *BLANKS                                                       CAS009
     C                     MOVE AYACAI    SVACAI  1                                           CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *
     C           PIMTYP    IFEQ 'LALS'                                                        256822
     C           PMODE     ANDEQ'B'                                                           256822
     C                     MOVE PILSTP    SSTYP                                               256822
     C                     ENDIF                                                              256822
      *                                                                                       256822
     C                     MOVE LTYPA     ATCD    2
     C                     MOVE SSTYP     AUCD    2
     C                     MOVE LCLAS     PLNCL                                               256822
     C                     CALL 'AOLOANR0'
     C                     PARM '*BLANKS' PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           ATCD
     C                     PARM           AUCD
     C                     PARM           PLNCL                                               256822
     C           SDLOAN    PARM SDLOAN    DSFDY
      *
     C           PRTCD     IFEQ *BLANKS
      *
      ** Loan type returned from call to AOLOANR0 must be the
      ** same as the original loan type and the loan sub-type must
      ** differ from the original loan sub-type.
     C           INLTYP    IFNE AYLNTY
     C           INLTYP    OREQ AYLNTY
     C           SUTPA     ANDEQAYLNST
     C           P#SUTP    ANDEQ*BLANKS                                   115208
      *                                                                   115208
     C           P#SUTP    OREQ AYLNST                                    115208
     C           P#SUTP    ANDNE*BLANKS                                   115208
      *                                                                   115208
     C           N#SUTP    OREQ AYLNST                                    115208
     C           N#SUTP    ANDNE*BLANKS                                   115208
     C                     MOVE '1'       *IN46
     C                     MOVEL'LEA0520' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           SVACAI    ANDNEAYACAI                                                        CAS009
      *                                                                                       232348
      ** Only process EIR cost accounting if loan's value date is same                        232348
      ** as or after the non-linear amortisation cut-off date.                                232348
      ** Loan's value date saved in VDATX in SRVALI.                                          232348
     C           VDATX     ANDGEFSNLAC                                                        232348
      *                                                                                       CAS009
     C                     MOVE '1'       *IN46                                               CAS009
     C**********           MOVEL'LEV1070' ZAMSID                                       CAS009 CAS011
     C                     MOVEL'LEV1075' ZAMSID                                              CAS011
     C                     EXSR ZASNMS                                                        CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE AYLNTY    LTYPA
     C                     MOVE AYLNST    SSTYP
      *
      ** IF LOAN PROCESSING TYPE IS 61 AND NEW PROCESSING TYPE IS 62
      ** VALIDATE MATURITY DATE.
      *
     C           PTYPA     IFEQ 61
     C           AYLNPT    ANDEQ62
     C           PTYPA     OREQ 68
     C           AYLNPT    ANDEQ62
     C           CLE005    ANDEQ'Y'
     C           PTYPA     OREQ 69                                        CLE005
     C           AYLNPT    ANDEQ62                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
      *
      **  NEW MATURITY DATE MUST NOT BE BLANKS.
      *
     C           SMDAT     IFEQ *BLANKS
     C           SMDAT     OREQ *ZEROS
     C                     MOVE '1'       *IN47
     C                     MOVEL'LEA0521' ZAMSID
     C                     EXSR ZASNMS
      *
     C                     ELSE
      *
     C                     MOVE SMDAT     ZDATE
     C                     EXSR ZDATE1
      *
      **  NEW MATURITY DATE MUST BE LATER THAN START DATE
      **  NEW MATURITY DATE MUST BE LATER THAN OR EQUAL TO RUN DATE
      *
     C           ZDAYNO    IFLT RUND
     C/COPY WNCPYSRC,LE2040C029
     C           ZDAYNO    ORLE VDATX
     C                     MOVE '1'       *IN47
     C                     MOVEL'LEA0129' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** NEW MATURITY DATE MUST BE LATER THAN NEXT INTEREST DATE
      *
     C           ZDAYNO    IFLE NIDT
     C                     MOVE '1'       *IN47
     C                     MOVEL'LEA0111' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** IF MATURITY SETTLEMENT TYPE IS ENTERED AND IS 01,07 OR 08
      ** MUST NOT BE A LOAN CURRENCY HOLIDAY
      *
     C           MDST      IFNE *ZEROS
      *                                                                                       CLE034
      ** Enhancement for CLE034                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           WSOLD     IFEQ 'Y'                                                           CLE034
     C                     MOVEAPPCCY     ACUR                                                CLE034
     C                     MOVEAPPLOC     ALOC                                                CLE034
     C                     ELSE                                                               CLE034
     C                     MOVEAPRCCY     ACUR                                                CLE034
     C                     MOVEAPRLOC     ALOC                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE *ON       *IN97                                               CLE034
     C                     MOVEAACUR      WACUR  60                                           CLE034
     C           WACUR     IFEQ *BLANKS                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE LOCY      ACUR,1                                              CLE034
     C                     MOVE BJSLCD    ALOC,1                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C           MDST      IFEQ 01
     C           MDST      OREQ 07
     C           MDST      OREQ 08
      *                                                                   CEU004
     C                     MOVE *ON       *IN97                                               CLE034
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           SCCY      ANDNE*BLANK                                    CEU004
     C**********           MOVE SCCY      ZCCY                                         CEU004 CLE034
     C                     MOVE SCCY      ACUR,1                                              CLE034
     C                     ELSE                                           CEU004
     C**********           MOVE SCURR     ZCCY                                                CLE034
     C                     MOVE SCURR     ACUR,1                                              CLE034
     C                     ENDIF                                          CEU004
      *                                                                                       CLE034
      ** Set the first member of Array of locations to Local Currency.                        CLE034
      *                                                                                       CLE034
     C                     MOVE LOCY      ALOC,1                                              CLE034
      *                                                                   CEU004
     C                     ELSE
      *
      ** IF MATURITY SETTLEMENT TYPE IS ENTERED AND IS NOT 01,07 OR 08
      ** MUST NOT BE A LOCAL CURRENCY HOLIDAY
      *
     C**********           MOVE LOCY      ZCCY                                                CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE LOCY      ACUR,1                                              CLE034
     C                     MOVE BJSLCD    ALOC,1                                              CLE034
     C                     ENDIF
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD1         WX      20                                          CLE034
     C           WX        DOWLE20                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE ACUR,WX   ZCCY                                                CLE034
     C                     MOVE ALOC,WX   ZLOC                                                CLE034
     C           ZCCY      IFNE *BLANKS                                                       CLE034
     C                     EXSR ZCHKH
      *
      ** IF DATE IS A HOLIDAY DISPLAY WARNING ERRORS
      *
     C           ZIND      IFEQ 'H'
     C           ZCCY      IFEQ SCURR
     C                     MOVE '1'       *IN47
     C                     MOVE 'Y'       WWERR
     C***********          MOVEL'LEA1027' ZAMSID                          CEU004
     C***********          MOVEL'LEA1040' ZAMSID                   CEU004 189827
     C                     MOVEL'LEA1027' ZAMSID                          189827
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR
     C                     ELSE
     C**********           MOVE '1'       *IN47                                               CLE034
     C                     MOVE *ON       *IN48                                               CLE034
     C                     MOVE 'Y'       WWERR
     C                     MOVEL'LEA1028' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CLE034
      ** Increment counter                                                                    CLE034
      *                                                                                       CLE034
     C           WX        ADD  1         WX                                                  CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
     C                     ENDIF                                                              CLE034
      *
      **  Maturity date of loan must not be before the value date of
      **  any loan amendments input against former call loan.
      *
      **  Save original loan number and value date.
      **  Only setup access to LOAMS if value date is valid.
      *
     C           *IN47     IFEQ '0'
     C**********           MOVELLNRF      WRK60   60                                          CLE148
     C                     MOVELLNRF      WRK60   6                                           CLE148
      *
      **  Set up key for LOAMS to detect any Loan Amendments Value-Dated
      **  after the input maturity date of the loan.
      *
     C                     MOVELLNRF      WKLNR
     C                     MOVE ZDAYNO    WKVDT
     C                     Z-ADD0         WKLSN
      *
     C           KLAKEY    SETLLLOAMS
      *
      **  If a record is found on LOAMS with a loan number equal to
      **  the input loan number, then it is an error.
      *
      ** It is not sufficant that a record is there, it must also be
      ** live. If it is not, check whether any other records apply
      *
     C                     READ LOAMS               N    79
     C           *IN79     DOWEQ'0'
     C           LNRF      ANDEQWRK60
     C           RECI      IFEQ 'D'
     C                     MOVE '1'       *IN47
     C                     MOVEL'LEA0525' ZAMSID
     C                     EXSR ZASNMS
     C                     LEAVE
     C                     ELSE
     C                     READ LOAMS               N    79
     C                     ENDIF
     C                     ENDDO
      *
      **  Restore the original value to LNRF and SETOF *IN92.
     C                     MOVELWRK60     LNRF
     C                     ENDIF
     C                     ENDIF
      *
      ** IF NOT CHANGING A LOAN FROM CALL TO TERM, IS IT VICE VERSA ?
      *
     C                     ELSE
      *
      ** IF LOAN PROCESSING TYPE IS 62 AND NEW PROCESSING TYPE IS 61
      *
     C           PTYPA     IFEQ 62
     C           AYLNPT    ANDEQ61
     C           PTYPA     OREQ 62
     C           AYLNPT    ANDEQ68
     C           CLE005    ANDEQ'Y'
     C           PTYPA     OREQ 62                                        CLE005
     C           AYLNPT    ANDEQ69                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
      *
      ** NEW MATURITY DATE MUST BE BLANK FOR CHANGE TO CALL LOAN
      *
     C           SMDAT     IFEQ '      '
     C           SMDAT     OREQ '000000'
      *
      ** REMOVE RESTRICTION PREVENTING CHANGE TO CALL LOAN IF ROLLOVER    140817
     C***********RLDT      IFNE 0                                         140817
     C***********          MOVE '1'       *IN47                           140817
     C***********          MOVEL'LEA0519' ZAMSID                          140817
     C***********          EXSR ZASNMS                                    140817
     C***********          ENDIF                                          140817
      *
     C                     ELSE
     C                     MOVE '1'       *IN47
     C                     MOVEL'LEA0524' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     ELSE
      *
      ** IF NOT CHANGING FROM PROCESSING TYPE 61 TO 62 OR VICE
      ** VERSA OLD AND NEW PROCESSING TYPE MUST BE THE SAME
     C           PTYPA     IFEQ AYLNPT
      *
     C                     MOVE SMDAT     ZDATE
     C                     EXSR ZDATE1
      *
      ** IF NOT CHANGING PROCESSING TYPE, AND LOAN IS A DISCOUNT
      ** LOAN, MATURITY DATE MUST NOT BE CHANGED.
      *
     C           PTYPA     IFEQ 63
     C           PTYPA     OREQ 65
     C           PTYPA     OREQ 67
     C           CLE005    OREQ 'Y'                                       CLE005
     C           PTYPA     ANDEQ72                                        CLE005
     C           WSPTYP    ANDEQ67                                        CLE005
     C           ZDAYNO    IFNE MDAT
     C                     MOVE '1'       *IN47
     C                     MOVEL'LEA0218' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** IF NOT CHANGING PROCESSING TYPE, AND LOAN IS A TERM
      ** PARTICIPATION SOLD, NEW MATURITY DATE MUST NOT BE LATER THAN
      ** ORIGINAL LOAN'S MATURITY DATE.
     C           PTYPA     IFEQ 66
     C           PTYPA     OREQ 69
     C           CLE005    ANDEQ'Y'
     C           CLE005    OREQ 'Y'                                       CLE005
     C           PTYPA     ANDEQ72                                        CLE005
     C           WSPTYP    ANDEQ66                                        CLE005
     C           CLE005    OREQ 'Y'                                       CLE005
     C           PTYPA     ANDEQ72                                        CLE005
     C           WSPTYP    ANDEQ69                                        CLE005
      *
      **  OBTAIN MATURITY DATE OF LOAN THAT THIS PARTICIPATION IS
      **  LINKED TO. SAVE RELEVENT FIELDS FROM THE INPUT LOAN FOR
      **  FURTHER REFERENCE.
      **  FIELD FLG1 IS USED TO INDICATE WHETHER THERE HAS BEEN A
      **  CHAIN TO CLOAN TO OBTAIN THE MATURITY DATE OF THE
      **  RELEVANT PARTICIPATION SOLD.
      *
     C           FLG1      IFEQ ' '
     C**********           MOVE SLOAN     IILNO   60                                          CSD027
     C**********           MOVE FCUSC     IFCUS   60                                          CSD027
     C                     MOVE SLOAN     IILNO   6                                           CSD027
     C                     MOVE FCUSC     IFCUS   6                                           CSD027
     C                     MOVE FTYPC     IFTYP   30
     C                     MOVE FSEQC     IFSEQ   20
     C                     MOVE PTYPA     IPTYP   2
     C                     MOVE LTYPA     ILTYP   2
     C                     MOVE SUTPA     ISUTP   2
     C                     MOVE CCYD      ICCYD   3
     C                     Z-ADDLCDA      ILCDA   50
     C                     MOVE CHTPA     ICHTPA  1
     C                     Z-ADDTNLUA     ITNLUA  50
     C**********           Z-ADDOLNO      IOLNO   60                                          CSD027
     C                     MOVE OLNO      IOLNO   6                                           CSD027
     C                     Z-ADDMDAT      WMDAT   50
      *
     C                     MOVELOLNO      WKLNR
     C                     MOVE 'A'       WRCDT
     C           KLKEY     CHAINCLOAN               N79
      *
     C           *IN79     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'CLOANCL 'DBFILE           ************
     C                     Z-ADD23        DBASE            * DBERR 23 *
     C                     MOVELOLNO      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ELSE
     C                     Z-ADDMDAT      MDTPRT  50
     C                     MOVE 'Y'       FLG1    1
     C                     ENDIF
     C                     ENDIF
      *
     C           ZDAYNO    IFGT MDTPRT
     C                     MOVE '1'       *IN47
     C                     MOVEL'LEA0218' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      **  REINSTATE NECESSARY FIELDS FROM FIRST CLOAN RECORD FOR
      **  FURTHER PROCESSING.
      *
     C                     MOVE IILNO     SLOAN
     C                     MOVE IFCUS     FCUSC
     C                     MOVE IFTYP     FTYPC
     C                     MOVE IFSEQ     FSEQC
     C                     MOVE IPTYP     PTYPA
     C                     MOVE ILTYP     LTYPA
     C                     MOVE ISUTP     SUTPA
     C                     MOVE ICCYD     CCYD
     C                     Z-ADDILCDA     LCDA
     C                     MOVE ICHTPA    CHTPA
     C                     Z-ADDITNLUA    TNLUA
     C**********           Z-ADDIOLNO     OLNO                                                CSD027
     C                     MOVE IOLNO     OLNO                                                CSD027
     C                     Z-ADDWMDAT     MDAT
     C                     MOVELSLOAN     WKLNR                           158200
      *
     C                     ENDIF
      *
      ** IF NOT CHANGING PROCESSING TYPE, INPUT MATURITY DATE
      ** MUST BE ZERO IF LOAN IS A CALL LOAN.
      *
     C           AYLNPT    IFEQ 61
     C           AYLNPT    OREQ 68
     C           CLE005    ANDEQ'Y'
     C           AYLNPT    OREQ 69                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           SMDAT     IFNE *BLANKS
     C           SMDAT     ANDNE*ZEROS
     C                     MOVE '1'       *IN47
     C                     MOVEL'LEA0524' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ELSE
      *
      ** NEW MATURITY DATE MUST NOT BE EARLIER THAN OLD MATURITY
      ** DATE.
      *
     C           FLG1      IFNE 'Y'
     C                     Z-ADDMDAT      WMDAT   50
     C                     ENDIF
     C           ZDAYNO    IFLT WMDAT
     C                     MOVE '1'       *IN47
     C                     MOVEL'LEA1019' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** MATURITY DATE MUST BE EQUAL TO OR LATER THAN RUN DATE
      *
     C           ZDAYNO    IFLT RUND
     C/COPY WNCPYSRC,LE2040C030
     C                     MOVE '1'       *IN47
     C                     MOVEL'LEA0129' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** ELSE PTYP CHANGE IS INVALID (I.E. NOT FROM 61 TO 62  OR
      ** VICE VERSA).
      *
     C                     ELSE
     C                     MOVE '1'       *IN46
     C                     MOVEL'LEA0523' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C/COPY WNCPYSRC,LEH00545
      ** IF NEW LOAN IS NOT A CALL LOAN, ENSURE THAT NEW MATURITY
      ** DATE OF LOAN DOES NOT EXCEED EXPIRY DATE OF FACILITY.
      *
     C           AYLNPT    IFNE 61
     C           CLE005    ANDNE'Y'
     C           AYLNPT    ORNE 61
     C           AYLNPT    ANDNE68
     C           CLE005    ANDEQ'Y'
     C                     MOVELFCUSC     WFCNM
     C                     MOVE FTYPC     WFACT
     C                     MOVELFSEQC     WFNUM
     C                     MOVE 'A'       WFRTP
      *
     C           KFCLT     CHAINFCLTY               N79
      *
     C                     Z-ADDDTEX      FCDTEX  50
     C           ZDAYNO    IFGT FCDTEX
     C                     MOVE '1'       *IN47
     C                     MOVEL'LEA0234' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                                              CAS009
     C                     ENDIF
      *
      ** IF NO ERRORS LSMD CHANGED TO IMDAT
      *
     C           *IN47     IFEQ '0'
     C           AYLNPT    IFNE 61
     C           CLE005    ANDNE'Y'
     C           AYLNPT    ORNE 61
     C           AYLNPT    ANDNE68
     C           CLE005    ANDEQ'Y'
     C                     Z-ADDZDAYNO    LSMD
     C                     ELSE
     C           AYLNPT    IFEQ 61
     C           AYLNPT    OREQ 68
     C           CLE005    ANDEQ'Y'
     C                     Z-ADD0         LSMD
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** ELSE AMENDMENT NOT VALID
      *
     C                     ELSE
     C                     MOVE '1'       *IN46
     C                     MOVEL'LEA0520' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                                       262461
      ** If AUTO settle is 'C', PDCL loan type/subtype must be defined                        262461
      *                                                                                      262461A
     C           CLE134    IFEQ 'Y'                                                           262461
     C                     MOVELLTYPA     WLTYP   1                                          262461A
      *                                                                                      262461A
     C           AUTOC     IFEQ 'C'                                                           262461
     C           WLTYP     ANDNE'X'                                                          262461A
     C           WLTYP     ANDNE'Y'                                                          262461A
     C           WLTYP     ANDNE'Z'                                                          262461A
      *                                                                                      262461A
     C           AYPPLT    IFEQ *BLANKS                                                       262461
     C           AYPPLS    OREQ *BLANKS                                                       262461
     C           AYIPLT    OREQ *BLANKS                                                       262461
     C           AYIPLS    OREQ *BLANKS                                                       262461
     C                     MOVE '1'       *IN46                                               262461
     C                     MOVEL'LER5573' ZAMSID                                              262461
     C                     EXSR ZASNMS                                                        262461
     C                     ENDIF                                                              262461
     C                     ENDIF                                                              262461
      *                                                                                       262461
     C                     ENDIF                                                              262461
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * FCLTSR  -  Evaluate Facility Exposure                         *
      * Called by: Main routine                                       *
      * Calls    : QFCLTY - Update Exposure Array                     *
      *****************************************************************
     C           FCLTSR    BEGSR                           ***  FCLTSR ***
      *
      ** Converts amounts in facility currency equivalent
      *
     C           WTRCA     IFEQ *BLANK                                    CLE005
     C           CDPF      SUB  CDPL      CX      10
     C           CX        ADD  4         CX
     C           FMDI      COMP 'D'                      92
     C******92** FCXR      DIV  POWR,CX   OFCXRT    H                                         CLE023
     C           *IN92     IFEQ '1'                                                           CLE023
     C           FCXR      DIV  POWER,CX  OFCXRT    H                                         CLE023
     C                     ENDIF                                                              CLE023
     C      92   1         DIV  OFCXRT    OFCXRT
     C*****N92** FCXR      MULT POWR,CX   OFCXRT 159H                                         CLE023
     C           *IN92     IFEQ '0'                                                           CLE023
     C           FCXR      MULT POWER,CX  OFCXRT 159H                                         CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
      ** If CLE023 is ON, get cross rate of currencies spot.                                  CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDWSPRTL    ZRATE1 138                                          CLE023
     C                     MOVE WMDINL    ZMDI1   1                                           CLE023
     C                     Z-ADDWSPRTF    ZRATE2 138                                          CLE023
     C                     MOVE WMDINF    ZMDI2   1                                           CLE023
     C                     EXSR ZXRATE                                                        CLE023
     C                     MOVE WCCYL     ZCCYI                                               CLE023
     C                     MOVE WCCYF     ZCCYO                                               CLE023
     C                     MOVE WCDPL     ZCDPI                                               CLE023
     C                     MOVE WCDPF     ZCDPO                                               CLE023
     C                     Z-ADDZRATEX    ZEXCH                                               CLE023
     C                     MOVE ZMDIX     ZMD                                                 CLE023
     C                     ENDIF                                                              CLE023
      *
     C           SACTN     IFEQ 'I'
     C           WLAMT     MULT OFCXRT    ILAAMF 130H
      *                                                                                       CLE023
      ** If CLE023 is ON convert amounts using spot rate.                                     CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDWLAMT     ZAMTCI                                              CLE023
     C                     EXSR ZCONV                                                         CLE023
     C                     Z-ADDZAMTCO    WXAAMF 130                                          CLE023
      *                                                                                       CLE023
      ** If rollover date is less than or equal to the value date of                          CLE023
      ** the amendment and there is a rollover of facility exchange                           CLE023
      ** rate, use the new facility exchange rate defined.                                    CLE023
      *                                                                                       CLE023
     C           RLDT      IFLT BJRDNB                                                        CLE023
     C           RLDT      ANDNE0                                                             CLE023
     C           NFCE      ANDNE0                                                             CLE023
     C           NCCY      ANDEQ*BLANKS                                                       CLE023
     C           NFMD      IFEQ 'D'                                                           CLE023
     C********** WLAMT     DIV  NFCE      ILAAMF    H                                  CLE023 203795
     C           NFCE      DIV  POWER,CX  WNFCE  159H                                         203795
     C           1         DIV  WNFCE     WNFCE                                               203795
     C                     ELSE                                                               CLE023
     C********** WLAMT     MULT NFCE      ILAAMF    H                                  CLE023 203795
     C           NFCE      MULT POWER,CX  WNFCE     H                                         203795
     C                     ENDIF                                                              CLE023
     C           WLAMT     MULT WNFCE     ILAAMF    H                                         203795
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF
     C           SACTN     IFEQ 'R'
     C           PRAM      MULT OFCXRT    ILAAMF    H
      *                                                                                       CLE023
      ** If CLE023 is ON convert amount using spot rate.                                      CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDPRAM      ZAMTCI                                              CLE023
     C                     EXSR ZCONV                                                         CLE023
     C                     Z-ADDZAMTCO    WXAAMF                                              CLE023
      *                                                                                       CLE023
      ** If rollover date is less than or equal to the value date of                          CLE023
      ** the amendment and there is a rollover of facility exchange                           CLE023
      ** rate, use the new facility exchange rate defined.                                    CLE023
      *                                                                                       CLE023
     C           RLDT      IFLT BJRDNB                                                        CLE023
     C           RLDT      ANDNE0                                                             CLE023
     C           NFCE      ANDNE0                                                             CLE023
     C           NCCY      ANDEQ*BLANKS                                                       CLE023
     C           NFMD      IFEQ 'D'                                                           CLE023
     C********** PRAM      DIV  NFCE      ILAAMF    H                                  CLE023 203795
     C           NFCE      DIV  POWER,CX  WNFCE     H                                         203795
     C                     ELSE                                                               CLE023
     C********** PRAM      MULT NFCE      ILAAMF    H                                  CLE023 203795
     C           NFCE      MULT POWER,CX  WNFCE     H                                         203795
     C                     ENDIF                                                              CLE023
     C           PRAM      MULT WNFCE     ILAAMF    H                                         203795
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF
     C                     ENDIF                                          CLE005
      *                                                                   122685
      ** Set up a flag for parts sold                                     122685
      *                                                                   122685
     C                     MOVE *BLANK    WSOLD   1                       122685
     C           PTYPA     IFEQ 66                                        122685
     C           PTYPA     OREQ 67                                        122685
     C           PTYPA     OREQ 69                                        122685
     C           CLE005    ANDEQ'Y'                                       122685
     C           PTYPA     OREQ 72                                        122685
     C           CLE005    ANDEQ'Y'                                       122685
     C                     MOVE 'Y'       WSOLD                           122685
     C                     ENDIF                                          122685
      *                                                                   143071
      ** Set up a flag for parts purchased and save original borrower     143071
      *                                                                   143071
     C                     MOVE *BLANK    WPURC   1                       143071
     C           PTYPA     IFEQ 64                                        143071
     C           PTYPA     OREQ 65                                        143071
     C           PTYPA     OREQ 68                                        143071
     C           CLE005    ANDEQ'Y'                                       143071
     C           PTYPA     OREQ 71                                        143071
     C           CLE005    ANDEQ'Y'                                       143071
     C                     MOVE 'Y'       WPURC                           143071
     C**********           MOVE OLNO      WOLNO   60                                   143071 CSD027
     C                     MOVE OLNO      WOLNO   6                                           CSD027
     C                     ENDIF                                          143071
      *
      ** Set up fields for value date updating
      ** Also update availability of a prime facility without recourse    122685
      *
     C                     Z-ADDVDAYNO    DAYNO   50
     C           SACTN     IFEQ 'I'
     C           WSOLD     IFEQ *BLANK                                    122685
     C           WLPFI     ANDEQ*BLANK                                    122685
     C           WPART     OREQ 'Y'                                       122685
     C                     MOVE '0'       *IN93
     C                     ELSE                                           122685
     C                     MOVE '1'       *IN93                           122685
     C                     ENDIF                                          122685
     C                     ENDIF
     C           SACTN     IFEQ 'R'
     C           WSOLD     IFEQ *BLANK                                    122685
     C           WLPFI     ANDEQ*BLANK                                    122685
     C           WPART     OREQ 'Y'                                       122685
     C                     MOVE '1'       *IN93
     C                     ELSE                                           122685
     C                     MOVE '0'       *IN93                           122685
     C                     ENDIF                                          122685
     C                     ENDIF
      *                                                                                     AR656363
     C           CLE134    IFEQ 'Y'                                                         AR656363
     C           WEXPO     ANDEQ'Y'                                                         AR656363
     C           CLE134    OREQ 'N'                                                         AR656363
     C                     Z-ADDILAAMF    FCBAL  130
     C                     ELSE                                                             AR656363
     C                     Z-ADD0         FCBAL                                             AR656363
     C                     Z-ADD0         ILAAMF                                            AR656363
     C                     Z-ADD0         WXAAMF                                            AR656363
     C                     ENDIF                                                            AR656363
      *
     C           WPART     IFEQ 'Y'
     C           WLPFI     OREQ *BLANK
     C           WSOLD     ANDEQ'Y'                                       122685
     C           RCSIC     ANDNE'Y'                                       122685
     C           CLE023    ANDEQ'N'                                                           CLE023
     C           WLPFI     OREQ *BLANK                                    122685
     C           WSOLD     ANDEQ*BLANK                                    122685
     C***********WLPFI     ORNE *BLANK                             122685 143772
     C***********WPART     ANDEQ'N'                                122685 143772
     C***********RCSIC     ANDNE'Y'                                122685 143772
     C                     EXSR QFCLTY
     C                     ENDIF
      *
      ** Reverse exposure update procedure for:
      ** Prime facility - if Participant is Internal (for Parts Purch)
      ** or participant is parts sold
      ** Participant facility - for Parts Sold
      ** Update prime facility only when recourse N, like a part sold     122685
      ** Internal and funding participants should be updated like a       122685
      ** normal loan                                                      122685
      ** Non-syndicated loans would be updated as they currently are      122685
      *
     C           VDAYNO    IFLE RUND
     C           PTYPA     IFEQ 66
     C           WLPFI     ANDEQ*BLANK
     C           PTYPA     OREQ 69
     C           WLPFI     ANDEQ*BLANK
     C           CLE005    ANDEQ'Y'
     C           PTYPA     OREQ 67
     C           WLPFI     ANDEQ*BLANK
     C           CLE005    OREQ 'Y'                                       CLE005
     C           WLPFI     ANDEQ*BLANK                                    CLE005
     C           PTYPA     ANDEQ72                                        CLE005
     C           WSPTYP    ANDEQ66                                        CLE005
     C           CLE005    OREQ 'Y'                                       CLE005
     C           WLPFI     ANDEQ*BLANK                                    CLE005
     C           PTYPA     ANDEQ72                                        CLE005
     C           WSPTYP    ANDEQ67                                        CLE005
     C           CLE005    OREQ 'Y'                                       CLE005
     C           WLPFI     ANDEQ*BLANK                                    CLE005
     C           PTYPA     ANDEQ72                                        CLE005
     C           WSPTYP    ANDEQ69                                        CLE005
      *
     C           WPART     OREQ 'N'
     C           WLPFI     ANDEQ'I'
     C           PTYPA     ANDEQ64
     C           WPART     OREQ 'N'
     C           WLPFI     ANDEQ'I'
     C           PTYPA     ANDEQ65
      *
     C           WPART     OREQ 'N'
     C           WLPFI     ANDEQ'P'
     C           PTYPA     ANDEQ66
     C           WPART     OREQ 'N'
     C           WLPFI     ANDEQ'P'
     C           PTYPA     ANDEQ69
     C           CLE005    ANDEQ'Y'
     C           WPART     OREQ 'N'
     C           WLPFI     ANDEQ'P'
     C           PTYPA     ANDEQ67
     C           CLE005    OREQ 'Y'                                       CLE005
     C           WPART     ANDEQ'N'                                       CLE005
     C           WLPFI     ANDEQ'P'                                       CLE005
     C           PTYPA     ANDEQ72                                        CLE005
     C           WSPTYP    ANDEQ66                                        CLE005
     C           CLE005    OREQ 'Y'                                       CLE005
     C           WPART     ANDEQ'N'                                       CLE005
     C           WLPFI     ANDEQ'P'                                       CLE005
     C           PTYPA     ANDEQ72                                        CLE005
     C           WSPTYP    ANDEQ67                                        CLE005
     C           CLE005    OREQ 'Y'                                       CLE005
     C           WPART     ANDEQ'N'                                       CLE005
     C           WLPFI     ANDEQ'P'                                       CLE005
     C           PTYPA     ANDEQ72                                        CLE005
     C           WSPTYP    ANDEQ69                                        CLE005
      *
     C           PTYPA     IFEQ 66
     C           RCSIC     ANDNE'Y'
     C           WLPFI     ANDEQ*BLANK                                    122685
     C           PTYPA     OREQ 67
     C           RCSIC     ANDNE'Y'
     C           WLPFI     ANDEQ*BLANK                                    122685
     C           PTYPA     OREQ 69
     C           RCSIC     ANDNE'Y'
     C           WLPFI     ANDEQ*BLANK                                    122685
     C           CLE005    ANDEQ'Y'
     C           CLE005    OREQ 'Y'                                       CLE005
     C           RCSIC     ANDNE'Y'                                       CLE005
     C           PTYPA     ANDEQ72                                        CLE005
     C           WSPTYP    ANDEQ66                                        CLE005
     C           WLPFI     ANDEQ*BLANK                                    122685
     C           CLE005    OREQ 'Y'                                       CLE005
     C           RCSIC     ANDNE'Y'                                       CLE005
     C           PTYPA     ANDEQ72                                        CLE005
     C           WSPTYP    ANDEQ67                                        CLE005
     C           WLPFI     ANDEQ*BLANK                                    122685
     C           CLE005    OREQ 'Y'                                       CLE005
     C           RCSIC     ANDNE'Y'                                       CLE005
     C           PTYPA     ANDEQ72                                        CLE005
     C           WSPTYP    ANDEQ69                                        CLE005
     C           WLPFI     ANDEQ*BLANK                                    CLE005
     C***********PTYPA     OREQ 64                                        143772
     C***********RCSIC     ANDNE'Y'                                122685 143772
     C***********PTYPA     OREQ 65                                        143772
     C***********RCSIC     ANDNE'Y'                                122685 143772
     C           PTYPA     OREQ 66                                        122685
     C           RCSIC     ANDNE'Y'                                       122685
     C           WLPFI     ANDEQ'P'                                       122685
     C           WPART     ANDEQ'N'                                       122685
     C           PTYPA     OREQ 67                                        122685
     C           RCSIC     ANDNE'Y'                                       122685
     C           WLPFI     ANDEQ'P'                                       122685
     C           WPART     ANDEQ'N'                                       122685
     C           PTYPA     OREQ 69                                        122685
     C           CLE005    ANDEQ'Y'                                       122685
     C           RCSIC     ANDNE'Y'                                       122685
     C           WLPFI     ANDEQ'P'                                       122685
     C           WPART     ANDEQ'N'                                       122685
     C           PTYPA     OREQ 72                                        122685
     C           CLE005    ANDEQ'Y'                                       122685
     C           RCSIC     ANDNE'Y'                                       122685
     C           WLPFI     ANDEQ'P'                                       122685
     C           WPART     ANDEQ'N'                                       122685
      *                                                                   122685
     C           SACTN     IFEQ 'I'
     C           CLE023    ANDEQ'N'                                                           CLE023
     C           CAMD      SUB  ILAAMF    CAMD
     C                     ENDIF
     C           SACTN     IFEQ 'R'
     C           CLE023    ANDEQ'N'                                                           CLE023
     C           CAMD      ADD  ILAAMF    CAMD
     C                     ENDIF
      *                                                                                       CLE023
      ** If CLE023 is ON, update Current Exposure based on spot rate.                         CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           SACTN     IFEQ 'I'                                                           CLE023
     C           CEXP      SUB  WXAAMF    CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
     C           SACTN     IFEQ 'R'                                                           CLE023
     C           CEXP      ADD  WXAAMF    CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                   CLE009
      ** If CLE009 is installed, set Work Regeneration Indicator to       CLE009
      ** changed                                                          CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     MOVE 'C'       WKSWRI  1                       CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF
      *
     C                     ELSE
      *
     C           PTYPA     IFEQ 66
     C***********RCSIC     ANDNE'Y'                                       122685
     C           PTYPA     OREQ 67
     C***********RCSIC     ANDNE'Y'                                       122685
     C           PTYPA     OREQ 69
     C***********RCSIC     ANDNE'Y'                                       122685
     C           CLE005    ANDEQ'Y'
     C           CLE005    OREQ 'Y'                                       CLE005
     C           RCSIC     ANDNE'Y'                                       CLE005
     C           PTYPA     ANDEQ72                                        CLE005
     C           WSPTYP    ANDEQ66                                        CLE005
     C           CLE005    OREQ 'Y'                                       CLE005
     C           RCSIC     ANDNE'Y'                                       CLE005
     C           PTYPA     ANDEQ72                                        CLE005
     C           WSPTYP    ANDEQ67                                        CLE005
     C           CLE005    OREQ 'Y'                                       CLE005
     C           RCSIC     ANDNE'Y'                                       CLE005
     C           PTYPA     ANDEQ72                                        CLE005
     C           WSPTYP    ANDEQ69                                        CLE005
     C           PTYPA     ORNE 66
     C           PTYPA     ANDNE67
     C           PTYPA     ANDNE69
     C           PTYPA     ANDNE72
     C           SACTN     IFEQ 'I'
     C           CAMD      ADD  ILAAMF    CAMD
     C                     ENDIF
     C           SACTN     IFEQ 'R'
     C           CAMD      SUB  ILAAMF    CAMD
     C                     ENDIF
      *                                                                                       CLE023
      ** If CLE023 is ON, update Current Exposure based on spot rate.                         CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           SACTN     IFEQ 'I'                                                           CLE023
     C           CEXP      ADD  WXAAMF    CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
     C           SACTN     IFEQ 'R'                                                           CLE023
     C           CEXP      SUB  WXAAMF    CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                   CLE009
      ** If CLE009 is installed, set Work Regeneration Indicator to       CLE009
      ** changed                                                          CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     MOVE 'C'       WKSWRI  1                       CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *
      ** Also update availability of a prime facility without recourse    122685
      *                                                                   122685
     C           RVCR      IFEQ 'Y'
     C                     Z-ADDMDAT      DAYNO          92
     C           SACTN     IFEQ 'I'
     C           WSOLD     IFEQ *BLANK                                    122685
     C           WLPFI     ANDEQ*BLANK                                    122685
     C           WPART     OREQ 'Y'                                       122685
     C                     MOVE '1'       *IN93
     C                     ELSE                                           122685
     C                     MOVE '0'       *IN93                           122685
     C                     ENDIF                                          122685
     C                     ENDIF
     C           SACTN     IFEQ 'R'
     C           WSOLD     IFEQ *BLANK                                    122685
     C           WLPFI     ANDEQ*BLANK                                    122685
     C           WPART     OREQ 'Y'                                       122685
     C                     MOVE '0'       *IN93
     C                     ELSE                                           122685
     C                     MOVE '1'       *IN93                           122685
     C                     ENDIF                                          122685
     C                     ENDIF
     C                     Z-ADDILAAMF    FCBAL
     C           *IN92     IFEQ '0'
     C           WPART     IFEQ 'Y'
     C           WLPFI     OREQ *BLANK
     C           WSOLD     ANDEQ'Y'                                       122685
     C           RCSIC     ANDNE'Y'                                       122685
     C           CLE023    ANDEQ'N'                                                           CLE023
     C           WLPFI     OREQ *BLANK                                    122685
     C           WSOLD     ANDEQ*BLANK                                    122685
     C***********WLPFI     ORNE *BLANK                             122685 143772
     C***********WPART     ANDEQ'N'                                122685 143772
     C***********RCSIC     ANDNE'Y'                                122685 143772
     C                     EXSR QFCLTY
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C           ENDFAC    ENDSR                           ***  ENDFAC ***
      *
      *****************************************************************   157303
      /EJECT                                                              157303
      *****************************************************************   157303
      *                                                               *   157303
      *  FCLTAM - Subroutine to verify facility amendments            *   157303
      *                                                               *   157303
      *  Called by: SRVALF                                            *   157303
      *  Calls    : None                                              *   157303
      *                                                               *   157303
      *****************************************************************   157303
      *                                                                   157303
     C           FCLTAM    BEGSR                                          157303
      *                                                                   157303
      ** Move drawn facility amount array to work array WOAM              157303
      *                                                                   157303
     C                     MOVEAOAM       WOAM                            157303
      *                                                                   157303
      ** Read live facility amendments file                               157303
      *                                                                   157303
     C           KEYFLA    SETLLLEFCAML6                                  157303
     C           KEYFLA    READELEFCAML6                 77               157303
      *                                                                   157303
     C           *IN77     DOWEQ*OFF                                      157303
      *                                                                   157303
      ** Verify amendment against the 10-day facility amount              157303
      ** projection. Deduct (facility increase) or  add (facility         157303
      ** decrease) amendment amount to facility drawn amount (ex.WOAM)    157303
      ** starting from the nearest projected date (ex. RUN1)              157303
      ** as compared to amendment value date.                             157303
      *                                                                   157303
     C                     Z-ADD1         A       20                      157303
     C           VLDT      LOKUPRUN,A                78  78               157303
      *                                                                   157303
     C           *IN78     DOWEQ*ON                                       157303
     C           A         ANDLT11                                        157303
     C                     SELEC                                          157303
     C           FATP      WHEQ 'FI'                                      157303
     C                     SUB  AAMT      WOAM,A                          157303
     C           FATP      WHEQ 'FD'                                      157303
     C                     ADD  AAMT      WOAM,A                          157303
     C                     ENDSL                                          157303
     C                     ADD  1         A                               157303
     C                     ENDDO                                          157303
      *                                                                   157303
     C           KEYFLA    READELEFCAML6                 77               157303
     C                     ENDDO                                          157303
      *                                                                   157303
     C                     ENDSR                                          157303
      *                                                                   157303
      /EJECT
      *****************************************************************
      * SRSETL  -  Set Up Data Received from SD2400                   *
      * Called by: Main routine                                       *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSETL    BEGSR
      *
      ** Terminate program if database error returned
      *
     C           PMTERM    IFEQ 'E'
     C           *LOCK     IN   LDA
     C                     MOVELPMDBFL    DBFILE           ************
     C                     MOVE PMDBSE    DBASE            * DBERR XX *
     C                     MOVELPMDBKY    DBKEY            ************
     C                     MOVELPMDPGM    DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF                           E1
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           WSOLD     IFEQ 'Y'                                       CEU004
     C                     MOVE PMRSCY    WSCCY   3                       CEU004
     C                     ELSE                                           CEU004
     C                     MOVE PMPSCY    WSCCY                           CEU004
     C                     ENDIF                                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           WSOLD     IFEQ 'Y'                                                           CLE031
     C                     MOVE PMREXI    REXI                                                CLE031
     C                     MOVE *BLANKS   WSCCY                                               CLE031
     C                     MOVE *BLANKS   PSCRF                                               CLE031
     C                     MOVE PMRSCY    SCCY                                                CLE031
      *                                                                                       CLE031
     C                     Z-ADD0         WSEXR0 130                                          CLE031
     C                     Z-ADD0         WSEXR8 138                                          CLE031
     C                     Z-ADD8         PNDEC                                               CLE031
     C                     Z-ADD5         PNDIG                                               CLE031
     C                     MOVE PMREXR    PSCRF                                               CLE031
      *                                                                                       CLE031
     C           PMREXR    IFNE *BLANKS                                                       CLE031
     C                     CALL 'ZALIGN'                                                      CLE031
     C                     PARM *BLANK    PRTCD                                               CLE031
     C                     PARM           PSCRF  16                                           CLE031
     C                     PARM           PNDEC   10                                          CLE031
     C                     PARM           PNDIG   20                                          CLE031
     C                     PARM *BLANKS   PRVAL  16                                           CLE031
      *                                                                                       CLE031
     C           PRTCD     IFEQ *BLANK                                                        CLE031
     C                     MOVE PRVAL     PMREXR                                              CLE031
     C                     ELSE                                                               CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'ZALIGN  'DBFILE                                              CLE031
     C                     Z-ADD30        DBASE                                               CLE031
     C                     MOVELPSCRF     DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE PMPEXI    PEXI                                                CLE031
     C                     MOVE *BLANKS   WSCCY                                               CLE031
     C                     MOVE *BLANKS   PSCRF                                               CLE031
     C                     MOVE PMPSCY    PSCY                                                CLE031
      *                                                                                       CLE031
     C                     Z-ADD0         WSEXR0 130                                          CLE031
     C                     Z-ADD0         WSEXR8 138                                          CLE031
     C                     Z-ADD8         PNDEC                                               CLE031
     C                     Z-ADD5         PNDIG                                               CLE031
     C                     MOVE PMPEXR    PSCRF                                               CLE031
      *                                                                                       CLE031
     C           PMPEXR    IFNE *BLANKS                                                       CLE031
     C                     CALL 'ZALIGN'                                                      CLE031
     C                     PARM *BLANK    PRTCD                                               CLE031
     C                     PARM           PSCRF  16                                           CLE031
     C                     PARM           PNDEC   10                                          CLE031
     C                     PARM           PNDIG   20                                          CLE031
     C                     PARM *BLANKS   PRVAL  16                                           CLE031
      *                                                                                       CLE031
     C           PRTCD     IFEQ *BLANK                                                        CLE031
     C                     MOVE PRVAL     PMPEXR                                              CLE031
     C                     ELSE                                                               CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'ZALIGN  'DBFILE                                              CLE031
     C                     Z-ADD30        DBASE                                               CLE031
     C                     MOVELPSCRF     DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      **                                                                                      CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *
      ** FOR INSERT/AMEND SET UP FIELDS TO BE OUTPUT TO FILE
      *
     C           SACTN     IFEQ 'I'                        B1
     C           SACTN     OREQ 'A'
     C           SACTN     OREQ 'R'                                       186706
      *
      ** SET UP SETTLEMENT METHOD FOR OUTPUT TO FILE
      *
     C           WSOLD     IFEQ 'Y'                                       163973
     C                     MOVELPMRSTM    ISETP                           163973
     C                     MOVE PMRSTM    TYPE                            163973
     C                     ELSE                                           163973
     C                     MOVELPMPSTM    ISETP   2        **2
     C                     MOVELPMPSTM    TYPE             **2
     C                     ENDIF                                          163973
      *
      ** SET UP OUR NOSTRO DETAILS FOR OUTPUT TO FILE
      *
     C           WSOLD     IFEQ 'Y'                                       163973
     C                     MOVELPMRONS    OTOURS                          163973
     C                     MOVELPMRONS    OURS                            163973
     C                     MOVELPMRONS    IOSAC                           163973
     C                     ELSE                                           163973
     C                     MOVELPMPONS    OTOURS           **2
     C                     MOVELPMPONS    OURS
     C                     MOVELPMPONS    IOSAC  12
     C                     ENDIF                                          163973
      *
      ** SET UP THEIR INSTRUCTIONS FOR OUTPUT TO FILE
      *
     C                     MOVELPAPIBN    ITSEN  10        **2
     C                     MOVELPAPIBN    THRS
      *                                                                   163973
     C           WSOLD     IFEQ 'Y'                                       163973
     C                     MOVELPMROBR    OOSBR                           163973
     C                     MOVELPMROBR    IOSBR                           163973
     C                     ELSE                                           163973
     C                     MOVELPMPOBR    OOSBR   3
     C                     MOVELPMPOBR    IOSBR   3
     C                     ENDIF                                          163973
      *
      ** SET UP FOR A/C OF AND SPECIAL INSTRUCTIONS FOR OUTPUT TO FILE
      *
     C                     MOVELPABENN    OTFACO
     C                     MOVELPABENN    IFACO  10
      *
     C                     ENDIF
      *
      ***Numeric*fields*should*be*updated*as*zero**********************                    AR548031A
      ***if*returned*as*blank******************************************                    AR548031A
      **********                                                                           AR548031A
     C********** PAROBN    IFEQ *BLANKS                                                    AR548031A
     C**********           MOVE *ZEROS    PAROBN                                           AR548031A
     C**********           ENDIF                                                           AR548031A
     C********** PAROCN    IFEQ *BLANKS                                                    AR548031A
     C**********           MOVE *ZEROS    PAROCN                                           AR548031A
     C**********           ENDIF                                                           AR548031A
     C********** PAPOBN    IFEQ *BLANKS                                                    AR548031A
     C**********           MOVE *ZEROS    PAPOBN                                           AR548031A
     C**********           ENDIF                                                           AR548031A
     C********** PAPOCN    IFEQ *BLANKS                                                    AR548031A
     C**********           MOVE *ZEROS    PAPOCN                                           AR548031A
     C**********           ENDIF                                                           AR548031A
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRAVAL  -  Additional Validation Dependent on Settlement Ins. *
      * Called by: Main routine                                       *
      * Calls    : None                                               *
      *****************************************************************
     C           SRAVAL    BEGSR
      *                                                                                       CLE034
      ** Restructure SR/SRAVAL for CLE034.                                                    CLE034
      *                                                                                       CLE034
      **********                                                                              CLE034
      ***Check*that value date is not a holiday in the deal / local CCY                       CLE034
      **********                                                                              CLE034
     C********** TYPE      IFNE '00'                                                          CLE034
      **********                                                                              CLE034
     C**********           Z-ADDVDAYNO    ZDAYNO                                              CLE034
     C**********           MOVE OOSBR     W@BRCA                                              CLE034
      **********                                                                              CLE034
      ***Find*DRS location of a branch                                                        CLE034
      **********                                                                              CLE034
     C**********           MOVE W@BRCA    W@BRCA  3                                           CLE034
     C********** W@BRCA    IFNE A8BRCD                                                        CLE034
     C***********          CALL 'AOBRCHR0'                                121783
     C**********           CALL 'AOBRCHR1'                                             121783 CLE034
     C**********           PARM *BLANKS   PRTCD                                               CLE034
     C**********           PARM '*KEY   ' POPTN                                               CLE034
     C**********           PARM W@BRCA    PBRCA   3                                           CLE034
     C********** SDBRCH    PARM SDBRCH    DSSDY                                               CLE034
     C**********           ENDIF                                                              CLE034
      **********                                                                              CLE034
     C********** PRTCD     IFEQ *BLANKS                                                       CLE034
     C**********           MOVE A8LCCD    ZLOC                                                CLE034
     C**********           ELSE                                                               CLE034
     C**********           MOVE *BLANKS   ZLOC                                                CLE034
     C**********           ENDIF                                                              CLE034
      **********                                                                              CLE034
      ***Find*currency to use                                                                 CLE034
      **********                                                                              CLE034
     C********** TYPE      IFEQ '01'                                                          CLE034
     C********** TYPE      OREQ '07'                                                          CLE034
     C********** TYPE      OREQ '08'                                                          CLE034
      **********                                                                       CEU004 CLE034
     C********** CEU004    IFEQ 'Y'                                                    CEU004 CLE034
     C********** WSCCY     ANDNE*BLANK                                                 CEU004 CLE034
     C**********           MOVE WSCCY     ZCCY                                         CEU004 CLE034
     C**********           ELSE                                                        CEU004 CLE034
     C**********           MOVE SCURR     ZCCY                                                CLE034
     C**********           ENDIF                                                       CEU004 CLE034
      **********                                                                       CEU004 CLE034
     C**********           ELSE                                                               CLE034
     C**********           MOVE LOCY      ZCCY                                                CLE034
     C**********           ENDIF                                                              CLE034
      **********                                                                              CLE034
      ***If*date is holiday send warning messages                                             CLE034
      **********                                                                              CLE034
     C**********           Z-ADD0         ZNRDYS                                              CLE034
     C**********           EXSR ZCHKH                                                         CLE034
     C********** TYPE      IFEQ '01'                                                          CLE034
     C********** TYPE      OREQ '07'                                                          CLE034
     C********** TYPE      OREQ '08'                                                          CLE034
     C********** ZIND      IFEQ 'H'                                                           CLE034
     C**********           MOVE 'Y'       WWERR                                               CLE034
     C**********           MOVE *ON       *IN48                                        123857 CLE034
     C***********          MOVEL'LEA1025' ZAMSID                          CEU004
     C***********          MOVEL'LEA1039' ZAMSID                   CEU004 189827
     C**********           MOVEL'LEA1025' ZAMSID                                       189827 CLE034
     C**********           EXSR ZASNMS                                                        CLE034
     C**********           MOVE *BLANK    WWERR                                               CLE034
     C**********           ENDIF                                                              CLE034
     C**********           ELSE                                                               CLE034
     C********** ZIND      IFEQ 'H'                                                           CLE034
     C**********           MOVE *ON       *IN48                                        123857 CLE034
     C**********           MOVE 'Y'       WWERR                                               CLE034
     C**********           MOVEL'LEA1026' ZAMSID                                              CLE034
     C**********           EXSR ZASNMS                                                        CLE034
     C**********           MOVE *BLANK    WWERR                                               CLE034
     C**********           ENDIF                                                              CLE034
     C**********           ENDIF                                                              CLE034
     C**********           ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           TYPE      IFNE '00'                                                          CLE034
     C           CLE034    ANDEQ'N'                                                           CLE034
     C           TYPE      ORNE '00'                                                          CLE034
     C           CLE034    ANDEQ'Y'                                                           CLE034
     C           STAL      ANDNE'Y'                                                           CLE034
     C           CLE034    OREQ 'Y'                                                           CLE034
     C           STAL      ANDEQ'Y'                                                           CLE034
     C           PNDET     ANDNE'Y'                                                           CLE034
      *                                                                                       CLE034
      ** Set ZDAYNO to VDAYNO                                                                 CLE034
      *                                                                                       CLE034
     C                     Z-ADDVDAYNO    ZDAYNO                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           WSOLD     IFEQ 'Y'                                                           CLE034
     C                     MOVEAPRCCY     ACUR                                                CLE034
     C                     MOVEAPRLOC     ALOC                                                CLE034
     C                     ELSE                                                               CLE034
     C                     MOVEAPPCCY     ACUR                                                CLE034
     C                     MOVEAPPLOC     ALOC                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE *ON       *IN97                                               CLE034
     C                     MOVEAACUR      WACUR                                               CLE034
     C           WACUR     IFEQ *BLANKS                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE BJSLCD    ALOC,1                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
      ** Find currency to use                                                                 CLE034
      *                                                                                       CLE034
     C           TYPE      IFEQ '01'                                                          CLE034
     C           TYPE      OREQ '07'                                                          CLE034
     C           TYPE      OREQ '08'                                                          CLE034
      *                                                                                       CLE034
     C                     MOVE *ON       *IN97                                               CLE034
     C           CEU004    IFEQ 'Y'                                                           CLE034
     C           WSCCY     ANDNE*BLANK                                                        CLE034
     C                     MOVE WSCCY     ZCCY                                                CLE034
     C                     MOVE WSCCY     ACUR,1                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE SCURR     ACUR,1                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           OOSBR     IFNE A8BRCD                                                        CLE034
     C                     CALL 'AOBRCHR1'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM '*KEY   ' POPTN                                               CLE034
     C                     PARM OOSBR     PBRCA   3                                           CLE034
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CLE034
      *                                                                                       CLE034
     C           PRTCD     IFEQ *BLANKS                                                       CLE034
     C                     MOVE A8LCCD    ALOC,1                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANKS   ALOC,1                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE BJSLCD    ALOC,1                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Initialise holiday field.                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE *BLANK    WHDAY   1                                           CLE034
      *                                                                                       CLE034
      ** If CLE034 is off or CLE034 is on but Settlement allocation is                        CLE034
      ** not 'Y'.                                                                             CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'N'                                                           CLE034
     C           CLE034    OREQ 'Y'                                                           CLE034
     C           SSTAL     ANDNE'Y'                                                           CLE034
      *                                                                                       CLE034
     C           TYPE      IFEQ '01'                                                          CLE034
     C           TYPE      OREQ '07'                                                          CLE034
     C           TYPE      OREQ '08'                                                          CLE034
     C                     MOVE 'Y'       WHDAY                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** If CLE034 is on and Settlement allocation is 'Y'                                     CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
     C           PSNOS     IFEQ 'Y'                                                           CLE034
     C                     MOVE 'Y'       WHDAY                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD1         WX      20                                          CLE034
     C           WX        DOWLE20                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE ACUR,WX   ZCCY                                                CLE034
     C                     MOVE ALOC,WX   ZLOC                                                CLE034
     C           ZCCY      IFNE *BLANKS                                                       CLE034
      *                                                                                       CLE034
     C                     Z-ADD0         ZNRDYS                                              CLE034
     C                     EXSR ZCHKH                                                         CLE034
      *                                                                                       CLE034
      ** If WHDAY = 'Y'                                                                       CLE034
      *                                                                                       CLE034
     C           WHDAY     IFEQ 'Y'                                                           CLE034
      *                                                                                       CLE034
     C           ZIND      IFEQ 'H'                                                           CLE034
     C                     MOVEL'Y'       WWERR                                               CLE034
     C                     MOVE *ON       *IN48                                               CLE034
     C                     MOVEL'LEA1025' ZAMSID                                              CLE034
     C                     EXSR ZASNMS                                                        CLE034
     C                     MOVE *BLANK    WWERR                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** If WHDAY <> 'Y'                                                                      CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C           ZIND      IFEQ 'H'                                                           CLE034
     C                     MOVEL'Y'       WWERR                                               CLE034
     C                     MOVE *ON       *IN48                                               CLE034
     C                     MOVEL'LEA1026' ZAMSID                                              CLE034
     C                     EXSR ZASNMS                                                        CLE034
     C                     MOVE *BLANK    WWERR                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Increment counter                                                                    CLE034
      *                                                                                       CLE034
     C           WX        ADD  1         WX                                                  CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * QFCLTY  -  Update Exposure Array                              *
      * Called by: Main routine                                       *
      * Calls    : None                                               *
      *****************************************************************
      *
     C           QFCLTY    BEGSR                           ***  QFCLTY ***
      *
     C           DAYNO     IFNE 0
      *
     C                     Z-ADD1         Z       20
     C           DAYNO     LOKUPRUN,Z                92  92
     C  N92                GOTO ENDFCT
     C           LOOPZ1    TAG                             ***  LOOPZ1 ***
     C           Z         COMP 11                     92
      * Don't update beyond the expiry date                               169232
     C           *IN92     IFEQ *ON                                       169232
     C           RUN,Z     ANDGEDTEX                                      169232
     C                     GOTO ENDFCT                                    169232
     C                     ENDIF                                          169232
     C  N92                GOTO ENDFCT
     C***********PTYPA     IFNE 66                                        122685
     C***********PTYPA     ANDNE67                                        122685
     C***********CLE005    ANDNE'Y'                                       122685
     C***********PTYPA     ORNE 66                                        122685
     C***********PTYPA     ANDNE69                                        122685
     C***********PTYPA     ANDNE72                                        122685
     C***********PTYPA     ANDNE67                                        122685
     C***********CLE005    ANDEQ'Y'                                       122685
     C   93      OAM,Z     SUB  FCBAL     OAM,Z
     C  N93      OAM,Z     ADD  FCBAL     OAM,Z
     C***********          ENDIF                                          122685
      *                                                                   CLE009
      ** If CLE009 is installed, set Work Regeneration Indicator to       CLE009
      ** changed                                                          CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     MOVE 'C'       WKSWRI  1                       CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C           Z         ADD  1         Z
     C                     GOTO LOOPZ1
      *
     C                     ENDIF
      *
     C           ENDFCT    ENDSR                           ***  ENDFCT ***
      *
      /EJECT
      *****************************************************************
      *  SRSCP - Subroutine to process 'SC' loan amendment            *
      *  Called by: Main processing (Validation of fields)            *
      *  Calls    : SRTOLC - Check funding rate/sprd tolerance        *
      *****************************************************************
     C           SRSCP     BEGSR
      *
     C                     MOVE '1'       *IN53
      *
      **  Calculate New Effective Interest Rate
      *
      **  Obtain Interest New Rate/Spread
      *
      **  New Interest Rate/Spread as entered
      *
     C           SRTSP     IFNE *BLANKS
     C                     Z-ADDWSPRT     WIRTS  117
     C                     MOVE 'Y'       WIRCF
      *
      **  Or, if no Interest Rate/Spread entered, from another 'SC'
      **  w/ value date <= current loan amendment value date and w/ int
      **  rate chg flag = 'Y'
      *
     C                     ELSE
     C                     MOVELSLOAN     WKLNR
     C                     MOVELVDAYNO    WKVDT
     C           SSEQN     IFEQ *BLANKS
     C                     MOVE '999'     WKLSN
     C                     ELSE
     C                     MOVE SSEQN     WKLSN
     C                     ENDIF
      *
     C           KLAKEY    SETGTLOAMD
     C           *IN79     DOUEQ*ON
     C           AMTP      OREQ 'SC'
     C           IRCF      ANDEQ'Y'
     C           RECI      ANDEQ'D'
     C           LNRF      ORNE WKLNR
     C                     READPLOAMD                    79
     C                     ENDDO
      *
     C           AMTP      IFEQ 'SC'
     C           IRCF      ANDEQ'Y'
     C           RECI      ANDEQ'D'
     C           LNRF      ANDEQWKLNR
     C********** RTSP      DIV  10000000  WIRTS                                               214893
     C                     Z-ADDRTSP      WIRTS                                               214893
     C                     MOVE '0'       *IN54
      *
      **  Or, if no Int Rate/Spread entered & no other 'SC' for loan,
      **  use original rate/spread from CLOAN
      *
     C                     ELSE
     C                     Z-ADDWCRTSP    WIRTS
     C                     MOVE '1'       *IN54
     C                     ENDIF
      *
     C                     MOVE 'N'       WIRCF
     C                     ENDIF
      *
      **  Obtain Base Rate Code
      *
     C                     MOVE *BLANKS   WBSRC   2
     C                     Z-ADD*ZERO     WBRTE  117                                          CLE036
      *
      **  Retrieve previous live 'BC' w/ value date <= current loan
      **  amendment value date
      *
     C                     MOVELSLOAN     WKLNR
     C                     MOVELVDAYNO    WKVDT
     C           SSEQN     IFEQ *BLANKS
     C                     MOVE '999'     WKLSN
     C                     ELSE
     C                     MOVE SSEQN     WKLSN
     C                     ENDIF
      *
     C           KLAKEY    SETGTLOAMD
     C           *IN79     DOUEQ*ON
     C           AMTP      OREQ 'BC'
     C           RECI      ANDEQ'D'
     C           LNRF      ORNE WKLNR
     C                     READPLOAMD                    79
     C                     ENDDO
      *
     C           AMTP      IFEQ 'BC'
     C           RECI      ANDEQ'D'
     C           LNRF      ANDEQWKLNR
     C                     MOVE BRTT      WBSRC
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     Z-ADDRTSP      WBRTE                                               CLE036
     C                     ENDIF                                                              CLE036
     C                     MOVE '0'       *IN55
      *
      **  Or, if no other 'BC' for loan, use BRTT from CLOAN
      *
     C                     ELSE
     C                     MOVE WCBRTT    WBSRC
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     Z-ADDWLBASR    WBRTE                                               CLE036
     C                     ENDIF                                                              CLE036
     C                     MOVE '1'       *IN55
     C                     ENDIF
      *
     C                     Z-ADD0         WEFIR  117
      *
      **  If loan has base rate or there is previous 'BC'...
      *
     C           WBSRC     IFNE *BLANKS
     C           WBSRC     ANDNE'00'                                      CDE002
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           WBRTE     ANDNE*ZERO                                                         CLE036
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C           WBRTE     ANDNE*ZERO                                                         CLE036
     C                     Z-ADDWBRTE     WBSRT                                               CLE036
     C                     ELSE                                                               CLE036
      *
      **  Retrieve base rate associated w/ base rate code
      *
     C                     CALL 'AOBSRTR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM SCURR     PCURR
     C                     PARM WBSRC     PBRAT
     C********** SDBSRT    PARM SDBSRT    DSFDY                                 CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                                 CSD006
      *
      **  Determine actual base rate
      *
     C           PRTCD     IFEQ *BLANKS
     C           VDAYNO    IFLT BAVDNR
     C                     Z-ADDBACBSR    WBSRT  117
     C                     ELSE
     C                     Z-ADDBANBRT    WBSRT
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                                              CLE036
      *
      **  New Effective Interest Rate = Interest New Rate/Spread
      **  combined w/ Base Rate depending on Spread Indicator
      *
     C                     SELEC
      *
     C           WCSPIN    WHEQ 'A'
     C           WBSRT     ADD  WIRTS     WEFIR
      *
     C           WCSPIN    WHEQ 'S'
     C           WBSRT     SUB  WIRTS     WEFIR
      *
     C           WCSPIN    WHEQ 'P'
     C           WBSRT     MULT WIRTS     WEFIR
     C           WEFIR     DIV  100       WEFIR
      *
     C                     ENDSL
      *
      **  New Effective Interest Rate = Interest New Rate/Spread if
      **  loan is not linked to base rate
      *
     C                     ELSE
     C                     Z-ADDWIRTS     WEFIR
     C                     ENDIF
      *
      ************************************************************        152931
      ****Do*not*perform*tolerance*check*if*New*Eff.*Int.*Rate*=*0        152931
      ************************************************************        152931
     C***********WEFIR     IFEQ 0                                         152931
     C***********          MOVE '0'       *IN53                           152931
     C***********          ENDIF                                          152931
      *
     C                     Z-ADD0         WFRSP  117
      *
      **  Obtain New Funding Rate/Spread
      *
     C           *IN51     IFEQ *ON                                       126903
     C************IN53     IFEQ *ON                                       152931
      *
      **  Validate Funding Spread/Rate if it is enabled.
      *
     C                     MOVE '0'       *IN52
      *
     C           SFRAT     IFEQ *BLANKS
      *
      **  Error if both interest and funding rate/spread are blank
      *
     C           SRTSP     IFEQ *BLANKS
     C                     MOVE '1'       *IN39
     C                     MOVEL'LEA0545' ZAMSID
     C                     EXSR ZASNMS
      *
      **  If int rate/spread entered...
      *
     C                     ELSE
      *
      **  Retrieve most previous 'SC' w/ Funding Rate Change Flag = 'Y'
      *
     C                     MOVELSLOAN     WKLNR
     C                     MOVELVDAYNO    WKVDT
     C           SSEQN     IFEQ *BLANKS
     C                     MOVE '999'     WKLSN
     C                     ELSE
     C                     MOVE SSEQN     WKLSN
     C                     ENDIF
      *
     C           KLAKEY    SETGTLOAMD
     C           *IN79     DOUEQ*ON
     C           AMTP      OREQ 'SC'
     C           FRCF      ANDEQ'Y'
     C           RECI      ANDEQ'D'
     C           LNRF      ORNE WKLNR
     C                     READPLOAMD                    79
     C                     ENDDO
      *
     C           AMTP      IFEQ 'SC'
     C           FRCF      ANDEQ'Y'
     C           RECI      ANDEQ'D'
     C           LNRF      ANDEQWKLNR
     C                     Z-ADDFSRP      WFRSP
      *
      **  Or, if no Fund Rate/Spread entered & no other 'SC' for loan,
      **  use original funding rate/spread from CLOAN
      *
     C                     ELSE
     C                     Z-ADDWCFSRP    WFRSP
     C                     Z-ADDWCFSRP    WFRAT                           152931
     C                     ENDIF
      *
     C                     MOVE 'N'       WFRCF
     C                     ENDIF
      *
      **  If funding rate/spread entered, check if it is a valid figure
      *
     C                     ELSE
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SFRAT     ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD7         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    WFRAT
     C                     Z-ADDWFRAT     WFRSP
      *
     C           *IN99     IFEQ *ON
     C                     MOVE '1'       *IN52
     C                     MOVEL'LEA0546' ZAMSID
     C                     EXSR ZASNMS
      *
      **  If valid figure, assign rate change flag and funding sign
      *
     C                     ELSE
     C                     MOVE 'Y'       WFRCF
     C                     MOVE WCFSGN    WFSGN
     C                     ENDIF
     C                     ENDIF
     C***********          ENDIF                                          152931
      *
      **  Do not perform tolerance check if New Funding Rate/Spread = 0
      *
     C           WFRSP     IFEQ 0
     C                     MOVE '0'       *IN53
     C                     ENDIF
      *
      **  Calculate New Actual (Effective) Funding Rate
      *
     C           *IN52     IFEQ *OFF
     C           *IN39     ANDEQ*OFF
     C           *IN53     ANDEQ*ON
      *
     C                     SELEC
      *
     C           WCFSGN    WHEQ *BLANK
     C                     Z-ADDWFRSP     WEFFR  117
      *
     C           WCFSGN    WHEQ '+'
     C           WEFIR     ADD  WFRSP     WEFFR
      *
     C           WCFSGN    WHEQ '-'
     C           WEFIR     SUB  WFRSP     WEFFR
      *
     C                     ENDSL
      *
      **  Perform tolerance check
      *
     C                     EXSR SRTOLC
     C                     ENDIF
     C                     ENDIF                                          126903
      *
      ** Retrieve back the original loan amendment details being          143004
      ** processed                                                        143004
      *                                                                   143004
     C           LNRF      IFNE WKLNR                                     143004
     C           AMTP      ORNE SATYP                                     143004
     C           VDAT      ORNE VDAYNO                                    143004
     C           LASN      ORNE WKLSN                                     143004
     C                     MOVE SLOAN     WKLNR                           143004
     C                     MOVE VDAYNO    WKVDT                           143004
     C                     MOVE SSEQN     WKLSN                           143004
      *                                                                   143004
     C           KLAKEY    CHAINLOAMD                79                   143004
     C                     MOVE '0'       *IN79                           143004
     C                     ENDIF                                          143004
      *                                                                   143004
     C                     ENDSR
      /EJECT
      *****************************************************************
      *  SRBCP - Subroutine to process 'BC' loan amendment            *
      *  Called by: Main processing (Validation of fields)            *
      *  Calls    : SRTOLC - Check funding rate/sprd tolerance        *
      *****************************************************************
     C           SRBCP     BEGSR
      *
     C                     MOVE '1'       *IN53
      *
      **  Calculate New Effective Interest Rate
      *
      **  Obtain Interest New Rate/Spread
      *
      **  Retrieve most previous 'SC' w/ value date <= current loan
      **  amendment value date and w/ int rate chg flag = 'Y'
      *
     C                     MOVELSLOAN     WKLNR
     C                     MOVELVDAYNO    WKVDT
     C           SSEQN     IFEQ *BLANKS
     C                     MOVE '999'     WKLSN
     C                     ELSE
     C                     MOVE SSEQN     WKLSN
     C                     ENDIF
      *
     C           KLAKEY    SETGTLOAMD
     C           *IN79     DOUEQ*ON
     C           AMTP      OREQ 'SC'
     C           IRCF      ANDEQ'Y'
     C           RECI      ANDEQ'D'
     C           LNRF      ORNE WKLNR
     C                     READPLOAMD                    79
     C                     ENDDO
      *
     C           AMTP      IFEQ 'SC'
     C           IRCF      ANDEQ'Y'
     C           RECI      ANDEQ'D'
     C           LNRF      ANDEQWKLNR
     C********** RTSP      DIV  10000000  WIRTS                                               214893
     C                     Z-ADDRTSP      WIRTS                                               214893
      *
      **  Or, if no other 'SC' for loan, use original rate/spread from
      **  CLOAN
      *
     C                     ELSE
     C                     Z-ADDWCRTSP    WIRTS
     C                     ENDIF
      *                                                                                       CLE036
     C           SBRAT     IFNE *BLANKS                                                       CLE036
      *
      **  Retrieve base rate associated w/ base rate code
      *
     C                     CALL 'AOBSRTR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM SCURR     PCURR
     C                     PARM SBRAT     PBRAT
     C********** SDBSRT    PARM SDBSRT    DSFDY                                 CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                                 CSD006
      *
      **  Determine actual base rate
      *
     C           PRTCD     IFEQ *BLANKS
     C           VDAYNO    IFLT BAVDNR
     C                     Z-ADDBACBSR    WBSRT
     C                     ELSE
     C                     Z-ADDBANBRT    WBSRT
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CLE036
     C                     ELSE                                                               CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     Z-ADDWSPRT     WBSRT                                               CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *
      **  New Effective Interest Rate = Interest New Rate/Spread
      **  combined w/ Base Rate depending on Spread Indicator
      *
     C                     SELEC
      *
     C           WCSPIN    WHEQ 'A'
     C           WBSRT     ADD  WIRTS     WEFIR
      *
     C           WCSPIN    WHEQ 'S'
     C           WBSRT     SUB  WIRTS     WEFIR
      *
     C           WCSPIN    WHEQ 'P'
     C           WBSRT     MULT WIRTS     WEFIR
     C           WEFIR     DIV  100       WEFIR
      *
     C                     ENDSL
      *
      **  Do not perform tolerance check if New Eff. Int. Rate = 0
      *
     C           WEFIR     IFEQ 0
     C                     MOVE '0'       *IN53
     C                     ENDIF
      *
     C                     Z-ADD0         WFRSP  117
      *
      **  Obtain New Funding Rate/Spread
      *
     C           *IN53     IFEQ *ON
      *
      **  Retrieve most previous 'SC' w/ Funding Rate Change Flag = 'Y'
      *
     C                     MOVELSLOAN     WKLNR
     C                     MOVELVDAYNO    WKVDT
     C           SSEQN     IFEQ *BLANKS
     C                     MOVE '999'     WKLSN
     C                     ELSE
     C                     MOVE SSEQN     WKLSN
     C                     ENDIF
      *
     C           KLAKEY    SETGTLOAMD
     C           *IN79     DOUEQ*ON
     C           AMTP      OREQ 'SC'
     C           FRCF      ANDEQ'Y'
     C           RECI      ANDEQ'D'
     C           LNRF      ORNE WKLNR
     C                     READPLOAMD                    79
     C                     ENDDO
      *
     C           AMTP      IFEQ 'SC'
     C           FRCF      ANDEQ'Y'
     C           RECI      ANDEQ'D'
     C           LNRF      ANDEQWKLNR
     C                     Z-ADDFSRP      WFRSP
      *
      **  Or, if no Fund Rate/Spread entered & no other 'SC' for loan,
      **  use original funding rate/spread from CLOAN
      *
     C                     ELSE
     C                     Z-ADDWCFSRP    WFRSP
     C                     ENDIF
     C                     ENDIF
      *
      **  Do not perform tolerance check if New Funding Rate/Spread = 0
      *
     C           WFRSP     IFEQ 0
     C                     MOVE '0'       *IN53
     C                     ENDIF
      *
      **  Calculate New Actual (Effective) Funding Rate
      *
     C           *IN53     IFEQ *ON
      *
     C                     SELEC
      *
     C           WCFSGN    WHEQ *BLANK
     C                     Z-ADDWFRSP     WEFFR  117
      *
     C           WCFSGN    WHEQ '+'
     C           WEFIR     ADD  WFRSP     WEFFR
      *
     C           WCFSGN    WHEQ '-'
     C           WEFIR     SUB  WFRSP     WEFFR
      *
     C                     ENDSL
      *
      **  Perform tolerance check
      *
     C                     EXSR SRTOLC
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *  SRTOLC - Subroutine to check funding rate/spread tolerance   *
      *  Called by: SRSCP, SRBCP                                      *
      *  Calls    : None                                              *
      *****************************************************************
     C           SRTOLC    BEGSR
      *
      **  Calculate minimum & maximum allowable amount based on Funding
      **  Tolerance
      *
     C           WEFFR     IFGT WEFIR
     C           FTTFRT    DIV  100       WTOL1   32
     C           WTOL1     ADD  1         WTOL4   32
     C           WEFIR     MULT WTOL4     WMAX   117
     C                     ENDIF
      *
     C           WEFFR     IFLT WEFIR
     C           FTTFRT    DIV  100       WTOL2   32
     C           1         SUB  WTOL2     WTOL3   32
     C           WEFIR     MULT WTOL3     WMIN   117
     C                     ENDIF
      *
      ** If Warning has not been sent before, or if rates have changed                        214893
      **  Check if Effective Funding Rate is within tolerance level
      **  Send Warning message
      *
     C           WE1036    IFNE 'Y'                                                           214893
     C           WEFFR     ORNE SWEFFR                                                        214893
     C           WEFIR     ORNE SWEFIR                                                        214893
      *                                                                                       214893
     C           WEFFR     IFNE WEFIR
     C           WEFFR     IFGT WMAX
     C           WEFFR     ANDGTWEFIR
     C           WEFFR     ORLT WMIN
     C           WEFFR     ANDLTWEFIR
     C                     MOVE 'Y'       WWERR
     C                     MOVE 'Y'       WE1036  1                                           214893
     C                     MOVEL'LEA1036' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR
     C                     Z-ADDWEFFR     SWEFFR 117                                          214893
     C                     Z-ADDWEFIR     SWEFIR 117                                          214893
      *
      **  Reverse image base rate code if 'BC'; funding rate/spread
      **  if 'SC'
      *
     C                     SELEC
      *
     C           SATYP     WHEQ 'SC'
     C                     MOVE '1'       *IN52
     C           SATYP     WHEQ 'BC'
     C                     MOVE '1'       *IN38
      *
     C                     ENDSL
     C                     ELSE                                                               214893
     C                     MOVE *BLANKS   WE1036                                              214893
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF                                                              214893
     C                     ENDSR
      /EJECT                                                              123857
      *****************************************************************   123857
      *  SRSAVE - Subroutine to save extended settlement values for   *   123857
      *           authorisation process                               *   123857
      *  Called by: SRVALF                                            *   123857
      *  Calls    : None                                              *   123857
      *****************************************************************   123857
     C           SRSAVE    BEGSR                                          123857
      *                                                                   123857
     C           *LIKE     DEFN RSTM      W#RSTM                          123857
     C           *LIKE     DEFN RONS      W#RONS                          123857
     C           *LIKE     DEFN RIBN      W#RIBN                          123857
     C           *LIKE     DEFN RIBA      W#RIBA                          123857
     C           *LIKE     DEFN ROBN      W#ROBN                          123857
     C           *LIKE     DEFN ROCN      W#ROCN                          123857
     C           *LIKE     DEFN PSTM      W#PSTM                          123857
     C           *LIKE     DEFN PONS      W#PONS                          123857
     C           *LIKE     DEFN PIBN      W#PIBN                          123857
     C           *LIKE     DEFN PIBA      W#PIBA                          123857
     C           *LIKE     DEFN POCN      W#POCN                          123857
     C           *LIKE     DEFN POBN      W#POBN                          123857
     C           *LIKE     DEFN RCRN      W#RCRN                          123857
     C           *LIKE     DEFN RCRA      W#RCRA                          123857
     C           *LIKE     DEFN RVNO      W#RVNO                          123857
     C           *LIKE     DEFN AWBN      W#AWBN                          123857
     C           *LIKE     DEFN AWBA      W#AWBA                          123857
     C           *LIKE     DEFN BENN      W#BENN                          123857
     C           *LIKE     DEFN BENA      W#BENA                          123857
     C           *LIKE     DEFN DTP1      W#DTP1                          123857
     C           *LIKE     DEFN DTP2      W#DTP2                          123857
     C           *LIKE     DEFN DTP3      W#DTP3                          123857
     C           *LIKE     DEFN DTP4      W#DTP4                          123857
     C           *LIKE     DEFN DCHG      W#DCHG                          123857
     C           *LIKE     DEFN BTB1      W#BTB1                          123857
     C           *LIKE     DEFN BTB2      W#BTB2                          123857
     C           *LIKE     DEFN BTB3      W#BTB3                          123857
     C           *LIKE     DEFN BTB4      W#BTB4                          123857
     C           *LIKE     DEFN BTB5      W#BTB5                          123857
     C           *LIKE     DEFN BTB6      W#BTB6                          123857
     C           *LIKE     DEFN CVMR      W#CVMR                          123857
      *                                                                   123857
     C                     MOVELRSTM      W#RSTM                          123857
     C                     MOVELRONS      W#RONS                          123857
     C                     MOVELRIBN      W#RIBN                          123857
     C                     MOVELRIBA      W#RIBA                          123857
     C                     MOVELROBN      W#ROBN                          123857
     C                     MOVELROCN      W#ROCN                          123857
     C                     MOVELPSTM      W#PSTM                          123857
     C                     MOVELPONS      W#PONS                          123857
     C                     MOVELPIBN      W#PIBN                          123857
     C                     MOVELPIBA      W#PIBA                          123857
     C                     MOVELPOCN      W#POCN                          123857
     C                     MOVELPOBN      W#POBN                          123857
     C                     MOVELRCRN      W#RCRN                          123857
     C                     MOVELRCRA      W#RCRA                          123857
     C                     MOVELRVNO      W#RVNO                          123857
     C                     MOVELAWBN      W#AWBN                          123857
     C                     MOVELAWBA      W#AWBA                          123857
     C                     MOVELBENN      W#BENN                          123857
     C                     MOVELBENA      W#BENA                          123857
     C                     MOVELDTP1      W#DTP1                          123857
     C                     MOVELDTP2      W#DTP2                          123857
     C                     MOVELDTP3      W#DTP3                          123857
     C                     MOVELDTP4      W#DTP4                          123857
     C                     MOVELDCHG      W#DCHG                          123857
     C                     MOVELBTB1      W#BTB1                          123857
     C                     MOVELBTB2      W#BTB2                          123857
     C                     MOVELBTB3      W#BTB3                          123857
     C                     MOVELBTB4      W#BTB4                          123857
     C                     MOVELBTB5      W#BTB5                          123857
     C                     MOVELBTB6      W#BTB6                          123857
     C                     MOVELCVMR      W#CVMR                          123857
      *                                                                   123857
     C                     ENDSR                                          123857
      /EJECT                                                              123857
      *****************************************************************   123857
      *  SRREST - Subroutine to restore extended settlement values    *   123857
      *           for authorisation process                           *   123857
      *  Called by: SRVALF                                            *   123857
      *  Calls    : None                                              *   123857
      *****************************************************************   123857
     C           SRREST    BEGSR                                          123857
      *                                                                   123857
      *                                                                   123857
     C                     MOVELW#RSTM    RSTM                            123857
     C                     MOVELW#RONS    RONS                            123857
     C                     MOVELW#RIBN    RIBN                            123857
     C                     MOVELW#RIBA    RIBA                            123857
     C                     MOVELW#ROBN    ROBN                            123857
     C                     MOVELW#ROCN    ROCN                            123857
     C                     MOVELW#PSTM    PSTM                            123857
     C                     MOVELW#PONS    PONS                            123857
     C                     MOVELW#PIBN    PIBN                            123857
     C                     MOVELW#PIBA    PIBA                            123857
     C                     MOVELW#POCN    POCN                            123857
     C                     MOVELW#POBN    POBN                            123857
     C                     MOVELW#RCRN    RCRN                            123857
     C                     MOVELW#RCRA    RCRA                            123857
     C                     MOVELW#RVNO    RVNO                            123857
     C                     MOVELW#AWBN    AWBN                            123857
     C                     MOVELW#AWBA    AWBA                            123857
     C                     MOVELW#BENN    BENN                            123857
     C                     MOVELW#BENA    BENA                            123857
     C                     MOVELW#DTP1    DTP1                            123857
     C                     MOVELW#DTP2    DTP2                            123857
     C                     MOVELW#DTP3    DTP3                            123857
     C                     MOVELW#DTP4    DTP4                            123857
     C                     MOVELW#DCHG    DCHG                            123857
     C                     MOVELW#BTB1    BTB1                            123857
     C                     MOVELW#BTB2    BTB2                            123857
     C                     MOVELW#BTB3    BTB3                            123857
     C                     MOVELW#BTB4    BTB4                            123857
     C                     MOVELW#BTB5    BTB5                            123857
     C                     MOVELW#BTB6    BTB6                            123857
     C                     MOVELW#CVMR    CVMR                            123857
      *                                                                   123857
     C                     ENDSR                                          123857
      /EJECT                                                              149500
      *****************************************************************   149500
      * SRTAMT  -  Accumulate total amt. sold for the orig loan.      *   149500
      * Called by: SRVALF                                             *   149500
      * Calls    : None                                               *   149500
      *****************************************************************   149500
     C           SRTAMT    BEGSR                                          149500
      *                                                                   149500
     C           WLAMT     ADD  PSAM      WTAMT  130                      149500
      *                                                                   149500
      ** Determine all part sold for the original loan.                   149500
      *                                                                   149500
     C           WKLNR2    SETLLPSOLDF                                    149500
     C           WKLNR2    READEPSOLDF                   93               149500
     C           *IN93     DOWEQ'0'                                       149500
      *                                                                   149500
      ** Accumulate all principal increase due.                           149500
      *                                                                   149500
     C                     MOVE LNRF      WKLNR                           149500
     C           WKLNR     SETLLLELOAMD4                                  149500
     C           WKLNR     READELELOAMD4                 94               149500
     C           *IN94     DOWEQ'0'                                       149500
     C           VDATW     IFLE VDAYNO                                    149500
     C                     ADD  PRAMW     WTAMT                           149500
     C           WKLNR     READELELOAMD4                 94               149500
     C                     ELSE                                           149500
     C                     LEAVE                                          149500
     C                     ENDIF                                          149500
     C                     ENDDO                                          149500
      *                                                                   149500
     C           WKLNR2    READEPSOLDF                   93               149500
     C                     ENDDO                                          149500
      *                                                                   149500
     C                     ENDSR                                          149500
      /EJECT
      *****************************************************************
      * SRWIND  -  Window Processing                                  *
      * Called by:                                                    *
      * Calls    : None                                               *
      *****************************************************************
     C           SRWIND    BEGSR
      *
     C           BGWDPR    IFEQ 'Y'
      *
     C*  FIND OUT WHICH SEQ NBR WILL BE USED FOR NEW LOAN AMENDMENT       189826
     C           SACTN     IFEQ 'I'                                       189826
      *                                                                   189826
      ** Find next available sequence no. for insert                      189826
     C                     Z-ADD0         WLSN    30                      189826
     C                     MOVE SLOAN     WKLNR                           189826
     C                     Z-ADDVDAYNO    WKVDT                           189826
     C                     Z-ADD0         WKLSN                           189826
     C           KLAKEY    SETLLLOAMD                                     189826
     C                     Z-ADD0         LASNP   30                      189826
      *                                                                   189826
     C                     READ LOAMD                    79               189826
      *                                                                   189826
     C           *IN79     DOWEQ'0'                                       189826
     C           RECI      IFEQ 'T'                                       189826
     C                     LEAVE                                          189826
     C                     ENDIF                                          189826
     C           WKLNR     IFNE LNRF                                      189826
     C           WKVDT     ORNE VDAT                                      189826
     C                     LEAVE                                          189826
     C                     ENDIF                                          189826
     C                     Z-ADDLASN      LASNP                           189826
     C                     READ LOAMD                    79               189826
     C                     ENDDO                                          189826
      *                                                                   189826
     C           LASNP     ADD  1         WLSN                            189826
      *                                                                   189826
     C                     ENDIF                                          189826
      *                                                                   189826
     C/COPY WNCPYSRC,LE2040MOV1
      *
     C                     MOVE SACTN     UACTCD
     C           SACTN     IFEQ 'X'
     C                     MOVE 'E'       UACTCD
     C                     ENDIF
     C           SACTN     IFEQ 'R'
     C                     MOVE 'D'       UACTCD
     C                     ENDIF
      *
     C                     CALL 'WN0010'
     C                     PARM ##PGM     UPGM   10        Program
     C                     PARM *BLANK    UFKEY   2        Function Key
     C                     PARM           UACTCD  1        Action
     C                     PARM           DATA             Trans Data
     C                     PARM *BLANK    W0RTN   7        Return Code
     C                     PARM           SPARE 256        Spare Field
      *
     C                     SELEC
     C           W0RTN     WHEQ 'Y2U9999'
     C                     MOVE *BLANK    WFMT
      *
     C           W0RTN     WHEQ 'USR0563'
     C                     MOVEL'USR0563' ZAMSID
     C                     MOVEL'WNMSGF  'ZAMSGF                          189825
     C                     EXSR ZASNMS
     C                     MOVEL'LERMSGF 'ZAMSGF                          189825
     C                     MOVE 'D1'      WFMT
      *
     C           W0RTN     WHEQ 'Y2U0004'
     C                     MOVEL'USR0567' ZAMSID
     C                     MOVEL'WNMSGF  'ZAMSGF                          189825
     C                     EXSR ZASNMS
     C                     MOVEL'LERMSGF 'ZAMSGF                          189825
     C                     MOVE 'D1'      WFMT
      *
     C           W0RTN     WHEQ 'USR0790'
     C                     MOVEL'USR0790' ZAMSID                          189825
     C                     MOVEL'WNMSGF  'ZAMSGF                          189825
     C                     EXSR ZASNMS                                    189825
     C                     MOVEL'LERMSGF 'ZAMSGF                          189825
     C                     MOVE 'D1'      WFMT
     C                     ENDSL
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************                       CLE038
      /EJECT                                                                                  CLE038
      *****************************************************************                       CLE038
      * SRBYAM -  Format Allocation By Amount Fields subroutine       *                       CLE038
      * Called by: SRFXST   SRBSET                                    *                       CLE038
      * Calls    : None                                               *                       CLE038
      *****************************************************************                       CLE038
     C           SRBYAM    BEGSR                                                              CLE038
      *                                                                                       CLE038
     C           CLE038    IFEQ 'Y'                                                           CLE038
     C           SSTAL     ANDEQ'Y'                                                           CLE038
      *                                                                                       CLE038
     C           SACTN     IFEQ 'I'                                                           CLE038
     C                     MOVE BJRDNB    WORED   5                                           CLE038
     C                     ELSE                                                               CLE038
     C                     MOVE ORED      WORED   5                                           CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
     C                     Z-ADDWLAMT     WALAM  130                                          CLE038
     C           WALAM     IFEQ *ZEROS                                                        CLE038
      *                                                                                       CLE038
      ** Get currency decimal places                                                          CLE038
      *                                                                                       CLE038
     C                     CALL 'AOCURRR0'                                                    CLE038
     C                     PARM *BLANKS   PRTCD                                               CLE038
     C                     PARM '*KEY   ' POPTN                                               CLE038
     C                     PARM SCURR     PCURR                                               CLE038
     C           SDCURR    PARM SDCURR    DSSDY                                               CLE038
     C           PRTCD     IFNE *BLANKS                                                       CLE038
     C           *LOCK     IN   LDA                                                           CLE038
     C                     MOVEL'SDCURRPD'DBFILE           ************                       CLE038
     C                     Z-ADD12        DBASE            * DBERR 12 *                       CLE038
     C                     MOVELCCY       DBKEY            ************                       CLE038
     C                     OUT  LDA                                                           CLE038
     C                     EXSR *PSSR                                                         CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
     C                     Z-ADDA6NBDP    ZADEC                                               CLE038
     C           13        SUB  A6NBDP    ZADIG                                               CLE038
     C                     MOVE *BLANK    ZFIELD                                              CLE038
     C                     MOVE SAMNT     ZFIELD                                              CLE038
     C                     EXSR ZALIGN                                                        CLE038
     C           *IN99     IFNE '1'                                                           CLE038
     C                     MOVE ZFIELD    WALAM                                               CLE038
     C                     ENDIF                                                              CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
     C                     ENDSR                                                              CLE038
      *****************************************************************                       CLE038
      /EJECT
      *****************************************************************
      * SREND   -  End program                                        *
      * Called by: Main routine                                       *
      * Calls    : None                                               *
      *****************************************************************
     C           SREND     BEGSR
      *
     C                     MOVE '1'       *INLR
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * CLEAR   -  Clears the message queue                           *
      * Called by: Main routine                                       *
      * Calls    : Y2CLMSC                                            *
      *****************************************************************
     C           CLEAR     BEGSR
      *
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
     C                     MOVE *BLANK    WERRF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *  GLZADD - Subroutine to add an amount to the total            *
      *  Called by: Main program                                      *
      *  Calls    : GLZSUM - Subr. to carry out the addition          *
      *****************************************************************
     CSR         GLZADD    BEGSR                           ***  GLZADD ***
      *
     CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
     CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
      *
      * SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
     CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
     CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
      * BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
      *
     CSR                   EXSR GLZSUM
     CSR         ZZAEND    ENDSR                           ***  ZZAEND ***
      /EJECT
      *****************************************************************
      *  GLZSUB - Subroutine to subtract an amount to the total       *
      *  Called by: Main program                                      *
      *  Calls    : GLZADD - Subroutine to add an amount to the total *
      *****************************************************************
     CSR         GLZSUB    BEGSR                           ***  GLZSUB ***
      * PROCESSING. JUST REVERSE THE 'SIGN' AND ADD
     CSR                   Z-SUBZZAMT     ZZAMT  153       REVERSE 'SIGN'
     CSR                   EXSR GLZADD                       AND 'ADD'
     CSR                   Z-SUBZZAMT     ZZAMT            RESTORE 'SIGN'
     CSR                   ENDSR
      /EJECT
      *****************************************************************
      *  GLZSUM - Subroutine to carry out the additon for subroutine  *
      *  Called by: Main program                                      *
      *  Calls    : None                                              *
      *****************************************************************
     CSR         GLZSUM    BEGSR                           ***  GLZSUM ***
      *
     CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
     CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
     CSR                   SETOF                     919293
     CSR                   SETOF                     949599
      *
      *    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
     CSR         ZZAMTI    COMP 0                      9293
     CSR 93      ZZAMTD    COMP 0                      9293
     CSR 93                GOTO ZZSEND                     ZERO BYPASS
      *
      *    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
     CSR         ZZTOTI    COMP 0                      9193
     CSR 93      ZZTOTD    COMP 0                      9193
      *
      *    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
     CSR 93                Z-ADDZZAMTI    ZZTOTI
     CSR 93                Z-ADDZZAMTD    ZZTOTD
     CSR 93                GOTO ZZSEND                     ZERO BYPASS
      *    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
     CSR 91N92
     CORN91 92             GOTO ZZOFPS
      *
     CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     CSR         ZZWK2     COMP 999                  93    '93' = CARRY
     CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
      *
     CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
     CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
     CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
     CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
      *
      * IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
     CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     CSRN99                Z-ADDZZWK2     ZZTOTD
     CSRN99                Z-ADDZZWK3     ZZTOTI
      *
      * IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
     CSR 99                Z-ADD0         ZZAMT  153
     CSR                   GOTO ZZSEND
      *
      * THE 'SIGNS' ARE DIFFERENT
     CSR         ZZOFPS    TAG                             ***  ZZOFPS ***
      * IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
      *
     CSR 92                Z-SUBZZAMTI    ZZAMTI 150
     CSR 92                Z-SUBZZAMTD    ZZAMTD  30
      *
      * IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
      *
     CSR 91                Z-SUBZZTOTI    ZZTOTI
     CSR 91                Z-SUBZZTOTD    ZZTOTD
      * BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
      *
     CSR         ZZTOTI    COMP ZZAMTI               93  95
     CSR 95      ZZTOTD    COMP ZZAMTD               93  95
      *
      * IF ZZTOT EQ. ZZAMT RETURN ZERO.
     CSR 95                Z-ADD0         ZZTOTI
     CSR 95                Z-ADD0         ZZTOTD
     CSR 95                GOTO ZZSEND
      *
      * IF ZZTOT GT. ZZAMT.
     CSR 93      ZZAMTD    COMP ZZTOTD               94
     CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
     CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
     CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
      *
      *
      * IF ZZAMT GT. ZZTOT.
     CSRN93      ZZTOTD    COMP ZZAMTD               94
     CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
     CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
     CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
      *
      * REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
     CSR                   SETOF                     94
     CSR 93 91
     CORN93 92             SETON                     94
     CSR 94                Z-SUBZZTOTI    ZZTOTI
     CSR 94                Z-SUBZZTOTD    ZZTOTD
      **
      **   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
     CSR 92                Z-SUBZZAMTI    ZZAMTI
     CSR 92                Z-SUBZZAMTD    ZZAMTD
     CSR         ZZSEND    TAG                             ***  ZZSEND ***
      **
      **   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
     CSR                   SETOF                     96
     CSR         ZZTOTD    COMP 0                        91
     CSR 91      ZZTOTI    COMP 0                      96
     CSR 96                MOVE '.000-'   ZZNEGD  5
     CSR                   ENDSR                             ** ENDSR **
      /EJECT
      *****************************************************************   143802
      * SRUPPS   - Update Part Sold amount for Assignments            *   143802
      * Called by: SRBTCH                                             *   143802
      * Calls    : None                                               *   143802
      *****************************************************************   143802
      *                                                                   143802
     C           SRUPPS    BEGSR                                          143802
      *                                                                   143802
     C                     Z-ADD0         W#PRAM 130                      143802
     C**********           Z-ADD0         WKLNR                                        143802 CLE148
     C                     MOVEL*BLANKS   WKLNR                                               CLE148
      *                                                                   143802
      **Only process if assignment flag is set                            143802
      *                                                                   143802
     C           PIGASS    IFEQ 'A'                                       143802
      *                                                                   143802
      **Access Loans file using loan number                               143802
      *                                                                   143802
     C                     MOVE PILOAN    WKLNR                           143802
     C           KLKEY     CHAINCLOAN                82                   143802
      *                                                                   143802
     C           *IN82     IFEQ *OFF                                      143802
     C**********           Z-ADD0         WKLNR                                        143802 CLE148
     C                     MOVEL*BLANKS   WKLNR                                               CLE148
      *                                                                   143802
      **If Mirror number not blank i.e. Loan is Part Purchased, access    143802
      **loans file using this number for main loan details                143802
      *                                                                   143802
     C********** MLNR      IFNE *ZERO                                                  143802 CLE148
     C           MLNR      IFNE *BLANKS                                                       CLE148
      *                                                                   143802
     C                     MOVE MLNR      WKLNR                           143802
     C           KLKEY     CHAINCLOAN                82                   143802
      *                                                                   143802
     C                     ELSE                                           143802
      *                                                                   143802
      **If Loan is Part Sold, Mirror Loan no will be blank so use OLNO    143802
      **as key to access main loan details                                143802
      *                                                                   143802
     C           PTYPA     IFEQ 66                                        143802
     C           PTYPA     OREQ 67                                        143802
     C           PTYPA     OREQ 69                                        143802
     C                     MOVE OLNO      WKLNR                           143802
     C           KLKEY     CHAINCLOAN                82                   143802
      *                                                                   143802
     C                     ELSE                                           143802
      *                                                                   143802
     C                     MOVE *ON       *IN82                           143802
      *                                                                   143802
     C                     ENDIF                                          143802
      *                                                                   143802
     C                     ENDIF                                          143802
      *                                                                   143802
     C           *IN82     IFEQ *OFF                                      143802
      *                                                                   143802
      **If action code is 'I' add principal amount to total sold          143802
      **amount                                                            143802
      *                                                                   143802
      ** Get currency decimal places                                      143802
      *                                                                   143802
     C                     CALL 'AOCURRR0'                                143802
     C                     PARM *BLANKS   PRTCD                           143802
     C                     PARM '*KEY   ' POPTN                           143802
     C                     PARM PICURR    PCURR                           143802
     C           SDCURR    PARM SDCURR    DSSDY                           143802
     C                     Z-ADDA6NBDP    CDP                             143802
      *                                                                   143802
     C                     MOVEL*BLANKS   ZFIELD                          143802
     C                     MOVE PIPAMT    ZFIELD                          143802
     C                     Z-ADDCDP       ZADEC                           143802
     C           13        SUB  CDP       ZADIG                           143802
     C                     EXSR ZALIGN                                    143802
     C                     MOVE ZFIELD    W#PRAM                          143802
      *                                                                   143802
     C           SACTN     IFEQ 'I'                                       143802
      *                                                                   143802
     C           PSAM      ADD  W#PRAM    PSAM                            143802
      *                                                                   143802
     C                     ENDIF                                          143802
      *                                                                   143802
      **If action code is 'A' subtract original principal amount          143802
      **accessed from LOAMSDK and add amended principal amount.           143802
      *                                                                   143802
     C           SACTN     IFEQ 'A'                                       143802
      *                                                                   143802
     C           PSAM      SUB  W#PRLA    PSAM                            143802
      *                                                                   143802
     C           PSAM      ADD  W#PRAM    PSAM                            143802
      *                                                                   143802
     C                     ENDIF                                          143802
      *                                                                   143802
      **Update Amended Part Sold amount on Loan Master File               143802
      *                                                                   143802
     C                     UPDATCLOANCLF                                  143802
     C                     ENDIF                                          143802
      *                                                                   143802
     C                     ENDIF                                          143802
      *                                                                   143802
     C                     ENDIF                                          143802
      *                                                                   135349
     C                     MOVE 'N'       WPARTS  1                       135349
     C                     MOVE '0'       *IN79                           135349
      *                                                                   143802
      ** If principal transfer transaction, update PSAM                   135349
      *                                                                   135349
     C           WAMTP     IFEQ 'PF'                                      135349
     C           WAMTP     OREQ 'PT'                                      135349
      *                                                                   135349
     C                     MOVE WLNNM     WKLNR                           135349
     C                     MOVE 'A'       WRCDT                           135349
     C           KLKEY     CHAINCLOAN               N79                   135349
     C           *IN79     IFEQ '0'                                       135349
      *                                                                   135349
      ** Check if loan is a parts sold or a parts purchased               135349
      *                                                                   135349
     C           PTYP      IFEQ 66                                        135349
     C           PTYP      OREQ 67                                        135349
     C           PTYP      OREQ 69                                        135349
     C           CLE005    ANDEQ'Y'                                       135349
     C           PTYP      OREQ 72                                        135349
     C           CLE005    ANDEQ'Y'                                       135349
     C********** MLNR      ORNE 0                                                      135349 CLE148
     C           MLNR      ORNE *BLANKS                                                       CLE148
      *                                                                   135349
     C********** MLNR      IFNE 0                                                      135349 CLE148
     C           MLNR      IFNE *BLANKS                                                       CLE148
     C                     MOVE MLNR      WKLNR                           135349
     C                     ELSE                                           135349
     C                     MOVE OLNO      WKLNR                           135349
     C                     ENDIF                                          135349
      *                                                                   135349
     C           KLKEY     CHAINCLOAN                79                   135349
      *                                                                   135349
     C                     MOVE 'Y'       WPARTS                          135349
      *                                                                   135349
     C                     ENDIF                                          135349
     C                     ENDIF                                          135349
     C                     ENDIF                                          135349
      *                                                                   135349
      ** Insert                                                           135349
      *                                                                   135349
     C           WPARTS    IFEQ 'Y'                                       135349
     C           *IN79     ANDEQ'0'                                       135349
      *                                                                   135349
     C           SACTN     IFEQ 'I'                                       135349
      *                                                                   135349
      ** Subtract transfer amount from sold amount of the original        135349
      ** loan if 'PF' else add if 'PT'                                    135349
      *                                                                   135349
     C           WAMTP     IFEQ 'PF'                                      135349
     C                     SUB  WPAMTF    PSAM                            135349
     C                     ELSE                                           135349
     C                     ADD  WPAMTF    PSAM                            135349
     C                     ENDIF                                          135349
      *                                                                   135349
      ** Update Sold Amount                                               135349
      *                                                                   135349
     C                     UPDATCLOANCLF                                  135349
      *                                                                   135349
     C                     ENDIF                                          135349
      *                                                                   135349
      ** Amendment/Reverse                                                135349
      *                                                                   135349
     C           SACTN     IFEQ 'A'                                       135349
     C           SACTN     OREQ 'R'                                       135349
      *                                                                   135349
      ** For 'PF' restore the sold amount of the original loan. If amend  135349
      ** subtract the transfer amount to the restored amount.             135349
      *                                                                   135349
     C           WAMTP     IFEQ 'PF'                                      135349
      *                                                                   135349
     C           SACTN     IFEQ 'A'                                       135349
     C                     ADD  WPRAM     PSAM                            135349
     C                     SUB  WPAMTF    PSAM                            135349
     C                     ELSE                                           135349
     C                     ADD  WPRAM     PSAM                            135349
     C                     ENDIF                                          135349
      *                                                                   135349
     C                     ELSE                                           135349
      *                                                                   135349
      ** For PT, restore the sold amount of the original loan. If amend   135349
      ** add the transfer amount to the restored amount.                  135349
      *                                                                   135349
     C           SACTN     IFEQ 'A'                                       135349
     C                     SUB  WPRAM     PSAM                            135349
     C                     ADD  WPAMTF    PSAM                            135349
     C                     ELSE                                           135349
     C                     SUB  WPRAM     PSAM                            135349
     C                     ENDIF                                          135349
      *                                                                   135349
     C                     ENDIF                                          135349
      *                                                                   135349
      ** Update Sold Amount                                               135349
      *                                                                   135349
     C                     UPDATCLOANCLF                                  135349
     C                     ENDIF                                          135349
     C                     ENDIF                                          135349
      *                                                                   135349
     C                     ENDSR                                          143802
      *****************************************************************
      *  SRPOUT - Return message Format (For Batch only)              *
      *  Called by: Main program                                      *
      *  Calls    : None                                              *
      *****************************************************************
     C           SRPOUT    BEGSR
      *
     C                     CLEARPOUTP
     C                     MOVE WMTYP     POMTYP
     C                     MOVE WTUSR     POTUSR
     C                     MOVE WTWST     POTWST
     C                     MOVE WTREF     POTREF
     C                     MOVE WTSEQ     POTSEQ
     C                     MOVE SACTN     POTACT
     C                     MOVE WTDST     POTDST
     C                     MOVE WTTST     POTTST
     C                     MOVE PINPAR    PONPAR
     C                     MOVE SLOAN     POLOAN
     C                     MOVE WPVDAT    POVDAT
     C           SACTN     IFEQ 'I'
     C                     MOVE WLSN      POAMSQ
     C                     ELSE
     C                     MOVE SSEQN     POAMSQ
     C                     ENDIF
     C                     MOVE PIROLN    POROLN
     C                     MOVE PIROAS    POROAS
      *                                                                                     AR870590
     C           ZAMSVR    IFEQ 'D'                                                         AR870590
     C                     CALL 'Y2RVMGC'                                                   AR870590
     C                     PARM           PRTCD                                             AR870590
     C                     PARM           ZAMSID                                            AR870590
     C                     PARM           ZAMSGF                                            AR870590
     C                     PARM           ZAMSDA                                            AR870590
     C                     PARM           ZAMSTX                                            AR870590
     C                     ENDIF                                                            AR870590
      *                                                                   203330
     C           ZAMSID    IFNE *BLANK                                    203330
     C********** WWERR     IFEQ 'Y'                                                    203330 CLE031
     C**********           MOVE 'W'       POMSVR                                       203330 CLE031
     C**********           ELSE                                                        203330 CLE031
     C**********           MOVE 'E'       POMSVR                                       203330 CLE031
     C**********           ENDIF                                                       203330 CLE031
     C                     MOVE ZAMSVR    POMSVR                                              CLE031
     C                     MOVELZAMSID    POMSID                          203330
     C                     MOVELZAMSTX    POMSTX                          203330
     C                     ENDIF                                          203330
      *                                                                   203330
     C                     ENDSR
      /EJECT
      *****************************************************************   159256
      * SRWARN   - Send a warning message if a syndicated loan is     *   159256
      *            being amended, reversed or authorised directly on  *   159256
      *            Midas as Loan Manager should be used to take       *   159256
      *            advantage of the autogeneration process.           *   159256
      * Called by: SRSTRT, SRSDET                                     *   159256
      * Calls    : None                                               *   159256
      *****************************************************************   159256
     C           SRWARN    BEGSR                                          159256
      *                                                                   159256
     C           PMODE     IFEQ 'I'                                       159256
      *                                                                   159256
      ** Only issue the warning once for the same transaction.            159256
      *                                                                   159256
     C           WE232     IFEQ *BLANK                                    159256
     C           WE232     OREQ 'Y'                                       159256
     C           SLNRF     ANDNEW1LNRF                                    159256
     C                     MOVELSLNRF     W1LNRF  6                       159256
      *                                                                   159256
      ** Warn if participation linked to a syndicate                      159256
      *                                                                   159256
     C           PTYPA     IFEQ 64                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYPA     OREQ 65                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYPA     OREQ 66                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYPA     OREQ 67                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYPA     OREQ 68                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYPA     OREQ 69                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYPA     OREQ 71                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYPA     OREQ 72                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C                     MOVE 'Y'       WE232   1                       159256
     C                     MOVE 'Y'       WWERR                           159256
     C                     MOVE 'LEM0232' ZAMSID                          159256
     C                     EXSR ZASNMS                                    159256
     C                     MOVE *BLANK    WWERR                           159256
     C                     MOVE *BLANK    WWFLG                           159256
      *                                                                   159256
     C                     ELSE                                           159256
      *                                                                   159256
     C                     MOVE *BLANKS   WE232                           159256
      *                                                                   159256
      ** Warn if loan or direct participation purchased but facility      159256
      ** is syndicated.                                                   159256
      *                                                                   159256
     C           PTYPA     IFEQ 61                                        159256
     C           PTYPA     OREQ 62                                        159256
     C           PTYPA     OREQ 63                                        159256
     C           PTYPA     OREQ 64                                        159256
     C           LNKS      ANDNE'Y'                                       159256
     C           PTYPA     OREQ 65                                        159256
     C           LNKS      ANDNE'Y'                                       159256
     C           PTYPA     OREQ 68                                        159256
     C           LNKS      ANDNE'Y'                                       159256
     C           PTYPA     OREQ 70                                        159256
     C           PTYPA     OREQ 71                                        159256
     C           LNKS      ANDNE'Y'                                       159256
      *                                                                   159256
     C                     MOVE FCUSC     WFCNM                           159256
     C                     MOVE FTYPC     WFACT                           159256
     C                     MOVE FSEQC     WFNUM                           159256
     C                     MOVE 'A'       WFRTP                           159256
      *                                                                   159256
     C********** KFCLT     CHAINFCLTY                79            159256 186431
     C           KFCLT     CHAINFCLTY               N79                   186431
     C           SYIN      IFEQ 'Y'                                       159256
     C                     MOVE 'Y'       WE232                           159256
     C                     MOVE 'Y'       WWERR                           159256
     C                     MOVE 'LEM0232' ZAMSID                          159256
     C                     EXSR ZASNMS                                    159256
     C                     MOVE *BLANK    WWERR                           159256
     C                     MOVE *BLANK    WWFLG                           159256
     C                     ENDIF                                          159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDIF                                          159256
     C                     ELSE                                           159256
      *                                                                   159256
     C                     MOVE *BLANKS   WE232                           159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDSR                                          159256
      *                                                                   159256
      *****************************************************************
      *  ZASNMS - Sends messages to the program's message queue       *
      *  Called by: Main program                                      *
      *  Calls    : SRBERR - Sends error messages for Batch records   *
      *****************************************************************
     C           ZASNMS    BEGSR
      *
     C           PMODE     IFNE 'B'
     C           PMODE     ANDNE'P'
      *
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     ENDIF
      *
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message Id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C                     PARM           ZAMSTP  7        Message type.
      *
     C           WWERR     IFEQ 'Y'
     C                     MOVE 'Y'       WWFLG   1
     C                     ELSE
     C                     MOVE 'Y'       WERRF   1
     C                     ENDIF
      *
      ** For Batch and Play mode, return message
      *
     C                     ELSE
     C                     EXSR SRBERR
     C                     ENDIF
      *
     C           ZAEXIT    ENDSR
      /EJECT                                                              123998
      *****************************************************************   123998
      * SRTEXT  -  Set up text from message file                      *   123998
      * Called by: All subroutines setting of texts                   *   123998
      * Calls    : None                                               *   123998
      *****************************************************************   123998
     C           SRTEXT    BEGSR                                          123998
      *                                                                   123998
     C                     CALL 'Y2RVMGC'                                 123998
     C                     PARM *BLANKS   PRTCD                           123998
     C                     PARM           ZAMSID           Message Id.    123998
     C                     PARM           ZAMSGF           Message file.  123998
     C                     PARM           ZAMSDA           Message data.  123998
     C                     PARM           ZAMSTX           Messge text    123998
      *                                                                   123998
     C                     ENDSR                                          123998
      /EJECT
      *****************************************************************
      *  SRBERR - Sends error messages for Batch records              *
      *  Called by: Main program                                      *
      *  Calls    : SRPOUT - Return message Format (For Batch only)   *
      *****************************************************************
     C           SRBERR    BEGSR
      *
     C                     CALL 'Y2RVMGC'
     C                     PARM           PRTCD
     C                     PARM           ZAMSID           Message Id.
     C                     PARM           ZAMSGF           Message file.
     C                     PARM           ZAMSDA           Message data.
     C                     PARM           ZAMSTX132        Messge text
      *
     C           WWERR     IFNE 'Y'
     C           SATYP     ANDNE'PT'
     C           SATYP     ANDNE'PF'
     C           PMODE     ANDNE'B'                                       122889
     C                     ROLBK
     C                     ENDIF
      *
     C           PMODE     IFEQ 'B'
     C                     EXSR SRPOUT
     C           WWERR     IFEQ 'Y'
     C                     MOVE 'W'       POMSVR
     C                     ELSE
     C                     MOVE 'E'       POMSVR
     C                     ENDIF
     C                     MOVELZAMSID    POMSID
     C                     MOVELZAMSTX    POMSTX
     C                     MOVE POMSVR    ZAMSVR  1                                           CLE031
     C                     ENDIF
      *
     C           PMODE     IFEQ 'P'
      *
      ** Restore the saved record to ensure that no other fields
      ** will be updated aside from error msg id, text and severity
      *
     C                     MOVE L2040S    L2040F
      *
     C           WWERR     IFEQ 'Y'
     C                     MOVE 'W'       MSVR
     C                     ELSE
     C                     MOVE 'E'       MSVR
     C                     ENDIF
     C                     MOVELZAMSID    MSID
     C                     MOVELZAMSTX    MSTX
     C                     UPDATLE2040D0
     C                     ENDIF
      *
      *  Include DUMP here for problems during batch and play modes.      120468
      *  ... if not in batch mode, with Lending API enhancements.         CAP061
      *                                                                   120468
     C           WWERR     IFEQ ' '                                       120468
      *                                                                   CAP061
      * If error and repair is in Back office then obtain next repair     CAP061
      * number                                                            CAP061
     C           POMSVR    IFEQ 'E'                                       CAP061
     C           PIPLC     ANDEQ'B'                                       CAP061
     C           CAP061    ANDEQ'Y'                                       CAP061
     C                     CALL 'LEC0215'                                 CAP061
     C                     PARM           XREPN                           CAP061
      *                                                                   CAP061
      * Set up remaining fields on LEIFEEPD.                              CAP061
     C                     MOVELZAMSID    XMSID                           CAP061
      *                                                                   CSC011
     C           PCRFK     IFEQ *BLANKS                                   CSC011
     C                     MOVELPITREF    STNRF                           CSC011
     C                     ELSE                                           CSC011
     C                     MOVELPCRFK     STNRF                           CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C           PITDST    IFEQ *BLANKS                                   CSC011
     C           PITTST    OREQ *BLANKS                                   CSC011
     C                     CALL 'ZAGENTS'                                 CSC011
     C                     PARM ZATMST    ZATMST 26                       CSC011
     C                     MOVE ZATMST    TSTISO                          CSC011
     C                     ELSE                                           CSC011
     C                     MOVE PITDST    WPITDS                          CSC011
     C                     MOVE WPIDD     TSTDD                           CSC011
     C                     MOVE WPIMM     TSTMM                           CSC011
     C                     MOVELWPICC     TSTYY                           CSC011
     C                     MOVE WPIYY     TSTYY                           CSC011
     C                     MOVE PITTST    WTSTM                           CSC011
     C                     MOVE WTSHR     TSTTM1                          CSC011
     C                     MOVE WTSMN     TSTTM2                          CSC011
     C                     MOVE WTSSC     TSTTM3                          CSC011
     C                     MOVE '000000'  TSTTM4                          CSC011
     C                     ENDIF                                          CSC011
     C                     MOVE TSTISO    STMST                           CSC011
     C*                                                                   CSC011
     C                     WRITELEILAMDL                                  CAP061
      *                                                                   CSC011
      * If Support System active, write transaction to 24x7 log           CSC011
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
      *                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
      *                                                                   CSC011
      * Convert Loan Amendment to PINPP format                            CSC011
     C                     EXSR LOG247                                    CSC011
      *                                                                   CSC011
      * Write invalid Loan Amendment in PINPP format to 24x7 Log File     CSC011
     C                     MOVE 'I'       LOGVAL  1                       CSC011
     C                     EXSR APLGTR                                    CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     COMIT                                          CAP061
     C                     ELSE                                           CAP061
     C***********CAP061    IFNE 'Y'                                 CAP061202539
     C                     DUMP                                           120468
     C***********          ENDIF                                    CAP061202539
     C                     ENDIF                                          CAP061
     C                     ENDIF                                          120468
      *                                                                   120468
      ** If not a warning error, stop validation and return               CAP061
     C           POMSVR    IFEQ 'E'                                       CAP061
     C           PMODE     ANDEQ'B'                                       CAP061
     C           PIPLC     ANDEQ'B'                                       CAP061
     C           CAP061    ANDEQ'Y'                                       CAP061
     C                     MOVE *BLANK    POMSVR                          CAP061
     C                     MOVE '1'       *INLR                           CAP061
     C                     RETRN                                          CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      ** If not a warning error, stop validation and return
      ** ... if not in batch mode, with Lending API enchancements.        CAP061
      *
     C           POMSVR    IFEQ 'E'
     C           MSVR      OREQ 'E'
      *                                                                   CAP061
      ** Set up error flag for other processing.                          CAP061
      *                                                                   CAP061
     C                     MOVE 'Y'       CAP61E  1                       CAP061
      *                                                                   CAP061
     C           CAP061    IFNE 'Y'                                       CAP061
     C                     MOVE '1'       *INLR
     C                     RETRN
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ELSE                                           CAP061
      *                                                                   CAP061
     C                     MOVE 'N'       CAP61E                          CAP061
      *                                                                   CAP061
     C                     ENDIF
      *
     C                     ENDSR
      *                                                                   CAP061
      /EJECT                                                              CAP061
      *****************************************************************   CAP061
      * SETSIN  -  Screen setup from invalid data                     *   CAP061
      * Called by: SRSDET - Setup Detail Screens                      *   CAP061
      * Calls    : None                                               *   CAP061
      *****************************************************************   CAP061
     C           SETSIN    BEGSR                                          CAP061
      *                                                                   CAP061
     C                     MOVE ISLOAN    SLOAN                           CAP061
     C                     MOVE ISATYP    SATYP                           CAP061
     C                     MOVE ISVDAT    SVDAT                           CAP061
     C                     MOVE ISSEQN    SSEQN                           CAP061
     C                     MOVE IWLSNA    WLSNA                           CAP061
     C                     MOVE ISCNUM    SCNUM                           CAP061
     C                     MOVE ISLTYP    SLTYP                           CAP061
     C                     MOVE ISSTYP    SSTYP                           CAP061
     C                     MOVE ISMDAT    SMDAT                           CAP061
     C                     MOVE ISBRAT    SBRAT                           CAP061
     C                     MOVE ISRTSP    SRTSP                           CAP061
     C                     MOVE ISCURR    SCURR                           CAP061
     C                     MOVE ISAMNT    SAMNT                           CAP061
     C                     MOVE ISSTPA    SSTPA                           CAP061
     C                     MOVE ISFRAT    SFRAT                           CAP061
     C                     MOVE ISDFTP    SDFTP                           CAP061
     C                     MOVE ISSPI1    SSPI1                           CAP061
     C                     MOVE ISSPI2    SSPI2                           CAP061
     C                     MOVE ISSPI3    SSPI3                           CAP061
     C                     MOVE ISDFST    SDFST                           CAP061
     C                     MOVE ISFSCY    SFSCCY                                              CLE031
     C                     MOVE ISFSCY    SFSCCY                                              CLE031
     C                     MOVE ISFPCY    SFPSCY                                              CLE031
     C                     MOVE ISREXR    SFREXR                                              CLE031
     C                     MOVE ISPEXR    SFPEXR                                              CLE031
     C                     MOVE ISREXI    SFREXI                                              CLE031
     C                     MOVE ISPEXI    SFPEXI                                              CLE031
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVELISSTAL    SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      *                                                                   CAP061
      ** Set up VDAYNO from value date                                    CAP061
      *                                                                   CAP061
     C                     MOVE SVDAT     ZDATE                           CAP061
     C                     EXSR ZDATE1                                    CAP061
     C                     Z-ADDZDAYNO    VDAYNO                          CAP061
      *                                                                   CAP061
     C                     ENDSR                                          CAP061
      *                                                                   CAP061
      /EJECT                                                              CAP061
      *****************************************************************   CAP061
      * SRIN2   -  Alternate initialise for screen                    *   CAP061
      * Called by: SRPROC - Subfile Detail Processing                 *   CAP061
      * Calls    : None                                               *   CAP061
      *****************************************************************   CAP061
     C           SRIN2     BEGSR                                          CAP061
      *                                                                   CAP061
     C                     MOVE USER      SUSER                           CAP061
     C                     MOVE BJMRDT    SRUNA                           CAP061
     C                     MOVE WSID      SWSID                           CAP061
     C                     MOVE 'Y'       PMFRST                          CAP061
     C                     MOVE *BLANK    FLG1                            CAP061
     C                     MOVE *BLANK    WWERR                           CAP061
     C                     MOVE *BLANK    WWFLG                           CAP061
     C                     MOVE *BLANK    WSKIP                           CAP061
     C                     MOVE *BLANK    WACCPT                          CAP061
     C                     MOVE *BLANK    WSCRNB                          CAP061
     C                     MOVE *BLANK    WSD                             CAP061
      *                                                                   CAP061
     C                     MOVEA'00'      *IN,22                          CAP061
     C                     MOVEA'000'     *IN,26                          CAP061
     C                     MOVEA'00000'   *IN,30                          CAP061
     C                     MOVEA'00000'   *IN,35                          CAP061
     C                     MOVEA'00000'   *IN,40                          CAP061
     C                     MOVEA'000'     *IN,45                          CAP061
     C                     MOVEA'00'      *IN,49                          CAP061
     C                     MOVEA'0000'    *IN,52                          CAP061
      *                                                                   CAP061
      ** Extra processing to fill in other fields - change as required.   CAP061
      *                                                                   CAP061
     C                     MOVE SLNRF     SLOAN                           CAP061
     C                     Z-ADDSLDTE     VDAYNO                          CAP061
     C                     MOVE SLMTP     SATYP                           CAP061
     C                     MOVE SSQNO     SSEQN                           CAP061
     C                     MOVE SLNRF     WKLNR                           CAP061
     C                     MOVE 'A'       WRCDT                           CAP061
     C                     MOVE 'SP'      WWBACK                          CAP061
      *                                                                   CAP061
      ** Loan must exist in loans file                                    CAP061
      *                                                                   CAP061
     C           KLKEY     CHAINCLOAN               N79                   CAP061
      *                                                                   CAP061
      ** Save some file fields from loans file                            CAP061
      *                                                                   CAP061
     C           *IN79     IFEQ '0'                                       CAP061
     C**********           MOVE LNRF      CLNRF   60                                   CAP061 CLE148
     C                     MOVE LNRF      CLNRF   6                                           CLE148
     C                     MOVE BRCA      WLBRC   3                       CAP061
     C                     MOVE VDAT      VDATX   50                      CAP061
     C**********           MOVE CNUM      WLCNO   60                                   CAP061 CSD027
     C                     MOVE CNUM      WLCNO   6                                           CSD027
     C                     MOVE CCYD      WLCUR   3                       CAP061
     C                     MOVE LTYPA     SLTYP                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
      *                                                                   CAP061
     C                     ENDSR                                          CAP061
      /EJECT                                                              CAP061
      *****************************************************************   CAP061
      * SRDLT   -  Delete a record from the invalid file with program *   CAP061
      *            LE2031.                                            *   CAP061
      * Called by: SRSDET - Setup Detail Screens                      *   CAP061
      * Calls    : LE2031   - Invalid lending transaction maintenance *   CAP061
      *****************************************************************   CAP061
     C           SRDLT     BEGSR                                          CAP061
      *                                                                   CAP061
      ** Set up reference number for call.                                CAP061
      *                                                                   CAP061
     C                     MOVE XREPN     IREPN   50                      CAP061
      *                                                                   CAP061
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
      *                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     MOVE 'Y'       SUPSYS  1                       CSC011
     C                     ELSE                                           CSC011
     C                     MOVE 'N'       SUPSYS                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     CALL 'LE2031'                                  CAP061
      *                                                                   CAP061
      ** INPUTS                                                           CAP061
      ** Invalid file name                                                CAP061
      *                                                                   CAP061
     C                     PARM 'LEILAMPD'INVFIL  8                       CAP061
      *                                                                   CAP061
      ** Repair Number                                                    CAP061
      *                                                                   CAP061
     C                     PARM           IREPN                           CAP061
      **Support*System On                                                              CSC011 222373
     C**********           PARM SUPSYS    SUPSYS                                       CSC011 222373
      **Front*Office ID / PC Transaction Reference                                     CSC011 222373
     C**********           PARM STNRF     STNRF                                        CSC011 222373
      **Transaction Timestamp                                                          CSC011 222373
     C**********           PARM STMST     STMST                                        CSC011 222373
      **********                                                                       CSC011 222373
      *                                                                   CAP061
      ** Clear error messages.                                            CAP061
      *                                                                   CAP061
     C                     EXSR CLEAR                                     CAP061
      *                                                                   CAP061
      ** Re-display subfile after delete and return.                      CAP061
      *                                                                   CAP061
     C                     MOVE 'S0'      WFMT                            CAP061
      *                                                                   CAP061
     C                     ENDSR                                          CAP061
      *                                                                   CAP061
      /EJECT                                                              CAP061
      *****************************************************************   CAP061
      * ERROUT  -  Write a record to the invalid file                 *   CAP061
      *                                                               *   CAP061
      * Called by: SRINIT - Initial Processing                        *   CAP061
      * Calls    :                                                    *   CAP061
      *****************************************************************   CAP061
     C           ERROUT    BEGSR                                          CAP061
      *                                                                   CAP061
      ** Write out to error file if repair location is 'B' in batch       CAP061
      ** mode.                                                            CAP061
      *                                                                   CAP061
     C           PIPLC     IFEQ 'B'                                       CAP061
     C           CAP061    ANDEQ'Y'                                       CAP061
      *                                                                   CAP061
     C                     CALL 'LEC0215'                                 CAP061
     C                     PARM           XREPN                           CAP061
      *                                                                   CAP061
      ** Set up file fields.                                              CAP061
      *                                                                   CAP061
     C                     MOVELWLBRC     FBRCA                           CAP061
     C                     MOVELWLBRC     BRCAL                           CAP061
     C                     MOVELWLBRC     SBRCA                           CAP061
     C                     MOVELZAMSID    XMSID                           CAP061
     C                     MOVELPILOAN    LNRFL                           CAP061
     C                     Z-ADD61        PTYPL                           CAP061
     C                     MOVELPITUSR    IUSRL                           CAP061
     C                     Z-ADD*ZERO     NOPSL                           CAP061
     C                     MOVELBRCAL     FBRCA                           CAP061
     C                     MOVELSATYP     FAMTP                           CAP061
     C                     MOVELSVORBR    ORBRL                           CAP061
     C                     MOVELSCNUM     SCUSTN                          CAP061
     C                     MOVELSLOAN     SLNRF                           CAP061
     C                     MOVELIUSRL     SIUSR                           CAP061
     C                     MOVE SVDAT     ZDATE                           CAP061
     C                     EXSR ZDATE1                                    CAP061
     C                     EXSR ZDATE2                                    CAP061
     C                     MOVELZADATE    SVLDT                           CAP061
      *                                                                   CAP061
     C           SVMDAT    IFNE 0                                         CAP061
     C                     Z-ADDSVMDAT    ZDAYNO                          CAP061
     C                     EXSR ZDATE2                                    CAP061
     C                     MOVELZDATE     SMDAT                           CAP061
     C                     ELSE                                           CAP061
     C                     Z-ADD*ZEROS    ZDATE                           CAP061
     C                     MOVELZDATE     SMDAT                           CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     MOVELBBCSSN    SCSNM                           CAP061
     C                     MOVELFAMTP     SLMTP                           CAP061
     C                     MOVE SVLSTS    FASTS                           CAP061
     C                     MOVE SVLSTS    LSTSL                           CAP061
     C                     MOVE SVLSTS    SASTS                           CAP061
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PMRSCY    SFSCCY                                              CLE031
     C                     MOVE PMPSCY    SFPSCY                                              CLE031
     C                     MOVE PMREXR    SFREXR                                              CLE031
     C                     MOVE PMPEXR    SFPEXR                                              CLE031
     C                     MOVE PMREXI    SFREXI                                              CLE031
     C                     MOVE PMPEXI    SFPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                   CAP061
      ** Write to error file.                                             CAP061
      *                                                                   CAP061
     C                     MOVEASTAMP,1   STMST            Default Timestamp                  CPK015
     C                     WRITELEILAMP0                                  CAP061
     C                     COMIT                                          CAP061
      *                                                                   CAP061
     C                     ENDIF                                          CAP061
      *                                                                   CAP061
     C                     ENDSR                                          CAP061
      *                                                                   CAP061
      *
      /EJECT
      *****************************************************************   CSC011
      *  APLGTR  -  Write Loan Amendment transaction to the 24X7 Midas*   CSC011
      *             availability Log File                             *   CSC011
      *  Called by: SRWRIT,SRUPDT,SRBERR                              *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           APLGTR    BEGSR                                          CSC011
      *                                                                   CSC011
     C                     MOVEL'LE'      APMTYP                          CSC011
     C                     MOVE WMTYP6    APMTYP                          CSC011
     C                     MOVE TSTISO    APSTMS                          CSC011
     C                     MOVELWTREF     APSOFC                          CSC011
      *                                                                   CSC011
     C                     MOVELPINPP     APTRAN                          CSC011
      *                                                                   CSC011
     C           LOGVAL    IFEQ 'V'                                       CSC011
      *                                                                   CSC011
      *                                                                   CSC011
     C                     OPEN APVLOGPD                                  CSC011
     C                     WRITEAPVLOGD0                                  CSC011
     C                     CLOSEAPVLOGPD                                  CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C           LOGVAL    IFEQ 'I'                                       CSC011
      *                                                                   CSC011
     C                     OPEN APILOGPD                                  CSC011
     C                     WRITEAPILOGD0                                  CSC011
     C                     CLOSEAPILOGPD                                  CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     ENDSR                                          CSC011
      *                                                                   CSC011
      /EJECT                                                              CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
      *  LOG247  -  Convert fields to the format required to be       *   CSC011
      *             written to the 24x7 Midas Availability Log        *   CSC011
      *  Called by: SRUPDT                                            *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           LOG247    BEGSR                                          CSC011
      *                                                                   CSC011
     C           PMODE     IFNE 'B'                                       CSC011
     C                     CLEARPINPP                                     CSC011
     C                     MOVE WMTYP     PIMTYP                          CSC011
      *                                                                   CSC011
      ** If message type is blank then set it up.                         CSC011
      *                                                                   CSC011
     C           PIMTYP    IFEQ *BLANKS                                   CSC011
     C                     MOVE *BLANKS   WMTYP4  4                       CSC011
     C                     MOVE AMTP      WMTYP4                          CSC011
     C                     MOVEL'LA'      WMTYP4                          CSC011
     C                     MOVEL'LE'      WMTYP6  6                       CSC011
     C                     MOVE WMTYP4    WMTYP6                          CSC011
     C                     MOVELWMTYP6    PIMTYP                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     MOVE WTUSR     PITUSR                          CSC011
     C                     MOVE WTWST     PITWST                          CSC011
     C                     MOVE STNRF     PITREF                          CSC011
     C                     MOVE WTSEQ     PITSEQ                          CSC011
     C                     MOVE SACTN     PITACT                          CSC011
     C*                                                                   CSC011
     C                     CALL 'ZAGENTS'                                 CSC011
     C                     PARM ZATMST    ZATMST 26                       CSC011
     C                     MOVE ZATMST    TSTISO                          CSC011
     C*                                                                   CSC011
     C           PITDST    IFEQ *BLANKS                                   CSC011
     C                     MOVE TSTYY     WPIYY                           CSC011
     C                     MOVELTSTYY     WPICC                           CSC011
     C                     MOVE TSTMM     WPIMM                           CSC011
     C                     MOVE TSTDD     WPIDD                           CSC011
     C                     MOVE WPITDS    PITDST                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C* Setup the timestamp.                                              CSC011
      *                                                                   CSC011
     C                     MOVELTSTTM1    WSTM1   40                      CSC011
     C                     MOVE TSTTM2    WSTM1                           CSC011
     C                     MOVELTSTTM3    WSTM2   40                      CSC011
     C                     MOVELTSTTM4    WSTM3   20                      CSC011
     C                     MOVELWSTM1     PITTST                          CSC011
     C                     MOVE WSTM3     WSTM2                           CSC011
     C                     MOVE WSTM2     PITTST                          CSC011
     C*                                                                   CSC011
     C                     MOVE PONPAR    PINPAR                          CSC011
     C                     MOVE SLOAN     PILOAN                          CSC011
     C                     MOVE WPVDAT    PIVDAT                          CSC011
     C                     MOVE SSEQN     PIAMSQ                          CSC011
     C                     MOVE SCNUM     PICSNO                          CSC011
     C                     MOVE SCURR     PICURR                          CSC011
     C                     MOVE SAMNT     PIPAMT                          CSC011
     C                     MOVE SBRAT     PIBSRT                          CSC011
     C                     MOVE SRTSP     PIRTSP                          CSC011
     C                     MOVE SSTPA     PISTAC                          CSC011
     C                     MOVE SMDAT     PIMATD                          CSC011
     C                     MOVE SLTYP     PILTYP                          CSC011
     C                     MOVE SSTYP     PILSTP                          CSC011
     C                     MOVE SFRAT     PIFRAT                          CSC011
     C                     MOVE SSPI1     PISPI1                          CSC011
     C                     MOVE SSPI2     PISPI2                          CSC011
     C                     MOVE SSPI3     PISPI3                          CSC011
     C                     MOVE PMPSTM    PIPSTM                          CSC011
     C                     MOVE PMPONS    PIPONS                          CSC011
     C                     MOVE PMRVNO    PIPREC                          CSC011
     C                     MOVE PMCVMR    PICVMR                          CSC011
     C                     MOVE PMPOCN    PIPOCN                          CSC011
     C                     MOVE PMPOBN    PIPOBN                          CSC011
     C                     MOVE PMRCRN    PIRCRN                          CSC011
     C                     MOVE PMRCRA    PIRCRA                          CSC011
     C                     MOVE PMPIBN    PIPIBN                          CSC011
     C                     MOVE PMPIBA    PIPIBA                          CSC011
     C                     MOVE PMAWBN    PIAWBN                          CSC011
     C                     MOVE PMBENN    PIBENN                          CSC011
     C                     MOVE PMBENA    PIBENA                          CSC011
     C                     MOVE PMRSTM    PIRSTM                          CSC011
     C                     MOVE PMRONS    PIRONS                          CSC011
     C                     MOVE PMROCN    PIROCN                          CSC011
     C                     MOVE PMROBN    PIROBN                          CSC011
     C                     MOVE PMRIBN    PIRIBN                          CSC011
     C                     MOVE PMRIBA    PIRIBA                          CSC011
     C                     MOVE PMDTP1    PIDTP1                          CSC011
     C                     MOVE PMDTP2    PIDTP2                          CSC011
     C                     MOVE PMDTP3    PIDTP3                          CSC011
     C                     MOVE PMDTP4    PIDTP4                          CSC011
     C                     MOVE PMDCHG    PIDCHG                          CSC011
     C                     MOVE PMBTB1    PIBTB1                          CSC011
     C                     MOVE PMBTB2    PIBTB2                          CSC011
     C                     MOVE PMBTB3    PIBTB3                          CSC011
     C                     MOVE PMBTB4    PIBTB4                          CSC011
     C                     MOVE PMBTB5    PIBTB5                          CSC011
     C                     MOVE PMBTB6    PIBTB6                          CSC011
     C                     MOVE SDFTP     PIDFTP                          CSC011
     C                     MOVE SDFST     PIDFST                          CSC011
     C                     MOVE NRLI      PINRLI                          CSC011
     C                     MOVE ROLN      PIROLN                          CSC011
     C                     MOVE ROSN      PIROAS                          CSC011
     C                     MOVE ROBR      PIROBR                          CSC011
     C                     MOVE RORC      PIROCU                          CSC011
     C                     MOVE IUSR      PIIUSR                          CSC011
     C                     MOVE AUSR      PIAUSR                          CSC011
     C                     MOVE XUSR      PIXUSR                          CSC011
     C                     MOVE PCOBK     PIPCOB                          CSC011
     C                     MOVE PISCCY    PMPSCY                          CSC011
     C                     MOVE PIICCY    PMIC72                          CSC011
     C                     MOVE PIGASS    GASS                            CSC011
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PIPSCY    PMPSCY                                              CLE031
     C                     MOVE PIPEXR    PMPEXR                                              CLE031
     C                     MOVE PIREXR    PMREXR                                              CLE031
     C                     MOVE PIPEXI    PMPEXI                                              CLE031
     C                     MOVE PIREXI    PMREXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVELSSTAL     PISTAL                                              CLE034
     C                     ENDIF                                                              CLE034
     C*                                                                   CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     ENDSR                                          CSC011
      *                                                                   CSC011
      /EJECT                                                              CSC011
      *****************************************************************   CSC011
      *  LOGDEL  -  Delete record from 24x7 Midas availability log    *   CSC011
      *             file                                              *   CSC011
      *  Called by: SRWRIT                                            *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           LOGDEL    BEGSR                                          CSC011
      *                                                                   CSC011
     C                     MOVEL'LE'      W#MSGT  6                       CSC011
     C                     MOVEL'LA'      W#MST4  4                       CSC011
     C                     MOVE AMTP      W#MST4                          CSC011
     C                     MOVE W#MST4    W#MSGT                          CSC011
     C                     MOVELW#MSGT    KMTYPE                          CSC011
     C                     MOVE '  '      KMTYPE                          CSC011
     C                     MOVELSTNRF     KFOID                           CSC011
     C                     MOVE STMST     KTSTMP                          CSC011
      *                                                                   CSC011
     C                     OPEN APILOGL0                                  CSC011
     C           KAPLOG    CHAINAPILOGX0             99                   CSC011
     C           *IN99     IFEQ *OFF                                      CSC011
     C                     DELETAPILOGX0                                  CSC011
     C                     ENDIF                                          CSC011
     C                     CLOSEAPILOGL0                                  CSC011
      *                                                                   CSC011
     C                     ENDSR                                          CSC011
      *                                                                   CSC011
      /EJECT                                                              CSC011
     C/COPY WNCPYSRC,LEH00524
      /TITLE Set EIR Indicators                                                               CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  SEIRI1 - Set EIR Indicators to re-calculate.                 *                       CAS009
      *                                                               *                       CAS009
      *  Called By: SRWIRT, SRUPDT                                    *                       CAS009
      *  Calls:                                                       *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
      *                                                                                       CAS009
     C           SEIRI1    BEGSR                                                              CAS009
      *                                                                                       CAS009
     C                     MOVE *IN81     SVIN81  1                                           CAS009
      *                                                                                       CAS009
     C           WTRAN     CHAINLEEIRDD5             81                                       CAS009
      *                                                                                       CAS009
     C           *IN81     IFEQ '0'                                                           CAS009
     C           WVALD     ANDLEEIENDT                                                        CAS009
      *                                                                                       CAS009
     C                     MOVE 'Y'       EIRCAL                                              CAS009
      *                                                                                       CAS009
     C           WDELR     IFEQ 'Y'                                                           CAS009
     C           WADJP     OREQ 'Y'                                                           CAS009
     C                     MOVE 'Y'       EIADJP                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     UPDATLEEIRDD5                                                      CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     MOVE SVIN81    *IN81                                               CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      /EJECT                                                                                  CAS009
      *****************************************************************
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *  Calls    : SRPOUT - Return message Format (For Batch only)   *
      *****************************************************************
     C           *PSSR     BEGSR                                       **
      *
     C           @RUN      IFEQ *BLANK
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           PMODE     OREQ 'F'                                       CAP061
     C                     CALL 'DBERRCTL'
     C                     ENDIF                                          122889
     C***********          ELSE                                           122889
      *
     C           SATYP     IFNE 'PT'
     C           SATYP     ANDNE'PF'
     C********** PMODE     ANDNE'B'                                                  122889 AR870590
     C                     ROLBK
     C                     ENDIF
      *
     C           PMODE     IFEQ 'B'
     C**********           EXSR SRPOUT                                                      AR870590
     C                     MOVE 'D'       POMSVR
     C                     MOVE POMSVR    ZAMSVR                                              CLE031
     C**********           MOVE DBASE     POMSID                                            AR870590
     C**********           MOVELDBFILE    POMSTX                                            AR870590
     C                     MOVEL'LEL0035 'ZAMSID                                            AR870590
     C           ##RTCD    IFEQ '*RECLCK'                                                   AR868380
     C                     MOVEL'LEL0817 'ZAMSID                                            AR868380
     C                     ENDIF                                                            AR868380
     C                     EXSR SRPOUT                                                      AR870590
     C                     ENDIF
      *
     C           PMODE     IFEQ 'P'
     C                     MOVE L2040S    L2040F
     C                     MOVE 'E'       MSVR
     C                     MOVE DBASE     MSID
     C                     MOVELDBFILE    MSTX
     C                     UPDATLE2040D0
     C                     CLOSELE2040PD
     C                     ENDIF
      *
     C***********          ENDIF                                          122889
     C                     ENDIF
      *
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      *****************************************************************
      /EJECT                                                                                  CLE023
     C/COPY ZSRSRC,ZXRATEZ1                                                                   CLE023
      /EJECT                                                                                  CLE023
     C/COPY ZSRSRC,ZCONVZ1                                                                    CLE023
      /EJECT                                                                                  CLE023
     C/COPY ZSRSRC,ZALIGNZ2
     C/COPY ZSRSRC,ZEDITZ2
     C/COPY ZSRSRC,ZDATE1Z2
     C/COPY ZSRSRC,ZDATE2Z2
     C/COPY ZSRSRC,ZACCH
     C/COPY ZSRSRC,ZCHKH
     C/COPY ZSRSRC,ZTNLU1Z2
     C/COPY ZSRSRC,ZFWDT
     C/COPY ZSRSRC,GLINTCZ1                                               138866
     C/COPY ZSRSRC,ZINTDYZ2                                               138866
     C/COPY ZSRSRC,ZDATE9Z3                                               138866
     C/COPY ZSRSRC,ZDAT10Z2                                               138866
      *
      ** Output LTRIX header record
      *
     O*LTRIX***E                LTRIXH                                                      AR322732
     O**********               NORE      11P                                                AR322732
     O**********               RRNA      20P                                                AR322732
     O**********               NLAR      32P                                                AR322732
     O**********               NATN      40P                                                AR322732
      *
      ** Output LTRIX detail record
      *
     O********E*               LTRIXD                                                       AR322732
     OLTRIX   EADD             LTRIXD                                                       AR322732
     O                                    2 'DA'
     O                         SLOAN      8
     O                         VDAYNO    13
     O***********              SSEQN     16                               144096
     O                         W#LASN    16                               144096
     O***********              SACTN     17                               126309
     O                         CHTP      17                               126309
     O                                   18 'N'
     O                                   19 'N'
     O                                   25 '00001'
     O                                   26 'N'
     O                         PRI1      27
     O                         BRCA      34
     O                         RRNA      37P
     O                         NATN      40P
     O                                   43 '000'                                           AR322732
     O                                   44 ' '                                             AR322732
     O                                   45 ' '                                             AR322732
     O/COPY WNCPYSRC,LE2040O001
      /EJECT
** STAMP - Dummy timestamp                                                                    CPK015
0001-01-01-00.00.00.000000                                                                    CPK015
** CWA - Array for watch list fields                                                          CSD015
<Receipt Nostro>                                                                              CSD015
</Receipt Nostro>                                                                             CSD015
<Receipt Intermed Bank>                                                                       CSD015
</Receipt Intermed Bank>                                                                      CSD015
<Receipt Ordering Bank>                                                                       CSD015
</Receipt Ordering Bank>                                                                      CSD015
<Receipt Ordering Cust>                                                                       CSD015
</Receipt Ordering Cust>                                                                      CSD015
<Payment Nostro>                                                                              CSD015
</Payment Nostro>                                                                             CSD015
<Payment Intermed Bank>                                                                       CSD015
</Payment Intermed Bank>                                                                      CSD015
<Payment Ordering Bank>                                                                       CSD015
</Payment Ordering Bank>                                                                      CSD015
<Payment Ordering Cust>                                                                       CSD015
</Payment Ordering Cust>                                                                      CSD015
<Receiver Correspondent>                                                                      CSD015
</Receiver Correspondent>                                                                     CSD015
<Receiver>                                                                                    CSD015
</Receiver>                                                                                   CSD015
<Account With Bank>                                                                           CSD015
</Account With Bank>                                                                          CSD015
<Beneficiary>                                                                                 CSD015
</Beneficiary>                                                                                CSD015
<Details Of Payment>                                                                          CSD015
</Details Of Payment>                                                                         CSD015
** CPY@
(c) Finastra International Limited 2001
** LATP ** Loan Amendment Type
PRINCIPAL INCREASE
SPREAD RATE CHANGE
BASE RATE CODE CHANGE
STOP/START ACCRUAL
LOAN SUB-TYPE
PAST DUE ITEM                                                             180044
**  POWER -- USED IN CURRENCY CONVERSION(FACILITY)                                            CLE023
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN    138866
00366007310109601461                                                      138866
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR       138866
00000000310005900090001200015100181002120024300273003040033400365         138866
