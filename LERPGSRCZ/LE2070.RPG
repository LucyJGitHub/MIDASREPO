     H        1
      *****************************************************************
/*OVR *: OVRDBF FILE(LEIROLLX) TOFILE(LEIROLL2) SHARE(*NO)          : *   CAP062
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Rollover input')                              *
      *****************************************************************
      *                                                               *
      *  Midas - Customer Lending Module                              *
      *                                                               *
      *  LE2070 - Rollover Input Maintenance                          *
      *                                                               *
      *  Function:  This is a new program for Rollover input.         *
      *             This could be run in any of the five modes        *
      *             available, depending on the parameter passed      *
      *             to it.                                            *
      *               1. Interactive ('I') - called from the Midas    *
      *                    Transaction Input menu                     *
      *               2. Record ('R') - Run interactively but updates *
      *                    are done to a new 'test harness' file      *
      *               3. Play ('P') - Run interactively or in batch   *
      *                    but data is read from the 'test harness'   *
      *                    file                                       *
      *               4. Batch ('B') - Run in batch and called by a   *
      *                    communications control program             *
      *               5. Repair ('F') - called from the Midas         *   CAP062
      *                    Transaction Input menu to repair invalid   *   CAP062
      *                    transactions.                              *   CAP062
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. CER050             Date 16Jun19               *
      *                 MD050139           Date 23Mar18               *
      *                 MD046248           Date 27Oct17               *
      *                 MD034840           Date 10Feb17               *
      *                 CGL184             Date 07Dec16               *
      *                 MD020567           Date 30May13               *
      *                 CLE154             Date 10Aug12               *
      *                 CLE141             Date 08Feb16               *
      *                 AR847588           Date 10Mar16               *
      *                 CSD095             Date 08Apr14               *
      *                 AR868380           Date 11Jun13               *
      *                 AR826115           Date 07Dec12               *
      *                 AR996895           Date 25Nov12               *
      *                 AR322732           Date 23Jul12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR820267           Date 25Aug11               *
      *                 CRE073             Date 06Dec10               *
      *                 CLE143             Date 06Dec10               *
      *                 CLE139             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 262328             Date 30Oct09               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      *                 CER047             Date 19May08               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 257336             Date 22Oct08               *
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 CRE026             Date 19Feb06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 227710             Date 21May04               *
      *                 CLE038             Date 11May04               *
      *                 CLE036             Date 22Oct03               *
      *                 CIR013             Date 25Apr05               *
      *                 CAS011             Date 16May05               *
      *                 230541             Date 08Nov04               *
      *                 CAS009             Date 04May04               *
      *                 CSW037A            Date 02May05               *
      *                 228390             Date 14Jul04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CDL031             Date 05Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CPK018             Date 15Nov03               *
      *                 222729             Date 03Nov03               *
      *                 222373             Date 28Oct03               *
      *                 218984             Date 10Oct03               *
      *                 220754             Date 15Sep03               *
      *                 221321             Date 12Sep03               *
      *                 221076             Date 10Sep03               *
      *                 219403             Date 22Jul03               *
      *                 CAP074             Date 08Aug02               *
      *                 CDE005             Date 23Aug02               *
      *                 CLE030             Date 25Sep02               *
      *                 CLE029             Date 04Sep02               *
      *                 CPK017             Date 14Sep03               *
      *                 218930             Date 19Jun03               *
      *                 218843             Date 17Jun03               *
      *                 217956             Date 31May03               *
      *                 CLE034             Date 05May03               *
      *                 CLE033             Date 09Apr03               *
      *                 216067             Date 20Mar03               *
      *                 215988             Date 19Feb03               *
      *                 CLE031             Date 17Mar03               *
      *                 CSF002             Date 11Aug03               *
      *                 CAS005             Date 16Dec02               *
      *                 CSD015             Date 14Oct02               *
      *                 CLE028             Date 27Jun02               *
      *                 207273             Date 07Aug02               *
      *                 CAS004             Date 26Jun02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 209026             Date 02Sep02               *
      *                 205771             Date 11Jun02               *
      *                 205506             Date 11Jun02               *
      *                 201672             Date 29Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 203095             Date 18Feb02               *
      *                 CLE023             Date 19Nov01               *
      *                 193859             Date 19Nov01               *
      *                 CSC011             Date 12Feb02               *
      *                 CAS001             Date 23Nov01               *
      *                 200967             Date 18Feb02               *
      *                 195070             Date 07Jan02               *
      *                 197084             Date 13Sep01               *
      *                 193701             Date 13Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CAP062             Date 11Jun01               *
      *                 193559             Date 06Jul01               *
      *                 175698             Date 26Jun01               *
      *                 194509             Date 19Jun01               *
      *                 CDE002             Date 04Apr00               *
      *                 188495             Date 14May01               *
      *                 CLE014             Date 20Mar01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 15May01               *
      *                 188804             Date 06Mar01               *
      *                 191223             Date 20Mar01               *
      *                 189632             Date 12Feb01               *
      *                 189229             Date 12Feb01               *
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CRT004             DATE 04MAY00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      *                 CDE001             Date 12Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 169211             Date 15Oct99               *
      *                 166578             Date 01Sep99               *
      *                 165976             Date 30Aug99               *
      *                 165977             Date 23Aug99               *
      *                 165974             Date 20Aug99               *
      *                 165968             Date 20Aug99               *
      *                 165969             Date 17Aug99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 152877             Date 08Jun99               *
      *                 134725             Date 26May99               *
      *                 157751             Date 13May99               *
      *                 159256             Date 11May99               *
      *                 158267             Date 14Apr99               *
      *                 158488 (BT0498)    Date 31Dec97               *
      *                 158487 (BT0669)    Date 10Apr98               *
      *                 158486 (BT0946)    Date 10Jul98               *
      *                 158483 (BT0696)    Date 21Aug98               *
      *                 155907             Date  5Mar99               *
      *                 154799             Date 25Feb99               *
      *                 151295             Date 25Feb99               *
      *                 153667             Date 25Feb99               *
      *                 153663             Date 25Feb99               *
      *                 152349             Date 25Feb99               *
      *                 135152             Date 25Feb99               *
      *                 134414             Date 25Feb99               *
      *                 133864             Date 25Feb99               *
      *                 133789             Date 25Feb99               *
      *                 131253             Date 25Feb99               *
      *                 153884             Date 16Feb99               *
      *                 155463             Date 16Feb99               *
      *                 147438             Date 30Dec98               *
      *                 150806             Date 22Dec98               *
      *                 144915             Date 28Oct98               *
      *                 144675             Date 27Oct98               *
      *                 144916             Date 20Oct98               *
      *                 144688             Date 15Oct98               *
      *                 144690             Date 14Oct98               *
      *                 144686             Date 12Oct98               *
      *                 143502             Date 05Oct98               *
      *                 143507             Date 29Sep98               *
      *                 132163             Date 25May98               *
      *                 CEU020             Date 13Mar98               *
      *                 CEU004             Date 02Feb98               *
      *                 121768             Date 19Feb98               *
      *                 128146             Date 29Dec97               *
      *                 127485             Date 22Dec97               *
      *                 127497             Date 22Dec97               *
      *                 CLE005             Date 08Aug97               *
      *                 126274             Date 21Nov97               *
      *                 123857             Date 21Oct97               *
      *                 122098             Date 13Oct97               *
      *                 123998             Date 10Oct97               *
      *                 123801             Date 06Oct97               *
      *                 123177             Date 02Oct97               *
      *                 121793             Date 26Sep97               *
      *                 120025             Date 25Sep97               *
      *                 123335             Date 24Sep97               *
      *                 123333             Date 23Sep97               *
      *                 123123             Date 17Sep97               *
      *                 123122             Date 17SEP97               *
      *                 121783             Date 14AUG97               *
      *                 121519             Date 06AUG97               *
      *                 120617             Date 17JUL97               *
      *                 120468             Date 09JUL97               *
      *                 120002             Date 07JUL97               *
      *                 119594             DATE 20JUN97               *
      *                 117441             Date 07May97               *
      *                 117216             Date 17Apr97               *
     F*                 117215             Date 17Apr97               *
     F*                 117214             Date 02Apr97               *
     F*                 CLE003             Date 23Dec96               *
      *                 CLE004 *Create     Date 02Dec96               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  MD050139- AOSARDR0 called every time causing performance     *
      *            issue. Recompile due to changes in /COPY           *
      *            ZFREQ/ZFRQ*.                                       *
      *  MD046248 - Finastra Rebranding                               *
      *  MD034840 - No error issued for input of base rate even if    *
      *             Base Rate Change Facility ICD is set to 'N'.      *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  MD020567 - FOOB in LEC06 00002. Fix is to ensure that CHTP   *
      *             for CLOANCL is updated correctly.                 *
      *  CLE154 - Loan Repayment Schedule Enhancement (Recompile)     *
      *  CLE141 - Currency and Location Business Day Convention       *
      *           (Recompile)                                         *
      *  AR847588 - Enable system to accept negative spread rate.     *
      *           - Applied for MD033488                              *
      *  CSD095 - Allow Deal Sub-Type and Branch for MM and FX SSIs   *
      *           (Recompile)                                         *
      *  AR868380 - APISERVER on LCKW status. Return *RECLCK to       *
      *             calling program if file locking occurred on       *
      *             online position files. (Child: AR868381)          *
      *  AR826115 - Allow rollover even if BPBCRF='N' in Lending ICD. *
      *             (Child: AR826116)                                 *
      *  AR996895 - Incorrect accrual interest calculation.           *
      *             (Child:AR996897) (Recompile)                      *
      *  AR322732 - LEC0212A and APISERVER locks LTRIX file.          *
      *           - Prevent LTRIX RRN 1 from being locked.            *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR820267 - Mapping error and Contractual Spread error not    *
      *             recognized                                        *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CLE143 - Original Loan Contract Date & Effective Interest    *
      *           Rate (Recompile)                                    *
      *  CLE139 - Lending Fee Capitalisation (Recompile)              *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  262328 - Serious Midas error occurred. Increase size of WBIC *
      *           array from 150 to 900.                              *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CER047 - German Features LF037-00 Reporting §24c             *
      *           (Recompile)                                         *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  257336 - COB: Component GLC0263 looping when processing more *
      *           than 100 branches (apply fix 240150)                *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CRE026 - Consumer Banking                                    *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  227710 - If F3 is pressed in the settlement programs, ensure *
      *           that all database changes are rolled back.          *
      *  CLE038 - Lending Enhancement for Nordea: Allocation by Amount*
      *  CLE036 - LE Enh for Nordea Phase 1 Pty 2 - Specific Base Rate*
      *  CAS011 - EIR/AC Accounting Upgrade to MP1                    *
      *  230541 - Error on Fwd Yield Curve even when it is not shown  *
      *  CAS009 - Effective Interest Rate/Amortised Cost Accounting   *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *  228390 - Introduce a new yield curve type 'S' (for swap      *
      *           rates) which will apply the formula currently being *
      *           used by curve type 'Z' and a new formula for type   *
      *           'Z' is to be introduced.                            *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CDL031 - Effective Date on Extended SSI (Recompile)          *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CPK018 - MidasPlus additional packaging.                     *
      *  222729 - Don't show 'Requires Release' if CLE030 is off.     *
      *  222373 - Parameter mismatch.                                 *
      *  218984 - Only change Next Interest Payment date if the       *
      *           interest payment frequency is 'R'. Note this can    *
      *           only be set if the Next interest payment date has   *
      *           been set.                                           *
      *           Also if a rollover where there will be a repayment  *
      *           or increase, need to produce shadow postings.       *
      *  220754 - Ensure all fields are sent to On line Updates. Call *
      *           AOOULEU0 (on line updates) if a multi currency      *
      *           rollover.                                           *
      *         - Some multi-currency rollovers did not produce any   *
      *           shadow postings. Some rollovers from Loan Manager   *
      *           were rejected by Midas. All the RO records on       *
      *           LEHOSTPD had action type = 'Reverse'.               *
      *         - Multi-currency rollovers need to be processed       *
      *           by the online updates.                              *
      *  221321 - Pay Settlement Branch in batch being got from       *
      *           Receive settlement details                          *
      *  221076 - Change message LEV1066 to a warning so Loan         *
      *           Manager transactions will not be rejected           *
      *  220754 - Multi-currency rollovers need to be processed       *
      *           by the online updates                               *
      *  219403 - 'See second level text' should not appear on Loan   *
      *           Manager.                                            *
      *  CAP074 - Lending API enhancements - Loans input.             *
      *  CDE005 - Data Export - Reservation ID                        *
      *  CLE030 - Release Authorisation processing                    *
      *  CLE029 - Addition of Severity code and Limit ID to FCLTYFM   *
      *  CPK017 - Midas Plus packaging.  Clash of field names.        *
      *  218930 - Amendment to 217956 - strange character in message  *
      *           LEV1070. Zeroize available amount if it is negative.*
      *  218843 - Amendment to original 217956 (Loan Manager interface*
      *           failed with divide by zero error).                  *
      *  217956 - Message LEV1066 returned to Loan Manager although   *
      *           New Principal Amount had been calculated correctly. *
      *  CLE034 - Lending Enhancements.                               *
      *  CLE033 - Settlement method 09                                *
      *  216067 - If batch mode do not cause d/b error when System    *
      *           Value LoanCustOriginPurch not present. Instead      *
      *           default to 'P' (purchased from customer)            *
      *  215988 - Facility exchange rate could not be inserted when   *
      *           BKEURO is equal to blank in SDGELRPD.               *
      *  CLE031 - Lending Enhancements.                               *
      *  CSF002 - Global layer.                                       *
      *           - Replace previous ZBACT* parameters with the new   *
      *             unique code.                                      *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  207273 - Forward Yield Curve Defaulting Error                *
      *           - Renumber message LEV1061 to LEV1066 for CAS001    *
      *             because this message id is already used by CLE023.*
      *  CAS004 - Hedge Accounting Phase A (Recompile)                *
      *  209026 - Check System Value LoanCustOriginPurch to decide if *
      *           original borrower should be used as the customer of *
      *           a Part Purchased instead of 'Purchased From' number.*
      *  205771 - Generate projections when rollover date defaults to *
      *           next interest payment date.                         *
      *  205506 - New Maturity Date must be mandatory if the rollover *
      *           date is equal to maturity date.                     *
      *           Next Interest Payment Date must not be equal or     *
      *           greater than maturity date when new maturity date   *
      *           is blank.                                           *
      *  201672 - Calculate projected interest and principal on       *
      *           maturity.                                           *
      *  203095 - Can enter backvalued rollover earlier than the last *
      *           multi-currency rollover                             *
      *  CLE023 - Lending Facility History Improvements               *
      *  193859 - New facility currency exchange rate is incorrect.   *
      *           Use old FCXR of loan and Euro rate of the loan ccy  *
      *           when defaulting new facility currency exchange rate *
      *           if multi-ccy rollover is from 'In' to Euro.         *
      *           Also amount and exchange rate should be amendable   *
      *           during multi-currency rollover from out currency.   *
      *           Apply fix 194771.                                   *
      *  CSC011 - 24x7 Midas Availability                             *
      *  CAS001 - Net Present Value (NPV) Accounting                  *
      *           Also ensure that message format in sync with file   *
      *           layout - CEU030 change missing.                     *
      *  200967 - Newly inserted base rate code not accepted as input *
      *  195070 - When rolling over to a new currency, display a      *
      *           message if the New ccy amount is not = the amount   *
      *           calculated by the program. If the amount entered is *
      *           within 5% tolerance of the calculated amount,       *
      *           display a warning message, otherwise display an     *
      *           error message and do not allow the input.           *
      *  197084 - Changed the condition for field BPAURV by comparing *
      *           it to 'Y' instead of 'N'.                           *
      *  193701 - Correct the condition which assigns value to WDFLT  *
      *           field to ensure EU0200 will not be called if an     *
      *           'Out' currency is involved in multi-ccy rollover.   *
      *  CAP062 - Lending API enhancements - Rollover Input           *
      *  193559 - Next rollover date is not shown on LERI subfile.    *
      *           Ensure that correct next rollover date will be      *
      *           shown.                                              *
      *  175698 - Default new interest date to rollover date only if  *
      *           interest payment frequency is 'R'.                  *
      *  194509 - Amended Transactions go to Re-auth and then complete*
      *  CDE002 - Revenue Analysis                                    *
      *  188495 - Rename TNLU from CLOANCK                            *
      *  CLE014 - Customer Driven Lending Enhancements                *
      *  CSD006 - Use long DS with SDBSRTPD.                          *
      *  188804 - Incorrect message displayed when entry in the New   *
      *           Interest Payment Date field is actually correct.    *
      *  191223 - Base rate should not default when blanked out.      *
      *  189632 - Window processing not included                      *
      *  189229 - In authorisation, err msg LEV0139 is shown          *
      *           although the base rate code is defined              *
      *  CLE011 - Rollover Rate Fixing Day Enhancement                *
      *  CRT004 - Cashier Midas TCP/IP interface.                     *
      *             Recompiled over SDBRCHPD Changes                  *
      *  CIR004 - Dealing Calculation Method Change.                  *
      *         - Recompiled due to GLINTC and ZINTDY changes         *
      *  CDE001 - Data Export - CCRM Limits                           *
      *  169211 - Rename TNLU field from FCLTY to prevent 'Updated by *
      *           another Workstation' message appearing incorrectly. *
      *  166578 - EMU rollover from Loan Manager rejected by Midas    *
      *  165976 - ECIN value change from 'Y' to 'N' after re-amending *
      *           roll-over without entering new currency.            *
      *  165977 - New ccy amount should be the New principal amount   *
      *           in the new ccy for discounted loans.                *
      *  165974 - Rollover of parts purchased should accept original  *
      *           borrower in the customer field not purchased from.  *
      *  165968 - Allow multi-ccy rollover from 'out' ccy to Euro if  *
      *           Syndicated Lending Enhancement is switched on       *
      *  165969 - Issue warning message 'LEM0232' on next amend of    *
      *           syndicated loan when entered on first screen.       *
      *  152877 - Settlement screen not shown for multi-currency      *
      *           rollovers which are not Euro related.               *
      *  134725 - PSAM does not get updated when loan rolled over     *
      *           into new currency.                                  *
      *  157751 - Rollover to new currency failed on calculation  of  *
      *           new principal.                                      *
      *  159256 - Send interactive warning message if syndicated      *
      *           loan is amended via Midas.                          *
      *  158267 - Rollover date should be mandatory for multi-ccy     *
      *           rollover.                                           *
     F*  158488 - Shortname on subfile s/b that of original borrower  *
     F*           for Participations Purchased                        *
     F*  158487 - LEV1041 wrongly issued on authorize - key wrongly   *
     F*           set up                                              *
      *  158486 - LCD, CHTP on loan corrupted by batch mode           *
      *  158483 - Default next interest date to next rollover date
      *  155907 - Rollover rejected with LEV0288 error                *
      *  154799 - Recompiled due to changes in /COPY,ZACCH            *
      *  151295 - Problems authorising repayment schedules            *
      *           Recompiled due to changes in ZCHKH                  *
      *  153667 - Rollover type 'Z' should allow blank or 0 irregular *
      *           rollover period                                     *
      *  153663 - Automatic unlinking no longer required.             *
      *  152349 - Error is issued when new Rollover Date is less      *
      *           than RLDT i.e. what it was before we tried to amend *
      *           This is wrong - check s/b against last Rollover     *
      *           Date, obtained from HISTSHQ.  Display last roll     *
      *           date when issuing LEV1040.                          *
      *  135152 - There needs to be a separate standard settlement    *
      *           instruction transaction type for Lending - use of   *
      *           'MM' is not sufficiently flexible                   *
      *  134414 - The settlement details for method '05' are not set  *
      *           up correctly.                                       *
      *  133864 - Settlement instructions sent up from the PC are     *
      *           being over written by the default set.              *
      *  133789 - Fee Settlements '05' are defaulting to the account  *
      *           but not including the branch.                       *
      *  131253 - Accept amendment when CLE005 is *ON and RATF in     *
      *           CLOANCL is 'Y' even if RECI is 'M'.                 *
      *  153884 - Error on new facility exchange rate when facility   *
      *           ccy is Euro.                                        *
      *  155463 - Interest details being zeroised when amending other *
      *           rollover details.                                   *
      *  147438 - Do not update interest date with rollover date      *
      *           if loan repayment type is not 2.                    *
      *  150806 - Fac ccy and base ccy exchange rate too short to     *
      *           receive ITL rates. Recompiled only due to changed   *
      *           display file.                                       *
      *  144915 - Bring up both sides of the settlement details when  *
      *           it is a multi-ccy rollover to euro.                 *
      *  144675 - Multi-ccy rollover defaults are not being shown on  *
      *           the screen prior to getting accepted.               *
      *  144916 - After a multi-ccy rollover with change of base rate,*
      *           the outstanding interest is calculated with the     *
      *           new base rate but for the old ccy.                  *
      *  144688 - Include all types of loan that can be rolled over.  *
      *         - Applied fix 136103 and 142393.                      *
      *  144690 - Discount calculated by the system is wrong because  *
      *           of zero next rollover date.                         *
      *  144686 - Error msgs for multi-ccy rollover appear even if    *
      *           no details entered or fields not shown.             *
      *  143502 - Defaults multipy/divide ind. to 'D' if facility or  *
      *           base ccy is equal to Euro ccy for multi-ccy rollover*
      *  143507   Defaults value for new ccy amt and repay amt.       *
      *           for EMU Multi-ccy rollover                          *
      *  132163 - NLRA is mandatory even if no repayment info for loan*
      *  CEU020 - EMU Lending Multi-currency Rollover                 *
      *  CEU004 - LE Settlement Ccy conversion Upgrade to DBA R2.0    *
     F*  121768 - Recompile over changed GLINTCZ1                     *
      *  128146 - (Mode 'I') Should be possible to enter a next       *
      *           rollover date without amending the rollover date.   *
      *           Also, fix incorrect check for rollover freq. = 0    *
      *           when setting up next rollover date field            *
      *  127485 - The validation for the base rate when it is a multi *
      *           ccy rollover is incorrect.                          *
      *  127497 - In authorisation mode the wrong field is used to    *
      *           retrieve the base rate code for new disc amount.    *
      *  CLE005 - Customer Lending Enhancements - Tranche 3           *
      *  126274 - The subfile review screen should show the customer  *
      *           short name.                                         *
      *  123857 - Additional authorisation option to go through all   *
      *           screens and pressing ENTER key to authorise at end. *
      *           Also, validate detail screen on authorisation       *
      *  122098 - Allow Rollovers for Discount PP/PSs with validation *
      *           similar to a discount loan                          *
      *  123998 - Texts should be coming from message subfile         *
      *  123801 - Return exact settlement detail error in batch mode  *
      *  123177 - Unlink from a syndicate only when linked            *
      *  121793 - New currency amount should be within 1 unit of ccy  *
      *         - In batch mode, new currency could equal loan or     *
      *           facility currency                                   *
      *  120025 - Loan number on review field must be numeric         *
      *         - Settlement details are required for multi-ccy       *
      *           rollovers                                           *
      *  123335 - Include new base currency exchange rate/indicator   *
      *         - Change existing exchange rate/ind to refer to fclty *
      *  123333 - Calculation of new currency amount does not take    *
      *           into account currency decimal places.               *
      *  123123 - Irregular rollover period should only be checked    *
      *           if rollover type is 'Z'                             *
      *  123122 - Some settlement details have been blanked out       *
      *  121783 - Call new access object AOBRCHR1 instead of AOBRCHR0 *
      *           (uses the long data structure DSSDY)                *
      *  121519 - Rollover PC Ref has last three chars truncated.     *
      *  120617 - Rollback should not be performed in batch mode.     *
      *           Error flag not set.                                 *
      *  120468 - Include a DUMP in ZASNMS subroutine for Batch and   *
      *           Play modes.                                         *
      *  120002 - If processing in batch mode, then status of         *
      *           transaction should always be set to 'A'.            *
      *         - Number of items in batch on return message is       *
      *           corrupted.                                          *
      *         - program perform COMIT operation while in batch mode *
      *  119594 - SD2400 should not be called when running in         *
      *           Batch or Play mode.                                 *
      *  117441 - Check that a base rate history record exists        *
      *           when base rate code is changed, or when a new date  *
      *           is applied to an existing base rate code.           *
      *           Similar already exists in loan amendments le0040.   *
      *  117216 - Incorrect conditioning of output fields which       *
      *           relate to discounted loans.                         *
      *  117215 - 085345 should not be done if rollover is            *
      *           backvalued - it causes b/v interest payments        *
      *  117214 - If CLE003 is on, then backvaluation of rollover to  *
      *           start date must be permitted                        *
      *  CLE003 - Backvaluation in Customer Lending Enhancements      *
      *  CLE004 - Customer Lending Enhancements - Syndications.       *
      *                                                               *
      *****************************************************************
     FLE2070DFCF  E                    WORKSTN                        UC
     F                                        SRRN  KSFILE LE2070S0
     FCLOAN   UF  E           K        DISK         KINFSR *PSSR
     F            CLOANHHF                          KIGNORE
     F            CLOANZ1F                          KIGNORE
     F                                              KCOMIT
     F***LTRIX***UF  F      43            DISK         KINFSR *PSSR                         AR322732
     FLTRIX   O   F      45            DISK         KINFSR *PSSR A                          AR322732
     F                                              KCOMIT
     FSDBSHSL1IF  E           K        DISK                               117441
     FLE2070PDUF  E                    DISK         KINFSR *PSSR A    UC
     FLELOANL2IF  E           K        DISK
     F            CLOANCKF                          KRENAMELOANL2F
     FLELOANL3IF  E           K        DISK
     F            CLOANCKF                          KRENAMELOANL3F
     FLEFCLTL0IF  E           K        DISK
     FLELOAML0IF  E           K        DISK
     FLEHISTL1IF  F     148  6AI    12 DISK                               152349
      *                                                                   159256
     F**********FCLTY   IF  E           K        DISK         KINFSR *PSSR             159256 CLE031
     FFCLTY   UF  E           K        DISK         KINFSR *PSSR                              CLE031
     F            FCLTYFMF                          KRENAMEFCLTY2F        159256
     F            FCLTYHHF                          KIGNORE               159256
     F            FCLTYZZF                          KIGNORE               159256
      ** Customer Lending Facility file                                   159256
      *                                                                   159256
     FPSOLD   IF  E           K        DISK         KINFSR *PSSR          134725
     F            CLOANCLF                          KRENAMEPSOLDFF        134725
     FSDEXSTL0IF  E           K        DISK         KINFSR *PSSR          166578
      *                                                                   CAP062
     FLEIROLPDO   E                    DISK                           UC  CAP062
     F                                              KCOMIT                CAP062
      ** Invalid Rollover Details                                         CAP062
      *                                                                   CAP062
     FLERELEPDO   E                    DISK                      A        CLE030
     F                                              KCOMIT                CLE030
     FLEIROLL1IF  E           K        DISK                           UC  CAP062
     F            LEIROLP0                          KRENAMELEIROLP1       CAP062
      ** Invalid Rollover Details by Loan Reference and Repair Number     CAP062
      *                                                                   CAP062
     FLEIROLL2IF  E           K        DISK                           UC  CAP062
     F            LEIROLP0                          KRENAMELEIROLP2       CAP062
      ** Invalid Rollover Details by Repair Number                        CAP062
      *                                                                   CAP062
     FLEIROLLXUF  E           K        DISK                           UC  CAP062
     F            LEIROLP0                          KRENAMELEIROLDL       CAP062
     F                                              KCOMIT                CAP062
     FLEEIRDL5UF  E           K        DISK                                                   CAS009
     F                                              KCOMIT                                    CAS009
      **                                                                  CAP062
      *                                                                   CAP062
      **  24/7 Midas Availability log file                                CSC011
     FAPILOGL0UF  E           K        DISK                           UC  CSC011
     F            APILOGD0                          KRENAMEAPILOGX0       CSC011
     FAPVLOGPDO   E                    DISK                           UC  CSC011
     F                                              KCOMIT                CSC011
     FAPILOGPDO   E                    DISK                           UC  CSC011
     F                                              KCOMIT                CSC011
      *                                                                   CSC011
      **  Compliance Watch Hit List File                                                      CSD015
     FSDCWHTL1IF  E           K        DISK                                                   CSD015
      *                                                                                       CSD015
     FSDBRCHL5IF  E           K        DISK         KINFSR *PSSR                              CLE031
     FLEFERLL0UF  E           K        DISK         KINFSR *PSSR A                            CLE031
     FLEFEEDFCUF  E           K        DISK         KINFSR *PSSR                              CLE031
      *                                                                                       CLE031
     F/COPY WNCPYSRC,LE2070F001
      /SPACE 3
      *****************************************************************
      *                                                               *
      *    F U N C T I O N   O F   I N D I C A T O R S                *
      *                                                               *
      *    09           Chain for SDCWHTL1                            *                       CSD015
      *    22           Show 'Requires Release Option'                *                       222729
      *    24           Subfile next change                           *
      *    25           Message subfile end                           *
      *    26           Allow authorisation keys                      *
      *    27           Enable extended settlement key                *
      *    28           Protect detail screen fields                  *
      *    29           Enable Analytical Accounting fields           *
      *    30           Invalid action code (also for select field)   *
      *    31           Invalid loan number                           *
      *    32           Invalid review from field-initial (reserved)  *
      *    33           Invalid requiring authorisation flag-initial  *
      *    34           Error in subfile option record field          *
      *    35           Invalid review from field-subfile (reserved)  *
      *    36           Invalid requiring authorisation flag-subfile  *
      *    37           Error in Customer number                      *
      *    38           Error in Rollover date                        *
      *    39           Error in Rollover frequency code              *
      *    40           Error in Rollover frequency day number        *
      *    41           Error in New base rate code                   *
      *    42           Error in New spread/rate                      *
      *    43           Error in New spread indicator                 *
      *    44           Error in New interest calculation basis       *
      *    45           Error in New change indicator                 *
      *    46           Error in Next rollover date                   *
      *    47           Error in New principal amount                 *
      *    48           Error in New discount amount                  *
      *    49           Error in New interest payment date            *
      *    50           Error in New maturity date                    *
      *    51           Error in New currency code                    *
      *    52           Error in New currency amount                  *
      *    53           Error in Exchange rate                        *
      *    54           Error in Exchange indicator                   *
      *    55           Error in Next loan currency repayment amount  *
      *    56           Error in Special instructions line 1          *
      *    57           Error in Special instructions line 2          *
      *    58           Error in Special instructions line 3          *
      *    59           F11 is not allowed for authorisation          *   123857
      *    60           BLI Lending Enhancement                       *
      *    61           Multi-currency allowed by Loan facility       *
      *    62           Error in New funding spread/rate              *
      *    63           Error in New funding spread sign              *
      *    64           Error in New base ccy exchange rate           *   123335
      *    65           Error in New base ccy exchange rate indicator *   123335
      *    70           Authorisation required                        *
      *    71           CLE011 is switched on                         *   CLE011
      *    72           CLE011, Display Rollover Fixed Rate           *   CLE011
      *    73           Displays the Forward Yield Curve              *                       CAS001
      *    74           Error indicator for Forward Yield Curve       *                       CAS001
      *    79           EOF in the test harness file LE2070PD         *
      *    80           Work indicator in standard subroutines        *
      *    81           Display 'Page key' in subfile                 *
      *    82           Subfile clear (off=subfile display)           *
      *    83           Subfile display control, not subfile display  *
      *    84           CAP062 switched on.                           *   CAP062
      *    85           Work indicator                                *
      *    86           Work indicator                                *
      *    87           No more changed subfile record                *
      *    88           Rollup indicator                              *
      *    89           EOF in LELOANL2 or LELOANL3.                  *
      *                 PLUS RNF ON REDPE TO LEHISTL1                 *   152349
      *    90           Work indicator in standard subroutines        *
      *    91           Work indicator in standard subroutines        *
      *    92           Work indicator in standard subroutines        *
      *    93           Work indicator in standard subroutines        *
      *    94           Work indicator in standard subroutines        *
      *    95           Work indicator in standard subroutines        *
      *    96           Work indicator in standard subroutines        *
      *    97           Work indicator in standard subroutines        *
      *    98           System date format (*ON=by Month)             *
      *    99           Error in formatting amounts                   *
      *                                                               *
      *****************************************************************
      /EJECT
     E                    CPY@    1   1 80
      **  Array containing Copyright statement
      *
     E***********         STS     1   4 20                                123998
      ****Array*containing*Rollover*status*narratives                     123998
      *
     E                    FTAB    4   4  1
      **  Array containing valid frequency codes
      *
     E                    LNOST   3   3  2
      **  Array containing valid settlement types for loan ccy.
      ***********                                                  123333 123335
     E***********         PWR     1   7  7 3                       123333 123335
      ****Array*containing*powers*of*10.***************************123333 123335
      *
     E                    ACCYA      12  3
      **  Array containing warning message IDs
      *
     E***********         WARA        5  4                                123335
     E***********         WARA        6  4                         123335 134725
     E**********          WARA        7  4                         134725 CLE011
     E***********         WARA        8  4                                             CLE011 CLE023
     E***********         WARA        9  4                                             CLE023 CLE031
     E                    WRN        10  4                                                    CLE031
      **  Array containing warning message IDs
      *                                                                                       CLE031
     E                    RUNS       10  5 0A                                                 CLE031
      ** Facility expiry dates                                                                CLE031
      *                                                                                       CLE031
     E                    OAM        10 13 0                                                  CLE031
      ** Facility expiry amounts                                                              CLE031
      *                                                                                       CLE031
     E**********          WBIC      150  6 0                                           CLE031 CSD027
     E**********          WBIC      150  6                                             CSD027 257336
     E**********          WBIC      500  6                                             257336 262328
     E                    WBIC      900  6                                                    262328
      ** Branch internal customer array                                                       CLE031
      *
     E/COPY ZSRSRC,ZALIGNZ1
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZHOLE
     E/COPY ZSRSRC,ZFREQBZ1
     E/COPY ZSRSRC,ZDATE9Z1
     E/COPY ZSRSRC,ZF2CE
      *                                                                                       CSD015
     E                    CWA     1  26 25                                                    CSD015
      *                                                                                       CSD015
     E/COPY ZSRSRC,ZPOWERZ1                                               123335
     E/COPY ZSRSRC,ZFRPEDZ1                                                                   195070
     E/COPY WNCPYSRC,LE2070E001
      /EJECT
      *
     E                    WLF        12 35                                                    CSD015
     E                    SVALTX  1   1 20                                                    CLE148
      **  Watch List Fields Array.                                                            CSD015
      *                                                                                       CSD015
     ILE2070D0
      ** Rename Test Harness fields
     I              LNRF                            FLNRF
     I              ACTN                            FACTN
     I              RSTS                            FRSTS
     I              RLDT                            FRLDT
     I              RLFQ                            FRLFQ
     I              RLDY                            FRLDY
     I              NBRA                            FNBRA
     I              NRTS                            FNRTS
     I              NSIN                            FNSIN
     I              NCAS                            FNCAS
     I              NCHI                            FNCHI
     I              NROD                            FNROD
     I              NPRAM                           FNPRAM
     I              NDAM                            FNDAM
     I              NIPD                            FNIPD
     I              NMDT                            FNMDT
     I              NCCY                            FNCCY
     I              NCPA                            FNCPA
     I              NFCE                            FNFCE
     I              NFMD                            FNFMD
     I              NLRA                            FNLRA
     I              SPI1                            FSPI1
     I              SPI2                            FSPI2
     I              SPI3                            FSPI3
     I              NFRS                            FNFRS
     I              NFSN                            FNFSN
     I              NFPC                            FNFPC
     I              RRST                            FRRST
     I              RRON                            FRRON
     I              RRIB                            FRRIB
     I              RRBA                            FRRBA
     I              RROB                            FRROB
     I              RROC                            FRROC
     I              NBCE                            FNBCE                 123335
     I              NBMD                            FNBMD                 123335
     I              RPST                            FRPST                 120025
     I              RPON                            FRPON                 120025
     I              RPIB                            FRPIB                 120025
     I              RPBA                            FRPBA                 120025
     I              RPOB                            FRPOB                 120025
     I              RPOC                            FRPOC                 120025
     I              RRCR                            FRRCR                 120025
     I              RRCA                            FRRCA                 120025
     I              RRVN                            FRRVN                 120025
     I              RAWB                            FRAWB                 120025
     I              RAWA                            FRAWA                 120025
     I              RBEN                            FRBEN                 120025
     I              RBNA                            FRBNA                 120025
     I              RDP1                            FRDP1                 120025
     I              RDP2                            FRDP2                 120025
     I              RDP3                            FRDP3                 120025
     I              RDP4                            FRDP4                 120025
     I              RDCH                            FRDCH                 120025
     I              RBB1                            FRBB1                 120025
     I              RBB2                            FRBB2                 120025
     I              RBB3                            FRBB3                 120025
     I              RBB4                            FRBB4                 120025
     I              RBB5                            FRBB5                 120025
     I              RBB6                            FRBB6                 120025
     I              RCVM                            FRCVM                 120025
     I              RIUS                            FRIUS
     I              RAUS                            FRAUS
     I              RXUS                            FRXUS
     I              RRSC                            FRRSC                 CEU004
     I              RPSC                            FRPSC                 CEU004
     I              RICY                            FRICY                 CEU004
     I              RFYLDC                          FYLDC                                     CAS001
     I              RRSR                            FRRSR                                     CLE031
     I              RRSI                            FRRSI                                     CLE031
     I              RPSR                            FRPSR                                     CLE031
     I              RPSI                            FRPSI                                     CLE031
     I              STAL                            FSTAL                                     CLE034
     I              NBRT                            FNBRT                                     CLE036
      *
     ICLOANCLF
      ** Rename CLOANCL fields similar to CLOANCK.
     I              RCDT                            RCDTL
     I              CNUM                            CNUML                 169211
     I              PCOB                            PCOBL
     I              PCRF                            PCRFL
     I              TMST                            CLTMST                                    CPK017
     I              CHTP                            CHTPL                                   MD020567
      *                                                                   152349
     ICLOANCKF                                                            188495
      ** Rename CLOANCK fields similar to CLOANCL.                        188495
     I              TNLU                            TNLUK                 188495
     I              TMST                            CKTMST                                    CPK017
      *
     ILEHISTL1NS                                                          152349
     I                                       18  220VDATH                 152349
     I*LTRIX***NS       1 CH                                                                AR322732
      ***Transaction*index*header**************************************                     AR322732
     I**********                              1   1 RECIX                                   AR322732
     I**********                              2   2 RCDTX                                   AR322732
     I**********                              3   80LNRFX                                   AR322732
     I**********                          P   9  110NOREX                                   AR322732
     I**********                          P  12  140FLSZX                                   AR322732
     I**********                          P  15  170RRLCX                                   AR322732
     I**********                          P  18  200RRNAX                                   AR322732
     I**********                          P  21  230RRLXX                                   AR322732
     I**********                          P  24  260RRXPX                                   AR322732
     I**********                          P  27  290NLNRX                                   AR322732
     I**********                          P  30  320NLARX                                   AR322732
     I**********                             33  330STPIX                                   AR322732
     I**********                          P  38  400TNLUX                                   AR322732
      *
     I********NS       1 CD                                                                 AR322732
      ***Transaction*index*detail**************************************                     AR322732
     I**********                              1   1 RECIX                                   AR322732
     I**********                              2   2 RCDTX                                   AR322732
     I**********                              3   80LNRFX                                   AR322732
     I**********                              9  130VDATX                                   AR322732
     I**********                             14  160LASNX                                   AR322732
     I**********                             17  17 CHTPX                                   AR322732
     I**********                             18  18 CNRQX                                   AR322732
     I**********                             19  19 CNPRX                                   AR322732
     I**********                             20  20 REPRX                                   AR322732
     I**********                             21  250RRLAX                                   AR322732
     I**********                             26  26 LADIX                                   AR322732
     I**********                             27  270PRI1X                                   AR322732
     I**********                             32  34 BRCAX                                   AR322732
     I**********                          P  35  370RRNTX                                   AR322732
     I**********                          P  38  400TNLUX                                   AR322732
     I**********                             41  410PRI2X                                   AR322732
     I**********                             42  420PRI3X                                   AR322732
     I**********                             43  430PRI4X                                   AR322732
      *
      ** Catch all
      *
     I********NS                                                                            AR322732
     I**********                              1   1 RECID                                   AR322732
      *
     IFCLTYFMF
      ** Rename FCLTYFM fields.
     I              RECI                            RECIF
     I              CNUM                            CNUMF
     I              BRCA                            BRCAF
     I              FCCY                            FCCYF
     I              NACD                            NACDF
     I              CRSK                            CRSKF
     I              NAR1                            NAR1F
     I              NAR2                            NAR2F
     I              NAR3                            NAR3F
     I              NAR4                            NAR4F
     I              ACOF                            ACOFF
     I              ORBR                            ORBRF
     I              ORED                            OREDF
     I              LCD                             LCDF
     I              CHTP                            CHTPF
     I              TNLU                            TNLUF
     I              DFTP                            DFTPF
     I              DFST                            DFSTF
     I              IUSR                            IUSRF
     I              AUSR                            AUSRF
     I              XUSR                            XUSRF
     I              PCRF                            PCRFF
     I              RCSI                            RCSIF
     I              OSDB                            OSDBF
     I              OMDB                            OMDBF
     I              RSTM                            RSTMF
     I              RONS                            RONSF
     I              RIBN                            RIBNF
     I              RIBA                            RIBAF
     I              ROBN                            ROBNF
     I              ROCN                            ROCNF
     I              PSTM                            PSTMF
     I              PONS                            PONSF
     I              PIBN                            PIBNF
     I              PIBA                            PIBAF
     I              POBN                            POBNF
     I              POCN                            POCNF
     I              RCRN                            RCRNF
     I              RCRA                            RCRAF
     I              RVNO                            RVNOF
     I              AWBN                            AWBNF
     I              AWBA                            AWBAF
     I              BENN                            BENNF
     I              BENA                            BENAF
     I              DTP1                            DTP1F
     I              DTP2                            DTP2F
     I              DTP3                            DTP3F
     I              DTP4                            DTP4F
     I              DCHG                            DCHGF
     I              BTB1                            BTB1F
     I              BTB2                            BTB2F
     I              BTB3                            BTB3F
     I              BTB4                            BTB4F
     I              BTB5                            BTB5F
     I              BTB6                            BTB6F
     I              CVMR                            CVMRF
     I              SCCY                            ICCYF
     I              ICCY                            SCCYF
     I              REXR                            REXRF                                     CLE031
     I              REXI                            REXIF                                     CLE031
     I              PSCY                            PSCYF                                     CLE031
     I              PEXR                            PEXRF                                     CLE031
     I              PEXI                            PEXIF                                     CLE031
      *
     ILOAMSDKF
      ** Rename LOAMSDK fields.
     I              RECI                            RECIA
     I              LNRF                            LNRFA
     I              VDAT                            VDATA
     I              MRIN                            MRINA
     I              LTYP                            LTYPA
     I              SUTP                            SUTPA
     I              PTYP                            PTYPA
     I              BRTT                            BRTTA
     I              RTSP                            RTSPA
     I              CCY                             CCYA
     I              BRCA                            BRCAA
     I              CNUM                            CNUMA
     I              REPT                            REPTA
     I              AUTO                            AUTOA
     I              FACO                            FACOA
     I              SPI1                            SPI1A
     I              SPI2                            SPI2A
     I              SPI3                            SPI3A
     I              BRTE                            BRTEA
     I              SPIN                            SPINA
     I              WTIN                            WTINA
     I              FCUS                            FCUSA
     I              FTYP                            FTYPA
     I              FSEQ                            FSEQA
     I              INTC                            INTCA
     I              NACD                            NACDA
     I              FCLB                            FCLBA
     I              ORED                            OREDA
     I              LCD                             LCDA
     I              CHTP                            CHTPA
     I              TNLU                            TNLUA
     I              RSTM                            RSTMA
     I              RONS                            RONSA
     I              RIBN                            RIBNA
     I              RIBA                            RIBAA
     I              ROBN                            ROBNA
     I              ROCN                            ROCNA
     I              PSTM                            PSTMA
     I              PONS                            PONSA
     I              PIBN                            PIBNA
     I              PIBA                            PIBAA
     I              POBN                            POBNA
     I              POCN                            POCNA
     I              RCRN                            RCRNA
     I              RCRA                            RCRAA
     I              RVNO                            RVNOA
     I              AWBN                            AWBNA
     I              AWBA                            AWBAA
     I              BENN                            BENNA
     I              BENA                            BENAA
     I              DTP1                            DTP1A
     I              DTP2                            DTP2A
     I              DTP3                            DTP3A
     I              DTP4                            DTP4A
     I              DCHG                            DCHGA
     I              BTB1                            BTB1A
     I              BTB2                            BTB2A
     I              BTB3                            BTB3A
     I              BTB4                            BTB4A
     I              BTB5                            BTB5A
     I              BTB6                            BTB6A
     I              CVMR                            CVMRA
     I              FSRP                            FSRPA
     I              FSGN                            FSGNA
     I              FPRC                            FPRCA
     I              DFTP                            DFTPA
     I              DFST                            DFSTA
     I              MNSG                            MNSGA
     I              GASS                            GASSA
     I              GPRT                            GPRTA
     I              IUSR                            IUSRA
     I              AUSR                            AUSRA
     I              XUSR                            XUSRA
     I              PCRF                            PCRFA
     I              SCCY                            ICCYA
     I              ICCY                            SCCYA
     I              REXR                            REXRA                                     CLE031
     I              REXI                            REXIA                                     CLE031
     I              PSCY                            PSCYA                                     CLE031
     I              PEXR                            PEXRA                                     CLE031
     I              PEXI                            PEXIA                                     CLE031
     I              TMST                            LKTMST                                    CPK017
      *
     IFCLTY2F                                                             169211
      ** Rename fields                                                    169211
     I              TNLU                            TNLUF                 169211
     I              SCCY                            SCCYF                                     CLE031
     I              REXR                            REXRF                                     CLE031
     I              REXI                            REXIF                                     CLE031
     I              PSCY                            PSCYF                                     CLE031
     I              PEXR                            PEXRF                                     CLE031
     I              PEXI                            PEXIF                                     CLE031
     IFCLTYFNF                                                                                CLE031
      ** Rename fields                                                                        CLE031
     I              TNLU                            TNLUFN                                    CLE031
     ILOANL2F                                                                                 CPK017
     I              TMST                            L2TMST                                    CPK017
     ILOANL3F                                                                                 CPK017
     I              TMST                            L3TMST                                    CPK017
     IPSOLDFF                                                                                 CPK017
     I              TMST                            PSTMST                                    CPK017
     I***PINPP*******DS                            903                    123335
     I***PINPP***    DS                            918             123335 CEU020
     I***PINPP**     DS                            927                                 CEU020 CAS001
     IPINPP     E DSLEO1MFPD                                                                  CAS001
      ** Incoming PC transmitted message parameter
     I                                        1   4 PITYPE
     I                                        5  20 PITUSR
     I                                       21  36 PITWID
     I                                       37  51 PITREF
     I                                       52  55 PITSEQ
     I                                       52  550P#TSEQ                123177
     I                                       56  56 PIACTN
     I                                       57  64 PITDST
     I                                       65  72 PITTST
     I************                           73  75 PIPARR                120002
     I************                           76  80 PIZIL5                120002
     I                                       73  76 PIPARR                120002
     I                                       77  77 PIRPLC                CAP062
     I************                           77  80 PIZIL5          CAP062120002
     I                                       78  80 PIZIL5                120002
     I                                       81  86 PILNRF
     I                                       87  92 PICNUM
     I                                       93  93 PIRLFQ
     I                                       94  95 PIRLDY
     I                                       96 103 PIRLDT
     I                                      104 111 PINROD
     I                                      112 112 PINCAS
     I                                      113 114 PINBRA
     I                                      115 126 PINRTS
     I                                      127 127 PINSIN
     I                                      128 128 PINCHI
     I                                      129 142 PINPRA
     I                                      143 156 PINDAM
     I                                      157 164 PINIPD
     I                                      165 172 PINMDT
     I                                      173 184 PINFRS
     I                                      185 185 PINFSN
     I                                      186 189 PINFPC
     I                                      190 191 PIRPST
     I                                      192 206 PIRPON
     I                                      207 214 PIRRVN
     I                                      215 215 PIRCVM
     I                                      216 221 PIRPOC
     I                                      222 227 PIRPOB
     I                                      228 235 PIRRCR
     I                                      236 270 PIRRCA
     I                                      271 278 PIRPIB
     I                                      279 313 PIRPBA
     I                                      314 321 PIRAWB
     I                                      322 356 PIRAWA
     I                                      357 364 PIRBEN
     I                                      365 399 PIRBNA
     I                                      400 401 PIRRST
     I                                      402 416 PIRRON
     I                                      417 422 PIRROC
     I                                      423 428 PIRROB
     I                                      429 436 PIRRIB
     I                                      437 471 PIRRBA
     I                                      472 611 PIRDPI
     I                                      472 506 PIRDP1
     I                                      507 541 PIRDP2
     I                                      542 576 PIRDP3
     I                                      577 611 PIRDP4
     I                                      612 614 PIRDCH
     I                                      615 824 PIRBBI
     I                                      615 649 PIRBB1
     I                                      650 684 PIRBB2
     I                                      685 719 PIRBB3
     I                                      720 754 PIRBB4
     I                                      755 789 PIRBB5
     I                                      790 824 PIRBB6
     I                                      825 827 PINCCY
     I                                      828 841 PINCPA
     I                                      842 842 PINFMD
     I                                      843 856 PINFCE
     I                                      857 870 PINLRA
     I                                      871 880 PIRIUS
     I                                      881 890 PIRAUS
     I                                      891 900 PIRXUS
     I                                      901 903 PIPCOB
     I                                      904 904 PINBMD                123335
     I                                      905 918 PINBCE                123335
     I                                      919 921 PIRRSC                CEU004
     I                                      922 924 PIRPSC                CEU004
     I                                      925 927 PIRICY                CEU004
     I                                      928 938 PIECIN                                    CAS001
     I                                      929 933 PFYLDC                                    CAS001
     I                                      934 947 PIRRSR                                    CLE031
     I                                      948 948 PIRRSI                                    CLE031
     I                                      949 962 PIRPSR                                    CLE031
     I                                      963 963 PIRPSI                                    CLE031
     I                                      964 964 PISTAL                                    CLE034
     I                                      965 976 PIBASR                                    CLE036
      *
     IPOUTP       DS                            172
      ** Outgoing PC transmitted message parameter
     I                                        1   4 POTYPE
     I                                        5  20 POTUSR
     I                                       21  36 POTWID
     I                                       37  51 POTREF
     I                                       52  55 POTSEQ
     I                                       56  56 POACTN
     I                                       57  64 POTDST
     I                                       65  72 POTTST
     I************                           73  75 POPARR                120002
     I************                           76  80 POFIL5                120002
     I                                       73  76 POPARR                120002
     I                                       77  80 POFIL5                120002
     I                                       81  81 PORMSV
     I                                       82  88 PORMID
     I                                       89 166 PORMTX
     I                                      167 172 POLNRF
      *                                                                   189632
      /COPY QWINDSRC,LE2070GDTA                                           189632
      *
     IPARMDS      DS                           9999                                           CSD015
      ** Compliance Engine Free Format String Parameter.                                      CSD015
      *                                                                                       CSD015
     IA@CPY       DS
      * Copyright array
     I                                        1  80 CPY@
      *
     ILDA       E DSLDA                         256
      *
      ** Local data area for database error details
      **
      **                                    134 141 DBFILE
      **       Defines:                     142 170 DBKEY
      **                                    171 180 DBPGM
      **                                    181 1830DBASE
      *
     IPSDS       SDS
      *
      ** Program Status Data Structure - gives Job/Workstation name and
      ** User ID
      *
     I                                     *PROGRAM ##PGM
     I                                      244 253 WSID
     I                                      254 263 USER
     IDATE8       DS                                                      CAP062
     I                                        1   2 D8DD                  CAP062
     I                                        3   4 D8MM                  CAP062
     I                                        7   8 D8YY                  CAP062
     IDATE6       DS                                                      CAP062
     I                                        1   2 D6DD                  CAP062
     I                                        3   4 D6MM                  CAP062
     I                                        5   6 D6YY                  CAP062
      *                                                                                       209026
      ** Datastructure to hold input parameter for AOSVALR0.                                  209026
     I            DS                                                                          209026
     I                                        1  20 WPARM                                     209026
     I                                        1   5 WPARM1                                    209026
     I                                        6  10 WPARM2                                    209026
     I                                       11  15 WPARM3                                    209026
     I                                       16  20 WPARM4                                    209026
      *                                                                                       217956
     I            DS                                                                          217956
     I                                        1  32 W#DATA                                    217956
     I                                        1  16 W#DAT1                                    217956
     I                                       17  32 W#DAT2                                    217956
      *                                                                                       209026
      * Format time for output to LERELEPD                                CLE030
     IWTMRE       DS                         26                           CLE030
     I                                       12  13 WREHRS                CLE030
     I                                       15  16 WREMIN                CLE030
     I                                       18  19 WRESEC                CLE030
     I            DS                                                                          CSD027
     I                                        1   6 OLNOA                                     CSD027
     I**********                              1   60OLNON                              CSD027 CLE148
     I                                        1   6 OLNON                                     CLE148
     I/COPY WNCPYSRC,LE2070I002
      *
     ISDBANK    E DSSDBANKPD
      ** Bank details
      *
     ISDMMOD    E DSSDMMODPD
      ** Midas modules details
      *
     ISDGELR    E DSSDGELRPD
      ** General ledger details
      *
     ISDCLND    E DSSDCLNDPD
      ** Customer lending ICD
      *
     ISDRETL    E DSSDRETLPD
     I              QQACCD                          Q1ACCD                                    CGL029
      ** Retail ICD
      *
     ISDPCAC    E DSSDPCACPD
      ** Profit centre accounting ICD
      *
     ISCSARD    E DSSCSARDPD
      ** SAR details
      *
     ISDCUST    E DSSDCUSTPD
      ** Customer details
      *
     ISDBRCH    E DSSDBRCHPD
     I              QQDFAC                          Q1DFAC                                    CGL029
      ** Branch details
      *
     ISDCURR    E DSSDCURRPD
      ** Currency details
      *
     ISDBSRT    E DSSDBSRTPD
      ** Base rate code details
      *
     ISDNOST    E DSSDNOSTPD
     I              QQACCD                          Q2ACCD                                    CGL029
      ** Nostro code details
      *
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      ** Midas Functions for Watch List Checking Details File                                 CSD015
      *                                                                                       CSD015
     ICWLCDS    E DSSDWLTOPD                                                                  CSD015
      ** Watch List Tranaction Details File                                                   CSD015
      *                                                                                       CSD015
     ISDCWCD    E DSSDCWCDPD                                                                  CSD015
      ** Compliance Watch List Configuration Data                                             CSD015
      *                                                                                       CSD015
     ISDLOAN    E DSSDLOANPD                                                                  CAS001
      ** Loan Types/Subtypes                                                                  CAS001
      *                                                                                       CAS001
     ISDYLDC    E DSSDYLDCPD                                                                  CAS001
     I              FSYLDCA                         FYLDCA                                    CRE026
      ** Yield Curves Master File                                                             CAS001
      *                                                                                       CAS001
     I***SDACNT**  E DSACCNTAB                                     144915 166578
     I***********   CNUM                            ACNUM          144915 166578
     I***********   CCY                             ACCY           144915 166578
     I***********   BRCA                            ABRCD          144915 166578
     I***********   LCD                             ALCD           144915 166578
      ***External*DS*for*Account*Details***************************144915 166578
      *                                                                   144915
     IDSFDY     E DSDSFDY
      ** Short data structure for access objects
      *
     IDSSDY     E DSDSSDY
      ** Long data structure for access objects
      *
     ISETLIB    E DSSETLIAB
      ** data structure for passing a parameter to synon screen
      ** handling program.
      *
     ISETLIZ    E DSSETLIAZ
      ** data structure for passing a parameter to synon screen
      ** handling program.
      *
     I@PARM3    E DSSDSETLPD                                                                  222373
      *
     IZ#BSTS    E DSZ#BST
      ** before image of update to LE position files
      *
     IZ#ASTS    E DSZ#AST
      ** after image of update to LE position files
      *
     IZ#WSTS    E DSZ#WST
      ** work file on updates to LE position files
      *
     IZ#BSTK      DS                           2048                                           220754
     IZ#ASTK      DS                           2048                                           220754
     ICLONQD    E DSLESTMP2PD                                                               AR820267
      ** Externally desc'd DS for screen Loans extension                                    AR820267
      *                                                                                     AR820267
     ISC24X7    E DSSC24X7                                                CSC011
      * 24X7 Data Structure                                               CSC011
      *                                                                   CSC011
     ISDSTAT    E DSSDSTAT                                                CSC011
      * SDSTAT Data Structure                                             CSC011
      *                                                                   CSC011
     ICURREF    E DSCLOANCL                                                                   201672
     I**********    RECI                            RCDTO                              201672 220754
     I              RECI                            RECIO                                     220754
     I              PRFC                            PRFCO                                     201672
     I              ORED                            OREDO                                     201672
     I              LCD                             LCDLO                                     201672
     I              CHTP                            CHTPO                                     201672
     I              TNLU                            TNLUO                                     201672
     I              PTFR                            PTFRO                                     201672
     I              HLEX                            HLEXO                                     201672
     I              REPI                            REPIO                                     201672
     I              FSYLDC                          YLDCO                                     201672
     I              TMST                            DSTMST                                    CPK017
      *                                                                                       201672
     ICURRFK    E DSCLOANCK                                                                   220754
     I              LNRF                            KLNRF                                     220754
     I              RCDT                            KRCDT                                     220754
     I              MRIN                            KMRIN                                     220754
     I              LCD                             KLCD                                      220754
     I              FRNT                            KFRNT                                     CPK018
     I              AFRT                            KAFRT                                     CPK018
     I              REPA                            KREPA                                     CPK018
     I              TMST                            KTMST                                     CPK018
      *
     I            DS
      ** Date format for test harness file
     I                                        1   8 WTDAT
     I                                        1   2 WTDT1
     I I            '/'                       3   3 WFIL1
     I                                        4   5 WTDT2
     I I            '/'                       6   6 WFIL2
     I                                        7   8 WTDT3
      *
     I            DS
      ** Time format for test harness file
     I                                        1   8 WTTIM
     I                                        1   2 WTTM1
     I I            ':'                       3   3 WFIL3
     I                                        4   5 WTTM2
     I I            ':'                       6   6 WFIL4
     I                                        7   8 WTTM3
      *
     I            DS
      **  Data structure workfield for dates.
     I                                        1   8 W1DTE8
     I                                        1   6 W1DTE6
     I                                        1   4 W1DTE4
     I                                        1   2 W1DTE2
     I                                        3   4 W3DTE4
     I                                        5   6 W5DTE6
     I                                        7   8 W7DTE8
      *
     I            DS
      ** Separate time values
     I                                        1   60WTIME
     I                                        1   2 WTIM1
     I                                        3   4 WTIM2
     I                                        5   6 WTIM3
      *
     I            DS                                                      CSC011
      ** ISO format timestamp for 24/7 log                                CSC011
      ** Used as Key in APILOGL0                                          CSC011
     I                                        1  26 TSTISO                CSC011
     I                                        1   4 TSTYY                 CSC011
     I I            '-'                       5   5 TSTF1                 CSC011
     I                                        6   7 TSTMM                 CSC011
     I I            '-'                       8   8 TSTF2                 CSC011
     I                                        9  10 TSTDD                 CSC011
     I I            '-'                      11  11 TSTF3                 CSC011
     I                                       12  19 TSTTM                 CSC011
     I                                       12  13 TSTTM1                CSC011
     I I            '.'                      14  14 TSTF4                 CSC011
     I                                       15  16 TSTTM2                CSC011
     I I            '.'                      17  17 TSTF5                 CSC011
     I                                       18  19 TSTTM3                CSC011
     I I            '.'                      20  20 TSTF6                 CSC011
     I                                       21  26 TSTTM4                CSC011
      *                                                                   CSC011
     I            DS                                                      CSC011
      ** Data Structure to separate time for correct timestamp            CSC011
      **                                                                  CSC011
     I                                        1   8 WTSTM                 CSC011
     I                                        1   2 WTSHR                 CSC011
     I                                        3   4 WTSMN                 CSC011
     I                                        5   6 WTSSC                 CSC011
     I            DS
      **  Data structure workfield for warning messages.
     I                                        1   7 W1WAR7
     I                                        1   3 W1WAR3
     I                                        4   7 W4WAR7
      *
     I            DS
      **  Data structure workfield for database error messages.
     I                                        1  91 D01X91
     I I            'DB error in '            1  12 D01X12
     I                                       13  20 D13X20
     I I            'with key '              21  29 D21X29
     I                                       30  58 D30X58
     I I            'in program '            59  69 D59X69
     I                                       70  79 D70X79
     I I            'at point '              80  88 D80X88
     I                                       89  910D89X91
     I/COPY WNCPYSRC,LE2070I001
      **********                                                                       157751 193859
     I**********  DS                                                                   157751 193859
      ****Data*structure*workfield*for*amount.*                                        157751 193859
     I**********                              1  130WCHK2                              157751 193859
     I**********                              1  131WWCHK1                             157751 193859
     I**********                              1  132WWCHK2                             157751 193859
     I**********                              1  133WWCHK3                             157751 193859
      *                                                                                       195070
     I            DS                                                                          195070
      ** Format amount returned by standard subroutine                                        195070
     I                                        1  22 ZOUT22                                    195070
     I                                        1  21 ZOUT21                                    195070
     I                                        1  20 ZOUT20                                    195070
     I                                       21  21 ZNEG                                      195070
      *                                                                                       CLE031
      ** Data structure of key list used in chaining to FCLTY                                 CLE031
     I            DS                                                                          CLE031
     I                                        1  12 FCTREC                                    CLE031
     I**********                              1   60WFCNUM                             CLE031 CSD027
     I                                        1   6 WFCNUM                                    CSD027
     I                                        7   90WFFACT                                    CLE031
     I                                       10  110WFFCNO                                    CLE031
     I                                       12  12 WFRCTP                                    CLE031
      *                                                                                       CLE031
      ** Data structure of rundates                                                           CLE031
     I            DS                                                                          CLE031
     I                                    P   1   30RUN0                                      CLE031
     I                                    P   4   60RUN1                                      CLE031
     I                                    P   7   90RUN2                                      CLE031
     I                                    P  10  120RUN3                                      CLE031
     I                                    P  13  150RUN4                                      CLE031
     I                                    P  16  180RUN5                                      CLE031
     I                                    P  19  210RUN6                                      CLE031
     I                                    P  22  240RUN7                                      CLE031
     I                                    P  25  270RUN8                                      CLE031
     I                                    P  28  300RUN9                                      CLE031
     I                                    P   1  30 RUNS                                      CLE031
      *                                                                                       CLE031
      ** Data structure of drawn amounts                                                      CLE031
     I            DS                                                                          CLE031
     I                                    P   1   70OAM1                                      CLE031
     I                                    P   8  140OAM2                                      CLE031
     I                                    P  15  210OAM3                                      CLE031
     I                                    P  22  280OAM4                                      CLE031
     I                                    P  29  350OAM5                                      CLE031
     I                                    P  36  420OAM6                                      CLE031
     I                                    P  43  490OAM7                                      CLE031
     I                                    P  50  560OAM8                                      CLE031
     I                                    P  57  630OAM9                                      CLE031
     I                                    P  64  700OA10                                      CLE031
     I                                    P   1  70 OAM                                       CLE031
      *                                                                                       CLE031
      ** Data structure of facility                                                           CLE031
     I            DS                                                                          CLE031
     I                                        1   50WEFACL                                    CLE031
     I                                        1   30WDFTYP                                    CLE031
     I                                        4   50WDFSEQ                                    CLE031
      *
     I/COPY ZSRSRC,ZHOLI
     I/COPY ZSRSRC,ZTNLU1Z1
     I/COPY ZSRSRC,ZINTDYZ1
     I/COPY ZSRSRC,ZDATE9Z2
     I/COPY ZSRSRC,ZF2CI
     I/COPY ZSRSRC,ZCPDZ1
     I/COPY ZSRSRC,ZDAT10Z1
     I/COPY ZSRSRC,ZFRPEDZ2                                                                   195070
      /EJECT
      *****************************************************************
      *                   Index to subroutines                        *
      *  Main routine                                                 *
      *  SRINIT  -  Initial processing                                *
      *  SRBTCH  -  Batch processing                                  *
      *  SRSTRT  -  First Screen (Prompt for key input)               *
      *  SRVPMT  -  Validate Prompt Key Input                         *
      *  SRSFIL  -  Subfile processing                                *
      *  SRSCLF  -  Clear all subfile fields                          *
      *  SRSCLR  -  Clear subfile                                     *
      *  SRLOAD  -  Load subfile records                              *
      *  SRSNXT  -  Load Next Set of records to subfile               *
      *  SRMORE  -  Look for Next valid record.                       *
      *  SRRNXT  -  Read Next record in LELOANL2 or LELOANL3          *
      *  SRSFLD  -  Format Subfile fields                             *
      *  SRSREV  -  Process criteria options                          *
      *  SRSVAL  -  Validate subfile fields                           *
      *  SRSPRO  -  Process Selected Action                           *
      *  SRDINI  -  Initial Setup of Detail Screen                    *
      *  SRMCCY  -  Check if Mutli-currency rollover is allowed       *
      *  SRPDET  -  Process Detail Screen                             *
      *  SREXST  -  Process Extended Settlement Screen                *
      *  SRFXST  -  Format fields for Extended Settlement Screen      *
      *  SRIEXS  -  Move extended settlement file fields              *
      *  SRBEXS  -  Move extended settlement PC parameter fields      *
      *  SRPEXS  -  Move extended settlement test harness fields      *
      *  SRSETT  -  Process Data from Extended Settlement Screen      *
      *  SRUROL  -  Process Update of Rollover Record                 *
      *  SRUSHW  -  Process Update of Shadow Files                    *
      *  SRLOAN  -  Validate Loan number and fetch details.           *
      *  SRAUTH  -  Validate authorisation action                     *
      *  SRCAUT  -  Check if user is authorised to the action         *
      *  SRINIP  -  Initialise Prompt screen fields.                  *
      *  SRINIW  -  Clear Work fields                                 *
      *  SRINID  -  Clear detail screen fields                        *
      *  SRINIO  -  Clear Outgoing message parameter fields           *
      *  SRMOVP  -  Move Test Harness fields to display fields.       *
      *  SRMOVI  -  Move Incoming message parameters to screen fields *
      *  SRMOVR  -  Move Rollover Loan Details to display fields      *
      *  SRUAMD  -  Update files for Amend action.                    *
      *  SRUAUT  -  Update files for Authorise action.                *
      *  SRTAMD  -  Update Test Harness file for Amend action.        *
      *  SRTAUT  -  Update Test Harness file for Authorise action.    *
      *  SRPOMP  -  Process Outgoing message parameter                *
      *  SRCURR  -  Get Currency Details                              *
      *  SRCUST  -  Get Customer Details                              *
      *  SRSTAT  -  Determine Rollover Status Narrative               *
      *  SRTEXT  -  Set up text from message file                     *   123998
      *  SRVCUS  -  Validation of Loan Customer                       *
      *  SRVDET  -  Validation of Detail Screen                       *
      *  SRRATE  -  Validation of Exchange Rate and Amounts           *
      *  SRWDET  -  Warning messages of Detail Screen.                *
      *  SRNDAM  -  Check New Discount amount against calculated      *
      *  SREFFI  -  Calculate the Effective Interest                  *
      *  SRRVFD  -  Define Removeable fields                          *
      *  SRLTRX  -  Update LTRIX header and detail record.            *
      *  SRTERM  -  Termination Processing                            *
      *  SRWARN  -  Display warning message if loan is syndicated     *   159256
      *  SRWTCH  -  Performs the Watch list processing.               *                       CSD015
      *  SRCWP2  -  Set up the 2nd parameter for Compliance Watch.    *                       CSD015
      *  SRCLMQ  -  Clears the message queue                          *
      *  ZASNMS  -  Sends message to the program message queue        *
      *  *PSSR   -  Error handling subroutine                         *
      *****************************************************************
      /EJECT
      *
      ** Main Routine
      *
      *
      ** Perform initial processing
      *
     C                     EXSR SRINIT
      *
      ** Perform different detailed processing
      *
     C           WFMT      DOWNE*BLANK
     C           WFMT      CASEQ'F0'      SRSTRT
     C           WFMT      CASEQ'S0'      SRSFIL
     C           WFMT      CASEQ'D1'      SRPDET
     C           WFMT      CASEQ'D2'      SREXST
     C           WFMT      CASEQ'UP'      SRUROL
     C           WFMT      CASEQ'ME'      SRUSHW
     C                     ENDCS
     C                     ENDDO
      *
      ** Perform termination processing
      *
     C***********CEU020    IFEQ 'Y'                                CEU020 144915
     C***********PTYP      IFEQ 63                                 CEU020 144915
     C***********PTYP      OREQ 65                                 CEU020 144915
     C***********PTYP      OREQ 67                                 CEU020 144915
     C                     EXSR SRTERM
     C***********          ELSE                                    CEU020 144915
     C***********          MOVE '1'       *INLR                    CEU020 144915
     C***********          ENDIF                                   CEU020 144915
     C***********          ENDIF                                   CEU020 144915
      /EJECT
      *****************************************************************
      * SRINIT  -  Initial Processing                                 *
      * Called by: Main routine                                       *
      * Calls    : SRBTCH - Batch processing                          *
      *****************************************************************
     C           SRINIT    BEGSR
      *
      **  Set up copyright parameter
      *
     C                     MOVEACPY@      CPY2@  80
      *
      **  Receive entry parameters
      *
     C           *ENTRY    PLIST
     C                     PARM           PMODE   1
     C                     PARM           PTMFT   4
     C                     PARM           PINPP
     C                     PARM           POUTP
     C                     PARM           PTSTMP 26                                           CLE034
      *
      **  Key list for CLOAN
      *
     C           WLOAN     KLIST
     C**********           KFLD           WLNRF   60                                          CLE148
     C                     KFLD           WLNRF   6                                           CLE148
     C                     KFLD           WRCDT   1
      *
      **  Key list for LEFCLTL0
      *
     C           WFCLT     KLIST
     C                     KFLD           FCUS
     C                     KFLD           FTYP
     C                     KFLD           FSEQ
      *
      **  Key list for LELOAML0
      *
     C           WLOAM     KLIST
     C**********           KFLD           ALNRF   60                                          CLE148
     C                     KFLD           ALNRF   6                                           CLE148
     C                     KFLD           AVDAT   50
     C                     KFLD           ALASN   30
      *
      ** Compliance Watch Hit List Key List                                                   CSD015
      *                                                                                       CSD015
     C           KWHTKY    KLIST                                                              CSD015
     C                     KFLD           WFUNT   8                                           CSD015
     C                     KFLD           WIDEN  40                                           CSD015
     C                     KFLD           WBRCH   3                                           CSD015
      *                                                                                       CSD015
      **  Key list for FCLTY                                              159256
      *                                                                   159256
     C           K#FCLT    KLIST                                          159256
     C**********           KFLD           WFCUS   60                                   159256 CSD027
     C                     KFLD           WFCUS   6                                           CSD027
     C                     KFLD           WFTYP   30                      159256
     C                     KFLD           WFSEQ   20                      159256
     C                     KFLD           WRCTP   1                       159256
      *                                                                   166578
      ** Key list for SDEXSTL0                                            166578
      *                                                                   166578
     C           KEXST     KLIST                                          166578
     C                     KFLD           WCCY    3                       166578
     C                     KFLD           SCNUM                           166578
     C                     KFLD           WBRTY   2                       166578
      *                                                                                       CLE031
      ** Key list for Facilities file                                                         CLE031
      *                                                                                       CLE031
     C           KFCLT     KLIST                                                              CLE031
     C**********           KFLD           WFCNUM  60                                   CLE031 CSD027
     C                     KFLD           WFCNUM  6                                           CSD027
     C                     KFLD           WFFACT  30                                          CLE031
     C                     KFLD           WFFCNO  20                                          CLE031
     C                     KFLD           WFRCTP  1                                           CLE031
      *                                                                                       CLE031
      ** Key list for Fees file                                                               CLE031
      *                                                                                       CLE031
     C           KFEES     KLIST                                                              CLE031
     C**********           KFLD           WECNUM  60                                   CLE031 CSD027
     C                     KFLD           WECNUM  6                                           CSD027
     C                     KFLD           WEFACT  50                                          CLE031
      *                                                                                       CLE031
      ** Key list for Facility Amendment File                                                 CLE031
      *                                                                                       CLE031
     C           KFAM2     KLIST                                                              CLE031
     C                     KFLD           CNUMF                                               CLE031
     C                     KFLD           FACT                                                CLE031
     C                     KFLD           FCNO                                                CLE031
      *                                                                   CSC011
      **  Used for APILOGL0                                               CSC011
      *                                                                   CSC011
     C           KAPLOG    KLIST                                          CSC011
     C                     KFLD           KMTYPE  8                       CSC011
     C                     KFLD           KFOID  20                       CSC011
     C                     KFLD           KTSTMP 26                       CSC011
      *                                                                   CSC011
      *                                                                   159256
      ** Define dataara LDA
      *
     C           *NAMVAR   DEFN           LDA
     C*                                                                   CSC011
     C           *NAMVAR   DEFN           SDSTAT                          CSC011
     C*                                                                   CSC011
     C           *NAMVAR   DEFN           SC24X7                          CSC011
     C*                                                                   CSC011
      *
      **  Initialise LDA
      *
     C           *LOCK     IN   LDA
     C                     MOVEL'LE2070'  DBPGM
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD*ZEROS    DBASE
     C                     OUT  LDA
      *
      **  Retrieve bank details
      *
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANKS   PRTCD   7
     C                     PARM '*FIRST ' POPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBANKPD'DBFILE           ************
     C                     Z-ADD1         DBASE            * DBERR 01 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Date format indicator.
      *
     C           BJDFIN    IFEQ 'M'
     C                     MOVE *ON       *IN98
     C                     ELSE
     C                     MOVE *OFF      *IN98
     C                     ENDIF
      *
      **  Retrieve midas module details
      *
     C                     CALL 'AOMMODR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDMMODPD'DBFILE           ************
     C                     Z-ADD2         DBASE            * DBERR 02 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVELBGMBIN    MBIN    1
      *
      **  Retrieve general ledger details
      *
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDGELRPD'DBFILE           ************
     C                     Z-ADD3         DBASE            * DBERR 03 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Retrieve lending ICD
      *
     C                     CALL 'AOCLNDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDCLND    PARM SDCLND    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCLNDPD'DBFILE           ************
     C                     Z-ADD4         DBASE            * DBERR 04 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Retrieve retail details
      *
     C           BGRTBN    IFEQ 'Y'
     C           BGNXST    ANDEQ'Y'
     C                     CALL 'AORETLR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDRETL    PARM SDRETL    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDRETLPD'DBFILE           ************
     C                     Z-ADD5         DBASE            * DBERR 05 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Update some extended settlement parameter fields.
     C                     MOVE 'Y'       PMRETP
     C                     MOVELBMACCD    PMPCYA
     C                     MOVE BMRANR    PMRETS
     C                     ENDIF
      *                                                                   CDE002
      ** Access SAR details file to determine if CDE002 is switched on    CDE002
      *                                                                   CDE002
     C                     CALL 'AOSARDR0'                                CDE002
     C                     PARM *BLANKS   PRTCD   7                       CDE002
     C                     PARM '*VERIFY' POPTN   7                       CDE002
     C                     PARM 'CDE002'  PSARD   6                       CDE002
     C           SCSARD    PARM SCSARD    DSFDY                           CDE002
      *                                                                   CDE002
     C                     MOVE 'N'       CDE002  1                       CDE002
     C           PRTCD     IFEQ *BLANKS                                   CDE002
     C                     MOVE 'Y'       CDE002                          CDE002
     C                     ENDIF                                          CDE002
      *                                                                   CLE033
      ** Access Switchable Feature Details (CLE033)                       CLE033
      *                                                                   CLE033
     C                     MOVE 'N'       CLE033  1                       CLE033
      *                                                                   CLE033
     C                     CALL 'AOSARDR0'                                CLE033
     C                     PARM *BLANKS   @RTCD                           CLE033
     C                     PARM '*VERIFY '@OPTN                           CLE033
     C                     PARM 'CLE033'  @SARD                           CLE033
      *                                                                   CLE033
     C           @RTCD     IFEQ *BLANKS                                   CLE033
     C                     MOVE 'Y'       CLE033                          CLE033
     C                     ENDIF                                          CLE033
      *
      **  Retrieve profit centre accounting ICD.
      *
     C           BGN0ST    IFEQ 'Y'
     C                     CALL 'AOPCACR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDPCAC    PARM SDPCAC    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDPCACPD'DBFILE           ************
     C                     Z-ADD6         DBASE            * DBERR 06 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2070C007
      *
      **  Determine if BLI Lending Enhancements feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'S01465'  PSARD
     C           SCSARD    PARM SCSARD    DSFDY
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       S01465  1
     C                     MOVE *ON       *IN60
     C                     ELSE
     C                     MOVE 'N'       S01465
     C                     MOVE *OFF      *IN60
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD7         DBASE            * DBERR 07 *
     C                     MOVEL'S01465'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      **  Determine if Customer Lending Enhancements - Authorisation
      **  feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'CLE002'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE002  1
     C                     ELSE
     C                     MOVE 'N'       CLE002
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD8         DBASE            * DBERR 08 *
     C                     MOVEL'CLE002'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      **  Determine if Customer Lending Enhancements - Backvaluations
      **  feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'CLE003'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE003  1
     C                     ELSE
     C                     MOVE 'N'       CLE003
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD9         DBASE            * DBERR 09 *
     C                     MOVEL'CLE003'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      **  Determine if Customer Lending Enhancements - Others
      **  feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'CLE005'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE005  1
     C                     ELSE
     C                     MOVE 'N'       CLE005
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD10        DBASE            * DBERR 10 *
     C                     MOVEL'CLE005'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *                                                                   CEU004
      **  Access Switchable SAR details for the existence of CEU004       CEU004
      *                                                                   CEU004
     C                     CALL 'AOSARDR0'                                CEU004
     C                     PARM *BLANK    PRTCD                           CEU004
     C                     PARM '*VERIFY' POPTN                           CEU004
     C                     PARM 'CEU004'  PSARD                           CEU004
     C           PRTCD     IFEQ *BLANKS                                   CEU004
     C                     MOVE 'Y'       CEU004  1                       CEU004
     C                     ELSE                                           CEU004
     C                     MOVE 'N'       CEU004                          CEU004
     C           PRTCD     IFNE '*NRF    '                                CEU004
     C           *LOCK     IN   LDA                                       CEU004
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU004
     C                     Z-ADD42        DBASE            * DBERR 42 *   CEU004
     C                     MOVEL'CEU004'  DBKEY            ************   CEU004
     C                     OUT  LDA                                       CEU004
     C                     EXSR *PSSR                                     CEU004
     C                     ENDIF                                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU020
      **  Determine if EMU Lending Multi Currency Rollover - CEU020       CEU020
      **  feature is installed                                            CEU020
      *                                                                   CEU020
     C                     CALL 'AOSARDR0'                                CEU020
     C                     PARM *BLANKS   PRTCD                           CEU020
     C                     PARM '*KEY   ' POPTN                           CEU020
     C                     PARM 'CEU020'  PSARD                           CEU020
     C           SCSARD    PARM SCSARD    DSFDY                           CEU020
     C           PRTCD     IFEQ *BLANKS                                   CEU020
     C                     MOVE 'Y'       CEU020  1                       CEU020
     C                     ELSE                                           CEU020
     C                     MOVE 'N'       CEU020                          CEU020
     C           PRTCD     IFNE '*NRF    '                                CEU020
     C           *LOCK     IN   LDA                                       CEU020
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU020
     C                     Z-ADD14        DBASE            * DBERR 14 *   CEU020
     C                     MOVEL'CEU020'  DBKEY            ************   CEU020
     C                     OUT  LDA                                       CEU020
     C                     EXSR *PSSR                                     CEU020
     C                     ENDIF                                          CEU020
     C                     ENDIF                                          CEU020
      *
      ** Determine if Data Export for CCRM Limits is active               CDE001
      *                                                                   CDE001
     C                     CALL 'AOSARDR0'                                CDE001
     C                     PARM *BLANKS   PRTCD                           CDE001
     C                     PARM '*VERIFY' POPTN                           CDE001
     C                     PARM 'CDE001'  PSARD                           CDE001
     C           PRTCD     IFEQ *BLANKS                                   CDE001
     C                     MOVE 'Y'       CDE001  1                       CDE001
     C                     ELSE                                           CDE001
     C                     MOVE 'N'       CDE001                          CDE001
     C           PRTCD     IFNE '*NRF    '                                CDE001
     C           *LOCK     IN   LDA                                       CDE001
     C                     MOVEL'SCSARDPD'DBFILE           ************   CDE001
     C                     Z-ADD15        DBASE            * DBERR 15 *   CDE001
     C                     MOVEL'CDE001'  DBKEY            ************   CDE001
     C                     OUT  LDA                                       CDE001
     C                     EXSR *PSSR                                     CDE001
     C                     ENDIF                                          CDE001
     C                     ENDIF                                          CDE001
      *                                                                   CAP062
      ** Determine if Lending Rollover API Upgrade feature is             CAP062
      ** installed.                                                       CAP062
      *                                                                   CAP062
     C                     CALL 'AOSARDR0'                                CAP062
     C                     PARM *BLANKS   PRTCD                           CAP062
     C                     PARM '*KEY   ' POPTN                           CAP062
     C                     PARM 'CAP062'  PSARD   6                       CAP062
     C           SCSARD    PARM SCSARD    DSFDY                           CAP062
     C           PRTCD     IFEQ *BLANKS                                   CAP062
     C                     MOVE 'Y'       CAP062  1                       CAP062
     C                     ELSE                                           CAP062
     C                     MOVE 'N'       CAP062                          CAP062
     C                     ENDIF                                          CAP062
      *                                                                   CLE014
      ** Determine if Lending Enhancements for BHF-London is active       CLE014
      *                                                                   CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM *BLANKS   PRTCD                           CLE014
     C                     PARM '*VERIFY' POPTN                           CLE014
     C                     PARM 'CLE014'  PSARD                           CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CLE014  1                       CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CLE014                          CLE014
     C           PRTCD     IFNE '*NRF    '                                CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVEL'SCSARDPD'DBFILE                          CLE014
     C                     Z-ADD27        DBASE                           CLE014
     C                     MOVEL'CLE014'  DBKEY                           CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE011
      **  Determine if Rollover rate fixing day enhancement - CLE011      CLE011
      **  feature is installed                                            CLE011
      *                                                                   CLE011
     C                     CALL 'AOSARDR0'                                CLE011
     C                     PARM *BLANKS   PRTCD                           CLE011
     C                     PARM '*KEY   ' POPTN                           CLE011
     C                     PARM 'CLE011'  PSARD                           CLE011
     C           SCSARD    PARM SCSARD    DSFDY                           CLE011
     C           PRTCD     IFEQ *BLANKS                                   CLE011
     C                     MOVE 'Y'       CLE011  1                       CLE011
     C                     MOVE *ON       *IN71                           CLE011
     C                     ELSE                                           CLE011
     C                     MOVE 'N'       CLE011                          CLE011
     C                     MOVE *OFF      *IN71                           CLE011
     C           PRTCD     IFNE '*NRF    '                                CLE011
     C           *LOCK     IN   LDA                                       CLE011
     C                     MOVEL'SCSARDPD'DBFILE                          CLE011
     C                     Z-ADD63        DBASE                           CLE011
     C                     MOVEL'CLE011'  DBKEY                           CLE011
     C                     OUT  LDA                                       CLE011
     C                     EXSR *PSSR                                     CLE011
     C                     ENDIF                                          CLE011
     C                     ENDIF                                          CLE011
      *                                                                   CDE001
      ** Determine if CAS001 is installed                                                     CAS001
      *                                                                                       CAS001
     C                     CALL 'AOSARDR0'                                                    CAS001
     C                     PARM *BLANKS   PRTCD                                               CAS001
     C                     PARM '*VERIFY 'POPTN                                               CAS001
     C                     PARM 'CAS001'  PSARD                                               CAS001
     C           SCSARD    PARM SCSARD    DSSDY                                               CAS001
      *                                                                                       CAS001
     C           PRTCD     IFNE *BLANKS                                                       CAS001
     C           PRTCD     ANDNE'*NRF   '                                                     CAS001
     C           *LOCK     IN   LDA                                                           CAS001
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS001
     C                     Z-ADD64        DBASE                                               CAS001
     C                     MOVEL'CAS001'  DBKEY                                               CAS001
     C                     OUT  LDA                                                           CAS001
     C                     EXSR *PSSR                                                         CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           PRTCD     IFEQ *BLANKS                                                       CAS001
     C                     MOVE 'Y'       CAS001  1                                           CAS001
     C                     ELSE                                                               CAS001
     C                     MOVE 'N'       CAS001                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      *                                                                                       CLE023
      **  Determine if Lending Facility History Improvements - CLE023                         CLE023
      **  feature is installed                                                                CLE023
      *                                                                                       CLE023
     C                     CALL 'AOSARDR0'                                                    CLE023
     C                     PARM *BLANKS   PRTCD                                               CLE023
     C                     PARM '*KEY   ' POPTN                                               CLE023
     C                     PARM 'CLE023'  PSARD                                               CLE023
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE023
     C           PRTCD     IFEQ *BLANKS                                                       CLE023
     C                     MOVE 'Y'       CLE023  1                                           CLE023
     C                     ELSE                                                               CLE023
     C                     MOVE 'N'       CLE023                                              CLE023
     C           PRTCD     IFNE '*NRF    '                                                    CLE023
     C           *LOCK     IN   LDA                                                           CLE023
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE023
     C                     Z-ADD64        DBASE                                               CLE023
     C                     MOVEL'CLE023'  DBKEY                                               CLE023
     C                     OUT  LDA                                                           CLE023
     C                     EXSR *PSSR                                                         CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CSD015
      ** Determine if Compliance Watch Enhancedment - CSD015                                  CSD015
      ** feature is installed.                                                                CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY 'POPTN                                               CSD015
     C                     PARM 'CSD015'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD31        DBASE                                               CSD015
     C                     MOVEL'CSD015'  DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015  1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'N'       CSD015                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Determine if Function Code is being monitored by                                     CSD015
      ** Compliance Watch.                                                                    CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*KEY    'POPTN                                               CSD015
     C                     PARM 'LENDING 'PFUNC   8                                           CSD015
     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SDWLCCPD'DBFILE                                              CSD015
     C                     Z-ADD32        DBASE                                               CSD015
     C                     MOVELPFUNC     DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCWCDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*FIRST  'POPTN                                               CSD015
     C           SDCWCD    PARM SDCWCD    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SDCWCDPD'DBFILE                                              CSD015
     C                     Z-ADD34        DBASE                                               CSD015
     C                     MOVELPOPTN     DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Determine if Cncord Interface Development  - CCF001                                  CSD015
      ** feature is installed.                                                                CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY 'POPTN                                               CSD015
     C                     PARM 'CCF001'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD33        DBASE                                               CSD015
     C                     MOVEL'CCF001'  DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CCF001  1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'N'       CCF001                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                   CSC011
      ** Determine if 24x7 Midas Availability active?                     CSC011
      *                                                                   CSC011
     C                     CALL 'AOSARDR0'                                CSC011
     C                     PARM *BLANKS   PRTCD                           CSC011
     C                     PARM '*VERIFY' POPTN                           CSC011
     C                     PARM 'CSC011'  PSARD                           CSC011
     C           PRTCD     IFEQ *BLANKS                                   CSC011
     C                     MOVE 'Y'       CSC011  1                       CSC011
     C                     ELSE                                           CSC011
     C                     MOVE 'N'       CSC011                          CSC011
     C           PRTCD     IFNE '*NRF    '                                CSC011
     C           *LOCK     IN   LDA                                       CSC011
     C                     MOVEL'SCSARDPD'DBFILE           ************   CSC011
     C                     Z-ADD17        DBASE            * DBERR 17 *   CSC011
     C                     MOVEL'CSC011'  DBKEY            ************   CSC011
     C                     OUT  LDA                                       CSC011
     C                     EXSR *PSSR                                     CSC011
     C                     ENDIF                                          CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C*                                                                   CSC011
     C* Is the support system on?                                         CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     Z-ADDS1DATE    WRNDAY  60                      CSC011
     C                     ELSE                                           CSC011
     C                     MOVE BJRDNB    WRNDAY                          CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
      ** Determine if Flat Rate Personal Loans (Rule of 78s) is                               CLE028
      ** installed                                                                            CLE028
      *                                                                                       CLE028
     C                     CALL 'AOSARDR0'                                                    CLE028
     C                     PARM *BLANKS   PRTCD                                               CLE028
     C                     PARM '*VERIFY' POPTN                                               CLE028
     C                     PARM 'CLE028'  PSARD                                               CLE028
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE028
      *                                                                                       CLE028
     C           PRTCD     IFNE *BLANKS                                                       CLE028
     C           PRTCD     ANDNE'*NRF   '                                                     CLE028
     C           *LOCK     IN   LDA                                                           CLE028
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE028
     C                     Z-ADD65        DBASE                                               CLE028
     C                     MOVELPSARD     DBKEY                                               CLE028
     C                     OUT  LDA                                                           CLE028
     C                     EXSR *PSSR                                                         CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           PRTCD     IFEQ *BLANKS                                                       CLE028
     C                     MOVE 'Y'       CLE028  1                                           CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE 'N'       CLE028                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      *                                                                                       CLE031
      ** Determine if Lending Enhancement is active                                           CLE031
      *                                                                                       CLE031
     C                     CALL 'AOSARDR0'                                                    CLE031
     C                     PARM *BLANKS   PRTCD                                               CLE031
     C                     PARM '*VERIFY' POPTN                                               CLE031
     C                     PARM 'CLE031'  PSARD                                               CLE031
     C           PRTCD     IFEQ *BLANKS                                                       CLE031
     C                     MOVE 'Y'       CLE031  1                                           CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'N'       CLE031                                              CLE031
     C           PRTCD     IFNE '*NRF    '                                                    CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE031
     C                     Z-ADD66        DBASE                                               CLE031
     C                     MOVEL'CLE031'  DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Determine if Lending I/C Swift Message Generation                                    CLE031
      ** for Fees is active                                                                   CLE031
      *                                                                                       CLE031
     C                     CALL 'AOSARDR0'                                                    CLE031
     C                     PARM *BLANKS   PRTCD                                               CLE031
     C                     PARM '*VERIFY' POPTN                                               CLE031
     C                     PARM 'CLE009'  PSARD                                               CLE031
     C           PRTCD     IFEQ *BLANKS                                                       CLE031
     C                     MOVE 'Y'       CLE009  1                                           CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'N'       CLE009                                              CLE031
     C           PRTCD     IFNE '*NRF    '                                                    CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE031
     C                     Z-ADD67        DBASE                                               CLE031
     C                     MOVEL'CLE009'  DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Set up an array of branch internal customer                                          CLE031
      ** If branch file is empty, report db error                                             CLE031
      *                                                                                       CLE031
     C           *LOVAL    SETLLSDBRCHL5                                                      CLE031
     C                     READ SDBRCHL5                 68                                   CLE031
     C           *IN68     IFEQ '1'                                                           CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'SDBRCHL5'DBFILE                                              CLE031
     C                     Z-ADD68        DBASE                                               CLE031
     C                     MOVEL'*FIRST  'DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ELSE                                                               CLE031
     C           *IN68     DOUEQ'1'                                                           CLE031
     C                     ADD  1         Z                                                   CLE031
     C                     MOVE A8BICN    WBIC,Z                                              CLE031
     C                     READ SDBRCHL5                 68                                   CLE031
     C                     ENDDO                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
      ** Check if CLE034 is on                                                                CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSARDR0'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM '*VERIFY' POPTN                                               CLE034
     C                     PARM 'CLE034'  PSARD                                               CLE034
      *                                                                                       CLE034
     C           PRTCD     IFNE *BLANKS                                                       CLE034
     C           PRTCD     ANDNE'*NRF   '                                                     CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVE 'SCSARDPD'DBFILE                                              CLE034
     C                     MOVEL'CLE034'  DBKEY                                               CLE034
     C                     Z-ADD13        DBASE                                               CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           PRTCD     IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'Y'       CLE034  1                                           CLE034
     C                     MOVE *ON       *IN01                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'N'       CLE034                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE036
      ** Check if CLE036 is on                                                                CLE036
      *                                                                                       CLE036
     C                     CALL 'AOSARDR0'                                                    CLE036
     C                     PARM *BLANKS   PRTCD                                               CLE036
     C                     PARM '*VERIFY' POPTN                                               CLE036
     C                     PARM 'CLE036'  PSARD                                               CLE036
      *                                                                                       CLE036
     C           PRTCD     IFNE *BLANKS                                                       CLE036
     C           PRTCD     ANDNE'*NRF   '                                                     CLE036
     C           *LOCK     IN   LDA                                                           CLE036
     C                     MOVE 'SCSARDPD'DBFILE                                              CLE036
     C                     MOVEL'CLE036'  DBKEY                                               CLE036
     C                     Z-ADD14        DBASE                                               CLE036
     C                     OUT  LDA                                                           CLE036
     C                     EXSR *PSSR                                                         CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           PRTCD     IFEQ *BLANKS                                                       CLE036
     C                     MOVE 'Y'       CLE036  1                                           CLE036
     C                     MOVE *ON       *IN02                                               CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE 'N'       CLE036                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE031
      *                                                                   CLE030
      ** Access SAR details file to determine if CLE030 is switched on    CLE030
      *                                                                   CLE030
     C                     CALL 'AOSARDR0'                                CLE030
     C                     PARM *BLANKS   PRTCD   7                       CLE030
     C                     PARM '*VERIFY' POPTN   7                       CLE030
     C                     PARM 'CLE030'  PSARD   6                       CLE030
     C           SCSARD    PARM SCSARD    DSFDY                           CLE030
      *                                                                   CLE030
     C                     MOVE 'N'       CLE030  1                       CLE030
     C           PRTCD     IFEQ *BLANKS                                   CLE030
     C                     MOVE 'Y'       CLE030                          CLE030
     C                     MOVE *ON       *IN22                           222729
     C                     ENDIF                                          CLE030
      ** Determine if CAS009 is ON                                                            CAS009
      *                                                                                       CAS009
     C                     CALL 'AOSARDR0'                                                    CAS009
     C                     PARM *BLANKS   PRTCD                                               CAS009
     C                     PARM '*VERIFY 'POPTN                                               CAS009
     C                     PARM 'CAS009'  PSARD                                               CAS009
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS009
      *                                                                                       CAS009
     C           PRTCD     IFNE *BLANKS                                                       CAS009
     C           PRTCD     ANDNE'*NRF   '                                                     CAS009
     C           *LOCK     IN   LDA                                                           CAS009
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS009
     C                     Z-ADD66        DBASE                                               CAS009
     C                     MOVEL'CAS009'  DBKEY                                               CAS009
     C                     OUT  LDA                                                           CAS009
     C                     EXSR *PSSR                                                         CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           PRTCD     IFEQ *BLANKS                                                       CAS009
     C                     MOVE 'Y'       CAS009  1                                           CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE 'N'       CAS009                                              CAS009
     C                     ENDIF                                                              CAS009
     C/COPY WNCPYSRC,LE2070C001
      **  Allow Authorisation action, if necessary.
      *
     C           CLE002    IFEQ 'Y'
     C           BPROAU    ANDEQ'Y'
     C                     MOVE *ON       *IN70
     C                     ELSE
     C                     MOVE *OFF      *IN70
     C                     ENDIF
      *                                                                   123857
      ** Determine if F11 is necessary to authorise a rollover            123857
      *                                                                   123857
     C           BPAURV    IFEQ 'Y'                                       123857
     C                     MOVE *ON       *IN59                           123857
     C                     ELSE                                           123857
     C                     MOVE *OFF      *IN59                           123857
     C                     ENDIF                                          123857
      *                                                                                       209026
      ** Check System Value: Use Original Borrower or Purchased From?                         209026
      ** Set up parameter so access object checks LoanCustOriginPurch                         209026
     C                     MOVE *BLANKS   WPARM                                               209026
     C                     MOVEL'LoanC'   WPARM1                                              209026
     C                     MOVEL'ustOr'   WPARM2                                              209026
     C                     MOVEL'iginP'   WPARM3                                              209026
     C                     MOVEL'urch'    WPARM4                                              209026
     C                     MOVELWPARM     SVALK1                                              209026
      *                                                                                       CLE148
     C                     MOVELSVALTX,1  SVALK2                                              CLE148
      * Call Access object:                                                                   209026
     C                     CALL 'AOSVALR0'                                                    209026
     C                     PARM           RTNCDE  7                                           209026
     C                     PARM           SVALK1 20                                           209026
     C                     PARM           SVAL1 200                                           209026
     C                     PARM           SVALK2 20                                           209026
     C                     PARM           SVAL2 200                                           209026
     C                     PARM           SVALK3 20                                           209026
     C                     PARM           SVAL3 200                                           209026
     C                     PARM           SVALK4 20                                           209026
     C                     PARM           SVAL4 200                                           209026
     C                     PARM           SVALK5 20                                           209026
     C                     PARM           SVAL5 200                                           209026
     C                     PARM           SVALK6 20                                           209026
     C                     PARM           SVAL6 200                                           209026
     C                     PARM           SVALK7 20                                           209026
     C                     PARM           SVAL7 200                                           209026
     C                     PARM           SVALK8 20                                           209026
     C                     PARM           SVAL8 200                                           209026
     C                     PARM           SVALK9 20                                           209026
     C                     PARM           SVAL9 200                                           209026
     C                     PARM           SVALK0 20                                           209026
     C                     PARM           SVAL10200                                           209026
      * If the system value is not found then issue a database error                          209026
      * unless batch mode, in which case default value to 'P'                                 216067
     C           RTNCDE    IFNE '        '                                                    209026
     C           PMODE     IFEQ 'B'                                                           216067
     C                     MOVE 'P'       PPCUST                                              216067
     C                     ELSE                                                               216067
     C           *LOCK     IN   LDA                                                           209026
     C                     MOVEL'SDSVALPD'DBFILE           ************                       209026
     C                     Z-ADD21        DBASE            * DBERR 21 *                       209026
     C                     MOVEL'SVALK1'  DBKEY            ************                       209026
     C                     OUT  LDA                                                           209026
     C                     EXSR *PSSR                                                         209026
     C                     ENDIF                                                              216067
     C                     ELSE                                                               209026
      * Isolate the first character of SVAL1 which = 'P' or 'O'.                              209026
     C                     MOVELSVAL1     WRK01   1        1 character fld                    209026
     C           WRK01     IFEQ 'O'                                                           209026
     C                     MOVE 'O'       PPCUST  1                                           209026
     C                     ELSE                                                               209026
     C                     MOVE 'P'       PPCUST                                              209026
     C                     ENDIF                                                              209026
     C                     ENDIF                                                              209026
      *                                                                                       CLE148
     C                     MOVELSVAL2     WALLOW  1                                           CLE148
      *
      **  Declare constants.
      *
     C                     MOVEL'LERMSGF 'ZAMSGF
     C                     MOVEL'LEV'     W1WAR3
     C***********          Z-ADD5         WARS    10                      123335
     C***********          Z-ADD6         WARS    10               123335 134725
     C**********           Z-ADD7         WARS    10               134725 CLE011
     C***********          Z-ADD8         WARS    10                                   CLE011 CLE023
     C**********           Z-ADD9         WARS    10                                   CLE023 CLE031
     C                     Z-ADD10        WARS    20                                          CLE031
     C                     MOVE *ZEROS    WA21   21
     C                     MOVE *ZEROS    WA22   22
      *
      **  Check mode of processing
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C                     OPEN LE2070DF
     C                     MOVE 'F0'      WFMT    2
     C                     MOVE *BLANKS   WWRTRN  2
     C                     ENDIF
      *
     C           PMODE     IFEQ 'R'
     C           PMODE     OREQ 'P'
     C                     OPEN LE2070PD
     C                     ENDIF
      *
     C           PMODE     IFEQ 'B'
     C           PMODE     OREQ 'P'
     C           PMODE     IFEQ 'B'
     C                     OPEN LEIROLPD                                  CAP062
     C                     MOVELPITUSR    @USER
     C**********           Z-ADD1         @ZMGRP                                              CSF002
     C                     MOVEL'00000'   UNQCDE                                              CSF002
     C**********           MOVE PITYPE    @ZICDE                                              CSF002
     C           PITYPE    IFEQ 'PTPU'                                                        CSF002
     C                     MOVE '01807'   UNQCDE                                              CSF002
     C                     ENDIF                                                              CSF002
     C           PITYPE    IFEQ 'PTSO'                                                        CSF002
     C                     MOVE '01808'   UNQCDE                                              CSF002
     C                     ENDIF                                                              CSF002
     C           PITYPE    IFEQ 'PTFT'                                                        CSF002
     C                     MOVE '01810'   UNQCDE                                              CSF002
     C                     ENDIF                                                              CSF002
     C           PITYPE    IFEQ 'LOAN'                                                        CSF002
     C                     MOVE '01806'   UNQCDE                                              CSF002
     C                     ENDIF                                                              CSF002
     C           PITYPE    IFEQ 'ROLL'                                                        CSF002
     C                     MOVE '01811'   UNQCDE                                              CSF002
     C                     ENDIF                                                              CSF002
     C                     ENDIF
     C                     EXSR SRBTCH
      *                                                                   CDE001
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           CDE001    IFEQ 'Y'                                       CDE001
     C                     MOVELSLOAN     T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C                     PARM           T#TREF 20                       CDE001
     C                     PARM 'LOAN'    T#TCAT  4                       CDE001
     C                     PARM *BLANKS   T#RSRV 10                       CDE005
     C                     ENDIF                                          CDE001
      *                                                                   CDE001
     C           PMODE     IFNE 'B'                                       120002
     C                     COMIT
     C                     ENDIF                                          120002
     C                     MOVE *ON       *INLR
     C                     RETRN
     C                     ENDIF
      *                                                                   CAP062
      ** If mode is Fix (Repair)                                          CAP062
     C           PMODE     IFEQ 'F'                                       CAP062
     C                     OPEN LEIROLL1                                  CAP062
     C                     OPEN LEIROLL2                                  CAP062
     C                     OPEN LEIROLLX                                  CAP062
     C                     OPEN LE2070DF                                  CAP062
     C                     MOVE 'S0'      WFMT                            CAP062
     C                     MOVE USER      SUSER                           CAP062
     C                     MOVE BJMRDT    SRUNA                           CAP062
     C                     MOVE WSID      SWSID                           CAP062
     C                     SETON                     84                   CAP062
     C                     ENDIF                                          CAP062
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRBTCH  -  Batch Processing                                   *
      * Called by: SRINIT - Initial processing                        *
      * Calls    : SRINIP - Initialise prompt screen fields           *
      *            SRINIW - Clear workfields                          *
      *            SRINID - Clear detail screen fields                *
      *            SRINIO - Clear Outgoing msg parameter fields       *
      *            SRMOVP - Move test harness to screen fields        *
      *            SRMOVI - Move Incoming msg parm to screen fields   *
      *            SRVPMT - Validate prompt key input                 *
      *            SRDIN1 - Initial set-up of detail screen           *
      *            SRVCUS - Validation of loan customer               *
      *            SRDIN2 - Clear workfields                          *
      *            SRVDET - Validation of detail screen               *
      *            SRWDET - Warning messages of detail screen         *
      *            SRFXST - Format fields for extend settlements      *
      *            SRSETT - Process data from extend settlements      *
      *            SRUROL - Process update for rollover record        *
      *            SRUSHW - Process update of shadow files            *
      *            SRPOMP - Process outgoing message parameter        *
      *****************************************************************
     C           SRBTCH    BEGSR
      *
      **  In Play mode, validate all records from
      **  the test harness file and update loans file accordingly.
      **  In Batch mode, validate the incoming message parameter
      **  then return the outgoing message parameter.
      *
     C                     MOVE *OFF      *IN79
     C           PMODE     IFEQ 'P'
     C                     READ LE2070PD                 79
     C                     ENDIF
      *
     C           *IN79     DOWEQ*OFF
      *
      **  Initialise screen and work fields.
      *
     C                     EXSR SRINIP
     C                     EXSR SRINIW
     C                     EXSR SRINID
     C                     EXSR SRINIO
      *
      **  Move PF fields to display fields.
      *
     C           PMODE     CASEQ'P'       SRMOVP
      *
      **  Move msg input parameter fields to display fields.
      *
     C           PMODE     CASEQ'B'       SRMOVI
     C                     ENDCS
      *
      **  Validate prompt details.
      *
     C                     EXSR SRVPMT
      *
      **  Set-up detail screen fields.
      *
     C                     EXSR SRDINI
      *
      **  Validate screen fields.
      *
     C           SACTN     IFEQ 'A'
     C           SACTN     OREQ 'X'
     C                     EXSR SRVCUS
     C***********SACTN     IFEQ 'A'                                       123857
     C                     EXSR SRINIW
     C                     EXSR SRVDET
     C***********          ENDIF                                          123857
     C                     EXSR SRWDET
     C                     ENDIF
      *
      **  Validate settlement details if Discount Loan.
      **  or a multi-currency rollover                                    120025
      *
     C           PTYP      IFEQ 63
     C           PTYP      OREQ 65                                        122098
     C           PTYP      OREQ 67                                        122098
     C           SNCCY     ORNE *BLANKS                                   120025
     C           SNCCYB    ORNE *BLANKS                                   120025
     C                     EXSR SRFXST
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SRSTA     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C                     CALL 'LE2230'                                                      CLE034
     C                     PARM 'ROLL'    PTYPE   4                                           CLE034
     C                     PARM           SLOAN                                               CLE034
     C                     PARM *BLANKS   PLAVDT  5                                           CLE034
     C                     PARM *BLANKS   PLASEQ  3                                           CLE034
     C                     PARM *BLANKS   PCUSTF  6                                           CLE034
     C                     PARM *BLANKS   PFACIF  5                                           CLE034
     C                     PARM *BLANKS   PFEESQ  2                                           CLE034
     C                     PARM           SETLIB                                              CLE034
     C                     PARM           SETLIZ                                              CLE034
     C                     PARM           PMODE                                               CLE034
     C                     PARM           PTSTMP                                              CLE034
     C                     PARM *BLANKS   PERROR  1                                           CLE034
     C                     PARM *BLANKS   PWARN   1                                           CLE034
     C                     PARM *BLANKS   PSTNOS  1                                           CLE034
     C                     PARM *BLANKS   PSEAMD  1                                           CLE034
     C                     PARM *BLANKS   PNODET  1                                           CLE034
     C                     PARM *BLANKS   PRSCUR 60                                           CLE034
     C                     PARM *BLANKS   PRSLOC 60                                           CLE034
     C                     PARM *BLANKS   PPSCUR 60                                           CLE034
     C                     PARM *BLANKS   PPSLOC 60                                           CLE034
     C                     PARM           PCRFL                                               CLE034
     C                     PARM           WORED   5                                           CLE038
     C                     PARM           WALAM  130                                          CLE038
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
     C/COPY WNCPYSRC,LE2070C002
     C                     CALL 'SD2410'
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           @PARM3                                              222373
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
     C/COPY WNCPYSRC,LE2070C003
      *
      ** If database error terminate processing
     C           PMDBSE    IFNE *ZERO
     C           *LOCK     IN   LDA
     C                     MOVELPMDBFL    DBFILE           *************
     C                     MOVE PMDBSE    DBASE            * DBERROR X *
     C                     MOVELPMDBKY    DBKEY            *************
     C                     MOVELPMDPGM    DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           PMERCD    IFNE *BLANK
     C                     MOVE *ON       ERRDET
     C***********          MOVEL'LEV1017' ZAMSID                          123801
     C           3         SUBSTPMERCD:1  WSERR   3                       123801
     C                     MOVEL'ESM0'    ZAMSID                          123801
     C                     MOVE WSERR     ZAMSID                          123801
     C                     MOVEL'DRSMM   'ZAMSGF                          123801
     C                     EXSR ZASNMS
     C                     MOVEL'LERMSGF 'ZAMSGF                          189632
     C                     ENDIF
      *
     C                     EXSR SRSETT
     C                     ENDIF
      *
      **  Update rollover record.
      *
     C                     EXSR SRUROL
      *
      **  Update shadow files.
      *
     C                     EXSR SRUSHW
      *
      **  Process this once in Batch mode.
      *
     C           PMODE     IFEQ 'B'
     C                     EXSR SRPOMP
     C                     MOVE *ON       *IN79
     C                     ENDIF
      *
      **  Read next test harness record.
      *
     C           PMODE     IFEQ 'P'
     C                     UPDATLE2070D0
     C                     READ LE2070PD                 79
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSTRT  -  First Screen (Prompt for key input)                *
      * Called by: Main routine                                       *
      * Calls    : SRINIP - Initialise prompt screen                  *
      *            SRCLMQ - Clears the message queue                  *
      *            SRVPMT - Validate prompt key input                 *
      *            SRDINI - Initial set up of detail screen           *
      *            SRWARN - Display warning message if loan is synd.  *   159256
      *****************************************************************
     C           SRSTRT    BEGSR
      *
      **  Initialise screen and work fields.
      *
     C                     EXSR SRINIP
     C                     EXSR SRCLMQ
      *
     C           WFMT      DOWEQ'F0'
      *
      **  Display initial screen.
      *
     C                     WRITELE2070F0
     C                     WRITELE2070C1
     C                     EXFMTLE2070F1
     C                     EXSR SRCLMQ
      *
      **  Clear screen indicators.
     C                     MOVEA'0000'    *IN,30
      *
      **  F3 pressed, end loop.
     C           *INKC     IFEQ *ON
     C                     MOVE *BLANKS   WFMT
     C                     LEAVE
     C                     ENDIF
     C/COPY WNCPYSRC,LE2070C012
      *
      **  Otherwise, Enter was pressed, validate prompt details.
     C                     EXSR SRVPMT
      *                                                                   159256
      ** Issue warning if changing a syndicated transaction.              159256
      *                                                                   159256
     C           SACTN     IFNE 'E'                                       159256
     C           SACTN     ANDNE*BLANK                                    159256
     C                     MOVE SALON     SLOAN                           165969
     C                     EXSR SRWARN                                    159256
     C           WE232     IFNE *BLANK                                    159256
     C                     MOVEA'11'      *IN,30                          159256
     C                     ENDIF                                          159256
     C                     ENDIF                                          159256
      *
      **  No errors and Action code is blank.
     C                     MOVEA*IN,30    W4INDS
     C                     SELEC
     C           SACTN     WHEQ *BLANK
     C           W4INDS    ANDEQ'0000'
     C                     MOVE 'S0'      WFMT
     C                     MOVE SALON     SLOAN
      *
      **  No errors and Action code entered.
     C           SACTN     WHNE *BLANK
     C           W4INDS    ANDEQ'0000'
     C                     MOVE 'F0'      WWRTRN
     C                     MOVE SALON     SLOAN
     C                     EXSR SRDINI
     C                     ENDSL
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRVPMT  -  Validate Prompt Key Input                          *
      * Called by: SRSTRT - First Screen (Prompt for key input)       *
      *            SRBTCH - Batch processing                          *
      * Calls    : SRLOAN - Validate loan number and fetch details    *
      *            SRCAUT - Check if user is authorised to action     *
      *            SRAUTH - Validate authorisation action             *
      *****************************************************************
     C           SRVPMT    BEGSR
      *
      **  Action code entered.
      *
     C                     SELEC
     C           SACTN     WHNE *BLANK
      *
      **  Action code must be 'E', 'A' or 'X'
      **  Or 'Q' if CLE030 is switched on                                 CLE030
      *                                                                   CLE030
     C           SLSEL     IFNE 'E'                                       CAP062
     C           SLSEL     ANDNE'E'                                       CAP062
     C***********SACTN     IFNE 'E'                                       CAP062
     C           SACTN     ANDNE'E'                                       CAP062
     C           SACTN     ANDNE'A'
     C           SACTN     ANDNE'X'
     C           SACTN     IFEQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     ELSE                                           CLE030
     C                     MOVE *ON       *IN30
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV0021' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF                                          CLE030
     C                     ENDIF
      *
      **  Validate loan no.
     C           *IN30     IFEQ *OFF
     C                     MOVE SALON     WLNRF
     C                     EXSR SRLOAN
     C           @ERCOD    IFNE *BLANKS
     C                     MOVE *ON       *IN31
     C                     MOVE *ON       ERRDET
     C                     MOVEL@ERCOD    ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2070C016
      *
      **  Must be a valid action for user.
     C                     MOVEA*IN,30    W4INDS  4
     C           W4INDS    IFEQ '0000'
     C                     EXSR SRCAUT
     C           @ERR      IFEQ 0
     C           SACTN     ANDEQ'X'
     C                     EXSR SRAUTH
     C                     ENDIF
      *                                                                   CLE030
     C           @ERR      IFEQ 0                                         CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C                     EXSR SRVLRL                                    CLE030
     C                     ENDIF                                          CLE030
      *                                                                   CLE030
     C                     ENDIF
      *
      **  Otherwise, action code is blank.
      *
      **  Loan number must be blank also.
     C           SACTN     WHEQ *BLANK
     C           SALON     ANDNE*BLANKS
     C                     MOVE *ON       *IN31
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV1037' ZAMSID
     C                     EXSR ZASNMS
      *
      **  Requiring Authorisation field should be 'Y' or 'N'.
     C           SACTN     WHEQ *BLANK
     C***********SRAUT     ANDNE'N'                                       120025
     C           SRAUT     IFNE 'N'                                       120025
     C           SRAUT     ANDNE'Y'
     C                     MOVE *ON       *IN33
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV1004' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF                                          120025
      *                                                                   120025
      **  Review from loan number must be numeric if entered              120025
     C           SRLON     IFNE *BLANKS                                   120025
     C                     MOVE '0'       WWRK7   7                       120025
     C                     MOVELSRLON     WWRK7                           120025
     C                     TESTN          WWRK7      85                   120025
      *                                                                                       CLE148
     C           WALLOW    IFEQ 'Y'                                                           CLE148
     C                     MOVEL'LELOAN'  WCHR10 10                                           CLE148
     C                     MOVE 'ISO '    WCHR10                                              CLE148
     C                     CALL WCHR10                                                        CLE148
     C                     PARM SRLON     PLNRF   6                                           CLE148
     C                     PARM *BLANKS   PVALID  6                                           CLE148
     C                     PARM *BLANKS   PCHKD   1                                           CLE148
     C                     PARM *BLANKS   PDATA   2                                           CLE148
     C                     ENDIF                                                              CLE148
      *                                                                                       CLE148
     C           *IN85     IFEQ '0'                                       120025
     C           WALLOW    ANDEQ'N'                                                           CLE148
     C           PVALID    ORNE *BLANKS                                                       CLE148
     C           WALLOW    ANDEQ'Y'                                                           CLE148
     C                     MOVE *ON       *IN32                           120025
     C                     MOVE *ON       ERRDET                          120025
     C**********           MOVEL'LEV0008' ZAMSID                                       120025 CLE148
     C           WALLOW    IFEQ 'N'                                                           CLE148
     C                     MOVEL'LEL0824' ZAMSID                                              CLE148
     C                     ELSE                                                               CLE148
     C                     MOVEL'LEL0822' ZAMSID                                              CLE148
     C                     MOVELPDATA     ZAMSDA                                              CLE148
     C                     ENDIF                                                              CLE148
     C                     EXSR ZASNMS                                    120025
     C                     ENDIF                                          120025
     C                     ENDIF                                          120025
      *                                                                   120025
     C                     ENDSL
     C/COPY WNCPYSRC,LE2070C013
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSFIL  -  Subfile processing                                 *
      * Called by: Main processing                                    *
      * Calls    : SRSCLF - Clear all subfile fields                  *
      *            SRSCLF - Clear subfile                             *
      *            SRLOAD - Load subfile records                      *
      *            SRCLMQ - Clears the message queue                  *
      *            SRSNXT - Load next set of records to subfile       *
      *            SRSVAL - Validate subfile fields                   *
      *            SRSPRO - Process selection action                  *
      *            SRSREV - Process criteria option                   *
      *****************************************************************
     C           SRSFIL    BEGSR
      *
      **  Initialise all subfile fields and clear subfile.
      *
     C                     EXSR SRSCLF
     C                     EXSR SRSCLR
      *
      **  Load subfile records, then display screen.
      *
     C                     MOVE SRLON     WKSLN
     C                     MOVE SRAUT     WKAUT
     C                     EXSR SRLOAD
      *
      **  Save criteria option.
      *
     C                     MOVE SRLON     ORLON   6
     C                     MOVE SRAUT     ORAUT   1
      *
     C           WFMT      DOUNE'S0'
      *
     C                     WRITELE2070F2
     C                     WRITELE2070C1
     C                     EXFMTLE2070C0
     C           *IN88     IFEQ *OFF
     C           NOSUBF    ANDEQ*OFF
     C                     EXSR SRCLMQ
     C                     ENDIF
     C                     MOVEA'00'      *IN,35
      *
     C                     SELEC
      *
      **  F3 was pressed, so exit.
     C           *INKC     WHEQ *ON
     C                     MOVE *BLANK    WFMT
      *
      **  F12 was pressed, go back to first screen.
     C           *INKL     WHEQ *ON
     C                     MOVE 'F0'      WFMT
      *
      **  F5 was pressed, reload subfile.
     C           *INKE     WHEQ *ON
     C                     EXSR SRSCLR
     C                     EXSR SRLOAD
      *
      **  Rollup pressed, load next set of records.
     C           *IN88     WHEQ *ON
     C                     EXSR SRSNXT
      *
      **  Enter key was pressed, validate subfile and process options.
     C           *INKC     WHEQ *OFF
     C           *INKL     ANDEQ*OFF
     C           *INKE     ANDEQ*OFF
     C           *IN88     ANDEQ*OFF
     C           NOSUBF    IFEQ *OFF
     C                     EXSR SRSVAL
     C           @ERR      IFEQ *ZERO
     C           DELMOD    ANDNE'Y'                                       CAP062
     C                     EXSR SRSPRO
     C           WFMT      IFNE *BLANKS
     C                     MOVE 'S0'      WFMT
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C           @ERR      IFEQ *ZERO
     C                     EXSR SRSREV
     C                     ENDIF
      *
     C                     ENDSL
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSCLF  -  Clear all subfile fields                           *
      * Called by: SRSFIL - Subfile processing                        *
      *            SRLOAD - Load subfile records                      *
      *            SRSNXT - Loand next set of records to subfile      *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSCLF    BEGSR
      *
      **  Selection field
     C                     MOVE *BLANKS   SLSEL
      *
      **  Loan number
     C                     MOVE *BLANKS   SLOAN
      *
      **  Rollover date
     C                     MOVE *BLANKS   SRLDT
      *
      **  Next rollover date
     C                     MOVE *BLANKS   SNROD
      *
      **  Rollover frequency
     C                     MOVE *BLANKS   SRLFQ
      *
      **  Rollover day number
     C                     MOVE *BLANKS   SRLDY
      *
      **  Status narrative
     C                     MOVE *BLANKS   SRSTS
      *
      **  Subfile change and error indicators
     C                     MOVE *OFF      *IN24
     C                     MOVE *OFF      *IN34
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSCLR  -  Clear subfile.                                     *
      * Called by: SRSFIL - Subfile processing                        *
      *            SRSREV - Process criteria option                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSCLR    BEGSR
      *
     C                     MOVEA'10'      *IN,82
     C                     WRITELE2070C0
     C                     MOVE *OFF      *IN82
      *
     C                     Z-ADD1         SRRN    40
     C                     WRITELE2070F0
     C                     WRITELE2070F2
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRLOAD  -  Load subfile records                               *
      * Called by: SRSFIL - Subfile processing                        *
      *            SRSREV - Process criteria option                   *
      * Calls    : SRLOAN - Validate loan number and fetch details    *
      *            SRSCLF - Clear alll subfile fields                 *
      *            SRSFLD - Format subfile fields                     *
      *            SRRNXT - Read next record in LELOANL2 or LELOANL3  *
      *            SRMORE - Look for next valid record                *
      *****************************************************************
     C           SRLOAD    BEGSR
      *
      ** If fix (repair) mode                                             CAP062
     C           PMODE     IFEQ 'F'                                       CAP062
     C           WKSLN     SETLLLEIROLP1                                  CAP062
     C                     READ LEIROLP1                 89               CAP062
     C                     ELSE                                           CAP062
      ** Retrieve from either of 2 files, depending on user input
      *
     C           WKAUT     IFEQ 'Y'
     C           WKSLN     SETLLLOANL3F
     C                     READ LOANL3F                  89
     C                     ELSE
     C           WKSLN     SETLLLOANL2F
     C                     READ LOANL2F                  89
     C                     ENDIF
     C                     ENDIF                                          CAP062
      *
     C                     Z-ADD1         WSCTR   20
     C                     Z-ADDSRRN      SRNBR
      *
     C           *IN89     DOWEQ*OFF
     C           WSCTR     ANDLE10
      *
      **  Get loan details to validate if it should be included.
     C           PMODE     IFEQ 'F'                                       CAP062
     C                     MOVE SLOAN     WLNRF                           CAP062
     C                     ELSE                                           CAP062
     C**********           Z-ADDLNRF      WLNRF                                               CLE148
     C                     MOVELLNRF      WLNRF                                               CLE148
     C                     ENDIF                                          CAP062
     C                     EXSR SRLOAN
      *
     C           @ERCOD    IFEQ *BLANKS
      *
      **  User must have access to the branch of the loan on display
      *
     C                     Z-ADD*ZERO     @ERR
     C           BGMBIN    IFEQ 'Y'
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBBBU'
     C                     PARM BRCA      @ZBR
     C                     PARM           @USER
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVBBU'
     C                     PARM BRCA      @ZBR
     C                     PARM           @ERR
     C                     ENDIF
     C                     ENDIF
      *
      **  Setup subfile fields.
      *
     C           @ERR      IFEQ *ZERO
      *                                                                   CAP062
     C           PMODE     IFEQ 'F'                                       CAP062
     C                     EXSR SRSFLF                                    CAP062
     C                     ELSE                                           CAP062
     C                     EXSR SRSCLF
     C                     EXSR SRSFLD
     C                     ENDIF                                          CAP062
      *
      **  Write to subfile record.
     C                     WRITELE2070S0
      *
     C                     ADD  1         WSCTR
     C                     ADD  1         SRRN
      *
     C                     ENDIF
     C                     ENDIF
      *
      **  Read next record
      *
     C                     EXSR SRRNXT
      *
     C                     ENDDO
      *
      **  No subfile records to display.
      *
     C           *IN89     IFEQ *ON
     C           WSCTR     ANDEQ1
     C           *IN83     ANDEQ*OFF
     C                     MOVE *ON       *IN83
     C                     MOVE *ON       NOSUBF  1
     C                     MOVEL'LEV1005' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     MOVE *OFF      NOSUBF
     C                     MOVE *BLANKS   ZAMSID
     C                     EXSR SRCLMQ
     C                     Z-ADDSRRN      SLAST   40
     C**********           Z-ADDLNRF      LLAST   60                                          CLE148
     C                     MOVELLNRF      LLAST   6                                           CLE148
     C                     ENDIF
      *
      **  Search for more valid records to set end-of-subfile indicator.
      *
     C                     EXSR SRMORE
      *
      **  Display 'Page Keys' narrative at the bottom, if necessary.
      *
     C           SRRN      IFLE 10
     C           *IN89     OREQ *ON
     C                     MOVE *ON       *IN81
     C                     ELSE
     C                     MOVE *OFF      *IN81
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSNXT  -  Load Next Set of records to subfile                *
      * Called by: SRSFIL - Subfile processing                        *
      * Calls    : SRLOAN - Validate loan number and fetch details    *
      *            SRSCLF - Clear alll subfile fields                 *
      *            SRSFLD - Format subfile fields                     *
      *            SRRNXT - Read next record in LELOANL2 or LELOANL3  *
      *            SRMORE - Look for next valid record                *
      *****************************************************************
     C           SRSNXT    BEGSR
      *
      **  Read next record
      ** If fix (repair) mode                                             CAP062
     C           PMODE     IFEQ 'F'                                       CAP062
     C           LLAST     SETLLLEIROLP1                                  CAP062
     C                     READ LEIROLP1                 89               CAP062
     C                     ELSE                                           CAP062
      *
     C           WKAUT     IFEQ 'Y'
     C           LLAST     SETLLLOANL3F
     C                     READ LOANL3F                  89
     C                     ELSE
     C           LLAST     SETLLLOANL2F
     C                     READ LOANL2F                  89
     C                     ENDIF
      *                                                                   CAP062
     C                     ENDIF                                          CAP062
      *
     C                     Z-ADD1         WSCTR
     C                     Z-ADDSLAST     SRNBR
     C                     Z-ADDSLAST     SRRN
      *
     C           *IN89     DOWEQ*OFF
     C           WSCTR     ANDLE10
      *
      **  Get loan details to validate if it should be included.
     C**********           Z-ADDLNRF      WLNRF                                               CLE148
     C                     MOVELLNRF      WLNRF                                               CLE148
     C                     EXSR SRLOAN
      *
     C           @ERCOD    IFEQ *BLANKS
      *
      **  User must have access to the branch of the loan on display
      *
     C                     Z-ADD*ZERO     @ERR
     C           BGMBIN    IFEQ 'Y'
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBBBU'
     C                     PARM BRCA      @ZBR
     C                     PARM           @USER
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVBBU'
     C                     PARM BRCA      @ZBR
     C                     PARM           @ERR
     C                     ENDIF
     C                     ENDIF
      *
      **  Setup subfile fields.
      *
     C           @ERR      IFEQ *ZERO
     C           PMODE     IFEQ 'F'                                       CAP062
     C                     EXSR SRSFLF                                    CAP062
     C                     ELSE                                           CAP062
     C                     EXSR SRSCLF
     C                     EXSR SRSFLD
     C                     ENDIF                                          CAP062
      *
      **  Write to subfile record.
     C                     WRITELE2070S0
      *
     C                     ADD  1         WSCTR
     C                     ADD  1         SRRN
      *
     C                     ENDIF
     C                     ENDIF
      *
      **  Read next record
      *
     C                     EXSR SRRNXT
      *
     C                     ENDDO
      *
     C           *IN89     IFEQ *OFF
     C                     Z-ADDSRRN      SLAST
     C**********           Z-ADDLNRF      LLAST                                               CLE148
     C                     MOVELLNRF      LLAST                                               CLE148
     C                     ENDIF
      *
      **  Search for more valid records to set end-of-subfile indicator.
      *
     C                     EXSR SRMORE
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRMORE  -  Look for Next valid record.                        *
      * Called by: SRLOAD - Load subfile records                      *
      *            SRSNXT - Load next set of records to subfile       *
      * Calls    : SRLOAN - Validate loan number and fetch details    *
      *            SRRNXT - Read next record in LELOANL2 or LELOANL3  *
      *****************************************************************
     C           SRMORE    BEGSR
      *
      **  A valid record is found if *IN89 is *OFF after this subroutine.
      *
     C           *IN89     IFEQ *OFF
      *
     C                     MOVE *ON       *IN86
      *
     C           *IN89     DOWEQ*OFF
     C           *IN86     ANDEQ*ON
     C**********           Z-ADDLNRF      WLNRF                                               CLE148
     C                     MOVELLNRF      WLNRF                                               CLE148
     C                     EXSR SRLOAN
      *
     C           @ERCOD    IFEQ *BLANKS
     C                     Z-ADD*ZERO     @ERR
     C           BGMBIN    IFEQ 'Y'
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBBBU'
     C                     PARM BRCA      @ZBR
     C                     PARM           @USER
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVBBU'
     C                     PARM BRCA      @ZBR
     C                     PARM           @ERR
     C                     ENDIF
     C                     ENDIF
     C           @ERR      IFEQ *ZERO
     C                     MOVE *OFF      *IN86
     C                     ENDIF
     C                     ENDIF
      *
     C           *IN86     IFEQ *ON
     C                     EXSR SRRNXT
     C                     ENDIF
     C                     ENDDO
     C                     MOVE *IN86     *IN89
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRRNXT  -  Read Next record in LELOANL2 or LELOANL3           *
      * Called by: SRLOAD - Load subfile records                      *
      *            SRSNXT - Load next set of records to subfile       *
      *            SRMORE - Look for next valid record                *
      * Calls    : None                                               *
      *****************************************************************
     C           SRRNXT    BEGSR
      *                                                                   CAP062
      ** If fix (repair) mode                                             CAP062
     C           PMODE     IFEQ 'F'                                       CAP062
     C                     READ LEIROLP1                 89               CAP062
     C                     ELSE                                           CAP062
      *
      **  WKAUT should be valid.  Output value is *IN89.
      *
     C           WKAUT     IFEQ 'Y'
     C                     READ LOANL3F                  89
     C                     ELSE
     C                     READ LOANL2F                  89
     C                     ENDIF
      *                                                                   CAP062
     C                     ENDIF                                          CAP062
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSFLD  -  Format Subfile fields                              *
      * Called by: SRLOAD - Loan Subfile records                      *
      *            SRSNXT - Load next set of records to subfile       *
      * Calls    : SRSTAT - Determine rollover status narrative       *
      *****************************************************************
     C           SRSFLD    BEGSR
      *
      **  Loan number and customer number.
      *
     C                     MOVE LNRF      SSLON
      *                                                                                       209026
      ** If the loan is a Participation Purchased, & System Value                             209026
      **  LoanCustOriginPurch = 'O', use Original Borrower:                                   209026
     C           PTYP      IFEQ 64                                        158488
     C           PTYP      OREQ 65                                        158488
     C           PTYP      OREQ 68                                                            209026
     C           PTYP      OREQ 71                                                            209026
     C           PPCUST    IFEQ 'O'                                                           209026
     C                     MOVE OLNO      SSCUS                           158488
     C                     ELSE                                                               209026
     C                     MOVE CNUML     SSCUS                                               209026
     C                     ENDIF                                                              209026
      * Else, not a Participation Purchased:                                                  209026
     C                     ELSE                                           158488
     C***********          MOVE CNUM      SSCUS                           169211
     C                     MOVE CNUML     SSCUS                           169211
     C                     END                                            158488
      *                                                                   126274
      ** Access the Customer Details file for Shortname                   126274
      *                                                                   126274
     C                     CALL 'AOCUSTR0'                                126274
     C                     PARM '       ' PRTCD                           126274
     C                     PARM '*KEY   ' POPTN                           126274
     C                     PARM SSCUS     PCUST                           126274
     C                     PARM           PKYST                           126274
     C           SDCUST    PARM SDCUST    DSSDY                           126274
     C                     MOVE *BLANKS   SCSNM                           126274
     C           PRTCD     IFEQ *BLANKS                                   126274
     C/COPY WNCPYSRC,LE2070C008
     C                     MOVE BBCSSN    SCSNM                           126274
     C/COPY WNCPYSRC,LE2070C009
     C                     ELSE                                           126274
     C                     MOVE 'Unknown' SCSNM                           126274
     C                     ENDIF                                          126274
      *
      **  Rollover date.
      *
     C                     Z-ADDRLDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SSRDT
      *
      **  Next Rollover date.
      *
     C           NROD      IFNE 0                                                             193559
     C                     Z-ADDNROD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SSNRD
      *                                                                                       193559
      ** If next rollover date field (NROD) has no value then                                 193559
      ** recalculate next rollover date.                                                      193559
      *                                                                                       193559
     C                     ELSE                                                               193559
     C           RLDT      IFNE *ZEROS                                                        193559
     C           RLFQ      ANDNE*BLANK                                                        193559
     C                     Z-ADDRLDT      ZDAYNO                                              193559
     C                     MOVE RLFQ      ZFREQ                                               193559
     C                     Z-ADDRLDY      ZMDAY                                               193559
     C                     MOVE CCY       ZCCY                                                193559
     C                     EXSR ZFREQB                                                        193559
     C                     EXSR ZDATE2                                                        193559
     C                     MOVELZADATE    SSNRD                                               193559
     C                     ELSE                                                               193559
     C                     MOVE *BLANKS   SSNRD                                               193559
     C                     END                                                                193559
     C                     END                                                                193559
      *
      **  Rollover frequency and day number.
      *
     C                     MOVELRLFQ      SSRFQ
     C           RLDY      IFNE *ZEROS
     C                     MOVE RLDY      SSRDY
     C                     ELSE
     C                     MOVE *BLANKS   SSRDY
     C                     ENDIF
      *
      **  Rollover status.
      *
     C                     MOVE RSTS      WRSTS   1
     C                     EXSR SRSTAT
     C                     MOVELWSTAT     SSRST
      *
     C                     ENDSR
      /EJECT
      *****************************************************************   CAP062
      * SRSFLF  -  Format Subfile fields in Repair Mode               *   CAP062
      * Called by: SRLOAD - Loan Subfile records                      *   CAP062
      *            SRSNXT - Load next set of records to subfile       *   CAP062
      * Calls    : SRSTAT - Determine rollover status narrative       *   CAP062
      *****************************************************************   CAP062
     C           SRSFLF    BEGSR                                          CAP062
      *                                                                   CAP062
      **  Loan number and customer number.                                CAP062
      *                                                                   CAP062
     C                     MOVE SLOAN     SSLON                           CAP062
     C           PTYPL     IFEQ 64                                        CAP062
     C           PTYPL     OREQ 65                                        CAP062
     C                     MOVE OLNO      SSCUS                           CAP062
     C                     ELSE                                           CAP062
     C                     MOVE SCNUM     SSCUS                           CAP062
     C                     END                                            CAP062
      *                                                                   CAP062
      ** Access the Customer Details file for Shortname                   CAP062
      *                                                                   CAP062
     C                     CALL 'AOCUSTR0'                                CAP062
     C                     PARM '       ' PRTCD                           CAP062
     C                     PARM '*KEY   ' POPTN                           CAP062
     C                     PARM SSCUS     PCUST                           CAP062
     C                     PARM           PKYST                           CAP062
     C           SDCUST    PARM SDCUST    DSSDY                           CAP062
     C                     MOVE *BLANKS   SCSNM                           CAP062
     C           PRTCD     IFEQ *BLANKS                                   CAP062
     C                     MOVE BBCSSN    SCSNM                           CAP062
     C                     ELSE                                           CAP062
     C                     MOVE 'Unknown' SCSNM                           CAP062
     C                     ENDIF                                          CAP062
      *                                                                   CAP062
      **  Rollover date.                                                  CAP062
      *                                                                   CAP062
     C                     MOVE SRLDTB    ZDATE                           CAP062
     C                     EXSR ZDATE1                                    CAP062
     C                     EXSR ZDATE2                                    CAP062
     C                     MOVE ZADATE    SSRDT                           CAP062
      *                                                                   CAP062
      **  Next Rollover date.                                             CAP062
      *                                                                   CAP062
     C                     MOVE SNRODB    ZDATE                           CAP062
     C                     EXSR ZDATE1                                    CAP062
     C                     EXSR ZDATE2                                    CAP062
     C                     MOVE ZADATE    SSNRD                           CAP062
      *                                                                   CAP062
      **  Rollover frequency and day number.                              CAP062
      *                                                                   CAP062
     C                     MOVELSRLFQB    SSRFQ                           CAP062
     C           SRLDYB    IFNE *ZEROS                                    CAP062
     C                     MOVE SRLDYB    SSRDY                           CAP062
     C                     ELSE                                           CAP062
     C                     MOVE *BLANKS   SSRDY                           CAP062
     C                     ENDIF                                          CAP062
      *                                                                   CAP062
      **  Rollover status.                                                CAP062
      *                                                                   CAP062
     C                     MOVE SRSTS     WRSTS   1                       CAP062
     C                     EXSR SRSTAT                                    CAP062
     C                     MOVELWSTAT     SSRST                           CAP062
      *                                                                   CAP062
     C                     ENDSR                                          CAP062
      *****************************************************************
      * SRSREV  -  Process criteria options                           *
      * Called by: SRSFIL - Subfile processing                        *
      * Calls    : SRSCLR - Clear subfile                             *
      *          : SRCLMQ - Clears the message queue                  *
      *          : SRLOAD - Load subfile records                      *
      *****************************************************************
     C           SRSREV    BEGSR
      *
      **  Validate if change in review from field and req. auth invalid.
      *
     C           SRLON     IFNE ORLON
     C           SRAUT     ORNE 'N'
     C           SRAUT     ANDNE'Y'
     C           *IN83     ANDEQ*OFF
     C           SRAUT     ORNE ORAUT
      *
     C                     EXSR SRSCLR
     C                     EXSR SRCLMQ
      *
     C           SRAUT     IFEQ *BLANK
     C                     MOVE 'N'       SRAUT
     C                     ENDIF
      *
     C**********           MOVE SRLON     WKSLN   60                                          CLE148
     C                     MOVE SRLON     WKSLN   6                                           CLE148
     C                     MOVE SRAUT     WKAUT   1
      *
     C           SRLON     IFEQ *BLANKS
     C                     MOVE *LOVAL    WKSLN
     C                     ENDIF
      *
      **  Requiring Authorisation field should be 'Y' or 'N'.
     C           SRAUT     IFNE 'N'
     C           SRAUT     ANDNE'Y'
     C                     MOVE *ON       *IN36
     C                     MOVEL'LEV1006' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE *HIVAL    WKSLN
     C                     ENDIF
      *                                                                   120025
      **  Review from loan number must be numeric if entered              120025
     C           SRLON     IFNE *BLANKS                                   120025
     C                     MOVE '0'       WWRK7   7                       120025
     C                     MOVELSRLON     WWRK7                           120025
     C                     TESTN          WWRK7      85                   120025
      *                                                                                       CLE148
     C           WALLOW    IFEQ 'Y'                                                           CLE148
     C                     MOVEL'LELOAN'  WCHR10                                              CLE148
     C                     MOVE 'ISO '    WCHR10                                              CLE148
     C                     CALL WCHR10                                                        CLE148
     C                     PARM SRLON     PLNRF   6                                           CLE148
     C                     PARM *BLANKS   PVALID  6                                           CLE148
     C                     PARM *BLANKS   PCHKD   1                                           CLE148
     C                     PARM *BLANKS   PDATA   2                                           CLE148
     C                     ENDIF                                                              CLE148
      *                                                                                       CLE148
     C           *IN85     IFEQ '0'                                       120025
     C           WALLOW    ANDEQ'N'                                                           CLE148
     C           PVALID    ORNE *BLANKS                                                       CLE148
     C           WALLOW    ANDEQ'Y'                                                           CLE148
     C                     MOVE *ON       *IN35                           120025
     C**********           MOVEL'LEV0008' ZAMSID                                       120025 CLE148
     C           WALLOW    IFEQ 'N'                                                           CLE148
     C                     MOVEL'LEL0824' ZAMSID                                              CLE148
     C                     ELSE                                                               CLE148
     C                     MOVEL'LEL0822' ZAMSID                                              CLE148
     C                     MOVELPDATA     ZAMSDA                                              CLE148
     C                     ENDIF                                                              CLE148
     C                     EXSR ZASNMS                                    120025
     C                     MOVE *HIVAL    WKSLN                           120025
     C                     ENDIF                                          120025
     C                     ENDIF                                          120025
      *
     C                     EXSR SRLOAD
      *
     C                     MOVE SRLON     ORLON
     C                     MOVE SRAUT     ORAUT
      *
      **  Refresh screen to reflect updates on records.
      *
     C                     ELSE
      *
     C                     EXSR SRSCLR
     C                     EXSR SRLOAD
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSVAL  -  Validate subfile fields                            *
      * Called by: SRSFIL - Subfile processing                        *
      * Calls    : SRLOAN - Validate loan number and fetch details    *
      *            SRCAUT - Check if user is authorised to action     *
      *            SRAUTH - Validate authorisation action             *
      *****************************************************************
     C           SRSVAL    BEGSR
      *
      **  Validate all option fields entered.
      *
     C                     Z-ADD*ZERO     @ERR1   10
     C                     Z-ADD*ZERO     WRRN    40
     C                     READCLE2070S0                 87
      *
     C           *IN87     DOWEQ*OFF
      *
      **  Initialise subfile indicators.
     C                     MOVE *OFF      *IN34
     C                     MOVEA'00'      *IN,30
      *
     C           SLSEL     IFNE *BLANK
      *
      **  Action code must be 'E', 'A' or 'X'
      * If in Repair mode, only 'U' and 'Q' actions allowed.              CAP062
     C           PMODE     IFNE 'F'                                       CAP062
     C***********SLSEL     IFNE 'E'                                       CAP062
     C           SLSEL     ANDNE'E'                                       CAP062
     C           SLSEL     ANDNE'A'
     C           SLSEL     ANDNE'X'
     C           SLSEL     ANDNE'Q'                                       CLE030
     C           PMODE     OREQ 'F'                                       CAP062
     C           SLSEL     ANDNE'U'                                       CAP062
     C           SLSEL     ANDNE'Q'                                       CAP062
     C                     MOVE *ON       *IN34
     C           PMODE     IFEQ 'F'                                       CAP062
     C                     MOVEL'LEA1044' ZAMSID                          CAP062
     C                     EXSR ZASNMS                                    CAP062
     C                     ELSE                                           CAP062
      *                                                                   CLE030
     C           CLE030    IFNE 'Y'                                       CLE030
     C                     MOVEL'LEV1007' ZAMSID
     C                     ELSE                                           CLE030
     C                     MOVEL'LEV0171' ZAMSID                          CLE030
     C                     ENDIF                                          CLE030
      *                                                                   CLE030
     C                     EXSR ZASNMS
     C                     ENDIF                                          CAP062
     C                     ENDIF
      *
      **  Get loan details.
     C           *IN34     IFEQ *OFF
     C           SLSEL     ANDNE'D'                                       CAP062
     C           PMODE     OREQ 'F'                                       CAP062
     C           SLSEL     ANDNE'Q'                                       CAP062
     C                     MOVE SSLON     WLNRF
     C                     EXSR SRLOAN
     C           @ERCOD    IFNE *BLANKS
     C                     MOVE *ON       *IN34
     C                     MOVEL@ERCOD    ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      **  Must be a valid action for user.
     C           *IN34     IFEQ *OFF
     C           PMODE     IFEQ 'F'                                       CAP062
     C                     SELEC                                          CAP062
     C           SLSEL     WHEQ 'U'                                       CAP062
     C                     MOVE 'A'       SACTN                           CAP062
     C           SLSEL     WHEQ 'Q'                                       CAP062
     C                     MOVE 'D'       SACTN                           CAP062
     C                     ENDSL                                          CAP062
     C                     ELSE                                           CAP062
     C                     MOVE SLSEL     SACTN
     C                     ENDIF                                          CAP062
     C                     EXSR SRCAUT
     C           @ERR      IFEQ 0
     C           SLSEL     ANDEQ'X'
     C                     EXSR SRAUTH
     C                     ENDIF
     C           @ERR      IFEQ 0                                         CLE030
     C           SLSEL     ANDEQ'Q'                                       CLE030
     C                     EXSR SRVLRL                                    CLE030
     C                     ENDIF                                          CLE030
     C                     ENDIF
      *                                                                   CAP062
      * If Delete mode then EXSR INVLTM.                                  CAP062
     C                     MOVE *BLANKS   DELMOD  1                       CAP062
     C           SLSEL     IFEQ 'Q'                                       CAP062
     C           PMODE     ANDEQ'F'                                       CAP062
     C                     EXSR INVLTM                                    CAP062
     C                     MOVE *BLANKS   SLSEL                           CAP062
     C                     MOVE 'Y'       DELMOD                          CAP062
     C                     ENDIF                                          CAP062
      *
      **  Update error indicators.
     C           *IN30     IFEQ *ON
     C           *IN34     OREQ *ON
     C                     Z-ADD1         @ERR1
     C                     MOVE *ON       *IN34
      *
      **  Get the first subfile record number with error.
     C           WRRN      IFEQ *ZERO
     C                     Z-ADDSRRN      WRRN
     C                     ENDIF
     C                     ENDIF
      *
      **  Update subfile record.
     C                     MOVE *ON       *IN24
     C                     UPDATLE2070S0
      *
      **  Selection may have been blanked out after an error.
      **  Set off the highlight attribute.
     C                     ELSE
     C                     MOVE *OFF      *IN34
     C                     UPDATLE2070S0
     C                     ENDIF
      *
      **  Read next changed subfile record.
     C                     READCLE2070S0                 87
      *
     C                     ENDDO
      *
     C           WRRN      IFNE *ZERO
     C                     Z-ADDWRRN      SRNBR
     C                     ENDIF
     C                     Z-ADD@ERR1     @ERR
      *
     C                     ENDSR
      /EJECT
      *****************************************************************   CAP062
      * INVLTM  -  Call to Program LE2031                             *   CAP062
      * Called by: SRSVAL                                             *   CAP062
      * Calls    :                                                    *   CAP062
      *****************************************************************   CAP062
     C           INVLTM    BEGSR                                          CAP062
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
      *                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     MOVE 'Y'       SUPSYS  1                       CSC011
     C                     ELSE                                           CSC011
     C                     MOVE 'N'       SUPSYS                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     CALL 'LE2031'                                  CAP062
      *                                                                   CAP062
      * INPUTS                                                            CAP062
      * Invalid file name                                                 CAP062
     C                     PARM 'LEIROLPD'INVFIL  8                       CAP062
      *                                                                   CAP062
      * Repair Number                                                     CAP062
     C                     PARM XREPN     IREPN   50                      CAP062
      **Support*System On                                          CSC011 222373
     C**********           PARM SUPSYS    SUPSYS                   CSC011 222373
      **Front*Office ID / PC Transaction Reference                 CSC011 222373
     C**********           PARM STNRF     STNRF                    CSC011 222373
      **Transaction Timestamp                                      CSC011 222373
     C**********           PARM STMST     STMST                    CSC011 222373
      *                                                                   CAP062
     C                     ENDSR                                          CAP062
      *****************************************************************   CAP062
      /EJECT                                                              CAP062
      *****************************************************************
      * SRSPRO  -  Process Selected Action                            *
      * Called by: SRSFIL - Subfile processing                        *
      * Calls    : SRLOAN - Validate loan number and fetch details    *
      *            SRDINI - Initiali set up of detail screen          *
      *            SRPDET - Process detail screen                     *
      *            SREXST - Process extended settlement screen        *
      *            SRUROL - Process update of rollover record         *
      *            SRUSHW - Process update of shadow files            *
      *****************************************************************
     C           SRSPRO    BEGSR
      *
      **  Process each selection.
      *
     C                     READCLE2070S0                 87
      *
     C           *IN87     DOWEQ*OFF
     C           WFMT      ANDNE*BLANKS
      *
     C           SLSEL     IFNE *BLANK
      *
      **  Get loan details.
     C                     MOVE SSLON     WLNRF
     C                     EXSR SRLOAN
      *
      **  Prepare detail screen.
     C                     MOVE SLSEL     SACTN
     C                     EXSR SRDINI
     C                     MOVE 'S0'      WWRTRN
      *
     C           WFMT      DOUEQ'F0'
     C           WFMT      OREQ *BLANKS
     C           WFMT      OREQ 'S0'
      *
     C           WFMT      CASEQ'D1'      SRPDET
     C           WFMT      CASEQ'D2'      SREXST
     C           WFMT      CASEQ'UP'      SRUROL
     C           WFMT      CASEQ'ME'      SRUSHW
     C                     ENDCS
      *
     C                     ENDDO
      *
      **  F12 was pressed, don't clear the selection field.
     C           *INKL     IFEQ *OFF
     C                     MOVE *BLANK    SLSEL
     C                     UPDATLE2070S0
     C                     ELSE
     C                     MOVE *ON       @ERR
     C                     MOVE *BLANK    SLSEL
     C                     UPDATLE2070S0
     C                     Z-ADDSRRN      SRNBR
     C/COPY WNCPYSRC,LE2070C023
     C                     LEAVE
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     READCLE2070S0                 87
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRDINI  -  Initial Setup of Detail Screen                     *
      * Called by: SRBTCH - Batch processing                          *
      *            SRSTRT - Frist Screen (Prompt for key input)       *
      *            SRSPRO - Process Selected Action                   *
      * Calls    : SRMCCY - Check if multi-ccy rollover is allowed    *
      *            SRINID - Clear detail screen fields                *
      *            SRMOVR - Move rollover loan details to screen field*
      *****************************************************************
     C           SRDINI    BEGSR
      *
     C                     MOVE *OFF      ERRDET  1
     C                     MOVE *OFF      WARDET  1
     C                     MOVE *ON       WARFST  1
     C                     MOVE *OFF      SEVERE  1
     C                     MOVE *OFF      SELDON  1
     C                     MOVE *OFF      EXSDSP  1
     C                     MOVEA'0000'    *IN,26
     C                     MOVE *OFF      *IN61
     C                     MOVE *OFF      *IN62                           CDE002
     C                     MOVE *OFF      *IN63                           CDE002
     C                     MOVEAWA22      *IN,37
     C                     MOVEA'00'      *IN,64                          123335
     C                     MOVE *OFF      *IN67                                               CLE023
     C                     MOVE '0'       *IN23                                             AR847588
     C                     MOVE *OFF      *IN76                                               CLE036
      *
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVE *OFF      *IN74                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      **  Protect screen input fields if action is Enquire or Authorise.
      **  Or Requires Release if CLE030 is switched on.                   CLE030
      *
     C           SACTN     IFEQ 'E'
     C           SACTN     OREQ 'X'
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVE *ON       *IN28
     C                     ENDIF
      *
      **  Display Authorise command key.
      **  Only if value in ICD is set to 'N'                              123857
      *
     C           SACTN     IFEQ 'X'
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVE *ON       *IN26
     C                     ENDIF
      *
      **  Enable Extended Settlement Details for Discount Loan.
      **  and discounted parts purchased or sold                          122098
      *
     C           PTYP      IFEQ 63
     C           PTYP      OREQ 65                                        122098
     C           PTYP      OREQ 67                                        122098
     C                     MOVE *ON       *IN27
     C                     ENDIF
     C                     MOVE *BLANKS   WSOLD   1                       120025
     C           PTYP      IFEQ 66                                        120025
     C           PTYP      OREQ 67                                        120025
     C                     MOVE 'Y'       WSOLD                           120025
     C                     ENDIF                                          120025
      *
      **  Enable display of Funding Details if Analytical Accounting
      **  module is switched on and loan is directly funded.
      **  or enable display of Funding Details if Revenue Analysis        CDE002
      **  is switched on.                                                 CDE002
      *
     C           BGN0ST    IFEQ 'Y'
     C           FPRC      ANDNE*BLANKS
     C           CDE002    OREQ 'Y'                                       CDE002
     C           PTYP      IFEQ 62
     C           PTYP      OREQ 64
     C           PTYP      OREQ 66
     C           PTYP      OREQ 61                                        CDE002
     C           PTYP      OREQ 68                                        CDE002
     C           CLE005    ANDEQ'Y'                                       CDE002
     C           PTYP      OREQ 69
     C           CLE005    ANDEQ'Y'
     C           PTYP      OREQ 63                                        CDE002
     C           CDE002    ANDEQ'Y'                                       CDE002
     C           PTYP      OREQ 65                                        CDE002
     C           CDE002    ANDEQ'Y'                                       CDE002
     C           PTYP      OREQ 67                                        CDE002
     C           CDE002    ANDEQ'Y'                                       CDE002
     C********** PTYP      OREQ 72                                        CDE002
     C********** CLE005    ANDEQ'Y'                                       CDE002
     C                     MOVE *ON       *IN29
     C                     ENDIF
     C                     ENDIF
      *
      **  Get facility details.
      *
     C           WFCLT     CHAINLEFCLTL0             85
      *
      **  Enable New currency, New currency amount, Exchange rate,
      **  Exchange rate indicator, Next loan currency repayment
      **  amount will be displayed if Customer Lending Enhancement
      **  Syndications feature is switched on and if it is a
      **  Multi-currency rollover or if EMU Lending Multi currency        CEU020
      **  rollover feauture is switched on and if loan currency is        CEU020
      **  an 'In' currency                                                CEU020
      *
     C           CEU020    IFEQ 'Y'                                       CEU020
     C***********          MOVE 'A'       WRCDT                    CEU020 143507
     C***********          MOVE SALON     WLNRF                    CEU020 143507
     C***********WLOAN     CHAINCLOAN                85            CEU020 143507
     C************IN85     IFEQ '1'                                CEU020 143507
     C                     MOVE CCY       PCURR                           CEU020
     C                     Z-ADD61        DBASE                           CEU020
     C                     MOVE *ON       EDBAS                           CEU020
     C                     EXSR SRCURR                                    CEU020
     C***********          ENDIF                                   CEU020 143507
     C                     ENDIF                                          CEU020
      *                                                                   CEU020
     C           MCRA      IFEQ 'Y'
     C           CEU020    IFEQ 'Y'                                       CEU020
     C                     MOVE A6INCY    WINCY   1                       CEU020
     C                     Z-ADDA6TPSD    WTPSD   50                      CEU020
     C                     Z-ADDA6SPRT    WASPRT 138                      CEU020
     C                     ENDIF                                          CEU020
     C                     MOVE *ON       *IN61
      *
      **  Determine if multi-currency rollover
      **  can be processed.
     C                     EXSR SRMCCY
     C           MULTIC    IFEQ *ON
     C                     MOVEAALCY      ACCYA
     C           SACTN     IFEQ 'A'                                       120025
     C           NCCY      ORNE *BLANKS                                   120025
     C           CEU020    IFEQ 'Y'                                       CEU020
     C           NCCY      ORNE *BLANKS                                   152877
     C***********PTYP      IFEQ 63                                 CEU020 144915
     C***********PTYP      OREQ 65                                 CEU020 144915
     C***********PTYP      OREQ 67                                 CEU020 144915
     C                     MOVE '1'       *IN27                           120025
     C***********          ENDIF                                   120025 144915
     C                     ENDIF                                          CEU020
     C                     ENDIF                                          120025
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CLE023
      ** Enable Facility currency exchange rate field if CLE023                               CLE023
      ** is installed and facility is multi-currency                                          CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           MCCY      ANDEQ'Y'                                                           CLE023
     C                     MOVE *ON       *IN67                                               CLE023
     C                     ENDIF                                                              CLE023
      *
      **  Save transaction number for amend & authorise actions.
      *
     C           SACTN     IFEQ 'A'
     C           SACTN     OREQ 'X'
     C           SACTN     OREQ 'Q'                                                           CLE030
     C           CLE030    ANDEQ'Y'                                                           CLE030
     C                     MOVE TNLU      WTNLU   50
     C                     ENDIF
      *
      **  For Interactive and Record mode,
      **  move Rollover loan details to display fields.
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           PMODE     OREQ 'F'                                       CAP062
     C                     EXSR SRINID
     C                     EXSR SRMOVR
     C                     ENDIF
      *                                                                   CAP062
      **  Overwrite screen fields with fields from invalid file           CAP062
      *                                                                   CAP062
     C           PMODE     IFEQ 'F'                                       CAP062
     C           XREPN     CHAINLEIROLP2             85                   CAP062
     C                     ENDIF                                          CAP062
      *
      **  Initialise extended settlement parameters and workfields.
     C                     MOVE *BLANK    SETLIB
     C                     MOVE *BLANK    SETLIZ
      *                                                                   123122
     C           BGRTBN    IFEQ 'Y'                                       123122
     C           BGNXST    ANDEQ'Y'                                       123122
      *                                                                   123122
      **  Update some extended settlement parameter fields.               123122
     C                     MOVE 'Y'       PMRETP                          123122
     C                     MOVELBMACCD    PMPCYA                          123122
     C                     MOVE BMRANR    PMRETS                          123122
     C                     ENDIF                                          123122
      *
     C                     MOVE 'Y'       TRSTRT  1
     C                     MOVE *BLANK    WINCYL                                              CLE023
     C                     MOVE *BLANK    WINCYF                                              CLE023
     C                     MOVE *BLANK    WEUMDL                                              CLE023
     C                     Z-ADD*ZERO     WEUERL                                              CLE023
      *
     C                     MOVE 'D1'      WFMT
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRMCCY  -  Check if Mutli-currency rollover is allowed.       *
      * Called by: SRDINI - Initial setup of detail screen            *
      * Calls    : None                                               *
      *****************************************************************
     C           SRMCCY    BEGSR
      *
     C                     MOVE *OFF      MULTIC  1
     C                     MOVE 'N'       WERLN                           134725
      *
      **  Multi-currency rollover processing are allowed
      **  if there are no past due payments outstanding.
      **  and no future-dated loan amendments (except for repay sched)
      *
      **  Access loan amendments file.
      *
     C**********           Z-ADDLNRF      ALNRF                                               CLE148
     C                     MOVELLNRF      ALNRF                                               CLE148
     C                     Z-ADD*ZEROS    AVDAT
     C                     Z-ADD*ZEROS    ALASN
     C           WLOAM     SETLLLELOAML0
      *
      **  Check if past due exists.
     C                     MOVE *ON       WLOGIC
     C                     READ LELOAML0                 85
     C           *IN85     DOWEQ'0'
     C           LNRF      ANDEQLNRFA
     C           AMTP      IFEQ 'PD'
     C                     MOVE *OFF      WLOGIC
     C                     LEAVE
     C                     ENDIF
     C                     READ LELOAML0                 85
     C                     ENDDO
      *
      ** Future dated loan amendments except repayment schedules must
      ** first be deleted before a multi-ccy rollover can be allowed
      *
     C           WLOGIC    IFEQ *ON
     C                     Z-ADDBJRDNB    AVDAT
     C           WLOAM     SETGTLELOAML0
     C                     READ LELOAML0                 85
     C           *IN85     DOWEQ'0'
     C           LNRFA     ANDEQLNRF
     C           VDATA     IFGT BJRDNB
     C           AMTP      ANDNE'RE'
     C           CLE014    ANDEQ'N'                                       CLE014
     C                     MOVE *OFF      WLOGIC
      *                                                                   CEU020
      ** If CEU020 is installed, future dated loan amendments will be     CEU020
      ** allowed if amendment currency is equal to Euro ccy               CEU020
      *                                                                   CEU020
     C           CEU020    IFEQ 'Y'                                       CEU020
     C           CCYA      ANDEQBKEURO                                    CEU020
     C                     MOVE *ON       WLOGIC                          CEU020
     C                     ENDIF                                          CEU020
      *                                                                   CEU020
     C                     LEAVE
     C                     ENDIF
     C                     READ LELOAML0                 85
     C                     ENDDO
     C                     ENDIF
      *                                                                   134725
      ** If parts sold, check if original loan has no past due            134725
      ** payments or future dated loan amendments except for 'RE'.        134725
      *                                                                   134725
     C**********           Z-ADDLNRF      WWLNRF                                       134725 CLE148
     C                     MOVELLNRF      WWLNRF                                              CLE148
      *                                                                   134725
     C           PTYP      IFEQ 66                                        134725
     C           PTYP      OREQ 67                                        134725
     C           PTYP      OREQ 69                                        134725
     C           PTYP      OREQ 72                                        134725
      *                                                                   134725
     C                     MOVE OLNO      ALNRF                           134725
     C                     Z-ADD*ZEROS    AVDAT                           134725
     C                     Z-ADD*ZEROS    ALASN                           134725
     C           WLOAM     SETLLLELOAML0                                  134725
     C                     READ LELOAML0                 85               134725
      *                                                                   134725
     C           *IN85     DOWEQ'0'                                       134725
     C********** OLNO      ANDEQLNRFA                                                  134725 CSD027
     C           ALNRF     ANDEQLNRFA                                                         CSD027
     C           AMTP      IFEQ 'PD'                                      134725
     C                     MOVE *OFF      WLOGIC                          134725
     C                     MOVE 'Y'       WERLN                           134725
     C                     MOVE LNRFA     WLNNO                           134725
     C                     LEAVE                                          134725
     C                     ENDIF                                          134725
     C                     READ LELOAML0                 85               134725
     C                     ENDDO                                          134725
      *                                                                   134725
      ** Future dated loan amendments except repayment schedules must     134725
      ** first be deleted before a multi-ccy rollover can be allowed      134725
      *                                                                   134725
     C           WLOGIC    IFEQ *ON                                       134725
     C                     Z-ADDBJRDNB    AVDAT                           134725
     C           WLOAM     SETGTLELOAML0                                  134725
     C                     READ LELOAML0                 85               134725
      *                                                                   134725
     C           *IN85     DOWEQ'0'                                       134725
     C********** LNRFA     ANDEQOLNO                                                   134725 CSD027
     C           LNRFA     ANDEQALNRF                                                         CSD027
     C           WERLN     ANDEQ'N'                                       134725
      *                                                                   134725
     C           VDATA     IFGT BJRDNB                                    134725
     C           AMTP      ANDNE'RE'                                      134725
     C                     MOVE *OFF      WLOGIC                          134725
     C                     MOVE 'Y'       WERLN                           134725
     C                     MOVE LNRFA     WLNNO                           134725
     C                     LEAVE                                          134725
     C                     ENDIF                                          134725
      *                                                                   134725
     C                     READ LELOAML0                 85               134725
     C                     ENDDO                                          134725
      *                                                                   134725
     C                     ENDIF                                          134725
     C                     MOVE OLNO      WOLNO                           134725
      *                                                                   134725
      ** Multi-ccy rollover allowed indicator of original loan must       134725
      ** be 'Y'.                                                          134725
      *                                                                   134725
     C                     MOVE 'A'       WRCDT                           134725
     C                     MOVE OLNO      WLNRF                           134725
     C           WLOAN     CHAINCLOAN                85                   134725
     C           *IN85     IFEQ *OFF                                      134725
     C           MCRA      ANDEQ'N'                                       134725
     C                     MOVE 'Y'       WERLN                           134725
     C                     MOVE LNRF      WLNNO                           134725
     C                     MOVE *OFF      WLOGIC                          134725
     C                     ENDIF                                          134725
      *                                                                   134725
     C                     ELSE                                           134725
     C**********           MOVE LNRF      WOLNO   60                                   134725 CLE148
     C                     MOVE LNRF      WOLNO   6                                           CLE148
     C                     ENDIF                                          134725
      *                                                                   134725
      ** Check if all the related parts sold has no past due payments     134725
      ** or future dated loan amendments except for 'RE'.                 134725
      *                                                                   134725
     C********** WOLNO     SETLLPSOLDFF                                                134725 CSD027
     C********** WOLNO     READEPSOLDFF                  85                            134725 CSD027
     C                     MOVE WOLNO     OLNOA                                               CSD027
     C           OLNOA     SETLLPSOLDFF                                                       CSD027
     C           OLNOA     READEPSOLDFF                  85                                   CSD027
      *                                                                   134725
     C           *IN85     DOWEQ'0'                                       134725
     C           WERLN     ANDEQ'N'                                       134725
      *                                                                   134725
     C           LNRF      IFNE WWLNRF                                    134725
     C                     MOVE LNRF      ALNRF                           134725
     C                     Z-ADD*ZEROS    AVDAT                           134725
     C                     Z-ADD*ZEROS    ALASN                           134725
     C           WLOAM     SETLLLELOAML0                                  134725
     C                     READ LELOAML0                 85               134725
      *                                                                   134725
     C           *IN85     DOWEQ'0'                                       134725
     C           LNRF      ANDEQLNRFA                                     134725
     C           AMTP      IFEQ 'PD'                                      134725
     C                     MOVE *OFF      WLOGIC                          134725
     C                     MOVE 'Y'       WERLN   1                       134725
     C**********           MOVE LNRFA     WLNNO   60                                   134725 CLE148
     C                     MOVE LNRFA     WLNNO   6                                           CLE148
     C                     LEAVE                                          134725
     C                     ENDIF                                          134725
     C                     READ LELOAML0                 85               134725
     C                     ENDDO                                          134725
      *                                                                   134725
      ** Future dated loan amendments except repayment schedules must     134725
      ** first be deleted before a multi-ccy rollover can be allowed      134725
      *                                                                   134725
     C           WLOGIC    IFEQ *ON                                       134725
     C                     Z-ADDBJRDNB    AVDAT                           134725
     C           WLOAM     SETGTLELOAML0                                  134725
     C                     READ LELOAML0                 85               134725
      *                                                                   134725
     C           *IN85     DOWEQ'0'                                       134725
     C           LNRFA     ANDEQLNRF                                      134725
     C           WERLN     ANDEQ'N'                                       134725
     C           VDATA     IFGT BJRDNB                                    134725
     C           AMTP      ANDNE'RE'                                      134725
     C                     MOVE *OFF      WLOGIC                          134725
     C                     MOVE 'Y'       WERLN                           134725
     C                     MOVE LNRFA     WLNNO                           134725
     C                     LEAVE                                          134725
     C                     ENDIF                                          134725
     C                     READ LELOAML0                 85               134725
     C                     ENDDO                                          134725
      *                                                                   134725
     C                     ENDIF                                          134725
      *                                                                   134725
     C                     ENDIF                                          134725
      *                                                                   134725
      ** Multi-ccy rollover allowed indicator must be 'Y' for all of      134725
      ** the related loan                                                 134725
      *                                                                   134725
     C           MCRA      IFEQ 'N'                                       134725
     C                     MOVE 'Y'       WERLN                           134725
     C                     MOVE LNRF      WLNNO                           134725
     C                     MOVE *OFF      WLOGIC                          134725
     C                     ENDIF                                          134725
     C********** WOLNO     READEPSOLDFF                  85                            134725 CSD027
     C           OLNOA     READEPSOLDFF                  85                                   CSD027
     C                     ENDDO                                          134725
      *                                                                   134725
      ** Retrieve back values of loan being rolled over                   134725
      *                                                                   134725
     C                     MOVE 'A'       WRCDT                           134725
     C                     MOVE WWLNRF    WLNRF                           134725
     C           WLOAN     CHAINCLOAN                85                   134725
     C                     MOVE 'B'       WRCDT                           134725
     C           WLOAN     CHAINCLOAN                85                   134725
      *
     C                     MOVE WLOGIC    MULTIC
      *
     C                     ENDSR
      /EJECT
      *****************************************************************                       CLE023
      * SRVFXR  -  Subroutine to check if Rollover of facility        *                       CLE023
      *            exchange rate will be allowed                      *                       CLE023
      * Called by: Main routine                                       *                       CLE023
      * Calls    : None                                               *                       CLE023
      *****************************************************************                       CLE023
     C           SRVFXR    BEGSR                                                              CLE023
      *                                                                                       CLE023
     C                     MOVE 'Y'       WFCXRA  1                                           CLE023
     C**********           Z-ADDLNRF      ALNRF                                        CLE023 CLE148
     C                     MOVELLNRF      ALNRF                                               CLE148
      *                                                                                       CLE023
     C           SRLDTB    IFNE *BLANKS                                                       CLE023
     C           WRLDT1    ANDNE'*'                                                           CLE023
     C                     Z-ADDWRLDT     AVDAT                                               CLE023
     C                     ELSE                                                               CLE023
     C                     Z-ADDRLDT      AVDAT                                               CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     Z-ADD*ZEROS    ALASN                                               CLE023
      *                                                                                       CLE023
     C           AVDAT     IFLT BJRDNB                                                        CLE023
     C           AVDAT     ANDNE*ZERO                                                         CLE023
     C           LNRF      SETLLLELOAML0                                                      CLE023
     C                     READ LELOAML0                 85                                   CLE023
      *                                                                                       CLE023
     C           *IN85     DOWEQ'0'                                                           CLE023
     C           LNRF      ANDEQLNRFA                                                         CLE023
     C           VDATA     ANDLEBJRDNB                                                        CLE023
      *                                                                                       CLE023
     C           AMTP      IFEQ 'PI'                                                          CLE023
     C           AMTP      OREQ 'RE'                                                          CLE023
     C           AMTP      OREQ 'MR'                                                          CLE023
     C           PRAM      ANDNE*ZERO                                                         CLE023
     C                     MOVE 'N'       WFCXRA                                              CLE023
     C                     LEAVE                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     READ LELOAML0                 85                                   CLE023
     C                     ENDDO                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C           AVDAT     IFLT BJRDNB                                                        CLE023
     C           AVDAT     ANDNE*ZEROS                                                        CLE023
     C           NRPD      ANDLEBJRDNB                                                        CLE023
     C           NRPD      ANDNE*ZEROS                                                        CLE023
     C                     MOVE 'N'       WFCXRA                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDSR                                                              CLE023
      /EJECT                                                                                  CLE023
      *****************************************************************
      * SRPDET  -  Process Detail Screen                              *
      * Called by: Main routine                                       *
      *            SRSPRO - Process Selected Action                   *
      * Calls    : SRCLMQ - Clear the message queue                   *
      *            SRVCUS - Validation of loan customer               *
      *            SRINIW - Clear work fields                         *
      *            SRVDET - Validation of detail screen               *
      *            SRWDET - Warning messages of detail screen         *
      *            SRWARN - Display warning message if loan is synd.  *   159256
      *****************************************************************
     C           SRPDET    BEGSR
      *
      ** Issue warning if loan is a syndicated loan (if called from       159256
      ** subfile processing).                                             159256
      *                                                                   159256
     C           SACTN     IFNE 'E'                                       159256
     C           WWRTRN    ANDEQ'S0'                                      159256
     C                     EXSR SRWARN                                    159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C           WFMT      DOWEQ'D1'
      *
      **  Display screen.
     C                     WRITELE2070F0
     C                     WRITELE2070F3
     C                     WRITELE2070C1
     C                     EXFMTLE2070D1
      *
      **  Clear error message subfile.
     C                     EXSR SRCLMQ
      *
      **  F3 pressed, exit routine.
     C                     SELEC
     C           *INKC     WHEQ *ON
     C                     MOVE *BLANK    WFMT
     C                     LEAVE
      *
      **  F12 pressed, go to previous screen.
     C           *INKL     WHEQ *ON
      *
      **  Return to the correct screen.
     C           WWRTRN    IFEQ 'S0'
     C                     MOVELWWRTRN    WFMT
     C                     MOVE *BLANKS   WWRTRN
     C                     ELSE
     C                     MOVE 'F0'      WFMT
     C                     ENDIF
      *
     C                     LEAVE
     C                     ENDSL
      *
      **  Validate input fields if action is Amend or Authorise.
      *
     C           SACTN     IFEQ 'A'
     C           SACTN     OREQ 'X'
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     EXSR SRVCUS
     C           *IN37     IFEQ *OFF
     C***********SACTN     IFEQ 'A'                                       123857
     C                     EXSR SRINIW
     C                     EXSR SRVDET
     C***********          ENDIF                                          123857
     C                     EXSR SRWDET
     C                     ENDIF
     C                     ENDIF
      *
      **  If available, F11 pressed, authorise rollover loan.
      **  If rollover has settlement instructions, display them first     123857
     C                     SELEC
     C           *INKK     WHEQ *ON
     C           *IN26     ANDEQ*ON
     C           ERRDET    ANDEQ*OFF
     C           SEVERE    ANDEQ*OFF
     C           WARNEW    ANDEQ*OFF
     C           TRSTRT    IFEQ 'Y'                                       123857
     C           *IN27     ANDEQ*ON                                       123857
     C                     MOVE 'D2'      WFMT                            123857
     C                     ELSE                                           123857
     C                     MOVE 'UP'      WFMT
     C                     ENDIF                                          123857
      *
      **  If available, F14 pressed, display Extended Settlement screen.
      **  If F14 is pressed when multi-ccy is allowed but no actual       120025
      **  multi-ccy details have been entered, send error message         120025
     C           *INKN     WHEQ *ON
     C           *IN27     ANDEQ*ON
     C           ERRDET    ANDEQ*OFF
     C           SEVERE    ANDEQ*OFF
     C                     MOVE 'D2'      WFMT
      *
      **  Enter key pressed when action is enquiry,
      **  return to the correct screen if enquiry.
     C           *INKC     WHEQ *OFF
     C           *INKL     ANDEQ*OFF
     C           SACTN     ANDEQ'E'
     C           WWRTRN    IFEQ 'S0'
     C                     MOVELWWRTRN    WFMT
     C                     MOVE *BLANKS   WWRTRN
     C                     ELSE
     C                     MOVE 'F0'      WFMT
     C                     ENDIF
      *
      ** Window Processing                                                189632
      /COPY WNCPYSRC,LE2070MOV1                                           189632
      *                                                                   189632
      **  Enter key pressed when action is amend,
      **  update rollover loan.
     C           *INKC     WHEQ *OFF
     C           *INKL     ANDEQ*OFF
     C           SACTN     ANDEQ'A'
     C           ERRDET    ANDEQ*OFF
     C           SEVERE    ANDEQ*OFF
     C           SELDON    ANDEQ*OFF
     C           WARNEW    ANDEQ*OFF
      *
      **  For discount loans, update rollover if
      **  valid extended settlement details was entered.
     C           PTYP      IFNE 63
     C           PTYP      ANDNE65                                        122098
     C           PTYP      ANDNE67                                        122098
     C           PTYP      OREQ 63
     C           PMSDTV    ANDEQ'Y'
     C           PTYP      OREQ 65                                        122098
     C           PMSDTV    ANDEQ'Y'                                       122098
     C           PTYP      OREQ 67                                        122098
     C           PMSDTV    ANDEQ'Y'                                       122098
     C           WFMT      IFNE *BLANKS                                   120025
     C***********WPASS     IFNE 'Y'                                144675 144915
     C***********CEU020    ANDEQ'Y'                                144675 144915
     C***********SNCCYB    ANDNE*BLANKS                            144675 144915
     C***********WNCCY1    ANDNE'*'                                144675 144915
     C***********          MOVE 'Y'       WPASS   1                144675 144915
     C***********          MOVE 'D1'      WFMT                     144675 144915
     C***********          ELSE                                    144675 144915
     C***********          MOVE 'N'       WPASS                    144675 144915
     C                     MOVE 'UP'      WFMT
     C                     ENDIF                                          120025
     C***********          ENDIF                                   144675 144915
     C                     ENDIF
      *
      ** Window Processing                                                189632
      /COPY WNCPYSRC,LE2070MOV2                                           189632
      *                                                                   189632
      **  Enter key pressed when action is authorise,
      **  display extended settlement details for Discount loans.
      **  and also for multi-ccy rollovers                                120025
     C           *INKC     WHEQ *OFF
     C           *INKL     ANDEQ*OFF
     C           SACTN     ANDEQ'X'
     C           ERRDET    ANDEQ*OFF
     C           SEVERE    ANDEQ*OFF
     C           EXSDSP    ANDEQ*OFF
     C           *IN27     ANDEQ*ON
      *                                                                   CLE030
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           *INKL     ANDEQ*OFF                                      CLE030
     C           ERRDET    ANDEQ*OFF                                      CLE030
     C           SEVERE    ANDEQ*OFF                                      CLE030
     C           EXSDSP    ANDEQ*OFF                                      CLE030
     C           *IN27     ANDEQ*ON                                       CLE030
      *                                                                   CLE030
     C           PTYP      IFEQ 63                                        120025
     C           PTYP      OREQ 65                                        122098
     C           PTYP      OREQ 67                                        122098
     C           MULTIC    OREQ *ON                                       120025
     C           NCCY      ANDNE*BLANKS                                   120025
     C           RLDT      ANDNE*ZEROS                                    120025
     C                     MOVE 'D2'      WFMT
     C                     MOVE *ON       EXSDSP
     C                     ENDIF                                          120025
      *                                                                   123857
      ** Window Processing                                                189632
      /COPY WNCPYSRC,LE2070MOV3                                           189632
      *                                                                   189632
      ** Enter is pressed when action is authorise, and no need to        123857
      ** press F11, and there is no settlement, update files              123857
      *                                                                   123857
     C           *INKC     WHEQ *OFF                                      123857
     C           *INKL     ANDEQ*OFF                                      123857
     C           SACTN     ANDEQ'X'                                       123857
     C           ERRDET    ANDEQ*OFF                                      123857
     C           SEVERE    ANDEQ*OFF                                      123857
     C           *IN27     ANDEQ*OFF                                      123857
     C           BPAURV    ANDEQ'Y'                                       123857
      *                                                                   CLE030
     C           *INKL     OREQ *OFF                                      CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           ERRDET    ANDEQ*OFF                                      CLE030
     C           SEVERE    ANDEQ*OFF                                      CLE030
     C           *IN27     ANDEQ*OFF                                      CLE030
     C           BPAURV    ANDEQ'Y'                                       CLE030
     C                     MOVE 'UP'      WFMT                            123857
      *
     C                     ENDSL
      *
      * Call to Window Manager if 'I' Mode                                189632
      * And if no errors exist and user has not pressed F11, F12, F3      189632
     C           PMODE     IFEQ 'I'                                       189632
     C           ERRDET    ANDEQ*OFF                                      189632
     C           *INKK     ANDEQ*OFF                                      189632
     C           *INKL     ANDEQ*OFF                                      189632
     C           *INKC     ANDEQ*OFF                                      189632
     C                     EXSR SRWIND                                    189632
     C                     ENDIF                                          189632
      *                                                                   189632
     C                     ENDDO
      *
      **  Clear error message subfile.
     C                     EXSR SRCLMQ
      *
     C/COPY WNCPYSRC,LE2070C015
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SREXST  -  Process Extended Settlement Screen                 *
      * Called by: Main routine                                       *
      *            SRSPRO - Process Selected Action                   *
      *            SRVDET - Validation of detail screen               *
      * Calls    : SRFXST - Format fields for extended settlement     *
      *            SRSETT - Process data from extended settlement     *
      *****************************************************************
     C           SREXST    BEGSR
      *
     C           WFMT      DOWEQ'D2'
      *
      **  Set on Settlement Details flag and Format fields for
      **  Extended Settlement
     C                     EXSR SRFXST
      *
      **  Display extended settlements.
     C                     MOVE *BLANKS   PMTERM
     C                     UNLCKLDA
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SRSTA     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C                     CALL 'LE2230'                                                      CLE034
     C                     PARM 'ROLL'    PTYPE                                               CLE034
     C                     PARM           SLOAN                                               CLE034
     C                     PARM *BLANKS   PLAVDT                                              CLE034
     C                     PARM *BLANKS   PLASEQ                                              CLE034
     C                     PARM *BLANKS   PCUSTF                                              CLE034
     C                     PARM *BLANKS   PFACIF                                              CLE034
     C                     PARM *BLANKS   PFEESQ                                              CLE034
     C                     PARM           SETLIB                                              CLE034
     C                     PARM           SETLIZ                                              CLE034
     C                     PARM           PMODE                                               CLE034
     C                     PARM           PTSTMP                                              CLE034
     C                     PARM *BLANKS   PERROR                                              CLE034
     C                     PARM *BLANKS   PWARN                                               CLE034
     C                     PARM *BLANKS   PSTNOS                                              CLE034
     C                     PARM *BLANKS   PSEAMD                                              CLE034
     C                     PARM *BLANKS   PNODET                                              CLE034
     C                     PARM *BLANKS   PRSCUR                                              CLE034
     C                     PARM *BLANKS   PRSLOC                                              CLE034
     C                     PARM *BLANKS   PPSCUR                                              CLE034
     C                     PARM *BLANKS   PPSLOC                                              CLE034
     C                     PARM           PCRFL                                               CLE034
     C                     PARM           WORED   5                                           CLE038
     C                     PARM           WALAM  130                                          CLE038
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
     C/COPY WNCPYSRC,LE2070C004
     C                     CALL 'SD2400'
     C                     PARM           PRCODE  7
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           PSLNRF  6
     C                     PARM           @PARM3                                              222373
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
     C/COPY WNCPYSRC,LE2070C005
     C           *LOCK     IN   LDA
      *
      **  Terminate program if database error returned.
      *
     C           PMDBSE    IFNE *ZERO
     C           *LOCK     IN   LDA
     C                     MOVELPMDBFL    DBFILE           *************
     C                     MOVE PMDBSE    DBASE            * DBERROR X *
     C                     MOVELPMDBKY    DBKEY            *************
     C                     MOVELPMDPGM    DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  F3 taken in SD2400.
     C                     SELEC
     C           PMCMDP    WHEQ '03'
     C                     MOVE *BLANKS   WFMT
     C           PMODE     IFNE 'B'                                                           227710
     C           PMODE     ANDNE'P'                                                           227710
     C                     ROLBK                                                              227710
     C                     ENDIF                                                              227710
     C                     LEAVE
      *
      **  F12 taken in SD2400 with amend action.
     C           PMCMDP    WHEQ '12'
     C           SACTN     ANDEQ'A'
      *
      **  Settlement detail valid or F12 is pressed w/out validation
      **  (i.e. Enter not pressed in the Settlement screen).
     C           PMSDTV    IFEQ 'Y'
     C           PMSDTV    OREQ 'N'
     C           PMERCD    ANDEQ*BLANKS
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           PMSDTV    ANDEQ'N'                                                           CLE034
     C           PMERCD    ANDEQ*BLANKS                                                       CLE034
     C                     MOVE 'N'       SRSTA                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     EXSR SRSETT
     C                     ENDIF
     C                     MOVE 'D1'      WFMT
      *
      **  F12 taken in SD2400 with enquire/authorise action.
     C           PMCMDP    WHEQ '12'
     C           SACTN     ANDNE'A'
     C                     MOVE 'D1'      WFMT
     C           SACTN     IFEQ 'X'                                       123857
     C           BPAURV    ANDEQ'Y'                                       123857
     C           *INKN     ANDEQ'0'                                       123857
     C           SACTN     OREQ 'X'                                       123857
     C********** BPAURV    ANDEQ'N'                                                    123857 197084
     C           BPAURV    ANDNE'Y'                                                           197084
     C           *INKN     ANDEQ'0'                                       123857
     C           *INKK     ANDEQ'1'                                       123857
      *                                                                   CLE030
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           BPAURV    ANDEQ'Y'                                       CLE030
     C           *INKN     ANDEQ'0'                                       CLE030
      *                                                                   CLE030
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           BPAURV    ANDNE'Y'                                       CLE030
     C           *INKN     ANDEQ'0'                                       CLE030
     C           *INKK     ANDEQ'1'                                       CLE030
      *                                                                   CLE030
     C                     MOVE 'UP'      WFMT                            123857
     C                     ENDIF                                          123857
     C                     MOVE 'N'       TRSTRT                          123857
     C                     LEAVE
     C                     ENDSL
      *
      **  Error in extended settlement screen.
     C           PMERCD    IFNE *BLANKS
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV1017' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      **  Valid extended settlement screen.
     C           PMERCD    IFEQ *BLANKS
     C           PMSDTV    ANDEQ'Y'
     C           SACTN     ANDNE'E'
     C                     MOVE 'UP'      WFMT
     C                     ENDIF
      *
     C                     MOVE 'N'       PMFRST
     C                     MOVE 'N'       TRSTRT
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRFXST  -  Format fields for Extended Settlement Screen       *
      * Called by: SRBTCH - Batch processing                          *
      *            SREXST - Process Extended Settlement Screen        *
      * Calls    : SRIEXS - Move extended settlement file fields      *
      *            SRAEXS - Move extended settlement PC parm fields   *
      *            SRXEXS - Move extended settlement test harness     *
      *****************************************************************
     C           SRFXST    BEGSR
      *
      **  First display of extended settlements
      **  for this loan.
      *
     C           TRSTRT    IFEQ 'Y'
     C                     MOVE *BLANKS   PMTERM
     C                     MOVE SACTN     PMACTC
     C                     MOVELSLOAN     PSLNRF
     C***********          MOVE 'MMLD'    PMCPGM                          135152
     C                     MOVE 'LEND'    PMCPGM                          135152
     C                     Z-ADD*ZEROS    PMDBSE
     C                     MOVE BJRDNB    PMRUND
     C                     MOVE 'Y'       PMFRST
     C                     MOVE 'Y'       PMPPAY
     C                     Z-ADDBJBVPD    PMBVPD
     C                     Z-ADD*ZEROS    PMDTRC
     C                     Z-ADD*ZEROS    PMDTPY
     C                     MOVE *BLANKS   PMERCD
     C           SACTN     IFEQ 'E'
     C           SACTN     OREQ 'X'
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVE 'Y'       PMPRCV
     C                     MOVE 'Y'       PMPPAY                          122098
     C                     MOVE 'Y'       PMSDTV
     C                     ELSE
     C           WRLDT1    IFEQ '*'
     C           SRLDTB    OREQ *BLANKS                                   120025
     C           SRLDT     ANDEQ*BLANKS                                   120025
     C                     MOVE 'Y'       PMSDTV
     C                     MOVE 'Y'       PMPRCV
     C                     MOVE 'Y'       PMPPAY                          122098
     C                     MOVE 'E'       PMACTC
      *                                                                   122098
      ** Discounted loans and parts purchased need receive settlements    122098
      ** only, discounted parts sold needs pay settlements                122098
      *                                                                   122098
     C                     ELSE
     C                     MOVE 'N'       PMSDTV
     C           PTYP      IFEQ 63                                        122098
     C           PTYP      OREQ 65                                        122098
     C                     MOVE 'N'       PMPRCV
     C                     MOVE 'Y'       PMPPAY                          122098
     C                     ENDIF                                          122098
     C           PTYP      IFEQ 67                                        122098
     C                     MOVE 'Y'       PMPRCV                          122098
     C                     MOVE 'N'       PMPPAY                          122098
     C                     ENDIF                                          122098
     C                     ENDIF
     C                     ENDIF
      *
      **  Set up date of receipt for amend.
      **  and date of payment                                             122098
      *
     C           SACTN     IFEQ 'A'
     C                     Z-ADDVRLDT     PMDTRC
     C                     Z-ADDVRLDT     PMDTPY                          122098
     C                     ENDIF
      *
     C           PMFRST    IFEQ 'Y'
     C                     MOVE 'N'       PMVALO
     C                     ELSE
     C                     MOVE 'Y'       PMVALO
     C                     ENDIF
      *
     C                     MOVE *BLANK    PMCMDP
     C                     MOVE *BLANK    PMFFND
     C                     Z-ADD*ZEROS    PMRSTM
     C                     MOVE *BLANKS   PMRONS
     C                     MOVE *BLANKS   PMROCN
     C                     MOVE *BLANKS   PAROCN
     C                     MOVE *BLANKS   PMROBN
     C                     MOVE *BLANKS   PAROBN
     C                     MOVE *BLANKS   PMRIBN
     C                     MOVE *BLANKS   PARIBN
     C                     MOVE *BLANKS   PMRIBA
      *                                                                   120025
     C                     MOVE *BLANKS   PMPSTM                          120025
     C                     MOVE *BLANKS   PMPONS                          120025
     C                     MOVE *BLANKS   PAPIBN                          120025
     C                     MOVE *BLANKS   PMPIBA                          120025
     C                     MOVE *BLANKS   PAPOBN                          120025
     C                     MOVE *BLANKS   PAPOCN                          120025
     C                     MOVE *BLANKS   PMCVMR                          120025
     C                     MOVE *BLANKS   PARCRN                          120025
     C                     MOVE *BLANKS   PMRCRA                          120025
     C                     MOVE *BLANKS   PARVNO                          120025
     C                     MOVE *BLANKS   PAAWBN                          120025
     C                     MOVE *BLANKS   PMAWBA                          120025
     C                     MOVE *BLANKS   PABENN                          120025
     C                     MOVE *BLANKS   PMBENA                          120025
     C                     MOVE *BLANKS   PMDTP1                          120025
     C                     MOVE *BLANKS   PMDTP2                          120025
     C                     MOVE *BLANKS   PMDTP3                          120025
     C                     MOVE *BLANKS   PMDTP4                          120025
     C                     MOVE *BLANKS   PMDCHG                          120025
     C                     MOVE *BLANKS   PMBTB1                          120025
     C                     MOVE *BLANKS   PMBTB2                          120025
     C                     MOVE *BLANKS   PMBTB3                          120025
     C                     MOVE *BLANKS   PMBTB4                          120025
     C                     MOVE *BLANKS   PMBTB5                          120025
     C                     MOVE *BLANKS   PMBTB6                          120025
     C                     MOVE *BLANKS   PMPOBR                          120025
     C                     MOVE *BLANKS   PMPOBN                          120025
     C                     MOVE *BLANKS   PMPOCN                          120025
     C                     MOVE *BLANKS   PMRCRN                          120025
     C                     MOVE *BLANKS   PMRVNO                          120025
     C                     MOVE *BLANKS   PMAWBN                          120025
     C                     MOVE *BLANKS   PMBENN                          120025
     C                     MOVE *BLANKS   PMPIBN                          120025
     C                     MOVE *BLANKS   PMPOBN                          120025
     C                     MOVE *BLANKS   PMPOCN                          120025
     C                     MOVE *BLANKS   PMRCRN                          120025
     C                     MOVE *BLANKS   PMRVNO                          120025
     C                     MOVE *BLANKS   PMAWBN                          120025
     C                     MOVE *BLANKS   PMBENN                          120025
     C                     MOVE *BLANKS   WPSET   1                       120025
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE *BLANKS   PMRSCY                          CEU004
     C                     MOVE *BLANKS   PMPSCY                          CEU004
     C                     MOVE *BLANKS   PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   PMRSCY                                              CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     MOVE *BLANKS   PMREXI                                              CLE031
     C                     MOVE *BLANKS   PMPSCY                                              CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     MOVE *BLANKS   PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                   120025
      ** Allow rec/pay settlement details for multi-ccy rollover          120025
      *                                                                   120025
     C           MULTIC    IFEQ *ON                                       120025
     C           SNCCY     ANDNE*BLANKS                                   120025
     C           MULTIC    OREQ *ON                                       120025
     C           SNCCYB    ANDNE*BLANKS                                   120025
     C                     MOVE 'Y'       WPSET                           120025
     C           SACTN     IFEQ 'A'                                       120025
     C           WRLDT1    ANDNE'*'                                       120025
     C                     Z-ADDVRLDT     PMDTPY                          120025
      *                                                                   120025
      ** When deleting just the multi-ccy details, for discounted loans   120025
      ** still allow receive settlement input, for others protect both    120025
      ** pay and receive settlements                                      120025
     C           WNCCY1    IFEQ '*'                                       120025
     C           PTYP      IFNE 63                                        120025
     C           PTYP      ANDNE65                                        122098
     C           PTYP      ANDNE67                                        122098
     C                     MOVE 'Y'       PMSDTV                          120025
     C                     MOVE 'Y'       PMPRCV                          120025
     C                     MOVE 'Y'       PMPPAY                          122098
     C                     MOVE 'E'       PMACTC                          120025
     C                     ENDIF                                          120025
     C                     ELSE                                           120025
     C                     MOVE 'N'       PMPRCV                          122098
     C                     MOVE 'N'       PMPPAY                          120025
     C                     ENDIF                                          120025
      *                                                                   120025
     C                     ENDIF                                          120025
     C                     ENDIF                                          120025
      *
      **  Load extended settlement fields from the
      **  corresponding run mode.
      *
     C                     SELEC
     C           PMODE     WHEQ 'I'
     C           PMODE     OREQ 'R'
     C           PMODE     OREQ 'F'                                       CAP062
     C                     EXSR SRIEXS
     C           PMODE     WHEQ 'B'
     C                     EXSR SRBEXS
     C           PMODE     WHEQ 'P'
     C           SACTN     ANDEQ'A'
     C                     EXSR SRPEXS
     C           PMODE     WHEQ 'P'
     C           SACTN     ANDEQ'X'
     C           PMODE     WHEQ 'P'                                       CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     EXSR SRIEXS
     C                     ENDSL
      *
     C           SACTN     IFEQ 'E'
     C           SACTN     OREQ 'X'
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           WPSET     IFEQ 'Y'                                       122098
     C           PTYP      OREQ 63                                        122098
     C           PTYP      OREQ 65                                        122098
     C                     Z-ADDXRRST     PMRSTM
     C                     MOVELXRRON     PMRONS
     C                     MOVELXRRIB     PARIBN
     C                     MOVELXRRBA     PMRIBA
     C********** XRROB     IFNE *ZERO                                                         CSD027
     C           XRROB     IFNE *BLANKS                                                       CSD027
     C                     MOVELXRROB     PAROBN
     C                     ELSE
     C                     MOVE *BLANKS   PAROBN
     C                     ENDIF
     C********** XRROC     IFNE *ZERO                                                         CSD027
     C           XRROC     IFNE *BLANKS                                                       CSD027
     C                     MOVELXRROC     PAROCN
     C                     ELSE
     C                     MOVE *BLANKS   PAROCN
     C                     ENDIF
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELXRSCY     PMRSCY                          CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELXRSCY     PMRSCY                                              CLE031
     C           XREXR     IFNE *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE XREXR     ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMREXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELXREXI     PMREXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                          122098
      *                                                                   120025
     C           WPSET     IFEQ 'Y'                                       120025
     C           PTYP      OREQ 67                                        122098
     C                     Z-ADDXRPST     PMPSTM                          120025
     C                     MOVELXRPON     PMPONS                          120025
     C                     MOVELXRPIB     PAPIBN                          120025
     C                     MOVELXRPBA     PMPIBA                          120025
     C********** XRPOB     IFNE *ZERO                                                  120025 CSD027
     C           XRPOB     IFNE *BLANKS                                                       CSD027
     C                     MOVELXRPOB     PAPOBN                          120025
     C                     ENDIF                                          120025
     C********** XRPOC     IFNE *ZERO                                                  120025 CSD027
     C           XRPOC     IFNE *BLANKS                                                       CSD027
     C                     MOVELXRPOC     PAPOCN                          120025
     C                     ENDIF                                          120025
      *                                                                   120025
     C                     MOVELXRCVM     PMCVMR                          120025
     C                     MOVELXRRCR     PARCRN                          120025
     C                     MOVELXRRCA     PMRCRA                          120025
     C                     MOVELXRRVN     PARVNO                          120025
     C                     MOVELXRAWB     PAAWBN                          120025
     C                     MOVELXRAWA     PMAWBA                          120025
     C                     MOVELXRBEN     PABENN                          120025
     C                     MOVELXRBNA     PMBENA                          120025
     C                     MOVELXRDP1     PMDTP1                          120025
     C                     MOVELXRDP2     PMDTP2                          120025
     C                     MOVELXRDP3     PMDTP3                          120025
     C                     MOVELXRDP4     PMDTP4                          120025
     C                     MOVELXRDCH     PMDCHG                          120025
     C                     MOVELXRBB1     PMBTB1                          120025
     C                     MOVELXRBB2     PMBTB2                          120025
     C                     MOVELXRBB3     PMBTB3                          120025
     C                     MOVELXRBB4     PMBTB4                          120025
     C                     MOVELXRBB5     PMBTB5                          120025
     C                     MOVELXRBB6     PMBTB6                          120025
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELXPSCY     PMPSCY                          CEU004
     C                     MOVELXIC72     PMIC72                          CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELXPSCY     PMPSCY                                              CLE031
     C           XPEXR     IFNE *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE XPEXR     ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMPEXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELXPEXI     PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                          120025
      *                                                                   120025
     C                     ENDIF
      *
      **  Get receipt settlement from CLOANCK if not blank
      **  Else, get details from CLOANCL
      **  If all details in first screen has been '*'ed
      **  settlement details would be blanked out.
      *
     C           SACTN     IFEQ 'A'
     C           WPSET     IFEQ 'Y'                                       122098
     C           PTYP      OREQ 63                                        122098
     C           PTYP      OREQ 65                                        122098
      *
     C           XRRST     IFNE *ZERO
     C           PMODE     ANDNE'B'                                       122098
     C***********XRRST     OREQ *ZERO                               122098133864
     C           XRRST     ORNE *ZERO                                     133864
     C           PMODE     ANDEQ'B'                                       122098
     C                     Z-ADDXRRST     PMRSTM
     C                     MOVELXRRON     PMRONS
     C                     MOVELXROBR     PMROBR                          134414
     C                     MOVELXRRIB     PARIBN
     C                     MOVELXRRBA     PMRIBA
     C********** XRROB     IFNE *ZERO                                                         CSD027
     C           XRROB     IFNE *BLANKS                                                       CSD027
     C                     MOVELXRROB     PAROBN
     C                     ELSE
     C                     MOVE *BLANKS   PAROBN
     C                     ENDIF
     C********** XRROC     IFNE *ZERO                                                         CSD027
     C           XRROC     IFNE *BLANKS                                                       CSD027
     C                     MOVELXRROC     PAROCN
     C                     ELSE
     C                     MOVE *BLANKS   PAROCN
     C                     ENDIF
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELXRSCY     PMRSCY                          CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELXRSCY     PMRSCY                                              CLE031
     C           XREXR     IFNE *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE XREXR     ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMREXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELXREXI     PMREXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *
     C                     ELSE
     C           RSTM      IFNE *ZERO
     C           WPSET     ANDNE'Y'                                       166578
     C                     Z-ADDRSTM      PMRSTM
     C                     MOVELRONS      PMRONS
     C                     MOVELRIBN      PARIBN
     C                     MOVELRIBA      PMRIBA
     C********** ROBN      IFNE *ZERO                                                         CSD027
     C           ROBN      IFNE *BLANKS                                                       CSD027
     C                     MOVELROBN      PAROBN
     C                     ELSE
     C                     MOVE *BLANKS   PAROBN
     C                     ENDIF
     C********** ROCN      IFNE *ZERO                                                         CSD027
     C           ROCN      IFNE *BLANKS                                                       CSD027
     C                     MOVELROCN      PAROCN
     C                     ELSE
     C                     MOVE *BLANKS   PAROCN
     C                     ENDIF
     C                     ENDIF
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           WPSET     ANDNE'Y'                                       166578
     C                     MOVELSCCY      PMRSCY                          CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELSCCY      PMRSCY                                              CLE031
     C           REXR      IFNE *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE REXR      ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMREXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELREXI      PMREXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *
     C                     ENDIF
     C                     ENDIF                                          122098
     C                     ENDIF
     C                     MOVELPARIBN    PMRIBN
     C                     MOVELPAROBN    PMROBN
      *                                                                   120025
      ** For multi-currency rollover, also allow for pay settle input     120025
      ** Default coming from CLOANCK or CLOANCL                           120025
      *                                                                   120025
     C           SACTN     IFEQ 'A'                                       120025
     C           WPSET     ANDEQ'Y'                                       120025
     C           SACTN     OREQ 'A'                                       122098
     C           PTYP      ANDEQ67                                        122098
      *                                                                   120025
     C           XRPST     IFNE *ZERO                                     120025
     C           PMODE     ANDNE'B'                                       122098
     C***********XRPST     OREQ *ZERO                               122098134414
     C           XRPST     ORNE *ZERO                                     134414
     C           PMODE     ANDEQ'B'                                       122098
     C                     Z-ADDXRPST     PMPSTM                          120025
     C                     MOVELXRPON     PMPONS                          120025
     C                     MOVELXPOBR     PMPOBR                          134414
     C                     MOVELXRPIB     PAPIBN                          120025
     C                     MOVELXRPBA     PMPIBA                          120025
     C********** XRPOB     IFNE *ZERO                                                  120025 CSD027
     C           XRPOB     IFNE *BLANKS                                                       CSD027
     C                     MOVELXRPOB     PAPOBN                          120025
     C                     ENDIF                                          120025
     C********** XRPOC     IFNE *ZERO                                                  120025 CSD027
     C           XRPOC     IFNE *BLANKS                                                       CSD027
     C                     MOVELXRPOC     PAPOCN                          120025
     C                     ENDIF                                          120025
      *                                                                   120025
     C                     MOVELXRCVM     PMCVMR                          120025
     C                     MOVELXRRCR     PARCRN                          120025
     C                     MOVELXRRCA     PMRCRA                          120025
     C                     MOVELXRRVN     PARVNO                          120025
     C                     MOVELXRAWB     PAAWBN                          120025
     C                     MOVELXRAWA     PMAWBA                          120025
     C                     MOVELXRBEN     PABENN                          120025
     C                     MOVELXRBNA     PMBENA                          120025
     C                     MOVELXRDP1     PMDTP1                          120025
     C                     MOVELXRDP2     PMDTP2                          120025
     C                     MOVELXRDP3     PMDTP3                          120025
     C                     MOVELXRDP4     PMDTP4                          120025
     C                     MOVELXRDCH     PMDCHG                          120025
     C                     MOVELXRBB1     PMBTB1                          120025
     C                     MOVELXRBB2     PMBTB2                          120025
     C                     MOVELXRBB3     PMBTB3                          120025
     C                     MOVELXRBB4     PMBTB4                          120025
     C                     MOVELXRBB5     PMBTB5                          120025
     C                     MOVELXRBB6     PMBTB6                          120025
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELXPSCY     PMPSCY                          CEU004
     C                     MOVELXIC72     PMIC72                          CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELXPSCY     PMPSCY                                              CLE031
     C           XPEXR     IFNE *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE XPEXR     ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMPEXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELXPEXI     PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                   120025
     C                     ELSE                                           120025
     C           PSTM      IFNE *ZERO                                     120025
     C           WPSET     ANDNE'Y'                                       166578
     C                     Z-ADDPSTM      PMPSTM                          120025
     C                     MOVELPONS      PMPONS                          120025
     C                     MOVELPIBN      PAPIBN                          120025
     C                     MOVELPIBA      PMPIBA                          120025
     C********** POBN      IFNE *ZERO                                                  120025 CSD027
     C           POBN      IFNE *BLANKS                                                       CSD027
     C                     MOVELPOBN      PAPOBN                          120025
     C                     ENDIF                                          120025
     C********** POCN      IFNE *ZERO                                                  120025 CSD027
     C           POCN      IFNE *BLANKS                                                       CSD027
     C                     MOVELPOCN      PAPOCN                          120025
     C                     ENDIF                                          120025
      *                                                                   120025
     C                     MOVELCVMR      PMCVMR                          120025
     C                     MOVELRCRN      PARCRN                          120025
     C                     MOVELRCRA      PMRCRA                          120025
     C                     MOVELRVNO      PARVNO                          120025
     C                     MOVELAWBN      PAAWBN                          120025
     C                     MOVELAWBA      PMAWBA                          120025
     C                     MOVELBENN      PABENN                          120025
     C                     MOVELBENA      PMBENA                          120025
     C                     MOVELDTP1      PMDTP1                          120025
     C                     MOVELDTP2      PMDTP2                          120025
     C                     MOVELDTP3      PMDTP3                          120025
     C                     MOVELDTP4      PMDTP4                          120025
     C                     MOVELDCHG      PMDCHG                          120025
     C                     MOVELBTB1      PMBTB1                          120025
     C                     MOVELBTB2      PMBTB2                          120025
     C                     MOVELBTB3      PMBTB3                          120025
     C                     MOVELBTB4      PMBTB4                          120025
     C                     MOVELBTB5      PMBTB5                          120025
     C                     MOVELBTB6      PMBTB6                          120025
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELSCCY      PMPSCY                          CEU004
     C                     MOVELICCY      PMIC72                          CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELSCCY      PMPSCY                                              CLE031
     C           PEXR      IFNE *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE PEXR      ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMPEXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELPEXI      PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                          120025
      *                                                                   120025
     C                     ENDIF                                          120025
     C                     MOVELPAPIBN    PMPIBN                          120025
     C                     MOVELPAPOBN    PMPOBN                          120025
     C                     MOVELPAPOCN    PMPOCN                          120025
     C                     MOVELPARCRN    PMRCRN                          120025
     C                     MOVELPARVNO    PMRVNO                          120025
     C                     MOVELPAAWBN    PMAWBN                          120025
     C                     MOVELPABENN    PMBENN                          120025
     C                     ENDIF                                          120025
      *                                                                   144915
     C***********CEU020    IFEQ 'Y'                                144915 166578
     C***********MULTIC    ANDEQ*ON                                144915 166578
     C***********SNCCY     IFEQ BKEURO                             144915 166578
     C***********SNCCYB    ANDEQ*BLANKS                            144915 166578
     C***********SNCCY     OREQ *BLANKS                            144915 166578
     C***********SNCCYB    ANDEQBKEURO                             144915 166578
     C***********          MOVE 'Y'       WRCV    1                144915 166578
     C***********          Z-ADDPMRSTM    WWSTM   20               144915 166578
     C***********          MOVELPMRONS    WWONS  12                144915 166578
     C***********          EXSR SRRXST                             144915 166578
     C***********          Z-ADDWWSTM     PMRSTM                   144915 166578
     C***********          MOVELWWONS     PMRONS                   144915 166578
      ***********                                                  144915 166578
     C***********          MOVE 'N'       WRCV                     144915 166578
     C***********          Z-ADDPMPSTM    WWSTM                    144915 166578
     C***********          MOVELPMPONS    WWONS                    144915 166578
     C***********          EXSR SRRXST                             144915 166578
     C***********          Z-ADDWWSTM     PMPSTM                   144915 166578
     C***********          MOVELWWONS     PMPONS                   144915 166578
     C***********          ENDIF                                   144915 166578
     C***********          ENDIF                                   144915 166578
      *
     C                     ENDIF
      *
     C                     MOVE SACTN     PMACTC
     C                     MOVE LTYP      PMTTYP
     C***********          MOVE CNUM      PMCSNM                          166578
     C***********          MOVELCNUM      PMCSNM                   166578 169211
     C                     MOVELCNUML     PMCSNM                          169211
     C                     MOVE BRCA      PMBRCA
     C           PTYP      IFEQ 63                                        122098
     C           PTYP      OREQ 65                                        122098
     C                     MOVE CCY       PMRCCY
     C                     MOVE CCY       PMPCCY                          144915
     C           PMRSTM    IFEQ 05
     C           XROBR     ANDEQ*BLANKS                                   134414
     C           RLBR      ANDEQ*BLANKS                                   134414
     C                     MOVE OMDB      PMROBR
     C                     ENDIF
     C           PMRSTM    IFEQ 05                                        134414
     C           XROBR     ANDEQ*BLANKS                                   134414
     C           RLBR      ANDNE*BLANKS                                   134414
     C                     MOVE RLBR      PMROBR                          134414
     C                     ENDIF                                          134414
     C                     ENDIF                                          122098
     C           PTYP      IFEQ 67                                        122098
     C                     MOVE CCY       PMPCCY                          122098
     C**********           MOVE CCY       PMPCCY                                       144915 CAS009
     C                     MOVE CCY       PMRCCY                                              CAS009
     C           PMPSTM    IFEQ 05                                        122098
     C           XPOBR     ANDEQ*BLANKS                                   134414
     C           RLSB      ANDEQ*BLANKS                                   134414
     C                     MOVE OMDB      PMPOBR                          122098
     C                     ENDIF                                          122098
     C           PMPSTM    IFEQ 05                                        134414
     C           XPOBR     ANDEQ*BLANKS                                   134414
     C           RLSB      ANDNE*BLANKS                                   134414
     C                     MOVE RLSB      PMPOBR                          134414
     C                     ENDIF                                          134414
     C                     ENDIF                                          122098
      *
     C           SACTN     IFEQ 'E'
     C           SACTN     OREQ 'X'
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVE *BLANKS   PMERCD
     C                     ENDIF
      *
      **  If Rollover date is to be removed,
      **  or multi-currency details are to be removed                     120025
      **  settlement details must be removed also.
      *
     C           SACTN     IFEQ 'A'
     C                     Z-ADDVRLDT     PMDTRC
     C                     Z-ADDVRLDT     PMDTPY                          122098
     C           WRLDT1    IFEQ '*'
     C           WNCCY1    OREQ '*'                                       120025
      *                                                                   120025
     C           WRLDT1    IFEQ '*'                                       120025
     C           WNCCY1    OREQ '*'                                       120025
     C           PTYP      ANDNE63                                        120025
     C           PTYP      ANDNE65                                        122098
     C                     Z-ADD*ZEROS    PMRSTM
     C                     MOVE *BLANKS   PMRONS
     C                     MOVE *BLANKS   PMROCN
     C                     MOVE *BLANKS   PAROCN
     C                     MOVE *BLANKS   PAROBN
     C                     MOVE *BLANKS   PARIBN
     C                     MOVE *BLANKS   PMRIBA
     C***********          MOVE 'Y'       PMSDTV                          122098
     C                     MOVE 'Y'       PMPRCV
     C***********          MOVE 'E'       PMACTC                          122098
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE *BLANKS   PMRSCY                          CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   PMRSCY                                              CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     MOVE *BLANKS   PMREXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                          120025
      *                                                                   120025
     C           WRLDT1    IFEQ '*'                                       122098
     C           WNCCY1    OREQ '*'                                       122098
     C           PTYP      ANDNE67                                        122098
     C                     MOVE *BLANKS   PMPSTM                          120025
     C                     MOVE *BLANKS   PMPONS                          120025
     C                     MOVE *BLANKS   PAPIBN                          120025
     C                     MOVE *BLANKS   PMPIBA                          120025
     C                     MOVE *BLANKS   PAPOBN                          120025
     C                     MOVE *BLANKS   PAPOCN                          120025
     C                     MOVE *BLANKS   PMCVMR                          120025
     C                     MOVE *BLANKS   PARCRN                          120025
     C                     MOVE *BLANKS   PMRCRA                          120025
     C                     MOVE *BLANKS   PARVNO                          120025
     C                     MOVE *BLANKS   PAAWBN                          120025
     C                     MOVE *BLANKS   PMAWBA                          120025
     C                     MOVE *BLANKS   PABENN                          120025
     C                     MOVE *BLANKS   PMBENA                          120025
     C                     MOVE *BLANKS   PMDTP1                          120025
     C                     MOVE *BLANKS   PMDTP2                          120025
     C                     MOVE *BLANKS   PMDTP3                          120025
     C                     MOVE *BLANKS   PMDTP4                          120025
     C                     MOVE *BLANKS   PMDCHG                          120025
     C                     MOVE *BLANKS   PMBTB1                          120025
     C                     MOVE *BLANKS   PMBTB2                          120025
     C                     MOVE *BLANKS   PMBTB3                          120025
     C                     MOVE *BLANKS   PMBTB4                          120025
     C                     MOVE *BLANKS   PMBTB5                          120025
     C                     MOVE *BLANKS   PMBTB6                          120025
     C                     MOVE *BLANKS   PMPOBR                          120025
     C                     MOVE *BLANKS   PMPOBN                          120025
     C                     MOVE *BLANKS   PMPOCN                          120025
     C                     MOVE *BLANKS   PMRCRN                          120025
     C                     MOVE *BLANKS   PMRVNO                          120025
     C                     MOVE *BLANKS   PMAWBN                          120025
     C                     MOVE *BLANKS   PMBENN                          120025
     C                     MOVE *BLANKS   PMPIBN                          120025
     C                     MOVE *BLANKS   PMPOBN                          120025
     C                     MOVE *BLANKS   PMPOCN                          120025
     C                     MOVE *BLANKS   PMRCRN                          120025
     C                     MOVE *BLANKS   PMRVNO                          120025
     C                     MOVE *BLANKS   PMAWBN                          120025
     C                     MOVE *BLANKS   PMBENN                          120025
     C                     MOVE 'Y'       PMPPAY                          122098
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE *BLANKS   PMPSCY                          CEU004
     C                     MOVE *BLANKS   PMIC72                          CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   PMPSCY                                              CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     MOVE *BLANKS   PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                          122098
     C           PMPRCV    IFEQ 'Y'                                       122098
     C           PMPPAY    ANDEQ'Y'                                       122098
     C                     MOVE 'Y'       PMSDTV                          122098
     C                     MOVE 'E'       PMACTC                          122098
     C                     ELSE                                           122098
     C                     MOVE 'N'       PMSDTV                          122098
     C                     ENDIF                                          122098
      *                                                                   122098
     C                     ELSE
     C                     MOVE 'N'       PMSDTV
     C           PTYP      IFEQ 63                                        122098
     C           PTYP      OREQ 65                                        122098
     C                     MOVE 'N'       PMPRCV
     C                     ENDIF                                          122098
     C           PTYP      IFEQ 67                                        122098
     C                     MOVE 'N'       PMPPAY                          122098
     C                     ENDIF                                          122098
     C                     ENDIF
     C                     ENDIF
      *                                                                   120025
      ** Set up other payment settlement details                          120025
      ** For parts sold, pay out in old ccy, receive in new ccy           120025
      ** For the rest, receive in old ccy, pay out in new ccy             120025
      *                                                                   120025
     C           WPSET     IFEQ 'Y'                                       120025
      *                                                                   120025
     C           SNCCYB    IFNE *BLANKS                                   120025
     C***********WNCCY1    ANDNE*BLANKS                            120025 144915
     C           WNCCY1    ANDNE'*'                                       144915
     C                     MOVE SNCCYB    WNCCY   3                       120025
     C                     ELSE                                           120025
     C                     MOVE NCCY      WNCCY                           120025
     C                     ENDIF                                          120025
      *                                                                   120025
     C           WSOLD     IFEQ 'Y'                                       120025
     C           PMPSTM    IFEQ 05                                        120025
     C           XPOBR     IFEQ *BLANKS                                   133789
     C                     MOVE OMDB      PMPOBR                          120025
     C                     ELSE                                           133789
     C                     MOVE XPOBR     PMPOBR                          133789
     C                     ENDIF                                          133789
     C                     ENDIF                                          120025
     C           PMRSTM    IFEQ 05                                        120025
     C           XROBR     IFEQ *BLANKS                                   133789
     C                     MOVE OSDB      PMROBR                          120025
     C                     ELSE                                           133789
     C                     MOVE XROBR     PMROBR                          133789
     C                     ENDIF                                          133789
     C                     ENDIF                                          120025
     C                     MOVE WNCCY     PMRCCY                          120025
     C***********          MOVE CCY       PMPCCY                   120025 166578
     C                     MOVE WNCCY     PMPCCY                          166578
      *                                                                   144915
     C           CEU020    IFEQ 'Y'                                       144915
     C           WNCCY     ANDNE*BLANKS                                   144915
     C           WNCCY     ANDEQBKEURO                                    144915
     C                     MOVE WNCCY     PMRCCY                          144915
     C                     MOVE WNCCY     PMPCCY                          144915
     C                     ENDIF                                          144915
      *                                                                   120025
     C                     ELSE                                           120025
     C           PMPSTM    IFEQ 05                                        122098
     C           XPOBR     IFEQ *BLANKS                                   133789
     C                     MOVE OSDB      PMPOBR                          120025
     C                     ELSE                                           133789
     C                     MOVE XPOBR     PMPOBR                          133789
     C                     ENDIF                                          133789
     C                     ENDIF                                          122098
     C           PMRSTM    IFEQ 05                                        122098
     C           XROBR     IFEQ *BLANKS                                   133789
     C                     MOVE OMDB      PMROBR                          122098
     C                     ELSE                                           133789
     C                     MOVE XROBR     PMROBR                          133789
     C                     ENDIF                                          133789
     C                     ENDIF                                          122098
     C                     MOVE WNCCY     PMPCCY                          120025
     C***********          MOVE CCY       PMRCCY                   122098 166578
     C                     MOVE WNCCY     PMRCCY                          166578
      *                                                                   144915
     C           CEU020    IFEQ 'Y'                                       144915
     C           WNCCY     ANDNE*BLANKS                                   144915
     C           WNCCY     ANDEQBKEURO                                    144915
     C                     MOVE WNCCY     PMRCCY                          144915
     C                     MOVE WNCCY     PMPCCY                          144915
     C                     ENDIF                                          144915
     C                     ENDIF                                          120025
      *                                                                   120025
      ** Set up date of receipt and payment                               120025
      *                                                                   120025
     C           SACTN     IFEQ 'A'                                       120025
     C                     Z-ADDVRLDT     PMDTPY                          120025
     C           VRLDT     IFEQ *ZEROS                                    120025
     C                     Z-ADDRLDT      PMDTPY                          120025
     C                     Z-ADDRLDT      PMDTRC                          120025
     C                     ENDIF                                          120025
     C           WRLDT1    IFNE '*'                                       120025
     C           SRLDTB    ANDNE*BLANKS                                   120025
     C           SRLDT     ANDNE*BLANKS                                   120025
     C           WNCCY1    ANDNE'*'                                       120025
     C                     MOVE 'N'       PMPRCV                          122098
     C                     MOVE 'N'       PMPPAY                          120025
     C                     ENDIF                                          120025
     C                     ENDIF                                          120025
     C                     ENDIF                                          120025
      *                                                                   166578
      ** Defaults settlement details for multi-ccy rollover               166578
      *                                                                   166578
     C           SACTN     IFEQ 'A'                                       166578
     C           WPSET     ANDEQ'Y'                                       166578
     C           SNCCYB    ANDNE*BLANKS                                   166578
     C           WNCCY1    ANDNE'*'                                       166578
     C           PMRSTM    ANDEQ0                                         166578
     C           PMPSTM    ANDEQ0                                         166578
     C                     EXSR SRDEFL                                    166578
     C                     ENDIF                                          166578
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRIEXS  -  Move extended settlement file fields.              *
      * Called by: SRFXST - Format fields for Extended Settlements    *
      * Calls    : None                                               *
      *****************************************************************
     C           SRIEXS    BEGSR
      *
     C           WPSET     IFEQ 'Y'                                       122098
     C           PTYP      ORNE 67                                        122098
     C                     Z-ADDRRST      XRRST   20
     C                     MOVELRRON      XRRON  12
     C                     MOVELRLBR      XROBR   3                       133789
     C                     MOVELRRIB      XRRIB  10
     C                     MOVELRRBA      XRRBA  35
     C                     MOVELRROB      XRROB  10
     C                     MOVELRROC      XRROC  10
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELRRSC      XRSCY   3                       CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELRRSC      XRSCY                                               CLE031
     C                     Z-ADDRRSR      XREXR  138                                          CLE031
     C                     MOVELRRSI      XREXI   1                                           CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                          122098
      *                                                                   120025
     C           WPSET     IFEQ 'Y'                                       120025
     C           PTYP      OREQ 67                                        122098
     C                     Z-ADDRPST      XRPST   20                      120025
     C                     MOVELRPON      XRPON  12                       120025
     C                     MOVELRLSB      XPOBR   3                       133789
     C                     MOVELRPIB      XRPIB   8                       120025
     C                     MOVELRPBA      XRPBA  35                       120025
     C                     MOVELRPOB      XRPOB  10                       120025
     C                     MOVELRPOC      XRPOC  10                       120025
     C                     MOVELRRCR      XRRCR   8                       120025
     C                     MOVELRRCA      XRRCA  35                       120025
     C                     MOVELRRVN      XRRVN   8                       120025
     C                     MOVELRAWB      XRAWB   8                       120025
     C                     MOVELRAWA      XRAWA  35                       120025
     C                     MOVELRBEN      XRBEN   8                       120025
     C                     MOVELRBNA      XRBNA  35                       120025
     C                     MOVELRDP1      XRDP1  35                       120025
     C                     MOVELRDP2      XRDP2  35                       120025
     C                     MOVELRDP3      XRDP3  35                       120025
     C                     MOVELRDP4      XRDP4  35                       120025
     C                     MOVELRDCH      XRDCH   3                       120025
     C                     MOVELRBB1      XRBB1  35                       120025
     C                     MOVELRBB2      XRBB2  35                       120025
     C                     MOVELRBB3      XRBB3  35                       120025
     C                     MOVELRBB4      XRBB4  35                       120025
     C                     MOVELRBB5      XRBB5  35                       120025
     C                     MOVELRBB6      XRBB6  35                       120025
     C                     MOVELRCVM      XRCVM   1                       120025
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELRPSC      XPSCY   3                       CEU004
     C                     MOVELRICY      XIC72   3                       CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELRPSC      XPSCY                                               CLE031
     C                     Z-ADDRPSR      XPEXR  138                                          CLE031
     C                     MOVELRPSI      XPEXI   1                                           CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                          120025
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRBEXS  -  Move extended settlement PC parameter fields.      *
      * Called by: SRFXST - Format fields for Extended Settlements    *
      * Calls    : None                                               *
      *****************************************************************
     C           SRBEXS    BEGSR
      *
     C           WPSET     IFEQ 'Y'                                       122098
     C           PTYP      ORNE 67                                        122098
     C                     MOVELPIRRST    XRRST
     C***********          MOVELPIRRON    XRRON                           134414
     C                     MOVE PIRRON    XRRON                           134414
     C                     MOVELPIRRON    XROBR   3                       134414
     C                     MOVELPIRRIB    XRRIB
     C                     MOVELPIRRBA    XRRBA
     C                     MOVELPIRROB    XRROB
     C                     MOVELPIRROC    XRROC
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELPIRRSC    XRSCY                           CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELPIRRSC    XRSCY                                               CLE031
     C                     Z-ADD0         WSEXR0 130                                          CLE031
     C                     Z-ADD0         WSEXR8 138                                          CLE031
     C                     MOVE *BLANK    ZFIELD                                              CLE031
     C                     MOVE PIRRSR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
      *                                                                                       CLE031
     C           *IN99     IFEQ *OFF                                                          CLE031
     C                     MOVE ZFIELD    WSEXR0                                              CLE031
     C           WSEXR0    DIV  100000000 WSEXR8                                              CLE031
     C                     Z-ADDWSEXR8    XREXR                                               CLE031
     C                     ELSE                                                               CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'ZALIGN  'DBFILE                                              CLE031
     C                     Z-ADD69        DBASE                                               CLE031
     C                     MOVELPIRRSR    DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELPIRRSI    XREXI                                               CLE031
     C           PIRRSI    IFEQ 'N'                                                           CLE031
     C                     MOVEL*BLANKS   XREXI                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                          122098
      *                                                                   120025
     C           WPSET     IFEQ 'Y'                                       120025
     C           PTYP      OREQ 67                                        122098
     C                     MOVELPIRPST    XRPST                           120025
     C***********          MOVELPIRPON    XRPON                     120025134414
     C                     MOVE PIRPON    XRPON                           134414
     C**********           MOVELPIRRON    XPOBR   3                                    134414 221321
     C                     MOVELPIRPON    XPOBR   3                                           221321
     C                     MOVELPIRPIB    XRPIB                           120025
     C                     MOVELPIRPBA    XRPBA                           120025
     C                     MOVELPIRPOB    XRPOB                           120025
     C                     MOVELPIRPOC    XRPOC                           120025
     C                     MOVELPIRRCR    XRRCR                           120025
     C                     MOVELPIRRCA    XRRCA                           120025
     C                     MOVELPIRRVN    XRRVN                           120025
     C                     MOVELPIRAWB    XRAWB                           120025
     C                     MOVELPIRAWA    XRAWA                           120025
     C                     MOVELPIRBEN    XRBEN                           120025
     C                     MOVELPIRBNA    XRBNA                           120025
     C                     MOVELPIRDP1    XRDP1                           120025
     C                     MOVELPIRDP2    XRDP2                           120025
     C                     MOVELPIRDP3    XRDP3                           120025
     C                     MOVELPIRDP4    XRDP4                           120025
     C                     MOVELPIRDCH    XRDCH                           120025
     C                     MOVELPIRBB1    XRBB1                           120025
     C                     MOVELPIRBB2    XRBB2                           120025
     C                     MOVELPIRBB3    XRBB3                           120025
     C                     MOVELPIRBB4    XRBB4                           120025
     C                     MOVELPIRBB5    XRBB5                           120025
     C                     MOVELPIRBB6    XRBB6                           120025
     C                     MOVELPIRCVM    XRCVM                           120025
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELPIRPSC    XPSCY                           CEU004
     C                     MOVELPIRICY    XIC72                           CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELPIRPSC    XPSCY                                               CLE031
     C                     Z-ADD0         WSEXR0                                              CLE031
     C                     Z-ADD0         WSEXR8                                              CLE031
     C                     MOVE *BLANK    ZFIELD                                              CLE031
     C                     MOVE PIRPSR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
      *                                                                                       CLE031
     C           *IN99     IFEQ *OFF                                                          CLE031
     C                     MOVE ZFIELD    WSEXR0                                              CLE031
     C           WSEXR0    DIV  100000000 WSEXR8                                              CLE031
     C                     Z-ADDWSEXR8    XPEXR                                               CLE031
     C                     ELSE                                                               CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'ZALIGN  'DBFILE                                              CLE031
     C                     Z-ADD70        DBASE                                               CLE031
     C                     MOVELPIRPSR    DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELPIRPSI    XPEXI                                               CLE031
     C           PIRPSI    IFEQ 'N'                                                           CLE031
     C                     MOVEL*BLANKS   XPEXI                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                          120025
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRPEXS  -  Move extended settlement test harness fields.      *
      * Called by: SRFXST - Format fields for Extended Settlements    *
      * Calls    : None                                               *
      *****************************************************************
     C           SRPEXS    BEGSR
      *
     C           WPSET     IFEQ 'Y'                                       122098
     C           PTYP      ORNE 67                                        122098
     C                     MOVE FRRST     XRRST
     C                     MOVELFRRON     XRRON
     C                     MOVELFRRIB     XRRIB
     C                     MOVELFRRBA     XRRBA
     C                     MOVELFRROB     XRROB
     C                     MOVELFRROC     XRROC
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELFRRSC     XRSCY                           CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELFRRSC     XRSCY                                               CLE031
     C                     Z-ADD0         WSEXR0                                              CLE031
     C                     Z-ADD0         WSEXR8                                              CLE031
     C                     MOVE *BLANK    ZFIELD                                              CLE031
     C                     MOVE FRRSR     ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
      *                                                                                       CLE031
     C           *IN99     IFEQ *OFF                                                          CLE031
     C                     MOVE ZFIELD    WSEXR0                                              CLE031
     C           WSEXR0    DIV  100000000 WSEXR8                                              CLE031
     C                     Z-ADDWSEXR8    XREXR                                               CLE031
     C                     ELSE                                                               CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'ZALIGN  'DBFILE                                              CLE031
     C                     Z-ADD71        DBASE                                               CLE031
     C                     MOVELFRRSR     DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELFRRSI     XREXI                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                          122098
      *                                                                   120025
     C           WPSET     IFEQ 'Y'                                       120025
     C           PTYP      OREQ 67                                        122098
     C                     MOVELFRPST     XRPST                           120025
     C                     MOVELFRPON     XRPON                           120025
     C                     MOVELFRPIB     XRPIB                           120025
     C                     MOVELFRPBA     XRPBA                           120025
     C                     MOVELFRPOB     XRPOB                           120025
     C                     MOVELFRPOC     XRPOC                           120025
     C                     MOVELFRRCR     XRRCR                           120025
     C                     MOVELFRRCA     XRRCA                           120025
     C                     MOVELFRRVN     XRRVN                           120025
     C                     MOVELFRAWB     XRAWB                           120025
     C                     MOVELFRAWA     XRAWA                           120025
     C                     MOVELFRBEN     XRBEN                           120025
     C                     MOVELFRBNA     XRBNA                           120025
     C                     MOVELFRDP1     XRDP1                           120025
     C                     MOVELFRDP2     XRDP2                           120025
     C                     MOVELFRDP3     XRDP3                           120025
     C                     MOVELFRDP4     XRDP4                           120025
     C                     MOVELFRDCH     XRDCH                           120025
     C                     MOVELFRBB1     XRBB1                           120025
     C                     MOVELFRBB2     XRBB2                           120025
     C                     MOVELFRBB3     XRBB3                           120025
     C                     MOVELFRBB4     XRBB4                           120025
     C                     MOVELFRBB5     XRBB5                           120025
     C                     MOVELFRBB6     XRBB6                           120025
     C                     MOVELFRCVM     XRCVM                           120025
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELFRPSC     XPSCY                           CEU004
     C                     MOVELFRICY     XIC72                           CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELFRPSC     XPSCY                                               CLE031
     C                     Z-ADD0         WSEXR0                                              CLE031
     C                     Z-ADD0         WSEXR8                                              CLE031
     C                     MOVE *BLANK    ZFIELD                                              CLE031
     C                     MOVE FRPSR     ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
      *                                                                                       CLE031
     C           *IN99     IFEQ *OFF                                                          CLE031
     C                     MOVE ZFIELD    WSEXR0                                              CLE031
     C           WSEXR0    DIV  100000000 WSEXR8                                              CLE031
     C                     Z-ADDWSEXR8    XPEXR                                               CLE031
     C                     ELSE                                                               CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'ZALIGN  'DBFILE                                              CLE031
     C                     Z-ADD72        DBASE                                               CLE031
     C                     MOVELFRPSR     DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELFRPSI     XPEXI                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                          120025
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSETT  -  Process Data from Extended Settlement Screen       *
      * Called by: SRBTCH - Batch processing                          *
      *            SREXST - Process Extended Settlement Screen        *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSETT    BEGSR
      *
      **  Move settlement details received from SD2400
      **  to be used in the validations of other screen fields.
      *
     C           WPSET     IFEQ 'Y'                                       122098
     C           PTYP      ORNE 67                                        122098
     C                     Z-ADDPMRSTM    VRRST
     C                     MOVELPMRONS    VRRON
     C                     MOVELPARIBN    VRRIB
     C                     MOVELPMRIBA    VRRBA
     C                     MOVE PMRSTM    VRDST
     C                     MOVE PMRONS    VORVD
     C                     MOVELPARIBN    VTHRN
     C           WRLDT1    IFEQ '*'
     C           WNCCY1    OREQ '*'                                       120025
     C                     MOVE *BLANKS   VRLBR
     C                     ELSE
     C                     MOVELPMROBR    VRLBR
     C                     ENDIF
     C           PAROBN    IFNE *BLANKS
     C                     MOVE PAROBN    VRROB
     C                     ELSE
     C**********           MOVE *ZEROS    VRROB                                               CSD027
     C                     MOVE *BLANKS   VRROB                                               CSD027
     C                     ENDIF
     C           PAROCN    IFNE *BLANKS
     C                     MOVE PAROCN    VRROC
     C                     ELSE
     C**********           MOVE *ZEROS    VRROC                                               CSD027
     C                     MOVE *BLANKS   VRROC                                               CSD027
     C                     ENDIF
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELPMRSCY    VRRSC                           CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELPMRSCY    VRRSC                                               CLE031
     C                     MOVELPMREXR    VRRSR                                               CLE031
     C                     MOVELPMREXI    VRRSI                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                          122098
      *                                                                   120025
      ** Also set up payment settlement details                           120025
      *                                                                   120025
     C           WPSET     IFEQ 'Y'                                       120025
     C           PTYP      OREQ 67                                        122098
     C           WSOLD     IFEQ 'Y'                                       120025
     C                     MOVELPMPOBR    VRLBR                           122098
     C                     MOVE PMPSTM    VRDST                           120025
     C                     MOVELPMPONS    VORVD                           120025
     C                     MOVELPAAWBN    VTHRN                           120025
     C                     ENDIF                                          120025
      *                                                                   120025
     C           WNCCY1    IFEQ '*'                                       120025
     C                     MOVE *BLANKS   VRLSB                           120025
     C                     ELSE                                           120025
     C                     MOVELPMPOBR    VRLSB                           120025
     C                     ENDIF                                          120025
     C                     Z-ADDPMPSTM    VRPST                           120025
     C                     MOVELPMPONS    VRPON                           120025
     C                     MOVELPAPIBN    VRPIB                           120025
     C                     MOVELPMPIBA    VRPBA                           120025
     C           PAPOBN    IFNE *BLANKS                                   120025
     C                     MOVE PAROBN    VRPOB                           120025
     C                     ELSE                                           120025
     C**********           MOVE *ZEROS    VRPOB                                        120025 CSD027
     C                     MOVE *BLANKS   VRPOB                                               CSD027
     C                     ENDIF                                          120025
     C           PAPOCN    IFNE *BLANKS                                   120025
     C                     MOVE PAPOCN    VRPOC                           120025
     C                     ELSE                                           120025
     C**********           MOVE *ZEROS    VRPOC                                        120025 CSD027
     C                     MOVE *BLANKS   VRPOC                                               CSD027
     C                     ENDIF                                          120025
     C                     MOVELPARCRN    VRRCR                           120025
     C                     MOVELPMRCRA    VRRCA                           120025
     C                     MOVELPARVNO    VRRVN                           120025
     C                     MOVELPAAWBN    VRAWB                           120025
     C                     MOVELPMAWBA    VRAWA                           120025
     C                     MOVELPABENN    VRBEN                           120025
     C                     MOVELPMBENA    VRBNA                           120025
     C                     MOVELPMDTP1    VRDP1                           120025
     C                     MOVELPMDTP2    VRDP2                           120025
     C                     MOVELPMDTP3    VRDP3                           120025
     C                     MOVELPMDTP4    VRDP4                           120025
     C                     MOVELPMDCHG    VRDCH                           120025
     C                     MOVELPMBTB1    VRBB1                           120025
     C                     MOVELPMBTB2    VRBB2                           120025
     C                     MOVELPMBTB3    VRBB3                           120025
     C                     MOVELPMBTB4    VRBB4                           120025
     C                     MOVELPMBTB5    VRBB5                           120025
     C                     MOVELPMBTB6    VRBB6                           120025
     C                     MOVELPMCVMR    VRCVM                           120025
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELPMPSCY    VRPSC                           CEU004
     C                     MOVELPMIC72    VRICY                           CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELPMPSCY    VRPSC                                               CLE031
     C                     MOVELPMPEXR    VRPSR                                               CLE031
     C                     MOVELPMPEXI    VRPSI                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                          120025
      *
     C                     ENDSR
      /EJECT                                                              144915
      *************************************************************144915 166578
      **SRRXST**-**Redefaulting*the*extended*settlement.***********144915 166578
      **Called*by:*SRFXST*-*Format*fields*for*extended*settlement**144915 166578
      **Calls****:*SRCLEX*-*Clear*the*extended*settlement*details.*144915 166578
      *************SRACCT*-*Get*Account*Details.*******************144915 166578
      *************************************************************144915 166578
     C***********SRRXST    BEGSR                                   144915 166578
      ***********                                                  144915 166578
     C***********          MOVE *BLANKS   W@RETL                   144915 166578
     C***********          MOVE *BLANKS   W@CNUM                   144915 166578
     C***********          MOVE *BLANKS   W@CYCD                   144915 166578
     C***********          MOVE *BLANKS   W@ACOD                   144915 166578
     C***********          MOVE *BLANKS   W@ACSQ                   144915 166578
     C***********          MOVE *BLANKS   W@BRCA                   144915 166578
      ***********                                                  144915 166578
     C***********          SELEC                                   144915 166578
     C***********WWSTM     WHEQ 04                                 144915 166578
     C***********          MOVELCNUM      W@CNUM                   144915 166578
     C***********          MOVELBKEURO    W@CYCD                   144915 166578
     C***********          MOVELBMACCD    W@ACOD                   144915 166578
     C***********          MOVEL'01'      W@ACSQ                   144915 166578
     C***********          MOVELBRCA      W@BRCA                   144915 166578
     C***********          EXSR SRACCT                             144915 166578
     C***********W@FND     IFEQ 'N'                                144915 166578
     C***********          EXSR SRCLEX                             144915 166578
     C***********          ENDIF                                   144915 166578
      ***********                                                  144915 166578
     C***********WWSTM     WHEQ 05                                 144915 166578
     C***********6         SUBSTWWONS:1   W@CNUM                   144915 166578
     C***********4         SUBSTWWONS:7   W@ACOD                   144915 166578
     C***********2         SUBSTWWONS:11  W@ACSQ                   144915 166578
     C***********          MOVELBKEURO    W@CYCD                   144915 166578
     C***********          MOVELBRCA      W@BRCA                   144915 166578
     C***********          EXSR SRACCT                             144915 166578
     C***********W@FND     IFEQ 'N'                                144915 166578
     C***********          EXSR SRCLEX                             144915 166578
     C***********          ENDIF                                   144915 166578
      ***********                                                  144915 166578
     C***********WWSTM     WHEQ 14                                 144915 166578
     C***********10        SUBSTWWONS:1   W@RETL                   144915 166578
     C***********          EXSR SRACCT                             144915 166578
     C***********W@FND     IFEQ 'N'                                144915 166578
     C************LOCK     IN   LDA                                144915 166578
     C***********          MOVEL'ACCNTAB' DBFILE                   144915 166578
     C***********          Z-ADD63        DBASE                    144915 166578
     C***********          MOVEL*BLANKS   DBKEY                    144915 166578
     C***********          OUT  LDA                                144915 166578
     C***********          EXSR *PSSR                              144915 166578
     C***********          ELSE                                    144915 166578
     C***********          MOVEL*BLANKS   W@RETL                   144915 166578
     C***********          MOVELACNUM     W@CNUM                   144915 166578
     C***********          MOVELBKEURO    W@CYCD                   144915 166578
     C***********          MOVELACOD      W@ACOD                   144915 166578
     C***********          MOVELACSQ      W@ACSQ                   144915 166578
     C***********          MOVELABRCD     W@BRCA                   144915 166578
     C***********          EXSR SRACCT                             144915 166578
     C***********W@FND     IFEQ 'Y'                                144915 166578
     C***********ATYP      ANDEQ'R'                                144915 166578
     C***********          EXSR SRCLEX                             144915 166578
     C***********          Z-ADD14        WWSTM                    144915 166578
     C***********          MOVELACNO      WWONS                    144915 166578
     C***********          ELSE                                    144915 166578
     C***********          EXSR SRCLEX                             144915 166578
     C***********          ENDIF                                   144915 166578
     C***********          ENDIF                                   144915 166578
     C***********          ENDSL                                   144915 166578
      ***********                                                  144915 166578
     C***********          ENDSR                                   144915 166578
      ***/EJECT**                                                  144915 166578
      *************************************************************144915 166578
      **SRCLEX**-**Clear*the*extended*settlement*details.**********144915 166578
      **Called*by:*SRRXST*-*Redefaulting*the*extended*settlement.**144915 166578
      **Calls****:*None********************************************144915 166578
      *************************************************************144915 166578
     C***********SRCLEX    BEGSR                                   144915 166578
      ***********                                                  144915 166578
     C***********WRCV      IFEQ 'Y'                                144915 166578
     C***********          Z-ADD0         WWSTM                    144915 166578
     C***********          MOVEL*BLANKS   WWONS                    144915 166578
     C***********          MOVEL*BLANKS   PAROBN                   144915 166578
     C***********          MOVEL*BLANKS   PAROCN                   144915 166578
     C***********          MOVEL*BLANKS   PARIBN                   144915 166578
     C***********          MOVEL*BLANKS   PMRIBA                   144915 166578
     C***********          ELSE                                    144915 166578
     C***********          Z-ADD0         WWSTM                    144915 166578
     C***********          MOVEL*BLANKS   WWONS                    144915 166578
     C***********          MOVEL*BLANKS   PAPIBN                   144915 166578
     C***********          MOVEL*BLANKS   PMPIBA                   144915 166578
     C***********          MOVEL*BLANKS   PAPOBN                   144915 166578
     C***********          MOVEL*BLANKS   PAPOCN                   144915 166578
     C***********          MOVEL*BLANKS   PMCVMR                   144915 166578
     C***********          MOVEL*BLANKS   PARCRN                   144915 166578
     C***********          MOVEL*BLANKS   PMRCRA                   144915 166578
     C***********          MOVEL*BLANKS   PARVNO                   144915 166578
     C***********          MOVEL*BLANKS   PAAWBN                   144915 166578
     C***********          MOVEL*BLANKS   PMAWBA                   144915 166578
     C***********          MOVEL*BLANKS   PABENN                   144915 166578
     C***********          MOVEL*BLANKS   PMBENA                   144915 166578
     C***********          MOVEL*BLANKS   PMDTP1                   144915 166578
     C***********          MOVEL*BLANKS   PMDTP2                   144915 166578
     C***********          MOVEL*BLANKS   PMDTP3                   144915 166578
     C***********          MOVEL*BLANKS   PMDTP4                   144915 166578
     C***********          MOVEL*BLANKS   PMDCHG                   144915 166578
     C***********          MOVEL*BLANKS   PMBTB1                   144915 166578
     C***********          MOVEL*BLANKS   PMBTB2                   144915 166578
     C***********          MOVEL*BLANKS   PMBTB3                   144915 166578
     C***********          MOVEL*BLANKS   PMBTB4                   144915 166578
     C***********          MOVEL*BLANKS   PMBTB5                   144915 166578
     C***********          MOVEL*BLANKS   PMBTB6                   144915 166578
     C***********          ENDIF                                   144915 166578
      ***********                                                  144915 166578
     C***********          ENDSR                                   144915 166578
      /EJECT
      *****************************************************************
      * SRUROL  -  Process Update of Rollover Record                  *
      * Called by: Main routine                                       *
      *            SRBTCH - Batch processing                          *
      *            SRSPRO - Process Selected Action                   *
      * Calls    : SRUAMD - Update files for amend action             *
      *            SRUAUT - Update files for authorise action         *
      *            SRTAMD - Update test harness for amend action      *
      *            SRTAUT - Update test harness for authorise action  *
      *****************************************************************
     C           SRUROL    BEGSR
      *
      **  Update loan files for All run modes.
      *
      **  Transaction details.
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      VTNLU
     C                     Z-ADDBJRDNB    VLCD                            158486
     C                     MOVE 'A'       VCHTP                           158486
     C           PMODE     IFEQ 'B'
     C***                  Z-ADDVTDST     VLCD                            158486
     C                     MOVELWTREF     VRPCR
      *
     C                     ELSE
     C***                  Z-ADDBJRDNB    VLCD                            158486
     C***                  MOVELSACTN     VCHTP                           158486
      *
      ****Unlink*loan*from*syndication*if*new*rollover*date,********      153663
      ****rollover*frequency*or*day*number*was*changed.*************      153663
      ****only*when*linked*to*start*with****************************123177153663
     C***********SACTN     IFEQ 'A'                                       153663
     C***********LNKS      ANDEQ'Y'                                 123177153663
     C***********PMODE     IFNE 'B'                                 123177153663
     C***********P#TSEQ    ORLE 1                                   123177153663
     C***********VRLDT     IFNE *ZEROS                                    153663
     C***********VRLDT     ANDNERLDT                                      153663
     C***********VRLFQ     ORNE *BLANK                                    153663
     C***********VRLFQ     ANDNERLFQ                                      153663
     C***********VRLDY     ORNE *ZEROS                                    153663
     C***********VRLDY     ANDNERLDY                                      153663
     C***********          MOVE 'N'       VLNKS                           153663
     C***********          ENDIF                                          153663
     C***********          ENDIF                                    123177153663
     C***********          ENDIF                                          153663
     C                     ENDIF
      *
     C           SACTN     CASEQ'A'       SRUAMD
     C           SACTN     CASEQ'X'       SRUAUT
     C           SACTN     CASEQ'Q'       SRUAUT                          CLE030
     C                     ENDCS
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     EXSR SRFEES                                                        CLE031
     C                     ENDIF                                                              CLE031
      *                                                                   CLE030
      ** Update LERELEPD if CLE030 is on and loan has been released       CLE030
      *                                                                   CLE030
     C           CLE030    IFEQ 'Y'                                       CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           RSTS      ANDEQ'A'                                       CLE030
     C                     MOVE RECI      RERECI                          CLE030
     C**********           Z-ADDLNRF      RELNRF                                       CLE030 CLE148
     C                     MOVELLNRF      RELNRF                                              CLE148
     C                     Z-ADDPTYP      REPTYP                          CLE030
     C**********           Z-ADDCNUM      RECNUM                                       CLE030 CSD027
     C                     MOVE CNUM      RECNUM                                              CSD027
     C                     MOVE BRCA      REBRCA                          CLE030
     C                     MOVE LTYP      RELTYP                          CLE030
     C                     MOVE SUTP      RESUTP                          CLE030
     C                     Z-ADDDDAT      REDDAT                          CLE030
     C                     Z-ADDVDAT      REVDAT                          CLE030
     C                     Z-ADDMDAT      REMDAT                          CLE030
     C**********           Z-ADDFCUS      REFCUS                                       CLE030 CSD027
     C                     MOVE FCUS      REFCUS                                              CSD027
     C                     Z-ADDFTYP      REFTYP                          CLE030
     C                     Z-ADDFSEQ      REFSEQ                          CLE030
     C                     MOVE CCY       RECCY                           CLE030
     C                     Z-ADDCPAM      RECPAM                          CLE030
     C                     MOVE AUUSER    REXUSR                          CLE030
     C                     MOVE USER      RERUSR                          CLE030
     C                     Z-ADDBJRDNB    RELCD                           CLE030
     C                     TIME           RETIME                          CLE030
     C                     WRITELERELED0                                  CLE030
     C                     ENDIF                                          CLE030
      *
      **  Format and add record to test harness file
      **  for Record mode.
      *
     C           PMODE     IFEQ 'R'
      *
      **  Initialise test harness record.
     C                     CLEARLE2070D0
      *
     C           SACTN     CASEQ'A'       SRTAMD
     C           SACTN     CASEQ'X'       SRTAUT
     C           SACTN     CASEQ'Q'       SRTAUT                          CLE030
     C                     ENDCS
      *
      **  Write record to the test harness.
     C                     WRITELE2070D0
      *
     C                     ENDIF
      *                                                                   CSC011
      * If Support System active, write transaction to 24x7 log           CSC011
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C*                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
      *                                                                   CSC011
      * Convert Rollover to PINPP format                                  CSC011
     C                     EXSR LOG247                                    CSC011
      *                                                                   CSC011
      * Write valid Rollover in PINPP format to 24x7 Log File             CSC011
     C                     MOVE 'V'       LOGVAL  1                       CSC011
     C                     EXSR APLGTR                                    CSC011
     C                     COMIT                                          CSC011
      *                                                                   CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
      *
      **  Set up WFMT field with 'ME' to update shadow files.
      *
     C                     MOVE 'ME'      WFMT
     C/COPY WNCPYSRC,LE2070C006
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRUSHW  -  Process Update of Shadow Files                     *
      * Called by: Main routine                                       *
      *            SRBTCH - Batch processing                          *
      *            SRSPRO - Process Selected Action                   *
      * Calls    :                                                    *
      *****************************************************************
     C           SRUSHW    BEGSR
      **  NOTE:  NO SHADOW POSTING FOR ROLLOVERS.
      **         PROGRAM NOT USED.
      *
      ** Do on-line updates to PRONO, MEMOS, OLPOS and RSACMTPD
      *
      *                    CALL 'AOOULEU0'
      *                    PARM *BLANKS   PRTCD
      *                    PARM           Z#BSTS
      *                    PARM           Z#ASTS
      *                    PARM           Z#WSTS
      *
      *          PRTCD     IFEQ '*ERROR*'
      *                    EXSR *PSSR
      *                    END
     C/COPY WNCPYSRC,LE2070C022
      *                                                                   CDE001
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           SACTN     IFEQ 'I'                                                           201672
     C           SACTN     OREQ 'A'                                                           201672
     C           SACTN     OREQ 'R'                                                           201672
     C           PTYP      IFNE 70                                                            201672
     C           PTYP      ANDNE71                                                            201672
     C           PTYP      ANDNE72                                                            201672
     C                     Z-ADDNMDT      #NMDAT                                              201672
     C           #OMDAT    IFNE 0                                                             201672
     C           #NMDAT    ORNE 0                                                             201672
     C           #ONIDT    ORNE NIDT                                                          205771
     C           NCCY      ORNE *BLANKS                                                       220754
     C           NCCY      ANDNE#ONCCY                                                        220754
     C           NCCY      OREQ *BLANKS                                                       218984
     C           NPRAM     ANDNE*ZEROS                                                        218984
     C           NFCE      ANDNE*ZEROS                                                        218984
      *                                                                                       201672
     C                     CALL 'AOOULEU0'                                                    201672
     C                     PARM *BLANKS   PRTCD                                               201672
     C                     PARM           Z#BSTS                                              201672
     C                     PARM           Z#ASTS                                              201672
     C                     PARM           Z#WSTS                                              201672
     C                     PARM           Z#BSTK                                              220754
     C                     PARM           Z#ASTK                                              220754
     C                     PARM *BLANKS   CLONQD                                            AR820267
      *                                                                                       201672
     C           PRTCD     IFEQ '*ERROR*'                                                     201672
     C           PRTCD     OREQ '*RECLCK'                                                   AR868380
     C                     EXSR *PSSR                                                         201672
     C                     END                                                                201672
      *                                                                                       201672
     C           #NMDAT    IFEQ 0                                                             201672
     C                     Z-ADDMDAT      #NMDAT                                              201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C           #OMDAT    IFEQ 0                                                             201672
     C                     Z-ADDMDAT      #OMDAT                                              201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C                     MOVELLNRF      OLNRF                                               201672
     C                     CALL 'LE2032 '                                                     201672
     C**********           PARM           OLNRF   60                                   201672 CLE148
     C                     PARM           OLNRF   6                                           CLE148
     C                     PARM           #NMDAT  50                                          201672
     C                     PARM           #OMDAT  50                                          201672
     C                     PARM *BLANKS   PRTCD                                             AR868380
      *                                                                                     AR868380
     C           PRTCD     IFEQ '*RECLCK'                                                   AR868380
     C                     EXSR *PSSR                                                       AR868380
     C                     ENDIF                                                            AR868380
     C                     ENDIF                                                              201672
     C                     ENDIF                                                              201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C           CDE001    IFEQ 'Y'                                       CDE001
     C                     MOVELSLOAN     T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C                     PARM           T#TREF 20                       CDE001
     C                     PARM 'LOAN'    T#TCAT  4                       CDE001
     C                     PARM *BLANKS   T#RSRV 10                       CDE005
     C                     ENDIF                                          CDE001
      *
      ** If not in batch mode or play mode, commit updates
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           PMODE     OREQ 'F'                                       CAP062
      *                                                                   CAP062
     C           PMODE     IFEQ 'F'                                       CAP062
     C           XREPN     CHAINLEIROLDL             99                   CAP062
     C                     DELETLEIROLDL                                  CAP062
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     EXSR LOGDEL                                    CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     END                                            CAP062
      *                                                                   CAP062
     C                     COMIT
     C                     ENDIF
      *
      ** Return to initial screen or subfile screen
      *
     C                     MOVE 'F0'      WFMT
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRLOAN  -  Validate Loan number and fetch details.            *
      * Called by: SRVPMT - Validate prompt key input                 *
      *            SRLOAD - Load subfile records                      *
      *            SRLOAD - Load next set of records to subfile       *
      *            SRMORE - Look for next valid record                *
      *            SRSVAL - Validate subfile fields                   *
      *            SRSPRO - Process selection action                  *
      * Calls    : None                                               *
      *****************************************************************
     C           SRLOAN    BEGSR
      *
     C                     MOVE *BLANKS   @ERCOD  7
      *
      **  Loan number must be entered.
     C********** WLNRF     IFEQ *ZEROS                                                        CLE148
     C           WLNRF     IFEQ *BLANKS                                                       CLE148
     C                     MOVEL'LEV0161' @ERCOD
     C                     ENDIF
      *
      **  Loan number must be a live record in Loans detail file 1.
     C           @ERCOD    IFEQ *BLANKS
     C                     MOVE 'A'       WRCDT
     C           WLOAN     CHAINCLOAN               N85
     C                     SELEC
     C           *IN85     WHEQ *ON
     C                     MOVEL'LEV1001' @ERCOD
     C           RECI      WHEQ 'M'
      *                                                                   131253
     C           RATF      IFNE 'Y'                                       131253
     C           CLE005    ORNE 'Y'                                       131253
     C                     MOVEL'LEV1002' @ERCOD
     C                     ENDIF                                          131253
     C           RECI      WHEQ 'R'
     C                     MOVEL'LEV1003' @ERCOD
     C           RECI      WHNE 'D'
     C                     MOVEL'LEV0161' @ERCOD
     C           PTYP      WHEQ 80                                                            CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C                     MOVEL'LEV1064' @ERCOD                                              CLE028
     C                     ENDSL
     C                     ENDIF
     C                     MOVELNIDT      #ONIDT  50                                          205771
     C                     MOVELRECI      RECIO                                               220754
     C                     MOVELCHTP      CHTPO                                               220754
     C                     MOVELTNLU      TNLUO                                               220754
     C                     MOVELCNUML     CNUM                                                220754
     C                     MOVELCURREF    Z#BSTS                                              201672
      ***********                                                         144688
      ****Rollover*are*not*allowed*to*Call/Demand*or*Risk*loans.********* 144688
     C***********@ERCOD    IFEQ *BLANKS                                   144688
     C***********PTYP      IFEQ 61                                        144688
     C***********PTYP      OREQ 65                                        122098
     C***********PTYP      OREQ 67                                        122098
     C***********PTYP      OREQ 70                                        144688
     C***********PTYP      OREQ 68                                        144688
     C***********CLE005    ANDEQ'Y'                                       144688
     C***********PTYP      OREQ 71                                        144688
     C***********CLE005    ANDEQ'Y'                                       144688
     C***********          MOVEL'LEV0272' @ERCOD                          144688
     C***********          ENDIF                                          144688
     C***********          ENDIF                                          144688
      *
      **  Early matured Discounted loan cannot be rollovered.
     C           @ERCOD    IFEQ *BLANKS
     C           PTYP      ANDEQ63
     C           SACTN     ANDEQ'A'
     C           ORMD      ANDGT*ZERO
     C           @ERCOD    OREQ *BLANKS                                   122098
     C           PTYP      ANDEQ65                                        122098
     C           SACTN     ANDEQ'A'                                       122098
     C           ORMD      ANDGT*ZERO                                     122098
     C           @ERCOD    OREQ *BLANKS                                   122098
     C           PTYP      ANDEQ67                                        122098
     C           SACTN     ANDEQ'A'                                       122098
     C           ORMD      ANDGT*ZERO                                     122098
     C                     MOVEL'LEV0469' @ERCOD
     C                     ENDIF
      *
      **  Loan number must exist in Loans detail file 2.
     C           @ERCOD    IFEQ *BLANKS
     C                     MOVE 'B'       WRCDT
     C           WLOAN     CHAINCLOAN               N85
     C           *IN85     IFEQ *ON
     C                     MOVEL'LEV0161' @ERCOD
     C                     ENDIF
     C                     MOVELNCCY      #ONCCY  3                                           220754
     C                     MOVELLNRF      KLNRF                                               220754
     C                     MOVELTNLUK     TNLU                                                220754
     C                     MOVELCURRFK    Z#BSTK                                              220754
     C                     ENDIF
     C/COPY WNCPYSRC,LEH00603
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRAUTH  -  Validate authorisation action                      *
      * Called by: SRVPMT - Validate prompt key input                 *
      *            SRSVAL - Validate subfile fields                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRAUTH    BEGSR
      *
      **  If authorisation feature (CLE002) is not installed
      **  authorisation action is not allowed
      *
     C           CLE002    IFEQ 'N'
     C                     MOVEA'11'      *IN,30
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV1008' ZAMSID
     C                     EXSR ZASNMS
      *
      **  If authorisation feature is installed,
      *
     C                     ELSE
      *
      **  Authorisation of rollover is not needed.
      *
     C           BPROAU    IFNE 'Y'
     C                     MOVE *ON       *IN30
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV1009' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      *                                                                                       CSD015
      **  Watch List Checking Applied                                                         CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
      ** If 24X7 is not installed or the suport system is off.                                CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
      *                                                                                       CSD015
     C                     MOVE *OFF      *IN09                                               CSD015
     C                     MOVEL*BLANKS   WFUNT                                               CSD015
     C                     MOVEL*BLANKS   WIDEN                                               CSD015
     C                     MOVEL*BLANKS   WBRCH                                               CSD015
      *                                                                                       CSD015
     C                     MOVEL'CLOANCK' WFUNT                                               CSD015
     C                     MOVELLNRF      WIDEN                                               CSD015
     C                     MOVELBRCA      WBRCH                                               CSD015
     C           KWHTKY    CHAINSDCWHTL1             09                                       CSD015
      *                                                                                       CSD015
      ** If record found, diplay error message 'Trade details being                           CSD015
      ** reviewed by Compliance Officer'                                                      CSD015
      *                                                                                       CSD015
     C           *IN09     IFEQ *OFF                                                          CSD015
     C           W3TREL    ANDNE'Y'                                                           CSD015
     C                     MOVE '1'       *IN30                                               CSD015
     C                     MOVE '1'       *IN31                                               CSD015
     C                     MOVE *ON       ERRDET                                              CSD015
     C                     MOVEL'LEL0564' ZAMSID                                              CSD015
     C                     EXSR ZASNMS                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *
      **  Authorising user must be different from the insert and
      **  amend users.
     C/COPY WNCPYSRC,LE2070C020
      *
     C           USER      IFEQ RIUS
     C           USER      OREQ RAUS
     C                     MOVEA'11'      *IN,30
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV1010' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C/COPY WNCPYSRC,LE2070C021
      *
      **  Status of rollover must be complete or requiring re-authori-
      **  sation
      *
     C           RSTS      IFNE 'C'
     C           RSTS      ANDNE'R'
     C                     MOVEA'11'      *IN,30
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV1011' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT                                                              CLE030
      *****************************************************************   CLE030
      * SRVLRL  -  Validate Release action                            *   CLE030
      * Called by: SRVPMT - Validate prompt key input                 *   CLE030
      *            SRSVAL - Validate subfile fields                   *   CLE030
      * Calls    : None                                               *   CLE030
      *****************************************************************   CLE030
     C           SRVLRL    BEGSR                                          CLE030
      *                                                                   CLE030
      **  If authorisation feature (CLE002) is not installed              CLE030
      **  authorisation action is not allowed                             CLE030
      *                                                                   CLE030
     C           CLE002    IFEQ 'N'                                       CLE030
     C                     MOVEA'11'      *IN,30                          CLE030
     C                     MOVE *ON       ERRDET                          CLE030
     C                     MOVEL'LEV0163' ZAMSID                          CLE030
     C                     EXSR ZASNMS                                    CLE030
     C                     ELSE                                           CLE030
      *                                                                   CLE030
      **  Authorisation of rollover is not needed.                        CLE030
      *                                                                   CLE030
     C           BPROAU    IFNE 'Y'                                       CLE030
     C                     MOVE *ON       *IN30                           CLE030
     C                     MOVE *ON       ERRDET                          CLE030
     C                     MOVEL'LEV0164' ZAMSID                          CLE030
     C                     EXSR ZASNMS                                    CLE030
     C                     ELSE                                           CLE030
      *                                                                   CLE030
      **  If CLE030 is not switched on                                    CLE030
      *                                                                   CLE030
     C           CLE030    IFNE 'Y'                                       CLE030
     C                     MOVEA'11'      *IN,30                          CLE030
     C                     MOVE *ON       ERRDET                          CLE030
     C                     MOVE 'LEV0165' ZAMSID                          CLE030
     C                     EXSR ZASNMS                                    CLE030
     C                     ENDIF                                          CLE030
      *                                                                   CLE030
      **  Status of rollover must be 'Q' if action is 'Requires Release'  CLE030
      *                                                                   CLE030
     C           SACTN     IFEQ 'Q'                                       CLE030
     C           RSTS      ANDNE'Q'                                       CLE030
     C                     MOVEA'11'      *IN,30                          CLE030
     C                     MOVE *ON       ERRDET                          CLE030
     C                     MOVEL'LEV0166' ZAMSID                          CLE030
     C                     EXSR ZASNMS                                    CLE030
     C                     ENDIF                                          CLE030
      *                                                                   CLE030
      **  Releasing user must be different from the amend and             CLE030
      **  authorise users.                                                CLE030
      *                                                                   CLE030
     C           USER      IFEQ RIUS                                      CLE030
     C           USER      OREQ RAUS                                      CLE030
     C           USER      OREQ RXUS                                      CLE030
     C                     MOVEA'11'      *IN,30                          CLE030
     C                     MOVE *ON       ERRDET                          CLE030
     C                     MOVEL'LEV0167' ZAMSID                          CLE030
     C                     EXSR ZASNMS                                    CLE030
     C                     ENDIF                                          CLE030
      *                                                                   CLE030
     C                     ENDIF                                          CLE030
     C                     ENDIF                                          CLE030
      *                                                                   CLE030
      * Store Authorising User for output to LERELEPD                     CLE030
      *                                                                   CLE030
     C                     MOVE RXUS      AUUSER 10                       CLE030
     C                     ENDSR                                          CLE030
      /EJECT
      *****************************************************************
      * SRCAUT  -  Check if user is authorised to the action          *
      * Called by: SRVPMT - Validate prompt key input                 *
      *            SRSVAL - Validate subfile fields                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRCAUT    BEGSR
      *
      ** For single branch system, check if user is authorised to the
      ** action
      *
     C                     Z-ADD0         @ERR
     C                     SELEC
     C           MBIN      WHEQ 'N'
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBACTU'
     C                     PARM SACTN     @ZACTN
     C                     PARM           @USER
     C**********           PARM           @ZMGRP                                              CSF002
     C**********           PARM           @ZICDE                                              CSF002
     C                     PARM           UNQCDE 10                                           CSF002
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVACTU'
     C                     PARM SACTN     @ZACTN
     C                     PARM           @ERR
     C                     ENDIF
     C           @ERR      IFNE 0
     C                     MOVE *ON       *IN30
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV0302' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** For multibranching system, and action codes A/E/X, branch code
      ** on loans file must be valid for user.
      *
     C           MBIN      WHEQ 'Y'
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBACTBU'
     C                     PARM SACTN     @ZACTN
     C                     PARM BRCA      @ZBR
     C                     PARM           @USER  10
     C**********           PARM           @ZMGRP  40                                          CSF002
     C**********           PARM           @ZICDE  4                                           CSF002
     C                     PARM           UNQCDE 10                                           CSF002
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVACTBU'
     C                     PARM SACTN     @ZACTN  1
     C                     PARM BRCA      @ZBR    3
     C                     PARM           @ERR    10
     C                     ENDIF
     C           @ERR      IFEQ 1
     C                     MOVEA'11'      *IN,30
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV0303' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C           @ERR      IFEQ 2
     C                     MOVEA'11'      *IN,30
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV0304' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      **  Validate against the Originating branch, if being used.
     C           BKOBRU    IFEQ 'Y'
     C           BKOBUV    ANDEQ'Y'
     C           SACTN     ANDNE'E'
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBOBU'
     C                     PARM ORBR      @ZOBR
     C                     PARM           @USER
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVOBU'
     C                     PARM ORBR      @ZOBR   3
     C                     PARM           @ERR
     C                     ENDIF
     C           @ERR      IFEQ 1
     C                     MOVEA'11'      *IN,30
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV0305' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C           @ERR      IFEQ 2
     C                     MOVEA'11'      *IN,30
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV0306' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDSL
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRINIP  -  Initialise Prompt screen fields.                   *
      * Called by: SRBTCH - Batch Processing                          *
      *            SRSTRT - First screen (prompt for key input)       *
      * Calls    : None                                               *
      *****************************************************************
     C           SRINIP    BEGSR
      *
     C                     CLEARLE2070F1
      *
     C                     CLEARLE2070D1
      *
      **  Clear screen indicators.
     C                     MOVEA'0000'    *IN,30
     C                     MOVE *OFF      ERRDET
      *
      **  Initialise user details for Interactive and Record Modes.
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C                     MOVELUSER      SUSER
     C                     MOVELBJMRDT    SRUNA
     C                     MOVELWSID      SWSID
      *
      **  Default 'Require Authorisation' field to 'N'.
     C                     MOVE 'N'       SRAUT
     C/COPY WNCPYSRC,LE2070C024
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRINIW  -  Clear Work fields                                  *
      * Called by: SRBTCH - Batch Processing                          *
      *            SRPDET - Process detail screen                     *
      * Calls    : None                                               *
      *****************************************************************
     C           SRINIW    BEGSR
      *
     C                     Z-ADD*ZEROS    VRLDT   50
     C                     MOVE *BLANK    VRLFQ   1
     C                     Z-ADD*ZEROS    VRLDY   20
     C**********           Z-ADD*ZEROS    VNBRA   20                                          CSD103
     C                     MOVE *BLANKS   VNBRA   2                                           CSD103
     C                     Z-ADD*ZEROS    VNBRT  117                                          CLE036
     C                     Z-ADD*ZEROS    VNRTS  117
     C                     MOVE *BLANK    VNSIN   1
     C                     Z-ADD*ZERO     VNCAS   10
     C                     MOVE *BLANK    VNCHI   1
     C                     Z-ADD*ZEROS    VNIPD   50
     C                     Z-ADD*ZEROS    VNMDT   50
     C                     Z-ADD*ZEROS    VNIDT   50
     C                     Z-ADD*ZERO     VNROD   50
      *
     C                     MOVE *BLANKS   VNCCY   3
     C                     Z-ADD*ZEROS    VNCPA  130
     C                     Z-ADD*ZEROS    VNFCE  138
     C                     MOVE *BLANK    VNFMD   1
     C                     Z-ADD*ZEROS    VNBCE  138                      123335
     C                     MOVE *BLANK    VNBMD   1                       123335
     C                     Z-ADD*ZEROS    VNLRA  130
      *
     C                     Z-ADD*ZEROS    VNPRAM 130
     C                     Z-ADD*ZEROS    VNDAM  130
     C                     Z-ADD*ZEROS    VINTR  117
      *
     C                     Z-ADD*ZEROS    VRRST   20
     C                     MOVE *BLANKS   VRRON  12
     C                     MOVE *BLANKS   VRRIB   8
     C                     MOVE *BLANKS   VRRBA  35
     C**********           Z-ADD*ZEROS    VRROB   60                                          CSD027
     C**********           Z-ADD*ZEROS    VRROC   60                                          CSD027
     C                     MOVE *BLANKS   VRROB   6                                           CSD027
     C                     MOVE *BLANKS   VRROC   6                                           CSD027
      *
     C                     Z-ADD*ZEROS    VRDST   20
     C                     MOVE *BLANKS   VRLBR   3
     C                     MOVE *BLANKS   VORVD  12
     C                     MOVE *BLANKS   VTHRN  10
      *                                                                   120025
     C                     MOVE *BLANKS   VRLSB   3                       120025
     C                     Z-ADD*ZEROS    VRPST   20                      120025
     C                     MOVE *BLANKS   VRPON  12                       120025
     C                     MOVE *BLANKS   VRPIB   8                       120025
     C                     MOVE *BLANKS   VRPBA  35                       120025
     C**********           Z-ADD*ZEROS    VRPOB   60                                   120025 CSD027
     C**********           Z-ADD*ZEROS    VRPOC   60                                   120025 CSD027
     C                     MOVE *BLANKS   VRPOB   6                                           CSD027
     C                     MOVE *BLANKS   VRPOC   6                                           CSD027
     C                     MOVE *BLANKS   VRRCR   8                       120025
     C                     MOVE *BLANKS   VRRCA  35                       120025
     C                     MOVE *BLANKS   VRRVN   8                       120025
     C                     MOVE *BLANKS   VRAWB   8                       120025
     C                     MOVE *BLANKS   VRAWA  35                       120025
     C                     MOVE *BLANKS   VRBEN   8                       120025
     C                     MOVE *BLANKS   VRBNA  35                       120025
     C                     MOVE *BLANKS   VRDP1  35                       120025
     C                     MOVE *BLANKS   VRDP2  35                       120025
     C                     MOVE *BLANKS   VRDP3  35                       120025
     C                     MOVE *BLANKS   VRDP4  35                       120025
     C                     MOVE *BLANKS   VRDCH   3                       120025
     C                     MOVE *BLANKS   VRBB1  35                       120025
     C                     MOVE *BLANKS   VRBB2  35                       120025
     C                     MOVE *BLANKS   VRBB3  35                       120025
     C                     MOVE *BLANKS   VRBB4  35                       120025
     C                     MOVE *BLANKS   VRBB5  35                       120025
     C                     MOVE *BLANKS   VRBB6  35                       120025
     C                     MOVE *BLANKS   VRCVM   1                       120025
      *
     C                     Z-ADD*ZEROS    VNFRS  117
     C                     MOVE *BLANK    VNFSN   1
      *
     C                     Z-ADD*ZEROS    VTNLU   50
     C                     Z-ADD*ZEROS    VLCD    50
     C                     MOVE *BLANK    VCHTP   1
     C***********          MOVE *BLANK    VRPCR  12                       121519
     C                     MOVE *BLANK    VRPCR  15                       121519
     C***********          MOVE *BLANK    VLNKS   1                       153663
      *
     C                     MOVE *BLANKS   WNBRAW  2
     C                     MOVE *BLANKS   WNBRTW 12                                           CLE036
     C                     Z-ADD*ZEROS    WNRODW  50
     C                     Z-ADD*ZEROS    WRLDTW  50
     C                     Z-ADD*ZEROS    WNFRSW 117
     C                     Z-ADD*ZEROS    WNFCEW 138
     C                     Z-ADD*ZEROS    WNBCEW 138                      123335
     C**********           Z-ADD*ZEROS    WOLNO   60                                   134725 CLE148
     C**********           Z-ADD*ZEROS    WWLNRF  60                                   134725 CLE148
     C                     MOVEL*BLANKS   WOLNO   6                                           CLE148
     C                     MOVEL*BLANKS   WWLNRF  6                                           CLE148
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE *BLANKS   VRRSC   3                       CEU004
     C                     MOVE *BLANKS   VRPSC   3                       CEU004
     C                     MOVE *BLANKS   VRICY   3                       CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   VRRSC                                               CLE031
     C                     MOVE *BLANKS   VRRSR  14                                           CLE031
     C                     MOVE *BLANKS   VRRSI   1                                           CLE031
     C                     MOVE *BLANKS   VRPSC                                               CLE031
     C                     MOVE *BLANKS   VRPSR  14                                           CLE031
     C                     MOVE *BLANKS   VRPSI   1                                           CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVE *BLANKS   VNFYLD  5                                           CAS001
     C                     ENDIF                                                              CAS001
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRINID  -  Clear detail screen fields                         *
      * Called by: SRBTCH - Batch Processing                          *
      *            SRDINI - Initial setup of detail screen            *
      * Calls    : None                                               *
      *****************************************************************
     C           SRINID    BEGSR
      *
     C***********          MOVE *BLANKS   SCUST                           CAP062
     C  N84                MOVE *BLANKS   SCUST                           CAP062
     C***********          MOVE *BLANKS   SCNUM                           CAP062
     C  N84                MOVE *BLANKS   SCNUM                           CAP062
     C                     MOVE *BLANKS   SRLDT
     C***********          MOVE *BLANKS   SRLDTB                          CAP062
     C  N84                MOVE *BLANKS   SRLDTB                          CAP062
     C                     MOVE *BLANKS   SRLFQ
     C***********          MOVE *BLANKS   SRLFQB                          CAP062
     C  N84                MOVE *BLANKS   SRLFQB                          CAP062
     C                     MOVE *BLANKS   SRLDY
     C***********          MOVE *BLANKS   SRLDYB                          CAP062
     C  N84                MOVE *BLANKS   SRLDYB                          CAP062
     C                     MOVE *BLANKS   SNBRA
     C***********          MOVE *BLANKS   SNBRAB                          CAP062
     C  N84                MOVE *BLANKS   SNBRAB                          CAP062
     C                     MOVE *BLANKS   SNBRT                                               CLE036
     C  N84                MOVE *BLANKS   SNBRTB                                              CLE036
     C                     MOVE *BLANKS   SNRTS
     C***********          MOVE *BLANKS   SNRTSB                          CAP062
     C  N84                MOVE *BLANKS   SNRTSB                          CAP062
     C                     MOVE *BLANKS   SNSIN
     C***********          MOVE *BLANKS   SNSINB                          CAP062
     C  N84                MOVE *BLANKS   SNSINB                          CAP062
     C                     MOVE *BLANKS   SNCAS
     C***********          MOVE *BLANKS   SNCASB                          CAP062
     C  N84                MOVE *BLANKS   SNCASB                          CAP062
     C                     MOVE *BLANKS   SNCASB
     C                     MOVE *BLANKS   SNCHI
     C***********          MOVE *BLANKS   SNCHIB                          CAP062
     C  N84                MOVE *BLANKS   SNCHIB                          CAP062
     C                     MOVE *BLANKS   SNROD
     C***********          MOVE *BLANKS   SNRODB                          CAP062
     C  N84                MOVE *BLANKS   SNRODB                          CAP062
     C                     MOVE *BLANKS   SNPRAM
     C***********          MOVE *BLANKS   SNPRAB                          CAP062
     C  N84                MOVE *BLANKS   SNPRAB                          CAP062
     C                     MOVE *BLANKS   SNDAM
     C***********          MOVE *BLANKS   SNDAMB                          CAP062
     C  N84                MOVE *BLANKS   SNDAMB                          CAP062
     C                     MOVE *BLANKS   SNIPD
     C***********          MOVE *BLANKS   SNIPDB                          CAP062
     C  N84                MOVE *BLANKS   SNIPDB                          CAP062
     C                     MOVE *BLANKS   SNMDT
     C***********          MOVE *BLANKS   SNMDTB                          CAP062
     C  N84                MOVE *BLANKS   SNMDTB                          CAP062
     C                     MOVE *BLANKS   SNCCY
     C***********          MOVE *BLANKS   SNCCYB                          CAP062
     C  N84                MOVE *BLANKS   SNCCYB                          CAP062
     C                     MOVE *BLANKS   SNCPA
     C***********          MOVE *BLANKS   SNCPAB                          CAP062
     C  N84                MOVE *BLANKS   SNCPAB                          CAP062
     C                     MOVE *BLANKS   SNFCE
     C***********          MOVE *BLANKS   SNFCEB                          CAP062
     C  N84                MOVE *BLANKS   SNFCEB                          CAP062
     C                     MOVE *BLANKS   SNFMD
     C***********          MOVE *BLANKS   SNFMDB                          CAP062
     C  N84                MOVE *BLANKS   SNFMDB                          CAP062
     C                     MOVE *BLANKS   SNBCE                           123335
     C***********          MOVE *BLANKS   SNBCEB                    CAP062123335
     C  N84                MOVE *BLANKS   SNBCEB                          CAP062
     C                     MOVE *BLANKS   SNBMD                           123335
     C***********          MOVE *BLANKS   SNBMDB                    CAP062123335
     C  N84                MOVE *BLANKS   SNBMDB                          CAP062
     C                     MOVE *BLANKS   SNLRA
     C***********          MOVE *BLANKS   SNLRAB                          CAP062
     C  N84                MOVE *BLANKS   SNLRAB                          CAP062
     C                     MOVE *BLANKS   SSPI1
     C                     MOVE *BLANKS   SSPI2
     C                     MOVE *BLANKS   SSPI3
     C                     MOVE *BLANKS   SNFRSB
     C                     MOVE *BLANKS   SNFSNB
     C                     MOVE *BLANKS   SNFPCB
     C                     MOVE *BLANKS   SRFDY                           CLE011
     C                     MOVE *BLANKS   SRFRT                           CLE011
     C                     MOVE *BLANKS   SFYLDB                                              207273
     C                     MOVE *BLANKS   SRSGN                                             AR847588
     C                     MOVE *BLANKS   SRSGNB                                            AR847588
     C                     MOVE *BLANKS   SRSTA                                               CLE034
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRINIO  -  Clear Outgoing message parameter fields            *
      * Called by: SRBTCH - Batch Processing.                         *
      * Calls    : None                                               *
      *****************************************************************
     C           SRINIO    BEGSR
      *
     C                     CLEARPOUTP
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRMOVP  -  Move Test Harness fields to display fields.        *
      * Called by: SRBTCH - Batch Processing.                         *
      * Calls    : SRSTAT - Determine rollover status narrative       *
      *****************************************************************
     C           SRMOVP    BEGSR
      *
      **  Job details.
      *
     C                     MOVELUSER      SUSER
     C                     MOVELBJMRDT    SRUNA
     C                     MOVELWSID      SWSID
     C                     MOVE 'N'       SRAUT
      *
      **  Action code, loan number, rollover status
      *
     C                     MOVELFLNRF     SLOAN
     C                     MOVELFLNRF     SALON
     C                     MOVELFACTN     SACTN
     C                     MOVELFRSTS     WRSTS
     C                     EXSR SRSTAT
     C                     MOVELWSTAT     SRSTS
      *
      **  Customer number
      *
     C                     MOVELCNMR      SCUST
      *
      **  Rollover date, frequency code and day number
      *
     C                     MOVELFRLDT     SRLDT
     C                     MOVELFRLDT     SRLDTB
     C                     MOVELFRLFQ     SRLFQ
     C                     MOVELFRLFQ     SRLFQB
     C                     MOVELFRLDY     SRLDY
     C                     MOVELFRLDY     SRLDYB
      *
      **  New base rate code, spread/rate, spread indicator,
      **  interest calculation basis, change indicator,
      **  next rollover date.
      *
     C                     MOVELFNBRA     SNBRA
     C                     MOVELFNBRA     SNBRAB
     C                     MOVELFNBRT     SNBRT                                               CLE036
     C                     MOVELFNBRT     SNBRTB                                              CLE036
     C                     MOVELFNRTS     SNRTS
     C                     MOVELFNRTS     SNRTSB
     C                     MOVELFNSIN     SNSIN
     C                     MOVELFNSIN     SNSINB
     C                     MOVELFNCAS     SNCAS
     C                     MOVELFNCAS     SNCASB
     C                     MOVELFNCHI     SNCHI
     C                     MOVELFNCHI     SNCHIB
     C                     MOVELFNROD     SNROD
     C                     MOVELFNROD     SNRODB
      *
      **  New principal, discount amount
      *
     C                     MOVELFNPRAM    SNPRAM
     C                     MOVELFNPRAM    SNPRAB
     C                     MOVELFNDAM     SNDAM
     C                     MOVELFNDAM     SNDAMB
      *
      **  New Interest payment date, maturity date
      *
     C                     MOVELFNIPD     SNIPD
     C                     MOVELFNIPD     SNIPDB
     C                     MOVELFNMDT     SNMDT
     C                     MOVELFNMDT     SNMDTB
      *
      **  New currency, ccy amount, exchange rate,
      **  mult/div indicator, ccy repayment amount
      *
     C                     MOVELFNCCY     SNCCY
     C                     MOVELFNCCY     SNCCYB
     C                     MOVELFNCPA     SNCPA
     C                     MOVELFNCPA     SNCPAB
     C                     MOVELFNFCE     SNFCE
     C                     MOVELFNFCE     SNFCEB
     C                     MOVELFNFMD     SNFMD
     C                     MOVELFNFMD     SNFMDB
     C                     MOVELFNBCE     SNBCE                           123335
     C                     MOVELFNBCE     SNBCEB                          123335
     C                     MOVELFNBMD     SNBMD                           123335
     C                     MOVELFNBMD     SNBMDB                          123335
     C                     MOVELFNLRA     SNLRA
     C                     MOVELFNLRA     SNLRAB
      *
      **  Special instructions
      *
     C                     MOVELFSPI1     SSPI1
     C                     MOVELFSPI2     SSPI2
     C                     MOVELFSPI3     SSPI3
      *
      **  New funding spread/rate, spread indicator, profit centre
      *
     C                     MOVELFNFRS     SNFRSB
     C                     MOVELFNFSN     SNFSNB
     C                     MOVELFNFPC     SNFPCB
      *                                                                                       CAS001
      ** Forward Yield Curve                                                                  CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVELFYLDC     SFYLDB                                              CAS001
     C                     ENDIF                                                              CAS001
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRMOVI  -  Move Incoming message parameters to screen fields  *
      * Called by: SRBTCH - Batch Processing.                         *
      * Calls    : None                                               *
      *****************************************************************
     C           SRMOVI    BEGSR
      *
      **  Incoming Message Header.
      *
     C                     MOVELPITYPE    WTYPE   4
     C                     MOVELPITUSR    WTUSR  16
     C                     MOVELPITWID    WTWID  16
     C                     MOVELPITREF    WTREF  15
     C                     MOVELPITSEQ    WTSEQ   4
     C                     MOVELPIACTN    WACTN   1
     C                     MOVELPITDST    WTDST   8
     C                     MOVELPITTST    WTTST   8
     C************         MOVELPIPARR    WPARR   3                       120002
     C                     MOVELPIPARR    WPARR   4                       120002
      *
      **  Job details.
      *
     C                     MOVELUSER      SUSER
     C                     MOVELBJMRDT    SRUNA
     C                     MOVELWTWID     SWSID
     C                     MOVE 'N'       SRAUT
      *
      **  Transaction date.
      *
     C                     MOVELWTDST     W1DTE8
     C                     MOVELW1DTE4    W6ALNU  6
     C                     MOVE W7DTE8    W6ALNU
     C                     MOVE W6ALNU    ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    VTDST   50
      *
      **  Action code, loan number
      *
     C                     MOVELPILNRF    SLOAN
     C                     MOVELPILNRF    SALON
     C                     MOVELWACTN     SACTN
      *
      **  Customer number
      *
     C                     MOVELPICNUM    SCUST
      *
      **  Rollover date, frequency code and day number
      *
     C                     MOVE *BLANKS   W1DTE8
     C                     MOVELPIRLDT    W1DTE8
     C                     MOVELW1DTE4    SRLDT
     C                     MOVE W7DTE8    SRLDT
     C                     MOVELW1DTE4    SRLDTB
     C                     MOVE W7DTE8    SRLDTB
      *
     C                     MOVELPIRLFQ    SRLFQ
     C                     MOVELPIRLFQ    SRLFQB
     C                     MOVELPIRLDY    SRLDY
     C                     MOVELPIRLDY    SRLDYB
      *
      **  New base rate code, spread/rate, spread indicator,
      **  interest calculation basis, change indicator,
      **  next rollover date.
      *
     C                     MOVELPINBRA    SNBRA
     C                     MOVELPINBRA    SNBRAB
     C                     MOVELPIBASR    SNBRT                                               CLE036
     C                     MOVELPIBASR    SNBRTB                                              CLE036
     C                     MOVELPINRTS    SNRTS
     C                     MOVELPINRTS    SNRTSB
     C                     MOVELPINSIN    SNSIN
     C                     MOVELPINSIN    SNSINB
     C                     MOVELPINCAS    SNCAS
     C                     MOVELPINCAS    SNCASB
     C                     MOVELPINCHI    SNCHI
     C                     MOVELPINCHI    SNCHIB
      *
     C                     MOVE *BLANKS   W1DTE8
     C                     MOVELPINROD    W1DTE8
     C                     MOVELW1DTE4    SNROD
     C                     MOVE W7DTE8    SNROD
     C                     MOVELW1DTE4    SNRODB
     C                     MOVE W7DTE8    SNRODB
      *
      **  New principal, discount amount
      *
     C                     MOVELPINPRA    SNPRAM
     C                     MOVELPINPRA    SNPRAB
     C                     MOVELPINDAM    SNDAM
     C                     MOVELPINDAM    SNDAMB
      *
      **  New Interest payment date, maturity date
      *
     C                     MOVE *BLANKS   W1DTE8
     C                     MOVELPINIPD    W1DTE8
     C                     MOVELW1DTE4    SNIPD
     C                     MOVE W7DTE8    SNIPD
     C                     MOVELW1DTE4    SNIPDB
     C                     MOVE W7DTE8    SNIPDB
      *
     C                     MOVE *BLANKS   W1DTE8
     C                     MOVELPINMDT    W1DTE8
     C                     MOVELW1DTE4    SNMDT
     C                     MOVE W7DTE8    SNMDT
     C                     MOVELW1DTE4    SNMDTB
     C                     MOVE W7DTE8    SNMDTB
      *
      **  New currency, ccy amount, exchange rate,
      **  mult/div indicator, ccy repayment amount
      *
     C                     MOVELPINCCY    SNCCY
     C                     MOVELPINCCY    SNCCYB
     C                     MOVELPINCPA    SNCPA
     C                     MOVELPINCPA    SNCPAB
     C                     MOVELPINFCE    SNFCE
     C                     MOVELPINFCE    SNFCEB
     C                     MOVELPINFMD    SNFMD
     C                     MOVELPINFMD    SNFMDB
     C                     MOVELPINBCE    SNBCE                           123335
     C                     MOVELPINBCE    SNBCEB                          123335
     C                     MOVELPINBMD    SNBMD                           123335
     C                     MOVELPINBMD    SNBMDB                          123335
     C                     MOVELPINLRA    SNLRA
     C                     MOVELPINLRA    SNLRAB
      *
      **  New funding spread/rate, spread indicator, profit centre
      *
     C                     MOVELPINFRS    SNFRSB
     C                     MOVELPINFSN    SNFSNB
     C                     MOVELPINFPC    SNFPCB
      *                                                                                       CAS001
      ** Forward Yield Curve                                                                  CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVELPFYLDC    SFYLDB                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CLE034
      ** Settlement Allocation flag                                                           CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE PISTAL    SRSTA                                               CLE034
     C                     ENDIF                                                              CLE034
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRMOVR  -  Move Rollover Loan Details to display fields       *
      * Called by: SRDINI - Initial set up of detail screen           *
      * Calls    : SRSTAT - Determine rollover status narrative       *
      *            SRCURR - Get currency details                      *
      *****************************************************************
     C           SRMOVR    BEGSR
      *
      **  User profile, run date, workstation ID
      *
     C                     MOVELUSER      SUSER
     C                     MOVELBJMRDT    SRUNA
     C                     MOVELWSID      SWSID
      *
      **  Loan number, status narrative
      *
     C                     MOVELLNRF      SLOAN
     C                     MOVE RSTS      WRSTS
     C                     EXSR SRSTAT
     C                     MOVELWSTAT     SRSTS
      *
      **  Initialise customer number/shortname.
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           SACTN     IFEQ 'E'
     C           SACTN     OREQ 'X'
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   165974
      ** For Parts Purchased use Original Borrower                        165974
      * if System Value LoanCustOriginPurch = 'O'.                                            209026
      *                                                                   165974
     C           PTYP      IFEQ 64                                        165974
     C           PTYP      OREQ 65                                        165974
     C           PTYP      OREQ 68                                        165974
     C           PTYP      OREQ 71                                        165974
      *                                                                                       209026
      ** If LoanCustOriginPurch = 'O', use Original Borrower:                                 209026
     C           PPCUST    IFEQ 'O'                                                           209026
     C                     MOVELOLNO      SCUST                           165974
     C                     ELSE                                                               209026
     C                     MOVELCNUML     SCUST                                               209026
     C                     ENDIF                                                              209026
      * Else, not a Participation Purchased:                                                  209026
     C                     ELSE                                           165974
     C***********          MOVELCNUM      SCUST                           169211
     C                     MOVELCNUML     SCUST                           169211
     C                     ENDIF                                          165974
     C                     ELSE
     C                     MOVE *BLANKS   SCUST
     C                     ENDIF
     C                     ENDIF
      *
      **  Rollover date
      *
     C           RLDT      IFNE *ZERO
     C                     Z-ADDRLDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     SRLDT
     C                     ENDIF
      *                                                                   CLE011
     C           CLE011    IFEQ 'Y'                                       CLE011
      *                                                                   CLE011
     C                     MOVELRFDY      SRFDY                           CLE011
      *                                                                   CLE011
     C           RFRI      IFEQ 'Y'                                       CLE011
      *                                                                   CLE011
     C                     MOVE *ON       *IN72                           CLE011
      *                                                                   CLE011
     C                     MOVE *BLANKS   ZFIELD                          CLE011
     C                     MOVE RFRT      ZFIELD                          CLE011
     C                     Z-ADD7         ZADEC                           CLE011
     C                     EXSR ZEDIT                                     CLE011
     C                     MOVE ZFIELD    SRFRT                           CLE011
      *                                                                   CLE011
     C                     ELSE                                           CLE011
      *                                                                   CLE011
     C                     MOVE *OFF      *IN72                           CLE011
      *                                                                   CLE011
     C                     ENDIF                                          CLE011
      *                                                                   CLE011
     C                     ENDIF                                          CLE011
      *
      **  Rollover frequency and day number
      *
     C           RLFQ      IFNE *BLANK
     C                     MOVELRLFQ      SRLFQ
     C                     MOVELRLDY      SRLDY
     C                     ENDIF
      *
      **  New base rate, spread/rate, spread indicator,
      **  interest calculation basis, change indicator
      *
     C********** NBRA      IFNE *ZERO                                                         CSD103
     C           NBRA      IFNE *BLANKS                                                       CSD103
     C                     MOVELNBRA      SNBRA
     C                     ENDIF
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C           NBSR      ANDNE*ZERO                                                         CLE036
     C                     MOVE *BLANKS   ZFIELD                                              CLE036
     C                     MOVE NBSR      ZFIELD                                              CLE036
     C                     Z-ADD7         ZADEC                                               CLE036
     C                     EXSR ZEDIT                                                         CLE036
     C                     MOVE ZFIELD    SNBRT                                               CLE036
     C                     ENDIF                                                              CLE036
      *
     C           NRTS      IFNE *ZERO
     C                     MOVE *BLANKS   ZFIELD
      *                                                                                     AR847588
      ** Move '-' to SRSGN and get the reciprocal of NRTS for display.                      AR847588
      *                                                                                     AR847588
     C           NRTS      IFLT 0                                                           AR847588
     C                     Z-SUBNRTS      NRTS                                              AR847588
     C                     MOVE '-'       SRSGN                                             AR847588
     C                     ENDIF                                                            AR847588
      *                                                                                     AR847588
     C                     MOVE NRTS      ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SNRTS
     C                     ENDIF
      *
     C                     MOVELNSIN      SNSIN
      *
     C           NCAS      IFNE *ZERO
     C                     MOVELNCAS      SNCAS
     C                     ENDIF
      *
     C                     MOVELNCHI      SNCHI
      *
      **  Next Rollover date
      *
     C           NROD      IFNE *ZERO
     C                     Z-ADDNROD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     SNROD
      *
      **  Compute if Rollover date and frequency detail exists.
     C                     ELSE
     C           RLDT      IFNE *ZEROS
     C***********RLFQ      ANDNE*ZEROS                                    128146
     C           RLFQ      ANDNE*BLANK                                    128146
     C                     Z-ADDRLDT      ZDAYNO
     C                     MOVE RLFQ      ZFREQ
     C                     Z-ADDRLDY      ZMDAY                                               193559
     C                     MOVE CCY       ZCCY
     C                     EXSR ZFREQB
     C                     EXSR ZDATE2
     C                     MOVELZDATE     SNROD
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CAS001
      ** Forward Yield Curve                                                                  CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C********** BRTT      ANDEQ0                                                      CAS001 CSD103
     C           BRTT      ANDEQ*BLANKS                                                       CSD103
     C           PTYP      ANDNE70                                                            CAS001
     C           PTYP      ANDNE71                                                            CAS001
     C           PTYP      ANDNE72                                                            CAS001
     C                     MOVE *ON       *IN73                                               CAS001
     C                     MOVE FSFYLB    SFYLD                                               CAS001
     C                     ELSE                                                               CAS001
     C                     MOVE *OFF      *IN73                                               CAS001
     C                     ENDIF                                                              CAS001
      *
      **  New Principal Amount
      *
     C           NPRAM     IFNE *ZERO
     C                     Z-ADDNPRAM     WSNPAM 130                                          CLE031
     C                     MOVELCCY       PCURR
     C                     Z-ADD50        DBASE
     C                     MOVE *ON       EDBAS   1
     C                     EXSR SRCURR
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE NPRAM     ZFIELD
     C                     Z-ADDA6NBDP    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SNPRAM
     C                     ENDIF
      *
      **  New Discount Amount
      *
     C           NDAM      IFNE *ZERO
     C                     MOVELCCY       PCURR
     C                     Z-ADD51        DBASE
     C                     MOVE *ON       EDBAS
     C                     EXSR SRCURR
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE NDAM      ZFIELD
     C                     Z-ADDA6NBDP    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SNDAM
     C                     ENDIF
      *
      **  New interest payment date
      **  - BLI Lending Enhancement feature
      *
     C           NIPD      IFNE *ZERO
     C           *IN60     ANDEQ*ON
     C                     Z-ADDNIPD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     SNIPD
     C                     ENDIF
      *
      **  New maturity date
      **  - BLI Lending Enhancement feature
      *
     C           NMDT      IFNE *ZERO
     C           *IN60     ANDEQ*ON
     C                     Z-ADDNMDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     SNMDT
     C                     ENDIF
      *                                                                                       201672
      ** Store original value of 'New Maturity Date'.                                         201672
      *                                                                                       201672
     C           NMDT      IFNE 0                                                             201672
     C                     Z-ADDNMDT      #OMDAT                                              201672
     C                     ENDIF                                                              201672
      *
      **  New currency and new currency amount
      **  - Customer Lending Enhancement Syndications feature
      *
     C***********NCPA      IFNE *ZERO                                     144915
     C           NCCY      IFNE *BLANKS                                   144915
     C           *IN61     ANDEQ*ON
     C                     MOVELNCCY      SNCCY
      *
     C                     MOVELNCCY      PCURR
     C                     Z-ADD52        DBASE
     C                     MOVE *ON       EDBAS
     C                     EXSR SRCURR
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE NCPA      ZFIELD
     C                     Z-ADDA6NBDP    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SNCPA
     C                     ENDIF
      *
      **  Exchange rate, exchange rate indicator
      **  - Customer Lending Enhancement Syndications feature
      *
     C           NFCE      IFNE *ZERO
     C           *IN61     ANDEQ*ON
     C           NFCE      ORNE *ZERO                                                         CLE023
     C           *IN67     ANDEQ*ON                                                           CLE023
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE NFCE      ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SNFCE
      *
     C                     MOVELNFMD      SNFMD
     C                     ENDIF
      *                                                                   123335
      **  Base ccy exchange rate and indicator                            123335
      **  - Customer Lending Enhancement Syndications feature             123335
      *                                                                   123335
     C           NBCE      IFNE *ZERO                                     123335
     C           *IN61     ANDEQ*ON                                       123335
     C                     MOVE *BLANKS   ZFIELD                          123335
     C                     MOVE NBCE      ZFIELD                          123335
     C                     Z-ADD8         ZADEC                           123335
     C                     EXSR ZEDIT                                     123335
     C                     MOVE ZFIELD    SNBCE                           123335
      *                                                                   123335
     C                     MOVELNBMD      SNBMD                           123335
     C                     ENDIF                                          123335
      *
      **  Next loan currency repayment amount
      **  - Customer Lending Enhancement Syndications feature
      *
     C           NLRA      IFNE *ZERO
     C           *IN61     ANDEQ*ON
     C                     MOVELNCCY      PCURR
     C                     Z-ADD53        DBASE
     C                     MOVE *ON       EDBAS
     C                     EXSR SRCURR
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE NLRA      ZFIELD
     C                     Z-ADDA6NBDP    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SNLRA
     C                     ENDIF
      *
      **  Special instructions
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C                     MOVELSPI1      SSPI1
     C                     MOVELSPI2      SSPI2
     C                     MOVELSPI3      SSPI3
     C                     ENDIF
      *
      **  Funding details
      *
     C           *IN29     IFEQ *ON
      *
      **  New funding spread/rate
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           NFRS      IFNE *ZERO
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE NFRS      ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SNFRSB
     C                     ENDIF
      *
      **  New funding spread indicator and profit centre
     C                     MOVELNFSN      SNFSNB
     C                     MOVELFPRC      SNFPCB
     C                     ENDIF
      *
      **  Move funding Info fields to work fields.
     C                     Z-ADDNFRS      WONFRS 117
     C                     MOVELNFSN      WONFSN  1
     C                     MOVELNFPC      WONFPC  4
      *
      **  Save new rollover interest details from file.
     C                     Z-ADDNRTS      WSNRTS 117
     C**********           Z-ADDNBRA      WSNBRA  20                                          CSD103
     C                     MOVE NBRA      WSNBRA  2                                           CSD103
     C                     MOVELNSIN      WSNSIN  1
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRUAMD  -  Update files for Amend action.                     *
      * Called by: SRUROL - Process update of rollover record         *
      * Calls    : SRUAUT - Update files for authorise action         *
      *****************************************************************
     C           SRUAMD    BEGSR
      *
      **  Loan details 1 changes.
      *
     C                     MOVE 'A'       WRCDT
     C                     MOVE LNRF      WLNRF
     C           WLOAN     CHAINCLOAN                85
      *
     C           WRLDT1    IFEQ '*'
     C           VRLDT     ORNE *ZEROS
     C                     Z-ADDVRLDT     RLDT
     C                     ENDIF
     C           WNROD1    IFEQ '*'
     C           VNROD     ORNE *ZEROS
     C                     Z-ADDVNROD     NROD
     C                     ENDIF
     C           WRLFQ1    IFEQ '*'
     C           VRLFQ     ORNE *BLANK
     C                     MOVELVRLFQ     RLFQ
     C                     ENDIF
     C           WRLDY1    IFEQ '*'
     C           VRLDY     ORNE *ZEROS
     C                     Z-ADDVRLDY     RLDY
     C                     ENDIF
     C           WNBRA1    IFEQ '*'
     C********** VNBRA     ORNE *ZERO                                                         CSD103
     C           VNBRA     ORNE *BLANKS                                                       CSD103
     C***********SNBRAB    OREQ *BLANKS                                   155463
     C**********           Z-ADDVNBRA     NBRA                                                CSD103
     C                     MOVE VNBRA     NBRA                                                CSD103
     C                     ENDIF
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C           WNBRT1    IFEQ '*'                                                           CLE036
     C           VNBRT     ORNE *ZERO                                                         CLE036
     C                     Z-ADDVNBRT     NBSR                                                CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           WNRTS1    IFEQ '*'
     C           VNRTS     ORNE *ZERO
     C***********SNRTSB    OREQ *BLANKS                                   155463
     C                     Z-ADDVNRTS     NRTS
     C                     ENDIF
     C           WNSIN1    IFEQ '*'
     C           VNSIN     ORNE *BLANK
     C           VNCAS     ANDNE*ZERO
     C                     MOVELVNSIN     NSIN
     C                     ENDIF
     C           WNCHI1    IFEQ '*'
     C           VNCHI     ORNE *BLANK
     C           VNCAS     ANDNE*ZERO
     C                     MOVELVNCHI     NCHI
     C                     ENDIF
     C           WNCAS1    IFEQ '*'
     C           VNCAS     ORNE *ZERO
     C                     Z-ADDVNCAS     NCAS
     C                     ENDIF
     C           VNIDT     IFNE *ZEROS
     C                     Z-ADDVNIDT     NIDT
     C                     ENDIF
      *                                                                   CLE005
      ** Overwrite Interest date with rollover date if interest           CLE005
      ** frequency is 'R'                                                 CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           IPFR      ANDEQ'R'                                       CLE005
     C                     SELEC                                          CLE005
     C           RLDT      WHNE *ZEROS                                    CLE005
     C                     Z-ADDRLDT      NIDT                            CLE005
     C                     Z-ADDRLDT      IBDT                            CLE005
     C           NROD      WHNE *ZEROS                                    CLE005
     C                     Z-ADDNROD      NIDT                            CLE005
     C                     Z-ADDNROD      IBDT                            CLE005
     C                     ENDSL                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C           *IN60     IFEQ *ON
     C           WNIPD1    IFEQ '*'
     C           VNIPD     ORNE *ZEROS
     C                     Z-ADDVNIPD     NIPD
     C                     ENDIF
     C           WNMDT1    IFEQ '*'
     C           VNMDT     ORNE *ZEROS
     C                     Z-ADDVNMDT     NMDT
     C                     ENDIF
     C                     ENDIF
      *
     C           *IN29     IFEQ *ON
     C           VNFRS     IFNE *ZEROS
     C           VNFRS     ANDNENFRS
     C                     Z-ADDVNFRS     NFRS
     C                     ENDIF
     C           VNFSN     IFNE NFSN
     C                     MOVE VNFSN     NFSN
     C                     ENDIF
     C                     MOVE SNFPCB    NFPC
     C                     ENDIF
      *
     C                     Z-ADDVTNLU     TNLU
     C                     Z-ADDVLCD      LCD
     C**********           MOVELVCHTP     CHTP                                              MD020567
     C                     MOVELVCHTP     CHTPL                                             MD020567
     C***********VLNKS     IFNE *BLANK                                    153663
     C***********VLNKS     ANDNELNKS                                      153663
     C***********          MOVE VLNKS     LNKS                            153663
     C***********          ENDIF                                          153663
      *
     C           PMODE     IFEQ 'B'
     C                     MOVE PIPCOB    PCOBL
     C                     ELSE
     C                     MOVE *BLANKS   PCOBL
     C                     ENDIF
      *
     C           PMODE     IFNE 'B'
     C           SACTN     ANDEQ'I'
      *
     C***********          CALL 'AOBRCHR0'                                121783
     C                     CALL 'AOBRCHR1'                                121783
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM BRCA      PBRCA   3
     C           SDBRCH    PARM SDBRCH    DSSDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRCHPD'DBFILE           ************
     C                     Z-ADD58        DBASE            * DBERR 58 *
     C                     MOVELPBRCA     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVELA8MQSM    W#1ST3  3
     C                     MOVELW#1ST3    PCRFL     P
     C                     ENDIF
     C                     ENDIF
      *                                                                   144688
     C           PTYP      IFEQ 61                                        144688
     C           MDAT      ANDEQ0                                         144688
     C           PTYP      OREQ 68                                        144688
     C           MDAT      ANDEQ0                                         144688
     C           PTYP      OREQ 69                                        144688
     C           MDAT      ANDEQ0                                         144688
     C                     Z-ADDNMDT      MDAT                            144688
     C                     Z-ADD0         NMDT                            144688
     C                     ENDIF                                          144688
      **********                                                                   AR826115 MD034840
     C********** BPBRCF    IFEQ 'N'                                                AR826115 MD034840
     C**********           Z-ADD0         BRTT                                     AR826115 MD034840
     C**********           Z-ADD0         BRTE                                     AR826115 MD034840
      **********                                                                   AR826115 MD034840
     C********** SPIN      IFEQ 'A'                                                AR826115 MD034840
     C********** BRTE      ADD  RTSP      RTSP                                     AR826115 MD034840
     C**********           ELSE                                                    AR826115 MD034840
     C********** BRTE      SUB  RTSP      RTSP                                     AR826115 MD034840
     C**********           ENDIF                                                   AR826115 MD034840
      **********                                                                   AR826115 MD034840
     C**********           MOVE *BLANK    SPIN                                     AR826115 MD034840
     C**********           ENDIF                                                   AR826115 MD034840
      *
     C                     UPDATCLOANCLF
     C/COPY WNCPYSRC,LE2070C027
     C                     MOVELRECI      RECIO                                               220754
     C                     MOVELCHTP      CHTPO                                               220754
     C                     MOVELTNLU      TNLUO                                               220754
     C                     MOVELCNUML     CNUM                                                220754
     C                     MOVELCURREF    Z#ASTS                                              201672
      *
      **  Loan details 2 changes.
      *
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       WDIFF   1                                           CSD015
     C                     MOVE 'N'       WDTPC   1                                           CSD015
     C                     MOVEA*BLANKS   WLF,1                                               CSD015
      *                                                                                       CSD015
     C           RRON      IFNE VRRON                                                         CSD015
     C                     MOVELVRRON     WLF,1                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RRIB      IFNE VRRIB                                                         CSD015
     C                     MOVELVRRIB     WLF,2                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RROB      IFNE VRROB                                                         CSD015
     C                     MOVELVRROB     WLF,3                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RROC      IFNE VRROC                                                         CSD015
     C                     MOVELVRROC     WLF,4                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RPON      IFNE VRPON                                                         CSD015
     C                     MOVELVRPON     WLF,5                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RPIB      IFNE VRPIB                                                         CSD015
     C                     MOVELVRPIB     WLF,6                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RPOB      IFNE VRPOB                                                         CSD015
     C                     MOVELVRPOB     WLF,7                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RPOC      IFNE VRPOC                                                         CSD015
     C                     MOVELVRPOC     WLF,8                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RRCR      IFNE VRRCR                                                         CSD015
     C                     MOVELVRRCR     WLF,9                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RRVN      IFNE VRRVN                                                         CSD015
     C                     MOVELRRVN      WLF,10                                              CSD015
     C                     MOVE VRRVN     WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RAWB      IFNE VRAWB                                                         CSD015
     C                     MOVELVRAWB     WLF,11                                              CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RBEN      IFNE VRBEN                                                         CSD015
     C                     MOVELVRBEN     WLF,12                                              CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RDP1      IFNE VRDP1                                                         CSD015
     C           RDP2      ORNE VRDP2                                                         CSD015
     C           RDP3      ORNE VRDP3                                                         CSD015
     C           RDP4      ORNE VRDP4                                                         CSD015
     C                     MOVE 'Y'       WDTPC                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE 'B'       WRCDT
     C                     MOVE LNRF      WLNRF
     C           WLOAN     CHAINCLOAN                85
      *
     C                     Z-ADDVRDST     RDST
     C                     MOVELVORVD     ORVD      P
     C                     MOVELVTHRN     THRN      P
     C           VNPRAM    IFNE *ZEROS
     C           WNPRA1    OREQ '*'
     C                     Z-ADDVNPRAM    NPRAM
     C                     ENDIF
     C           VNDAM     IFNE *ZEROS
     C           WNDAM1    OREQ '*'
     C                     Z-ADDVNDAM     NDAM
     C           VINTR     IFNE *ZEROS
     C                     Z-ADDVINTR     INTR
     C                     ENDIF
     C                     ENDIF
     C                     MOVELVRLBR     RLBR
     C           WPSET     IFEQ 'Y'                                       122098
     C           PTYP      OREQ 63                                        122098
     C           PTYP      OREQ 65                                        122098
     C                     Z-ADDVRRST     RRST
     C                     MOVELVRRON     RRON      P
     C                     MOVELVRRIB     RRIB      P
     C                     MOVELVRRBA     RRBA      P
     C**********           Z-ADDVRROB     RROB                                                CSD027
     C**********           Z-ADDVRROC     RROC                                                CSD027
     C                     MOVE VRROB     RROB                                                CSD027
     C                     MOVE VRROC     RROC                                                CSD027
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELVRRSC     RRSC                            CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELVRRSC     RRSC                                                CLE031
     C                     Z-ADD0         WSEXR0                                              CLE031
     C                     Z-ADD0         WSEXR8                                              CLE031
     C                     MOVE *BLANK    ZFIELD                                              CLE031
     C                     MOVE VRRSR     ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
      *                                                                                       CLE031
     C           *IN99     IFEQ *OFF                                                          CLE031
     C                     MOVE ZFIELD    WSEXR0                                              CLE031
     C           WSEXR0    DIV  100000000 WSEXR8                                              CLE031
     C                     Z-ADDWSEXR8    RRSR                                                CLE031
     C                     ELSE                                                               CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'ZALIGN  'DBFILE                                              CLE031
     C                     Z-ADD73        DBASE                                               CLE031
     C                     MOVELVRRSR     DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELVRRSI     RRSI                                                CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                          122098
      *                                                                   120025
     C           WPSET     IFEQ 'Y'                                       120025
     C           PTYP      OREQ 67                                        122098
     C                     MOVE VRLSB     RLSB                            120025
     C                     Z-ADDVRPST     RPST                            120025
     C                     MOVELVRPON     RPON      P                     120025
     C                     MOVELVRPIB     RPIB      P                     120025
     C                     MOVELVRPBA     RPBA      P                     120025
     C**********           Z-ADDVRPOB     RPOB                                         120025 CSD027
     C**********           Z-ADDVRPOC     RPOC                                         120025 CSD027
     C                     MOVE VRPOB     RPOB                                                CSD027
     C                     MOVE VRPOC     RPOC                                                CSD027
     C                     MOVELVRRCR     RRCR                            120025
     C                     MOVELVRRCA     RRCA                            120025
     C                     MOVELVRRVN     RRVN                            120025
     C                     MOVELVRAWB     RAWB                            120025
     C                     MOVELVRAWA     RAWA                            120025
     C                     MOVELVRBEN     RBEN                            120025
     C                     MOVELVRBNA     RBNA                            120025
     C                     MOVELVRDP1     RDP1                            120025
     C                     MOVELVRDP2     RDP2                            120025
     C                     MOVELVRDP3     RDP3                            120025
     C                     MOVELVRDP4     RDP4                            120025
     C                     MOVELVRDCH     RDCH                            120025
     C                     MOVELVRBB1     RBB1                            120025
     C                     MOVELVRBB2     RBB2                            120025
     C                     MOVELVRBB3     RBB3                            120025
     C                     MOVELVRBB4     RBB4                            120025
     C                     MOVELVRBB5     RBB5                            120025
     C                     MOVELVRBB6     RBB6                            120025
     C                     MOVELVRCVM     RCVM                            120025
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELVRPSC     RPSC                            CEU004
     C                     MOVELVRICY     RICY                            CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELVRPSC     RPSC                                                CLE031
     C                     Z-ADD0         WSEXR0                                              CLE031
     C                     Z-ADD0         WSEXR8                                              CLE031
     C                     MOVE *BLANK    ZFIELD                                              CLE031
     C                     MOVE VRPSR     ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
      *                                                                                       CLE031
     C           *IN99     IFEQ *OFF                                                          CLE031
     C                     MOVE ZFIELD    WSEXR0                                              CLE031
     C           WSEXR0    DIV  100000000 WSEXR8                                              CLE031
     C                     Z-ADDWSEXR8    RPSR                                                CLE031
     C                     ELSE                                                               CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'ZALIGN  'DBFILE                                              CLE031
     C                     Z-ADD74        DBASE                                               CLE031
     C                     MOVELVRPSR     DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELVRPSI     RPSI                                                CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                          120025
      *                                                                   120025
     C           SSPI1     IFNE *BLANKS
     C           SSPI1     ANDNESPI1
     C                     MOVELSSPI1     SPI1
     C                     ENDIF
     C           SSPI2     IFNE *BLANKS
     C           SSPI2     ANDNESPI2
     C                     MOVELSSPI2     SPI2
     C                     ENDIF
     C           SSPI3     IFNE *BLANKS
     C           SSPI3     ANDNESPI3
     C                     MOVELSSPI3     SPI3
     C                     ENDIF
      *
     C           VNCCY     IFNE *BLANKS
     C           WNCCY1    OREQ '*'
     C                     MOVELVNCCY     NCCY
     C           VNCPA     IFNE *ZEROS
     C           WNCPA1    OREQ '*'
     C                     Z-ADDVNCPA     NCPA
     C                     ENDIF
     C           VNFCE     IFNE *ZEROS
     C           WNFCE1    OREQ '*'
     C                     Z-ADDVNFCE     NFCE
     C                     ENDIF
     C           VNFMD     IFNE *BLANK
     C           WNFCE1    OREQ '*'
     C                     MOVELVNFMD     NFMD
     C                     ENDIF
     C           VNBCE     IFNE *ZEROS                                    123335
     C           WNBCE1    OREQ '*'                                       123335
     C                     Z-ADDVNBCE     NBCE                            123335
     C                     ENDIF                                          123335
     C           VNBMD     IFNE *BLANK                                    123335
     C           WNBMD1    OREQ '*'                                       123335
     C                     MOVELVNBMD     NBMD                            123335
     C                     ENDIF                                          123335
     C           VNLRA     IFNE *ZEROS
     C           WNLRA1    OREQ '*'
     C                     Z-ADDVNLRA     NLRA
     C                     ENDIF
     C                     ELSE                                                               CLE023
      *                                                                                       CLE023
      ** Move values to file fields of new facility ccy exchange rate                         CLE023
      ** and indicator even if new currency details were not entered                          CLE023
      ** provided that CLE023 is installed and facility is multi-ccy                          CLE023
      *                                                                                       CLE023
     C           *IN67     IFEQ *ON                                                           CLE023
     C           VNFCE     IFNE *ZEROS                                                        CLE023
     C           WNFCE1    OREQ '*'                                                           CLE023
     C                     Z-ADDVNFCE     NFCE                                                CLE023
     C                     ENDIF                                                              CLE023
     C           VNFMD     IFNE *BLANK                                                        CLE023
     C           WNFCE1    OREQ '*'                                                           CLE023
     C                     MOVELVNFMD     NFMD                                                CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF
      *
      **  Set Rollover Insert & Amend User to current user.
     C           RSTS      IFEQ *BLANK
     C                     MOVELSUSER     RIUS      P
     C                     ENDIF
     C                     MOVELSUSER     RAUS      P
     C           PMODE     IFEQ 'B'                                       120002
     C                     MOVELPIRIUS    RIUS                            120002
     C                     MOVELPIRAUS    RAUS                            120002
     C                     MOVELPIRXUS    RXUS                            120002
     C                     ENDIF                                          120002
      *
      **  Set Rollover Authorising User to blanks.
     C                     MOVE *BLANKS   RXUS
      *
      ****Set*Rollover*Status*to*'R'*if*previous*status*was*'A'****       194509
      ** Set Rollover Status to 'R' if previous status was 'A' or 'R'     194509
      ** If it's 'Q' and we amend, then need to set back to 'R'           CLE030
      **  else, set Rollover status to 'C'
     C           RSTS      IFEQ 'A'
     C           RSTS      OREQ 'R'                                       194509
     C           RSTS      OREQ 'Q'                                       CLE030
     C                     MOVE 'R'       RSTS
     C                     ELSE
     C                     MOVE 'C'       RSTS
     C                     ENDIF
     C           PMODE     IFEQ 'B'                                       120002
     C                     MOVE 'A'       RSTS                            120002
     C                     ENDIF                                          120002
     C                     Z-ADDVTNLU     TNLU
     C                     Z-ADDVLCD      LCD
     C                     MOVELVCHTP     CHTP
     C           VRPCR     IFNE *BLANKS
     C                     MOVELVRPCR     RPCR
     C                     ENDIF
      *                                                                   CEU020
      **  Set ECIN to 'Y' if CEU020 is installed and the rollover of      CEU020
      **  the currency is from an 'In' currency to the Euro currency      CEU020
      *                                                                   CEU020
     C           CEU020    IFEQ 'Y'                                       CEU020
     C           SNCCYB    ANDNE*BLANKS                                   CEU020
     C           WNCCY1    ANDNE'*'                                       CEU020
     C           VNCCY     IFEQ BKEURO                                    CEU020
     C           WINCY     ANDEQ'Y'                                       CEU020
     C                     MOVE 'Y'       ECIN                            CEU020
     C                     ELSE                                           CEU020
     C                     MOVE 'N'       ECIN                            CEU020
     C                     ENDIF                                          CEU020
     C                     ELSE                                           CEU020
     C           CEU020    IFEQ 'Y'                                       165976
     C           WNCCY1    ANDEQ'*'                                       165976
     C           CEU020    OREQ 'Y'                                       165976
     C           SNCCY     ANDEQ*BLANK                                    165976
     C                     MOVE 'N'       ECIN                            CEU020
     C                     ENDIF                                          165976
     C                     ENDIF                                          CEU020
      *                                                                                       CAS001
      ** Set value for Forward Yield Curve                                                    CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVE VNFYLD    FSFYLB                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE SRSTA     RSTA                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CSD015
      ** Call  SRWTCH if watch list checking is apllied.                                      CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C           PTYP      IFEQ 63                                                            CSD015
     C           PTYP      OREQ 65                                                            CSD015
     C           PTYP      OREQ 67                                                            CSD015
     C           SNCCY     ORNE *BLANKS                                                       CSD015
     C           SNCCYB    ORNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
      ** If 24X7 is not installed or the suport system is off.                                CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
     C                     MOVE *OFF      *IN09                                               CSD015
      *                                                                                       CSD015
     C                     MOVEL*BLANKS   WFUNT                                               CSD015
     C                     MOVEL*BLANKS   WIDEN                                               CSD015
     C                     MOVEL*BLANKS   WBRCH                                               CSD015
      *                                                                                       CSD015
     C                     MOVEL'CLOANCK' WFUNT                                               CSD015
     C                     MOVELLNRF      WIDEN                                               CSD015
     C                     MOVELBRCA      WBRCH                                               CSD015
     C           KWHTKY    CHAINSDCWHTL1             09                                       CSD015
      *                                                                                       CSD015
     C                     SELEC                                                              CSD015
     C           *IN09     WHEQ *OFF                                                          CSD015
     C           W3UNCF    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     MOVELRRON      WLF,1                                               CSD015
     C                     MOVELRRIB      WLF,2                                               CSD015
     C                     MOVELRROB      WLF,3                                               CSD015
     C                     MOVELRROC      WLF,4                                               CSD015
     C                     MOVELRPON      WLF,5                                               CSD015
     C                     MOVELRPIB      WLF,6                                               CSD015
     C                     MOVELRPOB      WLF,7                                               CSD015
     C                     MOVELRPOC      WLF,8                                               CSD015
     C                     MOVELRRCR      WLF,9                                               CSD015
     C                     MOVELRRVN      WLF,10                                              CSD015
     C                     MOVELRAWB      WLF,11                                              CSD015
     C                     MOVELRBEN      WLF,12                                              CSD015
     C                     EXSR SRWTCH                                                        CSD015
      *                                                                                       CSD015
     C           WDIFF     WHEQ 'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
      *                                                                                       CSD015
     C                     ENDSL                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *
     C                     UPDATCLOANCKF
     C                     MOVELLNRF      KLNRF                                               220754
     C                     MOVELTNLUK     TNLU                                                220754
     C                     MOVELCURRFK    Z#ASTK                                              220754
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           CCY       ANDNEFCCY                                                          CLE031
     C           WNPRAM    IFEQ *ZEROS                                                        CLE031
     C           VNFCE     ANDNE*ZEROS                                                        CLE031
      *                                                                                       CLE031
     C                     MOVE 'N'       WPARTP  1                                           CLE031
     C           PTYP      IFEQ 64                                                            CLE031
     C           PTYP      OREQ 65                                                            CLE031
     C           PTYP      OREQ 68                                                            CLE031
     C           PTYP      OREQ 71                                                            CLE031
     C                     MOVE 'Y'       WPARTP                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVE 'N'       WPARTS  1                                           CLE031
     C           PTYP      IFEQ 66                                                            CLE031
     C           PTYP      OREQ 67                                                            CLE031
     C           PTYP      OREQ 69                                                            CLE031
     C           PTYP      OREQ 72                                                            CLE031
     C                     MOVE 'Y'       WPARTS                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     EXSR SRFCLT                                                        CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *
      **  If LE Autorisation feature is switched off
      **  or not required, do automatic authorisation.
     C           *IN70     IFEQ *OFF
     C                     EXSR SRUAUT
     C                     ENDIF
      *                                                                                       CAS009
      ** If CAS009 is On, update LEEIRDPD records depending on                                CAS009
      ** action being done.                                                                   CAS009
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
      *                                                                                       CAS009
     C           WLNRF     CHAINLEEIRDL5             20                                       CAS009
     C           *IN20     IFEQ '0'                                                           CAS009
      *                                                                                       CAS009
      ** If Action is amend and rollover date is within this                                  CAS009
      ** EIR record's start and end dates, set to 'Y'                                         CAS009
      ** indicator fields accordingly.                                                        CAS009
      *                                                                                       CAS009
     C                     SELEC                                                              CAS009
     C           SACTN     WHEQ 'A'                                                           CAS009
     C           RLDT      ANDLEEIENDT                                                        CAS009
     C                     MOVE 'Y'       EIADJP                                              CAS009
     C                     MOVE 'Y'       EIRCAL                                              CAS009
     C                     UPDATLEEIRDD0                                                      CAS009
      *                                                                                       CAS009
      ** If Action is reverse                                                                 CAS009
      *                                                                                       CAS009
     C           WRLDT1    WHEQ '*'                                                           CAS009
      *                                                                                       CAS009
      ** If Rollover date is equal to end date, then                                          CAS009
      ** set Adjustment to EIR to 'Y'.                                                        CAS009
      *                                                                                       CAS009
     C           RLDT      IFLE EIENDT                                                        CAS009
     C                     MOVE 'Y'       EIADJP                                              CAS009
     C                     MOVE 'Y'       EIRCAL                                              CAS009
     C                     UPDATLEEIRDD0                                                      CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDSL                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** ENDIF of CAS009                                                                      CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      *
     C                     ENDSR
      /EJECT
      *****************************************************************                       CSD015
      *  SRWTCH  -  Performs the Watch list processing.               *                       CSD015
      *  Called by: SRUAMD                                            *                       CSD015
      *  Calls    : None                                              *                       CSD015
      *****************************************************************                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** PARAMETER 2:                                                                         CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PARMDS                                              CSD015
     C                     Z-ADD0         WID     20                                          CSD015
      *                                                                                       CSD015
     C           WID       DOUEQ12                                                            CSD015
     C                     ADD  1         WID                                                 CSD015
     C                     MOVELWLF,WID   PINP1                                               CSD015
      *                                                                                       CSD015
     C           WLF,WID   IFNE *BLANKS                                                       CSD015
     C           WLF,WID   ANDNE'000000'                                                      CSD015
      *                                                                                       CSD015
     C           RPSC      IFNE *BLANKS                                                       CSD015
     C                     MOVE RPSC      PCCY                                                CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE CCY       PCCY                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           NCCY      IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           PTYP      IFNE 66                                                            CSD015
     C           PTYP      ANDNE67                                                            CSD015
     C           PTYP      ANDNE69                                                            CSD015
      *                                                                                       CSD015
     C           WID       IFEQ 5                                                             CSD015
     C           RPSC      IFNE *BLANKS                                                       CSD015
     C                     MOVE RPSC      PCCY                                                CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE NCCY      PCCY                                                CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           WID       IFEQ 1                                                             CSD015
     C           RPSC      IFNE *BLANKS                                                       CSD015
     C                     MOVE RPSC      PCCY                                                CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE NCCY      PCCY                                                CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     CALL 'SDCWLFMT'                                                    CSD015
     C                     PARM           PRTCD   7                                           CSD015
     C                     PARM           PINP1  35                                           CSD015
     C                     PARM *BLANKS   PINP2  35                                           CSD015
     C                     PARM *BLANKS   PINP3  35                                           CSD015
     C                     PARM *BLANKS   PINP4  35                                           CSD015
     C                     PARM *BLANKS   PINP5  35                                           CSD015
     C                     PARM *BLANKS   PINP6  35                                           CSD015
     C                     PARM           PCCY    3                                           CSD015
     C                     PARM           POUT  216                                           CSD015
     C                     PARM           PCNUM   6                                           CSD015
      *                                                                                       CSD015
     C           POUT      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCWP2                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
      ** Add the Payment Details.                                                             CSD015
      *                                                                                       CSD015
     C           RDP1      IFNE *BLANKS                                                       CSD015
     C           RDP2      ORNE *BLANKS                                                       CSD015
     C           RDP3      ORNE *BLANKS                                                       CSD015
     C           RDP4      ORNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           WDTPC     IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     CAT  CWA,25:0  PARMDS                                              CSD015
     C                     CAT  DTP1:0    PARMDS                                              CSD015
     C                     CAT  DTP2:1    PARMDS                                              CSD015
     C                     CAT  DTP3:1    PARMDS                                              CSD015
     C                     CAT  DTP4:1    PARMDS                                              CSD015
     C                     CAT  CWA,26:0  PARMDS                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      **  Set up parameter 1 and send details to engine only if                               CSD015
      **  PARMDS is not empty.                                                                CSD015
      *                                                                                       CSD015
     C           PARMDS    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
      ** PARAMETER 1:                                                                         CSD015
      ** Item Type Code                                                                       CSD015
     C                     MOVEL'LEROLL'  W4ITEM                                              CSD015
      *                                                                                       CSD015
      ** Identifier                                                                           CSD015
     C                     MOVELLNRF      W4IDEN                                              CSD015
      *                                                                                       CSD015
      ** Branch                                                                               CSD015
     C                     MOVELBRCA      W4BRCH                                              CSD015
      *                                                                                       CSD015
      ** System                                                                               CSD015
      ** If Midas 24x7 is installed, use Main system prefix otherwise use system prefix       CSD015
     C           CSC011    IFEQ 'Y'                                                           CSD015
     C                     MOVE S1MAIN    W4SYSM                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE LIBR      W4SYSM                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Function Type                                                                        CSD015
     C                     MOVEL'CLOANCK' W4FUNT                                              CSD015
      *                                                                                       CSD015
      ** Counter Party Details                                                                CSD015
     C                     MOVE PCNUM     WKCNUM  6                                           CSD015
     C                     CALL 'AOCUSTR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*KEY   ' POPTN                                               CSD015
     C                     PARM WKCNUM    PCUST                                               CSD015
     C                     PARM           PKYST                                               CSD015
     C           SDCUST    PARM SDCUST    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C           BBCRNM    CAT  BBCRTN    W4CUST                                              CSD015
     C                     MOVELPCNUM     W4CNUM                                              CSD015
      *                                                                                       CSD015
     C           CCF001    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           BBCRPC    IFEQ 'Y'                                                           CSD015
     C                     MOVE 'C'       W4CTYP                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           BBLICD    IFNE *BLANK                                                        CSD015
     C           BBLICD    ANDNEW1IND1                                                        CSD015
     C           BBLICD    ANDNEW1IND2                                                        CSD015
     C           BBLICD    ANDNEW1IND3                                                        CSD015
     C           BBLICD    ANDNEW1IND4                                                        CSD015
     C           BBLICD    ANDNEW1IND5                                                        CSD015
     C                     MOVE 'C'       W4CTYP                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Deal Date                                                                            CSD015
     C                     MOVE *ZERO     W4DDAT                                              CSD015
      *                                                                                       CSD015
      ** Value Date                                                                           CSD015
     C                     MOVE RLDT      W4VDAT                                              CSD015
      *                                                                                       CSD015
      ** Maturity Date                                                                        CSD015
     C           NMDT      IFNE *ZERO                                                         CSD015
     C                     MOVE MDAT      W4MDAT                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE NMDT      W4MDAT                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Denomination Side                                                                    CSD015
     C           NCCY      IFNE *BLANKS                                                       CSD015
     C                     MOVELNCCY      W4DEN1                                              CSD015
     C                     MOVE *BLANKS   W4DEN2                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELCCY       W4DEN1                                              CSD015
     C                     MOVE *BLANKS   W4DEN2                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Amount Side 1                                                                        CSD015
     C           PTYP      IFEQ 63                                                            CSD015
     C           SNCCY     ANDEQ*BLANKS                                                       CSD015
     C           SNCCYB    ANDEQ*BLANKS                                                       CSD015
     C           PTYP      OREQ 65                                                            CSD015
     C           SNCCY     ANDEQ*BLANKS                                                       CSD015
     C           SNCCYB    ANDEQ*BLANKS                                                       CSD015
     C           PTYP      OREQ 67                                                            CSD015
     C           SNCCY     ANDEQ*BLANKS                                                       CSD015
     C           SNCCYB    ANDEQ*BLANKS                                                       CSD015
      *                                                                                       CSD015
     C                     MOVE NPRAM     W4AMT1                                              CSD015
     C                     MOVE *ZERO     W4AMT2                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           NCCY      IFNE *BLANKS                                                       CSD015
     C                     MOVE NCPA      W4AMT1                                              CSD015
     C                     MOVE *ZERO     W4AMT2                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Send transaction details to Compliance Watch by calling SDWLCLOP                     CSD015
      *                                                                                       CSD015
      *                                                                                       CSD015
     C                     CALL 'SDWLCLOP'                                                    CSD015
     C                     PARM           CWLCDS                                              CSD015
     C                     PARM           PARMDS                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      *  SRCWP2  -  Set up the 2nd parameter for Compliance Watch.    *                       CSD015
      *  Called by: SRUPDT                                            *                       CSD015
      *  Calls    : None                                              *                       CSD015
      *****************************************************************                       CSD015
     C           SRCWP2    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C           WID       MULT 2         CLS     20                                          CSD015
     C           CLS       SUB  1         OPN     20                                          CSD015
      *                                                                                       CSD015
     C                     MOVELCWA,OPN   WOPN   25                                           CSD015
     C                     MOVELCWA,CLS   WCLS   25                                           CSD015
      *                                                                                       CSD015
     C           PARMDS    CAT  WOPN:0    PARMDS                                              CSD015
     C                     CAT  POUT:0    PARMDS                                              CSD015
      *                                                                                       CSD015
     C                     SELEC                                                              CSD015
     C           WID       WHEQ 2                                                             CSD015
     C                     CAT  RRBA:0    PARMDS                                              CSD015
     C           WID       WHEQ 6                                                             CSD015
     C                     CAT  RPBA:0    PARMDS                                              CSD015
     C           WID       WHEQ 9                                                             CSD015
     C                     CAT  RRCA:0    PARMDS                                              CSD015
     C           WID       WHEQ 11                                                            CSD015
     C                     CAT  RAWA:0    PARMDS                                              CSD015
     C           WID       WHEQ 12                                                            CSD015
     C                     CAT  RBNA:0    PARMDS                                              CSD015
     C                     ENDSL                                                              CSD015
      *                                                                                       CSD015
     C                     CAT  WCLS:0    PARMDS                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************
      * SRUAUT  -  Update files for Authorise action.                 *
      * Called by: SRUROL - Process update of rollover record         *
      *            SRUAMD - Update files for amend action             *
      * Calls    : SRLTRX - Update LTRIX header and detail records    *
      *****************************************************************
     C           SRUAUT    BEGSR
      *
      **  For Discount loans, update LTRIX.
      *
     C           PTYP      IFEQ 63
     C           PTYP      OREQ 65                                        122098
     C           PTYP      OREQ 67                                        122098
     C                     EXSR SRLTRX
     C                     ENDIF
      *
      **  Loan details 2 changes.
      *
     C                     MOVE 'B'       WRCDT
     C                     MOVE LNRF      WLNRF
     C           WLOAN     CHAINCLOAN                85
      *                                                                   CLE030
      ** If CLE030 is switched on and rollover status should be set       CLE030
      ** to 'Q' then do so, otherwise set it to 'A'                       CLE030
      *                                                                   CLE030
     C           CLE030    IFEQ 'Y'                                       CLE030
     C           W#RSTS    ANDNE' '                                       CLE030
     C                     MOVE W#RSTS    RSTS                            CLE030
     C                     MOVE ' '       W#RSTS                          CLE030
     C                     ELSE                                           CLE030
      *
      **  Set Rollover Status to 'A'.
     C                     MOVE 'A'       RSTS
     C                     ENDIF                                          CLE030
      *
      **  Set Rollover Authorising User to current user.
     C                     MOVELSUSER     RXUS      P
      *
     C                     Z-ADDVTNLU     TNLU
     C                     Z-ADDVLCD      LCD
     C                     MOVELVCHTP     CHTP
      *
     C                     UPDATCLOANCKF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRTAMD  -  Update Test Harness file for Amend action          *
      * Called by: SRUROL - Process update of rollover record         *
      * Calls    : None                                               *
      *****************************************************************
     C           SRTAMD    BEGSR
      *
      **  Date and time stamps
      *
     C                     Z-ADDBJRDNB    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE *BLANKS   W1DTE8
     C                     MOVELZDATE     W1DTE6
     C                     MOVE W1DTE2    WTDT1
     C                     MOVE W3DTE4    WTDT2
     C                     MOVE W5DTE6    WTDT3
     C                     MOVE WTDAT     DTST
      *
     C                     TIME           WTIME
     C                     MOVE WTIM1     WTTM1
     C                     MOVE WTIM2     WTTM2
     C                     MOVE WTIM3     WTTM3
     C                     MOVE WTTIM     TMST
      *
      **  Detail screen fields.
      *
     C                     MOVELSLOAN     FLNRF
     C                     MOVELSACTN     FACTN
     C                     MOVELSCUST     CNMR
     C                     MOVELRSTS      FRSTS
     C                     MOVELSRLDTB    FRLDT
     C                     MOVELSRLFQB    FRLFQ
     C                     MOVELSRLDYB    FRLDY
     C                     MOVELSNBRAB    FNBRA
     C                     MOVELSNBRTB    FNBRT                                               CLE036
     C                     MOVELSNRTSB    FNRTS
     C                     MOVELSNSINB    FNSIN
     C                     MOVELSNCASB    FNCAS
     C                     MOVELSNCHIB    FNCHI
     C                     MOVELSNRODB    FNROD
     C                     MOVELSNPRAB    FNPRAM
     C                     MOVELSNDAMB    FNDAM
     C                     MOVELSNIPDB    FNIPD
     C                     MOVELSNMDTB    FNMDT
     C                     MOVELSNCCYB    FNCCY
     C                     MOVELSNCPAB    FNCPA
     C                     MOVELSNFCEB    FNFCE
     C                     MOVELSNFMDB    FNFMD
     C                     MOVELSNBCEB    FNBCE                           123335
     C                     MOVELSNBMDB    FNBMD                           123335
     C                     MOVELSNLRAB    FNLRA
     C                     MOVELSSPI1     FSPI1
     C                     MOVELSSPI2     FSPI2
     C                     MOVELSSPI3     FSPI3
      *                                                                                       CAS001
      ** Forward Yield Rate                                                                   CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVELSFYLDB    FYLDC                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CLE034
      ** Settlement Allocation flag                                                           CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE SRSTA     FSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
      *
      **  Funding details.
      *
     C           *IN29     IFEQ *ON
     C                     MOVELSNFRSB    FNFRS
     C                     MOVELSNFSNB    FNFSN
     C                     MOVELSNFPCB    FNFPC
     C                     ENDIF
      *
      **  Extended settlements.
      *
     C           *IN27     IFEQ *ON
     C           VRRST     IFEQ *ZEROS
     C                     MOVE *BLANKS   FRRST
     C                     ELSE
     C                     MOVELVRRST     FRRST
     C                     ENDIF
     C                     MOVELVRRON     FRRON
     C                     MOVELVRRIB     FRRIB
     C                     MOVELVRRBA     FRRBA
     C********** VRROB     IFEQ *ZEROS                                                        CSD027
     C           VRROB     IFEQ *BLANKS                                                       CSD027
     C                     MOVE *BLANKS   FRROB
     C                     ELSE
     C                     MOVELVRROB     FRROB
     C                     ENDIF
     C********** VRROC     IFEQ *ZEROS                                                        CSD027
     C           VRROC     IFEQ *BLANKS                                                       CSD027
     C                     MOVE *BLANKS   FRROC
     C                     ELSE
     C                     MOVELVRROC     FRROC
     C                     ENDIF
      *                                                                   CEU004
     C           VRPST     IFEQ *ZEROS                                    CEU004
     C                     MOVE *BLANKS   FRPST                           CEU004
     C                     ELSE                                           CEU004
     C                     MOVELVRPST     FRPST                           CEU004
     C                     ENDIF                                          CEU004
     C                     MOVELVRPON     FRPON                           CEU004
     C                     MOVELVRPIB     FRPIB                           CEU004
     C                     MOVELVRPBA     FRPBA                           CEU004
     C********** VRPOB     IFEQ *ZEROS                                                 CEU004 CSD027
     C           VRPOB     IFEQ *BLANKS                                                       CSD027
     C                     MOVE *BLANKS   FRPOB                           CEU004
     C                     ELSE                                           CEU004
     C                     MOVELVRPOB     FRPOB                           CEU004
     C                     ENDIF                                          CEU004
     C********** VRPOC     IFEQ *ZEROS                                                 CEU004 CSD027
     C           VRPOC     IFEQ *BLANKS                                                       CSD027
     C                     MOVE *BLANKS   FRPOC                           CEU004
     C                     ELSE                                           CEU004
     C                     MOVELVRPOC     FRPOC                           CEU004
     C                     ENDIF                                          CEU004
     C                     MOVELVRRCR     FRRCR                           CEU004
     C                     MOVELVRRCA     FRRCA                           CEU004
     C                     MOVELVRRVN     FRRVN                           CEU004
     C                     MOVELVRAWB     FRAWB                           CEU004
     C                     MOVELVRAWA     FRAWA                           CEU004
     C                     MOVELVRBEN     FRBEN                           CEU004
     C                     MOVELVRBNA     FRBNA                           CEU004
     C                     MOVELVRDP1     FRDP1                           CEU004
     C                     MOVELVRDP2     FRDP2                           CEU004
     C                     MOVELVRDP3     FRDP3                           CEU004
     C                     MOVELVRDP4     FRDP4                           CEU004
     C                     MOVELVRDCH     FRDCH                           CEU004
     C                     MOVELVRBB1     FRBB1                           CEU004
     C                     MOVELVRBB2     FRBB2                           CEU004
     C                     MOVELVRBB3     FRBB3                           CEU004
     C                     MOVELVRBB4     FRBB4                           CEU004
     C                     MOVELVRBB5     FRBB5                           CEU004
     C                     MOVELVRBB6     FRBB6                           CEU004
     C                     MOVELVRCVM     FRCVM                           CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELVRRSC     FRRSC                           CEU004
     C                     MOVELVRPSC     FRPSC                           CEU004
     C                     MOVELVRICY     FRICY                           CEU004
     C                     ENDIF                                          CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELVRRSC     FRRSC                                               CLE031
     C                     MOVELVRRSR     FRRSR                                               CLE031
     C                     MOVELVRRSI     FRRSI                                               CLE031
     C                     MOVELVRPSC     FRPSC                                               CLE031
     C                     MOVELVRPSR     FRPSR                                               CLE031
     C                     MOVELVRPSI     FRPSI                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF
      *
      **  Test harness message tag.
      *
     C                     MOVE *BLANKS   RMSV
     C                     MOVE *BLANKS   RMID
     C                     MOVE *BLANKS   RMTX
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRTAUT  -  Update Test Harness file for Authorise action      *
      * Called by: SRUROL - Process update of rollover record         *
      * Calls    : None                                               *
      *****************************************************************
     C           SRTAUT    BEGSR
      *
      **  Date and time stamps
      *
     C                     Z-ADDBJRDNB    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE *BLANKS   W1DTE8
     C                     MOVELZDATE     W1DTE6
     C                     MOVE W1DTE2    WTDT1
     C                     MOVE W3DTE4    WTDT2
     C                     MOVE W5DTE6    WTDT3
     C                     MOVE WTDAT     DTST
      *
     C                     TIME           WTIME
     C                     MOVE WTIM1     WTTM1
     C                     MOVE WTIM2     WTTM2
     C                     MOVE WTIM3     WTTM3
     C                     MOVE WTTIM     TMST
      *
      **  Key detail screen fields.
      *
     C                     MOVELSLOAN     FLNRF
     C                     MOVELSACTN     FACTN
     C                     MOVELSCUST     CNMR
      *
      **  User details.
      *
     C           SACTN     IFEQ 'A'
     C           RSTS      IFEQ *BLANK
     C                     MOVELSUSER     FRIUS
     C                     ENDIF
     C                     MOVELSUSER     FRAUS
     C                     ENDIF
     C           SACTN     IFEQ 'X'
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVELSUSER     FRXUS
     C                     ENDIF
      *
      **  Test harness message tag.
      *
     C                     MOVE *BLANKS   RMSV
     C                     MOVE *BLANKS   RMID
     C                     MOVE *BLANKS   RMTX
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRPOMP  -  Process Outgoing message parameter                 *
      * Called by: SRBTCH - Batch processing                          *
      *            ZASNMS - Sends messages to the program's msg que   *
      *            *PSSR  - Program exception error routine           *
      * Calls    : None                                               *
      *****************************************************************
     C           SRPOMP    BEGSR
      *
     C                     CLEARPOUTP
     C                     MOVELWTYPE     POTYPE
     C                     MOVELWTUSR     POTUSR
     C                     MOVELWTWID     POTWID
     C                     MOVELWTREF     POTREF
     C                     MOVELWTSEQ     POTSEQ
     C                     MOVELSACTN     POACTN
     C                     MOVELWTDST     POTDST
     C                     MOVELWTTST     POTTST
     C                     MOVELWPARR     POPARR
     C                     MOVELSLOAN     POLNRF
      *                                                                                     AR868380
     C           ZAMSVR    IFEQ 'D'                                                         AR868380
     C                     CALL 'Y2RVMGC'                                                   AR868380
     C                     PARM           PRTCD                                             AR868380
     C                     PARM           ZAMSID                                            AR868380
     C                     PARM           ZAMSGF                                            AR868380
     C                     PARM           ZAMSDA                                            AR868380
     C                     PARM           ZAMSTX                                            AR868380
      *                                                                                     AR868380
     C           ZAMSID    IFNE *BLANK                                                      AR868380
     C                     MOVE ZAMSVR    PORMSV                                            AR868380
     C                     MOVELZAMSID    PORMID                                            AR868380
     C                     MOVELZAMSTX    PORMTX                                            AR868380
     C                     ENDIF                                                            AR868380
     C                     ENDIF                                                            AR868380
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRCURR  -  Get Currency Details                               *
      * Called by: SRMOVR - More Rollover details to display fields   *
      *            SRVDET - Validation of detail screen               *
      *            SRLTRX - Update LTRIX header and detail records    *
      * Calls    : None                                               *
      *****************************************************************
     C           SRCURR    BEGSR
      *
      **  No need to access currency file if current details are the same.
      *
     C                     MOVE *BLANKS   PRTCD
     C           PCURR     IFNE A6CYCD
      *
     C                     CALL 'AOCURRR0'
     C                     PARM           PRTCD
     C                     PARM '*KEY    'POPTN
     C                     PARM           PCURR   3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           PRTCD     IFNE *BLANKS
     C           EDBAS     ANDEQ*ON
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADDDBASE     DBASE            * DBERR XX *
     C                     MOVELPCURR     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRCUST  -  Get Customer Details                               *
      * Called by: SRVCUS - Validation of loan customer               *
      * Calls    : None                                               *
      *****************************************************************
     C           SRCUST    BEGSR
      *
      **  No need to access customer file if current details are the same.
      **  PERRA equal to *ON allows dbase error in this routine.
      *
     C                     MOVELPCUST     WCNUM   6
     C                     MOVE PERRA     PERRA   1
     C                     MOVE *BLANKS   PRTCD
     C           WCNUM     IFNE BBCUST
     C           PCUST     ANDNEBBCSSN
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM           PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PCUST  10
     C                     PARM *BLANKS   PKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           PRTCD     IFNE *BLANK
     C           PERRA     ANDEQ*ON
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCUSTPD'DBFILE           ************
     C                     Z-ADDDBASE     DBASE            * DBERR XX *
     C                     MOVELPCUST     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C/COPY WNCPYSRC,LE2070C010
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT                                                              144915
      *************************************************************144915 166578
      **SRACCT**-**Get*Account*Details*****************************144915 166578
      **Called*by:*SRRXST*-*Redefaulting*the*extended*settlement***144915 166578
      **Calls****:*None********************************************144915 166578
      *************************************************************144915 166578
     C***********SRACCT    BEGSR                                   144915 166578
      ***********                                                  144915 166578
     C***********          MOVE 'N'       W@FND   1                144915 166578
      ***********                                                  144915 166578
     C***********          CALL 'AOACCTR0'                         144915 166578
     C***********          PARM *BLANKS   W@RTCD  7                144915 166578
     C***********          PARM '*KEY   ' W@OPTN  7                144915 166578
     C***********          PARM           W@RETL 10                144915 166578
     C***********          PARM           W@CNUM  6                144915 166578
     C***********          PARM           W@CYCD  3                144915 166578
     C***********          PARM           W@ACOD  4                144915 166578
     C***********          PARM           W@ACSQ  2                144915 166578
     C***********          PARM           W@BRCA  3                144915 166578
     C***********SDACNT    PARM SDACNT    DSSDY                    144915 166578
      ***********                                                  144915 166578
     C***********W@RTCD    IFEQ *BLANK                             144915 166578
     C***********          MOVE 'Y'       W@FND   1                144915 166578
     C***********          ENDIF                                   144915 166578
      ***********                                                  144915 166578
     C***********          ENDSR                                   144915 166578
      /EJECT
      *****************************************************************
      * SRSTAT  -  Determine Rollover Status Narrative                *
      * Called by: SRSFLD - Format subfile fields                     *
      *            SRMOVP - Move test harness fields to screen fields *
      *            SRMOVR - Move rollover loan details to screen      *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSTAT    BEGSR
      *
     C                     MOVE *BLANKS   ZAMSID                          123998
     C                     SELEC
     C           WRSTS     WHEQ 'C'
     C***********          MOVEASTS,1     WSTAT  16 P                     123998
     C                     MOVEL'LEV0003' ZAMSID                          123998
     C           WRSTS     WHEQ 'R'
     C***********          MOVEASTS,2     WSTAT     P                     123998
     C                     MOVEL'LEV0004' ZAMSID                          123998
     C           WRSTS     WHEQ 'A'
     C***********          MOVEASTS,3     WSTAT     P                     123998
     C                     MOVEL'LEV0005' ZAMSID                          123998
     C           WRSTS     WHEQ 'D'
     C***********          MOVEASTS,4     WSTAT     P                     123998
     C                     MOVEL'LEV0006' ZAMSID                          123998
     C           WRSTS     WHEQ 'Q'                                       CLE030
     C                     MOVEL'LEV0170' ZAMSID                          CLE030
     C                     OTHER
     C                     MOVE *BLANKS   WSTAT
     C                     ENDSL
     C           ZAMSID    IFNE *BLANKS                                   123998
     C                     EXSR SRTEXT                                    123998
     C                     MOVELZAMSTX    WSTAT  16 P                     123998
     C                     MOVE *BLANKS   ZAMSID                          123998
     C                     ENDIF                                          123998
      *
     C                     ENDSR
      /EJECT                                                              123998
      *****************************************************************   123998
      * SRTEXT  -  Set up text from message file                      *   123998
      * Called by: All subroutines setting of texts                   *   123998
      * Calls    : None                                               *   123998
      *****************************************************************   123998
     C           SRTEXT    BEGSR                                          123998
      *                                                                   123998
     C                     CALL 'Y2RVMGC'                                 123998
     C                     PARM *BLANKS   PRTCD                           123998
     C                     PARM           ZAMSID           Message Id.    123998
     C                     PARM           ZAMSGF           Message file.  123998
     C                     PARM           ZAMSDA           Message data.  123998
     C                     PARM           ZAMSTX           Messge text    123998
      *                                                                   123998
     C                     ENDSR                                          123998
      /EJECT
      *****************************************************************
      * SRVCUS  -  Validation of Loan Customer                        *
      * Called by: SRBTCH - Batch processing                          *
      *            SRPDET - Process Detail Screen                     *
      * Calls    : SRCUST - Get customer details                      *
      *****************************************************************
     C           SRVCUS    BEGSR
      *
      *
      **  Customer Number or Shortname * * * * * * * * * * * * * * * **
      *
     C                     MOVE *BLANKS   ERRMID  7
     C                     MOVE *OFF      *IN37
     C                     MOVE *OFF      ERRDET
      *
      **  Must not be blank.
     C                     SELEC
     C           SCUST     WHEQ *BLANKS
     C                     MOVEL'LEV0035' ERRMID
      *
      **  Must exist in the master file.
     C           SCUST     WHNE *BLANKS
     C                     MOVELSCUST     PCUST
     C                     MOVE *OFF      PERRA
     C                     EXSR SRCUST
     C                     MOVELPCUST     SCUST     P
     C           PRTCD     IFNE *BLANKS
     C                     MOVEL'LEV0035' ERRMID
     C           PRTCD     IFEQ '*NOSEL '
     C                     MOVE *BLANKS   SCUST
     C                     ENDIF
      *
      **  Must be same as the loan customer.
     C                     ELSE
     C**********           MOVELBBCUST    WCUST   60                                          CSD027
     C                     MOVELBBCUST    WCUST   6                                           CSD027
      *                                                                   165974
     C                     MOVE 'N'       WPPFL   1                       165974
     C           PTYP      IFEQ 64                                        165974
     C           PTYP      OREQ 65                                        165974
     C           PTYP      OREQ 68                                        165974
     C           PTYP      OREQ 71                                        165974
     C                     MOVE 'Y'       WPPFL                           165974
     C                     ENDIF                                          165974
      *                                                                   165974
     C***********WCUST     IFNE CNUM                                      169211
     C           WCUST     IFNE CNUML                                     169211
     C           WPPFL     ANDNE'Y'                                       165974
      *                                                                   165974
      ** For Parts Purchased, must be the same as the original borrower   165974
      ** if System Value LoanCustOriginPurch = 'O' - else, if System                          209026
      ** Value = 'P', should be the 'Purchased From' customer number.                         209026
      *                                                                   165974
     C           WCUST     ORNE OLNO                                      165974
     C           WPPFL     ANDEQ'Y'                                       165974
     C           PPCUST    ANDEQ'O'                                                           209026
     C           WCUST     ORNE CNUML                                                         209026
     C           WPPFL     ANDEQ'Y'                                                           209026
     C           PPCUST    ANDEQ'P'                                                           209026
      *                                                                   165974
     C                     MOVEL'LEV0104' ERRMID
     C                     ELSE
     C                     MOVELBBCUST    SCNUM
     C                     MOVELSCNUM     SCUST     P
     C                     ENDIF
     C                     ENDIF
     C                     ENDSL
      *
     C           ERRMID    IFNE *BLANKS
     C                     MOVE *ON       *IN37
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRVDET  -  Validation of Detail Screen                        *
      * Called by: SRBTCH - Batch processing                          *
      *            SRPDET - Process Detail Screen                     *
      * Calls    : SRRVFD - Define removable fields                   *
      *            SRCURR - Get currency details                      *
      *            SRRATE - Validation of exchange rate and amounts   *
      *            SRNDAM - Check new discount amt against calculated *
      *            SREXST - Process extended settlements screen       *
      *****************************************************************
     C           SRVDET    BEGSR
      *
      **  Initialise error indicators.
      *
     C                     MOVEAWA21      *IN,38
     C                     MOVEA'00000'   *IN,51
     C                     MOVEA'00'      *IN,62
     C                     MOVEA'00'      *IN,64                          123335
     C                     MOVE '0'       *IN23                                             AR847588
     C                     MOVE *OFF      *IN76                                               CLE036
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVE *OFF      *IN74                                               CAS001
     C                     ENDIF                                                              CAS001
     C                     MOVE *OFF      ERRDET
     C                     MOVE *OFF      SELDON
      *
      **  Define the first charater of removable fields.
      *
     C                     EXSR SRRVFD
      *                                                                   153667
      **  Access history to pick up the last rollovr date.                153667
      *                                                                   153667
     C           LNRF      SETGTLEHISTL1                                  153667
     C           LNRF      REDPELEHISTL1                 89               153667
      *                                                                   153667
     C           *IN89     IFEQ *OFF                                      153667
     C                     Z-ADD0         WIN89   10                      153667
     C                     ELSE                                           153667
     C                     Z-ADD1         WIN89                           153667
     C                     ENDIF                                          153667
      *
      **  Rollover Timing Details (Group A amendment).
      *
      **  Rollover Date * * * * * * * * * * * * * * * * * * * * * * * *
      *
     C           WRLDT1    IFNE '*'
     C                     MOVE *BLANKS   ERRMID
     C           SACTN     IFEQ 'A'                                       123857
     C                     TESTN          SRLDTB     85    *on means numeric
     C                     MOVE SRLDTB    ZDATE
     C                     ELSE                                           123857
     C                     TESTN          SRLDT      85    *on means numer123857
     C                     MOVE SRLDT     ZDATE                           123857
     C                     ENDIF                                          123857
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    WRLDT   50
      *
      **  Mandatory for Discount loans.
     C                     SELEC
     C           SRLDTB    WHEQ *BLANKS
     C           PTYP      ANDEQ63
     C           SACTN     ANDEQ'A'                                       123857
     C           SRLDTB    OREQ *BLANKS                                   122098
     C           PTYP      ANDEQ65                                        122098
     C           SACTN     ANDEQ'A'                                       123857
     C           SRLDTB    OREQ *BLANKS                                   122098
     C           PTYP      ANDEQ67                                        122098
     C           SACTN     ANDEQ'A'                                       123857
      *                                                                   123857
     C           SRLDT     OREQ *BLANKS                                   123857
     C           PTYP      ANDEQ63                                        123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SRLDT     OREQ *BLANKS                                   123857
     C           PTYP      ANDEQ65                                        123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SRLDT     OREQ *BLANKS                                   123857
     C           PTYP      ANDEQ67                                        123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SRLDT     OREQ *BLANKS                                   CLE030
     C           PTYP      ANDEQ63                                        CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           SRLDT     OREQ *BLANKS                                   CLE030
     C           PTYP      ANDEQ65                                        CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           SRLDT     OREQ *BLANKS                                   CLE030
     C           PTYP      ANDEQ67                                        CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     MOVEL'LEV0464' ERRMID
      *
      **  If rollover date is blank, frequency code and day number
      **  must be both blank.
     C           SRLDTB    WHEQ *BLANKS
     C           SRLFQB    ANDNE*BLANKS
     C           SACTN     ANDEQ'A'                                       123857
     C           SRLDTB    OREQ *BLANKS
     C           SRLDYB    ANDNE*BLANKS
     C           SACTN     ANDEQ'A'                                       123857
      *                                                                   123857
     C           SRLDT     OREQ *BLANKS                                   123857
     C           SRLFQ     ANDNE*BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SRLDT     OREQ *BLANKS                                   123857
     C           SRLDY     ANDNE*BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SRLDT     OREQ *BLANKS                                   CLE030
     C           SRLFQ     ANDNE*BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           SRLDT     OREQ *BLANKS                                   CLE030
     C           SRLDY     ANDNE*BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     MOVEL'LEV0285' ERRMID
      *                                                                   158267
      ** Mandatory for multi-ccy rollover                                 158267
      *                                                                   158267
     C           SRLDTB    WHEQ *BLANKS                                   158267
     C           SRLDT     ANDEQ*BLANKS                                   158267
     C           MULTIC    ANDEQ*ON                                       158267
     C           SNCCYB    ANDNE*BLANKS                                   158267
     C           SACTN     ANDEQ'A'                                       158267
      *                                                                   158267
     C           SRLDT     OREQ *BLANKS                                   158267
     C           MULTIC    ANDEQ*ON                                       158267
     C           SNCCY     ANDNE*BLANKS                                   158267
     C           SACTN     ANDEQ'X'                                       158267
      *                                                                   CLE030
     C           SRLDT     OREQ *BLANKS                                   CLE030
     C           MULTIC    ANDEQ*ON                                       CLE030
     C           SNCCY     ANDNE*BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     MOVEL'LEV1044' ERRMID                          158267
      *
      **  Must be numeric.
     C           SRLDTB    WHNE *BLANKS
     C           *IN85     ANDEQ*OFF
     C           SACTN     ANDEQ'A'                                       123857
     C           SRLDT     ORNE *BLANKS                                   123857
     C           *IN85     ANDEQ*OFF                                      123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SRLDT     ORNE *BLANKS                                   CLE030
     C           *IN85     ANDEQ*OFF                                      CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVEL'LEV0151' ERRMID
      *
      **  Must be in valid format.
     C           SRLDTB    WHNE *BLANKS
     C           SACTN     ANDEQ'A'                                       123857
     C           SRLDT     ORNE *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SRLDT     ORNE *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           *IN99     IFEQ *ON
     C                     MOVEL'LEV0151' ERRMID
     C                     ELSE
      *
      **  Must be same as Maturity date for Discount loans.
     C                     SELEC
     C           PTYP      WHEQ 63
     C           PTYP      OREQ 65                                        122098
     C           PTYP      OREQ 67                                        122098
     C           WRLDT     IFNE MDAT
     C                     MOVEL'LEV0464' ERRMID
     C                     ENDIF
      *
      **  Must be greater than value date and
      **  less than maturity date if S01465 is *OFF, or
      **  less than or equal to maturity date if S01465 is *ON.
      **  less than or equal to facility expiry date for a call loan      144688
      **  with no maturity date                                           144688
     C           WRLDT     WHLE VDAT
     C           CLE003    ANDEQ'N'                                       CLE003
     C           WRLDT     ORLT VDAT                                      CLE003
     C           CLE003    ANDEQ'Y'                                       CLE003
     C           WRLDT     ORGE MDAT
     C           *IN60     ANDEQ*OFF
     C           MDAT      ANDNE0                                         144688
     C           WRLDT     ORGT MDAT
     C           *IN60     ANDEQ*ON
     C           MDAT      ANDNE0                                         144688
     C           WRLDT     ORGT DTEX                                      144688
     C           PTYP      ANDEQ61                                        144688
     C           MDAT      ANDEQ0                                         144688
      *                                                                   144688
     C           WRLDT     ORGT DTEX                                      144688
     C           PTYP      ANDEQ68                                        144688
     C           MDAT      ANDEQ0                                         144688
      *                                                                   144688
     C           WRLDT     ORGT DTEX                                      144688
     C           PTYP      ANDEQ69                                        144688
     C           MDAT      ANDEQ0                                         144688
      *                                                                   144688
     C                     MOVEL'LEV0152' ERRMID
      *
      **  Must be greater than or equal to run date if original entry date
      **  is less than run date.
     C********** ORED      WHLT BJRDNB                                    CSC011
     C********** WRLDT     ANDLTBJRDNB                                    CSC011
     C           ORED      WHLT WRNDAY                                    CSC011
     C           WRLDT     ANDLTWRNDAY                                    CSC011
     C           CLE003    ANDEQ'N'                                       CLE003
     C                     MOVEL'LEV0275' ERRMID
      *
      **  Amended rollover date must be greater than or equal to
      **  run date if initial rollover date is less than run date.
     C********** RLDT      WHLT BJRDNB                                    CSC011
     C********** WRLDT     ANDLTBJRDNB                                    CSC011
     C           RLDT      WHLT WRNDAY                                    CSC011
     C           WRLDT     ANDLTWRNDAY                                    CSC011
     C           CLE003    ANDEQ'N'                                       CLE003
     C                     MOVEL'LEV0275' ERRMID
      *
      **  If rollover frequency code not entered, check that
      **  rollover date falls in the number of months specified
      **  for irregular rollovers on the facility to which the
      **  loan is linked.
      *                                                                   153667
     C           WIN89     IFEQ 0                                         153667
     C                     Z-ADDVDATH     ZINDT                           153667
     C                     ELSE                                           153667
     C                     Z-ADDVDAT      ZINDT                           153667
     C                     ENDIF                                          153667
      *                                                                   153667
     C           SRLFQB    WHEQ *BLANKS
     C           SACTN     ANDEQ'A'                                       123857
     C           SRLFQ     OREQ *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SRLFQ     OREQ *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           'Z'       SCAN RTPS                     85               123123
     C           *IN85     IFEQ *ON                                       123123
     C***********          Z-ADDVDAT      ZINDT                           153667
     C                     Z-ADD*ZEROS    ZNYR
     C                     Z-ADDRLPD      ZNMN
     C                     Z-ADD*ZEROS    ZNDY
     C           RLPD      IFNE 0                                         153667
     C                     EXSR ZCPD
     C                     ENDIF                                          153667
     C           WRLDT     IFGT ZPDNO
     C           RLPD      ANDNE0                                         153667
     C                     MOVEL'LEV1039' ERRMID
     C                     ENDIF
     C                     ENDIF                                          123123
     C                     ENDSL
     C                     ENDIF
      *
      **  If Next Rollover Date on file is not to be amended,
      **  amended rollover date should be earlier.
     C           SNRODB    WHEQ *BLANKS
     C           SRLDTB    ANDNE*BLANKS
     C           WRLDT     ANDGENROD
     C           SACTN     ANDEQ'A'                                       123857
     C                     MOVEL'LEV0289' ERRMID
     C                     ENDSL
      *
      **  It the value date is less than the run date, the new            CLE003
      **  Rollover date should be greater than or equal to the last       CLE003
      **  Rollover date.                                                  CLE003
     C**  N.B. Last Rollover Date must be obtained from the most          152349
     C**  recent "RO" record on HISTSHQ, if it exists. (VDAT check        152349
     C**  is redundant since covered by existence check.)                 152349
      **                                                                  CLE003
     C           CLE003    IFEQ 'Y'                                       CLE003
     C           ERRMID    ANDEQ*BLANKS                                   CLE003
     C           SRLDTB    ANDNE*BLANK                                    CLE003
     C***********LNRF      SETGTLEHISTL1                            152349153667
     C***********LNRF      REDPELEHISTL1                 89         152349153667
     C************IN89     IFEQ *OFF                                152349153667
     C           WIN89     IFEQ 0                                         152349
     C           WRLDT     ANDLTVDATH                                     152349
     C           WRLDT     ORLE LMCD                                                          203095
     C***********VDAT      ANDLTBJRDNB                              CLE003152349
     C***********WRLDT     ANDLTLRLD                                CLE003152349
     C                     MOVEL'LEV1040' ERRMID                          CLE003
     C                     Z-ADDVDATH     ZDAYNO                          152349
     C                     EXSR ZDATE2                                    152349
     C                     MOVE ZADATE    O#LROL  7                       152349
     C                     MOVELO#LROL    ZAMSDA                          152349
     C                     ENDIF                                          CLE003
     C                     ENDIF                                          152349
      *                                                                   CLE003
     C           ERRMID    IFNE *BLANKS
     C                     MOVE *ON       *IN38
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C           SRLDTB    IFNE *BLANKS
     C                     MOVE SRLDTB    SRLDTB
     C                     Z-ADDWRLDT     VRLDT
     C                     ENDIF
     C           SRLDT     IFNE *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C                     Z-ADDWRLDT     VRLDT                           123857
     C                     ENDIF                                          123857
     C           SRLDT     IFNE *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     Z-ADDWRLDT     VRLDT                           CLE030
     C                     ENDIF                                          CLE030
     C                     ENDIF
     C                     ENDIF
      *
      **  Validate remove request on rollover timing details.
      *
      **  Remove values of fields as requested.
     C           WRLDT1    IFEQ '*'
     C           WRLFQ1    ANDEQ'*'
     C           WRLDY1    ANDEQ'*'
      *                                                                   158267
      ** If new ccy is not equal to blanks and rollover date is to be     158267
      ** removed, multi-ccy details should also be removed.               158267
      *                                                                   158267
     C           SNCCY     IFEQ *BLANKS                                   158267
     C                     Z-ADD*ZEROS    VRLDT
     C                     MOVE *BLANK    VRLFQ
     C                     Z-ADD*ZEROS    VRLDY
      *                                                                                       CLE023
     C           *IN67     IFEQ *ON                                                           CLE023
     C           SNFCE     ANDNE*BLANKS                                                       CLE023
     C           WNFCE1    IFEQ '*'                                                           CLE023
     C           WNFMD1    ANDEQ'*'                                                           CLE023
      *                                                                                       CLE023
     C                     ELSE                                                               CLE023
     C                     MOVEA'11'      *IN,53                                              CLE023
     C                     MOVE *ON       ERRDET                                              CLE023
     C                     MOVEL'LEV1061' ZAMSID                                              CLE023
     C                     EXSR ZASNMS                                                        CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     ELSE                                           158267
     C           WNCCY1    IFEQ '*'                                       158267
     C           WNCPA1    ANDEQ'*'                                       158267
     C           WNFCE1    ANDEQ'*'                                       158267
     C           WNFMD1    ANDEQ'*'                                       158267
     C           WNBCE1    ANDEQ'*'                                       158267
     C           WNBMD1    ANDEQ'*'                                       158267
     C           WNLRA1    ANDEQ'*'                                       158267
     C                     Z-ADD*ZEROS    VRLDT                           158267
     C                     MOVE *BLANK    VRLFQ                           158267
     C                     Z-ADD*ZEROS    VRLDY                           158267
     C                     MOVE *BLANKS   VNCCY                           158267
     C                     Z-ADD*ZEROS    VNCPA                           158267
     C                     Z-ADD*ZEROS    VNFCE                           158267
     C                     MOVE *BLANK    VNFMD                           158267
     C                     Z-ADD*ZEROS    VNBCE                           158267
     C                     MOVE *BLANK    VNBMD                           158267
     C                     Z-ADD*ZEROS    VNLRA                           158267
     C                     ELSE                                           158267
     C                     MOVEA'111'     *IN,38                          158267
     C                     MOVEA'11111'   *IN,51                          158267
     C                     MOVEA'11'      *IN,64                          158267
     C                     MOVE *ON       ERRDET                          158267
     C                     MOVEL'LEV1045' ZAMSID                          158267
     C                     EXSR ZASNMS                                    158267
     C                     ENDIF                                          158267
     C                     ENDIF                                          158267
      *
      **  If a '*' is in the first position of Rollover date, then
      **  Rollover frequency code and day number should also
      **  have '*'s in its first positions.
     C                     ELSE
     C           WRLDT1    IFNE '*'
     C           WRLFQ1    ANDNE'*'
     C           WRLDY1    ANDNE'*'
     C                     ELSE
     C                     MOVEA'111'     *IN,38
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV0284' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *                                                                   CLE014
      ** Rollover date must not be followed by any principal increases,   CLE014
      ** manual repayments or repayment schedules falling due prior to    CLE014
      ** the next working day in local currency after the rollover date   CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
      *                                                                   CLE014
     C           MULTIC    IFEQ *ON                                       CLE014
     C           *IN85     ANDEQ*ON                                       CLE014
      *                                                                   CLE014
     C                     Z-ADDWRLDT     ZDAYNO                          CLE014
     C                     MOVE BJLCCY    ZCCY                            CLE014
     C                     MOVE *BLANKS   ZLOC                            CLE014
     C                     Z-ADD1         ZNRDYS                          CLE014
     C                     EXSR ZFWDT                                     CLE014
      *                                                                   CLE014
     C                     Z-ADDWRLDT     AVDAT                           CLE014
     C           WLOAM     SETGTLELOAML0                                  CLE014
     C                     READ LELOAML0                 85               CLE014
      *                                                                   CLE014
     C           *IN85     DOWEQ*OFF                                      CLE014
     C           LNRF      ANDEQLNRFA                                     CLE014
      *                                                                   CLE014
     C           AMTP      IFEQ 'RE'                                      CLE014
     C           AMTP      OREQ 'PI'                                      CLE014
     C           AMTP      OREQ 'MR'                                      CLE014
     C           AMTP      OREQ 'PF'                                      CLE014
     C           AMTP      OREQ 'PT'                                      CLE014
      *                                                                   CLE014
     C           VDATA     IFGT WRLDT                                     CLE014
     C           VDATA     ANDLTZDYNBR                                    CLE014
     C           SNCCYB    ANDNE*BLANKS                                   CLE014
     C                     MOVE *ON       *IN38                           CLE014
     C                     MOVE *ON       ERRDET                          CLE014
     C                     MOVEL'LEV0027' ZAMSID                          CLE014
     C                     EXSR ZASNMS                                    CLE014
     C                     LEAVE                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C********** WRLDT     IFLT BJRDNB                             CLE014 CSC011
     C           WRLDT     IFLT WRNDAY                                    CSC011
     C           SNCCYB    ANDNE*BLANKS                                   CLE014
     C                     MOVE *ON       *IN38                           CLE014
     C                     MOVE *ON       ERRDET                          CLE014
     C                     MOVEL'LEV0028' ZAMSID                          CLE014
     C                     EXSR ZASNMS                                    CLE014
     C                     LEAVE                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     READ LELOAML0                 85               CLE014
      *                                                                   CLE014
     C                     ENDDO                                          CLE014
      *                                                                   CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ENDIF                                          CLE014
      *                                                                                       CLE023
      ** Validate if rollover on FCXR can be inserted or deleted if                           CLE023
      ** CLE023 is installed and facility is multi-currency and no                            CLE023
      ** error on validation of rollover date                                                 CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           MCCY      ANDEQ'Y'                                                           CLE023
     C           *IN38     ANDEQ'0'                                                           CLE023
     C                     EXSR SRVFXR                                                        CLE023
      *                                                                                       CLE023
      ** Do not allow if backvalued rollover on FCXR cannot be entered,                       CLE023
      ** and if rollover date was changed to be earlier than rundate and                      CLE023
      ** new facility exchange rate already exist                                             CLE023
      *                                                                                       CLE023
     C           WFCXRA    IFEQ 'N'                                                           CLE023
     C           RLDT      ANDNEWRLDT                                                         CLE023
     C           RLDT      ANDNE*ZERO                                                         CLE023
     C           WRLDT1    ANDNE'*'                                                           CLE023
     C           WRLDT     ANDLTBJRDNB                                                        CLE023
     C           NFCE      ANDNE*ZEROS                                                        CLE023
     C           SNFCEB    ANDEQ*BLANKS                                                       CLE023
     C                     MOVE '1'       *IN38                                               CLE023
     C                     MOVE *ON       ERRDET                                              CLE023
      *                                                                                       219403
      ** 'See second level text' should not appear on Loan Manager.                           219403
     C           PMODE     IFEQ 'B'                                                           219403
     C                     MOVEL'LEV9004' ZAMSID                                              219403
     C                     ELSE                                                               219403
     C                     MOVEL'LEV1059' ZAMSID                                              CLE023
     C                     ENDIF                                                              219403
      *                                                                                       219403
     C                     EXSR ZASNMS                                                        CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE030
      ** Rollover Date Validation required for CLE030                                         CLE030
      *                                                                                       CLE030
     C           CLE030    IFEQ 'Y'                                                           CLE030
      *                                                                                       CLE030
      ** When action is 'A' and Rollover date is after the last availablility                 CLE030
      ** date for the facility but before the facility expiry date.                           CLE030
      *                                                                                       CLE030
     C                     MOVE *OFF      ERRDET                                              CLE030
      *                                                                                       CLE030
     C           SACTN     IFEQ 'A'                                                           CLE030
     C           WRLDT     ANDNE0                                                             CLE030
     C           WRLDT     ANDLTDTEX                                                          CLE030
     C           WRLDT     ANDGTAVLD                                                          CLE030
     C           W#RDLT    ANDNEWRLDT                                                         CLE030
     C           SACTN     OREQ 'X'                                                           CLE030
     C           WRLDT     ANDNE0                                                             CLE030
     C           WRLDT     ANDLTDTEX                                                          CLE030
     C           WRLDT     ANDGTAVLD                                                          CLE030
     C           W#RDLT    ANDNEWRLDT                                                         CLE030
     C                     Z-ADDWRLDT     W#RDLT  50                                          CLE030
     C           SACTN     IFEQ 'X'                                                           CLE030
     C                     MOVE 'Q'       W#RSTS                                              CLE030
     C                     ENDIF                                                              CLE030
     C                     MOVE *ON       ERRDET                                              CLE030
     C                     MOVEL'LEV0172' ZAMSID                                              CLE030
     C                     EXSR ZASNMS                                                        CLE030
     C                     ENDIF                                                              CLE030
      *                                                                                       CLE030
     C                     ENDIF                                                              CLE030
      *
      **  Rollover Frequency Code * * * * * * * * * * * * * * * * * * *
      *
     C           WRLFQ1    IFNE '*'
     C           *IN38     ANDEQ*OFF
     C                     MOVE *BLANKS   ERRMID
     C           SACTN     IFEQ 'A'                                       123857
     C           SRLFQB    LOKUPFTAB                     85*on means found
     C           *IN85     IFEQ *ON
     C           SRLFQB    SCAN RTPS                     85*on means found
     C                     ENDIF
     C                     ELSE                                           123857
     C           SRLFQ     LOKUPFTAB                     85*on means found123857
     C           *IN85     IFEQ *ON                                       123857
     C           SRLFQ     SCAN RTPS                     85*on means found123857
     C                     ENDIF                                          123857
     C                     ENDIF                                          123857
      *
      **  Rollover frequency code is forbidden for Discount loan.
     C                     SELEC
     C           PTYP      WHEQ 63
     C           SRLFQB    ANDNE*BLANKS
     C           SACTN     ANDEQ'A'                                       123857
     C           PTYP      OREQ 65                                        122098
     C           SRLFQB    ANDNE*BLANKS                                   122098
     C           SACTN     ANDEQ'A'                                       123857
     C           PTYP      OREQ 67                                        122098
     C           SRLFQB    ANDNE*BLANKS                                   122098
     C           SACTN     ANDEQ'A'                                       123857
      *                                                                   123857
     C           PTYP      OREQ 63                                        123857
     C           SRLFQ     ANDNE*BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           PTYP      OREQ 65                                        123857
     C           SRLFQ     ANDNE*BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           PTYP      OREQ 67                                        123857
     C           SRLFQ     ANDNE*BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           PTYP      OREQ 63                                        CLE030
     C           SRLFQ     ANDNE*BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           PTYP      OREQ 65                                        CLE030
     C           SRLFQ     ANDNE*BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           PTYP      OREQ 67                                        CLE030
     C           SRLFQ     ANDNE*BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     MOVEL'LEV0467' ERRMID
      *
      **  Must be a valid frequency code.
      **  It can be blank, a '*' or 'M', 'Q', 'X' or 'Y'
      **  unless not specified in the facility to which
      **  the loan is linked.
     C           SRLFQB    WHNE *BLANKS
     C           *IN85     ANDEQ*OFF
     C           SACTN     ANDEQ'A'                                       123857
     C           SRLFQ     ORNE *BLANKS                                   123857
     C           *IN85     ANDEQ*OFF                                      123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SRLFQ     ORNE *BLANKS                                   CLE030
     C           *IN85     ANDEQ*OFF                                      CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     MOVEL'LEV0055' ERRMID
     C                     ENDSL
      *
     C           ERRMID    IFNE *BLANKS
     C                     MOVE *ON       *IN39
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C           SRLFQB    IFNE *BLANK
     C                     MOVE SRLFQB    VRLFQ
     C                     ENDIF
     C           SRLFQ     IFNE *BLANK                                    123857
     C           SACTN     ANDEQ'X'                                       123857
     C                     MOVE SRLFQ     VRLFQ                           123857
     C                     ENDIF                                          123857
      *                                                                   CLE030
     C           SRLFQ     IFNE *BLANK                                    CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVE SRLFQ     VRLFQ                           CLE030
     C                     ENDIF                                          CLE030
      *                                                                   CLE030
     C                     ENDIF
     C                     ENDIF
      *
      **  Rollover Frequency Day Number * * * * * * * * * * * * * * * *
      *
     C           WRLDY1    IFNE '*'
     C           *IN38     ANDEQ*OFF
     C                     MOVE *BLANKS   ERRMID
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVE SRLDYB    WRLDY   20
     C                     TESTN          SRLDYB     85    *on means numeric
     C                     ELSE                                           123857
     C                     MOVE SRLDY     WRLDY   20                      123857
     C                     TESTN          SRLDY      85    *on means numer123857
     C                     ENDIF                                          123857
      *
      **  Rollover frequency day number is forbidden for Discount loan.
     C                     SELEC
     C           PTYP      WHEQ 63
     C           SRLDYB    ANDNE*BLANKS
     C           SACTN     ANDEQ'A'                                       123857
     C           PTYP      OREQ 65                                        122098
     C           SRLDYB    ANDNE*BLANKS                                   122098
     C           SACTN     ANDEQ'A'                                       123857
     C           PTYP      OREQ 67                                        122098
     C           SRLDYB    ANDNE*BLANKS                                   122098
     C           SACTN     ANDEQ'A'                                       123857
      *                                                                   123857
     C           PTYP      OREQ 63                                        123857
     C           SRLDY     ANDNE*BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           PTYP      OREQ 65                                        123857
     C           SRLDY     ANDNE*BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           PTYP      OREQ 67                                        123857
     C           SRLDY     ANDNE*BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           PTYP      OREQ 63                                        CLE030
     C           SRLDY     ANDNE*BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           PTYP      OREQ 65                                        CLE030
     C           SRLDY     ANDNE*BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           PTYP      OREQ 67                                        CLE030
     C           SRLDY     ANDNE*BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     MOVEL'LEV0467' ERRMID
      *
      **  Rollover frequency day number is forbidden if code is blank.
     C           SRLFQB    WHEQ *BLANK
     C           SRLDYB    ANDNE*BLANKS
     C           SACTN     ANDEQ'A'                                       123857
     C           SRLFQ     OREQ *BLANK                                    123857
     C           SRLDY     ANDNE*BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SRLFQ     OREQ *BLANK                                    CLE030
     C           SRLDY     ANDNE*BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     MOVEL'LEV0286' ERRMID
      *
      **  Default to day no. of rollover date if frequency code is entered.
     C           VRLDT     WHNE *ZEROS
     C           VRLFQ     ANDNE*BLANK
     C           SRLDYB    ANDEQ*BLANKS
     C                     MOVE *BLANKS   W1DTE8
     C                     MOVELSRLDTB    W1DTE6
     C           BJDFIN    IFEQ 'D'
     C                     MOVELW1DTE2    SRLDYB
     C                     ELSE
     C                     MOVELW3DTE4    SRLDYB
     C                     ENDIF
     C                     MOVE SRLDYB    WRLDY
      *
      **  If entered, must be numeric within the range 01 to 31.
     C           SRLDYB    WHNE *BLANKS
     C           *IN85     ANDEQ*OFF
     C           SRLDYB    ORNE *BLANKS
     C           WRLDY     ANDLT01
     C           SRLDYB    ORNE *BLANKS
     C           WRLDY     ANDGT31
     C           SRLDY     ORNE *BLANKS                                   123857
     C           *IN85     ANDEQ*OFF                                      123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SRLDY     ORNE *BLANKS                                   123857
     C           WRLDY     ANDLT01                                        123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SRLDY     ORNE *BLANKS                                   123857
     C           WRLDY     ANDGT31                                        123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SRLDY     ORNE *BLANKS                                   CLE030
     C           *IN85     ANDEQ*OFF                                      CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           SRLDY     ORNE *BLANKS                                   CLE030
     C           WRLDY     ANDLT01                                        CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           SRLDY     ORNE *BLANKS                                   CLE030
     C           WRLDY     ANDGT31                                        CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     MOVEL'LEV0279' ERRMID
      *
      **  Calculate next rollover date
      **  and it must be less than maturity date.
     C           VRLDT     WHNE *ZEROS
     C           VRLFQ     ANDNE*BLANK
     C           *IN85     ANDEQ*ON
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVE SRLFQB    ZFREQ
     C                     ELSE                                           123857
     C                     MOVE SRLFQ     ZFREQ                           123857
     C                     ENDIF                                          123857
     C                     Z-ADDVRLDT     ZDAYNO
     C                     Z-ADDWRLDY     ZMDAY
     C                     MOVE CCY       ZCCY
     C                     EXSR ZFREQB
     C           ZZERR@    IFEQ '*ERROR '
     C           *LOCK     IN   LDA
     C                     MOVEL'ZFREQB  'DBFILE           ************
     C                     Z-ADD20        DBASE            * DBERR 20 *
     C                     MOVELZZERR@    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C           ZDAYNO    IFGT MDAT
     C           MDAT      ANDNE0                                         144688
     C           MDAT      OREQ 0                                         144688
     C           ZDAYNO    ANDGTDTEX                                      144688
     C                     MOVEL'LEV0054' ERRMID
     C                     MOVEA'11'      *IN,38
     C                     ENDIF
     C                     ENDIF
     C                     ENDSL
      *
     C           ERRMID    IFNE *BLANKS
     C                     MOVE *ON       *IN40
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C           SRLDYB    IFNE *BLANKS
     C                     MOVE SRLDYB    SRLDYB
     C                     Z-ADDWRLDY     VRLDY
     C                     ENDIF
     C           SRLDY     IFNE *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C                     Z-ADDWRLDY     VRLDY                           123857
     C                     ENDIF                                          123857
      *                                                                   CLE030
     C           SRLDY     IFNE *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     Z-ADDWRLDY     VRLDY                           CLE030
     C                     ENDIF                                          CLE030
      *                                                                   CLE030
     C                     ENDIF
     C                     ENDIF
      *
      **  Rollover Details (Group B amendment).
      *
      **  New Base Rate Code * * * * * * * * * * * * * * * * * * * * **
      *
     C           WNBRA1    IFNE '*'
     C                     MOVE *BLANKS   ERRMID
     C           SACTN     IFEQ 'A'                                       123857
     C**********           MOVE SNBRAB    WNBRA   20                                          CSD103
     C                     MOVE SNBRAB    WNBRA   2                                           CSD103
     C                     TESTN          SNBRAB     85    *on means numeric
     C                     ELSE                                           123857
     C**********           MOVE SNBRA     WNBRA   20                                   123857 CSD103
     C                     MOVE SNBRA     WNBRA   2                                           CSD103
     C                     TESTN          SNBRA      85    *on means numer123857
     C                     ENDIF                                          123857
      *
      **  Skip validation if field is blank and loan not currently
      **  attached to base rate.
     C                     SELEC
     C********** BRTT      WHEQ *ZEROS                                                        CSD103
     C           BRTT      WHEQ *BLANKS                                                       CSD103
     C           SNBRAB    ANDEQ*BLANKS
     C           SNBRA     ANDEQ*BLANKS                                   158487
      *                                                                                       CLE036
      ** If CLE036 is on, entry is prohibited if New base rate already exists                 CLE036
      *                                                                                       CLE036
     C           CLE036    WHEQ 'Y'                                                           CLE036
     C           SNBRAB    ANDNE*BLANKS                                                       CLE036
     C           SNBRTB    ANDNE*BLANKS                                                       CLE036
     C           WNBRT1    ANDNE'*'                                                           CLE036
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           SNBRAB    ANDNE*BLANKS                                                       CLE036
     C           SNBRT     ANDNE*BLANKS                                                       CLE036
     C           WNBRT1    ANDNE'*'                                                           CLE036
     C                     MOVEL'LEV1078' ERRMID                                              CLE036
      *
      ****Base*Rate*Change*Facility*should*be**ON*in*Customer*Lending*ICD.                  AR826115
      **  And it must be numeric.
     C********** BPBRCF    WHNE 'Y'                                                         AR826115
     C********** SNBRAB    ORNE *BLANKS                                                     AR826115
     C********** SNBRAB    WHNE *BLANKS                                            AR826115 MD034840
     C           BPBRCF    WHNE 'Y'                                                         MD034840
     C           SNBRAB    ORNE *BLANKS                                                     MD034840
     C           WNBRA1    ANDNE'?'
     C           *IN85     ANDEQ*OFF
     C           SACTN     ANDEQ'A'                                       123857
     C           SNBRA     ORNE *BLANKS                                   123857
     C           *IN85     ANDEQ*OFF                                      123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SNBRA     ORNE *BLANKS                                   CLE030
     C           *IN85     ANDEQ*OFF                                      CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     MOVEL'LEV0139' ERRMID
      *
      **  Must be a valid base rate code.
     C           SNBRAB    WHNE *BLANKS
     C           SNBRA     ORNE *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNBRA     ORNE *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           WNBRA1    IFEQ '?'
     C                     MOVE *ON       SELDON
     C                     ENDIF
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVE SNBRAB    PBRAT                           123857
     C                     ELSE                                           123857
     C                     MOVE SNBRA     PBRAT                           123857
     C                     ENDIF                                          123857
      *                                                                   127485
      * If multi-ccy validate against rollover currency for base          127485
      * rate.                                                             127485
      *                                                                   127485
     C           SNCCYB    IFEQ *BLANKS                                   127485
     C                     MOVE CCY       PCURR                           127485
     C                     MOVE CCY       W#CCY   3                       127485
     C                     ELSE                                           127485
     C                     MOVE SNCCYB    PCURR                           127485
     C                     MOVE SNCCYB    W#CCY                           127485
     C                     ENDIF                                          127485
      *                                                                   127485
      * In case of authorisation, use SNCCY (new currency)                189229
      *                                                                   189229
     C           SNCCY     IFNE *BLANKS                                   189229
     C           SACTN     ANDEQ'X'                                       189229
     C           SNCCY     ORNE *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVE SNCCY     PCURR                           189229
     C                     MOVE SNCCY     W#CCY   3                       189229
     C                     END                                            189229
      *                                                                   189229
     C                     CALL 'AOBSRTR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY    'POPTN
     C***********          PARM CCY       PCURR   3                       127485
     C***********          PARM SNBRAB    PBRAT   2                       123857
     C                     PARM           PCURR   3                       127485
     C                     PARM           PBRAT   2                       123857
     C********** SDBSRT    PARM SDBSRT    DSFDY                                 CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                                 CSD006
      *
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVELPBRAT     SNBRAB
     C                     ENDIF                                          123857
     C           PRTCD     IFNE *BLANKS
     C           BACYCD    ORNE W#CCY                                     127485
     C***********BACYCD    ORNE CCY                                       127485
     C           PRTCD     IFEQ '*NOSEL '
     C                     MOVE *BLANKS   SNBRAB
     C                     ELSE
     C                     MOVEL'LEV0139' ERRMID
     C                     ENDIF
     C                     ELSE
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVELBABSRC    SNBRAB
     C                     ENDIF                                          123857
     C                     MOVELBABSRC    WNBRA
      *
      **  Note: These details will be used later for
      **        validation of new discount amount.
     C**********           Z-ADDWNBRA     NBRA                                                CSD103
     C                     MOVE WNBRA     NBRA                                                CSD103
     C                     Z-ADDBANBRT    BASE
     C                     ENDIF
     C**********           ENDSL                                          191223
      *                                                                   191223
      ** If new base rate is not entered, check base rate and             191223
      ** new currency combination if new base rate or current             191223
      ** base rate from file is not zero.                                 191223
      *                                                                   191223
     C           SNBRAB    WHEQ *BLANKS                                   191223
     C           SACTN     ANDEQ'A'                                       191223
     C           SNBRA     ANDNE*BLANKS                                   191223
     C           SNBRAB    OREQ *BLANKS                                   191223
     C           SACTN     ANDEQ'A'                                       191223
     C********** BRTT      ANDNE*ZEROS                                                 191223 CSD103
     C           BRTT      ANDNE*BLANKS                                                       CSD103
      *                                                                   144916
      **  If base rate code is not entered, use the old one               144916
      ** Use new base rate from file if not blank. Otherwise              191223
      ** get the current base currency from file.                         191223
      *                                                                   144916
     C                     MOVE 'N'       WFLAG   1                       144916
     C********** SNBRAB    IFEQ *BLANKS                            144916 191223
     C********** BRTT      ANDNE*ZEROS                             144916 191223
     C********** SACTN     ANDEQ'A'                                144916 191223
      *                                                                   191223
     C           SNBRA     IFNE *BLANKS                                   191223
     C                     MOVE SNBRA     PBRAT                           191223
     C                     ELSE                                           191223
     C                     MOVE BRTT      PBRAT                           144916
     C                     ENDIF                                          191223
      *                                                                   144916
      * If multi-ccy validate against rollover currency for base          144916
      * rate.                                                             144916
      *                                                                   144916
     C           SNCCYB    IFEQ *BLANKS                                   144916
     C                     MOVE CCY       PCURR                           144916
     C                     MOVE CCY       W#CCY   3                       144916
     C                     ELSE                                           144916
     C                     MOVE SNCCYB    PCURR                           144916
     C                     MOVE SNCCYB    W#CCY                           144916
     C                     ENDIF                                          144916
      *                                                                   144916
     C                     CALL 'AOBSRTR0'                                144916
     C                     PARM *BLANKS   PRTCD                           144916
     C                     PARM '*KEY    'POPTN                           144916
     C                     PARM           PCURR   3                       144916
     C                     PARM           PBRAT   2                       144916
     C********** SDBSRT    PARM SDBSRT    DSFDY                     144916CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
      *                                                                   144916
     C           PRTCD     IFNE *BLANKS                                   144916
     C           BACYCD    ORNE W#CCY                                     144916
     C           PRTCD     IFEQ '*NOSEL '                                 144916
     C                     MOVE *BLANKS   SNBRAB                          144916
     C                     ELSE                                           144916
     C                     MOVEL'LEV0026' ZAMSID                          144916
     C                     MOVE *ON       ERRDET                          144916
     C                     MOVE *OFF      *IN28                           144916
     C**********           MOVE *OFF      *IN41                    144916 191223
     C                     MOVE *ON       *IN51                           144916
     C                     EXSR ZASNMS                                    144916
     C                     MOVE 'Y'       WFLAG                           144916
     C                     ENDIF                                          144916
     C                     ELSE                                           144916
     C**********           MOVELBABSRC    SNBRAB                   144916 191223
     C                     MOVELBABSRC    WNBRA                           144916
      *                                                                   144916
      **  Note: These details will be used later for                      144916
      **        validation of new discount amount.                        144916
      *                                                                   144916
     C**********           Z-ADDWNBRA     NBRA                                         144916 CSD103
     C                     MOVE WNBRA     NBRA                                                CSD103
     C                     Z-ADDBANBRT    BASE                            144916
     C                     ENDIF                                          144916
     C**********           ENDIF                                   144916 191223
     C                     ENDSL                                          191223
      *
     C           ERRMID    IFNE *BLANKS
     C                     MOVE *ON       *IN41
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C           SNBRAB    IFNE *BLANKS
     C           SNBRA     ORNE *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNBRA     ORNE *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVE WNBRA     VNBRA
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CLE036
      ** New Base Rate                                                                        CLE036
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
      *                                                                                       CLE036
     C           WNBRT1    IFNE '*'                                                           CLE036
     C                     MOVE *BLANKS   ERRMID                                              CLE036
      *                                                                                       CLE036
      ** Entry is prohibited if New Base Rate Code already exists                             CLE036
      *                                                                                       CLE036
     C                     SELEC                                                              CLE036
     C           SNBRTB    WHNE *BLANKS                                                       CLE036
     C           SNBRAB    ANDNE*BLANKS                                                       CLE036
     C           WNBRA1    ANDNE'*'                                                           CLE036
     C           SNBRTB    ORNE *BLANKS                                                       CLE036
     C           SNBRA     ANDNE*BLANKS                                                       CLE036
     C           WNBRA1    ANDNE'*'                                                           CLE036
     C                     MOVEL'LEV1076' ERRMID                                              CLE036
      *****************************************************************              CLE036 AR826115
      ***Base*Rate*Change*Facility*must*be*on**************************              CLE036 AR826115
      *****************************************************************              CLE036 AR826115
     C********** SNBRTB    WHNE *BLANKS                                              CLE036 AR826115
     C********** BPBRCF    ANDNE'Y'                                                  CLE036 AR826115
     C********** SNBRT     ORNE *BLANKS                                              CLE036 AR826115
     C********** BPBRCF    ANDNE'Y'                                                  CLE036 AR826115
     C**********           MOVEL'LEV1077' ERRMID                                     CLE036 AR826115
     C           SNBRTB    WHNE *BLANKS                                                     MD034840
     C           BPBRCF    ANDNE'Y'                                                         MD034840
     C           SNBRT     ORNE *BLANKS                                                     MD034840
     C           BPBRCF    ANDNE'Y'                                                         MD034840
     C                     MOVEL'LEV1077' ERRMID                                            MD034840
      *                                                                                       CLE036
      ** Must be numeric with at most 4 integers and 7 decimal places                         CLE036
      *                                                                                       CLE036
     C           SNBRTB    WHNE *BLANKS                                                       CLE036
     C           SACTN     ANDEQ'A'                                                           CLE036
     C           SNBRT     ORNE *BLANKS                                                       CLE036
     C           SACTN     ANDEQ'X'                                                           CLE036
     C                     MOVE *BLANKS   ZFIELD                                              CLE036
      *                                                                                       CLE036
     C           SACTN     IFEQ 'A'                                                           CLE036
     C                     MOVE SNBRTB    ZFIELD                                              CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE SNBRT     ZFIELD                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     Z-ADD7         ZADEC                                               CLE036
     C                     Z-ADD4         ZADIG                                               CLE036
     C                     EXSR ZALIGN                                                        CLE036
      *                                                                                       CLE036
     C           *IN99     IFEQ *ON                                                           CLE036
     C                     MOVEL'LEV1075' ERRMID                                              CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE ZFIELD    VNBRT                                               CLE036
     C                     MOVE ZFIELD    BASE                                                CLE036
     C                     Z-ADD7         ZADEC                                               CLE036
     C                     EXSR ZEDIT                                                         CLE036
     C           SACTN     IFEQ 'A'                                                           CLE036
     C                     MOVE ZFIELD    SNBRTB                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDSL                                                              CLE036
      *                                                                                       CLE036
     C           ERRMID    IFNE *BLANKS                                                       CLE036
     C                     MOVE *ON       *IN76                                               CLE036
     C                     MOVE *ON       ERRDET                                              CLE036
     C                     MOVELERRMID    ZAMSID                                              CLE036
     C                     EXSR ZASNMS                                                        CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
      *
      **  Validate remove request on rollover details.
      *
      **  Remove values of fields as requested.
     C                     MOVE *OFF      RMVINT  1
     C           WNBRA1    IFEQ '*'
     C           WNRTS1    ANDEQ'*'
     C           WNSIN1    ANDEQ'*'
     C           WNCAS1    ANDEQ'*'
     C           WNCHI1    ANDEQ'*'
     C           WRSGN1    ANDEQ'*'                                                         AR847588
     C********** CAS001    ANDEQ'N'                                                    CAS001 230541
     C           *IN73     ANDEQ*OFF                                                          230541
     C           CLE036    ANDEQ'N'                                                           CLE036
     C           WNBRA1    OREQ '*'                                                           CAS001
     C           WNRTS1    ANDEQ'*'                                                           CAS001
     C           WNSIN1    ANDEQ'*'                                                           CAS001
     C           WNCAS1    ANDEQ'*'                                                           CAS001
     C           WNCHI1    ANDEQ'*'                                                           CAS001
     C           WNFYLD    ANDEQ'*'                                                           CAS001
     C           WRSGN1    ANDEQ'*'                                                         AR847588
     C********** CAS001    ANDEQ'Y'                                                    CAS001 230541
     C           *IN73     ANDEQ*ON                                                           230541
     C           CLE036    ANDEQ'N'                                                           CLE036
     C           WNBRA1    OREQ '*'                                                           CLE036
     C           WNRTS1    ANDEQ'*'                                                           CLE036
     C           WNSIN1    ANDEQ'*'                                                           CLE036
     C           WNCAS1    ANDEQ'*'                                                           CLE036
     C           WNCHI1    ANDEQ'*'                                                           CLE036
     C           WNFYLD    ANDEQ'*'                                                           CLE036
     C           CAS001    ANDEQ'Y'                                                           CLE036
     C           WNBRT1    ANDEQ'*'                                                           CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C           WNBRA1    OREQ '*'                                                           CLE036
     C           WNRTS1    ANDEQ'*'                                                           CLE036
     C           WNSIN1    ANDEQ'*'                                                           CLE036
     C           WNCAS1    ANDEQ'*'                                                           CLE036
     C           WNCHI1    ANDEQ'*'                                                           CLE036
     C           WNBRT1    ANDEQ'*'                                                           CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C           CAS001    ANDEQ'N'                                                           CLE036
     C***********WNROD1    ANDEQ'*'                                       155907
     C**********           Z-ADD*ZEROS    VNBRA                                               CSD103
     C                     MOVE *BLANKS   VNBRA                                               CSD103
     C                     Z-ADD*ZEROS    VNRTS
     C                     MOVE *BLANK    VNSIN
     C                     Z-ADD*ZERO     VNCAS
     C                     MOVE *BLANK    VNCHI
     C***********          Z-ADD*ZERO     VNROD                           155907
     C                     MOVE *ON       RMVINT
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVE *BLANKS   VNFYLD                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     Z-ADD*ZEROS    VNBRT                                               CLE036
     C                     ENDIF                                                              CLE036
      *
      **  If a '*' is in the first position of New base rate code, then
      **  New spread/rate, New spread indicator, New interest calculation
      **  basis and New change indicator must have '*' in its first       155907
      **  positions.                                                      155907
      **  New Forward Yield Curve must also be deleted                                        CAS001
      **  New Base Rate must also have a '*' in its first position.                           CLE036
      ****basis,*New*change*indicator*and*Next*rollover*date***********   155907
      ****must*have*'*'s*in*its*first*positions.***********************   155907
     C                     ELSE
     C           WNBRA1    IFNE '*'
     C           WNBRT1    ANDNE'*'                                                           CLE036
     C           WNRTS1    ANDNE'*'
     C           WNSIN1    ANDNE'*'
     C           WNCAS1    ANDNE'*'
     C           WNCHI1    ANDNE'*'
     C           WRSGN1    ANDNE'*'                                                         AR847588
     C********** CAS001    ANDEQ'N'                                                    CAS001 230541
     C           *IN73     ANDEQ*OFF                                                          230541
     C           WNBRA1    ORNE '*'                                                           CAS001
     C           WNBRT1    ANDNE'*'                                                           CLE036
     C           WNRTS1    ANDNE'*'                                                           CAS001
     C           WNSIN1    ANDNE'*'                                                           CAS001
     C           WNCAS1    ANDNE'*'                                                           CAS001
     C           WNCHI1    ANDNE'*'                                                           CAS001
     C           WNFYLD    ANDNE'*'                                                           CAS001
     C           WRSGN1    ANDNE'*'                                                         AR847588
     C********** CAS001    ANDEQ'Y'                                                    CAS001 230541
     C           *IN73     ANDEQ*ON                                                           230541
     C***********WNROD1    ANDNE'*'                                       155907
     C                     ELSE
     C***********          MOVEA'111111'  *IN,41                          155907
     C                     MOVEA'11111'   *IN,41                          155907
     C                     MOVE '1'       *IN23                                             AR847588
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV0287' ZAMSID
     C                     EXSR ZASNMS
     C********** CAS001    IFEQ 'Y'                                                    CAS001 230541
     C           *IN73     IFEQ *ON                                                           230541
     C           WNFYLD    ANDNE'*'                                                           230541
     C                     MOVE *ON       *IN74                                               CAS001
     C                     MOVEL'LEV1058' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     MOVE *ON       *IN76                                               CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF
     C                     ENDIF
      *
      **  New Spread/Rate * * * * * * * * * * * * * * * * * * * * * * *
      *
     C           WNRTS1    IFNE '*'
     C           *IN41     ANDEQ*OFF
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C                     MOVE *BLANKS   ERRMID
      *
      **  Must be in a valid rate format.
     C                     SELEC
     C           SNRTSB    WHNE *BLANKS
     C           SNRTS     ORNE *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNRTS     ORNE *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVE *BLANKS   ZFIELD
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVE SNRTSB    ZFIELD
     C                     ELSE                                           123857
     C                     MOVE SNRTS     ZFIELD                          123857
     C                     ENDIF                                          123857
     C                     Z-ADD7         ZADEC
     C                     Z-ADD4         ZADIG
     C                     EXSR ZALIGN
     C           *IN99     IFEQ *ON
     C                     MOVEL'LEV0140' ERRMID
     C                     ELSE
     C                     MOVE ZFIELD    VNRTS
      *                                                                                     AR847588
      ** Convert New Spread rate to negative if spread rate sign is                         AR847588
      ** negative.                                                                          AR847588
      *                                                                                     AR847588
     C           SRSGNB    IFEQ '-'                                                         AR847588
     C                     Z-SUBVNRTS     VNRTS                                             AR847588
     C                     ENDIF                                                            AR847588
      *                                                                                     AR847588
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVE ZFIELD    SNRTSB
     C                     ENDIF                                          123857
     C                     ENDIF
     C                     ENDSL
      *
     C           ERRMID    IFNE *BLANKS
     C                     MOVE *ON       *IN42
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                                     AR847588
      ** Show an error also on spread rate sign if there is an error                        AR847588
      ** in spread rate validation.                                                         AR847588
      *                                                                                     AR847588
     C           *IN42     IFEQ '1'                                                         AR847588
     C           WRSGN1    ANDNE'*'                                                         AR847588
     C                     MOVE '1'       *IN23                                             AR847588
     C                     MOVEL'LEV1089' ERRMID                                            AR847588
     C                     MOVE *ON       ERRDET                                            AR847588
     C                     MOVELERRMID    ZAMSID                                            AR847588
     C                     EXSR ZASNMS                                                      AR847588
     C                     ENDIF                                                            AR847588
     C                     ENDIF
      *                                                                                     AR847588
      ** Validate spread rate sign if not '*'.                                              AR847588
      *                                                                                     AR847588
     C           WRSGN1    IFNE '*'                                                         AR847588
     C                     MOVE *BLANKS   ERRMID                                            AR847588
      *                                                                                     AR847588
      ** Spread rate sign must be blank if spread rate is blank.                            AR847588
      *                                                                                     AR847588
     C           SNRTSB    IFEQ *BLANKS                                                     AR847588
     C           SRSGNB    ANDNE*BLANKS                                                     AR847588
     C                     MOVEL'LEV1089' ERRMID                                            AR847588
     C                     ENDIF                                                            AR847588
      *                                                                                     AR847588
      ** Spread rate must be '-' or '+' only.                                               AR847588
      *                                                                                     AR847588
     C           *IN42     IFEQ '0'                                                         AR847588
     C           SRSGNB    ANDNE*BLANKS                                                     AR847588
     C           SRSGNB    ANDNE'+'                                                         AR847588
     C           SRSGNB    ANDNE'-'                                                         AR847588
     C                     MOVEL'LEV1088' ERRMID                                            AR847588
     C                     ENDIF                                                            AR847588
      *                                                                                     AR847588
     C           ERRMID    IFNE *BLANKS                                                     AR847588
     C                     MOVE '1'       *IN23                                             AR847588
     C                     MOVE *ON       ERRDET                                            AR847588
     C                     MOVELERRMID    ZAMSID                                            AR847588
     C                     EXSR ZASNMS                                                      AR847588
     C                     ENDIF                                                            AR847588
     C                     ENDIF                                                            AR847588
      *
      **  New Spread Indicator * * * * * * * * * * * * * * * * * * * **
      *
     C           WNSIN1    IFNE '*'
     C           *IN41     ANDEQ*OFF
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C                     MOVE *BLANKS   ERRMID
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVELSNSINB    WNSIN   1
     C                     ELSE                                           123857
     C                     MOVELSNSIN     WNSIN                           123857
     C                     ENDIF                                          123857
      *                                                                                       CLE036
     C           CLE036    IFEQ 'N'                                                           CLE036
      *
      **  Default spread indicator to 'A'
      **  if a valid new base rate code was entered
      **  and new spread/rate is blank or vice versa.
     C                     SELEC
     C           SNSINB    WHEQ *BLANK
     C           SNBRAB    ANDEQ*BLANKS
     C           SNRTSB    ANDNE*BLANKS
     C           WNRTS1    ANDNE'*'
     C           *IN42     ANDEQ*OFF
     C           SACTN     ANDEQ'A'                                       123857
     C           SNSINB    OREQ *BLANK
     C           SNRTSB    ANDEQ*BLANKS
     C           SNBRAB    ANDNE*BLANKS
     C           WNBRA1    ANDNE'*'
     C           *IN41     ANDEQ*OFF
     C           SACTN     ANDEQ'A'                                       123857
     C                     MOVE 'A'       WNSIN
      *
      **  Entry is forbidden if no New base rate code
      **  and no New spread/rate;
      **  or either New base rate code or New spread/rate
      **  was not entered and entry is not 'A';
      **  or entry not 'A', 'S' or 'P'.
     C           SNBRAB    WHEQ *BLANKS
     C           SNRTSB    ANDEQ*BLANKS
     C           SNSINB    ANDNE*BLANKS
     C           SNBRAB    OREQ *BLANKS
     C           SNRTSB    ANDNE*BLANKS
     C           SNSINB    ANDNE'A'
     C           SNBRAB    ORNE *BLANKS
     C           SNRTSB    ANDEQ*BLANKS
     C           SNSINB    ANDNE'A'
     C           SNSINB    ORNE *BLANK
     C           SNSINB    ANDNE'A'
     C           SNSINB    ANDNE'S'
     C           SNSINB    ANDNE'P'
      *                                                                   123857
     C           SNBRA     OREQ *BLANKS                                   123857
     C           SNRTS     ANDEQ*BLANKS                                   123857
     C           SNSIN     ANDNE*BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNBRA     OREQ *BLANKS                                   123857
     C           SNRTS     ANDNE*BLANKS                                   123857
     C           SNSIN     ANDNE'A'                                       123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNBRA     ORNE *BLANKS                                   123857
     C           SNRTS     ANDEQ*BLANKS                                   123857
     C           SNSIN     ANDNE'A'                                       123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNSIN     ORNE *BLANK                                    123857
     C           SNSIN     ANDNE'A'                                       123857
     C           SNSIN     ANDNE'S'                                       123857
     C           SNSIN     ANDNE'P'                                       123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SNBRA     OREQ *BLANKS                                   CLE030
     C           SNRTS     ANDEQ*BLANKS                                   CLE030
     C           SNSIN     ANDNE*BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           SNBRA     OREQ *BLANKS                                   CLE030
     C           SNRTS     ANDNE*BLANKS                                   CLE030
     C           SNSIN     ANDNE'A'                                       CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           SNBRA     ORNE *BLANKS                                   CLE030
     C           SNRTS     ANDEQ*BLANKS                                   CLE030
     C           SNSIN     ANDNE'A'                                       CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           SNSIN     ORNE *BLANK                                    CLE030
     C           SNSIN     ANDNE'A'                                       CLE030
     C           SNSIN     ANDNE'S'                                       CLE030
     C           SNSIN     ANDNE'P'                                       CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     MOVEL'LEV0142' ERRMID
     C                     ENDSL
      *                                                                                       CLE036
     C                     ELSE                                                               CLE036
      *                                                                                       CLE036
      ** Default spread indicator to 'A' if a valid New Base Rate Code or New                 CLE036
      ** Base Rate was entered, and New Spread/Rate is blank or vice-versa                    CLE036
      *                                                                                       CLE036
     C                     SELEC                                                              CLE036
     C           SNSINB    WHEQ *BLANK                                                        CLE036
     C           SNBRAB    ANDEQ*BLANKS                                                       CLE036
     C           SNBRTB    ANDEQ*BLANKS                                                       CLE036
     C           SNRTSB    ANDNE*BLANKS                                                       CLE036
     C           WNRTS1    ANDNE'*'                                                           CLE036
     C           *IN42     ANDEQ*OFF                                                          CLE036
     C           SACTN     ANDEQ'A'                                                           CLE036
     C           SNSINB    OREQ *BLANK                                                        CLE036
     C           SNRTSB    ANDEQ*BLANKS                                                       CLE036
     C           SNBRAB    ANDNE*BLANKS                                                       CLE036
     C           WNBRA1    ANDNE'*'                                                           CLE036
     C           *IN41     ANDEQ*OFF                                                          CLE036
     C           SACTN     ANDEQ'A'                                                           CLE036
     C           SNSINB    OREQ *BLANK                                                        CLE036
     C           SNRTSB    ANDEQ*BLANKS                                                       CLE036
     C           SNBRTB    ANDNE*BLANKS                                                       CLE036
     C           WNBRT1    ANDNE'*'                                                           CLE036
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C           SACTN     ANDEQ'A'                                                           CLE036
     C                     MOVE 'A'       WNSIN                                               CLE036
      *                                                                                       CLE036
      ** Entry is forbidden if there are no base rates and spread/rate entered                CLE036
      *                                                                                       CLE036
     C           SNBRAB    WHEQ *BLANKS                                                       CLE036
     C           SNBRTB    ANDEQ*BLANKS                                                       CLE036
     C           SNRTSB    ANDEQ*BLANKS                                                       CLE036
     C           SNSINB    ANDNE*BLANKS                                                       CLE036
      *                                                                                       CLE036
      ** Entry must be 'A' if only base rates are entered or if only the                      CLE036
      ** spread/rate is entered                                                               CLE036
      *                                                                                       CLE036
     C           SNBRAB    OREQ *BLANKS                                                       CLE036
     C           SNBRTB    ANDEQ*BLANKS                                                       CLE036
     C           SNRTSB    ANDNE*BLANKS                                                       CLE036
     C           WNRTS1    ANDNE'*'                                                           CLE036
     C           SNSINB    ANDNE'A'                                                           CLE036
     C           SNBRAB    ORNE *BLANKS                                                       CLE036
     C           WNBRA1    ANDNE'*'                                                           CLE036
     C           SNRTSB    ANDEQ*BLANKS                                                       CLE036
     C           SNSINB    ANDNE'A'                                                           CLE036
     C           SNBRTB    ORNE *BLANKS                                                       CLE036
     C           WNBRT1    ANDNE'*'                                                           CLE036
     C           SNRTSB    ANDEQ*BLANKS                                                       CLE036
     C           SNSINB    ANDNE'A'                                                           CLE036
      *                                                                                       CLE036
      ** Entry must be 'A', 'S' or 'P'                                                        CLE036
      *                                                                                       CLE036
     C           SNSINB    ORNE *BLANK                                                        CLE036
     C           SNSINB    ANDNE'A'                                                           CLE036
     C           SNSINB    ANDNE'S'                                                           CLE036
     C           SNSINB    ANDNE'P'                                                           CLE036
      *                                                                                       CLE036
      ** Same validation for 'Authorise' action                                               CLE036
      *                                                                                       CLE036
     C           SNBRA     OREQ *BLANKS                                                       CLE036
     C           SNBRT     ANDEQ*BLANKS                                                       CLE036
     C           SNRTS     ANDEQ*BLANKS                                                       CLE036
     C           SNSIN     ANDNE*BLANKS                                                       CLE036
     C           SACTN     ANDEQ'X'                                                           CLE036
     C           SNBRA     OREQ *BLANKS                                                       CLE036
     C           SNBRT     ANDEQ*BLANKS                                                       CLE036
     C           SNRTS     ANDNE*BLANKS                                                       CLE036
     C           SNSIN     ANDNE'A'                                                           CLE036
     C           SACTN     ANDEQ'X'                                                           CLE036
     C           SNBRA     ORNE *BLANKS                                                       CLE036
     C           SNRTS     ANDEQ*BLANKS                                                       CLE036
     C           SNSIN     ANDNE'A'                                                           CLE036
     C           SACTN     ANDEQ'X'                                                           CLE036
     C           SNBRT     ORNE *BLANKS                                                       CLE036
     C           SNRTS     ANDEQ*BLANKS                                                       CLE036
     C           SNSIN     ANDNE'A'                                                           CLE036
     C           SACTN     ANDEQ'X'                                                           CLE036
     C           SNSIN     ORNE *BLANK                                                        CLE036
     C           SNSIN     ANDNE'A'                                                           CLE036
     C           SNSIN     ANDNE'S'                                                           CLE036
     C           SNSIN     ANDNE'P'                                                           CLE036
     C           SACTN     ANDEQ'X'                                                           CLE036
     C                     MOVEL'LEV1071' ERRMID                                              CLE036
     C                     ENDSL                                                              CLE036
      *                                                                                       CLE036
     C                     ENDIF                                                              CLE036
      *
     C           ERRMID    IFNE *BLANKS
     C                     MOVE *ON       *IN43
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     MOVE WNSIN     VNSIN
     C                     ENDIF
     C                     ENDIF
      *
      **  New Interest Calculation Basis * * * * * * * * * * * * * * **
      *
     C           WNCAS1    IFNE '*'
     C           *IN41     ANDEQ*OFF
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C                     MOVE *BLANKS   ERRMID
     C           SACTN     IFEQ 'A'
     C           SNCASB    IFEQ *BLANK
     C           SNBRAB    ANDNE*BLANKS
     C           WNBRA1    ANDNE'*'                                                           CLE036
     C           SNCASB    OREQ *BLANK                                                        CLE036
     C           SNBRTB    ANDNE*BLANKS                                                       CLE036
     C           WNBRT1    ANDNE'*'                                                           CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C           SNCASB    OREQ *BLANK
     C           SNRTSB    ANDNE*BLANKS
     C           SNCASB    ORLT '1'
     C           SNCASB    ANDNE*BLANK
     C           SNCASB    ORGT '6'
     C/COPY WNCPYSRC,LE2070C028
     C                     MOVE *ON       *IN44
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV0141' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     MOVE SNCASB    VNCAS
     C                     ENDIF
      *                                                                   123857
     C                     ELSE                                           123857
     C           SNCAS     IFEQ *BLANK                                    123857
     C           SNBRA     ANDNE*BLANKS                                   123857
     C           SNCAS     OREQ *BLANK                                                        CLE036
     C           SNBRT     ANDNE*BLANKS                                                       CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C           SNCAS     OREQ *BLANK                                    123857
     C           SNRTS     ANDNE*BLANKS                                   123857
     C           SNCAS     ORLT '1'                                       123857
     C           SNCAS     ANDNE*BLANK                                    123857
     C           SNCAS     ORGT '6'                                       123857
     C                     MOVE *ON       *IN44                           123857
     C                     MOVE *ON       ERRDET                          123857
     C                     MOVEL'LEV0141' ZAMSID                          123857
     C                     EXSR ZASNMS                                    123857
     C                     ELSE                                           123857
     C                     MOVE SNCAS     VNCAS                           123857
     C                     ENDIF                                          123857
     C                     ENDIF                                          123857
      *                                                                   123857
     C                     ENDIF
      *
      **  New Change Indicator * * * * * * * * * * * * * * * * * * * **
      *
     C           WNCHI1    IFNE '*'
     C           *IN41     ANDEQ*OFF
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C                     MOVE *BLANKS   ERRMID
     C                     MOVELSNCHIB    WNCHI   1
     C           SACTN     IFEQ 'X'                                       123857
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVELSNCHI     WNCHI                           123857
     C                     ENDIF                                          123857
      *
      **  May be blank if New base rate code not entered,
      **  default to 'D'.  But for discount laon, default to 'N'.
     C                     SELEC
     C           SNCHIB    WHEQ *BLANK
     C           SNBRAB    ANDEQ*BLANKS
     C           *IN41     ANDEQ*OFF
     C           PTYP      IFEQ 63
     C           PTYP      OREQ 65                                        122098
     C           PTYP      OREQ 67                                        122098
     C                     MOVE 'N'       WNCHI
     C                     ELSE
     C                     MOVE 'D'       WNCHI
     C                     ENDIF
      *
      **  Must be 'R', 'N', or 'D' for non-discount loans
      **  if New base rate code was entered.
     C           SNCHIB    WHNE *BLANK
     C********** VNBRA     ANDNE*ZEROS                                                        CSD103
     C           VNBRA     ANDNE*BLANKS                                                       CSD103
     C           *IN41     ANDEQ*OFF
     C           PTYP      ANDNE63
     C           PTYP      ANDNE65                                        122098
     C           PTYP      ANDNE67                                        122098
     C           SNCHIB    ANDNE'R'
     C           SNCHIB    ANDNE'N'
     C           SNCHIB    ANDNE'D'
     C           SACTN     ANDEQ'A'                                       123857
      *                                                                   123857
     C           SNCHI     ORNE *BLANK                                    123857
     C********** VNBRA     ANDNE*ZEROS                                                 123857 CSD103
     C           VNBRA     ANDNE*BLANKS                                                       CSD103
     C           *IN41     ANDEQ*OFF                                      123857
     C           PTYP      ANDNE63                                        123857
     C           PTYP      ANDNE65                                        123857
     C           PTYP      ANDNE67                                        123857
     C           SNCHI     ANDNE'R'                                       123857
     C           SNCHI     ANDNE'N'                                       123857
     C           SNCHI     ANDNE'D'                                       123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SNCHI     ORNE *BLANK                                    CLE030
     C********** VNBRA     ANDNE*ZEROS                                                 CLE030 CSD103
     C           VNBRA     ANDNE*BLANKS                                                       CSD103
     C           *IN41     ANDEQ*OFF                                      CLE030
     C           PTYP      ANDNE63                                        CLE030
     C           PTYP      ANDNE65                                        CLE030
     C           PTYP      ANDNE67                                        CLE030
     C           SNCHI     ANDNE'R'                                       CLE030
     C           SNCHI     ANDNE'N'                                       CLE030
     C           SNCHI     ANDNE'D'                                       CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
      *                                                                                       CLE036
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           SNCHIB    ANDNE*BLANK                                                        CLE036
     C           VNBRT     ANDNE*ZEROS                                                        CLE036
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C           PTYP      ANDNE63                                                            CLE036
     C           PTYP      ANDNE65                                                            CLE036
     C           PTYP      ANDNE67                                                            CLE036
     C           SNCHIB    ANDNE'R'                                                           CLE036
     C           SNCHIB    ANDNE'N'                                                           CLE036
     C           SNCHIB    ANDNE'D'                                                           CLE036
     C           SACTN     ANDEQ'A'                                                           CLE036
      *                                                                                       CLE036
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           SNCHI     ANDNE*BLANK                                                        CLE036
     C           VNBRT     ANDNE*ZEROS                                                        CLE036
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C           PTYP      ANDNE63                                                            CLE036
     C           PTYP      ANDNE65                                                            CLE036
     C           PTYP      ANDNE67                                                            CLE036
     C           SNCHI     ANDNE'R'                                                           CLE036
     C           SNCHI     ANDNE'N'                                                           CLE036
     C           SNCHI     ANDNE'D'                                                           CLE036
     C           SACTN     ANDEQ'X'                                                           CLE036
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     MOVEL'LEV1072' ERRMID                                              CLE036
     C                     ELSE                                                               CLE036
     C                     MOVEL'LEV0143' ERRMID
     C                     ENDIF                                                              CLE036
      *
      **  New base rate code not entered and not a discount loan,
      **  must be 'D'.
     C           SNBRAB    WHEQ *BLANKS
     C           *IN41     ANDEQ*OFF
     C           PTYP      ANDNE63
     C           PTYP      ANDNE65                                        122098
     C           PTYP      ANDNE67                                        122098
     C           SNCHIB    ANDNE'D'
     C           SACTN     ANDEQ'A'                                       123857
     C           CLE036    ANDEQ'N'                                                           CLE036
      *                                                                   123857
     C           SNBRA     OREQ *BLANKS                                   123857
     C           *IN41     ANDEQ*OFF                                      123857
     C           PTYP      ANDNE63                                        123857
     C           PTYP      ANDNE65                                        123857
     C           PTYP      ANDNE67                                        123857
     C           SNCHI     ANDNE'D'                                       123857
     C           SACTN     ANDEQ'X'                                       123857
     C           CLE036    ANDEQ'N'                                                           CLE036
      *                                                                                       CLE036
      *                                                                   CLE030
     C           SNBRA     OREQ *BLANKS                                   CLE030
     C           *IN41     ANDEQ*OFF                                      CLE030
     C           PTYP      ANDNE63                                        CLE030
     C           PTYP      ANDNE65                                        CLE030
     C           PTYP      ANDNE67                                        CLE030
     C           SNCHI     ANDNE'D'                                       CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           SNBRAB    ANDEQ*BLANKS                                                       CLE036
     C           *IN41     ANDEQ*OFF                                                          CLE036
     C           SNBRTB    ANDEQ*BLANKS                                                       CLE036
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C           PTYP      ANDNE63                                                            CLE036
     C           PTYP      ANDNE65                                                            CLE036
     C           PTYP      ANDNE67                                                            CLE036
     C           SNCHIB    ANDNE'D'                                                           CLE036
     C           SACTN     ANDEQ'A'                                                           CLE036
      *                                                                                       CLE036
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           SNBRA     ANDEQ*BLANKS                                                       CLE036
     C           *IN41     ANDEQ*OFF                                                          CLE036
     C           SNBRT     ANDEQ*BLANKS                                                       CLE036
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C           PTYP      ANDNE63                                                            CLE036
     C           PTYP      ANDNE65                                                            CLE036
     C           PTYP      ANDNE67                                                            CLE036
     C           SNCHI     ANDNE'D'                                                           CLE036
     C           SACTN     ANDEQ'X'                                                           CLE036
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     MOVEL'LEV1072' ERRMID                                              CLE036
     C                     ELSE                                                               CLE036
     C                     MOVEL'LEV0143' ERRMID
     C                     ENDIF                                                              CLE036
      *
      **  Must be 'N' for discount loans
      **  if New base rate code was entered.
     C           SNCHIB    WHNE *BLANK
     C********** VNBRA     ANDNE*ZEROS                                                        CSD103
     C           VNBRA     ANDNE*BLANKS                                                       CSD103
     C           *IN41     ANDEQ*OFF
     C           PTYP      ANDEQ63
     C           SNCHIB    ANDNE'N'
     C           SACTN     ANDEQ'A'                                       123857
     C           SNCHIB    ORNE *BLANK                                    122098
     C********** VNBRA     ANDNE*ZEROS                                                 122098 CSD103
     C           VNBRA     ANDNE*BLANKS                                                       CSD103
     C           *IN41     ANDEQ*OFF                                      122098
     C           PTYP      ANDEQ65                                        122098
     C           SNCHIB    ANDNE'N'                                       122098
     C           SACTN     ANDEQ'A'                                       123857
     C           SNCHIB    ORNE *BLANK                                    122098
     C********** VNBRA     ANDNE*ZEROS                                                 122098 CSD103
     C           VNBRA     ANDNE*BLANKS                                                       CSD103
     C           *IN41     ANDEQ*OFF                                      122098
     C           PTYP      ANDEQ67                                        122098
     C           SNCHIB    ANDNE'N'                                       122098
     C           SACTN     ANDEQ'A'                                       123857
      *                                                                   123857
     C           SNCHI     ORNE *BLANK                                    123857
     C********** VNBRA     ANDNE*ZEROS                                                 123857 CSD103
     C           VNBRA     ANDNE*BLANKS                                                       CSD103
     C           *IN41     ANDEQ*OFF                                      123857
     C           PTYP      ANDEQ63                                        123857
     C           SNCHI     ANDNE'N'                                       123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNCHI     ORNE *BLANK                                    123857
     C********** VNBRA     ANDNE*ZEROS                                                 123857 CSD103
     C           VNBRA     ANDNE*BLANKS                                                       CSD103
     C           *IN41     ANDEQ*OFF                                      123857
     C           PTYP      ANDEQ65                                        123857
     C           SNCHI     ANDNE'N'                                       123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNCHI     ORNE *BLANK                                    123857
     C********** VNBRA     ANDNE*ZEROS                                                 123857 CSD103
     C           VNBRA     ANDNE*BLANKS                                                       CSD103
     C           *IN41     ANDEQ*OFF                                      123857
     C           PTYP      ANDEQ67                                        123857
     C           SNCHI     ANDNE'N'                                       123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SNCHI     ORNE *BLANK                                    CLE030
     C********** VNBRA     ANDNE*ZEROS                                                 CLE030 CSD103
     C           VNBRA     ANDNE*BLANKS                                                       CSD103
     C           *IN41     ANDEQ*OFF                                      CLE030
     C           PTYP      ANDEQ63                                        CLE030
     C           SNCHI     ANDNE'N'                                       CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           SNCHI     ORNE *BLANK                                    CLE030
     C********** VNBRA     ANDNE*ZEROS                                                 CLE030 CSD103
     C           VNBRA     ANDNE*BLANKS                                                       CSD103
     C           *IN41     ANDEQ*OFF                                      CLE030
     C           PTYP      ANDEQ65                                        CLE030
     C           SNCHI     ANDNE'N'                                       CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           SNCHI     ORNE *BLANK                                    CLE030
     C********** VNBRA     ANDNE*ZEROS                                                 CLE030 CSD103
     C           VNBRA     ANDNE*BLANKS                                                       CSD103
     C           *IN41     ANDEQ*OFF                                      CLE030
     C           PTYP      ANDEQ67                                        CLE030
     C           SNCHI     ANDNE'N'                                       CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
      *                                                                                       CLE036
     C           SNCHIB    ORNE *BLANK                                                        CLE036
     C           VNBRT     ANDNE*ZEROS                                                        CLE036
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C           PTYP      ANDEQ63                                                            CLE036
     C           SNCHIB    ANDNE'N'                                                           CLE036
     C           SACTN     ANDEQ'A'                                                           CLE036
     C           SNCHIB    ORNE *BLANK                                                        CLE036
     C           VNBRT     ANDNE*ZEROS                                                        CLE036
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C           PTYP      ANDEQ65                                                            CLE036
     C           SNCHIB    ANDNE'N'                                                           CLE036
     C           SACTN     ANDEQ'A'                                                           CLE036
     C           SNCHIB    ORNE *BLANK                                                        CLE036
     C           VNBRT     ANDNE*ZEROS                                                        CLE036
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C           PTYP      ANDEQ67                                                            CLE036
     C           SNCHIB    ANDNE'N'                                                           CLE036
     C           SACTN     ANDEQ'A'                                                           CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
      *                                                                                       CLE036
     C           SNCHI     ORNE *BLANK                                                        CLE036
     C           VNBRT     ANDNE*ZEROS                                                        CLE036
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C           PTYP      ANDEQ63                                                            CLE036
     C           SNCHI     ANDNE'N'                                                           CLE036
     C           SACTN     ANDEQ'X'                                                           CLE036
     C           SNCHI     ORNE *BLANK                                                        CLE036
     C           VNBRT     ANDNE*ZEROS                                                        CLE036
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C           PTYP      ANDEQ65                                                            CLE036
     C           SNCHI     ANDNE'N'                                                           CLE036
     C           SACTN     ANDEQ'X'                                                           CLE036
     C           SNCHI     ORNE *BLANK                                                        CLE036
     C           VNBRT     ANDNE*ZEROS                                                        CLE036
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C           PTYP      ANDEQ67                                                            CLE036
     C           SNCHI     ANDNE'N'                                                           CLE036
     C           SACTN     ANDEQ'X'                                                           CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     MOVEL'LEV1072' ERRMID                                              CLE036
     C                     ELSE                                                               CLE036
     C                     MOVEL'LEV0143' ERRMID
     C                     ENDIF                                                              CLE036
      *
      **  Mandatory if New base rate code entered.
     C           SNBRAB    WHNE *BLANKS
     C           WNBRA1    ANDNE'*'
     C           *IN41     ANDEQ*OFF
     C           SNCHIB    ANDEQ*BLANK
      *                                                                   123857
     C           SNBRA     ORNE *BLANKS                                   123857
     C           *IN41     ANDEQ*OFF                                      123857
     C           SNCHI     ANDEQ*BLANK                                    123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SNBRA     ORNE *BLANKS                                   CLE030
     C           *IN41     ANDEQ*OFF                                      CLE030
     C           SNCHI     ANDEQ*BLANK                                    CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
      *                                                                                       CLE036
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           SNBRTB    ANDNE*BLANKS                                                       CLE036
     C           WNBRT1    ANDNE'*'                                                           CLE036
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C           SNCHIB    ANDEQ*BLANK                                                        CLE036
      *                                                                                       CLE036
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           SNBRT     ANDNE*BLANKS                                                       CLE036
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C           SNCHI     ANDEQ*BLANK                                                        CLE036
     C           SACTN     ANDEQ'X'                                                           CLE036
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     MOVEL'LEV1072' ERRMID                                              CLE036
     C                     ELSE                                                               CLE036
     C                     MOVEL'LEV0143' ERRMID
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     ENDSL
      *
     C           ERRMID    IFNE *BLANKS
     C                     MOVE *ON       *IN45
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     MOVE WNCHI     VNCHI
     C                     ENDIF
     C                     ENDIF
      *                                                                   117441
      * A base rate history record must exist which would apply to        117441
      * the base rate code at rollover date.                              117441
      * Only do this if a valid base rate/rollover date combination       117441
      * still exists; ie from screen or file.                             117441
      *                                                                   117441
      * Invalid or removed by '*'                                         117441
     C           *IN38     IFEQ '0'                                       117441
     C           WRLDT1    ANDNE'*'                                       117441
     C           SNBRAB    ANDNE*BLANK                                    117441
     C           WNBRA1    ANDNE'*'                                       117441
     C           *IN41     ANDEQ'0'                                       117441
     C           SACTN     ANDEQ'A'                                       123857
      *                                                                   123857
     C           *IN38     OREQ '0'                                       123857
     C           SNBRA     ANDNE*BLANK                                    123857
     C           *IN41     ANDEQ'0'                                       123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           *IN38     OREQ '0'                                       CLE030
     C           SNBRA     ANDNE*BLANK                                    CLE030
     C           *IN41     ANDEQ'0'                                       CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   117441
     C           WRLDT     IFGT *ZERO                                     117441
     C                     Z-ADDWRLDT     W#HIDT  50                      117441
     C                     ELSE                                           117441
     C                     Z-ADDRLDT      W#HIDT                          117441
     C                     ENDIF                                          117441
      *                                                                   117441
     C**********           Z-ADDWNBRA     G0BSRC                                       117441 CSD103
     C                     MOVE WNBRA     G0BSRC                                              CSD103
      *                                                                   117441
     C           K#BSHS    KLIST                                          117441
     C***********          KFLD           CCY                       117441127485
     C                     KFLD           W#CCY                           127485
     C**********           KFLD           G0BSRC  20                                   117441 CSD103
     C                     KFLD           G0BSRC  2                                           CSD103
      *                                                                   117441
     C           K#BSHS    CHAINSDBSHSL1             85                   117441
     C           *IN85     IFEQ *ON                                       117441
      *                                                                                       200967
      ** Check if it exists in SDBSRTPD and if the dates are valid                            200967
      *                                                                                       200967
     C                     MOVE WNBRA     PBRAT                                               200967
     C                     CALL 'AOBSRTR0'                                                    200967
     C                     PARM *BLANKS   PRTCD                                               200967
     C                     PARM '*KEY    'POPTN                                               200967
     C                     PARM W#CCY     PCURR                                               200967
     C                     PARM           PBRAT                                               200967
     C           SDBSRT    PARM SDBSRT    DSFDY                                               200967
     C                     ENDIF                                                              200967
      *                                                                                       200967
     C           PRTCD     IFNE *BLANKS                                                       200967
     C           BAVDNR    ORGT W#HIDT                                                        200967
     C           W#HIDT    ANDNE*ZEROS                                                        200967
     C           *IN85     ANDEQ'1'                                                           200967
     C           G0HIDT    ORGT W#HIDT                                    117441
     C           W#HIDT    ANDNE*ZEROS                                                        200967
     C           *IN85     ANDNE'1'                                                           200967
     C                     MOVE '1'       *IN41                           117441
     C                     MOVE *ON       ERRDET                          120617
     C                     MOVEL'LEV1041' ZAMSID                          117441
     C                     EXSR ZASNMS                                    117441
     C                     ENDIF                                          117441
     C                     ENDIF                                          117441
      *
      **  If BLI Lending Enhancements feature is switched on
      **  validate New interest payment date and New Maturity date
      *
     C           *IN60     IFEQ *ON
      *
     C                     Z-ADDNIPD      VNIPD
     C                     Z-ADDNMDT      VNMDT
     C                     Z-ADDNIDT      VNIDT
      ** Before validating new interest payment date, value of new                            188804
      ** maturity date is already necessary for comparison purposes.                          188804
     C           SNMDTB    IFNE *BLANKS                                                       188804
     C           WNMDT1    ANDNE'*'                                                           188804
     C           SNMDT     ORNE *BLANKS                                                       188804
     C           SACTN     ANDEQ'X'                                                           188804
     C           SNMDT     ORNE *BLANKS                                                       CLE030
     C           SACTN     ANDEQ'Q'                                                           CLE030
     C           CLE030    ANDEQ'Y'                                                           CLE030
     C                     MOVE *BLANKS   ERRMID                                              188804
     C           SACTN     IFEQ 'A'                                                           188804
     C                     TESTN          SNMDTB     85    *on is num                         188804
     C                     MOVE SNMDTB    ZDATE                                               188804
     C                     ELSE                                                               188804
     C                     TESTN          SNMDT      85    *on is num                         188804
     C                     MOVE SNMDT     ZDATE                                               188804
     C                     ENDIF                                                              188804
     C                     EXSR ZDATE1                                                        188804
     C                     Z-ADDZDAYNO    WNMDT   50                                          188804
     C                     ENDIF                                                              188804
      *
      **  New Interest Payment Date * * * * * * * * * * * * * * * * * *
      *
      **  Validate if not blank and not to be removed.
     C           SNIPDB    IFNE *BLANKS
     C           WNIPD1    ANDNE'*'
     C           SNIPD     ORNE *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNIPD     ORNE *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVE *BLANKS   ERRMID
     C           SACTN     IFEQ 'A'                                       123857
     C                     TESTN          SNIPDB     85    *on means numeric
     C                     MOVE SNIPDB    ZDATE
     C                     ELSE                                           123857
     C                     TESTN          SNIPD      85    *on means numer123857
     C                     MOVE SNIPD     ZDATE                           123857
     C                     ENDIF                                          123857
     C                     EXSR ZDATE1
      *
      **  Forbidden for Discount loans.
     C                     SELEC
     C           PTYP      WHEQ 63
     C           PTYP      OREQ 65                                        122098
     C           PTYP      OREQ 67                                        122098
     C                     MOVEL'LEV1012' ERRMID
      *
      **  Must be numeric.
     C           *IN85     WHEQ *OFF
     C                     MOVEL'LEV0601' ERRMID
      *
      **  Must be in valid date format.
     C           *IN99     WHEQ *ON
     C                     MOVEL'LEV0601' ERRMID
      *
      **  Must be later than the loan interest payment date.
     C           ZDAYNO    WHLE NIDT
     C           ZDAYNO    ORLT WRLDT                                                         175698
     C           IPFR      ANDEQ'R'                                                           175698
     C                     MOVEL'LEV0602' ERRMID
      *                                                                   144688
      **  Must not be later than the maturity date.                       144688
      *                                                                   144688
     C********** ZDAYNO    WHGT MDAT                                      144688              205506
     C           ZDAYNO    WHGE MDAT                                                          205506
     C           MDAT      ANDNE0                                         144688
     C********** ZDAYNO    ANDGTNMDT                               144688 188804
     C********** ZDAYNO    ANDGTWNMDT                                     188804              205506
     C           ZDAYNO    ANDGEWNMDT                                                         205506
     C                     MOVEL'LEV0607' ERRMID                          144688
      *                                                                   144688
      **  Must not be later than the Facility Expiry Date for             144688
      **  Call Loans with no Maturity Date.                               144688
      *                                                                   144688
     C           ZDAYNO    WHGT DTEX                                      144688
     C           MDAT      ANDEQ0                                         144688
     C                     MOVEL'LEV0608' ERRMID                          144688
     C                     ENDSL
      *
     C           ERRMID    IFNE *BLANKS
     C                     MOVE *ON       *IN49
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVE SNIPDB    SNIPDB
     C                     ENDIF                                          123857
     C                     Z-ADDZDAYNO    VNIPD
     C                     ENDIF
     C                     ENDIF
      *
      **  If New interest payment date is blank,
      **  check if Next interest date is blank,
      **  if it is, default to Rollover date.
      **  If not blank, default New interest payment date
      **  to Rollover date.
     C           SNIPDB    IFEQ *BLANKS
     C           PTYP      ANDNE63
     C           PTYP      ANDNE65                                        122098
     C           PTYP      ANDNE67                                        122098
     C           VRLDT     ANDNE*ZEROS
     C           *IN38     ANDEQ*OFF
     C           SACTN     ANDEQ'A'                                       123857
     C           REPT      ANDEQ2                                         147438
     C***********NIDT      IFEQ *ZEROS                                                        218984
     C********** VRLDT     ANDGEBJRDNB                             117215 CSC011
     C***********VRLDT     ANDGEWRNDAY                                                 CSC011 218984
     C***********          Z-ADDVRLDT     VNIDT                                               218984
     C***********          ELSE                                                               218984
     C           VRLDT     IFGT NIDT
     C********** VRLDT     ANDGEBJRDNB                             117215 CSC011
     C           VRLDT     ANDGEWRNDAY                                    CSC011
     C           IPFR      ANDEQ'R'                                                           175698
     C                     Z-ADDVRLDT     VNIPD
     C                     ENDIF
     C***********          ENDIF                                                              218984
     C                     ENDIF
      *
      **  New Maturity Date * * * * * * * * * * * * * * * * * * * * * *
      *
      **  Validate if not blank and not to be removed.
      *
     C           SNMDTB    IFNE *BLANKS
     C           WNMDT1    ANDNE'*'
     C           SNMDT     ORNE *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C                     MOVE *BLANKS   ERRMID
     C           SACTN     IFEQ 'A'                                       123857
     C                     TESTN          SNMDTB     85    *on means numeric
     C                     MOVE SNMDTB    ZDATE
     C                     ELSE                                           123857
     C                     TESTN          SNMDT      85    *on means numer123857
     C                     MOVE SNMDT     ZDATE                           123857
     C                     ENDIF                                          123857
     C                     EXSR ZDATE1
      *
      **  Forbidden for Discount loans.
     C                     SELEC
     C           PTYP      WHEQ 63
     C           PTYP      OREQ 65                                        122098
     C           PTYP      OREQ 67                                        122098
     C                     MOVEL'LEV1013' ERRMID
      *
      **  Must be numeric.
     C           *IN85     WHEQ *OFF
     C                     MOVEL'LEV0603' ERRMID
      *
      **  Must be in valid date format.
     C           *IN99     WHEQ *ON
     C                     MOVEL'LEV0603' ERRMID
      *
      **  Must be later than the loan maturity date.
     C           ZDAYNO    WHLE MDAT
     C                     MOVEL'LEV0604' ERRMID
      *                                                                   144688
      **  Must be later than the Rollover date or Next Interest           144688
      **  Payment Date                                                    144688
      *                                                                   144688
     C           ZDAYNO    WHLE RLDT                                      144688
     C           ZDAYNO    ORLE VRLDT                                     144688
     C           ZDAYNO    ORLE NROD                                      144688
     C           ZDAYNO    ORLE VNROD                                     144688
     C           ZDAYNO    ORLT NIPD                                      144688
     C           ZDAYNO    ORLT NIDT                                      144688
     C           ZDAYNO    ORLT VNIPD                                     144688
     C                     MOVEL'LEV0605' ERRMID                          144688
      *                                                                   144688
      **  Must be not be later than the facility Expiry date.             144688
      *                                                                   144688
     C           ZDAYNO    WHGT DTEX                                      144688
     C                     MOVEL'LEV0606' ERRMID                          144688
     C                     ENDSL
      *
     C           ERRMID    IFNE *BLANKS
     C                     MOVE *ON       *IN50
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVE SNMDTB    SNMDTB
     C                     ENDIF                                          123857
     C                     Z-ADDZDAYNO    VNMDT
     C                     ENDIF
     C                     ENDIF
      *
      **  If New maturity date is blank
      **  or is about to be blanked out
      **  do allow if rollover date is equal to maturity date.
      *                                                                                       205506
     C                     MOVE VRLDT     WVRLDT  50                                          205506
      *                                                                                       205506
      ** Check if Rollover date is zero and previous rollover date                            205506
      ** is greater than zero then use the value of the previous                              205506
      ** rollover date                                                                        205506
      *                                                                                       205506
     C           VRLDT     IFEQ 0                                                             205506
     C           RLDT      ANDNE0                                                             205506
     C           WRLDT1    ANDNE'*'                                                           205506
     C                     MOVE RLDT      VRLDT                                               205506
     C                     ENDIF                                                              205506
      *                                                                                       205506
     C           SNMDTB    IFEQ *BLANKS
     C           PTYP      ANDNE63
     C           PTYP      ANDNE65                                        122098
     C           PTYP      ANDNE67                                        122098
     C           NMDT      ANDEQ*ZERO
     C           VRLDT     ANDNE*ZEROS
     C           *IN38     ANDEQ*OFF
     C           SACTN     ANDEQ'A'                                       123857
      *                                                                                       205506
     C           SNMDTB    ORNE *BLANKS                                                       205506
     C           WNMDT1    ANDEQ'*'                                                           205506
     C           WRLDT1    ANDNE'*'                                                           205506
     C           PTYP      ANDNE63                                                            205506
     C           PTYP      ANDNE65                                                            205506
     C           PTYP      ANDNE67                                                            205506
     C           RLDT      ANDEQMDAT                                                          205506
      *                                                                   123857
     C           SNMDT     OREQ *BLANKS                                   123857
     C           PTYP      ANDNE63                                        123857
     C           PTYP      ANDNE65                                        123857
     C           PTYP      ANDNE67                                        123857
     C           NMDT      ANDEQ*ZERO                                     123857
     C           VRLDT     ANDNE*ZEROS                                    123857
     C           *IN38     ANDEQ*OFF                                      123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SNMDT     OREQ *BLANKS                                   CLE030
     C           PTYP      ANDNE63                                        CLE030
     C           PTYP      ANDNE65                                        CLE030
     C           PTYP      ANDNE67                                        CLE030
     C           NMDT      ANDEQ*ZERO                                     CLE030
     C           VRLDT     ANDNE*ZEROS                                    CLE030
     C           *IN38     ANDEQ*OFF                                      CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C           VRLDT     IFGE MDAT
     C           PTYP      ANDNE61                                        144688
     C           MDAT      ANDNE0                                         144688
     C           VRLDT     ORGE MDAT                                      144688
     C           PTYP      ANDNE68                                        144688
     C           MDAT      ANDNE0                                         144688
     C           VRLDT     ORGE MDAT                                      144688
     C           PTYP      ANDNE69                                        144688
     C           MDAT      ANDNE0                                         144688
     C           RLDT      ORGE MDAT
     C           PTYP      ANDNE61                                        144688
     C           MDAT      ANDNE0                                         144688
     C           RLDT      ORGE MDAT                                      144688
     C           PTYP      ANDNE68                                        144688
     C           MDAT      ANDNE0                                         144688
     C           RLDT      ORGE MDAT                                      144688
     C           PTYP      ANDNE69                                        144688
     C           MDAT      ANDNE0                                         144688
      *                                                                   144688
     C           VRLDT     ORGE DTEX                                      144688
     C           PTYP      ANDEQ61                                        144688
     C           MDAT      ANDEQ0                                         144688
      *                                                                   144688
     C           VRLDT     ORGE DTEX                                      144688
     C           PTYP      ANDEQ68                                        144688
     C           MDAT      ANDEQ0                                         144688
      *                                                                   144688
     C           VRLDT     ORGE DTEX                                      144688
     C           PTYP      ANDEQ69                                        144688
     C           MDAT      ANDEQ0                                         144688
      *                                                                   144688
     C           RLDT      ORGE DTEX                                      144688
     C           PTYP      ANDEQ61                                        144688
     C           MDAT      ANDEQ0                                         144688
      *                                                                   144688
     C           RLDT      ORGE DTEX                                      144688
     C           PTYP      ANDEQ68                                        144688
     C           MDAT      ANDEQ0                                         144688
      *                                                                   144688
     C           RLDT      ORGE DTEX                                      144688
     C           PTYP      ANDEQ69                                        144688
     C           MDAT      ANDEQ0                                         144688
      *                                                                   144688
     C**********           MOVEL'LEV0152' ERRMID                                              205506
     C                     MOVEL'LEV1065' ERRMID                                              205506
     C                     ENDIF
     C                     ENDIF
      *                                                                                       205506
      **  Move the original value of Rollover date                                            205506
      *                                                                                       205506
     C                     MOVE WVRLDT    VRLDT                                               205506
      *                                                                                       205506
      ** If ERRMID is not blank then need to display error message                            205506
      *                                                                                       205506
     C           ERRMID    IFNE *BLANKS                                                       205506
     C                     MOVE '1'       *IN50                                               205506
     C                     MOVE '1'       ERRDET                                              205506
     C                     MOVELERRMID    ZAMSID                                              205506
     C                     EXSR ZASNMS                                                        205506
     C                     ENDIF                                                              205506
      *
      **  Remove field values if required.
      *
     C           WNIPD1    IFEQ '*'
     C                     Z-ADD*ZEROS    VNIPD
     C                     ENDIF
     C           WNMDT1    IFEQ '*'
     C                     Z-ADD*ZEROS    VNMDT
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Next Rollover Date * * * * * * * * * * * * * * * * * * * * **
      *
     C           WNROD1    IFEQ '*'                                       155907
     C                     Z-ADD*ZERO     VNROD                           155907
     C                     ENDIF                                          155907
     C           WNROD1    IFNE '*'
     C           *IN41     ANDEQ*OFF
     C           *IN76     ANDEQ*OFF                                                          CLE036
     C                     MOVE *BLANKS   ERRMID
     C           SACTN     IFEQ 'A'                                       123857
     C                     TESTN          SNRODB     85    *on means numeric
     C                     MOVE SNRODB    ZDATE
     C                     ELSE                                           123857
     C                     TESTN          SNROD      85    *on means numer123857
     C                     MOVE SNROD     ZDATE                           123857
     C                     ENDIF                                          123857
     C                     EXSR ZDATE1
      *
      **  Discount loans, this field is mandatory.
     C           PTYP      IFEQ 63
     C           PTYP      OREQ 65                                        122098
     C           PTYP      OREQ 67                                        122098
     C           SNRODB    IFEQ *BLANKS
     C           SACTN     ANDEQ'A'                                       123857
     C           SNROD     OREQ *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNROD     OREQ *BLANKS                                   CLE030
     C           SACTN     ANDEQ'X'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVEL'LEV0465' ERRMID
     C                     ENDIF
     C                     ENDIF
      *
      ****Next*Rollover*date*entered,*an*amended*Rollover*date*           128146
      ****must*exist.******************************************           128146
     C                     SELEC
     C***********SNRODB    WHNE *BLANKS                                   128146
     C***********VRLDT     ANDEQ*ZEROS                                    128146
     C***********          MOVEL'LEV0289' ERRMID                          128146
      *
      **  Next Rollover date entered and no valid amended
      **  Rollover date, the Rollover date of the loan must exist.
     C           SNRODB    WHNE *BLANKS
     C           VRLDT     ANDEQ*ZEROS
     C           RLDT      ANDEQ*ZEROS
     C                     MOVEL'LEV0289' ERRMID
      *
      **  Must be numeric.
     C           SNRODB    WHNE *BLANKS
     C           *IN85     ANDEQ*OFF
     C           SNROD     ORNE *BLANKS                                   123857
     C           *IN85     ANDEQ*OFF                                      123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNROD     ORNE *BLANKS                                   CLE030
     C           *IN85     ANDEQ*OFF                                      CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVEL'LEV1014' ERRMID
      *
      **  Must be in valid date format.
     C           SNRODB    WHNE *BLANKS
     C           *IN99     ANDEQ*ON
     C           SNROD     WHNE *BLANKS                                   123857
     C           *IN99     ANDEQ*ON                                       123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNROD     WHNE *BLANKS                                   CLE030
     C           *IN99     ANDEQ*ON                                       CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVEL'LEV1014' ERRMID
      *
      **  Must be greater than Rollover date of the loan
      **  if amended Rollover date is not valid or blank.
      **  OR, must be greater than the valid amended Rollover date.
     C           SNRODB    WHNE *BLANKS
     C           *IN99     ANDEQ*OFF
      *
     C           VRLDT     IFEQ *ZEROS
     C           ZDAYNO    ANDLERLDT
     C           VRLDT     ORNE *ZEROS
     C           ZDAYNO    ANDLEVRLDT
     C                     MOVEL'LEV0289' ERRMID
     C                     ENDIF
      *
      **  Must be greater than Value date of the loan,
      **  (only if Backvaluation feature is switched off)
      **  and less than Maturity date.
      **  If BLI LE Enhancement feature *ON,
      **  then it must be less than New Maturity date.
      **  Validation against maturity date only for
      **  non-discount loans.
     C           ZDAYNO    IFLE VDAT
     C           CLE003    ANDNE'Y'
     C                     MOVEL'LEV1031' ERRMID
     C                     ENDIF
     C           *IN60     IFEQ *ON
     C           PTYP      ANDNE63
     C           PTYP      ANDNE65                                        122098
     C           PTYP      ANDNE67                                        122098
     C           VNMDT     ANDNE*ZEROS
     C           ZDAYNO    IFGE VNMDT
     C                     MOVEL'LEV1038' ERRMID
     C                     ENDIF
     C                     ELSE
     C           PTYP      IFNE 63
     C           PTYP      ANDNE65                                        122098
     C           PTYP      ANDNE67                                        122098
     C           ZDAYNO    ANDGEMDAT
     C           MDAT      ANDNE*ZEROS                                    144688
     C                     MOVEL'LEV1038' ERRMID
     C                     ENDIF
     C                     ENDIF
     C           ZDAYNO    IFGE DTEX                                      144688
     C           MDAT      ANDEQ0                                         144688
     C                     MOVEL'LEV1043' ERRMID                          144688
     C                     ENDIF                                          144688
      *
     C                     ENDSL
      *                                                                   CLE030
      ** For CLE030 send a warning message if the next rollover date      CLE030
      ** is is after the facility last availablity date but before        CLE030
      ** the Facility Expiry Date                                         CLE030
      *                                                                   CLE030
     C           SACTN     IFEQ 'A'                                       CLE030
     C           ZDAYNO    ANDNE*ZEROS                                    CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           ZDAYNO    ANDGTVRLDT                                     CLE030
     C           ZDAYNO    ANDGTAVLD                                      CLE030
     C           ZDAYNO    ANDLTDTEX                                      CLE030
     C           ZDAYNO    ANDNEW#NRLD                                    CLE030
     C           SACTN     OREQ 'X'                                       CLE030
     C           ZDAYNO    ANDNE*ZEROS                                    CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           ZDAYNO    ANDGTVRLDT                                     CLE030
     C           ZDAYNO    ANDGTAVLD                                      CLE030
     C           ZDAYNO    ANDLTDTEX                                      CLE030
     C           ZDAYNO    ANDNEW#NRLD                                    CLE030
     C                     Z-ADDZDAYNO    W#NRLD  50                      CLE030
     C           SACTN     IFEQ 'X'                                       CLE030
     C                     MOVE 'Q'       W#RSTS                          CLE030
     C                     ENDIF                                          CLE030
     C                     MOVE 'LEV0173' ERRMID                          CLE030
      *                                                                   CLE030
     C                     ENDIF                                          CLE030
      *                                                                   CLE030
      *
     C           ERRMID    IFNE *BLANKS
     C                     MOVE *ON       *IN46
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C           SNRODB    IFNE *BLANKS
     C                     MOVE SNRODB    SNRODB
     C                     Z-ADDZDAYNO    VNROD
     C                     ENDIF
     C           SNROD     IFNE *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNROD     ORNE *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     Z-ADDZDAYNO    VNROD                           123857
     C                     ENDIF                                          123857
     C                     ENDIF
     C                     ENDIF
     C***                                                                 158483
     C           *IN46     IFNE '1'                                       158483
     C           VNROD     ANDNE0                                         158483
     C           VNIDT     ANDNE0                                         158483
     C           VNIPD     ANDEQ0                                         158483
     C           VNROD     ANDGTVNIDT                                     158483
     C           IPFR      ANDEQ'R'                                                           175698
     C                     Z-ADDVNROD     VNIPD                           158483
     C                     END                                            158483
     C***                                                                 158483
      *
      **  New rollover details should be complete or none at all.
      **  New base rate is empty, thus, new spread indicator,
      **  new interest calc basis and new change indicator must all       155907
      **  be empty; and new spread/rate must be empty or has a valid      155907
      **  entry.                                                          155907
      ****new*interest*calc*basis,*new*change*indicator*and************   155907
      ****next*rollover*date*must*all*be*empty;*and********************   155907
      ****new*spread/rate*must*be*empty*or*has*a*valid*entry.**********   155907
      *
     C           RMVINT    IFEQ *OFF
     C           SACTN     ANDEQ'A'                                       123857
     C                     MOVE *OFF      WLOGIC
     C           SNRTSB    IFEQ *BLANKS
     C           VNRTS     ORNE *ZERO
     C                     MOVE *ON       WLOGIC  1
     C                     ENDIF
      *                                                                                       CLE036
     C           CLE036    IFEQ 'N'                                                           CLE036
      *                                                                                       CLE036
     C           SNBRAB    IFEQ *BLANKS
     C           SNSINB    ANDEQ*BLANK
     C           SNCASB    ANDEQ*BLANK
     C           SNCHIB    ANDEQ*BLANK
     C***********SNRODB    ANDEQ*BLANKS                                   155907
     C           WLOGIC    ANDEQ*ON
     C                     ELSE
     C           SNBRAB    IFNE *BLANKS
     C           SNSINB    ANDNE*BLANK
     C           SNCASB    ANDNE*BLANK
     C           SNCHIB    ANDNE*BLANK
     C***********SNRODB    ANDNE*BLANKS                                   155907
     C           WLOGIC    ANDEQ*ON
     C                     ELSE
     C           WNSIN     IFEQ *BLANK
     C           WFLAG     ANDEQ'N'                                       144916
     C           WNCHI     OREQ *BLANK
     C           WFLAG     ANDEQ'N'                                       144916
     C***********          MOVEA'111111'  *IN,41                          155907
     C                     MOVEA'11111'   *IN,41                          155907
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV0288' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CLE036
     C                     ELSE                                                               CLE036
      *                                                                                       CLE036
     C           SNBRAB    IFEQ *BLANKS                                                       CLE036
     C           SNBRTB    ANDEQ*BLANKS                                                       CLE036
     C           SNSINB    ANDEQ*BLANK                                                        CLE036
     C           SNCASB    ANDEQ*BLANK                                                        CLE036
     C           SNCHIB    ANDEQ*BLANK                                                        CLE036
     C           WLOGIC    ANDEQ*ON                                                           CLE036
     C           WNBRA1    OREQ '*'                                                           CLE036
     C           SNBRTB    ANDEQ*BLANKS                                                       CLE036
     C           SNBRT     ANDEQ*BLANKS                                                       CLE036
     C           WNBRT1    OREQ '*'                                                           CLE036
     C           SNBRAB    ANDEQ*BLANKS                                                       CLE036
     C           SNBRA     ANDEQ*BLANKS                                                       CLE036
     C                     ELSE                                                               CLE036
     C           SNBRAB    IFNE *BLANKS                                                       CLE036
     C           SNSINB    ANDNE*BLANK                                                        CLE036
     C           SNCASB    ANDNE*BLANK                                                        CLE036
     C           SNCHIB    ANDNE*BLANK                                                        CLE036
     C           WLOGIC    ANDEQ*ON                                                           CLE036
     C           SNBRTB    ORNE *BLANKS                                                       CLE036
     C           SNSINB    ANDNE*BLANK                                                        CLE036
     C           SNCASB    ANDNE*BLANK                                                        CLE036
     C           SNCHIB    ANDNE*BLANK                                                        CLE036
     C           WLOGIC    ANDEQ*ON                                                           CLE036
     C                     ELSE                                                               CLE036
     C           WNSIN     IFEQ *BLANK                                                        CLE036
     C           WFLAG     ANDEQ'N'                                                           CLE036
     C           WNCHI     OREQ *BLANK                                                        CLE036
     C           WFLAG     ANDEQ'N'                                                           CLE036
     C                     SELEC                                                              CLE036
     C           SNBRTB    WHNE *BLANKS                                                       CLE036
     C           WNBRT1    ANDNE'*'                                                           CLE036
     C                     MOVE *ON       *IN76                                               CLE036
     C           SNBRAB    WHNE *BLANKS                                                       CLE036
     C           WNBRA1    ANDNE'*'                                                           CLE036
     C                     MOVE *ON       *IN41                                               CLE036
     C           SNBRTB    WHEQ *BLANKS                                                       CLE036
     C           SNBRAB    ANDEQ*BLANKS                                                       CLE036
     C                     MOVE *ON       *IN76                                               CLE036
     C                     MOVE *ON       *IN41                                               CLE036
     C                     ENDSL                                                              CLE036
     C                     MOVEA'1111'    *IN,42                                              CLE036
     C                     MOVE *ON       ERRDET                                              CLE036
     C                     MOVEL'LEV1073' ZAMSID                                              CLE036
     C                     EXSR ZASNMS                                                        CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF
      *                                                                                       CAS001
      ** Validate Forward Yield Curve                                                         CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C           *IN73     ANDEQ*ON                                                           CAS001
      *                                                                                       CAS001
     C                     CALL 'AOLOANR0'                                                    CAS001
     C                     PARM *BLANKS   PRTCD                                               CAS001
     C                     PARM '*KEY   ' POPTN                                               CAS001
     C                     PARM LTYP      PLNTP   2                                           CAS001
     C                     PARM SUTP      PLNST   2                                           CAS001
     C           SDLOAN    PARM SDLOAN    DSFDY                                               CAS001
      *                                                                                       CAS001
     C           PRTCD     IFNE *BLANKS                                                       CAS001
     C           *LOCK     IN   LDA                                                           CAS001
     C                     MOVEL'SDLOANPD'DBFILE                                              CAS001
     C                     Z-ADD56        DBASE                                               CAS001
     C           LTYP      CAT  SUTP      DBKEY                                               CAS001
     C                     OUT  LDA                                                           CAS001
     C                     EXSR *PSSR                                                         CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Validate Forward Yield Curve                                                         CAS001
      *                                                                                       CAS001
     C           SNBRAB    IFNE *BLANKS                                                       CAS001
     C           WNFYLD    ANDNE'*'                                                           CAS001
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           SNBRTB    ANDNE*BLANKS                                                       CLE036
     C           WNFYLD    ANDNE'*'                                                           CLE036
      *                                                                                       CAS001
     C           SFYLDB    IFNE *BLANKS                                                       CAS001
     C                     CALL 'AOYLDCR0'                                                    CAS001
     C                     PARM '*BLANKS' PRTCD                                               CAS001
     C                     PARM '*KEY   ' POPTN                                               CAS001
     C                     PARM SFYLDB    PPYLDC  5                                           CAS001
     C           SDYLDC    PARM SDYLDC    DSSDY                                               CAS001
      *                                                                                       CAS001
      ** Error on the Yield Curve entered                                                     CAS001
      *                                                                                       CAS001
     C           PRTCD     IFEQ '*NRF   '                                                     CAS001
     C                     MOVE *ON       *IN74                                               CAS001
     C                     MOVE *ON       ERRDET                                              CAS001
     C                     MOVEL'LEV1057' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
      ** If no selection was made, default to the value of the Forward                        CAS001
      ** Yield Curve for the loan type/subtype                                                CAS001
      *                                                                                       CAS001
     C           PRTCD     IFEQ '*NOSEL '                                                     CAS001
      *                                                                                       CAS001
      ** Check if Yield Curve Mandatory flag is 'Y'.                                          CAS001
      ** Generate error if no default value set in loan                                       CAS001
      ** type/subtype file.                                                                   CAS001
      *                                                                                       CAS001
     C           AYYLDM    IFEQ 'Y'                                                           CAS001
     C           AYFYLD    ANDEQ*BLANKS                                                       CAS001
     C                     MOVE *ON       *IN74                                               CAS001
     C                     MOVE *ON       ERRDET                                              CAS001
     C                     MOVEL'LEV1063' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
     C                     MOVE AYFYLD    SFYLDB                                              CAS001
      *                                                                                       CAS001
      ** Access yield curves file to get the details                                          CAS001
      *                                                                                       CAS001
     C           SFYLDB    IFNE *BLANK                                                        CAS001
     C                     CALL 'AOYLDCR0'                                                    CAS001
     C                     PARM '*BLANKS' PRTCD                                               CAS001
     C                     PARM '*KEY   ' POPTN                                               CAS001
     C                     PARM SFYLDB    PPYLDC                                              CAS001
     C           SDYLDC    PARM SDYLDC    DSSDY                                               CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Valid yield curve selected                                                           CAS001
      *                                                                                       CAS001
     C                     ELSE                                                               CAS001
     C                     MOVELFSYLDC    SFYLDB                                              CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Error if Non Zero-coupon Yield Curve                                                 CAS001
      ** And Non Swap Rate Yield Curve.                                                       228390
      *                                                                                       CAS001
     C           FSYLDT    IFNE 'Z'                                                           CAS001
     C           FSYLDT    ANDNE'S'                                                           228390
     C                     MOVE *ON       *IN74                                               CAS001
     C                     MOVE *ON       ERRDET                                              CAS001
     C**********           MOVEL'LEV1061' ZAMSID                                        CAS001207273
     C                     MOVEL'LEV1066' ZAMSID                                              207273
     C                     EXSR ZASNMS                                                        CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Error if Interpolation Method is neither 'Y' nor 'R'                                 CAS001
      *                                                                                       CAS001
     C           FSINTP    IFNE 'Y'                                                           CAS001
     C           FSINTP    ANDNE'R'                                                           CAS001
     C                     MOVE *ON       *IN74                                               CAS001
     C                     MOVE *ON       ERRDET                                              CAS001
     C                     MOVEL'LEV1062' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** If Forward Yield Curve is not entered, default value will                            CAS001
      ** come from SDLOANPD                                                                   CAS001
      *                                                                                       CAS001
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
      ** Check if Yield Curve Mandatory flag is 'Y'.                                          CAS001
      ** Generate error if no default value set in loan                                       CAS001
      ** type/subtype file.                                                                   CAS001
      *                                                                                       CAS001
     C           AYYLDM    IFEQ 'Y'                                                           CAS001
     C           AYFYLD    ANDEQ*BLANKS                                                       CAS001
     C                     MOVE *ON       *IN74                                               CAS001
     C                     MOVE *ON       ERRDET                                              CAS001
     C                     MOVEL'LEV1063' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C**********           ENDIF                                                       CAS001 207273
     C                     ELSE                                                               207273
     C                     MOVE AYFYLD    SFYLDB                                              CAS001
      *                                                                                       207273
      ** Access yield curves file to get the details                                          207273
      *                                                                                       207273
     C           SFYLDB    IFNE *BLANK                                                        207273
     C                     CALL 'AOYLDCR0'                                                    207273
     C                     PARM '*BLANKS' PRTCD                                               207273
     C                     PARM '*KEY   ' POPTN                                               207273
     C                     PARM SFYLDB    PPYLDC                                              207273
     C           SDYLDC    PARM SDYLDC    DSSDY                                               207273
     C                     ENDIF                                                              207273
     C                     ENDIF                                                              207273
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     MOVE SFYLDB    VNFYLD                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
     C/COPY WNCPYSRC,LE2070C014
      **********                                                                              CLE031
      ****New*principal * * * * * * * * * * * * * * * * * * * * * * * *                       CLE031
      **********                                                                              CLE031
     C********** WNPRA1    IFNE '*'                                                           CLE031
     C**********           MOVE *BLANKS   ERRMID                                              CLE031
     C**********           MOVELCCY       PCURR                                               CLE031
     C**********           Z-ADD54        DBASE                                               CLE031
     C**********           MOVE *ON       EDBAS                                               CLE031
     C**********           EXSR SRCURR                                                        CLE031
     C**********           MOVE *BLANKS   ZFIELD                                              CLE031
     C********** SACTN     IFEQ 'A'                                                    123857 CLE031
     C**********           MOVE SNPRAB    ZFIELD                                              CLE031
     C**********           ELSE                                                        123857 CLE031
     C**********           MOVE SNPRAM    ZFIELD                                       123857 CLE031
     C**********           ENDIF                                                       123857 CLE031
     C**********           MOVE A6NBDP    WNBDP   10                                          CLE031
     C********** 13        SUB  WNBDP     ZADIG                                               CLE031
     C**********           Z-ADDA6NBDP    ZADEC                                               CLE031
     C**********           EXSR ZALIGN                                                        CLE031
     C**********           MOVE ZFIELD    WNPRAM 130                                          CLE031
      **********                                                                              CLE031
      ****Forbidden*for*Non-discount*loans.****************************                       CLE031
     C**********           SELEC                                                              CLE031
     C********** PTYP      WHNE 63                                                            CLE031
     C********** PTYP      ANDNE65                                                     122098 CLE031
     C********** PTYP      ANDNE67                                                     122098 CLE031
     C********** SNPRAB    ANDNE*BLANKS                                                       CLE031
     C********** PTYP      ORNE 63                                                     123857 CLE031
     C********** PTYP      ANDNE65                                                     123857 CLE031
     C********** PTYP      ANDNE67                                                     123857 CLE031
     C********** SNPRAM    ANDNE*BLANKS                                                123857 CLE031
     C********** SACTN     ANDEQ'X'                                                    123857 CLE031
     C**********           MOVEL'LEV0466' ERRMID                                              CLE031
      **********                                                                              CLE031
      ****For*discount*loans,*default*to*New*or*Current*principal******                       CLE031
      ****if*entry*is*blank.*******************************************                       CLE031
     C********** PTYP      WHEQ 63                                                            CLE031
     C********** SNPRAB    ANDEQ*BLANKS                                                       CLE031
     C********** SACTN     ANDEQ'A'                                                    123857 CLE031
     C********** PTYP      OREQ 65                                                     122098 CLE031
     C********** SNPRAB    ANDEQ*BLANKS                                                122098 CLE031
     C********** SACTN     ANDEQ'A'                                                    123857 CLE031
     C********** PTYP      OREQ 67                                                     122098 CLE031
     C********** SNPRAB    ANDEQ*BLANKS                                                122098 CLE031
     C********** SACTN     ANDEQ'A'                                                    123857 CLE031
     C********** NPRAM     IFNE *ZEROS                                                        CLE031
     C**********           Z-ADDNPRAM     WNPRAM                                              CLE031
     C**********           ELSE                                                               CLE031
     C**********           Z-ADDCPAM      WNPRAM                                              CLE031
     C**********           ENDIF                                                              CLE031
      **********                                                                              CLE031
      ****Must*be*a*valid*numeric*amount*******************************                       CLE031
     C********** PTYP      WHEQ 63                                                            CLE031
     C********** *IN99     ANDEQ*ON                                                           CLE031
     C********** PTYP      OREQ 65                                                     122098 CLE031
     C********** *IN99     ANDEQ*ON                                                    122098 CLE031
     C********** PTYP      OREQ 67                                                     122098 CLE031
     C********** *IN99     ANDEQ*ON                                                    122098 CLE031
     C**********           MOVEL'LEV0460' ERRMID                                              CLE031
      **********                                                                              CLE031
      ****Must*be*less*than*or*equal*to*Current************************                       CLE031
      ****principal*amount.********************************************                       CLE031
     C********** PTYP      WHEQ 63                                                            CLE031
     C********** *IN99     ANDEQ*OFF                                                          CLE031
     C********** WNPRAM    ANDGTCPAM                                                          CLE031
     C********** PTYP      OREQ 65                                                     122098 CLE031
     C********** *IN99     ANDEQ*OFF                                                   122098 CLE031
     C********** WNPRAM    ANDGTCPAM                                                   122098 CLE031
     C********** PTYP      OREQ 67                                                     122098 CLE031
     C********** *IN99     ANDEQ*OFF                                                   122098 CLE031
     C********** WNPRAM    ANDGTCPAM                                                   122098 CLE031
     C**********           MOVEL'LEV0461' ERRMID                                              CLE031
     C**********           ENDSL                                                              CLE031
      **********                                                                              CLE031
     C********** ERRMID    IFNE *BLANKS                                                       CLE031
     C**********           MOVE *ON       *IN47                                               CLE031
     C**********           MOVE *ON       ERRDET                                              CLE031
     C**********           MOVELERRMID    ZAMSID                                              CLE031
     C**********           EXSR ZASNMS                                                        CLE031
     C**********           ELSE                                                               CLE031
     C********** WNPRAM    IFNE *ZEROS                                                        CLE031
     C**********           Z-ADDWNPRAM    VNPRAM                                              CLE031
     C**********           MOVE WNPRAM    ZFIELD                                              CLE031
     C**********           EXSR ZEDIT                                                         CLE031
     C********** SACTN     IFEQ 'A'                                                    123857 CLE031
     C**********           MOVE ZFIELD    SNPRAB                                              CLE031
     C**********           ENDIF                                                       123857 CLE031
     C**********           ENDIF                                                              CLE031
     C**********           ENDIF                                                              CLE031
     C**********           ENDIF                                                              CLE031
      **********                                                                              CLE031
      ****Validate*remove*request*on*rollover*details.*****************                       CLE031
      **********                                                                              CLE031
      ****Remove*values*of*fields*as*requested.************************                       CLE031
     C********** PTYP      IFEQ 63                                                            CLE031
     C********** WNPRA1    ANDEQ'*'                                                           CLE031
     C********** WNDAM1    ANDEQ'*'                                                           CLE031
     C********** PTYP      OREQ 65                                                     122098 CLE031
     C********** WNPRA1    ANDEQ'*'                                                    122098 CLE031
     C********** WNDAM1    ANDEQ'*'                                                    122098 CLE031
     C********** PTYP      OREQ 67                                                     122098 CLE031
     C********** WNPRA1    ANDEQ'*'                                                    122098 CLE031
     C********** WNDAM1    ANDEQ'*'                                                    122098 CLE031
     C**********           Z-ADD*ZEROS    VNPRAM                                              CLE031
     C**********           Z-ADD*ZEROS    VNDAM                                               CLE031
      **********                                                                              CLE031
      ****For*Discount loans, if a '*' is in the first position                               CLE031
      ****of*New principal amount, then New discount amount                                   CLE031
      ****must*have*'*'s*in*its*first*positions.***********************                       CLE031
     C**********           ELSE                                                               CLE031
     C********** PTYP      IFEQ 63                                                            CLE031
     C********** WNPRA1    ANDNE'*'                                                           CLE031
     C********** WNDAM1    ANDNE'*'                                                           CLE031
     C********** PTYP      OREQ 65                                                     122098 CLE031
     C********** WNPRA1    ANDNE'*'                                                    122098 CLE031
     C********** WNDAM1    ANDNE'*'                                                    122098 CLE031
     C********** PTYP      OREQ 67                                                     122098 CLE031
     C********** WNPRA1    ANDNE'*'                                                    122098 CLE031
     C********** WNDAM1    ANDNE'*'                                                    122098 CLE031
     C**********           ELSE                                                               CLE031
     C********** PTYP      IFEQ 63                                                            CLE031
     C********** PTYP      OREQ 65                                                     122098 CLE031
     C********** PTYP      OREQ 67                                                     122098 CLE031
     C**********           MOVEA'11'      *IN,47                                              CLE031
     C**********           MOVE *ON       ERRDET                                              CLE031
     C**********           MOVEL'LEV0468' ZAMSID                                              CLE031
     C**********           EXSR ZASNMS                                                        CLE031
     C**********           ENDIF                                                              CLE031
     C**********           ENDIF                                                              CLE031
     C**********           ENDIF                                                              CLE031
      **********                                                                              CLE031
      ****New*discount*amount * * * * * * * * * * * * * * * * * * * * *                       CLE031
      **********                                                                              CLE031
     C********** WNDAM1    IFNE '*'                                                           CLE031
     C**********           MOVE *BLANKS   ERRMID                                              CLE031
     C**********           MOVELCCY       PCURR                                               CLE031
     C**********           Z-ADD55        DBASE                                               CLE031
     C**********           MOVE *ON       EDBAS                                               CLE031
     C**********           EXSR SRCURR                                                        CLE031
     C**********           MOVE *BLANKS   ZFIELD                                              CLE031
     C********** SACTN     IFEQ 'A'                                                    123857 CLE031
     C**********           MOVE SNDAMB    ZFIELD                                              CLE031
     C**********           ELSE                                                        123857 CLE031
     C**********           MOVE SNDAM     ZFIELD                                       123857 CLE031
     C**********           ENDIF                                                       123857 CLE031
     C**********           MOVE A6NBDP    WNBDP                                               CLE031
     C********** 13        SUB  WNBDP     ZADIG                                               CLE031
     C**********           Z-ADDA6NBDP    ZADEC                                               CLE031
     C**********           EXSR ZALIGN                                                        CLE031
     C**********           MOVE ZFIELD    WNDAM  130                                          CLE031
      **********                                                                              CLE031
      ****Forbidden*for*Non-discount*loans.****************************                       CLE031
     C**********           SELEC                                                              CLE031
     C********** PTYP      WHNE 63                                                            CLE031
     C********** PTYP      ANDNE65                                                     122098 CLE031
     C********** PTYP      ANDNE67                                                     122098 CLE031
     C********** SNDAMB    ANDNE*BLANKS                                                       CLE031
     C********** PTYP      ORNE 63                                                     123857 CLE031
     C********** PTYP      ANDNE65                                                     123857 CLE031
     C********** PTYP      ANDNE67                                                     123857 CLE031
     C********** SNDAM     ANDNE*BLANKS                                                123857 CLE031
     C********** SACTN     ANDEQ'X'                                                    123857 CLE031
     C**********           MOVEL'LEV0466' ERRMID                                              CLE031
      **********                                                                              CLE031
      ****Mandatory*for*Discount*loans.********************************                       CLE031
     C********** PTYP      WHEQ 63                                                            CLE031
     C********** SNDAMB    ANDEQ*BLANKS                                                       CLE031
     C********** SACTN     ANDEQ'A'                                                    123857 CLE031
     C********** PTYP      OREQ 65                                                     122098 CLE031
     C********** SNDAMB    ANDEQ*BLANKS                                                122098 CLE031
     C********** SACTN     ANDEQ'A'                                                    123857 CLE031
     C********** PTYP      OREQ 67                                                     122098 CLE031
     C********** SNDAMB    ANDEQ*BLANKS                                                122098 CLE031
     C********** SACTN     ANDEQ'A'                                                    123857 CLE031
      **********                                                                       123857 CLE031
     C********** PTYP      OREQ 63                                                     123857 CLE031
     C********** SNDAM     ANDEQ*BLANKS                                                123857 CLE031
     C********** SACTN     ANDEQ'X'                                                    123857 CLE031
     C********** PTYP      OREQ 65                                                     123857 CLE031
     C********** SNDAM     ANDEQ*BLANKS                                                123857 CLE031
     C********** SACTN     ANDEQ'X'                                                    123857 CLE031
     C********** PTYP      OREQ 67                                                     123857 CLE031
     C********** SNDAM     ANDEQ*BLANKS                                                123857 CLE031
     C********** SACTN     ANDEQ'X'                                                    123857 CLE031
     C**********           MOVEL'LEV0462' ERRMID                                              CLE031
      **********                                                                              CLE031
      ****Must*be*a*valid*numeric*amount.******************************                       CLE031
     C********** PTYP      WHEQ 63                                                            CLE031
     C********** *IN99     ANDEQ*ON                                                           CLE031
     C********** PTYP      OREQ 65                                                     122098 CLE031
     C********** *IN99     ANDEQ*ON                                                    122098 CLE031
     C********** PTYP      OREQ 67                                                     122098 CLE031
     C********** *IN99     ANDEQ*ON                                                    122098 CLE031
     C**********           MOVEL'LEV0460' ERRMID                                              CLE031
      **********                                                                              CLE031
      ****Must*agree*with*the*calculated*discount*amount***************                       CLE031
      ****within*1*unit*of*the*loan*currency.**************************                       CLE031
     C********** PTYP      WHEQ 63                                                            CLE031
     C********** ZFIELD    ANDNE*BLANKS                                                       CLE031
     C********** PTYP      OREQ 65                                                     122098 CLE031
     C********** ZFIELD    ANDNE*BLANKS                                                122098 CLE031
     C********** PTYP      OREQ 67                                                     122098 CLE031
     C********** ZFIELD    ANDNE*BLANKS                                                122098 CLE031
     C**********           EXSR SRNDAM                                                        CLE031
     C**********           ENDSL                                                              CLE031
      **********                                                                              CLE031
     C********** ERRMID    IFNE *BLANKS                                                       CLE031
     C**********           MOVE *ON       *IN48                                               CLE031
     C**********           MOVE *ON       ERRDET                                              CLE031
     C**********           MOVELERRMID    ZAMSID                                              CLE031
     C**********           EXSR ZASNMS                                                        CLE031
     C**********           ELSE                                                               CLE031
     C********** WNDAM     IFNE *ZEROS                                                        CLE031
     C**********           Z-ADDWNDAM     VNDAM                                               CLE031
     C**********           EXSR ZEDIT                                                         CLE031
     C********** SACTN     IFEQ 'A'                                                    123857 CLE031
     C**********           MOVE ZFIELD    SNDAMB                                              CLE031
     C**********           ENDIF                                                       123857 CLE031
     C**********           ENDIF                                                              CLE031
     C**********           ENDIF                                                              CLE031
     C**********           ENDIF                                                              CLE031
      *
      **  For multi-currency rollover.
      *
     C           *IN61     IFEQ *ON
      *
      **  If multi-currency rollover not allowed,
      **  entry in these fields are forbidden.
     C           MULTIC    IFEQ *OFF
     C           SNCCYB    IFNE *BLANKS
     C           SNCPAB    ORNE *BLANKS
     C           SNFCEB    ORNE *BLANKS
     C           *IN67     ANDEQ*OFF                                                          CLE023
     C           SNFMDB    ORNE *BLANKS
     C           *IN67     ANDEQ*OFF                                                          CLE023
     C           SNBCEB    ORNE *BLANKS                                   123335
     C           SNBMDB    ORNE *BLANKS                                   123335
     C           SNLRAB    ORNE *BLANKS
     C                     MOVEA'11111'   *IN,51
     C                     MOVEA'11'      *IN,64                          123335
     C                     MOVE *ON       ERRDET
      *                                                                   134725
     C           WERLN     IFEQ 'Y'                                       134725
     C                     MOVEL'LEV1047' ZAMSID                          134725
     C                     MOVELWLNNO     ZAMSDA                          134725
     C                     ELSE                                           134725
     C                     MOVEL'LEV1033' ZAMSID
     C                     ENDIF                                          134725
      *                                                                   134725
     C                     EXSR ZASNMS
      *                                                                   123857
     C                     ELSE                                           123857
     C           SNCCY     IFNE *BLANKS                                   123857
     C           SNCPA     ORNE *BLANKS                                   123857
     C           SNFCE     ORNE *BLANKS                                   123857
     C           *IN67     ANDEQ*OFF                                                          CLE023
     C           SNFMD     ORNE *BLANKS                                   123857
     C           *IN67     ANDEQ*OFF                                                          CLE023
     C           SNBCE     ORNE *BLANKS                                   123857
     C           SNBMD     ORNE *BLANKS                                   123857
     C           SNLRA     ORNE *BLANKS                                   123857
     C                     MOVE *ON       ERRDET                          123857
      *                                                                   134725
     C           WERLN     IFEQ 'Y'                                       134725
     C                     MOVEL'LEV1047' ZAMSID                          134725
     C                     MOVELWLNNO     ZAMSDA                          134725
     C                     ELSE                                           134725
     C                     MOVEL'LEV1033' ZAMSID                          123857
     C                     ENDIF                                          134725
      *                                                                   134725
     C                     EXSR ZASNMS                                    123857
     C                     ENDIF                                          123857
     C                     ENDIF
     C                     ENDIF
      *
      **  New currency  * * * * * * * * * * * * * * * * * * * * * * * *
      *
     C           WNCCY1    IFNE '*'
     C           MULTIC    ANDEQ*ON
     C                     MOVE *BLANKS   ERRMID
     C                     MOVE *OFF      *IN85
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVELSNCCYB    PCURR
     C                     ELSE                                           123857
     C                     MOVELSNCCY     PCURR                           123857
     C                     ENDIF                                          123857
     C                     MOVE *BLANKS   A6CYCD
     C                     MOVE *OFF      EDBAS
     C                     EXSR SRCURR
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVELPCURR     SNCCYB
     C                     ENDIF                                          123857
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SNCCYB
     C                     ENDIF
     C           WNCCY1    IFEQ '?'
     C                     MOVE *ON       SELDON
     C                     ENDIF
     C           PRTCD     IFEQ *BLANKS
     C           CSEL      IFEQ 'Y'
     C           SACTN     IFEQ 'A'                                       123857
     C           SNCCYB    LOKUPACCYA                    85*on means found
     C                     ELSE                                           123857
     C           SNCCY     LOKUPACCYA                    85*on means found123857
     C                     ENDIF                                          123857
     C                     ELSE
     C                     MOVE *ON       *IN85
     C                     ENDIF                                          165968
      *                                                                   CEU020
      ****If*CEU020*is*installed*and*new*currency*is*not*equal*to*ECEU020 165968
      ****currency,*display*error*message**************************CEU020 165968
      ** If CEU020 is installed allow new currency to be equal to Euro    165968
      ** if rolling over from 'IN' currency.                              165968
      *                                                                   CEU020
     C           CEU020    IFEQ 'Y'                                       CEU020
     C           *IN85     ANDEQ'0'                                       165968
     C           SACTN     ANDEQ'A'                                       CEU020
     C           SNCCYB    ANDNE*BLANKS                                   CEU020
     C           SNCCYB    IFEQ BKEURO                                    CEU020
     C           WINCY     IFEQ 'Y'                                       CEU020
     C                     MOVE '1'       *IN85                           CEU020
     C***********          ELSE                                    CEU020 165968
     C***********          MOVE '0'       *IN85                    CEU020 165968
     C                     ENDIF                                          CEU020
     C                     ENDIF                                          CEU020
     C                     ENDIF                                          CEU020
     C***********          ENDIF                                          165968
     C                     ENDIF
      *
     C                     SELEC
     C           SNCCYB    WHEQ *BLANKS
     C           CLE030    ANDEQ'N'                                       CLE030
     C           SNCCY     OREQ *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNCCY     OREQ *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *
      **  Must be a valid currency code and specified
      **  in the facility to which the loan is linked.
     C           SNCCYB    WHNE *BLANKS
     C           *IN85     ANDEQ*OFF
     C           SNCCY     ORNE *BLANKS                                   123857
     C           *IN85     ANDEQ*OFF                                      123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNCCY     ORNE *BLANKS                                   CLE030
     C           *IN85     ANDEQ*OFF                                      CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           CEU020    IFEQ 'Y'                                       CEU020
     C           WINCY     ANDEQ'Y'                                       CEU020
     C                     MOVEL'LEV0022' ERRMID                          CEU020
     C                     ELSE                                           CEU020
      *                                                                   CLE030
      ** If CLE030 is switched on then don't send error message           CLE030
      *                                                                   CLE030
     C           CLE030    IFNE 'Y'                                       CLE030
     C                     MOVEL'LEV1023' ERRMID
     C                     ELSE                                           CLE030
      *                                                                   CLE030
      ** If CLE030 is switched on, make the message only a warning        CLE030
      ** error if the currency is not on the list of allowable            CLE030
      ** currencies for that facility.                                    CLE030
      ** If the action code is 'A' then the currency field in error       CLE030
      ** will be SNCCYB, and if the action code is 'X' then it will       CLE030
      ** be SNCCY that holds the new currency.                            CLE030
      *                                                                   CLE030
     C           SACTN     IFEQ 'A'                                       CLE030
     C           WSNCCY    IFNE SNCCYB                                    CLE030
     C                     MOVE SNCCYB    WSNCCY  3                       CLE030
     C                     MOVE 'LEV0169' ERRMID                          CLE030
     C                     ENDIF                                          CLE030
      *                                                                   CLE030
     C                     ELSE                                           CLE030
      *                                                                   CLE030
     C           WSNCCY    IFNE SNCCY                                     CLE030
     C                     MOVE SNCCY     WSNCCY  3                       CLE030
     C                     MOVE 'LEV0169' ERRMID                          CLE030
     C           SACTN     IFEQ 'X'                                       CLE030
     C                     MOVE 'Q'       W#RSTS  1                       CLE030
     C                     ELSE                                           CLE030
     C                     MOVE ' '       W#RSTS                          CLE030
     C                     ENDIF                                          CLE030
     C                     ENDIF                                          CLE030
     C                     ENDIF                                          CLE030
     C                     ENDIF                                          CLE030
     C                     ENDIF                                          CEU020
      *
      **  Must not be equal to new currency in the file
      **  or not equal to the loan currency.
      **  except when in batch mode, where it is allowed                  121793
     C           SNCCYB    WHNE *BLANKS
     C           NCCY      ANDNE*BLANKS
     C           NCCY      ANDEQSNCCYB
     C           SACTN     ANDEQ'A'                                       123857
     C           SNCCYB    ORNE *BLANKS
     C           CCY       ANDEQSNCCYB
     C           SACTN     ANDEQ'A'                                       123857
     C           SNCCY     ORNE *BLANKS                                   123857
     C           CCY       ANDEQSNCCY                                     123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNCCY     ORNE *BLANKS                                   CLE030
     C           CCY       ANDEQSNCCY                                     CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           PMODE     IFNE 'B'                                       121793
     C                     MOVEL'LEV1036' ERRMID
     C                     ENDIF                                          121793
      *                                                                                       CLE023
     C           SNCCYB    WHNE *BLANKS                                                       CLE023
     C           NCCY      ANDEQ*BLANKS                                                       CLE023
     C           NFCE      ANDNE*ZERO                                                         CLE023
     C           WFCXRA    ANDEQ'N'                                                           CLE023
     C           *IN67     ANDEQ*ON                                                           CLE023
     C                     MOVEA'11'      *IN,53                                              CLE023
      *                                                                                       219403
      ** 'See second level text' should not appear on Loan Manager.                           219403
     C           PMODE     IFEQ 'B'                                                           219403
     C                     MOVEL'LEV9002' ZAMSID                                              219403
     C                     ELSE                                                               219403
     C                     MOVEL'LEV1055' ERRMID                                              CLE023
     C                     ENDIF                                                              219403
      *                                                                                       219403
     C                     ENDSL
      *
     C           ERRMID    IFNE *BLANKS
     C                     MOVE *ON       *IN51
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     MOVE SNCCYB    VNCCY
     C           SACTN     IFEQ 'X'                                       123857
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVE SNCCY     VNCCY                           123857
     C                     ENDIF                                          123857
     C                     MOVE A6MDIN    WMDIN   1
     C                     Z-ADDA6SPRT    WSPRT  138
     C                     Z-ADDA6NBDP    W#PWR   10                      123333
     C                     ENDIF
     C                     ENDIF
      *
      **  If one multi-ccy detail is to be removed,
      **  all of them must be removed.
      *
     C           WNCCY1    IFEQ '*'
     C           WNCPA1    ANDEQ'*'
     C           WNFCE1    ANDEQ'*'
     C           WNFMD1    ANDEQ'*'
     C           WNBCE1    ANDEQ'*'                                       123335
     C           WNBMD1    ANDEQ'*'                                       123335
     C           WNLRA1    ANDEQ'*'
     C                     MOVE *BLANKS   VNCCY
     C                     Z-ADD*ZEROS    VNCPA
     C                     Z-ADD*ZEROS    VNFCE
     C                     MOVE *BLANK    VNFMD
     C                     Z-ADD*ZEROS    VNBCE                           123335
     C                     MOVE *BLANK    VNBMD                           123335
     C                     Z-ADD*ZEROS    VNLRA
     C                     ELSE
     C           WNCCY1    IFNE '*'
     C           WNCPA1    ANDNE'*'
     C           WNFCE1    ANDNE'*'
     C           WNFMD1    ANDNE'*'
     C           WNBCE1    ANDNE'*'                                       123335
     C           WNBMD1    ANDNE'*'                                       123335
     C           WNLRA1    ANDNE'*'
     C                     ELSE
     C           MULTIC    IFEQ *ON
     C           *IN67     ANDEQ*OFF                                                          CLE023
     C           MULTIC    OREQ *ON                                                           CLE023
     C           *IN67     ANDEQ*ON                                                           CLE023
     C           SNCCY     ANDNE*BLANKS                                                       CLE023
     C                     MOVEA'11111'   *IN,51
     C                     MOVEA'11'      *IN,64                          123335
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV1034' ZAMSID
     C                     EXSR ZASNMS
      *                                                                                       CLE023
      ** If removal of fields is not for multi-currency details, check                        CLE023
      ** if this is for facility currency exchange rate details                               CLE023
      *                                                                                       CLE023
     C                     ELSE                                                               CLE023
     C           *IN67     IFEQ *ON                                                           CLE023
      *                                                                                       CLE023
     C           WNFCE1    IFEQ '*'                                                           CLE023
     C           WNFMD1    ANDEQ'*'                                                           CLE023
     C                     Z-ADD*ZEROS    VNFCE                                               CLE023
     C                     MOVE *BLANK    VNFMD                                               CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C           WNFCE1    IFEQ '*'                                                           CLE023
     C           WNFMD1    ANDNE'*'                                                           CLE023
     C           WNFCE1    ORNE '*'                                                           CLE023
     C           WNFMD1    ANDEQ'*'                                                           CLE023
     C                     MOVEA'11'      *IN,53                                              CLE023
     C                     MOVE *ON       ERRDET                                              CLE023
     C                     MOVEL'LEV1052' ZAMSID                                              CLE023
     C                     EXSR ZASNMS                                                        CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      **  If New currency was not entered, other multi-ccy
      **  details are forbidden.
      *
     C           SNCCYB    IFEQ *BLANKS
     C           SACTN     ANDEQ'A'                                       123857
     C           SNCPAB    IFNE *BLANKS
     C           SNFCEB    ORNE *BLANKS
     C           *IN67     ANDEQ*OFF                                                          CLE023
     C           SNFMDB    ORNE *BLANK
     C           *IN67     ANDEQ*OFF                                                          CLE023
     C           SNBCEB    ORNE *BLANKS                                   123335
     C           SNBMDB    ORNE *BLANK                                    123335
     C           SNLRAB    ORNE *BLANKS
     C                     MOVEA'11111'   *IN,51
     C                     MOVEA'11'      *IN,64                          123335
     C                     MOVE *ON       ERRDET
     C                     MOVEL'LEV1035' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *                                                                   123857
     C           SNCCY     IFEQ *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNCCY     OREQ *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           SNCPA     IFNE *BLANKS                                   123857
     C           SNFCE     ORNE *BLANKS                                   123857
     C           *IN67     ANDEQ*OFF                                                          CLE023
     C           SNFMD     ORNE *BLANK                                    123857
     C           *IN67     ANDEQ*OFF                                                          CLE023
     C           SNBCE     ORNE *BLANKS                                   123857
     C           SNBMD     ORNE *BLANK                                    123857
     C           SNLRA     ORNE *BLANKS                                   123857
     C                     MOVEA'11111'   *IN,51                          123857
     C                     MOVEA'11'      *IN,64                          123857
     C                     MOVE *ON       ERRDET                          123857
     C                     MOVEL'LEV1035' ZAMSID                          123857
     C                     EXSR ZASNMS                                    123857
     C                     ENDIF                                          123857
     C                     ENDIF                                          123857
      *
      **  New currency amount * * * * * * * * * * * * * * * * * * * * *
      *
     C           WNCPA1    IFNE '*'
     C           MULTIC    ANDEQ*ON
     C           *IN51     ANDEQ*OFF
     C                     MOVE *BLANKS   ERRMID
     C                     MOVELVNCCY     PCURR
     C                     MOVE *OFF      EDBAS
     C                     EXSR SRCURR
     C                     MOVE *BLANKS   ZFIELD
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVE SNCPAB    ZFIELD
     C                     ELSE                                           123857
     C                     MOVE SNCPA     ZFIELD                          123857
     C                     ENDIF                                          123857
     C                     MOVE A6NBDP    WNBDP
     C           13        SUB  WNBDP     ZADIG
     C                     Z-ADDA6NBDP    ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    WNCPA  130
      *                                                                   143507
      ** Set flag if rollover is EMU multi-ccy rollover                   143507
      *                                                                   143507
     C                     MOVE 'N'       WDFLT   1                       143507
      *                                                                   143507
     C           CEU020    IFEQ 'Y'                                       143507
     C           SNCCYB    ANDEQBKEURO                                    143507
     C           SACTN     ANDEQ'A'                                       143507
     C           CEU020    OREQ 'Y'                                       143507
     C           SNCCY     ANDEQBKEURO                                    143507
     C           SACTN     ANDEQ'X'                                       143507
     C           CEU020    OREQ 'Y'                                       CLE030
     C           SNCCY     ANDEQBKEURO                                    CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   143507
     C                     MOVE *BLANKS   ERRMID                          143507
     C                     MOVELCCY       PCURR                           143507
     C                     MOVE *OFF      EDBAS                           143507
     C                     EXSR SRCURR                                    143507
      *                                                                   143507
     C********** A6INCY    IFEQ 'N'                                                    143507 193701
     C           A6INCY    IFNE 'Y'                                                           193701
     C                     MOVE 'N'       WDFLT                           143507
     C                     ELSE                                           143507
     C                     MOVE 'Y'       WDFLT                           143507
     C                     ENDIF                                          143507
      *                                                                   143507
     C                     ELSE                                           143507
     C                     MOVE 'N'       WDFLT   1                       143507
     C                     ENDIF                                          143507
      *
      **  Mandatory if new currency was entered.
     C                     SELEC
     C           SNCPAB    WHEQ *BLANKS
     C           SNCCYB    ANDNE*BLANKS
     C           SACTN     ANDEQ'A'                                       123857
     C           WDFLT     ANDEQ'N'                                       143507
     C           SNCPA     OREQ *BLANKS                                   123857
     C           SNCCY     ANDNE*BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           WDFLT     ANDEQ'N'                                       143507
     C           SNCPA     OREQ *BLANKS                                   CLE030
     C           SNCCY     ANDNE*BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           WDFLT     ANDEQ'N'                                       CLE030
     C                     MOVEL'LEV1024' ERRMID
      *
      **  Must be a valid numeric amount.
     C           SNCPAB    WHNE *BLANKS
     C           VNCCY     ANDNE*BLANKS
     C           *IN99     ANDEQ*ON
     C           SNCPA     ORNE *BLANKS                                   123857
     C           VNCCY     ANDNE*BLANKS                                   123857
     C           *IN99     ANDEQ*ON                                       123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNCPA     ORNE *BLANKS                                   CLE030
     C           VNCCY     ANDNE*BLANKS                                   CLE030
     C           *IN99     ANDEQ*ON                                       CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVEL'LEV1025' ERRMID
     C                     ENDSL
      *
     C           ERRMID    IFNE *BLANKS
     C                     MOVE *ON       *IN52
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C           SNCPAB    IFNE *BLANKS
     C           SNCPA     ORNE *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNCPA     ORNE *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     Z-ADDWNCPA     VNCPA
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                                              CLE023
      *
      **  Exchange rate * * * * * * * * * * * * * * * * * * * * * * * *
      *
     C           WNFCE1    IFNE '*'
     C           MULTIC    ANDEQ*ON
     C           *IN51     ANDEQ*OFF
     C           *IN61     ANDEQ*ON                                                           CLE023
     C           WNFCE1    ORNE '*'                                                           CLE023
     C           *IN67     ANDEQ*ON                                                           CLE023
      *
      **  Must be a valid rate amount.
     C           SNFCEB    IFNE *BLANKS
     C           SNFCE     ORNE *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNFCE     ORNE *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                                       CLE023
      ** If CLE023 is installed and facility is multi-currency,                               CLE023
      ** entry on facility currency exchange rate is forbidden if                             CLE023
      ** loan currency is the same with facility currency.  Also if                           CLE023
      ** Facility exchange rate allowed flag is 'N'.                                          CLE023
      *                                                                                       CLE023
     C           *IN67     IFEQ *ON                                                           CLE023
     C           SNCCYB    ANDEQ*BLANKS                                                       CLE023
     C           SNCCY     ANDEQ*BLANKS                                                       CLE023
     C           CCY       IFEQ FCCY                                                          CLE023
     C                     MOVEA'11'      *IN,53                                              CLE023
     C                     MOVE *ON       ERRDET                                              CLE023
     C                     MOVEL'LEV1051' ZAMSID                                              CLE023
     C                     EXSR ZASNMS                                                        CLE023
      *                                                                                       CLE023
     C                     ELSE                                                               CLE023
     C           WFCXRA    IFEQ 'N'                                                           CLE023
     C           SACTN     ANDEQ'A'                                                           CLE023
     C                     MOVEA'11'      *IN,53                                              CLE023
     C                     MOVE *ON       ERRDET                                              CLE023
      *                                                                                       219403
      ** 'See second level text' should not appear on Loan Manager.                           219403
     C           PMODE     IFEQ 'B'                                                           219403
     C                     MOVEL'LEV9000' ZAMSID                                              219403
     C                     ELSE                                                               219403
     C                     MOVEL'LEV1053' ZAMSID                                              CLE023
     C                     ENDIF                                                              219403
      *                                                                                       219403
     C                     EXSR ZASNMS                                                        CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
      ** If multi-currency details were previously entered and new                            CLE023
      ** facility exchange rate and indicator was entered but other                           CLE023
      ** multi currency details are not, issue an error msg.                                  CLE023
      *                                                                                       CLE023
     C           *IN67     IFEQ *ON                                                           CLE023
     C           SNCCY     ANDNE*BLANKS                                                       CLE023
     C           SNCCY     ANDNECCY                                                           CLE023
     C           SNCCYB    ANDEQ*BLANKS                                                       CLE023
     C           SNBCEB    ANDEQ*BLANKS                                                       CLE023
     C           SNBMDB    ANDEQ*BLANK                                                        CLE023
     C           SNLRAB    ANDEQ*BLANKS                                                       CLE023
     C           SNFCEB    ANDNE*BLANKS                                                       CLE023
     C           *IN61     ANDEQ*ON                                                           CLE023
     C                     MOVEA'11'      *IN,53                                              CLE023
     C                     MOVE *ON       ERRDET                                              CLE023
      *                                                                                       219403
      ** 'See second level text' should not appear on Loan Manager.                           219403
     C           PMODE     IFEQ 'B'                                                           219403
     C                     MOVEL'LEV9003' ZAMSID                                              219403
     C                     ELSE                                                               219403
     C                     MOVEL'LEV1056' ZAMSID                                              CLE023
     C                     ENDIF                                                              219403
      *                                                                                       219403
     C                     EXSR ZASNMS                                                        CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C           *IN53     IFEQ *OFF                                                          CLE023
     C                     MOVE *BLANKS   ERRMID
     C                     MOVE *BLANKS   ZFIELD
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVE SNFCEB    ZFIELD
     C                     ELSE                                           123857
     C                     MOVE SNFCE     ZFIELD                          123857
     C                     ENDIF                                          123857
     C                     Z-ADD8         ZADEC
     C                     Z-ADD5         ZADIG
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ *ON
     C                     MOVEL'LEV1027' ERRMID
     C                     MOVE *ON       *IN53
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     MOVE ZFIELD    VNFCE
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVE ZFIELD    SNFCEB
     C                     ENDIF                                          123857
     C                     ENDIF
     C                     ENDIF                                                              CLE023
     C                     ENDIF
     C                     ENDIF
      *
      **  Exchange rate indicator * * * * * * * * * * * * * * * * * * *
      *
     C           WNFMD1    IFNE '*'
     C           MULTIC    ANDEQ*ON
     C           *IN51     ANDEQ*OFF
     C           *IN61     ANDEQ*ON                                                           CLE023
     C           WNFMD1    ORNE '*'                                                           CLE023
     C           *IN67     ANDEQ*ON                                                           CLE023
     C                     MOVE *BLANKS   ERRMID
      *
      **  Default to 'M'
     C                     SELEC
     C           SNFMDB    WHEQ *BLANK
     C           SNFCEB    ANDNE*BLANKS
     C           WNFCE1    ANDNE'*'                                                           CLE023
     C           SACTN     ANDEQ'A'                                       123857
     C                     MOVE 'M'       SNFMDB  1
     C           CEU020    IFEQ 'Y'                                       CEU020
     C           MULTIC    ANDEQ*ON                                                           CLE023
     C           *IN51     ANDEQ*OFF                                                          CLE023
     C           *IN61     ANDEQ*ON                                                           CLE023
     C           A6INCY    ANDEQ'Y'                                                           193859
     C                     MOVE A6EUMD    SNFMDB                          CEU020
     C                     ENDIF                                          CEU020
      *
      **  Forbidden if exchange rate not entered.
     C           SNFMDB    WHNE *BLANK
     C           SNFCEB    ANDEQ*BLANKS
     C           SNFMD     ORNE *BLANK                                    123857
     C           SNFCE     ANDEQ*BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNFMD     ORNE *BLANK                                    CLE030
     C           SNFCE     ANDEQ*BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVEL'LEV1028' ERRMID
      *
      **  Must be 'M' or 'D'.
     C           SNFCEB    WHNE *BLANKS
     C           WNFCE1    ANDNE'*'                                                           CLE023
     C           SNFMDB    ANDNE'M'
     C           SNFMDB    ANDNE'D'
     C           SNFCE     ORNE *BLANKS                                   123857
     C           SNFMD     ANDNE'M'                                       123857
     C           SNFMD     ANDNE'D'                                       123857
     C           SACTN     ANDEQ'X'                                       123857
     C           SNFCE     ORNE *BLANKS                                   CLE030
     C           SNFMD     ANDNE'M'                                       CLE030
     C           SNFMD     ANDNE'D'                                       CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVEL'LEV1029' ERRMID
     C                     ENDSL
      *
     C           ERRMID    IFNE *BLANKS
     C                     MOVE *ON       *IN54
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     MOVE SNFMDB    VNFMD
     C           SACTN     IFEQ 'X'                                       123857
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVE SNFMD     VNFMD                           123857
     C                     ENDIF                                          123857
     C                     ENDIF
     C                     ENDIF
      *
      **  Further validation on exchange rate/indicator and amount
      *
     C           *IN67     IFEQ *ON                                                           CLE023
     C           WNFCE1    IFEQ '*'                                                           CLE023
     C           WNFMD1    ANDNE'*'                                                           CLE023
     C           *IN61     ANDEQ*OFF                                                          CLE023
     C           WNFCE1    ORNE '*'                                                           CLE023
     C           WNFMD1    ANDEQ'*'                                                           CLE023
     C           *IN61     ANDEQ*OFF                                                          CLE023
     C                     MOVEA'11'      *IN,53                                              CLE023
     C                     MOVE *ON       ERRDET                                              CLE023
     C                     MOVEL'LEV1052' ZAMSID                                              CLE023
     C                     EXSR ZASNMS                                                        CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C           WNFCE1    IFEQ '*'                                                           CLE023
     C           WNFMD1    ANDEQ'*'                                                           CLE023
     C           *IN61     ANDEQ*ON                                                           CLE023
     C           SNCCY     ANDEQ*BLANKS                                                       CLE023
     C           WNFCE1    OREQ '*'                                                           CLE023
     C           WNFMD1    ANDEQ'*'                                                           CLE023
     C           *IN61     ANDEQ*OFF                                                          CLE023
     C           WFCXRA    IFEQ 'N'                                                           CLE023
     C                     MOVEA'11'      *IN,53                                              CLE023
     C                     MOVE *ON       ERRDET                                              CLE023
      *                                                                                       219403
      ** 'See second level text' should not appear on Loan Manager.                           219403
     C           PMODE     IFEQ 'B'                                                           219403
     C                     MOVEL'LEV9001' ZAMSID                                              219403
     C                     ELSE                                                               219403
     C                     MOVEL'LEV1054' ZAMSID                                              CLE023
     C                     ENDIF                                                              219403
      *                                                                                       219403
     C                     EXSR ZASNMS                                                        CLE023
     C                     ELSE                                                               CLE023
     C                     Z-ADD*ZEROS    VNFCE                                               CLE023
     C                     MOVE *BLANK    VNFMD                                               CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     MOVE 'N'       WMCCY   1                                           CLE023
     C           *IN51     IFEQ *OFF
     C************IN52     ANDEQ*OFF                                      123335
     C           *IN53     ANDEQ*OFF
     C           *IN54     ANDEQ*OFF
     C           SNCCYB    ANDNE*BLANKS
     C           WNCPA1    ANDNE'*'
     C           WNFCE1    ANDNE'*'
     C           WNFMD1    ANDNE'*'
     C           *IN61     ANDEQ*ON                                                           CLE023
      *                                                                   123857
     C           *IN51     OREQ *OFF                                      123857
     C           *IN53     ANDEQ*OFF                                      123857
     C           *IN54     ANDEQ*OFF                                      123857
     C           SNCCY     ANDNE*BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
     C           *IN61     ANDEQ*ON                                                           CLE023
      *                                                                   CLE030
     C           *IN51     OREQ *OFF                                      CLE030
     C           *IN53     ANDEQ*OFF                                      CLE030
     C           *IN54     ANDEQ*OFF                                      CLE030
     C           SNCCY     ANDNE*BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           *IN61     ANDEQ*ON                                       CLE030
     C                     MOVE 'Y'       WMCCY                                               CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C           WMCCY     IFEQ 'Y'                                                           CLE023
     C           *IN67     OREQ *ON                                                           CLE023
     C           *IN53     ANDEQ*OFF                                                          CLE023
     C           *IN54     ANDEQ*OFF                                                          CLE023
     C           CCY       ANDNEFCCY                                                          CLE023
     C           WNFCE1    ANDNE'*'                                                           CLE023
     C           WFCXRA    ANDEQ'Y'                                                           CLE023
     C                     EXSR SRRATE
     C                     MOVE ZRATEX    WNFCRT 138                      CEU020
     C                     ENDIF
      *                                                                   CEU020
      **  When rolling over from 'In' ccy to Euro, exchange rate is not   CEU020
      **  amendable                                                       CEU020
      *                                                                   CEU020
      *                                                                                       193859
      ** An exchange rate can be entered for non-EMU multi-currency                           193859
      ** rollover, as long as it is within 25% of that calculated by                          193859
      ** the program.                                                                         193859
      *                                                                                       193859
     C           CEU020    IFEQ 'Y'                                       CEU020
     C           WNFCE1    ANDNE'*'                                       CEU020
     C           WINCY     ANDEQ'Y'                                       CEU020
     C           VNFCE     ANDNEZRATEX                                    CEU020
     C           *IN61     ANDEQ*ON                                                           CLE023
     C***********SACTN     ANDEQ'A'                                CEU020 144686
     C           VNCCY     ANDNE*BLANKS                                                       CLE023
     C           CLE023    OREQ 'Y'                                                           CLE023
     C           WNFCE1    ANDNE'*'                                                           CLE023
     C           VNFCE     ANDNEZRATEX                                                        CLE023
     C           VNFCE     ANDNE*ZEROS                                                        CLE023
     C           VNCCY     ANDEQ*BLANKS                                                       CLE023
     C           *IN67     ANDEQ*ON                                                           CLE023
     C           SACTN     IFEQ 'A'                                       144686
     C********** SNCCYB    ANDNE*BLANKS                                                144686 193859
     C           SNCCYB    ANDEQBKEURO                                                        193859
     C           BKEURO    ANDNE*BLANKS                                                       215988
     C           SACTN     OREQ 'X'                                       144686
     C********** SNCCY     ANDNE*BLANKS                                                144686 193859
     C           SNCCY     ANDEQBKEURO                                                        193859
      *                                                                                       CLE030
     C           SACTN     OREQ 'Q'                                                           CLE030
     C           CLE030    ANDEQ'Y'                                                           CLE030
     C           SNCCY     ANDEQBKEURO                                                        CLE030
      *                                                                                       CLE030
     C           BKEURO    ANDNE*BLANKS                                                       215988
     C           CLE023    OREQ 'Y'                                                           CLE023
     C           CCY       ANDEQBKEURO                                                        CLE023
     C           WINCYF    ANDEQ'Y'                                                           CLE023
     C           CLE023    OREQ 'Y'                                                           CLE023
     C           FCCY      ANDEQBKEURO                                                        CLE023
     C           WINCYL    ANDEQ'Y'                                                           CLE023
     C           CLE023    OREQ 'Y'                                                           CLE023
     C           WINCYL    ANDEQ'Y'                                                           CLE023
     C           WINCYF    ANDEQ'Y'                                                           CLE023
     C                     MOVE '1'       *IN53                           CEU020
     C                     MOVE *ON       ERRDET                          CEU020
     C                     MOVEL'LEV0023' ZAMSID                          CEU020
     C                     EXSR ZASNMS                                    CEU020
      *                                                                   CEU020
     C                     ENDIF                                          CEU020
     C                     ENDIF                                          144686
      *                                                                   CEU020
      ** New Principal amount * * * * * * * * * * * * * * * * * * * * *                       CLE031
      *                                                                                       CLE031
     C                     EXSR SRVNPA                                                        CLE031
      *                                                                                       CLE031
      ** New Discount amount  * * * * * * * * * * * * * * * * * * * * *                       CLE031
      *                                                                                       CLE031
     C                     EXSR SRVNDA                                                        CLE031
      *                                                                   123335
      **  Base ccy exchange rate  * * * * * * * * * * * * * * * * * * *   123335
      *                                                                   123335
     C           *IN61     IFEQ *ON                                                           CLE023
     C           WNBCE1    IFNE '*'                                       123335
     C           MULTIC    ANDEQ*ON                                       123335
     C           *IN51     ANDEQ*OFF                                      123335
      *                                                                   123335
      **  Must be a valid rate amount.                                    123335
     C           SNBCEB    IFNE *BLANKS                                   123335
     C           SNBCE     ORNE *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SNBCE     ORNE *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     MOVE *BLANKS   ERRMID                          123335
     C                     MOVE *BLANKS   ZFIELD                          123335
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVE SNBCEB    ZFIELD                          123335
     C                     ELSE                                           123857
     C                     MOVE SNBCE     ZFIELD                          123857
     C                     ENDIF                                          123857
     C                     Z-ADD8         ZADEC                           123335
     C                     Z-ADD5         ZADIG                           123335
     C                     EXSR ZALIGN                                    123335
      *                                                                   123335
     C           *IN99     IFEQ *ON                                       123335
     C                     MOVEL'LEV1027' ERRMID                          123335
     C                     MOVE *ON       *IN64                           123335
     C                     MOVE *ON       ERRDET                          123335
     C                     MOVELERRMID    ZAMSID                          123335
     C                     EXSR ZASNMS                                    123335
     C                     ELSE                                           123335
     C                     MOVE ZFIELD    VNBCE                           123335
     C                     Z-ADD8         ZADEC                           123335
     C                     EXSR ZEDIT                                     123335
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVE ZFIELD    SNBCEB                          123335
     C                     ENDIF                                          123857
     C                     ENDIF                                          123335
     C                     ENDIF                                          123335
     C                     ENDIF                                          123335
      *                                                                   123335
      **  Base ccy exchange rate indicator  * * * * * * * * * * * * * *   123335
      *                                                                   123335
     C           WNBMD1    IFNE '*'                                       123335
     C           MULTIC    ANDEQ*ON                                       123335
     C           *IN51     ANDEQ*OFF                                      123335
     C                     MOVE *BLANKS   ERRMID                          123335
      *                                                                   123335
      **  Forbidden if exchange rate not entered.                         123335
      **  Must be 'M' or 'D' if entered                                   123335
      *                                                                   123335
     C           SNBMDB    IFNE *BLANK                                    123335
     C           SNBMD     ORNE *BLANK                                    123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SNBMD     ORNE *BLANK                                    CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     SELEC                                          123335
     C           SNBCEB    WHEQ *BLANKS                                   123335
     C           SACTN     ANDEQ'A'                                       123857
     C           SNBCE     OREQ *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SNBCE     OREQ *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     MOVEL'LEV1028' ERRMID                          123335
     C           SNBMDB    WHNE 'M'                                       123335
     C           SNBMDB    ANDNE'D'                                       123335
     C           SACTN     ANDEQ'A'                                       123857
     C           SNBMD     ORNE 'M'                                       123857
     C           SNBMD     ANDNE'D'                                       123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SNBMD     ORNE 'M'                                       CLE030
     C           SNBMD     ANDNE'D'                                       CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     MOVEL'LEV1029' ERRMID                          123335
     C                     ENDSL                                          123335
      *                                                                   CEU020
      **  When rolling over from 'In' ccy to Euro, exchange rate is not   CEU020
      **  amendable                                                       CEU020
      *                                                                   CEU020
     C           CEU020    IFEQ 'Y'                                       CEU020
     C           WNBCE1    ANDNE'*'                                       CEU020
     C           WINCY     ANDEQ'Y'                                       CEU020
     C           VNBCE     ANDNEWSPRT                                     CEU020
     C***********SACTN     ANDEQ'A'                                CEU020 144686
     C           SACTN     IFEQ 'A'                                       144686
     C           SNCCYB    ANDNE*BLANKS                                   144686
     C           SACTN     OREQ 'X'                                       144686
     C           SNCCY     ANDNE*BLANKS                                   144686
      *                                                                   CLE030
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           SNCCY     ANDNE*BLANKS                                   CLE030
      *                                                                   CLE030
     C                     MOVE '1'       *IN64                           CEU020
     C                     MOVE *ON       ERRDET                          CEU020
     C                     MOVEL'LEV0024' ZAMSID                          CEU020
     C                     EXSR ZASNMS                                    CEU020
      *                                                                   CEU020
     C                     ENDIF                                          CEU020
     C                     ENDIF                                          144686
      *                                                                   CEU020
      *                                                                   123335
      **  Default to spot rate and indicator from new ccys record         123335
      **  if rate is blank, otherwise, default to 'M'                     123335
      *                                                                   123335
     C                     ELSE                                           123335
     C           SNCCYB    IFNE *BLANKS                                   123335
     C           SACTN     ANDEQ'A'                                       123857
     C                     MOVE 'M'       SNBMDB                          123335
     C                     MOVE SNBCEB    VNBMD                           123335
     C           SNBCEB    IFEQ *BLANKS                                   123335
     C                     MOVE WMDIN     SNBMDB                          123335
     C                     MOVE WMDIN     VNBMD                           123335
     C                     Z-ADDWSPRT     VNBCE                           123335
     C                     MOVE WSPRT     ZFIELD                          123335
     C                     Z-ADD8         ZADEC                           123335
     C                     EXSR ZEDIT                                     123335
     C                     MOVE ZFIELD    SNBCEB                          123335
     C                     ENDIF                                          123335
     C                     ENDIF                                          123335
      *                                                                   143502
      **  Default mult/div indicator if base ccy is Euro                  143502
      *                                                                   143502
     C           BJCYCD    IFEQ BKEURO                                    143502
     C           WDFLT     ANDEQ'Y'                                       143502
     C                     MOVE 'D'       SNBMDB                          143502
     C                     ENDIF                                          143502
      *                                                                   143502
     C                     ENDIF                                          123335
      *                                                                   123335
     C           ERRMID    IFNE *BLANKS                                   123335
     C                     MOVE *ON       *IN65                           123335
     C                     MOVE *ON       ERRDET                          123335
     C                     MOVELERRMID    ZAMSID                          123335
     C                     EXSR ZASNMS                                    123335
     C                     ELSE                                           123335
     C                     MOVE SNBMDB    VNBMD                           123335
     C           SACTN     IFEQ 'X'                                       123857
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVE SNBMD     VNBMD                           123857
     C                     ENDIF                                          123857
     C                     ENDIF                                          123335
     C                     ENDIF                                          123335
      *
      **  Next loan currency repayment amount * * * * * * * * * * * * *
      *
     C           WNLRA1    IFNE '*'
     C           MULTIC    ANDEQ*ON
     C           *IN51     ANDEQ*OFF
     C                     MOVE *BLANKS   ERRMID
     C                     MOVELVNCCY     PCURR
     C                     MOVE *OFF      EDBAS
     C                     EXSR SRCURR
      *                                                                   143507
      **  Default new loan repayment amount if blanks and next            143507
      **  repayment date is not equal to zero only for EMU multi-ccy      143507
      **  rollover                                                        143507
      *                                                                   143507
     C           WDFLT     IFEQ 'Y'                                       143507
     C           NRPD      ANDNE*ZEROS                                    143507
     C           SNLRAB    ANDEQ*BLANKS                                   143507
     C           SACTN     ANDEQ'A'                                       143507
     C                     MOVELCCY       PCURR                           143507
     C                     EXSR SRCURR                                    143507
     C                     CALL 'EU0200'                                  143507
     C                     PARM *BLANKS   PRTCD   7                       143507
     C                     PARM RAMT      PFRAM  183                      143507
     C                     PARM CCY       PFRCY   3                       143507
     C                     PARM VNCCY     PTOCY   3                       143507
     C                     PARM           POUTA  150                      143507
     C                     PARM           PINTA  183                      143507
     C                     PARM           PEXRT  159                      143507
     C                     PARM           PMDIN   1                       143507
     C                     Z-ADDPOUTA     VNLRA                           143507
     C                     Z-ADDPOUTA     WNLRA                           143507
     C                     MOVELVNCCY     PCURR                           143507
     C                     EXSR SRCURR                                    143507
     C                     Z-ADDA6NBDP    ZADEC                           143507
     C                     MOVE *BLANKS   ZFIELD                          143507
     C                     MOVE POUTA     ZFIELD                          143507
     C                     EXSR ZEDIT                                     143507
     C                     MOVE ZFIELD    SNLRAB                          143507
     C                     ENDIF                                          143507
      *                                                                   143507
     C                     MOVE *BLANKS   ZFIELD
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVE SNLRAB    ZFIELD
     C                     ELSE                                           123857
     C                     MOVE SNLRA     ZFIELD                          123857
     C                     ENDIF                                          123857
     C                     MOVE A6NBDP    WNBDP
     C           13        SUB  WNBDP     ZADIG
     C                     Z-ADDA6NBDP    ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    WNLRA  130
      *
      **  Mandatory if new currency was entered
      **  and/or repayment schedule is defined.
     C                     SELEC
     C           SNLRAB    WHEQ *BLANKS
     C***********SNCCYB    ANDNE*BLANK                                    132163
     C***********WNLRA     OREQ *ZEROS                                    132163
     C***********SNCCYB    ANDNE*BLANK                                    132163
     C***********SNLRAB    OREQ *BLANKS                                   132163
     C           SNCCYB    ANDNE*BLANK
     C           NRPD      ANDNE*ZEROS
     C           WDFLT     ANDEQ'N'                                       143507
     C           WNLRA     OREQ *ZEROS
     C           SNCCYB    ANDNE*BLANK
     C           NRPD      ANDNE*ZEROS
     C           *IN99     ANDEQ'0'                                       143507
      *                                                                   123857
     C***********NLRA      OREQ *ZEROS                             123857 132163
     C***********SNCCY     ANDNE*BLANK                             123857 132163
     C***********SACTN     ANDEQ'X'                                123857 132163
     C           NLRA      OREQ *ZEROS                                    123857
     C           SNCCY     ANDNE*BLANK                                    123857
     C           NRPD      ANDNE*ZEROS                                    123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           NLRA      OREQ *ZEROS                                    CLE030
     C           SNCCY     ANDNE*BLANK                                    CLE030
     C           NRPD      ANDNE*ZEROS                                    CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     MOVEL'LEV1030' ERRMID
      *
      **  Must be a valid numeric amount.
     C           SNLRAB    WHNE *BLANKS
     C           VNCCY     ANDNE*BLANKS
     C           *IN99     ANDEQ*ON
     C           SNLRA     WHNE *BLANKS                                   123857
     C           VNCCY     ANDNE*BLANKS                                   123857
     C           *IN99     ANDEQ*ON                                       123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SNLRA     WHNE *BLANKS                                   CLE030
     C           VNCCY     ANDNE*BLANKS                                   CLE030
     C           *IN99     ANDEQ*ON                                       CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     MOVEL'LEV1032' ERRMID
     C                     ENDSL
      *
     C           ERRMID    IFNE *BLANKS
     C                     MOVE *ON       *IN55
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C           SNLRAB    IFNE *BLANKS
     C           SNLRA     ORNE *BLANKS                                   123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SNLRA     ORNE *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     Z-ADDWNLRA     VNLRA
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                                       CLE034
      ** Validate Settlement Allocation                                                       CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
      *                                                                                       CLE034
      ** Must be 'Y' or 'N', defaults to 'N' when left blank                                  CLE034
      *                                                                                       CLE034
     C           SRSTA     IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'N'       SRSTA                                               CLE034
     C                     ELSE                                                               CLE034
     C           SRSTA     IFNE 'Y'                                                           CLE034
     C           SRSTA     ANDNE'N'                                                           CLE034
     C                     MOVE *ON       *IN75                                               CLE034
     C                     MOVE *ON       ERRDET                                              CLE034
     C**********           MOVEL'LEL0568' ZAMSID                                       CLE034 CAS011
     C                     MOVEL'LEL0801' ZAMSID                                              CAS011
     C                     EXSR ZASNMS                                                        CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *
      **  Funding spread sign * * * * * * * * * * * * * * * * * * * * *
      *
     C           *IN29     IFEQ *ON
     C                     MOVE *BLANKS   ERRMID
      *
      **  Must be either '+', '-', or blank.
     C                     SELEC
     C           SNFSNB    WHNE '+'
     C           SNFSNB    ANDNE'-'
     C           SNFSNB    ANDNE*BLANK
     C                     MOVEL'LEV1019' ERRMID
      *
      **  Forbidden if funding spread/rate not entered.
     C           SNFSNB    WHNE *BLANK
     C           SNFRSB    ANDEQ*BLANKS
     C                     MOVEL'LEV1020' ERRMID
     C                     ENDSL
      *
     C           ERRMID    IFNE *BLANKS
     C                     MOVE *ON       *IN63
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     MOVE SNFSNB    VNFSN
     C                     ENDIF
     C                     ENDIF
      *
      **  Funding spread/rate * * * * * * * * * * * * * * * * * * * * *
      *
     C           *IN29     IFEQ *ON
     C           SNFRSB    ANDNE*BLANKS
     C                     MOVE *BLANKS   ERRMID
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SNFRSB    ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD7         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    WNFRS  117
      *
      **  Must be a valid rate amount.
     C           *IN99     IFEQ *ON
     C                     MOVEL'LEV1021' ERRMID
     C                     ENDIF
      *
     C           ERRMID    IFNE *BLANKS
     C                     MOVE *ON       *IN62
     C                     MOVE *ON       ERRDET
     C                     MOVELERRMID    ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     Z-ADDWNFRS     VNFRS
     C                     ENDIF
     C                     ENDIF
      *
      **  For discount loans, validate extended settlements.
      **  Also, for multi-currency rollovers with rollover date input     120025
      **  Do this only during Interactive and Record modes.
      *
     C           SACTN     IFEQ 'A'                                       123857
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           PMODE     OREQ 'F'                                       CAP062
      *                                                                   120025
     C                     MOVE *BLANK    WMCST   1                       120025
     C           ERRDET    IFEQ *OFF                                      120025
     C           *INKN     ANDEQ*OFF                                      120025
     C           MULTIC    ANDEQ*ON                                       120025
     C           PTYP      ANDNE63                                        120025
     C           PTYP      ANDNE65                                        122098
     C           PTYP      ANDNE67                                        122098
     C           NCCY      IFNE *BLANKS                                   120025
     C           SNCCYB    ORNE *BLANKS                                   120025
     C           WNCCY1    ANDNE'*'                                                           CLE023
     C           SRLDT     IFNE *BLANKS                                   120025
     C           SRLDTB    ORNE *BLANKS                                   120025
     C           WRLDT1    ANDNE'*'                                       120025
     C                     MOVE 'Y'       WMCST                           120025
     C                     ENDIF                                          120025
     C                     ENDIF                                          120025
     C                     ENDIF                                          120025
      *                                                                   120025
     C           PTYP      IFEQ 63
     C           ERRDET    ANDEQ*OFF
     C           *INKN     ANDEQ*OFF
     C           PTYP      OREQ 65                                        122098
     C           ERRDET    ANDEQ*OFF                                      122098
     C           *INKN     ANDEQ*OFF                                      122098
     C           PTYP      OREQ 67                                        122098
     C           ERRDET    ANDEQ*OFF                                      122098
     C           *INKN     ANDEQ*OFF                                      122098
     C           WMCST     OREQ 'Y'                                       120025
     C***********CEU020    ANDEQ'N'                                CEU020 144915
     C                     MOVE 'D2'      WFMT
     C                     EXSR SREXST
     C           WFMT      IFNE *BLANKS
     C                     MOVE 'D1'      WFMT
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      **  No more errors, check if record was changed
      **  from another workstation.
      *
     C           ERRDET    IFEQ *OFF
     C                     MOVE 'B'       WRCDT
     C                     MOVE LNRF      WLNRF
     C           WLOAN     CHAINCLOAN               N85
     C           TNLU      IFNE WTNLU
     C                     MOVE *ON       ERRDET
     C                     MOVE *ON       SEVERE
     C                     MOVEL'LEV1018' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *                                                                   123857
     C                     ENDIF                                          123857
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRRATE  -  Validation of exchange rate and amount             *
      * Called by: SRVDET - Validation of detail screen               *
      *            SRWDET - Warning messages of detail screen         *
      * Calls    : None                                               *
      *****************************************************************
     C           SRRATE    BEGSR
      *                                                                                       CLE023
      ** Get loan currency details when CLE023 is installed and                               CLE023
      ** default to spot rate is 'Y'                                                          CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           *IN67     ANDEQ*ON                                                           CLE023
     C           WMCCY     ANDEQ'N'                                                           CLE023
      *                                                                                       CLE023
     C           SRLDTB    IFNE *BLANKS                                                       CLE023
     C           WRLDT1    ANDNE'*'                                                           CLE023
     C                     Z-ADDWRLDT     WWRLDT  60                                          CLE023
     C                     ELSE                                                               CLE023
     C                     Z-ADDRLDT      WWRLDT  60                                          CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     MOVELCCY       PCURR                                               CLE023
     C                     Z-ADD65        DBASE                                               CLE023
     C                     MOVE *ON       EDBAS                                               CLE023
     C                     EXSR SRCURR                                                        CLE023
     C                     MOVE A6INCY    WINCYL  1                                           CLE023
     C           A6INCY    IFEQ 'Y'                                                           CLE023
     C                     MOVE A6EUMD    WEUMDL  1                                           CLE023
     C                     Z-ADDA6EUER    WEUERL 138                                          CLE023
     C                     ENDIF                                                              CLE023
     C                     MOVE A6MDIN    WMDIN                                               CLE023
     C                     Z-ADDA6SPRT    WSPRT                                               CLE023
     C                     ENDIF                                                              CLE023
      *
      ** Get cross exchange rate and multiply/divide indicator
      ***between*old*and*new*currencies********************************   123335
      ** between new loan/rollover ccy and facility currency              123335
      *
     C***********          MOVELCCY       PCURR                           123335
      *                                                                                       193859
      ** For non-EMU multi-currency rollover.                                                 193859
      *                                                                                       193859
     C           WDFLT     IFEQ 'N'                                                           193859
     C           CLE023    OREQ 'Y'                                                           CLE023
     C           *IN67     ANDEQ*ON                                                           CLE023
     C           SNCCYB    ANDEQ*BLANKS                                                       CLE023
     C           SACTN     ANDEQ'A'                                                           CLE023
     C           CLE023    OREQ 'Y'                                                           CLE023
     C           *IN67     ANDEQ*ON                                                           CLE023
     C           SNCCY     ANDEQ*BLANKS                                                       CLE023
     C           SACTN     ANDEQ'X'                                                           CLE023
      *                                                                                       CLE030
     C           CLE023    OREQ 'Y'                                                           CLE030
     C           *IN67     ANDEQ*ON                                                           CLE030
     C           SNCCY     ANDEQ*BLANKS                                                       CLE030
     C           SACTN     ANDEQ'Q'                                                           CLE030
     C           CLE030    ANDEQ'Y'                                                           CLE030
      *                                                                                       CLE030
     C                     MOVELFCCY      PCURR                           123335
     C                     Z-ADD57        DBASE
     C                     MOVE *ON       EDBAS
     C                     EXSR SRCURR
     C                     MOVE A6INCY    WINCYF  1                                           CLE023
      *                                                                                       CLE023
      ** If loan and facility is an 'In' currency, default facility                           CLE023
      ** exchange rate by using the cross rate of the two A6EUER                              CLE023
      *                                                                                       CLE023
     C           A6INCY    IFEQ 'Y'                                                           CLE023
     C           WINCYL    ANDEQ'Y'                                                           CLE023
     C                     MOVE A6EUMD    ZMDI1                                               CLE023
     C                     MOVE A6EUER    ZRATE1                                              CLE023
     C                     ELSE                                                               CLE023
     C                     MOVE A6MDIN    ZMDI1   1
     C                     Z-ADDA6SPRT    ZRATE1 138
     C                     ENDIF                                                              CLE023
     C           A6INCY    IFEQ 'Y'                                                           CLE023
     C           WINCYL    ANDEQ'Y'                                                           CLE023
     C                     MOVE WEUMDL    ZMDI2                                               CLE023
     C                     Z-ADDWEUERL    ZRATE2                                              CLE023
     C                     ELSE                                                               CLE023
     C                     MOVE WMDIN     ZMDI2   1
     C                     Z-ADDWSPRT     ZRATE2 138
      *                                                                                       CLE023
     C                     ENDIF                                                              CLE023
     C                     EXSR ZXRATE
      *                                                                   123335
     C           A6MDIN    IFEQ 'M'                                       123335
     C           CLE023    OREQ 'Y'                                                           CLE023
     C           *IN67     ANDEQ*ON                                                           CLE023
     C           SNCCYB    ANDEQ*BLANKS                                                       CLE023
     C           A6INCY    ANDEQ'Y'                                                           CLE023
     C           A6EUMD    ANDEQ'M'                                                           CLE023
     C           WINCYL    ANDEQ'Y'                                                           CLE023
     C           WINCYF    ANDEQ'Y'                                                           CLE023
     C                     MOVE 'D'       ZMDIX                           123335
     C                     ELSE                                           123335
     C                     MOVE 'M'       ZMDIX                           123335
     C                     ENDIF                                          123335
      *                                                                                       193859
      ** Else this is an EMU multi-currency rollover.                                         193859
      ** Get cross exchange rate and multiply/divide indicator between                        193859
      ** new loan currency (EUR) and the facility currency, by                                193859
      ** converting the old loan currency FCXR with the old currency's                        193859
      ** EMU exchange rate.                                                                   193859
      ** Get details of loan currency.                                                        193859
      *                                                                                       193859
     C                     ELSE                                                               193859
     C                     MOVELCCY       PCURR                                               193859
     C                     Z-ADD64        DBASE                                               193859
     C                     MOVE *ON       EDBAS                                               193859
     C                     EXSR SRCURR                                                        193859
     C           A6EUMD    IFEQ 'M'                                                           193859
     C                     MOVE 'D'       ZMDI1                                               193859
     C                     ELSE                                                               193859
     C                     MOVE 'M'       ZMDI1                                               193859
     C                     ENDIF                                                              193859
     C                     Z-ADDA6EUER    ZRATE1 138                                          193859
     C           FMDI      IFEQ 'M'                                                           193859
     C                     MOVE 'D'       ZMDI2   1                                           193859
     C                     ELSE                                                               193859
     C                     MOVE 'M'       ZMDI2                                               193859
     C                     ENDIF                                                              193859
     C                     Z-ADDFCXR      ZRATE2 138                                          193859
     C                     EXSR ZXRATE                                                        193859
     C                     ENDIF                                                              193859
      *                                                                   123335
     C***********SNFMDB    IFNE ZMDIX                                     123335
     C***********SACTN     ANDEQ'A'                                       123335
     C***********NFMD      ORNE ZMDIX                                     123335
     C***********SACTN     ANDEQ'X'                                       123335
     C***********1         DIV  ZRATEX    ZRATEX                          123335
     C***********          ENDIF                                          123335
      *
      ** If exchange rate is left blank, default to cross exch rate
      *
     C           SACTN     IFEQ 'A'
     C           *IN67     IFEQ *ON                                                           CLE023
     C           BPDRTS    ANDEQ'Y'                                                           CLE023
     C           WWRLDT    ANDNE*ZERO                                                         CLE023
     C           WRLDT1    ANDNE'*'                                                           CLE023
     C           SNFCE     ANDEQ*BLANKS                                                       CLE023
     C           WMCCY     OREQ 'Y'                                                           CLE023
     C           SNFCEB    IFEQ *BLANK
      *                                                                                       CLE023
     C           SNCCYB    IFEQ FCCY                                                          CLE023
     C                     Z-ADD1         ZRATEX                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE ZRATEX    ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SNFCEB
     C                     Z-ADDZRATEX    VNFCE
     C***********          MOVE 'M'       SNFMDB                          123335
     C                     MOVE ZMDIX     SNFMDB                          123335
     C                     MOVE SNFMDB    VNFMD
      *                                                                   143502
      **  Default mult/div indicator to 'D' if facility ccy is Euro       143502
      *                                                                   143502
     C           FCCY      IFEQ BKEURO                                    143502
     C           WDFLT     ANDEQ'Y'                                       143502
     C                     MOVE 'D'       ZMDIX                           143502
     C                     MOVE ZMDIX     VNFMD                           153884
     C                     MOVE ZMDIX     SNFMDB                          153884
     C                     ENDIF                                          143502
     C                     ELSE                                           143502
      *                                                                                       193859
      ** Else, SNFCEB was not blank. If Facility currency = 'EUR',                            193859
      ** & EMU rollover, will need to get Facility currency details.                          193859
      *                                                                                       193859
     C           FCCY      IFEQ BKEURO                                                        193859
     C           WDFLT     ANDEQ'Y'                                                           193859
     C                     MOVELFCCY      PCURR                                               193859
     C                     Z-ADD65        DBASE                                               193859
     C                     MOVE *ON       EDBAS                                               193859
     C                     EXSR SRCURR                                                        193859
     C                     ENDIF                                                              193859
     C           FCCY      IFEQ BKEURO                                    143502
     C           WDFLT     ANDEQ'Y'                                       143502
     C           VNFCE     ANDEQA6SPRT                                    143502
     C                     MOVE 'D'       ZMDIX                           143502
     C                     ENDIF                                          143502
      *                                                                   143502
     C                     ENDIF
     C                     ENDIF                                                              CLE023
      *                                                                   123335
      ** Get cross exchange rate between old and new currencies           123335
      ** using the facility exchange rates                                123335
      *                                                                   123335
     C           WMCCY     IFEQ 'Y'                                                           CLE023
     C           SNFMDB    IFNE ZMDIX                                     123335
     C           SACTN     ANDEQ'A'                                       123335
     C           NFMD      ORNE ZMDIX                                     123335
     C           SACTN     ANDEQ'X'                                       123335
     C           NFMD      ORNE ZMDIX                                     CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C           1         DIV  ZRATEX    ZRATEX                          123335
     C                     ENDIF                                          123335
     C                     Z-ADDZRATEX    WZRATE 138                      123335
     C                     Z-ADDFCXR      ZRATE1                          123335
     C                     MOVE FMDI      ZMDI1                           123335
     C                     MOVE VNFMD     ZMDI2                           123335
     C                     Z-ADDVNFCE     ZRATE2                          123335
     C                     EXSR ZXRATE                                    123335
      *
      ** Verify that exchange rate and amounts in old and new ccys
      ** agree
      ** taking into account currency decimal places.                     123333
     C           *IN52     IFEQ '0'                                       123335
     C                     MOVELCCY       PCURR                           123335
     C                     Z-ADD58        DBASE                           123335
     C                     MOVE *ON       EDBAS                           123335
     C                     EXSR SRCURR                                    123335
     C***********          SUB  A6NBDP    W#PWR                    123333 123335
     C***********          ADD  4         W#PWR                    123333 123335
     C***********CPAM      MULT PWR,W#PWR W#AMNT 193H              123333 123335
      ***********                                                         123335
     C***********VNFMD     IFEQ 'M'                                       123335
     C***********CPAM      MULT VNFCE     WNAMT  130H                     123333
     C***********W#AMNT    MULT VNFCE     WNAMT  130H              123333 123335
     C***********          ELSE                                           123335
     C***********CPAM      DIV  VNFCE     WNAMT     H                     123333
     C***********W#AMNT    DIV  VNFCE     WNAMT     H              123333 123335
     C***********          ENDIF                                          123335
     C           WDFLT     IFEQ 'N'                                       143507
     C                     Z-ADDA6NBDP    ZCDPI                           123335
     C                     Z-ADDW#PWR     ZCDPO                           123335
      *                                                                   165977
      ** Use new principal amount field when converting to new ccy        165977
      ** if discount loan                                                 165977
      *                                                                   165977
     C           PTYP      IFEQ 63                                        165977
     C           PTYP      OREQ 65                                        165977
     C           PTYP      OREQ 67                                        165977
     C                     Z-ADDVNPRAM    ZAMTCI                          165977
     C                     ELSE                                           165977
     C                     Z-ADDCPAM      ZAMTCI                          123335
     C                     ENDIF                                          165977
      *                                                                   165977
     C                     Z-ADD*ZEROS    ZAMTCO                          123335
     C                     Z-ADDZRATEX    ZEXCH                           123335
     C                     MOVE ZMDIX     ZMD                             123335
     C                     EXSR ZCONV                                     123335
     C                     Z-ADDZAMTCO    WNAMT  130                      123335
     C                     ELSE                                           143507
     C           *IN27     IFEQ '1'                                       144688
     C           WRLDT     ANDEQMDAT                                      144688
     C           *IN47     ANDEQ'0'                                       144688
     C                     Z-ADDVNPRAM    WPFRAM 150                      144688
     C                     ELSE                                           144688
     C                     Z-ADDCPAM      WPFRAM                          144688
     C                     ENDIF                                          144688
     C           *IN47     IFEQ '0'                                       144688
     C           *IN47     OREQ '1'                                       144688
     C           *IN27     ANDNE'1'                                       144688
     C                     CALL 'EU0200'                                  143507
     C                     PARM *BLANKS   PRTCD   7                       143507
     C***********          PARM CPAM      PFRAM  183               143507 144688
     C                     PARM WPFRAM    PFRAM  183                      144688
     C                     PARM CCY       PFRCY   3                       143507
     C                     PARM SNCCYB    PTOCY   3                       143507
     C                     PARM           POUTA  150                      143507
     C                     PARM           PINTA  183                      143507
     C                     PARM           PEXRT  159                      143507
     C                     PARM           PMDIN   1                       143507
      *                                                                   144688
     C***********          Z-ADDPOUTA     VNCPA                    144688 165968
     C                     Z-ADDPOUTA     WNAMT                           165968
      *                                                                   143507
      **  Default New ccy principal amount CEU020 is installed, new       143507
      **  ccy is Euro and new principal amt is blanks                     143507
      *                                                                   143507
     C           SNCPAB    IFEQ *BLANKS                                   143507
     C                     MOVELVNCCY     PCURR                           143507
     C                     Z-ADD62        DBASE                           143507
     C                     MOVE *ON       EDBAS                           143507
     C                     EXSR SRCURR                                    143507
     C                     Z-ADDA6NBDP    ZADEC                           143507
     C           13        SUB  A6NBDP    ZADIG                           143507
     C                     MOVE POUTA     ZFIELD                          143507
     C                     EXSR ZEDIT                                     143507
     C                     MOVE ZFIELD    SNCPAB                          143507
     C                     Z-ADDPOUTA     VNCPA                           143507
     C                     Z-ADDPOUTA     WNAMT                           143507
     C                     ENDIF                                          143507
      *                                                                   143507
     C                     ENDIF                                          143507
     C                     ENDIF                                          144688
      *
      ***Check*that*amount*entered*should*be*within*one*unit*of*********  121793              195070
      ***the*calculated*cross-currency*equivalent*for*non-discount*loans  121793              195070
      ***or*must*less*than*or*equal*to*oustanding*amount*in*old*ccy*****  121793              195070
      ***for*discounted*loans*******************************************  121793              195070
     C********** WNAMT     SUB  VNCPA     WCHK2  130                      121793              195070
     C********** WCHK2     IFLT *ZEROS                                    121793              195070
     C**********           Z-SUBWCHK2     WCHK2                           121793              195070
     C**********           ENDIF                                          121793              195070
     C***********WNAMT     IFNE VNCPA                                     121793
     C**********           MOVE '0'       WXFLAG  1                       157751              195070
     C**********           SELEC                                          157751              195070
     C********** ZCDPO     WHEQ 0                                         157751              195070
     C********** WCHK2     IFGT 1                                         121793              195070
     C**********           MOVE '1'       WXFLAG                          157751              195070
     C**********           ENDIF                                          157751              195070
      *                                                                   157751
     C********** ZCDPO     WHEQ 1                                         157751              195070
     C********** WWCHK1    IFGT 1                                         157751              195070
     C**********           MOVE '1'       WXFLAG                          157751              195070
     C**********           ENDIF                                          157751              195070
      *                                                                   157751
     C********** ZCDPO     WHEQ 2                                         157751              195070
     C********** WWCHK2    IFGT 1                                         157751              195070
     C**********           MOVE '1'       WXFLAG                          157751              195070
     C**********           ENDIF                                          157751              195070
      *                                                                   157751
     C********** ZCDPO     WHEQ 3                                         157751              195070
     C********** WWCHK3    IFGT 1                                         157751              195070
     C**********           MOVE '1'       WXFLAG                          157751              195070
     C**********           ENDIF                                          157751              195070
     C**********           ENDSL                                          157751              195070
      *                                                                   157751
     C********** WXFLAG    IFEQ '1'                                       157751              195070
     C***********WDFLT     ANDEQ'Y'                                143507 165977
     C***********WCHK2     ORGT 1                                  143507 157751
     C***********WXFLAG    OREQ '1'                                157751 165977
     C***********PTYP      ANDNE63                                 121793 165977
     C***********PTYP      ANDNE65                                 122098 165977
     C***********PTYP      ANDNE67                                 122098 165977
     C***********WDFLT     ANDEQ'N'                                143507 165977
     C***********PTYP      OREQ 63                                 121793 165977
     C***********VNCPA     ANDGTWNAMT                              121793 165977
     C***********WDFLT     ANDEQ'N'                                143507 165977
     C***********PTYP      OREQ 65                                 122098 165977
     C***********VNCPA     ANDGTWNAMT                              122098 165977
     C***********WDFLT     ANDEQ'N'                                143507 165977
     C***********PTYP      OREQ 67                                 122098 165977
     C***********VNCPA     ANDGTWNAMT                              122098 165977
     C***********WDFLT     ANDEQ'N'                                143507 165977
     C**********           MOVEA'111'     *IN,52                                              195070
     C**********           MOVE *ON       ERRDET                                              195070
     C**********           MOVEL'LEV0011' ZAMSID                                              195070
     C**********           EXSR ZASNMS                                                        195070
     C**********           ENDIF                                                              195070
      *                                                                                       195070
      ** Check that the amount entered must be within the tolerance of                        195070
      ** 5%                                                                                   195070
      *                                                                                       195070
     C           WNAMT     MULT 0.95      WNLAMT 130H                                         195070
     C           WNAMT     MULT 1.05      WNHAMT 130H                                         195070
      *                                                                                       195070
     C           VNCPA     IFLT WNLAMT                                                        195070
     C           VNCPA     ORGT WNHAMT                                                        195070
     C                     MOVEA'111'     *IN,52                                              195070
     C                     MOVE *ON       ERRDET                                              195070
     C                     MOVE 'LEV1050' ZAMSID                                              195070
     C                     MOVE *BLANKS   ZFLD15                                              195070
     C                     MOVE WNAMT     ZFLD15                                              195070
     C                     Z-ADDZCDPO     ZDECS                                               195070
     C                     MOVE 'L'       ZECODE                                              195070
     C                     EXSR ZFRPED                                                        195070
     C           ZNEG      IFEQ '-'                                                           195070
     C                     MOVELZOUT21    ZAMSDA                                              195070
     C                     ELSE                                                               195070
     C                     MOVELZOUT20    ZAMSDA                                              195070
     C                     ENDIF                                                              195070
     C                     EXSR ZASNMS                                                        195070
     C                     ENDIF                                                              195070
     C                     ENDIF                                          123335
      *                                                                   123335
     C                     Z-ADDWZRATE    ZRATEX                          123335
     C                     ENDIF                                                              CLE023
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRWDET  -  Warning messages of Detail Screen.                 *
      * Called by: SRBTCH - Batch processing                          *
      *            SRPDET - Process Detail Screen                     *
      * Calls    : SREFFI - Calculate the effective interest          *
      *            SRRATE - Validation of exchange rate and amounts   *
      *****************************************************************
     C           SRWDET    BEGSR
      *
      **  Initialise warning work fields.
      *
     C                     MOVE *OFF      WARDET
     C                     MOVE *OFF      WARNEW  1
     C**********           CLEARWARA                                                          CLE031
     C                     CLEARWRN                                                           CLE031
      *
      **  Initialise warning indicators only during authorisation.
      *
     C           SACTN     IFEQ 'X'
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVE *OFF      *IN38
     C                     MOVE *OFF      *IN41
     C                     MOVE *OFF      *IN76                                               CLE036
     C                     MOVE *OFF      *IN46
     C                     MOVE *OFF      *IN47                                               CLE031
     C                     MOVE *OFF      *IN53
     C                     MOVE *OFF      *IN62
     C                     ENDIF
      *
      **  If New base rate code is blank and loan is
      **  currently attached to base rate.
      *
     C********** BRTT      IFNE *ZEROS                                                        CSD103
     C           BRTT      IFNE *BLANKS                                                       CSD103
     C           SNBRAB    ANDEQ*BLANKS
     C           SNBRA     ANDEQ*BLANKS                                   191223
     C           SACTN     ANDEQ'A'
     C********** BRTT      ORNE *ZEROS                                                        CSD103
     C********** NBRA      ANDEQ*ZEROS                                                        CSD103
     C           BRTT      ORNE *BLANKS                                                       CSD103
     C           NBRA      ANDEQ*BLANKS                                                       CSD103
     C           SACTN     ANDEQ'X'
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           BASR      ANDNE*ZEROS                                                        CLE036
     C           SNBRTB    ANDEQ*BLANKS                                                       CLE036
     C           SNBRT     ANDEQ*BLANKS                                                       CLE036
     C           SACTN     ANDEQ'A'                                                           CLE036
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           BASR      ANDNE*ZEROS                                                        CLE036
     C           NBSR      ANDEQ*ZEROS                                                        CLE036
     C           SACTN     ANDEQ'X'                                                           CLE036
      *                                                                   CLE030
     C********** BRTT      ORNE *ZEROS                                                 CLE030 CSD103
     C********** NBRA      ANDEQ*ZEROS                                                 CLE030 CSD103
     C           BRTT      ORNE *BLANKS                                                       CSD103
     C           NBRA      ANDEQ*BLANKS                                                       CSD103
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   CLE030
     C                     MOVE *ON       WARDET
     C**********           MOVEA'0020'    WARA,1                                              CLE031
     C********** BRTT      IFNE *ZEROS                                                 CLE036 CSD103
     C           BRTT      IFNE *BLANKS                                                       CSD103
     C                     MOVEA'0020'    WRN,1                                               CLE031
     C                     MOVE *ON       *IN41
     C                     ENDIF                                                              CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C           BASR      ANDNE*ZEROS                                                        CLE036
     C                     MOVEA'1074'    WRN,1                                               CLE036
     C                     MOVE *ON       *IN76                                               CLE036
     C                     ENDIF                                                              CLE036
     C           SACTN     IFEQ 'A'
     C           SNBRAB    ANDNEWNBRAW
     C                     MOVE *ON       WARNEW
     C                     MOVELSNBRAB    WNBRAW
     C                     ENDIF
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C           SACTN     ANDEQ'A'                                                           CLE036
     C           SNBRTB    ANDNEWNBRTW                                                        CLE036
     C                     MOVE *ON       WARNEW                                              CLE036
     C                     MOVELSNBRTB    WNBRTW                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF
      *
      **  If New Next Rollover date entered, send
      **  warning message if holiday in Loan currency.
      *
     C           VNROD     IFNE *ZEROS
     C           SACTN     ANDEQ'A'
     C           NROD      ORNE *ZEROS
     C           SACTN     ANDEQ'X'
     C           NROD      ORNE *ZEROS                                    CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *
     C           SACTN     IFEQ 'A'
     C                     Z-ADDVNROD     ZDAYNO
     C                     ELSE
     C                     Z-ADDNROD      ZDAYNO
     C                     ENDIF
      *
     C                     MOVE CCY       ZCCY
     C                     EXSR ZCHKH
      *
     C           ZIND      IFEQ 'H'
     C                     MOVE *ON       WARDET
     C**********           MOVEA'1016'    WARA,2                                              CLE031
     C                     MOVEA'1016'    WRN,2                                               CLE031
     C                     MOVE *ON       *IN46
     C           SACTN     IFEQ 'A'
     C           ZDAYNO    ANDNEWNRODW
     C                     MOVE *ON       WARNEW
     C                     Z-ADDZDAYNO    WNRODW
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  If New Rollover date was entered, send
      **  warning message if holiday in Loan currency.
      *
     C           VRLDT     IFNE *ZEROS
     C           SACTN     ANDEQ'A'
     C           RLDT      ORNE *ZEROS
     C           SACTN     ANDEQ'X'
     C           RLDT      ORNE *ZEROS                                    CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *
     C           SACTN     IFEQ 'A'
     C                     Z-ADDVRLDT     ZDAYNO
     C                     ELSE
     C                     Z-ADDRLDT      ZDAYNO
     C                     ENDIF
      *
     C                     MOVE CCY       ZCCY
     C                     EXSR ZCHKH
      *
     C           ZIND      IFEQ 'H'
     C                     MOVE *ON       WARDET
     C**********           MOVEA'1015'    WARA,3                                              CLE031
     C                     MOVEA'1015'    WRN,3                                               CLE031
     C                     MOVE *ON       *IN38
     C           SACTN     IFEQ 'A'
     C           ZDAYNO    ANDNEWRLDTW
     C                     MOVE *ON       WARNEW
     C                     Z-ADDZDAYNO    WRLDTW
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  If the funding spread/rate and sign are both valid,
      **  determine the actual funding rate.
      *
     C           *IN29     IFEQ *ON
     C           *IN62     ANDEQ*OFF
     C           *IN63     ANDEQ*OFF
     C           VNFRS     ANDNE*ZEROS
     C           SACTN     ANDEQ'A'
     C           *IN29     OREQ *ON
     C           NFRS      ANDNE*ZEROS
     C           SACTN     ANDEQ'X'
     C           *IN29     OREQ *ON                                       CLE030
     C           NFRS      ANDNE*ZEROS                                    CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *
     C                     EXSR SREFFI
     C           SACTN     IFEQ 'A'
     C                     SELEC
     C           VNFSN     WHEQ *BLANK
     C                     Z-ADDVNFRS     WANFRS 117
     C           VNFSN     WHEQ '+'
     C           WINTR     ADD  VNFRS     WANFRS
     C           VNFSN     WHEQ '-'
     C           WINTR     SUB  VNFRS     WANFRS
     C                     ENDSL
      *
     C                     ELSE
     C                     SELEC
     C           NFSN      WHEQ *BLANK
     C                     Z-ADDNFRS      WANFRS 117
     C           NFSN      WHEQ '+'
     C           WINTR     ADD  NFRS      WANFRS
     C           NFSN      WHEQ '-'
     C           WINTR     SUB  NFRS      WANFRS
     C                     ENDSL
     C                     ENDIF
      *
      **  Compute the maximum and minimum allowable amount
      **  based on the tolerance for Funding Rate.
     C           FTTFRT    DIV  100       WTRATE  32
     C           1         ADD  WTRATE    WMAXTL  42
     C           WINTR     MULT WMAXTL    WMAXRT 117H
     C           1         SUB  WTRATE    WMINTL  42
     C           WINTR     MULT WMINTL    WMINRT 117H
      *
      **  If the Actual Funding Rate is greater than the
      **  maximum or less than the minimum amount,
      **  display warning message.
     C           WANFRS    IFGT WMAXRT
     C           WANFRS    ORLT WMINRT
     C                     MOVE *ON       WARDET
     C**********           MOVEA'1022'    WARA,4                                              CLE031
     C                     MOVEA'1022'    WRN,4                                               CLE031
     C                     MOVE *ON       *IN62
     C           SACTN     IFEQ 'A'
     C           WANFRS    ANDNEWNFRSW
     C                     MOVE *ON       WARNEW
     C                     Z-ADDWANFRS    WNFRSW
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *                                                                                       195070
      ** Send a warning message if new loan amount differs from the                           195070
      ** amount calulated by less than or equal to 5%.                                        195070
      *                                                                                       195070
     C           VNCPA     IFGE WNLAMT                                                        195070
     C           VNCPA     ANDLEWNHAMT                                                        195070
     C           VNCPA     ANDNEWNAMT                                                         195070
     C                     MOVE *ON       WARDET                                              195070
     C                     MOVEA'111'     *IN,52                                              195070
     C                     MOVE 'LEV1049' ZAMSID                                              195070
     C                     MOVE *BLANKS   ZFLD15                                              195070
     C                     MOVE WNAMT     ZFLD15                                              195070
     C                     Z-ADDZCDPO     ZDECS                                               195070
     C                     MOVE 'L'       ZECODE                                              195070
     C                     EXSR ZFRPED                                                        195070
     C           ZNEG      IFEQ '-'                                                           195070
     C                     MOVELZOUT21    ZAMSDA                                              195070
     C                     ELSE                                                               195070
     C                     MOVELZOUT20    ZAMSDA                                              195070
     C                     ENDIF                                                              195070
     C                     EXSR ZASNMS                                                        195070
     C                     ENDIF                                                              195070
      *
      ** Warning message will be sent if exchange rate for multi-
      ** currency rollover is not within 25% of the rate calculated
      ** by the system as spot rate
      *
     C           MULTIC    IFEQ *ON                                       123857
     C           *IN67     OREQ *ON                                                           CLE023
      *                                                                                       CLE023
     C           SNFCEB    IFNE *BLANKS
     C           WNFCE1    ANDNE'*'
     C           *IN53     ANDEQ*OFF
     C           *IN54     ANDEQ*OFF                                      123335
     C           *IN51     ANDEQ*OFF                                      123335
     C           SACTN     ANDEQ'A'
     C           MULTIC    ANDEQ*ON                                                           CLE023
      *                                                                                       CLE023
     C           NCCY      ORNE *BLANKS
     C           NCPA      ANDNE*ZEROS
     C           NFCE      ANDNE*ZEROS
     C           NFMD      ANDNE*BLANK
     C           SACTN     ANDEQ'X'
     C           MULTIC    ANDEQ*ON                                                           CLE023
      *                                                                                       CLE030
     C           NCCY      ORNE *BLANKS                                                       CLE030
     C           NCPA      ANDNE*ZEROS                                                        CLE030
     C           NFCE      ANDNE*ZEROS                                                        CLE030
     C           NFMD      ANDNE*BLANK                                                        CLE030
     C           SACTN     ANDEQ'Q'                                                           CLE030
     C           CLE030    ANDEQ'Y'                                                           CLE030
     C           MULTIC    ANDEQ*ON                                                           CLE030
      *                                                                                       CLE023
      ** Or new facility exchange rate is not equal to blanks and                             CLE023
      ** action is amend and CLE023 is installed and facility is                              CLE023
      ** multi-currency                                                                       CLE023
      *                                                                                       CLE023
     C           SNFCEB    ORNE *BLANKS                                                       CLE023
     C           WNFCE1    ANDNE'*'                                                           CLE023
     C           *IN53     ANDEQ*OFF                                                          CLE023
     C           *IN54     ANDEQ*OFF                                                          CLE023
     C           SACTN     ANDEQ'A'                                                           CLE023
     C           *IN67     ANDEQ*ON                                                           CLE023
      *                                                                                       CLE023
      ** Or new facility exchange rate is not equal to zero and                               CLE023
      ** action is authorise and CLE023 is installed and facility is                          CLE023
      ** multi-currency                                                                       CLE023
      *                                                                                       CLE023
     C           NFCE      ORNE *ZEROS                                                        CLE023
     C           NFMD      ANDNE*BLANK                                                        CLE023
     C           SACTN     ANDEQ'X'                                                           CLE023
     C           *IN67     ANDEQ*ON                                                           CLE023
      *                                                                                       CLE023
      ** Or new facility exchange rate is not equal to zero and                               CLE030
      ** action is Release and CLE023 is installed and facility is                            CLE030
      ** multi-currency and CLE030 is on.                                                     CLE030
      *                                                                                       CLE030
     C           NFCE      ORNE *ZEROS                                                        CLE030
     C           NFMD      ANDNE*BLANK                                                        CLE030
     C           SACTN     ANDEQ'Q'                                                           CLE030
     C           CLE030    ANDEQ'Y'                                                           CLE030
     C           *IN67     ANDEQ*ON                                                           CLE030
      *                                                                                       CLE030
     C           SACTN     IFEQ 'X'
     C           MULTIC    IFEQ *ON                                                           CLE023
     C           NCCY      ANDNE*BLANKS                                                       CLE023
     C           NCCY      ANDNECCY                                                           CLE023
     C                     MOVELNCCY      PCURR                           123335
     C                     ELSE                                                               CLE023
     C                     MOVE CCY       PCURR                                               CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     Z-ADD60        DBASE                           123335
     C                     MOVE *ON       EDBAS                           123335
     C                     EXSR SRCURR                                    123335
     C                     MOVE A6MDIN    WMDIN                           123335
     C                     Z-ADDA6SPRT    WSPRT                           123335
     C                     EXSR SRRATE
     C                     ENDIF
     C           CEU020    IFEQ 'Y'                                       CEU020
     C           SNCCYB    IFEQ BKEURO                                    CEU020
     C           SACTN     ANDEQ'A'                                       CEU020
     C           SNCCY     OREQ BKEURO                                    CEU020
     C           SACTN     ANDEQ'X'                                       CEU020
     C           SNCCY     OREQ BKEURO                                    CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVE 'N'       WTLLMT  1                       CEU020
     C                     ELSE                                           CEU020
     C                     MOVE 'Y'       WTLLMT                          CEU020
     C                     ENDIF                                          CEU020
     C                     ELSE                                           CEU020
     C                     MOVE 'Y'       WTLLMT                          CEU020
     C                     ENDIF                                          CEU020
      *                                                                   CEU020
     C           WTLLMT    IFEQ 'Y'                                       CEU020
     C           PMODE     ANDNE'B'                                                          220754
     C           ZRATEX    MULT .75       WRATL  138H
     C           ZRATEX    MULT 1.25      WRATH  138H
     C           SACTN     IFEQ 'A'
     C                     Z-ADDVNFCE     WANFCE 138
     C                     ELSE
     C                     Z-ADDNFCE      WANFCE
     C                     ENDIF
     C           WANFCE    IFLT WRATL
     C           WANFCE    ORGT WRATH
     C                     MOVE *ON       WARDET
     C**********           MOVEA'0010'    WARA,5                                              CLE031
     C                     MOVEA'0010'    WRN,5                                               CLE031
     C                     MOVE *ON       *IN53
     C           SACTN     IFEQ 'A'
     C           VNFCE     ANDNEWNFCEW
     C                     MOVE *ON       WARNEW
     C                     Z-ADDVNFCE     WNFCEW
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                          CEU020
      *                                                                                       195070
      ** Send a warning message if new loan amount differs from the                           195070
      ** amount calulated by less than or equal to 5%.                                        195070
      *                                                                                       195070
     C           VNCPA     IFGE WNLAMT                                                        195070
     C           VNCPA     ANDLEWNHAMT                                                        195070
     C           VNCPA     ANDNEWNAMT                                                         195070
     C                     MOVE *ON       WARDET                                              195070
     C                     MOVEA'111'     *IN,52                                              195070
     C                     MOVE 'LEV1049' ZAMSID                                              195070
     C                     EXSR ZASNMS                                                        195070
     C                     ENDIF                                                              195070
     C                     ENDIF                                                              CLE023
     C                     ENDIF
      *                                                                   123335
      ** Warning message will be sent if exchange rate for multi-         123335
      ** currency rollover is not within 25% of the spot rate for the     123335
      ** new currency as is stored in file                                123335
      *                                                                   123335
     C           MULTIC    IFEQ *ON                                                           CLE023
     C           SNBCEB    IFNE *BLANKS                                   123335
     C           WNBCE1    ANDNE'*'                                       123335
     C           *IN64     ANDEQ*OFF                                      123335
     C           *IN65     ANDEQ*OFF                                      123335
     C           *IN51     ANDEQ*OFF                                      123335
     C           SACTN     ANDEQ'A'                                       123335
     C           NCCY      ORNE *BLANKS                                   123335
     C           SACTN     ANDEQ'X'                                       123335
     C           NCCY      ORNE *BLANKS                                   CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *                                                                   123335
     C           SACTN     IFEQ 'X'                                       123335
     C           SACTN     OREQ 'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
     C                     MOVELNCCY      PCURR                           123335
     C                     Z-ADD59        DBASE                           123335
     C                     MOVE *ON       EDBAS                           123335
     C                     EXSR SRCURR                                    123335
     C                     MOVE A6MDIN    WMDIN                           123335
     C                     Z-ADDA6SPRT    WSPRT                           123335
     C                     Z-ADDNBCE      VNBCE                           123335
     C***********          MOVE NBMD      SNBMDB                   123335 123857
     C                     MOVE NBMD      WNBMDB  1                       123857
     C                     ELSE                                           123857
     C                     MOVE SNBMDB    WNBMDB                          123857
     C                     ENDIF                                          123335
      *                                                                   123335
     C***********SNBMDB    IFEQ WMDIN                              123335 123857
     C           WNBMDB    IFEQ WMDIN                                     123857
     C                     Z-ADDWSPRT     ZRATEX                          123335
     C                     ELSE                                           123335
     C           1         DIV  WSPRT     ZRATEX    H                     123335
     C                     ENDIF                                          123335
     C           WTLLMT    IFEQ 'Y'                                       CEU020
     C           ZRATEX    MULT .75       WRATL     H                     123335
     C           ZRATEX    MULT 1.25      WRATH     H                     123335
      *                                                                   123335
     C           VNBCE     IFLT WRATL                                     123335
     C           VNBCE     ORGT WRATH                                     123335
     C                     MOVE *ON       WARDET                          123335
     C**********           MOVEA'0012'    WARA,6                                       123335 CLE031
     C                     MOVEA'0012'    WRN,6                                               CLE031
     C                     MOVE *ON       *IN64                           123335
     C           SACTN     IFEQ 'A'                                       123335
     C           VNBCE     ANDNEWNBCEW                                    123335
     C                     MOVE *ON       WARNEW                          123335
     C                     Z-ADDVNBCE     WNBCEW                          123335
     C                     ENDIF                                          123335
     C                     ENDIF                                          CEU020
     C                     ENDIF                                          123335
      *                                                                   123335
     C                     ENDIF                                          123335
     C                     ENDIF                                          123857
      *                                                                   134725
      ** Send warning message if multi-ccy rollover details is            134725
      ** different with related loan                                      134725
      *                                                                   134725
     C           MULTIC    IFEQ *ON                                       134725
     C           *IN51     ANDEQ*OFF                                      134725
     C           *IN52     ANDEQ*OFF                                      134725
     C           *IN53     ANDEQ*OFF                                      134725
     C           *IN54     ANDEQ*OFF                                      134725
     C           *IN55     ANDEQ*OFF                                      134725
     C           *IN64     ANDEQ*OFF                                      134725
     C           *IN65     ANDEQ*OFF                                      134725
     C           MULTIC    OREQ *ON                                       134725
     C           WARDET    ANDEQ*ON                                       134725
      *                                                                   134725
      ** If new ccy was entered or being deleted, use this field to       134725
      ** compare to related loan, otherwise, use the new ccy field        134725
      ** file if not blank.                                               134725
      *                                                                   134725
     C           VNCCY     IFNE *BLANKS                                   134725
     C           WNCCY1    OREQ '*'                                       134725
     C                     MOVE VNCCY     WNCCY   3                       134725
     C                     Z-ADDVNFCE     WNFCE  138                      134725
     C                     MOVE VNFMD     WNFMD   1                       134725
     C                     Z-ADDVNBCE     WNBCE  138                      134725
     C                     MOVE VNBMD     WNBMD   1                       134725
     C                     ELSE                                           134725
     C           NCCY      IFNE *BLANKS                                   134725
     C                     MOVE NCCY      WNCCY                           134725
     C                     Z-ADDNFCE      WNFCE                           134725
     C                     MOVE NFMD      WNFMD                           134725
     C                     Z-ADDNBCE      WNBCE                           134725
     C                     MOVE NBMD      WNBMD                           134725
     C                     ELSE                                           134725
     C                     MOVE *BLANKS   WNCCY                           134725
     C                     Z-ADD*ZEROS    WNFCE                           134725
     C                     MOVE *BLANK    WNFMD                           134725
     C                     Z-ADD*ZEROS    WNBCE                           134725
     C                     MOVE *BLANK    WNBMD                           134725
     C                     ENDIF                                          134725
     C                     ENDIF                                          134725
      *                                                                   134725
      ** If rollover date was entered, use this to compare to rollover    134725
      ** date of the related loan, otherwise use the field from file      134725
      ** if not blank.                                                    134725
      *                                                                   134725
     C           VRLDT     IFGT *ZERO                                     134725
     C           WRLDT1    OREQ '*'                                       134725
     C                     Z-ADDVRLDT     WRLDT   50                      134725
     C                     ELSE                                           134725
     C           RLDT      IFGT *ZERO                                     134725
     C                     Z-ADDRLDT      WRLDT                           134725
     C                     ELSE                                           134725
     C                     Z-ADD*ZERO     WRLDT                           134725
     C                     ENDIF                                          134725
     C                     ENDIF                                          134725
      *                                                                   134725
     C           WNCCY     IFNE *BLANKS                                   134725
     C           WNCCY1    OREQ '*'                                       134725
      *                                                                   134725
     C**********           Z-ADDLNRF      WWLNRF  60                                   134725 CLE148
     C                     MOVELLNRF      WWLNRF  6                                           CLE148
     C           PTYP      IFEQ 66                                        134725
     C           PTYP      OREQ 67                                        134725
     C           PTYP      OREQ 69                                        134725
     C           PTYP      OREQ 72                                        134725
     C                     MOVE 'A'       WRCDT                           134725
     C                     MOVE OLNO      WLNRF                           134725
     C           WLOAN     CHAINCLOAN                89                   134725
      *                                                                   134725
     C           *IN89     IFEQ '0'                                       134725
     C                     MOVE 'B'       WRCDT                           134725
     C                     MOVE LNRF      WLNRF                           134725
     C           WLOAN     CHAINCLOAN                89                   134725
     C                     ENDIF                                          134725
     C           *IN89     IFEQ '0'                                       134725
      *                                                                   134725
      ** Compare multi-ccy details of parts sold to its Sale of loan      134725
      *                                                                   134725
     C           WRLDT     IFEQ RLDT                                      134725
     C           WNCCY     ANDEQNCCY                                      134725
     C           WNFCE     ANDEQNFCE                                      134725
     C           WNBCE     ANDEQNBCE                                      134725
     C           WNFMD     ANDEQNFMD                                      134725
     C           WNBMD     ANDEQNBMD                                      134725
     C**********           Z-ADDLNRF      WOLNO                                        134725 CLE148
     C                     MOVELLNRF      WOLNO                                               CLE148
     C                     ELSE                                           134725
     C                     MOVE *ON       WARDET                          134725
     C**********           MOVEA'1046'    WARA,7                                       134725 CLE031
     C                     MOVEA'1046'    WRN,7                                               CLE031
     C                     MOVE *ON       *IN38                           134725
     C                     MOVE *ON       *IN51                           134725
     C                     MOVE *ON       *IN53                           134725
     C                     MOVE *ON       *IN54                           134725
     C                     MOVE *ON       *IN64                           134725
     C                     MOVE *ON       *IN65                           134725
     C                     MOVELLNRF      ZAMSDA                          134725
     C                     ENDIF                                          134725
     C                     ENDIF                                          134725
     C                     ELSE                                           134725
     C**********           Z-ADDLNRF      WOLNO                                        134725 CLE148
     C                     MOVELLNRF      WOLNO                                               CLE148
     C                     ENDIF                                          134725
      *                                                                   134725
     C********** WOLNO     SETLLPSOLDFF                                                134725 CSD027
     C********** WOLNO     READEPSOLDFF                  85                            134725 CSD027
     C                     MOVE WOLNO     OLNOA                                               CSD027
     C           OLNOA     SETLLPSOLDFF                                                       CSD027
     C           OLNOA     READEPSOLDFF                  89                                   CSD027
      *                                                                   134725
     C           *IN89     DOWEQ*OFF                                      134725
     C           *IN51     ANDEQ*OFF                                      134725
      *                                                                   134725
     C           LNRF      SETLLLOANL2F                                   134725
     C                     READ LOANL2F                  89               134725
      *                                                                   134725
     C           *IN89     IFEQ '0'                                       134725
     C           WWLNRF    ANDNELNRF                                      134725
      *                                                                   134725
      ** Compare multi-ccy details to other related parts sold            134725
      *                                                                   134725
     C           WRLDT     IFEQ RLDT                                      134725
     C           WNCCY     ANDEQNCCY                                      134725
     C           WNFCE     ANDEQNFCE                                      134725
     C           WNBCE     ANDEQNBCE                                      134725
     C           WNFMD     ANDEQNFMD                                      134725
     C           WNBMD     ANDEQNBMD                                      134725
     C                     ELSE                                           134725
     C                     MOVE *ON       WARDET                          134725
     C**********           MOVEA'1046'    WARA,7                                       134725 CLE031
     C                     MOVEA'1046'    WRN,7                                               CLE031
     C                     MOVELLNRF      ZAMSDA                          134725
     C                     MOVE *ON       *IN38                           134725
     C                     MOVE *ON       *IN51                           134725
     C                     MOVE *ON       *IN53                           134725
     C                     MOVE *ON       *IN54                           134725
     C                     MOVE *ON       *IN64                           134725
     C                     MOVE *ON       *IN65                           134725
     C                     ENDIF                                          134725
     C                     ENDIF                                          134725
     C********** WOLNO     READEPSOLDFF                  89                            134725 CSD027
     C           OLNOA     READEPSOLDFF                  89                                   CSD027
     C                     ENDDO                                          134725
      *                                                                   134725
      ** Retrieve back original values of loan being rolled over          134725
      *                                                                   134725
     C                     MOVEL'A'       WRCDT                           134725
     C                     MOVE WWLNRF    WLNRF                           134725
     C           WLOAN     SETLLCLOAN                                     134725
     C           WLOAN     READECLOAN                    89               134725
     C                     MOVEL'B'       WRCDT                           134725
     C           WLOAN     SETLLCLOAN                                     134725
     C           WLOAN     READECLOAN                    89               134725
     C                     ENDIF                                          134725
     C                     ENDIF                                          134725
      *                                                                   CLE011
      ** Send warning message if rollover date, new base rate,            CLE011
      ** new spread/rate, new spread indicator, new spread                CLE011
      ** indicator, or the new currency are amended or removed.           CLE011
      *                                                                   CLE011
     C           CLE011    IFEQ 'Y'                                       CLE011
     C           RFRI      ANDEQ'Y'                                       CLE011
      *                                                                   CLE011
     C                     MOVE *BLANKS   ZFIELD                          CLE011
     C                     MOVE SNRTSB    ZFIELD                          CLE011
     C                     Z-ADD7         ZADEC                           CLE011
     C                     Z-ADD4         ZADIG                           CLE011
     C                     EXSR ZALIGN                                    CLE011
     C                     MOVE ZFIELD    WNRTSB 117                      CLE011
      *                                                                   CLE011
     C           SRLDTB    IFNE SRLDT                                     CLE011
     C           SRLDTB    ANDNE*BLANKS                                   CLE011
     C           SNBRAB    ORNE SNBRAB                                    CLE011
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           SNBRTB    ANDNESNBRT                                                         CLE036
     C           WNRTSB    ORNE NRTS                                      CLE011
     C           WNRTSB    ANDNE0                                         CLE011
     C           SNSINB    ORNE SNSIN                                     CLE011
     C           SNSINB    ANDNE*BLANK                                    CLE011
     C           SNCHIB    ORNE SNCHI                                     CLE011
     C           SNCHIB    ANDNE*BLANK                                    CLE011
     C           SNCCYB    ORNE SNCCY                                     CLE011
     C           SNCCYB    ANDNE*BLANKS                                   CLE011
      *                                                                   CLE011
     C                     MOVE *ON       WARDET                          CLE011
      *                                                                   CLE011
     C                     SELEC                                          CLE011
      ** Loan                                                             CLE011
     C           PTYP      WHEQ 61                                        CLE011
     C           PTYP      OREQ 62                                        CLE011
     C           PTYP      OREQ 63                                        CLE011
     C           PTYP      OREQ 70                                        CLE011
     C**********           MOVEA'0403'    WARA,8                                       CLE011 CLE031
     C                     MOVEA'0403'    WRN,8                                               CLE031
      ** Participation Purchased                                          CLE011
     C           PTYP      WHEQ 64                                        CLE011
     C           PTYP      OREQ 65                                        CLE011
     C           PTYP      OREQ 68                                        CLE011
     C           PTYP      OREQ 71                                        CLE011
     C**********           MOVEA'0404'    WARA,8                                       CLE011 CLE031
     C                     MOVEA'0404'    WRN,8                                               CLE031
      ** Participation Sold                                               CLE011
     C           PTYP      WHEQ 66                                        CLE011
     C           PTYP      OREQ 67                                        CLE011
     C           PTYP      OREQ 69                                        CLE011
     C           PTYP      OREQ 72                                        CLE011
     C**********           MOVEA'0405'    WARA,8                                       CLE011 CLE031
     C                     MOVEA'0405'    WRN,8                                               CLE031
     C                     ENDSL                                          CLE011
      *                                                                   CLE011
     C                     ENDIF                                          CLE011
      *                                                                   CLE011
     C                     ENDIF                                          CLE011
      *                                                                                       CLE023
      ** Display warning message if new facility exchange rate cannot                         CLE023
      ** be defaulted due to existing loan amendments even if default                         CLE023
      ** rate to spot indicator is 'Y'                                                        CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           *IN67     ANDEQ*ON                                                           CLE023
     C           WFCXRA    ANDEQ'N'                                                           CLE023
     C           BPDRTS    ANDEQ'Y'                                                           CLE023
     C           VNFCE     ANDEQ*ZEROS                                                        CLE023
     C           WNFCE1    ANDNE'*'                                                           CLE023
     C                     MOVE *ON       WARDET                                              CLE023
     C**********           MOVEA'1060'    WARA,9                                       CLE023 CLE031
     C                     MOVEA'1060'    WRN,9                                               CLE031
     C                     MOVE *ON       *IN53                                               CLE023
     C                     MOVE *ON       *IN54                                               CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE031
      ** Check if the facility utilisation is going to be exceeded                            CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           RVCR      ANDEQ'Y'                                                           CLE031
     C           SNPRAB    ANDNE*BLANKS                                                       CLE031
     C           *IN47     ANDEQ*OFF                                                          CLE031
     C           *IN53     ANDEQ*OFF                                                          CLE031
      *                                                                                       CLE031
     C           SNFCEB    IFNE *BLANKS                                                       CLE031
     C           SNFCE     ORNE *BLANKS                                                       CLE031
      *                                                                                       CLE031
      ** Retrieve facilities detail B record                                                  CLE031
      *                                                                                       CLE031
     C**********           Z-ADDFCUS      WFCNUM                                       CLE031 CSD027
     C                     MOVE FCUS      WFCNUM                                              CSD027
     C                     Z-ADDFTYP      WFFACT                                              CLE031
     C                     Z-ADDFSEQ      WFFCNO                                              CLE031
     C                     MOVE 'B'       WFRCTP                                              CLE031
      *                                                                                       CLE031
     C           KFCLT     CHAINFCLTY                68                                       CLE031
      *                                                                                       CLE031
     C           *IN68     IFEQ '1'                                                           CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'FCLTY   'DBFILE                                              CLE031
     C                     Z-ADD75        DBASE                                               CLE031
     C                     MOVELFCTREC    DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     Z-ADD*ZEROS    W1AM   130                                          CLE031
     C                     Z-ADD1         Z                                                   CLE031
     C           Z         DOWLE10                                                            CLE031
     C           RUNS,Z    ANDLEDTEX                                                          CLE031
      *                                                                                       CLE034
      ** Compute for the over-line facility amount depending on whether an                    CLE034
      ** over-line % or over-line amount is specified for the facility                        CLE034
      *                                                                                       CLE034
     C           OVPC      IFNE *ZEROS                                                        CLE034
     C           OVPC      DIV  100       WKOVPC  53                                          CLE034
     C           FAMT      MULT WKOVPC    WKOVFA 153                                          CLE034
     C                     ADD  FAMT      WKOVFA                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           OVAM      IFNE *ZEROS                                                        CLE034
     C           OVAM      ADD  FAMT      WKOVFA                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE031
     C           RUNS,Z    IFGE WRLDT                                                         CLE031
     C********** FAMT      ANDLTOAM,Z                                                  CLE031 CLE034
     C           WKOVFA    ANDLTOAM,Z                                                         CLE034
     C           RUNS,Z    ORGE WRLDT                                                         CLE031
     C********** FAMT      ANDLTWNPRAM                                                 CLE031 CLE034
     C           WKOVFA    ANDLTWNPRAM                                                        CLE034
      *                                                                                       CLE031
     C           WE003     IFEQ *BLANK                                                        CLE031
     C           WE003     OREQ 'Y'                                                           CLE031
     C           WNPRAM    ANDNEW1AM                                                          CLE031
     C                     Z-ADDWNPRAM    W1AM                                                CLE031
     C                     MOVE 'Y'       WE003   1                                           CLE031
     C                     MOVE *ON       WARDET                                              CLE031
     C                     MOVEA'1067'    WRN,10                                              CLE031
     C                     MOVE '1'       *IN47                                               CLE031
     C                     LEAVE                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ADD  1         Z                                                   CLE031
     C                     ENDDO                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *
      **  Display warning messages if any.
      *
     C           WARDET    IFEQ *ON
     C           1         DO   WARS      W2N0    20
     C********** WARA,W2N0 IFNE *BLANKS                                                       CLE031
     C           WRN,W2N0  IFNE *BLANKS                                                       CLE031
     C**********           MOVELWARA,W2N0 W4WAR7                                              CLE031
     C                     MOVELWRN,W2N0  W4WAR7                                              CLE031
     C                     MOVELW1WAR7    ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDDO
     C           WARFST    IFEQ *ON
     C                     MOVE *ON       WARNEW
     C                     MOVE *OFF      WARFST
     C                     ELSE
     C                     MOVE *OFF      WARNEW
     C                     ENDIF
      *
     C                     ELSE
     C           WARFST    IFEQ *OFF
     C                     MOVE *ON       WARFST
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRNDAM  -  Check New Discount amount against calculated       *
      * Called by: SRVDET - Validation of Detail Screen               *
      * Calls    : SREFFI - Calculate the effective interest          *
      *****************************************************************
     C           SRNDAM    BEGSR
      *
      **  Get the effective interest.
      *
     C                     EXSR SREFFI
      *
      **  Calculate discount between rollover and
      **  next rollover dates.  If rollover date was
      **  not validated successfully use maturity date.
      *
      ** Calculate interest only if next rollover date has been entered   144690
      *                                                                   144690
     C           VNROD     IFGT 0                                         144690
      *                                                                   144690
     C           VRLDT     IFGT *ZEROS
     C                     Z-ADDVRLDT     ZIBEG
     C                     ELSE
     C                     Z-ADDMDAT      ZIBEG
     C                     ENDIF
     C                     Z-ADDCALC      ZICALC
     C                     Z-ADDVNROD     ZIEND
     C**********           Z-ADDVNPRAM    ZIAMT                                               CLE031
     C                     Z-ADDWVPRAM    ZIAMT                                               CLE031
     C                     Z-ADDWINTR     ZIRATE
     C/COPY WNCPYSRC,LE2070C017
     C                     EXSR GLINTC
     C/COPY WNCPYSRC,LE2070C018
      *
      **  Round down interest if necessary.
      *
     C           RDFC      IFEQ 'Y'
     C                     Z-ADDZINTR     CHCKI  130
     C                     ELSE
     C                     Z-ADDZINTR     CHCKI     H
     C                     ENDIF
      *
      **  Check if entered New Discount amount is similar
      **  with the calculated within 1 unit.
      *
     C           CHCKI     IFLT *ZERO
     C                     Z-SUBCHCKI     CHCKI
     C                     ENDIF
     C           WNDAM     SUB  CHCKI     CHK2   130
     C           CHK2      IFLT *ZERO
     C                     Z-SUBCHK2      CHK2
     C                     ENDIF
     C           CHK2      IFGT 1
     C                     MOVEL'LEV0463' ERRMID
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CHCKI     ZFIELD
     C                     EXSR ZEDIT
     C                     MOVELZFIELD    ZAMSDA    P
     C                     ELSE
     C                     Z-ADDWINTR     VINTR
     C                     ENDIF
      *                                                                   144690
     C                     ENDIF                                          144690
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SREFFI  -  Calculate the Effective Interest                   *
      * Called by: SRVDET - Validation of Detail Screen               *
      *            SRNDAM - Check new discount amt against calculated *
      * Calls    : None                                               *
      *****************************************************************
     C           SREFFI    BEGSR
      *                                                                                       CLE036
      ** If CLE036 is on and New base rate is entered, use this                               CLE036
      ** in calculating the Effective Interest                                                CLE036
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C           SNBRTB    ANDNE*BLANKS                                                       CLE036
     C           WNBRT1    ANDNE'*'                                                           CLE036
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           SNBRT     ANDNE*BLANKS                                                       CLE036
     C           WNBRT1    ANDNE'*'                                                           CLE036
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           NBSR      ANDNE*ZEROS                                                        CLE036
     C           WNBRT1    ANDNE'*'                                                           CLE036
      *                                                                                       CLE036
      ** No new rollover details entered; obtain base rate                                    CLE036
      ** and spread/rate to be used in computation from file                                  CLE036
      *                                                                                       CLE036
     C           SNBRTB    IFEQ *BLANKS                                                       CLE036
     C           SNRTSB    ANDEQ*BLANKS                                                       CLE036
     C           SNSINB    ANDEQ*BLANK                                                        CLE036
     C           SNCASB    ANDEQ*BLANK                                                        CLE036
     C           SNCHIB    ANDEQ*BLANK                                                        CLE036
     C           SACTN     ANDEQ'A'                                                           CLE036
     C           SNBRT     OREQ *BLANKS                                                       CLE036
     C           SNRTS     ANDEQ*BLANKS                                                       CLE036
     C           SNSIN     ANDEQ*BLANK                                                        CLE036
     C           SNCAS     ANDEQ*BLANK                                                        CLE036
     C           SNCHI     ANDEQ*BLANK                                                        CLE036
     C           SACTN     ANDEQ'X'                                                           CLE036
      *                                                                                       CLE036
      ** Next base rate on file is blank                                                      CLE036
      *                                                                                       CLE036
     C           NBSR      IFEQ *ZEROS                                                        CLE036
      *                                                                                       CLE036
      ** If next spread/rate and other related fields                                         CLE036
      ** are blank, use old details from file                                                 CLE036
      *                                                                                       CLE036
     C           NRTS      IFEQ *ZEROS                                                        CLE036
     C           NSIN      ANDEQ*BLANK                                                        CLE036
     C           NCAS      ANDEQ*ZERO                                                         CLE036
     C           NCHI      ANDEQ*BLANK                                                        CLE036
     C                     MOVE SPIN      SPRIND                                              CLE036
     C                     Z-ADDRTSP      SPREAD                                              CLE036
     C                     MOVE ICBS      CALC                                                CLE036
     C                     Z-ADDBRTE      BASE                                                CLE036
     C                     ELSE                                                               CLE036
     C                     Z-ADD*ZEROS    BASE                                                CLE036
     C                     MOVE NSIN      SPRIND                                              CLE036
     C                     Z-ADDNRTS      SPREAD                                              CLE036
     C                     Z-ADDNCAS      CALC                                                CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
      ** Next base rate on file is not blank                                                  CLE036
      *                                                                                       CLE036
     C                     ELSE                                                               CLE036
      *                                                                                       CLE036
     C                     Z-ADDNBSR      BASE                                                CLE036
     C                     MOVE NSIN      SPRIND                                              CLE036
     C                     Z-ADDNRTS      SPREAD                                              CLE036
     C                     Z-ADDNCAS      CALC                                                CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
      ** Use newly-entered rollover details                                                   CLE036
      *                                                                                       CLE036
     C                     ELSE                                                               CLE036
      *                                                                                       CLE036
     C                     MOVE VNSIN     SPRIND                                              CLE036
     C                     Z-ADDVNRTS     SPREAD                                              CLE036
     C                     Z-ADDVNCAS     CALC                                                CLE036
      *                                                                                       CLE036
      ** Use the correct base rate depending on action code                                   CLE036
      *                                                                                       CLE036
     C           SACTN     IFEQ 'A'                                                           CLE036
     C                     MOVE SNBRTB    W#BRTB 12                                           CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE SNBRT     W#BRTB                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           W#BRTB    IFEQ *BLANKS                                                       CLE036
     C                     Z-ADD*ZEROS    BASE                                                CLE036
     C                     ELSE                                                               CLE036
     C                     Z-ADDVNBRT     BASE                                                CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
      ** If CLE036 is off or is on and New base rate code is                                  CLE036
      ** entered, get Effective Interest as per existing calculation                          CLE036
      *                                                                                       CLE036
     C                     ELSE                                                               CLE036
      *
      **  No new rollover details entered.  Obtain base rate
      **  and spread/rate to be used in computation from file.
      *
     C           SNBRAB    IFEQ *BLANKS
     C           SNRTSB    ANDEQ*BLANKS
     C           SNSINB    ANDEQ*BLANK
     C           SNCASB    ANDEQ*BLANK
     C           SNCHIB    ANDEQ*BLANK
     C           SACTN     ANDEQ'A'                                       123857
     C           SNBRA     OREQ *BLANKS                                   123857
     C           SNRTS     ANDEQ*BLANKS                                   123857
     C           SNSIN     ANDEQ*BLANK                                    123857
     C           SNCAS     ANDEQ*BLANK                                    123857
     C           SNCHI     ANDEQ*BLANK                                    123857
     C           SACTN     ANDEQ'X'                                       123857
      *                                                                   CLE030
     C           SNBRA     OREQ *BLANKS                                   CLE030
     C           SNRTS     ANDEQ*BLANKS                                   CLE030
     C           SNSIN     ANDEQ*BLANK                                    CLE030
     C           SNCAS     ANDEQ*BLANK                                    CLE030
     C           SNCHI     ANDEQ*BLANK                                    CLE030
     C           SACTN     ANDEQ'Q'                                       CLE030
     C           CLE030    ANDEQ'Y'                                       CLE030
      *
      **  Next base rate code on file is blank.
     C********** NBRA      IFEQ *ZEROS                                                        CSD103
     C           NBRA      IFEQ *BLANKS                                                       CSD103
      *
      **  If next spread/rate and other related fields
      **  are blank, use old details from file.
     C           NRTS      IFEQ *ZEROS
     C           NSIN      ANDEQ*BLANK
     C           NCAS      ANDEQ*ZERO
     C           NCHI      ANDEQ*BLANK
     C                     MOVE SPIN      SPRIND  1
     C                     Z-ADDRTSP      SPREAD 117
     C                     MOVE ICBS      CALC    10
     C                     Z-ADDBRTE      BASE   117
     C                     ELSE
     C                     Z-ADD*ZEROS    BASE
     C                     MOVE NSIN      SPRIND
     C                     Z-ADDNRTS      SPREAD
     C                     Z-ADDNCAS      CALC
     C                     ENDIF
      *
      **  Next base rate code on file is not blank.
     C                     ELSE
      *
      **  Obtain new base rate base on the
      **  next base rate code.
     C                     MOVE NBRA      PBRAT
     C                     CALL 'AOBSRTR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY    'POPTN
     C                     PARM CCY       PCURR
     C                     PARM           PBRAT
     C********** SDBSRT    PARM SDBSRT    DSFDY                                 CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                                 CSD006
      *
     C           PRTCD     IFEQ *BLANKS
     C                     Z-ADDBANBRT    BASE
      *
      **  Apply new base rate if rollover date is earlier
      **  than base rate value date in the Base rate codes file.
     C           VRLDT     IFLT BAVDNR
     C                     Z-ADDBACBSR    BASE
     C                     ENDIF
     C                     MOVE NSIN      SPRIND
     C                     Z-ADDNRTS      SPREAD
     C                     Z-ADDNCAS      CALC
     C                     ENDIF
     C                     ENDIF
      *
      **  Otherwise, obtain base rate and spread/rate
      **  from newly entered rollover details.
      **  If some amendable fields are blank,
      **  get its values from the file.
     C                     ELSE
     C                     MOVE VNSIN     SPRIND
     C                     Z-ADDVNRTS     SPREAD
     C                     Z-ADDVNCAS     CALC
      *
      * Need to use the right field to retrive base rate code in          127497
      * authorisation mode.                                               127497
      *                                                                   127497
     C           SACTN     IFEQ 'I'                                       127497
     C                     MOVE SNBRAB    W#BRAB  2                       127497
     C                     ELSE                                           127497
     C                     MOVE SNBRA     W#BRAB                          127497
     C                     ENDIF                                          127497
      *                                                                   127497
     C***********SNBRAB    IFEQ *BLANKS                                   127497
     C           W#BRAB    IFEQ *BLANKS                                   127497
     C                     Z-ADD*ZEROS    BASE
     C                     ELSE
      *
      **  Apply new base rate if rollover date is earlier
      **  than base rate value date in the Base rate codes file.
     C           VRLDT     IFLT BAVDNR
     C                     Z-ADDBACBSR    BASE
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                                       CLE036
     C                     ENDIF                                                              CLE036
      *
      **  Calculate interest rate to be used.
      *
     C                     SELEC
     C           SPRIND    WHEQ 'A'
     C           BASE      ADD  SPREAD    WINTR
     C           SPRIND    WHEQ 'S'
     C           BASE      SUB  SPREAD    WINTR
     C           SPRIND    WHEQ 'P'
     C           SPREAD    DIV  100       WRK139 139
     C           WRK139    MULT BASE      WINTR  117H
     C                     ENDSL
      *
     C                     ENDSR
      /EJECT                                                              166578
      *****************************************************************   166578
      * SRDEFL  -  Defaulting of Settlement Details for Multi-ccy     *   166578
      *            Rollover                                           *   166578
      * Called by: SRFXST - Format Fields for Extended Settlement     *   166578
      * Calls    : None                                               *   166578
      *****************************************************************   166578
     C           SRDEFL    BEGSR                                          166578
      *                                                                   166578
     C                     MOVE 'LE'      WBRTY                           166578
     C                     MOVE SNCCYB    WCCY                            166578
     C           KEXST     CHAINSDEXSTL0             66                   166578
      *                                                                   166578
     C           *IN66     IFEQ '1'                                       166578
     C                     MOVE 'AT'      WBRTY                           166578
     C           KEXST     CHAINSDEXSTL0             66                   166578
     C                     ENDIF                                          166578
      *                                                                   166578
      ** For EMU Multi-ccy Rollover                                       166578
      *                                                                   166578
     C                     MOVE 'N'       WDEFL   1                       166578
     C           *IN66     IFEQ '0'                                       166578
     C           BYSTCY    ANDNE*BLANKS                                   166578
     C           CEU020    ANDEQ'Y'                                       166578
     C           *IN66     OREQ '0'                                       166578
     C           BYSTCY    ANDNE*BLANKS                                   166578
     C           CEU004    ANDEQ'Y'                                       166578
     C                     MOVE 'Y'       WDEFL   1                       166578
     C                     MOVE 'LE'      WBRTY                           166578
     C                     MOVE BYSTCY    WCCY                            166578
     C                     MOVE BYIERI    WIERI   1                       166578
     C                     MOVELBYSTCY    PMRSCY                          166578
     C                     MOVELBYSTCY    PMPSCY                          166578
     C           KEXST     CHAINSDEXSTL0             66                   166578
      *                                                                   166578
     C           *IN66     IFEQ '1'                                       166578
     C                     MOVE 'AT'      WBRTY                           166578
     C           KEXST     CHAINSDEXSTL0             66                   166578
     C                     ENDIF                                          166578
     C           *IN66     IFEQ '1'                                       166578
     C                     MOVE *BLANKS   PMRSCY                          166578
     C                     MOVE *BLANKS   PMPSCY                          166578
     C                     MOVE *BLANKS   PMIC72                          166578
     C                     ENDIF                                          166578
     C                     ENDIF                                          166578
      *                                                                   166578
     C           *IN66     IFEQ '0'                                       166578
     C           WDEFL     OREQ 'Y'                                       166578
      *                                                                   166578
     C                     MOVE BYRSTY    PMRSTM                          166578
     C           BYRSTY    IFEQ '05'                                      166578
     C           BGMBIN    ANDEQ'Y'                                       166578
     C           CLE033    OREQ 'Y'                                       CLE033
     C           BYRSTY    ANDEQ'09'                                      CLE033
     C                     MOVELBYORBR    PMRONS                          166578
     C                     MOVE BYRONO    PMRONS                          166578
     C                     ELSE                                           166578
     C                     MOVELBYRONO    PMRONS                          166578
     C                     ENDIF                                          166578
     C           BYPSTY    IFEQ '05'                                      166578
     C           BGMBIN    ANDEQ'Y'                                       166578
     C           CLE033    OREQ 'Y'                                       CLE033
     C           BYPSTY    ANDEQ'09'                                      CLE033
     C                     MOVELBYOPBR    PMPONS                          166578
     C                     MOVE BYPONO    PMPONS                          166578
     C                     ELSE                                           166578
     C                     MOVELBYPONO    PMPONS                          166578
     C                     ENDIF                                          166578
      *                                                                   166578
     C                     MOVELBYROBN    PAROBN                          166578
     C                     MOVELBYROCS    PAROCN                          166578
     C                     MOVELBYRIBN    PARIBN                          166578
     C                     MOVELBYRIBL    PMRIBA                          166578
     C                     MOVELBYPSTY    PMPSTM                          166578
     C                     MOVELBYPOBN    PMPOBN                          166578
     C                     MOVELBYPOCS    PAPOCN                          166578
     C                     MOVELBYPIBN    PAPIBN                          166578
     C                     MOVELBYPIBA    PMPIBA                          166578
     C                     MOVELBYRCNO    PMRCRN                          166578
     C                     MOVELBYRCAL    PMRCRA                          166578
     C                     MOVELBYRCNB    PARVNO                          166578
     C                     MOVELBYACBN    PAAWBN                          166578
     C                     MOVELBYACBL    PMAWBA                          166578
     C                     MOVELBYBYNB    PABENN                          166578
     C                     MOVELBYBACL    PMBENA                          166578
     C                     MOVELBYDPY1    PMDTP1                          166578
     C                     MOVELBYDPY2    PMDTP2                          166578
     C                     MOVELBYDPY3    PMDTP3                          166578
     C                     MOVELBYDPY4    PMDTP4                          166578
     C                     MOVELBYDECG    PMDCHG                          166578
     C                     MOVELBYBBI1    PMBTB1                          166578
     C                     MOVELBYBBI2    PMBTB2                          166578
     C                     MOVELBYBBI3    PMBTB3                          166578
     C                     MOVELBYBBI4    PMBTB4                          166578
     C                     MOVELBYBBI5    PMBTB5                          166578
     C                     MOVELBYBBI6    PMBTB6                          166578
     C                     MOVELBYCVMR    PMCVMR                          166578
     C                     MOVELPAPIBN    PMPIBN                          CLE034
     C                     MOVELPAPOBN    PMPOBN                          CLE034
     C                     MOVELPAPOCN    PMPOCN                          CLE034
     C                     MOVELPARCRN    PMRCRN                          CLE034
     C                     MOVELPARVNO    PMRVNO                          CLE034
     C                     MOVELPAAWBN    PMAWBN                          CLE034
     C                     MOVELPABENN    PMBENN                          CLE034
      *                                                                   166578
     C           SNCCYB    IFNE BKEURO                                    166578
     C           PMPSCY    ANDEQBKEURO                                    166578
     C           WIERI     ANDEQ'Y'                                       166578
     C                     MOVELSNCCYB    PMIC72                          166578
     C                     ENDIF                                          166578
      *                                                                   166578
     C                     ELSE                                           166578
     C                     Z-ADD*ZEROS    PMRSTM                          166578
     C                     MOVE *BLANKS   PMRONS                          166578
     C                     MOVE *BLANKS   PMROCN                          166578
     C                     MOVE *BLANKS   PAROCN                          166578
     C                     MOVE *BLANKS   PMROBN                          166578
     C                     MOVE *BLANKS   PAROBN                          166578
     C                     MOVE *BLANKS   PMRIBN                          166578
     C                     MOVE *BLANKS   PARIBN                          166578
     C                     MOVE *BLANKS   PMRIBA                          166578
      *                                                                   166578
     C                     Z-ADD*ZEROS    PMPSTM                          166578
     C                     MOVE *BLANKS   PMPONS                          166578
     C                     MOVE *BLANKS   PAPIBN                          166578
     C                     MOVE *BLANKS   PMPIBA                          166578
     C                     MOVE *BLANKS   PAPOBN                          166578
     C                     MOVE *BLANKS   PAPOCN                          166578
     C                     MOVE *BLANKS   PMCVMR                          166578
     C                     MOVE *BLANKS   PARCRN                          166578
     C                     MOVE *BLANKS   PMRCRA                          166578
     C                     MOVE *BLANKS   PARVNO                          166578
     C                     MOVE *BLANKS   PAAWBN                          166578
     C                     MOVE *BLANKS   PMAWBA                          166578
     C                     MOVE *BLANKS   PABENN                          166578
     C                     MOVE *BLANKS   PMBENA                          166578
     C                     MOVE *BLANKS   PMDTP1                          166578
     C                     MOVE *BLANKS   PMDTP2                          166578
     C                     MOVE *BLANKS   PMDTP3                          166578
     C                     MOVE *BLANKS   PMDTP4                          166578
     C                     MOVE *BLANKS   PMDCHG                          166578
     C                     MOVE *BLANKS   PMBTB1                          166578
     C                     MOVE *BLANKS   PMBTB2                          166578
     C                     MOVE *BLANKS   PMBTB3                          166578
     C                     MOVE *BLANKS   PMBTB4                          166578
     C                     MOVE *BLANKS   PMBTB5                          166578
     C                     MOVE *BLANKS   PMBTB6                          166578
     C                     MOVE *BLANKS   PMPOBR                          166578
     C                     MOVE *BLANKS   PMPOBN                          166578
     C                     MOVE *BLANKS   PMPOCN                          166578
     C                     MOVE *BLANKS   PMRCRN                          166578
     C                     MOVE *BLANKS   PMRVNO                          166578
     C                     MOVE *BLANKS   PMAWBN                          166578
     C                     MOVE *BLANKS   PMBENN                          166578
     C                     MOVE *BLANKS   PMPIBN                          166578
     C                     MOVE *BLANKS   PMPOBN                          166578
     C                     MOVE *BLANKS   PMPOCN                          166578
     C                     MOVE *BLANKS   PMRCRN                          166578
     C                     MOVE *BLANKS   PMRVNO                          166578
     C                     MOVE *BLANKS   PMAWBN                          166578
     C                     MOVE *BLANKS   PMBENN                          166578
     C                     MOVE *BLANKS   PMRSCY                          166578
     C                     MOVE *BLANKS   PMPSCY                          166578
     C                     MOVE *BLANKS   PMIC72                          166578
     C                     ENDIF                                          166578
      *                                                                   166578
     C                     ENDSR                                          166578
      /EJECT
      *****************************************************************
      * SRRVFD  -  Define Removeable fields                           *
      * Called by: SRVDET - Validation of Detail Screen               *
      * Calls    : None                                               *
      *****************************************************************
     C           SRRVFD    BEGSR
      *
      **  Rollover date
     C                     MOVELSRLDTB    WRLDT1  1
      *
      **  Rollover frequency and day number
     C                     MOVELSRLFQB    WRLFQ1  1
     C                     MOVELSRLDYB    WRLDY1  1
      *
      **  New base rate
     C                     MOVELSNBRAB    WNBRA1  1
      *                                                                                       CLE036
     C                     MOVELSNBRTB    WNBRT1  1                                           CLE036
      *                                                                                       CLE036
      ** New base rate code                                                                   CLE036
      *                                                                                       CLE036
      *
      **  New spread/rate and spread indicator
     C                     MOVELSNRTSB    WNRTS1  1
     C                     MOVELSNSINB    WNSIN1  1
      *                                                                                     AR847588
      **  New spread rate sign.                                                             AR847588
      *                                                                                     AR847588
     C                     MOVELSRSGNB    WRSGN1  1                                         AR847588
      *
      **  New interest calculation basis
     C                     MOVELSNCASB    WNCAS1  1
      *
      **  New change indicator
     C                     MOVELSNCHIB    WNCHI1  1
      *
      **  Next rollover date
     C                     MOVELSNRODB    WNROD1  1
      *                                                                                       CAS001
      **  New Forward Yield Curve                                                             CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVELSFYLDB    WNFYLD  1                                           CAS001
     C                     ENDIF                                                              CAS001
      *
      **  Principal
     C                     MOVELSNPRAB    WNPRA1  1
      *
      **  New discount amount
     C                     MOVELSNDAMB    WNDAM1  1
      *
      **  New interest and maturity date - for S01465
     C           *IN60     IFEQ *ON
     C                     MOVELSNIPDB    WNIPD1  1
     C                     MOVELSNMDTB    WNMDT1  1
     C                     ENDIF
      *
      **  For multi-ccy rolover
      *
      **  New currency
     C           *IN61     IFEQ *ON
     C                     MOVELSNCCYB    WNCCY1  1
      *
      **  New currency amount
     C                     MOVELSNCPAB    WNCPA1  1
      *
      **  Exchange rate
     C                     MOVELSNFCEB    WNFCE1  1
      *
      **  Exchange rate indicator
     C                     MOVELSNFMDB    WNFMD1  1
      *                                                                   123335
      **  Base ccy exchange rate                                          123335
     C                     MOVELSNBCEB    WNBCE1  1                       123335
      *                                                                   123335
      **  Base ccy exchange rate indicator                                123335
     C                     MOVELSNBMDB    WNBMD1  1                       123335
      *
      **  Next loan currency repayment amount.
     C                     MOVELSNLRAB    WNLRA1  1
     C                     ELSE                                                               CLE023
      *                                                                                       CLE023
      ** Facility exchange rate and indicator if CLE023 is installed                          CLE023
      ** and facility is multi-currency                                                       CLE023
      *                                                                                       CLE023
     C           *IN67     IFEQ *ON                                                           CLE023
     C                     MOVELSNFCEB    WNFCE1  1                                           CLE023
     C                     MOVELSNFMDB    WNFMD1  1                                           CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRLTRX  -  Update LTRIX header and detail record.             *
      * Called by: SRUAUT - Update files for Authorise action.        *
      * Calls    : SRCURR - Get currency details                      *
      *****************************************************************
     C           SRLTRX    BEGSR
      *
      **  Get telex notice days.
      *
      ** If CLE034 is on, Settlement Allocations is 'Y', &                                    CLE034
      ** Settle through Nostros is 'Y'                                                        CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SRSTA     ANDEQ'Y'                                                           CLE034
     C           PSTNOS    ANDEQ'Y'                                                           CLE034
     C                     MOVE CCY       PCURR                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE BJLCCY    PCURR                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SRSTA     ANDEQ'N'                                                           CLE034
     C           CLE034    OREQ 'N'                                                           CLE034
     C                     MOVE SDST      WSDST   2
     C           WSDST     LOKUPLNOST                    85
     C           *IN85     IFEQ *OFF
     C                     MOVELBJLCCY    PCURR
     C                     ELSE
     C                     MOVELCCY       PCURR
     C                     ENDIF
     C                     ENDIF                                                              CLE034
     C                     MOVE *BLANKS   A6CYCD
     C                     MOVE *ON       EDBAS
     C                     Z-ADD56        DBASE
     C                     EXSR SRCURR
      *
     C                     Z-ADDA6TXND    ZNRDYS
     C           *IN40     IFEQ *OFF
     C                     MOVELCCY       ZCCY
     C                     ELSE
     C                     MOVELBJLCCY    ZCCY
     C                     ENDIF
     C                     Z-ADDBJRDNB    ZDAYNO
     C                     MOVELBJLCCY    ZCCY1
     C                     MOVELCCY       ZCCY2
     C                     EXSR ZF2C
      *
     C                     Z-ADDRLDT      XROLD   50
      *
      **  Write record to LTRIX for pay/receive if
      **    1. Rollover date is not zero
      **  + 2. Rollover date is not less than rundate
      **  + 3. Rollover date is within telex notice days
      **  + 4. Rollover date is same as original maturity date on loan.
      *
     C           OMDT      IFNE *ZEROS
     C           XROLD     ANDEQOMDT
     C           XROLD     ANDLEZDYNBR
     C           OMDT      ANDGEBJRDNB
      *
      ****Read*LTRIX*header.*******************************************                     AR322732
     C**********           Z-ADD1         LXRRN   50                                        AR322732
     C********** LXRRN     CHAINLTRIX                85                                     AR322732
     C********** *IN85     IFEQ *OFF                                                        AR322732
     C********** RECIX     IFEQ 'H'                                                         AR322732
     C********** RRNAX     IFGT FLSZX                                                       AR322732
     C**********           MOVE *ON       *INU8                                             AR322732
     C**********           ENDIF                                                            AR322732
     C**********           ELSE                                                             AR322732
     C**********           MOVE *ON       *IN85                                             AR322732
     C**********           ENDIF                                                            AR322732
     C**********           ENDIF                                                            AR322732
     C********** *IN85     IFEQ *ON                                                         AR322732
     C********** *INU8     OREQ *ON                                                         AR322732
     C********** *LOCK     IN   LDA                                                         AR322732
     C**********           MOVEL'LTRIX   'DBFILE           ************                     AR322732
     C**********           Z-ADD11        DBASE            * DBERR 11 *                     AR322732
     C**********           MOVEL'1     '  DBKEY            ************                     AR322732
     C**********           OUT  LDA                                                         AR322732
     C**********           EXSR *PSSR                                                       AR322732
     C**********           ENDIF                                                            AR322732
      *
      **  Save relative record no. of next available record.
     C**********           Z-ADDRRNAX     LXRRN                                             AR322732
      *
      **  Update LTRIX header details.
     C**********           ADD  1         NOREX                                             AR322732
     C**********           ADD  1         RRNAX                                             AR322732
     C**********           ADD  1         NLNRX                                             AR322732
     C**********           EXCPTTRXHDR                                                      AR322732
      *
      **  Access next available LTRIX record.
     C********** LXRRN     CHAINLTRIX                85                                     AR322732
     C********** *IN85     IFEQ *ON                                                         AR322732
     C********** *LOCK     IN   LDA                                                         AR322732
     C**********           MOVEL'LTRIX   'DBFILE           ************                     AR322732
     C**********           Z-ADD12        DBASE            * DBERR 12 *                     AR322732
     C**********           MOVE LXRRN     DBKEY            ************                     AR322732
     C**********           OUT  LDA                                                         AR322732
     C**********           EXSR *PSSR                                                       AR322732
     C**********           ENDIF                                                            AR322732
      *
      ** Update LTRIX detail record
     C                     Z-ADD0         LXRRN   50                                        AR322732
     C                     EXCPTTRXDTL
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************   159256
      * SRWARN   - Send a warning message if a syndicated loan is     *   159256
      *            being amended, reversed or authorised directly on  *   159256
      *            Midas as Loan Manager should be used to take       *   159256
      *            advantage of the autogeneration process.           *   159256
      * Called by: SRSTRT, SRPDET                                     *   159256
      * Calls    : None                                               *   159256
      *****************************************************************   159256
     C           SRWARN    BEGSR                                          159256
      *                                                                   159256
     C           PMODE     IFEQ 'I'                                       159256
     C           PMODE     OREQ 'F'                                       CAP062
      *                                                                   159256
      ** Only issue the warning once for the same transaction.            159256
      *                                                                   159256
     C           WE232     IFEQ *BLANK                                    159256
     C           WE232     OREQ 'Y'                                       159256
     C           SLOAN     ANDNEW1LNRF                                    159256
     C                     MOVELSLOAN     W1LNRF  6                       159256
      *                                                                   159256
      ** Warn if participation linked to a syndicate                      159256
      *                                                                   159256
     C           PTYP      IFEQ 64                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYP      OREQ 65                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYP      OREQ 66                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYP      OREQ 67                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYP      OREQ 68                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYP      OREQ 69                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYP      OREQ 71                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYP      OREQ 72                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C                     MOVE 'Y'       WE232   1                       159256
     C                     MOVE 'LEM0232' ZAMSID                          159256
     C                     EXSR ZASNMS                                    159256
      *                                                                   159256
     C                     ELSE                                           159256
      *                                                                   159256
     C                     MOVE *BLANKS   WE232                           159256
      *                                                                   159256
      ** Warn if loan or direct participation purchased but facility      159256
      ** is syndicated.                                                   159256
      *                                                                   159256
     C           PTYP      IFEQ 61                                        159256
     C           PTYP      OREQ 62                                        159256
     C           PTYP      OREQ 63                                        159256
     C           PTYP      OREQ 64                                        159256
     C           LNKS      ANDNE'Y'                                       159256
     C           PTYP      OREQ 65                                        159256
     C           LNKS      ANDNE'Y'                                       159256
     C           PTYP      OREQ 68                                        159256
     C           LNKS      ANDNE'Y'                                       159256
     C           PTYP      OREQ 70                                        159256
     C           PTYP      OREQ 71                                        159256
     C           LNKS      ANDNE'Y'                                       159256
      *                                                                   159256
     C                     MOVE FCUS      WFCUS                           159256
     C                     MOVE FTYP      WFTYP                           159256
     C                     MOVE FSEQ      WFSEQ                           159256
     C                     MOVE 'A'       WRCTP                           159256
      *                                                                   159256
     C           K#FCLT    CHAINFCLTY2F              85                   159256
     C           SYIN      IFEQ 'Y'                                       159256
     C                     MOVE 'Y'       WE232                           159256
     C                     MOVE 'LEM0232' ZAMSID                          159256
     C                     EXSR ZASNMS                                    159256
     C                     ENDIF                                          159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDIF                                          159256
     C                     ELSE                                           159256
      *                                                                   159256
     C                     MOVE *BLANKS   WE232                           159256
      *                                                                   159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDSR                                          159256
      *                                                                   159256
      *****************************************************************   189632
      * SRWIND  -  Window Processing                                  *   189632
      * Called by: Main Routine                                       *   189632
      * Calls    : None                                               *   189632
      *****************************************************************   189632
     C           SRWIND    BEGSR                                          189632
      *                                                                   189632
     C           BGWDPR    IFEQ 'Y'                                       189632
     C                     MOVEL'LE2070'  W#PGM     P                     189632
     C/COPY WNCPYSRC,LE2070C025
      *                                                                   189632
     C                     UNLCKLDA                                       189632
     C                     CALL 'WN0010'                                  189632
     C                     PARM           W#PGM  10                       189632
     C                     PARM *BLANK    W#KEY   2                       189632
     C                     PARM SACTN     W#ACTN  1                       189632
     C                     PARM           DATA                            189632
     C                     PARM *BLANK    W#RTRN  7                       189632
     C                     PARM           W#SPAR256                       189632
     C           *LOCK     IN   LDA                                       189632
      *                                                                   189632
      *  Cmd12 pressed                                                    189632
     C           W#RTRN    IFNE *BLANK                                    189632
     C           W#RTRN    ANDNE'Y2U9999'                                 189632
     C                     MOVE 'D1'      WFMT                            189632
      *                                                                   189632
     C                     CALL 'SNDERMSG'                                189632
     C                     PARM 'LE2070'  ZAPGM  10        Program queue  189632
     C                     PARM           ZAPGRL  5        Rel queue      189632
     C                     PARM W#RTRN    ZAMSID  7        Msg Id.        189632
     C                     PARM 'WNMSGF'  ZAMSGF 10        Msg file.      189632
     C                     PARM           ZAMSDA132        Message data.  189632
     C                     PARM           ZAMSTP  7        Message type.  189632
      * Clear all fields                                                  189632
     C                     MOVEL*BLANK    ZAPGM            Program queue  189632
     C                     MOVEL*BLANK    ZAPGRL           Rel queue      189632
     C                     MOVEL*BLANK    ZAMSID           Message Id.    189632
     C                     MOVEL*BLANK    ZAMSGF           Message file.  189632
     C                     MOVEL'LERMSGF 'ZAMSGF                          189632
     C                     MOVEL*BLANK    ZAMSDA           Message data.  189632
     C                     MOVEL*BLANK    ZAMSTP           Message type.  189632
     C                     ENDIF                                          189632
      *                                                                   189632
      *  Cmd3 pressed                                                     189632
     C           W#RTRN    IFEQ 'Y2U9999'                                 189632
     C                     SETON                     LR                   189632
     C                     RETRN                                          189632
     C                     ENDIF                                          189632
      *                                                                   189632
     C                     ENDIF                                          189632
      *                                                                   189632
     C                     ENDSR                                          189632
      *                                                                   189632
      *****************************************************************
      * SRTERM  -  Termination Processing                             *
      * Called by: Main Routine                                       *
      * Calls    : None                                               *
      *****************************************************************
     C           SRTERM    BEGSR
      *
      **  Close extended settlement program.
      *
     C           PMODE     IFNE 'B'                                       119594
     C           PMODE     ANDNE'P'                                       119594
     C                     MOVE 'T'       PMTERM
     C                     CALL 'SD2400'
     C                     PARM           PRCODE
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           PSLNRF
     C                     PARM           @PARM3                                              222373
     C                     ROLBK                                                              227710
     C/COPY WNCPYSRC,LE2070C026
     C                     ENDIF                                          119594
      *
      **  Terminate program.
      *
     C                     MOVE *ON       *INLR
     C/COPY WNCPYSRC,LE2070C011
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRCLMQ  -  Clears the message queue                           *
      * Called by: SRSTRT - First screen (prompt for key input)       *
      *            SRSFIL - Subfile processing                        *
      *            SRLOAD - Load subfile records                      *
      *            SRSREV - Process criteria options                  *
      *            SRPDET - Process detail screen                     *
      * Calls    : None                                               *
      *****************************************************************
     C           SRCLMQ    BEGSR
      *
      **  Clear message subfile.
      *
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *  ZASNMS - Sends messages to the program's message queue       *
      *  Called by: Main program                                      *
      *  Calls    : None                                              *
      *****************************************************************
     C           ZASNMS    BEGSR
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           PMODE     OREQ 'F'                                       CAP062
      *
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     ENDIF
      *
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message Id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C                     PARM           ZAMSTP  7        Message type.
     C                     ELSE
      *
      ** For Batch and Play mode, return message
      *
     C                     CALL 'Y2RVMGC'
     C                     PARM           PRTCD
     C                     PARM           ZAMSID           Message Id.
     C                     PARM           ZAMSGF           Message file.
     C                     PARM           ZAMSDA           Message data.
     C                     PARM           ZAMSTX132        Messge text
      *
     C           PMODE     IFNE 'B'                                       120617
     C                     ROLBK
     C                     ENDIF                                          120617
      *
     C           PMODE     IFEQ 'B'
      *                                                                   CAP062
      ** If Repair Location is Back Office...                             CAP062
     C           PIRPLC    IFEQ 'B'                                       CAP062
     C           CAP062    ANDEQ'Y'                                       CAP062
     C                     CALL 'LEC0215'                                 CAP062
     C                     PARM           XREPN                           CAP062
     C                     MOVELZAMSID    XMSID                           CAP062
     C                     MOVELPILNRF    LNRFL                           CAP062
     C                     Z-ADD61        PTYPL                           CAP062
     C                     MOVELPITUSR    IUSRL                           CAP062
     C                     MOVEL*BLANK    LSTSL                           CAP062
     C                     Z-ADD*ZERO     NOPSL                           CAP062
     C                     MOVE 'Y'       ULINVF  1                       CAP062
      *                                                                   CAP062
      * Set up Customer Number, Rollover frequency and day                CAP062
      * and rollover date and next rollover date.                         CAP062
     C                     MOVE PICNUM    SCNUM                           CAP062
     C                     MOVE PIRLFQ    SSRFQ                           CAP062
     C                     MOVE PIRLDY    SRLDY                           CAP062
      *                                                                   CAP062
     C                     MOVE PIRLDT    DATE8                           CAP062
     C                     MOVE D8DD      D6DD                            CAP062
     C                     MOVE D8MM      D6MM                            CAP062
     C                     MOVE D8YY      D6YY                            CAP062
     C                     MOVE DATE6     SRLDT                           CAP062
      *                                                                   CAP062
     C                     MOVE PINROD    DATE8                           CAP062
     C                     MOVE D8DD      D6DD                            CAP062
     C                     MOVE D8MM      D6MM                            CAP062
     C                     MOVE D8YY      D6YY                            CAP062
     C                     MOVE DATE6     SNROD                           CAP062
      *                                                                   CAP062
     C           PCRFL     IFEQ *BLANKS                                   CSC011
     C                     MOVELPITREF    STNRF                           CSC011
     C                     ELSE                                           CSC011
     C                     MOVELPCRFL     STNRF                           CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C           PITDST    IFEQ *BLANKS                                   CSC011
     C           PITTST    OREQ *BLANKS                                   CSC011
     C                     CALL 'ZAGENTS'                                 CSC011
     C                     PARM ZATMST    ZATMST 26                       CSC011
     C                     MOVE ZATMST    TSTISO                          CSC011
     C                     ELSE                                           CSC011
     C                     MOVE PITDST    W1DTE8                          CSC011
     C                     MOVE W1DTE2    TSTDD                           CSC011
     C                     MOVE W3DTE4    TSTMM                           CSC011
     C                     MOVELW5DTE6    TSTYY                           CSC011
     C                     MOVE W7DTE8    TSTYY                           CSC011
     C                     MOVE PITTST    WTSTM                           CSC011
     C                     MOVE WTSHR     TSTTM1                          CSC011
     C                     MOVE WTSMN     TSTTM2                          CSC011
     C                     MOVE WTSSC     TSTTM3                          CSC011
     C                     MOVE '000000'  TSTTM4                          CSC011
     C                     ENDIF                                          CSC011
     C                     MOVE TSTISO    STMST                           CSC011
      *                                                                   CSC011
     C                     WRITELEIROLP0                                  CAP062
      *                                                                   CSC011
      * If Support System active, write transaction to 24x7 log           CSC011
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
      *                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
      *                                                                   CSC011
      * Convert Rollover to PINPP format                                  CSC011
     C                     EXSR LOG247                                    CSC011
      *                                                                   CSC011
      * Write invalid Rollover in PINPP format to 24x7 Log File           CSC011
     C                     MOVE 'I'       LOGVAL  1                       CSC011
     C                     EXSR APLGTR                                    CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     COMIT                                          CAP062
      *                                                                   CAP062
      ** Otherwise...                                                     CAP062
     C                     ELSE                                           CAP062
     C                     EXSR SRPOMP
     C           WARDET    IFEQ *ON
     C                     MOVE 'W'       PORMSV
     C                     ENDIF
     C           ERRDET    IFEQ *ON
     C                     MOVE 'E'       PORMSV
     C                     ENDIF
     C                     MOVELZAMSID    PORMID
     C                     MOVELZAMSTX    PORMTX
     C                     ENDIF                                          CAP062
      *                                                                   CAP062
     C                     ENDIF
      *
     C           PMODE     IFEQ 'P'
     C                     MOVELZAMSID    RMID
     C                     MOVELZAMSTX    RMTX
     C           WARDET    IFEQ *ON
     C                     MOVE 'W'       RMSV
     C                     ENDIF
     C           ERRDET    IFEQ *ON
     C                     MOVE 'E'       RMSV
     C                     UPDATLE2070D0
     C                     ENDIF
     C                     ENDIF
      *                                                                   120468
      *  Include DUMP here for problems during batch and play modes.      120468
      *  Only DUMP if record has not been written to Invlaid File.        CAP062
      *                                                                   120468
     C           ERRDET    IFEQ *ON                                       120468
     C           ULINVF    ANDNE'Y'                                       CAP062
     C                     DUMP                                           120468
     C                     ENDIF                                          120468
      *
      ** If not a warning error, stop validation and return
      *
     C           PORMSV    IFEQ 'E'
     C           RMSV      OREQ 'E'
     C                     MOVE '1'       *INLR
     C                     RETRN
     C                     ENDIF
      *
     C           PMODE     IFEQ 'B'                                       CAP062
     C           PIRPLC    ANDEQ'B'                                       CAP062
     C           CAP062    ANDEQ'Y'                                       CAP062
     C                     MOVE '1'       *INLR                           CAP062
     C                     RETRN                                          CAP062
     C                     ENDIF                                          CAP062
     C                     ENDIF
      *
     C           ZAEXIT    ENDSR
      /EJECT
      *****************************************************************   CSC011
      *  APLGTR  -  Write Rollover transaction to the 24X7 Midas      *   CSC011
      *             availability Log File                             *   CSC011
      *  Called by: SRUROL, ZASNMS                                    *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           APLGTR    BEGSR                                          CSC011
      *                                                                   CSC011
     C                     MOVEL'LEROLL'  APMTYP                          CSC011
      *                                                                   CSC011
      ** If timestamp field is blank, then call ZAGENTS to set it up      CSC011
      *                                                                   CSC011
     C           APSTMS    IFEQ *BLANKS                                   CSC011
     C                     CALL 'ZAGENTS'                                 CSC011
     C                     PARM ZATMST    ZATMST 26                       CSC011
     C                     MOVE ZATMST    APSTMS                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C           PCRFL     IFEQ *BLANKS                                   CSC011
     C                     MOVE PITREF    APSOFC                          CSC011
     C                     ELSE                                           CSC011
     C                     MOVELPCRFL     APSOFC                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     MOVELPINPP     APTRAN                          CSC011
      *                                                                   CSC011
     C           LOGVAL    IFEQ 'V'                                       CSC011
     C                     OPEN APVLOGPD                                  CSC011
     C                     WRITEAPVLOGD0                                  CSC011
     C                     CLOSEAPVLOGPD                                  CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C           LOGVAL    IFEQ 'I'                                       CSC011
     C                     OPEN APILOGPD                                  CSC011
     C                     WRITEAPILOGD0                                  CSC011
     C                     CLOSEAPILOGPD                                  CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     ENDSR                                          CSC011
      *                                                                   CSC011
      /EJECT                                                              CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
      *  LOG247  -  Convert fields to the format required to be       *   CSC011
      *             written to the 24x7 Midas Availability Log        *   CSC011
      *  Called by: SRUPDT                                            *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           LOG247    BEGSR                                          CSC011
      *                                                                   CSC011
     C           PMODE     IFNE 'B'                                       CSC011
     C                     CLEARPINPP                                     CSC011
     C                     MOVE WTYPE     PITYPE                          CSC011
      *                                                                   CSC011
      ** If message type is blank then set it up.                         CSC011
      *                                                                   CSC011
     C           PITYPE    IFEQ *BLANKS                                   CSC011
     C                     MOVEL'ROLL'    PITYPE                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     MOVE WTUSR     PITUSR                          CSC011
     C                     MOVE WTWID     PITWID                          CSC011
     C                     MOVE WTREF     PITREF                          CSC011
     C                     MOVE WTSEQ     PITSEQ                          CSC011
     C                     MOVE SACTN     PIACTN                          CSC011
     C*                                                                   CSC011
     C                     CALL 'ZAGENTS'                                 CSC011
     C                     PARM ZATMST    ZATMST 26                       CSC011
     C                     MOVE ZATMST    TSTISO                          CSC011
     C*                                                                   CSC011
     C           PITDST    IFEQ *BLANKS                                   CSC011
     C                     MOVE TSTYY     W7DTE8                          CSC011
     C                     MOVELTSTYY     W5DTE6                          CSC011
     C                     MOVE TSTMM     W3DTE4                          CSC011
     C                     MOVE TSTDD     W1DTE2                          CSC011
     C                     MOVE W1DTE8    PITDST                          CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     MOVELTSTTM1    WSTM1   40                      CSC011
     C                     MOVE TSTTM2    WSTM1                           CSC011
     C                     MOVELTSTTM3    WSTM2   40                      CSC011
     C                     MOVELTSTTM4    WSTM3   20                      CSC011
     C                     MOVELWSTM1     PITTST                          CSC011
     C                     MOVE WSTM3     WSTM2                           CSC011
     C                     MOVE WSTM2     PITTST                          CSC011
     C*                                                                   CSC011
     C                     MOVE WPARR     PIPARR                          CSC011
     C                     MOVE SLOAN     PILNRF                          CSC011
     C                     MOVE SCUST     PICNUM                          CSC011
     C                     MOVE SRLDT     PIRLDT                          CSC011
     C                     MOVE SNROD     PINROD                          CSC011
     C                     MOVE SNCAS     PINCAS                          CSC011
     C                     MOVE SNBRA     PINBRA                          CSC011
     C                     MOVE SNBRT     PIBASR                                              CLE036
     C                     MOVE SNRTS     PINRTS                          CSC011
     C                     MOVE SNSIN     PINSIN                          CSC011
     C                     MOVE SNCHI     PINCHI                          CSC011
     C                     MOVE SNPRAM    PINPRA                          CSC011
     C                     MOVE SNIPDB    PINIPD                          CSC011
     C                     MOVE SNMDTB    PINMDT                          CSC011
     C                     MOVE SNFRSB    PINFRS                          CSC011
     C                     MOVE SNFSNB    PINFSN                          CSC011
     C                     MOVE SNFPCB    PINFPC                          CSC011
     C                     MOVE XRPST     PIRPST                          CSC011
     C                     MOVE XRPON     PIRPON                          CSC011
     C                     MOVE XRRVN     PIRRVN                          CSC011
     C                     MOVE XRCVM     PIRCVM                          CSC011
     C                     MOVE XRPOC     PIRPOC                          CSC011
     C                     MOVE XRPOB     PIRPOB                          CSC011
     C                     MOVE XRRCR     PIRRCR                          CSC011
     C                     MOVE XRPIB     PIRPIB                          CSC011
     C                     MOVE XRPBA     PIRPBA                          CSC011
     C                     MOVE XRAWB     PIRAWB                          CSC011
     C                     MOVE XRAWA     PIRAWA                          CSC011
     C                     MOVE XRBEN     PIRBEN                          CSC011
     C                     MOVE XRBNA     PIRBNA                          CSC011
     C                     MOVE XRRST     PIRRST                          CSC011
     C                     MOVE XRPON     PIRRON                          CSC011
     C                     MOVE XRROC     PIRROC                          CSC011
     C                     MOVE XRROB     PIRROB                          CSC011
     C                     MOVE XRRIB     PIRRIB                          CSC011
     C                     MOVE XRRBA     PIRRBA                          CSC011
     C                     MOVE XRDP1     PIRDP1                          CSC011
     C                     MOVE XRDP2     PIRDP2                          CSC011
     C                     MOVE XRDP3     PIRDP3                          CSC011
     C                     MOVE XRDP4     PIRDP4                          CSC011
     C                     MOVE XRDCH     PIRDCH                          CSC011
     C                     MOVE XRBB1     PIRBB1                          CSC011
     C                     MOVE XRBB2     PIRBB2                          CSC011
     C                     MOVE XRBB3     PIRBB3                          CSC011
     C                     MOVE XRBB4     PIRBB4                          CSC011
     C                     MOVE XRBB5     PIRBB5                          CSC011
     C                     MOVE XRBB6     PIRBB6                          CSC011
     C                     MOVE SNCCY     PINCCY                          CSC011
     C                     MOVE SNCPA     PINCPA                          CSC011
     C                     MOVE SNFMD     PINFMD                          CSC011
     C                     MOVE SNFCE     PINFCE                          CSC011
     C                     MOVE SNLRA     PINLRA                          CSC011
     C                     MOVE RIUS      PIRIUS                          CSC011
     C                     MOVE RAUS      PIRAUS                          CSC011
     C                     MOVE RXUS      PIRXUS                          CSC011
     C                     MOVE PCOBL     PIPCOB                          CSC011
     C                     MOVE SNBMD     PINBMD                          CSC011
     C                     MOVE SNBCE     PINBCE                          CSC011
     C                     MOVE XRSCY     PIRRSC                          CSC011
     C                     MOVE XPSCY     PIRPSC                          CSC011
     C                     MOVE XIC72     PIRICY                          CSC011
      *                                                                                       CLE034
      ** Settlement Allocation flag                                                           CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE SRSTA     PISTAL                                              CLE034
     C                     ENDIF                                                              CLE034
     C*                                                                   CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     ENDSR                                          CSC011
      *                                                                   CSC011
      /EJECT                                                              CSC011
      *****************************************************************   CSC011
      *  LOGDEL  -  Delete record from 24x7 Midas availability log    *   CSC011
      *             file                                              *   CSC011
      *  Called by: SRUSHW                                            *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           LOGDEL    BEGSR                                          CSC011
      *                                                                   CSC011
     C                     MOVEL'LE'      W#MSGT  6                       CSC011
     C                     MOVE 'ROLL'    W#MSGT                          CSC011
     C                     MOVELW#MSGT    KMTYPE                          CSC011
     C                     MOVE '  '      KMTYPE                          CSC011
     C                     MOVELSTNRF     KFOID                           CSC011
     C                     MOVE STMST     KTSTMP                          CSC011
      *                                                                   CSC011
     C                     OPEN APILOGL0                                  CSC011
     C           KAPLOG    CHAINAPILOGX0             99                   CSC011
     C           *IN99     IFEQ *OFF                                      CSC011
     C                     DELETAPILOGX0                                  CSC011
     C                     ENDIF                                          CSC011
     C                     CLOSEAPILOGL0                                  CSC011
      *                                                                   CSC011
     C                     ENDSR                                          CSC011
      *                                                                   CSC011
      /EJECT                                                              CSC011
      *****************************************************************                       CLE031
      * SRVNPA  -  Validation of New Principal Amount                 *                       CLE031
      *****************************************************************                       CLE031
     C           SRVNPA    BEGSR                                                              CLE031
      *                                                                                       CLE031
     C           WNPRA1    IFNE '*'                                                           CLE031
     C                     MOVE *BLANKS   ERRMID                                              CLE031
     C                     MOVELCCY       PCURR                                               CLE031
     C                     Z-ADD54        DBASE                                               CLE031
     C                     MOVE *ON       EDBAS                                               CLE031
     C                     EXSR SRCURR                                                        CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C           SACTN     IFEQ 'A'                                                           CLE031
     C                     MOVE SNPRAB    ZFIELD                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE SNPRAM    ZFIELD                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE A6NBDP    WNBDP   10                                          CLE031
     C           13        SUB  WNBDP     ZADIG                                               CLE031
     C                     Z-ADDA6NBDP    ZADEC                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
     C                     MOVE ZFIELD    WNPRAM 130                                          CLE031
      *                                                                                       CLE031
      ** Forbidden for Non-discount loans when CLE031 is off.                                 CLE031
      ** If CLE031 is on, loan ccy must be different from                                     CLE031
      ** facility currency.                                                                   CLE031
      *                                                                                       CLE031
     C                     SELEC                                                              CLE031
     C           PTYP      WHNE 63                                                            CLE031
     C           PTYP      ANDNE65                                                            CLE031
     C           PTYP      ANDNE67                                                            CLE031
     C           SNPRAB    ANDNE*BLANKS                                                       CLE031
     C           CLE031    ANDNE'Y'                                                           CLE031
     C           PTYP      ORNE 63                                                            CLE031
     C           PTYP      ANDNE65                                                            CLE031
     C           PTYP      ANDNE67                                                            CLE031
     C           SNPRAM    ANDNE*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'X'                                                           CLE031
     C           CLE031    ANDNE'Y'                                                           CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           PTYP      ANDNE63                                                            CLE031
     C           PTYP      ANDNE65                                                            CLE031
     C           PTYP      ANDNE67                                                            CLE031
     C           CCY       ANDEQFCCY                                                          CLE031
     C           SNPRAB    ANDNE*BLANKS                                                       CLE031
     C           CLE031    IFNE 'Y'                                                           CLE031
     C                     MOVEL'LEV0466' ERRMID                                              CLE031
     C                     ELSE                                                               CLE031
     C**********           MOVEL'LEV1068' ERRMID                                       CLE031 CAS011
     C                     MOVEL'LEV1073' ERRMID                                              CAS011
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** For discount loans, default to New or Current principal                              CLE031
      ** if entry is blank.                                                                   CLE031
      *                                                                                       CLE031
     C           PTYP      WHEQ 63                                                            CLE031
     C           SNPRAB    ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'A'                                                           CLE031
     C           CLE031    ANDNE'Y'                                                           CLE031
     C           PTYP      OREQ 65                                                            CLE031
     C           SNPRAB    ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'A'                                                           CLE031
     C           CLE031    ANDNE'Y'                                                           CLE031
     C           PTYP      OREQ 67                                                            CLE031
     C           SNPRAB    ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'A'                                                           CLE031
     C           CLE031    ANDNE'Y'                                                           CLE031
      *                                                                                       CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           PTYP      ANDEQ63                                                            CLE031
     C           SNPRAB    ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'A'                                                           CLE031
     C           SNFCEB    ANDEQ*BLANKS                                                       CLE031
     C           SNFCE     ANDEQ*BLANKS                                                       CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           PTYP      ANDEQ65                                                            CLE031
     C           SNPRAB    ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'A'                                                           CLE031
     C           SNFCEB    ANDEQ*BLANKS                                                       CLE031
     C           SNFCE     ANDEQ*BLANKS                                                       CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           PTYP      ANDEQ67                                                            CLE031
     C           SNPRAB    ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'A'                                                           CLE031
     C           SNFCEB    ANDEQ*BLANKS                                                       CLE031
     C           SNFCE     ANDEQ*BLANKS                                                       CLE031
      *                                                                                       CLE031
     C           NPRAM     IFNE *ZEROS                                                        CLE031
     C                     Z-ADDNPRAM     WNPRAM                                              CLE031
     C                     ELSE                                                               CLE031
     C                     Z-ADDCPAM      WNPRAM                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Must be a valid numeric amount                                                       CLE031
      *                                                                                       CLE031
     C           PTYP      WHEQ 63                                                            CLE031
     C           *IN99     ANDEQ*ON                                                           CLE031
     C           PTYP      OREQ 65                                                            CLE031
     C           *IN99     ANDEQ*ON                                                           CLE031
     C           PTYP      OREQ 67                                                            CLE031
     C           *IN99     ANDEQ*ON                                                           CLE031
     C                     MOVEL'LEV0460' ERRMID                                              CLE031
      *                                                                                       CLE031
      ** Must be less than or equal to Current                                                CLE031
      ** principal amount.                                                                    CLE031
      *                                                                                       CLE031
     C           PTYP      WHEQ 63                                                            CLE031
     C           *IN99     ANDEQ*OFF                                                          CLE031
     C           WNPRAM    ANDGTCPAM                                                          CLE031
     C           CLE031    ANDNE'Y'                                                           CLE031
     C           PTYP      OREQ 65                                                            CLE031
     C           *IN99     ANDEQ*OFF                                                          CLE031
     C           WNPRAM    ANDGTCPAM                                                          CLE031
     C           CLE031    ANDNE'Y'                                                           CLE031
     C           PTYP      OREQ 67                                                            CLE031
     C           *IN99     ANDEQ*OFF                                                          CLE031
     C           WNPRAM    ANDGTCPAM                                                          CLE031
     C           CLE031    ANDNE'Y'                                                           CLE031
     C                     MOVEL'LEV0461' ERRMID                                              CLE031
     C                     ENDSL                                                              CLE031
      *                                                                                       CLE031
      ** If CLE031 is on and new facility exchange rate has                                   CLE031
      ** been entered:                                                                        CLE031
      *                                                                                       CLE031
     C                     Z-ADD*ZEROS    WVPRAM 130                                          CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           ERRMID    ANDEQ*BLANKS                                                       CLE031
     C           CCY       ANDNEFCCY                                                          CLE031
     C           *IN53     ANDEQ*OFF                                                          CLE031
      *                                                                                       CLE031
     C           SNFCEB    IFNE *BLANKS                                                       CLE031
     C           WNFCE1    ANDNE'*'                                                           CLE031
     C           SNFCE     ORNE *BLANKS                                                       CLE031
     C           WNFCE1    ANDNE'*'                                                           CLE031
      *                                                                                       CLE031
     C           SACTN     IFEQ 'A'                                                           217956
     C                     MOVE SNFCEB    ZFIELD                                              217956
     C                     ELSE                                                               217956
     C                     MOVE SNFCE     ZFIELD                                              217956
     C                     ENDIF                                                              217956
      *                                                                                       217956
     C                     Z-ADD8         ZADEC                                               217956
     C                     Z-ADD5         ZADIG                                               217956
     C                     EXSR ZALIGN                                                        217956
     C                     MOVE ZFIELD    VNFCE                                               217956
      *                                                                                       217956
     C                     MOVELFCCY      PCURR                                               217956
     C                     Z-ADD90        DBASE                                               217956
     C                     MOVE *ON       EDBAS                                               217956
     C                     EXSR SRCURR                                                        217956
     C                     Z-ADDA6NBDP    WNFDP   10                                          217956
     C           WNFDP     SUB  WNBDP     DP      10                                          217956
     C                     ADD  4         DP                                                  217956
     C           SNFCEB    IFNE *BLANKS                                                       217956
     C                     MOVE SNFMDB    WNFMDI  1                                           217956
     C                     ELSE                                                               217956
     C           SNFCE     IFNE *BLANKS                                                       217956
     C                     MOVE SNFMD     WNFMDI                                              217956
     C                     ENDIF                                                              217956
     C                     ENDIF                                                              217956
      *                                                                                       217956
     C           WNFMDI    IFEQ 'D'                                                           217956
     C           VNFCE     DIV  POWER,DP  WEXR15 159H                                         217956
     C********** 1         DIV  WFCXRT    WEXR15                                       217956 218843
     C           1         DIV  WEXR15    WEXR15                                              218843
     C                     ELSE                                                               217956
     C           VNFCE     MULT POWER,DP  WEXR15    H                                         217956
     C                     ENDIF                                                              217956
      *                                                                                       217956
     **********            SELEC                                                       CLE031 217956
     **********                                                                        CLE031 217956
     **********  SNFCEB    WHNE *BLANKS                                                CLE031 217956
     C**********           Z-ADD0         WSEXR0                                       CLE031 217956
     C**********           Z-ADD0         WSEXR8                                       CLE031 217956
     C**********           MOVE *BLANK    ZFIELD                                       CLE031 217956
     C**********           MOVE SNFCEB    ZFIELD                                       CLE031 217956
     C**********           Z-ADD8         ZADEC                                        CLE031 217956
     C**********           Z-ADD5         ZADIG                                        CLE031 217956
     C**********           EXSR ZALIGN                                                 CLE031 217956
     **********                                                                        CLE031 217956
     C********** *IN99     IFEQ *OFF                                                   CLE031 217956
     C**********           MOVE ZFIELD    WNFCER 138                                   CLE031 217956
     C**********           MOVE ZFIELD    WSEXR0                                       CLE031 217956
     C********** WSEXR0    DIV  100000000 WSEXR8                                       CLE031 217956
     C**********           Z-ADDWSEXR8    WNFCER 138                                   CLE031 217956
     C**********           MOVE SNFMDB    WNFMDI  1                                    CLE031 217956
     C**********           ELSE                                                        CLE031 217956
     C********** *LOCK     IN   LDA                                                    CLE031 217956
     C**********           MOVEL'ZALIGN  'DBFILE                                       CLE031 217956
     C**********           Z-ADD76        DBASE                                        CLE031 217956
     C**********           MOVELSNFCEB    DBKEY                                        CLE031 217956
     C**********           OUT  LDA                                                    CLE031 217956
     C**********           EXSR *PSSR                                                  CLE031 217956
     C**********           ENDIF                                                       CLE031 217956
      **********                                                                       CLE031 217956
     C********** SNFCE     WHNE *BLANKS                                                CLE031 217956
     C**********           Z-ADD0         WSEXR0                                       CLE031 217956
     C**********           Z-ADD0         WSEXR8                                       CLE031 217956
     C**********           MOVE *BLANK    ZFIELD                                       CLE031 217956
     C**********           MOVE SNFCE     ZFIELD                                       CLE031 217956
     C**********           Z-ADD8         ZADEC                                        CLE031 217956
     C**********           Z-ADD5         ZADIG                                        CLE031 217956
     C**********           EXSR ZALIGN                                                 CLE031 217956
      ***********                                                                      CLE031 217956
     C************IN99     IFEQ *OFF                                                   CLE031 217956
     C**********           MOVE ZFIELD    WSEXR0                                       CLE031 217956
     C********** WSEXR0    DIV  100000000 WSEXR8                                       CLE031 217956
     C**********           Z-ADDWSEXR8    WNFCER                                       CLE031 217956
     C**********           MOVE SNFMD     WNFMDI                                       CLE031 217956
     C**********           ELSE                                                        CLE031 217956
     C********** *LOCK     IN   LDA                                                    CLE031 217956
     C**********           MOVEL'ZALIGN  'DBFILE                                       CLE031 217956
     C**********           Z-ADD77        DBASE                                        CLE031 217956
     C**********           MOVELSNFCE     DBKEY                                        CLE031 217956
     C**********           OUT  LDA                                                    CLE031 217956
     C**********           EXSR *PSSR                                                  CLE031 217956
     C**********           ENDIF                                                       CLE031 217956
      **********                                                                       CLE031 217956
     C**********           ENDSL                                                       CLE031 217956
      *                                                                                       CLE031
      ** Calculate default value of New Principal Amount                                      CLE031
      *                                                                                       CLE031
     C           FPAM      IFNE 0                                                             CLE031
      ** Loans with Facility Ccy amt FPAM can be rolled over to full                          217956
      ** utilisation of the facility, or to loan ccy equiv. of FPAM                           217956
      *                                                                                       217956
     C                     EXSR SRFAMT                                                        217956
      *                                                                                       CLE031
     C           WNFMDI    IFEQ 'M'                                                           CLE031
     **********  FPAM      DIV  WNFCER    WCNPAM 130                                   CLE031 217956
     C           FPAM      DIV  WEXR15    WCNPAM 130H                                         217956
     C                     ELSE                                                               CLE031
     C********** FPAM      MULT WNFCER    WCNPAM                                       CLE031 217956
     C           FPAM      MULT WEXR15    WCNPAM    H                                         217956
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
     C                     Z-ADDCPAM      WCNPAM                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Revolving credit facility                                                            CLE031
      *                                                                                       CLE031
     C           RVCR      IFEQ 'Y'                                                           CLE031
      *                                                                                       CLE031
     C           WNPRAM    IFNE WCNPAM                                                        CLE031
     C           WNPRAM    ANDNEWLFAMT                                                        217956
     C           WNPRAM    IFNE 0                                                             CLE031
     C           NPRAM     ORNE 0                                                             CLE031
      *  Display Warning message only once:                                                   217956
     C           WCNPAM    IFNE PRNPAM                                                        217956
     C********** WLFAMT    ANDNEPRFAMT                                                 217956 218930
     C           WLFAMT    ORNE PRFAMT                                                        218930
     C                     Z-ADDWCNPAM    PRNPAM 130                                          217956
     C                     Z-ADDWLFAMT    PRFAMT 130                                          217956
     C**********           Z-ADDWCNPAM    WVPRAM                                       CLE031 217956
     C**********           MOVEL'LEV1066' ERRMID                                       CLE031 217956
     C**********           MOVELWCNPAM    ZAMSDA    P                                  CLE031 217956
     C                     MOVELCCY       PCURR                                               CLE031
     C                     Z-ADD78        DBASE                                               CLE031
     C                     MOVE *ON       EDBAS                                               CLE031
     C                     EXSR SRCURR                                                        CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE WCNPAM    ZFIELD                                              CLE031
     C                     Z-ADDA6NBDP    ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C**********           MOVELZFIELD    ZAMSDA    P                                  CLE031 217956
     C                     MOVELZFIELD    W#DAT1    P                                         217956
     C                     MOVE WLFAMT    ZFIELD                                              217956
     C                     EXSR ZEDIT                                                         217956
     C                     MOVELZFIELD    W#DAT2    P                                         217956
     C                     MOVELW#DATA    ZAMSDA    P                                         217956
     C                     MOVE *ON       WARDET                                              217956
     C                     MOVE *ON       *IN47                                               217956
     C**********           MOVEL'LEV1070' ZAMSID                                       217956 CAS011
     C                     MOVEL'LEV1075' ZAMSID                                              CAS011
     C                     EXSR ZASNMS                                                        217956
     C********             MOVE *ON       ERRDET                                       217956 220754
     C                     ENDIF                                                              217956
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Non-revolving credit facility                                                        CLE031
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
     C           SNPRAB    IFEQ *BLANKS                                                       CLE031
     C                     Z-ADDWCNPAM    WNPRAM                                              CLE031
     C                     ELSE                                                               CLE031
     C           WNPRAM    IFNE WCNPAM                                                        CLE031
     C                     Z-ADDWCNPAM    WVPRAM                                              CLE031
     C**********           MOVEL'LEV1069' ERRMID                                       CLE031 221076
     C**********           MOVELFCCY      PCURR                                        CLE031 217956
     C                     MOVELCCY       PCURR                                               217956
     C                     Z-ADD79        DBASE                                               CLE031
     C                     MOVE *ON       EDBAS                                               CLE031
     C                     EXSR SRCURR                                                        CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE WCNPAM    ZFIELD                                              CLE031
     C                     Z-ADDA6NBDP    ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVELZFIELD    ZAMSDA    P                                         CLE031
     C                     MOVE *ON       WARDET                                              221076
     C                     MOVE *ON       *IN47                                               221076
     C**********           MOVEL'LEV1069' ZAMSID                                       221076 CAS011
     C                     MOVEL'LEV1074' ZAMSID                                              CAS011
     C                     EXSR ZASNMS                                                        221076
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           ERRMID    IFNE *BLANKS                                                       CLE031
     C                     MOVE *ON       *IN47                                               CLE031
     C                     MOVE *ON       ERRDET                                              CLE031
     C                     MOVELERRMID    ZAMSID                                              CLE031
     C                     EXSR ZASNMS                                                        CLE031
     C                     ELSE                                                               CLE031
     C           WNPRAM    IFNE *ZEROS                                                        CLE031
     C                     Z-ADDWNPRAM    VNPRAM                                              CLE031
     C                     Z-ADDWNPRAM    WVPRAM                                              CLE031
     C                     Z-ADDWNBDP     ZADEC                                               CLE031
     C                     MOVE WNPRAM    ZFIELD                                              CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C           SACTN     IFEQ 'A'                                                           CLE031
     C                     MOVE ZFIELD    SNPRAB                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      **  Validate remove request on rollover details.                                        CLE031
      *                                                                                       CLE031
     C           PTYP      IFEQ 63                                                            CLE031
     C           WNPRA1    ANDEQ'*'                                                           CLE031
     C           WNDAM1    ANDEQ'*'                                                           CLE031
     C           PTYP      OREQ 65                                                            CLE031
     C           WNPRA1    ANDEQ'*'                                                           CLE031
     C           WNDAM1    ANDEQ'*'                                                           CLE031
     C           PTYP      OREQ 67                                                            CLE031
     C           WNPRA1    ANDEQ'*'                                                           CLE031
     C           WNDAM1    ANDEQ'*'                                                           CLE031
     C                     Z-ADD*ZEROS    VNPRAM                                              CLE031
     C                     Z-ADD*ZEROS    VNDAM                                               CLE031
      *                                                                                       CLE031
      **  For Discount loans, if a '*' is in the first position                               CLE031
      **  of New principal amount, then New discount amount                                   CLE031
      **  must have '*'s in its first positions.                                              CLE031
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
     C           PTYP      IFEQ 63                                                            CLE031
     C           WNPRA1    ANDNE'*'                                                           CLE031
     C           WNDAM1    ANDNE'*'                                                           CLE031
     C           PTYP      OREQ 65                                                            CLE031
     C           WNPRA1    ANDNE'*'                                                           CLE031
     C           WNDAM1    ANDNE'*'                                                           CLE031
     C           PTYP      OREQ 67                                                            CLE031
     C           WNPRA1    ANDNE'*'                                                           CLE031
     C           WNDAM1    ANDNE'*'                                                           CLE031
     C                     ELSE                                                               CLE031
     C           PTYP      IFEQ 63                                                            CLE031
     C           PTYP      OREQ 65                                                            CLE031
     C           PTYP      OREQ 67                                                            CLE031
     C                     MOVEA'11'      *IN,47                                              CLE031
     C                     MOVE *ON       ERRDET                                              CLE031
     C                     MOVEL'LEV0468' ZAMSID                                              CLE031
     C                     EXSR ZASNMS                                                        CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *****************************************************************                       CLE031
      * SRVNDA  -  Validation of New Discount Amount                  *                       CLE031
      *****************************************************************                       CLE031
     C           SRVNDA    BEGSR                                                              CLE031
      *                                                                                       CLE031
     C           WNDAM1    IFNE '*'                                                           CLE031
     C                     MOVE *BLANKS   ERRMID                                              CLE031
     C                     MOVELCCY       PCURR                                               CLE031
     C                     Z-ADD55        DBASE                                               CLE031
     C                     MOVE *ON       EDBAS                                               CLE031
     C                     EXSR SRCURR                                                        CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C           SACTN     IFEQ 'A'                                                           CLE031
     C                     MOVE SNDAMB    ZFIELD                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE SNDAM     ZFIELD                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE A6NBDP    WNBDP                                               CLE031
     C           13        SUB  WNBDP     ZADIG                                               CLE031
     C                     Z-ADDA6NBDP    ZADEC                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
     C                     MOVE ZFIELD    WNDAM  130                                          CLE031
      *                                                                                       CLE031
      ** Forbidden for Non-discount loans.                                                    CLE031
      *                                                                                       CLE031
     C                     SELEC                                                              CLE031
     C           PTYP      WHNE 63                                                            CLE031
     C           PTYP      ANDNE65                                                            CLE031
     C           PTYP      ANDNE67                                                            CLE031
     C           SNDAMB    ANDNE*BLANKS                                                       CLE031
     C           PTYP      ORNE 63                                                            CLE031
     C           PTYP      ANDNE65                                                            CLE031
     C           PTYP      ANDNE67                                                            CLE031
     C           SNDAM     ANDNE*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'X'                                                           CLE031
     C                     MOVEL'LEV0466' ERRMID                                              CLE031
      *                                                                                       CLE031
      **  Mandatory for Discount loans.                                                       CLE031
      *                                                                                       CLE031
     C           PTYP      WHEQ 63                                                            CLE031
     C           SNDAMB    ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'A'                                                           CLE031
     C           CLE031    ANDNE'Y'                                                           CLE031
     C           PTYP      OREQ 65                                                            CLE031
     C           SNDAMB    ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'A'                                                           CLE031
     C           CLE031    ANDNE'Y'                                                           CLE031
     C           PTYP      OREQ 67                                                            CLE031
     C           SNDAMB    ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'A'                                                           CLE031
     C           CLE031    ANDNE'Y'                                                           CLE031
      *                                                                                       CLE031
     C           PTYP      OREQ 63                                                            CLE031
     C           SNDAM     ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'X'                                                           CLE031
     C           CLE031    ANDNE'Y'                                                           CLE031
     C           PTYP      OREQ 65                                                            CLE031
     C           SNDAM     ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'X'                                                           CLE031
     C           CLE031    ANDNE'Y'                                                           CLE031
     C           PTYP      OREQ 67                                                            CLE031
     C           SNDAM     ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'X'                                                           CLE031
     C           CLE031    ANDNE'Y'                                                           CLE031
      *                                                                                       CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           PTYP      ANDEQ63                                                            CLE031
     C           SNDAMB    ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'A'                                                           CLE031
     C           WVPRAM    ANDNE*ZEROS                                                        CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           PTYP      ANDEQ65                                                            CLE031
     C           SNDAMB    ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'A'                                                           CLE031
     C           WVPRAM    ANDNE*ZEROS                                                        CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           PTYP      ANDEQ67                                                            CLE031
     C           SNDAMB    ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'A'                                                           CLE031
     C           WVPRAM    ANDNE*ZEROS                                                        CLE031
      *                                                                                       CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           PTYP      ANDEQ63                                                            CLE031
     C           SNDAM     ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'X'                                                           CLE031
     C           SNPRAM    ANDNE*BLANKS                                                       CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           PTYP      ANDEQ65                                                            CLE031
     C           SNDAM     ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'X'                                                           CLE031
     C           SNPRAM    ANDNE*BLANKS                                                       CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           PTYP      ANDEQ67                                                            CLE031
     C           SNDAM     ANDEQ*BLANKS                                                       CLE031
     C           SACTN     ANDEQ'X'                                                           CLE031
     C           SNPRAM    ANDNE*BLANKS                                                       CLE031
     C                     MOVEL'LEV0462' ERRMID                                              CLE031
      *                                                                                       CLE031
      **  Must be a valid numeric amount.                                                     CLE031
      *                                                                                       CLE031
     C           PTYP      WHEQ 63                                                            CLE031
     C           *IN99     ANDEQ*ON                                                           CLE031
     C           PTYP      OREQ 65                                                            CLE031
     C           *IN99     ANDEQ*ON                                                           CLE031
     C           PTYP      OREQ 67                                                            CLE031
     C           *IN99     ANDEQ*ON                                                           CLE031
     C                     MOVEL'LEV0460' ERRMID                                              CLE031
      *                                                                                       CLE031
      **  Must agree with the calculated discount amount                                      CLE031
      **  within 1 unit of the loan currency.                                                 CLE031
      *                                                                                       CLE031
     C           PTYP      WHEQ 63                                                            CLE031
     C           ZFIELD    ANDNE*BLANKS                                                       CLE031
     C           PTYP      OREQ 65                                                            CLE031
     C           ZFIELD    ANDNE*BLANKS                                                       CLE031
     C           PTYP      OREQ 67                                                            CLE031
     C           ZFIELD    ANDNE*BLANKS                                                       CLE031
     C                     EXSR SRNDAM                                                        CLE031
     C                     ENDSL                                                              CLE031
      *                                                                                       CLE031
     C           ERRMID    IFNE *BLANKS                                                       CLE031
     C                     MOVE *ON       *IN48                                               CLE031
     C                     MOVE *ON       ERRDET                                              CLE031
     C                     MOVELERRMID    ZAMSID                                              CLE031
     C                     EXSR ZASNMS                                                        CLE031
     C                     ELSE                                                               CLE031
     C           WNDAM     IFNE *ZEROS                                                        CLE031
     C                     Z-ADDWNDAM     VNDAM                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C           SACTN     IFEQ 'A'                                                           CLE031
     C                     MOVE ZFIELD    SNDAMB                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *****************************************************************                       CLE031
      * SRFEES  -  Update Fees File                                   *                       CLE031
      *****************************************************************                       CLE031
     C           SRFEES    BEGSR                                                              CLE031
      *                                                                                       CLE031
     C           CLE002    IFEQ 'Y'                                                           CLE031
     C           SACTN     ANDEQ'A'                                                           CLE031
     C           RLDT      ANDNE*ZEROS                                                        CLE031
      *                                                                                       CLE031
     C           LNRF      CHAINLEFERLL0             69                                       CLE031
     C           *IN69     IFEQ *ON                                                           CLE031
     C**********           Z-ADDLNRF      FRLNRF                                       CLE031 CLE148
     C                     MOVELLNRF      FRLNRF                                              CLE148
     C                     MOVE *BLANKS   FRAUTH                                              CLE031
     C                     MOVE *BLANKS   FRSWRI                                              CLE031
     C                     WRITELEFERLD0                                                      CLE031
     C                     ELSE                                                               CLE031
     C           WKSWRI    IFEQ 'C'                                                           CLE031
     C           FRSWRI    ANDEQ*BLANK                                                        CLE031
     C                     MOVE WKSWRI    FRSWRI                                              CLE031
     C                     UPDATLEFERLD0                                                      CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
     C           SACTN     IFEQ 'X'                                                           CLE031
     C           LNRF      CHAINLEFERLL0             69                                       CLE031
     C           *IN69     IFEQ *ON                                                           CLE031
     C                     MOVE 'Y'       FRAUTH                                              CLE031
     C**********           Z-ADDLNRF      FRLNRF                                       CLE031 CLE148
     C                     MOVELLNRF      FRLNRF                                              CLE148
     C                     MOVE *BLANKS   FRSWRI                                              CLE031
     C                     WRITELEFERLD0                                                      CLE031
     C******************** UPDATLEFERLD0                                                      CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** If work regeneration indicator is changed                                            CLE031
      *                                                                                       CLE031
     C           WKSWRI    IFEQ 'C'                                                           CLE031
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           PTFI      IFNE *BLANKS                                                       CLE034
     C                     MOVE 'E'       WSTMA                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'S'       WSTMA                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE FELOAN    PLOAN                                               CLE034
     C                     MOVE FECNUM    PCUSTN                                              CLE034
     C                     MOVE FEFACL    PFACL                                               CLE034
     C                     MOVE FEFSEQ    PFSEQ                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALR1'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM '*TXDT  ' POPTN                                               CLE034
     C                     PARM           BJRDNB                                              CLE034
     C                     PARM *ZERO     PPROT   20                                          CLE034
     C                     PARM           WSTMA   1                                           CLE034
     C                     PARM           FEFCCY                                              CLE034
     C                     PARM 'N'       PNOSCK  1                                           CLE034
     C                     PARM 'FEES'    PLTYPE  4                                           CLE034
     C                     PARM           PLOAN   6                                           CLE034
     C                     PARM *BLANKS   PLAVDT                                              CLE034
     C                     PARM *BLANKS   PLASEQ                                              CLE034
     C                     PARM           PCUSTN  6                                           CLE034
     C                     PARM           PFACL   5                                           CLE034
     C                     PARM           PFSEQ   2                                           CLE034
     C                     PARM *ZERO     PTXDT   50                                          CLE034
     C                     PARM *BLANK    PNOSTR  1                                           CLE034
      *                                                                                       CLE034
     C           PRTCD     IFNE *BLANKS                                                       CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVEL'LESTALPD'DBFILE                                              CLE034
     C                     MOVELPLOAN     DBKEY                                               CLE034
     C                     Z-ADD76        DBASE                                               CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     Z-ADDPTXDT     WTXND                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE031
     C                     ELSE                                                               CLE034
      *                                                                                       CLE031
     C                     EXSR SRGTND                                                        CLE031
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE031
     C**********           Z-ADDFCUS      WECNUM                                       CLE031 CSD027
     C                     MOVE FCUS      WECNUM                                              CSD027
     C                     Z-ADDFTYP      WDFTYP                                              CLE031
     C                     Z-ADDFSEQ      WDFSEQ                                              CLE031
      *                                                                                       CLE031
      ** Check if facility has any associated fee                                             CLE031
      *                                                                                       CLE031
     C           KFEES     SETLLLEFEEDFC                                                      CLE031
     C           KFEES     READELEFEEDFC                 69                                   CLE031
     C           *IN69     DOWEQ*OFF                                                          CLE031
     C           FECALT    IFNE *BLANKS                                                       CLE031
     C           FENPYD    IFLE WTXND                                                         CLE031
     C           FEPEND    ORLE WTXND                                                         CLE031
     C           FEPPTI    IFEQ 'Y'                                                           CLE031
     C           FEEPTI    OREQ 'Y'                                                           CLE031
     C                     MOVE 'A'       FESWRI                                              CLE031
     C                     UPDATLEFEEDF                                                       CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C           KFEES     READELEFEEDFC                 69                                   CLE031
     C                     ENDDO                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *****************************************************************                       CLE031
      * SRFCLT  -  Update facilities file                             *                       CLE031
      *****************************************************************                       CLE031
     C           SRFCLT    BEGSR                                                              CLE031
      *                                                                                       CLE031
      ** Retrieve facilities detail A record                                                  CLE031
      *                                                                                       CLE031
     C**********           Z-ADDFCUS      WFCNUM                                       CLE031 CSD027
     C                     MOVE FCUS      WFCNUM                                              CSD027
     C                     Z-ADDFTYP      WFFACT                                              CLE031
     C                     Z-ADDFSEQ      WFFCNO                                              CLE031
     C                     MOVE 'A'       WFRCTP                                              CLE031
      *                                                                                       CLE031
     C           KFCLT     CHAINFCLTY                68                                       CLE031
      *                                                                                       CLE031
     C           *IN68     IFEQ '1'                                                           CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'FCLTY   'DBFILE                                              CLE031
     C                     Z-ADD80        DBASE                                               CLE031
     C                     MOVELFCTREC    DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Retrieve facilities detail B record                                                  CLE031
      *                                                                                       CLE031
     C                     MOVE 'B'       WFRCTP                                              CLE031
     C           KFCLT     CHAINFCLTY                68                                       CLE031
     C           *IN68     IFEQ '1'                                                           CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'FCLTY   'DBFILE                                              CLE031
     C                     Z-ADD81        DBASE                                               CLE031
     C                     MOVELFCTREC    DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** If linked to participant facility, first update is for the                           CLE031
      ** prime facility                                                                       CLE031
      *                                                                                       CLE031
     C                     MOVE *BLANK    WPRME   1                                           CLE031
     C                     MOVE *BLANK    WPART   1                                           CLE031
      *                                                                                       CLE031
     C           LPFI      IFNE *BLANK                                                        CLE031
     C                     MOVE 'Y'       WPRME                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Prepare for facility updates                                                         CLE031
      *                                                                                       CLE031
     C                     EXSR SRFCUP                                                        CLE031
      *                                                                                       CLE031
      ** If the facility has a credit agreement, update it                                    CLE031
      ** the same way.                                                                        CLE031
      *                                                                                       CLE031
     C           CLE005    IFEQ 'Y'                                                           CLE031
     C           TRCA      ANDEQ'Y'                                                           CLE031
     C                     MOVE RVCR      WRVCR   1                                           CLE031
     C                     MOVE LPFI      WLPFI   1                                           CLE031
     C**********           Z-ADDPTFC      WPTFC   60                                   CLE031 CSD027
     C                     MOVE PTFC      WPTFC   6                                           CSD027
     C                     Z-ADDPTFT      WPTFT   30                                          CLE031
     C                     Z-ADDPTFN      WPTFN   20                                          CLE031
     C                     EXSR SRCAUP                                                        CLE031
     C                     MOVE WLPFI     LPFI                                                CLE031
     C**********           Z-ADDWPTFC     PTFC                                         CLE031 CSD027
     C                     MOVE WPTFC     PTFC                                                CSD027
     C                     Z-ADDWPTFT     PTFT                                                CLE031
     C                     Z-ADDWPTFN     PTFN                                                CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** If linked to participant facility, update participant facility                       CLE031
      *                                                                                       CLE031
     C           LPFI      IFNE *BLANK                                                        CLE031
     C           LPFI      ANDNE'R'                                                           CLE031
     C                     MOVE *BLANK    WPRME                                               CLE031
     C                     MOVE 'Y'       WPART                                               CLE031
     C**********           Z-ADDPTFC      WFCNUM                                       CLE031 CSD027
     C                     MOVE PTFC      WFCNUM                                              CSD027
     C                     Z-ADDPTFT      WFFACT                                              CLE031
     C                     Z-ADDPTFN      WFFCNO                                              CLE031
     C                     MOVE 'A'       WFRCTP                                              CLE031
      *                                                                                       CLE031
     C           KFCLT     CHAINFCLTY                68                                       CLE031
     C           *IN68     IFEQ '1'                                                           CLE031
     C           *IN68     OREQ '0'                                                           CLE031
     C           RECIF     ANDNE'D'                                                           CLE031
     C           RECIF     ANDNE'E'                                                           CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'FCLTY   'DBFILE                                              CLE031
     C                     Z-ADD82        DBASE                                               CLE031
     C                     MOVELFCTREC    DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Retrieve facilities detail B record                                                  CLE031
      *                                                                                       CLE031
     C                     MOVE 'B'       WFRCTP                                              CLE031
     C           KFCLT     CHAINFCLTY                68                                       CLE031
     C           *IN68     IFEQ '1'                                                           CLE031
     C           *IN68     OREQ '0'                                                           CLE031
     C           RECIF     ANDNE'D'                                                           CLE031
     C           RECIF     ANDNE'E'                                                           CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'FCLTY   'DBFILE                                              CLE031
     C                     Z-ADD83        DBASE                                               CLE031
     C                     MOVELFCTREC    DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Prepare for participant facility update                                              CLE031
      *                                                                                       CLE031
     C                     EXSR SRFCUP                                                        CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *****************************************************************                       CLE031
      /EJECT                                                                                  CLE031
      *****************************************************************                       CLE031
      * SRCAUP  -  Update credit agreement/superfacility              *                       CLE031
      *****************************************************************                       CLE031
     C           SRCAUP    BEGSR                                                              CLE031
      *                                                                                       CLE031
      ** Retrieve facilities detail A record                                                  CLE031
      *                                                                                       CLE031
     C                     MOVE FCCYF     WFCCYF  3                                           CLE031
     C                     MOVE CMDI      WFCMDI  1                                           CLE031
     C                     Z-ADDCAXR      WFCAXR 138                                          CLE031
     C**********           Z-ADDCANM      WFCNUM                                       CLE031 CSD027
     C                     MOVE CANM      WFCNUM                                              CSD027
     C                     Z-ADDCAFT      WFFACT                                              CLE031
     C                     Z-ADDCAFN      WFFCNO                                              CLE031
     C                     MOVE 'A'       WFRCTP                                              CLE031
     C           KFCLT     CHAINFCLTY                68                                       CLE031
     C           *IN68     IFEQ '1'                                                           CLE031
     C           *IN68     OREQ '0'                                                           CLE031
     C           RECIF     ANDNE'D'                                                           CLE031
     C           RECIF     ANDNE'E'                                                           CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'FCLTY   'DBFILE                                              CLE031
     C                     Z-ADD84        DBASE                                               CLE031
     C                     MOVELFCTREC    DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Retrieve facilities detail B record                                                  CLE031
      *                                                                                       CLE031
     C                     MOVE 'B'       WFRCTP                                              CLE031
     C           KFCLT     CHAINFCLTY                68                                       CLE031
     C           *IN68     IFEQ '1'                                                           CLE031
     C           *IN68     OREQ '0'                                                           CLE031
     C           RECIF     ANDNE'D'                                                           CLE031
     C           RECIF     ANDNE'E'                                                           CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'FCLTY   'DBFILE                                              CLE031
     C                     Z-ADD85        DBASE                                               CLE031
     C                     MOVELFCTREC    DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** If the revolving credit indicator is 'T', use the tranche's                          CLE031
      ** revolving credit indicator                                                           CLE031
      *                                                                                       CLE031
     C           CLE014    IFEQ 'Y'                                                           CLE031
     C           RVCR      ANDEQ'T'                                                           CLE031
     C                     MOVE WRVCR     RVCR                                                CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Prepare for credit agreement/superfacility update                                    CLE031
      *                                                                                       CLE031
     C                     MOVE 'Y'       WTRCA   1                                           CLE031
     C                     EXSR SRFCUP                                                        CLE031
     C                     MOVE *BLANK    WTRCA                                               CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *****************************************************************                       CLE031
      /EJECT                                                                                  CLE031
      *****************************************************************                       CLE031
      * SRFCUP  -  Prepare for facilities updates                     *                       CLE031
      *****************************************************************                       CLE031
     C           SRFCUP    BEGSR                                                              CLE031
      *                                                                                       CLE031
     C           WTRCA     IFEQ *BLANK                                                        CLE031
     C           WTRCA     OREQ 'Y'                                                           CLE031
     C           FCCYF     ANDNEWFCCYF                                                        CLE031
      *                                                                                       CLE031
     C           WTRCA     IFEQ 'Y'                                                           CLE031
     C                     MOVE WFCCYF    PCURR                                               CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE CCY       PCURR                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     CALL 'AOCURRR0'                                                    CLE031
     C                     PARM           PRTCD                                               CLE031
     C                     PARM '*KEY    'POPTN                                               CLE031
     C                     PARM           PCURR                                               CLE031
     C           SDCURR    PARM SDCURR    DSSDY                                               CLE031
      *                                                                                       CLE031
     C           PRTCD     IFNE *BLANKS                                                       CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'SDCURRPD'DBFILE                                              CLE031
     C                     Z-ADD86        DBASE                                               CLE031
     C                     MOVELPCURR     DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Save currency details.                                                               CLE031
      *                                                                                       CLE031
     C                     MOVE A6CYCD    ZCCYI                                               CLE031
     C                     Z-ADDA6SPRT    ZRATE1                                              CLE031
     C                     MOVE A6MDIN    ZMDI1                                               CLE031
     C                     Z-ADDA6NBDP    ZCDPI                                               CLE031
     C                     Z-ADDA6NBDP    WCDPL   10                                          CLE031
      *                                                                                       CLE031
     C           WTRCA     IFEQ 'Y'                                                           CLE031
     C                     MOVE FCCYF     PCURR                                               CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE FCCY      PCURR                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     CALL 'AOCURRR0'                                                    CLE031
     C                     PARM           PRTCD                                               CLE031
     C                     PARM '*KEY    'POPTN                                               CLE031
     C                     PARM           PCURR                                               CLE031
     C           SDCURR    PARM SDCURR    DSSDY                                               CLE031
      *                                                                                       CLE031
     C           PRTCD     IFNE *BLANKS                                                       CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'SDCURRPD'DBFILE                                              CLE031
     C                     Z-ADD87        DBASE                                               CLE031
     C                     MOVELPCURR     DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Save currency details.                                                               CLE031
      *                                                                                       CLE031
     C                     MOVE A6CYCD    ZCCYO                                               CLE031
     C                     Z-ADDA6SPRT    ZRATE2                                              CLE031
     C                     MOVE A6MDIN    ZMDI2                                               CLE031
     C                     Z-ADDA6NBDP    ZCDPO                                               CLE031
     C                     Z-ADDA6NBDP    WCDPF   10                                          CLE031
      *                                                                                       CLE031
     C           WFMIN     IFEQ *BLANKS                                                       CLE031
     C           A6MDIN    IFEQ 'M'                                                           CLE031
     C                     MOVE 'D'       WFMIN   1                                           CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'M'       WFMIN                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Convert amounts into facility currency equivalent                                    CLE031
      *                                                                                       CLE031
     C                     EXSR SRFEQV                                                        CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** If sold with recourse, do not update exposure and availability                       CLE031
      ** For syndicated loans, do not update prime facility if sold                           CLE031
      ** with recourse                                                                        CLE031
      ** Do not update prime facility for Internal parts purchased                            CLE031
      *                                                                                       CLE031
     C                     DO                                                                 CLE031
      *                                                                                       CLE031
     C           WPARTS    IFEQ 'Y'                                                           CLE031
     C           RCSI      ANDEQ'Y'                                                           CLE031
     C           WPART     ANDEQ*BLANK                                                        CLE031
     C           RCSI      OREQ 'Y'                                                           CLE031
     C           WPART     ANDEQ'Y'                                                           CLE031
     C           WPARTP    OREQ 'Y'                                                           CLE031
     C           WPRME     ANDEQ'Y'                                                           CLE031
     C           LPFI      ANDEQ'Y'                                                           CLE031
     C                     LEAVE                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVE 'Y'       WFUAV   1                                           CLE031
      *                                                                                       CLE031
     C                     MOVE FCCYF     ZCCY                                                CLE031
     C                     MOVE ' '       ZFREQ                                               CLE031
     C                     Z-ADD0         ZMDAY                                               CLE031
     C                     Z-ADD99999     ENDAY   50                                          CLE031
      *                                                                                       CLE031
     C           WPARTS    IFEQ 'Y'                                                           CLE031
     C           WPART     ANDEQ*BLANKS                                                       CLE031
     C                     MOVE 'N'       WFUAV                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     EXSR SRFUPD                                                        CLE031
      *                                                                                       CLE031
     C                     Z-ADDRLDT      DAYNO   50                                          CLE031
     C                     MOVE *BLANK    ZLOC                                                CLE031
     C                     Z-ADDWOPAMF    FCBAL  130                                          CLE031
     C                     Z-ADDFCBAL     WRK13  130                                          CLE031
      *                                                                                       CLE031
     C           CLE023    IFEQ 'Y'                                                           CLE031
     C                     Z-ADDWXPAMF    FXCBAL 130                                          CLE031
     C                     Z-ADDFXCBAL    WRK14  130                                          CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     EXSR SRFEXP                                                        CLE031
      *                                                                                       CLE031
     C                     ENDDO                                                              CLE031
      *                                                                                       CLE031
      ** Update facilities file - B record                                                    CLE031
      *                                                                                       CLE031
     C                     Z-ADDBJRDNB    LCD                                                 CLE031
     C                     MOVE 'A'       CHTP                                                CLE031
     C                     Z-ADDNATN      TNLUFN                                              CLE031
     C                     UPDATFCLTYFNF                                                      CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *****************************************************************                       CLE031
      /EJECT                                                                                  CLE031
      *****************************************************************                       CLE031
      * SRFEQV  -  Get facility equivalent of amounts                 *                       CLE031
      *****************************************************************                       CLE031
     C           SRFEQV    BEGSR                                                              CLE031
      *                                                                                       CLE031
     C           WCDPF     SUB  WCDPL     CX      10                                          CLE031
     C                     ADD  4         CX                                                  CLE031
      *                                                                                       CLE031
      ** If CLE023 is ON, get cross rate of currencies spot.                                  CLE031
      *                                                                                       CLE031
     C           CLE023    IFEQ 'Y'                                                           CLE031
     C                     EXSR ZXRATE                                                        CLE031
     C                     Z-ADDZRATEX    ZEXCH                                               CLE031
     C                     MOVE ZMDIX     ZMD                                                 CLE031
     C           ZCCYI     IFEQ BJCYCD                                                        CLE031
     C                     MOVE 'M'       ZMD                                                 CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** If Rollover status is blank                                                          CLE031
      *                                                                                       CLE031
     C           RSTS      IFEQ *BLANKS                                                       CLE031
     C           WNPRAM    SUB  CPAM      WAMT   130                                          CLE031
     C                     ELSE                                                               CLE031
     C           WNPRAM    SUB  WSNPAM    WAMT                                                CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** If work tranche is blanks                                                            CLE031
      *                                                                                       CLE031
     C           WTRCA     IFEQ *BLANK                                                        CLE031
      *                                                                                       CLE031
     C           SNFCEB    IFNE *BLANKS                                                       CLE031
      *                                                                                       CLE031
      ** Format new facility currency exchange rate                                           CLE031
      *                                                                                       CLE031
     C           WFMIN     IFEQ 'D'                                                           CLE031
     C           VNFCE     DIV  POWER,CX  WFCXRT 159H                                         CLE031
     C           1         DIV  WFCXRT    WFCXRT                                              CLE031
     C                     ELSE                                                               CLE031
     C           VNFCE     MULT POWER,CX  WFCXRT    H                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Calculate work facility principal amount using new facility                          CLE031
      ** currency exchange rate                                                               CLE031
      *                                                                                       CLE031
     C           WAMT      MULT WFCXRT    WOPAMF    H                                         CLE031
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
      ** Format facility currency exchange rate                                               CLE031
      *                                                                                       CLE031
     C           WFMIN     IFEQ 'D'                                                           CLE031
     C           FCXR      DIV  POWER,CX  WFCXRT 159H                                         CLE031
     C           1         DIV  WFCXRT    WFCXRT                                              CLE031
     C                     ELSE                                                               CLE031
     C           FCXR      MULT POWER,CX  WFCXRT    H                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Calculate work facility principal amount using facility                              CLE031
      ** currency exchange rate                                                               CLE031
      *                                                                                       CLE031
     C           WAMT      MULT WFCXRT    WOPAMF    H                                         CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           CLE023    IFEQ 'Y'                                                           CLE031
     C                     Z-ADDWAMT      ZAMTCI                                              CLE031
     C                     EXSR ZCONV                                                         CLE031
     C                     Z-ADDZAMTCO    WXPAMF                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Get loan amount in credit agreement currency                                         CLE031
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
      ** Format credit agreement exchange rate                                                CLE031
      *                                                                                       CLE031
     C           WFCMDI    IFEQ 'D'                                                           CLE031
     C           WFCAXR    DIV  POWER,CX  WFCXRT 159H                                         CLE031
     C           1         DIV  WFCXRT    WFCXRT                                              CLE031
     C                     ELSE                                                               CLE031
     C           WFCAXR    MULT POWER,CX  WFCXRT    H                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Calculate work facility principal amount using credit                                CLE031
      ** agreement exchange rate                                                              CLE031
      *                                                                                       CLE031
     C           WAMT      MULT WFCXRT    WOPAMF 130H                                         CLE031
      *                                                                                       CLE031
      ** If CLE023 is on, calculate amounts using spot rate.                                  CLE031
      *                                                                                       CLE031
     C           CLE023    IFEQ 'Y'                                                           CLE031
     C                     Z-ADDWAMT      ZAMTCI                                              CLE031
     C                     EXSR ZCONV                                                         CLE031
     C                     Z-ADDZAMTCO    WXPAMF 130                                          CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *****************************************************************                       CLE031
      /EJECT                                                                                  CLE031
      *****************************************************************                       CLE031
      * SRFUPD  -  Determine if adding to or subtracting from facility*                       CLE031
      *****************************************************************                       CLE031
     C           SRFUPD    BEGSR                                                              CLE031
      *                                                                                       CLE031
     C                     MOVE *BLANK    WNOUP   1                                           CLE031
      *                                                                                       CLE031
     C                     SELEC                                                              CLE031
      *                                                                                       CLE031
      ** Participation Purchased                                                              CLE031
      *                                                                                       CLE031
     C           WPARTP    WHEQ 'Y'                                                           CLE031
     C           WPRME     IFEQ 'Y'                                                           CLE031
     C                     MOVE 'S'       WFUPD   1                                           CLE031
     C           CLE023    IFEQ 'Y'                                                           CLE031
     C                     MOVE 'Y'       WNOUP                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'A'       WFUPD                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Participation Sold                                                                   CLE031
      *                                                                                       CLE031
     C           WPARTS    WHEQ 'Y'                                                           CLE031
     C           WPART     IFEQ 'Y'                                                           CLE031
     C                     MOVE 'A'       WFUPD                                               CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'S'       WFUPD                                               CLE031
     C           CLE023    IFEQ 'Y'                                                           CLE031
     C                     MOVE 'Y'       WNOUP                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Normal Loan                                                                          CLE031
      *                                                                                       CLE031
     C                     OTHER                                                              CLE031
     C                     MOVE 'A'       WFUPD                                               CLE031
      *                                                                                       CLE031
     C                     ENDSL                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *****************************************************************                       CLE031
      /EJECT                                                                                  CLE031
      *****************************************************************                       CLE031
      * SRFEXP  -  Update exposure and availability array of facility *                       CLE031
      *****************************************************************                       CLE031
     C           SRFEXP    BEGSR                                                              CLE031
      *                                                                                       CLE031
     C           DAYNO     IFNE *ZEROS                                                        CLE031
      *                                                                                       CLE031
     C           ZFREQ     DOUEQ*BLANK                                                        CLE031
      *                                                                                       CLE031
     C**********           Z-ADD1         Z       20                                   CLE031 257336
     C                     Z-ADD1         Z       30                                          257336
     C           DAYNO     LOKUPRUNS,Z               69  69                                   CLE031
     C           *IN69     IFEQ '1'                                                           CLE031
     C           DAYNO     ANDGTENDAY                                                         CLE031
     C           *IN69     OREQ '0'                                                           CLE031
     C                     LEAVE                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Do not update if amount is negative                                                  CLE031
      *                                                                                       CLE031
     C                     SUB  FCBAL     WRK13      69  69                                   CLE031
     C           WRK13     IFLT *ZEROS                                                        CLE031
     C                     ADD  WRK13     FCBAL      69                                       CLE031
     C                     Z-ADD*ZEROS    WRK13                                               CLE031
     C                     ENDIF                                                              CLE031
     C           *IN69     IFEQ '0'                                                           CLE031
     C                     LEAVE                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Update exposure if earlier than or equal to rundate                                  CLE031
      ** Do not update exposure of an internal parts purchased for                            CLE031
      ** participant facility                                                                 CLE031
      *                                                                                       CLE031
     C           WNOUP     IFNE 'Y'                                                           CLE031
     C           DAYNO     IFLE BJRDNB                                                        CLE031
     C           WFUPD     IFEQ 'S'                                                           CLE031
     C                     SUB  FCBAL     CAMD                                                CLE031
     C                     ELSE                                                               CLE031
     C                     ADD  FCBAL     CAMD                                                CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** If CLE009 is installed, set Work Regeneration Indicator to                           CLE031
      ** changed                                                                              CLE031
      *                                                                                       CLE031
     C           CLE009    IFEQ 'Y'                                                           CLE031
     C                     MOVE 'C'       WKSWRI  1                                           CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Prevent update of availability if:                                                   CLE031
      ** (1) customer is a branch internal customer for parts purchased                       CLE031
      **       and sold                                                                       CLE031
      *                                                                                       CLE031
     C           WPARTP    IFEQ 'Y'                                                           CLE031
     C           WPARTS    OREQ 'Y'                                                           CLE031
     C           CNUML     LOKUPWBIC,1                   86                                   CLE031
     C           *IN86     IFEQ '1'                                                           CLE031
     C                     MOVE 'N'       WFUAV                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Update outstanding amounts                                                           CLE031
      *                                                                                       CLE031
     C           WNOUP     IFNE 'Y'                                                           CLE031
     C           WFUAV     IFEQ 'Y'                                                           CLE031
      *                                                                                       CLE031
      ** Do not update beyond the expiry date of the facility                                 CLE031
      *                                                                                       CLE031
     C           Z         DOWLE10                                                            CLE031
     C           RUNS,Z    ANDLTDTEX                                                          CLE031
      *                                                                                       CLE031
     C           WFUPD     IFEQ 'S'                                                           CLE031
     C           OAM,Z     SUB  FCBAL     OAM,Z                                               CLE031
     C                     ELSE                                                               CLE031
     C           OAM,Z     ADD  FCBAL     OAM,Z                                               CLE031
     C                     ENDIF                                                              CLE031
     C           Z         ADD  1         Z                                                   CLE031
     C                     ENDDO                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** If CLE023 is on, update Current Exposure based on spot rate.                         CLE031
      *                                                                                       CLE031
     C           CLE023    IFEQ 'Y'                                                           CLE031
      *                                                                                       CLE031
     C                     SUB  FXCBAL    WRK14      69  69                                   CLE031
     C           WRK14     IFLT *ZEROS                                                        CLE031
     C                     ADD  WRK14     FXCBAL     69                                       CLE031
     C                     Z-ADD*ZEROS    WRK14                                               CLE031
     C                     ENDIF                                                              CLE031
     C           *IN69     IFEQ '0'                                                           CLE031
     C                     LEAVE                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           DAYNO     IFLE BJRDNB                                                        CLE031
     C           WFUPD     IFEQ 'S'                                                           CLE031
     C                     SUB  FXCBAL    CEXP                                                CLE031
     C                     ELSE                                                               CLE031
     C                     ADD  FXCBAL    CEXP                                                CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Increase DAYNO by frequency code                                                     CLE031
      *                                                                                       CLE031
     C           ZFREQ     IFNE *BLANK                                                        CLE031
     C                     Z-ADDDAYNO     ZDAYNO                                              CLE031
     C                     EXSR ZFREQB                                                        CLE031
     C                     Z-ADDZDAYNO    DAYNO                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDDO                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *****************************************************************                       CLE031
      /EJECT                                                                                  CLE031
      *****************************************************************                       CLE031
      *  SRGTND  -  Get Telex Notice Days                             *                       CLE031
      *****************************************************************                       CLE031
     C           SRGTND    BEGSR                                                              CLE031
      *                                                                                       CLE031
      ** If CLE034 is on, Settlement Allocations is 'Y', &                                    CLE034
      ** Settle through Nostros is 'Y'                                                        CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SRSTA     ANDEQ'Y'                                                           CLE034
     C           PSTNOS    ANDEQ'Y'                                                           CLE034
     C                     MOVE CCY       PCURR                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE BJLCCY    PCURR                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SRSTA     ANDEQ'N'                                                           CLE034
     C           CLE034    OREQ 'N'                                                           CLE034
     C                     MOVE SDST      WSDST                                               CLE031
     C           WSDST     LOKUPLNOST                    68                                   CLE031
     C           *IN68     IFEQ *OFF                                                          CLE031
     C                     MOVELBJLCCY    PCURR                                               CLE031
     C                     ELSE                                                               CLE031
     C                     MOVELCCY       PCURR                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE034
     C                     MOVE *BLANKS   A6CYCD                                              CLE031
     C                     MOVE *ON       EDBAS                                               CLE031
     C                     Z-ADD88        DBASE                                               CLE031
     C                     EXSR SRCURR                                                        CLE031
      *                                                                                       CLE031
     C                     Z-ADDA6TXND    ZNRDYS                                              CLE031
     C           *IN40     IFEQ *OFF                                                          CLE031
     C                     MOVELCCY       ZCCY                                                CLE031
     C                     ELSE                                                               CLE031
     C                     MOVELBJLCCY    ZCCY                                                CLE031
     C                     ENDIF                                                              CLE031
     C                     Z-ADDBJRDNB    ZDAYNO                                              CLE031
     C                     MOVELBJLCCY    ZCCY1                                               CLE031
     C                     MOVELCCY       ZCCY2                                               CLE031
     C                     EXSR ZF2C                                                          CLE031
     C                     Z-ADDZDYNBR    WTXND   50                                          CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *****************************************************************                       CLE031
      /EJECT                                                                                  CLE031
      *****************************************************************                       217956
      * SRFAMT  - Calculate New Principal Amt. based on Facility FAMT *                       217956
      *****************************************************************                       217956
     C           SRFAMT    BEGSR                                                              217956
      *                                                                                       217956
     C                     Z-ADD0         WLFAMT 130                                          217956
     C                     Z-ADD0         W#DRAW 130                                          217956
      * Access FCLTYFM record for fcaility amount FAMT                                        217956
     C                     MOVE 'A'       WFRCTP                                              217956
     C**********           Z-ADDFCUS      WFCNUM                                       217956 CSD027
     C                     MOVE FCUS      WFCNUM                                              CSD027
     C                     Z-ADDFTYP      WFFACT                                              217956
     C                     Z-ADDFSEQ      WFFCNO                                              217956
      *                                                                                       217956
     C           KFCLT     CHAINFCLTY               N68                                       217956
      *                                                                                       217956
     C           *IN68     IFEQ '1'                                                           217956
     C           *LOCK     IN   LDA                                                           217956
     C                     MOVEL'FCLTY   'DBFILE                                              217956
     C                     Z-ADD91        DBASE                                               217956
     C                     MOVELFCTREC    DBKEY                                               217956
     C                     OUT  LDA                                                           217956
     C                     EXSR *PSSR                                                         217956
     C                     ENDIF                                                              217956
      *                                                                                       217956
      ** Access FCLTYFN record for drawn amount OAM2:                                         217956
      *                                                                                       217956
     C                     MOVE 'B'       WFRCTP                                              217956
     C           KFCLT     CHAINFCLTY               N68                                       217956
      *                                                                                       217956
     C           *IN68     IFEQ '1'                                                           217956
     C           *LOCK     IN   LDA                                                           217956
     C                     MOVEL'FCLTY   'DBFILE                                              217956
     C                     Z-ADD92        DBASE                                               217956
     C                     MOVELFCTREC    DBKEY                                               217956
     C                     OUT  LDA                                                           217956
     C                     EXSR *PSSR                                                         217956
     C                     ENDIF                                                              217956
      *                                                                                       217956
      ** Calculate the undrawn facility amount:                                               217956
      *                                                                                       217956
     C           OAM2      SUB  FPAM      W#DRAW                                              217956
     C           FAMT      SUB  W#DRAW    W#FAMT 130                                          217956
      *                                                                                       217956
      ** Convert to Loan Currency using New Facility Ccy Exchange Rate:                       217956
      *                                                                                       217956
     C           WNFMDI    IFEQ 'M'                                                           217956
     C           W#FAMT    DIV  WEXR15    WLFAMT    H                                         217956
     C                     ELSE                                                               217956
     C           W#FAMT    MULT WEXR15    WLFAMT    H                                         217956
     C                     ENDIF                                                              217956
      *                                                                                       218930
     C           WLFAMT    IFLT 0                                                             218930
     C                     Z-ADD0         WLFAMT                                              218930
     C                     ENDIF                                                              218930
      *                                                                                       217956
     C                     ENDSR                                                              217956
      *****************************************************************
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *****************************************************************
     C           *PSSR     BEGSR                                       **
      *
     C           @RUN      IFEQ *BLANK
      *
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           PMODE     OREQ 'F'                                       CAP062
     C                     CALL 'DBERRCTL'
     C                     ELSE
      *
     C           PMODE     IFNE 'B'                                       120617
     C                     ROLBK
     C                     ENDIF                                          120617
     C                     MOVELDBFILE    D13X20
     C                     MOVELDBKEY     D30X58
     C                     MOVELDBPGM     D70X79
     C                     MOVE DBASE     D89X91
     C           PMODE     IFEQ 'B'
     C                     MOVE 'D'       PORMSV                                            AR868380
     C                     MOVE PORMSV    ZAMSVR  1                                         AR868380
     C                     MOVEL'LEL0035 'ZAMSID                                            AR868380
     C           PRTCD     IFEQ '*RECLCK'                                                   AR868380
     C                     MOVEL'LEL0817 'ZAMSID                                            AR868380
     C                     ENDIF                                                            AR868380
     C                     EXSR SRPOMP
     C**********           MOVE 'D'       PORMSV                                            AR868380
     C**********           MOVE DBASE     PORMID                                            AR868380
     C**********           MOVELD01X91    PORMTX                                            AR868380
     C                     ENDIF
     C           PMODE     IFEQ 'P'
     C                     MOVE 'E'       RMSV
     C                     MOVE DBASE     RMID
     C                     MOVELD01X91    RMTX
     C                     UPDATLE2070D0
     C                     CLOSELE2070PD
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVE *ON       *INU7
     C                     MOVE *ON       *INU8
     C                     MOVE *ON       *INLR
     C                     RETRN
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
     C/COPY ZSRSRC,ZALIGNZ2
      /EJECT
     C/COPY ZSRSRC,ZEDITZ2
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C/COPY ZSRSRC,ZACCH
      /EJECT
     C/COPY ZSRSRC,ZCHKH
      /EJECT
     C/COPY ZSRSRC,ZTNLU1Z2
      /EJECT
     C/COPY ZSRSRC,ZFWDT
      /EJECT
     C/COPY ZSRSRC,ZFREQBZ2
      /EJECT
     C/COPY ZSRSRC,GLINTCZ1
      /EJECT
     C/COPY ZSRSRC,ZINTDYZ2
      /EJECT
     C/COPY ZSRSRC,ZDATE9Z3
      /EJECT
     C/COPY ZSRSRC,ZF2C
      /EJECT
     C/COPY ZSRSRC,ZCPDZ2
      /EJECT
     C/COPY ZSRSRC,ZDAT10Z2
      /EJECT
     C/COPY ZSRSRC,ZXRATEZ1
      /EJECT
     C/COPY ZSRSRC,ZCONVZ1                                                123335
      /EJECT                                                              123335
     C/COPY ZSRSRC,ZFRPEDZ3                                                                   195070
      /EJECT                                                                                  195070
     C/COPY WNCPYSRC,LE2070C019
      *
      ** Update LTRIX header record
      *
     O*LTRIX***E                TRXHDR                                                      AR322732
     O**********               NOREX     11P                                                AR322732
     O**********               RRNAX     20P                                                AR322732
     O**********               NLNRX     29P                                                AR322732
     O**********               VTNLU     40P                                                AR322732
      *
      ** Update LTRIX detail record
      *
     O********E*               TRXDTL                                                       AR322732
     OLTRIX   EADD             TRXDTL                                                       AR322732
     O                                    2 'DL'
     O                         LNRF       8
     O                                   16 '00000000'
     O                         SACTN     17
     O                                   19 'YN'
     O                                   20 ' '
     O                                   25 '00001'
     O                                   26 'N'
     O                                   27 '0'
     O                         LXRRN     37P
     O                         VTNLU     40P
     O                                   43 '010'
     O                                   44 ' '                                             AR322732
     O                                   45 ' '                                             AR322732
     O/COPY WNCPYSRC,LE2070O001
      /EJECT
** CPY@
(c) Finastra International Limited 2001
**  FTAB
MQXY
**  LNOST
010708
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
** CWA - Array for watch list fields                                                          CSD015
<Receipt Nostro>                                                                              CSD015
</Receipt Nostro>                                                                             CSD015
<Receipt Intermed Bank>                                                                       CSD015
</Receipt Intermed Bank>                                                                      CSD015
<Receipt Ordering Bank>                                                                       CSD015
</Receipt Ordering Bank>                                                                      CSD015
<Receipt Ordering Cust>                                                                       CSD015
</Receipt Ordering Cust>                                                                      CSD015
<Payment Nostro>                                                                              CSD015
</Payment Nostro>                                                                             CSD015
<Payment Intermed Bank>                                                                       CSD015
</Payment Intermed Bank>                                                                      CSD015
<Payment Ordering Bank>                                                                       CSD015
</Payment Ordering Bank>                                                                      CSD015
<Payment Ordering Cust>                                                                       CSD015
</Payment Ordering Cust>                                                                      CSD015
<Receiver Correspondent>                                                                      CSD015
</Receiver Correspondent>                                                                     CSD015
<Receiver>                                                                                    CSD015
</Receiver>                                                                                   CSD015
<Account With Bank>                                                                           CSD015
</Account With Bank>                                                                          CSD015
<Beneficiary>                                                                                 CSD015
</Beneficiary>                                                                                CSD015
<Details Of Payment>                                                                          CSD015
</Details Of Payment>                                                                         CSD015
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION                       123335
0000001                                                                   123335
0000010                                                                   123335
0000100                                                                   123335
0001000                                                                   123335
0010000                                                                   123335
0100000                                                                   123335
1000000                                                                   123335
** SVALTX - Systen value key text                                                             CLE148
LoanAlphaAllow                                                                                CLE148
