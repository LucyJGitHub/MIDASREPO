     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Manual repayment input')                      *
/*OVRF*: OVRDBF FILE(LOAMD) TOFILE(LOAMS)  SHARE(*NO)               : *
/*OVR *: OVRDBF FILE(LEIMRPLX) TOFILE(LEIMRPL2) SHARE(*NO)          : *   CAP063
      *****************************************************************
      *                                                               *
      *  Midas - Customer Lending Module                              *
      *                                                               *
      *  LE2110 - Manual Repayment Input                              *
      *                                                               *
      *  Function:  This is the new maintenance program for Manual    *
      *             Repayment Input.  It will be run in five modes:   *
      *             Repayment Input.  It will be run in four modes:   *
      *       'I' - Interactive - The program is called from the      *
      *             Midas Transaction Input menu.                     *
      *       'R' - Record - The program is run interactively through *
      *             a Midas test environment.  When updates are       *
      *             performed a record is written to a new test       *
      *             harness physical file which will mirror exactly   *
      *             the contents of the screen.                       *
      *       'P' - Play - The program is run interactively or in     *
      *             batch through a Midas test environment.  Data is  *
      *             read in from the test harness physical file which *
      *             is written in record mode.  Updates will be done  *
      *             to the Midas database.                            *
      *       'B' - The program is run in batch and called by a       *
      *             communications control program.  Data which has   *
      *             been entered in a PC subsystem is received from a *
      *             message queue and passed to the program as a      *
      *             parameter.  The program  will be called by a      *
      *             communications control program  with input        *
      *             parameters  MODE='B' and 'LAMR' TRANSMITTED       *
      *             MESSAGE types = as received from the message queue*
      *             A RETURNED MESSAGE output parameter is used to    *
      *             return information to the control program for     *
      *             communication with the PC subsystem.              *
      *       'F' - Repair - The program is called from the Midas     *   CAP063
      *             Transaction Input menu to repair invalid          *   CAP063
      *             transactions.                                     *   CAP063
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. MD023787           Date 29Apr14               *
      *  Prev Amend No. CSD095             Date 08Apr14               *
      *                 AR868380           Date 11Jun13               *
      *                 AR830785           Date 07May13               *
      *                 AR806351           Date 24Apr13               *
      *                 259991             Date 20Dec12               *
      *                 AR870590           Date 29Nov12               *
      *                 AR991073           Date 26Nov12               *
      *                 AR996895           Date 25Nov12               *
      *                 AR722359           Date 08Nov12               *
      *                 AR322732           Date 23Jul12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR317587           Date 19Aug11               *
      *                 CRE073             Date 06Dec10               *
      *                 CLE143             Date 06Dec10               *
      *                 CLE139             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 259328             Date 27Mar09               *
      *                 262328             Date 30Oct09               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 257477             Date 31Oct08               *
      *                 257369             Date 23Oct08               *
      *                 257098             Date 08Oct08               *
      *                 246141             Date 26Mar07               *
      *                 245082             Date 30Jan07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 227710             Date 21May04               *
      *                 CLE038             Date 11May04               *
      *                 222410             Date 23Oct03               *
      *                 CLE036             Date 23Oct03               *
      *                 CIR013             Date 25Apr05               *
      *                 CAS011             Date 16May05               *
      *                 CAS009             Date 04May04               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 28Oct03               *
      *                 219608             Date 20Oct03               *
      *                 CSF002             Date 11Aug03               *
      *                 CAP075             Date 08Aug02               *
      *                 CAP074             Date 08Aug02               *
      *                 CAP073             Date 08Aug02               *
      *                 CDE005             Date 23Sep02
      *                 CLE029             Date 04Sep02               *
      *                 CLE034             Date 23Jun03               *
      *                 217046             Date 16Apr03               *
      *                 CLE033             Date 09Apr03               *
      *                 216067             Date 20Mar03               *
      *                 CLE031             Date 11Feb03               *
      *                 223935             Date 05Dec03               *
      *                 CAS005             Date 16Dec02               *
      *                 CSD015             Date 14Oct02               *
      *                 CLE028             Date 27Jun02               *
      *                 CAS004             Date 26Jun02               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 210119             Date 23Oct02               *
      *                 209161             Date 23Oct02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 209709             Date 25Sep02               *
      *                 207629             Date 23Aug02               *
      *                 205964             Date 11Jun02               *
      *                 206443             Date 11Jun02               *
      *                 205703             Date 11Jun02               *
      *                 205504             Date 10Jun02               *
      *                 205258             Date 10Jun02               *
      *                 205535             Date 10Jun02               *
      *                 204708             Date 29Apr02               *
      *                 204452             Date 05Jun02               *
      *                 201672             Date 29Apr02               *
      *                 205002             Date 26Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 22May01               *
      *                 CAP068             Date 25JUN02               *
      *                 CLE023             Date 19Nov01               *
      *                 202068             Date 19Nov01               *
      *                 CSC011             Date 09Jan02               *
      *                 194632             Date 16Oct01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CAP063             Date 06Jun01               *
      *                 192949             Date 23Jul01               *
      *                 186431             Date 19Jul01               *
      *                 186752             Date 04Jul01               *
      *                 177972             Date 03Jul01               *
      *                 184384             Date 02Jul01               *
      *                 194509             Date 19Jun01               *
      *                 CLE014             Date 20Mar01               *
      *                 193064             Date 23May01               *
      *                 183958             Date 30Mar01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 15May01               *
      *                 186072             Date 19Feb01               *
      *                 184689             Date 24Jan01               *
      *                 186834             Date 15Dec00               *
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CRT004             Date 04May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 175450             Date 09Mar00               *
      *                 CIR004             Date 20Jan00               *
      *                 178782             Date 11May00               *
      *                 CDE001             Date 12Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 170120             Date 10Nov99               *
      *                 165031             Date 04Aug99               *
      *                 163937             Date 14Jul99               *
      *                 CLE009             Date 21May99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 155099             Date 16Jun99               *
      *                 161262             Date 08Jun99               *
      *                 161072             Date 25May99               *
      *                 157744             Date 21May99               *
      *                 159256             Date 11May99               *
      *                 159257             Date 19Apr99               *
      *                 158802             Date 16Apr99               *
      *                 156969             Date 14Apr99               *
      *                 158148             Date 05Apr98               *
      *                 152678             Date 29Mar99               *
      *                 154092             Date 18Mar99               *
      *                 156873             Date 18Mar99               *
      *                 158207 (BT0428)    Date 14Nov97               *
      *                 158544 (BT0478)    Date 19Nov97               *
      *                 158534 (BT0486)    Date 20Nov97               *
      *                 158046 (BT0506)    Date 10Apr98               *
      *                 158510 (098512)    Date 08Mar99               *
      *                 156135             Date 08Mar99               *
      *                 156048             Date 02Mar99               *
      *                 155610             Date 26Feb99               *
      *                 155570             Date 25Feb99               *
      *                 155568             Date 22Feb99               *
      *                 155462             Date 16Feb99               *
      *                 152227             Date 06Jan99               *
      *                 154799             Date 24Feb99               *
      *                 154576             Date 04Feb99               *
      *                 153663             Date 21Jan99               *
      *                 153357             Date 22Jan99               *
      *                 152669             Date 19Jan99               *
      *                 151295             Date 18Feb99               *
      *                 150496             Date 15Dec98               *
      *                 148845             Date 14Jan99               *
      *                 148730             Date 11Dec98               *
      *                 148720             Date 08Jan99               *
      *                 148591             Date 14Dec98               *
      *                 147518             Date 19Nov98               *
      *                 146683             Date 16Nov98               *
      *                 144251             Date 06Oct98               *
      *                 143802             Date 23Oct98               *
      *                 143795             Date 15Oct98               *
      *                 143132             Date 22Sep98               *
      *                 143071             Date 10Feb99               *
      *                 135152             Date 13May98               *
      *                 122461             Date 11Feb99               *
      *                 142078             Date 18Feb99               *
      *                 135152             Date 11Feb99               *
      *                 131253             Date 25May98               *
      *                 144915             Date 28Oct98               *
      *                 143510             Date 29Sep98               *
      *                 CEU004             Date 29Mar98               *
      *                 126017             Date 14Nov97               *
      *                 131415             Date 13Mar98               *
      *                 131414             Date 13Mar98               *
      *                 130173             Date 12Mar98               *
      *                 121768             Date 19Feb98               *
      *                 125974             Date 09Mar98               *
      *                 128147             Date 29Dec97               *
      *                 128094             Date 29Dec97               *
      *                 127722             Date 11Dec97               *
      *                 CLE007             Date 27Jun97               *
      *                 CLE005             Date 22May97               *
      *                 126274             Date 21Nov97               *
      *                 123857 (Re-open)   Date 04Nov97               *
      *                 123857             Date 24Oct97               *
      *                 124657             Date 21Oct97               *
      *                 123699 (Re-open)   Date 21Oct97               *
      *                 122685             Date 10Oct97               *
      *                 123998             Date 08Oct97               *
      *                 123699             Date 08Oct97               *
      *                 123856             Date 07Oct97               *
      *                 123801             Date 06Oct97               *
      *                 123789             Date 03Oct97               *
      *                 123873             Date 03Oct97               *
      *                 123177             Date 02Oct97               *
      *                 123533             Date 26Sep97               *
      *                 122960             Date 15Sep97               *
      *                 122874             Date 11SEP97               *
      *                 122601             Date 04SEP97               *
      *                 122109             Date 26AUG97               *
      *                 121783             Date 14AUG97               *
      *                 121123             Date 29JUL97               *
      *                 120468             Date 09JUL97               *
      *                 120002             Date 07JUL97               *
     F*                 119892             Date 30JUN97               *
      *                 119594             Date 20Jun97               *
      *                 115134             Date 27Feb97               *
     F*                 CLE003             Date 12Dec96               *
      *                 CLE004 *Create     Date 02Dec96               *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  MD023787 - Add parameter on AOOULAU0.                        *
      *  CSD095 - Allow Deal Sub-Type and Branch for MM and FX SSIs   *
      *           (Recompile)                                         *
      *  AR868380 - APISERVER on LCKW status. Return *RECLCK to       *
      *             calling program if file locking occurred on       *
      *             online position files. (Child: AR868381)          *
      *  AR830785 - Recompiled due to changes in core hook RULE78Z1.  *
      *             (Child: AR830786)                                 *
      *  AR806351 - Incorrect facility utilisation on OSFC. Prevent   *
      *             facility update of MR for interest and fee PDCL   *
      *             with FAMU = 'N'. (Child: AR806352)                *
      *  259991 - Our settlement account (OSAC) doesnt get written to *
      *           LOAMSDK for batch mode. Additional fix needed to    *
      *           cater for ten-digit account codes.                  *
      *  AR870590 - FOOB on LE0370AU due to trailer imbalance.        *
      *             For API, check file status of chain to LOAMSZ1    *
      *             and issue rollback when error occurred.           *
      *             (Child: AR870591)                                 *
      *  AR991073 - Several errors were shown, when a MR inserted via *
      *             LELAMR MQ API is enquired via MidasPlus screen.   *
      *             Amend program to write record in PF/CLOAMSQD when *
      *             transaction is processed thru API.                *
      *             (Child: AR991075)                                 *
      *  AR996895 - Incorrect accrual interest calculation.           *
      *             (Child:AR996897) (Recompile)                      *
      *  AR722359 - Record in LOAMSDK was not replicated in the global*
      *             layer. Initialise fields FRAM, FINT, FTXA, FTOT   *
      *             and FPEN to zeroes if not used. (Child: AR722360) *
      *  AR322732 - LEC0212A and APISERVER locks LTRIX file.          *
      *           - Prevent LTRIX RRN 1 from being locked.            *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR317587 - Matured Loan can't be recovered using maturity    *
      *             date as the value date of the manual repayment.   *
      *             Amended program to allow value date of MR greater *
      *             than Maturity date for past due loans. Applied fix*
      *             (Child: AR810533)                                 *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CLE143 - Original Loan Contract Date & Effective Interest    *
      *           Rate (Recompile)                                    *
      *  CLE139 - Lending Fee Capitalisation (Recompile)              *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  259328 - Distinguish a transaction error even when there is  *
      *           a separate warning error encountered during         *
      *           validation.                                         *
      *  262328 - Serious Midas error occurred. Increase size of @BCA *
      *           array from 150 to 900.                              *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  257477 - RONS not being updated correcly to LOAMSDK.         *
      *  257369 - Unnecesary check on LAMR                            *
      *  257098 - Wrong Settlement being processed                    *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  245082 - Loans with first and last day accrual should be     *
      *           treated as first day accruals until maturity        *
      *           date.  Then add one day on the maturity date.       *
      *           Applied fix 235784 from Release 4.                  *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  227710 - If F3 is pressed in the settlement programs, ensure *
      *           that all database changes are rolled back.          *
      *  CLE038 - Lending Enhancement for Nordea: Allocation by Amount*
      *  222410 - Generated REs were having tax field not set to 0.   *
      *           The sequence number for the generated RE was not    *
      *           correct as not checking key field in SRSNEQ.        *
      *           When checking if the record exists for a generated  *
      *           RE, should not be checking reci as numbers should   *
      *           be unique                                           *
      *  CLE036 - Lending Enhancements for Nordea Phase 1 Priority 2: *
      *           Allow repayments in facility currency.              *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *  CAS011 - EIR/AC Accounting Upgrade to MP1                    *
      *  CAS009 - Effective Interest Rate/Amortised Cost Accounting   *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter mismatch.                                 *
      *  219608 - The before versions of the settlement allocation    *
      *           flag and settlement currencies are not sent to      *
      *           online update program AOOULAU0.                     *
      *  CSF002 - Global layer.                                       *
      *           - Replace previous ZBACT* parameters with the new   *
      *             unique code.                                      *
      *  CAP075 - Lending API enhancements - Loan Amendment.          *
      *           (amendment in common with CAP079)                   *
      *  CAP074 - Lending API enhancements - Loans input.             *
      *  CAP073 - Lending API Enhancements - Facility Input(Recompile)*
      *  CDE005 - Reservation ID                                      *
      *  CLE029 - Addition of Severity code and Limit ID to FCLTYFM   *
      *  CLE034 - Lending Enhancements.                               *
      *         - (Revision) Don't default settlement instructions    *
      *           from loan if settlement alllocation flag = Y.       *
      *  217046 - Branch not passed to SD2410 if record is selected   *
      *           from subfile                                        *
      *  CLE033 - Settlement method 09                                *
      *  216067 - If batch mode do not cause d/b error when System    *
      *           Value LoanCustOriginPurch not present. Instead      *
      *           default to 'P' (purchased from customer)            *
      *  CLE031 - Lending Enhancements.                               *
      *  223935 - Divide by Zero Error                                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  CAS004 - Hedge Accounting Phase A (Recompile)                *
      *  210119 - Original Settlement Branch disappear using the input*
      *           screen option when enquiring, amending, reversing,  *
      *           and authorizing Manual Repayment instead of through *
      *           subfile selection.                                  *
      *  209161 - Locking error when authorizing transaction.         *
      *  209709 - System generated RE with a zero amount makes LE2120 *
      *           loop during authorisation. Automatically authorise  *
      *           all system generated REs. Ensure Auth. Status of an *
      *           RE is unaffected by amending the Manual Repayment.  *
      *  209709 - System generated RE with a zero amount makes LE2120 *
      *           loop during authorisation. Automatically authorise  *
      *           all system generated REs. Ensure Auth. Status of an *
      *           RE is unaffected by amending the Manual Repayment.  *
      *  207629 - Check System Value LoanCustOriginPurch to decide if *
      *           original borrower should be input as the customer of*
      *           a Part Purchased, instead of 'Purchased From' num.  *
      *  205964 - Ensure that no records will be generated in         *
      *           RSACMTPD when settlement details were not amended.  *
      *  206443 - Reverse part of fix 205535 - ensure that OAM of a   *
      *           revolving credit facility is updated correctly when *
      *           reactivating a loan with a negative MR.             *
      *  205703 - Ensure correct loan type used when inserting        *
      *           manual repayment.                                   *
      *  205504 - Generate correct projections when repayment type is *
      *           '3'.                                                *
      *  205258 - Incorrect value date in Projected Account Movements *
      *           for reactivated loans.                              *
      *         - Add DR entry on reactivation to balance the CR      *
      *           entry of the -MR.                                   *
      *  205535 - Update OAM,x of non-revolving facility for loan     *
      *           reactivation (-MR). Also, ensure that when -MR was  *
      *           reversed for a revolving credit facility, OAM will  *
      *           will not be doubled.                                *
      *  204708 - If loan is non-autosettle, update the availability  *
      *           beyond the loan's maturity date.                    *
      *  204452 - Recompiled due to changed PF/LEFEED.                *
      *  201672 - Calculate projected interest and principal on       *
      *           maturity.                                           *
      *  205002 - Incorrect update of CAMD when a -MR (for loan re-   *
      *           activation) was reversed.                           *
      *  CPK015 - Packaging changes:                                  *
      *           Ensure that message format in sync with file layout *
      *  CAP068 - Recompiled for changes to FCLTYFM and FCLTYFN.      *
      *  CLE023 - Lending Facility History Improvements               *
      *  202068 - Wrong currency details being retrieve for Credit    *
      *           Agreement Facility.  Use field FCCYF instead of     *
      *           FCCY.                                               *
      *  CSC011 - Midas 24x7 availability                             *
      *  194632 - Next Repayment Date calculated considers the        *
      *           holiday even the payment due date indicator is      *
      *           'A' (ACTUAL DATE).                                  *
      *  CAP063 - Lending API enhancements - Manual Repayment         *
      *  192949 - Locking problem with file FCLTY in subroutine       *
      *           SRWARN.                                             *
      *  186431 - Added processing to handle LTRIX record locks.      *
      *  186752 - LEV1042 should be displayed as an error message.    *
      *           Also, the reactivation flag should not be switched  *
      *           off if there is still a -ve MR other than the one   *
      *           being reversed.                                     *
      *  177972 - Past due withholding tax are not settled though a   *
      *           manual repayment has been inserted.                 *
      *  184384 - Fields from LOAMD not being cleared when entering   *
      *           the 2nd 'MR' input without exiting the program.     *
      *  194509 - Amended Transactions go to Re-auth and then complete*
      *  CLE014 - Customer Driven Lending Enhancements                *
      *  193064 - Expected value date and expected sequence no.       *
      *           should not be validated if the transaction is sent  *
      *           from Loan Manager.                                  *
      *  183958 - Forward-date manual repayment rejected. Interest    *
      *           amount entry exceeds the current outstanding        *
      *           interest amount.                                    *
      *  CSD006 - Use long DS with SDBSRTPD.                          *
      *  186072 - Program does not properly indicate chain failure on *
      *           Loan Amendments File on the second entry.  Entry of *
      *           an incorrect value date, sequence and loan ref. no. *
      *           combination was not properly validated.             *
      *  184689 - Ensure that a transaction reference is passed to    *
      *           SHLNRF field which is used by access objects in     *
      *           writing a record to RSACMTPD.                       *
      *  186834 - Database error in AOSPOSU0 when settlement currency *
      *           is used.  Properly set-up the settlement currency   *
      *           before calling access objects.                      *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
      *  CRT004 - Cashier Midas TCP/IP interface.                     *
      *             Recompiled over SDBRCHPD Changes                  *
      *  175450 - Shadow files should not be updated for Risk Loan.   *
      *  CIR004 - Dealing Calculation Method Change.                  *
      *         - Recompiled due to GLINTC and ZINTDY changes         *
      *  178782 - Enable input of Manual Repayment of Discount loan,  *
      *           if loan is past due. Correction to program logic.   *
      *  CDE001 - Data Export - CCRM Limits                           *
      *  170120 - 'F12' is not going to previous (detail) screen. It  *
      *           'Enters' the transaction.                           *
      *  165031 - For Participation Sold Loan.                        *
      *           Settlement Instruction on receipt side has a value  *
      *           when it should be blank.  These are not present     *
      *           when message was sent from Loan Manager.            *
      *  163937 - Normal repayments (i.e. not assignments) should not *
      *           update available if the facility is non-revolving   *
      *  CLE009 - LE I/C Swift Message Generation for Fees            *
      *  155099 - Past Due Interest (PDIN) is not updated on the      *
      *           loan when a repayment is entered against a PD.      *
      *  161262 - Assignment must reduce the OAM values even for      *
      *           non-revolving credit facilities.                    *
      *  161072 - Manual Repayment of interest expected against       *
      *           LN is rejected                                      *
      *  157744 - Calculate expected penalty amt, if any, for display *
      *  159256 - Send interactive warning message if syndicated      *
      *           loan is amended via Midas.                          *
      *  159257 - Display warning message if user attempts manual     *
      *           payment without entering expected details when a    *
      *           past due amount exists on loan amendments file.     *
      *  158802 - Amend last change type when AOOULAU0 is called      *
      *  156969 - Availability wrong on IPP after assignment.         *
      *  158148 - Wrong value moved to facility branch code (FCLB)    *
      *  152678 - Pay/receive indicator on ltrix is only updated      *
      *           for payment instructions.                           *
      *  154092 - 'Generated by Assignment' flag is not set.          *
      *  156873 - Manual repayments input, subfile shows strange      *
      *           currency codes.                                     *
      *  BD5278 - There needs to be a separate standard settlement    *
      *           instruction transaction type for Lending - use of   *
      *  158207 - F12 from SD2400 updating directly on authorise
      *         - must go back to main screen first
      *  158544 - D/B error 13 when repayment input against a loan    *
      *           whose facility is expired (RECI confusion)          *
      *  158534 - Subfile should show original borrower for parts.
      *           purchased
      *  158046 - All transactions input through Midas must have      *
      *           a full PC reference                                 *
      *  158510 - FOB in LE0320                                       *
      *  156135 - Reversed a manual repayment but past due is lost.   *
      *  156048 - Considered 'PI' and 'PT' on the validation of the   *
      *           entered principal amount.                           *
      *  155610 - Authorisation processing incorrect if CLE002 is     *
      *           off as manual ICD flags are still on.               *
      *  155570 - Conditioning incorrect for update of ltrix.         *
      *  155568 - With participation sold, only pay side of the ins - *
      *           tructions should show for the settlement.           *
      *  154799 - Recompiled due to changes in /COPY,ZACCH            *
      *  155462 - Backvalued MR not allowed eventhough multi-ccy      *
      *           has not occurred yet.                               *
      *  152227 - Database error 21, (file sdcurrpd blank key)        *
      *           occurs. Emu change to facility file conflicts       *
      *           with display file.(Fixed by CEU004)                 *
      *  154576 - LE0320, File out of Balance when entering past      *
      *           due settlements                                     *
      *  153663 - Automatic unlinking no longer required.             *
      *  153357 - Manual repayment input should be allowed in a       *
      *           matured loan where its facility is closed or expired*
      *           provided, there has been an 'FR' amendment type     *
      *           entered against the facility.                       *
      *  152669 - Principal transfer amount was not considered in the *
      *           validation of the manual repayment principal.       *
      *  151295 - Problems authorising repayment schedules            *
      *           Recompiled due to changes in ZCHKH                  *
      *  150496 - Negative manual repayment rejected by Midas         *
      *  148845 - Manual repayments that does not allow risk          *
      *           participation sold                                  *
      *  148730 - Reversal of manual repayment causes the payment our *
      *           nostro to be blank                                  *
      *  148720 - Settlement details, crucial to pay/receives, are    *
      *           blanked out on reversal when user does not view     *
      *           settlement details. Further to 148730.              *
      *  148591 - Shadow postings for Manual Repayments do not include*
      *           interest and penalties.                             *
      *  147518 - Availability wrong after assignment.                *
      *  146683 - Reactivation of loan with +ve manual repayment      *
      *           should not be allowed.                              *
      *  144251 - Program incorrectly looks for participant facility  *
      *           when lpfi is 'R'; causes db error 24.               *
      *  143802 - Total Part Sold Amount on main loan reduced when    *
      *           Manual Repayment is processed which is an Assignment*
      *  143795 - Should be able to close a facility after the loan   *
      *           has matured                                         *
      *  143132 - DB error occurred when reversing a Manual Repayment *
      *  143071 - The Std settlement instructions for a participation *
      *           purchased should default from the original borrower.*
      *  135152 - There needs to be a separate standard settlement    *
      *           instruction transaction type for Lending - use of   *
      *           'MM' is not sufficiently flexible                   *
      *  122461 - Correct the setting of 'manual/system generated'    *
      *           flag. Where the transaction is from loan manager,   *
      *           (but not the first message in the unit of work),    *
      *           set to 'S'; otherwise set to 'M'.                   *
      *  142078 - Manual Repayment settlement instruction should      *
      *           default to the Std. settlement instruction first,   *
      *           then to loan.                                       *
      *  135152 - There needs to be a separate standard settlement    *
      *           instruction transaction type for Lending - use of   *
      *           'MM' is not sufficiently flexible                   *
      *  131253 - Accept amendment when CLE005 is *ON and RATF in     *
      *           CLOANCL is 'Y' even if RECI is 'M'.                 *
      *  144915 - Recompiled due to changes in LF/CLOAN.              *
      *  143510 - Shows extra one day in interest amount computation. *
      *           Applied fix 065277 to ignore First Day Accrual ind. *
      *  CEU004 - LE Settlement Ccy Conversion Upgrade to DBA R2.0    *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC. Add SR/ZDAT10                 *
      *  131415 - PD/RE record is flagged as insert                   *
      *  131414 - OOB when reversing a PD record, or inserting a      *
      *           matched to CLOAN                                    *
      *  130173 - If LTRIX is full for batch mode the program does not*
      *           processs the PC messages correctly. This should be  *
      *           treated as a DB error.                              *
      *  121768 - Recompile over changed GLINTCZ1                     *
      *  125974 - When the ICD authorisation field is 'N' you should  *
      *           still be able to see authorised loan amendments.    *
      *  128147 - SRVAL1 is being called on authorise (per 123857     *
      *           spec.) - however, we must not validate amounts as   *
      *           they are already included on LOAMSDK                *
      *  128094 - Add Input Cycle Pay / Receive functionality         *
      *  127722 - Wrong update of trailer when related to 'PD'        *
      *  CLE007 - Customer Lending Enhancements - Others T3)          *
      *  CLE005 - Customer Lending Enhancements - Tranche 3           *
      *  126274 - The subfile review screen should show the customer  *
      *           short name.                                         *
      *  123857 - Additional authorisation option, to use F11 or go   *
      *           through all screens and pressing ENTER on the last  *
      *           screen.                                             *
      *  124657 - When manual repayments are not to be authorised,    *
      *           should auto-authorise it upon entry                 *
      *  123699 - Settlement account not set up correctly             *
      *  122685 - Incorrect update of facility availability amount    *
      *  123998 - Texts should be coming from message subfile         *
      *  123856 - MR or RE not accepted if loan is auto-settled       *
      *  123801 - Return exact settlement detail error in batch mode  *
      *  123789 - File out of balance                                 *
      *  123873 - Set manual/system generated flag to S only in batch *
      *  123177 - Unlink from a syndicate only when linked            *
      *  123533 - Loan amend seq number not returned in batch mode.   *
      *  122960 - Use first parameter of positions update program     *
      *           to suppress rollback in batch mode.                 *
      *  122874 - Outstanding interest on screen is calculated        *
      *           as double the amount.                               *
      *           Principal amount on repayment schedule may be in    *
      *           facility currency and may need converting.          *
      *  122601 - Manual repayment does not update projected account  *
      *           movements.                                          *
      *  122109 - PC transaction ref is not set in interactive mode   *
      *           due to confusion with 'if..' construct.             *
      *  121783 - Call new access object AOBRCHR1 instead of AOBRCHR0 *
      *           (uses the long data structure DSSDY)                *
      *  121123 - Special Instructions not required.                  *
      *  120468 - Include a DUMP in ZASNMS subroutine for Batch and   *
      *           Play modes.                                         *
      *  120002 - If processing in batch mode, then status of         *
      *           transaction should always be set to 'A'.            *
      *         - Number of items in batch on return message is       *
      *           corrupted.                                          *
      *         - program perform COMIT operation while in batch mode *
      *  119892 - Rename SPARE to SPARF                               *
      *  119594 - SD2400 should not be called when running in         *
      *           Batch or Play mode.                                 *
      *  115134 - Backvaluation to Start Date must be allowed when    *
      *            CLE003 active.                                     *
      *  CLE003 - Backvaluation in Customer Lending Enhancements      *
      *  CLE004 - Customer Lending Enhancements - Syndications        *
      *                                                               *
      *****************************************************************
      *
     FLE2110DFCF  E                    WORKSTN                        UC
     F                                        SRRN  KSFILE LE2110S0
      ** Manual Repayment Input Display File
      *
     FLE2110PDUF  E                    DISK         KINFSR *PSSR A    UC
      ** Manual Repayment Record File
      *
     FLOAMD   IF  E           K        DISK
     F            LOAMSDKF                          KRENAMELOAMDF
     F            LOAMSDHF                          KIGNORE
     F            LOAMSZ1F                          KIGNORE
      ** Loan Amendments Retrieval Index
      *
     FLMANP   IF  E           K        DISK         KINFSR *PSSR
     F            LOAMSDKF                          KRENAMELELMANPF
     FLOAMS   UF  E           K        DISK         KINFSR *PSSR A
     F                                              KCOMIT
      ** Loan Amendments for Updating
      *
     FCLOAN   UF  E           K        DISK         KINFSR *PSSR
     F                                              KCOMIT
     F            CLOANHHF                          KIGNORE
     F            CLOANZ1F                          KIGNORE
     FLELOAML0IF  E           K        DISK         KINFSR *PSSR
     F            LOAMSDKF                          KRENAMELELOAM0F
      ** Live Loan Amendment Details
      *
     FLELOAML1IF  E           K        DISK         KINFSR *PSSR
     F            LOAMSDKF                          KRENAMELELOAM1F
      ** Loan Amendments Requiring Authorisation
      *
     FLELOAML6IF  E           K        DISK         KINFSR *PSSR          159257
     F            LOAMSDKF                          KRENAMELOAML6         159257
      ** Loan Amendments Requiring Authorisation                          159257
      *                                                                   159257
     FLEFCAML3IF  E           K        DISK         KINFSR *PSSR          150496
      ** Facility Amendment Retrieval Index                               150496
      *                                                                   150496
     FFCLTY   UF  E           K        DISK         KINFSR *PSSR
     F                                              KCOMIT
     F            FCLTYHHF                          KIGNORE
     F            FCLTYZZF                          KIGNORE
      ** Customer Lending Facility file
      *
     FSDBRCHL5IF  E           K        DISK         KINFSR *PSSR
      ** SD Branch Codes by Customer Number
     F***LTRIX***UF  F      43            DISK         KINFSR *PSSR                  128094 AR322732
     FLTRIX   O   F      45            DISK         KINFSR *PSSR A                          AR322732
     F                                              KCOMIT                128094
     F                                              KINFDS FLDTX          186431
      *
     FLEFEEDL1UF  E           K        DISK         KINFSR *PSSR          CLE009
     F                                              KCOMIT                CLE009
      *                                                                   CLE009
     FLEFELAL0UF  E           K        DISK         KINFSR *PSSR A        CLE009
     F                                              KCOMIT                CLE009
     F/COPY WNCPYSRC,LEH00584
      *                                                                   CAP063
     FLEIMRPPDO   E                    DISK         KINFSR *PSSR      UC  CAP063
     F                                              KCOMIT                CAP063
      *                                                                   CAP063
     FLEIMRPL1IF  E           K        DISK         KINFSR *PSSR      UC  CAP063
     F            LEIMRPD0                          KRENAMELEIMRPD1       CAP063
      *                                                                   CAP063
     FLEIMRPL2IF  E           K        DISK         KINFSR *PSSR      UC  CAP063
     F            LEIMRPD0                          KRENAMELEIMRPD2       CAP063
      *                                                                   CAP063
     FLEIMRPLXUF  E           K        DISK         KINFSR *PSSR      UC  CAP063
     F            LEIMRPD0                          KRENAMELEIMRPDL       CAP063
     F                                              KCOMIT                CAP063
      *                                                                   CSC011
      **  24/7 Midas Availability log file                                CSC011
     FAPILOGL0UF  E           K        DISK                           UC  CSC011
     F            APILOGD0                          KRENAMEAPILOGX0       CSC011
     FAPVLOGPDO   E                    DISK                           UC  CSC011
     F                                              KCOMIT                CSC011
     FAPILOGPDO   E                    DISK                           UC  CSC011
     F                                              KCOMIT                CSC011
      **  Compliance Watch Hit List File                                                      CSD015
     FSDCWHTL1IF  E           K        DISK                                                   CSD015
      *                                                                                       CSD015
     FLEEIRDL5UF  E           K        DISK                                                   CAS009
     F                                              KCOMIT                                    CAS009
     FCLOAMSQDO   E                    DISK         KCOMIT                                  AR991073
      *                                                                                     AR991073
     F/COPY WNCPYSRC,LE2110F001
      /SPACE 3
      *****************************************************************
      *                                                               *
      *    F U N C T I O N   O F   I N D I C A T O R S                *
      *                                                               *
      *       06      Chain for SDCWHTL1                              *                       CSD015
      *       07      Prohibit entry to 'Interest' field              *                       CLE028
      *       08      Hide 'Interest Refunded'                        *                       CLE028
      *       09      Hide 'Charges Refunded'                         *                       CLE028
      *       10      Settlement details amended.                     *                       205964
      *       12      LOKUP currency array                            *   CLE009
      *       13      CHAIN to LEFELAL0                               *   CLE009
      *       14      READE to LEFEEDL1                               *   CLE009
      *       14      Facility Currency Repayments allowed. (Reused)  *                       CLE036
      *       15      READE to LEFCAML3                               *                       CLE036
      *       15      Repayment currency invalid. (Reused).           *                       CLE036
      *       16      Only one page of subfile records are shown      *
      *       17      Non-display Past Due Y/N indicator              *
      *       18      Highlight receive date for warning error        *
      *       19      Non-display Review from Loan no.                *
      *       20      SFLNXTCHG                                       *
      *       21      SFLNXTCHG                                       *
      *       22      SFLDSPCTL                                       *
      *       23      SFLDSP                                          *
      *       24      ND Seq. no. of value date & F14 Settlt on insert*
      *       25      Repayment is in Facility Currency.              *                       CLE036
      *       26      F10 Delete.                                     *                       CLE036
      *       27      Protect Write-off                               *
      *       28      F14 Settlement                                  *
      *       29      Interest sign invalid                           *
      *       30      Protect for settlement branch                   *
      *       31      Protect for amend and initial screen            *
      *       32      Protect for enquiry and initial screen          *
      *       33      F09 INSERT                                      *
      *       34      F10 DELETE                                      *
      *       35      F11 AUTHORISE                                   *
      *       36      READC on Subfile; no record found               *
      *       37      Second CHAIN to LELOAML0 or LELOAML1            *
      *       38      Initial CHAIN to LELOAML0 or LELOAML1           *
      *       39      CHAIN LELOAML0 for validation of Loan Ref.      *
      *       40      Work indicator                                  *
      *       41      Work indicator                                  *
      *       42      Work indicator                                  *
      *       43      Work indicator                                  *
      *       44      Expected Sequence no. is LN                     *
      *       45      F11 is not needed for authorisation             *   123857
      *       46      Authorisation is needed                         *
      *       47      Unmatched                                       *
      *       49      Error on Subfile selection field                *
      *       50      CHAIN to LOAMS; no record found                 *
      *       51      Work indicator                                  *
      *       52      Processing Type = '66' or '67'                  *
      *       53      Processing Type = '64' or '65'                  *
      *       54      Non-display expected principal                  *
      *       55      Non-display expected interest and W/Tax         *
      *       56      Non-display expected total                      *
      *       57      Non-display Write-off                           *
      *       58      Non-display  Seq. No. last allocated            *
      *       59      Non-display expected penalty                    *
      *       60      No Witholding Tax                               *
      *       61      Gross Witholding Tax                            *
      *       62      Receivable Witholding Tax                       *
      *       63      Processing type of loan is 70                   *
      *       64      Rollup key pressed                              *
      *       65      Display Header/Footer for Mode 'F'              *   CAP063
      *       66      READ LE2110PD; EOF                              *
      *       67      Action code invalid                             *
      *       68      Loan Ref. invalid                               *
      *       69      Value date invalid                              *
      *       70      Expected Value date is invalid                  *
      *       71      Sequence no. is invalid                         *
      *       72      Expected Seq. no. is invalid                    *
      *       73      Error on Review from loan no. field             *
      *       74      Error on Review from Authorised field           *
      *       75      Customer number blank / invalid                 *
      *       76      Past Due indicator invalid                      *
      *       77      Principal invalid                               *
      *       78      Principal Sign invalid                          *
      *       79      Interest invalid                                *
      *       80      Chain to CLOAN to reduce part sold              *   143802
      *       81      Penalty invalid                                 *
      *       82      Penalty sign invalid                            *
      *       83      Total invalid                                   *
      *       84      Total sign invalid                              *
      *       85      Write-off invalid                               *
      *       86      ICD: Authorisation of Manual Repayment req'd    *
      *       87      CLE003 Backvaluations feature installed         *
      *       88      CLE004 Syndications installed                   *
      *       89      CLE005 LE Other feature installed               *
      *                                                               *
      *****************************************************************
      /EJECT
      *                                                                                       CSD015
     E                    CWA     1  26 25                                                    CSD015
      ** Array used in Midas Compliance Watch                                                 CSD015
      *                                                                                       CSD015
     E                    CPY@    1   1 80
      *
      ** Array containing Copyright statement
      *
     E***********         WSTAT   1   4 20                                123998
      *
      ***Array*containing*Amendment*Status********************************123998
      *
     E***********         TABSLD  2   2  2 0                              CLE005
     E                    TABSLD  4   4  2 0                              CLE005
      *
      ** Array containing Parts Sold Processing Types
      *
     E***********         TABTYP  2   4  2 0                              CLE005
     E***********         TABTYP  2   6  2 0                       CLE005 148845
     E**********          TABTYP  2   8  2 0                                           148845 CLE028
     E                    TABTYP  2   9  2 0                                                  CLE028
      *
      ** Array for processing type
      *
     E                    TABDIS  3   3  2 0
      *
      ** Array for Discount Processing types
      *
     E**********          POWR    1   7  7 3             POWER OF TEN                         CLE023
     E                    POWER   1   7  7 3             POWER OF TEN                         CLE023
     E                    OAM        10 13 0             FACILITY AMOUNTS
     E**********          @BCA      150  6 0                                                  CSD027
     E**********          @BCA      150  6                                             CSD027 262328
     E                    @BCA      900  6                                                    262328
     E                    RUNS       10  5 0A            FACILITY DATES
      *
     E                    CYA       150  3                                CLE009
      ** Currencies array                                                 CLE009
     E                    TND       150  1 0                              CLE009
      ** Telex Notice Days array                                          CLE009
      *                                                                   CLE009
     E                    NDP       150  1 0                                                  CLE036
      ** No of Decimal Places array                                                           CLE036
      *                                                                                       CLE036
     E                    ACY        20  3                                                    CLE034
      ** Locations array                                                                      CLE034
      *                                                                                       CLE034
     E                    ALC        20  3                                                    CLE034
      ** Locations array                                                                      CLE034
      *                                                                                       CLE034
     E/COPY ZSRSRC,ZALIGNZ1
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZFRPEDZ1
     E/COPY ZSRSRC,ZFREQBZ1
     E/COPY ZSRSRC,ZDATE9Z1
     E/COPY ZSRSRC,ZHOLE
     E/COPY ZSRSRC,ZF2CE                                                  128094
      *
      ** Edit Amount
     E/COPY WNCPYSRC,LE2110E001
      *                                                                                       CSD015
     E                    WLF        12 35                                                    CSD015
      **  Watch List Fields Array.                                                            CSD015
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *
      ** Rename fields of CLOANCL file
      *
     ICLOANCLF
     I              RECI                            RECIL                 131253
     I              CNUM                            CNUML
     I              LTYP                            LTYPL                                     205258
     I              SUTP                            SUTPL                                     CLE036
     I              REPT                            REPTL
     I              PTYP                            PTYPL
     I              AUTO                            AUTOL
     I              CCY                             CCYL
     I              FCCY                            FCCYL                                     CLE036
     I              RDFC                            RDFCL
     I              INTC                            INTCL
     I              WTIN                            WTINL
     I              PDDI                            PDDIL                                     194632
     I              TMST                            PTMST                                     CAP074
      *
      ** Extended settlements
      *
     I              RSTM                            RSTML
     I              RONS                            RONSL
     I              RIBN                            RIBNL
     I              RIBA                            RIBAL
     I              ROBN                            ROBNL
     I              ROCN                            ROCNL
     I              PSTM                            PSTML
     I              PONS                            PONSL
     I              PIBN                            PIBNL
     I              PIBA                            PIBAL
     I              POBN                            POBNL
     I              POCN                            POCNL
     I              RCRN                            RCRNL
     I              RCRA                            RCRAL
     I              RVNO                            RVNOL
     I              AWBN                            AWBNL
     I              AWBA                            AWBAL
     I              BENN                            BENNL
     I              BENA                            BENAL
     I              DTP1                            DTP1L
     I              DTP2                            DTP2L
     I              DTP3                            DTP3L
     I              DTP4                            DTP4L
     I              DCHG                            DCHGL
     I              BTB1                            BTB1L
     I              BTB2                            BTB2L
     I              BTB3                            BTB3L
     I              BTB4                            BTB4L
     I              BTB5                            BTB5L
     I              BTB6                            BTB6L
     I              CVMR                            CVMRL
     I              SCCY                            SCCYL                 CEU004
     I              ICCY                            ICCYL                 CEU004
     I              GASS                            GASSL                 156969
     I              OMDA                            OMDAL                                     CGL029
      *
      ** Rename fields of CLOANCK file
      *
     ICLOANCKF
     I              NLRA                            WNLRA
     I              TMST                            TMSTW                                     CAP074
     ILOAMSDKF
     I              PCRF                            PCRFK
     I              PCOB                            PCOBK
     I              SCCY                            SCCYK                 CEU004
     I              PSCY                            PSCYK                                     CLE031
     I              REXR                            REXRK                                     CLE031
     I              PEXR                            PEXRK                                     CLE031
     I              REXI                            REXIK                                     CLE031
     I              PEXI                            PEXIK                                     CLE031
     I              STAL                            STALK                                     CLE034
     I              TMST                            TMSTK                                     CAP075
     I              OSAC                            OSACK                                     CGL029
      *                                                                   CEU004
      ** Rename fields of LE2110PD file                                   CEU004
      *                                                                   CEU004
     ILE2110D0                                                            CEU004
     I              SCCY                            SCCYK                 CEU004
     I              PSCY                            PSCYK                                     CLE031
     I              REXR                            REXRA                                     CLE031
     I              PEXR                            PEXRA                                     CLE031
     I              REXI                            REXIA                                     CLE031
     I              PEXI                            PEXIA                                     CLE031
     I              TMST                            L2TMST                                    CLE031
      *
      ** Rename fields of LMANP file
      *
     ILELMANPF
     I              RECI                            RECIMP
     I              LNRF                            LNRFMP
     I              VDAT                            VDATMP
     I              AMTP                            AMTPMP
     I              CCY                             CCYMP                 122874
     I              PRAM                            PRAMMP
     I              INTA                            INTAMP
     I              TAMT                            TANTMP
     I              XAVD                            XAVDMP
     I              XASQ                            XASQMP
     I              AUTO                            AUTOMP
     I              SETP                            SETPMP
     I              OSAC                            OSACMP
     I              TSEN                            TSENMP
     I              FACO                            FACOMP
     I              STAL                            STALMP                                    CLE034
     I              TMST                            TMSTPP                                    CAP075
      *
      ** Extended settlements
      *
     I              RSTM                            RSTMMP
     I              RONS                            RONSMP
     I              RIBN                            RIBNMP
     I              RIBA                            RIBAMP
     I              ROBN                            ROBNMP
     I              ROCN                            ROCNMP
     I              PSTM                            PSTMMP
     I              PONS                            PONSMP
     I              PIBN                            PIBNMP
     I              PIBA                            PIBAMP
     I              POBN                            POBNMP
     I              POCN                            POCNMP
     I              RCRN                            RCRNMP
     I              RCRA                            RCRAMP
     I              RVNO                            RVNOMP
     I              AWBN                            AWBNMP
     I              AWBA                            AWBAMP
     I              BENN                            BENNMP
     I              BENA                            BENAMP
     I              DTP1                            DTP1MP
     I              DTP2                            DTP2MP
     I              DTP3                            DTP3MP
     I              DTP4                            DTP4MP
     I              DCHG                            DCHGMP
     I              BTB1                            BTB1MP
     I              BTB2                            BTB2MP
     I              BTB3                            BTB3MP
     I              BTB4                            BTB4MP
     I              BTB5                            BTB5MP
     I              BTB6                            BTB6MP
     I              CVMR                            CVMRMP
     I              SCCY                            SCCYL                 CEU004
     I              ICCY                            ICCYL                 CEU004
      *
     ILOAMDF
     I              RECI                            RECIA
     I              LNRF                            LNRFA
     I              VDAT                            VDATA
     I              LASN                            LASNA
     I              LTYP                            LTYPA                 158148
     I              SUTP                            SUTPA                 158148
     I              AMTP                            AMTPA
     I              PTYP                            PTYPA
     I              INTA                            INTAA
     I              PRAM                            PRAMA
     I              TAMT                            TAMTA
     I              WTXA                            WTXAA
     I              PNAM                            PNAMA
     I              AUTO                            AUTOA
     I              SETP                            SETPAA
     I              OSAC                            OSACA
     I              TSEN                            TSENA
     I              FACO                            FACOA
     I              XAVD                            XAVDA
     I              XASQ                            XASQA
     I              ASTS                            ASTSA
     I              IUSR                            IUSRA
     I              AUSR                            AUSRA
     I              FCUS                            FCUSA
     I              FTYP                            FTYPA
     I              FSEQ                            FSEQA
     I              FCLB                            FCLBA                 158148
     I              CCY                             CCYA                                      CLE036
     I              FRCY                            FRCYA                                     CLE036
     I              FRAM                            FRAMA                                     CLE036
     I              FINT                            FINTA                                     CLE036
     I              FTOT                            FTOTA                                     CLE036
     I              FTXA                            FTXAA                                     CLE036
     I              FPEN                            FPENA                                     CLE036
      *
      ** Extended settlements
      *
     I              RSTM                            RSTMA
     I              RONS                            RONSA
     I              RIBN                            RIBNA
     I              RIBA                            RIBAA
     I              ROBN                            ROBNA
     I              ROCN                            ROCNA
     I              PSTM                            PSTMA
     I              PONS                            PONSA
     I              PIBN                            PIBNA
     I              PIBA                            PIBAA
     I              POBN                            POBNA
     I              POCN                            POCNA
     I              RCRN                            RCRNA
     I              RCRA                            RCRAA
     I              RVNO                            RVNOA
     I              AWBN                            AWBNA
     I              AWBA                            AWBAA
     I              BENN                            BENNA
     I              BENA                            BENAA
     I              DTP1                            DTP1A
     I              DTP2                            DTP2A
     I              DTP3                            DTP3A
     I              DTP4                            DTP4A
     I              DCHG                            DCHGA
     I              BTB1                            BTB1A
     I              BTB2                            BTB2A
     I              BTB3                            BTB3A
     I              BTB4                            BTB4A
     I              BTB5                            BTB5A
     I              BTB6                            BTB6A
     I              CVMR                            CVMRA
     I              PAST                            PASTA                 186752
     I              SCCY                            SCCYL                 CEU004
     I              ICCY                            ICCYL                 CEU004
      *
     ILELOAM0F
      ** Rename fields for subfile use
     I              LNRF                            FLNRF
     I              CNUM                            FCNUM
     I              LASN                            FLASN
     I              PTYP                            FPTYP
     I              VDAT                            FVDAT
     I              AMTP                            FAMTP
     I              CCY                             FCCY
     I              PRAM                            FPRAM
     I              ASTS                            FASTS
     I              SETP                            FSETP
     I              OSAC                            FOSAC
     I              TSEN                            FTSEN
     I              FACO                            FFACO
     I              TMST                            FTMST                 CAP075
      *
     ILELOAM1F
      ** Rename fields for subfile use
     I              LNRF                            FLNRF
     I              CNUM                            FCNUM
     I              LASN                            FLASN
     I              PTYP                            FPTYP
     I              VDAT                            FVDAT
     I              AMTP                            FAMTP
     I              CCY                             FCCY
     I              PRAM                            FPRAM
     I              ASTS                            FASTS
     I              SETP                            FSETP
     I              OSAC                            FOSAC
     I              TSEN                            FTSEN
     I              FACO                            FFACO
     I              TMST                            GTMST                 CAP075
      *
     IFCLTYFMF
      ** Rename fields
     I              RECI                            RECIF
     I              CNUM                            CNUMF
     I              FACT                            FACTF
     I              FCNO                            FCNOF
     I              RCTP                            RCTPF
     I              BRCA                            BRCDF
     I              FCTI                            FCTIF
     I              FCCY                            FCCYF
     I              FAMT                            FAMTF
     I              OVPC                            OVPCF
     I              DTAP                            DTAPF
     I              DTEX                            DTEXF
     I              RVCR                            RVCRF
     I              SECI                            SECIF
     I              MCCY                            MCCYF
     I              MCSI                            MCSIF
     I              NACD                            NACDF
     I              CRSK                            CRSKF
     I              DLFS                            DLFSF
     I              NOMR                            NOMRF
     I              RVDT                            RVDTF
     I              RVFR                            RVFRF
     I              RVDY                            RVDYF
     I              NAR1                            NAR1F
     I              NAR2                            NAR2F
     I              NAR3                            NAR3F
     I              NAR4                            NAR4F
     I              MTDH                            MTDHF
     I              MTDL                            MTDLF
     I              MTDA                            MTDAF
     I              QTDA                            QTDAF
     I              YTDA                            YTDAF
     I              ACOF                            ACOFF
     I              ORED                            OREDF
     I              LCD                             LCDF
     I              CHTP                            CHTPF
     I              TNLU                            TNLUF
     I              RCSI                            RCSIF                 122685
     I              SCCY                            SCCYL                 CEU004
     I              ICCY                            ICCYL                 CEU004
      *                                                                   165031
      ** Extended settlements                                             165031
      *                                                                   165031
     I              OMDB                            OMDBF                                     210119
     I              RSTM                            RSTMF                 165031
     I              RONS                            RONSF                 165031
     I              RIBN                            RIBNF                 165031
     I              RIBA                            RIBAF                 165031
     I              ROBN                            ROBNF                 165031
     I              ROCN                            ROCNF                 165031
     I              PSTM                            PSTMF                 165031
     I              PONS                            PONSF                 165031
     I              PIBN                            PIBNF                 165031
     I              PIBA                            PIBAF                 165031
     I              POBN                            POBNF                 165031
     I              POCN                            POCNF                 165031
     I              RCRN                            RCRNF                 165031
     I              RCRA                            RCRAF                 165031
     I              RVNO                            RVNOF                 165031
     I              AWBN                            AWBNF                 165031
     I              AWBA                            AWBAF                 165031
     I              BENN                            BENNF                 165031
     I              BENA                            BENAF                 165031
     I              DTP1                            DTP1F                 165031
     I              DTP2                            DTP2F                 165031
     I              DTP3                            DTP3F                 165031
     I              DTP4                            DTP4F                 165031
     I              DCHG                            DCHGF                 165031
     I              BTB1                            BTB1F                 165031
     I              BTB2                            BTB2F                 165031
     I              BTB3                            BTB3F                 165031
     I              BTB4                            BTB4F                 165031
     I              BTB5                            BTB5F                 165031
     I              BTB6                            BTB6F                 165031
     I              CVMR                            CVMRF                 165031
      *                                                                   150496
     ILEFCAMPF                                                            150496
      ** Rename fields                                                    150496
     I              RECI                            RECIC                 150496
     I              VLDT                            VLDTC                 150496
     I              RVCR                            RVCRC                 150496
     I              NDEX                            NDEXC                 150496
     I              ASTS                            ASTSC                 150496
     I              IUSR                            IUSRC                 150496
     I              AUSR                            AUSRC                 150496
     I              XUSR                            XUSRC                 150496
     I              ORED                            OREDC                 150496
     I              TLCD                            TLCDC                 150496
     I              CHTP                            CHTPC                 150496
     I              PCRF                            PCRFC                 150496
     I              PCOB                            PCOBC                 150496
      *                                                                   CAP075
     ILOAML6                                                              CAP075
      ** Rename fields                                                    CAP075
     I              TMST                            HTMST                 CAP075
     I              OSAC                            HOSAC                                     CGL029
      *
     I@BRCHFM
      * FORMAT OF SDBRCHL5
     I              A8BICN                          BICN
     I/COPY WNCPYSRC,LE2110I002
      *                                                                   128094
      ** LTRIX HEADER                                                     128094
      *                                                                   128094
     I*LTRIX***NS       1 CH                                                         128094 AR322732
     I**********                              1   1 RECI                             128094 AR322732
     I**********                              2   2 RCDT                             128094 AR322732
     I**********                              3   80LNRF                             128094 AR322732
     I**********                          P   9  110NORES                            128094 AR322732
     I**********                          P  12  140FLSZ                             128094 AR322732
     I**********                          P  15  170RRLC                             128094 AR322732
     I**********                          P  18  200RRNA                             128094 AR322732
     I**********                          P  21  230RRLX                             128094 AR322732
     I**********                          P  24  260RRXP                             128094 AR322732
     I**********                          P  27  290NLNR                             128094 AR322732
     I**********                          P  30  320NLAR                             128094 AR322732
     I**********                             33  330STPI                             128094 AR322732
     I**********                          P  38  400TNLU                             128094 AR322732
      *                                                                   128094
      **   LTRIX DETAIL                                                   128094
      *                                                                   128094
     I*LTRIX***NS       1 CD                                                         128094 AR322732
     I**********                              1   1 RECI                             128094 AR322732
     I**********                              2   2 RCDT                             128094 AR322732
     I**********                              3   80LNRFLT                           128094 AR322732
     I**********                              9  130VDATS                            128094 AR322732
     I**********                             14  160LASN                             128094 AR322732
     I**********                             17  17 CHTPLT                           128094 AR322732
     I**********                             18  18 CNRQ                             128094 AR322732
     I**********                             19  19 CNPR                             128094 AR322732
     I**********                             20  20 REPR                             128094 AR322732
     I**********                             21  250RRLA                             128094 AR322732
     I**********                             26  26 LADI                             128094 AR322732
     I**********                             27  270PRI1                             128094 AR322732
     I**********                          P  35  370RRNT                             128094 AR322732
     I**********                          P  38  400TNLU                             128094 AR322732
     I**********                             41  410PRI2                             128094 AR322732
     I**********                             42  420PRI3                             128094 AR322732
     I**********                             43  430PRI4                             128094 AR322732
      *                                                                   128094
      **   LTRIX CATCHALL                                                 128094
      *                                                                   128094
     I********NS                                                                     128094 AR322732
     I**********                              1   1 RECI                             128094 AR322732
      *                                                                   CAP063
     ILEIMRPD2                                                            CAP063
      ** Rename fields                                                    CAP063
     I              SLOAN                           ISLOAN                CAP063
     I              SCUST                           ISCUST                CAP063
     I              SPASD                           ISPASD                CAP063
     I              SVALD                           ISVALD                CAP063
     I              SSEQN                           ISSEQN                CAP063
     I              SEVAL                           ISEVAL                CAP063
     I              SESEQ                           ISESEQ                CAP063
     I              SRPRI                           ISRPRI                CAP063
     I              SPSIG                           ISPSIG                CAP063
     I              SRINT                           ISRINT                CAP063
     I              SISIG                           ISISIG                CAP063
     I              SRPEN                           ISRPEN                CAP063
     I              SRPIG                           ISRPIG                CAP063
     I              SRTOT                           ISRTOT                CAP063
     I              SRSIG                           ISRSIG                CAP063
     I              SWOFF                           ISWOFF                CAP063
     I              SFSCCY                          ISFSCY                                    CLE031
     I              SFPSCY                          ISPSCY                                    CLE031
     I              SFREXR                          ISREXR                                    CLE031
     I              SFPEXR                          ISPEXR                                    CLE031
     I              SFREXI                          ISREXI                                    CLE031
     I              SFPEXI                          ISPEXI                                    CLE031
     I              SRCCY                           ISRCCY                                    CLE036
      *
     IFLDTX       DS                                                      186431
      ** Data Structure for PF/LTRIX                                      186431
      *                                                                   186431
     I                                     *STATUS  TXSTS                 186431
      *                                                                   186431
     IA@CPY       DS
      ** Copyright array
      *
     ILDA       E DSLDA                         256
     I              SPARE                           SPARF                 119892
      *
      ** Local data area for database error details
      ** *LOCK IN LDA immediately before and OUT LDA immediately
      ** after each database error handling.
      *
      *                                     134 141 DBFILE
      *        Defines:                     142 170 DBKEY
      *                                     171 180 DBPGM
      *                                     181 1830DBASE
      *
     IPSDS       SDS
      *
      ** Program Status Data Structure - gives Job/Workstation name and
      ** User ID
      *
     I                                     *PROGRAM ##PGM
     I                                      244 253 WSID
     I                                      254 263 USER
     I/COPY WNCPYSRC,LE2110I003
      *
      ** Data member for main program
      *
     I            DS
     I                                        1   4 WDATA
     I                                       35  35 WTRAC
     I                                       36  43 WTRDS
     I                                       36  39 WDDMM
     I                                       42  43 WDSYY
     I                                        1 192 PDAT
     I            DS
      ** Data structure of rundates
     I                                    P   1   30RUN0
     I                                    P   4   60RUN1
     I                                    P   7   90RUN2
     I                                    P  10  120RUN3
     I                                    P  13  150RUN4
     I                                    P  16  180RUN5
     I                                    P  19  210RUN6
     I                                    P  22  240RUN7
     I                                    P  25  270RUN8
     I                                    P  28  300RUN9
     I                                    P   1  300RUNS
      *
      ** Data structure for drawn amount FCLTY
      *
     I            DS
     I                                    P   1   70OAM1
     I                                    P   8  140OAM2
     I                                    P  15  210OAM3
     I                                    P  22  280OAM4
     I                                    P  29  350OAM5
     I                                    P  36  420OAM6
     I                                    P  43  490OAM7
     I                                    P  50  560OAM8
     I                                    P  57  630OAM9
     I                                    P  64  700OA10
     I                                    P   1  70 OAM
      *
      ** Data structure for last change details
      *
     I            DS
     I                                        1   50LCD
     I                                        6   6 CHTP
     I                                        7  110TNLU
     I                                        1  11 LSTC
      *
      ** Data structure for saved amounts
      *
     I            DS
     I                                        1  130PRAMR
     I                                       14  260INTAR
     I                                       27  390PNAMR
     I                                       40  520TAMTR
     I                                       53  650WTXAR
     I                                        1  65 SAMT
      *
     I                                       66  780PRAM
     I                                       79  910INTA
     I                                       92 1040PNAM
     I                                      105 1170TAMT
     I                                      118 1300WTXA
     I                                       66 130 AMT
      *
     I                                      131 1430OPRAM
     I                                      144 1560OINTA
     I                                      157 1690OPNAM
     I                                      170 1820OTAMT
     I                                      183 1950OWTXA
     I                                      131 195 OAMT
     I                                      131 182 W@DET1
      *                                                                                       CLE036
      ** Data structure for Facility Currency saved amounts                                   CLE036
      *                                                                                       CLE036
     I            DS                                                                          CLE036
      * contains amounts from file, to check during Amend:                                    CLE036
     I                                        1  130FRAMR                                     CLE036
     I                                       14  260FINTR                                     CLE036
     I                                       27  390FPENR                                     CLE036
     I                                       40  520FTOTR                                     CLE036
     I                                       53  650FTXAR                                     CLE036
     I                                        1  65 FSAMT                                     CLE036
      * contains amounts from file, to check during Amend:                                    CLE036
     I                                       66  780FRAM                                      CLE036
     I                                       79  910FINT                                      CLE036
     I                                       92 1040FPEN                                      CLE036
     I                                      105 1170FTOT                                      CLE036
     I                                      118 1300FTXA                                      CLE036
     I                                       66 130 FRAMT                                     CLE036
      *                                                                                       CLE036
      * contains amounts from screen, to output during Insert:                                CLE036
     I                                      131 1430OFRAM                                     CLE036
     I                                      144 1560OFINT                                     CLE036
     I                                      157 1690OFPEN                                     CLE036
     I                                      170 1820OFTOT                                     CLE036
     I                                      183 1950OFTXA                                     CLE036
     I                                      131 195 OFAMT                                     CLE036
     I                                      131 182 W@FAM1                                    CLE036
      *
      ** Datastructure to keep detail screen fields
      *
     I            DS
     I                                        1   1 SPASD
     I                                        2   2 SWOFF
     I                                        1   2 W@DET2
      *                                                                   170120
      ** Data structure to hold before image of detail screen             170120
      *                                                                   170120
     I            DS                                                      170120
     I                                        1  70 W@DETA                170120
     I                                        1  10 SCUST                 170120
     I                                       11  24 SRPRI                 170120
     I                                       25  25 SPSIG                 170120
     I                                       26  39 SRINT                 170120
     I                                       40  40 SISIG                 170120
     I                                       41  54 SRPEN                 170120
     I                                       55  55 SRPIG                 170120
     I                                       56  69 SRTOT                 170120
     I                                       70  70 SRSIG                 170120
      *                                                                   170120
      *
      ** Data structure for saved details other than amounts
      *
     I            DS
     I**********                              3   3 LWOI                                      259991
     I**********                              4   5 SETPA                                     259991
     I**********                              6  17 OSAC                                      259991
     I**********                             18  27 TSEN                                      259991
     I**********                              4  27 SETTR                                     259991
     I**********                              3  27 DETS                                      259991
      **********                                                                              259991
     I**********                             30  30 LWOIR                                     259991
     I**********                             31  32 OSETT                                     259991
     I**********                             33  44 OOSAC                                     259991
     I**********                             45  54 OTSEN                                     259991
     I**********                             31  54 SETTO                                     259991
     I**********                             30  54 SDETS                                     259991
      *                                                                                       259991
     I                                        3   3 LWOI                                      259991
     I                                        4   5 SETPA                                     259991
     I                                        6  23 OSAC                                      259991
     I                                       24  33 TSEN                                      259991
     I                                        4  33 SETTR                                     259991
     I                                        3  33 DETS                                      259991
      *                                                                                       259991
     I                                       36  36 LWOIR                                     259991
     I                                       37  38 OSETT                                     259991
     I                                       39  56 OOSAC                                     259991
     I                                       57  66 OTSEN                                     259991
     I                                       37  66 SETTO                                     259991
     I                                       36  66 SDETS                                     259991
      *
      ** Extra fields to define whole record and settlement instr.
      *
     I                                      163 1640MDST
     I                                      165 176 OMDA
     I                                      177 186 TMAN
     I                                      163 186 SETTL
     I                                        1 256 LOT1A
     I                                      257 436 LOT2A
      *
     I            DS
     I**********                              1   2 WTYP                                      259991
     I**********                              3  14 WOURS                                     259991
     I**********                             15  24 WTHRS                                     259991
     I**********                             25  34 WFACO                                     259991
     I**********                              1  34 WSETT                                     259991
      *                                                                                       259991
     I                                        1   2 WTYP                                      259991
     I                                        3  20 WOURS                                     259991
     I                                       21  30 WTHRS                                     259991
     I                                       31  40 WFACO                                     259991
     I                                        1  40 WSETT                                     259991
      *
      ** CLOAN
      *
     I            DS
     I**********                              1   60WLOAN                                     CLE148
     I                                        1   6 WLOAN                                     CLE148
     I                                        7   7 WRCDT
     I                                        1   7 WLOAN1
      *
      ** KLKEY
      *
     I            DS
     I**********                              1   60WLNRF                                     CLE148
     I                                        1   6 WLNRF                                     CLE148
     I                                        7  110WVALD
     I                                       12  140SLASN
     I                                        1  14 KLKEY
      *
      ** FCLKEY
      *
     I            DS
     I**********                              1   60WFCUS                                     CSD027
     I                                        1   6 WFCUS                                     CSD027
     I                                        7   90WFTYP
     I                                       10  110WFSEQ
     I                                       12  12 WRCDT1
     I                                        1  12 FCLKEY
      *
     I            DS
     I                                        1   8 WPITDS
     I                                        1   2 WPIDD
     I                                        3   4 WPIMM
     I                                        5   6 WPICC                 CSC011
     I                                        5   8 WPIYY
      *
     I            DS
     I                                        1   6 WDATE
     I                                        1   2 WDD
     I                                        3   4 WMM
     I                                        5   6 WYY
      *
     I            DS
     I                                        1   6 WTIMEA
     I                                        1   2 WHH
     I                                        3   4 WNN
     I                                        5   6 WSS
      *                                                                   CLE005
     I            DS                                                      CLE005
     I                                        1  12 WPRME                 CLE005
     I                                        1   1 LPFI                  CLE005
     I**********                              2   70PTFC                               CLE005 CSD027
     I                                        2   7 PTFC                                      CSD027
     I                                        8  100PTFT                  CLE005
     I                                       11  120PTFN                  CLE005
      *                                                                                       207629
      ** Datastructure to hold input parameter for AOSVALR0.                                  207629
     I            DS                                                                          207629
     I                                        1  20 WPARM                                     207629
     I                                        1   5 WPARM1                                    207629
     I                                        6  10 WPARM2                                    207629
     I                                       11  15 WPARM3                                    207629
     I                                       16  20 WPARM4                                    207629
      *
     I***PINPP***    DS                            844                    CEU004
     I***PINPP       DS                            850             CEU004 143802
     I***PINPP***    DS                            851             143802 CPK015
     IPINPP     E DSLEM1MFPD                                              CPK015
      ** Transmitted message format
      *
     I                                        1   4 PIMTYP
     I                                        5  20 PITUSR
     I                                       21  36 PITWST
     I                                       37  51 PITREF
     I                                       52  55 PITSEQ
     I                                       52  550P#TSEQ                123177
     I                                       56  56 PITACT
     I                                       57  64 PITDST
     I                                       65  72 PITTST
     I************                           73  75 PINPAR                120002
     I************                           76  80 PIFIL5                120002
     I                                       73  76 PINPAR                120002
     I************                           77  80 PIFIL5         120002 CAP063
     I                                       77  77 PIRPLC                CAP063
     I                                       78  80 PIFIL5                CAP063
     I                                       81  86 PILOAN
     I                                       87  94 PIVDAT
     I                                       95  97 PIMRSQ
     I                                       98 105 PIXDAT
     I                                      106 108 PIXSEQ
     I                                      109 114 PICSNO
     I                                      115 128 PIPAMT
     I                                      129 129 PIPSGN
     I                                      130 143 PIIAMT
     I                                      144 144 PIISGN
     I                                      145 158 PITAMT
     I                                      159 159 PITSGN
     I                                      160 160 PIWOFF
     I                                      161 162 PIPSTM
     I**********                            163 177 PIPONS                                    257098
     I**********                            166 177 P#PONS                             123699 257098
     I                                      163 177 QXPONS                                    257098
     I                                      166 177 Q#PONS                                    257098
     I                                      178 185 PIPREC
     I                                      186 186 PICVMR
     I                                      187 192 PIPOCN
     I                                      193 198 PIPOBN
     I                                      199 206 PIRCRN
     I                                      207 241 PIRCRA
     I                                      242 249 PIPIBN
     I                                      250 284 PIPIBA
     I                                      285 292 PIAWBN
     I                                      293 327 PIAWBA
     I                                      328 335 PIBENN
     I                                      336 370 PIBENA
     I                                      371 372 PIRSTM
     I**********                            373 387 PIRONS                                    257098
     I**********                            376 387 P#RONS                             123699 257098
     I                                      373 387 QXRONS                                    257098
     I                                      376 387 Q#RONS                                    257098
     I                                      388 393 PIROCN
     I                                      394 399 PIROBN
     I                                      400 407 PIRIBN
     I                                      408 442 PIRIBA
     I                                      443 582 PIDTPA
     I                                      443 477 PIDTP1
     I                                      478 512 PIDTP2
     I                                      513 547 PIDTP3
     I                                      548 582 PIDTP4
     I                                      583 585 PIDCHG
     I                                      586 795 PIBTBA
     I                                      586 620 PIBTB1
     I                                      621 655 PIBTB2
     I                                      656 690 PIBTB3
     I                                      691 725 PIBTB4
     I                                      726 760 PIBTB5
     I                                      761 795 PIBTB6
     I                                      796 796 PIPAST
     I                                      797 810 PIPEAM
     I                                      811 811 PIPESN
     I                                      812 821 PIIUSR
     I                                      822 831 PIAUSR
     I                                      832 841 PIXUSR
     I                                      842 844 PIPCOB
     I                                      845 847 PISCCY                CEU004
     I                                      848 850 PIICCY                CEU004
     I                                      851 851 PIGASS                143802
     I                                      852 865 PIREXR                                    CLE031
     I                                      866 866 PIREXI                                    CLE031
     I                                      867 869 PIPSCY                                    CLE031
     I                                      870 883 PIPEXR                                    CLE031
     I                                      884 884 PIPEXI                                    CLE031
     I                                      885 885 PISTAL                                    CLE034
     I**********                            886 888 PICCY                              CLE036 257098
     I                                      886 906 PIPONS                                    257098
     I                                      889 906 P#PONS                                    257098
     I                                      907 927 PIRONS                                    257098
     I                                      910 927 P#RONS                                    257098
     I                                      928 930 PICCY                                     257098
      *
     IPOUTP       DS                            183
      ** Return message format
      *
     I                                        1   4 POMTYP
     I                                        5  20 POTUSR
     I                                       21  36 POTWST
     I                                       37  51 POTREF
     I                                       52  55 POTSEQ
     I                                       56  56 POTACT
     I                                       57  64 POTDST
     I                                       65  72 POTTST
     I***********                            73  75 PONPAR                120002
     I***********                            76  80 POFIL5                120002
     I                                       73  76 PONPAR                120002
     I                                       77  80 POFIL5                120002
     I                                       81  81 POMSVR
     I                                       82  88 POMSID
     I                                       89 166 POMSTX
     I                                      167 172 POLOAN
     I                                      173 180 POVDAT
     I                                      181 183 POMRSQ
      *
      **
      *
     I/COPY QWINDSRC,LE2110GDTA
     I/COPY ZSRSRC,ZTNLU1Z1
     I/COPY ZSRSRC,ZF2CI                                                  128094
      *
      *
     I            DS
      ** Fields used for update of MEMOS, PRONO etc.
      *
     I                                        1 256 Z#ADTA
     I                                        1   1 SHRECI
     I                                        2   7 SHLNRF
     I                                        8  120SHVDAT
     I                                       13  150SHLASN
     I                                       21  22 SHPTYP
     I                                       23  24 SHAMTP
     I                                       35  37 SHCCY
     I                                    P  38  440SHPRAM
     I                                    P  66  720SHTAMT                148591
     I                                       73  75 SHBRCA
     I                                       82  820SHREPT
     I                                       83  83 SHAUTO
     I**********                             85 118 SHTIST                                    259991
     I                                       85 124 SHTIST                                    259991
      *
     I                                      257 512 Z#ADTB
     I                                      261 263 SHOSBR
     I                                      317 317 SHCHTP
     I                                    P 318 3200SHTNLU                CLE033
      *                                                                   CEU004
      *                                                                   148591
     I                                      7691024 Z#ADTD                148591
     I                                    P100110070SHPNAM                148591
      *                                                                   148591
     I                                     10251280 Z#ADTE                CEU004
     I***********                          10581060 SHSCCY         CEU004 186834
     I***********                          10611063 SHICCY         CEU004 186834
     I                                     10611063 SHSCCY                186834
     I                                     10641066 SHICCY                186834
     I                                    P106910758SHREXR                                    CLE031
     I                                     10761076 SHREXI                                    CLE031
     I                                     10771079 SHPSCY                                    CLE031
     I                                    P108010868SHPEXR                                    CLE031
     I                                     10871087 SHPEXI                                    CLE031
     I                                     10881088 SHSTAL                                    CLE034
      *                                                                   CEU004
     I            DS                                                      157744
     I                                        1  130WLPAM                 157744
     I                                        1  137WRATE1                157744
      *                                                                   157744
     IL2110S      DS                            942
      ** Data structure to hold test harness record
      *                                                                                       CSD015
     IPARMDS      DS                           9999                                           CSD015
      ** Compliance Engine Free Format String Parameter.                                      CSD015
      *                                                                   CSC011
     I            DS                                                      CSC011
      ** ISO format timestamp for 24/7 log                                CSC011
      ** Used as Key in APILOGL0                                          CSC011
     I                                        1  26 TSTISO                CSC011
     I                                        1   4 TSTYY                 CSC011
     I I            '-'                       5   5 TSTF1                 CSC011
     I                                        6   7 TSTMM                 CSC011
     I I            '-'                       8   8 TSTF2                 CSC011
     I                                        9  10 TSTDD                 CSC011
     I I            '-'                      11  11 TSTF3                 CSC011
     I                                       12  19 TSTTM                 CSC011
     I                                       12  13 TSTTM1                CSC011
     I I            '.'                      14  14 TSTF4                 CSC011
     I                                       15  16 TSTTM2                CSC011
     I I            '.'                      17  17 TSTF5                 CSC011
     I                                       18  19 TSTTM3                CSC011
     I I            '.'                      20  20 TSTF6                 CSC011
     I                                       21  26 TSTTM4                CSC011
     I            DS                                                      CSC011
      ** Data Structure to separate time for correct timestamp            CSC011
      **                                                                  CSC011
     I                                        1   8 WTSTM                 CSC011
     I                                        1   2 WTSHR                 CSC011
     I                                        3   4 WTSMN                 CSC011
     I                                        5   6 WTSSC                 CSC011
      *                                                                   CSC011
     ISC24X7    E DSSC24X7                                                CSC011
      * 24X7 Data Structure                                               CSC011
      *                                                                   CSC011
     ISDSTAT    E DSSDSTAT                                                CSC011
      * SDSTAT Data Structure                                             CSC011
      *                                                                   CSC011
     ISDCWCD    E DSSDCWCDPD                                                                  CSD015
      ** Compliance Watch List Configuration Data                                             CSD015
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      ** Midas Functions for Watch List Checking Deatils File                                 CSD015
      *                                                                                       CSD015
     ICWLCDS    E DSSDWLTOPD                                                                  CSD015
      ** Watch List Tranaction Details File                                                   CSD015
      *                                                                                       CSD015
     I/COPY WNCPYSRC,LE2110I001
      *
     IL2110F    E DSLE2110PD
      ** Data structure to receive test harness record
     I              LWOI                            LWOIT
     I              REXR                            REXRA                                     CLE031
     I              PEXR                            PEXRA                                     CLE031
     I              REXI                            REXIA                                     CLE031
     I              PEXI                            PEXIA                                     CLE031
     I              TMST                            L2TMST                                    CLE031
      *
     IZ#BSTS    E DSZ#BST
     IZ#ASTS    E DSZ#AST
     IZ#WSTS    E DSZ#WST
      ** Shadow posting parameters
      *
     ISDNOST    E DSSDNOSTPD
      **  EXTERNAL DS FOR NOSTRO DETAILS
     I              A7BRCD                          NBRCD
     I              A7ACCD                          WACOD
     I              A7ACSN                          WACSQ
      *
     ISDBRCH    E DSSDBRCHPD
      ** BRANCH CODES
      *
     ISDCUST    E DSSDCUSTPD
     I              QQDFAC                          Q1DFAC                                    CGL029
      **  EXTERNAL DS FOR CUSTOMER DETAILS
      *
     ISDBANK    E DSSDBANKPD
      ** External DS for Bank details
     I              BJSLCD                          SYSL
     I              BJBVPD                          BVLP
     I              BJLCCY                          LOCY
      *
     ISDCLND    E DSSDCLNDPD
      ** External DS for Customer Lending details
      *
     ISDTRAD    E DSSDTRADPD
      ** External DS for Trading details
     I              BLUSCY                          USCY
     I              QQACCD                          Q1ACCD                                    CGL029
      *
     ISDMMOD    E DSSDMMODPD
      ** External DS for Midas Module details
     I              BGRTBN                          RETL
      *
     ISDGELR    E DSSDGELRPD
     I              QQACCD                          Q2ACCD                                    CGL029
      ** External DS for Retail details
      *
     ISDRETL    E DSSDRETLPD
      ** External DS for Retail details
     I              BMRANR                          RACN
     I              BMACCD                          CADC
     I              QQACCD                          Q3ACCD                                    CGL029
      *
     ISCSARD    E DSSCSARDPD
      ** External DS for SAR details
     I              LCD                             LCDSAR
      *
     ISDCURR    E DSSDCURRPD
     I** External DS for Currency details
     I              A6NBDP                          CDP
     I              A6TXND                          TNOTL
      *                                                                   142078
     ISDEXST    E DSSDEXSTPD                                              142078
      ** External DS for Extended settlement Instruction.                 142078
      *
     ISDBSRT    E DSSDBSRTPD                                              157744
      ** External DS for Base Rate Codes                                  157744
      *
     I@PARM3    E DSSDSETLPD                                                                  222373
      *
     IDSFDY     E DSDSFDY
      ** Short data structure for access objects
      *
     IDSSDY     E DSDSSDY
      ** Long data structure for access objects
      *                                                                   158046
      * DS for calculating PC reference                                   158046
     ILEALLO    E DSLEALLO                                                158046
      *
     ISETLIB    E DSSETLIAB
     I              QQPONS                          Q1PONS                                    CGL029
     I              QQRONS                          Q1RONS                                    CGL029
      ** Parameter passed to extended settlement pgm
      *
     ISETLIZ    E DSSETLIAZ
      ** Parameter passed to extended settlement pgm
     IDSCSNM      DS                             10
      ** DATA AREA FOR THE LOCATION CODE IN CUSTOMER SHORTNAME FIELD
     I                                        8  10 NRLC
      *
     I/COPY ZSRSRC,ZHOLI
     I/COPY ZSRSRC,ZINTDYZ1
     I/COPY ZSRSRC,ZFRPEDZ2
     I/COPY ZSRSRC,ZDATE9Z2
     I/COPY ZSRSRC,ZDAT10Z1                                               126017
      ** Edit Amount
      *
      /EJECT
      *****************************************************************
      *                   INDEX TO SUBROUTINES                        *
      *  Main routine                                                 *
      *  SRINIT  -  Initial processing                                *
      *  SRSTRT  -  First Screen (Prompt for key input)               *
      *  SRRAUT  -  Validate Review from Loan number                  *
      *  SRINTL  -  Initial screen validation                         *
      *  SRINT1  -  Initial validations                               *
      *  SRCAUT  -  Check user authority on action/branch             *
      *  SRMIN2  -  Format amounts for output                         *
      *  SRINTR  -  Calculate remaining interest to be paid           *
      *  SRFRMT  -  Set up the Detail screens                         *
      *  SRXAUT  -  Check if action 'X' is authorised                 *
      *  SRSUBF  -  Select Screen (List of Manual Repaym. for select  *
      *  SRSUB1  -  Initialise all subfile fields                     *
      *  SRSCLR  -  Clear and initialise subfile                      *
      *  SRSUB2  -  Move file fields to subfile fields                *
      *  SRSTR1  -  Initialise all screen fields                      *
      *  SRSTR2  -  Initialise all screen fields                      *
      *  SRSTR3  -  Initialise all work fields                        *
      *  SRSVD1  -  Subfile validation                                *
      *  SRSUBP  -  Subfile Processing                                *
      *  SRDET1  -  First Detail Screen                               *
      *  SRHOLI  -  Check for holiday in nostro location              *
      *  SRUPRE  -  Set up details for update of related RE/PD record *
      *  SRINRE  -  Set up details for output of related RE record    *
      *  SRSTAT  -  Set up status of amendment                        *
      *  SRUPMR  -  Set up details for update of MR record            *
      *  SRINMR  -  Set up details for output of MR/PD record         *
      *  SRSTEX  -  Set up extended settlement details                *
      *  SRWRIT  -  Write a new record in file                        *
      *  SRUSHD  -  Shadow posting update                             *
      *  SRSHAD  -  Set up details for shadow post                    *
      *  SRLOAM  -  Update Loan Amendment file                        *
      *  SRNSEQ  -  Get next available sequence number                *
      *  SRTSHR  -  Set up details for output to test harness file    *
      *  SRUPDT  -  Update record                                     *
      *  SRFEES  -  Update Fees File                                  *   CLE009
      *  SRCHGS  -  Check for changes in record before update         *
      *  SRSLOC  -  Get location                                      *
      *  SRLOAN  -  Update Loans file                                 *
      *  SRMINI  -  Move file fields in screen fields                 *
      *  SRMIN1  -  Move file fields in screen fields (amounts)       *
      *  SRVAL1  -  Validate First detail screen input                *
      *  SRCUST  -  Validate customer no. or shortname                *
      *  SRAMTV  -  Validate amounts entered                          *
      *  SRAMTI  -  Validate amounts and indicator                    *
      *  SRADDV  -  Cross validation on fields                        *
      *  SRWIND  -  Window Processing                                 *
      *  SRDET2  -  Second Detail Screen - Extended settlement info   *
      *  SRPRST  -  Set up details received from SD2400/SD2410        *
      *  SRSHRT  -  Customer shortname                                *
      *  SRMFSR  -  Set up details for settlements screen - Not Insert*
      *  SRINTI  -  Set up details for settlements screen - Insert    *
      *  SRPLAY  -  Process play mode                                 *
      *  SRBTCH  -  Batch processing                                  *
      *  SRBSET  -  Format screen fields for Batch/Play               *
      *  SRTRAL  -  Update loan amendments trailer file               *
      *  SRFCLT  -  Facility file update                              *
      *  SRUPCA  -  Update credit agreement/superfacility             *   CLE005
      *  FCLTSR  -  Update facility exposure                          *
      *  SRCIBC  -  Check if customer is a branch internal customer   *
      *  SRSVD1  -  Subfile Validation                                *
      *  SRSUB2  -  Move file fields to the subfile fields            *
      *  SRENDC  -  End Closedown                                     *
      *  SRPNAM  -  Calculate the Penalty Amount                      *   157744
      *  BCASR   -  Set up array of branch interal customers          *
      *  CLEAR   -  Clears message from the program message queue     *
      *  GLZADD  -  Add an amount to the total                        *
      *  GLZSUB  -  Subtract amount from the total                    *
      *  GLZSUM  -  Carry out addition for subroutine                 *
      *  QFCLTY  -  Update facility availability array                *
      *  SRTEXT  -  Set up text from message file                     *   123998
      *  SRWARN  -  Display warning message if loan is syndicated     *   159256
      *  SRWTCH  -  Performs the Watch list processing.               *                       CSD015
      *  SRBLDA  -  Build array used for storing fields in Compliance *                       CSD015
      *  SRCWP2  -  Set up the 2nd parameter for Compliance Watch.    *                       CSD015
      *  ZASNMS  -  Sends message to the program message queue        *
      *  SRMIN3  -  Convert Expected amounts to facility ccy.         *                       CLE036
      *  SRMIN4  -  Move Fac. Ccy fields from file to screen fields.  *                       CLE036
      *  SRFNEG  -  Seperate +/- sign from Facility ccy amounts.      *                       CLE036
      *  SRFRUP  -  Update Facility Ccy fields of related record.     *                       CLE036
      *  FRCONV  -  Convert Facility Ccy amounts to loan ccy fields.  *                       CLE036
      *  *PSSR   -  Error handling subroutine                         *
      *****************************************************************
     C/EJECT
      *****************************************************************
      *
      *    Standard parameter list for window manager
      *
      *
      *****************************************************************
      *
      *                M A I N  P R O C E S S I N G
      *
      *****************************************************************
      *
      ** Initialise data
      *
     C                     EXSR SRINIT
      *
      ** Continue to redisplay the screen if WFMT not blank
      *
     C           WFMT      DOWNE*BLANKS
      *
     C           WFMT      CASEQ'F0'      SRSTRT
     C           WFMT      CASEQ'S0'      SRSUBF
     C           WFMT      CASEQ'D1'      SRDET1
     C           WFMT      CASEQ'D2'      SRDET2
     C           WFMT      CASEQ'WR'      SRWRIT
     C           WFMT      CASEQ'UP'      SRUPDT
     C                     ENDCS
     C                     ENDDO
      *
      **   Exit from program
      *
     C           *INKC     IFEQ '1'
     C                     EXSR SRENDC
     C                     ENDIF
     C           PMODE     IFNE 'B'                                                           227710
     C           PMODE     ANDNE'P'                                                           227710
     C                     ROLBK                                                              227710
     C                     ENDIF                                                              227710
      *
      ** Terminate program
      *
     C                     MOVE '1'       *INLR
      *
      /EJECT
      *****************************************************************
      * SRINIT   - Initial Processing                                 *
      * Called by: Main Process                                       *
      * Calls    : None                                               *
      *****************************************************************
      *
     C           SRINIT    BEGSR
      *
     C                     MOVEACPY@      CPY2@  80
      *                                                                   123998
     C           *LIKE     DEFN ZAMSTX    Z1MSTX                          123998
     C           *LIKE     DEFN ZAMSTX    Z2MSTX                          123998
     C           *LIKE     DEFN ZAMSTX    Z3MSTX                          123998
      *
     C           *ENTRY    PLIST
     C                     PARM           PMODE   1
     C                     PARM           PINPP
     C                     PARM           POUTP
     C                     PARM           PTMST  26                                           CLE034
      *
      ** Read in Installation Data
      *
     C           *NAMVAR   DEFN           LDA
     C*                                                                   CSC011
     C           *NAMVAR   DEFN           SDSTAT                          CSC011
     C*                                                                   CSC011
     C           *NAMVAR   DEFN           SC24X7                          CSC011
     C*                                                                   CSC011
      *
      ** Initialise LDA
      *
     C           *LOCK     IN   LDA
     C                     MOVEL'LE2110'  DBPGM
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD*ZEROS    DBASE
     C                     OUT  LDA
      *
      ** Key to LOAMS file
      *
     C           KLMKEY    KLIST
     C**********           KFLD           WLNRF   60                                          CLE148
     C                     KFLD           WLNRF   6                                           CLE148
     C                     KFLD           WVALD   50
     C                     KFLD           SLASN
      *
      ** Key to LELOAM file
      *
     C           KLEKEY    KLIST
     C                     KFLD           WLNRF
     C                     KFLD           WBLK1   50
     C                     KFLD           WBLK2   30
      *
      ** Key to LMANP file
      *
     C           KTKEY     KLIST
     C                     KFLD           WLOAN
     C                     KFLD           WBLK1   50
     C                     KFLD           WBLK2   30
      *
      ** Key to CLOAN file
      *
     C           KCLOAN    KLIST
     C                     KFLD           WLOAN
     C                     KFLD           WRCDT   1
      *
      ** Key to FCLTY
      *
     C           KFCLT     KLIST
     C                     KFLD           WFCUS
     C                     KFLD           WFTYP
     C                     KFLD           WFSEQ
     C                     KFLD           WRCDT1
      *
      ** Key to LEFCAML3                                                  150496
      *                                                                   150496
     C           KFCAM     KLIST                                          150496
     C                     KFLD           WFCUS                           150496
     C                     KFLD           WFTYP                           150496
     C                     KFLD           WFSEQ                           150496
      *                                                                   CLE009
      ** Keylist for loan amendment fee index file                        CLE009
      *                                                                   CLE009
     C           KIDXF     KLIST                                          CLE009
     C**********           KFLD           WKLOAN  60                                   CLE009 CLE148
     C                     KFLD           WKLOAN  6                                           CLE148
     C                     KFLD           WKDATE  50                      CLE009
     C                     KFLD           WKSEQN  30                      CLE009
      *                                                                   CLE009
      ** Key list for Fees file                                           CLE009
      *                                                                   CLE009
     C           WKFEE     KLIST                                          CLE009
     C**********           KFLD           WFCUS   60                                   CLE009 CSD027
     C                     KFLD           WFCUS   6                                           CSD027
     C                     KFLD           WFFACL  50                      CLE009
     C**********           KFLD           WFLOAN  60                                   CLE009 CLE148
     C                     KFLD           WFLOAN  6                                           CLE148
      *                                                                   CSC011
      **  Used for APILOGL0                                               CSC011
      *                                                                   CSC011
     C           KAPLOG    KLIST                                          CSC011
     C                     KFLD           KMTYPE  8                       CSC011
     C                     KFLD           KFOID  20                       CSC011
     C                     KFLD           KTSTMP 26                       CSC011
      *                                                                   CSC011
      **  Used fo Compliance Watch                                                            CSD015
      *                                                                                       CSD015
     C           CWHTKY    KLIST                                                              CSD015
     C                     KFLD           KFUNT   8                                           CSD015
     C                     KFLD           KIDEN  40                                           CSD015
     C                     KFLD           KBRCH   3                                           CSD015
      *
     C                     MOVELWDDMM     WDAYNO  60
     C                     MOVE WDSYY     WDAYNO
     C                     MOVE 'A'       WRCDT
     C                     Z-ADD0         WBLK1
     C                     Z-ADD0         WBLK2
      *
     C                     BITOF'01234567'BIT     1
      *
      ** Access Bank Details
      *
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANKS   PRTCD   7
     C                     PARM '*FIRST ' POPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBANKPD'DBFILE           ************
     C                     Z-ADD1         DBASE            * DBERR 01 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Access Customer Lending data
      *
     C                     CALL 'AOCLNDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDCLND    PARM SDCLND    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCLNDPD'DBFILE           ************
     C                     Z-ADD2         DBASE            * DBERR 02 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Access Trading Data
      *
     C                     CALL 'AOTRADR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDTRAD    PARM SDTRAD    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDTRADPD'DBFILE           ************
     C                     Z-ADD3         DBASE            * DBERR 03 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Access Midas Module Details
      *
     C                     CALL 'AOMMODR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDMMODPD'DBFILE           ************
     C                     Z-ADD4         DBASE            * DBERR 04 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVELBGMBIN    MBIN    1
      *
      ** Access General Ledger Details
      *
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDGELRPD'DBFILE           ************
     C                     Z-ADD5         DBASE            * DBERR 05 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Access Retail Details if Retail Module Present
      *
     C           RETL      IFEQ 'Y'
     C                     MOVE 'Y'       PMRETP
     C                     CALL 'AORETLR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDRETL    PARM SDRETL    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDRETLPD'DBFILE           ************
     C                     Z-ADD6         DBASE            * DBERR 06 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     MOVE RACN      PMRETS
     C                     MOVE CADC      PMPCYA
     C                     ENDIF
      *
      ** Access SAR details file to see if Customer Lending
      ** Enhancements - Authorisation feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'CLE002'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
      *
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE002  1
     C                     MOVE '1'       *IN86
     C                     ELSE
     C                     MOVE 'N'       CLE002
     C                     MOVE '0'       *IN86
     C           PRTCD     IFNE '*NRF   '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD7         DBASE            * DBERR 07 *
     C                     MOVEL'CLE002'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Access SAR details file to see if Customer Lending
      ** Enhancements - Backvaluations feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'CLE003'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
      *
     C           PRTCD     IFEQ *BLANK
     C                     MOVE 'Y'       CLE003  1
     C                     MOVE '1'       *IN87
     C                     ELSE
     C                     MOVE 'N'       CLE003
     C                     MOVE '0'       *IN87
     C           PRTCD     IFNE '*NRF   '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD8         DBASE            * DBERR 08 *
     C                     MOVEL'CLE003'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Access SAR details file to see if Customer Lending
      ** Enhancements - Syndications feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'CLE004'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
      *
     C           PRTCD     IFEQ *BLANK
     C                     MOVE 'Y'       CLE004  1
     C                     MOVE '1'       *IN88
     C                     ELSE
     C                     MOVE 'N'       CLE004  1
     C                     MOVE '0'       *IN88
     C           PRTCD     IFNE '*NRF   '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD9         DBASE            * DBERR 09 *
     C                     MOVEL'CLE004'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Access SAR details file to see if Customer Lending
      ** Enhancements - Other feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANK    PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'CLE005'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
      *
     C           PRTCD     IFEQ *BLANK
     C                     MOVE 'Y'       CLE005  1
     C                     ELSE
     C                     MOVE 'N'       CLE005  1
     C           PRTCD     IFNE '*NRF   '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD10        DBASE            * DBERR 10 *
     C                     MOVEL'CLE005'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *                                                                   CLE033
      ** Access Switchable Feature Details (CLE033)                       CLE033
      *                                                                   CLE033
     C                     MOVE 'N'       CLE033  1                       CLE033
      *                                                                   CLE033
     C                     CALL 'AOSARDR0'                                CLE033
     C                     PARM *BLANKS   @RTCD                           CLE033
     C                     PARM '*VERIFY '@OPTN                           CLE033
     C                     PARM 'CLE033'  @SARD                           CLE033
      *                                                                   CLE033
     C           @RTCD     IFEQ *BLANKS                                   CLE033
     C                     MOVE 'Y'       CLE033                          CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE007
      ** Access SAR details file to see if Customer Lending               CLE007
      ** Enhancements - Other feature (T3) is installed                   CLE007
      *                                                                   CLE007
     C                     CALL 'AOSARDR0'                                CLE007
     C                     PARM *BLANK    PRTCD                           CLE007
     C                     PARM '*KEY   ' POPTN                           CLE007
     C                     PARM 'CLE007'  PSARD   6                       CLE007
     C           SCSARD    PARM SCSARD    DSFDY                           CLE007
      *                                                                   CLE007
     C           PRTCD     IFEQ *BLANK                                    CLE007
     C                     MOVE 'Y'       CLE007  1                       CLE007
     C                     MOVE '1'       *IN89                           CLE007
     C                     CALL 'AOSARDR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*KEY   ' POPTN                           CLE009
     C                     PARM 'CLE009'  PSARD   6                       CLE009
     C           SCSARD    PARM SCSARD    DSFDY                           CLE009
      *                                                                   CLE009
      ** If CLE009 is installed, fill currency and their corresponding    CLE009
      ** telex notice days arrays                                         CLE009
      *                                                                   CLE009
     C           PRTCD     IFEQ *BLANKS                                   CLE009
     C                     MOVE 'Y'       CLE009  1                       CLE009
     C                     Z-ADD1         Y       30                      CLE009
      *                                                                   CLE009
     C                     CALL 'AOCURRR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*FIRST ' POPTN                           CLE009
     C                     PARM           PCURR   3                       CLE009
     C           SDCURR    PARM SDCURR    DSSDY                           CLE009
      *                                                                   CLE009
     C                     MOVE A6CYCD    CYA,Y                           CLE009
     C                     MOVE TNOTL     TND,Y                           CLE009
     C                     MOVE CDP       NDP,Y                                               CLE036
      *                                                                   CLE009
     C           PRTCD     DOWNE'*EOF    '                                CLE009
     C                     ADD  1         Y                               CLE009
      *                                                                   CLE009
     C                     CALL 'AOCURRR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*NEXT  ' POPTN                           CLE009
     C                     PARM           PCURR   3                       CLE009
     C           SDCURR    PARM SDCURR    DSSDY                           CLE009
      *                                                                   CLE009
     C           PRTCD     IFNE '*EOF    '                                CLE009
     C                     MOVE A6CYCD    CYA,Y                           CLE009
     C                     MOVE TNOTL     TND,Y                           CLE009
     C                     MOVE CDP       NDP,Y                                               CLE036
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDDO                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'N'       CLE009                          CLE009
      *                                                                   CLE009
     C           PRTCD     IFNE '*NRF    '                                CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE009
     C                     Z-ADD35        DBASE            * DBERR 35 *   CLE009
     C                     MOVEL'CLE009'  DBKEY            ************   CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
     C                     ELSE                                           CLE007
     C                     MOVE 'N'       CLE007                          CLE007
     C                     MOVE '0'       *IN89                           CLE007
     C           PRTCD     IFNE '*NRF   '                                 CLE007
     C           *LOCK     IN   LDA                                       CLE007
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE007
     C                     Z-ADD33        DBASE            * DBERR 33 *   CLE007
     C                     MOVEL'CLE007'  DBKEY            ************   CLE007
     C                     OUT  LDA                                       CLE007
     C                     EXSR *PSSR                                     CLE007
     C                     ENDIF                                          CLE007
     C                     ENDIF                                          CLE007
      *                                                                   CEU004
      ** Access SAR details file to see if Customer Lending               CEU004
      ** Enhancements - Ccy Conversion Upgrade to DBA R2.0                CEU004
      *                                                                   CEU004
     C                     CALL 'AOSARDR0'                                CEU004
     C                     PARM *BLANK    PRTCD                           CEU004
     C                     PARM '*KEY   ' POPTN                           CEU004
     C                     PARM 'CEU004'  PSARD   6                       CEU004
     C           SCSARD    PARM SCSARD    DSFDY                           CEU004
      *                                                                   CEU004
     C           PRTCD     IFEQ *BLANK                                    CEU004
     C                     MOVE 'Y'       CEU004  1                       CEU004
     C                     ELSE                                           CEU004
     C                     MOVE 'N'       CEU004                          CEU004
     C           PRTCD     IFNE '*NRF   '                                 CEU004
     C           *LOCK     IN   LDA                                       CEU004
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU004
     C                     Z-ADD34        DBASE            * DBERR 34 *   CEU004
     C                     MOVEL'CEU004'  DBKEY            ************   CEU004
     C                     OUT  LDA                                       CEU004
     C                     EXSR *PSSR                                     CEU004
     C                     ENDIF                                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
      ** Access SAR details file to see if Customer Lending                                   CLE031
      ** Enhancements - settlement of other currencies allowed.                               CLE031
      *                                                                                       CLE031
     C                     CALL 'AOSARDR0'                                                    CLE031
     C                     PARM *BLANK    PRTCD                                               CLE031
     C                     PARM '*KEY   ' POPTN                                               CLE031
     C                     PARM 'CLE031'  PSARD   6                                           CLE031
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE031
      *                                                                                       CLE031
     C                     MOVE 'N'       CLE031                                              CLE031
     C           PRTCD     IFEQ *BLANK                                                        CLE031
     C                     MOVE 'Y'       CLE031  1                                           CLE031
     C                     ELSE                                                               CLE031
     C           PRTCD     IFNE '*NRF   '                                                     CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'SCSARDPD'DBFILE           ************                       CLE031
     C                     Z-ADD37        DBASE            * DBERR 37 *                       CLE031
     C                     MOVEL'CLE031'  DBKEY            ************                       CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *
      ** Determine if Data Export for CCRM Limits is active               CDE001
      *                                                                   CDE001
     C                     CALL 'AOSARDR0'                                CDE001
     C                     PARM *BLANKS   PRTCD                           CDE001
     C                     PARM '*VERIFY' POPTN                           CDE001
     C                     PARM 'CDE001'  PSARD                           CDE001
     C           PRTCD     IFEQ *BLANKS                                   CDE001
     C                     MOVE 'Y'       CDE001  1                       CDE001
     C                     ELSE                                           CDE001
     C                     MOVE 'N'       CDE001                          CDE001
     C           PRTCD     IFNE '*NRF    '                                CDE001
     C           *LOCK     IN   LDA                                       CDE001
     C                     MOVEL'SCSARDPD'DBFILE           ************   CDE001
     C                     Z-ADD37        DBASE            * DBERR 37 *   CDE001
     C                     MOVEL'CDE001'  DBKEY            ************   CDE001
     C                     OUT  LDA                                       CDE001
     C                     EXSR *PSSR                                     CDE001
     C                     ENDIF                                          CDE001
     C                     ENDIF                                          CDE001
      *                                                                   CLE014
      ** Determine if Lending API enhancement/Manual Repayment is active  CAP063
      *                                                                   CAP063
     C                     CALL 'AOSARDR0'                                CAP063
     C                     PARM *BLANKS   PRTCD                           CAP063
     C                     PARM '*VERIFY' POPTN                           CAP063
     C                     PARM 'CAP063'  PSARD                           CAP063
     C           PRTCD     IFEQ *BLANKS                                   CAP063
     C                     MOVE 'Y'       CAP063  1                       CAP063
     C                     ELSE                                           CAP063
     C                     MOVE 'N'       CAP063                          CAP063
     C           PRTCD     IFNE '*NRF    '                                CAP063
     C           *LOCK     IN   LDA                                       CAP063
     C                     MOVEL'SCSARDPD'DBFILE           ************   CAP063
     C                     Z-ADD38        DBASE            * DBERR 38 *   CAP063
     C                     MOVEL'CAP063'  DBKEY            ************   CAP063
     C                     OUT  LDA                                       CAP063
     C                     EXSR *PSSR                                     CAP063
     C                     ENDIF                                          CAP063
     C                     ENDIF                                          CAP063
      ** Determine if Lending Enhancements for is active                  CLE014
      *                                                                   CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM *BLANKS   PRTCD                           CLE014
     C                     PARM '*VERIFY' POPTN                           CLE014
     C                     PARM 'CLE014'  PSARD                           CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CLE014  1                       CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CLE014                          CLE014
     C           PRTCD     IFNE '*NRF    '                                CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVEL'SCSARDPD'DBFILE                          CLE014
     C                     Z-ADD38        DBASE                           CLE014
     C                     MOVEL'CLE014'  DBKEY                           CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C/COPY WNCPYSRC,LEH00585
      *                                                                   CSC011
      ** Determine if 24x7 Midas Availability active?                     CSC011
      *                                                                   CSC011
     C                     CALL 'AOSARDR0'                                CSC011
     C                     PARM *BLANKS   PRTCD                           CSC011
     C                     PARM '*VERIFY' POPTN                           CSC011
     C                     PARM 'CSC011'  PSARD                           CSC011
     C           PRTCD     IFEQ *BLANKS                                   CSC011
     C                     MOVE 'Y'       CSC011  1                       CSC011
     C                     ELSE                                           CSC011
     C                     MOVE 'N'       CSC011                          CSC011
     C           PRTCD     IFNE '*NRF    '                                CSC011
     C           *LOCK     IN   LDA                                       CSC011
     C                     MOVEL'SCSARDPD'DBFILE           ************   CSC011
     C                     Z-ADD17        DBASE            * DBERR 17 *   CSC011
     C                     MOVEL'CSC011'  DBKEY            ************   CSC011
     C                     OUT  LDA                                       CSC011
     C                     EXSR *PSSR                                     CSC011
     C                     ENDIF                                          CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C*                                                                   CSC011
     C* Is the support system on?                                         CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     Z-ADDS1DATE    WRNDAY  60                      CSC011
     C                     ELSE                                           CSC011
     C                     MOVE BJRDNB    WRNDAY                          CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
      *                                                                                       CLE023
      ** Access SAR details to see if Lending Facility History                                CLE023
      ** Improvements is installed                                                            CLE023
      *                                                                                       CLE023
     C                     CALL 'AOSARDR0'                                                    CLE023
     C                     PARM *BLANKS   PRTCD                                               CLE023
     C                     PARM '*VERIFY' POPTN                                               CLE023
     C                     PARM 'CLE023'  PSARD                                               CLE023
     C           PRTCD     IFEQ *BLANKS                                                       CLE023
     C                     MOVE 'Y'       CLE023  1                                           CLE023
     C                     ELSE                                                               CLE023
     C                     MOVE 'N'       CLE023                                              CLE023
     C           PRTCD     IFNE '*NRF    '                                                    CLE023
     C           *LOCK     IN   LDA                                                           CLE023
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE023
     C                     Z-ADD40        DBASE                                               CLE023
     C                     MOVEL'CLE023'  DBKEY                                               CLE023
     C                     OUT  LDA                                                           CLE023
     C                     EXSR *PSSR                                                         CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
      ** Access SAR details file to see if Customer Lending                                   CLE034
      ** Enhancements - settlement of other currencies allowed.                               CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSARDR0'                                                    CLE034
     C                     PARM *BLANK    PRTCD                                               CLE034
     C                     PARM '*KEY   ' POPTN                                               CLE034
     C                     PARM 'CLE034'  PSARD                                               CLE034
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE034
      *                                                                                       CLE034
     C                     MOVE 'N'       CLE034                                              CLE034
     C                     MOVE *OFF      *IN90                                               CLE034
     C           PRTCD     IFEQ *BLANK                                                        CLE034
     C                     MOVE 'Y'       CLE034  1                                           CLE034
     C                     MOVE *ON       *IN90                                               CLE034
     C                     ELSE                                                               CLE034
     C           PRTCD     IFNE '*NRF   '                                                     CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE034
     C                     Z-ADD41        DBASE                                               CLE034
     C                     MOVEL'CLE034'  DBKEY                                               CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Check if Flat Rate Personal Loans (Rule of 78s) is installed                         CLE028
      *                                                                                       CLE028
     C                     CALL 'AOSARDR0'                                                    CLE028
     C                     PARM *BLANKS   PRTCD                                               CLE028
     C                     PARM '*VERIFY' POPTN                                               CLE028
     C                     PARM 'CLE028'  PSARD                                               CLE028
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE028
      *                                                                                       CLE028
     C           PRTCD     IFNE *BLANKS                                                       CLE028
     C           PRTCD     ANDNE'*NRF   '                                                     CLE028
     C           *LOCK     IN   LDA                                                           CLE028
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE028
     C                     Z-ADD039       DBASE                                               CLE028
     C                     MOVELPSARD     DBKEY                                               CLE028
     C                     OUT  LDA                                                           CLE028
     C                     EXSR *PSSR                                                         CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           PRTCD     IFEQ *BLANKS                                                       CLE028
     C                     MOVE 'Y'       CLE028  1                                           CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE 'N'       CLE028                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CAS005
      ** Check if switchable feature CAS005 is installed                                      CAS005
      *                                                                                       CAS005
     C                     MOVE 'N'       CAS005  1                                           CAS005
     C                     CALL 'AOSARDR0'                                                    CAS005
     C                     PARM *BLANKS   PRTCD                                               CAS005
     C                     PARM '*VERIFY' POPTN                                               CAS005
     C                     PARM 'CAS005'  PSARD                                               CAS005
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS005
      *                                                                                       CAS005
     C           PRTCD     IFEQ *BLANKS                                                       CAS005
     C                     MOVE 'Y'       CAS005                                              CAS005
     C                     ELSE                                                               CAS005
     C           PRTCD     IFNE '*NRF   '                                                     CAS005
     C           *LOCK     IN   LDA                                                           CAS005
     C                     MOVE 'SCSARDPD'DBFILE                                              CAS005
     C                     MOVE 'CAS005'  DBKEY                                               CAS005
     C                     Z-ADD41        DBASE                                               CAS005
     C                     OUT  LDA                                                           CAS005
     C                     EXSR *PSSR                                                         CAS005
     C                     ENDIF                                                              CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CLE028
      ** Check System Value: Allow Repayments in Facility Currency?                           CLE036
      ** Set up parameter so access object checks FacilityCcyRepayment                        CLE036
     C                     MOVE *BLANKS   WPARM                                               CLE036
     C                     MOVEL'Facil'   WPARM1                                              CLE036
     C                     MOVEL'ityCc'   WPARM2                                              CLE036
     C                     MOVEL'yRepa'   WPARM3                                              CLE036
     C                     MOVEL'yment'   WPARM4                                              CLE036
     C                     MOVELWPARM     SVALK2                                              CLE036
      ** Check System Value: Use Original Borrower or Purchased From?                         207629
      ** Set up parameter so access object checks LoanCustOriginPurch                         207629
     C                     MOVE *BLANKS   WPARM                                               207629
     C                     MOVEL'LoanC'   WPARM1                                              207629
     C                     MOVEL'ustOr'   WPARM2                                              207629
     C                     MOVEL'iginP'   WPARM3                                              207629
     C                     MOVEL'urch'    WPARM4                                              207629
     C                     MOVELWPARM     SVALK1                                              207629
      * Call Access object:                                                                   207629
     C                     CALL 'AOSVALR0'                                                    207629
     C                     PARM           RTNCDE  7                                           207629
     C                     PARM           SVALK1 20                                           207629
     C                     PARM           SVAL1 200                                           207629
     C                     PARM           SVALK2 20                                           207629
     C                     PARM           SVAL2 200                                           207629
     C                     PARM           SVALK3 20                                           207629
     C                     PARM           SVAL3 200                                           207629
     C                     PARM           SVALK4 20                                           207629
     C                     PARM           SVAL4 200                                           207629
     C                     PARM           SVALK5 20                                           207629
     C                     PARM           SVAL5 200                                           207629
     C                     PARM           SVALK6 20                                           207629
     C                     PARM           SVAL6 200                                           207629
     C                     PARM           SVALK7 20                                           207629
     C                     PARM           SVAL7 200                                           207629
     C                     PARM           SVALK8 20                                           207629
     C                     PARM           SVAL8 200                                           207629
     C                     PARM           SVALK9 20                                           207629
     C                     PARM           SVAL9 200                                           207629
     C                     PARM           SVALK0 20                                           207629
     C                     PARM           SVAL10200                                           207629
      * If the system value is not found then issue a database error                          207629
      * unless batch mode, in which case default value to 'P'                                 216067
     C           RTNCDE    IFNE '        '                                                    207629
     C           PMODE     IFEQ 'B'                                                           216067
     C                     MOVE 'P'       PPCUST                                              216067
     C                     ELSE                                                               216067
     C           *LOCK     IN   LDA                                                           207629
     C                     MOVEL'SDSVALPD'DBFILE           ************                       207629
     C                     Z-ADD39        DBASE            * DBERR 39 *                       207629
     C                     MOVEL'SVALK1'  DBKEY            ************                       207629
     C                     OUT  LDA                                                           207629
     C                     EXSR *PSSR                                                         207629
     C                     ENDIF                                                              216067
     C                     ELSE                                                               207629
      * Isolate the first character of SVAL1 which = 'P' or 'O'.                              207629
     C                     MOVELSVAL1     WRK01   1        1 character fld                    207629
     C           WRK01     IFEQ 'O'                                                           207629
     C                     MOVE 'O'       PPCUST  1                                           207629
     C                     ELSE                                                               207629
     C                     MOVE 'P'       PPCUST                                              207629
     C                     ENDIF                                                              207629
      * Isolate the first character of SVAL2 which = 'Y' or 'N'.                              CLE036
     C                     MOVELSVAL2     WRK01                                               CLE036
     C           WRK01     IFEQ 'Y'                                                           CLE036
     C                     MOVE 'Y'       FREPAY  1                                           CLE036
     C                     MOVE *ON       *IN14                                               CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE *OFF      *IN14                                               CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              207629
      *                                                                                       207629
      ** Determine if Compliance Watch Enhancedment - CSD015                                  CSD015
      ** feature is installed.                                                                CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY 'POPTN                                               CSD015
     C                     PARM 'CSD015'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD56        DBASE                                               CSD015
     C                     MOVEL'CSD015'  DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015  1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'N'       CSD015                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Determine if Function Code is being monitored by                                     CSD015
      ** Compliance Watch.                                                                    CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*KEY    'POPTN                                               CSD015
     C                     PARM 'LENDING 'PFUNC   8                                           CSD015
     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SDWLCCPD'DBFILE                                              CSD015
     C                     Z-ADD57        DBASE                                               CSD015
     C                     MOVELPFUNC     DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCWCDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*FIRST  'POPTN                                               CSD015
     C           SDCWCD    PARM SDCWCD    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SDCWCDPD'DBFILE                                              CSD015
     C                     Z-ADD59        DBASE                                               CSD015
     C                     MOVELPOPTN     DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Determine if Cncord Interface Development  - CCF001                                  CSD015
      ** feature is installed.                                                                CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY 'POPTN                                               CSD015
     C                     PARM 'CCF001'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD58        DBASE                                               CSD015
     C                     MOVEL'CCF001'  DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CCF001  1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'N'       CCF001                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if switchable feature CAS009 is installed                                      CAS009
      *                                                                                       CAS009
     C                     MOVE 'N'       CAS009  1                                           CAS009
     C                     CALL 'AOSARDR0'                                                    CAS009
     C                     PARM *BLANKS   PRTCD                                               CAS009
     C                     PARM '*VERIFY' POPTN                                               CAS009
     C                     PARM 'CAS009'  PSARD                                               CAS009
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS009
      *                                                                                       CAS009
     C           PRTCD     IFEQ *BLANKS                                                       CAS009
     C                     MOVE 'Y'       CAS009                                              CAS009
     C                     ELSE                                                               CAS009
     C           PRTCD     IFNE '*NRF   '                                                     CAS009
     C           *LOCK     IN   LDA                                                           CAS009
     C                     MOVE 'SCSARDPD'DBFILE                                              CAS009
     C                     MOVE 'CAS009'  DBKEY                                               CAS009
     C                     Z-ADD42        DBASE                                               CAS009
     C                     OUT  LDA                                                           CAS009
     C                     EXSR *PSSR                                                         CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      *                                                                                     AR806351
      * CLE134 - Past Due Call Loans                                                        AR806351
      *                                                                                     AR806351
     C                     CALL 'AOSARDR0'                                                  AR806351
     C                     PARM *BLANK    PRTCD                                             AR806351
     C                     PARM '*KEY   ' POPTN                                             AR806351
     C                     PARM 'CLE134'  PSARD   6                                         AR806351
     C           SCSARD    PARM SCSARD    DSFDY                                             AR806351
      *                                                                                     AR806351
     C           PRTCD     IFEQ *BLANK                                                      AR806351
     C                     MOVE 'Y'       CLE134  1                                         AR806351
     C                     ELSE                                                             AR806351
     C                     MOVE 'N'       CLE134  1                                         AR806351
     C                     END                                                              AR806351
      *                                                                                     AR806351
     C/COPY WNCPYSRC,LE2110C003
      *
      ** Set Date Format Indicator *IN98  on if date format is MMDDYY
      *
     C           BJDFIN    IFEQ 'M'
     C                     MOVE *ON       *IN98
     C                     ENDIF
      *
      ** Set indicator if Authorisation for Manual Repayment required
      *
     C           BPMRAU    IFEQ 'Y'
     C           CLE002    ANDEQ'Y'                                       155610
     C                     MOVE *ON       *IN46
     C                     ENDIF
      *
     C                     MOVELBJRDNB    RUND    50
      *
     C                     Z-ADD0         WMAXIN 130
      *
      ** Clear 'Last Seq No. Allocated' FIELD
      *
     C                     Z-ADD0         SLASN1  30
     C                     MOVEL*BLANKS   WFMT    2
     C                     MOVEL*BLANKS   WWRTRN  2
      *
      ** Execute sub-routine to set up array of Branch Internal Customer
      ** Numbers.
      *
     C                     EXSR BCASR
     C                     MOVEL'LERMSGF 'ZAMSGF
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C                     MOVE 'F0'      WFMT
     C                     OPEN LE2110DF
     C                     ENDIF
      *
     C           PMODE     IFEQ 'R'
     C           PMODE     OREQ 'P'
     C                     OPEN LE2110PD
     C                     ENDIF
      *
     C           PMODE     IFEQ 'B'
     C                     OPEN LEIMRPPD                                  CAP063
     C                     MOVELPITUSR    @USER
     C**********           Z-ADD1         @ZMGRP                                              CSF002
     C**********           MOVE 'MARE'    @ZICDE                                              CSF002
     C                     MOVEL'00000'   @UNQCD                                              CSF002
     C                     MOVE '01812'   @UNQCD                                              CSF002
     C                     EXSR SRBTCH
     C                     ENDIF
      *
     C           PMODE     IFEQ 'P'
     C                     EXSR SRPLAY
     C                     ENDIF
      *                                                                   CAP063
     C           PMODE     IFEQ 'F'                                       CAP063
     C                     OPEN LEIMRPL1                                  CAP063
     C                     OPEN LEIMRPL2                                  CAP063
     C                     OPEN LEIMRPLX                                  CAP063
     C                     OPEN LE2110DF                                  CAP063
     C                     MOVE 'S0'      WFMT                            CAP063
     C                     MOVELUSER      SUSER                           CAP063
     C                     MOVE BJMRDT    SRUNA                           CAP063
     C                     MOVELWSID      SWSID                           CAP063
     C                     EXSR SRRAUT                                    CAP063
     C                     MOVE *ON       *IN65                           CAP063
     C                     ENDIF                                          CAP063
      *                                                                   123857
      ** Set on indicator that will disable F11 on auth. as needed        123857
      *                                                                   123857
     C           BPAURV    IFEQ 'Y'                                       123857
     C                     MOVE *ON       *IN45                           123857
     C                     ENDIF                                          123857
     C/COPY WNCPYSRC,LE2110C026
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRSTRT - First Screen Processing                              *
      * Called by: SRINIT                                             *
      * Calls    : SRSTR1, SRSTR2, SRCAUT, SRRAUT, SRFRMT, CLEAR      *
      *            SRINTL, SRXAUT                                     *
      *            SRWARN - Display warning message if loan is synd.  *   159256
      *****************************************************************
      *
     C           SRSTRT    BEGSR
      *
      ** Initialise work/screen fields
      *
     C                     EXSR SRSTR1
     C                     EXSR SRSTR2
     C                     EXSR SRSTR3
      *
     C           WFMT      DOWEQ'F0'
      *
     C                     WRITELE2110F0
     C                     WRITELE2110C1
     C                     EXFMTLE2110F1
     C                     MOVE 'N'       WEXIT   1
     C                     MOVE 'N'       WBLK
     C                     MOVE 'N'       WERR
      *
      ** Set off error indicators
      *
     C                     MOVEA'0000000' *IN,67
     C                     MOVEA'0000000' *IN,74
     C                     MOVEA'00000'   *IN,81
     C                     MOVE *OFF      *IN58
      *
     C                     EXSR CLEAR
     C/COPY WNCPYSRC,LE2110C010
      *
     C                     SELEC
      *
      ** F3 pressed
      *
     C           *INKC     WHEQ '1'
     C                     MOVE *BLANK    WFMT
     C                     LEAVE
      *
      ** F12 pressed
      *
     C           *INKL     WHEQ '1'
     C                     MOVE WWRTRN    WFMT
     C                     LEAVE
      *
      ** Check action code if enter is pressed
      *
     C           SACTN     WHEQ *BLANK
     C                     MOVE 'Y'       WBLK    1
      *
      ** If action code is blank, Requiring Authorisation field must be
      ** 'Y' or 'N'
      *
     C           SRAUT     IFEQ 'Y'
     C           SRAUT     OREQ 'N'
      *
     C           SLOAN     IFNE *BLANKS
     C                     MOVE 'N'       WBLK
     C                     MOVE *ON       *IN68
     C                     ENDIF
      *
     C           SVALD     IFNE *BLANKS
     C                     MOVE 'N'       WBLK
     C                     MOVE *ON       *IN69
     C                     ENDIF
      *
     C           SEVAL     IFNE *BLANKS
     C                     MOVE 'N'       WBLK
     C                     MOVE *ON       *IN70
     C                     ENDIF
      *
     C           SSEQN     IFNE *BLANKS
     C                     MOVE 'N'       WBLK
     C                     MOVE *ON       *IN71
     C                     ENDIF
      *
     C           SESEQ     IFNE *BLANKS
     C                     MOVE 'N'       WBLK
     C                     MOVE *ON       *IN72
     C                     ENDIF
      *
     C           WBLK      IFEQ 'N'
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0004' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     EXSR SRRAUT
     C                     ENDIF
      *
     C           WERR      IFNE 'Y'
     C                     MOVE 'S0'      WFMT
     C                     LEAVE
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           SRAUT     IFNE 'Y'
     C           SRAUT     ANDNE'N'
     C                     MOVE *ON       *IN74
     C                     MOVE 'LEM0007' ZAMSID
     C                     MOVE 'Y'       WERR
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** Action code is not blank;  Action code must be valid
      *
     C                     OTHER
     C           SACTN     IFNE 'X'
     C           SACTN     ANDNE'A'
     C           SACTN     ANDNE'R'
     C           SACTN     ANDNE'E'
     C           SACTN     ANDNE'I'
     C           SACTN     ANDNE*BLANK
     C                     MOVE *ON       *IN67
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0021' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C           WERR      IFNE 'Y'
     C                     EXSR SRINTL
     C                     ENDIF
      *
      ** Check user/action/branch/authority checks
      *
     C           WERR      IFNE 'Y'
     C                     EXSR SRCAUT
     C                     ENDIF
      *
      ** Action code is Authorise
      *
     C           SACTN     IFEQ 'X'
     C           WERR      ANDNE'Y'
     C                     EXSR SRXAUT
     C                     ENDIF
      *                                                                   159256
      ** Issue warning if changing a syndicated transaction.              159256
      *                                                                   159256
     C           SACTN     IFNE 'E'                                       159256
     C           SACTN     ANDNE*BLANK                                    159256
     C                     EXSR SRWARN                                    159256
     C           WE232     IFNE *BLANK                                    159256
     C                     MOVEA'11'      *IN,67                          159256
     C                     ENDIF                                          159256
     C                     ENDIF                                          159256
      *
     C           WBLK      IFNE 'Y'
     C           WERR      ANDNE'Y'
     C           WARN      ANDNE'Y'                                       159257
     C           WWRTRN    IFNE 'S0'
     C                     MOVEL'F0'      WWRTRN
     C                     ENDIF
     C                     MOVEL'D1'      WFMT
     C                     EXSR SRFRMT
     C                     ENDIF
     C                     ENDSL
      *
     C                     ENDDO
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRRAUT   - Validate Review from Loan number field and setup   *
      *          - work fields for subfile                            *
      * Called by: SRSTRT, SRSUBF                                     *
      * Calls    : ZASNMS                                             *
      *****************************************************************
     C           SRRAUT    BEGSR
      *
     C                     MOVE *BLANKS   WNUM7
     C                     MOVE *BLANKS   WALF6
      *
     C           SRFLN     IFNE *BLANKS
     C                     MOVELSRFLN     WNUM7
     C                     MOVELWNUM7     WALF6
     C           SRFLN     IFNE WALF6
     C                     MOVE '1'       *IN73
     C                     MOVEL'LEM0019' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'Y'       WERR
     C                     ELSE
     C                     MOVE 'N'       WINSC
     C                     ENDIF
     C                     ENDIF
      *
     C           SRAUT     IFEQ *BLANK
     C                     MOVE 'N'       SRAUT
     C                     ENDIF
      *
     C           SRAUT     IFNE 'Y'
     C           SRAUT     ANDNE'N'
     C           SRAUT     ANDNE*BLANK
     C                     MOVE '1'       *IN74
     C                     MOVEL'LEM0007' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'Y'       WERR
     C                     ENDIF
      *
     C           WERR      IFNE 'Y'
     C                     MOVE SRAUT     WAUTH   1
     C                     MOVE SRFLN     WLNRFS  6
     C                     MOVE SRFLN     WLNRF
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRINTL   - Initial validations                                *
      * Called by: SRSTRT, SRBTCH                                     *
      * Calls    : SRINT1, ZASNMS                                     *
      *****************************************************************
     C           SRINTL    BEGSR
      *
     C                     Z-ADD0         WDAYNV
     C                     Z-ADD0         WDAYNE
     C                     MOVE *BLANKS   WNUM7
     C                     MOVE *BLANKS   WNUM4
     C                     MOVE *BLANKS   WALF6
     C                     MOVE *BLANKS   WALF3
     C                     MOVE *BLANKS   WREAC   1                       CLE007
     C                     MOVE 'N'       WMTPD   1
      *
      ** Validate Loan Ref
      *
     C**********           MOVE SLOAN     WLOAN   60                                          CLE148
     C                     MOVE SLOAN     WLOAN   6                                           CLE148
     C                     MOVE SLOAN     WLNRF
     C           KCLOAN    CHAINCLOAN               N39
      *
     C           *IN39     IFEQ '0'
     C/COPY WNCPYSRC,LEH00605
     C           RECIL     IFEQ 'R'                                       131253
     C***********RECI      IFEQ 'R'                                       131253
     C                     MOVE *ON       *IN68
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0025' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO ENDINT
     C                     ENDIF
      ** Validate the Repayment currency field if repayments                                  CLE036
      ** in facility ccy are allowed:                                                         CLE036
      ** If Manual Repayment is not linked to another loan amendment                          CLE036
      ** Repayment currency must be either loan ccy or facility ccy:                          CLE036
     C                     MOVE *OFF      *IN15                                               CLE036
      *                                                                                       CLE036
     C           FREPAY    IFEQ 'Y'                                                           CLE036
     C           SRCCY     IFNE CCYL                                                          CLE036
     C           SRCCY     ANDNEFCCYL                                                         CLE036
     C           SACTN     ANDEQ'I'                                                           CLE036
     C           SESEQ     IFEQ *BLANKS                                                       CLE036
     C           SESEQ     OREQ 'LN'                                                          CLE036
     C                     MOVE 'Y'       WERR                                                CLE036
     C                     MOVE *ON       *IN15                                               CLE036
     C                     MOVE 'LEM0312' ZAMSID                                              CLE036
     C                     EXSR ZASNMS                                                        CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           *IN44     IFEQ *ON                                                           CLE036
     C           *IN15     ANDEQ*OFF                                                          CLE036
     C                     MOVE SRCCY     SEXCY                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           SRCCY     IFNE *BLANKS                                                       CLE036
     C           SACTN     ANDNE'I'                                                           CLE036
     C                     MOVE 'Y'       WERR                                                CLE036
     C                     MOVE *ON       *IN15                                               CLE036
     C                     MOVE 'LEM0314' ZAMSID                                              CLE036
     C                     EXSR ZASNMS                                                        CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *
      ** Allow manual repayments on a matured loan for CLE007, for the    CLE007
      ** purpose of entering past due settlements due at maturity date,   CLE007
      ** and thereby, re-activating the matured loan                      CLE007
      *                                                                   CLE007
     C***********RECI      IFEQ 'M'                                       131253
     C           RECIL     IFEQ 'M'                                       131253
     C           CLE007    ANDEQ'N'                                       CLE007
     C                     MOVE *ON       *IN68
     C                     MOVE 'Y'       WERR
     C***********          MOVE 'LEM0026' ZAMSID                          CLE007
     C                     MOVE 'LEM0027' ZAMSID                          CLE007
     C                     EXSR ZASNMS
     C                     GOTO ENDINT
     C                     ENDIF
      *
     C***********RECI      IFNE 'D'                                       131253
     C***********RECI      ANDNE'R'                                       131253
     C***********RECI      ANDNE'M'                                       131253
     C           RECIL     IFNE 'D'                                       131253
     C           RECIL     ANDNE'R'                                       131253
     C           RECIL     ANDNE'M'                                       131253
     C                     MOVE *ON       *IN68
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0025' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO ENDINT
     C                     ENDIF
      *
     C                     ELSE
     C                     MOVE *ON       *IN68
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0032' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO ENDINT
     C                     ENDIF
      *                                                                   CLE005
      ** If CLE005 is not installed, do not allow repayments for loans    CLE005
      ** with processing type 68,69,71 or 72                              CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'N'                                       CLE005
     C           PTYPL     IFEQ 68                                        CLE005
     C           PTYPL     OREQ 69                                        CLE005
     C           PTYPL     OREQ 71                                        CLE005
     C           PTYPL     OREQ 72                                        CLE005
     C                     MOVE *ON       *IN68                           CLE005
     C                     MOVE 'Y'       WERR                            CLE005
     C                     MOVE 'LEM0030' ZAMSID                          CLE005
     C                     EXSR ZASNMS                                    CLE005
     C                     GOTO ENDINT                                    CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                                       CLE028
      ** If CLE028 is not installed, do not allow repayments for                              CLE028
      ** flat rate personal loans                                                             CLE028
      *                                                                                       CLE028
     C           CLE028    IFNE 'Y'                                                           CLE028
     C           PTYPL     ANDEQ80                                                            CLE028
     C                     MOVE *ON       *IN68                                               CLE028
     C                     MOVE 'Y'       WERR                                                CLE028
     C                     MOVE 'LEM0400' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     GOTO ENDINT                                                        CLE028
     C                     ENDIF                                                              CLE028
      *                                                                   CLE007
      ** If trying to re-activate a matured loan, facility must exist     CLE007
      ** and not yet expired                                              CLE007
      *                                                                   CLE007
     C           CLE007    IFEQ 'Y'                                       CLE007
     C           RECIL     ANDEQ'M'                                       131253
     C***********RECI      ANDEQ'M'                                CLE007 131253
     C                     MOVE 'A'       WRCDT1                          CLE007
     C                     MOVE FCUS      WFCUS                           CLE007
     C                     MOVE FTYP      WFTYP                           CLE007
     C                     MOVE FSEQ      WFSEQ                           CLE007
      *                                                                   CLE007
     C           KFCLT     CHAINFCLTY               N50                   CLE007
     C           *IN50     IFEQ '1'                                       CLE007
     C           *IN50     OREQ '0'                                       CLE007
     C           RECIF     ANDEQ'E'                                       CLE007
     C           *IN50     OREQ '0'                                       143795
     C           RECIF     ANDEQ'C'                                       143795
     C           CLE005    ANDEQ'Y'                                       143795
      *                                                                   150496
     C                     MOVE *BLANKS   WRECT   1                       150496
     C           *IN50     IFEQ '0'                                       150496
     C***********          MOVE SVALD     ZDATE                    150496 153357
     C***********          EXSR ZDATE1                             150496 153357
     C************IN99     IFEQ '0'                                150496 153357
      *  Reuse indicator *IN15:                                                               CLE036
     C                     MOVE *IN15     WIN15   1                                           CLE036
      *                                                                   150496
      ** Check if facility was reactivated                                150496
      *                                                                   150496
     C           KFCAM     SETLLLEFCAML3                                  150496
     C           KFCAM     READELEFCAML3                 15               150496
     C           *IN15     DOWEQ'0'                                       150496
     C           FATP      ANDNE'FR'                                      150496
     C           *IN15     OREQ '0'                                       153357
     C           FATP      ANDEQ'FR'                                      153357
     C           RECIC     ANDNE'D'                                       153357
     C           KFCAM     READELEFCAML3                 15               150496
     C                     ENDDO                                          150496
     C           *IN15     IFEQ '0'                                       150496
     C           FATP      ANDEQ'FR'                                      150496
     C           RECIC     ANDEQ'D'                                       153357
     C***********ZDAYNO    ANDGEVLDTC                              150496 153357
     C                     MOVE 'Y'       WRECT                           150496
     C                     ENDIF                                          150496
     C***********          ENDIF                                   150496 153357
     C                     ENDIF                                          150496
      *                                                                   150496
     C           WRECT     IFEQ *BLANKS                                   150496
     C                     MOVE *ON       *IN68                           CLE007
     C                     MOVE 'Y'       WERR                            CLE007
     C***********RECIF     IFEQ 'C'                                143795 153357
     C                     MOVE WIN15     *IN15                                               CLE036
     C           *IN50     IFEQ '1'                                       153357
     C                     MOVE 'LEM0057' ZAMSID                          143795
     C                     ELSE                                           143795
     C                     MOVE 'LEM0056' ZAMSID                          CLE007
     C                     ENDIF                                          143795
     C                     EXSR ZASNMS                                    CLE007
     C                     GOTO ENDINT                                    CLE007
     C                     ENDIF                                          150496
     C                     ENDIF                                          CLE007
     C                     MOVE 'Y'       WREAC                           CLE007
     C                     ENDIF                                          CLE007
      *
      ** Set indicator for Processing Type 70
      *
     C           PTYPL     COMP 70                       63
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           PTYPL     ANDEQ71                                        CLE005
     C                     MOVE '1'       *IN63                           CLE005
     C                     ENDIF                                          CLE005
      *
      ** Check users access to action, and if multibranching
      ** access to branch code
      ** Validate users authority to use this branch/action
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
      *
     C                     Z-ADD*ZERO     @ERR
      *
     C           MBIN      IFEQ 'N'
      *
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBACTU'
     C                     PARM SACTN     @ZACTN
     C                     PARM           @USER
     C**********           PARM           @ZMGRP                                              CSF002
     C**********           PARM           @ZICDE                                              CSF002
     C                     PARM           @UNQCD                                              CSF002
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVACTU'
     C                     PARM SACTN     @ZACTN  1
     C                     PARM           @ERR    10
     C                     ENDIF
      *
     C                     ELSE
      *
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBACTBU'
     C                     PARM SACTN     @ZACTN
     C                     PARM BRCA      @ZBR
     C                     PARM           @USER  10
     C**********           PARM           @ZMGRP  40                                          CSF002
     C**********           PARM           @ZICDE  4                                           CSF002
     C                     PARM           @UNQCD 10                                           CSF002
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVACTBU'
     C                     PARM SACTN     @ZACTN  1
     C                     PARM BRCA      @ZBR    3
     C                     PARM           @ERR    10
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           @ERR      IFNE *ZERO
     C           MBIN      IFEQ 'N'
     C           @ERR      IFEQ 1
     C                     MOVE 'LEM0302' ZAMSID
     C                     ENDIF
     C                     ELSE
     C           @ERR      IFEQ 1
     C                     MOVE 'LEM0303' ZAMSID
     C                     ENDIF
     C           @ERR      IFEQ 2
     C                     MOVE 'LEM0304' ZAMSID
     C                     ENDIF
     C                     ENDIF
     C                     SETON                     6768
     C                     MOVE 'Y'       WERR
     C                     EXSR ZASNMS
     C                     GOTO ENDINT
     C                     ENDIF
      *
      ** Validate users access to originating branch
      *
     C           MBIN      IFEQ 'Y'
     C           BKOBRU    ANDEQ'Y'
     C           BKOBUV    ANDEQ'Y'
     C           SACTN     ANDNE'E'
      *
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBOBU'
     C                     PARM ORBR      @ZOBRX
     C                     PARM           @USER
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVOBU'
     C                     PARM ORBR      @ZOBRX  3
     C                     PARM           @ERR    10
     C                     ENDIF
     C           @ERR      IFNE *ZERO
     C           @ERR      IFEQ 1
     C                     MOVE 'LEM0305' ZAMSID
     C                     ENDIF
     C           @ERR      IFEQ 2
     C                     MOVE 'LEM0306' ZAMSID
     C                     ENDIF
     C                     SETON                     6768
     C                     MOVE 'Y'       WERR
     C                     EXSR ZASNMS
     C                     GOTO ENDINT
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2110C011
      *
      ** Validate value date
      *
     C           WTINL     IFEQ 'G'
     C                     MOVE '1'       *IN61
     C                     ELSE
     C           WTINL     IFLT 'G'
     C                     MOVE '1'       *IN60
     C                     ELSE
     C                     MOVE '0'       *IN60
     C                     MOVE '0'       *IN67
     C                     ENDIF
     C                     ENDIF
     C           WTINL     COMP 'N'                  62
     C           *IN61     IFEQ '1'
     C                     Z-ADDWTRT      WTXRT  117
     C                     ENDIF
      *
     C           PTYPL     LOKUPTABSLD                   52
      *
     C           PTYPL     IFEQ 64
     C           PTYPL     OREQ 65
     C           PTYPL     OREQ 68                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C                     MOVE *ON       *IN53
     C                     ENDIF
      *
      ** Save Bkg. Branch in unique field
      *
     C                     MOVE BRCA      WBRCDA  3
      *
      ** Save last change type for CLOAN
      *
     C                     MOVE LSTC      WLSTCL 11
      *
     C                     MOVELSVALD     WNUM7   70
     C                     MOVELWNUM7     WALF6   6
     C           SVALD     IFEQ WALF6
     C                     MOVE SVALD     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    WDAYNV  50
     C                     ELSE
     C                     MOVE *ON       *IN69
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0105' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C           *IN99     IFEQ *OFF
      *
     C           MDAT      COMP 0                        42
     C           *IN69     IFEQ '0'
     C                     MOVE '0'       *IN41                           115134
     C           CLE003    IFNE 'Y'                                       115134
     C           WDAYNV    ANDLEVDAT                                      115134
     C           CLE003    OREQ 'Y'                                       115134
     C           WDAYNV    ANDLTVDAT                                      115134
     C                     MOVE '1'       *IN41                           115134
     C                     ENDIF                                          115134
      *
      ** Value date must be less than or equal to maturity date
      *
     C           *IN41     IFEQ '0'
     C           *IN42     ANDEQ'0'
     C           WDAYNV    COMP MDAT                 41
     C/COPY WNCPYSRC,LE2110C012
     C                     ENDIF
     C           *IN41     IFEQ '1'
     C           RECIL     IFEQ 'D'                                                         AR317587
     C           MDAT      ANDLTBJRDNB                                                      AR317587
     C           CPAM      ANDNE*ZERO                                                       AR317587
     C           WDAYNV    ANDGEVDAT                                                        AR317587
     C           SEVAL     ANDNE*BLANKS                                                     AR317587
     C           RECIL     OREQ 'D'                                                         AR317587
     C           MDAT      ANDLTBJRDNB                                                      AR317587
     C           PDIN      ANDNE*ZERO                                                       AR317587
     C           WDAYNV    ANDGEVDAT                                                        AR317587
     C           SEVAL     ANDNE*BLANKS                                                     AR317587
     C                     ELSE                                                             AR317587
     C                     MOVE *ON       *IN69
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0103' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF                                                            AR317587
     C                     ENDIF
     C                     ENDIF
      *                                                                   CLE005
      ** If CLE005 is NOT installed, value date must not be               CLE005
      ** later than rundate                                               CLE005
      *                                                                   CLE005
     C           *IN69     IFEQ '0'                                       CLE005
     C           CLE005    ANDEQ'N'                                       CLE005
     C           WDAYNV    ANDGTRUND                                      CLE005
     C                     MOVE *ON       *IN69                           CLE005
     C                     MOVE 'Y'       WERR                            CLE005
     C                     MOVE 'LEM0199' ZAMSID                          CLE005
     C                     EXSR ZASNMS                                    CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE007
      ** If CLE007 is installed, and a matured loan is being processed,   CLE007
      ** value date should equal maturity date                            CLE007
      *                                                                   CLE007
     C           CLE007    IFEQ 'Y'                                       CLE007
     C           RECIL     ANDEQ'M'                                       131253
     C***********RECI      ANDEQ'M'                                CLE007 131253
     C           *IN69     ANDEQ'0'                                       CLE007
     C           WDAYNV    ANDNEMDAT                                      CLE007
     C                     MOVE *ON       *IN69                           CLE007
     C                     MOVE 'Y'       WERR                            CLE007
     C                     MOVE 'LEM0028' ZAMSID                          CLE007
     C                     EXSR ZASNMS                                    CLE007
     C                     ENDIF                                          CLE007
      *
      ** Determine limit of back validation;  if CLE003
      ** Customer Lending Enchancements Backvaluation is OFF
      *
     C           *IN87     IFEQ *OFF
      *
     C           RUND      SUB  BVLP      WBVLMT  50
     C           SLID      COMP WBVLMT                 40
     C           *IN69     IFEQ *OFF
     C           *IN40     IFEQ *ON
     C           WDAYNV    COMP SLID                   41
     C                     ELSE
     C           WDAYNV    COMP WBVLMT                 41
     C                     ENDIF
     C           *IN41     IFEQ *ON
     C                     MOVE *ON       *IN69
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0111' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ELSE
     C                     MOVE *ON       *IN69
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0105' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                   CLE014
      ** Manual repayments for loans with a multi-currency rollover       CLE014
      ** date may not be entered on non-working days after the rollover   CLE014
      ** date if CLE014 is on.                                            CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           *IN69     ANDEQ*OFF                                      CLE014
     C           RLDT      ANDNE*ZERO                                     CLE014
      *                                                                   CLE014
     C                     MOVE WRCDT     WRCDTX  1                       CLE014
     C                     MOVE 'B'       WRCDT                           CLE014
     C********** KCLOAN    CHAINCLOANCKF             80                   CLE014              209161
     C           KCLOAN    CHAINCLOANCKF            N80                                       209161
      *                                                                   CLE014
     C           *IN80     IFEQ *OFF                                      CLE014
     C           NCCY      ANDNE*BLANKS                                   CLE014
     C           NCCY      ANDNECCYL                                      CLE014
      *                                                                   CLE014
     C                     Z-ADDRLDT      ZDAYNO                          CLE014
     C                     MOVE LOCY      ZCCY                            CLE014
     C                     MOVE *BLANKS   ZLOC                            CLE014
     C                     Z-ADD1         ZNRDYS                          CLE014
     C                     EXSR ZFWDT                                     CLE014
      *                                                                   CLE014
     C           WDAYNV    IFGT RLDT                                      CLE014
     C           WDAYNV    ANDLTZDYNBR                                    CLE014
     C                     MOVE *ON       *IN69                           CLE014
     C                     MOVE 'Y'       WERR                            CLE014
     C                     MOVE 'LEM0038' ZAMSID                          CLE014
     C                     EXSR ZASNMS                                    CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** Back valued manual repayment is prohibited when rollover         CLE014
      ** details exist                                                    CLE014
      *                                                                   CLE014
     C***********RLDT      IFLT BJRDNB                              CLE014CSC011
     C***********WDAYNV    ANDLTBJRDNB                              CLE014CSC011
     C           RLDT      IFLT WRNDAY                                    CSC011
     C           WDAYNV    ANDLTWRNDAY                                    CSC011
     C           WDAYNV    ANDGTRLDT                                      CLE014
     C                     MOVE *ON       *IN69                           CLE014
     C                     MOVE 'Y'       WERR                            CLE014
     C                     MOVE 'LEM0039' ZAMSID                          CLE014
     C                     EXSR ZASNMS                                    CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     MOVE WRCDTX    WRCDT                           CLE014
      *                                                                   CLE014
     C                     ENDIF                                          CLE014
      *
      ** Validate Sequence No
      *
     C           SSEQN     IFEQ *BLANKS
     C           SACTN     ANDNE'I'
     C                     MOVE *ON       *IN71
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0107' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C           SSEQN     IFNE *BLANKS
     C           SACTN     ANDEQ'I'
     C                     MOVE *ON       *IN71
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0108' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     MOVELSSEQN     WNUM4   40
     C                     MOVELWNUM4     WALF3   3
     C           SSEQN     COMP WALF3                4141
     C           *IN41     IFEQ *OFF
     C           SSEQN     COMP '000'                    41
     C                     ENDIF
     C           SACTN     IFNE 'I'
     C           *IN71     ANDEQ'0'
     C           *IN41     ANDEQ'1'
     C                     MOVE *ON       *IN71
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0031' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** Validate expected value date
      *
     C           SACTN     IFNE 'I'
     C           SEVAL     ANDNE*BLANKS
     C           PMODE     ANDNE'B'                                       193064
     C                     MOVE *ON       *IN70
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0109' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** Processing for discounted loans must be to settle an
      ** expected repayment
      *
     C           PTYPL     IFEQ 63
     C           PTYPL     OREQ 65
     C           PTYPL     OREQ 67
     C           SACTN     IFNE 'I'
     C           SEVAL     OREQ *BLANKS
     C                     MOVE *ON       *IN70
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0102' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
     C           *IN70     IFEQ *OFF
      *
     C                     MOVELSEVAL     WNUM7
     C                     MOVELWNUM7     WALF6
     C           SEVAL     IFNE *BLANKS
     C           SEVAL     IFEQ WALF6
     C                     MOVELSEVAL     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    WDAYNE  50
     C                     ELSE
     C                     MOVE *ON       *IN70
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0104' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C           *IN99     IFEQ *OFF
      *
     C           *IN70     IFEQ *OFF
     C           WDAYNE    COMP VDAT                   4141
      *
      ** Expected value date must be less than or equal to maturity date
      *
     C           *IN41     IFEQ '0'
     C           *IN42     ANDEQ'0'
     C           WDAYNE    COMP MDAT                 41
     C                     ENDIF
     C           *IN41     IFEQ '1'
     C                     MOVE *ON       *IN70
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0106' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ELSE
     C                     MOVE *ON       *IN70
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0104' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate Expected Sequence No.
      *
     C           SACTN     IFNE 'I'
     C           SESEQ     ANDNE*BLANKS
     C           PMODE     ANDNE'B'                                       193064
     C                     MOVE *ON       *IN72
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0110' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C           SACTN     IFEQ 'I'
     C           SESEQ     IFEQ *BLANKS
     C           SEVAL     ANDNE*BLANKS
     C           *IN72     ANDEQ*OFF
     C                     MOVE *ON       *IN72
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0202' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO ENDINT
     C                     ENDIF
      *
     C           SESEQ     IFNE *BLANKS
     C           SEVAL     ANDEQ*BLANKS
     C           *IN72     ANDEQ*OFF
     C                     MOVE *ON       *IN70
     C                     MOVE *ON       *IN72
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0210' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO ENDINT
     C                     ENDIF
     C                     ENDIF
      *
      ** Expected Seq No can be 'LN' or Numeric
      *
     C           SACTN     IFEQ 'I'
     C           *IN72     IFEQ *OFF
      *
     C           SESEQ     COMP 'LN '                    44
      *
     C           SESEQ     IFNE *BLANKS
     C           *IN44     IFEQ *OFF
     C                     MOVELSESEQ     WNUM4
     C                     MOVELWNUM4     WALF3
     C           SESEQ     COMP WALF3                7272
     C           *IN72     IFEQ *OFF
     C           SESEQ     COMP '000'                    72
     C                     ENDIF
     C           *IN72     IFEQ *ON
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0031' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO ENDINT
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** Additional validation for valid individual fields
      ** Move expected input fields into output fields for insert
      *
     C           SACTN     IFEQ 'I'
     C                     MOVE SEVAL     EDAT
     C                     MOVE SESEQ     ESEQ
     C                     ENDIF
      *
     C           *IN68     IFEQ *ON
     C           *IN69     OREQ *ON
     C           *IN71     OREQ *ON
     C                     GOTO ENDINT
     C                     ENDIF
      *
     C                     Z-ADDWDAYNV    WVALD
     C                     MOVE SSEQN     SLASN
      *
     C           KLMKEY    CHAINLOAMS               N50
     C                     MOVE OSBR      W#OSBR                                              210119
     C*                                                                   143802
     C**Save principal amount in case assigment is to be amended          143802
     C*                                                                   143802
     C           *LIKE     DEFN PRAM      W#PRLA                          143802
     C                     Z-ADD0         W#PRLA                          143802
     C                     MOVE PRAM      W#PRLA                          143802
     C*                                                                   143802
     C           SACTN     IFNE 'I'
     C***********SACTN     IFNE 'E'                                       159256
     C***********RECI      ANDEQ'R'                                       159256
     C           SACTN     IFEQ 'E'                                       159256
     C           RECI      ANDNE'R'                                       159256
     C           RECI      ANDNE'D'                                       159256
     C           AMTP      ANDEQ'MR'
     C           SACTN     ORNE 'E'
     C           RECI      ANDNE'D'
     C           AMTP      ANDEQ'MR'
     C           *IN50     OREQ '1'                                       159256
     C                     SETON                     686971
     C                     MOVE 'Y'       WERR
     C           *IN50     IFEQ '1'                                       159256
     C                     MOVE 'LEM0176' ZAMSID                          159256
     C                     ELSE                                           159256
     C                     MOVE 'LEM0001' ZAMSID
     C                     ENDIF                                          159256
     C                     EXSR ZASNMS
     C                     GOTO ENDINT
     C                     ENDIF
      *
     C***********RECI      IFEQ 'D'                                       159256
     C***********AMTP      ANDNE'MR'                                      159256
     C           AMTP      IFNE 'MR'                                      159256
     C                     SETON                     686971
     C           AMTP      IFEQ 'RE'
     C                     MOVE 'LEM0002' ZAMSID
     C                     ENDIF
     C           AMTP      IFEQ 'PD'
     C                     MOVE 'LEM0003' ZAMSID
     C                     ELSE
     C                     MOVE 'LEM0008' ZAMSID
     C                     ENDIF
     C                     MOVE 'Y'       WERR
     C                     EXSR ZASNMS
     C                     GOTO ENDINT
     C                     ENDIF
     C                     ENDIF
      *                                                                   163937
      ** Save Generated by assignment indicator of the manual repayment   163937
      *                                                                   163937
     C                     MOVE ' '       WGASS   1                       163937
     C           *IN50     IFEQ '0'                                       163937
     C           SACTN     ANDNE'I'                                       163937
     C           WERR      ANDNE'Y'                                       163937
     C                     MOVE GASS      WGASS                           163937
     C                     ENDIF                                          163937
     C                     MOVE OSBR      W#OSBR                          217046
      *
     C                     EXSR SRINT1
      *                                                                   159257
      ** Produce new warning message if new loan reference is entered     159257
      *                                                                   159257
     C           W#LOAN    IFNE WLOAN                                     159257
     C                     MOVE *BLANK    WARN                            159257
     C                     ENDIF                                          159257
     C**********           Z-ADDWLOAN     W#LOAN  60                                   159257 CLE148
     C                     MOVELWLOAN     W#LOAN  6                                           CLE148
      *                                                                   159257
      ** Check LELOAML6 for any past due records if there are no errors   159257
      ** so far, and expected value date not entered and warning has      159257
      ** not been previously issued.                                      159257
      *                                                                   159257
     C           WERR      IFNE 'Y'                                       159257
     C           SACTN     ANDEQ'I'                                       159257
     C           WARN      ANDEQ*BLANKS                                   159257
     C           SEVAL     ANDEQ*BLANKS                                   159257
      *                                                                   159257
      ** Issue warning if past due record exists                          159257
      *                                                                   159257
     C           WLOAN     SETLLLOAML6                   20               159257
     C           *IN20     IFEQ *ON                                       159257
     C                     MOVE 'Y'       WWERR                           159257
     C                     MOVE 'LEM0231' ZAMSID                          159257
     C                     EXSR ZASNMS                                    159257
     C                     MOVE *BLANK    WWERR                           159257
     C           PMODE     IFNE 'B'                                       159257
     C                     MOVE 'Y'       WARN    1                       159257
     C                     ENDIF                                          159257
     C                     MOVE *ON       *IN68                           159257
     C                     ENDIF                                          159257
     C                     ELSE                                           159257
     C                     MOVE *BLANK    WARN                            159257
     C                     ENDIF                                          159257
      *                                                                   159257
     C/COPY WNCPYSRC,LEH00604
      *
     C           ENDINT    ENDSR
      *
      /EJECT
      *****************************************************************
      * SRINT1   - Initial validations                                *
      * Called by: SRINTL, SRSUBP                                     *
      * Calls    : SRMINI, ZASNMS                                     *
      *****************************************************************
     C           SRINT1    BEGSR
      *
     C           SACTN     IFNE 'I'
      *
      ** Save last change details of record
      *
     C                     MOVE LSTC      WLSTCA 11
     C                     MOVE AMT       SAMT
     C                     MOVE FRAMT     FSAMT                                               CLE036
     C                     MOVE DETS      SDETS
     C                     MOVE OSBR      WOSBR   3
      *
      ** Format expected date and sequence
      *
     C                     MOVE XAVD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     EDAT
     C                     MOVE XASQ      ESEQ
     C           *IN99     IFEQ *ON
     C                     MOVE '      '  EDAT
     C                     MOVE '   '     ESEQ
     C                     ENDIF                                      C
      *
      ** Check expected value date and seq no Loan Amendment
      *
     C                     Z-ADDXAVD      WVALD          47
     C                     Z-ADDXASQ      SLASN
      *
     C                     EXSR SRMINI
      *
     C           ASTS      IFEQ 'C'
     C                     MOVE *BLANKS   SSTAT
     C***********          MOVELWSTAT,1   SSTAT                           123998
     C                     MOVEL'LEM0060' ZAMSID                          123998
     C                     ENDIF
     C           ASTS      IFEQ 'R'
     C                     MOVE *BLANKS   SSTAT
     C***********          MOVELWSTAT,2   SSTAT                           123998
     C                     MOVEL'LEM0061' ZAMSID                          123998
     C                     ENDIF
     C           ASTS      IFEQ 'A'
     C                     MOVE *BLANKS   SSTAT
     C***********          MOVELWSTAT,3   SSTAT                           123998
     C                     MOVEL'LEM0062' ZAMSID                          123998
     C                     ENDIF
     C           ASTS      IFEQ 'D'
     C                     MOVE *BLANKS   SSTAT
     C***********          MOVELWSTAT,4   SSTAT                           123998
     C                     MOVEL'LEM0063' ZAMSID                          123998
     C                     ENDIF
      *
     C                     EXSR SRTEXT                                    123998
     C                     MOVELZAMSTX    SSTAT                           123998
     C                     MOVE *BLANKS   ZAMSID                          123998
      *                                                                   123998
     C                     ENDIF
      *
     C           SACTN     IFEQ 'I'
     C                     Z-ADDWDAYNE    WVALD          47
     C                     MOVE SESEQ     SLASN
     C                     ENDIF
      *
     C           *IN44     IFEQ '0'
     C           *IN47     IFEQ *ON
     C                     GOTO ENINT1
     C                     ENDIF
      *
     C           KLMKEY    CHAINLOAMD                50
     C           SACTN     IFEQ 'I'
     C           RECIA     ANDNE'D'
     C           SACTN     OREQ 'I'                                       CAP063
     C           *IN50     ANDEQ*ON                                       CAP063
     C           *IN50     OREQ *ON                                       186072
     C                     SETON                     686971
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0176' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO ENINT1
     C                     ENDIF
      *
      * IF NOT PD OR RE, ERROR
      *
     C           RECIA     IFEQ 'D'
     C           AMTPA     ANDNE'RE'
     C           AMTPA     ANDNE'PD'
     C           SACTN     ANDEQ'I'
     C                     SETON                     7072
     C                     ENDIF
      *
     C           SACTN     IFEQ 'I'
     C           *IN70     ANDEQ*OFF
     C           *IN72     ANDEQ*OFF
     C           AUTOA     ANDNE'N'
     C                     SETON                     7072
     C                     ENDIF
      *                                                                                       CLE036
      ** Save currency of expected payment.                                                   CLE036
     C           SACTN     IFEQ 'I'                                                           CLE036
     C           *IN70     ANDEQ*OFF                                                          CLE036
     C           *IN72     ANDEQ*OFF                                                          CLE036
     C           FRCYA     IFNE *BLANKS                                                       CLE036
     C           *IN14     ANDEQ*ON                                                           CLE036
     C                     MOVE FRCYA     SEXCY            Expected CCY                       CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE CCYA      SEXCY                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
      * Currency entered by User must match Expected currency:                                CLE036
     C           SESEQ     IFNE *BLANKS                                                       CLE036
     C           SESEQ     ANDNE'LN'                                                          CLE036
     C           SRCCY     ANDNESEXCY                                                         CLE036
     C           SACTN     ANDNE'I'                                                           257369
     C                     MOVELSEXCY     ZAMSDA    P                                         CLE036
     C                     MOVE 'Y'       WERR                                                CLE036
     C                     MOVE *ON       *IN15                                               CLE036
     C                     MOVE 'LEM0313' ZAMSID                                              CLE036
     C                     EXSR ZASNMS                                                        CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *
     C           *IN70     IFEQ *ON
     C           *IN72     ANDEQ*ON
     C                     MOVE 'Y'       WERR
     C***********          MOVE 'LEM0176' ZAMSID                          123856
     C                     MOVE 'LEM0307' ZAMSID                          123856
     C                     EXSR ZASNMS
     C                     GOTO ENINT1
     C                     ENDIF
      *
      ** As fees processing is no longer performed by this program
      ** processing for discounted loans (which was only fee related
      ** anyway) is only allowed for past due settlements
      *
     C           PTYPL     IFEQ 63
     C           PTYPL     OREQ 65
     C           PTYPL     OREQ 67
     C           AMTPA     IFNE 'PD'
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0102' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO ENINT1
     C                     ENDIF
     C                     ENDIF
      *
      ** Save last change details for related LOAM record  GRACE
      *
     C                     MOVE LSTC      WLSTCR 11
      *
     C           SACTN     IFEQ 'I'
     C           AMTPA     ANDEQ'PD'
     C                     MOVE 'Y'       WMTPD
     C                     ENDIF
      *
      ** Database error if not Insert and not found
      *
     C           SACTN     IFNE 'I'
     C           RECIA     ANDNE'D'
     C           SACTN     ORNE 'I'
     C           AMTPA     ANDNE'RE'
     C           AMTPA     ANDNE'PD'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA
     C                     MOVE 'Y'       WERR
     C                     MOVEL'LOAMS'   DBFILE           ************
     C                     MOVELKLKEY     DBKEY            * DBERR 11 *
     C                     Z-ADD11        DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate loan details if matched to loan
      *
     C                     MOVE *BLANKS   W72TP   1                       148845
     C           SACTN     IFEQ 'I'
      *
      * Manual repayments against Discount loans only valid if past due   178782
     C           PTYPL     IFEQ 63                                        178782
     C           PTYPL     OREQ 65                                        178782
     C           PTYPL     OREQ 67                                        178782
     C           AMTPA     IFNE 'PD'                                      178782
     C                     MOVE 'Y'       WERR                            178782
     C                     MOVE 'LEM0102' ZAMSID                          178782
     C                     EXSR ZASNMS                                    178782
     C                     GOTO ENINT1                                    178782
     C                     ENDIF                                          178782
      * Else, not a discount loan, so check if its valid processing type  178782
     C                     ELSE                                           178782
     C           PTYPL     LOKUPTABTYP                   50
      *                                                                   148845
     C           CLE005    IFEQ 'Y'                                       148845
     C           PTYPL     ANDEQ72                                        148845
     C**********           Z-ADDOLNO      WLOAN                                        148845 CSD027
     C                     MOVE OLNO      WLOAN                                               CSD027
     C                     MOVE 'A'       WRCDT                           148845
     C********** KCLOAN    CHAINCLOAN                20                   148845              209161
     C           KCLOAN    CHAINCLOAN               N20                                       209161
     C           PTYPL     IFNE 63                                        148845
     C           PTYPL     ANDNE65                                        148845
     C           PTYPL     ANDNE67                                        148845
     C                     MOVE '1'       *IN50                           148845
     C                     ELSE                                           148845
     C                     MOVE 'Y'       W72TP                           148845
     C                     ENDIF                                          148845
     C**********           Z-ADDWLNRF     WLOAN                                        148845 CLE148
     C                     MOVELWLNRF     WLOAN                                               CLE148
     C********** KCLOAN    CHAINCLOAN                20                   148845              209161
     C           KCLOAN    CHAINCLOAN               N20                                       209161
     C                     ENDIF                                          148845
      *                                                                   148845
     C           *IN50     IFEQ *OFF
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN68
     C           CLE005    IFEQ 'N'                                       148845
     C                     MOVE 'LEM0206' ZAMSID
     C                     ELSE                                           148845
     C                     MOVE 'LEM0211' ZAMSID                          148845
     C                     ENDIF                                          148845
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF                                          178782
      *
     C           *IN68     IFEQ *OFF
     C           AUTOL     ANDNE'N'
     C           *IN44     ANDEQ*ON                                       123856
     C           *IN68     OREQ *OFF                                      123856
     C           AUTOA     ANDNE'N'                                       123856
     C           *IN44     ANDEQ*OFF                                      123856
     C                     MOVE *ON       *IN68
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0208' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C           *IN68     IFEQ *OFF
     C           *IN44     ANDEQ*ON
      *
     C           WDAYNE    IFNE NRPD
     C           REPTL     ANDNE2                                         161072
     C                     MOVE *ON       *IN70
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0207' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C           ENINT1    ENDSR
      *
      /EJECT
      *****************************************************************
      * SRCAUT   - Check if action is valid                           *
      * Called by: SRSTR, SRSVD1, SRBTCH                              *
      * Calls    : ZVACTU                                             *
      *****************************************************************
     C           SRCAUT    BEGSR
      *
      ** If Multi-branching is OFF, action code must be valid for user
      *
     C                     Z-ADD0         @ERR
     C           MBIN      IFEQ 'N'
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBACTU'
     C                     PARM SACTN     @ZACTN
     C                     PARM           @USER
     C**********           PARM           @ZMGRP                                              CSF002
     C**********           PARM           @ZICDE                                              CSF002
     C                     PARM           @UNQCD                                              CSF002
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVACTU'
     C                     PARM SACTN     @ZACTN  1
     C                     PARM           @ERR
     C                     ENDIF
     C                     ENDIF
      *
     C           @ERR      IFNE 0
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0302' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** If Multi-branching is ON and if action code is A, E, X,
      ** or 'R';  Branch code on loan amendment file must be valid
      ** for user
      *
     C           MBIN      IFEQ 'Y'
     C           SACTN     ANDNE'I'
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBACTBU'
     C                     PARM SACTN     @ZACTN
     C                     PARM BRCA      @ZBR
     C                     PARM           @USER  10
     C**********           PARM           @ZMGRP  40                                          CSF002
     C**********           PARM           @ZICDE  4                                           CSF002
     C                     PARM           @UNQCD 10                                           CSF002
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVACTBU'
     C                     PARM SACTN     @ZACTN  1
     C                     PARM BRCA      @ZBR    3
     C                     PARM           @ERR    10
     C                     ENDIF
     C                     ENDIF
      *
     C           @ERR      IFEQ 1
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0303' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C           @ERR      IFEQ 2
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0304' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRFRMT   - Format Detail Screen                               *
      * Called by: SRSTRT, SRSUBP, SRBTCH                             *
      * Calls    : SRMIN1, SRMIN2                                     *
      *****************************************************************
     C           SRFRMT    BEGSR
      *
     C                     MOVEA'0000'    *IN,54
     C                     MOVE *ON       *IN,55
     C                     MOVEA'0000000' *IN,75
     C                     MOVEA'0000'    *IN,82
     C                     MOVEA'000'     *IN,30
     C                     MOVEA'00'      *IN,27
     C                     MOVEA'000'     *IN,33
     C                     MOVE *OFF      *IN17
     C                     MOVE *OFF      *IN24
     C                     MOVE *BLANK    WRE
      *
     C           *IN47     IFEQ '0'
     C                     MOVE '1'       *IN17
     C                     ENDIF
      *
     C           SACTN     IFEQ 'I'
     C                     MOVE *ON       *IN24
     C                     ELSE
     C                     MOVEA'11'      *IN,27
     C                     ENDIF
      *
     C           SACTN     IFEQ 'A'
     C           SACTN     OREQ 'E'
     C           SACTN     OREQ 'X'
     C           SACTN     OREQ 'R'
     C                     MOVE *ON       *IN32
     C                     ENDIF
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYPL     ANDEQ80                                                            CLE028
      *                                                                                       CLE028
      ** For flat rate personal loans, if ADIF is 'Y' show interest                           CLE028
      ** refunded and if ADCF is 'Y' show charges refunded.                                   CLE028
      *                                                                                       CLE028
     C           ADIF      IFEQ 'Y'                                                           CLE028
     C                     MOVE *OFF      *IN08                                               CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE *ON       *IN08                                               CLE028
     C                     ENDIF                                                              CLE028
     C           ADCF      IFEQ 'Y'                                                           CLE028
     C                     MOVE *OFF      *IN09                                               CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE *ON       *IN09                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** If Add on interest is 'Y', prevent entry to interest repayment                       CLE028
      ** and non-display the outstanding interest to date                                     CLE028
      *                                                                                       CLE028
     C           ADIF      IFEQ 'Y'                                                           CLE028
     C                     MOVE *ON       *IN07                                               CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE *OFF      *IN07                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE *OFF      *IN07                                               CLE028
     C                     MOVE *ON       *IN08                                               CLE028
     C                     MOVE *ON       *IN09                                               CLE028
     C                     ENDIF                                                              CLE028
      *
     C           SACTN     IFEQ 'I'
     C                     MOVE *BLANKS   SSTAT
     C                     ENDIF
      *
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C                     MOVE *ON       *IN33
     C                     ENDIF
      *
     C           *IN47     IFEQ *ON
     C                     MOVEA'1111'    *IN,54
     C                     MOVE *ON       *IN27
     C                     MOVE *ON       *IN59
     C                     ENDIF
      *
     C           AMTPA     IFEQ 'RE'
     C           REPTL     IFEQ 1
     C                     MOVEA'11'      *IN,55
     C                     ENDIF
     C           REPTL     IFEQ 2
     C                     MOVE *ON       *IN55
     C                     ENDIF
     C           REPTL     IFEQ 3
     C                     MOVEA'11'      *IN,54
     C                     ENDIF
     C                     ENDIF
      *
     C           AMTPA     IFEQ 'PD'
     C           *IN47     ANDEQ'0'
     C                     MOVE *OFF      *IN55
     C                     ENDIF
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*BLANK  'PRTCD
     C                     PARM '*KEY    'POPTN
     C                     PARM CCYL      PCURR   3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE 'Y'       WERR
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD11        DBASE            * DBERR 11 *
     C                     MOVELPCURR     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     Z-ADDCDP       WCDP    10
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDA6SPRT    WSPRTL 138                                          CLE023
     C                     MOVE A6MDIN    WMDINL  1                                           CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE036
      ** Repayments only allowed in Loan Currency                                             CLE036
     C           FREPAY    IFNE 'Y'                                                           CLE036
     C                     MOVE CCYL      SSCCY                                               CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE SRCCY     SSCCY                                               CLE036
     C           SACTN     IFNE 'I'                                                           CLE036
      * Use Repayment Currency from file:                                                     CLE036
     C           FRCY      IFNE *BLANKS                                                       CLE036
     C                     MOVE FRCY      SSCCY                                               CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE CCY       SSCCY                                               CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
      *                                                                                       CLE036
      ** Switch on *IN25 if this is a Facility Ccy Repayment                                  CLE036
     C           FREPAY    IFEQ 'Y'                                                           CLE036
     C           SSCCY     ANDNECCYL                                                          CLE036
     C                     MOVE *ON       *IN25                                               CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE *OFF      *IN25                                               CLE036
     C                     ENDIF                                                              CLE036
      *
      ** Calculate outstanding interest
      ** Work fields for outstanding principal and total interest
      ** repaid.
      *
     C                     Z-ADDCPAM      WOPRN  130
     C                     Z-ADD0         WINTM  130
      *                                                                   156048
     C           SVDAT     IFNE *BLANKS                                   156048
     C                     MOVE SVDAT     ZDATE                           156048
     C                     EXSR ZDATE1                                    156048
     C                     Z-ADDZDAYNO    WDAT    50                      156048
     C                     ENDIF                                          156048
      *
     C           KTKEY     SETLLLMANP
     C                     READ LMANP                    40
      *
      ** If Manual Repayment found then remove the principal amount
      ** from the outstanding principal, and add the interest amount
      ** to the total interest repaid for that loan.
      *
     C           *IN40     DOWEQ'0'
      *
     C           WLOAN     IFNE LNRFMP
     C                     LEAVE
     C                     ELSE
      *
     C           RECIMP    IFEQ 'D'
     C           AMTPMP    IFEQ 'MR'
     C           AMTPMP    OREQ 'RE'
     C           AUTOMP    ANDEQ'Y'
     C           AMTPMP    OREQ 'PF'                                      152669
      *                                                                   122874
      * RE may be in facility currency.                                   122874
     C           AMTPMP    IFEQ 'RE'                                      122874
     C           CCYMP     ANDNECCYL                                      122874
      *                                                                   122874
     C                     CALL 'AOCURRR0'                                122874
     C                     PARM *BLANKS   PRTCD                           122874
     C                     PARM '*KEY'    POPTN                           122874
     C                     PARM CCYMP     PCURR                           122874
     C           SDCURR    PARM SDCURR    DSSDY                           122874
     C           PRTCD     IFNE *BLANKS                                   122874
     C           *LOCK     IN   LDA                                       122874
     C                     MOVEL'SDCURRPD'DBFILE                          122874
     C                     Z-ADD33        DBASE                           122874
     C                     MOVELCCYMP     DBKEY                           122874
     C                     OUT  LDA                                       122874
     C                     EXSR *PSSR                                     122874
     C                     ENDIF                                          122874
     C                     Z-ADDCDP       CDPF    10                      122874
      *                                                                   122874
     C           WCDP      SUB  CDPF      CX                              122874
     C                     ADD  4         CX                              122874
     C********** PRAMMP    MULT POWR,CX   W#AMNT 193H                                  122874 CLE023
     C           PRAMMP    MULT POWER,CX  W#AMNT 193H                                         CLE023
      *                                                                   122874
     C           FMDI      IFEQ 'D'                                       122874
     C           W#AMNT    MULT FCXR      PRAMMP    H                     122874
     C                     ELSE                                           122874
     C           W#AMNT    DIV  FCXR      PRAMMP    H                     122874
     C                     ENDIF                                          122874
     C                     ENDIF                                          122874
     C           WOPRN     SUB  PRAMMP    WOPRN
     C           WINTM     ADD  INTAMP    WINTM
      *
     C           AMTPMP    IFEQ 'RE'
     C                     MOVE 'Y'       WRE     1
     C                     ENDIF
     C                     ENDIF
      *                                                                   156048
     C           AMTPMP    IFEQ 'PI'                                      156048
     C           AMTPMP    OREQ 'PT'                                      156048
     C           VDATMP    IFLE WDAT                                      156048
     C                     ADD  PRAMMP    WOPRN                           156048
     C                     ENDIF                                          156048
     C                     ENDIF                                          156048
      *                                                                   156048
     C                     ENDIF
      *
     C                     ENDIF
     C                     READ LMANP                    40
      *
     C                     ENDDO
      *
     C                     Z-ADDCPAM      WAMNT  130
     C           WDAYNV    IFGT RUND                                                          183958
     C           *IN69     ANDEQ'0'                                                           183958
     C           CLE005    ANDEQ'Y'                                                           183958
     C                     Z-ADDWDAYNV    WENINT  50                                          183958
     C                     ELSE                                                               183958
     C                     Z-ADDRUND      WENINT  50
     C                     ENDIF                                                              183958
     C/COPY WNCPYSRC,LE2110C001
      *
      ** If maturity date is less or equal rundate then use this as
      ** end date for calculation of interest
      *
     C           MDAT      IFNE 0
     C           MDAT      ANDLERUND
     C/COPY WNCPYSRC,LE2110C002
     C                     Z-ADDMDAT      WENINT
     C                     ENDIF
      *
     C                     EXSR SRINTR
      *
     C                     Z-ADDWRINT     WOINT  130
     C           WOINT     SUB  WINTM     WOINR  130
      *                                                                                       CLE028
      ** For flat rate personal loans, calculate interest refunded and                        CLE028
      ** charges refunded                                                                     CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYPL     ANDEQ80                                                            CLE028
     C                     EXSR SRRFND                                                        CLE028
      *                                                                                       CLE028
      ** Add charges and/or interest to the principal where these                             CLE028
      ** have been added on, but only if the loan hasn't started                              CLE028
      *                                                                                       CLE028
     C           ORED      IFEQ RUND                                                          CLE028
     C           ORED      ORLT VDAT                                                          CLE028
     C           ADIF      IFEQ 'Y'                                                           CLE028
     C                     ADD  FLTI      WOPRN                                               CLE028
     C                     ADD  FLTI      CPAM                                                CLE028
     C                     ENDIF                                                              CLE028
     C           ADCF      IFEQ 'Y'                                                           CLE028
     C                     ADD  CHGA      WOPRN                                               CLE028
     C                     ADD  CHGA      CPAM                                                CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
      *
      ** Calculate expected principal
      *
     C           *IN54     IFEQ *OFF
      *
      ** Check if expected payment is in loan or facility Currency:                           CLE036
      *                                                                                       CLE036
      ** If MR linked to Loan Repayment:                                                      CLE036
     C           *IN44     IFEQ *ON
     C           *IN25     IFEQ *ON                                                           CLE036
     C           SRCCY     ANDEQFCCYL                                                         CLE036
     C                     Z-ADDFCRA      WEPRIN 130                                          CLE036
     C                     ELSE                                                               CLE036
     C                     Z-ADDRAMT      WEPRIN 130
     C                     ENDIF                                                              CLE036
     C                     ELSE
      *                                                                                       CLE036
      ** If MR linked to Loan Amendment:                                                      CLE036
     C           FRCYA     IFNE *BLANK                                                        CLE036
     C           *IN25     ANDEQ*ON                                                           CLE036
     C                     Z-ADDFRAMA     WEPRIN                                              CLE036
     C                     ELSE                                                               CLE036
     C                     Z-ADDPRAMA     WEPRIN
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     ENDIF
      *                                                                                       CLE036
     C           SACTN     IFNE 'I'
     C           *IN47     ANDEQ*OFF
     C           FRCYA     IFNE *BLANK                                                        CLE036
     C           *IN25     ANDEQ*ON                                                           CLE036
     C           FRAMA     ADD  FRAMR     WEPRIN                                              CLE036
     C                     MOVE FRCYA     SEXCY                                               CLE036
     C                     ELSE                                                               CLE036
     C           PRAMA     ADD  PRAMR     WEPRIN
     C                     ENDIF                                                              CLE036
     C                     ENDIF
     C                     ENDIF
      *
      ** Calculate expected interest and W/Hold Tax
      *
     C           *IN55     IFEQ *OFF
      *
     C           SACTN     IFEQ 'I'
      *                                                                                       CLE036
     C           *IN25     IFEQ *ON                                                           CLE036
     C           FINTA     ANDNE0                                                             CLE036
     C                     Z-ADDFINTA     WEINT  130                                          CLE036
     C                     Z-ADDFTXAA     WEWTAX 130                                          CLE036
     C                     MOVE FRCYA     SEXCY                                               CLE036
     C                     ELSE                                                               CLE036
     C                     Z-ADDINTAA     WEINT  130
     C                     Z-ADDWTXAA     WEWTAX 130
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     ELSE
     C           *IN25     IFEQ *ON                                                           CLE036
     C           FINTA     ANDNE0                                                             CLE036
     C           FINTA     ADD  FINTR     WEINT                                               CLE036
     C           FTXAA     ADD  FTXAR     WEWTAX                                              CLE036
     C                     ELSE                                                               CLE036
     C           INTAA     ADD  INTAR     WEINT
     C           WTXAA     ADD  WTXAR     WEWTAX
     C                     ENDIF                                                              CLE036
     C                     ENDIF
     C                     ENDIF
      *
      ***Calculate*expected*penalty******************************         157744
      *
     C************IN59     IFEQ *OFF                                      157744
      *
     C***********SACTN     IFEQ 'I'                                       157744
     C***********          Z-ADDPNAMA     WEPAM  130                      157744
     C***********          ELSE                                           157744
     C***********PNAMA     ADD  PNAMR     WEPAM  130                      157744
     C***********          ENDIF                                          157744
     C***********          ENDIF                                          157744
      *
      ** Calculate expected total
      *
     C           *IN56     IFEQ *OFF
      *
     C           *IN44     IFEQ *ON
     C                     Z-ADDRAMT      WEXTOT 130
     C           *IN25     IFEQ *ON                                                           CLE036
     C           FCRA      ANDNE0                                                             CLE036
     C                     Z-ADDFCRA      WEXTOT                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     ELSE
      *                                                                                       CLE036
     C                     Z-ADDTAMTA     WEXTOT
     C           *IN25     IFEQ *ON                                                           CLE036
     C           FTOTA     ANDNE0                                                             CLE036
     C                     Z-ADDFTOTA     WEXTOT                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF
      *
     C           SACTN     IFNE 'I'
     C           AMTPA     IFEQ 'RE'
     C           REPTL     IFEQ 2
     C           TAMTA     ADD  PRAMR     WEXTOT
     C           *IN25     IFEQ *ON                                                           CLE036
     C           FTOTA     ANDNE0                                                             CLE036
     C           FTOTA     ADD  FRAMR     WEXTOT                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF
     C           REPTL     IFEQ 3
     C           TAMTA     ADD  TAMTR     WEXTOT
     C           *IN25     IFEQ *ON                                                           CLE036
     C           FTOTA     ANDNE0                                                             CLE036
     C           FTOTA     ADD  FTOTR     WEXTOT                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF
     C                     ENDIF
     C           AMTPA     IFEQ 'PD'
     C           TAMTA     ADD  TAMTR     WEXTOT
     C           *IN25     IFEQ *ON                                                           CLE036
     C           FTOTA     ANDNE0                                                             CLE036
     C           FTOTA     ADD  FTOTR     WEXTOT                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2110C013
      *                                                                   157744
      ** Calculate expected penalty                                       157744
      *                                                                   157744
     C           *IN59     IFEQ *OFF                                      157744
     C           WDAYNV    IFGT WDAYNE                                    157744
     C           AMTPA     ANDEQ'PD'                                      157744
     C                     EXSR SRPNAM                                    157744
     C                     ENDIF                                          157744
     C                     ENDIF                                          157744
      *
      ** Set up settlement instructions
      *
     C           *IN44     IFEQ *OFF
     C           *IN47     ANDEQ*OFF
     C           SACTN     ANDEQ'I'
     C                     MOVE SETTR     SDETS
     C                     MOVE OSBR      WOSBR
     C                     ENDIF
      *
     C           SACTN     IFEQ 'I'
     C           AMTPA     ANDNE'PD'
     C           AMTPA     ANDNE'RE'
     C                     MOVE SETTL     SDETS
     C                     MOVE OMDB      WOSBR
     C                     ENDIF
      *
     C           OSETT     IFNE '05'
     C           SACTN     ANDEQ'E'
     C                     MOVE SETP      SETPA
     C                     ENDIF
      *
      ** Set up negative indicators
      *
     C           SACTN     IFNE 'I'
      *                                                                                       CLE036
      ** If repayment is in facility ccy, set up negative indicators                          CLE036
      ** for amounts in Facility Currency:                                                    CLE036
     C           FREPAY    IFEQ 'Y'                                                           CLE036
     C           SSCCY     ANDEQFCCYL                                                         CLE036
     C                     EXSR SRFNEG                                                        CLE036
     C                     ELSE                                                               CLE036
      *
     C           PRAMR     IFLT 0
     C                     MOVE '-'       SPSIG
     C                     Z-SUBPRAMR     PRAMR
     C                     ELSE
     C                     MOVE ' '       SPSIG
     C                     ENDIF
      *
     C           INTAR     IFLT 0
     C                     MOVE '-'       SISIG
     C                     Z-SUBINTAR     INTAR
     C                     ELSE
     C                     MOVE ' '       SISIG
     C                     ENDIF
      *
     C           PNAMR     IFLT 0
     C                     MOVE '-'       SRPIG
     C                     Z-SUBPNAMR     PNAMR
     C                     ELSE
     C                     MOVE ' '       SRPIG
     C                     ENDIF
      *
     C           TAMTR     IFLT 0
     C                     MOVE '-'       SRSIG
     C                     Z-SUBTAMTR     TAMTR
     C                     ELSE
     C                     MOVE ' '       SRSIG
     C                     ENDIF
     C                     ENDIF                                                              CLE036
     C                     ENDIF
      *
      *
     C***********          MOVE CCYL      SCCY                            156873
     C**********           MOVE CCYL      SSCCY                                        156873 CLE036
     C                     MOVE WTINL     SWTTP
      *
     C           SACTN     IFNE 'I'
      *                                                                                       CLE036
      ** If repayment in facility ccy, use Fac. Ccy amounts from file:                        CLE036
     C           FREPAY    IFEQ 'Y'                                                           CLE036
     C           SSCCY     ANDEQFCCYL                                                         CLE036
     C                     EXSR SRMIN4                                                        CLE036
     C                     ELSE                                                               CLE036
     C                     EXSR SRMIN1
     C                     ENDIF                                                              CLE036
     C                     ENDIF
      *                                                                                       CLE036
      ** If repayment in facility ccy, convert & format loan amounts:                         CLE036
     C           FREPAY    IFEQ 'Y'                                                           CLE036
     C           SSCCY     ANDEQFCCYL                                                         CLE036
     C                     EXSR SRMIN3                                                        CLE036
     C                     ELSE                                                               CLE036
     C                     EXSR SRMIN2
     C                     ENDIF                                                              CLE036
      *
     C           SACTN     IFEQ 'R'
     C                     SETON                     34
     C                     ENDIF
      *
     C           SACTN     IFEQ 'X'
     C                     SETON                     35
     C                     ENDIF
      *                                                                   CAP063
      * Overwrite screen fields with fields from invalid file             CAP063
      *                                                                   CAP063
     C           PMODE     IFEQ 'F'                                       CAP063
     C           XREPN     CHAINLEIMRPD2             48                   CAP063
     C                     EXSR SRSIND                                    CAP063
     C                     ENDIF                                          CAP063
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************   CAP063
      * SRSIND   - Screen setup from Invalid Data file                *   CAP063
      * Called by: SRFRMT                                             *   CAP063
      * Calls    : None                                               *   CAP063
      *****************************************************************   CAP063
     C           SRSIND    BEGSR                                          CAP063
      *                                                                   CAP063
     C                     MOVE ISLOAN    SLOAN                           CAP063
     C                     MOVE ISCUST    SCUST                           CAP063
      *                                                                   CAP063
     C           *IN89     IFEQ *OFF                                      CAP063
     C           *IN17     OREQ *ON                                       CAP063
     C                     MOVE *BLANKS   SPASD                           CAP063
     C                     ELSE                                           CAP063
     C                     MOVE ISPASD    SPASD                           CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
     C           SACTN     IFEQ 'I'                                       CAP063
     C                     MOVE *BLANKS   SSEQN                           CAP063
     C                     ELSE                                           CAP063
     C                     MOVE ISSEQN    SSEQN                           CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
     C                     MOVE ISRPRI    SRPRI                           CAP063
     C                     MOVE ISPSIG    SPSIG                           CAP063
     C                     MOVE ISRINT    SRINT                           CAP063
     C                     MOVE ISISIG    SISIG                           CAP063
     C                     MOVE ISRPEN    SRPEN                           CAP063
     C                     MOVE ISRPIG    SRPIG                           CAP063
     C                     MOVE ISRTOT    SRTOT                           CAP063
     C                     MOVE ISRSIG    SRSIG                           CAP063
     C                     MOVE ISWOFF    SWOFF                           CAP063
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE ISFSCY    SFSCCY                                              CLE031
     C                     MOVE ISPSCY    SFPSCY                                              CLE031
     C                     MOVE ISPEXR    SFREXR                                              CLE031
     C                     MOVE ISREXR    SFPEXR                                              CLE031
     C                     MOVE ISREXI    SFREXI                                              CLE031
     C                     MOVE ISPEXI    SFPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                   CAP063
     C                     ENDSR                                          CAP063
      *                                                                   CAP063
      /EJECT                                                              CAP063
      *****************************************************************
      * SRMIN2   - Format amounts for output                          *
      * Called by: SRFRMT                                             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRMIN2    BEGSR
      *
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE CPAM      ZFLD15
     C                     Z-ADDWCDP      ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    SCURP
      *
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE WOINT     ZFLD15
     C                     Z-ADDWCDP      ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    SINTD
      *
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE WEPRIN    ZFLD15
     C                     Z-ADDWCDP      ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    SEPRI
      *
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE WEINT     ZFLD15
     C                     Z-ADDWCDP      ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    SEINT
      *
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE WEPAM     ZFLD15
     C                     Z-ADDWCDP      ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    SEPEN
      *
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE WEWTAX    ZFLD15
     C                     Z-ADDWCDP      ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    SWHTX
      *
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE WEXTOT    ZFLD15
     C                     Z-ADDWCDP      ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    SETOT
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRINTR   - Calculate interest remaining to be paid at a given *
      *            date.                                              *
      * Called by: SRFRMT                                             *
      * Calls    : ZFLAC, ZFLDC, GLINTC                               *
      *****************************************************************
     C           SRINTR    BEGSR
      *
     C           CLE007    IFEQ 'Y'                                       CLE007
     C           WREAC     ANDEQ'Y'                                       CLE007
     C                     Z-ADD*ZEROS    ZINTR                           CLE007
      *                                                                   CLE007
     C                     ELSE                                           CLE007
     C                     Z-ADDWENINT    ZIEND
     C                     Z-ADDIACD      ZIBEG
      *
      ** Add extra days if first and last day accruals
      *
     C**********           Z-ADDVDAT      ZVDAT                                               245082
     C                     Z-ADDMDAT      ZMDAT                                               245082
     C                     EXSR ZFLAC
      *
      ***Add*an*extra*day*if*first*&*last*day*accrual*and*original******                      245082
      ***entry*date*is*greater*than*or*equal*to*the*maturity*date.******                      245082
      *
     C********** ORED      IFGE MDAT                                                          245082
     C********** ADDI      ANDEQ'B'                                                           245082
     C**********           ADD  1         ZIEND                                               245082
     C**********           ENDIF                                                              245082
      *
      ** Add extra days if first day accruals
      *
     C                     Z-ADDMDAT      ZMDAT
     C***********          EXSR ZFLDC                                     143510
      *
     C                     Z-ADDICBS      ZICALC
     C                     Z-ADDINTR      ZIRATE       41
     C                     Z-ADDWAMNT     ZIAMT
     C/COPY WNCPYSRC,LE2110C014
      *
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYPL     ANDEQ80                                                            CLE028
     C                     EXSR SROSIN                                                        CLE028
     C                     Z-ADDZINTR     WRINT                                               CLE028
     C                     ELSE                                                               CLE028
     C                     EXSR GLINTC
     C                     ENDIF                                                              CLE028
     C/COPY WNCPYSRC,LE2110C015
      *
      ** Round down interest if required
      *
     C           RDFCL     IFEQ 'Y'
     C           PTYPL     ANDNE80                                                            CLE028
     C                     Z-ADDZINTR     WRDW   130
     C                     Z-ADDWRDW      ZINTR
     C                     ENDIF
     C                     ENDIF                                          CLE007
      *
      ** If loan has gone past due, add PDIN, AIAP, AIMN to get
      ** interest accrued.
      *
     C           MDAT      IFLT IACD
     C           MDAT      ANDNE0
     C           RECIL     ANDEQ'D'                                       131253
     C***********RECI      ANDEQ'D'                                       131253
     C           AIAP      ADD  AIMN      WRINT
     C           WRINT     ADD  PDIN      WRINT
     C                     ELSE                                           122874
     C***********          ENDIF                                          122874
      *
      ** If stop accruals ind. is on, do not include interest calculated
      *
     C                     TESTB'3'       LONI           43
      *
     C           *IN43     IFEQ *ON
     C           AITC      ADD  AIAP      WRINT
     C           WRINT     ADD  AIMN      WRINT
     C                     ELSE
      *
     C           CLE028    IFEQ 'N'                                                           CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           PTYP      ANDNE80                                                            CLE028
     C           ZINTR     ADD  AITC      WRINT  130H
     C                     ENDIF                                                              CLE028
     C           WRINT     ADD  AIAP      WRINT
     C***********WRINT     ADD  WRINT     WRINT                           122874
     C           WRINT     ADD  AIMN      WRINT                           122874
     C                     ENDIF
     C                     ENDIF                                          122874
      *
     C           CLE028    IFEQ 'N'                                                           CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           PTYP      ANDNE80                                                            CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           ADIF      ANDNE'Y'                                                           CLE028
     C           WRINT     SUB  IPRD      WRINT
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           WRINT     SUB  ICTD      WRINT
     C           WRINT     SUB  IWOD      WRINT
      *
     C           *IN41     IFEQ *ON
     C           WRINT     ANDGT0
     C           *IN41     OREQ *OFF
     C           WRINT     ANDLT0
     C                     Z-ADD0         WRINT
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRXAUT   - Check if action 'X' is authorised                  *
      * Called by: SRSTRT, SRSVD1, SRBTCH                             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRXAUT    BEGSR
      *
      ** CLE002 feature should be on before authorisation
      *
     C           *IN86     IFEQ *OFF
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN67
     C                     MOVE 'LEM0011' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO ENDAUT
     C                     ENDIF
      *
      ** Check if Authorisation Required
      *
      *   (Check LE ICD new field Authorisation of Manual Rpayment)
     C           *IN86     IFEQ *ON
     C           BPMRAU    ANDNE'Y'
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN67
     C                     MOVE 'LEM0012' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO ENDAUT
     C                     ENDIF
      *
     C           *IN86     IFEQ *ON
     C           BPMRAU    ANDEQ'Y'
      *
      ** Check status of loan amendment
      *
     C           ASTS      IFNE 'C'
     C           ASTS      ANDNE'R'
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN67
     C                     MOVE 'LEM0014' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** User should not be the same as Insert/Amendment User
     C/COPY WNCPYSRC,LE2110C022
      *
     C           USER      COMP IUSR                     51
     C           *IN51     IFEQ '0'
     C           USER      COMP AUSR                     51
     C                     ENDIF
     C           *IN51     IFEQ *ON
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN67
     C                     MOVE 'LEM0013' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO ENDAUT
     C                     ENDIF
      *                                                                                       CSD015
      **  Watch List Checking Applied                                                         CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     MOVE *OFF      *IN06                                               CSD015
     C                     MOVEL*BLANK    KFUNT                                               CSD015
     C                     MOVEL*BLANK    KIDEN                                               CSD015
     C                     MOVEL*BLANK    KBRCH                                               CSD015
     C                     MOVEL*BLANK    WKIDEN                                              CSD015
     C                     MOVEL*BLANK    WKLNRF                                              CSD015
     C                     MOVEL*BLANK    WVDAT                                               CSD015
     C                     MOVEL*BLANK    WLASN                                               CSD015
      *                                                                                       CSD015
     C                     MOVE LNRF      WKLNRF                                              CSD015
     C                     MOVE VDAT      WVDAT                                               CSD015
     C                     MOVE LASN      WLASN                                               CSD015
     C           WKLNRF    CAT  WVDAT:0   WKIDEN                                              CSD015
     C                     CAT  WLASN:0   WKIDEN                                              CSD015
      *                                                                                       CSD015
      ** If 24X7 is not installed or the suport system is off.                                CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
      *                                                                                       CSD015
     C                     MOVEL'LOAMSDK' KFUNT                                               CSD015
     C                     MOVELWKIDEN    KIDEN                                               CSD015
     C                     MOVELBRCA      KBRCH                                               CSD015
     C           CWHTKY    CHAINSDCWHTL1             06                                       CSD015
      *                                                                                       CSD015
      ** If record found, diplay error message 'Trade details being                           CSD015
      ** reviewed by Compliance Officer'                                                      CSD015
      *                                                                                       CSD015
     C           *IN06     IFEQ *OFF                                                          CSD015
     C           W3TREL    ANDNE'Y'                                                           CSD015
     C                     MOVE '1'       *IN67                                               CSD015
     C                     MOVE 'Y'       WERR                                                CSD015
     C                     MOVEL'LEL0564' ZAMSID                                              CSD015
     C                     EXSR ZASNMS                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF
     C/COPY WNCPYSRC,LE2110C023
      *
     C           ENDAUT    ENDSR
      *
      /EJECT
      *****************************************************************
      * SRSUBF   - Subfile screen                                     *
      * Called by: Main Processing                                    *
      * Calls    : SRSUB1, SRSUB2, SRSCLR, SRSVD1, SRSUBP, CLEAR      *
      *****************************************************************
     C           SRSUBF    BEGSR
      *
      ** Clear error message
      *
     C           WERR      IFNE 'Y'
     C                     EXSR CLEAR
     C                     ENDIF
      *
      ** Initialise subfile fields
      *
     C                     EXSR SRSUB1
      *
      ** Clear subfile
      *
     C                     EXSR SRSCLR
      *
     C           WFMT      DOWEQ'S0'
     C                     WRITELE2110F0
     C                     WRITELE2110F3
     C                     WRITELE2110C1
     C                     EXFMTLE2110C0
      *
     C                     MOVE 'N'       WERR
     C                     MOVEA'00'      *IN,73
     C                     EXSR CLEAR
      *
     C                     SELEC
     C           *INKC     WHEQ '1'
     C                     MOVE *BLANK    WFMT
      *
     C           *INKL     WHEQ '1'
     C                     MOVE 'F0'      WFMT
     C                     MOVE *BLANKS   WWRTRN
      *
     C           *INKI     WHEQ '1'
     C                     MOVE 'S0'      WWRTRN
     C                     MOVE 'I'       SACTN
     C                     MOVE 'F0'      WFMT
     C                     MOVE '1'       *IN19
      *
     C           *INKE     WHEQ '1'
     C                     MOVE WLNRFS    SRFLN
     C                     MOVE WAUTH     SRAUT
     C                     MOVE SRFLN     WLNRF
     C                     EXSR SRSCLR
      *
     C           SRFLN     WHNE WLNRFS
     C           SRAUT     ORNE WAUTH
     C                     EXSR SRRAUT
     C           WERR      IFNE 'Y'
     C                     EXSR SRSCLR
     C                     ENDIF
      *
     C           *IN64     WHEQ '1'
     C                     MOVE 'N'       WTEST   1
     C           *IN37     IFEQ '0'
     C                     Z-ADDSRRN1     SRRN
     C                     Z-ADDSRRN1     SRCNR
     C                     ELSE
     C                     Z-ADD1         SRCNR
     C                     ENDIF
     C                     EXSR SRSUB2
      *
     C           *IN37     IFEQ '1'
     C           SRRN1     SUB  1         SRCNR
     C                     ENDIF
      *
     C                     OTHER
      *
     C           *IN23     IFEQ *ON
     C                     EXSR SRSVD1
      *
     C           WDELET    IFEQ 'Y'                                       CAP063
     C                     EXSR SRSCLR                                    CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
     C           PMODE     IFEQ 'F'                                       CAP063
     C           WFIRST    ANDNE'Y'                                       CAP063
     C           SACTN     ANDEQ'I'                                       CAP063
     C                     MOVE 'S0'      WWRTRN                          CAP063
     C                     MOVE 'I'       SACTN                           CAP063
     C                     MOVE 'F0'      WFMT                            CAP063
     C                     MOVE '1'       *IN19                           CAP063
     C                     LEAVE                                          CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
     C           WDET      IFEQ 'Y'
     C           WDELET    ANDNE'Y'                                       CAP063
      *                                                                   CAP063
     C           WFIRST    IFNE 'Y'
     C                     MOVE 'S0'      WWRTRN
     C                     EXSR SRSUBP
      *
     C           *IN36     IFEQ '1'
     C                     MOVE WLNRFS    SRFLN
     C                     MOVE WAUTH     SRAUT
     C                     MOVE SRFLN     WLNRF
     C                     EXSR SRSCLR
     C                     ENDIF
      *
     C           WFMT      IFNE *BLANK
     C                     MOVE 'S0'      WFMT
     C                     ENDIF
      *
     C                     ENDIF
     C                     ELSE
     C                     Z-ADD1         SRCNR
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSL
      *
     C                     ENDDO
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRSUB1   - Initialise all subfile fields with *blank or zero  *
      * Called by: SRSUBF                                             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSUB1    BEGSR
     C                     MOVE *BLANKS   SLOAN
     C                     MOVEL*BLANKS   SCNUM
     C                     MOVEL*BLANKS   SVDAT
     C                     MOVEL*BLANKS   SCURP
     C***********          MOVEL*BLANKS   SCCY                            156873
     C                     MOVEL*BLANKS   SSCCY                           156873
     C                     MOVEL*BLANKS   SSTAT
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRSCLR   - Clear the subfile                                  *
      * Called by: SRSUBF                                             *
      * Calls    : SRSUB2                                             *
      *****************************************************************
     C           SRSCLR    BEGSR
      *
     C                     MOVE '0'       *IN16
     C                     MOVEA'00'      *IN,22
     C                     WRITELE2110C0
     C                     MOVEA'11'      *IN,22
     C                     MOVEA'00'      *IN,37
     C                     MOVE '0'       *IN19
     C                     MOVE '0'       *IN49
     C                     MOVE *BLANK    SACTN
      *
     C                     MOVE 'N'       WTEST
     C                     Z-ADD1         SRRN
     C                     Z-ADD1         SRCNR
      *
     C           SRAUT     IFEQ 'Y'
     C           SRFLN     IFEQ *BLANK
     C           *LOVAL    SETLLLELOAML1
     C                     READ LELOAML1                 38
     C                     ELSE
     C           KLEKEY    SETLLLELOAML1
     C                     READ LELOAML1                 38
     C                     ENDIF
     C                     ENDIF
      *
     C           SRAUT     IFEQ 'N'
      *                                                                   CAP063
     C           PMODE     IFEQ 'F'                                       CAP063
     C           *LOVAL    SETLLLEIMRPD1                                  CAP063
     C                     READ LEIMRPD1                 38               CAP063
     C                     MOVE SSBRC     BRCA                            CAP063
     C                     ELSE                                           CAP063
      *                                                                   CAP063
     C           SRFLN     IFEQ *BLANK
     C           *LOVAL    SETLLLELOAML0
     C                     READ LELOAML0                 38
     C                     ELSE
     C           KLEKEY    SETLLLELOAML0
     C                     READ LELOAML0                 38
     C                     ENDIF
     C                     ENDIF
      *                                                                   CAP063
     C                     ENDIF                                          CAP063
      *
     C           *IN38     IFEQ '1'
     C                     MOVEA'10'      *IN,22
     C                     MOVE '1'       *IN37
     C                     ENDIF
      *
     C                     EXSR SRSUB2
      *
     C           *IN37     IFEQ '1'
     C           SRRN1     SUB  1         SRCNR
     C           WCOUNT    COMP 0                        38
     C           SRRN      IFLE 11
     C                     MOVE '1'       *IN16
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRSUB2   - Move file fields to the subfile fields             *
      * Called by: SRSUBF                                             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSUB2    BEGSR
      *
     C                     Z-ADD0         WCOUNT
      *
     C           *IN37     DOWEQ'0'
     C           WCOUNT    ANDLT10
      *
     C           FAMTP     IFEQ 'MR'
      *
      ** Check if other records to be display on next subfile page
      *
     C           WTEST     IFEQ 'Y'
     C                     LEAVE
     C                     ENDIF
      *
      ** User must be authorised to the branch of the record
      *
     C                     Z-ADD*ZERO     @ERR
     C           MBIN      IFEQ 'Y'
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBBBU'
     C                     PARM BRCA      @ZBR
     C                     PARM           @USER
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVBBU'
     C                     PARM BRCA      @ZBR
     C                     PARM           @ERR
     C                     ENDIF
     C                     ENDIF
      *
     C           @ERR      IFEQ *ZERO
      *                                                                   CAP063
      ** Mode is not 'F'                                                  CAP063
     C           PMODE     IFNE 'F'                                       CAP063
     C                     MOVE *BLANKS   SLOAN
     C                     MOVE *BLANKS   SCNUM
     C***********          MOVE *BLANKS   SCCY                            156873
     C                     MOVE *BLANKS   SSCCY                           156873
     C                     MOVE *BLANKS   SCURP
     C                     ENDIF                                          CAP063
      *
     C                     MOVE BRCA      SSBRC
      *                                                                   CAP063
      ** Mode is not 'F'                                                  CAP063
     C           PMODE     IFNE 'F'                                       CAP063
     C                     MOVE FLNRF     SLOAN
     C                     MOVE FLNRF     WLOAN
     C                     MOVE FCNUM     SCNUM
      *                                                                   126274
      ** Access the Customer Details file for Shortname                   126274
      *                                                                   126274
     C***  Move this access to after loan access, so that we can          158534
     C**    use original borrower for parts. purchased                    158534
     C***                  MOVE *BLANKS   WKEYC                    126274 158534
     C***                  MOVELSCNUM     WKEYC                    126274 158534
     C***                  CALL 'AOCUSTR0'                         126274 158534
     C***                  PARM '       ' PRTCD                    126274 158534
     C***                  PARM '*KEY   ' @OPTN                    126274 158534
     C***                  PARM SCNUM     WKEYC                    126274 158534
     C***                  PARM           KEYSTS                   126274 158534
     C***        SDCUST    PARM SDCUST    DSSDY                    126274 158534
     C***                  MOVE *BLANKS   SCSNM                    126274 158534
     C***        PRTCD     IFEQ *BLANKS                            126274 158534
     C***                  MOVE BBCSSN    SCSNM                    126274 158534
     C***                  ELSE                                    126274 158534
     C***                  MOVE 'Unknown' SCSNM                    126274 158534
     C***                  END                                     126274 158534
      *                                                                   126274
     C***********          MOVE FCCY      SCCY                            156873
     C                     MOVE FCCY      SSCCY                           156873
     C                     MOVE FLASN     SSEQN
      *
     C           FASTS     IFEQ 'C'
     C                     MOVE *BLANKS   SSTAT
     C***********          MOVELWSTAT,1   SSTAT                           123998
     C                     MOVEL'LEM0060' ZAMSID                          123998
     C                     ENDIF
     C           FASTS     IFEQ 'R'
     C                     MOVE *BLANKS   SSTAT
     C***********          MOVELWSTAT,2   SSTAT                           123998
     C                     MOVEL'LEM0061' ZAMSID                          123998
     C                     ENDIF
     C           FASTS     IFEQ 'A'
     C                     MOVE *BLANKS   SSTAT
     C***********          MOVELWSTAT,3   SSTAT                           123998
     C                     MOVEL'LEM0062' ZAMSID                          123998
     C                     ENDIF
     C           FASTS     IFEQ 'D'
     C                     MOVE *BLANKS   SSTAT
     C***********          MOVELWSTAT,4   SSTAT                           123998
     C                     MOVEL'LEM0063' ZAMSID                          123998
     C                     ENDIF
      *                                                                   123998
     C                     EXSR SRTEXT                                    123998
     C                     MOVELZAMSTX    SSTAT                           123998
     C                     MOVE *BLANKS   ZAMSID                          123998
      *
      ** Format start date
      *
     C                     Z-ADDFVDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SVDAT
     C                     MOVE ZDATE     SVALD
     C                     ENDIF                                          CAP063
      *
      ** Mode is 'F'                                                      CAP063
     C           PMODE     IFEQ 'F'                                       CAP063
     C**********           MOVE SLOAN     WLOAN   60                                   CAP063 CLE148
     C                     MOVE SLOAN     WLOAN   6                                           CLE148
     C           KCLOAN    CHAINCLOAN               N39                   CAP063
     C                     MOVE CCYL      SSCCY                           CAP063
     C                     MOVE CCYL      FCCY                            CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM FCCY      PCURR
     C           SDCURR    PARM SDCURR    DSSDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD12        DBASE            * DBERR 12 *
     C                     MOVELFCCY      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     Z-ADDCDP       WCDP
      *                                                                   CAP063
      ** Mode is 'F'                                                      CAP063
     C           PMODE     IFEQ 'F'                                       CAP063
     C                     MOVE *BLANKS   SACTN                           CAP063
     C                     MOVELSVALD     SVDAT                           CAP063
     C                     ENDIF                                          CAP063
      *
     C           KCLOAN    CHAINCLOAN               N39
      *
      ** Format Current Principal amount
      ** Include repayments for loan processing types 68,69,71 and 72     CLE005
      ** only if CLE005 is installed                                      CLE005
      ** ... and include processing type 80 only if CLE028 is installed                       CLE028
      *
     C                     MOVE *BLANKS   WALLOW  1                                           CLE028
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           CLE005    OREQ 'N'                                       CLE005
     C           PTYPL     ANDNE68                                        CLE005
     C           PTYPL     ANDNE69                                        CLE005
     C           PTYPL     ANDNE71                                        CLE005
     C           PTYPL     ANDNE72                                        CLE005
     C                     MOVE 'Y'       WALLOW                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           CLE028    IFNE 'Y'                                                           CLE028
     C           PTYPL     ANDEQ80                                                            CLE028
     C                     MOVE *BLANKS   WALLOW                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           WALLOW    IFEQ 'Y'                                                           CLE028
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE CPAM      ZFLD15
     C                     Z-ADDWCDP      ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    SCURP
      *                                                                   158534
      ** Access the Customer Details file for Shortname                   158534
      *                                                                                       207629
      **If the loan is a Participation Purchased, & System Value                              207629
      ** LoanCustOriginPurch = 'O', use Original Borrower:                                    207629
      *                                                                                       207629
     C           PPCUST    IFEQ 'O'                                                           207629
     C           PTYPL     IFEQ 64                                        158534
     C           PTYPL     OREQ 65                                        158534
     C           PTYPL     OREQ 68                                                            207629
     C           PTYPL     OREQ 71                                                            207629
     C                     MOVE OLNO      SCNUM                           158534
     C                     END                                            158534
     C                     ENDIF                                                              207629
      *                                                                   CAP063
      ** Mode is 'F'                                                      CAP063
     C           PMODE     IFEQ 'F'                                       CAP063
     C                     MOVELSCUST     SCNUM                           CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
     C                     MOVE *BLANKS   WKEYC                           158534
     C                     MOVELSCNUM     WKEYC                           158534
     C                     CALL 'AOCUSTR0'                                158534
     C                     PARM '       ' PRTCD                           158534
     C                     PARM '*KEY   ' @OPTN                           158534
     C                     PARM SCNUM     WKEYC                           158534
     C                     PARM           KEYSTS                          158534
     C           SDCUST    PARM SDCUST    DSSDY                           158534
     C                     MOVE *BLANKS   SCSNM                           158534
     C           PRTCD     IFEQ *BLANKS                                   158534
     C                     MOVE BBCSSN    SCSNM                           158534
     C                     ELSE                                           158534
     C                     MOVE 'Unknown' SCSNM                           158534
     C                     END                                            158534
      *
     C           WCOUNT    IFLT 10
     C                     WRITELE2110S0
     C                     ADD  1         SRRN    40
     C                     ADD  1         WCOUNT
     C                     ENDIF
     C                     ENDIF                                          CLE005
     C                     ENDIF
     C                     ENDIF
      *
     C           PMODE     IFEQ 'F'                                       CAP063
     C                     READ LEIMRPD1                 37               CAP063
     C                     ELSE                                           CAP063
     C           SRAUT     IFEQ 'Y'
     C                     READ LELOAML1                 37
     C                     ELSE
     C                     READ LELOAML0                 37
     C                     ENDIF
     C                     ENDIF                                          CAP063
      *
     C           *IN37     IFEQ *ON
     C                     Z-ADDSRRN1     SRCNR
     C                     LEAVE
     C                     ENDIF
      *
     C                     MOVE '0'       *IN,64
     C                     ENDDO
      *
      ** Read an extra valid record for the proper display of rollup
      ** function
      *
     C           *IN37     DOWEQ'0'
      *
     C           FAMTP     IFEQ 'MR'
     C                     Z-ADD*ZERO     @ERR                        Z
     C           MBIN      IFEQ 'Y'
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBBBU'
     C                     PARM BRCA      @ZBR
     C                     PARM           @USER
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVBBU'
     C                     PARM BRCA      @ZBR
     C                     PARM           @ERR
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *                                                                   CLE005
      ** Still check if CLE005 is installed, before including loan        CLE005
      ** processing types 68,69,71 and 72                                 CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'N'                                       CLE005
     C           @ERR      ANDEQ*ZERO                                     CLE005
     C                     MOVE FLNRF     WLOAN                           CLE005
     C           KCLOAN    CHAINCLOAN               N39                   CLE005
     C           PTYPL     IFEQ 68                                        CLE005
     C           PTYPL     OREQ 69                                        CLE005
     C           PTYPL     OREQ 71                                        CLE005
     C           PTYPL     OREQ 72                                        CLE005
     C                     Z-ADD1         @ERR                            CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                                       CLE028
      ** Still check if Flat rate personal loans is installed,                                CLE028
      ** before including processing type 80                                                  CLE028
      *                                                                                       CLE028
     C           CLE028    IFNE 'Y'                                                           CLE028
     C           @ERR      ANDEQ*ZERO                                                         CLE028
     C                     MOVE FLNRF     WLOAN                                               CLE028
     C           KCLOAN    CHAINCLOAN               N39                                       CLE028
     C           PTYPL     IFEQ 80                                                            CLE028
     C                     Z-ADD1         @ERR                                                CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *
     C           FAMTP     IFEQ 'MR'
     C           @ERR      ANDEQ*ZERO
     C                     LEAVE
     C                     ENDIF
      *
     C           PMODE     IFEQ 'F'                                       CAP063
     C                     READ LEIMRPD1                 37               CAP063
     C                     ELSE                                           CAP063
     C           SRAUT     IFEQ 'Y'
     C                     READ LELOAML1                 37
     C                     ELSE
     C                     READ LELOAML0                 37
     C                     ENDIF
     C                     ENDIF                                          CAP063
      *
     C                     ENDDO
      *
     C           SRRN      IFEQ 0
     C           *IN37     OREQ *ON
     C           WCOUNT    ANDEQ0
     C                     MOVEA'10'      *IN,22
     C                     MOVEA'11'      *IN,37
     C                     ELSE
     C                     Z-ADDSRRN      SRRN1   40
     C                     ENDIF
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRSTR1   - Initialise all screen fields                       *
      * Called by: SRSTRT, SRBTCH                                     *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSTR1    BEGSR
     C                     MOVELUSER      SUSER
     C                     MOVE BJMRDT    SRUNA
     C                     MOVELWSID      SWSID
     C************IN46     IFEQ '0'                                       125974
     C***********          MOVE 'Y'       SRAUT                           125974
     C***********          ELSE                                           125974
     C                     MOVE 'N'       SRAUT
     C***********          ENDIF                                          125974
     C           WWRTRN    IFNE 'S0'
     C                     MOVE *BLANKS   SACTN
     C                     ENDIF
      *                                                                   CAP063
     C           PMODE     IFNE 'F'                                       CAP063
     C                     MOVE *BLANKS   SRFLN
     C                     MOVE *BLANKS   SLOAN
     C                     MOVE *BLANKS   SSTAT
     C                     MOVE *BLANKS   SCUST
     C***********          MOVE *BLANKS   SCCY                            156873
     C                     MOVE *BLANKS   SSCCY                           156873
     C                     MOVE *BLANKS   #1INRF                                              CLE028
     C                     MOVE *BLANKS   #1CGRF                                              CLE028
     C                     MOVE *BLANKS   SVALD
     C                     MOVE *BLANKS   SSEQN
     C                     ENDIF                                          CAP063
      *
     C                     MOVEA'00000000'*IN,67
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRSTR2   - Initialise all screen fields                       *
      * Called by: SRSTRT, SRSUBP, SRBTCH                             *
      * Calls    : CLEAR                                              *
      *****************************************************************
     C           SRSTR2    BEGSR
      *
     C           PMODE     IFNE 'F'                                       CAP063
     C                     MOVE *BLANKS   SCURP
     C                     MOVE *BLANKS   SINTD
     C                     MOVE *BLANKS   SWTTP
     C                     MOVE *BLANKS   SPASD
     C                     MOVE *BLANKS   SEVAL
     C                     MOVE *BLANKS   SESEQ
     C                     MOVE *BLANKS   SRCCY                                               CLE036
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
     C                     MOVE *BLANKS   SRPRI
     C                     MOVE *BLANKS   SPSIG
     C                     MOVE *BLANKS   SEPRI
     C                     MOVE *BLANKS   SRINT
     C                     MOVE *BLANKS   SISIG
     C                     MOVE *BLANKS   SEINT
     C                     MOVE *BLANKS   SRPEN
     C                     MOVE *BLANKS   SRPIG
     C                     MOVE *BLANKS   SEPEN
     C                     MOVE *BLANKS   SWHTX
     C                     MOVE *BLANKS   SRTOT
     C                     MOVE *BLANKS   SRSIG
     C                     MOVE *BLANKS   SETOT
     C                     MOVE *BLANKS   SWOFF
     C                     MOVE *BLANKS   SEPEN                           157744
     C                     MOVE *BLANKS   SSCCY                                               CLE036
     C                     MOVE *BLANKS   SEXCY                                               CLE036
     C***********          MOVE *BLANKS   SSIN1                           121123
     C***********          MOVE *BLANKS   SSIN2                           121123
     C***********          MOVE *BLANKS   SSIN3                           121123
     C                     EXSR CLEAR
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRSTR3   - Initialise all work fields                         *
      * Called by: SRSTRT, SRBTCH                                     *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSTR3    BEGSR
      *
      ** Reset last update fields for new transaction
      *
     C                     MOVE *BLANKS   WLSTCR
     C                     MOVE *BLANKS   WLSTCL
     C                     MOVE *BLANKS   WLSTCA
     C                     MOVE *BLANK    WNOTBK  1
     C                     MOVE *BLANK    WINSC   1
     C                     MOVE *BLANK    WERR    1
     C                     MOVE *BLANK    WAMTP                           154576
     C                     Z-ADD0         WCOUNT  20
     C                     Z-ADD0         WEPAM                           157744
      *                                                                                       CLE028
     C                     Z-ADD*ZERO     WINRF                                               CLE028
     C                     Z-ADD*ZERO     WCGRF                                               CLE028
      *                                                                                       CLE028
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRSVD1   - Subfile Validation.                                *
      * Called by: SRSUBF                                             *
      * Calls    : ZASNMS, SRCAUT, SRXAUT                             *
      *****************************************************************
     C           SRSVD1    BEGSR
      *
     C                     READCLE2110S0                 36
     C                     MOVE ' '       WFIRST  1
     C                     MOVE ' '       WDET    1
      *
     C           *IN36     DOWEQ'0'
      *
     C                     MOVE '0'       *IN49
     C                     MOVE 'N'       WERR
      *
      ** Action code if not blank, and not E, A, X or R
      *
     C           SACTN     IFNE 'E'
     C           SACTN     ANDNE'A'
     C           SACTN     ANDNE'X'
     C           SACTN     ANDNE'R'
     C           SACTN     ANDNE' '
     C           PMODE     ANDNE'F'                                       CAP063
     C                     MOVE '1'       *IN49
     C                     MOVE 'LEM0014' ZAMSID
     C                     MOVE 'Y'       WERR
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                   CAP063
     C           SACTN     IFNE 'U'                                       CAP063
     C           SACTN     ANDNE'Q'                                       CAP063
     C           SACTN     ANDNE' '                                       CAP063
     C           PMODE     ANDEQ'F'                                       CAP063
     C                     MOVE '1'       *IN49                           CAP063
     C                     MOVE 'LEA1044' ZAMSID                          CAP063
     C                     MOVE 'Y'       WERR                            CAP063
     C                     EXSR ZASNMS                                    CAP063
     C                     ENDIF                                          CAP063
      *
     C           SACTN     IFNE *BLANK
      ** Check user authority on action
      *
     C           WERR      IFNE 'Y'                                       CAP063
     C           SACTN     ANDEQ'Q'                                       CAP063
     C                     EXSR INVLTM                                    CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
     C           WERR      IFNE 'Y'
     C                     MOVE SSBRC     BRCA
     C                     EXSR SRCAUT
     C           @ERR      IFNE 0
     C                     MOVE '1'       *IN49
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVE SLOAN     WLNRF
     C                     MOVE SVALD     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    WVALD
     C                     MOVE SSEQN     SLASN
      *
     C           KLMKEY    CHAINLOAMS               N50
      *
     C           *IN50     IFEQ '0'
     C           SACTN     ANDEQ'X'
     C           *IN46     IFEQ '0'
     C                     MOVE 'Y'       WERR
     C                     MOVE '1'       *IN49
     C                     MOVEL'LEM0014' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                   123998
      *  Retrieve text for SSTAT comparison                               123998
     C                     MOVEL'LEA0061' ZAMSID                          123998
     C                     EXSR SRTEXT                                    123998
     C                     MOVELZAMSTX    Z1MSTX                          123998
     C                     MOVEL'LEA0062' ZAMSID                          123998
     C                     EXSR SRTEXT                                    123998
     C                     MOVELZAMSTX    Z2MSTX                          123998
     C                     MOVEL'LEA0063' ZAMSID                          123998
     C                     EXSR SRTEXT                                    123998
     C                     MOVELZAMSTX    Z3MSTX                          123998
     C                     MOVEL'LEA0060' ZAMSID                          123998
     C                     EXSR SRTEXT                                    123998
     C                     MOVE *BLANKS   ZAMSID                          123998
      *
     C***********SSTAT     IFEQ WSTAT,1                                   123998
     C           SSTAT     IFEQ ZAMSTX                                    123998
     C                     MOVEL'C'       ASTS
     C                     ENDIF
     C***********SSTAT     IFEQ WSTAT,2                                   123998
     C           SSTAT     IFEQ Z1MSTX                                    123998
     C                     MOVEL'R'       ASTS
     C                     ENDIF
     C***********SSTAT     IFEQ WSTAT,3                                   123998
     C           SSTAT     IFEQ Z2MSTX                                    123998
     C                     MOVEL'A'       ASTS
     C                     ENDIF
     C***********SSTAT     IFEQ WSTAT,4                                   123998
     C           SSTAT     IFEQ Z3MSTX                                    123998
     C                     MOVEL'D'       ASTS
     C                     ENDIF
      *
     C***********SSTAT     IFEQ WSTAT,3                                   123998
     C           SSTAT     IFEQ Z2MSTX                                    123998
     C           WERR      ANDEQ'N'
     C                     MOVE 'Y'       WERR
     C                     MOVE '1'       *IN49
     C                     MOVEL'LEM0011' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                   123998
     C                     MOVE *BLANKS   ZAMSTX                          123998
     C                     MOVE *BLANKS   Z1MSTX                          123998
     C                     MOVE *BLANKS   Z2MSTX                          123998
     C                     MOVE *BLANKS   Z3MSTX                          123998
     C/COPY WNCPYSRC,LE2110C024
      *
     C           AUSR      IFEQ USER
     C           WERR      ANDEQ'N'
     C           IUSR      OREQ USER
     C           WERR      ANDEQ'N'
     C                     MOVE 'Y'       WERR
     C                     MOVE '1'       *IN49
     C                     MOVEL'LEM0013' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C/COPY WNCPYSRC,LE2110C025
      *
     C           WERR      IFNE 'Y'
     C           SACTN     IFEQ 'X'
     C                     EXSR SRXAUT
     C           *IN67     IFEQ '1'
     C                     MOVE '1'       *IN49
     C                     ENDIF
     C                     ENDIF
      *
     C           SACTN     IFEQ 'X'
     C           SSTAT     ANDEQ'A'
     C                     MOVE 'Y'       WERR
     C                     MOVE '1'       *IN49
     C                     MOVEL'LEM0011' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C           WERR      IFEQ 'Y'
     C           WFIRST    ANDEQ' '
     C                     MOVE SRRN      SRCNR
     C                     MOVE 'Y'       WFIRST  1
     C                     ENDIF
     C           SACTN     IFNE 'D'                                       CAP063
     C                     MOVE '1'       *IN21
     C                     ENDIF                                          CAP063
     C                     ENDIF
      *
     C                     MOVE *BLANKS   WDELET  1                       CAP063
     C           WERR      IFNE 'Y'                                       CAP063
     C           SACTN     ANDEQ'Q'                                       CAP063
     C                     MOVE *BLANKS   SACTN                           CAP063
     C                     MOVE 'Y'       WDELET                          CAP063
     C                     MOVE 'Y'       WFIRST                          CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
     C           SACTN     IFEQ *BLANK
     C                     MOVE '0'       *IN49
     C                     MOVE '0'       *IN21
     C                     ENDIF
      *
     C           PMODE     IFEQ 'F'                                       CAP063
     C           WFIRST    ANDNE'Y'                                       CAP063
     C           SACTN     ANDEQ'U'                                       CAP063
     C                     MOVE SLSEL     SACTN                           CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
     C                     UPDATLE2110S0
     C                     MOVE 'Y'       WDET
     C                     READCLE2110S0                 36
     C                     ENDDO
     C                     ENDSR
      *
      /EJECT
      *****************************************************************   CAP063
      * INVLTM   - Subfile Processing                                 *   CAP063
      * Called by: SRSVD1                                             *   CAP063
      * Calls    :                                                    *   CAP063
      *****************************************************************   CAP063
     C           INVLTM    BEGSR                                          CAP063
      *                                                                   CAP063
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
      *                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     MOVE 'Y'       SUPSYS  1                       CSC011
     C                     ELSE                                           CSC011
     C                     MOVE 'N'       SUPSYS                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     CALL 'LE2031'                                  CAP063
      *                                                                   CAP063
      * INPUTS                                                            CAP063
      * Invalid file name                                                 CAP063
     C                     PARM 'LEIMRPPD'INVFIL  8                       CAP063
      *                                                                   CAP063
      * Repair Number                                                     CAP063
     C                     PARM XREPN     IREPN   50                      CAP063
      *                                                                   CAP063
      **Support*System On                                                              CSC011 222373
     C**********           PARM SUPSYS    SUPSYS                                       CSC011 222373
      **Front*Office ID / PC Transaction Reference                                     CSC011 222373
     C**********           PARM STNRF     STNRF                                        CSC011 222373
      **Transaction Timestamp                                                          CSC011 222373
     C**********           PARM STMST     STMST                                        CSC011 222373
      **********                                                                       CSC011 222373
     C                     ENDSR                                          CAP063
      /EJECT                                                              CAP063
      *****************************************************************
      * SRSUBP   - Subfile Processing                                 *
      * Called by: SRSUBF                                             *
      * Calls    : SRSTR2, SRINT1, SRFRMT                             *
      *****************************************************************
     C           SRSUBP    BEGSR
      *
     C                     READCLE2110S0                 36
     C                     MOVEL'S0'      WWRTRN
     C                     MOVEL'D1'      WFMT
     C                     Z-ADDSRRN      SRCNR
      *
     C           *IN36     DOWEQ'0'
     C           WFMT      ANDNE*BLANKS
      *
     C                     EXSR SRSTR2
      *
     C                     MOVE SLOAN     WLOAN
     C           KCLOAN    CHAINCLOAN               N39
      *
     C                     MOVE SLOAN     WLNRF
     C                     MOVE SVALD     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    WVALD
     C                     Z-ADDZDAYNO    WDAYNV
     C                     MOVE SSEQN     SLASN
     C                     MOVE *BLANK    WREAC                           CLE007
     C                     MOVE FCUS      W1FCUS  6                       159256
     C                     MOVE FTYP      W1FTYP  3                       159256
     C                     MOVE FSEQ      W1FSEQ  2                       159256
     C                     MOVE BRCA      WBRCDA                          217046
     C           CLE007    IFEQ 'Y'                                       CLE007
     C           RECIL     ANDEQ'M'                                       131253
     C***********RECI      ANDEQ'M'                                CLE007 131253
     C                     MOVE 'Y'       WREAC                           CLE007
     C                     ENDIF                                          CLE007
      *
     C           KLMKEY    CHAINLOAMS               N50
      *
     C                     MOVE OSBR      W#OSBR  3                       123699
      *                                                                   123699
     C                     EXSR SRINT1
     C                     EXSR SRFRMT
      *
     C           WFMT      DOUEQ'F0'
     C           WFMT      OREQ 'S0'
     C           WFMT      OREQ *BLANKS
      *
     C           WFMT      CASEQ'D1'      SRDET1
     C           WFMT      CASEQ'WR'      SRWRIT
     C           WFMT      CASEQ'UP'      SRUPDT
     C                     ENDCS
     C                     ENDDO
      *
     C           WFMT      IFNE *BLANKS
     C           WFMT      ANDNE'S0'
     C                     MOVE 'D1'      WFMT
     C                     ENDIF
      *
     C                     MOVE *BLANK    SACTN
     C                     UPDATLE2110S0
     C                     MOVE 'Y'       WTOP    1
      *
     C           *INKL     IFEQ '1'
     C                     LEAVE
     C                     ENDIF
      *
     C                     READCLE2110S0                 36
     C                     ENDDO
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRDET1   - First Detail Screen                                *
      * Called by: Main Processing, SRSUBP                            *
      * Calls    : SRVAL1, SRWIND, SRDET2, SRHOLI                     *
      *            SRWARN - Display warning message if loan is synd.  *   159256
      *****************************************************************
     C           SRDET1    BEGSR
      *
      ** Set indicator for Loan processing type
      *
     C                     SELEC
     C           PTYPL     WHEQ 66
     C           PTYPL     OREQ 67
     C                     MOVE *ON       *IN52
     C           PTYPL     WHEQ 70
     C                     MOVE *ON       *IN63
     C           PTYPL     WHEQ 64
     C           PTYPL     OREQ 65
     C                     MOVE *ON       *IN53
     C                     ENDSL
      *                                                                   CLE005
      ** Process new loan processing types for CLE005                     CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C                     SELEC                                          CLE005
     C           PTYPL     WHEQ 69                                        CLE005
     C           PTYPL     OREQ 72                                        CLE005
     C                     MOVE *ON       *IN52                           CLE005
     C           PTYPL     WHEQ 71                                        CLE005
     C                     MOVE *ON       *IN63                           CLE005
     C           PTYPL     WHEQ 68                                        CLE005
     C                     MOVE *ON       *IN53                           CLE005
     C                     ENDSL                                          CLE005
     C                     ENDIF                                          CLE005
      *
     C                     MOVE 'N'       WWERR   1
     C                     MOVE *BLANK    WOK1    1
     C                     MOVE *BLANKS   PMSDTV
     C                     MOVE *BLANKS   @SDTV
     C                     MOVE 'Y'       FPASS   1
      *                                                                   131253
     C********** SACTN     IFEQ 'R'                                131253 186752
     C********** CLE005    ANDEQ'Y'                                131253 186752
     C********** RECIL     ANDEQ'M'                                131253 186752
      *                                                                   131253
     C**********           MOVE 'LEV1042' ZAMSID                   131253 186752
     C**********           CALL 'Y2SNMGC'                          131253 186752
     C**********           PARM           ZAPGMQ 10        Program 131253 186752
     C**********           PARM           ZAPGRL  5        Rel queu131253 186752
     C**********           PARM           ZAMSID  7        Message 131253 186752
     C**********           PARM           ZAMSGF 10        Message 131253 186752
     C**********           PARM           ZAMSDA132        Message 131253 186752
     C**********           PARM           ZAMSTP  7        Message 131253 186752
      *                                                                   131253
     C**********           ENDIF                                   131253 186752
     C*                                                                   131253
      ** Issue warning if loan is a syndicated loan (if called from       159256
      ** subfile processing).                                             159256
      *                                                                   159256
     C           SACTN     IFNE 'E'                                       159256
     C           SACTN     ANDNE'I'                                       159256
     C           WWRTRN    ANDEQ'S0'                                      159256
     C                     MOVE W1FCUS    FCUS                            159256
     C                     MOVE W1FTYP    FTYP                            159256
     C                     MOVE W1FSEQ    FSEQ                            159256
     C                     EXSR SRWARN                                    159256
     C                     ENDIF                                          159256
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE *ON       *IN90                                               CLE034
     C           SACTN     IFEQ 'I'                                                           CLE034
     C           SACTN     OREQ 'A'                                                           CLE034
     C                     MOVE *OFF      *IN91                                               CLE034
     C                     MOVE *OFF      *IN92                                               CLE034
     C           SACTN     IFEQ 'A'                                                           CLE034
     C           STALK     ANDNE*BLANKS                                                       CLE034
     C                     MOVE STALK     SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
     C           SACTN     IFEQ 'I'                                                           CLE034
     C           SSTAL     ANDEQ*BLANKS                                                       CLE034
     C                     MOVE 'N'       SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *ON       *IN92                                               CLE034
     C           STALK     IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'N'       SSTAL                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE STALK     SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *
     C           WFMT      DOWEQ'D1'
     C                     WRITELE2110F0
     C                     WRITELE2110C1
     C                     WRITELE2110F2
     C                     EXFMTLE2110D1
      *                                                                   123857
      * If warning error is shown allow user to authorise and exit from   123857
      * screen.                                                           123857
      *                                                                   123857
     C           SACTN     IFEQ 'X'                                       123857
     C           *IN45     ANDEQ*ON                                       123857
     C***        WWERR     ANDEQ'Y'                                123857 158207
     C                     MOVE 'Y'       W#EXIT  1                       123857
     C                     MOVE 'UP'      WFMT                            123857
     C                     ENDIF                                          123857
      *                                                                   170120
      * If validation has been carried out allow the user to authorise    170120
      * the transaction and exit.                                         170120
      *                                                                   170120
     C           SACTN     IFEQ 'A'                                       170120
     C           #VALID    ANDEQ'Y'                                       170120
     C           *INKN     ANDEQ'0'                                       170120
     C                     MOVE 'Y'       W#EXIT  1                       170120
     C                     MOVE 'UP'      WFMT                            170120
     C                     MOVE 'N'       #VALID                          170120
     C                     LEAVE                                          170120
     C                     ELSE                                           170120
     C           SACTN     IFEQ 'I'                                       170120
     C           #VALID    ANDEQ'Y'                                       170120
     C           *INKN     ANDEQ'0'                                       170120
     C           W@DETA    ANDEQW@DETB                                    170120
     C           W@DET2    ANDEQWKDET2                                    170120
     C           WERR      ANDNE'Y'                                                           CLE036
     C                     MOVE 'Y'       W#EXIT  1                       170120
     C                     MOVE 'WR'      WFMT                            170120
     C                     MOVE 'N'       #VALID                          170120
     C                     MOVE *BLANKS   W@DETB                          170120
     C                     LEAVE                                          170120
     C                     ENDIF                                          170120
     C                     ENDIF                                          170120
      *
     C                     MOVE 'N'       WERR
     C                     MOVE *BLANK    WOK     1
      *
      **   SET OFF ERROR INDICATORS
      *
     C                     MOVEA'0000000' *IN,75
     C                     MOVEA'0000'    *IN,82
     C                     MOVE '0'       *IN18
     C                     MOVE '0'       *IN29
     C                     MOVE '0'       *IN70                           161072
      *
     C                     EXSR CLEAR
      *                                                                   186752
      ** Validation for loan reactivation                                 186752
      *                                                                   186752
     C           SACTN     IFEQ 'R'                                       186752
     C           CLE005    ANDEQ'Y'                                       186752
     C           RECIL     ANDEQ'M'                                       186752
      *                                                                   186752
     C                     MOVE 'N'       CNTAGN  1                       186752
     C                     Z-ADD0         CNTRTF  10                      186752
     C                     Z-ADD0         CNTAMD  20                      186752
      *
      ** Check if there are other -ve MRs intended for the loan's         186752
      ** reactivation.                                                    186752
      *                                                                   186752
     C                     MOVE SLOAN     WLNRF                           186752
     C                     Z-ADD0         WVALD                           186752
     C                     Z-ADD0         SLASN                           186752
     C           KLMKEY    SETLLLOAMD                                     186752
     C                     READ LOAMD                    50               186752
     C           *IN50     DOWEQ'0'                                       186752
      *                                                                   186752
     C           LNRFA     IFNE WLNRF                                     186752
     C                     LEAVE                                          186752
     C                     ENDIF                                          186752
      *                                                                   186752
     C           AMTPA     IFEQ 'MR'                                      186752
     C           RECIA     ANDEQ'D'                                       186752
     C           TAMTA     ANDLT0                                         186752
     C           PASTA     ANDEQ'Y'                                       186752
     C                     ADD  1         CNTRTF                          186752
     C                     ENDIF                                          186752
      *                                                                   186752
      ** Check if there are other amendments for the loan                 186752
      *                                                                   186752
     C           AMTPA     IFNE 'MR'                                      186752
     C           RECIA     ANDEQ'D'                                       186752
     C                     ADD  1         CNTAMD                          186752
     C                     ENDIF                                          186752
      *                                                                   186752
     C                     READ LOAMD                    50               186752
      *                                                                   186752
     C                     ENDDO                                          186752
      *                                                                   186752
      ** Display error message if MR for reactivation is being reversed   186752
      ** prior to reversing other amendments.                             186752
      *                                                                   186752
     C           CNTRTF    IFEQ 1                                         186752
     C           CNTAMD    ANDGT0                                         186752
     C                     MOVE 'Y'       WERR                            186752
     C                     MOVE 'Y'       CNTAGN                          186752
     C                     MOVE '0'       *INKJ                           186752
     C                     MOVE '0'       *INKN                           186752
     C                     MOVE 'LEV1042' ZAMSID                          186752
     C                     EXSR ZASNMS                                    186752
     C                     ENDIF                                          186752
      *                                                                   186752
     C                     ENDIF                                          186752
     C           *INKC     IFEQ '1'
     C                     MOVEL*BLANKS   WFMT
     C                     LEAVE
     C                     ENDIF
      *
     C           *INKL     IFEQ '1'
     C           WWRTRN    IFEQ 'S0'
     C                     MOVEL'S0'      WFMT
     C                     ELSE
     C                     MOVEL'F0'      WFMT
     C                     ENDIF
     C                     EXSR CLEAR                                     186752
     C                     LEAVE
     C                     ENDIF
      *
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'X'                                       123857
     C           *IN45     ANDEQ*ON                                       123857
     C                     EXSR SRVAL1
     C                     ENDIF
      *                                                                                       CLE034
      ** Validate Settlement Allocation field                                                 CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SACTN     IFEQ 'I'                                                           CLE034
     C           SACTN     OREQ 'A'                                                           CLE034
     C                     MOVE *ON       *IN90                                               CLE034
     C                     MOVE *OFF      *IN91                                               CLE034
     C                     MOVE *OFF      *IN92                                               CLE034
     C           SSTAL     IFEQ *BLANKS                                                       CLE034
     C                     MOVEL'N'       SSTAL   1                                           CLE034
     C                     ELSE                                                               CLE034
     C           SSTAL     IFNE 'Y'                                                           CLE034
     C           SSTAL     ANDNE'N'                                                           CLE034
     C                     MOVE *ON       *IN91                                               CLE034
     C                     MOVE 'Y'       WERR                                                CLE034
     C                     MOVE 'LEM0058' ZAMSID                                              CLE034
     C                     EXSR ZASNMS                                                        CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
     C***********          MOVE SSTAL     STALK                                        CLE034 219608
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *
     C           *INKJ     IFEQ '1'
     C           SACTN     IFNE 'R'
     C                     MOVE *ON       *IN75
     C                     MOVE 'LEM0016' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     MOVEL'UP'      WFMT
     C                     MOVE *OFF      *IN26                           158802
     C                     ENDIF
     C                     ENDIF
      *
     C           *INKK     IFEQ '1'
     C           SACTN     IFNE 'X'
     C                     MOVE *ON       *IN75
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0017' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     MOVEL'D2'      WFMT                            123857
     C                     EXSR SRDET2                                    123857
     C                     MOVEL'UP'      WFMT
     C                     ENDIF
     C                     ENDIF
      *
      ** Enter is pressed
      *
     C           WERR      IFNE 'Y'
     C           WOK1      ANDNE'Y'
     C           WWERR     ANDNE'Y'
     C/COPY WNCPYSRC,LE2110C027
     C                     EXSR SRWIND
     C                     ENDIF
      *
     C           WERR      IFNE 'Y'
     C           WOK1      ANDNE'Y'
     C           WWERR     ANDNE'Y'
     C           *INKJ     ANDEQ'0'
     C           *INKK     ANDEQ'0'
     C           SACTN     ANDNE'E'
     C           @SDTV     ANDNE'Y'
     C           *INKN     OREQ '1'
     C                     MOVEL'D2'      WFMT
     C                     EXSR SRDET2
     C                     ENDIF
      *
      ** Validate CCY against holiday
      *
     C           SACTN     IFEQ 'I'
     C           PMSDTV    ANDNE'N'                                       170120
     C           SACTN     OREQ 'A'
     C           PMSDTV    ANDNE'N'                                       170120
     C           SACTN     OREQ 'X'                                       123857
     C           *IN45     ANDEQ*ON                                       123857
     C           W#EXIT    ANDEQ' '                                       123857
     C           @SDTV     IFEQ 'Y'
     C           WWERR     IFNE 'Y'
     C           WOK1      ANDNE'Y'
     C                     EXSR SRHOLI
     C                     ELSE
      * Redisplay screen if there are still errors outstanding:                               CLE036
     C           WERR      IFEQ 'Y'                                                           CLE036
     C                     MOVE 'D1'      WFMT                                                CLE036
     C                     ELSE                                                               CLE036
     C           SACTN     IFEQ 'I'
     C                     MOVE 'WR'      WFMT
     C                     ENDIF
     C           SACTN     IFEQ 'A'
     C                     MOVE 'UP'      WFMT
     C                     ENDIF
     C                     ENDIF                                                              CLE036
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      *
     C           SACTN     IFEQ 'E'
     C           WWRTRN    ANDEQ'S0'
     C           *INKN     ANDEQ'0'
     C                     MOVE 'F0'      WFMT
     C                     ENDIF
      *
     C                     ENDDO
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRHOLI   - Check for holiday in nostro location               *
      * Called by: SRDET1                                             *
      * Calls    : ZASNMS                                             *
      *****************************************************************
     C           SRHOLI    BEGSR
      *
     C           WTYPE     IFNE '00'
     C           WTYPE     ANDNE'  '
     C           CLE034    ANDEQ'N'                                                           CLE034
      *                                                                                       CLE034
     C           CLE034    OREQ 'Y'                                                           CLE034
     C           WTYPE     ORNE '00'                                                          CLE034
     C           WTYPE     ANDNE'  '                                                          CLE034
     C           SSTAL     ANDNE'Y'                                                           CLE034
      *                                                                                       CLE034
     C           CLE034    OREQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
     C           PNODT     ANDNE'Y'                                                           CLE034
      *
     C                     Z-ADDWDAYNV    ZDAYNO
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           PTYPL     IFEQ 66                                                            CLE034
     C           PTYPL     OREQ 69                                                            CLE034
     C           PTYPL     OREQ 72                                                            CLE034
     C                     MOVEAPPSTC     ACY                                                 CLE034
     C                     MOVEAPPSTL     ALC                                                 CLE034
     C                     ELSE                                                               CLE034
     C                     MOVEAPRSTC     ACY                                                 CLE034
     C                     MOVEAPRSTL     ALC                                                 CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE *ON       *IN97                                               CLE034
      *                                                                                       CLE034
     C           ACY,1     IFEQ *BLANKS                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE LOCY      ACY,1                                               CLE034
     C                     MOVE SYSL      ALC,1                                               CLE034
     C                     ENDIF                                                              CLE034
      *
      ** Find the location of the settlement
      *
     C***********WTYPE     IFEQ '01'                                      CEU004
     C***********WTYPE     OREQ '07'                                      CEU004
     C***********WTYPE     OREQ '08'                                      CEU004
     C********** WTYPE     IFNE '01'                                                   CEU004 CLE034
     C********** WTYPE     ANDNE'07'                                                   CEU004 CLE034
     C********** WTYPE     ANDNE'08'                                                   CEU004 CLE034
     C**********           MOVE LOCY      ZCCY                                                CLE034
     C**********           MOVE SYSL      ZLOC                                                CLE034
     C                     ELSE
      *                                                                                       CLE034
     C           WTYPE     IFEQ '01'                                                          CLE034
     C           WTYPE     OREQ '07'                                                          CLE034
     C           WTYPE     OREQ '08'                                                          CLE034
     C                     MOVE *ON       *IN97                                               CLE034
      *
      **  Find the location of the settlement
      *
     C                     MOVE WTYPE     W@SETP  2
     C                     MOVE OSBR      W@SNOS  2
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           SCCYL     ANDNE*BLANKS                                   CEU004
     C                     MOVE SCCYL     W@CCY   3                       CEU004
     C                     ELSE                                           CEU004
     C                     MOVE CCYL      W@CCY   3
     C                     ENDIF                                          CEU004
     C                     EXSR SRSLOC
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           SCCYL     ANDNE*BLANKS                                   CEU004
     C                     MOVE SCCYL     ZCCY                            CEU004
     C                     MOVE SCCYL     ACY,1                                               CLE034
     C                     ELSE                                           CEU004
     C                     MOVE CCYL      ZCCY
     C                     MOVE CCYL      ACY,1                                               CLE034
     C                     ENDIF                                          CEU004
     C                     MOVE W@STLL    ZLOC
     C                     MOVE W@STLL    ALC,1                                               CLE034
     C**********           ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE LOCY      ACY,1                                               CLE034
     C                     MOVE SYSL      ALC,1                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD1         WC      20                                          CLE034
      *                                                                                       CLE034
     C           WC        DOWLE20                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE ACY,WC    ZCCY                                                CLE034
     C                     MOVE ALC,WC    ZLOC                                                CLE034
      *                                                                                       CLE034
     C           ZCCY      IFNE *BLANKS                                                       CLE034
     C                     MOVE *ZEROS    ZNRDYS                                              CLE034
      *
      ** If date is holiday send warning messages
      *
     C                     EXSR ZCHKH
      *
     C           WTYPE     IFEQ '01'
     C           WTYPE     OREQ '07'
     C           WTYPE     OREQ '08'
      *
     C           ZIND      IFEQ 'H'
     C           ZCCY      IFEQ CCYL
     C                     MOVE 'Y'       WWERR
     C                     MOVEL'LEM0053' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     MOVE 'Y'       WWERR
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVEL'LEM1001' ZAMSID                          CEU004
     C                     ELSE                                           CEU004
     C                     MOVEL'LEM0052' ZAMSID
     C                     ENDIF                                          CEU004
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ADD  1         WC                                                  CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *
     C           WWERR     IFEQ 'Y'
     C                     MOVE *ON       *IN18
     C                     MOVE 'D1'      WFMT
     C                     MOVE 'Y'       WOK1
     C                     ELSE
     C           SACTN     IFEQ 'I'
     C***********          MOVE 'WR'      WFMT                            170120
     C                     MOVE 'D1'      WFMT                            170120
     C                     MOVE 'Y'       #VALID  1                       170120
     C                     MOVE W@DETA    W@DETB 70                       170120
     C                     MOVE W@DET2    WKDET2  2                       170120
     C                     ENDIF
     C           SACTN     IFEQ 'A'
     C***********          MOVE 'UP'      WFMT                            170120
     C                     MOVE 'D1'      WFMT                            170120
     C                     MOVE 'Y'       #VALID                          170120
     C                     ENDIF
     C           SACTN     IFEQ 'X'                                       123857
     C           *IN45     ANDEQ*ON                                       123857
     C                     MOVE 'UP'      WFMT                            123857
     C                     ENDIF                                          123857
     C                     ENDIF
      *                                                                   123857
     C                     ELSE                                           123857
      *                                                                   123857
     C           WTYPE     IFEQ '00'                                      123857
     C           CLE034    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           CLE034    OREQ 'Y'                                                           CLE034
     C           WTYPE     ANDEQ'00'                                                          CLE034
     C           SSTAL     ANDNE'Y'                                                           CLE034
      *                                                                                       CLE034
     C           CLE034    ANDEQ'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
     C           PNODT     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C********** SACTN     ANDEQ'X'                                                    123857 CLE034
     C           SACTN     IFEQ 'X'                                                           CLE034
     C           *IN45     ANDEQ*ON                                       123857
     C                     MOVE 'UP'      WFMT                            123857
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                          123857
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRUPRE   - Set up details for updated of Related RE/PD record *
      * Called by: SRLOAM                                             *
      * Calls    : SRSTAT                                             *
      *****************************************************************
     C           SRUPRE    BEGSR
      *
     C                     Z-ADDRUND      LCD
     C***********SACTN     IFNE 'X'                                 123789131415
     C***********          MOVE SACTN     CHTP                            131415
     C***********          ENDIF                                    123789131415
     C                     MOVE 'A'       CHTP                            131415
     C                     Z-ADDNATN      TNLU
      *
     C                     SELEC
     C           SACTN     WHEQ 'A'
     C                     MOVE SUSER     AUSR
     C                     ADD  1         XASQ
     C           SACTN     WHEQ 'X'
     C                     MOVE SUSER     XUSR
     C                     ADD  1         XASQ
     C           SACTN     WHEQ 'R'
     C                     SUB  1         XASQ
     C           PAST      IFEQ 'Y'
     C           AMTP      ANDNE'PD'                                      156135
     C***********          MOVE 'D'       CHTP                            123789
     C                     MOVE 'R'       RECI
     C                     ENDIF
     C                     ENDSL
      *                                                                   120002
     C           PMODE     IFEQ 'B'                                       120002
     C                     MOVE PIIUSR    IUSR                            120002
     C                     MOVE PIAUSR    AUSR                            120002
     C                     MOVE PIXUSR    XUSR                            120002
     C                     ENDIF                                          120002
      *
     C********** AMTP      IFEQ 'RE'                                                          209709
     C**********           EXSR SRSTAT                                                        209709
     C**********           ENDIF                                                              209709
      *                                                                   122461
      * Setting of 'manual/system generated' flag.                        122461
     C                     SELEC                                          122461
     C           SACTN     WHEQ 'X'                                       122461
     C           PMODE     WHEQ 'B'                                       122461
     C           P#TSEQ    ANDNE1                                         122461
     C                     MOVE 'S'       MNSG                            122461
     C                     OTHER                                          122461
     C                     MOVE 'M'       MNSG                            122461
     C                     ENDSL                                          122461
      *
     C                     ENDSR
      *
      *****************************************************************
      * SRINRE   - Set up details for output of RE record             *
      * Called by: SRLOAM                                             *
      * Calls    : SRSTAT                                             *
      *****************************************************************
     C           SRINRE    BEGSR
      *
     C                     MOVE 'D'       RECI
     C                     MOVE SLOAN     LNRF
     C                     Z-ADDWDAYNE    VDAT
     C                     Z-ADDSLASN     LASN
     C                     MOVE '2'       MRIN
     C                     Z-ADDPTYPL     PTYP
     C                     MOVE LTYPL     LTYP                                                CLE036
     C                     MOVE SUTPL     SUTP                                                CLE036
     C                     MOVE 'RE'      AMTP
     C                     Z-ADD0         INTA
     C                     Z-ADD0         PRSQ
     C                     Z-ADD0         BRTT
     C                     Z-ADD0         FEAM
     C                     MOVE CCYL      CCY
     C                     MOVE WBRCDA    BRCA
     C                     MOVE CNUML     CNUM
     C                     MOVE REPTL     REPT
     C                     MOVE 'N'       AUTO
     C                     MOVE *ZERO     SETP
     C**********           MOVE *BLANKS   OSAC                                                259991
     C                     MOVE *BLANKS   OSACK                                               259991
     C                     MOVE *BLANKS   TSEN
     C                     MOVE *BLANKS   FACO
     C                     MOVE *ZERO     CALC
     C                     Z-ADD0         BRTE
     C                     MOVE WTINL     WTIN
     C                     MOVE 'A'       LLAG
     C                     MOVE *ZERO     XAVD
     C**********           MOVE *ZERO     RLON                                                CSD027
     C                     MOVE *BLANKS   RLON                                                CSD027
     C                     MOVE *ZERO     FECD
     C                     MOVE BIT       PONI
     C                     MOVE OMDB      OSBR
     C                     Z-ADDRUND      ORED
     C                     Z-ADDRUND      LCD
     C                     MOVE 'I'       CHTP
     C                     Z-ADDNATN      TNLU
     C                     MOVE 'M'       MNSG
     C           PMODE     IFEQ 'B'                                       154092
     C                     MOVE PIGASS    GASS                            154092
     C                     ELSE                                           154092
     C                     MOVE 'N'       GASS
     C                     ENDIF                                          154092
     C                     MOVE 'N'       GPRT
     C                     MOVE 'N'       NRLI
     C**********           Z-ADD0         ROLN                                                CLE148
     C                     MOVEL*BLANKS   ROLN                                                CLE148
     C                     Z-ADD0         ROSN
     C**********           Z-ADD0         RORC                                                CSD027
     C                     MOVE *BLANKS   RORC                                                CSD027
     C                     MOVE *BLANK    ROBR
     C                     MOVE *BLANK    PDGN
     C                     MOVE *BLANK    GRIN
     C                     MOVE *BLANK    RLCY
     C                     Z-ADD0         PNAM
     C           PMODE     IFEQ 'B'                                       120002
     C                     MOVE PIIUSR    IUSR                            120002
     C                     MOVE PIAUSR    AUSR                            120002
     C                     MOVE PIXUSR    XUSR                            120002
     C                     ELSE                                           120002
     C                     MOVELSUSER     IUSR
     C                     MOVE *BLANKS   AUSR
     C                     MOVE *BLANKS   XUSR
     C                     ENDIF                                          120002
      *
     C                     MOVE SPASD     PAST
      ** If Repayment is in facility currency:                                                CLE036
     C           *IN25     IFEQ *ON                                                           CLE036
     C                     MOVE SRCCY     FRCY                                                CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE *BLANKS   FRCY                                                CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C***********          MOVE SSIN1     SPI1                            121123
     C***********          MOVE SSIN2     SPI2                            121123
     C***********          MOVE SSIN3     SPI3                            121123
      *
      ** Set status depending on ICD
      *
     C**********           EXSR SRSTAT                                                        209709
     C                     MOVE 'A'       ASTS                                                209709
      *
      ** Batch Mode: Set up Original Entry Date, and Last Change Date
      *
     C           PMODE     IFEQ 'B'
     C                     MOVE PITDST    WPITDS
     C                     MOVELWPIDD     WFLD4   4
     C                     MOVE WPIMM     WFLD4
     C                     MOVELWFLD4     WFLD6   6
     C                     MOVE WPIYY     WFLD2   2
     C                     MOVE WFLD2     WFLD6
     C                     MOVELWFLD6     ZDATE
     C                     EXSR ZDATE1
     C           SACTN     IFEQ 'I'
     C                     Z-ADDZDAYNO    ORED
     C                     ENDIF
     C                     Z-ADDZDAYNO    LCD
      *
      ** Set up Last Change Type and PC transaction reference
      *
     C           PITACT    IFNE 'X'                                       123789
     C                     MOVE PITACT    CHTP
     C                     ENDIF                                          123789
      *
     C***********PMODE     IFEQ 'B'                                       122109
     C                     MOVE PIPCOB    PCOBK
     C                     ELSE
     C                     MOVE *BLANKS   PCOBK
     C                     ENDIF
      *
     C********** PMODE     IFNE 'B'                                                           CLE036
     C********** SACTN     ANDEQ'I'                                                           CLE036
     C           SACTN     IFEQ 'I'                                                           CLE036
     C                     MOVE BRCA      PBRCA
     C***********          CALL 'AOBRCHR0'                                121783
     C                     CALL 'AOBRCHR1'                                121783
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PBRCA   3
     C           SDBRCH    PARM SDBRCH    DSSDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRCHPD'DBFILE           ************
     C                     Z-ADD32        DBASE            * DBERR 32 *
     C                     MOVELBRCA      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVELA8MQSM    W#1ST3  3
     C***                  MOVELW#1ST3    PCRFK     P                     158046
     C********** *NAMVAR   DEFN           LEALLO                                       158046 CLE148
     C********** *LOCK     IN   LEALLO                                                 158046 CLE148
     C********** PCLAST    ADD  1         PCNEXT  80                                   158046 CLE148
     C                     CALL 'LEALLO'                                                      CLE148
     C                     PARM *BLANKS   PRTCD   7                                           CLE148
     C                     PARM 'Y'       PUPDT   1                                           CLE148
     C                     PARM *BLANKS   PCLAST                                              CLE148
     C                     PARM *BLANKS   PCNEXT  8                                           CLE148
     C                     MOVE PCNEXT    W1ST11 11                       158046
     C                     MOVELW#1ST3    W1ST11                          158046
     C                     MOVELW1ST11    PCRFK                           158046
     C                     MOVE '0001'    PCRFK                           158046
     C**********           Z-ADDPCNEXT    PCLAST                                       158046 CLE148
     C**********           OUT  LEALLO                                                 158046 CLE148
     C                     ENDIF
     C**********           ELSE                                                               CLE036
     C********** PMODE     IFEQ 'B'                                                           CLE036
     C**********           MOVELPITREF    PCRFK                                               CLE036
     C**********           ENDIF                                                              CLE036
     C                     ENDIF
      *
      *
      ** System generated
      *
     C           PMODE     IFEQ 'B'                                       123873
     C           P#TSEQ    ANDNE1                                         122461
     C                     MOVE 'S'       MNSG
     C                     ENDIF                                          123873
     C***********          ENDIF                                          122109
      *
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE WSCCY     SCCYK                           CEU004
     C                     MOVE PMIC72    ICCY                            CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PMRSCY    SCCYK                                               CLE031
     C                     MOVE PMPSCY    PSCYK                                               CLE031
     C                     ENDIF                                                              CLE031
      *
      ** Interest Amount using the Net-Treasury Rate                                          CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C                     Z-ADD*ZERO     INTN                                                CAS005
     C                     ENDIF                                                              CAS005
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSTAT   - Set up status of amendment                         *
      * Called by: SRUPRE, SRINRE, SRUPMR, SRINMR                     *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSTAT    BEGSR
      *
     C           CLE002    IFEQ 'Y'
      *
     C           BPMRAU    IFEQ 'Y'
     C           AMTP      ANDEQ'MR'
     C           BPREAU    OREQ 'Y'
     C           AMTP      ANDEQ'RE'
      *
     C                     SELEC
     C           SACTN     WHEQ 'I'
     C                     MOVE 'C'       ASTS
     C           SACTN     WHEQ 'A'
     C           ASTS      IFEQ 'A'
     C           ASTS      OREQ 'R'                                                           194509
     C                     MOVE 'R'       ASTS
     C                     ELSE
     C                     MOVE 'C'       ASTS
     C                     ENDIF
     C           SACTN     WHEQ 'X'
     C                     MOVE 'A'       ASTS
     C           SACTN     WHEQ 'R'                                                           CLE034
     C                     MOVE 'D'       ASTS                                                CLE034
     C                     ENDSL
      *
     C                     ENDIF
     C                     ENDIF
      *
     C           CLE002    IFEQ 'N'
     C           BPMRAU    OREQ 'N'
     C***********BPMRAU    ANDEQ'MR'                                      124657
     C           AMTP      ANDEQ'MR'                                      124657
     C           BPREAU    OREQ 'N'
     C           AMTP      ANDEQ'RE'
     C                     MOVE 'A'       ASTS
     C                     ENDIF
      *                                                                   120002
     C           PMODE     IFEQ 'B'                                       120002
     C                     MOVE 'A'       ASTS                            120002
     C                     ENDIF                                          120002
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRUPMR   - Set up details for update of MR record             *
      * Called by: SRLOAM                                             *
      * Calls    : SRSTAT, SRSTEX                                     *
      *****************************************************************
     C           SRUPMR    BEGSR
      *
     C           SACTN     IFNE 'R'                                       148720
     C                     MOVE WTYP      SETP
     C**********           MOVE WOURS     OSAC                                                259991
     C                     MOVE WOURS     OSACK                                               259991
     C                     MOVE WTHRS     TSEN
     C                     ENDIF                                          148720
     C                     Z-ADDRUND      LCD
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE SSTAL     STALK                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           SACTN     IFNE 'X'                                       123789
     C                     MOVE SACTN     CHTP
     C                     ENDIF                                          123789
     C                     Z-ADDNATN      TNLU
     C***********          MOVE SSIN1     SPI1                            121123
     C***********          MOVE SSIN2     SPI2                            121123
     C***********          MOVE SSIN3     SPI3                            121123
     C           PMODE     IFEQ 'B'                                       120002
     C                     MOVE PIAUSR    AUSR                            120002
     C                     MOVE PIXUSR    XUSR                            120002
     C                     ELSE                                           120002
     C           SACTN     IFEQ 'A'                                       123857
     C                     MOVELSUSER     AUSR
     C                     ELSE                                           123857
     C                     MOVELSUSER     XUSR                            123857
     C                     ENDIF                                          123857
     C                     ENDIF                                          120002
      *
     C           SACTN     IFEQ 'R'
     C                     MOVE 'R'       RECI
     C                     ENDIF
      *
      ** Extended settlements
      *
     C           SACTN     IFNE 'R'                                       148730
     C                     EXSR SRSTEX
     C                     ENDIF                                          148730
      *
      ** Set status depending on ICD
      *
     C                     EXSR SRSTAT
      *
      *                                                                   122461
      * Setting of 'manual/system generated' flag.                        122461
     C                     SELEC                                          122461
     C           SACTN     WHEQ 'X'                                       122461
     C           PMODE     WHEQ 'B'                                       122461
     C           P#TSEQ    ANDNE1                                         122461
     C                     MOVE 'S'       MNSG                            122461
     C                     OTHER                                          122461
     C                     MOVE 'M'       MNSG                            122461
     C                     ENDSL                                          122461
      *
     C                     ENDSR
      *
      *****************************************************************
      * SRINMR   - Set up details for output of MR/PD record          *
      * Called by: SRLOAM                                             *
      * Calls    : SRSTAT, SRSTEX                                     *
      *****************************************************************
     C           SRINMR    BEGSR
      *
     C                     MOVE 'D'       RECI
     C                     MOVE SLOAN     LNRF
     C                     Z-ADDWVALD     VDAT
     C                     Z-ADDSLASN     LASN
     C                     Z-ADD2         MRIN
     C                     Z-ADDPTYPL     PTYP
     C                     MOVE LTYPL     LTYP                                                205703
     C                     MOVE SUTPL     SUTP                                                CLE036
     C                     Z-ADD0         PRSQ
     C                     Z-ADD0         BRTT
     C                     Z-ADD0         RTSP
     C                     MOVE CCYL      CCY
     C                     Z-ADDWTXAR     WTXA
     C                     Z-ADD0         FEAM
     C                     MOVE WBRCDA    BRCA
     C                     MOVE CNUML     CNUM
     C                     Z-ADD0         REPT
     C                     MOVE 'N'       AUTO
     C                     MOVE *BLANK    STAI
     C                     MOVE WTYP      SETP
     C**********           MOVE WOURS     OSAC                                                259991
     C                     MOVE WOURS     OSACK                                               259991
     C                     MOVE WTHRS     TSEN
     C                     MOVE *BLANKS   FACO
     C                     MOVE *BLANKS   SPIN
     C                     MOVE BIT       LAIN
     C                     Z-ADD0         BRTE
     C                     MOVE 'N'       AUTO
     C                     Z-ADD0         CALC
     C                     MOVE 'A'       LLAG
     C                     MOVE SWOFF     LWOI
     C                     Z-ADDWDAYNE    XAVD
     C                     Z-ADDXLASN     XASQ
     C**********           Z-ADD0         RLON                                                CSD027
     C                     MOVE *BLANKS   RLON                                                CSD027
     C                     Z-ADD0         FECD
     C                     MOVE BIT       PONI
     C                     MOVE *BLANK    ACTI
     C                     MOVE *BLANK    CNFY
     C                     MOVE *BLANK    TLXY
     C                     MOVE *BLANK    CBLY
     C                     MOVE *BLANK    INTC
     C                     MOVE *BLANK    NACD
     C                     MOVE *BLANK    ACBI
     C                     MOVE *BLANK    ZZ001
     C                     Z-ADD0         LSWCC
     C                     Z-ADD0         LSWSC
     C                     MOVE WOOSBR    OSBR
     C                     Z-ADD0         LSMD
     C                     Z-ADD0         REBT
     C                     MOVE *BLANKS   ZZ034
     C                     Z-ADDRUND      ORED
     C                     Z-ADDRUND      LCD
     C                     MOVE 'I'       CHTP
     C                     Z-ADDNATN      TNLU
     C                     MOVE 'M'       MNSG
     C           PMODE     IFEQ 'B'                                       154092
     C                     MOVE PIGASS    GASS                            154092
     C                     ELSE                                           154092
     C                     MOVE 'N'       GASS
     C                     ENDIF                                          154092
     C                     MOVE 'N'       GPRT
     C                     MOVE 'N'       NRLI
     C**********           Z-ADD0         ROLN                                                CLE148
     C                     MOVEL*BLANKS   ROLN                                                CLE148
     C                     Z-ADD0         ROSN
     C**********           Z-ADD0         RORC                                                CSD027
     C                     MOVE *BLANKS   RORC                                                CSD027
     C                     MOVE *BLANK    PDGN
     C           CLE007    IFEQ 'Y'                                       CLE007
     C           SPASD     ANDEQ'Y'
     C                     MOVE 'Y'       PDGN
     C                     ENDIF
     C                     MOVE *BLANK    GRIN
     C                     MOVE *BLANK    RLCY
      *
      ** If Repayment is in facility currency:                                                CLE036
     C           *IN25     IFEQ *ON                                                           CLE036
     C                     MOVE SRCCY     FRCY                                                CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE *BLANKS   FRCY                                                CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     MOVE SPASD     PAST
     C           PMODE     IFEQ 'B'                                       120002
     C                     MOVE PIIUSR    IUSR                            120002
     C                     MOVE PIAUSR    AUSR                            120002
     C                     MOVE PIXUSR    XUSR                            120002
     C                     ELSE                                           120002
     C                     MOVE SUSER     IUSR
     C                     MOVE *BLANKS   AUSR
     C                     MOVE *BLANKS   XUSR
     C                     ENDIF                                          120002
     C***********          MOVE SSIN1     SPI1                            121123
     C***********          MOVE SSIN2     SPI2                            121123
     C***********          MOVE SSIN3     SPI3                            121123
      *
      ** Set status depending on ICD
      *
     C                     MOVEL'MR'      AMTP
     C                     EXSR SRSTAT
      *
      ** Setup extended settlements
      *
     C                     EXSR SRCLSD                                    165031
     C                     EXSR SRSTEX
      *
      ** Batch Mode: Set up Original Entry Date, and Last Change Date
      *
     C           PMODE     IFEQ 'B'
     C                     MOVE PITDST    WPITDS
     C                     MOVELWPIDD     WFLD4   4
     C                     MOVE WPIMM     WFLD4
     C                     MOVELWFLD4     WFLD6   6
     C                     MOVE WPIYY     WFLD2   2
     C                     MOVE WFLD2     WFLD6
     C                     MOVELWFLD6     ZDATE
     C                     EXSR ZDATE1
     C           SACTN     IFEQ 'I'
     C                     Z-ADDZDAYNO    ORED
     C                     ENDIF
     C                     Z-ADDZDAYNO    LCD
      *
      ** Set up Last Change Type and PC transaction reference
      *
     C           PITACT    IFNE 'X'                                       123789
     C                     MOVE PITACT    CHTP
     C                     ENDIF                                          123789
      *
     C***********PMODE     IFEQ 'B'                                       122109
     C                     MOVE PIPCOB    PCOBK
     C                     ELSE
     C                     MOVE *BLANKS   PCOBK
     C                     ENDIF
      *
     C           PMODE     IFNE 'B'
     C           SACTN     ANDEQ'I'
     C                     MOVE BRCA      PBRCA
     C***********          CALL 'AOBRCHR0'                                121783
     C                     CALL 'AOBRCHR1'                                121783
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PBRCA   3
     C           SDBRCH    PARM SDBRCH    DSSDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRCHPD'DBFILE           ************
     C                     Z-ADD32        DBASE            * DBERR 32 *
     C                     MOVELBRCA      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVELA8MQSM    W#1ST3  3
     C***                  MOVELW#1ST3    PCRFK     P                     158046
     C********** *LOCK     IN   LEALLO                                                 158046 CLE148
     C********** PCLAST    ADD  1         PCNEXT  80                                   158046 CLE148
     C                     CALL 'LEALLO'                                                      CLE148
     C                     PARM *BLANKS   PRTCD   7                                           CLE148
     C                     PARM 'Y'       PUPDT   1                                           CLE148
     C                     PARM *BLANKS   PCLAST                                              CLE148
     C                     PARM *BLANKS   PCNEXT  8                                           CLE148
     C                     MOVE PCNEXT    W1ST11 11                       158046
     C                     MOVELW#1ST3    W1ST11                          158046
     C                     MOVELW1ST11    PCRFK                           158046
     C                     MOVE '0001'    PCRFK                           158046
     C**********           Z-ADDPCNEXT    PCLAST                                       158046 CLE148
     C**********           OUT  LEALLO                                                 158046 CLE148
     C                     ENDIF
     C                     ELSE
     C           PMODE     IFEQ 'B'
     C                     MOVELPITREF    PCRFK
     C                     ENDIF
     C                     ENDIF
      *
      ** System generated
      *
     C           PMODE     IFEQ 'B'                                       123873
     C           P#TSEQ    ANDNE1                                         122461
     C                     MOVE 'S'       MNSG
     C                     ENDIF                                          123873
     C***********          ENDIF                                          122109
      *
     C           WMTPD     IFEQ 'Y'
     C                     MOVE 'Y'       MTPD    1
     C                     ELSE
     C                     MOVE 'N'       MTPD
     C                     ENDIF
      *                                                                                       CLE028
      ** For flat rate personal loans, save the interest refunded and                         CLE028
      ** charges refunded if the whole expected principal is being paid                       CLE028
      *                                                                                       CLE028
     C                     Z-ADD*ZERO     CHDU                                                CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYPL     ANDEQ80                                                            CLE028
     C           ADIF      IFEQ 'Y'                                                           CLE028
     C           PRAMR     ANDEQWEXPRN                                                        CLE028
     C           WEXPRN    ANDNE*ZERO                                                         CLE028
     C                     Z-SUBWINRF     REBT                                                CLE028
     C                     ENDIF                                                              CLE028
     C           ADCF      IFEQ 'Y'                                                           CLE028
     C           PRAMR     ANDEQWEXPRN                                                        CLE028
     C           WEXPRN    ANDNE*ZERO                                                         CLE028
     C                     Z-SUBWCGRF     CHDU                                                CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSTEX   - Set up extended settlements details                *
      * Called by: SRUPMR, SRINMR                                     *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSTEX    BEGSR
      *
      ** Extended settlement
      **  Check if before and after image of the record of LOAMSDK                            CSD015
      **  is different.                                                                       CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C           SACTN     ANDEQ'A'                                                           CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       WDIFF   1                                           CSD015
     C                     MOVE 'N'       WDTPC   1                                           CSD015
      *                                                                                       CSD015
     C                     MOVEA*BLANKS   WLF,1                                               CSD015
      *                                                                                       CSD015
     C           RONS      IFNE WIOSAC                                                        CSD015
     C                     MOVELWIOSAC    WLF,1                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RIBN      IFNE PARIBN                                                        CSD015
     C                     MOVELPARIBN    WLF,2                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           ROBN      IFNE WOROBN                                                        CSD015
     C                     MOVELWOROBN    WLF,3                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           ROCN      IFNE WOROCN                                                        CSD015
     C                     MOVELWOROCN    WLF,4                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PONS      IFNE PMPONS                                                        CSD015
     C                     MOVELPMPONS    WLF,5                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PIBN      IFNE PAPIBN                                                        CSD015
     C                     MOVELPAPIBN    WLF,6                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           POBN      IFNE WOPOBN                                                        CSD015
     C                     MOVELWOPOBN    WLF,7                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           POCN      IFNE WOPOCN                                                        CSD015
     C                     MOVELWOPOCN    WLF,8                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RCRN      IFNE PARCRN                                                        CSD015
     C                     MOVELPARCRN    WLF,9                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RVNO      IFNE PARVNO                                                        CSD015
     C                     MOVELPARVNO    WLF,10                                              CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           AWBN      IFNE PAAWBN                                                        CSD015
     C                     MOVELPAAWBN    WLF,11                                              CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           BENN      IFNE PABENN                                                        CSD015
     C                     MOVELPABENN    WLF,12                                              CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           DTP1      IFNE PMDTP1                                                        CSD015
     C           DTP2      ORNE PMDTP2                                                        CSD015
     C           DTP3      ORNE PMDTP3                                                        CSD015
     C           DTP4      ORNE PMDTP4                                                        CSD015
     C                     MOVE 'Y'       WDTPC   1                                           CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *
     C           PTYPL     IFNE 66                                        155568
     C           PTYPL     ANDNE67                                        155568
     C           PTYPL     ANDNE69                                        155568
     C           PTYPL     ANDNE72                                        155568
     C                     MOVE WTYPE     RSTM
     C                     MOVE WIOSAC    RONS
     C                     ENDIF                                          155568
      *                                                                   155568
     C                     MOVE WOOSBR    OSBR                            123669
     C                     MOVE PARIBN    RIBN
     C                     MOVE PMRIBA    RIBA
     C**********           Z-ADDWOROBN    ROBN                                                CSD027
     C**********           Z-ADDWOROCN    ROCN                                                CSD027
     C                     MOVE WOROBN    ROBN                                                CSD027
     C                     MOVE WOROCN    ROCN                                                CSD027
     C                     Z-ADDPMPSTM    PSTM
     C                     MOVE PMPONS    PONS
     C                     MOVE PAPIBN    PIBN
     C                     MOVE PMPIBA    PIBA
     C**********           Z-ADDWOPOBN    POBN                                                CSD027
     C**********           Z-ADDWOPOCN    POCN                                                CSD027
     C                     MOVE WOPOBN    POBN                                                CSD027
     C                     MOVE WOPOCN    POCN                                                CSD027
     C                     MOVE PARCRN    RCRN
     C                     MOVE PMRCRA    RCRA
     C                     MOVE PARVNO    RVNO
     C                     MOVE PAAWBN    AWBN
     C                     MOVE PMAWBA    AWBA
     C                     MOVE PABENN    BENN
     C                     MOVE PMBENA    BENA
     C                     MOVE PMDTP1    DTP1
     C                     MOVE PMDTP2    DTP2
     C                     MOVE PMDTP3    DTP3
     C                     MOVE PMDTP4    DTP4
     C                     MOVE PMDCHG    DCHG
     C                     MOVE PMBTB1    BTB1
     C                     MOVE PMBTB2    BTB2
     C                     MOVE PMBTB3    BTB3
     C                     MOVE PMBTB4    BTB4
     C                     MOVE PMBTB5    BTB5
     C                     MOVE PMBTB6    BTB6
     C                     MOVE PMCVMR    CVMR
      *
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE SCCYK     WSVSC   3                       CEU004
     C                     MOVE WSCCY     SCCYK                           CEU004
     C                     MOVE PMIC72    ICCY                            CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PMRSCY    SCCYK                                               CLE031
     C                     MOVE PMPSCY    PSCYK                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRWRIT   - Write a new record in file                         *
      * Called by: Main Processing, SRSUBP, SRBTCH                    *
      * Calls    : SRCHGS, SRSHAD, SRFCLT, SRLOAN, SRTRAL, SRLOAM     *
      *            SRTSHR,                                            *
      *            SRFEES - Update Fees File                          *   CLE009
      *****************************************************************
     C           SRWRIT    BEGSR
      *                                                                                     AR722359
     C                     Z-ADD*ZEROS    OFRAM                                             AR722359
     C                     Z-ADD*ZEROS    OFINT                                             AR722359
     C                     Z-ADD*ZEROS    OFPEN                                             AR722359
     C                     Z-ADD*ZEROS    OFTOT                                             AR722359
     C                     Z-ADD*ZEROS    OFTXA                                             AR722359
      *
     C           FREPAY    IFEQ 'Y'                                                           CLE036
     C           *IN25     ANDEQ*ON                                                           CLE036
     C                     EXSR FRCONV                                                        CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     MOVE OAMT      SAMT
     C                     MOVE OFAMT     FSAMT                                               CLE036
      *
      ** Check changes to files
      *
     C                     EXSR SRCHGS
      *
     C           WEXIT     IFEQ 'N'
      *
      ** Facility update
      *
     C           AMTP      IFEQ 'PD'
     C           *IN47     OREQ '1'
     C                     EXSR SRFCLT
     C           WERR      CABEQ'Y'       SRWEND
     C                     ENDIF
      *
      ** Loans file update
      *
     C           *IN44     IFEQ '1'
     C           AMTP      OREQ 'PD'                                      155099
     C                     EXSR SRLOAN
     C           WERR      CABEQ'Y'       SRWEND
     C                     ENDIF
      *
      ** Loan Amendment main update
      *
     C                     EXSR SRLOAM
     C           WERR      CABEQ'Y'       SRWEND
      *                                                                   CLE009
      ** If CLE009 is installed, update fees file                         CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     EXSR SRFEES                                    CLE009
     C                     ENDIF                                          CLE009
      *
      ** Update Trailer
      *
     C                     EXSR SRTRAL
      *
      ** Shadow posting
      *
      ** Update on shadow posting shd only be done if not a Risk loan     175450
      ** If it is a Risk loan then it should have an interest payment.    175450
      *                                                                   175450
     C           PTYP      IFEQ 61                                        175450
     C           PTYP      OREQ 62                                        175450
     C           PTYP      OREQ 63                                        175450
     C           PTYP      OREQ 64                                        175450
     C           PTYP      OREQ 65                                        175450
     C           PTYP      OREQ 66                                        175450
     C           PTYP      OREQ 67                                        175450
     C           PTYP      OREQ 68                                        175450
     C           PTYP      OREQ 69                                        175450
     C           PTYP      OREQ 70                                        175450
     C           INTA      ANDNE0                                         175450
     C           PTYP      OREQ 71                                        175450
     C           INTA      ANDNE0                                         175450
     C           PTYP      OREQ 72                                        175450
     C           INTA      ANDNE0                                         175450
      *                                                                   175450
     C                     MOVE WSETT     SHSETT
     C                     MOVELWOOSBR    WOSBRK                                              219608
     C           CLE031    IFEQ 'Y'                                                           219608
     C                     MOVELPMRSCY    WSCCYK                                              219608
     C                     MOVELPMPSCY    WPSCY                                               219608
     C                     MOVE PMREXR    WREXR                                               219608
     C                     MOVELPMREXI    WREXI                                               219608
     C                     MOVE PMPEXR    WPEXR                                               219608
     C                     MOVELPMPEXI    WPEXI                                               219608
     C                     ENDIF                                                              219608
     C           CLE034    IFEQ 'Y'                                                           219608
     C                     MOVELSSTAL     WSTAL                                               219608
     C                     ENDIF                                                              219608
     C                     EXSR SRSHAD
     C                     CLEARZ#BSTS
     C                     MOVE Z#ADTA    Z#ADT1
     C***********          MOVE Z#ADTB    Z#ADTB                          CEU004
     C                     MOVE Z#ADTB    Z#ADT2                          CEU004
     C***********          MOVE Z#ADTB    Z#ADTB                          148591
     C                     MOVE Z#ADTB    Z#ADT2                          148591
     C                     MOVE Z#ADTD    Z#ADT4                          148591
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           CLE031    OREQ 'Y'                                                           CLE031
     C                     MOVE Z#ADTE    Z#ADT5                          CEU004
     C                     ENDIF                                          CEU004
     C                     EXSR SRUSHD
      *                                                                                       205258
      ** For loan reactivation (through -MR), shadow post again for a DR entry                205258
      ** to balance the -MR CR entry                                                          205258
      ** Conditions: past due, matured loan, reactivation flag = 'Y' and -amt.                205258
      *                                                                                       205258
     C           CLE007    IFEQ 'Y'                                                           205258
     C           PAST      ANDEQ'Y'                                                           205258
     C           RECIL     ANDEQ'M'                                                           205258
     C           RATF      ANDEQ'Y'                                                           205258
     C           SHTAMT    ANDLT0                                                             205258
     C                     CLEARZ#ASTS                                                        205258
     C                     MOVE LTYPL     SHAMTP                                              205258
     C                     Z-ADD0         TMPFLD 150                                          205258
     C                     Z-ADDSHPRAM    TMPFLD                                              205258
     C                     Z-ADDTAMT      SHPRAM                                              205258
     C                     MOVE Z#ADTA    Z#BDT1                                              205258
     C                     MOVE Z#ADTB    Z#BDT2                                              205258
     C                     MOVE Z#ADTD    Z#BDT4                                              205258
     C           CEU004    IFEQ 'Y'                                                           205258
     C           CLE031    OREQ 'Y'                                                           CLE031
     C                     MOVE Z#ADTE    Z#BDT5                                              205258
     C                     ENDIF                                                              205258
     C                     EXSR SRUSHD                                                        205258
     C                     Z-ADDTMPFLD    SHPRAM                                              205258
     C                     ENDIF                                                              205258
      *                                                                                       205258
     C                     ENDIF                                          175450
      *
     C                     ENDIF
      *                                                                   CDE001
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           CDE001    IFEQ 'Y'                                       CDE001
     C           WERR      ANDEQ'N'                                       CDE001
     C                     MOVELSLOAN     T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C                     PARM           T#TREF 20                       CDE001
     C                     PARM 'LOAN'    T#TCAT  4                       CDE001
     C                     PARM *BLANKS   RSRVID 10                       CDE005
     C                     ENDIF                                          CDE001
      *                                                                   CAP063
      ** Delete invalid record after insert                               CAP063
      *                                                                   CAP063
     C           PMODE     IFEQ 'F'                                       CAP063
     C           XREPN     CHAINLEIMRPDL             48                   CAP063
     C                     DELETLEIMRPDL                                  CAP063
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     EXSR LOGDEL                                    CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     ENDIF                                          CAP063
      *
     C           WERR      IFEQ 'N'
     C***********PMODE     ANDNE'P'                                       120002
     C           PMODE     ANDNE'B'                                       120002
     C                     COMIT
     C                     MOVE 'F0'      WFMT
     C                     MOVE *ON       *IN58
      *
      ** Write to test harness if changes committed
      *
     C           PMODE     IFEQ 'R'
     C                     EXSR SRTSHR
     C                     ENDIF
     C                     ENDIF
      *                                                                   CSC011
      * If Support System active, write transaction to 24x7 log           CSC011
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C*                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
      *                                                                   CSC011
      * Convert facility to PINPP format                                  CSC011
     C                     EXSR LOG247                                    CSC011
      *                                                                   CSC011
      * Write valid facility in PINPP format to 24x7 Log File             CSC011
     C                     MOVE 'V'       LOGVAL  1                       CSC011
     C                     EXSR APLGTR                                    CSC011
     C                     COMIT                                          CSC011
      *                                                                   CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C/COPY WNCPYSRC,LE2110C004
      *
     C           SRWEND    ENDSR
      *
      /EJECT
      *****************************************************************
      * SRUSHD  -  Shadow posting update                              *
      * Called by: SRWRIT, SRUPDT                                     *
      * Calls    : AOOULAU0                                           *
      *                                                               *
      *****************************************************************
      *
     C           SRUSHD    BEGSR
      *
      ** Do On-line updates
      *                                                                   122960
     C           SACTN     IFEQ 'I'                                                           201672
     C           SACTN     OREQ 'A'                                                           201672
     C           *IN10     ANDEQ'1'                                                           205964
     C           SACTN     OREQ 'R'                                                           201672
     C           PMODE     IFEQ 'B'                                       122960
     C                     MOVE '*LEBTCH' ##RTCD                          122960
     C                     ELSE                                           122960
     C                     MOVE *BLANKS   ##RTCD                          122960
     C                     ENDIF                                          122960
      *                                                                   CLE033
     C           CLE033    IFEQ 'Y'                                       CLE033
     C           SLASN1    ANDNESHLASN                                    CLE033
     C           SHLASN    ANDEQ999                                       CLE033
     C                     Z-ADDSHLASN    W0LASN  30                      CLE033
     C                     Z-ADDSLASN1    SHLASN                          CLE033
     C                     SELEC                                          CLE033
     C           SACTN     WHEQ 'I'                                       CLE033
     C                     MOVE Z#ADTA    Z#ADT1                          CLE033
     C           SACTN     WHEQ 'R'                                       CLE033
     C                     MOVE Z#ADTA    Z#BDT1                          CLE033
     C                     ENDSL                                          CLE033
     C                     ELSE                                           CLE033
     C                     Z-ADD-1        W0LASN                          CLE033
     C                     ENDIF                                          CLE033
      *
     C                     CALL 'AOOULAU0'
     C                     PARM           ##RTCD  7
     C                     PARM           Z#BSTS
     C                     PARM           Z#ASTS
     C                     PARM           Z#WSTS
     C                     PARM *BLANKS   PDCLI   1                                         MD023787
      *
     C           CLE033    IFEQ 'Y'                                       CLE033
     C           W0LASN    ANDNE-1                                        CLE033
     C                     Z-ADDW0LASN    SHLASN                          CLE033
     C                     SELEC                                          CLE033
     C           SACTN     WHEQ 'I'                                       CLE033
     C                     MOVE Z#ADTA    Z#ADT1                          CLE033
     C           SACTN     WHEQ 'R'                                       CLE033
     C                     MOVE Z#ADTA    Z#BDT1                          CLE033
     C                     ENDSL                                          CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE033
     C           ##RTCD    IFEQ '*ERROR*'
     C           ##RTCD    OREQ '*RECLCK'                                                   AR868380
     C                     MOVE *ON       *INU8
     C                     MOVE *ON       *INU7
     C                     EXSR *PSSR
     C                     ENDIF
      *                                                                                       201672
     C           PRAM      IFNE 0                                                             201672
     C           TAMT      ORNE 0                                                             205504
     C                     MOVELLNRF      OLNRF                                               201672
     C                     MOVELVDAT      OVDAT                                               201672
     C                     MOVELSLASN1    OLASN                                               201672
     C                     MOVELPRAM      OMPRAM                                              201672
     C                     CALL 'LE2041  '                                                    201672
     C**********           PARM           OLNRF   60                                   201672 CLE148
     C                     PARM           OLNRF   6                                           CLE148
     C                     PARM           OVDAT   50                                          201672
     C                     PARM           OLASN   30                                          201672
     C                     PARM           OMPRAM 130                                          201672
     C                     PARM           AMTP                                                201672
     C                     PARM           SACTN                                               201672
     C                     PARM *BLANKS   ##RTCD                                            AR868380
      *                                                                                     AR868380
     C           ##RTCD    IFEQ '*RECLCK'                                                   AR868380
     C                     EXSR *PSSR                                                       AR868380
     C                     ENDIF                                                            AR868380
     C                     ENDIF                                                              201672
     C                     ENDIF                                                              201672
     C/COPY WNCPYSRC,LE2110C032
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSHAD   - Set up details for shadow post                     *
      * Called by: SRWRIT, SRUPDT                                     *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSHAD    BEGSR
      *
     C                     MOVE RECI      SHRECI
     C                     MOVE LNRF      SHLNRF
     C**********           Z-ADDVDAT      SHVDAT                                              205258
     C                     Z-ADDWDAYNV    SHVDAT                                              205258
     C                     Z-ADDLASN      SHLASN
     C                     MOVE PTYPL     SHPTYP
     C                     MOVE AMTP      SHAMTP
     C                     MOVE CCY       SHCCY
     C                     Z-ADDPRAM      SHPRAM
     C                     Z-ADDTAMT      SHTAMT                          148591
     C                     MOVE BRCA      SHBRCA
     C                     Z-ADD0         SHREPT
     C                     MOVE SHSETT    SHTIST
      *
     C***********          MOVE OSBR      SHOSBR                                              219608
     C                     MOVELWOSBRK    SHOSBR                                              219608
      *                                                                   158802
     C           SACTN     IFNE 'R'                                       158802
     C                     MOVE CHTP      SHCHTP
     C                     ELSE                                           158802
     C                     MOVE 'R'       SHCHTP                          158802
     C                     ENDIF                                          158802
      *                                                                   CLE033
     C           SACTN     IFEQ 'A'                                       CLE033
     C           BEFSTS    ANDEQ'Y'                                       CLE033
     C                     MOVE 'N'       BEFSTS                          CLE033
     C                     MOVE WLSTCA    SHTNLU                          CLE033
     C                     ELSE                                           CLE033
     C                     Z-ADDNATN      SHTNLU                          CLE033
     C                     ENDIF                                          CLE033
      *                                                                   148591
     C                     MOVE PNAM      SHPNAM                          148591
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE SCCYK     SHSCCY                          CEU004
     C                     MOVE ICCY      SHICCY                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C***********          MOVE SCCYK     SHSCCY                                       CLE031 219608
     C                     MOVE ICCY      SHICCY                                              CLE031
     C***********          Z-ADDREXRK     SHREXR                                       CLE031 219608
     C***********          MOVE REXIK     SHREXI                                       CLE031 219608
     C***********          MOVE PSCYK     SHPSCY                                       CLE031 219608
     C***********          Z-ADDPEXRK     SHPEXR                                       CLE031 219608
     C***********          MOVE PEXIK     SHPEXI                                       CLE031 219608
     C                     MOVELWSCCYK    SHSCCY                                              219608
     C                     Z-ADDWREXR     SHREXR                                              219608
     C                     MOVELWREXI     SHREXI                                              219608
     C                     MOVELWPSCY     SHPSCY                                              219608
     C                     Z-ADDWPEXR     SHPEXR                                              219608
     C                     MOVELWPEXI     SHPEXI                                              219608
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C***********          MOVE SSTAL     SHSTAL                                       CLE034 219608
     C                     MOVELWSTAL     SHSTAL                                              219608
     C                     ENDIF                                                              CLE034
      *
     C                     ENDSR
      *
      *****************************************************************
      * SRLOAM   - Update loan amendment file                         *
      * Called by: SRWRIT, SRUPDT                                     *
      * Calls    : SRNSEQ, SRINRE, SRUPRE, SRINMR, SRUPMR             *
      *****************************************************************
     C           SRLOAM    BEGSR
      *
     C                     Z-ADD0         SLASN
     C                     Z-ADD0         XLASN   30
      *                                                                                       CSD015
     C                     MOVE *OFF      *IN06                                               CSD015
     C                     MOVEA*BLANKS   WLF,1                                               CSD015
     C                     MOVEL*BLANKS   KFUNT                                               CSD015
     C                     MOVEL*BLANKS   KIDEN                                               CSD015
     C                     MOVEL*BLANKS   KBRCH                                               CSD015
     C                     MOVEL*BLANK    WKIDEN                                              CSD015
     C                     MOVEL*BLANK    WKLNRF                                              CSD015
     C                     MOVEL*BLANK    WVDAT                                               CSD015
     C                     MOVEL*BLANK    WLASN                                               CSD015
      *                                                                                       CSD015
     C                     MOVE LNRF      WKLNRF  6                                           CSD015
     C                     MOVE VDAT      WVDAT   5                                           CSD015
     C                     MOVE LASN      WLASN   3                                           CSD015
     C           WKLNRF    CAT  WVDAT:0   WKIDEN 40                                           CSD015
     C                     CAT  WLASN:0   WKIDEN                                              CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C                     MOVEL'LOAMSDK' KFUNT                                               CSD015
     C                     MOVELWKIDEN    KIDEN                                               CSD015
     C                     MOVELBRCA      KBRCH                                               CSD015
     C           CWHTKY    CHAINSDCWHTL1             06                                       CSD015
     C                     ENDIF                                                              CSD015
      *
     C           SACTN     IFEQ 'I'
     C                     Z-ADDWDAYNE    WVALD
     C                     MOVE SESEQ     SLASN
     C                     ENDIF
      *
     C           SACTN     IFEQ 'R'
     C***********          Z-ADDXAVD      WVALD                           143132
     C***********          MOVE XASQ      SLASN                           143132
     C           XAVD      IFNE 0                                         156135
     C           XASQ      ANDNE0                                         156135
     C                     Z-ADDXAVD      WVALD                           156135
     C                     MOVE XASQ      SLASN                           156135
     C                     ELSE                                           156135
     C                     Z-ADDDAYNO     WVALD                           143132
     C                     MOVE SSEQN     SLASN                           143132
     C                     ENDIF                                          156135
      ***********                                                         CLE007
     C***********WVALD     IFEQ 0                                         CLE007
     C***********SPASD     ANDEQ'Y'                                       CLE007
     C***********          Z-ADDWDAYNV    WVALD                           CLE007
     C***********          MOVE SSEQN     SLASN                           CLE007
     C***********          SUB  1         SLASN                           CLE007
     C***********          ENDIF                                          CLE007
      *
     C                     ENDIF
      *
     C                     MOVE SLASN     XLASN
      *
      ** Insert, Reverse and Unmatched
      *
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'R'
     C           *IN47     OREQ *ON
     C           SACTN     ANDNE'A'
     C           SACTN     ANDNE'X'
      *
      ** Get next available sequence for Insert of related RE
      *
     C           *IN44     IFEQ '1'
     C                     EXSR SRNSEQ
     C                     MOVE SLASN     XLASN
     C                     ENDIF
      *
      ** Chain to related LOAM record
      *
     C           KLMKEY    CHAINLOAMS                50
      *
     C           SACTN     IFEQ 'R'
     C           RECI      ANDNE'D'
     C           SACTN     OREQ 'I'
     C           *IN50     ANDEQ*OFF
     C********** RECI      ANDEQ'D'                                                           222410
     C           *IN44     ANDEQ*ON
     C           SACTN     OREQ 'I'
     C           RECI      ANDNE'D'
     C           *IN50     ANDEQ*OFF                                      158544
     C           *IN44     ANDEQ*OFF
     C           SACTN     ORNE 'I'                                       143132
     C           *IN50     ANDEQ*ON                                       143132
     C                     SETON                     U7U8
     C                     MOVE 'Y'       WERR
     C                     MOVE *BLANKS   WFMT
     C           *LOCK     IN   LDA
     C                     Z-ADD13        DBASE            ************
     C                     MOVE 'LOAMS'   DBFILE           * DBERR 13 *
     C                     MOVELKLKEY     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Save Before status of Related record
      *
     C                     MOVE AMT       OAMT
     C                     MOVE FRAMT     OFAMT                                               CLE036
     C/COPY WNCPYSRC,LE2110C016
      *
      ** Repayment schedule only
      *
     C           AMTP      IFEQ 'RE'
     C                     Z-ADD0         WTXA                                                222410
     C************IN44     OREQ *ON                                       131414
      *
     C           REPTL     IFNE 3
     C           SACTN     IFEQ 'I'
     C           PRAM      SUB  PRAMR     PRAM
     C                     ENDIF
      *
     C           SACTN     IFEQ 'R'
     C           PRAM      ADD  PRAMR     PRAM
     C                     ENDIF
     C                     ENDIF
      *
     C           REPTL     IFEQ 2
     C           SACTN     IFEQ 'I'
     C           TAMT      SUB  PRAMR     TAMT
     C                     ENDIF
     C           SACTN     IFEQ 'R'
     C           TAMT      ADD  PRAMR     TAMT
     C                     ENDIF
     C                     ENDIF
      *
     C           REPTL     IFEQ 3
     C           SACTN     IFEQ 'I'
     C           TAMT      SUB  TAMTR     TAMT
     C                     ENDIF
     C           SACTN     IFEQ 'R'
     C           TAMT      ADD  TAMTR     TAMT
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           AMTP      IFEQ 'PD'
     C***********SACTN     ANDEQ'I'                                       131414
      *
     C           SACTN     IFEQ 'I'
     C           PRAM      SUB  PRAMR     PRAM
     C           INTA      SUB  INTAR     INTA
     C           WTXA      SUB  WTXAR     WTXA
     C           TAMT      SUB  TAMTR     TAMT
     C                     ENDIF
     C           SACTN     IFEQ 'R'
     C           PRAM      ADD  PRAMR     PRAM
     C           INTA      ADD  INTAR     INTA
     C           WTXA      ADD  WTXAR     WTXA
     C           TAMT      ADD  TAMTR     TAMT
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           *IN44     IFEQ *ON
     C/COPY WNCPYSRC,LE2110C017
     C           RAMTS     SUB  PRAMR     PRAM
      *
     C                     SELEC
     C           REPTL     WHEQ 1
     C                     Z-ADD0         TAMT
     C           REPTL     WHEQ 2
     C                     Z-ADDPRAM      TAMT
     C           REPTL     WHEQ 3
     C                     Z-ADD0         PRAM
     C           RAMTS     SUB  TAMTR     TAMT
     C                     ENDSL
      *
     C                     ENDIF
      *
      ** Save after status of TAMT
      *
     C                     Z-ADDTAMT      TAMTS  130
      *
      * Update Facility Currency amount fields on Related record:                             CLE036
     C           *IN25     IFEQ *ON                                                           CLE036
     C                     EXSR SRFRUP                                                        CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           *IN44     IFEQ '1'
     C                     MOVE BIT       LAIN
     C                     TESTB'3'       TLXI           86
     C   86                BITON'1'       LAIN
     C                     TESTB'2'       CBLI           86
     C   86                BITON'45'      LAIN
     C                     BITON'27'      LAIN
      *
      ** Write new RE record
      *
     C                     Z-ADD1         XASQ
     C                     EXSR SRINRE
      *
     C           PMODE     IFEQ 'B'
     C                     MOVE PIPCOB    PCOB
     C                     ELSE
     C                     MOVE *BLANKS   PCOB
     C                     ENDIF
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C           MARG      IFLT 0                                                             CAS005
     C                     Z-SUBMARG      WAVMAR  75                                          CAS005
     C                     ELSE                                                               CAS005
     C                     Z-ADDMARG      WAVMAR                                              CAS005
     C                     ENDIF                                                              CAS005
     C           INTR      IFGT WAVMAR                                                        CAS005
     C           INTR      SUB  MARG      WKINTR 117                                          CAS005
     C                     ELSE                                                               CAS005
     C                     Z-ADD0         WKINTR                                              CAS005
     C                     ENDIF                                                              CAS005
     C           INTA      MULT WKINTR    WKINTA 130                                          CAS005
     C           INTR      IFNE 0                                                             223935
     C           WKINTA    DIV  INTR      INTN                                                CAS005
     C                     ELSE                                                               223935
     C                     Z-ADDWKINTA    INTN                                                223935
     C                     ENDIF                                                              223935
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      *                                                                                       CSD015
      ** Call  SRWTCH if watch list checking is applied.                                      CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C           AMTP      ANDEQ'RE'                                                          CSD015
     C                     EXSR SRBLDA                                                        CSD015
      *                                                                                       CSD015
     C           WNBLNK    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
      ** If 24X7 is not installed or the suport system is off.                                CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PMREXR    REXRK                                               CLE031
     C                     MOVE PMPEXR    PEXRK                                               CLE031
     C                     MOVE PMREXI    REXIK                                               CLE031
     C                     MOVE PMPEXI    PEXIK                                               CLE031
     C                     MOVE PMPSCY    PSCYK                                               CLE031
     C                     MOVE PMRSCY    SCCYK                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** If CAS009 is On, update LEEIRDPD if Insert or Reverse                                CAS009
      ** for all records affected by the value date of the                                    CAS009
      ** manual repayment record.                                                             CAS009
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           SACTN     IFEQ 'I'                                                           CAS009
     C           WLNRF     CHAINLEEIRDL5             20                                       CAS009
     C           *IN20     IFEQ '0'                                                           CAS009
      *                                                                                       CAS009
     C           VDAT      IFLE EIENDT                                                        CAS009
     C                     MOVE 'Y'       EIRCAL                                              CAS009
     C                     UPDATLEEIRDD0                                                      CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** ENDIF of CAS009                                                                      CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     WRITELOAMSDKF
      *                                                                                     AR991073
     C           PMODE     IFEQ 'B'                                                         AR991073
     C                     MOVE LNRF      AMLNRF                                            AR991073
     C                     MOVE VDAT      AMVDAT                                            AR991073
     C                     MOVE LASN      AMLASN                                            AR991073
     C                     MOVE BRCA      AMBRCA                                            AR991073
     C                     MOVE FRNT      AMFRID                                            AR991073
     C                     WRITELOAMSQD0                                                    AR991073
     C                     ENDIF                                                            AR991073
      *                                                                                     AR991073
     C/COPY WNCPYSRC,LE2110C028
     C                     MOVE LASN      SESEQ
     C                     MOVE *BLANK    WAMTP                           131414
      *
      ** Update related amendment
      *
     C                     ELSE
      *
      ** If CAS009 is On, update LEEIRDPD if Insert or Reverse                                CAS009
      ** for all records affected by the value date of the                                    CAS009
      ** manual repayment record.                                                             CAS009
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           SACTN     IFEQ 'R'                                                           CAS009
     C           WLNRF     CHAINLEEIRDL5             20                                       CAS009
     C           *IN20     IFEQ '0'                                                           CAS009
      *                                                                                       CAS009
     C           VDAT      IFLE EIENDT                                                        CAS009
     C                     MOVE 'Y'       EIRCAL                                              CAS009
     C                     UPDATLEEIRDD0                                                      CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** ENDIF of CAS009                                                                      CAS009
     C                     ENDIF                                                              CAS009
     C           AMTP      IFEQ 'RE'
     C           AMTP      OREQ 'PD'
     C                     MOVE AMTP      WAMTP   2                       127722
     C                     EXSR SRUPRE
      *                                                                                       CSD015
      ** Call  SRWTCH if watch list checking is applied.                                      CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C           AMTP      ANDEQ'RE'                                                          CSD015
      *                                                                                       CSD015
      ** If 24X7 is not installed or the suport system is off.                                CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
      *                                                                                       CSD015
     C           *IN06     IFEQ *OFF                                                          CSD015
     C           W3UNCF    ANDEQ'Y'                                                           CSD015
     C                     EXSR SRBLDA                                                        CSD015
     C                     EXSR SRWTCH                                                        CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           WDIFF     IFEQ 'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PMREXR    REXRK                                               CLE031
     C                     MOVE PMPEXR    PEXRK                                               CLE031
     C                     MOVE PMREXI    REXIK                                               CLE031
     C                     MOVE PMPEXI    PEXIK                                               CLE031
     C                     MOVE PMPSCY    PSCYK                                               CLE031
     C                     MOVE PMRSCY    SCCYK                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     UPDATLOAMSDKF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     MOVE SSEQN     SLASN
      *
     C           SACTN     IFEQ 'I'
      *
     C                     Z-ADDWDAYNV    WVALD
     C                     Z-ADD0         SLASN
     C                     EXSR SRNSEQ
     C                     EXSR SRINMR
      *
      ** Output MR record
      *
     C                     Z-ADDWDAYNE    XAVD
     C                     MOVE SESEQ     XASQ
     C                     MOVE 'MR'      AMTP
     C                     Z-ADDPRAMR     PRAM
     C                     Z-ADDINTAR     INTA
     C                     Z-ADDTAMTR     TAMT
     C                     Z-ADDPNAMR     PNAM
      *                                                                                       CLE036
     C                     Z-ADDFRAMR     FRAM                                                CLE036
     C                     Z-ADDFINTR     FINT                                                CLE036
     C                     Z-ADDFTXAR     FTXA                                                CLE036
     C                     Z-ADDFTOTR     FTOT                                                CLE036
     C                     Z-ADDFPENR     FPEN                                                CLE036
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C           MARG      IFLT 0                                                             CAS005
     C                     Z-SUBMARG      WAVMAR  75                                          CAS005
     C                     ELSE                                                               CAS005
     C                     Z-ADDMARG      WAVMAR                                              CAS005
     C                     ENDIF                                                              CAS005
     C           INTR      IFGT WAVMAR                                                        CAS005
     C           INTR      SUB  MARG      WKINTR                                              CAS005
     C                     ELSE                                                               CAS005
     C                     Z-ADD0         WKINTR                                              CAS005
     C                     ENDIF                                                              CAS005
     C           INTA      MULT WKINTR    WKINTA                                              CAS005
     C           INTR      IFNE 0                                                             223935
     C           WKINTA    DIV  INTR      INTN                                                CAS005
     C                     ELSE                                                               223935
     C                     Z-ADDWKINTA    INTN                                                223935
     C                     ENDIF                                                              223935
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      *                                                                                       CSD015
      ** Call  SRWTCH if watch list checking is applied.                                      CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C           AMTP      ANDEQ'MR'                                                          CSD015
     C                     EXSR SRBLDA                                                        CSD015
      *                                                                                       CSD015
     C           WNBLNK    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
      ** If 24X7 is not installed or the suport system is off.                                CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PMREXR    REXRK                                               CLE031
     C                     MOVE PMPEXR    PEXRK                                               CLE031
     C                     MOVE PMREXI    REXIK                                               CLE031
     C                     MOVE PMPEXI    PEXIK                                               CLE031
     C                     MOVE PMPSCY    PSCYK                                               CLE031
     C                     MOVE PMRSCY    SCCYK                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE SSTAL     STALK                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE031
     C/COPY ZSRSRC,DFTTSTAMPC                                             CLE029
     C                     MOVELTSTAMP    TMSTK                           CLE029
      ** If CAS009 is On, update LEEIRDPD if Insert or Reverse                                CAS009
      ** for all records affected by the value date of the                                    CAS009
      ** manual repayment record.                                                             CAS009
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           SACTN     IFEQ 'I'                                                           CAS009
     C           WLNRF     CHAINLEEIRDL5             20                                       CAS009
     C           *IN20     IFEQ '0'                                                           CAS009
      *                                                                                       CAS009
     C           VDAT      IFLE EIENDT                                                        CAS009
     C                     MOVE 'Y'       EIRCAL                                              CAS009
     C                     UPDATLEEIRDD0                                                      CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** ENDIF of CAS009                                                                      CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     WRITELOAMSDKF
      *                                                                                     AR991073
     C           PMODE     IFEQ 'B'                                                         AR991073
     C                     MOVE LNRF      AMLNRF                                            AR991073
     C                     MOVE VDAT      AMVDAT                                            AR991073
     C                     MOVE LASN      AMLASN                                            AR991073
     C                     MOVE BRCA      AMBRCA                                            AR991073
     C                     MOVE FRNT      AMFRID                                            AR991073
     C                     WRITELOAMSQD0                                                    AR991073
     C                     ENDIF                                                            AR991073
      *                                                                                     AR991073
     C/COPY WNCPYSRC,LE2110C029
      *                                                                   131253
     C           CLE005    IFEQ 'Y'                                       131253
     C           RECIL     ANDEQ'M'                                       131253
     C           SACTN     ANDEQ'I'                                       131253
      *                                                                   131253
     C           KCLOAN    CHAINCLOAN                39                   131253
     C           *IN39     IFEQ '0'                                       131253
     C                     MOVEL'Y'       RATF                            131253
     C                     UPDATCLOANCLF                                  131253
     C                     ENDIF                                          131253
      *                                                                   131253
     C                     ENDIF                                          131253
      *
      ** Save record for test harness
      *
     C                     MOVE L2110F    L2110S
      *
     C                     ELSE
      *                                                                                       CAS009
      ** If CAS009 is On, update LEEIRDPD if Insert or Reverse                                CAS009
      ** for all records affected by the value date of the                                    CAS009
      ** manual repayment record.                                                             CAS009
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           SACTN     IFEQ 'R'                                                           CAS009
     C           WLNRF     CHAINLEEIRDL5             20                                       CAS009
     C           *IN20     IFEQ '0'                                                           CAS009
      *                                                                                       CAS009
     C           VDAT      IFLE EIENDT                                                        CAS009
     C                     MOVE 'Y'       EIRCAL                                              CAS009
     C                     UPDATLEEIRDD0                                                      CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** ENDIF of CAS009                                                                      CAS009
     C                     ENDIF                                                              CAS009
      *
      ** Set up MR details for update
      *
     C                     Z-ADDWDAYNV    WVALD
     C                     MOVE SSEQN     SLASN
     C           KLMKEY    CHAINLOAMS                50
      *
     C                     EXSR SRUPMR
      *                                                                                       CSD015
      ** Call  SRWTCH if watch list checking is applied.                                      CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C           AMTP      ANDEQ'MR'                                                          CSD015
      *                                                                                       CSD015
      ** If 24X7 is not installed or the suport system is off.                                CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
      *                                                                                       CSD015
     C           *IN06     IFEQ *OFF                                                          CSD015
     C           W3UNCF    ANDEQ'Y'                                                           CSD015
     C                     EXSR SRBLDA                                                        CSD015
     C                     EXSR SRWTCH                                                        CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           WDIFF     IFEQ 'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PMREXR    REXRK                                               CLE031
     C                     MOVE PMPEXR    PEXRK                                               CLE031
     C                     MOVE PMREXI    REXIK                                               CLE031
     C                     MOVE PMPEXI    PEXIK                                               CLE031
     C                     MOVE PMPSCY    PSCYK                                               CLE031
     C                     MOVE PMRSCY    SCCYK                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     UPDATLOAMSDKF
      *                                                                   131253
     C           CLE005    IFEQ 'Y'                                       131253
     C           RECIL     ANDEQ'M'                                       131253
     C           SACTN     ANDEQ'R'                                       131253
     C           CNTRTF    ANDEQ1                                         186752
      *                                                                   131253
     C           KCLOAN    CHAINCLOAN                39                   131253
      *                                                                   131253
     C           *IN39     IFEQ '0'                                       131253
     C                     MOVE *BLANK    RATF                            131253
     C                     UPDATCLOANCLF                                  131253
     C                     ENDIF                                          131253
      *                                                                   131253
     C                     ENDIF                                          131253
      *                                                                   131253
     C                     MOVE L2110F    L2110S
     C                     ENDIF
      *
      ** Allocated sequence no to last input
      *
     C                     Z-ADDLASN      SLASN1
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C                     MOVELLNRF      PLNRF   6                                           CLE034
     C                     MOVELLASN      PLASN   3                                           CLE034
     C                     MOVELVDAT      PVDAT   5                                           CLE034
      *                                                                                       CLE034
     C           SACTN     IFEQ 'I'                                                           CLE034
     C           WNOKY     ANDEQ'Y'                                                           CLE034
     C                     CALL 'AOSTALU0'                                                    CLE034
     C                     PARM PMODE     PRTCD                                               CLE034
     C                     PARM 'LAMR'    PTYPE                                               CLE034
     C                     PARM 'U'       PACTN   1                                           CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM           PVDAT                                               CLE034
     C                     PARM           PLASN                                               CLE034
     C                     PARM *BLANKS   PCSTF                                               CLE034
     C                     PARM *BLANKS   PFTYF                                               CLE034
     C                     PARM *BLANKS   PFSEQ                                               CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM           PCRFK                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           SACTN     IFEQ 'D'                                                           CLE034
     C                     CALL 'AOSTALU0'                                                    CLE034
     C                     PARM PMODE     PRTCD                                               CLE034
     C                     PARM 'LAMR'    PTYPE                                               CLE034
     C                     PARM 'D'       PACTN                                               CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM           PVDAT                                               CLE034
     C                     PARM           PLASN                                               CLE034
     C                     PARM *BLANKS   PCSTF                                               CLE034
     C                     PARM *BLANKS   PFTYF                                               CLE034
     C                     PARM *BLANKS   PFSEQ                                               CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM           PCRFK                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
     C/COPY WNCPYSRC,LEH00586
      *                                                                   128094
     C                     EXSR SRLTRX                                    128094
      *                                                                   184689
      ** If LNRF field is blanked out due to LTRIX chaining,              184689
      ** move SLOAN value to the said field.                              184689
      *                                                                   184689
     C********** LNRF      IFEQ 0                                                      184689 CLE148
     C           LNRF      IFEQ *BLANKS                                                       CLE148
     C                     MOVE SLOAN     LNRF                            184689
     C                     END                                            184689
      *                                                                   159257
      ** Clear warning indicator for next input                           159257
      *                                                                   159257
     C                     MOVE *BLANK    WARN                            159257
      *
     C                     ENDSR
     C/COPY WNCPYSRC,LEH00587
      *****************************************************************                       CSD015
      *  SRBLDA  -  Build array used for storing fields in Compliance *                       CSD015
      *             Watch.                                            *                       CSD015
      *  Called by: SRLOAM                                            *                       CSD015
      *  Calls    : None                                              *                       CSD015
      *****************************************************************                       CSD015
     C           SRBLDA    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     MOVEA*BLANKS   WLF,1                                               CSD015
     C                     MOVEL'N'       WNBLNK  1                                           CSD015
      *                                                                                       CSD015
     C           RONS      IFNE *BLANKS                                                       CSD015
     C           RIBN      ORNE *BLANKS                                                       CSD015
     C********** ROBN      ORNE *ZERO                                                  CSD015 CSD027
     C********** ROCN      ORNE *ZERO                                                  CSD015 CSD027
     C           ROBN      ORNE *BLANKS                                                       CSD027
     C           ROCN      ORNE *BLANKS                                                       CSD027
     C           PONS      ORNE *BLANKS                                                       CSD015
     C           PIBN      ORNE *BLANKS                                                       CSD015
     C********** POBN      ORNE *ZERO                                                  CSD015 CSD027
     C********** POCN      ORNE *ZERO                                                  CSD015 CSD027
     C           POBN      ORNE *BLANKS                                                       CSD027
     C           POCN      ORNE *BLANKS                                                       CSD027
     C           RCRN      ORNE *BLANKS                                                       CSD015
     C           RVNO      ORNE *BLANKS                                                       CSD015
     C           AWBN      ORNE *BLANKS                                                       CSD015
     C           BENN      ORNE *BLANKS                                                       CSD015
     C           DTP1      ORNE *BLANKS                                                       CSD015
     C           DTP2      ORNE *BLANKS                                                       CSD015
     C           DTP3      ORNE *BLANKS                                                       CSD015
     C           DTP4      ORNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C                     MOVEL'Y'       WNBLNK                                              CSD015
     C                     MOVEL'Y'       WDTPC                                               CSD015
      *                                                                                       CSD015
     C                     MOVELRONS      WLF,1                                               CSD015
     C                     MOVELRIBN      WLF,2                                               CSD015
     C                     MOVELROBN      WLF,3                                               CSD015
     C                     MOVELROCN      WLF,4                                               CSD015
     C                     MOVELPONS      WLF,5                                               CSD015
     C                     MOVELPIBN      WLF,6                                               CSD015
     C                     MOVELPOBN      WLF,7                                               CSD015
     C                     MOVELPOCN      WLF,8                                               CSD015
     C                     MOVELRCRN      WLF,9                                               CSD015
     C                     MOVELRVNO      WLF,10                                              CSD015
     C                     MOVELAWBN      WLF,11                                              CSD015
     C                     MOVELBENN      WLF,12                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      *  SRWTCH  -  Performs the Watch list processing.               *                       CSD015
      *  Called by: SRWRIT, SRUPDT                                    *                       CSD015
      *  Calls    : None                                              *                       CSD015
      *****************************************************************                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** PARAMETER 2:                                                                         CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PARMDS                                              CSD015
     C                     Z-ADD0         WID     20                                          CSD015
      *                                                                                       CSD015
     C           WID       DOUEQ12                                                            CSD015
     C                     ADD  1         WID                                                 CSD015
     C                     MOVELWLF,WID   PINP1                                               CSD015
      *                                                                                       CSD015
     C           WLF,WID   IFNE *BLANKS                                                       CSD015
     C           WLF,WID   ANDNE'000000'                                                      CSD015
      *                                                                                       CSD015
     C           SCCY      IFNE *BLANKS                                                       CSD015
     C                     MOVELSCCY      PCCY                                                CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELCCY       PCCY                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     CALL 'SDCWLFMT'                                                    CSD015
     C                     PARM           PRTCD   7                                           CSD015
     C                     PARM           PINP1  35                                           CSD015
     C                     PARM *BLANKS   PINP2  35                                           CSD015
     C                     PARM *BLANKS   PINP3  35                                           CSD015
     C                     PARM *BLANKS   PINP4  35                                           CSD015
     C                     PARM *BLANKS   PINP5  35                                           CSD015
     C                     PARM *BLANKS   PINP6  35                                           CSD015
     C                     PARM           PCCY    3                                           CSD015
     C                     PARM           POUT  216                                           CSD015
     C                     PARM           PCNUM   6                                           CSD015
      *                                                                                       CSD015
     C           POUT      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCWP2                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
      ** Add the Payment Details.                                                             CSD015
      *                                                                                       CSD015
     C           DTP1      IFNE *BLANKS                                                       CSD015
     C           DTP2      ORNE *BLANKS                                                       CSD015
     C           DTP3      ORNE *BLANKS                                                       CSD015
     C           DTP4      ORNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           WDTPC     IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     CAT  CWA,25:0  PARMDS                                              CSD015
     C                     CAT  DTP1:0    PARMDS                                              CSD015
     C                     CAT  DTP2:1    PARMDS                                              CSD015
     C                     CAT  DTP3:1    PARMDS                                              CSD015
     C                     CAT  DTP4:1    PARMDS                                              CSD015
     C                     CAT  CWA,26:0  PARMDS                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      **  Set up parameter 1 and send details to engine only if                               CSD015
      **  PARMDS is not empty.                                                                CSD015
      *                                                                                       CSD015
     C           PARMDS    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
      ** PARAMETER 1:                                                                         CSD015
      ** Item Type Code                                                                       CSD015
     C                     MOVEL'LERPAY'  W4ITEM                                              CSD015
      *                                                                                       CSD015
      ** Identifier                                                                           CSD015
     C                     MOVEL*BLANK    WKLNRF                                              CSD015
     C                     MOVEL*BLANK    WVDAT                                               CSD015
     C                     MOVEL*BLANK    WLASN                                               CSD015
     C                     MOVEL*BLANK    W4IDEN                                              CSD015
      *                                                                                       CSD015
     C                     MOVE LNRF      WKLNRF                                              CSD015
     C                     MOVE VDAT      WVDAT                                               CSD015
     C                     MOVE LASN      WLASN                                               CSD015
     C           WKLNRF    CAT  WVDAT:0   W4IDEN                                              CSD015
     C                     CAT  WLASN:0   W4IDEN                                              CSD015
      *                                                                                       CSD015
      ** Branch                                                                               CSD015
     C                     MOVELBRCA      W4BRCH                                              CSD015
      *                                                                                       CSD015
      ** System                                                                               CSD015
      ** If Midas 24x7 is installed, use Main system prefix otherwise use system prefix       CSD015
     C           CSC011    IFEQ 'Y'                                                           CSD015
     C                     MOVE S1MAIN    W4SYSM                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE LIBR      W4SYSM                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Function Type                                                                        CSD015
     C                     MOVEL'LOAMSDK' W4FUNT                                              CSD015
      *                                                                                       CSD015
      ** Counter Party Details                                                                CSD015
     C                     MOVE PCNUM     WCNUM   6                                           CSD015
     C                     CALL 'AOCUSTR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*KEY   ' POPTN                                               CSD015
     C                     PARM WCNUM     WKEYC                                               CSD015
     C                     PARM           KEYSTS                                              CSD015
     C           SDCUST    PARM SDCUST    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C           BBCRNM    CAT  BBCRTN    W4CUST                                              CSD015
     C                     MOVE PCNUM     W4CNUM                                              CSD015
      *                                                                                       CSD015
     C           CCF001    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           BBCRPC    IFEQ 'Y'                                                           CSD015
     C                     MOVE 'C'       W4CTYP                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           BBLICD    IFNE *BLANK                                                        CSD015
     C           BBLICD    ANDNEW1IND1                                                        CSD015
     C           BBLICD    ANDNEW1IND2                                                        CSD015
     C           BBLICD    ANDNEW1IND3                                                        CSD015
     C           BBLICD    ANDNEW1IND4                                                        CSD015
     C           BBLICD    ANDNEW1IND5                                                        CSD015
     C                     MOVE 'C'       W4CTYP                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Deal Date                                                                            CSD015
     C                     MOVE *BLANKS   W4DDAT                                              CSD015
      *                                                                                       CSD015
      ** Value Date                                                                           CSD015
     C                     Z-ADDVDAT      W4VDAT                                              CSD015
      *                                                                                       CSD015
      ** Maturity Date                                                                        CSD015
     C                     MOVE *BLANKS   W4MDAT                                              CSD015
      *                                                                                       CSD015
      ** Denomination Side 1                                                                  CSD015
     C                     MOVELCCY       W4DEN1                                              CSD015
     C                     MOVE *BLANKS   W4DEN2                                              CSD015
      *                                                                                       CSD015
      ** Amount Side 1                                                                        CSD015
     C                     MOVELTAMT      W4AMT1                                              CSD015
     C                     MOVE *BLANKS   W4AMT2                                              CSD015
      *                                                                                       CSD015
      ** Send transaction details to Compliance Watch by calling SDWLCLOP                     CSD015
      *                                                                                       CSD015
     C                     CALL 'SDWLCLOP'                                                    CSD015
     C                     PARM           CWLCDS                                              CSD015
     C                     PARM           PARMDS                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      *  SRCWP2  -  Set up the 2nd parameter for Compliance Watch.    *                       CSD015
      *  Called by: SRUPDT                                            *                       CSD015
      *  Calls    : None                                              *                       CSD015
      *****************************************************************                       CSD015
     C           SRCWP2    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C           WID       MULT 2         CLS     20                                          CSD015
     C           CLS       SUB  1         OPN     20                                          CSD015
      *                                                                                       CSD015
     C                     MOVELCWA,OPN   WOPN   25                                           CSD015
     C                     MOVELCWA,CLS   WCLS   25                                           CSD015
      *                                                                                       CSD015
     C           PARMDS    CAT  WOPN:0    PARMDS                                              CSD015
     C                     CAT  POUT:0    PARMDS                                              CSD015
      *                                                                                       CSD015
     C                     SELEC                                                              CSD015
     C           WID       WHEQ 2                                                             CSD015
     C                     CAT  RIBA:0    PARMDS                                              CSD015
     C           WID       WHEQ 6                                                             CSD015
     C                     CAT  PIBA:0    PARMDS                                              CSD015
     C           WID       WHEQ 9                                                             CSD015
     C                     CAT  RCRA:0    PARMDS                                              CSD015
     C           WID       WHEQ 11                                                            CSD015
     C                     CAT  AWBA:0    PARMDS                                              CSD015
     C           WID       WHEQ 12                                                            CSD015
     C                     CAT  BENA:0    PARMDS                                              CSD015
     C                     ENDSL                                                              CSD015
      *                                                                                       CSD015
     C                     CAT  WCLS:0    PARMDS                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************
      * SRNSEQ   -  Get next available sequence number                *
      * Called by: SRLOAM                                             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRNSEQ    BEGSR
      *
     C                     Z-ADD0         SLASN
      *
      ** Get next available sequence
      *
     C           KLMKEY    SETLLLOAMD
     C                     READ LOAMD                    50
     C           *IN50     DOWEQ*OFF
     C           LNRFA     IFNE WLNRF
     C********** VDATA     ORNE WDAYNV                                                        222410
     C           VDATA     ORNE WVALD                                                         222410
     C                     MOVE *BLANKS   RECIA                                               184384
     C                     MOVE *BLANKS   LTYPA                                               184384
     C                     MOVE *BLANKS   SUTPA                                               184384
     C                     MOVE *BLANKS   AMTPA                                               184384
     C                     MOVE *BLANKS   AUTOA                                               184384
     C                     MOVE *BLANKS   OSACA                                               184384
     C                     MOVE *BLANKS   TSENA                                               184384
     C                     MOVE *BLANKS   FACOA                                               184384
     C**********           Z-ADD*ZEROS    LNRFA                                        184384 CLE148
     C                     MOVEL*BLANKS   LNRFA                                               CLE148
     C                     Z-ADD*ZEROS    VDATA                                               184384
     C                     Z-ADD*ZEROS    LASNA                                               184384
     C                     Z-ADD*ZEROS    PTYPA                                               184384
     C                     Z-ADD*ZEROS    INTAA                                               184384
     C                     Z-ADD*ZEROS    PRAMA                                               184384
     C                     Z-ADD*ZEROS    TAMTA                                               184384
     C                     Z-ADD*ZEROS    WTXAA                                               184384
     C                     Z-ADD*ZEROS    PNAMA                                               184384
     C                     Z-ADD*ZEROS    SETPAA                                              184384
     C                     Z-ADD*ZEROS    FRAMA                                               CLE036
     C                     Z-ADD*ZEROS    FINTA                                               CLE036
     C                     Z-ADD*ZEROS    FTOTA                                               CLE036
     C                     Z-ADD*ZEROS    FTXAA                                               CLE036
     C                     Z-ADD*ZEROS    FPENA                                               CLE036
     C                     LEAVE
     C                     ENDIF
     C                     Z-ADDLASNA     SLASN
     C                     READ LOAMD                    50
     C                     ENDDO
      *
     C                     ADD  1         SLASN
      *
     C                     ENDSR
      *****************************************************************
      * SRTSHR   - Set up details for output to test harness file     *
      * Called by: SRWRIT, SRUPDT                                     *
      * Calls    : None                                               *
      *****************************************************************
     C           SRTSHR    BEGSR
     C                     MOVE L2110S    L2110F
     C                     MOVELSRPRI     SPRM
     C                     MOVELSPSIG     SPRS
     C                     MOVELSRINT     SINT
     C                     MOVELSISIG     SINS
     C                     MOVELSRPEN     SPNM
     C                     MOVELSRPIG     SPNS
     C                     MOVELSRTOT     STAM
     C                     MOVELSRSIG     STAS
     C                     MOVELSRCCY     SRCY                                                CLE036
     C                     MOVE LWOI      LWOIT
     C                     Z-ADDBJRDNB    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     WDATE
     C                     MOVELWDD       WFLD3A  3
     C                     MOVE '/'       WFLD3A
     C                     MOVELWMM       WFLD3B  3
     C                     MOVE '/'       WFLD3B
     C                     MOVELWFLD3A    WFLD6A  6
     C                     MOVE WFLD3B    WFLD6A
     C                     MOVELWFLD6A    WDTST   8
     C                     MOVE WYY       WDTST
     C                     MOVELWDTST     DTST
     C                     TIME           WTIME   60
     C                     MOVELWTIME     WTIMEA  6
     C                     MOVELWHH       WFLD3A  3
     C                     MOVE ':'       WFLD3A
     C                     MOVELWNN       WFLD3B  3
     C                     MOVE ':'       WFLD3B
     C                     MOVELWFLD3A    WFLD6A  6
     C                     MOVE WFLD3B    WFLD6A
     C                     MOVELWFLD6A    WTMST   8
     C                     MOVE WSS       WTMST
     C                     MOVELWTMST     TMST
     C                     MOVELSACTN     ACTN
     C                     MOVE WDAYNE    EDAT
     C                     MOVE SESEQ     ESEQ
     C                     MOVE *BLANK    MSVR
     C                     MOVE *BLANK    MSID
     C                     MOVE *BLANK    MSTX
     C                     WRITELE2110D0
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRUPDT   - Update processing                                  *
      * Called by: Main Processing, SRBTCH                            *
      * Calls    : SRCHGS, SRSHAD, SRFCLT, SRLOAN, SRLOAM, SRTRAL,    *
      *            SRTSHR                                             *
      *            SRFEES - Update Fees File                          *   CLE009
      *****************************************************************
      *
     C           SRUPDT    BEGSR
      *
     C                     Z-ADDWDAYNV    WVALD
     C                     MOVE SSEQN     SLASN
      *
      ** Check for changes to file(s)
      *
     C                     EXSR SRCHGS
      *
     C           WEXIT     IFNE 'Y'
      *
      ** Facility update
      *
     C           SACTN     IFEQ 'R'
     C           *IN47     IFEQ *ON
     C           *IN47     OREQ *OFF
     C           AMTPA     ANDEQ'PD'
     C                     EXSR SRFCLT
     C           WERR      CABEQ'Y'       SRUEND
     C                     ENDIF
     C                     ENDIF
      *
      ** Loans file update
      *
     C           *IN44     IFEQ '1'
     C           AMTP      OREQ 'PD'                                      155099
     C                     EXSR SRLOAN
     C           WERR      CABEQ'Y'       SRUEND
     C                     ENDIF
      *
      ** Update loan amendment
      *
     C           SACTN     IFEQ 'R'                                       158802
     C**********           Z-ADDLNRF      W#LNRF                                       158802 CLE148
     C                     MOVELLNRF      W#LNRF                                              CLE148
     C                     ENDIF                                          158802
      *                                                                   158802
     C                     EXSR SRLOAM
      *                                                                   158802
     C           SACTN     IFEQ 'R'                                       158802
     C**********           Z-ADDW#LNRF    LNRF                                         158802 CLE148
     C                     MOVELW#LNRF    LNRF                                                CLE148
     C                     ENDIF                                          158802
      *                                                                   158802
      *                                                                   CLE009
      ** If CLE009 is installed, update fees file                         CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     EXSR SRFEES                                    CLE009
     C                     ENDIF                                          CLE009
     C           WERR      CABEQ'Y'       SRUEND
      *
      ** Update trailer
      *
     C           SACTN     IFEQ 'R'
     C                     EXSR SRTRAL
     C           WERR      CABEQ'Y'       SRUEND
     C                     ENDIF
      *
      ** Shadow posting
      *
      ** Before status
      *
      ** Update on shadow posting shd only be done if not a Risk loan     175450
      ** If it is a Risk loan then it should have an interest payment.    175450
      *                                                                   175450
     C           PTYP      IFEQ 61                                        175450
     C           PTYP      OREQ 62                                        175450
     C           PTYP      OREQ 63                                        175450
     C           PTYP      OREQ 64                                        175450
     C           PTYP      OREQ 65                                        175450
     C           PTYP      OREQ 66                                        175450
     C           PTYP      OREQ 67                                        175450
     C           PTYP      OREQ 68                                        175450
     C           PTYP      OREQ 69                                        175450
     C           PTYP      OREQ 70                                        175450
     C           INTA      ANDNE0                                         175450
     C           PTYP      OREQ 71                                        175450
     C           INTA      ANDNE0                                         175450
     C           PTYP      OREQ 72                                        175450
     C           INTA      ANDNE0                                         175450
      *                                                                   175450
     C**********           MOVE OLDSET    SHSETT 34                                           259991
     C                     MOVE OLDSET    SHSETT 40                                           259991
     C                     MOVE 'Y'       BEFSTS  1                       CLE033
     C                     EXSR SRSHAD
     C                     MOVE Z#ADTA    Z#BDT1
     C                     MOVE Z#ADTB    Z#BDT2
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           CLE031    OREQ 'Y'                                                           CLE031
     C                     MOVE Z#ADTE    Z#BDT5                          CEU004
     C                     ENDIF                                          CEU004
      *
      ** After status
      *
     C                     MOVE WSETT     SHSETT
     C                     MOVELWOOSBR    WOSBRK                                              219608
     C           CLE031    IFEQ 'Y'                                                           219608
     C                     MOVELPMRSCY    WSCCYK                                              219608
     C                     MOVELPMPSCY    WPSCY                                               219608
     C                     MOVE PMREXR    WREXR                                               219608
     C                     MOVELPMREXI    WREXI                                               219608
     C                     MOVE PMPEXR    WPEXR                                               219608
     C                     MOVELPMPEXI    WPEXI                                               219608
     C                     ENDIF                                                              219608
     C           CLE034    IFEQ 'Y'                                                           219608
     C                     MOVELSSTAL     WSTAL                                               219608
     C                     ENDIF                                                              219608
     C                     EXSR SRSHAD
     C                     MOVE Z#ADTA    Z#ADT1
     C**********           MOVE Z#ADTB    Z#ADTB                          CEU004
     C                     MOVE Z#ADTB    Z#ADT2                          CEU004
     C***********          MOVE Z#ADTB    Z#ADTB                          148591
     C                     MOVE Z#ADTB    Z#ADT2                          148591
     C                     MOVE Z#ADTD    Z#ADT4                          148591
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           CLE031    OREQ 'Y'                                                           CLE031
     C                     MOVE Z#ADTE    Z#ADT5                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C                     EXSR SRUSHD
     C                     ENDIF                                          175450
      *
     C                     ENDIF
      *                                                                   CDE001
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           CDE001    IFEQ 'Y'                                       CDE001
     C           WERR      ANDEQ'N'                                       CDE001
     C                     MOVELSLOAN     T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C                     PARM           T#TREF 20                       CDE001
     C                     PARM 'LOAN'    T#TCAT  4                       CDE001
     C                     PARM *BLANKS   RSRVID 10                       CDE005
     C                     ENDIF                                          CDE001
      *                                                                   CAP063
      ** Delete invalid record after amend                                CAP063
      *                                                                   CAP063
     C           PMODE     IFEQ 'F'                                       CAP063
     C           XREPN     CHAINLEIMRPDL             48                   CAP063
     C                     DELETLEIMRPDL                                  CAP063
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     EXSR LOGDEL                                    CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     ENDIF                                          CAP063
      *
     C           WERR      IFEQ 'N'
     C***********PMODE     ANDNE'P'                                       120002
     C           PMODE     ANDNE'B'                                       120002
     C                     COMIT
      *
      ** Write to test harness if changes committed
      *
     C           PMODE     IFEQ 'R'
     C                     EXSR SRTSHR
     C                     ENDIF
     C                     MOVE 'F0'      WFMT
      *
     C                     ELSE
     C                     MOVE WWRTRN    WFMT
     C                     ENDIF
      *                                                                   CSC011
      * If Support System active, write transaction to 24x7 log           CSC011
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C*                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
      *                                                                   CSC011
      * Convert facility to PINPP format                                  CSC011
     C                     EXSR LOG247                                    CSC011
      *                                                                   CSC011
      * Write valid facility in PINPP format to 24x7 Log File             CSC011
     C                     MOVE 'V'       LOGVAL  1                       CSC011
     C                     EXSR APLGTR                                    CSC011
     C                     COMIT                                          CSC011
      *                                                                   CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C/COPY WNCPYSRC,LE2110C005
      *
     C           SRUEND    ENDSR
      *
      *****************************************************************   CLE009
      * SRFEES  -  Update Fees File                                   *   CLE009
      * Called by: SRWRIT - Write a new record in file                *   CLE009
      *            SRUPDT - Update records                            *   CLE009
      * Calls    : None                                               *   CLE009
      *****************************************************************   CLE009
     C           SRFEES    BEGSR                                          CLE009
      *                                                                                       CLE036
      ** Re-use indicator *IN14:                                                              CLE036
     C                     MOVE *IN14     WIN14   1                                           CLE036
      *                                                                   CLE009
      ** If authorisation switchable feature is on and action code        CLE009
      ** is insert or amend and Manual Repayments Authorisations is       CLE009
      ** required                                                         CLE009
      *                                                                   CLE009
     C           CLE002    IFEQ 'Y'                                       CLE009
     C           SACTN     ANDNE'X'                                       CLE009
     C           SACTN     ANDNE'R'                                       CLE009
     C           BPMRAU    ANDEQ'Y'                                       CLE009
      *                                                                   CLE009
      ** If action code is insert                                         CLE009
      *                                                                   CLE009
     C           SACTN     IFEQ 'I'                                       CLE009
      *                                                                   CLE009
      ** Write a record to Loan Amendment Fee Index File                  CLE009
      *                                                                   CLE009
     C                     MOVE SLOAN     FFLNRF                          CLE009
     C                     Z-ADDWDAYNV    FFVDAT                          CLE009
     C                     MOVE SSEQN     FFLASN                          CLE009
     C                     MOVE *BLANKS   FFAUTH                          CLE009
     C                     MOVE WKSWRI    FFSWRI                          CLE009
     C                     WRITELEFELAD0                                  CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** If action code is amend                                          CLE009
      *                                                                   CLE009
     C           SACTN     IFEQ 'A'                                       CLE009
      *                                                                   CLE009
      ** Chain to Loan Amendment Fee Index File                           CLE009
      *                                                                   CLE009
     C                     MOVE SLOAN     WKLOAN                          CLE009
     C                     Z-ADDWDAYNV    WKDATE                          CLE009
     C                     MOVE SSEQN     WKSEQN                          CLE009
     C           KIDXF     CHAINLEFELAL0             13                   CLE009
      *                                                                   CLE009
      ** If record not found                                              CLE009
      *                                                                   CLE009
     C           *IN13     IFEQ *ON                                       CLE009
      *                                                                   CLE009
      ** Write a record to Loan Fee Index File                            CLE009
      *                                                                   CLE009
     C                     MOVE SLOAN     FFLNRF                          CLE009
     C                     Z-ADDWDAYNV    FFVDAT                          CLE009
     C                     MOVE SSEQN     FFLASN                          CLE009
     C                     MOVE 'Y'       FFAUTH                          CLE009
     C                     MOVE WKSWRI    FFSWRI                          CLE009
     C                     WRITELEFELAD0                                  CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** If work regeneration indicator is changed and regeneration       CLE009
      ** indicator is blank                                               CLE009
      *                                                                   CLE009
     C           WKSWRI    IFEQ 'C'                                       CLE009
     C           FFSWRI    ANDEQ*BLANKS                                   CLE009
      *                                                                   CLE009
      ** Update the record to Loan Amendment Fee Index File               CLE009
      *                                                                   CLE009
     C                     MOVE WKSWRI    FFSWRI                          CLE009
     C                     UPDATLEFELAD0                                  CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** If action code is authorise                                      CLE009
      *                                                                   CLE009
     C           SACTN     IFEQ 'X'                                       CLE009
      *                                                                   CLE009
      ** Chain to Loan Amendment Fee Index File                           CLE009
      *                                                                   CLE009
     C                     MOVE SLOAN     WKLOAN                          CLE009
     C                     Z-ADDWDAYNV    WKDATE                          CLE009
     C                     MOVE SSEQN     WKSEQN                          CLE009
     C           KIDXF     CHAINLEFELAL0             13                   CLE009
      *                                                                   CLE009
      ** If record is found                                               CLE009
      *                                                                   CLE009
     C           *IN13     IFEQ *OFF                                      CLE009
      *                                                                   CLE009
      ** Update the record to Loan Amendment Fee Index File               CLE009
      *                                                                   CLE009
     C                     MOVE FFSWRI    WKSWRI                          CLE009
     C                     MOVE 'Y'       FFAUTH                          CLE009
     C                     UPDATLEFELAD0                                  CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** If action code is reverse                                        CLE009
      *                                                                   CLE009
     C           SACTN     IFEQ 'R'                                       CLE009
      *                                                                   CLE009
      ** Chain to Loan Amendment Fee Index File                           CLE009
      *                                                                   CLE009
     C                     MOVE SLOAN     WKLOAN                          CLE009
     C                     Z-ADDWDAYNV    WKDATE                          CLE009
     C                     MOVE SSEQN     WKSEQN                          CLE009
     C           KIDXF     CHAINLEFELAL0             13                   CLE009
      *                                                                   CLE009
      ** If record is found                                               CLE009
      *                                                                   CLE009
     C           *IN13     IFEQ *OFF                                      CLE009
      *                                                                   CLE009
      ** If authorised is blank                                           CLE009
      *                                                                   CLE009
     C           FFAUTH    IFEQ *BLANKS                                   CLE009
     C                     MOVE *BLANKS   WKSWRI                          CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** If work regeneration indicator is blank                          CLE009
      *                                                                   CLE009
     C           WKSWRI    IFEQ *BLANKS                                   CLE009
     C                     MOVE FFSWRI    WKSWRI                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** If work regeneration indicator is changed                        CLE009
      *                                                                   CLE009
     C           WKSWRI    IFEQ 'C'                                       CLE009
      *                                                                   CLE009
      ** Check if the facility has an associated fee                      CLE009
      *                                                                   CLE009
     C                     MOVE WFTYP     CHFACT  3                       CLE009
     C                     MOVE WFSEQ     CHFCNO  2                       CLE009
     C           CHFACT    CAT  CHFCNO    CHFACL  5                       CLE009
     C                     MOVE CHFACL    WFFACL                          CLE009
     C**********           Z-ADD0         WFLOAN                                       CLE009 CLE148
     C                     MOVEL*BLANK    WFLOAN                                              CLE148
     C           WKFEE     SETLLLEFEEDL1                                  CLE009
     C           WKFEE     READELEFEEDL1                 14               CLE009
      *                                                                   CLE009
      ** Do while an associated fee exists                                CLE009
      *                                                                   CLE009
     C           *IN14     DOWEQ*OFF                                      CLE009
      *                                                                   CLE009
      ** If the fee is a confirmed calculated fee and swift               CLE009
      ** regeneration indicator is not 'I', 'B', 'H'                      CLE009
      *                                                                   CLE009
     C           FEAUTO    IFEQ 'Y'                                       CLE009
     C           FECALT    ANDNE*BLANKS                                   CLE009
     C           FESWRI    ANDNE'I'                                       CLE009
     C           FESWRI    ANDNE'B'                                       CLE009
     C           FESWRI    ANDNE'H'                                       CLE009
      *                                                                   CLE009
      ** Set currency to fee currency                                     CLE009
      ** Set day to run date                                              CLE009
      ** Set number of working days to telex notice days                  CLE009
      *                                                                   CLE009
     C                     MOVE FEFCCY    ZCCY                            CLE009
      *                                                                   CLE031
      ** If CLE031 is on then use correct currency to access AONOSTRO     CLE031
      *                                                                   CLE031
     C                     MOVE FEFCCY    WKCCY   3                       CLE031
     C           CLE031    IFEQ 'Y'                                       CLE031
      *                                                                   CLE031
     C           PTFI      IFEQ 'P'                                       CLE031
     C           FEPSCY    IFNE *BLANKS                                   CLE031
     C                     MOVE FEPSCY    WKCCY                           CLE031
     C                     ENDIF                                          CLE031
     C                     ELSE                                           CLE031
     C           FESCCY    IFNE *BLANKS                                   CLE031
     C                     MOVE FESCCY    WKCCY                           CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     MOVE WKCCY     ZCCY                            CLE031
     C                     MOVE WKCCY     PCURR                           CLE031
      *                                                                   CLE031
     C                     Z-ADDBJRDNB    ZDAYNO                          CLE009
     C                     Z-ADD1         Y                               CLE009
     C********** FEFCCY    LOKUPCYA,Y                    12        CLE009 CLE031
     C           WKCCY     LOKUPCYA,Y                    12               CLE031
     C                     MOVE *OFF      *IN12                           CLE009
     C                     MOVE TND,Y     ZNRDYS                          CLE009
      *                                                                   CLE009
      ** If Fee Settlement type is '01', '02', '07', '08' or '12'         CLE009
      *                                                                   CLE009
     C           FESTTL    IFEQ 01                                        CLE009
     C           FESTTL    OREQ 02                                        CLE009
     C           FESTTL    OREQ 07                                        CLE009
     C           FESTTL    OREQ 08                                        CLE009
     C           FESTTL    OREQ 12                                        CLE009
      *                                                                   CLE009
     C                     CALL 'AONOSTR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*KEY   ' POPTN                           CLE009
     C                     PARM           PCUSN   6                       CLE009
     C                     PARM FEFCCY    PCURR                           CLE009
     C**********           PARM           PACCD   4                                    CLE009 CAS011
     C                     PARM           PACCD  10                                           CAS011
     C                     PARM           PACSN   2                       CLE009
     C                     PARM FEOURS    PNONB   2                       CLE009
     C                     PARM           PBRCA                           CLE009
     C                     PARM           PCSSN  10                       CLE009
     C                     PARM           PPNOI   1                       CLE009
     C           SDNOST    PARM SDNOST    DSFDY                           CLE009
      *                                                                   CLE009
     C           PRTCD     IFNE *BLANKS                                   CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVEL'AONOSTR0'DBFILE           ************   CLE009
     C                     Z-ADD36        DBASE            * DBERR 36 *   CLE009
     C                     MOVELFEFCCY    DBKEY            ************   CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** Set Location to Nostro Location                                  CLE009
      *                                                                   CLE009
     C                     MOVE A7NOSN    ZLOC                            CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
     C                     MOVE *BLANKS   ZLOC                            CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** Calculate number of working days forward                         CLE009
      *                                                                   CLE009
     C                     EXSR ZFWDT                                     CLE009
      *                                                                   CLE009
      ** Set Telex Notice date to day number                              CLE009
      *                                                                   CLE009
     C                     Z-ADDZDYNBR    TXDT    50                      CLE009
      *                                                                   CLE009
      ** If next payment date is before or equals to Telex Notice date    CLE009
      ** and Next Payment Telex indicator is set to 'Y'                   CLE009
      *                                                                   CLE009
     C           FENPYD    IFLE TXDT                                      CLE009
     C           FEPPTI    ANDEQ'Y'                                       CLE009
      *                                                                   CLE009
      ** Update Fees file                                                 CLE009
      *                                                                   CLE009
     C                     MOVE 'A'       FESWRI                          CLE009
     C                     UPDATLEFEEDF                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** If end date is before or equals to Telex Notice date and End     CLE009
      ** Telex indicator is set to 'Y'                                    CLE009
      *                                                                   CLE009
     C           FEPEND    IFLE TXDT                                      CLE009
     C           FEEPTI    ANDEQ'Y'                                       CLE009
      *                                                                   CLE009
      ** Update Fees file                                                 CLE009
      *                                                                   CLE009
     C                     MOVE 'A'       FESWRI                          CLE009
     C                     UPDATLEFEEDF                                   CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C           WKFEE     READELEFEEDL1                 14               CLE009
     C                     ENDDO                                          CLE009
     C/COPY WNCPYSRC,LEH00742
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     MOVE *BLANKS   WKSWRI                          CLE009
      *                                                                                       CLE036
      ** Re-store indicator *IN14:                                                            CLE036
     C                     MOVE WIN14     *IN14                                               CLE036
      *                                                                   CLE009
     C                     ENDSR                                          CLE009
      /EJECT
      *****************************************************************
      * SRCHGS   - Check for changes in record before update          *
      * Called by: SRWRIT, SRUPDT                                     *
      * Calls    : ZASNMS, ZTNLU1                                     *
      *****************************************************************
     C           SRCHGS    BEGSR
      *
     C                     MOVEL'N'       WEXIT
      *
     C           *IN44     IFEQ '0'
     C           *IN47     ANDEQ'0'
     C           SACTN     ANDNE'A'
     C           SACTN     ANDNE'X'
     C           SACTN     ANDNE'E'
      *
     C           SACTN     IFEQ 'I'
     C                     Z-ADDWDAYNE    WVALD
     C                     MOVE SESEQ     SLASN
     C                     ELSE
     C                     Z-ADDXAVD      WVALD
     C                     Z-ADDXASQ      SLASN
     C                     ENDIF
      *
     C                     MOVE '0'       *IN50
     C           KLMKEY    CHAINLOAMS               N50
     C           RECI      IFEQ 'D'
     C           LSTC      IFEQ WLSTCR
     C                     MOVE WVALD     XAVD
     C                     MOVE SLASN     XASQ
     C                     ELSE
     C                     MOVE 'Y'       WEXIT
     C                     ENDIF
     C                     ELSE
     C                     MOVE 'Y'       WEXIT
     C                     ENDIF
      *
     C           WEXIT     IFEQ 'Y'
     C                     MOVE 'F0'      WFMT
     C                     MOVE *BLANKS   WWRTRN  2
     C                     MOVE 'LEM0010' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
     C           WEXIT     IFNE 'Y'
      *
      ** Check Loans file for change
      *
     C           KCLOAN    CHAINCLOAN               N50
     C           *IN50     IFEQ '1'
     C           RECIL     ORNE 'D'                                       131253
     C           RECIL     ANDNE'M'                                       131253
     C           RECIL     OREQ 'M'                                       131253
     C***********RECI      ORNE 'D'                                       131253
     C***********RECI      ANDNE'M'                                CLE007 131253
     C***********RECI      OREQ 'M'                                CLE007 131253
     C           WREAC     ANDEQ*BLANK                                    CLE007
     C           *IN44     OREQ '1'
     C           LSTC      ANDNEWLSTCL
     C                     MOVE 'Y'       WEXIT
     C                     MOVE 'LEM0010' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** Obtain last transaction number and prepare standard
      *
     C                     EXSR ZTNLU1
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRSLOC   - Get location                                       *
      * Called by: SRHOLI, SRLOAN                                     *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSLOC    BEGSR
      *
      ** Initialise working variable - settlement branch location
      *
     C           *LIKE     DEFN NRLC      W@STLL
     C                     MOVE *BLANKS   W@STLL
      *
      ** For type 01,02,07,08 or 12, settlement location is determined
      ** by the nostro branch
      *
     C           W@SETP    IFEQ '01'
     C           W@SETP    OREQ '02'
     C           W@SETP    OREQ '07'
     C           W@SETP    OREQ '08'
     C           W@SETP    OREQ '12'
      *
     C                     CALL 'AONOSTR0'
     C                     PARM '*BLANKS' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @KEYA   6
     C                     PARM W@CCY     @KEYB   3
     C**********           PARM *BLANKS   @KEYC   4                                           CAS011
     C                     PARM *BLANKS   @KEYC  10                                           CAS011
     C                     PARM *BLANKS   @KEYD   2
     C                     PARM W@SNOS    @KEYE   2
     C                     PARM *BLANKS   @KEYF   3
     C                     PARM *BLANKS   @KEYG  10
     C                     PARM *BLANKS   @KEYH   1
     C           SDNOST    PARM SDNOST    DSFDY
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVE A7NOSN    DSCSNM
     C                     MOVE NRLC      W@STLL
     C                     ELSE
     C           *LOCK     IN   LDA
     C                     Z-ADD14        DBASE            ************
     C                     MOVEL'SDNOSTPD'DBFILE           * DBERR 14 *
     C                     MOVELW@CCY     DBKEY            ************
     C                     MOVE W@SNOS    DBKEY
     C                     OUT  LDA
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           SETRTN    ENDSR
      /EJECT
      *****************************************************************
      * SRLOAN   - Update Loans file                                  *
      * Called by: SRWRIT, SRUPDT                                     *
      * Calls    : SRSLOC                                             *
      *****************************************************************
     C           SRLOAN    BEGSR
      *
      ** Access the CLOAN record to be updated
      *
     C                     MOVE SLOAN     WLOAN
     C           KCLOAN    CHAINCLOAN                50
      *
     C           *IN50     IFEQ '1'
     C           RECIL     ORNE 'D'                                       131253
     C***********RECI      ORNE 'D'                                       131253
     C           *LOCK     IN   LDA
     C                     MOVEL'CLOAN   'DBFILE           ************
     C                     Z-ADD15        DBASE            * DBERR 15 *
     C                     MOVELSLOAN     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     MOVE 'Y'       WERR
     C                     ELSE
      *
      ** Save repayment amount for generating 'RE' if match to cloan
      *
     C                     Z-ADDRAMT      RAMTS  130
     C                     Z-ADDFCRA      FCRAS  130                                          CLE036
      *
      ** Update fields for next repayment date
      *
     C           AMTP      IFNE 'PD'
      *
     C           RFRQ      IFNE ' '
      *
     C                     MOVE RFRQ      ZFREQ
     C                     Z-ADDRBDT      ZDAYNO
     C                     Z-ADDRDYN      ZMDAY
     C                     MOVE CCY       ZCCY
      *
      ** Find the location of the settlement
      *
     C                     MOVE MDST      W@SETP  2
     C                     MOVELOMDA      W@SNOS  2
     C                     MOVE CCY       W@CCY   3
     C                     EXSR SRSLOC
      *
      ** Determine next repayment date
      *
     C                     MOVE W@STLL    ZLOC
      ** If CLE005 exist, calculate the next repayment date based on                          194632
      ** the Payment Due Day Indicator                                                        194632
     C           CLE005    IFEQ 'Y'                                                           194632
     C                     EXSR ZFRQB3                                                        194632
     C                     Z-ADD*ZERO     ZNRDYS                                              194632
     C                     SELEC                                                              194632
     C           PDDIL     WHEQ 'A'                                                           194632
     C                     Z-ADDZDAYNO    ZDYNBR                                              194632
     C           PDDIL     WHEQ 'P'                                                           194632
     C                     EXSR ZBKDT                                                         194632
     C           PDDIL     WHEQ 'N'                                                           194632
     C           PDDIL     OREQ *BLANK                                                        194632
     C                     EXSR ZFWDT                                                         194632
     C           PDDIL     WHEQ 'M'                                                           194632
     C                     EXSR ZDATE2                                                        194632
     C           *IN98     IFEQ *OFF                                                          194632
     C                     MOVE ZDATE     MMYY    40P                                         194632
     C                     MOVELMMYY      MMNLCD  20P                                         194632
     C                     ELSE                                                               194632
     C                     MOVELZDATE     MMNLCD    P                                         194632
     C                     ENDIF                                                              194632
     C                     Z-ADDZDAYNO    @DAYNO  50                                          194632
     C                     EXSR ZFWDT                                                         194632
     C                     Z-ADDZDYNBR    ZDAYNO                                              194632
     C                     EXSR ZDATE2                                                        194632
     C           *IN98     IFEQ *OFF                                                          194632
     C                     MOVE ZDATE     MMYY      P                                         194632
     C                     MOVELMMYY      MMNWKD  20P                                         194632
     C                     ELSE                                                               194632
     C                     MOVELZDATE     MMNWKD    P                                         194632
     C                     ENDIF                                                              194632
     C           MMNLCD    IFNE MMNWKD                                                        194632
     C                     Z-ADD@DAYNO    ZDAYNO                                              194632
     C                     EXSR ZBKDT                                                         194632
     C                     ENDIF                                                              194632
     C                     ENDSL                                                              194632
     C                     ELSE                                                               194632
     C                     EXSR ZFREQB
     C                     Z-ADD0         ZNRDYS
     C                     EXSR ZFWDT
     C                     ENDIF
     C                     ENDIF
      *
      ** If next repay date greater than maturity date zeroise fields
      *
     C           MDAT      IFNE 0
     C           ZDYNBR    ANDGTMDAT
     C           RFRQ      OREQ ' '
     C                     Z-ADD0         RAMT
     C                     Z-ADD0         NRPD
     C                     Z-ADD0         RBDT
     C                     MOVE ' '       RFRQ
     C                     Z-ADD0         RDYN
     C                     BITOF'23'      CBLI
     C                     BITOF'3'       TLXI
     C                     ELSE
      *
     C                     Z-ADDZDYNBR    NRPD
     C                     Z-ADDZDAYNO    RBDT
     C                     ENDIF
      *
     C                     ELSE
      *
      ** Update Past Due Interest
      *
     C                     Z-ADDINTAR     WRK13
      *
     C           *IN61     IFEQ *ON
     C           *IN62     OREQ *ON
     C           WRK13     ADD  WTXAR     WRK13
     C                     ENDIF
      *
     C           SACTN     IFEQ 'I'
     C           PDIN      SUB  WRK13     PDIN
     C                     ELSE
     C           PDIN      ADD  WRK13     PDIN
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Update CLOAN file to unlink Loan to syndication and
      ** Consolidated confirmation
      *
     C***********LNKS      IFEQ 'Y'                                 123177153663
     C***********PMODE     IFNE 'B'                                 123177153663
     C***********P#TSEQ    ORLE 1                                   123177153663
     C***********          MOVE 'N'       LNKS                            153663
     C***********          ENDIF                                    123177153663
     C***********          ENDIF                                    123177153663
     C           BPCONR    IFEQ 'Y'
     C                     MOVE 'N'       CNCF
     C                     ELSE
     C                     MOVE *BLANK    CNCF
     C                     ENDIF
      *
      ** Update CLOAN
      ** Write after status of CLOAN record
      *
     C                     Z-ADDRUND      LCD
     C                     MOVE 'A'       CHTP
     C                     Z-ADDNATN      TNLU
     C                     UPDATCLOANCLF               50
      *
     C                     ENDIF
      *
     C           *IN50     IFEQ '1'
     C                     MOVE 'Y'       WERR
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      * SRMINI   - Move file fields in screen fields                  *
      * Called by: SRINT1                                             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRMINI    BEGSR
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           PMODE     OREQ 'F'                                       CAP063
     C                     MOVE *BLANKS   SCUST
     C***********          MOVE CNUML     SCUST                           122685
     C           PTYPL     IFEQ 64                                                            207629
     C           PTYPL     OREQ 65                                                            207629
     C           PTYPL     OREQ 68                                                            207629
     C           PTYPL     OREQ 71                                                            207629
      *If the loan is a Participation Purchased, & System Value                               207629
      * LoanCustOriginPurch = 'O', use Original Borrower:                                     207629
     C           PPCUST    IFEQ 'O'                                                           207629
     C                     MOVELOLNO      SCUST                                               207629
      * Else, use 'Purchased from' customer number.                                           207629
     C                     ELSE                                                               207629
     C                     MOVELCNUML     SCUST                                               207629
     C                     ENDIF                                                              207629
      * Else, loan is not a Part Purchased:                                                   207629
     C                     ELSE                                                               207629
     C                     MOVELCNUML     SCUST                           122685
     C                     ENDIF                                                              207629
     C                     MOVE PAST      SPASD
     C                     MOVE WTIN      SWTTP
     C                     MOVE LWOI      SWOFF
      *
     C                     MOVE XAVD      EDAT
     C                     MOVE XASQ      ESEQ
     C           EDAT      IFNE *ZERO
     C                     MOVE EDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SEVAL
     C                     MOVE ESEQ      SESEQ
     C                     ELSE
     C                     MOVE *BLANKS   SEVAL
     C                     MOVE *BLANKS   SESEQ
     C                     ENDIF
     C***********          MOVE SPI1      SSIN1                           121123
     C***********          MOVE SPI2      SSIN2                           121123
     C***********          MOVE SPI3      SSIN3                           121123
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      * SRMIN1   - Move file fields in screen fields (Amounts)        *
      * Called by: SRFRMT                                             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRMIN1    BEGSR
      *
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE PRAMR     ZFIELD
     C                     Z-ADDWCDP      ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SRPRI
      *
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE INTAR     ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SRINT
      *
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE PNAMR     ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SRPEN
      *
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE TAMTR     ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SRTOT
      *
     C                     ENDSR
      *
      *****************************************************************
      * SRVAL1   - Validation First detail screen input               *
      * Called by: SRDET1, SRBTCH                                     *
      * Calls    : SRAMTV, SRADDV                                     *
      *****************************************************************
     C           SRVAL1    BEGSR
      *
      ** Validate customer entered for insert only
      *
     C           SACTN     IFEQ 'I'                                                           CLE034
     C                     EXSR SRCUST
     C                     ENDIF                                                              CLE034
      *
     C           *INU7     IFEQ *ON
     C           *INU8     ANDEQ*ON
     C                     MOVE 'Y'       WERR
     C                     ENDIF
      *
      ***Validate*amounts*for*insert******************************        146683
      ***********                                                         146683
     C***********SACTN     IFEQ 'I'                                128147 146683
     C***********          EXSR SRAMTV                                    146683
      ***********                                                         146683
      ***********                                                         146683
      ***Cross*validate*amounts***********************************        146683
      ***********                                                         146683
     C***********          EXSR SRADDV                                    146683
     C***********          ENDIF                                   128147 146683
      ***********                                                  128147 146683
     C***********          MOVELW@DET1    WSDET                           146683
     C***********          MOVE W@DET2    WSDET  54                       146683
      *
      ** If Customer Lending Enchancements - Backvaluations
      ** feature is on CLE003
      *
     C           *IN87     IFEQ *ON
     C           MCRA      IFEQ 'Y'
     C***********RLDT      ANDNE0                                         155462
     C***********WDAYNV    IFLT RLDT                                      155462
     C           LMCD      ANDNE0                                         155462
     C           WDAYNV    IFLT LMCD                                      155462
     C                     MOVE *ON       *IN69
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0022' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** If CLE007 is installed, validate past due indicator              CLE007
      *                                                                   CLE007
     C           CLE007    IFEQ 'Y'                                       CLE007
     C           SPASD     IFNE 'Y'
     C           SPASD     ANDNE'N'
     C           SPASD     ANDNE*BLANK
     C                     MOVE 'Y'       WERR
     C                     MOVE '1'       *IN76
     C                     MOVE 'LEM0055' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C           SPASD     IFEQ 'Y'
     C           WREAC     ANDEQ*BLANK                                    CLE007
     C           SPSIG     IFNE '-'
     C           SISIG     ANDNE'-'
     C                     MOVE 'Y'       WERR
     C                     MOVE '1'       *IN76
     C                     MOVE 'LEM0054' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *                                                                   CLE007
      ** If a matured loan is being processed, negative past due          CLE007
      ** due on maturity date must be input                               CLE007
      *                                                                   CLE007
     C           WREAC     IFEQ 'Y'                                       CLE007
     C           SPASD     IFEQ 'Y'                                       CLE007
     C           SRPRI     IFNE *BLANKS                                   CLE007
     C                     MOVE '-'       SPSIG                           CLE007
     C                     ENDIF                                          CLE007
     C           SRINT     IFNE *BLANKS                                   CLE007
     C                     MOVE '-'       SISIG                           CLE007
     C                     ENDIF                                          CLE007
      *                                                                   CLE007
     C                     ELSE                                           CLE007
     C                     MOVE 'Y'       WERR                            CLE007
     C                     MOVE '1'       *IN76                           CLE007
     C                     MOVE 'LEM0029' ZAMSID                          CLE007
     C                     EXSR ZASNMS                                    CLE007
     C                     ENDIF                                          CLE007
     C                     ENDIF                                          CLE007
     C                     ENDIF                                          CLE007
      *                                                                   146683
      ** Validate amounts for insert                                      146683
      *                                                                   146683
     C           SACTN     IFEQ 'I'                                       146683
     C                     EXSR SRAMTV                                    146683
      *                                                                   146683
      *                                                                   146683
      ** Cross validate amounts                                           146683
      *                                                                   146683
     C                     EXSR SRADDV                                    146683
     C                     ENDIF                                          146683
      *                                                                   146683
     C                     MOVELW@DET1    WSDET                           146683
     C                     MOVE W@DET2    WSDET  54                       146683
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRCUST   - Subroutine to validate Cust. No. or shortname      *
      * Called by: SRVAL1                                             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRCUST    BEGSR
      *
     C**********           Z-ADD0         WCUST   60                                          CSD027
     C                     MOVE *BLANKS   WCUST   6                                           CSD027
      *
      ** Customer is mandatory
      *
     C           SCUST     IFEQ *BLANKS
     C                     MOVE *ON       *IN75
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0178' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C           WERR      IFNE 'Y'
      *
     C                     MOVEL*BLANKS   WKEYC
     C                     MOVELSCUST     WKEYC
     C                     CALL 'AOCUSTR0'
     C                     PARM '*BLANKS' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           WKEYC  10
     C                     PARM *BLANKS   KEYSTS  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C                     MOVE '0'       *IN50
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN50
     C           @RTCD     IFEQ '*NOSEL'
     C                     MOVE '1'       *IN75
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0178' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL*BLANKS   SCUST
     C                     ENDIF
     C                     ELSE
     C                     MOVEL*BLANKS   SCUST
     C                     MOVELBBCUST    SCUST
     C                     ENDIF
      *
      ** Chain to customer master failed
      *
     C           *IN50     IFEQ *ON
     C           WERR      ANDNE'Y'
     C                     MOVE *ON       *IN75
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0034' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** Customer must not be parent
      *
     C           *IN50     IFEQ *OFF
     C           WERR      ANDNE'Y'
     C           BBPAIN    COMP 'P'                      40
     C           *IN40     IFEQ *ON
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN75
     C                     MOVE 'LEM0036' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
      ** Valid cust. no. field
      *
     C           *IN75     IFEQ *OFF
     C**********           MOVE BBCUST    CNUM    60                                          CSD027
     C**********           Z-ADDCNUM      WCUST                                               CSD027
     C                     MOVE BBCUST    CNUM    6                                           CSD027
     C                     MOVE CNUM      WCUST                                               CSD027
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Cust no must equal cust on loan
      *
     C           *IN75     IFEQ *OFF
      *                                                                                       207629
     C           PTYPL     IFEQ 64                                                            207629
     C           PTYPL     OREQ 65                                                            207629
     C           PTYPL     OREQ 68                                                            207629
     C           PTYPL     OREQ 71                                                            207629
      *If the loan is a Participation Purchased, & System Value                               207629
      * LoanCustOriginPurch = 'O', use Original Borrower:                                     207629
     C           PPCUST    IFEQ 'O'                                                           207629
     C           WCUST     COMP OLNO                     40                                   207629
      * Else, use 'Purchased from' customer number.                                           207629
     C                     ELSE                                                               207629
     C           WCUST     COMP CNUML                    40                                   207629
     C                     ENDIF                                                              207629
      * Else, loan is not a Part Purchased:                                                   207629
     C                     ELSE                                                               207629
     C           WCUST     COMP CNUML                    40
     C                     ENDIF                                                              207629
      *                                                                                       207629
     C           *IN40     IFEQ *OFF
     C                     MOVE *ON       *IN75
     C                     MOVE 'Y'       WERR
     C                     MOVE 'LEM0040' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRAMTV   - Subroutine to validate amounts entered             *
      * Called by: SRVAL1                                             *
      * Calls    : SRAMTI                                             *
      *****************************************************************
     C           SRAMTV    BEGSR
      *
      ** Validate principal amount and ind
      *
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELSRPRI     ZFIELD
     C                     MOVE SPSIG     WNEGIV  1
     C                     EXSR SRAMTI
     C           *IN99     IFEQ *ON
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN77
     C                     MOVE 'LEM0191' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C           *IN43     IFEQ *ON
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN78
     C                     MOVE 'LEM0148' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                                       CLE028
      ** For flat rate personal loans, the principal that can be paid                         CLE028
      ** must not exceed the current principal less interest refunded                         CLE028
      ** less charges refunded less previous repayments                                       CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYPL     ANDEQ80                                                            CLE028
     C           WOPRN     ADD  WINRF     WEXPRN 130                                          CLE028
     C                     ADD  WCGRF     WEXPRN                                              CLE028
     C           WAMNT     IFGT WEXPRN                                                        CLE028
     C                     MOVE 'Y'       WERR                                                CLE028
     C                     MOVE *ON       *IN77                                               CLE028
     C                     MOVE 'LEM0401' ZAMSID                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     Z-ADDWAMNT     OPRAM
      *
      ** Validate interest amount and ind
      *
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELSRINT     ZFIELD
     C                     MOVE SISIG     WNEGIV
     C                     EXSR SRAMTI
     C           *IN99     IFEQ *ON
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN79
     C                     MOVE 'LEM0192' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C           *IN43     IFEQ *ON
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN29
     C                     MOVE 'LEM0149' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     Z-ADDWAMNT     OINTA
      *
      ** Validate penalty amount and ind
      *
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELSRPEN     ZFIELD
     C                     MOVE SRPIG     WNEGIV
     C                     EXSR SRAMTI
     C           *IN99     IFEQ *ON
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN81
     C                     MOVE 'LEM0193' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C           *IN43     IFEQ *ON
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN82
     C                     MOVE 'LEM0150' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     Z-ADDWAMNT     OPNAM
      *
     C                     MOVE *OFF      *IN50
      *
      ** Initialise this field for output
      *
     C                     Z-ADD0         OFECD   20
      *
      ** Validate total amount and ind
      *
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELSRTOT     ZFIELD
     C                     MOVE SRSIG     WNEGIV
     C                     EXSR SRAMTI
     C           *IN99     IFEQ *ON
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN83
     C                     MOVE 'LEM0194' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C           *IN43     IFEQ *ON
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN84
     C                     MOVE 'LEM0151' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     Z-ADDWAMNT     OTAMT
      *
      ** Validate Write-off ind
      *
     C           SWOFF     IFNE ' '
     C           SWOFF     ANDNE'Y'
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN85
     C                     MOVE 'LEM0212' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C           SWOFF     IFEQ 'Y'
     C           SPSIG     ANDNE' '
     C           SISIG     ANDNE' '
     C           SRPIG     ANDNE' '
     C           SRSIG     ANDNE' '
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN85
     C                     MOVE 'LEM0229' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C/COPY WNCPYSRC,LE2110C018
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRAMTI   - Validate amounts and indicator                     *
      * Called by: SRAMTV                                             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRAMTI    BEGSR
      *
     C                     MOVEA'0000'    *IN,40
      *
     C**********           Z-ADDWCDP      ZADEC                                               CLE036
     C********** 13        SUB  WCDP      ZADIG                                               CLE036
      ** Check the number of decimal places in the repayment currency:                        CLE036
     C                     Z-ADD1         Y                                                   CLE036
     C           SSCCY     LOKUPCYA,Y                    12                                   CLE036
     C           *IN12     IFEQ '1'                                                           CLE036
     C                     Z-ADDNDP,Y     ZADEC            Repay Ccy D.P.                     CLE036
     C           13        SUB  NDP,Y     ZADIG                                               CLE036
     C                     MOVE *OFF      *IN12                                               CLE036
     C                     ENDIF                                                              CLE036
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    WAMNT  130
      *
     C           WNEGIV    COMP ' '                      40
     C           WNEGIV    COMP '-'                      42
      *
     C           WAMNT     COMP 0                        41
     C           *IN41     IFEQ *ON
     C           *IN42     ANDEQ*ON
     C                     SETOF                     4042
     C                     ENDIF
      *
     C           *IN42     IFEQ *ON
     C                     Z-SUBWAMNT     WAMNT
     C                     ENDIF
      *
     C           *IN40     IFEQ *OFF
     C           *IN42     ANDEQ*OFF
     C           WNEGIV    ANDNE'+'
     C                     MOVE *ON       *IN43
     C                     MOVE 'Y'       WERR
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRADDV   - Subroutine to do Cross Validation on fields        *
      * Called by: SRVAL1                                             *
      * Calls    : SD2400                                             *
      *****************************************************************
     C           SRADDV    BEGSR
      *
      ** Manual repayments of risk loans are allowed                      148845
      *                                                                   148845
      ***Prevent*user*from*inputing*principal*repayment*with*expected*    148845
      ***date*for*risk*loans******************************************    148845
      ***********                                                         148845
     C***********PTYPL     IFEQ 70                                        148845
     C***********OPRAM     ANDNE0                                         148845
     C***********WDAYNE    ANDNE0                                         148845
     C***********          MOVE 'Y'       WERR                            148845
     C***********          MOVE *ON       *IN77                           148845
     C***********          MOVE 'LEM0219' ZAMSID                          148845
     C***********          EXSR ZASNMS                                    148845
     C***********          ENDIF                                          148845
      *                                                                   CLE005
      ** Do the same thing for CLE005's new risk processing types         CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           OPRAM     ANDNE0                                         CLE005
     C           WDAYNE    ANDNE0                                         CLE005
     C***********PTYPL     IFEQ 71                                 CLE005 148845
     C***********PTYPL     OREQ 72                                 CLE005 148845
     C           PTYPL     IFEQ 72                                        148845
     C           W72TP     ANDEQ'Y'                                       148845
     C                     MOVE 'Y'       WERR                            CLE005
     C                     MOVE *ON       *IN77                           CLE005
     C                     MOVE 'LEM0219' ZAMSID                          CLE005
     C                     EXSR ZASNMS                                    CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *
     C           OPRAM     COMP 0                      4142
     C           *IN41     IFEQ *ON
     C           SWOFF     ANDEQ'Y'
     C                     MOVE 'Y'       WERR
     C                     MOVEA'11'      *IN,77
     C                     MOVE 'LEM0229' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** *IN41 if on means the value entered for repayment of principal
      ** was negative. This is an error in certain circumstances:
      *
     C           *IN41     IFEQ '1'
      *
      ** If AMTP if equal to PD the manual repayment is matched to a
      ** PAST DUE repayment.  If the amount entered for payment is GT
      ** the outstanding amt (ie. less negative) this is NOT an ERROR.
      ** This would be equivalent to a partial settlement - a PD record
      ** for the difference will be generated.  SETOF *IN41
      *
     C********** AMTP      IFEQ 'PD'                                                          183958
     C********** OPRAM     ANDGEPRAM                                                          183958
     C           AMTPA     IFEQ 'PD'                                                          183958
     C           OPRAM     ANDGEWEPRIN                                                        183958
     C                     MOVE *OFF      *IN41
     C                     ENDIF
     C                     ELSE
      *
      ** *IN41 OFF means that the amount entered was not less than zero
      ** In this case if the amt entered is MORE than the outstanding,
      ** this is an error.
      *
     C********** AMTP      IFEQ 'PD'                                                          183958
     C********** OPRAM     ANDGTPRAM                                                          183958
     C**********           MOVE *OFF      *IN41                                               183958
     C           AMTPA     IFEQ 'PD'                                                          183958
     C           OPRAM     ANDGTWEPRIN                                                        183958
     C                     MOVE '1'       *IN41                                               183958
     C                     ENDIF
     C                     ENDIF
      *
     C********** AMTP      IFEQ 'PD'                                                          183958
     C           AMTPA     IFEQ 'PD'                                                          183958
     C           *IN41     ANDEQ*ON
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN77
     C                     MOVE 'LEM0215' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C           OINTA     COMP 0                        41
      *
     C           PTYPL     LOKUPTABDIS                   40
      *
     C           *IN40     IFEQ *ON
     C           *IN42     ANDEQ*OFF
     C***********AMTP      ANDNE'PD'                                      178782
     C           AMTPA     ANDNE'PD'                                      178782
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN77
     C***********          MOVE 'LEM0221' ZAMSID                          178782
     C                     MOVE 'LEM0102' ZAMSID                          178782
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C           *IN40     IFEQ *ON
     C           *IN41     ANDEQ*OFF
     C***********AMTP      ANDNE'PD'                                      178782
     C           AMTPA     ANDNE'PD'                                                          183958
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN79
     C                     MOVE 'LEM0221' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** Cannot pay interest if being capitalised
      *
     C           INTCL     COMP 'Y'                      40
     C           *IN40     IFEQ *ON
     C           *IN41     ANDEQ*OFF
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN79
     C                     MOVE 'LEM0228' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** Validate interest amount against O/S Int.
      *
     C           WOINR     COMP 0                      41
     C           OINTA     COMP WOINR                4042
     C/COPY WNCPYSRC,LE2110C019
     C           *IN41     IFEQ *ON
     C           *IN42     ANDEQ*ON
     C           *IN41     OREQ *OFF
     C           *IN40     ANDEQ*ON
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN79
     C                     MOVE 'LEM0204' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** Validate interest amount if gross W/H Tax type loan
      *
     C           *IN61     IFEQ *ON
     C           WTXRT     DIV  100       WK1107 117
     C           WOINR     MULT WK1107    WK1300 130H
     C           WOINR     SUB  WK1300    WMAXIN 130
     C           WMAXIN    COMP 0                      41
     C           OINTA     COMP WMAXIN               4042
     C/COPY WNCPYSRC,LE2110C020
     C                     ENDIF
      *
     C           *IN41     IFEQ *ON
     C           *IN42     ANDEQ*ON
     C           *IN41     OREQ *OFF
     C           *IN40     ANDEQ*ON
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN79
     C                     MOVE 'LEM0209' ZAMSID
     C                     ENDIF
      *
     C           OINTA     COMP 0                    4240
      *
     C           *IN40     IFEQ *ON
     C           SWOFF     ANDEQ'Y'
     C           *IN41     ANDEQ*OFF
     C           *IN41     OREQ *ON
     C           *IN42     ANDEQ*ON
     C           SWOFF     ANDEQ'Y'
     C                     MOVE 'Y'       WERR
     C                     MOVEA'11'      *IN,79
     C                     MOVE 'LEM0230' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     SETOF                     50
     C           *IN62     IFEQ *ON
     C           WEINT     ADD  WEWTAX    WRK13  130
     C                     ELSE
     C                     Z-ADDWEINT     WRK13
     C                     ENDIF
      *
     C           *IN42     IFEQ *ON
     C           OINTA     COMP WRK13                50
     C                     ENDIF
      *
     C           *IN40     IFEQ *ON
     C           OINTA     COMP WRK13                  50
     C                     ENDIF
      *
     C           *IN50     IFEQ *ON
     C********** AMTP      ANDEQ'PD'                                                          183958
     C           AMTPA     ANDEQ'PD'                                                          183958
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN79
     C                     MOVE 'LEM0216' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** Validate total amount
      *
     C           *IN77     IFEQ *ON
     C           *IN79     OREQ *ON
     C           *IN83     OREQ *ON
     C                     GOTO ENADDV
     C                     ENDIF
      *
     C           OPRAM     ADD  OINTA     WRK13
     C           WRK13     COMP OTAMT                4040
     C           *IN40     IFEQ *ON
     C                     MOVE 'Y'       WERR
     C                     MOVE *ON       *IN83
     C                     MOVE 'LEM0205' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C           OPRAM     COMP 0                        40
     C           *IN40     IFEQ *ON
     C           OINTA     COMP 0                        40
     C                     ENDIF
     C           *IN40     IFEQ *ON
     C                     MOVE 'Y'       WERR
     C                     SETON                     7779
     C                     MOVE 'LEM0227' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** Validate amounts for warning errors and at least one
      ** amount input
      *
     C           WWERR     IFEQ 'Y'
     C                     MOVE W@DET2    W@DET  54
     C                     MOVELW@DET1    W@DET
     C           W@DET     IFEQ WSDET
     C           WERR      ANDNE'Y'
     C                     MOVE 'Y'       WOK
     C                     MOVE *BLANK    WWERR
     C                     ENDIF
     C                     ENDIF
      *
     C           WOK       IFNE 'Y'
     C           SRPRI     IFNE *BLANKS
     C           SRINT     ORNE *BLANKS
      *
      ** Validate principal against expected
      *
     C           OPRAM     COMP WOPRN                40
     C/COPY WNCPYSRC,LE2110C021
     C           *IN40     IFEQ '1'
     C                     MOVE 'Y'       WWERR
     C                     MOVE 'LEM0050' ZAMSID
     C                     EXSR ZASNMS
     C           WRE       IFEQ 'Y'
     C                     MOVE 'LEM0051' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ELSE
     C                     MOVE *BLANK    WWERR
     C                     ENDIF
      *
     C           OPRAM     COMP WEPRIN                   40
      *
     C           AMTP      IFEQ 'RE'
     C           REPTL     ANDNE3
     C           *IN40     ANDEQ*OFF
     C           *IN44     OREQ *ON
     C           REPTL     ANDNE3
     C           *IN40     ANDEQ*OFF
     C                     MOVE 'Y'       WWERR
     C                     MOVE 'LEM0005' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *                                                                                       CLE028
      ** For flat rate personal loans:                                                        CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYPL     ANDEQ80                                                            CLE028
      *                                                                                       CLE028
      ** For early payoffs, error if the full expected principal is                           CLE028
      ** not paid, w/c is computed as: current principal less previous                        CLE028
      ** repayments less interest refunded less charges refunded                              CLE028
      *                                                                                       CLE028
     C           SESEQ     IFEQ *BLANKS                                                       CLE028
     C           OPRAM     ANDNEWEXPRN                                                        CLE028
     C                     MOVE 'Y'       WERR                                                CLE028
     C                     MOVE *ON       *IN77                                               CLE028
     C                     MOVE 'LEM0402' ZAMSID                                              CLE028
     C                     MOVE *BLANKS   ZFIELD                                              CLE028
     C                     MOVE WEXPRN    ZFIELD                                              CLE028
     C                     Z-ADDWCDP      ZADEC                                               CLE028
     C                     EXSR ZEDIT                                                         CLE028
     C                     MOVELZFIELD    ZAMSDA                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** For early payoffs, error if the full expected interest is                            CLE028
      ** not paid, w/c is computed as: outstanding interest to date                           CLE028
      ** less previous repayments                                                             CLE028
      *                                                                                       CLE028
     C           ADIF      IFNE 'Y'                                                           CLE028
     C           SESEQ     ANDEQ*BLANKS                                                       CLE028
     C           OINTA     ANDNEWOINR                                                         CLE028
     C                     MOVE 'Y'       WERR                                                CLE028
     C                     MOVE *ON       *IN79                                               CLE028
     C                     MOVE 'LEM0403' ZAMSID                                              CLE028
     C                     MOVE *BLANKS   ZFIELD                                              CLE028
     C                     MOVE WOINR     ZFIELD                                              CLE028
     C                     Z-ADDWCDP      ZADEC                                               CLE028
     C                     EXSR ZEDIT                                                         CLE028
     C                     MOVELZFIELD    ZAMSDA                                              CLE028
     C                     EXSR ZASNMS                                                        CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
      *
     C           WRK13     COMP WEXTOT                   40
      *
     C           AMTP      IFEQ 'RE'
     C           REPTL     ANDNE1
     C           *IN40     ANDEQ*OFF
     C           *IN44     OREQ *ON
     C           REPTL     ANDNE1
     C           *IN40     ANDEQ*OFF
     C                     MOVE 'Y'       WWERR
     C                     MOVE 'LEM0006' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                   161072
      ** For loans with repayment type 2 and expected sequence number     161072
      ** of LN, check expected date against the principal repayment       161072
      ** date if the principal amount is non-zero                         161072
      *                                                                   161072
     C           *IN44     IFEQ '1'                                       161072
     C           REPTL     ANDEQ2                                         161072
      *                                                                   161072
     C           OPRAM     IFNE 0                                         161072
     C           WDAYNE    ANDNENRPD                                      161072
     C                     MOVE 'Y'       WERR                            161072
     C                     MOVE '1'       *IN70                           161072
     C                     MOVE 'LEM0207' ZAMSID                          161072
     C                     EXSR ZASNMS                                    161072
     C                     ENDIF                                          161072
      *                                                                   161072
      ** Check expected date against the interest payment date if         161072
      ** the interest amount is non-zero                                  161072
      *                                                                   161072
     C           OINTA     IFNE 0                                         161072
     C           WDAYNE    ANDNENIDT                                      161072
     C                     MOVE *BLANK    WWERR                                               CLE036
     C                     MOVE 'Y'       WERR                            161072
     C                     MOVE '1'       *IN70                           161072
     C                     MOVE 'LEM0311' ZAMSID                          161072
     C                     EXSR ZASNMS                                    161072
     C                     ENDIF                                          161072
      *                                                                   161072
     C                     ENDIF                                          161072
      *
      ** Calculate W/Tax for 'PD' match
      ** not 'PD' or no witholding tax
      *
     C                     Z-ADD0         OWTXA
      *
     C           *IN60     IFEQ '1'
     C********** AMTP      ORNE 'PD'                                                          183958
     C********** AMTPA     ORNE 'PD'                                                   183958 177972
     C           *IN47     OREQ '1'                                                           177972
     C                     GOTO ENADDV
     C                     ENDIF
      *
      ** Net or Gross Witholding Tax
      *
     C           *IN62     IFNE *ON
     C           100       SUB  WTRT      WRK117 117
     C           WTRT      DIV  WRK117    WRK117
     C           OINTA     MULT WRK117    OWTXA     H
     C                     ELSE
      *
      ** Receivable witholding tax
      *
     C           WTRT      DIV  100       WRK117
     C           OINTA     MULT WRK117    OWTXA     H
     C           OINTA     SUB  OWTXA     OINTA
     C                     ENDIF
      *
     C           ENADDV    ENDSR
      *
      *****************************************************************
      * SRWIND  -  Window Processing                                  *
      * Called by: SRDET1                                             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRWIND    BEGSR
      *
     C           BGWDPR    IFEQ 'Y'
      *
     C/COPY WNCPYSRC,LE2110MOV1
      *
     C                     MOVE SACTN     UACTCD
     C           SACTN     IFEQ 'X'
     C                     MOVE 'E'       UACTCD
     C                     ENDIF
     C           SACTN     IFEQ 'R'
     C                     MOVE 'D'       UACTCD
     C                     ENDIF
      *
     C                     CALL 'WN0010'
     C                     PARM ##PGM     UPGM   10        Program
     C                     PARM *BLANK    UFKEY   2        Function Key
     C                     PARM           UACTCD  1        Action
     C                     PARM           DATA             Trans Data
     C                     PARM *BLANK    W0RTN   7        Return Code
     C***********          PARM           SPARE            Spare Field    119892
     C                     PARM           SPARE 256        Spare Field    119892
      *
     C                     SELEC
     C           W0RTN     WHEQ 'Y2U9999'
     C                     MOVE *BLANK    WFMT
      *
     C           W0RTN     WHEQ 'USR0563'
     C                     MOVE 'Y'       WERR
     C                     MOVEL'USR0563' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'D1'      WFMT
      *
     C           W0RTN     WHEQ 'Y2U0004'
     C                     MOVE 'Y'       WERR
     C                     MOVEL'USR0567' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'D1'      WFMT
      *
     C           W0RTN     WHEQ 'USR0790'
     C                     MOVE 'D1'      WFMT
     C                     ENDSL
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRDET2   - Second Detail Screen - Extended settlement info    *
      * Called by: SRDET1, SRBTCH                                     *
      * Calls    : SRINTI, SRMFSR                                     *
      *****************************************************************
     C           SRDET2    BEGSR
      *
     C           WFMT      DOWEQ'D2'
      *
      ** Setup details for settlement screen if first time pass through
      ** extended settlement screen
      *
     C           FPASS     IFEQ 'Y'
      *
     C           PMODE     IFNE 'B'                                       123699
     C                     CLEARSETLIB
     C                     ENDIF                                          123699
     C           SACTN     IFEQ 'X'
     C                     MOVE 'E'       PMACTC
     C                     ELSE
     C                     MOVE SACTN     PMACTC
     C                     ENDIF
     C           SACTN     IFEQ 'R'
     C                     MOVE 'D'       PMACTC
     C                     ENDIF
      *
     C***                  MOVE 'MMLD'    PMCPGM                          135152
     C                     MOVE 'LEND'    PMCPGM                          135152
     C                     Z-ADD0         PMDBSE
     C                     MOVE *BLANKS   PMERCD
     C                     MOVE 'Y'       PMFRST
     C                     Z-ADDRUND      PMRUND
     C                     Z-ADDBVLP      PMBVPD
      *
     C                     MOVE 'RE'      PMTTYP
     C                     MOVE SCUST     PMCSNM
     C                     MOVE CCYL      PMRCCY
     C                     MOVE CCYL      PMPCCY
     C                     Z-ADDWDAYNV    PMDTRC
     C                     Z-ADDWDAYNV    PMDTPY
     C                     MOVE WBRCDA    PMBRCA
      *
      ** Determine if pay & receive settlement screen will be
      ** protected
      *
      ** Reverse/enquire
      *
     C           SACTN     IFEQ 'R'
     C           SACTN     OREQ 'E'
     C           SACTN     OREQ 'X'
     C                     MOVE 'Y'       PMPRCV
     C                     MOVE 'Y'       PMPPAY
      *
      ** Insert/amend
      *
     C                     ELSE
     C           PTYPL     IFEQ 66
     C           PTYPL     OREQ 69                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYPL     OREQ 72                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C                     MOVE 'Y'       PMPRCV
     C                     MOVE 'N'       PMPPAY
     C                     ELSE
     C                     MOVE 'N'       PMPRCV
     C                     MOVE 'Y'       PMPPAY
     C                     ENDIF
     C                     ENDIF
      *
      ** Move file or data struct. values to SD2400 parameters to be
      ** displayed on settlement screen for amend or reverse
      ** Initialise SD2400 parameters for insert.
      *
     C           SACTN     IFEQ 'I'
     C           PMODE     ANDNE'P'
     C           PMODE     ANDNE'B'
     C                     EXSR SRINTI
     C                     ELSE
     C                     EXSR SRMFSR
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     MOVE *BLANK    PMFFND
     C                     MOVE *BLANK    PMCMDP
      *
      ** Validation only flag
      *
     C           PMFRST    IFEQ 'N'
     C                     MOVE 'Y'       PMVALO
     C                     ELSE
     C                     MOVE 'N'       PMVALO
     C                     ENDIF
      *
      ** Settlement detail valid flag
      *
     C           SACTN     IFEQ 'R'
     C           SACTN     OREQ 'E'
     C           SACTN     OREQ 'X'
     C                     MOVE 'Y'       PMSDTV
     C                     ELSE
     C                     MOVE 'N'       PMSDTV
     C                     ENDIF
      *                                                                   CAP063
      ** Setup fields from invalid file, if in Repair mode                CAP063
      *                                                                   CAP063
     C           PMODE     IFEQ 'F'                                       CAP063
     C                     MOVE SFRSTM    PMRSTM                          CAP063
     C                     MOVELSFRONS    PMRONS    P                     CAP063
     C                     MOVELSFROBN    PAROBN    P                     CAP063
     C                     MOVELSFROCN    PAROCN    P                     CAP063
     C                     MOVELSFRIBN    PARIBN    P                     CAP063
     C                     MOVELSFRIBA    PMRIBA    P                     CAP063
     C                     MOVE SFPSTM    PMPSTM                          CAP063
     C                     MOVELSFPONS    PMPONS    P                     CAP063
     C                     MOVELSFPOBN    PAPOBN    P                     CAP063
     C                     MOVELSFPOCN    PAPOCN    P                     CAP063
     C                     MOVELSFPIBN    PAPIBN    P                     CAP063
     C                     MOVELSFPIBA    PMPIBA    P                     CAP063
     C                     MOVELSFRCRN    PARCRN    P                     CAP063
     C                     MOVELSFRCRA    PMRCRA    P                     CAP063
     C                     MOVELSFRVNO    PARVNO    P                     CAP063
     C                     MOVELSFAWBN    PAAWBN    P                     CAP063
     C                     MOVELSFAWBA    PMAWBA    P                     CAP063
     C                     MOVELSFBENN    PABENN    P                     CAP063
     C                     MOVELSFBENA    PMBENA    P                     CAP063
     C                     MOVELSFDTP1    PMDTP1    P                     CAP063
     C                     MOVELSFDTP2    PMDTP2    P                     CAP063
     C                     MOVELSFDTP3    PMDTP3    P                     CAP063
     C                     MOVELSFDTP4    PMDTP4    P                     CAP063
     C                     MOVELSFDCHG    PMDCHG    P                     CAP063
     C                     MOVELSFBTB1    PMBTB1    P                     CAP063
     C                     MOVELSFBTB2    PMBTB2    P                     CAP063
     C                     MOVELSFBTB3    PMBTB3    P                     CAP063
     C                     MOVELSFBTB4    PMBTB4    P                     CAP063
     C                     MOVELSFBTB5    PMBTB5    P                     CAP063
     C                     MOVELSFBTB6    PMBTB6    P                     CAP063
     C                     MOVELSFCVMR    PMCVMR    P                     CAP063
      *                                                                   CAP063
      ** Set Protect receipt instructions and Protect Payment             CAP063
      ** instructions flags to be 'N'.                                    CAP063
      *                                                                   CAP063
     C                     MOVE 'N'       PMPRCV                          CAP063
     C                     MOVE 'N'       PMPPAY                          CAP063
     C                     ENDIF                                          CAP063
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
      *                                                                                       CLE034
      ** If Loan Amendment sequence is blanks or zeros                                        CLE034
      *                                                                                       CLE034
     C           SSEQN     IFEQ *BLANKS                                                       CLE034
     C           SSEQN     OREQ *ZEROS                                                        CLE034
     C                     MOVEL'Y'       WNOKY   1                                           CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE WDAYNV    PVDAT                                               CLE034
      *                                                                                       CLE034
      *                                                                                       CLE034
      ** Call the new program, LE2230 with the ffg parameters                                 CLE034
      *                                                                                       CLE034
     C                     CALL 'LE2230'                                                      CLE034
     C                     PARM 'LAMR'    PTYPE   4                                           CLE034
     C                     PARM SLOAN     PLOAN   6                                           CLE034
     C                     PARM           PVDAT                                               CLE034
     C                     PARM SSEQN     PSEQN   3                                           CLE034
     C                     PARM *BLANKS   PCSTF   6                                           CLE034
     C                     PARM *BLANKS   PFTYF   5                                           CLE034
     C                     PARM *BLANKS   PFSEQ   2                                           CLE034
     C                     PARM           SETLIB                                              CLE034
     C                     PARM           SETLIZ                                              CLE034
     C                     PARM           PMODE   1                                           CLE034
     C                     PARM           PTMST  26                                           CLE034
     C                     PARM           PERR    1                                           CLE034
     C                     PARM           PWRNG   1                                           CLE034
     C                     PARM           PNOST   1                                           CLE034
     C                     PARM           PSAMD   1                                           CLE034
     C                     PARM           PNODT   1                                           CLE034
     C                     PARM           PRSTC  60                                           CLE034
     C                     PARM           PRSTL  60                                           CLE034
     C                     PARM           PPSTC  60                                           CLE034
     C                     PARM           PPSTL  60                                           CLE034
     C                     PARM           PCRFK                                               CLE034
     C                     PARM           WORED   5                                           CLE038
     C                     PARM           WALAM  130                                          CLE038
      *                                                                                       CLE034
     C           PMODE     IFEQ 'B'                                                           CLE034
     C                     MOVEL'12'      PMCMDP                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE *OFF      *IN26                                               CLE034
     C           SACTN     IFEQ 'R'                                                           CLE034
     C           PMODE     IFEQ 'I'                                                           CLE034
     C           PMODE     OREQ 'R'                                                           CLE034
     C           PMODE     OREQ 'F'                                                           CLE034
     C                     MOVE *ON       *IN26                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           PMODE     OREQ 'F'                                       CAP063
     C                     MOVE *BLANKS   PMTERM
     C                     MOVE *ON       *IN26                           158802
     C/COPY WNCPYSRC,LE2110C006
     C                     CALL 'SD2400'
     C                     PARM           @RTCD
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           SLOAN
     C/COPY WNCPYSRC,LE2110C007
     C                     ELSE
      *
      ** Set up fields on call to SD2410 for settlement validation
      ** Process settlement branch only if method 05 and multibranching
      *
     C           BGMBIN    IFEQ 'Y'
     C           PMRSTM    IFNE 05
     C           PMPRCV    IFEQ 'N'
     C           PMACTC    ORNE 'A'
     C                     MOVE *BLANKS   PMROBR
     C                     ENDIF
     C                     ENDIF
      *
     C           PMPSTM    IFNE 05
     C           PMPPAY    IFEQ 'N'
     C           PMACTC    ORNE 'A'
     C                     MOVE *BLANKS   PMPOBR
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2110C008
      *
     C                     CALL 'SD2410'
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C/COPY WNCPYSRC,LE2110C009
     C                     MOVEL'12'      PMCMDP
     C                     ENDIF
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *
      ** Terminate program if database error returned
      *
     C           PMDBSE    IFNE *ZERO
     C                     SETON                     U7U8LR
     C                     MOVE *BLANKS   WFMT
     C                     MOVELPMDBFL    DBFILE           *************
     C                     MOVE PMDBSE    DBASE            * DBERROR X *
     C                     MOVELPMDBKY    DBKEY            *************
     C                     MOVELPMDPGM    DBPGM
     C                     OUT  LDA
     C                     LEAVE
     C                     ENDIF
      *
     C           PMCMDP    IFEQ '03'
     C                     MOVE '1'       *INLR
     C                     MOVE *BLANKS   WFMT
     C           PMODE     IFNE 'B'                                                           227710
     C           PMODE     ANDNE'P'                                                           227710
     C                     ROLBK                                                              227710
     C                     ENDIF                                                              227710
     C                     LEAVE
     C                     ELSE
     C           PMCMDP    IFEQ '12'
     C/COPY WNCPYSRC,LE2110C030
      *
      ** Settlement detail valid or F12 is pressed w/out validation
      ** (i.e. enter not pressed in the settlement screen)
      *
     C           PMSDTV    IFEQ 'Y'
     C           PMSDTV    OREQ 'N'
     C           PMERCD    ANDEQ*BLANKS
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           PMSDTV    ANDEQ'N'                                                           CLE034
     C           PMERCD    ANDEQ*BLANKS                                                       CLE034
     C                     MOVE 'N'       SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     EXSR SRPRST
     C                     MOVE 'Y'       @SDTV   1
     C                     ENDIF
      *
      ** Settlement detail in error
      *
     C           PMERCD    IFNE *BLANKS
     C                     MOVE 'N'       @SDTV
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
     C                     MOVE 'N'       PMFRST
     C                     MOVE 'N'       FPASS
      *
      ** Settlement detail in error
      *
     C           FPASS     IFEQ 'N'
     C           @SDTV     ANDEQ'N'
     C                     MOVE 'Y'       WERR
     C           PMODE     IFEQ 'I'                                       123801
     C           PMODE     OREQ 'R'                                       123801
     C           PMODE     OREQ 'F'                                       CAP063
     C                     MOVE 'LEM1000' ZAMSID
     C                     ELSE                                           123801
     C           3         SUBSTPMERCD:1  WSERR   3                       123801
     C                     MOVEL'ESM0'    ZAMSID                          123801
     C                     MOVE WSERR     ZAMSID                          123801
     C                     MOVEL'DRSMM   'ZAMSGF                          123801
     C                     ENDIF                                          123801
     C                     EXSR ZASNMS
     C                     ENDIF
      *
      ** For reverse, authorise and enquire
      *
     C           PMCMDP    IFEQ '12'
      *
     C           PMODE     IFEQ 'B'
     C           PMODE     OREQ 'P'
     C                     MOVE '  '      WFMT
     C                     ENDIF
      *
     C           SACTN     IFEQ 'R'
     C           SACTN     OREQ 'E'
     C           SACTN     OREQ 'X'
     C                     MOVE 'D1'      WFMT
     C                     ENDIF
      *
      ** For insert and amend
      *
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C           @SDTV     IFNE 'Y'
B03  C           PMSDTV    OREQ 'N'                                       170120
     C                     MOVE 'D1'      WFMT
     C                     MOVE ' '       @SDTV                           170120
     C                     ELSE
      *
     C           SACTN     IFEQ 'I'
     C                     MOVE 'WR'      WFMT
     C                     ELSE
     C                     MOVE 'UP'      WFMT
     C                     ENDIF
      *
     C                     LEAVE
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDDO
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRPRST   - Set up details received from SD2400/SD2410         *
      * Called by: SRDET2                                             *
      * Calls    : None                                               *
      *                                                               *
      *****************************************************************
     C           SRPRST    BEGSR
      *
      ** Move settlement details received from SD2400 to variables
      ** originally used by LE2110 (i.e. prior to LE SWIFT Feature)
      ** to be use in the update of files
      *
     C           PTYPL     IFEQ 66
     C           PTYPL     OREQ 69                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYPL     OREQ 72                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELPMPSCY    WSCCY   3                       CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C                     MOVE PMPEXI    PEXIK                                               CLE031
     C                     MOVE *BLANKS   WSCCY                                               CLE031
     C                     MOVE *BLANKS   PSCRF                                               CLE031
     C                     MOVE PMPSCY    PSCYK                                               CLE031
      *                                                                                       CLE031
     C                     Z-ADD0         WSEXR0 130                                          CLE031
     C                     Z-ADD0         WSEXR8 138                                          CLE031
     C                     Z-ADD8         PNDEC                                               CLE031
     C                     Z-ADD5         PNDIG                                               CLE031
     C                     MOVE PMPEXR    PSCRF                                               CLE031
      *                                                                                       CLE031
     C           PMPEXR    IFNE *BLANKS                                                       CLE031
     C                     CALL 'ZALIGN'                                                      CLE031
     C                     PARM *BLANK    PRTCD                                               CLE031
     C                     PARM           PSCRF  16                                           CLE031
     C                     PARM           PNDEC   10                                          CLE031
     C                     PARM           PNDIG   20                                          CLE031
     C                     PARM *BLANKS   PRVAL  16                                           CLE031
      *                                                                                       CLE031
     C           PRTCD     IFEQ *BLANK                                                        CLE031
     C                     MOVE PRVAL     PMPEXR                                              CLE031
     C                     ELSE                                                               CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'ZALIGN  'DBFILE                                              CLE031
     C                     Z-ADD30        DBASE                                               CLE031
     C                     MOVELPSCRF     DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVELPMPSTM    WTYPE   2
     C**********           MOVELPMPONS    WIOSAC 12                                           257477
     C                     MOVELPMPONS    WIOSAC 18                                           257477
     C                     MOVELPMPOBR    WIOBBR  3
     C                     MOVELPMPOBR    WOOSBR  3
     C                     MOVELPAPIBN    WITSEN 10
     C                     ELSE
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELPMRSCY    WSCCY   3                       CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C                     MOVE PMREXI    REXIK                                               CLE031
     C                     MOVE *BLANKS   WSCCY                                               CLE031
     C                     MOVE *BLANKS   PSCRF                                               CLE031
     C                     MOVE PMPSCY    PSCYK                                               CLE031
     C                     Z-ADD8         PNDEC                                               CLE031
     C                     Z-ADD5         PNDIG                                               CLE031
      *                                                                                       CLE031
     C           PMREXR    IFNE *BLANKS                                                       CLE031
     C                     Z-ADD0         WSEXR0 130                                          CLE031
     C                     Z-ADD0         WSEXR8 138                                          CLE031
     C                     MOVE PMREXR    PSCRF                                               CLE031
     C                     CALL 'ZALIGN'                                                      CLE031
     C                     PARM *BLANK    PRTCD                                               CLE031
     C                     PARM           PSCRF  16                                           CLE031
     C                     PARM           PNDEC   10                                          CLE031
     C                     PARM           PNDIG   20                                          CLE031
     C                     PARM *BLANKS   PRVAL  16                                           CLE031
      *                                                                                       CLE031
     C           PRTCD     IFEQ *BLANK                                                        CLE031
     C                     MOVE PRVAL     PMREXR                                              CLE031
     C                     ELSE                                                               CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'ZALIGN  'DBFILE                                              CLE031
     C                     Z-ADD30        DBASE                                               CLE031
     C                     MOVELPSCRF     DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVELPMRSTM    WTYPE
     C                     MOVELPMRONS    WIOSAC
     C                     MOVELPMROBR    WIOBBR
     C                     MOVELPMROBR    WOOSBR
     C                     MOVELPARIBN    WITSEN
     C                     END
      *
      ** Save old settlement for shadow posting
      *
     C           *LIKE     DEFN SCCYK     WSCCYK                                              219608
     C           *LIKE     DEFN PSCYK     WPSCY                                               219608
     C           *LIKE     DEFN REXRK     WREXR                                               219608
     C           *LIKE     DEFN REXIK     WREXI                                               219608
     C           *LIKE     DEFN PEXRK     WPEXR                                               219608
     C           *LIKE     DEFN PEXIK     WPEXI                                               219608
     C           *LIKE     DEFN STALK     WSTAL                                               219608
     C           *LIKE     DEFN OSBR      WOSBRK                                              219608
     C                     MOVE SETP      WTYP
     C                     MOVE OSAC      WOURS
     C                     MOVE TSEN      WTHRS
     C                     MOVE FACO      WFACO
     C                     MOVELW#OSBR    WOSBRK                                              219608
     C**********           MOVE WSETT     OLDSET 34                                           259991
     C                     MOVE WSETT     OLDSET 40                                           259991
     C           CLE031    IFEQ 'Y'                                                           219608
     C                     MOVELSCCYK     WSCCYK                                              219608
     C                     MOVELPSCYK     WPSCY                                               219608
     C                     Z-ADDREXRK     WREXR                                               219608
     C                     MOVELREXIK     WREXI                                               219608
     C                     Z-ADDPEXRK     WPEXR                                               219608
     C                     MOVELPEXIK     WPEXI                                               219608
     C                     ENDIF                                                              219608
     C           CLE034    IFEQ 'Y'                                                           219608
     C                     MOVELSTALK     WSTAL                                               219608
     C                     ENDIF                                                              219608
      *
     C                     MOVE *BLANKS   WSETT
     C                     MOVE WTYPE     WTYP
     C                     MOVELWIOSAC    WOURS
     C                     MOVELWITSEN    WTHRS
     C                     MOVELPABENN    WFACO  10
      *                                                                                       205964
      ** if amend, check if there is change in settlement details.                            205964
      *                                                                                       205964
     C           SACTN     IFEQ 'A'                                                           205964
     C           WSETT     ANDNEOLDSET                                                        205964
     C           SACTN     OREQ 'A'                                                           219608
     C           CLE034    ANDEQ'Y'                                                           219608
     C           WSTAL     ANDNESSTAL                                                         219608
     C                     MOVE '1'       *IN10                                               205964
     C                     ELSE                                                               205964
     C                     MOVE '0'       *IN10                                               205964
     C                     ENDIF                                                              205964
      *
      ** Move to numeric field to initialise file fields to zero in
      ** case input is blank
      *
     C**********           MOVE PAROBN    WOROBN  60                                          CSD027
     C**********           MOVE PAROCN    WOROCN  60                                          CSD027
     C**********           MOVE PAPOBN    WOPOBN  60                                          CSD027
     C**********           MOVE PAPOCN    WOPOCN  60                                          CSD027
     C                     MOVE PAROBN    WOROBN  6                                           CSD027
     C                     MOVE PAROCN    WOROCN  6                                           CSD027
     C                     MOVE PAPOBN    WOPOBN  6                                           CSD027
     C                     MOVE PAPOCN    WOPOCN  6                                           CSD027
      *
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      * SRSHRT   - Customer shortname                                 *
      * Called by: SRMFSR, SRINTI                                     *
      * Calls    : None                                               *
      *                                                               *
      *****************************************************************
     C           SRSHRT    BEGSR
      *
      ** Counterparty pay instructions
      *
     C                     MOVE *BLANKS   PMRIBN
     C                     MOVELPARIBN    PMRIBN
      *
      ** Ordering bank no.
      *
     C                     MOVE *BLANKS   PMROBN
     C                     MOVELPAROBN    PMROBN
      *
      ** Ordering customer no.
      *
     C                     MOVE *BLANKS   PMROCN
     C                     MOVELPAROCN    PMROCN
      *
      ** Intermediary bank no.
      *
     C                     MOVE *BLANKS   PMPIBN
     C                     MOVELPAPIBN    PMPIBN
      *
      ** Ordering bank no.
      *
     C                     MOVE *BLANKS   PMPOBN
     C                     MOVELPAPOBN    PMPOBN
      *
      ** Ordering customer no.
      *
     C                     MOVE *BLANKS   PMPOCN
     C                     MOVELPAPOCN    PMPOCN
      *
      ** Receiver correspondent no.
      *
     C                     MOVE *BLANKS   PMRCRN
     C                     MOVELPARCRN    PMRCRN
      *
      ** Receiver number
      *
     C                     MOVE *BLANKS   PMRVNO
     C                     MOVELPARVNO    PMRVNO
      *
      ** Counterparty receive instructions.
      *
     C                     MOVE *BLANKS   PMAWBN
     C                     MOVELPAAWBN    PMAWBN
      *
      ** For account of instructions.
      *
     C                     MOVE *BLANKS   PMBENN
     C                     MOVELPABENN    PMBENN
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRMFSR   - Set up details for settlements screen - Not Insert *
      * Called by: SRDET2                                             *
      * Calls    : SRSHRT                                             *
      *                                                               *
      *****************************************************************
     C           SRMFSR    BEGSR
      *
     C           PMODE     IFNE 'B'                                       123699
     C                     Z-ADDRSTM      PMRSTM
     C                     MOVE RONS      PMRONS
     C                     MOVE RIBN      PARIBN
     C                     MOVE RIBA      PMRIBA
      *
     C********** ROBN      IFNE 0                                                             CSD027
     C           ROBN      IFNE *BLANKS                                                       CSD027
     C                     MOVE ROBN      PAROBN
     C                     ELSE
     C                     MOVE *BLANKS   PAROBN
     C                     ENDIF
      *
     C********** ROCN      IFNE 0                                                             CSD027
     C           ROCN      IFNE *BLANKS                                                       CSD027
     C                     MOVE ROCN      PAROCN
     C                     ELSE
     C                     MOVE *BLANKS   PAROCN
     C                     ENDIF
      *
     C                     Z-ADDPSTM      PMPSTM
     C                     MOVE PONS      PMPONS
     C                     MOVE PIBN      PAPIBN
     C                     MOVE PIBA      PMPIBA
      *
     C********** POBN      IFNE 0                                                             CSD027
     C           POBN      IFNE *BLANKS                                                       CSD027
     C                     MOVE POBN      PAPOBN
     C                     ELSE
     C                     MOVE *BLANKS   PAPOBN
     C                     ENDIF
      *
     C********** POCN      IFNE 0                                                             CSD027
     C           POCN      IFNE *BLANKS                                                       CSD027
     C                     MOVE POCN      PAPOCN
     C                     ELSE
     C                     MOVE *BLANKS   PAPOCN
     C                     ENDIF
      *
     C                     MOVE CVMR      PMCVMR
     C                     MOVE RCRN      PARCRN
     C                     MOVE RCRA      PMRCRA
     C                     MOVE RVNO      PARVNO
     C                     MOVE AWBN      PAAWBN
     C                     MOVE AWBA      PMAWBA
     C                     MOVE BENN      PABENN
     C                     MOVE BENA      PMBENA
     C                     MOVE DTP1      PMDTP1
     C                     MOVE DTP2      PMDTP2
     C                     MOVE DTP3      PMDTP3
     C                     MOVE DTP4      PMDTP4
     C                     MOVE DCHG      PMDCHG
     C                     MOVE BTB1      PMBTB1
     C                     MOVE BTB2      PMBTB2
     C                     MOVE BTB3      PMBTB3
     C                     MOVE BTB4      PMBTB4
     C                     MOVE BTB5      PMBTB5
     C                     MOVE BTB6      PMBTB6
      *
     C           PTYPL     IFEQ 66
     C           PTYPL     OREQ 69                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYPL     OREQ 72                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C***********          MOVE OSBR      PMPOBR                          123699
     C                     MOVE W#OSBR    PMPOBR                          123699
     C                     MOVE *BLANKS   PMROBR
     C                     ELSE
     C***********          MOVE OSBR      PMROBR                          123699
     C                     MOVE W#OSBR    PMROBR                          123699
     C                     MOVE *BLANKS   PMPOBR
     C                     ENDIF
      *                                                                   123699
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELSCCYK     PMPSCY                          CEU004
     C                     MOVELSCCYK     PMRSCY                          CEU004
     C                     MOVELICCY      PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELPSCYK     PMPSCY                                              CLE031
     C                     MOVELSCCYK     PMRSCY                                              CLE031
      *                                                                                       CLE031
     C           REXRK     IFEQ 0                                                             CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE REXRK     PMREXC 14                                           CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE PMREXC    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMREXR                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PEXRK     IFEQ 0                                                             CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE PEXRK     PMPEXC 14                                           CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE PMPEXC    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMPEXR                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVE REXIK     PMREXI                                              CLE031
     C                     MOVE PEXIK     PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                          123699
      *
     C                     EXSR SRSHRT
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      * SRINTI   - Set up details for settlements screen - Insert     *
      * Called by: SRDET2                                             *
      * Calls    :                                                    *
      *                                                               *
      *****************************************************************
     C           SRINTI    BEGSR
      *
      ***For*insert*default*settlement*screen*to*that*of*the*loan*        142078
      ** For insert default settlement screen to that of the Std.         142078
      ** Settlement Instruction first, then to that of the loan           142078
      ** action has to be an amend upon entry to SD2400 for the
      ** default fields to be displayed
      *
     C                     MOVE 'A'       PMACTC
      *                                                                   142078
      **  Call to access object if extended settlement instructions       142078
      *   exist.                                                          142078
     C                     MOVE 'N'       EXDTA   1                       142078
      *                                                                   143071
      ** Use Original borrower if loan is Parts Purch                     143071
      *                                                                   143071
     C           PTYPL     IFEQ 64                                        143071
     C           PTYPL     OREQ 65                                        143071
     C           PTYPL     OREQ 68                                        143071
     C           PTYPL     OREQ 71                                        143071
     C                     MOVELOLNO      @CUST                           143071
     C                     ELSE                                           143071
     C                     MOVELCNUML     @CUST                           142078
     C                     ENDIF                                          143071
      *                                                                   143071
     C                     MOVELCCYL      @CYCD                           142078
     C                     MOVEL'LE'      @TRTY                           142078
      *                                                                   142078
     C                     CALL 'AOEXSTR0'                                142078
     C                     PARM *BLANKS   @RTCD   7                       142078
     C                     PARM '*KEY   ' @OPTN   7                       142078
     C                     PARM           @CYCD   3                       142078
     C                     PARM           @CUST   6                       142078
     C                     PARM           @TRTY   2                       142078
     C           SDEXST    PARM SDEXST    DSSDY                           142078
      *                                                                   142078
     C           @RTCD     IFNE *BLANKS                                   142078
      *                                                                   142078
     C                     MOVE 'AT'      @TRTY                           142078
     C                     CALL 'AOEXSTR0'                                142078
     C                     PARM *BLANKS   @RTCD                           142078
     C                     PARM '*KEY   ' @OPTN                           142078
     C                     PARM           @CYCD   3                       142078
     C                     PARM           @CUST   6                       142078
     C                     PARM           @TRTY   2                       142078
     C           SDEXST    PARM SDEXST    DSSDY                           142078
      *                                                                   142078
     C                     ENDIF                                          142078
      *                                                                   142078
     C           @RTCD     IFEQ *BLANKS                                   142078
     C                     MOVE 'Y'       EXDTA                           142078
     C                     ENDIF                                          142078
      *                                                                   142078
      *
      ** For participation sold (i.e.PTYP 66)
      *
     C           PTYPL     IFEQ 66
     C           PTYPL     OREQ 69                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYPL     OREQ 72                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE *BLANKS   PMRSCY                          CEU004
     C                     MOVELSCCYK     PMPSCY                          CEU004
     C                     MOVELICCY      PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   PMRSCY                                              CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     MOVE *BLANKS   PMREXI                                              CLE031
     C                     MOVE *BLANKS   PMPSCY                                              CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     MOVE *BLANKS   PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     Z-ADD0         PMRSTM
     C                     MOVE *BLANKS   PMRONS
     C                     MOVE *BLANKS   PARIBN
     C                     MOVE *BLANKS   PMRIBA
     C                     MOVE *BLANKS   PAROBN
     C                     MOVE *BLANKS   PAROCN
     C                     MOVE *BLANKS   PMROBR
      *
      ** Don't default Settlement instructions if Allocations are used:                       CLE034
     C           CLE034    IFNE 'Y'                                                           CLE034
     C           SSTAL     ORNE 'Y'                                                           CLE034
      *                                                                                       CLE034
     C           EXDTA     IFEQ 'Y'                                       142078
     C                     MOVELBYPSTY    PMPSTM                          142078
     C                     MOVELBYPONO    PMPONS                          142078
     C                     MOVELBYPIBN    PAPIBN                          142078
     C                     MOVELBYPIBA    PMPIBA                          142078
     C                     MOVELBYPOBN    PAPOBN                          142078
     C                     MOVELBYPOCS    PAPOCN                          142078
     C                     MOVELBYCVMR    PMCVMR                          142078
     C                     MOVELBYRCNO    PARCRN                          142078
     C                     MOVELBYRCAL    PMRCRA                          142078
     C                     MOVELBYRCNB    PARVNO                          142078
     C                     MOVELBYACBN    PAAWBN                          142078
     C                     MOVELBYACBL    PMAWBA                          142078
     C                     MOVELBYBYNB    PABENN                          142078
     C                     MOVELBYBACL    PMBENA                          142078
     C                     MOVELBYDPY1    PMDTP1                          142078
     C                     MOVELBYDPY2    PMDTP2                          142078
     C                     MOVELBYDPY3    PMDTP3                          142078
     C                     MOVELBYDPY4    PMDTP4                          142078
     C                     MOVELBYDECG    PMDCHG                          142078
     C                     MOVELBYBBI1    PMBTB1                          142078
     C                     MOVELBYBBI2    PMBTB2                          142078
     C                     MOVELBYBBI3    PMBTB3                          142078
     C                     MOVELBYBBI4    PMBTB4                          142078
     C                     MOVELBYBBI5    PMBTB5                          142078
     C                     MOVELBYBBI6    PMBTB6                          142078
     C                     MOVELBYOPBR    PMPOBR                          142078
     C                     ELSE                                           142078
      *                                                                   142078
     C                     Z-ADDPSTML     PMPSTM
     C                     MOVE PONSL     PMPONS
     C                     MOVE PIBNL     PAPIBN
     C                     MOVE PIBAL     PMPIBA
      *
     C********** POBNL     IFNE 0                                                             CSD027
     C           POBNL     IFNE *BLANKS                                                       CSD027
     C                     MOVE POBNL     PAPOBN
     C                     ELSE
     C                     MOVE *BLANKS   PAPOBN
     C                     ENDIF
      *
     C********** POCNL     IFNE 0                                                             CSD027
     C           POCNL     IFNE *BLANKS                                                       CSD027
     C                     MOVE POCNL     PAPOCN
     C                     ELSE
     C                     MOVE *BLANKS   PAPOCN
     C                     ENDIF
      *
     C                     MOVE CVMRL     PMCVMR
     C                     MOVE RCRNL     PARCRN
     C                     MOVE RCRAL     PMRCRA
     C                     MOVE RVNOL     PARVNO
     C                     MOVE AWBNL     PAAWBN
     C                     MOVE AWBAL     PMAWBA
     C                     MOVE BENNL     PABENN
     C                     MOVE BENAL     PMBENA
     C                     MOVE DTP1L     PMDTP1
     C                     MOVE DTP2L     PMDTP2
     C                     MOVE DTP3L     PMDTP3
     C                     MOVE DTP4L     PMDTP4
     C                     MOVE DCHGL     PMDCHG
     C                     MOVE BTB1L     PMBTB1
     C                     MOVE BTB2L     PMBTB2
     C                     MOVE BTB3L     PMBTB3
     C                     MOVE BTB4L     PMBTB4
     C                     MOVE BTB5L     PMBTB5
     C                     MOVE BTB6L     PMBTB6
     C                     MOVE OSDB      PMPOBR
      *                                                                   142078
     C                     ENDIF                                          142078
     C                     ENDIF                                                              CLE034
      *
      ** else for loans other than participation sold.
      *
     C                     ELSE
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE *BLANKS   PMPSCY                          CEU004
     C                     MOVE *BLANKS   PMIC72                          CEU004
     C                     MOVELSCCYK     PMRSCY                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   PMPSCY                                              CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     MOVE *BLANKS   PMPEXI                                              CLE031
     C                     MOVE *BLANKS   PMRSCY                                              CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     MOVE *BLANKS   PMREXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
      ** Don't default Settlement instructions if Allocations are used:                       CLE034
     C           CLE034    IFNE 'Y'                                                           CLE034
     C           SSTAL     ORNE 'Y'                                                           CLE034
      *                                                                   142078
     C           EXDTA     IFEQ 'Y'                                       142078
     C                     MOVELBYRSTY    PMRSTM                          142078
     C                     MOVE BYRONO    PMRONS                          142078
     C                     MOVE BYRIBN    PARIBN                          142078
     C                     MOVE BYRIBL    PMRIBA                          142078
     C                     MOVE BYORBR    PMROBR                          142078
     C                     MOVE BYROBN    PAROBN                          142078
     C                     MOVE BYROCS    PAROCN                          142078
      *                                                                   142078
     C                     ELSE                                           142078
      *                                                                   142078
     C                     Z-ADDRSTML     PMRSTM
     C                     MOVE RONSL     PMRONS
     C                     MOVE RIBNL     PARIBN
     C                     MOVE RIBAL     PMRIBA
     C                     MOVE OMDB      PMROBR
      *
     C********** ROBNL     IFNE 0                                                             CSD027
     C           ROBNL     IFNE *BLANKS                                                       CSD027
     C                     MOVE ROBNL     PAROBN
     C                     ELSE
     C                     MOVE *BLANKS   PAROBN
     C                     ENDIF
      *
     C********** ROCNL     IFNE 0                                                             CSD027
     C           ROCNL     IFNE *BLANKS                                                       CSD027
     C                     MOVE ROCNL     PAROCN
     C                     ELSE
     C                     MOVE *BLANKS   PAROCN
     C                     ENDIF
      *                                                                   142078
     C                     ENDIF                                          142078
     C                     ENDIF                                                              CLE034
      *
     C                     Z-ADD0         PMPSTM
     C                     MOVE *BLANKS   PMPONS
     C                     MOVE *BLANKS   PAPIBN
     C                     MOVE *BLANKS   PMPIBA
     C                     MOVE *BLANKS   PAPOBN
     C                     MOVE *BLANKS   PAPOCN
     C                     MOVE *BLANKS   PMCVMR
     C                     MOVE *BLANKS   PARCRN
     C                     MOVE *BLANKS   PMRCRA
     C                     MOVE *BLANKS   PARVNO
     C                     MOVE *BLANKS   PAAWBN
     C                     MOVE *BLANKS   PMAWBA
     C                     MOVE *BLANKS   PABENN
     C                     MOVE *BLANKS   PMBENA
     C                     MOVE *BLANKS   PMDTP1
     C                     MOVE *BLANKS   PMDTP2
     C                     MOVE *BLANKS   PMDTP3
     C                     MOVE *BLANKS   PMDTP4
     C                     MOVE *BLANKS   PMDCHG
     C                     MOVE *BLANKS   PMBTB1
     C                     MOVE *BLANKS   PMBTB2
     C                     MOVE *BLANKS   PMBTB3
     C                     MOVE *BLANKS   PMBTB4
     C                     MOVE *BLANKS   PMBTB5
     C                     MOVE *BLANKS   PMBTB6
     C                     MOVE *BLANKS   PMPOBR
     C                     ENDIF
      *
     C                     EXSR SRSHRT
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRPLAY  -  Process Play Mode                                  *
      * Called by: Main Routine                                       *
      * Calls    : SRBTCH                                             *
      *                                                               *
      *****************************************************************
      *
     C           SRPLAY    BEGSR
      *
      ** Read test harness
      *
     C                     READ LE2110PD                 66
      *
      ** Perform batch processing until end of Test harness file
      *
     C           *IN66     DOWEQ*OFF
     C                     EXSR SRBTCH
      *
     C           WERR      IFEQ ' '
     C                     MOVE L2110S    L2110F
     C                     MOVELWMSEV     MSVR
     C                     MOVELZAMSID    MSID
     C                     MOVELZAMSTX    MSTX
     C                     UPDATLE2110D0
     C                     ENDIF
      *
     C                     READ LE2110PD                 66
     C                     ENDDO
      *                                                                   CDE001
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           CDE001    IFEQ 'Y'                                       CDE001
     C           WERR      ANDEQ' '                                       CDE001
     C                     MOVELSLOAN     T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C                     PARM           T#TREF 20                       CDE001
     C                     PARM 'LOAN'    T#TCAT  4                       CDE001
     C                     PARM *BLANKS   RSRVID 10                       CDE005
     C                     ENDIF                                          CDE001
      *
      ** If no errors, commit all changes to update files
      *
     C           WERR      IFEQ ' '
     C                     COMIT
     C                     CLOSELE2110PD
     C                     MOVE *ON       *INLR
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRBTCH   - Batch processing                                   *
      * Called by: Main Processing, SRPLAY                            *
      * Calls    : SRSTR1, SRSTR2, SRSTR3, SRBSET, SRINTL, SRCAUT,    *
      *            SRXAUT, SRFRMT, SRVAL1, SRWRIT, SRUPDT, SRBHED     *
      *****************************************************************
     C           SRBTCH    BEGSR
      *
     C                     EXSR SRSTR1
     C                     EXSR SRSTR2
     C                     EXSR SRSTR3
      *                                                                   CAP063
     C                     MOVE PITACT    SLSEL                           CAP063
      *                                                                   CAP063
      ** If action code is 'Amend' for Batch transaction, compare         CAP063
      ** Non-Amendable fields with value from file. If different          CAP063
      ** replace with value from file & flag as error.                    CAP063
     C           PITACT    IFEQ 'A'                                       CAP063
     C           PIRPLC    ANDEQ'B'                                       CAP063
     C           CAP063    ANDEQ'Y'                                       CAP063
      *                                                                   CAP063
      ** Loan must exist in file                                          CAP063
     C                     MOVE PILOAN    WLNRF                           CAP063
      *                                                                   CAP063
     C                     MOVE PIVDAT    WPITDS                          CAP063
     C                     MOVELWPIDD     WFLD4   4                       CAP063
     C                     MOVE WPIMM     WFLD4                           CAP063
     C                     MOVELWFLD4     WFLD6   6                       CAP063
     C                     MOVE WPIYY     WFLD2   2                       CAP063
     C                     MOVE WFLD2     WFLD6                           CAP063
     C                     MOVELWFLD6     ZDATE                           CAP063
     C                     EXSR ZDATE1                                    CAP063
     C                     Z-ADDZDAYNO    WVALD                           CAP063
      *                                                                   CAP063
     C                     MOVE PIMRSQ    SLASN                           CAP063
     C           KLMKEY    CHAINLOAMS               N50                   CAP063
     C           *IN50     IFEQ *ON                                       CAP063
     C                     MOVE 'Y'       WERR                            CAP063
     C                     MOVEL'LEM0176' ZAMSID                          CAP063
     C                     EXSR ZASNMS                                    CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
      ** Move file fields to screen fields                                CAP063
     C                     MOVELCNUM      SCUST                           CAP063
     C                     MOVELPAST      SPASD                           CAP063
      *                                                                   CAP063
     C                     MOVE XAVD      EDAT                            CAP063
     C                     MOVE XASQ      ESEQ                            CAP063
     C           EDAT      IFNE *ZERO                                     CAP063
     C                     MOVE EDAT      ZDAYNO                          CAP063
     C                     EXSR ZDATE2                                    CAP063
     C                     MOVE ZDATE     SEVAL                           CAP063
     C                     MOVE ESEQ      SESEQ                           CAP063
     C                     ELSE                                           CAP063
     C                     MOVE *BLANKS   SEVAL                           CAP063
     C                     MOVE *BLANKS   SESEQ                           CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
     C                     MOVE LWOI      SWOFF                           CAP063
      *                                                                   CAP063
     C                     MOVE AMT       SAMT                            CAP063
     C                     MOVE FRAMT     FSAMT                                               CLE036
      *                                                                                       CLE036
      ** If repayment in facility ccy, use Fac. Ccy amounts from file:                        CLE036
     C           FREPAY    IFEQ 'Y'                                                           CLE036
     C           SSCCY     ANDEQFCCYL                                                         CLE036
     C                     EXSR SRMIN4                                                        CLE036
     C                     ELSE                                                               CLE036
     C                     EXSR SRMIN1                                    CAP063
     C                     ENDIF                                                              CLE036
      *                                                                   CAP063
      ** Save Non-Amendable screen fields to work fields to be            CAP063
      ** used later for compare.                                          CAP063
     C                     EXSR SRSCWK                                    CAP063
      *                                                                   CAP063
      ** Clear screen fields                                              CAP063
     C                     EXSR SRSTR1                                    CAP063
     C                     EXSR SRSTR2                                    CAP063
     C                     ENDIF                                          CAP063
      *
      ** Move fields from input parameter in DSPF fields
      *
     C                     EXSR SRBSET
      *                                                                   CAP063
      ** Compare values of Incoming fields with those of saved values     CAP063
     C           PITACT    IFEQ 'A'                                       CAP063
     C           PIRPLC    ANDEQ'B'                                       CAP063
     C           CAP063    ANDEQ'Y'                                       CAP063
     C                     EXSR SRCOMP                                    CAP063
     C                     ENDIF                                          CAP063
      *
      ** Validate initial screen
      *
     C                     EXSR SRINTL
      *
     C           WERR      IFNE 'Y'
     C                     EXSR SRCAUT
     C                     ENDIF
      *
     C           WERR      IFNE 'Y'
     C           SACTN     ANDEQ'X'
     C                     EXSR SRXAUT
     C                     ENDIF
      *
     C           WERR      IFNE 'Y'
     C                     EXSR SRFRMT
     C                     ENDIF
      *
     C           WERR      IFNE 'Y'
     C                     EXSR SRVAL1
     C                     ENDIF
      *
     C           WERR      IFNE 'Y'
      *
     C           PMODE     IFEQ 'P'
     C                     MOVE L2110S    L2110F
     C                     ENDIF
      *
     C                     MOVE 'D2'      WFMT
     C                     MOVE 'Y'       FPASS
     C                     EXSR SRDET2
     C                     ENDIF
      *
      ** Perform file updates if no errors in validation
      *
     C           WERR      IFNE 'Y'
     C           SACTN     IFEQ 'I'
     C                     EXSR SRWRIT
     C                     ELSE
     C                     EXSR SRUPDT
     C                     ENDIF
     C                     ENDIF
      *                                                                   143802
      ** Peform Reduce Part Sold amount on Master Loan subroutine         143802
      *                                                                   143802
     C                     EXSR SRUPPS                                    143802
      *                                                                   CDE001
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           CDE001    IFEQ 'Y'                                       CDE001
     C           WERR      ANDNE'Y'                                       CDE001
     C                     MOVELSLOAN     T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C                     PARM           T#TREF 20                       CDE001
     C                     PARM 'LOAN'    T#TCAT  4                       CDE001
     C                     PARM *BLANKS   RSRVID 10                       CDE005
     C                     ENDIF                                          CDE001
      *
      ** Commit changes if Batch mode
      *
     C           WERR      IFNE 'Y'
     C***********PMODE     ANDEQ'B'                                       120002
     C***********PMODE     ANDNE'B'                                120002 123533
     C           PMODE     IFNE 'B'                                       123533
     C                     COMIT
     C                     ENDIF                                          123533
     C           SACTN     IFEQ 'I'
     C                     MOVE SLASN1    POMRSQ
     C                     ENDIF
     C                     ENDIF
     C                     MOVE *BLANKS   WFMT
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************   CAP063
      * SRSCWK  -  Save screen fields to work fields                  *   CAP063
      * Called by: SRBTCH - Batch processing                          *   CAP063
      *****************************************************************   CAP063
     C           SRSCWK    BEGSR                                          CAP063
      *                                                                   CAP063
     C                     MOVE SCUST     ISCUST                          CAP063
     C                     MOVE SPASD     ISPASD                          CAP063
     C                     MOVE SEVAL     ISEVAL                          CAP063
     C                     MOVE SESEQ     ISESEQ                          CAP063
     C                     MOVE SRPRI     ISRPRI                          CAP063
     C                     MOVE SRINT     ISRINT                          CAP063
     C                     MOVE SRPEN     ISRPEN                          CAP063
     C                     MOVE SRTOT     ISRTOT                          CAP063
     C                     MOVE SWOFF     ISWOFF                          CAP063
     C                     MOVE SRCCY     ISRCCY                                              CLE036
      *                                                                   CAP063
     C                     ENDSR                                          CAP063
      /EJECT                                                              CAP063
      *****************************************************************   CAP063
      * SRCOMP  -  Compare values of Incoming fields with those of    *   CAP063
      *            saved values. If they are different replace with   *   CAP063
      *            value of file and flag as error.                   *   CAP063
      * Called by: SRBTCH - Batch processing                          *   CAP063
      *****************************************************************   CAP063
     C           SRCOMP    BEGSR                                          CAP063
      *                                                                   CAP063
      ** Set protect indicators and error Flag to 'N'                     CAP063
     C                     MOVE 'N'       WERR                            CAP063
      *                                                                   CAP063
      ** Compare Customer                                                 CAP063
     C           SCUST     IFNE ISCUST                                    CAP063
     C                     MOVE ISCUST    SCUST                           CAP063
     C                     MOVE 'Y'       WERR                            CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
      ** Compare Past due Y/N                                             CAP063
     C           SPASD     IFNE ISPASD                                    CAP063
     C                     MOVE ISPASD    SPASD                           CAP063
     C                     MOVE 'Y'       WERR                            CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
      ** Compare Expected Date                                            CAP063
     C           SEVAL     IFNE ISEVAL                                    CAP063
     C                     MOVE ISEVAL    SEVAL                           CAP063
     C                     MOVE 'Y'       WERR                            CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
      ** Compare Expected Sequence                                        CAP063
     C           SESEQ     IFNE ISESEQ                                    CAP063
     C                     MOVE ISESEQ    SESEQ                           CAP063
     C                     MOVE 'Y'       WERR                            CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
      ** Compare Principal                                                CAP063
     C           SRPRI     IFNE ISRPRI                                    CAP063
     C                     MOVE ISRPRI    SRPRI                           CAP063
     C                     MOVE 'Y'       WERR                            CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
      ** Compare Interest                                                 CAP063
     C           SRINT     IFNE ISRINT                                    CAP063
     C                     MOVE ISRINT    SRINT                           CAP063
     C                     MOVE 'Y'       WERR                            CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
      ** Compare Penalty                                                  CAP063
     C           SRPEN     IFNE ISRPEN                                    CAP063
     C                     MOVE ISRPEN    SRPEN                           CAP063
     C                     MOVE 'Y'       WERR                            CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
      ** Compare Total                                                    CAP063
     C           SRTOT     IFNE ISRTOT                                    CAP063
     C                     MOVE ISRTOT    SRTOT                           CAP063
     C                     MOVE 'Y'       WERR                            CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
      ** Compare Write-off                                                CAP063
     C           SWOFF     IFNE ISWOFF                                    CAP063
     C                     MOVE ISWOFF    SWOFF                           CAP063
     C                     MOVE 'Y'       WERR                            CAP063
     C                     ENDIF                                          CAP063
      *                                                                                       CLE036
      ** Compare Repayment Currency                                                           CLE036
     C           SRCCY     IFNE ISRCCY                                                        CLE036
     C                     MOVE ISRCCY    SRCCY                                               CLE036
     C                     MOVE 'Y'       WERR                                                CLE036
     C                     ENDIF                                                              CLE036
      *                                                                   CAP063
      ** If Error set-up error message & write details to Invalid file    CAP063
     C           WERR      IFEQ 'Y'                                       CAP063
     C                     MOVEL'LEA1043' ZAMSID                          CAP063
     C                     EXSR ZASNMS                                    CAP063
     C                     ENDIF                                          CAP063
      *                                                                   CAP063
     C                     ENDSR                                          CAP063
      /EJECT                                                              CAP063
      *****************************************************************
      * SRBSET  -  Format screen fields for Batch/Play                *
      * Called by: SRBTCH                                             *
      * Calls    : None                                               *
      *                                                               *
      *****************************************************************
      *
     C           SRBSET    BEGSR
      *
      ** Play mode: move Test Harness fields to screen fields
      *
     C           PMODE     IFEQ 'P'
      *
      ** Save Test harness record to DS
      *
     C                     MOVE L2110F    L2110S
      *
      ** Initial screen details
      *
     C                     MOVE LNRF      SLOAN
     C                     MOVE ACTN      SACTN
     C                     Z-ADDVDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SVALD
     C           EDAT      IFNE *ZERO
     C                     Z-ADDEDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SEVAL
     C                     MOVE ESEQ      SESEQ
     C                     ELSE
     C                     MOVE *BLANKS   SEVAL
     C                     MOVE *BLANKS   SESEQ
     C                     ENDIF
      *
      *
     C           ACTN      IFEQ 'I'
     C                     MOVE *BLANKS   SSEQN
      *                                                                                       CLE036
     C           FREPAY    IFEQ 'Y'                                                           CLE036
     C                     MOVE PICCY     SRCCY                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     ELSE
     C                     MOVE LASN      SSEQN
     C                     ENDIF
      *
      ** Detail screen fields
      *
     C           PTYPL     IFEQ 64                                                            207629
     C           PTYPL     OREQ 65                                                            207629
     C           PTYPL     OREQ 68                                                            207629
     C           PTYPL     OREQ 71                                                            207629
      *If the loan is a Participation Purchased, & System Value                               207629
      * LoanCustOriginPurch = 'O', use Original Borrower:                                     207629
     C           PPCUST    IFEQ 'O'                                                           207629
     C                     MOVELOLNO      SCUST                                               207629
      * Else, use 'Purchased from' customer number.                                           207629
     C                     ELSE                                                               207629
     C                     MOVELCNUM      SCUST                                               207629
     C                     ENDIF                                                              207629
      * Else, loan is not a Part Purchased:                                                   207629
     C                     ELSE                                                               207629
     C                     MOVELCNUM      SCUST
     C                     ENDIF                                                              207629
     C                     MOVELPAST      SPASD
     C                     MOVELSPRM      SRPRI
     C                     MOVELSPRS      SPSIG
     C                     MOVELSINT      SRINT
     C                     MOVELSINS      SISIG
     C                     MOVELSPNM      SRPEN
     C                     MOVELSPNS      SRPIG
     C                     MOVELSTAM      SRTOT
     C                     MOVELSTAS      SRSIG
     C                     MOVE LWOI      SWOFF
     C***********          MOVE SPI1      SSIN1                           121123
     C***********          MOVE SPI2      SSIN2                           121123
     C***********          MOVE SPI3      SSIN3                           121123
      *
     C                     ELSE
      *                                                                   123699
     C                     CLEARSETLIB                                    123699
      *
      ** Batch mode: move formatted message to screen fields
      *
     C                     MOVE PILOAN    SLOAN
     C                     MOVE PITACT    SACTN
     C                     MOVELPICSNO    SCUST
     C                     MOVELPIPAST    SPASD
     C                     MOVELPIWOFF    SWOFF
      *                                                                                       CLE036
     C           FREPAY    IFEQ 'Y'                                                           CLE036
     C                     MOVE PICCY     SRCCY                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
      *
      ** Value date
      *
     C                     MOVE PIVDAT    WPITDS
     C                     MOVELWPIDD     WFLD4   4
     C                     MOVE WPIMM     WFLD4
     C                     MOVELWFLD4     WFLD6   6
     C                     MOVE WPIYY     WFLD2   2
     C                     MOVE WFLD2     WFLD6
     C                     MOVELWFLD6     SVALD
      *
      ** Expected Value date
      *
     C                     MOVE PIXDAT    WPITDS
     C                     MOVELWPIDD     WFLD4   4
     C                     MOVE WPIMM     WFLD4
     C                     MOVELWFLD4     WFLD6   6
     C                     MOVE WPIYY     WFLD2   2
     C                     MOVE WFLD2     WFLD6
     C                     MOVELWFLD6     SEVAL
     C                     MOVE PIXSEQ    SESEQ
      *
      ** Sequence
      *
     C           PITACT    IFEQ 'I'
     C                     MOVE *BLANKS   SSEQN
     C                     ELSE
     C                     MOVE PIMRSQ    SSEQN
     C                     ENDIF
      *
      ** Amounts and signs
      *
     C                     MOVE PIPAMT    SRPRI
     C                     MOVE PIPSGN    SPSIG
     C                     MOVE PIIAMT    SRINT
     C                     MOVE PIISGN    SISIG
     C                     MOVE PITAMT    SRTOT
     C                     MOVE PITSGN    SRSIG
     C                     MOVE PIPEAM    SRPEN
     C                     MOVE PIPESN    SRPIG
      *
      ** Extended settlements
      *
     C***********          MOVELPIPSTM    PSTM                            123699
     C***********          MOVELPIPONS    PONS                            123699
     C***********          MOVELPIPREC    RVNO                            123699
     C***********          MOVELPICVMR    CVMR                            123699
     C***********          MOVELPIPOCN    POCN                            123699
     C***********          MOVELPIPOBN    POBN                            123699
     C***********          MOVELPIRCRN    RCRN                            123699
     C***********          MOVELPIRCRA    RCRA                            123699
     C***********          MOVELPIPIBN    PIBN                            123699
     C***********          MOVELPIPIBA    PIBA                            123699
     C***********          MOVELPIAWBN    AWBN                            123699
     C***********          MOVELPIAWBA    AWBA                            123699
     C***********          MOVELPIBENN    BENN                            123699
     C***********          MOVELPIBENA    BENA                            123699
      *
     C***********          MOVELPIRSTM    RSTM                            123699
     C***********          MOVELPIRONS    RONS                            123699
     C***********          MOVELPIROCN    ROCN                            123699
     C***********          MOVELPIROBN    ROBN                            123699
     C***********          MOVELPIRIBN    RIBN                            123699
     C***********          MOVELPIRIBA    RIBA                            123699
      *
     C***********          MOVELPIDTP1    DTP1                            123699
     C***********          MOVELPIDTP2    DTP2                            123699
     C***********          MOVELPIDTP3    DTP3                            123699
     C***********          MOVELPIDTP4    DTP4                            123699
     C***********          MOVELPIDCHG    DCHG                            123699
     C***********          MOVELPIBTB1    BTB1                            123699
     C***********          MOVELPIBTB2    BTB2                            123699
     C***********          MOVELPIBTB3    BTB3                            123699
     C***********          MOVELPIBTB4    BTB4                            123699
     C***********          MOVELPIBTB5    BTB5                            123699
     C***********          MOVELPIBTB6    BTB6                            123699
      *
      ** Settlement Allocations:                                                              CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE PISTAL    SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVELPIPSTM    PMPSTM                          123699
     C           PIPSTM    IFEQ '05'                                      123699
     C           CLE033    OREQ 'Y'                                       CLE033
     C           PIPSTM    ANDEQ'09'                                      CLE033
     C                     MOVELPIPONS    PMPOBR                          123699
     C                     MOVE PIPONS    PMPONS                          123699
     C                     MOVELPMPONS    WIOSAC                                              259991
     C                     ELSE                                           123699
     C**********           MOVELP#PONS    PMPONS                                       123699 257098
     C                     MOVELPIPONS    PMPONS                                              257098
     C                     MOVELPMPONS    WIOSAC                                              259991
     C                     ENDIF                                          123699
      *                                                                   123699
     C                     MOVELPIPREC    PARVNO                          123699
     C                     MOVELPICVMR    PMCVMR                          123699
     C                     MOVELPIPOCN    PAPOCN                          123699
     C                     MOVELPIPOBN    PAPOBN                          123699
     C                     MOVELPIRCRN    PARCRN                          123699
     C                     MOVELPIRCRA    PMRCRA                          123699
     C                     MOVELPIPIBN    PAPIBN                          123699
     C                     MOVELPIPIBA    PMPIBA                          123699
     C                     MOVELPIAWBN    PAAWBN                          123699
     C                     MOVELPIAWBA    PMAWBA                          123699
     C                     MOVELPIBENN    PABENN                          123699
     C                     MOVELPIBENA    PMBENA                          123699
      *                                                                   123699
     C                     MOVELPIRSTM    PMRSTM                          123699
     C           PIRSTM    IFEQ '05'                                      123699
     C           CLE033    OREQ 'Y'                                       CLE033
     C           PIRSTM    ANDEQ'09'                                      CLE033
     C                     MOVELPIRONS    PMROBR                          123699
     C                     MOVE PIRONS    PMRONS                          123699
     C                     MOVELPMRONS    WIOSAC                                              259991
     C                     ELSE                                           123699
     C**********           MOVELP#RONS    PMRONS                                       123699 257098
     C                     MOVELPIRONS    PMRONS                                              257098
     C                     MOVELPMRONS    WIOSAC                                              259991
     C                     ENDIF                                          123699
      *                                                                                       259991
     C                     MOVELWIOSAC    WOURS                                               259991
      *                                                                   123699
     C                     MOVELPIROCN    PAROCN                          123699
     C                     MOVELPIROBN    PAROBN                          123699
     C                     MOVELPIRIBN    PARIBN                          123699
     C                     MOVELPIRIBA    PMRIBA                          123699
      *                                                                   123699
     C                     MOVELPIDTP1    PMDTP1                          123699
     C                     MOVELPIDTP2    PMDTP2                          123699
     C                     MOVELPIDTP3    PMDTP3                          123699
     C                     MOVELPIDTP4    PMDTP4                          123699
     C                     MOVELPIDCHG    PMDCHG                          123699
     C                     MOVELPIBTB1    PMBTB1                          123699
     C                     MOVELPIBTB2    PMBTB2                          123699
     C                     MOVELPIBTB3    PMBTB3                          123699
     C                     MOVELPIBTB4    PMBTB4                          123699
     C                     MOVELPIBTB5    PMBTB5                          123699
     C                     MOVELPIBTB6    PMBTB6                          123699
      *                                                                   123699
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELPISCCY    PMRSCY                          CEU004
     C                     MOVELPISCCY    PMPSCY                          CEU004
     C                     MOVELPIICCY    PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELPISCCY    PMRSCY                                              CLE031
     C                     MOVELPIPSCY    PMPSCY                                              CLE031
     C                     MOVELPIREXR    PMREXR                                              CLE031
     C           PIREXR    IFNE *BLANKS                                                       CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVELPIREXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
     C                     Z-ADD*ZEROS    WSEXR  138                                          CLE031
     C                     MOVELZFIELD    WSEXR                                               CLE031
     C           *IN99     IFEQ *ON                                                           CLE031
     C           WSEXR     OREQ *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELPIPEXR    PMPEXR                                              CLE031
     C           PIPEXR    IFNE *BLANKS                                                       CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVELPIPEXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
     C                     Z-ADD*ZEROS    WSEXR                                               CLE031
     C                     MOVELZFIELD    WSEXR                                               CLE031
     C           *IN99     IFEQ *ON                                                           CLE031
     C           WSEXR     OREQ *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELPIREXI    PMREXI                                              CLE031
     C           PIREXI    IFEQ 'N'                                                           CLE031
     C                     MOVE *BLANKS   PMREXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELPIPEXI    PMPEXI                                              CLE031
     C           PIPEXI    IFEQ 'N'                                                           CLE031
     C                     MOVE *BLANKS   PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     CLEARPOUTP
     C                     MOVE PIMTYP    POMTYP
     C                     MOVE PITUSR    POTUSR
     C                     MOVE PITWST    POTWST
     C                     MOVE PITREF    POTREF
     C                     MOVE PITSEQ    POTSEQ
     C                     MOVE PITACT    POTACT
     C                     MOVE PITDST    POTDST
     C                     MOVE PITTST    POTTST
     C                     MOVE PINPAR    PONPAR
     C                     MOVE PILOAN    POLOAN
     C                     MOVE PIVDAT    POVDAT
     C                     MOVE PIMRSQ    POMRSQ                          123533
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRTRAL  -  Update Loan Amendments Trailer File                *
      * Called by: SRWRIT, SRUPDT                                     *
      * Calls    : GLZADD, GLZSUB                                     *
      *****************************************************************
     C           SRTRAL    BEGSR
      *
      ** Update Loan Amendments Trailer, No action for amendments
      *
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'R'
      *
     C                     MOVE '999999'  WLNRF
     C                     MOVE '99999'   WVALD
     C                     MOVE '999'     SLASN
      *                                                                   122601
      *  Store values before updating loan amendments trailer             122601
      *                                                                   122601
     C           *LIKE     DEFN VDAT      W#VDAT                          122601
     C           *LIKE     DEFN LNRF      W#LNRF                          122601
     C                     Z-ADDVDAT      W#VDAT                          122601
     C**********           Z-ADDLNRF      W#LNRF                                       122601 CLE148
     C                     MOVELLNRF      W#LNRF                                              CLE148
      *
     C********** KLMKEY    CHAINLOAMS                59                                     AR870590
     C           KLMKEY    CHAINLOAMS                5901                                   AR870590
      *
     C           *IN59     IFEQ '1'
     C           *IN01     OREQ '1'                                                         AR870590
     C           *LOCK     IN   LDA
     C                     MOVEL'LOAMS   'DBFILE           ************
     C                     Z-ADD16        DBASE            * DBERR 16 *
     C                     MOVEL'999999'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     GOTO ENTRAL
     C                     ENDIF
      *
      ** Action is insert
      *
     C           SACTN     IFEQ 'I'
     C           NORE      ADD  1         NORE
     C           NINS      ADD  1         NINS
     C           NLRA      ADD  1         NLRA
     C***********SPASD     IFEQ 'Y'                                       123789
     C***********NORE      ADD  1         NORE                            123789
     C***********NINS      ADD  1         NINS                            123789
     C***********NLRA      ADD  1         NLRA                            123789
     C***********          ENDIF                                          123789
     C                     Z-ADDVRIF      ZZTOTI
     C                     Z-ADDVRIL      ZZTOTD
     C                     ENDIF
      *
      ** Action is reverse
      *
     C           SACTN     IFEQ 'R'
     C           NDEL      ADD  1         NDEL
     C           NLRA      SUB  1         NLRA
     C                     Z-ADDVRDF      ZZTOTI
     C                     Z-ADDVRDL      ZZTOTD
     C                     ENDIF
      *
      ** If matched against CLOAN add for extra 'RE' record
      *
     C           *IN44     IFEQ '1'
     C           NORE      ADD  1         NORE
     C           NINS      ADD  1         NINS
     C           NLRA      ADD  1         NLRA
     C                     ENDIF
      *
      ** Update amount fields
      *
     C           TAMTR     DIV  1000      ZZAMT        40
     C           *IN40     IFEQ '1'
     C                     Z-SUBZZAMT     ZZAMT
     C                     ENDIF
     C                     EXSR GLZADD
      *
      ** Action is insert
      *
     C           SACTN     IFEQ 'I'
     C                     Z-ADDZZTOTI    VRIF
     C                     Z-ADDZZTOTD    VRIL
     C                     ENDIF
      *
      ** Action is reverse
      *
     C           SACTN     IFEQ 'R'
     C                     Z-ADDZZTOTI    VRDF
     C                     Z-ADDZZTOTD    VRDL
     C                     ENDIF
      *
      ** If matched against CLOAN add for extra 'RE' record
      *
     C           *IN44     IFEQ '1'
     C***********TAMT      DIV  1000      ZZAMT        40                 131414
     C           TAMTS     DIV  1000      ZZAMT        40                 131414
     C           *IN40     IFEQ '1'
     C                     Z-SUBZZAMT     ZZAMT
     C                     ENDIF
     C                     Z-ADDVRIF      ZZTOTI
     C                     Z-ADDVRIL      ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    VRIF
     C                     Z-ADDZZTOTD    VRIL
     C                     ENDIF
      *
     C                     Z-ADD0         WAMNT        40
      *
     C***********AMTP      IFEQ 'PD'                                      127722
     C           WAMTP     IFEQ 'PD'                                      127722
     C           SACTN     IFEQ 'R'
     C                     Z-ADDTAMTR     WAMNT
     C                     ENDIF
     C           SACTN     IFEQ 'I'
     C                     Z-SUBTAMTR     WAMNT
     C                     ENDIF
     C                     ENDIF
     C*                                                                   158510
     C** Also get absolute value of amount when linked to a past due.     158510
     C*                                                                   158510
     C           WAMTP     IFEQ 'PD'                                      158510
     C           SACTN     ANDEQ'R'                                       158510
     C           WAMNT     ANDLT0                                         158510
     C                     Z-SUBWAMNT     WAMNT                           158510
     C                     ENDIF                                          158510
     C*                                                                   158510
     C** Get absolute value of amount first before negating it.  This is  158510
     C** to accomodate negative manual repayments linked to a past due.   158510
     C*                                                                   158510
     C           WAMTP     IFEQ 'PD'                                      158510
     C           SACTN     ANDEQ'I'                                       158510
     C                     Z-ADDTAMTR     WAMNT                           158510
     C           WAMNT     IFGE 0                                         158510
     C                     Z-SUBWAMNT     WAMNT                           158510
     C                     ENDIF                                          158510
     C                     ENDIF                                          158510
      *
      **  For match against 'RE' value of amend is absolute
      **  value of TAMT of 'RE' after amend minus absolute value
      **  of TAMT of 'RE' before amend
      **
      *
     C***********AMTP      IFEQ 'RE'                                      127722
     C           WAMTP     IFEQ 'RE'                                      127722
     C           REPTL     ANDNE1
     C                     Z-ADDOTAMT     WRK13        40
     C           *IN40     IFEQ '1'
     C                     Z-SUBWRK13     WRK13
     C                     ELSE
     C                     Z-ADDTAMTS     WAMNT        40
     C                     ENDIF
     C           *IN40     IFEQ '1'
     C                     Z-SUBWAMNT     WAMNT
     C                     ELSE
     C           WAMNT     SUB  WRK13     WAMNT
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVE WAMNT     ZZAMT
     C                     Z-ADDVRAF      ZZTOTI
     C                     Z-ADDVRAL      ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    VRAF
     C                     Z-ADDZZTOTD    VRAL
      *
     C                     Z-ADDTAMTR     ZZAMT        40
     C           *IN40     IFEQ '1'
     C                     Z-SUBZZAMT     ZZAMT
     C                     ENDIF
      *
     C           SACTN     IFEQ 'I'
     C           ZZAMT     ADD  WAMNT     WRK13
     C                     ENDIF
      *
     C           SACTN     IFEQ 'R'
     C           ZZAMT     SUB  WAMNT     WRK13
     C                     ENDIF
      *
     C           WRK13     DIV  1000      ZZAMT        40
     C           *IN40     IFEQ '1'
     C                     Z-SUBZZAMT     ZZAMT
     C                     ENDIF
      *                                                                   123789
     C                     Z-ADDVRRF      ZZTOTI                          123789
     C                     Z-ADDVRRL      ZZTOTD                          123789
      *
     C           SACTN     IFEQ 'I'
     C                     EXSR GLZADD
     C                     ENDIF
      *
     C           SACTN     IFEQ 'R'
     C                     EXSR GLZSUB
     C                     ENDIF
      *
     C                     Z-ADDZZTOTI    VRRF
     C                     Z-ADDZZTOTD    VRRL
      *
     C           *IN44     IFEQ '1'
     C***********TAMT      DIV  1000      ZZAMT        40                 131414
     C           TAMTS     DIV  1000      ZZAMT        40                 131414
     C           *IN40     IFEQ '1'
     C                     Z-SUBZZAMT     ZZAMT
     C                     ENDIF
     C                     Z-ADDVRRF      ZZTOTI
     C                     Z-ADDVRRL      ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    VRRF
     C                     Z-ADDZZTOTD    VRRL
     C                     ENDIF
      *
     C                     Z-ADDRUND      LCD
     C                     MOVE 'A'       CHTP
     C                     Z-ADDNATN      TNLU
      *
     C                     UPDATLOAMSZ1F
      *                                                                   122601
      *  REStore values after updating loan amendments trailer            122601
      *                                                                   122601
     C                     MOVE W#VDAT    VDAT                            122601
     C                     MOVE W#LNRF    LNRF                            122601
      *
     C                     ENDIF
      *
     C           ENTRAL    ENDSR
      /EJECT
      *****************************************************************   128094
      * SRLTRX  -  Update Loan Transaction Index Detail (LTRIX)       *   128094
      * Called by: Main routine                                       *   128094
      * Calls    : None                                               *   128094
      *****************************************************************   128094
     C           SRLTRX    BEGSR                                          128094
      *                                                                   128094
      ***Update*LTRIX*if*amendment*type*is*PI,*PT*or*PF*only,*and*ac128094155570
      ***is*authorisation*or*reversal*******************************128094155570
      *                                                                   128094
     C           SACTN     IFEQ 'X'                                       128094
     C           BPMRAU    ANDEQ'Y'                                       128094
     C           CLE002    ANDEQ'Y'                                       155610
     C           SACTN     OREQ 'I'                                       128094
     C***********BPMRAU    ANDEQ'N'                                 128094155610
     C           BPMRAU    ANDNE'Y'                                       155610
      *                                                                   128094
     C           SACTN     OREQ 'R'                                       128094
     C           BPMRAU    ANDEQ'Y'                                       128094
     C           CLE002    ANDEQ'Y'                                       155610
     C           XUSR      ANDNE*BLANK                                    128094
     C           SACTN     OREQ 'R'                                       128094
     C***********BPMRAU    ANDEQ'N'                                 128094155610
     C           BPMRAU    ANDNE'Y'                                       155610
     C           SACTN     OREQ 'A'                                       155570
     C           BPMRAU    ANDNE'Y'                                       155570
      *                                                                   155570
     C           PMODE     OREQ 'B'                                       155570
      *                                                                   128094
     C**********           MOVE *IN17     IN17    1                                  186431 AR322732
     C**********           MOVE '1'       *IN17                                      186431 AR322732
     C**********           MOVE '0'       *IN79                                      186431 AR322732
      *                                                                   186431
     C********** *IN17     DOUEQ'0'                                                  186431 AR322732
     C********** RECI      ANDEQ*BLANK                                               186431 AR322732
     C********** *IN79     OREQ '1'                                                  186431 AR322732
      *                                                                   186431
     C**********           Z-ADD1         LXRRN   50                                 128094 AR322732
      *                                                                   128094
      ** Access LTRIX header                                              128094
      *                                                                   128094
     C********** LXRRN     CHAINLTRIX               N79                              128094 AR322732
      *                                                                   128094
     C********** *IN79     IFEQ '0'                                                  128094 AR322732
     C********** RECI      IFEQ 'H'                                                  128094 AR322732
     C********** RRNA      IFGT FLSZ                                                 130173 AR322732
     C***********RRNA      ANDGTFLSZ                                128094130173
     C**********           MOVE '1'       *INU8                                      128094 AR322732
     C***********          MOVE '1'       *INLR                     128094130173
     C***********          RETRN                                    128094130173
     C**********           ENDIF                                                     128094 AR322732
     C**********           ELSE                                                      128094 AR322732
     C**********           MOVE *ON       *IN79                                      130173 AR322732
     C**********           ENDIF                                                     130173 AR322732
     C**********           ENDIF                                                     130173 AR322732
      *                                                                   130173
     C********** *IN79     IFEQ *ON                                                  130173 AR322732
     C********** *INU8     OREQ *ON                                                  130173 AR322732
     C********** *LOCK     IN   LDA                                                  128094 AR322732
     C**********           MOVEL'LTRIX   'DBFILE           ************              128094 AR322732
     C**********           Z-ADD19        DBASE            * DBERR 19 *              128094 AR322732
     C**********           MOVELLXRRN     DBKEY            ************              128094 AR322732
     C**********           OUT  LDA                                                  128094 AR322732
     C**********           EXSR *PSSR                                                128094 AR322732
     C**********           ENDIF                                                     128094 AR322732
      *                                                                   128094
     C**********           MOVE RRNA      LXRRN                                      128094 AR322732
      *                                                                   128094
     C********** LXRRN     CHAINLTRIX                79            128094 186431
     C********** LXRRN     CHAINLTRIX                7917                            186431 AR322732
      *                                                                   186431
     C********** *IN17     IFEQ '1'                                                  186431 AR322732
     C********** TXSTS     IFEQ 1218                                                 186431 AR322732
     C**********           UNLCKLTRIX                                                186431 AR322732
     C**********           EXSR CLEAR                                                186431 AR322732
     C**********           ELSE                                                      186431 AR322732
     C**********           MOVE '1'       *IN79                                      186431 AR322732
     C**********           ENDIF                                                     186431 AR322732
     C**********           ENDIF                                                     186431 AR322732
      *                                                                   186431
     C**********           ENDDO                                                     186431 AR322732
     C**********           MOVE IN17      *IN17                                      186431 AR322732
      *                                                                   186431
     C********** *IN79     IFEQ '1'                                                  128094 AR322732
     C********** *LOCK     IN   LDA                                                  128094 AR322732
     C**********           MOVEL'LTRIX   'DBFILE           ************              128094 AR322732
     C**********           Z-ADD20        DBASE            * DBERR 20 *              128094 AR322732
     C**********           MOVELLXRRN     DBKEY            ************              128094 AR322732
     C**********           OUT  LDA                                                  128094 AR322732
     C**********           EXSR *PSSR                                                128094 AR322732
     C**********           ENDIF                                                     128094 AR322732
      *                                                                   128094
     C**********           Z-ADD0         PRI1                                       128094 AR322732
     C                     Z-ADD0         PRI1    10                                        AR322732
      *                                                                   128094
      ** Check settlement type                                            128094
      *                                                                   128094
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
     C           PNOST     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
      ** Set Work Process to blanks                                                           CLE034
      *                                                                                       CLE034
     C                     MOVE *BLANKS   WPROC   1                                           CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'N'                                                           CLE034
     C           CLE034    OREQ 'N'                                                           CLE034
      *                                                                                       CLE034
     C***********PSTM      IFEQ 01                                  128094152678
     C***********PSTM      OREQ 02                                  128094152678
     C***********PSTM      OREQ 07                                  128094152678
     C***********PSTM      OREQ 08                                  128094152678
     C***********PSTM      OREQ 12                                  128094152678
     C           SETP      IFEQ 01                                        152678
     C           SETP      OREQ 02                                        152678
     C           SETP      OREQ 07                                        152678
     C           SETP      OREQ 08                                        152678
     C           SETP      OREQ 12                                        152678
      *                                                                                       CLE034
     C                     MOVE 'Y'       WPROC                                               CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WPROC     IFEQ 'Y'                                                           CLE034
      *                                                                   128094
      ** Obtain lowest telex notice days between loan & local CCY         128094
      *                                                                   128094
     C                     CALL 'AOCURRR0'                                128094
     C                     PARM '*BLANK  'PRTCD                           128094
     C                     PARM '*KEY    'POPTN                           128094
     C***********          PARM SCCY      PCURR                    128094 156873
     C                     PARM SSCCY     PCURR                           156873
     C           SDCURR    PARM SDCURR    DSSDY                           128094
      *                                                                   128094
     C           PRTCD     IFNE *BLANKS                                   128094
     C           *LOCK     IN   LDA                                       128094
     C                     MOVEL'SDCURRPD'DBFILE           ************   128094
     C                     Z-ADD21        DBASE            * DBERR 21 *   128094
     C***********          MOVELSCCY      DBKEY            ********128094 156873
     C                     MOVELSSCCY     DBKEY                           156873
     C                     OUT  LDA                                       128094
     C                     EXSR *PSSR                                     128094
     C                     ENDIF                                          128094
      *                                                                   128094
      ** Default to local CCY for telex notice calculation                128094
      *                                                                   128094
     C                     Z-ADDTNOTL     ZNRDYS                          128094
     C                     Z-ADDRUND      ZDAYNO                          128094
     C                     MOVE LOCY      ZCCY                            128094
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'N'                                                           CLE034
     C           CLE034    OREQ 'N'                                                           CLE034
      *                                                                   128094
      ** For settlement types 01, 07, & 08 use loan currency instead      128094
      *                                                                   128094
     C***********PSTM      IFEQ 01                                  128094152678
     C***********PSTM      OREQ 07                                  128094152678
     C***********PSTM      OREQ 08                                  128094152678
     C           SETP      IFEQ 01                                        152678
     C           SETP      OREQ 07                                        152678
     C           SETP      OREQ 08                                        152678
     C                     Z-ADDTNOTL     ZNRDYS                          128094
     C***********          MOVE SCCY      ZCCY                     128094 156873
     C                     MOVE SSCCY     ZCCY                            156873
     C                     ENDIF                                          128094
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     Z-ADDTNOTL     ZNRDYS                                              CLE034
     C                     MOVE SSCCY     ZCCY                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   128094
     C                     EXSR ZFWDT                                     128094
      *                                                                   128094
     C           WDAYNV    IFLE ZDYNBR                                    128094
     C           WDAYNV    IFGE RUND                                      128094
     C                     Z-ADD1         PRI1                            128094
     C                     ENDIF                                          128094
     C                     ENDIF                                          128094
      *                                                                   128094
     C                     ENDIF                                          128094
      *                                                                   128094
      ** Update LTRIX detail record                                       128094
      *                                                                   128094
     C                     Z-ADD0         RRNA    50                                        AR322732
     C                     EXCPTLTRIXD                                    128094
      *                                                                   128094
      ** Get header record                                                128094
      *                                                                   128094
     C**********           Z-ADD1         LXRRN                                      128094 AR322732
     C********** LXRRN     CHAINLTRIX                79                              128094 AR322732
      *                                                                   128094
     C********** *IN79     IFEQ '1'                                                  128094 AR322732
     C********** *LOCK     IN   LDA                                                  128094 AR322732
     C**********           MOVEL'LTRIX   'DBFILE           ************              128094 AR322732
     C**********           Z-ADD22        DBASE            * DBERR 22 *              128094 AR322732
     C**********           MOVELLXRRN     DBKEY            ************              128094 AR322732
     C**********           OUT  LDA                                                  128094 AR322732
     C**********           EXSR *PSSR                                                128094 AR322732
     C**********           ENDIF                                                     128094 AR322732
      *                                                                   128094
      ** Update relevant control fields                                   128094
      *                                                                   128094
     C********** NORE      ADD  1         NORE                                       128094 AR322732
     C********** RRNA      ADD  1         RRNA                                       128094 AR322732
     C********** NLAR      ADD  1         NLAR                                       128094 AR322732
      *                                                                   128094
     C**********           EXCPTLTRIXH                                               128094 AR322732
      *                                                                   128094
     C                     ENDIF                                          128094
      *                                                                   128094
     C                     ENDSR                                          128094
      /EJECT                                                              128094
      *****************************************************************
      * SRFCLT   - Facility file update                               *
      * Called by: SRWRIT, SRUPDT                                     *
      * Calls    : FCLTSR                                             *
      *****************************************************************
     C           SRFCLT    BEGSR
      *
     C                     MOVE 'N'       WPART
      *
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'R'
      *
      ** Access FACILITY 'A' record
      *
     C                     MOVE 'A'       WRCDT1
     C                     MOVE FCUS      WFCUS
     C                     MOVE FTYP      WFTYP
     C                     MOVE FSEQ      WFSEQ
      *
     C           KFCLT     CHAINFCLTY               N50
     C           *IN50     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE           ************
     C                     Z-ADD21        DBASE            * DBERR 21 *
     C                     MOVELFCLKEY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     GOTO ENDFCL
     C                     ENDIF
      *
      ** Access FACILITY 'B' record
      *
     C                     MOVE 'B'       WRCDT1
     C           KFCLT     CHAINFCLTY                50
     C           *IN50     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE           ************
     C                     Z-ADD22        DBASE            * DBERR 22 *
     C                     MOVELFCLKEY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     GOTO ENDFCL
     C                     ENDIF
      *
      ** Access FCCY record for decimal places
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*BLANK  'PRTCD
     C                     PARM '*KEY    'POPTN
     C                     PARM FCCYF     PCURR
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD23        DBASE            * DBERR 23 *
     C                     MOVELFCCYF     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     GOTO ENDFCL
     C                     ENDIF
      *
      ** Save currency details to work field                                                  CLE023
      *                                                                                       CLE023
     C                     MOVE CDP       CDPF    10
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDA6SPRT    WSPRTF 138                                          CLE023
     C                     MOVE A6MDIN    WMDINF  1                                           CLE023
     C                     ENDIF                                                              CLE023
     C           CLE134    IFEQ 'Y'                                                         AR806351
     C                     MOVE 'Y'       WEXPO   1                                         AR806351
     C                     EXSR PDCLMR                                                      AR806351
     C                     ENDIF                                                            AR806351
      *                                                                                     AR806351
     C                     EXSR FCLTSR
      *
     C                     Z-ADDRUND      LCD
     C                     MOVE 'A'       CHTP
     C                     Z-ADDNATN      TNLU
     C                     UPDATFCLTYFNF               50
      *
      ** Update superfacility of the tranche, if any, for CLE005          CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           TRCA      ANDEQ'TR'                                      CLE005
     C                     MOVELWPRME     SPRME  12                       CLE005
     C                     EXSR SRUPCA                                    CLE005
     C                     MOVELSPRME     WPRME                           CLE005
     C                     ENDIF                                          CLE005
      *
      ** Update also the Participant facility if existing
      *
     C           LPFI      IFNE ' '
     C           LPFI      ANDNE'R'                                       144251
      *
     C                     MOVE 'Y'       WPART   1
      *
     C                     MOVELPTFC      WFCUS
     C                     MOVELPTFT      WFTYP
     C                     MOVELPTFN      WFSEQ
     C                     MOVE 'A'       WRCDT1
      *
     C           KFCLT     CHAINFCLTY               N50
      *
     C           *IN50     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE           ************
     C                     Z-ADD24        DBASE            * DBERR 24 *
     C                     MOVELFCLKEY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      *
      ** Access FACILITY 'B' record
      *
     C                     MOVE 'B'       WRCDT1
     C           KFCLT     CHAINFCLTY                50
     C           *IN50     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE           ************
     C                     Z-ADD25        DBASE            * DBERR 25 *
     C                     MOVELFCLKEY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     GOTO ENDFCL
     C                     ENDIF
      *
      ** Access FCCY record for decimal places
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*BLANK  'PRTCD
     C                     PARM '*KEY    'POPTN
     C                     PARM FCCYF     PCURR
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD26        DBASE            * DBERR 26 *
     C                     MOVELFCCYF     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     GOTO ENDFCL
     C                     ENDIF
      *
     C                     MOVE CDP       CDPF
      *
     C           CLE134    IFEQ 'Y'                                                         AR806351
     C                     MOVE 'Y'       WEXPO                                             AR806351
     C                     EXSR PDCLMR                                                      AR806351
     C                     ENDIF                                                            AR806351
      *                                                                                     AR806351
     C                     EXSR FCLTSR
      *
     C                     Z-ADDRUND      LCD
     C                     MOVE 'A'       CHTP
     C                     Z-ADDNATN      TNLU
     C                     UPDATFCLTYFNF               50
      *                                                                   CLE005
      *
      ***Update*superfacility*of*the*tranche,*if*any,*for*CLE005***CLE005 147518
      ***********                                                  CLE005 147518
     C***********CLE005    IFEQ 'Y'                                CLE005 147518
     C***********TRCA      ANDEQ'TR'                               CLE005 147518
     C***********          EXSR SRUPCA                             CLE005 147518
     C***********          ENDIF                                   CLE005 147518
      ***********                                                         147518
     C                     ENDIF
     C                     ENDIF
      *
     C           ENDFCL    ENDSR
      *
      /EJECT                                                                                AR806351
      *****************************************************************                     AR806351
      * PDCLMR   - Check if loan has FAMU N/Y                         *                     AR806351
      * Called by: SRFCLT, SRUPCA                                     *                     AR806351
      * Calls    : None                                               *                     AR806351
      *****************************************************************                     AR806351
     C           PDCLMR    BEGSR                                                            AR806351
      *                                                                                     AR806351
      ** Bypass if PDCL type is Interest(Y) or Fee(Z) and with FAMU = N                     AR806351
      ** Only do this if auto-settlement is equal to 'C' from CLOANCL                       AR806351
      *                                                                                     AR806351
     C                     MOVELLTYPL     WLTYP   1                                         AR806351
      *                                                                                     AR806351
     C           AUTOL     IFEQ 'C'                                                         AR806351
     C           WLTYP     IFEQ 'Y'                                                         AR806351
     C           FAMU      ANDEQ'N'                                                         AR806351
     C           WLTYP     OREQ 'Z'                                                         AR806351
     C           FAMU      ANDEQ'N'                                                         AR806351
     C                     MOVE 'N'       WEXPO                                             AR806351
     C                     ENDIF                                                            AR806351
     C                     ENDIF                                                            AR806351
      *                                                                                     AR806351
     C                     ENDSR                                                            AR806351
      /EJECT                                                              CLE005
      *****************************************************************   CLE005
      * SRUPCA   - Sub-routine to update credit agreement             *   CLE005
      * Called by: SRFCLT                                             *   CLE005
      * Calls    : FCLTSR                                             *   CLE005
      *****************************************************************   CLE005
     C           SRUPCA    BEGSR                                          CLE005
      *                                                                   CLE005
      ** Whenever the facility utilisation is updated for a tranche,      CLE005
      ** update the credit agreement/superfacility as well                CLE005
      *                                                                   CLE005
     C                     MOVE FCCY      WTCCY   3                       CLE005
     C                     MOVE CMDI      WCMDI   1                       CLE005
     C                     Z-ADDCAXR      WCAXR  138                      CLE005
     C                     MOVELCANM      WFCUS                           CLE005
     C                     MOVELCAFT      WFTYP                           CLE005
     C                     MOVELCAFN      WFSEQ                           CLE005
     C                     MOVE 'A'       WRCDT1                          CLE005
      *                                                                   CLE014
      ** Save the revolving credit indicator specified for the tranche    CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C                     MOVE RVCRF     WRVCRF  1                       CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE005
     C           KFCLT     CHAINFCLTY               N79                   CLE005
      *                                                                   CLE005
     C           *IN79     IFEQ '1'                                       CLE005
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVEL'FCLTY   'DBFILE           ************   CLE005
     C                     Z-ADD27        DBASE            * DBERR 27 *   CLE005
     C                     MOVELFCLKEY    DBKEY            ************   CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      *                                                                   CLE014
      ** If the revolving credit indicator for the credit agreement is    CLE014
      ** 'T', use the saved tranche revolving credit indicator as the     CLE014
      ** credit agreement revolving indicator.                            CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
      *                                                                   CLE014
     C           RVCRF     IFEQ 'T'                                       CLE014
     C                     MOVE WRVCRF    RVCRF                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ENDIF                                          CLE014
     C                     MOVE 'B'       WRCDT1                          CLE005
     C           KFCLT     CHAINFCLTY                79                   CLE005
      *                                                                   CLE005
     C           *IN79     IFEQ '1'                                       CLE005
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVEL'FCLTY   'DBFILE           ************   CLE005
     C                     Z-ADD29        DBASE            * DBERR 29 *   CLE005
     C                     MOVELFCLKEY    DBKEY            ************   CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      ** If tranche and superfacility currencies are different, get       CLE005
      ** superfacility currency details                                   CLE005
      *                                                                   CLE005
     C           WTCCY     IFNE FCCYF                                     CLE005
     C                     CALL 'AOCURRR0'                                CLE005
     C                     PARM *BLANKS   PRTCD                           CLE005
     C                     PARM '*KEY   ' POPTN                           CLE005
     C**********           PARM FCCY      PCURR                                        CLE005 202068
     C                     PARM FCCYF     PCURR                                               202068
     C           SDCURR    PARM SDCURR    DSSDY                           CLE005
     C           PRTCD     IFNE *BLANKS                                   CLE005
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVEL'SDCURRPD'DBFILE           ************   CLE005
     C                     Z-ADD28        DBASE            * DBERR 28 *   CLE005
     C                     MOVELFCCY      DBKEY            ************   CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      ** Convert facility amount to credit facility currency              CLE005
      *                                                                   CLE005
     C                     Z-ADDCDP       CDPC    10                      CLE005
     C           CDPC      SUB  CDPF      CX                              CLE005
     C           CX        ADD  4         CX                              CLE005
     C           WCMDI     IFEQ 'D'                                       CLE005
     C********** WCAXR     DIV  POWR,CX   OFCXRT    H                                  CLE005 CLE023
     C           WCAXR     DIV  POWER,CX  OFCXRT    H                                         CLE023
     C           1         DIV  OFCXRT    OFCXRT                          CLE005
     C                     ELSE                                           CLE005
     C********** WCAXR     MULT POWR,CX   OFCXRT    H                                  CLE005 CLE023
     C           WCAXR     MULT POWER,CX  OFCXRT    H                                         CLE023
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     MULT OFCXRT    PRAMF     H                     CLE005
      *                                                                                       CLE023
      ** Convert facility amount to Credit agreement facility using spot                      CLE023
      ** rate for later update of Current exposure                                            CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     MOVE WMDINF    ZMDI1                                               CLE023
     C                     Z-ADDWSPRTF    ZRATE1                                              CLE023
     C                     Z-ADDCDPF      ZNBDP1                                              CLE023
     C                     MOVE A6MDIN    ZMDI2                                               CLE023
     C                     Z-ADDA6SPRT    ZRATE2                                              CLE023
     C                     Z-ADDCDPC      ZNBDP2                                              CLE023
     C                     EXSR ZXRATE                                                        CLE023
      *                                                                                       CLE023
     C                     Z-ADDZRATEX    ZEXCH                                               CLE023
     C                     MOVE ZMDIX     ZMD                                                 CLE023
     C                     Z-ADDWPRAMS    ZAMTCI                                              CLE023
     C                     MOVE WTCCY     ZCCYI                                               CLE023
     C                     MOVE FCCYF     ZCCYO                                               CLE023
     C                     Z-ADDZNBDP1    ZCDPI                                               CLE023
     C                     Z-ADDZNBDP2    ZCDPO                                               CLE023
     C                     EXSR ZCONV                                                         CLE023
      *                                                                                       CLE023
     C                     Z-ADDZAMTCO    WPRAMS 130                                          CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      ** Update facility exposure and availability                        CLE005
      *                                                                   CLE005
     C                     MOVE 'Y'       WTRCA   1                       CLE005
     C           CLE134    IFEQ 'Y'                                                         AR806351
     C                     MOVE 'Y'       WEXPO   1                                         AR806351
     C                     EXSR PDCLMR                                                      AR806351
     C                     ENDIF                                                            AR806351
      *                                                                                     AR806351
     C                     EXSR FCLTSR                                    CLE005
     C                     Z-ADDRUND      LCD                             CLE005
     C                     MOVE 'A'       CHTP                            CLE005
     C                     Z-ADDNATN      TNLU                            CLE005
     C                     UPDATFCLTYFNF               50                 CLE005
     C                     MOVE *BLANK    WTRCA                           CLE005
      *                                                                   CLE005
     C                     ENDSR                                          CLE005
      *                                                                   CLE005
      /EJECT
      *****************************************************************
      * FCLTSR   - Sub-routine to update exposure.                    *
      *            internal customer.                                 *
      * Called by: SRFCLT                                             *
      * Calls    : SRCIBC, QFCLTY                                     *
      *****************************************************************
     C           FCLTSR    BEGSR
      *
      ** Convert amounts into facility currency equivalent
      *
     C           WTRCA     IFEQ *BLANK                                    CLE005
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           RLDT      ANDLTBJRDNB                                                        CLE023
     C           RLDT      ANDNE*ZERO                                                         CLE023
     C           NFCE      ANDNE*ZERO                                                         CLE023
     C           NCCY      ANDEQ*BLANKS                                                       CLE023
     C                     Z-ADDNFCE      WFCXR  138                                          CLE023
     C                     MOVE 'Y'       WROFXR  1                                           CLE023
     C                     ELSE                                                               CLE023
     C                     Z-ADDFCXR      WFCXR                                               CLE023
     C                     MOVE 'N'       WROFXR  1                                           CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C           CDPF      SUB  WCDP      CX      10
     C           CX        ADD  4         CX
     C           FMDI      IFEQ 'D'
     C           WROFXR    ANDEQ'N'                                                           CLE023
     C           NFMD      OREQ 'D'                                                           CLE023
     C           WROFXR    ANDEQ'Y'                                                           CLE023
     C********** FCXR      DIV  POWR,CX   OFCXRT    H                                         CLE023
     C           WFCXR     MULT POWER,CX  OFCXRT 159H                                         CLE023
     C           1         DIV  OFCXRT    OFCXRT
     C                     ELSE
     C********** FCXR      MULT POWR,CX   OFCXRT 159H                                         CLE023
     C           WFCXR     MULT POWER,CX  OFCXRT 159H                                         CLE023
     C                     ENDIF
      *
     C           PRAMR     MULT OFCXRT    PRAMF  130H
      *                                                                                       CLE023
      ** Convert amount to facility currency using spot rates                                 CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     MOVE WMDINL    ZMDI1   1                                           CLE023
     C                     Z-ADDWSPRTL    ZRATE1 138                                          CLE023
     C                     Z-ADDWCDP      ZNBDP1  10                                          CLE023
     C                     MOVE WMDINF    ZMDI2   1                                           CLE023
     C                     Z-ADDWSPRTF    ZRATE2 138H                                         CLE023
     C                     Z-ADDCDPF      ZNBDP2  10                                          CLE023
     C                     EXSR ZXRATE                                                        CLE023
      *                                                                                       CLE023
     C                     Z-ADDZRATEX    ZEXCH  138                                          CLE023
     C                     MOVE ZMDIX     ZMD     1                                           CLE023
     C                     Z-ADDPRAMR     ZAMTCI 150                                          CLE023
     C                     MOVE CCYL      ZCCYI   3                                           CLE023
     C                     MOVE FCCY      ZCCYO   3                                           CLE023
     C                     Z-ADDZNBDP1    ZCDPI   10                                          CLE023
     C                     Z-ADDZNBDP2    ZCDPO   10                                          CLE023
     C                     EXSR ZCONV                                                         CLE023
      *                                                                                       CLE023
     C                     Z-ADDZAMTCO    WPRAMS 130                                          CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF                                          CLE005
      *
      ** Set up fields for availability updating
      *
     C                     Z-ADDMDAT      ENDAY   50     40
     C           *IN40     IFEQ '1'
     C                     Z-ADD99999     ENDAY
     C                     ENDIF
     C                     Z-ADDWDAYNV    DAYNO   50
      *
     C                     MOVEA'00'      *IN,41
      *
     C***********SACTN     IFEQ 'I'                                       122685
     C************IN52     ANDEQ'0'                                       122685
     C***********RVCRF     ANDEQ'Y'                                       122685
     C***********SACTN     OREQ 'R'                                       122685
     C************IN52     ANDEQ'1'                                       122685
     C***********FCTIF     ANDNE'C'                                       122685
     C***********          MOVE '1'       *IN41                           122685
     C***********          ENDIF                                          122685
      ***********                                                         122685
     C***********SACTN     IFEQ 'I'                                       122685
     C************IN52     ANDEQ'1'                                       122685
     C***********FCTIF     ANDNE'C'                                       122685
     C***********SACTN     OREQ 'R'                                       122685
     C************IN52     ANDEQ'0'                                       122685
     C***********RVCRF     ANDEQ'Y'                                       122685
     C***********          MOVE '1'       *IN42                           122685
     C***********          ENDIF                                          122685
      *                                                                   122685
      ** Similar update for a non-syndicated loan and part purchased,     122685
      ** internal parts purchased and funding participant                 122685
      *                                                                   122685
     C           RVCRF     IFEQ 'Y'                                       122685
     C           RVCRF     OREQ 'N'                                                           205535
     C           SPASD     ANDEQ'Y'                                                           205535
     C           WPART     OREQ 'Y'                                       156969
     C***********LPFI      ANDEQ'I'                                156969 161262
     C           GASS      ANDEQ'A'                                       156969
      *                                                                   156969
     C           WPART     OREQ 'Y'                                       156969
     C***********LPFI      ANDEQ'I'                                156969 161262
     C           PIGASS    ANDEQ'A'                                       156969
      *                                                                   156969
     C           *IN52     IFEQ '0'                                       122685
     C           LPFI      ANDEQ' '                                       122685
     C           WPART     OREQ 'Y'                                       122685
     C           SACTN     IFEQ 'I'                                       122685
     C           SACTN     OREQ 'R'                                                           205535
     C           SPASD     ANDEQ'Y'                                                           205535
     C                     MOVE '1'       *IN41                           122685
     C                     ELSE                                           122685
     C                     MOVE '1'       *IN42                           122685
     C                     ENDIF                                          122685
      *                                                                   122685
      ** Similar update for a non-syndicated parts sold, and prime        122685
      ** facilities                                                       122685
     C                     ELSE                                           122685
     C           SACTN     IFEQ 'I'                                       122685
     C           SACTN     OREQ 'R'                                                           205535
     C           SPASD     ANDEQ'Y'                                                           205535
     C                     MOVE '1'       *IN42                           122685
     C                     ELSE                                           122685
     C                     MOVE '1'       *IN41                           122685
     C                     ENDIF                                          122685
     C                     ENDIF                                          122685
     C                     ENDIF                                          122685
      *
     C           CLE134    IFEQ 'Y'                                                         AR806351
     C           WEXPO     ANDEQ'Y'                                                         AR806351
     C           CLE134    OREQ 'N'                                                         AR806351
     C                     Z-ADDPRAMF     FCBAL  130
     C                     ELSE                                                             AR806351
     C                     Z-ADD0         PRAMF                                             AR806351
     C                     Z-ADD0         FCBAL                                             AR806351
     C                     Z-ADD0         WPRAMS                                            AR806351
     C                     ENDIF                                                            AR806351
      *
      ** Do not update for parts sold with recourse and
      ** if CLE023 is not installed.  If CLE023 is installed, do not                          CLE023
      ** update for parts sold for non-participant facility with or                           CLE023
      ** without recourse.  Also do not update                                                CLE023
      ** Prime facility of a syndicated loan
      ***when*sold*with*recourse**************************************                 122685 CLE023
      *
     C           *IN52     IFEQ '1'
     C           RCSI      ANDEQ'Y'
     C           LPFI      ANDEQ' '                                       122685
     C           CLE023    ANDEQ'N'                                                           CLE023
      *                                                                                       CLE023
     C           *IN52     OREQ '1'                                                           CLE023
     C           LPFI      ANDEQ' '                                                           CLE023
     C           CLE023    ANDEQ'Y'                                                           CLE023
      *                                                                                       CLE023
     C           WPART     OREQ 'N'
     C           LPFI      ANDNE' '
     C***********RCSI      ANDEQ'Y'                                122685 147518
     C                     MOVEA'00'      *IN,41
     C                     ENDIF
      *
      ** If customer is branch internal customer, then no update to
      ** facility availability
      *
     C                     EXSR SRCIBC
      *
      ** If ind. 43 is on, then customer is an internal customer.
      ** Or, if LPFI equals 'I', then loan is an IPP.                     147518
      *
     C           *IN43     IFEQ '1'
     C           LPFI      ANDNE'I'                                       161262
     C           LPFI      OREQ 'I'                                       147518
     C           WPART     ANDEQ'N'                                       147518
     C                     MOVE '0'       *IN43
     C                     ELSE
      *
     C           *IN41     IFEQ '1'
     C           *IN42     OREQ '1'
     C                     EXSR QFCLTY
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** UPDATE EXPOSURE
      **
      ** Pgm LE0480 has been amended so that all non-settled matured
      ** loans are processed as 'Past Due', and in LE0490 the O/S
      ** Principal of these loans is included in the current exposure
      ** for the facility - system no longer waits until payment is
      ** Past Due for 3 days.
      ** The program currently does not update the exposure for the
      ** repayment if the loan has matured within the last 3 days -
      ** this check is now redundant and has been removed, i.e. If a
      ** Manual Repayment is input, update the exposure.
      **
      ***Reverse*exposure*update*procedure*for:***************************122685
      ***Prime*facility*-*if*Participant*is*Internal*(for*Parts*Purch)****122685
      ***Participant*facility*-*for*Parts*Sold****************************122685
      ***********                                                         122685
     C***********WPART     IFEQ 'Y'                                       122685
     C***********LPFI      ANDEQ'P'                                       122685
     C************IN52     ANDEQ*ON                                       122685
     C***********WPART     OREQ 'N'                                       122685
     C***********LPFI      ANDEQ'I'                                       122685
     C************IN53     ANDEQ*ON                                       122685
      *
      ** Internal parts purchased and funding participants are updated    122685
      ** just like any normal loan.  Prime facilities are updated only    122685
      ** when sold without recourse just like a parts sold                122685
      ** Also, since future-dated manual repayments can now be entered,   122685
      ** update exposure only when value date is not in the future        122685
      ** Update CAMD of Prime or normal facility only if loan is not                          CLE023
      ** a parts sold.  If CLE023 is installed, update the exposure                           CLE023
      ** only if normal loan or a funded loan is sold without recourse                        CLE023
      *                                                                   122685
     C           WDAYNV    IFLE BJRDNB                                    122685
     C           LPFI      IFNE *BLANK                                    122685
     C************IN52     IFEQ '1'                                       122685
     C***********SACTN     ANDEQ'I'                                       122685
     C***********RCSI      ANDNE'Y'                                       122685
     C************IN53     OREQ '1'                                       122685
     C***********SACTN     ANDEQ'R'                                       122685
     C           SACTN     IFEQ 'I'                                       122685
     C           WPART     ANDEQ'Y'                                       122685
     C           SACTN     OREQ 'R'                                       122685
     C           WPART     ANDEQ'N'                                       122685
     C           RCSI      ANDNE'Y'                                       122685
     C           LPFI      ANDNE'I'                                       147518
      *                                                                   147518
     C           WPART     IFEQ 'Y'                                                           CLE023
     C           CLE023    ANDEQ'Y'                                                           CLE023
     C           CLE023    OREQ 'N'                                                           CLE023
     C           CAMD      SUB  PRAMF     CAMD
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           CEXP      SUB  WPRAMS    CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
      *                                                                   CLE009
      ** If CLE009 is installed, set Work Regeneration Indicator to       CLE009
      ** changed                                                          CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     MOVE 'C'       WKSWRI  1                       CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF
      *
     C************IN52     IFEQ '1'                                       122685
     C***********SACTN     ANDEQ'R'                                       122685
     C***********RCSI      ANDNE'Y'                                       122685
     C************IN53     OREQ '1'                                       122685
     C***********SACTN     ANDEQ'I'                                       122685
     C           SACTN     IFEQ 'R'                                       122685
     C           WPART     ANDEQ'Y'                                       122685
     C           SACTN     OREQ 'I'                                       122685
     C           WPART     ANDEQ'N'                                       122685
     C           RCSI      ANDNE'Y'                                       122685
     C           LPFI      ANDNE'I'                                       147518
      *                                                                   147518
     C           WPART     IFEQ 'Y'                                                           CLE023
     C           CLE023    ANDEQ'Y'                                                           CLE023
     C           CLE023    OREQ 'N'                                                           CLE023
     C           CAMD      ADD  PRAMF     CAMD
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           CEXP      ADD  WPRAMS    CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
      *                                                                   CLE009
      ** If CLE009 is installed, set Work Regeneration Indicator to       CLE009
      ** changed                                                          CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     MOVE 'C'       WKSWRI  1                       CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF
      *
      ** normal, non-syndicated loans                                     122685
      *                                                                   122685
     C                     ELSE
      *
     C           *IN52     IFEQ '0'
     C           SACTN     ANDEQ'I'
     C           *IN52     OREQ '1'
     C           SACTN     ANDEQ'R'
     C           RCSI      ANDNE'Y'
      *                                                                                       CLE023
     C           *IN52     IFEQ '0'                                                           CLE023
     C           CLE023    ANDEQ'Y'                                                           CLE023
     C           CLE023    OREQ 'N'                                                           CLE023
     C           CAMD      SUB  PRAMF     CAMD
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           CEXP      SUB  WPRAMS    CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
      *                                                                   CLE009
      ** If CLE009 is installed, set Work Regeneration Indicator to       CLE009
      ** changed                                                          CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     MOVE 'C'       WKSWRI  1                       CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF
      *
     C           *IN52     IFEQ '0'
     C           SACTN     ANDEQ'R'
     C           *IN52     OREQ '1'
     C           SACTN     ANDEQ'I'
     C           RCSI      ANDNE'Y'
      *                                                                                       CLE023
     C           *IN52     IFEQ '0'                                                           CLE023
     C           CLE023    ANDEQ'Y'                                                           CLE023
     C           CLE023    OREQ 'N'                                                           CLE023
      *                                                                                       205002
      ** if reversed MR is for loan reactivation                                              205002
      *                                                                                       205002
     C           *IN52     IFEQ '0'                                                           205002
     C           SACTN     ANDEQ'R'                                                           205002
     C           SPASD     ANDEQ'Y'                                                           205002
     C           CAMD      SUB  PRAMF     CAMD                                                205002
     C                     ELSE                                                               205002
     C           CAMD      ADD  PRAMF     CAMD
     C                     ENDIF                                                              205002
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
      *                                                                                       205002
      ** if reversed MR is for loan reactivation                                              205002
      *                                                                                       205002
     C           SACTN     IFEQ 'R'                                                           205002
     C           SPASD     ANDEQ'Y'                                                           205002
     C           CEXP      SUB  WPRAMS    CEXP                                                CLE023
     C                     ELSE                                                               205002
     C           CEXP      ADD  WPRAMS    CEXP                                                CLE023
     C                     ENDIF                                                              205002
     C                     ENDIF                                                              CLE023
      *                                                                   CLE009
      ** If CLE009 is installed, set Work Regeneration Indicator to       CLE009
      ** changed                                                          CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     MOVE 'C'       WKSWRI  1                       CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                          122685
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRCIBC   - Sub-routine to see if a customer is also a branch  *
      *            internal customer.                                 *
      * Called by: SRFCLT                                             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRCIBC    BEGSR
      *
     C                     MOVE '0'       *IN43
      *
     C**********           MOVELSCUST     ICUSTN  60                                          CSD027
     C                     MOVELSCUST     ICUSTN  6                                           CSD027
      *
     C                     Z-ADD1         W
     C           ICUSTN    LOKUP@BCA,W                   43
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * QFCLTY   - Sub-routine to update availability array - FCLTY   *
      * Called by: SRFCLT                                             *
      * Calls    : None                                               *
      *****************************************************************
     C           QFCLTY    BEGSR
      *
     C           DAYNO     IFEQ 0
     C                     GOTO ENDFCT
     C                     ENDIF
      *
     C                     Z-ADD1         X       20
     C           ENDAY     LOKUPRUNS,X               40  40
     C           *IN40     IFEQ '0'
     C                     Z-ADD99        X
      *
      ** Pgm LE0480 has been amended so that all non-settled matured
      ** loans are processed as 'Past Due', and in LE0490 the O/S
      ** principal of these loans is included in all elements of the
      ** drawn amount array of the facility.
      ** Therefore, on manual repayment of such loans during I/C,
      ** the availability (i.e. undrawn amount) should be updated
      ** to reflect the repayment.
      ** RUNS,1 = The previous working day
      ** ENDAY  = Maturity date of loan
      *
     C                     ELSE
      *                                                                                       204708
      * If Loan is not autosettled, then the O/S principal of that loan                       204708
      * is included in all elements of the drawn amount array, even                           204708
      * beyond the maturity date of the loan. So this MR amount should                        204708
      * update all elements of the array if the loan is non-autosettled                       204708
      *                                                                .                      204708
     C           AUTOL     IFEQ 'N'                                                           204708
     C                     Z-ADD99        X                                                   204708
     C                     ENDIF                                                              204708
      *                                                                                       204708
     C           ENDAY     IFLE RUNS,1
     C                     Z-ADD99        X
     C                     ENDIF
     C********** ENDAY     IFLT RUNS,1                                                 205535 206443
     C********** RECIL     ANDEQ'M'                                                    205535 206443
     C********** RVCRF     ANDEQ'Y'                                                    205535 206443
     C**********           Z-ADD1         X                                            205535 206443
     C**********           ELSE                                                        205535 206443
     C********** ENDAY     IFEQ RUNS,1                                                 205535 206443
     C********** RECIL     ANDEQ'M'                                                    205535 206443
     C********** RVCRF     ANDEQ'Y'                                                    205535 206443
     C**********           Z-ADD2         X                                            205535 206443
     C**********           ENDIF                                                       205535 206443
     C**********           ENDIF                                                       205535 206443
      **********                                                                       205535 206443
     C                     ENDIF
      *
     C                     Z-ADD1         W       30
     C           DAYNO     LOKUPRUNS,W               40  40
     C           *IN40     IFEQ '0'
     C                     GOTO ENDFCT
     C                     ENDIF
      *
     C           W         DOWLE10
     C           W         ANDLTX
      *
     C           *IN41     IFEQ '1'
     C           OAM,W     SUB  FCBAL     OAM,W
     C                     ENDIF
     C           *IN42     IFEQ '1'
     C           OAM,W     ADD  FCBAL     OAM,W
     C                     ENDIF
      *                                                                   CLE009
      ** If CLE009 is installed, set Work Regeneration Indicator to       CLE009
      ** changed                                                          CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     MOVE 'C'       WKSWRI  1                       CLE009
     C                     ENDIF                                          CLE009
      *
     C           W         ADD  1         W
     C                     ENDDO
      *
     C           ENDFCT    ENDSR
      *
      /EJECT
      *****************************************************************
      * CLEAR    - Clears the message queue                           *
      * Called by: SRSTRT, SRSUBF, SRSTR2, SRDET1                     *
      * Calls    : Y2CLMSC                                            *
      *****************************************************************
     C           CLEAR     BEGSR
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * GLZADD   - Subroutine to add an amount to the total           *
      * Called by: SRTRAL, GLZSUB                                     *
      * Calls    : GLZSUM                                             *
      *****************************************************************
      *
     C           GLZADD    BEGSR
      *
     C                     Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
     C   91                GOTO ZZAEND                     AMT = 0.BYPASS
      *
      * SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
     C                     Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
     C                     MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
      * BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
      *
     C                     EXSR GLZSUM
     C           ZZAEND    ENDSR
      *
      /SPACE 3
      *****************************************************************
      * GLZSUM   - Subroutine to carry out the addition for subroutine*
      * Called by: GLZSUM                                             *
      * Calls    : None                                               *
      *****************************************************************
     C           GLZSUM    BEGSR
      *
     C                     Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
     C                     Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
     C                     SETOF                     919293
     C                     SETOF                     949599
      *
      *    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
     C           ZZAMTI    COMP 0                      9293
     C   93      ZZAMTD    COMP 0                      9293
     C   93                GOTO ZZSEND                     ZERO BYPASS
      *
      *    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
     C           ZZTOTI    COMP 0                      9193
     C   93      ZZTOTD    COMP 0                      9193
      *
      *    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
     C   93                Z-ADDZZAMTI    ZZTOTI
     C   93                Z-ADDZZAMTD    ZZTOTD
     C   93                GOTO ZZSEND                     ZERO BYPASS
      *    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
     C   91N92
     CORN91 92             GOTO ZZOFPS
      *
     C           ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     C           ZZWK2     COMP 999                  93    '93' = CARRY
     C  N93      ZZWK2     COMP -999                   93    INTO INTEGER.
      *
     C   93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
     C      93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
     C   93      ZZTOTI    ADD  ZZWK3     ZZWK3
     C  N93      ZZTOTI    ADD  ZZAMTI    ZZWK3
      *
      * IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
     C  N92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     C   92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     C  N99                Z-ADDZZWK2     ZZTOTD
     C  N99                Z-ADDZZWK3     ZZTOTI
      *
      * IF O/F ZEROISE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
     C   99                Z-ADD0         ZZAMT  153
     C                     GOTO ZZSEND
      *
      * THE 'SIGNS' ARE DIFFERENT
     C           ZZOFPS    TAG
      * IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
      *
     C   92                Z-SUBZZAMTI    ZZAMTI 150
     C   92                Z-SUBZZAMTD    ZZAMTD  30
      *
      * IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
      *
     C   91                Z-SUBZZTOTI    ZZTOTI
     C   91                Z-SUBZZTOTD    ZZTOTD
      * BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
      *
     C           ZZTOTI    COMP ZZAMTI               93  95
     C   95      ZZTOTD    COMP ZZAMTD               93  95
      *
      * IF ZZTOT EQ. ZZAMT RETURN ZERO.
     C   95                Z-ADD0         ZZTOTI
     C   95                Z-ADD0         ZZTOTD
     C   95                GOTO ZZSEND
      *
      * IF ZZTOT GT. ZZAMT.
     C   93      ZZAMTD    COMP ZZTOTD               94
     C   93 94   ZZTOTI    SUB  1         ZZTOTI
     C   93 94   ZZTOTD    ADD  1000      ZZWK2
     C   93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     C   93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     C   93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
      *
      *
      * IF ZZAMT GT. ZZTOT.
     C  N93      ZZTOTD    COMP ZZAMTD               94
     C  N93 94   ZZAMTI    SUB  1         ZZWK3  150
     C  N93 94   ZZAMTD    ADD  1000      ZZWK2
     C  N93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     C  N93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     C  N93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     C  N93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
      *
      * REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
     C                     SETOF                     94
     C   93 91
     CORN93 92             SETON                     94
     C   94                Z-SUBZZTOTI    ZZTOTI
     C   94                Z-SUBZZTOTD    ZZTOTD
      *
      *    RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
     C   92                Z-SUBZZAMTI    ZZAMTI
     C   92                Z-SUBZZAMTD    ZZAMTD
     C           ZZSEND    TAG
      *
      *    IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
     C                     SETOF                     96
     C           ZZTOTD    COMP 0                        91
     C   91      ZZTOTI    COMP 0                      96
     C   96                MOVE '.000-'   ZZNEGD  5
     C                     ENDSR
      *
      /SPACE 3
      *****************************************************************
      * GLZSUB   - Subroutine to subtract an amount from the total    *
      * Called by: SRTRAL                                             *
      * Calls    : GLZADD                                             *
      *****************************************************************
     C           GLZSUB    BEGSR
      * PROCESSING. JUST REVERSE THE 'SIGN' AND ADD
     C                     Z-SUBZZAMT     ZZAMT  153       REVERSE 'SIGN'
     C                     EXSR GLZADD                       AND 'ADD'
     C                     Z-SUBZZAMT     ZZAMT            RESTORE 'SIGN'
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRENDC   - End Closedown                                      *
      * Called by: Main Processing                                    *
      * Calls    : None                                               *
      *****************************************************************
     C           SRENDC    BEGSR
     C                     SETON                     LR
      *
      ** Call SD2400 w/ termination parameter to close program
      *
     C           PMODE     IFNE 'B'                                       119594
     C           PMODE     ANDNE'P'                                       119594
     C                     MOVE 'T'       PMTERM
     C                     CALL 'SD2400'
     C                     PARM           @RTCD
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           SLOAN
     C                     ENDIF                                          119594
      *
     C                     RETRN
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * BCASR    - Sub-routine to set-up array of Branch Internal     *
      *            Customer Numbers                                   *
      * Called by: SRINIT                                             *
      * Calls    : None                                               *
      *****************************************************************
     C           BCASR     BEGSR
      *
     C                     READ SDBRCHL5                 43
      *
     C           *IN43     IFEQ '0'
      *
     C                     Z-ADD1         I       30
      *
     C           *IN43     DOWEQ'0'
      *
     C                     MOVE BICN      @BCA,I
     C                     ADD  1         I
      *
     C                     READ SDBRCHL5                 43
      *
      ** End of DOW
      *
     C                     ENDDO
      *
     C                     ELSE
      *
      ** Set-up local data area for reporting database error
      *
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRCHL5'DBFILE           ************
     C                     MOVEL'*READ'   DBKEY            * DBERR 31 *
     C                     Z-ADD031       DBASE            ************
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     OUT  LDA
      *
      ** End of IF...ELSE statement
      *
     C                     ENDIF
      *
     C                     MOVE '0'       *IN43
      *
     C                     ENDSR
      *
      /EJECT                                                              123998
      *****************************************************************   143802
      * SRUPPS   - Update Part Sold amount for Assignments            *   143802
      * Called by: SRBTCH                                             *   143802
      * Calls    : None                                               *   143802
      *****************************************************************   143802
      *                                                                   143802
     C           SRUPPS    BEGSR                                          143802
      *                                                                   143802
     C                     Z-ADD0         W#PRAM 130                      143802
     C**********           Z-ADD0         WLOAN                                        143802 CLE148
     C                     MOVEL*BLANKS   WLOAN                                               CLE148
      *                                                                   143802
      **Only process if assignment flag is set                            143802
      *                                                                   143802
     C           PIGASS    IFEQ 'A'                                       143802
      *                                                                   143802
      **Access Loans file using loan number                               143802
      *                                                                   143802
     C                     MOVE PILOAN    WLOAN                           143802
     C           KCLOAN    CHAINCLOAN                80                   143802
      *                                                                   143802
     C           *IN80     IFEQ *OFF                                      143802
     C**********           Z-ADD0         WLOAN                                        143802 CLE148
     C                     MOVEL*BLANKS   WLOAN                                               CLE148
      *                                                                   143802
      **If Mirror number not blank i.e. Loan is Part Purchased access     143802
      **loans file using this number for main loan details                143802
      *                                                                   143802
     C           MLNR      IFNE *ZERO                                     143802
      *                                                                   143802
     C                     MOVE MLNR      WLOAN                           143802
     C           KCLOAN    CHAINCLOAN                80                   143802
      *                                                                   143802
     C                     ELSE                                           143802
      *                                                                   143802
      **If Loan is Part Sold Mirror Loan no will be blank so use OLNO     143802
      **as key to access main loan details                                143802
      *                                                                   143802
     C           PTYPL     IFEQ 66                                        143802
     C           PTYPL     OREQ 67                                        143802
     C           PTYPL     OREQ 69                                        143802
     C                     MOVE OLNO      WLOAN                           143802
     C           KCLOAN    CHAINCLOAN                80                   143802
      *                                                                   143802
     C                     ELSE                                           143802
      *                                                                   143802
     C                     MOVE *ON       *IN80                           143802
      *                                                                   143802
     C                     ENDIF                                          143802
      *                                                                   143802
     C                     ENDIF                                          143802
      *                                                                   143802
     C           *IN80     IFEQ *OFF                                      143802
      *                                                                   143802
      **If action code is 'I' subtract principal amount from total sold   143802
      **amount                                                            143802
      *                                                                   143802
      *                                                                   143802
     C                     MOVEL*BLANKS   ZFIELD                          143802
     C                     MOVE PIPAMT    ZFIELD                          143802
     C                     Z-ADDWCDP      ZADEC                           143802
     C           13        SUB  WCDP      ZADIG                           143802
     C                     EXSR ZALIGN                                    143802
     C                     MOVE ZFIELD    W#PRAM                          143802
      *                                                                   143802
     C           SACTN     IFEQ 'I'                                       143802
      *                                                                   143802
     C           PSAM      SUB  W#PRAM    PSAM                            143802
      *                                                                   143802
     C                     ENDIF                                          143802
      *                                                                   143802
      **If action code is 'A' add principal amount back in from details   143802
      **of original ammendment saved from LOAMSDK and subtract            143802
      **ammended principal amount.                                        143802
      *                                                                   143802
     C           SACTN     IFEQ 'A'                                       143802
      *                                                                   143802
     C           PSAM      ADD  W#PRLA    PSAM                            143802
      *                                                                   143802
     C           PSAM      SUB  W#PRAM    PSAM                            143802
      *                                                                   143802
     C                     ENDIF                                          143802
      *                                                                   143802
      **Update Amended Part Sold amount on Loan Master File               143802
      *                                                                   143802
     C                     UPDATCLOANCLF                                  143802
     C                     ENDIF                                          143802
      *                                                                   143802
     C                     ENDIF                                          143802
      *                                                                   143802
     C                     ENDIF                                          143802
      *                                                                   143802
     C                     ENDSR                                          143802
      /EJECT                                                              157744
      *****************************************************************   157744
      *  SRPNAM - Calculate the Penalty amount                        *   157744
      *  Called by: SRFRMT                                            *   157744
      *  Calls    : None                                              *   157744
      *****************************************************************   157744
      *                                                                   157744
     C           SRPNAM    BEGSR                                          157744
      *                                                                   157744
      ** If Late Payment type is 'A', expected penalty will be            157744
      ** equal to the late payment amount                                 157744
      *                                                                   157744
     C           LPTP      IFEQ 'A'                                       157744
     C           FCCYF     IFEQ CCYL                                      157744
     C                     Z-ADDLPAM      WEPAM  130                      157744
      *                                                                   157744
     C                     ELSE                                           157744
      *                                                                   157744
     C           FMDI      IFEQ 'M'                                       157744
     C           LPAM      DIV  FCXR      WEPAM                           157744
     C                     ELSE                                           157744
     C           LPAM      MULT FCXR      WEPAM                           157744
     C                     ENDIF                                          157744
     C                     ENDIF                                          157744
     C                     ENDIF                                          157744
      *                                                                   157744
      ** If Late Payment Type is 'P'                                      157744
      *                                                                   157744
     C           LPTP      IFEQ 'P'                                       157744
     C                     MOVELLPBR      WLPBR   2                       157744
     C                     Z-ADDLPAM      WLPAM                           157744
      *                                                                   157744
      ** Determine the rate                                               157744
      *                                                                   157744
     C           LPBR      IFNE *ZEROS                                    157744
      *                                                                   157744
      ** Access base rate codes file                                      157744
      *                                                                   157744
     C                     CALL 'AOBSRTR0'                                157744
     C                     PARM *BLANKS   PRTCD                           157744
     C                     PARM '*KEY   ' POPTN                           157744
     C                     PARM FCCY      PCCY    3                       157744
     C                     PARM WLPBR     PBSRT   2                       157744
     C********** SDBSRT    PARM SDBSRT    DSFDY                     157744CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
      *                                                                   157744
     C           PRTCD     IFEQ *BLANKS                                   157744
     C           LPPS      IFEQ '+'                                       157744
     C           BACBSR    ADD  WRATE1    WRATE  117                      157744
     C                     ELSE                                           157744
     C           BACBSR    SUB  WRATE1    WRATE                           157744
     C                     ENDIF                                          157744
     C                     ENDIF                                          157744
      *                                                                   157744
      ** If Late Penalty Base Rate is blanks, rate will be equal          157744
      ** to the Late Penalty Amount                                       157744
      *                                                                   157744
     C                     ELSE                                           157744
     C                     Z-ADDWRATE1    WRATE                           157744
     C                     ENDIF                                          157744
      *                                                                   157744
      ** Compute for penalty                                              157744
      *                                                                   157744
     C                     Z-ADDWDAYNE    ZIBEG                           157744
     C                     Z-ADDWDAYNV    ZIEND                           157744
     C                     Z-ADDICBS      ZICALC                          157744
     C                     Z-ADDWEXTOT    ZIAMT                           157744
     C                     Z-ADDWRATE     ZIRATE                          157744
     C                     EXSR GLINTC                                    157744
     C                     Z-ADDZINTR     WEPAM                           157744
     C                     ENDIF                                          157744
      *                                                                   157744
     C                     ENDSR                                          157744
      *****************************************************************   123998
      * SRTEXT  -  Set up text from message file                      *   123998
      * Called by: All subroutines setting of texts                   *   123998
      * Calls    : None                                               *   123998
      *****************************************************************   123998
     C           SRTEXT    BEGSR                                          123998
      *                                                                   123998
     C                     CALL 'Y2RVMGC'                                 123998
     C                     PARM *BLANKS   PRTCD                           123998
     C                     PARM           ZAMSID           Message Id.    123998
     C                     PARM           ZAMSGF           Message file.  123998
     C                     PARM           ZAMSDA           Message data.  123998
     C                     PARM           ZAMSTX           Messge text    123998
      *                                                                   123998
     C                     ENDSR                                          123998
      /EJECT
      *****************************************************************
      * ZASNMS   - Send message to program's message queue            *
      * Called by:                                                    *
      * Calls    : Y2SNMGC                                            *
      *****************************************************************
     C           ZASNMS    BEGSR
      *
     C                     MOVE ' '       WMSEV   1
      *
     C           WWERR     IFEQ 'Y'
     C           WERR      ANDNE'Y'                                                           259328
     C                     MOVE 'W'       WMSEV
     C                     ELSE
     C                     MOVE 'E'       WMSEV
     C                     ENDIF
      *                                                                                     AR870590
     C           PMODE     IFEQ 'B'                                                         AR870590
     C           POMSVR    ANDEQ'D'                                                         AR870590
     C                     MOVE 'D'       WMSEV                                             AR870590
     C                     ENDIF                                                            AR870590
      *
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     ENDIF
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           PMODE     OREQ 'F'                                       CAP063
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message Id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C                     PARM           ZAMSTP  7        Message type.
      *
      ** Get error message text for batch/play mode
      ** and cancel processing
      *
     C                     ELSE
      *
     C                     CALL 'Y2RVMGC'
     C                     PARM           PRTCD
     C                     PARM           ZAMSID           Message Id.
     C                     PARM           ZAMSGF           Message file.
     C                     PARM           ZAMSDA           Message data.
     C                     PARM           ZAMSTX132        Messge text
      *
     C           PMODE     IFEQ 'P'
     C                     MOVE L2110S    L2110F
     C                     MOVE WMSEV     MSVR
     C                     MOVELZAMSID    MSID
     C                     MOVELZAMSTX    MSTX
     C                     ELSE
     C                     MOVELWMSEV     POMSVR
     C                     MOVELZAMSID    POMSID
     C                     MOVELZAMSTX    POMSTX
     C                     ENDIF
      *                                                                   120468
      *  Include DUMP here for problems during batch and play modes.      120468
      *                                                                   120468
     C           WERR      IFEQ 'Y'                                       120468
     C           PIRPLC    IFEQ 'B'                                       CAP063
     C           CAP063    ANDEQ'Y'                                       CAP063
     C                     CALL 'LEC0215'                                 CAP063
     C                     PARM           XREPN                           CAP063
      *                                                                   CAP063
      ** Set up invalid file fields                                       CAP063
      *                                                                   CAP063
     C                     MOVELZAMSID    XMSID                           CAP063
     C                     MOVELPILOAN    FLNRF                           CAP063
     C                     MOVE 'MR'      FAMTP                           CAP063
     C                     MOVE BRCA      SSBRC                           CAP063
     C                     MOVE *BLANK    ASTS                            CAP063
      *                                                                   CAP063
      ** Set up SD2400 invalid file fields                                CAP063
      *                                                                   CAP063
     C                     MOVELPMRSTM    SFRSTM    P                     CAP063
     C                     MOVELPMRONS    SFRONS    P                     CAP063
     C                     MOVELPAROBN    SFROBN    P                     CAP063
     C                     MOVELPAROCN    SFROCN    P                     CAP063
     C                     MOVELPARIBN    SFRIBN    P                     CAP063
     C                     MOVELPMRIBA    SFRIBA    P                     CAP063
     C                     MOVELPMPSTM    SFPSTM    P                     CAP063
     C                     MOVELPMPONS    SFPONS    P                     CAP063
     C                     MOVELPAPOBN    SFPOBN    P                     CAP063
     C                     MOVELPAPOCN    SFPOCN    P                     CAP063
     C                     MOVELPAPIBN    SFPIBN    P                     CAP063
     C                     MOVELPMPIBA    SFPIBA    P                     CAP063
     C                     MOVELPARCRN    SFRCRN    P                     CAP063
     C                     MOVELPMRCRA    SFRCRA    P                     CAP063
     C                     MOVELPARVNO    SFRVNO    P                     CAP063
     C                     MOVELPAAWBN    SFAWBN    P                     CAP063
     C                     MOVELPMAWBA    SFAWBA    P                     CAP063
     C                     MOVELPABENN    SFBENN    P                     CAP063
     C                     MOVELPMBENA    SFBENA    P                     CAP063
     C                     MOVELPMDTP1    SFDTP1    P                     CAP063
     C                     MOVELPMDTP2    SFDTP2    P                     CAP063
     C                     MOVELPMDTP3    SFDTP3    P                     CAP063
     C                     MOVELPMDTP4    SFDTP4    P                     CAP063
     C                     MOVELPMDCHG    SFDCHG    P                     CAP063
     C                     MOVELPMBTB1    SFBTB1    P                     CAP063
     C                     MOVELPMBTB2    SFBTB2    P                     CAP063
     C                     MOVELPMBTB3    SFBTB3    P                     CAP063
     C                     MOVELPMBTB4    SFBTB4    P                     CAP063
     C                     MOVELPMBTB5    SFBTB5    P                     CAP063
     C                     MOVELPMBTB6    SFBTB6    P                     CAP063
     C                     MOVELPMCVMR    SFCVMR    P                     CAP063
     C                     MOVELPMBTB6    SFBTB6    P                     CAP063
     C                     MOVELPMIC72    SFICCY    P                     CAP063
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELPMRSCY    SFSCCY                                              CLE031
     C                     MOVELPMPSCY    SFPSCY                                              CLE031
     C                     MOVELPMREXR    SFREXR                                              CLE031
     C                     MOVELPMPEXR    SFPEXR                                              CLE031
     C                     MOVELPMREXI    SFREXI                                              CLE031
     C                     MOVELPMPEXI    SFPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C*                                                                   CSC011
     C           PCRFK     IFEQ *BLANKS                                   CSC011
     C                     MOVELPITREF    STNRF                           CSC011
     C                     ELSE                                           CSC011
     C                     MOVELPCRFK     STNRF                           CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C           PITDST    IFEQ *BLANKS                                   CSC011
     C           PITTST    OREQ *BLANKS                                   CSC011
     C                     CALL 'ZAGENTS'                                 CSC011
     C                     PARM ZATMST    ZATMST 26                       CSC011
     C                     MOVE ZATMST    TSTISO                          CSC011
     C                     ELSE                                           CSC011
     C                     MOVE PITDST    WPITDS                          CSC011
     C                     MOVE WPIDD     TSTDD                           CSC011
     C                     MOVE WPIMM     TSTMM                           CSC011
     C                     MOVELWPICC     TSTYY                           CSC011
     C                     MOVE WPIYY     TSTYY                           CSC011
     C                     MOVE PITTST    WTSTM                           CSC011
     C                     MOVE WTSHR     TSTTM1                          CSC011
     C                     MOVE WTSMN     TSTTM2                          CSC011
     C                     MOVE WTSSC     TSTTM3                          CSC011
     C                     MOVE '000000'  TSTTM4                          CSC011
     C                     ENDIF                                          CSC011
     C                     MOVE TSTISO    STMST                           CSC011
      *                                                                   CAP063
     C                     WRITELEIMRPD0                                  CAP063
     C                     COMIT                                          CAP063
     C                     ELSE                                           CAP063
      *                                                                   CAP063
     C                     DUMP                                           120468
     C                     ENDIF                                          CAP063
     C                     ENDIF                                          120468
      *
     C           WMSEV     IFEQ 'E'
     C           WMSEV     OREQ 'D'                                                         AR870590
     C           PMODE     IFNE 'B'                                       120002
     C                     ROLBK
     C                     ENDIF                                          120002
      *                                                                   CAP063
      * If not a warning error, in batch mode, and repair in back-office  CAP063
      *                                                                   CAP063
     C           WMSEV     IFEQ 'E'                                       CAP063
     C           PMODE     ANDEQ'B'                                       CAP063
     C           PIRPLC    ANDEQ'B'                                       CAP063
     C           CAP063    ANDEQ'Y'                                       CAP063
     C                     MOVEL*BLANK    POMSVR                          CAP063
     C                     MOVE '1'       *INLR                           CAP063
     C                     RETRN                                          CAP063
     C                     ENDIF                                          CAP063
      *
     C           PMODE     IFEQ 'P'
     C                     UPDATLE2110D0
     C                     CLOSELE2110PD
     C                     ENDIF
      *
     C                     MOVE *ON       *INLR
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           ZAEXIT    ENDSR
      *
      /EJECT
      *****************************************************************   159256
      * SRWARN   - Send a warning message if a syndicated loan is     *   159256
      *            being amended, reversed or authorised directly on  *   159256
      *            Midas as Loan Manager should be used to take       *   159256
      *            advantage of the autogeneration process.           *   159256
      * Called by: SRSTRT, SRDET1                                     *   159256
      * Calls    : None                                               *   159256
      *****************************************************************   159256
     C           SRWARN    BEGSR                                          159256
      *                                                                   159256
     C           PMODE     IFEQ 'I'                                       159256
     C           PMODE     OREQ 'F'                                       CAP063
      *                                                                   159256
      ** Only issue the warning once for the same transaction.            159256
      *                                                                   159256
     C           WE232     IFEQ *BLANK                                    159256
     C           WE232     OREQ 'Y'                                       159256
     C           SLOAN     ANDNEW1LNRF                                    159256
     C                     MOVELSLOAN     W1LNRF  6                       159256
      *                                                                   159256
      ** Warn if participation linked to a syndicate                      159256
      *                                                                   159256
     C           PTYPL     IFEQ 64                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYPL     OREQ 65                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYPL     OREQ 66                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYPL     OREQ 67                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYPL     OREQ 68                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYPL     OREQ 69                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYPL     OREQ 71                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYPL     OREQ 72                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C                     MOVE 'LEM0232' ZAMSID                          159256
     C                     EXSR ZASNMS                                    159256
     C                     MOVE 'Y'       WE232   1                       159256
     C                     MOVE 'Y'       WARN                            159256
      *                                                                   159256
     C                     ELSE                                           159256
      *                                                                   159256
     C                     MOVE *BLANKS   WE232                           159256
      *                                                                   159256
      ** Warn if loan or direct participation purchased but facility      159256
      ** is syndicated.                                                   159256
      *                                                                   159256
     C           PTYPL     IFEQ 61                                        159256
     C           PTYPL     OREQ 62                                        159256
     C           PTYPL     OREQ 63                                        159256
     C           PTYPL     OREQ 64                                        159256
     C           LNKS      ANDNE'Y'                                       159256
     C           PTYPL     OREQ 65                                        159256
     C           LNKS      ANDNE'Y'                                       159256
     C           PTYPL     OREQ 68                                        159256
     C           LNKS      ANDNE'Y'                                       159256
     C           PTYPL     OREQ 70                                        159256
     C           PTYPL     OREQ 71                                        159256
     C           LNKS      ANDNE'Y'                                       159256
      *                                                                   159256
     C                     MOVE 'A'       WRCDT1                          159256
     C                     MOVE FCUS      WFCUS                           159256
     C                     MOVE FTYP      WFTYP                           159256
     C                     MOVE FSEQ      WFSEQ                           159256
      *                                                                   159256
     C********** KFCLT     CHAINFCLTY                57            159256 192949
     C           KFCLT     CHAINFCLTY               N57                   192949
     C           SYIN      IFEQ 'Y'                                       159256
     C                     MOVE 'LEM0232' ZAMSID                          159256
     C                     EXSR ZASNMS                                    159256
     C                     MOVE 'Y'       WE232                           159256
     C                     MOVE 'Y'       WARN                            159256
     C                     ENDIF                                          159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDIF                                          159256
     C                     ELSE                                           159256
      *                                                                   159256
     C                     MOVE *BLANKS   WE232                           159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDSR                                          159256
      *                                                                   159256
      /EJECT                                                              165031
      *****************************************************************   165031
      * SRCLSD   - Sub-routine to clear settlement details prior to   *   165031
      *            writing record.                                    *   165031
      * Called by: SRINMR                                             *   165031
      * Calls    : None                                               *   165031
      *****************************************************************   165031
     C           SRCLSD    BEGSR                                          165031
      *                                                                   165031
     C                     CLEARRSTM                                      165031
     C                     CLEARRONS                                      165031
     C                     CLEARRIBN                                      165031
     C                     CLEARRIBA                                      165031
     C                     CLEARROBN                                      165031
     C                     CLEARROCN                                      165031
     C                     CLEARPSTM                                      165031
     C                     CLEARPONS                                      165031
     C                     CLEARPIBN                                      165031
     C                     CLEARPIBA                                      165031
     C                     CLEARPOBN                                      165031
     C                     CLEARPOCN                                      165031
     C                     CLEARRCRN                                      165031
     C                     CLEARRCRA                                      165031
     C                     CLEARRVNO                                      165031
     C                     CLEARAWBN                                      165031
     C                     CLEARAWBA                                      165031
     C                     CLEARBENN                                      165031
     C                     CLEARBENA                                      165031
     C                     CLEARDTP1                                      165031
     C                     CLEARDTP2                                      165031
     C                     CLEARDTP3                                      165031
     C                     CLEARDTP4                                      165031
     C                     CLEARDCHG                                      165031
     C                     CLEARBTB1                                      165031
     C                     CLEARBTB2                                      165031
     C                     CLEARBTB3                                      165031
     C                     CLEARBTB4                                      165031
     C                     CLEARBTB5                                      165031
     C                     CLEARBTB6                                      165031
     C                     CLEARCVMR                                      165031
      *                                                                   165031
     C                     ENDSR                                          165031
      *                                                                   165031
      /EJECT                                                              165031
      *****************************************************************   CSC011
      *                                                                   CSC011
      *  LOG247  -  Convert fields to the format required to be       *   CSC011
      *             written to the 24x7 Midas Availability Log        *   CSC011
      *  Called by: SRUPDT                                            *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           LOG247    BEGSR                                          CSC011
      *                                                                   CSC011
     C                     CLEARPINPP                                     CSC011
     C                     MOVE 'LAMR'    PIMTYP                          CSC011
     C                     MOVE USER      PITUSR                          CSC011
     C                     MOVE WSID      PITWST                          CSC011
     C                     MOVE SACTN     PITACT                          CSC011
     C*                                                                   CSC011
     C                     CALL 'ZAGENTS'                                 CSC011
     C                     PARM ZATMST    ZATMST 26                       CSC011
     C                     MOVE ZATMST    TSTISO                          CSC011
     C*                                                                   CSC011
     C           PITDST    IFEQ *BLANKS                                   CSC011
     C                     MOVE TSTYY     WPIYY                           CSC011
     C                     MOVE TSTMM     WPIMM                           CSC011
     C                     MOVE TSTDD     WPIDD                           CSC011
     C                     MOVE WPITDS    PITDST                          CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     MOVELTSTTM1    WSTM1   40                      CSC011
     C                     MOVE TSTTM2    WSTM1                           CSC011
     C                     MOVELTSTTM3    WSTM2   40                      CSC011
     C                     MOVELTSTTM4    WSTM3   20                      CSC011
     C                     MOVELWSTM1     PITTST                          CSC011
     C                     MOVE WSTM3     WSTM2                           CSC011
     C                     MOVE WSTM2     PITTST                          CSC011
     C*                                                                   CSC011
     C                     MOVE SLOAN     PILOAN                          CSC011
     C                     MOVE SSEQN     PIMRSQ                          CSC011
     C*                                                                   CSC011
     C                     MOVE SEVAL     WPITDS                          CSC011
     C                     MOVELSEVAL     WPITDS                          CSC011
     C                     MOVE *BLANKS   WPICC                           CSC011
     C                     MOVE WPITDS    PIXDAT                          CSC011
     C*                                                                   CSC011
     C                     MOVE SESEQ     PIXSEQ                          CSC011
     C                     MOVE SCUST     PICSNO                          CSC011
     C                     MOVE SRPRI     PIPAMT                          CSC011
     C                     MOVE SPSIG     PIPSGN                          CSC011
     C                     MOVE SRINT     PIIAMT                          CSC011
     C                     MOVE SISIG     PIISGN                          CSC011
     C                     MOVE SRTOT     PITAMT                          CSC011
     C                     MOVE SRSIG     PITSGN                          CSC011
     C                     MOVE SWOFF     PIWOFF                          CSC011
     C                     MOVE PMPSTM    PIPSTM                          CSC011
     C                     MOVE PMPONS    PIPONS                          CSC011
     C                     MOVE PARVNO    PIPREC                          CSC011
     C                     MOVE PMCVMR    PICVMR                          CSC011
     C                     MOVE PMPOCN    PIPOCN                          CSC011
     C                     MOVE PMPOBN    PIPOBN                          CSC011
     C                     MOVE PMRCRN    PIRCRN                          CSC011
     C                     MOVE PMRCRA    PIRCRA                          CSC011
     C                     MOVE PMPIBN    PIPIBN                          CSC011
     C                     MOVE PMPIBA    PIPIBA                          CSC011
     C                     MOVE PMAWBN    PIAWBN                          CSC011
     C                     MOVE PMAWBA    PIAWBA                          CSC011
     C                     MOVE PMBENN    PIBENN                          CSC011
     C                     MOVE PMBENA    PIBENA                          CSC011
     C                     MOVE PMRSTM    PIRSTM                          CSC011
     C                     MOVE PMRONS    PIRONS                          CSC011
     C                     MOVE PMROCN    PIROCN                          CSC011
     C                     MOVE PMROBN    PIROBN                          CSC011
     C                     MOVE PMRIBN    PIRIBN                          CSC011
     C                     MOVE PMRIBA    PIRIBA                          CSC011
     C                     MOVE PMDTP1    PIDTP1                          CSC011
     C                     MOVE PMDTP2    PIDTP2                          CSC011
     C                     MOVE PMDTP3    PIDTP3                          CSC011
     C                     MOVE PMDTP4    PIDTP4                          CSC011
     C                     MOVE PMDCHG    PIDCHG                          CSC011
     C                     MOVE PMBTB1    PIBTB1                          CSC011
     C                     MOVE PMBTB2    PIBTB2                          CSC011
     C                     MOVE PMBTB3    PIBTB3                          CSC011
     C                     MOVE PMBTB4    PIBTB4                          CSC011
     C                     MOVE PMBTB5    PIBTB5                          CSC011
     C                     MOVE PMBTB6    PIBTB6                          CSC011
     C                     MOVE SPASD     PIPAST                          CSC011
     C                     MOVE SRPEN     PIPEAM                          CSC011
     C                     MOVE SRPIG     PIPESN                          CSC011
     C                     MOVE IUSR      PIIUSR                          CSC011
     C                     MOVE AUSR      PIAUSR                          CSC011
     C                     MOVE XUSR      PIXUSR                          CSC011
     C                     MOVE PCOB      PIPCOB                          CSC011
     C                     MOVE PMRSCY    PISCCY                          CSC011
     C                     MOVE PMIC72    PIICCY                          CSC011
     C                     MOVE GASS      PIGASS                          CSC011
     C*                                                                   CSC011
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PISCCY    PIPSCY                                              CLE031
     C                     MOVE PMREXR    PIREXR                                              CLE031
     C                     MOVE PMREXI    PIREXI                                              CLE031
     C                     MOVE PMPEXR    PIPEXR                                              CLE031
     C                     MOVE PMPEXI    PIPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR                                          CSC011
      *                                                                   CSC011
      /EJECT                                                              CSC011
      *****************************************************************   CSC011
      *  APLGTR  -  Write facility transaction to the 24X7 Midas      *   CSC011
      *             availability Log File                             *   CSC011
      *  Called by: SRUPDT                                            *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           APLGTR    BEGSR                                          CSC011
      *                                                                   CSC011
     C                     MOVE TSTISO    APSTMS                          CSC011
     C                     MOVEL'LE'      W#MSGT  6                       CSC011
     C                     MOVE PIMTYP    W#MSGT                          CSC011
     C                     MOVELW#MSGT    APMTYP                          CSC011
     C                     MOVE '  '      APMTYP                          CSC011
      *                                                                   CSC011
     C           PCRFK     IFEQ *BLANKS                                   CSC011
     C                     MOVELPITREF    APSOFC                          CSC011
     C                     ELSE                                           CSC011
     C                     MOVELPCRFK     APSOFC                          CSC011
     C                     ENDIF                                          CSC011
     C                     MOVELPINPP     APTRAN                          CSC011
      *                                                                   CSC011
      ** If timestamp field is blank, then call ZAGENTS to set it up      CSC011
      *                                                                   CSC011
     C           APSTMS    IFEQ *BLANKS                                   CSC011
     C                     CALL 'ZAGENTS'                                 CSC011
     C                     PARM ZATMST    ZATMST 26                       CSC011
     C                     MOVE ZATMST    APSTMS                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C           LOGVAL    IFEQ 'V'                                       CSC011
     C                     OPEN APVLOGPD                                  CSC011
     C                     WRITEAPVLOGD0                                  CSC011
     C                     CLOSEAPVLOGPD                                  CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C           LOGVAL    IFEQ 'I'                                       CSC011
     C                     OPEN APILOGPD                                  CSC011
     C                     WRITEAPILOGD0                                  CSC011
     C                     CLOSEAPILOGPD                                  CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     ENDSR                                          CSC011
      *                                                                   CSC011
      /EJECT                                                              CSC011
      *****************************************************************   CSC011
      *  LOGDEL  -  Delete record from 24x7 Midas availability log    *   CSC011
      *             file                                              *   CSC011
      *  Called by: SRWRIT, SRUPDT                                    *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           LOGDEL    BEGSR                                          CSC011
      *                                                                   CSC011
     C                     MOVEL'LE'      W#MSGT                          CSC011
     C                     MOVE 'LAMR'    W#MSGT                          CSC011
     C                     MOVELW#MSGT    KMTYPE                          CSC011
     C                     MOVE '  '      KMTYPE                          CSC011
     C                     MOVELSTNRF     KFOID                           CSC011
     C                     MOVE STMST     KTSTMP                          CSC011
      *                                                                   CSC011
     C                     OPEN APILOGL0                                  CSC011
     C           KAPLOG    CHAINAPILOGX0             99                   CSC011
     C           *IN99     IFEQ *OFF                                      CSC011
     C                     DELETAPILOGX0                                  CSC011
     C                     ENDIF                                          CSC011
     C                     CLOSEAPILOGL0                                  CSC011
      *                                                                   CSC011
     C                     ENDSR                                          CSC011
      *                                                                   CSC011
      /EJECT                                                              CSC011
      *****************************************************************                       CLE028
      *  SROSIN - Compute for outstanding interest via Rule of 78     *                       CLE028
      *****************************************************************                       CLE028
     C           SROSIN    BEGSR                                                              CLE028
      *                                                                                       CLE028
     C                     Z-ADDVDAT      W78VDT                                              CLE028
     C                     Z-ADDMDAT      W78MDT                                              CLE028
     C                     Z-ADDFLTI      W78FLT                                              CLE028
     C                     MOVE RFRQ      W78RPF                                              CLE028
     C                     Z-ADDFRPD      W78FRD                                              CLE028
     C                     Z-ADDRDYN      W78RPM                                              CLE028
     C                     MOVE CCYL      W78CCY                                              CLE028
     C                     MOVE *BLANKS   W78LCN                                              CLE028
     C                     Z-ADDVDAT      W78BEG                                              CLE028
     C                     Z-ADDZIEND     W78END                                              CLE028
     C                     MOVE 'A'       W78ROA                                              CLE028
      *                                                                                       CLE028
     C                     EXSR RULE78                                                        CLE028
      *                                                                                       CLE028
     C                     Z-ADDW78INT    ZINTR                                               CLE028
      *                                                                                       CLE028
     C                     ENDSR                                                              CLE028
      *****************************************************************                       CLE028
      /EJECT                                                                                  CLE028
      *****************************************************************                       CLE028
      *  SRRFND - Compute for Interest refunded and Charges refunded  *                       CLE028
      *****************************************************************                       CLE028
     C           SRRFND    BEGSR                                                              CLE028
      *                                                                                       CLE028
     C                     Z-ADDVDAT      W78VDT                                              CLE028
     C                     Z-ADDMDAT      W78MDT                                              CLE028
     C                     Z-ADDFLTI      W78FLT                                              CLE028
     C                     MOVE RFRQ      W78RPF                                              CLE028
     C                     Z-ADDFRPD      W78FRD                                              CLE028
     C                     Z-ADDRDYN      W78RPM                                              CLE028
     C                     MOVE CCYL      W78CCY                                              CLE028
     C                     MOVE *BLANKS   W78LCN                                              CLE028
     C           WDAYNV    IFEQ MDAT                                                          CLE028
     C                     Z-ADDMDAT      W78BEG                                              CLE028
     C                     ELSE                                                               CLE028
     C           WDAYNV    ADD  1         W78BEG                                              CLE028
     C                     ENDIF                                                              CLE028
     C                     Z-ADDMDAT      W78END                                              CLE028
     C                     MOVE 'A'       W78ROA                                              CLE028
     C                     EXSR RULE78                                                        CLE028
      *                                                                                       CLE028
      ** Compute for interest refunded if manual payment is for early                         CLE028
      ** pay-offs and Add on interest is 'Y'                                                  CLE028
      *                                                                                       CLE028
     C           SESEQ     IFEQ *BLANKS                                                       CLE028
     C           ADIF      ANDEQ'Y'                                                           CLE028
     C                     Z-SUBW78INT    WINRF  130H                                         CLE028
     C                     MOVE *BLANKS   ZFLD15                                              CLE028
     C                     MOVE WINRF     ZFLD15                                              CLE028
     C                     Z-ADDWCDP      ZDECS                                               CLE028
     C                     MOVE 'J'       ZECODE                                              CLE028
     C                     EXSR ZFRPED                                                        CLE028
     C                     MOVE ZOUT22    #1INRF                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** Compute for charges refunded if manual payment is for early                          CLE028
      ** pay-offs and Add on charges is 'Y'                                                   CLE028
      *                                                                                       CLE028
     C           SESEQ     IFEQ *BLANKS                                                       CLE028
     C           ADCF      ANDEQ'Y'                                                           CLE028
      *                                                                                       CLE028
      ** Compute for charge amount per payment                                                CLE028
      *                                                                                       CLE028
     C           W78NPY    IFNE 0                                                             CLE028
     C           CHGA      DIV  W78NPY    WCHGPY 309                                          CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** Compute for number of months for charges to be refunded                              CLE028
      ** if value date is not equal to rundate.                                               CLE028
      *                                                                                       CLE028
     C           WDAYNV    IFLT MDAT                                                          CLE028
     C           W78NPY    SUB  W78NTH    WMOSRF  50                                          CLE028
     C                     ADD  2         WMOSRF                                              CLE028
     C           WCHGPY    MULT WMOSRF    WCHGRF 309                                          CLE028
     C                     Z-SUBWCHGRF    WCGRF  130H                                         CLE028
     C                     ELSE                                                               CLE028
     C                     Z-ADD*ZERO     WCGRF                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     MOVE *BLANKS   ZFLD15                                              CLE028
     C                     MOVE WCGRF     ZFLD15                                              CLE028
     C                     Z-ADDWCDP      ZDECS                                               CLE028
     C                     MOVE 'J'       ZECODE                                              CLE028
     C                     EXSR ZFRPED                                                        CLE028
     C                     MOVE ZOUT22    #1CGRF                                              CLE028
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ENDSR                                                              CLE028
      *****************************************************************                       CLE028
      /EJECT                                                                                  CLE028
      *****************************************************************                       CLE036
      *  FRCONV  -  Convert Facility Currency Repayment Amounts into  *                       CLE036
      *             Loan Currency for outputting to the file:         *                       CLE036
      *  Called by:                                                   *                       CLE036
      *  Calls    : ZCONV                                             *                       CLE036
      *****************************************************************                       CLE036
      *                                                                                       CLE036
     C           FRCONV    BEGSR                                                              CLE036
      *                                                                                       CLE036
      * If Repayment is in facility Ccy, convert to loan ccy:                                 CLE036
      * using the recipricol of the fixed rate from the loan.                                 CLE036
     C           SSCCY     IFNE CCYL                                                          CLE036
     C           *IN15     ANDEQ*OFF                                                          CLE036
     C                     MOVE SSCCY     ZCCYI                                               CLE036
     C                     MOVE CCYL      ZCCYO                                               CLE036
     C                     Z-ADD1         Y                                                   CLE036
     C           SSCCY     LOKUPCYA,Y                    12                                   CLE036
     C           *IN12     IFEQ '1'                                                           CLE036
     C                     Z-ADDNDP,Y     ZCDPI            Repay Ccy D.P.                     CLE036
     C                     MOVE *OFF      *IN12                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     Z-ADDWCDP      ZCDPO            Loan Ccy D.P.                      CLE036
      *                                                                                       CLE036
     C           RLDT      IFLT WDAYNV                                                        CLE036
     C           RLDT      ANDNE*ZERO                                                         CLE036
     C           NFCE      ANDNE*ZERO                                                         CLE036
     C           NCCY      ANDEQ*BLANKS                                                       CLE036
     C                     Z-ADDNFCE      ZEXCH  138                                          CLE036
     C           NFMD      IFEQ 'D'                                                           CLE036
     C                     MOVE 'M'       ZMD                                                 CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE 'D'       ZMD                                                 CLE036
     C                     ENDIF                                                              CLE036
     C                     ELSE                                                               CLE036
     C                     Z-ADDFCXR      ZEXCH                                               CLE036
     C           FMDI      IFEQ 'D'                                                           CLE036
     C                     MOVE 'M'       ZMD                                                 CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE 'D'       ZMD                                                 CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      * Move amounts entered by User into Facility Ccy fields:                                CLE036
     C                     Z-ADDOPRAM     OFRAM                                               CLE036
     C                     Z-ADDOINTA     OFINT                                               CLE036
     C                     Z-ADDOWTXA     OFTXA                                               CLE036
     C                     Z-ADDOTAMT     OFTOT                                               CLE036
     C                     Z-ADDOPNAM     OFPEN                                               CLE036
      *                                                                                       CLE036
      ** Convert amounts entered by User into Loan Ccy:                                       CLE036
     C                     Z-ADDOPRAM     ZAMTCI                                              CLE036
     C                     EXSR ZCONV                                                         CLE036
     C                     Z-ADDZAMTCO    OPRAM                                               CLE036
      *                                                                                       CLE036
     C                     Z-ADDOINTA     ZAMTCI                                              CLE036
     C                     EXSR ZCONV                                                         CLE036
     C                     Z-ADDZAMTCO    OINTA                                               CLE036
      *                                                                                       CLE036
     C                     Z-ADDOWTXA     ZAMTCI                                              CLE036
     C                     EXSR ZCONV                                                         CLE036
     C                     Z-ADDZAMTCO    OWTXA                                               CLE036
      *                                                                                       CLE036
     C                     Z-ADDOPNAM     ZAMTCI                                              CLE036
     C                     EXSR ZCONV                                                         CLE036
     C                     Z-ADDZAMTCO    OPNAM                                               CLE036
      *                                                                                       CLE036
     C                     Z-ADDOTAMT     ZAMTCI                                              CLE036
     C                     EXSR ZCONV                                                         CLE036
     C                     Z-ADDZAMTCO    OTAMT                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     ENDSR                                                              CLE036
      *                                                                                       CLE036
      /EJECT                                                                                  CLE036
      *****************************************************************                       CLE036
      * SRMIN3   - Convert Loan amounts to FCCY & output to screen.   *                       CLE036
      * Called by: SRFRMT                                             *                       CLE036
      * Calls    : None                                               *                       CLE036
      *****************************************************************                       CLE036
     C           SRMIN3    BEGSR                                                              CLE036
      *                                                                                       CLE036
      * First need outstanding Loan Amounts in Loan currency:                                 CLE036
     C                     MOVE *BLANKS   ZFLD15                                              CLE036
     C                     MOVE CPAM      ZFLD15                                              CLE036
     C                     Z-ADDWCDP      ZDECS                                               CLE036
     C                     MOVE 'J'       ZECODE                                              CLE036
     C                     EXSR ZFRPED                                                        CLE036
     C                     MOVE ZOUT22    SCURP                                               CLE036
      *                                                                                       CLE036
     C                     MOVE *BLANKS   ZFLD15                                              CLE036
     C                     MOVE WOINT     ZFLD15                                              CLE036
     C                     Z-ADDWCDP      ZDECS                                               CLE036
     C                     MOVE 'J'       ZECODE                                              CLE036
     C                     EXSR ZFRPED                                                        CLE036
     C                     MOVE ZOUT22    SINTD                                               CLE036
      ** Then check number of decimal places in facility currency:                            CLE036
     C                     Z-ADD1         Y                                                   CLE036
     C           FCCYL     LOKUPCYA,Y                    12                                   CLE036
     C           *IN12     IFEQ '1'                                                           CLE036
     C                     Z-ADDNDP,Y     FCDP             Repay Ccy D.P.                     CLE036
     C                     Z-ADDNDP,Y     ZCDPO            Repay Ccy D.P.                     CLE036
     C                     Z-ADDWCDP      ZCDPI            Loan Ccy D.P.                      CLE036
     C                     MOVE *OFF      *IN12                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
      ** Retrieve exchange rate & convert amounts to facility currency:                       CLE036
      *                                                                                       CLE036
     C           RLDT      IFLT BJRDNB                                                        CLE036
     C           RLDT      ANDNE*ZERO                                                         CLE036
     C           NFCE      ANDNE*ZERO                                                         CLE036
     C           NCCY      ANDEQ*BLANKS                                                       CLE036
     C                     Z-ADDNFCE      ZEXCH  138                                          CLE036
     C                     MOVE NFMD      ZMD                                                 CLE036
     C                     ELSE                                                               CLE036
     C                     Z-ADDFCXR      ZEXCH                                               CLE036
     C                     MOVE FMDI      ZMD                                                 CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
      ** Principal Amount in Facility Currency:                                               CLE036
     C           FPAM      IFNE 0                                                             CLE036
     C                     MOVE *BLANKS   ZFLD15                                              CLE036
     C                     MOVE FPAM      ZFLD15                                              CLE036
     C                     Z-ADDFCDP      ZDECS                                               CLE036
     C                     MOVE 'J'       ZECODE                                              CLE036
     C                     EXSR ZFRPED                                                        CLE036
     C                     MOVE ZOUT22    SFURP                                               CLE036
     C                     ELSE                                                               CLE036
      *                                                                                       CLE036
     C                     Z-ADDCPAM      ZAMTCI                                              CLE036
     C                     EXSR ZCONV                                                         CLE036
     C                     Z-ADDZAMTCO    WFPAM  130                                          CLE036
      *                                                                                       CLE036
     C                     MOVE *BLANKS   ZFLD15                                              CLE036
     C                     MOVE WFPAM     ZFLD15                                              CLE036
     C                     Z-ADDFCDP      ZDECS                                               CLE036
     C                     MOVE 'J'       ZECODE                                              CLE036
     C                     EXSR ZFRPED                                                        CLE036
     C                     MOVE ZOUT22    SFURP                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
      ** Outstanding Interest Amount in Facility Currency:                                    CLE036
     C                     Z-ADDWOINT     ZAMTCI                                              CLE036
     C                     EXSR ZCONV                                                         CLE036
     C                     Z-ADDZAMTCO    WOINT                                               CLE036
      *                                                                                       CLE036
     C                     MOVE *BLANKS   ZFLD15                                              CLE036
     C                     MOVE WOINT     ZFLD15                                              CLE036
     C                     EXSR ZFRPED                                                        CLE036
     C                     MOVE ZOUT22    SFIND                                               CLE036
      *                                                                                       CLE036
      * Expected Principal Amount in Facility Currency:                                       CLE036
      *                                                                                       CLE036
     C                     MOVE *BLANKS   ZFLD15                                              CLE036
     C                     MOVE WEPRIN    ZFLD15                                              CLE036
     C                     EXSR ZFRPED                                                        CLE036
     C                     MOVE ZOUT22    SEPRI                                               CLE036
      *                                                                                       CLE036
     C                     Z-ADDWEINT     ZAMTCI                                              CLE036
     C                     EXSR ZCONV                                                         CLE036
     C                     Z-ADDZAMTCO    WEINT                                               CLE036
     C                     MOVE *BLANKS   ZFLD15                                              CLE036
     C                     MOVE WEINT     ZFLD15                                              CLE036
     C                     EXSR ZFRPED                                                        CLE036
     C                     MOVE ZOUT22    SEINT                                               CLE036
      *                                                                                       CLE036
      ** Expected Penalty Amount in Facility Currency:                                        CLE036
     C                     Z-ADDWEPAM     ZAMTCI                                              CLE036
     C                     EXSR ZCONV                                                         CLE036
     C                     Z-ADDZAMTCO    WEPAM                                               CLE036
     C                     MOVE *BLANKS   ZFLD15                                              CLE036
     C                     MOVE WEPAM     ZFLD15                                              CLE036
     C                     EXSR ZFRPED                                                        CLE036
     C                     MOVE ZOUT22    SEPEN                                               CLE036
      *                                                                                       CLE036
      ** Expected Withholding Tax Amount in Facility Currency:                                CLE036
     C                     MOVE *BLANKS   ZFLD15                                              CLE036
     C                     MOVE WEWTAX    ZFLD15                                              CLE036
     C                     EXSR ZFRPED                                                        CLE036
     C                     MOVE ZOUT22    SWHTX                                               CLE036
      *                                                                                       CLE036
      ** Expected Total Amount in Facility Currency:                                          CLE036
     C                     MOVE *BLANKS   ZFLD15                                              CLE036
     C                     MOVE WEXTOT    ZFLD15                                              CLE036
     C                     EXSR ZFRPED                                                        CLE036
     C                     MOVE ZOUT22    SETOT                                               CLE036
      *                                                                                       CLE036
     C                     ENDSR                           End SRMIN3                         CLE036
      *                                                                                       CLE036
      *****************************************************************                       CLE036
      * SRMIN4   - Move Fac. Ccy fields to screen fields (Amounts)    *                       CLE036
      * Called by: SRFRMT & SRBTCH.                                   *                       CLE036
      * Calls    : None                                               *                       CLE036
      *****************************************************************                       CLE036
     C           SRMIN4    BEGSR                                                              CLE036
      *                                                                                       CLE036
      ** Output amounts in loan currency:                                                     CLE036
     C                     MOVE CCYL      SLCCY                                               CLE036
     C                     MOVE *BLANKS   ZFLD15                                              CLE036
     C                     MOVE PRAMR     ZFLD15                                              CLE036
     C                     Z-ADDWCDP      ZDECS                                               CLE036
     C                     MOVE 'J'       ZECODE                                              CLE036
     C                     EXSR ZFRPED                                                        CLE036
     C                     MOVE ZOUT22    SLPRI                                               CLE036
      *                                                                                       CLE036
     C                     MOVE *BLANKS   ZFLD15                                              CLE036
     C                     MOVE INTAR     ZFLD15                                              CLE036
     C                     EXSR ZFRPED                                                        CLE036
     C                     MOVE ZOUT22    SLINT                                               CLE036
      *                                                                                       CLE036
     C                     MOVE *BLANKS   ZFLD15                                              CLE036
     C                     MOVE PNAMR     ZFLD15                                              CLE036
     C                     EXSR ZFRPED                                                        CLE036
     C                     MOVE ZOUT22    SLPEN                                               CLE036
      *                                                                                       CLE036
     C                     MOVE *BLANKS   ZFLD15                                              CLE036
     C                     MOVE TAMTR     ZFLD15                                              CLE036
     C                     EXSR ZFRPED                                                        CLE036
     C                     MOVE ZOUT22    SLTOT                                               CLE036
      *                                                                                       CLE036
      ** Check number of decimal places in facility currency:                                 CLE036
     C                     Z-ADD1         Y                                                   CLE036
     C           FCCYL     LOKUPCYA,Y                    12                                   CLE036
     C           *IN12     IFEQ '1'                                                           CLE036
     C                     Z-ADDNDP,Y     FCDP    10       Repay Ccy D.P.                     CLE036
     C                     MOVE *OFF      *IN12                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     MOVE *BLANKS   ZFIELD                                              CLE036
     C                     MOVE FRAMR     ZFIELD                                              CLE036
     C                     Z-ADDFCDP      ZADEC                                               CLE036
     C                     EXSR ZEDIT                                                         CLE036
     C                     MOVE ZFIELD    SRPRI                                               CLE036
      *                                                                                       CLE036
     C                     MOVE *BLANKS   ZFIELD                                              CLE036
     C                     MOVE FINTR     ZFIELD                                              CLE036
     C                     EXSR ZEDIT                                                         CLE036
     C                     MOVE ZFIELD    SRINT                                               CLE036
      *                                                                                       CLE036
     C                     MOVE *BLANKS   ZFIELD                                              CLE036
     C                     MOVE FPENR     ZFIELD                                              CLE036
     C                     EXSR ZEDIT                                                         CLE036
     C                     MOVE ZFIELD    SRPEN                                               CLE036
      *                                                                                       CLE036
     C                     MOVE *BLANKS   ZFIELD                                              CLE036
     C                     MOVE FTOTR     ZFIELD                                              CLE036
     C                     EXSR ZEDIT                                                         CLE036
     C                     MOVE ZFIELD    SRTOT                                               CLE036
      *                                                                                       CLE036
     C                     ENDSR                                                              CLE036
      *                                                                                       CLE036
      *****************************************************************                       CLE036
      * SRFNEG   - Seperate +/- sign from Facility ccy amounts.       *                       CLE036
      * Called by:                                                    *                       CLE036
      * Calls    : None                                               *                       CLE036
      *****************************************************************                       CLE036
     C           SRFNEG    BEGSR                                                              CLE036
      *                                                                                       CLE036
     C           FRAMR     IFLT 0                                                             CLE036
     C                     MOVE '-'       SPSIG                                               CLE036
     C                     Z-SUBFRAMR     FRAMR                                               CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE ' '       SPSIG                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           FINTR     IFLT 0                                                             CLE036
     C                     MOVE '-'       SISIG                                               CLE036
     C                     Z-SUBFINTR     FINTR                                               CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE ' '       SISIG                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           FPENR     IFLT 0                                                             CLE036
     C                     MOVE '-'       SRPIG                                               CLE036
     C                     Z-SUBFPENR     FPENR                                               CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE ' '       SRPIG                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           FTOTR     IFLT 0                                                             CLE036
     C                     MOVE '-'       SRSIG                                               CLE036
     C                     Z-SUBFTOTR     FTOTR                                               CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE ' '       SRSIG                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     ENDSR                           End SRFNEG                         CLE036
      *                                                                                       CLE036
      *****************************************************************                       CLE036
      * SRFRUP   - Update facility currency amounts on related record *                       CLE036
      * Called by:                                                    *                       CLE036
      * Calls    : None                                               *                       CLE036
      *****************************************************************                       CLE036
     C           SRFRUP    BEGSR                                                              CLE036
      *                                                                                       CLE036
      ** Repayment schedule only                                                              CLE036
      *                                                                                       CLE036
     C           AMTP      IFEQ 'RE'                                                          CLE036
      *                                                                                       CLE036
     C           REPTL     IFNE 3                                                             CLE036
     C           SACTN     IFEQ 'I'                                                           CLE036
     C           FRAM      SUB  FRAMR     FRAM                                                CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           SACTN     IFEQ 'R'                                                           CLE036
     C           FRAM      ADD  FRAMR     FRAM                                                CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           REPTL     IFEQ 2                                                             CLE036
     C           SACTN     IFEQ 'I'                                                           CLE036
     C           FTOT      SUB  FTOTR     FTOT                                                CLE036
     C                     ENDIF                                                              CLE036
     C           SACTN     IFEQ 'R'                                                           CLE036
     C           FTOT      ADD  FRAMR     FTOT                                                CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           REPTL     IFEQ 3                                                             CLE036
     C           SACTN     IFEQ 'I'                                                           CLE036
     C           FTOT      SUB  FTOTR     FTOT                                                CLE036
     C                     ENDIF                                                              CLE036
     C           SACTN     IFEQ 'R'                                                           CLE036
     C           FTOT      ADD  FTOTR     FTOT                                                CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           AMTP      IFEQ 'PD'                                                          CLE036
      *                                                                                       CLE036
     C           SACTN     IFEQ 'I'                                                           CLE036
     C           FRAM      SUB  FRAMR     FRAM                                                CLE036
     C           FINT      SUB  FINTR     FINT                                                CLE036
     C           FTXA      SUB  FTXAR     FTXA                                                CLE036
     C           FTOT      SUB  FTOTR     FTOT                                                CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           SACTN     IFEQ 'R'                                                           CLE036
     C           FRAM      ADD  FRAMR     FRAM                                                CLE036
     C           FINT      ADD  FINTR     FINT                                                CLE036
     C           FTXA      ADD  FTXAR     FTXA                                                CLE036
     C           FTOT      ADD  FTOTR     FTOT                                                CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           *IN44     IFEQ *ON                                                           CLE036
     C           FCRAS     SUB  FRAMR     FRAM                                                CLE036
      *                                                                                       CLE036
     C                     SELEC                                                              CLE036
     C           REPTL     WHEQ 1                                                             CLE036
     C                     Z-ADD0         FTOT                                                CLE036
     C           REPTL     WHEQ 2                                                             CLE036
     C                     Z-ADDFRAM      FTOT                                                CLE036
     C           REPTL     WHEQ 3                                                             CLE036
     C                     Z-ADD0         FRAM                                                CLE036
     C           FCRAS     SUB  FTOTR     FTOT                                                CLE036
     C                     ENDSL                                                              CLE036
      *                                                                                       CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     ENDSR                                                              CLE036
      *                                                                                       CLE036
      *****************************************************************
      *                                                               *
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
     C           @RUN      IFEQ *BLANK
      *
     C                     DUMP
     C                     MOVE 'Y'       @RUN    1
     C                     MOVE *ON       *INU7
     C                     MOVE *ON       *INU8
     C                     MOVE *ON       *INLR
     C           PMODE     IFNE 'B'                                       120002
     C                     ROLBK
     C                     ENDIF                                          120002
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           PMODE     OREQ 'F'                                       CAP063
     C                     CALL 'DBERRCTL'
     C                     ENDIF
      *
     C                     MOVE 'D'       POMSVR
      *                                                                                     AR870590
     C           PMODE     IFEQ 'B'                                                         AR870590
     C                     ROLBK                                                            AR870590
     C                     MOVEL'LEL0035 'ZAMSID                                            AR870590
     C           ##RTCD    IFEQ '*RECLCK'                                                   AR868380
     C                     MOVEL'LEL0817 'ZAMSID                                            AR868380
     C                     ENDIF                                                            AR868380
     C                     EXSR ZASNMS                                                      AR870590
     C                     ENDIF                                                            AR870590
     C                     ENDIF                                                            AR870590
      *                                                                                     AR870590
     C                     RETRN
      *
     C**********           ENDIF                                                            AR870590
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
     C/TITLE SR/ZBKDT
     C/COPY ZSRSRC,ZBKDT
     C/TITLE SR/ZCHKH
     C/COPY ZSRSRC,ZCHKH
     C/COPY ZSRSRC,ZALIGNZ2
     C/COPY ZSRSRC,ZEDITZ2
     C/TITLE SR/ZDATE1
     C/COPY ZSRSRC,ZDATE1Z2
     C/TITLE SR/ZDATE2
     C/COPY ZSRSRC,ZDATE2Z2
     C/TITLE SR/ZFWDT
     C/COPY ZSRSRC,ZFWDT
     C/TITLE SR/ZFREQB
     C/COPY ZSRSRC,ZFREQBZ2
     C/TITLE SR/ZFRQB3                                                                        194632
     C/COPY ZSRSRC,ZFRQB3                                                                     194632
     C/TITLE SR/ZFLAC
     C/COPY ZSRSRC,ZFLACZ2
     C/TITLE SR/ZACCH
     C/COPY ZSRSRC,ZACCH
     C/TITLE SR/GLINTC
     C/COPY ZSRSRC,GLINTCZ1
     C/COPY ZSRSRC,ZDAT10Z2                                               126017
     C/EJECT                                                              126017
     C/COPY ZSRSRC,ZFRPEDZ3
     C/COPY ZSRSRC,ZINTDYZ2
     C/COPY ZSRSRC,ZDATE9Z3
     C/TITLE SR/ZTNLU1
     C/COPY ZSRSRC,ZTNLU1Z2
      /TITLE SR/ZCONV                                                                         CLE023
     C/COPY ZSRSRC,ZCONVZ1                                                                    CLE023
      /TITLE SR/ZXRATEZ1                                                                      CLE023
     C/COPY ZSRSRC,ZXRATEZ1                                                                   CLE023
      /TITLE SR/RULE78                                                                        CLE028
     C/COPY ZSRSRC,RULE78Z1                                                                   CLE028
      *
      /EJECT
      ****************************************************************
      *                                                                   128094
      ** Output LTRIX header record                                       128094
      *                                                                   128094
     O*LTRIX***E                LTRIXH                                               128094 AR322732
     O**********               NORE      11P                                         128094 AR322732
     O**********               RRNA      20P                                         128094 AR322732
     O**********               NLAR      32P                                         128094 AR322732
     O**********               NATN      40P                                         128094 AR322732
      *                                                                   128094
      ** Output LTRIX detail record                                       128094
      *                                                                   128094
     O********E*               LTRIXD                                                128094 AR322732
     OLTRIX   EADD             LTRIXD                                                       AR322732
     O                                    2 'DA'                          128094
     O                         SLOAN      8                               128094
     O                         WDAYNV    13                               128094
     O                         LASN      16                               128094
     O                         CHTP      17                               128094
     O                                   18 'N'                           128094
     O                                   19 'N'                           128094
     O                                   25 '00001'                       128094
     O                                   26 'N'                           128094
     O                         PRI1      27                               128094
     O                         BRCA      34                               128094
     O                         RRNA      37P                              128094
     O                         NATN      40P                              128094
     O                                   43 '000'                         128094
     O                                   44 ' '                                             AR322732
     O                                   45 ' '                                             AR322732
      *                                                                                     AR322732
     O/COPY WNCPYSRC,LE2110O001
      *
** CWA - Array for watch list fields                                                          CSD015
<Receipt Nostro>                                                                              CSD015
</Receipt Nostro>                                                                             CSD015
<Receipt Intermed Bank>                                                                       CSD015
</Receipt Intermed Bank>                                                                      CSD015
<Receipt Ordering Bank>                                                                       CSD015
</Receipt Ordering Bank>                                                                      CSD015
<Receipt Ordering Cust>                                                                       CSD015
</Receipt Ordering Cust>                                                                      CSD015
<Payment Nostro>                                                                              CSD015
</Payment Nostro>                                                                             CSD015
<Payment Intermed Bank>                                                                       CSD015
</Payment Intermed Bank>                                                                      CSD015
<Payment Ordering Bank>                                                                       CSD015
</Payment Ordering Bank>                                                                      CSD015
<Payment Ordering Cust>                                                                       CSD015
</Payment Ordering Cust>                                                                      CSD015
<Receiver Correspondent>                                                                      CSD015
</Receiver Correspondent>                                                                     CSD015
<Receiver>                                                                                    CSD015
</Receiver>                                                                                   CSD015
<Account With Bank>                                                                           CSD015
</Account With Bank>                                                                          CSD015
<Beneficiary>                                                                                 CSD015
</Beneficiary>                                                                                CSD015
<Details Of Payment>                                                                          CSD015
</Details Of Payment>                                                                         CSD015
** CPY@
(c) Misys International Banking Systems Ltd. 2001
** TABSLD   **     Processing Types for Parts Sold
66676972
** TABTYP   **     Valid processing types for match against loan
6162
6466
6869                                                                      CLE005
7071                                                                      148845
80                                                                                            CLE028
** TABDIS   **     Discounted Processing Types
636567
**  POWER   **      POWERS OF TEN                                                             CLE023
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZYDY   **     YEARS IN DAYS CUMULATIVE IN FOUR YEAR SPAN
0366073110961461
**   ZMDY   **     MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM   **     MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZFMD   **     NUMBER OF DAYS IN THE MONTH
312831303130313130313031
** @YD      **     USED BY ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD      **     USED BY ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
