     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Repayment schedule input')                    *
/*XBIA*: OVRDBF FILE(LOAMD) TOFILE(LOAMS) SHARE(*NO)                : *
      *****************************************************************
      *                                                               *
      *  Midas - Customer Lending Module                              *
      *                                                               *
      *  LE2120 - Repayment Schedule Maintenance                      *
      *                                                               *
      *  Function:  This is a new program for Repayment Schedule      *
      *             Input. This could be run in any of the four modes *
      *             available, depending on the parameter passed to it*
      *               1. Interactive ('I') - called from the Midas    *
      *                    Transaction Input menu                     *
      *               2. Record ('R') - Run interactively but updates *
      *                    are done to a new 'test harness' file      *
      *               3. Play ('P') - Run interactively but data is   *
      *                    read from the 'test harness' file          *
      *               4. Batch ('B') - Run in batch and called by a   *
      *                    communications control program             *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 MD023787           Date 29Apr14               *
      *                 CSD095             Date 08Apr14               *
      *                 AR868380           Date 11Jun13               *
      *                 AR1046444          Date 06Jun13               *
      *                 AR806351           Date 24Apr13               *
      *                 AR740107           Date 21Dec12               *
      *                 AR693137           Date 01Aug12               *
      *                 CLE134             Date 01Aug12               *
      *                 AR322732           Date 23Jul12               *
      *                 CLE148             Date 23Jul12               *
      *                 CLE139             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 262328             Date 30Oct09               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CLE106             Date 01Aug04               *
      *                 223174             Date 05Jul04               *
      *                 227710             Date 21May04               *
      *                 CLE038             Date 11May04               *
      *                 CLE036             Date 29Sep03               *
      *                 CAS011             Date 16May05               *
      *                 CAS009             Date 04May04               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 BUG2117            Date 22Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 28Oct03               *
      *                 CSF002             Date 11Aug03               *
      *                 CAP075             Date 08Aug02               *
      *                 CAP074             Date 08Aug02               *
      *                 CAP073             Date 08Aug02               *
      *                 CDE005             Date 23Sep02
      *                 CLE029             Date 04Sep02               *
      *                 219608             Date 22Jul03               *
      *                 219152             Date 26Jun03               *
      *                 CLE034             Date 05May03               *
      *                 CLE033             Date 09Apr03               *
      *                 216067             Date 20Mar03               *
      *                 CLE031             Date 04Feb03               *
      *                 CAS005             Date 16Dec02               *
      *                 CSD015             Date 14Oct02               *
      *                 CLE028             Date 27Jun02               *
      *                 214643             Date 15Apr03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 207653             Date 21Oct02               *
      *                 207629             Date 23Aug02               *
      *                 205964             Date 11Jun02               *
      *                 205504             Date 10Jun02               *
      *                 203856             Date 06Jun02               *
      *                 205714             Date 06Jun02               *
      *                 204452             Date 03May02               *
      *                 201672             Date 29Apr02               *
      *                 204708             Date 26Apr02               *
      *                 204507             Date 26Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *  Last Amend No. CLE042             Date 06Sep05               *
      *  Prev Amend No. CAP068             Date 25JUN02               *
      *                 203469             Date 28Feb02               *
      *                 CLE023             Date 19Nov01               *
      *                 202239             Date 23Jan02               *
      *                 203070             Date 14Feb02               *
      *                 199073             Date 07Feb02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 197083             Date 02Aug01               *
      *                 194724             Date 23Jul01               *
      *                 186431             Date 19Jul01               *
      *                 194509             Date 19Jun01               *
      *                 194454             Date 18Jun01               *
      *                 CLE014             Date 20Mar01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 189601             Date 28Feb01               *
      *                 188983             Date 14Feb01               *
      *                 187559             Date 24Jan01               *
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CRT004             DATE 04MAY00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 181357             Date 11Jul00               *
      *                 175450             Date 09Mar00               *
      *                 172706             Date 24Jul00               *
      *                 CDE001             Date 12Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 172288             Date 11Jan00               *
      *                 169698             Date 02Dec99               *
      *                 CLE009             Date 02Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 162494             Date 18Jun99               *
      *                 161136             Date 21May99               *
      *                 159256             Date 11May99               *
      *                 157753             Date 11May99               *
      *                 158268             Date 08Apr99               *
      *                 157536             Date 26Mar99               *
      *                 158177  (BT0506)   Date 10Apr98               *
      *                 157585             Date 23Mar99               *
      *                 157209             Date 22Mar99               *
      *                 155421             Date 09Mar99               *
      *                 156048             Date 02Mar99               *
      *                 155570             Date 25Feb99               *
      *                 154799             Date 24Feb99               *
      *                 153864             Date 25Feb99               *
      *                 153663             Date 25Feb99               *
      *                 152669             Date 25Feb99               *
      *                 152625             Date 25Feb99               *
      *                 151295             Date 25Feb99               *
      *                 148730             Date 25Feb99               *
      *                 148624             Date 25Feb99               *
      *                 148532             Date 25Feb99               *
      *                 144073             Date 25Feb99               *
      *                 143071             Date 25Feb99               *
      *                 142398             Date 25Feb99               *
      *                 142392             Date 25Feb99               *
      *                 142388             Date 25Feb98               *
      *                 135152             Date 25Feb98               *
      *                 131253             Date 25Feb99               *
      *                 122461             Date 25Feb99               *
      *                 144915             Date 28Oct98               *
      *                 147281             Date 13Nov98               *
      *                 CEU020             Date 13Mar98               *
      *                 CEU004             Date 02Feb98               *
      *                 128968             Date 26Jan98               *
      *                 128148             Date 29Dec97               *
      *                 128094             Date 29Dec97               *
      *                 CLE005             Date 22May97               *
      *                 127348             Date 10DEC97               *
      *                 126274             Date 21NOV97               *
      *                 123857             Date 14NOV97 (Re-open)     *
      *                 125558             Date 07Nov97               *
      *                 124922             Date 27OCT97               *
      *                 123857             Date 27OCT97               *
      *                 123699             Date 22Oct97               *
      *                 122685             Date 10OCT97               *
      *                 123998             Date 07Oct97               *
      *                 123801             Date 06Oct97               *
      *                 123873             Date 03Oct97               *
      *                 123789             Date 03Oct97               *
      *                 123177             Date 02Oct97               *
      *                 122960             Date 15Sep97               *
      *                 122998             Date 15SEP97               *
      *                 122109             Date 26AUG97               *
      *                 121783             Date 14AUG97               *
      *                 121798             Date 13AUG97               *
      *                 120468             Date 09JUL97               *
      *                 119989             Date 08JUL97               *
      *                 120002             Date 07JUL97               *
      *                 119594             Date 20JUN97               *
      *                 CLE004 *Create     Date 02Dec96               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *           (Recompile)                                         *
      *  MD046248 - Finastra Rebranding                               *
      *  MD023787 - Add parameter on AOOULAU0.                        *
      *  CSD095 - Allow Deal Sub-Type and Branch for MM and FX SSIs   *
      *           (Recompile)                                         *
      *  AR868380 - APISERVER on LCKW status. Return *RECLCK to       *
      *             calling program if file locking occurred on       *
      *             online position files. (Child: AR868381)          *
      *  AR1046444 - Don't allow insert of repayment sched against    *
      *              PDCL loan. (Child: AR1046445)                    *
      *  AR806351 - Incorrect facility utilisation on OSFC. Prevent   *
      *             facility update of RE for interest and fee PDCL   *
      *             with FAMU = 'N'. (Child: AR806352)                *
      *  AR740107 - Maturity changed equal to repayment date requires *
      *             warning message. Additional validation added      *
      *             between Maturity and Next Repayment date.         *
      *             (Child: AR740108)                                 *
      *  AR693137 - LEC0459 00001. LE0479 dbase 004, dbfile LE0475    *
      *             Auto cannot be 'C' if settlement methods are not  *
      *             equal to 01, 05, 08 and 14 or loan processing type*
      *             is not equal to 61, 62, 64, 68 and 80.            *
      *             (Child: AR693138)                                 *
      *  AR322732 - LEC0212A and APISERVER locks LTRIX file.          *
      *           - Prevent LTRIX RRN 1 from being locked.            *
      *  CLE134 - Past Due Call Loan Processing                       *
      *         - CC02: Manual Repayment Feature                      *
      *  CLE148 - Alpha Loan Reference                                *
      *  CLE139 - Lending Fee Capitalisation (Recompile)              *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  262328 - Serious Midas error occurred. Increase size of @BIC *
      *           array from 150 to 900.                              *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE106 - Syndications Manager.                               *
      *  223174 - Use new fixed rate if RE is dated after rollover.   *
      *  227710 - If F3 is pressed in the settlement programs, ensure *
      *           that all database changes are rolled back.          *
      *  CLE038 - Lending Enhancement for Nordea: Allocation by Amount*
      *  CLE036 - Lending Enhancements for Nordea Phase 1 Priority 2: *
      *           Allow repayments in facility currency.              *
      *  CAS011 - EIR/AC Accounting Upgrade to MP1                    *
      *  CAS009 - Effective Interest Rate/Amortised Cost Accounting   *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  BUG2117 - Allocate timestamp during Insert. Also align       *
      *            length of field OSAC in data structures            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter Mismatch                                  *
      *  CSF002 - Global layer.                                       *
      *           - Replace previous ZBACT* parameters with the new   *
      *             unique code.                                      *
      *  CAP075 - Lending API enhancements - Loan Amendment.          *
      *           (amendment in common with CAP079)                   *
      *  CAP074 - Lending API enhancements - Loans input.             *
      *  CAP073 - Lending API enhancement - Facility Input (Recompile)*
      *  CDE005 - Reservation ID                                      *
      *  CLE029 - Addition of Severity code and Limit ID to FCLTYFM   *
      *  219608 - Pass Settlement Allocation ind to shadow posting pgm*
      *  219152 - Repayment was not authorised if the User pressed F11*
      *           and the RE had settlement allocations (CLE034)      *
      *  CLE034 - Lending Enhancements.                               *
      *  CLE033 - Settlement method 09                                *
      *  216067 - If batch mode do not cause d/b error when System    *
      *           Value LoanCustOriginPurch not present. Instead      *
      *           default to 'P' (purchased from customer)            *
      *  CLE031 - Lending Enhancements.                               *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  214643 - The loan number was not shown in the extended       *
      *           settlement details screen.  Pass field SLOAN as     *
      *           parameter to SD2400 intead of PSLNRF.               *
      *  207653 - After authorisation, RE status was still 'Complete'.*
      *           If BPAURV (Authorisation - Review all Screens) = 'Y'*
      *           then allow authorisation even if *INKK (F11) is off.*
      *  207629 - Check System Value LoanCustOriginPurch to decide if *
      *           original borrower should be input as the customer of*
      *           a Part Purchased, instead of 'Purchased From' num.  *
      *  205964 - Ensure that no records will be generated in         *
      *           RSACMTPD when settlement details were not amended.  *
      *  205504 - Generate correct projections when repayment type is *
      *           '3'.                                                *
      *  203856 - Settlement details defaulted from previous RPSC for *
      *           a different loan. Caused DBASE error in COB because *
      *           Nostro did not exist. *IN70 should be initialised.  *
      *  205714 - Amending repayment schedule from 'N' to 'Y' from    *
      *           the initial screen does not affect availability.    *
      *           Ensure that variable AUTOA is properly updated as   *
      *           this field is used in conditioning update of OAMs.  *
      *  204452 - Recompiled due to changed PF/LEFEED.                *
      *  201672 - Calculate projected interest and principal on       *
      *           maturity.                                           *
      *  204708 - If loan is non-autosettled, update availability of  *
      *           the facility beyond the loan's maturity date.       *
      *  204507 - Availability should only be updated for schedules   *
      *           entered as autosettled.  If autosettle indicator is *
      *           changed, update should be done accordingly. Fix     *
      *           extends core fix 199073 to also cover availability. *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  CAP068 - Recompiled for changes to FCLTYFM and FCLTYFN.      *
      *  203469 - OAM array of Participant facility not updated for   *
      *           Repayment of an Internal Participation Purchased.   *
      *  CLE023 - Lending Facilty History Improvements.               *
      *  202239 - Result fields when computing for CAMD should be     *
      *           half-adjusted.                                      *
      *  203070 - Repayments for Internal Parts Purchased should not  *
      *           update the drawn amount (CAMD) of the primary       *
      *           facility.                                           *
      *  199073 - Repayment schedule should only update the exposure  *
      *           amount if autosettle indicator is 'Y'.              *
      *  197083 - Incorrect settlement details for ptyp 72.           *
      *  194724 - Available facility amount not updated correctly.    *
      *  186431 - Added processing to handle LTRIX record locks.      *
      *  194509 - Amended Transactions go to Re-auth and then complete*
      *  194454 - Repayment Schedule amounts displayed as zero        *
      *  CLE014 - Customer Driven Lending Enhancements                *
      *           Applied part of fix for 190136                      *
      *  189601 - Rename SCCYC field in LOAMSDK file to avoid over-   *
      *           writing same field in CLOANCL.  Also renamed TNLU   *
      *           field of FCLTYFM to avoid overwriting LOAMSDK file. *
      *  188983 - Fields are in error on detail screen but no error   *
      *           messages are displayed                              *
      *  187559 - The repayment details should be re-validated if     *
      *           changes are made to prevent invalid details used    *
      *           during file update.                                 *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing.   *
      *           Recompile.                                          *
      *  CRT004 - Cashier Midas TCP/IP interface.                     *
      *             Recompiled over SDBRCHPD Changes                  *
      *  181357 - If called in Batch mode, do not try to redisplay    *
      *           screens. Amendment to 172288.                       *
      *  175450 - Shadow files should not be updated if Risk Loan.    *
      *  172706 - Amend the authorisation process so that Settlement  *
      *           screen is viewed only once when F11 or Enter is used*
      *           Also, problem with F14 when used after F11.         *
      *  CDE001 - Data Export - CCRM Limits                           *
      *  172288 - If F12 pressed in settlements, then user returned   *
      *           to initial screen instead of previous screen.       *
      *  169698 - Program looping if Enter pressed whilst trying to   *
      *           to authorise a transaction. Should redisplay detail *
      *           screen.                                             *
      *  CLE009 - LE I/C Swift Message Generation for Fees            *
      *  162494 - Blank sequence number written on LTRIX causing      *
      *           database error on LE1067.                           *
      *  161136 - LASN blank when LTRIX record written                *
      *           (Authorisation is switched off)                     *
      *  159256 - Send interactive warning message if syndicated      *
      *           loan is amended via Midas.                          *
      *  157753 - LE0320AU - Control Difference                       *
      *  158268 - Amount not appearing on enquiry of a repayment      *
      *           schedule with repayment type 1.                     *
      *  157536 - Pay/Rec reporting showing backvalued repayments     *
      *           and non auto-settled repayments                     *
      *  158177 - All transactions input through Midas must have      *
      *           a full PC reference                                 *
      *  157585 - Database error on SDCURRPD if ccy entered is blank. *
      *  157209 - Wrong entry on Customer, Value date, and Currency   *
      *           fields are accepted when enter pressed twice.       *
      *  155421 - LE0320 file out of balance                          *
      *  156048 - Considered 'PI' and 'PT' on the validation of the   *
      *           entered principal amount.                           *
      *  155570 - Conditioning incorrect for update of ltrix.         *
      *  154799 - Recompiled due to changes in /COPY,ZACCH            *
      *  153864 - I/C update of facility exposure/availability wrong  *
      *           for Credit Agreement.                               *
      *  153663 - Automatic unlinking no longer required.             *
      *  152669 - Principal transfer amount should be considered in   *
      *           the validation of the repayment amount.             *
      *  152625 - DoWhile loop incorrectly set up causing payments    *
      *           to fail if near principal amount                    *
      *  151295 - Problems on authorisation                           *
      *  148730 - Repayment that should be settled properly was posted*
      *           to suspense account                                 *
      *  148624 - F12 from settlement screen now returns program      *
      *           to detail screen when authorising. Previously       *
      *           this would authorise and return to sfl.             *
      *  148532 - Repay Schedule settlement is not defaulting to the  *
      *           beneficiary when you change settlement to 08/01.    *
      *  144073 - DB error 17 for repayment schedules entered against *
      *           risk parts sent from Loan Manager with participant  *
      *           indicator set to 'R' (i.e. new setting).            *
      *  143071 - The Std settlement instructions for a participation *
      *           purchased should default from the original borrower.*
      *  142398 - Should be able to overpay with repay sched          *
      *  142392 - Repay Schedule should default to standard           *
      *           settlement first then loan.                         *
      *  142388 - Repay Schedule for risk loans not allowed           *
      *  135152 - There needs to be a separate standard settlement    *
      *           instruction transaction type for Lending - use of   *
      *           'MM' is not sufficiently flexible                   *
      *  131253 - Accept amendment when CLE005 is *ON and RATF in     *
      *           CLOANCL is 'Y' even if RECI is 'M'.                 *
      *  122461 - Correct the setting of 'manual/system generated'    *
      *           flag. Where the transaction is from loan manager,   *
      *           (but not the first message in the unit of work),    *
      *           set to 'S'; otherwise set to 'M'.                   *
      *  144915 - Recompiled due to changes in LF/CLOAN.              *
      *  147281 - Multi-ccy rollover should not be allowed if past    *
      *           due payments or future dated loan amendments except *
      *           for repayment schedule exists.                      *
      *  CEU020 - EMU Lending Multi-currency Rollover                 *
      *  CEU004 - LE Settlement Ccy Conversion Upgrade to DBA R2.0    *
      *  128968 - Cannot authorise a scheduled repayment              *
      *  128148 - If customer shortname entered it is translated      *
      *           into an incorrect customer number                   *
      *  128094 - Add Input Cycle Pay / Receive functionality         *
      *  CLE005 - Customer Lending Enhancements - Tranche 3           *
      *  127348 - The validation for the amount field when the        *
      *           repayment is entered in facility currency and not   *
      *           loan currency is invalid.                           *
      *  126274 - The subfile review screen should show the customer  *
      *           short name.                                         *
      *  125558 - ORED, CHTP, LCD corrupted on facility               *
      *  124922 - Able to authorise a loan from the initial input     *
      *           screen even though CLE002 is switched off.          *
      *  123857 - Additional authorisation option, to use F11 or go   *
      *           through all screens and pressing ENTER on the last  *
      *           screen.                                             *
      *  123699 - Settlement account not set up correctly             *
      *  122685 - Incorrect update of facility availability amount    *
      *  123998 - Texts should be coming from message subfile         *
      *  123801 - Return exact settlement detail error in batch mode  *
      *  123873 - Set manual/system generated flag to S only in batch *
      *  123789 - Dont change the change type on an authorisation     *
      *  123177 - Unlink from a syndicate only when linked            *
      *  122960 - Use first parameter of positions update program     *
      *           to suppress rollback in batch mode.                 *
      *  122998 - Remove backvalue validation from program as well as *
      *           check done against rollover date.                   *
      *  122109 - PC transaction ref is not set in interactive mode   *
      *           due to confusion with 'if..' construct.             *
      *  121783 - Call new access object AOBRCHR1 instead of AOBRCHR0 *
      *           (uses the long data structure DSSDY)                *
      *  121798 - PC Transaction ref is missing the first 3 numbers   *
      *           when it is sent back to the PC.                     *
      *  120468 - Include a DUMP in SREROR subroutine for Batch and   *
      *           Play modes.                                         *
      *  119989 - File control processing not performed correctly.    *
      *           Negative amounts are not included in totals.        *
      *  120002 - If processing in batch mode, then status of         *
      *           transaction should always be set to 'A'.            *
      *         - Number of items in batch on return message is       *
      *           corrupted.                                          *
      *         - program perform COMIT operation while in batch mode *
      *  119594 - SD2400 should not be called when running in         *
      *           Batch or Play mode.                                 *
      *  CLE004 - Customer Lending Enhancements - Syndications.       *
      *                                                               *
      *****************************************************************
      *
     FLE2120DFCF  E                    WORKSTN                        UC
     F                                        SRRN  KSFILE LE2120S0
      ** Repayment Schedule Display file
      *
     FLE2120PDUF  E                    DISK         KINFSR *PSSR A    UC
      ** Repayment Schedule Record file
      *
     FLELOAML0IF  E           K        DISK
     F            LOAMSDKF                          KRENAMELELOAMD0
      ** Live Loan Amendment Details
      *
     FLELOAML1IF  E           K        DISK
     F            LOAMSDKF                          KRENAMELELOAMD1
      ** Loan Amendments Requiring Authorisation
      *
     FLOAMS   UF  E           K        DISK         KINFSR *PSSR A
     F                                              KCOMIT
      ** Loan Amendments for Updating
      *
     FLOAMD   IF  E           K        DISK
     F            LOAMSDKF                          KRENAMELOAMSD
     F            LOAMSDHF                          KIGNORE
     F            LOAMSZ1F                          KIGNORE
      ** Loan Amendments Retrieval Index
      *
     F***CLOAN***UF  E           K        DISK         KINFSR *PSSR       153663
     FCLOAN   IF  E           K        DISK         KINFSR *PSSR          153663
     F                                              KCOMIT                153663
     F            CLOANHHF                          KIGNORE
     F            CLOANZ1F                          KIGNORE
      ** Loans file
      *
     F***LTRIX***UF  F      43            DISK         KINFSR *PSSR                         AR322732
     FLTRIX   O   F      45            DISK         KINFSR *PSSR A                          AR322732
     F                                              KCOMIT
     F                                              KINFDS FLDTX                              186431
      ** Loan Transaction Index Detail
      *
     FFCLTY   UF  E           K        DISK         KINFSR *PSSR
     F                                              KCOMIT
     F            FCLTYHHF                          KIGNORE
     F            FCLTYZZF                          KIGNORE
      ** Customer Lending Facility file
      *
     FSDBRCHL5IF  E           K        DISK
      ** SD Branch Codes by Customer Number
      *
     FLEFEEDL1UF  E           K        DISK         KINFSR *PSSR          CLE009
     F                                              KCOMIT                CLE009
      *                                                                   CLE009
     FLEFELAL0UF  E           K        DISK         KINFSR *PSSR A        CLE009
     F                                              KCOMIT                CLE009
      *                                                                                       CSD015
      **  Compliance Watch Hit List File                                                      CSD015
     FSDCWHTL1IF  E           K        DISK                                                   CSD015
      *                                                                                       CSD015
     FLEEIRDL5UF  E           K        DISK                                                   CAS009
     F                                              KCOMIT                                    CAS009
     F/COPY WNCPYSRC,LE2120F001
      /SPACE 3
      *****************************************************************
      *                                                               *
      *    F U N C T I O N   O F   I N D I C A T O R S                *
      *                                                               *
      *    01           Chain fail on LOAMS                           *
      *    02           Chain fail on CLOAN                           *
      *    04           End of file on LELOAML0/L1                    *
      *    06           No more changed record in subfile             *
      *    07           End of file on LOAMD                          *
      *    08           Chain fail on FCLTY                           *
      *    09           End of file on LE2120PD                       *
      *    10           Settlement details amended                    *                       205964
      *    11           Repayment in Facility currency                *                       CLE036
      *    17           Error CHAIN to LTRIX detail                   *                       186431
      *    18           CHAIN to LEFELAL0                             *   CLE009
      *    19           READE to LEFEEDL1                             *   CLE009
      *    20           LOKUP currency array                          *   CLE009
      *                                                               *
      *    21           Unauthorised only - use LELOAML1              *
      *    22           Protect detail screen                         *
      *    24           Repayment Authorisation                       *
      *    25           Amend action                                  *
      *    26           Insert action                                 *
      *    27           F9 for insert is pressed from subfile screen  *
      *    28           Repayment in Facility currency allowed???     *                       CLE036
      *    29           'Page Keys' on Subfile screen                 *
      *                                                               *
      *    Initial screen validation indicators                       *
      *                                                               *
      *    30           Error on Action code in Subfile               *
      *    31           Error on Loan number                          *
      *    32           Error on Action code                          *
      *    33           Error on Value date                           *
      *    34           Errod on Sequence number                      *
      *    35           Error on Review from Loan number              *
      *    36           Error on Review from Value date               *
      *    37           Error on Review from Sequence number          *
      *    38           Error on Unauthorised Only field              *
      *                                                               *
      *    Midas Compliance Watch                                     *                       CSD015
      *                                                               *                       CSD015
      *    39           Chain fail on SDCWHTL1                        *                       CSD015
      *                                                               *                       CSD015
      *    Detail screen validation indicators                        *
      *                                                               *
      *    41           Error on Customer number                      *
      *    42           Error on Value date                           *
      *    43           Error on Currency                             *
      *    44           Error on Amount                               *
      *    45           Error on Auto-settlement indicator            *
      *    46           Error on Settlement Allocation indicator      *                       CLE034
      *                                                               *
      *    50           Delete action                                 *
      *    51           Authorise action                              *
      *    56           CLE034 is installed                           *                       CLE034
      *                                                               *
      *    70           Value date falls on a Holiday                 *   187559
      *                                                               *   187559
      *    Subfile indicators                                         *
      *                                                               *
      *    80           Enable Rollup                                 *
      *    81           Rollup key pressed                            *
      *    82           Subfile display                               *
      *    83           Subfile next change                           *
      *    84           Subfile clear                                 *
      *    85           Subfile message queue                         *
      *    86           No records in subfile                         *
      *    87           F11 is not needed for authorisation           *   123857
      *                                                               *
      *    Work indicators                                            *
      *                                                               *
      *    60           Facility update work indicator                *
      *    61           Facility update work indicator                *
      *    62           Facility update work indicator                *
      *    63           Facility update work indicator                *
      *    88           Work indicator for testing numeric            *
      *    89           Update files work indicator                   *
      *                                                               *
      *****************************************************************
      /EJECT
      *                                                                                       CSD015
     E                    CWA     1  26 25                                                    CSD015
      ** Array used in Midas Compliance Watch                                                 CSD015
      *                                                                                       CSD015
     E                    CPY@    1   1 80
     E***********         WSTAT   1   4 10               Loan status      123998
     E                    POWR    1   7  7 3             Ccy conversion
     E                    OAM        10 13 0             Fclty amounts
     E                    RUNS       10  5 0A            Fclty dates
     E**********          @BIC      150  6 0             Internal Custs                       CSD027
     E**********          @BIC      150  6               Internal Custs                CSD027 262328
     E                    @BIC      900  6               Internal Custs                       262328
      *
     E                    CYA       150  3                                CLE009
      ** Currencies array                                                 CLE009
     E                    TND       150  1 0                              CLE009
      ** Telex Notice Days array                                          CLE009
      *                                                                   CLE009
     E                    POWER   1   7  7 3             POWER OF TEN                         CLE036
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZFRPEDZ1
     E/COPY ZSRSRC,ZALIGNZ1
     E/COPY ZSRSRC,ZHOLE
     E/COPY ZSRSRC,ZF2CE
     E/COPY WNCPYSRC,LE2120E001
      *
     E                    WLF        12 35                                                    CSD015
      **  Watch List Fields Array.                                                            CSD015
      *                                                                                       CSD015
     E                    ACUR       20  3                                                    CLE034
      ** Array of Currencies                                                                  CLE034
      *                                                                                       CLE034
     E                    ALOC       20  3                                                    CLE034
      ** Array of Locations                                                                   CLE034
      *                                                                                       CLE034
     E                    SVALTX  1   1 20                                                    CLE148
      /EJECT
      *----------------------------------------------------------------
      *
     ICLOANCLF
      ** Rename fields for Loans file - A
      *
     I              RECI                            RECIC
     I              CNUM                            CNUMC
     I              LTYP                            LTYPC
     I              SUTP                            SUTPC
     I              PTYP                            PTYPC
     I              CCY                             LCCYC
     I              MDAT                            MDATC
     I              VDAT                            VDATC
     I              FCUS                            FCUSC
     I              FTYP                            FTYPC
     I              FSEQ                            FSEQC
     I              REPT                            REPTC
     I              WTIN                            WTINC
     I              BRCA                            BRCAC
     I              LSWC                            LSWCC
     I              LSWS                            LSWSC
     I              FCLB                            FCLBC
     I              AUTO                            AUTOC
     I              LCD                             LCDC
     I              CHTP                            CHTPC
     I              TNLU                            TNLUC
     I              TMST                            TMSTC                                     CAP074
      *
      ** Extended settlement details
      *
     I              RSTM                            RSTMC
     I              RONS                            RONSC
     I              RIBN                            RIBNC
     I              RIBA                            RIBAC
     I              ROBN                            ROBNC
     I              ROCN                            ROCNC
     I              PSTM                            PSTMC
     I              PONS                            PONSC
     I              PIBN                            PIBNC
     I              PIBA                            PIBAC
     I              POBN                            POBNC
     I              POCN                            POCNC
     I              RCRN                            RCRNC
     I              RCRA                            RCRAC
     I              RVNO                            RVNOC
     I              AWBN                            AWBNC
     I              AWBA                            AWBAC
     I              BENN                            BENNC
     I              BENA                            BENAC
     I              DTP1                            DTP1C
     I              DTP2                            DTP2C
     I              DTP3                            DTP3C
     I              DTP4                            DTP4C
     I              DCHG                            DCHGC
     I              BTB1                            BTB1C
     I              BTB2                            BTB2C
     I              BTB3                            BTB3C
     I              BTB4                            BTB4C
     I              BTB5                            BTB5C
     I              BTB6                            BTB6C
     I              CVMR                            CVMRC
     I              OMDB                            OMDBC
     I              OSDB                            OSDBC
     I              FACO                            FACOC
     I              SCCY                            SCCYC                 CEU004
     I              ICCY                            ICCYC                 CEU004
     I              PSCY                            PSCYC                                     CLE031
     I              REXR                            REXRC                                     CLE031
     I              PEXR                            PEXRC                                     CLE031
     I              REXI                            REXIC                                     CLE031
     I              PEXI                            PEXIC                                     CLE031
     I              STAL                            STALC                                     CLE034
     I              OMDA                            OMDAC                                     CLG029
      *
     ICLOANCKF
      ** Rename fields for Loans file - B
      *
     I              NLRA                            NLRAK
     I              SPI1                            SPI1K
     I              SPI2                            SPI2K
     I              SPI3                            SPI3K
     I              ECIN                            ECINK                 CEU020
     I              TMST                            TMSTK                                     CAP074
      *
     ILOAMSD
      ** Rename fields for Loan Amendments Retrieval index
      *
     I              RECI                            RECIA
     I              LNRF                            LNRFA
     I              VDAT                            VDATA
     I              LASN                            LASNA
     I              AMTP                            AMTPA
     I              PTYP                            PTYPA
     I              PRAM                            PRAMA
     I              AUTO                            AUTOA
     I              SETP                            SETPA
     I              OSAC                            OSACA
     I              TSEN                            TSENA
     I              FACO                            FACOA
     I              SPI1                            SPI1A
     I              SPI2                            SPI2A
     I              SPI3                            SPI3A
     I              XASQ                            XASQA
     I              ASTS                            ASTSA
     I              IUSR                            IUSRA
     I              AUSR                            AUSRA
     I              TMST                            TMSTA                                     CAP075
      *
      ** Extended settlement details
      *
     I              RSTM                            RSTMA
     I              RONS                            RONSA
     I              RIBN                            RIBNA
     I              RIBA                            RIBAA
     I              ROBN                            ROBNA
     I              ROCN                            ROCNA
     I              PSTM                            PSTMA
     I              PONS                            PONSA
     I              PIBN                            PIBNA
     I              PIBA                            PIBAA
     I              POBN                            POBNA
     I              POCN                            POCNA
     I              RCRN                            RCRNA
     I              RCRA                            RCRAA
     I              RVNO                            RVNOA
     I              AWBN                            AWBNA
     I              AWBA                            AWBAA
     I              BENN                            BENNA
     I              BENA                            BENAA
     I              DTP1                            DTP1A
     I              DTP2                            DTP2A
     I              DTP3                            DTP3A
     I              DTP4                            DTP4A
     I              DCHG                            DCHGA
     I              BTB1                            BTB1A
     I              BTB2                            BTB2A
     I              BTB3                            BTB3A
     I              BTB4                            BTB4A
     I              BTB5                            BTB5A
     I              BTB6                            BTB6A
     I              CVMR                            CVMRA
     I**********    SCCY                            SCCYC                              CEU004 189601
     I              SCCY                            SCCYCL                                    189601
     I              ICCY                            ICCYC                 CEU004
     I              PSCY                            PSCYA                                     CLE031
     I              REXR                            REXRA                                     CLE031
     I              PEXR                            PEXRA                                     CLE031
     I              REXI                            REXIA                                     CLE031
     I              PEXI                            PEXIA                                     CLE031
     I              STAL                            STALA                                     CLE034
      *
     IFCLTYFMF
      ** Rename fields for Facility file
      *
     I              CNUM                            CNUMF
     I              BRCA                            BRCAF
     I              LCD                             LCDF
     I              CHTP                            CHTPF
     I              TNLU                            TNLUF                                     189601
     I              RCSI                            RCSIF                 122685
      *
      ** Rename extended settlement fields
      *
     I              RSTM                            RSTMF
     I              RONS                            RONSF
     I              RIBN                            RIBNF
     I              RIBA                            RIBAF
     I              ROBN                            ROBNF
     I              ROCN                            ROCNF
     I              PSTM                            PSTMF
     I              PONS                            PONSF
     I              PIBN                            PIBNF
     I              PIBA                            PIBAF
     I              POBN                            POBNF
     I              POCN                            POCNF
     I              RCRN                            RCRNF
     I              RCRA                            RCRAF
     I              RVNO                            RVNOF
     I              AWBN                            AWBNF
     I              AWBA                            AWBAF
     I              BENN                            BENNF
     I              BENA                            BENAF
     I              DTP1                            DTP1F
     I              DTP2                            DTP2F
     I              DTP3                            DTP3F
     I              DTP4                            DTP4F
     I              DCHG                            DCHGF
     I              BTB1                            BTB1F
     I              BTB2                            BTB2F
     I              BTB3                            BTB3F
     I              BTB4                            BTB4F
     I              BTB5                            BTB5F
     I              BTB6                            BTB6F
     I              CVMR                            CVMRF
     I              SCCY                            SCCYC                 CEU004
     I              ICCY                            ICCYC                 CEU004
     I              REXR                            REXRF                                     CLE031
     I              REXI                            REXIF                                     CLE031
     I              PSCY                            PSCYF                                     CLE031
     I              PEXR                            PEXRF                                     CLE031
     I              PEXI                            PEXIF                                     CLE031
      *
     IFCLTYFNF
      ** Rename fields for Facility file
      *
     I              LCD                             LCDF
     I              CHTP                            CHTPF
     I              TNLU                            TNLUF
      *
     ILELOAMD0
      ** Rename fields to be used in Subfile Display
      *
     I              LNRF                            FLNRF
     I              CNUM                            FCNUM
     I              LASN                            FLASN
     I              PTYP                            FPTYP
     I              VDAT                            FVDAT
     I              AMTP                            FAMTP
     I**********    CCY                             FCCY                  187559
     I              CCY                             RECCY                 187559
     I              PRAM                            FPRAM
     I              TAMT                            FTAMT                 194454
     I              ASTS                            FASTS
     I              IUSR                            FIUSR
     I              AUSR                            FAUSR
     I              BRCA                            FBRCA
     I              SETP                            FSETP
     I              OSAC                            FOSAC
     I              TSEN                            FTSEN
     I              FACO                            FFACO
     I              SPI1                            FSPI1
     I              SPI2                            FSPI2
     I              SPI3                            FSPI3
     I              REXR                            FREXR                                     CLE031
     I              REXI                            FREXI                                     CLE031
     I              PSCY                            FPSCY                                     CLE031
     I              PEXR                            FPEXR                                     CLE031
     I              PEXI                            FPEXI                                     CLE031
     I              STAL                            FSTAL                                     CLE034
     I              TMST                            FTMST                                     CAP075
      *
     ILELOAMD1
      ** Rename fields to be used in Subfile Display
      *
     I              LNRF                            FLNRF
     I              CNUM                            FCNUM
     I              LASN                            FLASN
     I              PTYP                            FPTYP
     I              VDAT                            FVDAT
     I              AMTP                            FAMTP
     I**********    CCY                             FCCY                  187559
     I              CCY                             RECCY                 187559
     I              PRAM                            FPRAM
     I              TAMT                            FTAMT                 194454
     I              ASTS                            FASTS
     I              IUSR                            FIUSR
     I              AUSR                            FAUSR
     I              BRCA                            FBRCA
     I              SETP                            FSETP
     I              OSAC                            FOSAC
     I              TSEN                            FTSEN
     I              FACO                            FFACO
     I              SPI1                            FSPI1
     I              SPI2                            FSPI2
     I              SPI3                            FSPI3
     I              REXR                            FREXR                                     CLE031
     I              REXI                            FREXI                                     CLE031
     I              PSCY                            FPSCY                                     CLE031
     I              PEXR                            FPEXR                                     CLE031
     I              PEXI                            FPEXI                                     CLE031
     I              STAL                            FSTAL                                     CLE034
     I              TMST                            GTMST                                     CAP075
      *
     ILOAMSDKF
     I              PCRF                            PCRFK
     I              PCOB                            PCOBK
     I              PSCY                            PSCYK                                     CLE031
     I              REXR                            REXRK                                     CLE031
     I              PEXR                            PEXRK                                     CLE031
     I              REXI                            REXIK                                     CLE031
     I              PEXI                            PEXIK                                     CLE031
     I              STAL                            STALK                                     CLE034
     I              TMST                            TMSTK                                     CAP074
      *
     ILE2120D0                                                                                CLE034
     I              TMST                            D0TMST                                    CLE034
      ** Loan transactions index file - Header record
      *
     I*LTRIX***NS       1 CH                                                                AR322732
     I**********                              1   1 RECI                                    AR322732
     I**********                              2   2 RCDT                                    AR322732
     I**********                              3   80LNRF                                    AR322732
     I**********                          P   9  110NORE                                    AR322732
     I**********                          P  12  140FLSZ                                    AR322732
     I**********                          P  15  170RRLC                                    AR322732
     I**********                          P  18  200RRNA                                    AR322732
     I**********                          P  21  230RRLX                                    AR322732
     I**********                          P  24  260RRXP                                    AR322732
     I**********                          P  27  290NLNR                                    AR322732
     I**********                          P  30  320NLAR                                    AR322732
     I**********                             33  330STPI                                    AR322732
     I**********                          P  38  400TNLU                                    AR322732
      *
      ** Loan transactions index file - Detail record
      *
     I*LTRIX***NS       1 CD   2 CA                                                         AR322732
     I*******OR*       1 CD   2 CL                                                          AR322732
     I**********                              1   1 RECI                                    AR322732
     I**********                              2   2 RCDT                                    AR322732
     I**********                              3   80LNRF                                    AR322732
     I**********                              9  130VDAT                                    AR322732
     I**********                             14  160LASN                                    AR322732
     I**********                             17  17 CHTP                                    AR322732
     I**********                             18  18 CNRQ                                    AR322732
     I**********                             19  19 CNPR                                    AR322732
     I**********                             20  20 REPR                                    AR322732
     I**********                             21  250RRLA                                    AR322732
     I**********                             26  26 LADI                                    AR322732
     I**********                             27  270PRI1                                    AR322732
     I**********                          P  35  370RRNT                                    AR322732
     I**********                          P  38  400TNLU                                    AR322732
      *
      ** Loans transactions index file - Catchall
      *
     I********NS                                                                            AR322732
     I**********                              1   1 RECI                                    AR322732
      *
     IPSDS       SDS
      ** Program Status Data Structure - gives Job/Workstation name and
      ** User ID
      *
     I                                     *PROGRAM ##PGM
     I                                      244 253 WSID
     I                                      254 263 USER
     I/COPY WNCPYSRC,LE2120I002
      *
     I***PINPP***    DS                            879                    CEU004
     I***PINPP***    DS                            908                       CEU004           CLE031
     I***PINPP***    DS                            941                                 CLE031 CLE034
     I***PINPP***    DS                            942                                 CLE034 CLE036
     IPINPP     E DSLEP1MFPD                                                                  CLE036
      ** Transmitted message format
      *
     I                                        1   4 PIMTYP
     I                                        5  20 PITUSR
     I                                       21  36 PITWST
     I                                       37  51 PITREF
     I                                       52  55 PITSEQ
     I                                       52  550P#TSEQ                123177
     I                                       56  56 PITACT
     I                                       57  64 PITDST
     I                                       65  72 PITTST
     I************                           73  78 PINPAR                120002
     I************                           79  80 PIFIL2                120002
     I                                       73  76 PINPAR                120002
     I                                       77  80 PIFIL2                120002
     I                                       81  86 PILOAN
     I                                       87  94 PIVDAT
     I                                       95  97 PIRESQ
     I                                       98 103 PICSNO
     I                                      104 106 PICURR
     I                                      107 120 PIPAMT
     I                                      121 121 PIAUTO
     I                                      122 211 PISPIS
     I                                      122 151 PISPI1
     I                                      152 181 PISPI2
     I                                      182 211 PISPI3
     I                                      212 213 PIPSTM
     I                                      214 228 PIPONS
     I                                      217 228 P#PONS                123699
     I                                      229 236 PIPREC
     I                                      237 237 PICVMR
     I                                      238 243 PIPOCN
     I                                      244 249 PIPOBN
     I                                      250 257 PIRCRN
     I                                      258 292 PIRCRA
     I                                      293 300 PIPIBN
     I                                      301 335 PIPIBA
     I                                      336 343 PIAWBN
     I                                      344 378 PIAWBA
     I                                      379 386 PIBENN
     I                                      387 421 PIBENA
     I                                      422 423 PIRSTM
     I                                      424 438 PIRONS
     I                                      427 438 P#RONS                123699
     I                                      439 444 PIROCN
     I                                      445 450 PIROBN
     I                                      451 458 PIRIBN
     I                                      459 493 PIRIBA
     I                                      494 633 PIDTPA
     I                                      494 528 PIDTP1
     I                                      529 563 PIDTP2
     I                                      564 598 PIDTP3
     I                                      599 633 PIDTP4
     I                                      634 636 PIDCHG
     I                                      637 846 PIBTBA
     I                                      637 671 PIBTB1
     I                                      672 706 PIBTB2
     I                                      707 741 PIBTB3
     I                                      742 776 PIBTB4
     I                                      777 811 PIBTB5
     I                                      812 846 PIBTB6
     I***********                           847 856 PIIUSR                CEU004
     I***********                           857 866 PIAUSR                CEU004
     I***********                           867 876 PIXUSR                CEU004
     I***********                           877 879 PIPCOB                CEU004
     I                                      847 848 PIDFTP                CEU004
     I                                      849 850 PIDFST                CEU004
     I                                      851 851 PINRLI                CEU004
     I                                      852 857 PIROLN                CEU004
     I                                      858 860 PIROSN                CEU004
     I                                      861 863 PIROBR                CEU004
     I                                      864 869 PIRORC                CEU004
     I                                      870 879 PIIUSR                CEU004
     I                                      880 889 PIAUSR                CEU004
     I                                      890 899 PIXUSR                CEU004
     I                                      900 902 PIPCOB                CEU004
     I                                      903 905 PISCCY                CEU004
     I                                      906 908 PIICCY                CEU004
     I                                      909 922 PIREXR                                    CLE031
     I                                      923 923 PIREXI                                    CLE031
     I                                      924 926 PIPSCY                                    CLE031
     I                                      927 940 PIPEXR                                    CLE031
     I                                      941 941 PIPEXI                                    CLE031
     I                                      942 942 PISTAL                                    CLE034
      *
     IPOUTP       DS                            183
      ** Return message format
      *
     I                                        1   4 POMTYP
     I                                        5  20 POTUSR
     I                                       21  36 POTWST
     I                                       37  51 POTREF
     I                                       52  55 POTSEQ
     I                                       56  56 POTACT
     I                                       57  64 POTDST
     I                                       65  72 POTTST
     I*************                          73  78 PONPAR                120002
     I*************                          79  80 POFIL2                120002
     I                                       73  76 PONPAR                120002
     I                                       77  80 POFIL2                120002
     I                                       81  81 POMSVR
     I                                       82  88 POMSID
     I                                       89 166 POMSTX
     I                                      167 172 POLOAN
     I                                      173 180 POVDAT
     I                                      181 183 PORESQ
      *
     I            DS
      ** Subfile screen review fields
      *
     I                                        1  16 SCRREV
     I                                        1   6 SLONR
     I                                        7  12 SDATR
     I                                       13  15 SSEQR
     I                                       16  16 SAUTR
     I            DS
      *
     I                                        1  16 SAVREV
     I                                        1   6 WSLONR
     I                                        7  12 WSDATR
     I                                       13  15 WSSEQR
     I                                       16  16 WSAUTR
     I            DS
      ** Last change data - LOAMS
      *
     I                                        1   50WLCD
     I                                        6   6 WCHTP
     I                                        7  110WTNLU
     I                                        1  11 WLSTC
      *
      ** Datastructure to hold input parameter for AOSVALR0.                                  207629
     I            DS                                                                          207629
     I                                        1  20 WPARM                                     207629
     I                                        1   5 WPARM1                                    207629
     I                                        6  10 WPARM2                                    207629
     I                                       11  15 WPARM3                                    207629
     I                                       16  20 WPARM4                                    207629
      *                                                                                       207629
     I            DS
      ** Detail screen save
      *
     I                                        1  10 SCUST
     I                                       11  16 SVDAT
     I                                       17  19 SCURR
     I                                       20  33 SAMNT
     I                                       34  34 SAUTO
     I                                        1  34 SCRFLD
      *
     I            DS
      ** Settlement details from CLOAN
      *
     I                                        1   20MDST
     I                                        3  14 OMDA
     I                                       15  24 TMAN
     I                                       25  34 FACOC
     I                                        1  34 LONSET
     I            DS
      ** Old settlement details
      *
     I                                        1   20OSETP
     I**********                              3  14 OOSAC                                    BUG2117
     I**********                             15  24 OTSEN                                    BUG2117
     I**********                             25  34 OFACO                                    BUG2117
     I**********                              1  34 OLDSET                                   BUG2117
     I**********                             35  64 OSPI1                                    BUG2117
     I**********                             65  94 OSPI2                                    BUG2117
     I**********                             95 124 OSPI3                                    BUG2117
     I**********                              1 124 OLDSTS                                   BUG2117
     I                                        3  20 OOSAC                                    BUG2117
     I                                       21  30 OTSEN                                    BUG2117
     I                                       31  40 OFACO                                    BUG2117
     I                                        1  40 OLDSET                                   BUG2117
     I                                       41  70 OSPI1                                    BUG2117
     I                                       71 100 OSPI2                                    BUG2117
     I                                      101 130 OSPI3                                    BUG2117
     I                                        1 130 OLDSTS                                   BUG2117
      *
     I            DS
      ** New settlement details
      *
     I                                        1   2 WSETP
     I**********                              3  14 WOSAC                                    BUG2117
     I**********                             15  24 WTSEN                                    BUG2117
     I**********                             25  34 WFACO                                    BUG2117
     I**********                              1  34 NEWSET                                   BUG2117
     I**********                             35  64 SSPI1                                    BUG2117
     I**********                             65  94 SSPI2                                    BUG2117
     I**********                             95 124 SSPI3                                    BUG2117
     I**********                              1 124 NEWSTS                                   BUG2117
     I                                        3  20 WOSAC                                    BUG2117
     I                                       21  30 WTSEN                                    BUG2117
     I                                       31  40 WFACO                                    BUG2117
     I                                        1  40 NEWSET                                   BUG2117
     I                                       41  70 SSPI1                                    BUG2117
     I                                       71 100 SSPI2                                    BUG2117
     I                                      101 130 SSPI3                                    BUG2117
     I                                        1 130 NEWSTS                                   BUG2117
      *
     I            DS
      ** Data structure of rundates
     I                                    P   1   30RUN0
     I                                    P   4   60RUN1
     I                                    P   7   90RUN2
     I                                    P  10  120RUN3
     I                                    P  13  150RUN4
     I                                    P  16  180RUN5
     I                                    P  19  210RUN6
     I                                    P  22  240RUN7
     I                                    P  25  270RUN8
     I                                    P  28  300RUN9
     I                                    P   1  300RUNS
      *
     I            DS
      ** Data structure of drawn amounts
     I                                    P   1   70OAM1
     I                                    P   8  140OAM2
     I                                    P  15  210OAM3
     I                                    P  22  280OAM4
     I                                    P  29  350OAM5
     I                                    P  36  420OAM6
     I                                    P  43  490OAM7
     I                                    P  50  560OAM8
     I                                    P  57  630OAM9
     I                                    P  64  700OA10
     I                                    P   1  700OAM
     I            DS
     I                                        1   6 WDATE
     I                                        1   2 WDD
     I                                        3   4 WMM
     I                                        5   6 WYY
      *
     I            DS
     I                                        1   6 WTIMEA
     I                                        1   2 WHH
     I                                        3   4 WNN
     I                                        5   6 WSS
      *
     I            DS
     I**********                              1   60WFCNUM                                    CSD027
     I                                        1   6 WFCNUM                                    CSD027
     I                                        7   90WFFACT
     I                                       10  110WFFCNO
     I                                       12  12 WFRCTP
     I                                        1  12 WFKEY
      *
     I            DS
     I                                        1   8 WPITDS
     I                                        1   2 WPIDD
     I                                        3   4 WPIMM
     I                                        5   8 WPIYY
      *                                                                   CLE005
     I            DS                                                      CLE005
     I                                        1  12 WPRME                 CLE005
     I                                        1   1 LPFI                  CLE005
     I**********                              2   70PTFC                               CLE005 CSD027
     I                                        2   7 PTFC                                      CSD027
     I                                        8  100PTFT                  CLE005
     I                                       11  120PTFN                  CLE005
      *
     IFLDTX       DS                                                      186431
      ** Data Structure for PF/LTRIX                                      186431
      *                                                                   186431
     I                                     *STATUS  TXSTS                 186431
      *                                                                   186431
     ILDA         DS                            256
      ** Local data area for database error details
      *
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      *
     I            DS
      ** Fields used for update of MEMOS, PRONO etc.
      *
     I                                        1 256 Z#ADTA
     I                                        1   1 SHRECI
     I                                        2   7 SHLNRF
     I                                        8  120SHVDAT
     I                                       13  150SHLASN
     I                                       21  22 SHPTYP
     I                                       23  24 SHAMTP
     I                                       35  37 SHCCY
     I                                    P  38  440SHPRAM
     I                                       73  75 SHBRCA
     I                                       82  820SHREPT
     I                                       83  83 SHAUTO
     I**********                             85 118 SHTIST                                   BUG2117
     I                                       85 124 SHTIST                                   BUG2117
      *
     I                                      257 512 Z#ADTB
     I                                      261 263 SHOSBR
     I                                      317 317 SHCHTP
     I                                    P 318 3200SHTNLU                CLE033
      *                                                                   CEU004
     I                                     10251280 Z#ADTE                CEU004
     I**********                           10581060 SHSCCY                             CEU004 CLE031
     I**********                           10611063 SHICCY                             CEU004 CLE031
     I                                     10611063 SHSCCY                                    CLE031
     I                                     10641066 SHICCY                                    CLE031
     I                                    P106910758SHREXR                                    CLE031
     I                                     10761076 SHREXI                                    CLE031
     I                                     10771079 SHPSCY                                    CLE031
     I                                    P108010868SHPEXR                                    CLE031
     I                                     10871087 SHPEXI                                    CLE031
     I                                     10881088 SHSTAL                                    CLE034
      *                                                                   127348
      * Data structure for assign appropriate decimal places to amount.   127348
     I            DS                                                      127348
     I                                        1  130WAMT0                 127348
     I                                        1  131WAMT1                 127348
     I                                        1  132WAMT2                 127348
     I                                        1  133WAMT3                 127348
     I                                        1  134WAMT4                 127348
     I                                        1  135WAMT5                 127348
     I                                        1  136WAMT6                 127348
      *                                                                   127348
      * Data structure for assign appropriate decimal places to amount.   127348
     I            DS                                                      127348
     I                                        1  130W#MT0                 127348
     I                                        1  131W#MT1                 127348
     I                                        1  132W#MT2                 127348
     I                                        1  133W#MT3                 127348
     I                                        1  134W#MT4                 127348
     I                                        1  135W#MT5                 127348
     I                                        1  136W#MT6                 127348
     I/COPY WNCPYSRC,LE2120I003
      *
     I***L2120S*     DS                            884                                        CLE031
     IL2120S      DS                            923                                           CLE031
      ** Data structure to hold test harness record
      *
     IPARMDS      DS                           9999                                           CSD015
      ** Compliance Engine Free Format String Parameter.                                      CSD015
      *                                                                                       CSD015
     I/COPY WNCPYSRC,LE2120I001
     IL2120F    E DSLE2120PD
      ** Data structure to receive test harness record
     I              TMST                            L2TMST                                    CLE031
      *
     IZ#BSTS    E DSZ#BST
     IZ#ASTS    E DSZ#AST
     IZ#WSTS    E DSZ#WST
      ** Shadow posting parameters
      *
     ISDCLND    E DSSDCLNDPD
      ** Customer lending ICD
      *
     ISCSARD    E DSSCSARDPD
      ** SAR details
      *
     I              LCD                             LCDX
      *
     ISDBANK    E DSSDBANKPD
      ** Bank details
      *
     ISDGELR    E DSSDGELRPD
      ** General ledger details
      *
     ISDMMOD    E DSSDMMODPD
      ** Midas modules details
      *
     ISDCURR    E DSSDCURRPD
      ** Currency Details
      *
     ISDCUST    E DSSDCUSTPD
      ** Customer Details
      *
     ISDBRCH    E DSSDBRCHPD
     I              QQDFAC                          Q1DFAC                                    CGL029
      ** Branch Details
      *                                                                   142392
     ISDEXST    E DSSDEXSTPD                                              142392
      ** External DS for Extended settlement Instruction.                 142392
      *                                                                                       CSD015
     ISC24X7    E DSSC24X7                                                                    CSD015
      * 24X7 Data Structure                                                                   CSD015
      *                                                                                       CSD015
     ISDSTAT    E DSSDSTAT                                                                    CSD015
      * SDSTAT Data Structure                                                                 CSD015
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      ** Midas Functions for Watch List Checking Deatils File                                 CSD015
      *                                                                                       CSD015
     ICWLCDS    E DSSDWLTOPD                                                                  CSD015
      ** Watch List Tranaction Details File                                                   CSD015
      *                                                                                       CSD015
     ISDCWCD    E DSSDCWCDPD                                                                  CSD015
      ** Compliance Watch List Configuration Data                                             CSD015
      *
     ISDNOST    E DSSDNOSTPD
     I              QQACCD                          Q1ACCD                                    CGL029
      ** Nostro Details
      *
     ISDRETL    E DSSDRETLPD
     I              QQACCD                          Q2ACCD                                    CGL029
      ** Retail ICD Details
      *
     IDSFDY     E DSDSFDY
      ** Short data structure for access objects
      *
     IDSSDY     E DSDSSDY
      ** Long data structure for access objects
      *                                                                   158177
      * DS for calculating PC reference                                   158177
     ILEALLO    E DSLEALLO                                                158177
      *
      *
     ISETLIB    E DSSETLIAB
     I              QQRONS                          Q2RONS                                    CLE106
     I              QQPONS                          Q2PONS                                    CLE106
      ** Data structure for passing a parameter to synon screen
      *  handling program.
      *
     ISETLIZ    E DSSETLIAZ
      ** Data structure for passing a parameter to synon screen
      *  handling program.
     I@PARM3    E DSSDSETLPD                                              222373
      *
     I/COPY QWINDSRC,LE2120GDTA
     I/COPY ZSRSRC,ZFRPEDZ2
     I/COPY ZSRSRC,ZHOLI
     I/COPY ZSRSRC,ZTNLU1Z1
     I/COPY ZSRSRC,ZF2CI
      *
      /EJECT
      *****************************************************************
      *                   Index to subroutines                        *
      *                                                               *
      *  Processes                                                    *
      *  Main routine                                                 *
      *  SRINPU  -  Initialise input screen for Interactive/Rec Mode  *
      *  SRPLAY  -  Play Mode Processing                              *
      *  SRBTCH  -  Batch Mode Processing                             *
      *  SRPREV  -  Process previous screen                           *
      *  SRSUBF  -  Process subfile                                   *
      *  SRDETL  -  Process detail screen                             *
      *  SRWIND  -  Window Processing                                 *
      *  SRUPDT  -  Update files                                      *
      *  SRFEES  -  Update Fees File                                  *   CLE009
      *  SRUPCL  -  Update Loans File                                 *
      *  SRUPTR  -  Update Loan Amendments Trailer file               *
      *  SRUPLX  -  Update Loan Transaction Index                     *
      *  SRUSHD  -  Update Shadow Record                              *
      *  SRLOAD  -  Load subfile page                                 *
      *  SRCLRS  -  Clear subfile message queue                       *
      *  SRREVW  -  Build subfile from Review fields                  *
      *  SRNSEQ  -  Get next amendment sequence no.                   *
      *  SRGNST  -  Access nostro details                             *
      *  SRCURR  -  Access currency details                           *
      *  SREROR  -  Error processing                                  *
      *  FCLTSR  -  Update Facility File                              *
      *  GLZADD  -  Add an amount to the total                        *
      *  GLZSUB  -  Subtract an amount from the total                 *
      *  GLZSUM  -  Carry out addition for subroutines                *
      *  QFCLTY  -  Update Exposure Array                             *
      *  ZASNMS  -  Send messages to program message queue            *
      *  SRTEXT  -  Set up text from message file                     *   123998
      *  FRCONV  -  Convert Facility Ccy Repayment amounts.           *                       CLE036
      *  *INZSR  -  Initial processing                                *
      *  *PSSR   -  Program exception error routine                   *
      *                                                               *
      *  Initialising/Setting up                                      *
      *  SRPF01  -  Initialise work fields for input screen           *
      *  SRPF02  -  Initialise input screen fields                    *
      *  SRINIS  -  Initialise subfile and subfile fields             *
      *  SRINZD  -  Initialise detail screen                          *
      *  SRINTI  -  Initialise settlement detail scrn for Insert      *
      *  SRMFSC  -  Move file values to settlement screen             *
      *  SRSETU  -  Set up fields values for update                   *
      *  SRBSET  -  Set up fields for Batch/Play mode processing      *
      *  SRUPFC  -  Set up file for update of Facility                *
      *  SRUPCA  -  Update credit agreement/superfacility             *   CLE005
      *  SRBICA  -  To get all branch internal customers              *
      *  SRWARN  -  Issue warning message if loan is syndicated       *   159256
      *                                                               *
      *  Validating                                                   *
      *  SRVAL1  -  Validate initial screen                           *
      *  SRVVAL  -  Validate value date                               *
      *  SRVALR  -  Validate Review from fields                       *
      *  SRVALS  -  Validate subfile tags                             *
      *  SRVAL2  -  Validate detail screen                            *
      *  SRAVAL  -  Additional Validation                             *
      *  SRCAUT  -  Validate user authority on branch/action          *
      *                                                               *
      *  Formatting                                                   *
      *  SRFMTA  -  Format amount field for screen output             *
      *  SRFRMT  -  Format subfile screen fields                      *
      *  SRSTAT  -  Format Repayment Schdule status for display       *
      *  SRMOVS  -  Move Test Harness fields to screen fields         *
      *  SRFMSG  -  Format message                                    *
      *  SRFXST  -  Format Extended Settlement Fields                 *
      *  SRSETT  -  Set Up Data Received from SD2400                  *
      *  SRSNAM  -  Move cust. no. to shortname counterpart           *
      *  SRSHAD  -  Setup parameter for Shadow post                   *
      *                                                               *
      *  Subroutines for Midas Compliance Watch Enhancement           *                       CSD015
      *  SRWTCH  -  Performs the Watch list processing.               *                       CSD015
      *  SRCWP2  -  Set up the 2nd parameter for Compliance Watch.    *                       CSD015
      *  SRBLDA  -  Build array used for storing fields in Compliance *                       CSD015
      *****************************************************************
      /EJECT
      *---------------------------------------------------------------*
      *
      ** Main Routine
      *
      ** Perform detailed processing according to Parameter Mode
      *
     C           PMODE     CASEQ'I'       SRINPU
     C           PMODE     CASEQ'R'       SRINPU
     C           PMODE     CASEQ'B'       SRBTCH
     C           PMODE     CASEQ'P'       SRPLAY
     C                     ENDCS
      *
      ** Terminate program
      *
      ** Call SD2400 w/ termination parameter to close program
      *
     C           PMODE     IFNE 'B'                                       119594
     C           PMODE     ANDNE'P'                                       119594
     C                     MOVE 'T'       PMTERM
     C                     CALL 'SD2400'
     C                     PARM           @RTCD
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           SLOAN
     C                     PARM           @PARM3                          222373
     C                     ROLBK                                                              227710
     C                     ENDIF                                          119594
      *
     C                     MOVE *ON       *INLR
     C                     RETRN
      *
      /EJECT
      *---------------------------------------------------------------*
      *     S  U  B  R  O  U  T  I  N  E  S                           *
      *---------------------------------------------------------------*
      *****************************************************************
      * SRINPU  -  Process input screen for Interactive/Record Mode   *
      * Called by: Main Routine                                       *
      * Calls    : None                                               *
      *                                                               *
      *****************************************************************
      *
     C           SRINPU    BEGSR
      *
      ** Initialise screen fields
      *
     C                     EXSR SRPF02
      *
      ** Du until F3 pressed
      *
     C           *INKC     DOUEQ*ON
      *
      ** Initialise work fields
      *
     C                     EXSR SRPF01
      *
      ** Write message subfile
      *
     C                     WRITELE2120C1
     C                     EXFMTLE2120F1
      *
      ** Clear subfile message queue and setof error indicators
      *
     C                     MOVEA'00000000'*IN,31
     C                     MOVE *OFF      *IN26
     C                     EXSR SRCLRS
     C/COPY WNCPYSRC,LE2120C007
      *
     C                     SELEC
      *
      ** F3 is pressed, exit program
      *
     C           *INKC     WHEQ '1'
     C                     LEAVE
      *
      ** F12 is pressed, go to subfile
      *
     C           *INKL     WHEQ '1'
     C                     MOVE 'S'       WOPTN
     C                     EXSR SRPREV
      *
      ** If Enter key pressed
      *
     C                     OTHER
      *
      ** Validate screen entries
      *
     C           SLOAN     IFNE *BLANKS
     C           SACTN     ORNE *BLANKS
     C           SVDAT     ORNE *BLANKS
     C           SSEQN     ORNE *BLANKS
     C           *IN27     OREQ *ON
      *
      ** Validate entries for Detail screen
      *
     C                     EXSR SRVAL1
     C                     ELSE
      *
      ** Validate entries for Review
      *
     C                     EXSR SRVALR
     C                     ENDIF
      *
     C                     ENDSL
      *
      ** If no errors in validation, process request
      *
     C           WERRF     IFEQ ' '
      *
     C           WOPTN     IFEQ 'D'
     C                     EXSR SRDETL
     C           *INKL     IFEQ *ON
     C           *IN27     ANDEQ*ON
     C                     EXSR SRSUBF
     C                     ENDIF
     C                     ELSE
     C                     EXSR SRSUBF
     C                     ENDIF
      *
     C                     EXSR SRPF01
     C                     EXSR SRPF02
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRBTCH  -  Batch mode processing                              *
      * Called by: Main Routine                                       *
      *            SRPLAY - Process play mode                         *
      * Calls    : SRPF01 - Initialise wrok fields for input screen   *
      *            SRBSET - Format screen fields for Batch/Play       *
      *            SRVAL1 - Validate initial screen                   *
      *            SRINZD - Initialise detail screen                  *
      *            SRVAL2 - Validate detail screen                    *
      *            SRUPDT - Update files                              *
      *                                                               *
      *****************************************************************
      *
     C           SRBTCH    BEGSR
      *
      ** Initialise work fields/set up screen fields
      *
     C                     EXSR SRPF01
     C                     EXSR SRBSET
      *
      ** Validate initial screen
      *
     C                     EXSR SRVAL1
      *
      ** Process detail screen
      *
     C                     EXSR SRINZD
     C                     EXSR SRVAL2
      *
      ** Perform file updates if no errors in validation
      *
     C                     EXSR SRUPDT
      *
      ** Return message format
      *
     C                     EXSR SRPOUT
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRPLAY  -  Process Play Mode                                  *
      * Called by: Main Routine                                       *
      * Calls    : SRBTCH - Batch mode processing                     *
      *                                                               *
      *****************************************************************
      *
     C           SRPLAY    BEGSR
      *
      ** Read test harness
      *
     C                     READ LE2120PD                 09
      *
      ** Perform batch processing until end of Test harness file
      *
     C           *IN09     DOWEQ*OFF
     C                     EXSR SRBTCH
      *
     C           WERRF     IFEQ ' '
     C           WMSEV     ANDEQ' '
     C                     MOVE L2120S    L2120F
     C                     MOVE WLASNX    LASN
     C                     UPDATLE2120D0
     C                     ENDIF
      *
     C                     READ LE2120PD                 09
     C                     ENDDO
      *                                                                   CDE001
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           CDE001    IFEQ 'Y'                                       CDE001
     C           WERRF     ANDEQ' '                                       CDE001
     C                     MOVELSLOAN     T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C                     PARM           T#TREF 20                       CDE001
     C                     PARM 'LOAN'    T#TCAT  4                       CDE001
     C                     PARM *BLANKS   RSRVID 10                       CDE005
     C                     ENDIF                                          CDE001
      *
      ** If no errors, commit all changes to update files
      *
     C           WERRF     IFEQ ' '
     C                     COMIT
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRPREV  -  Process Previous screen                            *
      * Called by: SRSUBF - Process subfile                           *
      *            SRDETL - Process detail screen                     *
      * Calls    : SRPF02 - Initialise input screen fields            *
      *            SRPF01 - Initialise work fields for input screen   *
      *                                                               *
      *****************************************************************
      *
     C           SRPREV    BEGSR
      *
      ** Previous screen is Subfile screen
      *
     C           WPREV     IFEQ 'S'
     C           *IN27     OREQ *ON
     C                     MOVE 'Y'       WPASS
     C                     MOVE 'Y'       WSDTV
     C                     ENDIF
      *
      ** Previous screen is Initial screen
      *
     C           WPREV     IFEQ 'I'
     C                     EXSR SRPF01
     C                     EXSR SRPF02
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSUBF  -  Process subfile                                    *
      * Called by: SRINPU - Process input screen for Interactive/Rec  *
      * Calls    : SRREVW - Build subfile from Review fields          *
      *            SRCLRS - Clear subfile message queue               *
      *            SRLOAD - Load subfile page                         *
      *            SRPREV - Process previous screen                   *
      *            SRVALR - Validate Review fields                    *
      *            SRVALS - Validate subfile tags                     *
      *            SRDETL - Process detail screen                     *
      *                                                               *
      *****************************************************************
      *
     C           SRSUBF    BEGSR
      *
      ** Build subfile from Review fields
      *
     C                     EXSR SRREVW
      *
      ** Do until F3 pressed
      *
     C           *INKC     DOUEQ*ON
      *
      ** Display subfile msg line and subfile
      *
     C                     WRITELE2120F2
     C                     WRITELE2120C1
     C                     WRITELE2120F0
     C                     EXFMTLE2120C0
      *
      ** Set off error indicator, clear subfile msg queue
      *
     C                     MOVE 'N'       SEENSL                          172706
     C                     MOVE *OFF      *IN27
     C                     MOVE *OFF      *IN30
     C                     MOVEA'0000'    *IN,35
     C  N81                EXSR SRCLRS
      *
      ** Enter key = Validate action codes/Set Review from fields
      ** Rollup    = Load next page
      ** F12       = Load previous page
      ** F09       = Insert repayment schedule
      ** F05       = Refresh subfile
      *
     C           *INKC     IFEQ *OFF
      *
     C                     SELEC
      *
      ** F5 - Refresh
      *
     C           *INKE     WHEQ *ON
     C                     MOVE *BLANKS   SLONR
     C                     MOVE *BLANKS   SDATR
     C                     MOVE *BLANKS   SSEQR
     C                     MOVE 'N'       SAUTR
     C                     EXSR SRREVW
      *
      ** Rollup
      *
     C           *IN81     WHEQ *ON
     C                     Z-ADDWRRNSV    SRRN
     C                     EXSR SRLOAD
      *
      ** F12 - Previous
      *
     C           *INKL     WHEQ *ON
     C                     EXSR SRPREV
     C                     LEAVE
      *
      ** F9 - Insert
      *
     C           *INKI     WHEQ *ON
     C                     MOVE *ON       *IN27
     C                     LEAVE
      *
      ** Enter Key
      *
     C                     OTHER
      *
      ** Priority on Review from fields: if this is entered, process
      ** this request
      *
     C           SCRREV    IFNE SAVREV
      *
     C                     EXSR SRVALR
      *
      ** If no error on Review fields, re-load subfile
      *
     C           WERRF     IFEQ ' '
     C                     EXSR SRREVW
     C                     ENDIF
      *
     C                     ELSE
      *
      ** Process subfile action; validate tags
      *
     C                     Z-ADD0         WDETL   10
     C           *IN86     IFEQ *OFF
     C                     EXSR SRVALS
     C                     ENDIF
      *
      ** If there are no errors on tags, process detail screen
      *
     C           WERRF     IFNE 'Y'
      *
     C           WDETL     IFEQ 1
     C                     MOVE *OFF      *IN06
     C                     READCLE2120S0                 06
      *
      ** Do until no more selection, or F3 or F12 pressed
      *
     C           *IN06     DOWEQ*OFF
      *
      ** Build LOAM key
      *
     C           SACTN     IFNE ' '
     C                     MOVE SLOAN     WLLOAN
     C                     MOVE SVDTH     WLVDAT
     C                     MOVE SSEQN     WLLASN
      *
      ** Access loan amendment record, set prev screen to subfile dsp
      *
     C           WKLAM     CHAINLOAMS               N01
      *
     C           *IN01     IFEQ *ON
     C                     ELSE
     C                     MOVE 'S'       WPREV
     C                     EXSR SRDETL
     C                     MOVE ' '       SACTN
     C                     UPDATLE2120S0
      *
     C           *INKL     IFEQ *ON
     C           *INKC     OREQ *ON
     C                     LEAVE
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *
     C                     READCLE2120S0                 06
     C                     ENDDO
      *
      ** If successful process of all records, refresh subfile
      *
     C           *IN06     IFEQ *ON
     C           *INKL     ANDEQ*OFF
     C                     EXSR SRREVW
     C                     ENDIF
      *
     C                     ELSE
     C                     EXSR SRREVW
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
     C                     ENDSL
      *
     C                     ENDIF
      *
     C                     MOVE 'I'       WPREV
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRDETL  -  Process Detail screen                              *
      * Called by: SRINPU - Process input screen for Interactive/Rec  *
      *            SRSUBF - Process subfile                           *
      * Calls    : SRINZD - Initialise detail screen                  *
      *            SRCLRS - Clear subfile message queue               *
      *            SRPREV - Process previous screen                   *
      *            SRUPDT - Update files                              *
      *            SRVAL2 - Validate detail screen                    *
      *            SRSETT - Settlements screen                        *
      *            SRWIND - Window Processing                         *
      *            SRWARN - Display warning message if loan is synd.  *   159256
      *                                                               *
      *****************************************************************
      *
     C           SRDETL    BEGSR
      *
      ** Initialise screen indicators and work fields
      *
     C                     EXSR SRINZD
      *                                                                   148624
      * F12 from detail screen after returning from settlement            148624
      * screen during authorisation.                                      148624
      * Enter from detail screen after returning from settlement          148624
      * screen when using F14 to show settlement screen during            148624
      * authorisation.                                                    148624
      *                                                                   148624
     C                     MOVE *BLANKS   @F12A   1                       148624
     C                     MOVE *BLANKS   @ENTA   1                       148624
      *
      **  Do until F3 or F12 pressed
      *
     C           *INKC     DOWEQ*OFF
      *                                                                   148624
      ** Return to sfl - F12 from detail screen after returning           148624
      ** from settlement screen during authorisation.                     148624
      *                                                                   148624
     C           @F12A     IFEQ 'Y'                                       148624
     C                     EXSR SRPREV                                    148624
     C                     LEAVE                                          148624
     C                     ENDIF                                          148624
      *                                                                   159256
      ** Issue warning if loan is a syndicated loan (if called from       159256
      ** subfile processing).                                             159256
      *                                                                   159256
     C           SACTN     IFNE 'E'                                       159256
     C           SACTN     ANDNE'I'                                       159256
     C           WOPTN     ANDEQ'S'                                       159256
     C                     EXSR SRWARN                                    159256
     C                     ENDIF                                          159256
      *
      ** Write footer and message subfile
      ** Do not output detail screen again if Enter pressed on            148624
      ** detail screen when settlements displayed using F14               148624
      ** during authorisation.                                            148624
      *
     C           *IN53     IFEQ '0'                                       187559
     C           *INKK     IFNE *ON                                       172706
     C           *INKN     IFEQ *OFF                                      172288
     C***********@ENTA     IFEQ *BLANKS                            148624 169698
     C           *INKN     OREQ '1'                                       187559
     C           WERRF     ANDNE' '                                       187559
     C                     WRITELE2120C1
     C                     WRITELE2120F4
     C                     EXFMTLE2120F3
     C***********          ENDIF                                   148624 169698
     C                     ENDIF                                          172288
     C                     ENDIF                                          172706
      *                                                                   187559
     C                     ELSE                                           187559
     C                     MOVE '0'       *IN53                           187559
     C                     ENDIF                                          187559
      *
      ** Clear subfile message queue and setof error indicators
      *
     C           SAVSCR    IFNE SCRFLD
     C           *IN44     OREQ '1'                                       142398
     C           *IN41     OREQ '1'                                       157209
     C           *IN42     OREQ '1'                                       157209
     C           *IN43     OREQ '1'                                       157209
     C           *IN45     OREQ '1'                                       157209
     C                     MOVEA'00000'   *IN,41
     C                     EXSR SRCLRS
     C                     ENDIF
      *
     C           *INKC     IFEQ *OFF
      *
     C                     SELEC
      *
      ** F12 - Previous
      *
     C           *INKL     WHEQ *ON
     C                     EXSR SRPREV
     C                     LEAVE
      *
      ** F10 - Delete
      *
     C           *INKJ     WHEQ *ON
     C                     EXSR SRUPDT
     C                     LEAVE
      *
      ** F11 - Authorise
      *
     C           *INKK     WHEQ *ON
     C           WXPAS     IFEQ 'N'
     C           WXPAS     OREQ 'W'                                       142398
     C                     MOVE 'Y'       WXPAS                           142398
     C                     EXSR SRVAL2
     C***********          MOVE 'Y'       WXPAS                           142398
     C                     ENDIF
      *
     C           WERRF     IFEQ ' '
     C           WMSEV     ANDEQ' '
     C           *INKN     ANDNE*ON                                       172706
     C                     EXSR SRUPDT
     C                     LEAVE
     C                     ENDIF
      *
      ** F14 - Settlements
      *
     C           *INKN     WHEQ *ON
     C           SACTN     IFEQ 'E'
     C           SACTN     OREQ 'R'
     C           SACTN     OREQ 'X'
     C                     MOVE 'Y'       WPASS
     C                     EXSR SRSETT
     C                     ELSE
     C                     EXSR SRVAL2
      *
      ** Window Processing
      *
     C           WMSEV     IFEQ ' '
     C           WERRF     ANDEQ' '
     C/COPY WNCPYSRC,LE2120C015
     C                     EXSR SRWIND
     C                     ENDIF
      *
     C           *INKC     IFEQ *ON
     C                     LEAVE
     C                     ENDIF
      *
      ** If no errors, proceed to update file
      *
     C           WERRF     IFEQ ' '
     C           WSDTV     ANDEQ'Y'
     C           WMSEV     ANDEQ' '
     C           SACTN     ANDNE'X'
     C           *IN87     OREQ *ON                                       123857
     C           SACTN     ANDEQ'X'                                       123857
     C           WMSEV     ANDEQ' '                                       123857
     C           W#EXIT    ANDEQ'Y'                                       123857
      *
     C                     EXSR SRUPDT
      *
     C           WERRF     IFEQ ' '
     C                     LEAVE
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *
     C                     OTHER
      *
      ** Enter Key
      *
      ** No further processing for Enquiry
      *
     C           SACTN     IFEQ 'E'
     C                     LEAVE
     C                     ENDIF
      *
      ** If screen fields have been altered since last validation,
      ** validate again
      *
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C           SACTN     OREQ 'X'
      *
     C           SAVSCR    IFNE SCRFLD
     C           SAVSCR    OREQ SCRFLD
     C           WSDTV     ANDEQ'N'
     C                     EXSR SRVAL2
     C                     ENDIF
      *
      ** Window Processing
      *
     C           WMSEV     IFEQ ' '
     C           WERRF     ANDEQ' '
     C/COPY WNCPYSRC,LE2120C016
     C                     EXSR SRWIND
     C                     ENDIF
      *
     C           *INKC     IFEQ *ON
     C                     LEAVE
     C                     ENDIF
      *
      ** If no errors, proceed to update file
      *
     C           WERRF     IFEQ ' '
     C           WSDTV     ANDEQ'Y'
     C           WMSEV     ANDEQ' '
     C           SACTN     ANDNE'X'
     C           WERRF     OREQ ' '                                       128968
     C           WSDTV     ANDEQ'Y'                                       128968
     C           WMSEV     ANDEQ' '                                       128968
     C           SACTN     ANDEQ'X'                                       128968
     C           *IN87     ANDEQ'1'                                       128968
      *
     C                     EXSR SRUPDT
      *
     C           WERRF     IFEQ ' '
     C                     LEAVE
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSL
     C                     MOVE SCRFLD    SAVSCR
      *                                                                   123857
      * If warning error is shown allow user to authorise and exit from   123857
      * screen.                                                           123857
      *                                                                   123857
     C           SACTN     IFEQ 'X'                                       123857
     C           *IN87     ANDEQ*ON                                       123857
     C                     MOVE 'Y'       W#EXIT  1                       123857
     C                     ENDIF                                          123857
      *
      ** Warning error
      *
     C           WMSEV     IFEQ 'W'
     C                     MOVE ' '       WMSEV
     C                     ENDIF
      *
     C           *INKL     IFEQ *ON
     C                     MOVE *OFF      *INKL
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     EXSR SRCLRS
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRWIND  -  Window Processing                                  *
      * Called by: SRDETL - Detail Processing                         *
      * Calls    : None                                               *
      *****************************************************************
     C           SRWIND    BEGSR
      *
     C/COPY WNCPYSRC,LE2120MOV1
      *
     C                     MOVE SACTN     UACTCD
     C           SACTN     IFEQ 'X'
     C                     MOVE 'E'       UACTCD
     C                     ENDIF
     C           SACTN     IFEQ 'R'
     C                     MOVE 'D'       UACTCD
     C                     ENDIF
      *
     C                     CALL 'WN0010'
     C                     PARM ##PGM     UPGM   10        Program
     C                     PARM *BLANK    UFKEY   2        Function Key
     C                     PARM           UACTCD  1        Action
     C                     PARM           DATA             Trans Data
     C                     PARM *BLANK    W0RTN   7        Return Code
     C                     PARM           SPARE 256        Spare Field
      *
     C                     SELEC
     C           W0RTN     WHEQ 'Y2U9999'
     C                     MOVE *ON       *INKC
      *
     C           W0RTN     WHEQ 'USR0790'
     C                     MOVE *ON       *INKL
      *
     C           W0RTN     WHNE *BLANKS
     C                     MOVELW0RTN     ZAMSID
     C                     MOVEL'WNMSGF'  ZAMSGF
     C                     MOVEL'LERMSGF' ZAMSGF
     C                     EXSR ZASNMS
     C                     ENDSL
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRUPDT  -  Update files                                       *
      * Called by: SRBTCH - Batch mode processing                     *
      *            SRDETL - Process detail screen                     *
      * Calls    : SRNSEQ - Get next amendment sequence number        *
      *            SRSETU - Set up fields for update                  *
      *            SRSHAD - Set up parameter for Shadow Post          *
      *            SRUSHD - Update shadow record                      *
      *            SRUPLX - Update Loan transaction index             *
      *            SRUPCL - Update Loans file                         *
      *            SRUPFC - Update Facility file                      *
      *            SRUPTR - Update Loan Amendments Trailer file       *
      *            SREROR - Error processing                          *
      *            ZTNLU1 - Get next transaction number               *
      *            SRFEES - Update Fees File                          *   CLE009
      *                                                               *
      *****************************************************************
      *
     C           SRUPDT    BEGSR
      *
      ** Build key for chain to LOAMS
      *
     C                     MOVE SVDAT     ZDAYNO
     C                     MOVE SVDAT     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    WLVDAT
      *
     C                     MOVE SSEQN     WLLASN
      *
      ** Get next sequence number if Insert
      *
      *
     C           SACTN     IFEQ 'I'
     C                     EXSR SRNSEQ
     C                     ENDIF
      *
      ** Access record for any updates to this record
      *
     C                     MOVE SLOAN     WLLOAN
      *
     C           WKLAM     CHAINLOAMS                01
      *
     C                     Z-ADDLCD       WLCD    50
     C                     MOVE CHTP      WCHTP   1
     C                     Z-ADDTNLU      WTNLU   50
     C                     MOVE WLSTC     NEWLC  11
      *
      ** If:  Record not found and action is A, X or D, or found and
     C           *IN01     IFEQ *ON
     C           SACTN     ANDNE'I'
      *
      **      Action is Insert, or
     C           *IN01     OREQ *OFF
     C           SACTN     ANDEQ'I'
      *
      **      Change details have been altered, or
     C           NEWLC     ORNE SAVLC
     C           SACTN     ANDNE'I'
      *
      **      Record already reversed
     C           *IN01     OREQ *OFF
     C           RECI      ANDNE'D'
      *
     C                     MOVEL'LES9999' ZAMSID
     C                     EXSR SREROR
     C                     MOVE 'Y'       WTERM   1
     C                     ENDIF
      *
     C           WERRF     IFEQ ' '
      *
      ** No errors, continue update
      *
      ** Obtain last transaction number
      *
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      TNLU
      *
      ** Setup fields for output to LOAMS
      *
     C                     EXSR SRSETU
      *                                                                   CEU020
      ** If SAR CEU020 is installed and loan amendment is allowed to ha   CEU020
      ** ve a loan amendment currency of Euro                             CEU020
      *                                                                   CEU020
     C           CEU020    IFEQ 'Y'                                       CEU020
     C           ECIN      ANDEQ' '                                       CEU020
     C                     MOVE 'N'       ECIN                            CEU020
     C                     ENDIF                                          CEU020
      *                                                                                       CSD015
      ** Call  SRWTCH if watch list checking is apllied.                                      CSD015
      *                                                                                       CSD015
     C                     MOVEL'N'       WNBLNK  1                                           CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C           SACTN     IFEQ 'I'                                                           CSD015
     C                     EXSR SRBLDA                                                        CSD015
      *                                                                                       CSD015
     C           WNBLNK    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
      ** If 24X7 is not installed or the suport system is off.                                CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           SACTN     IFEQ 'A'                                                           CSD015
      *                                                                                       CSD015
     C                     MOVEL*BLANKS   KFUNT                                               CSD015
     C                     MOVEL*BLANKS   KIDEN                                               CSD015
     C                     MOVEL*BLANKS   KBRCH                                               CSD015
     C                     MOVEL*BLANKS   WKIDEN                                              CSD015
     C                     MOVEL*BLANKS   WLNRF                                               CSD015
     C                     MOVEL*BLANKS   WVDAT                                               CSD015
     C                     MOVEL*BLANKS   WLASN                                               CSD015
     C                     MOVE *OFF      *IN39                                               CSD015
      *                                                                                       CSD015
     C                     MOVE LNRF      WLNRF                                               CSD015
     C                     MOVE VDAT      WVDAT                                               CSD015
     C                     MOVE LASN      WLASN                                               CSD015
     C           WLNRF     CAT  WVDAT:0   WKIDEN 40                                           CSD015
     C                     CAT  WLASN:0   WKIDEN                                              CSD015
      *                                                                                       CSD015
      ** If 24X7 is not installed or the suport system is off.                                CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
      *                                                                                       CSD015
     C                     MOVEL'LOAMSDK' KFUNT                                               CSD015
     C                     MOVELWKIDEN    KIDEN                                               CSD015
     C                     MOVELBRCA      KBRCH                                               CSD015
     C           CWHTKY    CHAINSDCWHTL1             39                                       CSD015
      *                                                                                       CSD015
     C           *IN39     IFEQ *OFF                                                          CSD015
     C           W3UNCF    ANDEQ'Y'                                                           CSD015
     C                     EXSR SRBLDA                                                        CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           WDIFF     IFEQ 'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PMREXR    REXRK                                               CLE031
     C                     MOVE PMPEXR    PEXRK                                               CLE031
     C                     MOVE PMREXI    REXIK                                               CLE031
     C                     MOVE PMPEXI    PEXIK                                               CLE031
     C                     MOVE PMPSCY    PSCYK                                               CLE031
     C                     MOVE PMRSCY    SCCY                                                CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CAS009
      ** If CAS009 is On, update LEEIRDPD if Insert or Reverse                                CAS009
      ** for all records affected by the value date of the                                    CAS009
      ** manual repayment record.                                                             CAS009
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C***********          MOVE SLOAN     WLOAN   60                                   CAS009 CLE148
     C                     MOVE SLOAN     WLOAN   6                                           CLE148
     C           WLOAN     CHAINLEEIRDL5             20                                       CAS009
     C           *IN20     IFEQ '0'                                                           CAS009
      *                                                                                       CAS009
     C           SACTN     IFEQ 'I'                                                           CAS009
     C           SACTN     OREQ 'R'                                                           CAS009
     C           VDAT      IFLE EIENDT                                                        CAS009
     C                     MOVE 'Y'       EIRCAL                                              CAS009
     C                     UPDATLEEIRDD0                                                      CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** ENDIF of CAS009                                                                      CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      *
      ** Update Loan Amendments Detail
      *
     C           SACTN     IFEQ 'I'
     C                     WRITELOAMSDKF
     C/COPY ZSRSRC,DFTTSTAMPC                                             CLE029
     C                     MOVELTSTAMP    TMSTK                           CLE029
     C/COPY WNCPYSRC,LE2120C017
     C                     ELSE
     C                     UPDATLOAMSDKF
     C                     ENDIF
      *                                                                                       CLE034
      ** After LOAMSDK has been written to, need to update the                                CLE034
      ** settlement allocations table.                                                        CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
     C           SACTN     ANDEQ'I'                                                           CLE034
     C           WNKEY     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALU0'                                                    CLE034
     C                     PARM PMODE     PRTCD                                               CLE034
     C                     PARM 'LARE  '  PTYPE                                               CLE034
     C                     PARM 'U'       PACTN   1                                           CLE034
     C                     PARM           LNRF                                                CLE034
     C                     PARM           VDAT                                                CLE034
     C                     PARM           LASN                                                CLE034
     C                     PARM *BLANKS   PCNUM                                               CLE034
     C                     PARM *BLANKS   PFACL                                               CLE034
     C                     PARM *BLANKS   PFESQ                                               CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM           PCRFK                                               CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *
      ** Other Updates
      *
      ** Shadow posting
      *
      *                                                                   175450
      ** Update on shadow files should only be done if not a Risk loan    175450
      *                                                                   175450
     C           PTYP      IFNE 70                                        175450
     C           PTYP      ANDNE71                                        175450
     C           PTYP      ANDNE72                                        175450
     C           SACTN     IFNE 'X'                            IAR
     C           SACTN     IFNE 'R'                                       123699
     C                     MOVE NEWSET    OTIST
     C                     ENDIF                                          123699
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
     C           SACTN     ANDEQ'R'                                                           CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALU0'                                                    CLE034
     C                     PARM PMODE     PRTCD                                               CLE034
     C                     PARM 'LARE  '  PTYPE                                               CLE034
     C                     PARM 'D'       PACTN   1                                           CLE034
     C                     PARM           LNRF                                                CLE034
     C                     PARM           VDAT                                                CLE034
     C                     PARM           LASN                                                CLE034
     C                     PARM *BLANKS   PCNUM                                               CLE034
     C                     PARM *BLANKS   PFACL                                               CLE034
     C                     PARM *BLANKS   PFESQ                                               CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM           PCRFK                                               CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     EXSR SRSHAD
     C                     MOVE Z#ADTA    Z#ADT1
     C***********          MOVE Z#ADTB    Z#ADTB                          123699
     C                     MOVE Z#ADTB    Z#ADT2                          123699
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           CLE031    OREQ 'Y'                                                           CLE031
     C                     MOVE Z#ADTE    Z#ADT5                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C                     EXSR SRUSHD
     C                     ENDIF
     C/COPY WNCPYSRC,LE2120C019
     C                     ENDIF                                          175450
      *
      ** Write to LTRIX if S01465 feature is switched on
      *
     C           S01465    IFEQ 'Y'
     C                     EXSR SRUPLX
     C                     ENDIF
      *
      ***Update*Loans*File*                                               153663
      ***********                                                         153663
     C***********PMODE     IFNE 'B'                                       153663
     C***********          EXSR SRUPCL                                    153663
     C***********          ENDIF                                          153663
      *
      ** Update Facility file
      *
     C           SACTN     IFNE 'X'
     C                     EXSR SRUPFC
     C                     ENDIF
      *                                                                   CLE009
      ** If CLE009 is installed, update fees file                         CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     EXSR SRFEES                                    CLE009
     C                     ENDIF                                          CLE009
      *
      ** Update Loan Amendments Trailer
      *
     C                     EXSR SRUPTR
      *                                                                   CDE001
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           CDE001    IFEQ 'Y'                                       CDE001
     C           WERRF     ANDEQ' '                                       CDE001
     C                     MOVELSLOAN     T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C                     PARM           T#TREF 20                       CDE001
     C                     PARM 'LOAN'    T#TCAT  4                       CDE001
     C                     PARM *BLANKS   RSRVID 10                       CDE005
     C                     ENDIF                                          CDE001
     C/COPY WNCPYSRC,LE2120C022
      *
      ** Commit changes only on non-Play mode and no errors on the
      ** update proessing
      *
     C           PMODE     IFNE 'P'
     C           PMODE     ANDNE'B'                                       120002
     C           WERRF     IFEQ ' '
     C                     COMIT
      *
      ** On Record mode, write to Test Harness
      *
     C           PMODE     IFEQ 'R'
     C                     MOVE L2120S    L2120F
     C                     WRITELE2120D0
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                   187559
      ** Reset field after update.                                        187559
      *                                                                   187559
     C           WERRF     IFEQ ' '                                       187559
     C                     MOVE 'N'       SEENSL                          187559
     C                     ENDIF                                          187559
     C/COPY WNCPYSRC,LE2120C001
      *
     C                     ENDSR
     C/COPY WNCPYSRC,LE2120C023
      *****************************************************************                       CSD015
      *  SRBLDA  -  Build array used for storing fields in Compliance *                       CSD015
      *             Watch.                                            *                       CSD015
      *  Called by: SRUPDT                                            *                       CSD015
      *  Calls    : None                                              *                       CSD015
      *****************************************************************                       CSD015
     C           SRBLDA    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     MOVEA*BLANKS   WLF,1                                               CSD015
     C                     MOVEL'N'       WNBLNK                                              CSD015
      *                                                                                       CSD015
     C           RONS      IFNE *BLANKS                                                       CSD015
     C           RIBN      ORNE *BLANKS                                                       CSD015
     C********** ROBN      ORNE *ZERO                                                  CSD015 CSD027
     C********** ROCN      ORNE *ZERO                                                  CSD015 CSD027
     C           ROBN      ORNE *BLANKS                                                       CSD027
     C           ROCN      ORNE *BLANKS                                                       CSD027
     C           PONS      ORNE *BLANKS                                                       CSD015
     C           PIBN      ORNE *BLANKS                                                       CSD015
     C********** POBN      ORNE *ZERO                                                  CSD015 CSD027
     C********** POCN      ORNE *ZERO                                                  CSD015 CSD027
     C           POBN      ORNE *BLANKS                                                       CSD027
     C           POCN      ORNE *BLANKS                                                       CSD027
     C           RCRN      ORNE *BLANKS                                                       CSD015
     C           RVNO      ORNE *BLANKS                                                       CSD015
     C           AWBN      ORNE *BLANKS                                                       CSD015
     C           BENN      ORNE *BLANKS                                                       CSD015
     C           DTP1      ORNE *BLANKS                                                       CSD015
     C           DTP2      ORNE *BLANKS                                                       CSD015
     C           DTP3      ORNE *BLANKS                                                       CSD015
     C           DTP4      ORNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C                     MOVEL'Y'       WNBLNK                                              CSD015
     C                     MOVEL'Y'       WDTPC                                               CSD015
      *                                                                                       CSD015
     C                     MOVELRONS      WLF,1                                               CSD015
     C                     MOVELRIBN      WLF,2                                               CSD015
     C                     MOVELROBN      WLF,3                                               CSD015
     C                     MOVELROCN      WLF,4                                               CSD015
     C                     MOVELPONS      WLF,5                                               CSD015
     C                     MOVELPIBN      WLF,6                                               CSD015
     C                     MOVELPOBN      WLF,7                                               CSD015
     C                     MOVELPOCN      WLF,8                                               CSD015
     C                     MOVELRCRN      WLF,9                                               CSD015
     C                     MOVELRVNO      WLF,10                                              CSD015
     C                     MOVELAWBN      WLF,11                                              CSD015
     C                     MOVELBENN      WLF,12                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      *  SRWTCH  -  Performs the Watch list processing.               *                       CSD015
      *  Called by: SRUPDT                                            *                       CSD015
      *  Calls    : None                                              *                       CSD015
      *****************************************************************                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** PARAMETER 2:                                                                         CSD015
     C                     CLEARPARMDS                                                        CSD015
     C                     Z-ADD0         WID     20                                          CSD015
      *                                                                                       CSD015
     C           WID       DOUEQ12                                                            CSD015
     C                     ADD  1         WID                                                 CSD015
     C                     MOVELWLF,WID   PINP1                                               CSD015
      *                                                                                       CSD015
     C           WLF,WID   IFNE *BLANKS                                                       CSD015
     C           WLF,WID   ANDNE'000000'                                                      CSD015
      *                                                                                       CSD015
     C           SCCY      IFNE *BLANKS                                                       CSD015
     C                     MOVELSCCY      PCCY                                                CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELCCY       PCCY                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     CALL 'SDCWLFMT'                                                    CSD015
     C                     PARM           PRTCD   7                                           CSD015
     C                     PARM           PINP1  35                                           CSD015
     C                     PARM *BLANKS   PINP2  35                                           CSD015
     C                     PARM *BLANKS   PINP3  35                                           CSD015
     C                     PARM *BLANKS   PINP4  35                                           CSD015
     C                     PARM *BLANKS   PINP5  35                                           CSD015
     C                     PARM *BLANKS   PINP6  35                                           CSD015
     C                     PARM CCY       PCCY    3                                           CSD015
     C                     PARM           POUT  216                                           CSD015
     C                     PARM           PCNUM   6                                           CSD015
      *                                                                                       CSD015
     C           POUT      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCWP2                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
      ** Add the Payment Details.                                                             CSD015
      *                                                                                       CSD015
     C           DTP1      IFNE *BLANKS                                                       CSD015
     C           DTP2      ORNE *BLANKS                                                       CSD015
     C           DTP3      ORNE *BLANKS                                                       CSD015
     C           DTP4      ORNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           WDTPC     IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     CAT  CWA,25:0  PARMDS                                              CSD015
     C                     CAT  DTP1:0    PARMDS                                              CSD015
     C                     CAT  DTP2:1    PARMDS                                              CSD015
     C                     CAT  DTP3:1    PARMDS                                              CSD015
     C                     CAT  DTP4:1    PARMDS                                              CSD015
     C                     CAT  CWA,26:0  PARMDS                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      **  Set up parameter 1 and send details to engine only if                               CSD015
      **  PARMDS is not empty.                                                                CSD015
      *                                                                                       CSD015
     C           PARMDS    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
      ** PARAMETER 1:                                                                         CSD015
      ** Item Type Code                                                                       CSD015
     C                     MOVEL'LESCHD'  W4ITEM                                              CSD015
      *                                                                                       CSD015
      ** Identifier                                                                           CSD015
     C                     MOVEL*BLANKS   WLNRF                                               CSD015
     C                     MOVEL*BLANKS   WVDAT                                               CSD015
     C                     MOVEL*BLANKS   WLASN                                               CSD015
     C                     MOVEL*BLANKS   W4IDEN                                              CSD015
      *                                                                                       CSD015
     C                     MOVE LNRF      WLNRF   6                                           CSD015
     C                     MOVE VDAT      WVDAT   5                                           CSD015
     C                     MOVE LASN      WLASN   3                                           CSD015
     C           WLNRF     CAT  WVDAT:0   W4IDEN                                              CSD015
     C                     CAT  WLASN:0   W4IDEN                                              CSD015
      *                                                                                       CSD015
      ** Branch                                                                               CSD015
     C                     MOVELBRCA      W4BRCH                                              CSD015
      *                                                                                       CSD015
      ** System                                                                               CSD015
      ** If Midas 24x7 is installed, use Main system prefix otherwise use system prefix       CSD015
     C           CSC011    IFEQ 'Y'                                                           CSD015
     C                     MOVE S1MAIN    W4SYSM                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE LIBR      W4SYSM                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Function Type                                                                        CSD015
     C                     MOVEL'LOAMSDK' W4FUNT                                              CSD015
      *                                                                                       CSD015
      ** Counter Party                                                                        CSD015
     C                     MOVE PCNUM     WCNUM   6                                           CSD015
     C                     CALL 'AOCUSTR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*KEY   ' POPTN                                               CSD015
     C                     PARM WCNUM     PCUST                                               CSD015
     C                     PARM           PKYST                                               CSD015
     C           SDCUST    PARM SDCUST    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C           BBCRNM    CAT  BBCRTN    W4CUST                                              CSD015
     C                     MOVE PCNUM     W4CNUM                                              CSD015
      *                                                                                       CSD015
     C           CCF001    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           BBCRPC    IFEQ 'Y'                                                           CSD015
     C                     MOVE 'C'       W4CTYP                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           BBLICD    IFNE *BLANK                                                        CSD015
     C           BBLICD    ANDNEW1IND1                                                        CSD015
     C           BBLICD    ANDNEW1IND2                                                        CSD015
     C           BBLICD    ANDNEW1IND3                                                        CSD015
     C           BBLICD    ANDNEW1IND4                                                        CSD015
     C           BBLICD    ANDNEW1IND5                                                        CSD015
     C                     MOVE 'C'       W4CTYP                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Deal Date                                                                            CSD015
     C                     MOVE *ZERO     W4DDAT                                              CSD015
      *                                                                                       CSD015
      ** Value Date                                                                           CSD015
     C                     Z-ADDVDATA     W4VDAT                                              CSD015
      *                                                                                       CSD015
      ** Maturity Date                                                                        CSD015
     C                     MOVE *ZERO     W4MDAT                                              CSD015
      *                                                                                       CSD015
      ** Denomination Side 1                                                                  CSD015
     C                     MOVELCCY       W4DEN1                                              CSD015
     C                     MOVE *BLANKS   W4DEN2                                              CSD015
      *                                                                                       CSD015
      ** Amount Side 1                                                                        CSD015
     C                     MOVELTAMT      W4AMT1                                              CSD015
     C                     MOVE *ZERO     W4AMT2                                              CSD015
      *                                                                                       CSD015
      *                                                                                       CSD015
      ** Send transaction details to Compliance Watch by calling SDWLCLOP                     CSD015
      *                                                                                       CSD015
     C                     CALL 'SDWLCLOP'                                                    CSD015
     C                     PARM           CWLCDS                                              CSD015
     C                     PARM           PARMDS                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      *  SRCWP2  -  Set up the 2nd parameter for Compliance Watch.    *                       CSD015
      *  Called by: SRUPDT                                            *                       CSD015
      *  Calls    : None                                              *                       CSD015
      *****************************************************************                       CSD015
     C           SRCWP2    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C           WID       MULT 2         CLS     20                                          CSD015
     C           CLS       SUB  1         OPN     20                                          CSD015
      *                                                                                       CSD015
     C                     MOVELCWA,OPN   WOPN   25                                           CSD015
     C                     MOVELCWA,CLS   WCLS   25                                           CSD015
      *                                                                                       CSD015
     C           PARMDS    CAT  WOPN:0    PARMDS                                              CSD015
     C                     CAT  POUT:0    PARMDS                                              CSD015
      *                                                                                       CSD015
     C                     SELEC                                                              CSD015
     C           WID       WHEQ 2                                                             CSD015
     C                     CAT  RIBA:0    PARMDS                                              CSD015
     C           WID       WHEQ 6                                                             CSD015
     C                     CAT  PIBA:0    PARMDS                                              CSD015
     C           WID       WHEQ 9                                                             CSD015
     C                     CAT  RCRA:0    PARMDS                                              CSD015
     C           WID       WHEQ 11                                                            CSD015
     C                     CAT  AWBA:0    PARMDS                                              CSD015
     C           WID       WHEQ 12                                                            CSD015
     C                     CAT  BENA:0    PARMDS                                              CSD015
     C                     ENDSL                                                              CSD015
      *                                                                                       CSD015
     C                     CAT  WCLS:0    PARMDS                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************   CLE009
      * SRFEES  -  Update Fees File                                   *   CLE009
      * Called by: SRUPDT - Update files                              *   CLE009
      * Calls    : None                                               *   CLE009
      *****************************************************************   CLE009
     C           SRFEES    BEGSR                                          CLE009
      *                                                                   CLE009
      ** If authorisation switchable feature is on and action code        CLE009
      ** is insert or amend and Repayment Schedules Authorisations is     CLE009
      ** required                                                         CLE009
      *                                                                   CLE009
     C           CLE002    IFEQ 'Y'                                       CLE009
     C           SACTN     ANDNE'X'                                       CLE009
     C           SACTN     ANDNE'R'                                       CLE009
     C           BPREAU    ANDEQ'Y'                                       CLE009
      *                                                                   CLE009
      ** If action code is insert                                         CLE009
      *                                                                   CLE009
     C           SACTN     IFEQ 'I'                                       CLE009
      *                                                                   CLE009
      ** Write a record to Loan Amendment Fee Index File                  CLE009
      *                                                                   CLE009
     C                     MOVE SLOAN     FFLNRF                          CLE009
     C                     Z-ADDWVDAYN    FFVDAT                          CLE009
     C                     MOVE WLLASN    FFLASN                          CLE009
     C                     MOVE *BLANKS   FFAUTH                          CLE009
     C                     MOVE WKSWRI    FFSWRI                          CLE009
     C                     WRITELEFELAD0                                  CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** If action code is amend                                          CLE009
      *                                                                   CLE009
     C           SACTN     IFEQ 'A'                                       CLE009
      *                                                                   CLE009
      ** Chain to Loan Amendment Fee Index File                           CLE009
      *                                                                   CLE009
     C                     MOVE SLOAN     WKLOAN                          CLE009
     C                     Z-ADDWVDAYN    WKDATE                          CLE009
     C                     MOVE SSEQN     WKSEQN                          CLE009
     C           KIDXF     CHAINLEFELAL0             18                   CLE009
      *                                                                   CLE009
      ** If record not found                                              CLE009
      *                                                                   CLE009
     C           *IN18     IFEQ *ON                                       CLE009
      *                                                                   CLE009
      ** Write a record to Loan Fee Index File                            CLE009
      *                                                                   CLE009
     C                     MOVE SLOAN     FFLNRF                          CLE009
     C                     Z-ADDWVDAYN    FFVDAT                          CLE009
     C                     MOVE SSEQN     FFLASN                          CLE009
     C                     MOVE 'Y'       FFAUTH                          CLE009
     C                     MOVE WKSWRI    FFSWRI                          CLE009
     C                     WRITELEFELAD0                                  CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** If work regeneration indicator is changed and regeneration       CLE009
      ** indicator is blank                                               CLE009
      *                                                                   CLE009
     C           WKSWRI    IFEQ 'C'                                       CLE009
     C           FFSWRI    ANDEQ*BLANKS                                   CLE009
      *                                                                   CLE009
      ** Update the record to Loan Amendment Fee Index File               CLE009
      *                                                                   CLE009
     C                     MOVE WKSWRI    FFSWRI                          CLE009
     C                     UPDATLEFELAD0                                  CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** If action code is authorise                                      CLE009
      *                                                                   CLE009
     C           SACTN     IFEQ 'X'                                       CLE009
      *                                                                   CLE009
      ** Chain to Loan Amendment Fee Index File                           CLE009
      *                                                                   CLE009
     C                     MOVE SLOAN     WKLOAN                          CLE009
     C                     Z-ADDWVDAYN    WKDATE                          CLE009
     C                     MOVE SSEQN     WKSEQN                          CLE009
     C           KIDXF     CHAINLEFELAL0             18                   CLE009
      *                                                                   CLE009
      ** If record is found                                               CLE009
      *                                                                   CLE009
     C           *IN18     IFEQ *OFF                                      CLE009
      *                                                                   CLE009
      ** Update the record to Loan Amendment Fee Index File               CLE009
      *                                                                   CLE009
     C                     MOVE FFSWRI    WKSWRI                          CLE009
     C                     MOVE 'Y'       FFAUTH                          CLE009
     C                     UPDATLEFELAD0                                  CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** If action code is reverse                                        CLE009
      *                                                                   CLE009
     C           SACTN     IFEQ 'R'                                       CLE009
      *                                                                   CLE009
      ** Chain to Loan Amendment Fee Index File                           CLE009
      *                                                                   CLE009
     C                     MOVE SLOAN     WKLOAN                          CLE009
     C                     Z-ADDWVDAYN    WKDATE                          CLE009
     C                     MOVE SSEQN     WKSEQN                          CLE009
     C           KIDXF     CHAINLEFELAL0             18                   CLE009
      *                                                                   CLE009
      ** If record is found                                               CLE009
      *                                                                   CLE009
     C           *IN18     IFEQ *OFF                                      CLE009
      *                                                                   CLE009
      ** If authorised is blank                                           CLE009
      *                                                                   CLE009
     C           FFAUTH    IFEQ *BLANKS                                   CLE009
     C                     MOVE *BLANKS   WKSWRI                          CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** If work regeneration indicator is blank                          CLE009
      *                                                                   CLE009
     C           WKSWRI    IFEQ *BLANKS                                   CLE009
     C                     MOVE FFSWRI    WKSWRI                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** If work regeneration indicator is changed                        CLE009
      *                                                                   CLE009
     C           WKSWRI    IFEQ 'C'                                       CLE009
      *                                                                   CLE009
      ** Check if the facility has an associated fee                      CLE009
      *                                                                   CLE009
     C                     MOVE WFFACT    CHFACT  3                       CLE009
     C                     MOVE WFFCNO    CHFCNO  2                       CLE009
     C           CHFACT    CAT  CHFCNO    CHFACL  5                       CLE009
     C                     MOVE CHFACL    WFFACL                          CLE009
     C**********           Z-ADD0         WFLOAN                                       CLE009 CLE148
     C                     MOVEL*BLANKS   WFLOAN                                              CLE148
     C           WKFEE     SETLLLEFEEDL1                                  CLE009
     C           WKFEE     READELEFEEDL1                 19               CLE009
      *                                                                   CLE009
      ** Do while an associated fee exists                                CLE009
      *                                                                   CLE009
     C           *IN19     DOWEQ*OFF                                      CLE009
      *                                                                   CLE009
      ** If the fee is a confirmed calculated fee and swift               CLE009
      ** regeneration indicator is not 'I', 'B', 'H'                      CLE009
      *                                                                   CLE009
     C                     MOVE FEAUTO    WAUTOM  1                                           CLE134
     C           WAUTOM    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C                     MOVE 'Y'       WAUTOM                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C********** FEAUTO    IFEQ 'Y'                                                    CLE009 CLE134
     C           WAUTOM    IFEQ 'Y'                                                           CLE134
     C           FECALT    ANDNE*BLANKS                                   CLE009
     C           FESWRI    ANDNE'I'                                       CLE009
     C           FESWRI    ANDNE'B'                                       CLE009
     C           FESWRI    ANDNE'H'                                       CLE009
      *                                                                   CLE009
      ** Set currency to fee currency                                     CLE009
      ** Set day to run date                                              CLE009
      ** Set number of working days to telex notice days                  CLE009
      *                                                                   CLE009
     C                     MOVE FEFCCY    ZCCY                            CLE009
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
      ** Set-up Start/Maturity indicator.                                                     CLE034
      *                                                                                       CLE034
     C           PTFI      IFNE *BLANK                                                        CEL034
     C                     MOVEL'E'       WSTMT   1                                           CLE034
     C                     ELSE                                                               CLE034
     C                     MOVEL'S'       WSTMT                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALR1'                                                    CLE034
     C                     PARM           PRTCD                                               CLE034
     C                     PARM '*TXDT  ' POPTN                                               CLE034
     C                     PARM           BJRDNB                                              CLE034
     C                     PARM           PPTYP   20                                          CLE034
     C                     PARM           WSTMT                                               CLE034
     C                     PARM           FEFCCY                                              CLE034
     C                     PARM 'N'       PNCHK   1                                           CLE034
     C                     PARM 'FEES'    PTYPE                                               CLE034
     C                     PARM           FELOAN                                              CLE034
     C                     PARM *BLANKS   PVDAT   5                                           CLE034
     C                     PARM *BLANKS   PLASN   3                                           CLE034
     C                     PARM           FECNUM                                              CLE034
     C                     PARM           FEFACL                                              CLE034
     C                     PARM           FEFSEQ                                              CLE034
     C                     PARM *ZEROS    PTNDT   50                                          CLE034
     C                     PARM *BLANK    PNOST   1                                           CLE034
      *                                                                                       CLE034
     C                     Z-ADDPTNDT     TXDT                                                CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
      *                                                                   CLE031
     C                     MOVE FEFCCY    WKCCY   3                       CLE031
      *                                                                   CLE031
     C           CLE031    IFEQ 'Y'                                       CLE031
      *                                                                   CLE031
     C           PTFI      IFEQ 'P'                                       CLE031
     C           FEPSCY    IFNE *BLANKS                                   CLE031
     C                     MOVE FEPSCY    WKCCY                           CLE031
     C                     ENDIF                                          CLE031
     C                     ELSE                                           CLE031
     C           FESCCY    IFNE *BLANKS                                   CLE031
     C                     MOVE FESCCY    WKCCY                           CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     ENDIF                                          CLE031
     C                     MOVE WKCCY     ZCCY                            CLE031
     C                     MOVE WKCCY     PCURR                           CLE031
      *                                                                   CLE031
     C                     Z-ADDBJRDNB    ZDAYNO                          CLE009
     C                     Z-ADD1         Y                               CLE009
     C********** FEFCCY    LOKUPCYA,Y                    20        CLE009 CLE031
     C           WKCCY     LOKUPCYA,Y                    20               CLE031
     C                     MOVE *OFF      *IN20                           CLE009
     C                     MOVE TND,Y     ZNRDYS                          CLE009
      *                                                                   CLE009
      ** If Fee Settlement type is '01', '02', '07', '08' or '12'         CLE009
      *                                                                   CLE009
     C           FESTTL    IFEQ 01                                        CLE009
     C           FESTTL    OREQ 02                                        CLE009
     C           FESTTL    OREQ 07                                        CLE009
     C           FESTTL    OREQ 08                                        CLE009
     C           FESTTL    OREQ 12                                        CLE009
      *                                                                   CLE009
     C                     CALL 'AONOSTR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*KEY   ' POPTN                           CLE009
     C                     PARM           PCUSN   6                       CLE009
     C**********           PARM FEFCCY    PCURR                                        CLE009 CLE036
     C                     PARM           PCURR                                               CLE036
     C**********           PARM           PACCD   4                       CLE009       CLE009 CAS011
     C                     PARM           PACCD  10                                           CAS011
     C                     PARM           PACSN   2                       CLE009
     C                     PARM FEOURS    PNONB   2                       CLE009
     C                     PARM           PBRCA                           CLE009
     C                     PARM           PCSSN  10                       CLE009
     C                     PARM           PPNOI   1                       CLE009
     C           SDNOST    PARM SDNOST    DSFDY                           CLE009
      *                                                                   CLE009
     C           PRTCD     IFNE *BLANKS                                   CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVEL'AONOSTR0'DBFILE           ************   CLE009
     C                     Z-ADD29        DBASE            * DBERR 29 *   CLE009
     C                     MOVELFEFCCY    DBKEY            ************   CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** Set Location to Nostro Location                                  CLE009
      *                                                                   CLE009
     C                     MOVE A7NOSN    ZLOC                            CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
     C                     MOVE *BLANKS   ZLOC                            CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** Calculate number of working days forward                         CLE009
      *                                                                   CLE009
     C                     EXSR ZFWDT                                     CLE009
      *                                                                   CLE009
      ** Set Telex Notice date to day number                              CLE009
      *                                                                   CLE009
     C                     Z-ADDZDYNBR    TXDT    50                      CLE009
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   CLE009
      ** If next payment date is before or equals to Telex Notice date    CLE009
      ** and Next Payment Telex indicator is set to 'Y'                   CLE009
      *                                                                   CLE009
     C           FENPYD    IFLE TXDT                                      CLE009
     C           FEPPTI    ANDEQ'Y'                                       CLE009
      *                                                                   CLE009
      ** Update Fees file                                                 CLE009
      *                                                                   CLE009
     C                     MOVE 'A'       FESWRI                          CLE009
     C                     UPDATLEFEEDF                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** If end date is before or equals to Telex Notice date and End     CLE009
      ** Telex indicator is set to 'Y'                                    CLE009
      *                                                                   CLE009
     C           FEPEND    IFLE TXDT                                      CLE009
     C           FEEPTI    ANDEQ'Y'                                       CLE009
      *                                                                   CLE009
      ** Update Fees file                                                 CLE009
      *                                                                   CLE009
     C                     MOVE 'A'       FESWRI                          CLE009
     C                     UPDATLEFEEDF                                   CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C           WKFEE     READELEFEEDL1                 19               CLE009
     C                     ENDDO                                          CLE009
     C/COPY WNCPYSRC,LEH00743
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     MOVE *BLANKS   WKSWRI                          CLE009
      *                                                                   CLE009
     C                     ENDSR                                          CLE009
      /EJECT
      *****************************************************************
      * SRUPCL  -  Update CLOAN record                                *
      * Called by: SRUPDT - Update files                              *
      * Calls    : none                                               *
      *                                                               *
      *****************************************************************
      *
     C***********SRUPCL    BEGSR                                          153663
      ***********                                                         153663
      ** Unlink loan from syndication if RE inserted/deleted              153663
      ***********                                                         153663
     C***********SACTN     IFEQ 'I'                                       153663
     C***********SACTN     OREQ 'R'                                       153663
     C***********          MOVE SLOAN     WCLOAN                          153663
     C***********          MOVE 'A'       WCRCDT                          153663
     C***********WKLON     CHAINCLOAN                02                   153663
      ***********                                                         153663
     C************IN02     IFEQ *OFF                                      153663
     C***********LNKS      IFEQ 'Y'                                 123177153663
     C***********PMODE     IFNE 'B'                                 123177153663
     C***********P#TSEQ    ORLE 1                                   123177153663
     C***********          MOVE 'N'       LNKS                            153663
     C***********          ENDIF                                    123177153663
     C***********          ENDIF                                    123177153663
     C***********          UPDATCLOANCLF                                  153663
     C***********          ENDIF                                          153663
     C***********          ENDIF                                          153663
      ***********                                                         153663
     C***********          ENDSR                                          153663
      *
      /EJECT
      *****************************************************************
      * FCLTSR   - Update Facility file                               *
      * Called by: SRUPFC - Setup file for update of Facility         *
      * Calls    : SRCURR - Access currency details                   *
      *            QFCLTY - Update exposure value for facility        *
      *                                                               *
      *****************************************************************
      *
     C           FCLTSR    BEGSR
      *
      ** Get facility ccy decimal places
      *
     C                     Z-ADDWVDAYN    DAYNO   50
     C           WTRCA     IFEQ *BLANK                                    CLE005
     C                     MOVE FCCY      WCURR
     C                     EXSR SRCURR
     C                     Z-ADDA6NBDP    WFCDP   10
     C                     MOVE A6MDIN    WFMDI   1                                           CLE023
     C                     Z-ADDA6SPRT    WFSPT  138                                          CLE023
      *
      ** Get Loan ccy decimal places
      *
     C                     MOVE LCCYC     WCURR
     C                     EXSR SRCURR
     C                     Z-ADDA6NBDP    WLCDP   10
     C                     MOVELA6MDIN    WLMDI   1                                           CLE023
     C                     Z-ADDA6SPRT    WLSPT  138                                          CLE023
     C                     MOVE LCCYC     WCCYX   3                                           CLE023
      *
     C           WFCDP     SUB  WLCDP     WCX     10
     C                     ADD  4         WCX
     C           FMDI      IFEQ 'D'
     C*********  FCXR      DIV  POWR,WCX  WFCXRT                                              202239
     C           FCXR      DIV  POWR,WCX  WFCXRT    H                                         202239
     C           1         DIV  WFCXRT    WFCXRT
     C                     ELSE
     C           FCXR      MULT POWR,WCX  WFCXRT 159H
     C                     ENDIF
      *                                                                                       CLE023
      ** Use new facility exchange rate (NFCE) to update CAMD if                              CLE023
      ** backvalued rollover exists w/c is earlier than repayement                            CLE023
      ** schedule                                                                             CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
      *                                                                                       CLE023
     C           RLDT      IFNE 0                                                             CLE023
     C           NFCE      ANDNE0                                                             CLE023
     C           NCCY      ANDEQ*BLANKS                                                       CLE023
     C           RLDT      ANDLTBJRDNB                                                        CLE023
      *                                                                                       CLE023
     C           NFMD      IFEQ 'D'                                                           CLE023
     C           NFCE      DIV  POWR,WCX  WFCXRT    H                                         CLE023
     C           1         DIV  WFCXRT    WFCXRT                                              CLE023
     C                     ELSE                                                               CLE023
     C           NFCE      MULT POWR,WCX  WFCXRT 159H                                         CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF                                          CLE005
      *
      ** Use WFCXRT when calculating for the correct payment amount.                          194724
      *                                                                                       194724
     C           SACTN     IFEQ 'I'
     C********** WLAMT     MULT POWR,WCX  WFCBAL                                              194724
     C********** WLAMT     MULT WFCXRT    WFCBAL                                       194724 202239
     C           WLAMT     MULT WFCXRT    WFCBAL    H                                         202239
     C                     ELSE
     C           REPTC     IFEQ 1
     C********** PRAM      MULT POWR,WCX  WFCBAL 130                                          194724
     C********** PRAM      MULT WFCXRT    WFCBAL 130                                   194724 202239
     C           PRAM      MULT WFCXRT    WFCBAL 130H                                         202239
     C                     ELSE
     C********** TAMT      MULT POWR,WCX  WFCBAL                                              194724
     C********** TAMT      MULT WFCXRT    WFCBAL                                       194724 202239
     C           TAMT      MULT WFCXRT    WFCBAL    H                                         202239
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CLE023
      ** Lending Enhancement CLE023 is switched on                                            CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
      *                                                                                       CLE023
      ** cross exchange rate bet Facility ccy and Loan ccy                                    CLE023
      *                                                                                       CLE023
     C                     MOVE WLMDI     ZMDI1                                               CLE023
     C                     Z-ADDWLSPT     ZRATE1                                              CLE023
     C                     MOVE WFMDI     ZMDI2                                               CLE023
     C                     Z-ADDWFSPT     ZRATE2                                              CLE023
     C                     EXSR ZXRATE                                                        CLE023
      *                                                                                       CLE023
     C           ZMDIX     IFEQ 'D'                                                           CLE023
     C           ZRATEX    DIV  POWR,WCX  WSPXRT    H                                         CLE023
     C           1         DIV  WSPXRT    WSPXRT                                              CLE023
     C                     ELSE                                                               CLE023
     C           ZRATEX    MULT POWR,WCX  WSPXRT 159H                                         CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
      ** Calculate equivalent repayment amount at spot rate                                   CLE023
      *                                                                                       CLE023
     C           SACTN     IFEQ 'I'                                                           CLE023
     C           WLAMT     MULT WSPXRT    WCEXP  130H                                         CLE023
     C                     ELSE                                                               CLE023
     C           REPTC     IFEQ 1                                                             CLE023
     C           PRAM      MULT WSPXRT    WCEXP     H                                         CLE023
     C                     ELSE                                                               CLE023
     C           TAMT      MULT WSPXRT    WCEXP     H                                         CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF                                                              CLE023
      *                                                                   CLE005
      ** Get amount in credit facility currency equivalent,               CLE005
      ** if necessary, for CLE005                                         CLE005
      *                                                                   CLE005
     C           WTRCA     IFEQ 'Y'                                       CLE005
     C           WTCCY     ANDNEFCCY                                      CLE005
     C                     MOVE FCCY      WCURR                           CLE005
     C                     EXSR SRCURR                                    CLE005
     C                     Z-ADDA6NBDP    WFCDP                           CLE005
      *                                                                                       CLE023
     C                     Z-ADDA6SPRT    WFSPT                                               CLE023
     C                     MOVE A6MDIN    WFMDI                                               CLE023
     C                     MOVE WTCCY     WCURR                           CLE005
     C                     EXSR SRCURR                                    CLE005
     C                     Z-ADDA6NBDP    WLCDP                           CLE005
      *                                                                                       CLE023
     C                     Z-ADDA6SPRT    WLSPT                                               CLE023
     C                     MOVE A6MDIN    WLMDI                                               CLE023
     C                     MOVE WTCCY     WCCYX                                               CLE023
      *                                                                   CLE005
     C           WFCDP     SUB  WLCDP     WCX     10                      CLE005
     C                     ADD  4         WCX                             CLE005
     C           WFCMDI    IFEQ 'D'                                       CLE005
     C           WFCAXR    DIV  POWR,WCX  WCXRT  159H                     CLE005
     C           1         DIV  WCXRT     WCXRT                           CLE005
     C                     ELSE                                           CLE005
     C           WFCAXR    MULT POWR,WCX  WCXRT     H                     CLE005
     C                     ENDIF                                          CLE005
     C**********           MULT WCXRT     WFCBAL                                       CLE005 202239
     C                     MULT WCXRT     WFCBAL    H                                         202239
      *                                                                                       CLE023
      ** Compute and update CEXP if CLE023 is on                                              CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
      *                                                                                       CLE023
     C                     MOVE WLMDI     ZMDI1                                               CLE023
     C                     Z-ADDWLSPT     ZRATE1                                              CLE023
     C                     MOVE WFMDI     ZMDI2                                               CLE023
     C                     Z-ADDWFSPT     ZRATE2                                              CLE023
     C                     EXSR ZXRATE                                                        CLE023
      *                                                                                       CLE023
     C           ZMDIX     IFEQ 'D'                                                           CLE023
     C           ZRATEX    DIV  POWR,WCX  WSPXRT    H                                         CLE023
     C           1         DIV  WSPXRT    WSPXRT                                              CLE023
     C                     ELSE                                                               CLE023
     C           ZRATEX    MULT POWR,WCX  WSPXRT    H                                         CLE023
     C                     ENDIF                                                              CLE023
     C                     MULT WSPXRT    WCEXP     H                                         CLE023
      *                                                                                       CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF                                          CLE005
      *
     C                     MOVE 'B'       WFRCTP
     C           WKFAC     CHAINFCLTY                08
     C           *IN08     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY'   DBFILE           ************
     C                     Z-ADD18        DBASE            * DBERR 18 *
     C                     MOVELWFKEY     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** The only concern should be if credit is revolving for all        122685
      ** loan types                                                       122685
      *                                                                   122685
     C***********PTYP      IFNE 66                                        122685
     C***********FCTI      ANDNE'C'                                       122685
     C***********RVCR      ANDNE'Y'                                       122685
     C***********PTYP      OREQ 66                                        122685
     C***********FCTI      ANDEQ'C'                                       122685
     C***********RVCR      ANDEQ'Y'                                       122685
     C***********FCTI      OREQ 'C'                                       122685
     C***********RVCR      ANDNE'Y'                                       122685
     C           RVCR      IFNE 'Y'                                       122685
     C                     MOVE *ON       *IN60
     C                     ENDIF
      *
     C           WVDAYN    IFGT BJRDNB
     C           WVDAYN    ORLE BJRDNB
     C           PTYP      ANDEQ66
     C           RCSI      ANDEQ'Y'
     C           LPFI      ANDEQ*BLANK                                    122685
     C           WVDAYN    ORLE BJRDNB                                    122685
     C           WPART     ANDEQ'N'                                       122685
     C           LPFI      ANDNE*BLANK                                    122685
     C           RCSI      ANDEQ'Y'                                       122685
      *                                                                   CLE005
     C           WVDAYN    ORLE BJRDNB                                    CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      ANDEQ69                                        CLE005
     C           RCSI      ANDEQ'Y'                                       CLE005
      *                                                                   CLE005
     C           *IN60     IFEQ *ON
     C                     UNLCKFCLTY
     C                     ENDIF                                          122685
     C                     MOVE *ON       *IN62
     C***********          ENDIF                                          122685
     C                     ENDIF
      *
      ** Do not update OAM for Prime facility of syndicated loans
      ** as well as exposure if sold with recourse                        122685
      *
     C           WPART     IFEQ 'N'
     C           LPFI      ANDNE' '
     C           CLE023    IFEQ 'N'                                                           CLE023
     C           RCSI      ANDEQ'Y'                                       122685
     C           CLE023    OREQ 'Y'                                                           CLE023
     C                     MOVE *ON       *IN60
     C                     ENDIF                                                              CLE023
     C                     ENDIF
      *                                                                                     AR806351
     C           CLE134    IFEQ 'Y'                                                         AR806351
     C           WEXPO     ANDEQ'N'                                                         AR806351
     C                     MOVE '1'       *IN60                                             AR806351
     C                     MOVE '1'       *IN62                                             AR806351
     C                     UNLCKFCLTY                                                       AR806351
     C                     ENDIF                                                            AR806351
      *
      ** Update facility exposure:
      **
      ***note:**Reverse*normal*processing*if*(a)*Prime*facility*for****   122685
      **********Syndicated*Parts*Purchased*or*(b)*Participant**********   122685
      **********faciltiy*for*Syndicated*Parts*Sold*********************   122685
      *
     C********** *IN62     IFEQ *OFF                                                          204507
      *                                                                                       199073
     C                     MOVE SAUTO     WAUTOS  1                                           CLE134
     C           WAUTOS    IFEQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     MOVE 'Y'       WAUTOS                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     MOVE AUTOA     WAUTOA  1                                           CLE134
     C           WAUTOA    IFEQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     MOVE 'Y'       WAUTOA                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     MOVE 'N'       UPEXP                                               199073
      *                                                                                       199073
     C           SACTN     IFEQ 'I'                                                           199073
     C********** SAUTO     ANDEQ'Y'                                                    199073 CLE134
     C           WAUTOS    ANDEQ'Y'                                                           CLE134
     C           SACTN     OREQ 'A'                                                           199073
     C********** SAUTO     ANDEQ'Y'                                                    199073 CLE134
     C           WAUTOS    ANDEQ'Y'                                                           CLE134
     C           AUTOA     ANDEQ'N'                                                           199073
     C           SACTN     OREQ 'A'                                                           199073
     C           SAUTO     ANDEQ'N'                                                           199073
     C********** AUTOA     ANDEQ'Y'                                                    199073 CLE134
     C           WAUTOA    ANDEQ'Y'                                                           CLE134
     C           SACTN     OREQ 'R'                                                           199073
     C********** AUTOA     ANDEQ'Y'                                                    199073 CLE134
     C           WAUTOA    ANDEQ'Y'                                                           CLE134
     C                     MOVE 'Y'       UPEXP   1                                           199073
     C                     ENDIF                                                              199073
      *                                                                                       199073
     C           *IN62     IFEQ *OFF                                                          204507
      *
     C***********WPART     IFEQ 'Y'                                       122685
     C***********LPFI      ANDEQ'P'                                       122685
     C***********PTYP      ANDEQ66                                        122685
     C***********WPART     OREQ 'N'                                       122685
     C***********LPFI      ANDEQ'I'                                       122685
     C***********PTYP      ANDEQ64                                        122685
      ***********                                                         122685
     C***********SACTN     IFEQ 'I'                                       122685
     C***********PTYP      ANDEQ64                                        122685
     C***********SACTN     OREQ 'R'                                       122685
     C***********PTYP      ANDEQ66                                        122685
      *                                                                   122685
      ** Internal parts purchased and funding participants are updated    122685
      ** just like any normal loan.  Prime facilities are updated only    122685
      ** when sold without recourse just like a parts sold                122685
      *                                                                   122685
     C           LPFI      IFNE *BLANK                                    122685
      *                                                                   122685
     C           SACTN     IFEQ 'R'                                       122685
     C           WPART     ANDEQ'Y'                                       122685
     C           SACTN     OREQ 'I'                                       122685
     C           WPART     ANDEQ'N'                                       122685
     C           LPFI      ANDNE'I'                                                           203070
      *                                                                                       203070
     C           WPART     IFEQ 'Y'                                                           CLE023
     C           CLE023    ANDEQ'Y'                                                           CLE023
     C           CLE023    OREQ 'N'                                                           CLE023
     C           CAMD      ADD  WFCBAL    CAMD
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
      ** Update Current Exposure for Lending Enhancement CLE023                               CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           CEXP      ADD  WCEXP     CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF
      *
     C***********SACTN     IFEQ 'R'                                       122685
     C***********PTYP      ANDEQ64                                        122685
     C***********SACTN     OREQ 'I'                                       122685
     C***********PTYP      ANDEQ66                                        122685
     C           SACTN     IFEQ 'I'                                       122685
     C           WPART     ANDEQ'Y'                                       122685
     C           SACTN     OREQ 'R'                                       122685
     C           WPART     ANDEQ'N'                                       122685
     C           WPART     IFEQ 'Y'                                                           CLE023
     C           CLE023    ANDEQ'Y'                                                           CLE023
     C           CLE023    OREQ 'N'                                                           CLE023
     C           CAMD      SUB  WFCBAL    CAMD
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
      ** Update Current Exposure for Lending Enhancement CLE023                               CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           CEXP      SUB  WCEXP     CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF
      *
     C                     ELSE
      *                                                                                       199073
     C           UPEXP     IFEQ 'Y'                                                           199073
      *
      ** Update of non-syndicated loans                                   122685
      *                                                                                       CLE134
     C                     MOVE SAUTO     WAUTOS  1                                           CLE134
     C           WAUTOS    IFEQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     MOVE 'Y'       WAUTOS                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     MOVE AUTOA     WAUTOA  1                                           CLE134
     C           WAUTOA    IFEQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     MOVE 'Y'       WAUTOA                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                   122685
     C           SACTN     IFEQ 'I'
     C           PTYP      ANDNE66
     C           PTYP      ANDNE69                                        CLE005
     C           SACTN     OREQ 'R'
     C           PTYP      ANDEQ66
     C           SACTN     OREQ 'R'                                       CLE005
     C           PTYP      ANDEQ69                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           SACTN     OREQ 'A'                                                           199073
     C           PTYP      ANDNE66                                                            199073
     C           PTYP      ANDNE69                                                            199073
     C********** SAUTO     ANDEQ'Y'                                                    199073 CLE134
     C           WAUTOS    ANDEQ'Y'                                                           CLE134
     C           AUTOA     ANDEQ'N'                                                           199073
      *                                                                                       CLE023
      ** Do not update CAMD of normal facility if parts sold                                  CLE023
      *                                                                                       CLE023
     C           PTYP      IFNE 66                                                            CLE023
     C           PTYP      ANDNE69                                                            CLE023
     C           PTYP      ANDNE72                                                            CLE023
     C           CLE023    ANDEQ'Y'                                                           CLE023
     C           CLE023    OREQ 'N'                                                           CLE023
     C           CAMD      SUB  WFCBAL    CAMD
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
      ** Update Current Exposure for Lending Enhancement CLE023                               CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           CEXP      SUB  WCEXP     CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF
      *
     C           SACTN     IFEQ 'R'
     C           PTYP      ANDNE66
     C           PTYP      ANDNE69                                        CLE005
     C           SACTN     OREQ 'I'
     C           PTYP      ANDEQ66
     C           SACTN     OREQ 'I'                                       CLE005
     C           PTYP      ANDEQ69                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           SACTN     OREQ 'A'                                                           199073
     C           PTYP      ANDNE66                                                            199073
     C           PTYP      ANDNE69                                                            199073
     C           SAUTO     ANDEQ'N'                                                           199073
     C********** AUTOA     ANDEQ'Y'                                                    199073 CLE134
     C           WAUTOA    ANDEQ'Y'                                                           CLE134
      *                                                                                       CLE023
      ** Do not update CAMD of normal facility if parts sold                                  CLE023
      *                                                                                       CLE023
     C           PTYP      IFNE 66                                                            CLE023
     C           PTYP      ANDNE69                                                            CLE023
     C           PTYP      ANDNE72                                                            CLE023
     C           CLE023    ANDEQ'Y'                                                           CLE023
     C           CLE023    OREQ 'N'                                                           CLE023
     C           CAMD      ADD  WFCBAL    CAMD
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
      ** Update Current Exposure for Lending Enhancement CLE023                               CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           CEXP      ADD  WCEXP     CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF
      *
     C                     ENDIF                                                              199073
      *                                                                                       199073
     C                     ENDIF
      *                                                                   CLE009
      ** If CLE009 is installed, set Work Regeneration Indicator to       CLE009
      ** changed                                                          CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     MOVE 'C'       WKSWRI  1                       CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE014
     C                     ENDIF                                          CLE014
      *
     C           *IN60     IFEQ *OFF
      *                                                                                       CLE134
     C                     MOVE SAUTO     WAUTOS  1                                           CLE134
     C           WAUTOS    IFEQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     MOVE 'Y'       WAUTOS                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     MOVE AUTOA     WAUTOA  1                                           CLE134
     C           WAUTOA    IFEQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     MOVE 'Y'       WAUTOA                                              CLE134
     C                     ENDIF                                                              CLE134
      *
      ** Update OAM for facility - Value Date
      *
     C***********          MOVE *OFF      *IN63                           122685
     C***********PTYP      IFEQ 66                                        122685
     C***********SACTN     ANDEQ'I'                                       122685
     C***********PTYP      ORNE 66                                        122685
     C***********SACTN     ANDEQ'R'                                       122685
      *                                                                   122685
     C           LPFI      IFEQ *BLANK                                    122685
     C           PTYP      ANDNE66                                        122685
     C           LPFI      OREQ *BLANK                                    CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      ANDNE69                                        CLE005
     C           LPFI      ORNE *BLANK                                    122685
     C           WPART     ANDEQ'Y'                                       122685
      *                                                                                       204507
     C           SACTN     IFEQ 'I'                                       122685
     C           SACTN     OREQ 'A'                                                           204507
     C********** SAUTO     ANDEQ'Y'                                                    204507 CLE134
     C           WAUTOS    ANDEQ'Y'                                                           CLE134
     C           AUTOA     ANDEQ'N'                                                           204507
     C                     MOVE *OFF      *IN63                           122685
      *                                                                                       204507
     C                     ELSE                                           122685
      *                                                                                       204507
     C           SACTN     IFEQ 'R'                                                           204507
     C           SACTN     OREQ 'A'                                                           204507
     C           SAUTO     ANDEQ'N'                                                           204507
     C********** AUTOA     ANDEQ'Y'                                                    204507 CLE134
     C           WAUTOA    ANDEQ'Y'                                                           CLE134
     C                     MOVE *ON       *IN63                           122685
     C                     ENDIF                                                              204507
      *                                                                                       204507
     C                     ENDIF                                          122685
      *                                                                                       204507
     C                     ELSE                                           122685
      *                                                                                       204507
     C           SACTN     IFEQ 'I'                                       122685
     C           SACTN     OREQ 'A'                                                           204507
     C********** SAUTO     ANDEQ'Y'                                                    204507 CLE134
     C           WAUTOS    ANDEQ'Y'                                                           CLE134
     C           AUTOA     ANDEQ'N'                                                           204507
     C                     MOVE *ON       *IN63
      *                                                                                       204507
     C                     ELSE                                           122685
      *                                                                                       204507
     C           SACTN     IFEQ 'R'                                                           204507
     C           SACTN     OREQ 'A'                                                           204507
     C           SAUTO     ANDEQ'N'                                                           204507
     C********** AUTOA     ANDEQ'Y'                                                    204507 CLE134
     C           WAUTOA    ANDEQ'Y'                                                           CLE134
     C                     MOVE *OFF      *IN63                           122685
     C                     ENDIF                                                              204507
      *                                                                                       204507
     C                     ENDIF                                          122685
     C                     ENDIF
      *
     C                     EXSR QFCLTY
      *                                                                                       CLE134
     C                     MOVE SAUTO     WAUTOS  1                                           CLE134
     C           WAUTOS    IFEQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     MOVE 'Y'       WAUTOS                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     MOVE AUTOA     WAUTOA  1                                           CLE134
     C           WAUTOA    IFEQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     MOVE 'Y'       WAUTOA                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     MOVE AUTOC     WAUTOC  1                                           CLE134
     C           WAUTOC    IFEQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     MOVE 'Y'       WAUTOC                                              CLE134
     C                     ENDIF                                                              CLE134
      *
      ** Update OAM for facility - Maturity date
      *
     C***********          MOVE *OFF      *IN63                           122685
     C***********PTYP      IFEQ 66                                        122685
     C***********SACTN     ANDEQ'R'                                       122685
     C***********PTYP      ORNE 66                                        122685
     C***********SACTN     ANDEQ'I'                                       122685
      *                                                                   122685
      * If loan is non-autosettled, then repayment should affect                              204708
      * availability beyond the loan's maturity date.                                         204708
     C********** AUTOC     IFEQ 'Y'                                                    204708 CLE134
     C           WAUTOC    IFEQ 'Y'                                                           CLE134
      *                                                                                       204708
     C           LPFI      IFEQ *BLANK                                    122685
     C           PTYP      ANDNE66                                        122685
     C           LPFI      OREQ *BLANK                                    CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      ANDNE69                                        CLE005
     C           LPFI      ORNE *BLANK                                    122685
     C           WPART     ANDEQ'Y'                                       122685
      *                                                                                       204507
     C           SACTN     IFEQ 'I'                                       122685
     C           SACTN     OREQ 'A'                                                           204507
     C********** SAUTO     ANDEQ'Y'                                                    204507 CLE134
     C           WAUTOS    ANDEQ'Y'                                                           CLE134
     C           AUTOA     ANDEQ'N'                                                           204507
     C                     MOVE *ON       *IN63
      *                                                                                       204507
     C                     ELSE                                           122685
      *                                                                                       204507
     C           SACTN     IFEQ 'R'                                                           204507
     C           SACTN     OREQ 'A'                                                           204507
     C********** SAUTO     ANDEQ'N'                                                    204507 CLE134
     C********** AUTOA     ANDEQ'Y'                                                    204507 CLE134
     C           WAUTOS    ANDEQ'N'                                                           CLE134
     C           WAUTOA    ANDEQ'Y'                                                           CLE134
     C                     MOVE *OFF      *IN63                           122685
     C                     ENDIF                                                              204507
      *                                                                                       204507
     C                     ENDIF                                          122685
      *                                                                                       204507
     C                     ELSE                                           122685
      *                                                                                       204507
     C           SACTN     IFEQ 'I'                                       122685
     C           SACTN     OREQ 'A'                                                           204507
     C********** SAUTO     ANDEQ'Y'                                                    204507 CLE134
     C           WAUTOS    ANDEQ'Y'                                                           CLE134
     C           AUTOA     ANDEQ'N'                                                           204507
     C                     MOVE *OFF      *IN63                           122685
      *                                                                                       204507
     C                     ELSE                                           122685
      *                                                                                       204507
     C           SACTN     IFEQ 'R'                                                           204507
     C           SACTN     OREQ 'A'                                                           204507
     C           SAUTO     ANDEQ'N'                                                           204507
     C********** AUTOA     ANDEQ'Y'                                                    204507 CLE134
     C           WAUTOA    ANDEQ'Y'                                                           CLE134
     C                     MOVE *ON       *IN63                           122685
     C                     ENDIF                                                              204507
      *                                                                                       204507
     C                     ENDIF                                          122685
     C                     ENDIF
      *
     C                     Z-ADDMDATC     DAYNO
      *
     C           DAYNO     IFGT 0
     C           SACTN     IFEQ 'I'
     C                     Z-ADDWLAMT     WRK13
     C                     ELSE
     C           REPTC     IFEQ 1
     C***********          Z-ADDTAMT      WRK13  130                      158268
     C                     Z-ADDPRAM      WRK13                           158268
     C                     ELSE
     C***********          Z-ADDPRAM      WRK13                           158268
     C                     Z-ADDTAMT      WRK13  130                      158268
     C                     ENDIF
     C                     ENDIF
     C********** WRK13     MULT WFCXRT    WFCBAL                                              202239
     C           WRK13     MULT WFCXRT    WFCBAL    H                                         202239
      *                                                                   CLE005
     C           WTRCA     IFEQ 'Y'                                       CLE005
     C           WTCCY     ANDNEFCCY                                      CLE005
     C**********           MULT WCXRT     WFCBAL                                       CLE005 202239
     C                     MULT WCXRT     WFCBAL    H                                         202239
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     EXSR QFCLTY
     C                     ENDIF
     C                     ENDIF                                                              204708
     C                     ENDIF
      *
     C***********          Z-ADDBJRDNB    LCDF                            125558
     C***********          MOVE 'A'       CHTPF                           125558
     C***********          MOVE NATN      TNLUF                           125558
      *
     C           *IN62     IFEQ *OFF                                      CLE014
     C           *IN60     OREQ *OFF                                      CLE014
     C                     UPDATFCLTYFNF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRUPTR   - Loan Amendments Trailer File Update                *
      * Called by: SRUPDT - Update files                              *
      * Calls    : GLZADD - Add an amount to the total                *
      *            GLZSUB - Subtract an amount from the total         *
      *            GLZSUM - Carry out addition for subroutines        *
      *                                                               *
      *****************************************************************
      *
     C           SRUPTR    BEGSR
      *
      ** Update Loan Amendments Trailer, No action for amendments
      *
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'R'
     C           SACTN     OREQ 'A'                                                           CLE134
     C           PIFIL2    ANDEQ'C134'                                                        CLE134
      *
     C                     MOVE '999999'  WLLOAN
     C                     MOVE '99999'   WLVDAT
     C                     MOVE '999'     WLLASN
      *
     C           WKLAM     CHAINLOAMS                89
      *
     C           *IN89     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVEL'LOAMS   'DBFILE           ************
     C                     Z-ADD10        DBASE            * DBERR 10 *
     C                     MOVEL'999999'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C           PIFIL2    IFEQ 'C134'                                                        CLE134
     C           SACTN     ANDEQ'A'                                                           CLE134
     C                     MOVE WLAMT     ZZAMT                                               CLE134
     C                     Z-ADDVRAF      ZZTOTI                                              CLE134
     C                     Z-ADDVRAL      ZZTOTD                                              CLE134
     C                     EXSR GLZADD                                                        CLE134
     C                     Z-ADDZZTOTI    VRAF                                                CLE134
     C                     Z-ADDZZTOTD    VRAL                                                CLE134
     C                     ELSE                                                               CLE134
      *
      ** Action not Reversal
      *
     C           SACTN     IFNE 'R'
     C           NORE      ADD  1         NORE
     C           NINS      ADD  1         NINS
     C           NLRA      ADD  1         NLRA
      *
     C***********REPT      IFNE 1                                         155421
     C           REPT      IFNE 1                                         157753
     C                     MOVE WLAMT     ZZAMT
     C                     Z-ADDVRIF      ZZTOTI
     C                     Z-ADDVRIL      ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    VRIF
     C                     Z-ADDZZTOTD    VRIL
     C                     Z-ADDVRRF      ZZTOTI
     C                     Z-ADDVRRL      ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    VRRF
     C                     Z-ADDZZTOTD    VRRL
     C***********          ENDIF                                          155421
     C                     ENDIF                                    155421157753
     C                     ELSE
      *
      ** Reverse action code
      *
     C***********REPT      IFNE 1                                         155421
     C                     MOVE TAMT      ZZAMT  153
      *
     C           NDEL      ADD  1         NDEL
     C           NLRA      SUB  1         NLRA
      *
     C                     Z-ADDVRDF      ZZTOTI
     C                     Z-ADDVRDL      ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    VRDF
     C                     Z-ADDZZTOTD    VRDL
     C                     Z-ADDVRRF      ZZTOTI
     C                     Z-ADDVRRL      ZZTOTD
     C                     EXSR GLZSUB
     C                     Z-ADDZZTOTI    VRRF
     C                     Z-ADDZZTOTD    VRRL
     C***********          ENDIF                                          155421
     C                     ENDIF
     C                     ENDIF                                                              CLE134
     C                     Z-ADDNATN      TNLU
      *
     C                     UPDATLOAMSZ1F
      *
     C                     ENDIF
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRUPLX   - S01465: Update Loan Transaction Index              *
      * Called by: SRUPDT - Update files                              *
      * Calls    : none                                               *
      *                                                               *
      *****************************************************************
      *
     C           SRUPLX    BEGSR
      *
      ** Update LTRIX   - S01465
      *
     C           SACTN     IFEQ 'X'
     C           SACTN     OREQ 'R'                                       155570
     C           BPREAU    ANDEQ'Y'                                       155570
     C           XUSR      ANDNE*BLANKS                                   155570
     C           PMODE     OREQ 'B'                                       155570
     C           BPREAU    OREQ 'N'                                       155570
      *
      ** Get Telex notice days form currencies file.  Use loan ccy
      ** if start settlement type is 01,07 OR 08 otherwise use local
      ** ccy.
      *
     C                     MOVE BJLCCY    @CCY    3
     C                     MOVE BJSLCD    ZLOC2
      *                                                                                       CLE034
      ** Initialise Work Process Field, then add enhancement for CLE034.                      CLE034
      *                                                                                       CLE034
     C                     MOVE *BLANK    WPROC   1                                           CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
     C           PSNOS     ANDEQ'Y'                                                           CLE034
     C                     MOVEL'Y'       WPROC                                               CLE034
     C                     MOVE LCCYC     @CCY                                                CLE034
     C                     MOVE *BLANKS   ZLOC2                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** If CLE034 is on and SSTAL is 'N' or if CLE034 is off.                                CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'N'                                                           CLE034
     C           CLE034    OREQ 'N'                                                           CLE034
      *
     C           SDST      IFEQ 01
     C           SDST      OREQ 07
     C           SDST      OREQ 08
      *
     C                     MOVE LCCYC     @CCY
      *
      ** Get the nostro location of the nostro no.
      *
     C                     MOVELOSDA      STNOS   2
     C           STNOS     IFEQ *BLANKS
     C           STNOS     OREQ '00'
     C                     MOVE *BLANKS   ZLOC2
     C                     ELSE
     C                     MOVE STNOS     W@NSTR  2
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           SCCYC     ANDNE*BLANKS                                   CEU004
     C                     MOVE SCCYC     W@CCY   3                       CEU004
     C                     ELSE                                           CEU004
     C                     MOVE LCCYC     W@CCY   3
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C           CLE031    IFEQ 'N'                                       CLE031
      *                                                                   CLE031
     C           CEU004    IFEQ 'Y'                                       CLE031
     C           SCCYC     ANDNE*BLANKS                                   CLE031
     C                     MOVE SCCYC     W@CCY                           CLE031
     C                     ELSE                                           CLE031
     C                     MOVE LCCYC     W@CCY                           CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     ELSE                                           CLE031
      *                                                                   CLE031
     C                     MOVE LCCYC     W@CCY                           CLE031
     C           PTYP      IFNE 66                                        CLE031
     C           PTYP      ANDNE67                                        CLE031
     C           PTYP      ANDNE69                                        CLE031
     C           PTYP      ANDNE72                                        CLE031
     C                     MOVE SCCYC     W@CCY                           CLE031
     C                     ELSE                                           CLE031
     C                     MOVE PSCYC     W@CCY                           CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     EXSR SRGNST
     C           @RTCD     IFEQ *BLANKS
     C           BGUDRS    IFEQ 'Y'
     C                     MOVE A7NOSN    ZLOC2
     C                     ELSE
     C                     MOVE *BLANKS   ZLOC2
     C                     END
     C                     END
     C                     END
     C                     END
      *
      ** Get the telex notice days
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM @CCY      K101    3
     C           SDCURR    PARM SDCURR    DSSDY
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD11        DBASE            * DBERR 11 *
     C                     MOVEL@CCY      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Derive test date
      *
     C                     MOVE BJLCCY    ZCCY1
     C                     MOVE BJSLCD    ZLOC1
     C                     MOVE @CCY      ZCCY2
     C                     Z-ADDA6TXND    ZNRDYS
     C                     Z-ADDBJRDNB    ZDAYNO
     C                     EXSR ZF2C
      *
     C***********OMDT      IFNE *ZERO                                     128094
     C***********OMDT      ANDGEBJRDNB                                    128094
     C***********WVDAYN    ANDEQOMDT                                      128094
     C***********WVDAYN    ANDLEZDYNBR                                    128094
     C           WVDAYN    IFLE ZDYNBR                                    128094
      *                                                                   186431
     C**********           MOVE '1'       *IN17                           186431     186431 AR322732
     C**********           MOVE '0'       *IN89                           186431     186431 AR322732
      *                                                                   186431
     C********** *IN17     DOUEQ'0'                                                  186431 AR322732
     C********** RECI      ANDEQ*BLANK                                               186431 AR322732
     C********** *IN89     OREQ '1'                                                  186431 AR322732
      *
      ** Access LTRIX header for next available RRN
      *
     C********** 1         CHAINLTRIX               N89                                     AR322732
      *
     C********** *IN89     IFEQ *OFF                                                        AR322732
      *
     C********** RECI      IFEQ 'H'                                                         AR322732
     C********** RRNA      ANDGTFLSZ                                                        AR322732
     C**********           EXSR *PSSR                                                       AR322732
     C**********           ENDIF                                                            AR322732
      *
     C**********           ELSE                                                             AR322732
     C********** *LOCK     IN   LDA                                                         AR322732
     C**********           MOVEL'LTRIX   'DBFILE           ************                     AR322732
     C**********           Z-ADD12        DBASE            * DBERR 12 *                     AR322732
     C**********           MOVEL1         DBKEY            ************                     AR322732
     C**********           OUT  LDA                                                         AR322732
     C**********           EXSR *PSSR                                                       AR322732
     C**********           ENDIF                                                            AR322732
      *
     C**********           Z-ADDRRNA      LXRRN   50                                        AR322732
      *
     C********** LXRRN     CHAINLTRIX                89                   186431
     C********** LXRRN     CHAINLTRIX                8917                            186431 AR322732
      *                                                                   186431
     C********** *IN17     IFEQ '1'                                                  186431 AR322732
     C********** TXSTS     IFEQ 1218                                                 186431 AR322732
     C**********           UNLCKLTRIX                                                186431 AR322732
     C**********           EXSR SRCLRS                                               186431 AR322732
     C**********           ELSE                                                      186431 AR322732
     C**********           MOVE '1'       *IN89                                      186431 AR322732
     C**********           ENDIF                                                     186431 AR322732
     C**********           ENDIF                                                     186431 AR322732
      *                                                                   186431
     C**********           ENDDO                                                     186431 AR322732
      *                                                                   186431
     C********** *IN89     IFEQ *ON                                                         AR322732
     C********** *LOCK     IN   LDA                                                         AR322732
     C**********           MOVEL'LTRIX   'DBFILE           ************                     AR322732
     C**********           Z-ADD13        DBASE            * DBERR 13 *                     AR322732
     C**********           MOVELLXRRN     DBKEY            ************                     AR322732
     C**********           OUT  LDA                                                         AR322732
     C**********           EXSR *PSSR                                                       AR322732
     C**********           ELSE                                                             AR322732
      *                                                                   157536
     C**********           Z-ADD1         PRI1                                       157536 AR322732
     C                     Z-ADD1         PRI1    10                                        AR322732
     C                     Z-ADD0         RRNA    50                                        AR322732
      *                                                                   157536
      ** Backvalued repayments and non auto-settled repayments should     157536
      ** not be shown on Pay/rec reporting                                157536
      *                                                                   157536
     C           WVDAYN    IFLT BJRDNB                                    157536
     C           AUTO      OREQ 'N'                                       157536
     C                     Z-ADD0         PRI1                            157536
     C                     ENDIF                                          157536
      *
     C                     EXCPTLTRIXD
      *
      ** Get header record
      *
     C********** 1         CHAINLTRIX                89                                     AR322732
      *
     C********** *IN89     IFEQ *ON                                                         AR322732
     C********** *LOCK     IN   LDA                                                         AR322732
     C**********           MOVEL'LTRIX   'DBFILE           ************                     AR322732
     C**********           Z-ADD14        DBASE            * DBERR 14 *                     AR322732
     C**********           MOVELLXRRN     DBKEY            ************                     AR322732
     C**********           OUT  LDA                                                         AR322732
     C**********           EXSR *PSSR                                                       AR322732
     C**********           ENDIF                                                            AR322732
      *
      ** Update relevant control fields
      *
     C********** NORE      ADD  1         NORE                                              AR322732
     C********** RRNA      ADD  1         RRNA                                              AR322732
     C********** NLAR      ADD  1         NLAR                                              AR322732
      *
     C**********           EXCPTLTRIXH                                                      AR322732
      *
     C**********           ENDIF                                                            AR322732
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRUSHD  -  Update Shadow Record                               *
      * Called by: SRUPDT - Update files                              *
      * Calls    : AOOULAU0                                           *
      *                                                               *
      *****************************************************************
      *
     C           SRUSHD    BEGSR
      *
      ** Do On-line updates
      *                                                                   122960
     C           SACTN     IFEQ 'I'                                                           201672
     C           SACTN     OREQ 'A'                                                           201672
     C           *IN10     ANDEQ'1'                                                           205964
     C           SACTN     OREQ 'R'                                                           201672
     C           PMODE     IFEQ 'B'                                       122960
     C                     MOVE '*LEBTCH' ##RTCD                          122960
     C                     ELSE                                           122960
     C                     MOVE *BLANKS   ##RTCD                          122960
     C                     ENDIF                                          122960
      *
     C                     CALL 'AOOULAU0'
     C                     PARM           ##RTCD  7
     C                     PARM           Z#BSTS
     C                     PARM           Z#ASTS
     C                     PARM           Z#WSTS
     C                     PARM *BLANKS   PDCLI   1                                         MD023787
      *
     C           ##RTCD    IFEQ '*ERROR*'
     C                     MOVE *ON       *INU8
     C                     MOVE *ON       *INU7
     C                     EXSR *PSSR
     C                     ENDIF
      *                                                                                       201672
     C           PRAM      IFNE 0                                                             201672
     C           TAMT      ORNE 0                                                             205504
     C                     MOVELLNRF      OLNRF                                               201672
     C                     MOVELVDAT      OVDAT                                               201672
     C                     MOVELWLLASN    OLASN                                               201672
     C                     MOVELPRAM      OMPRAM                                              201672
     C                     CALL 'LE2041  '                                                    201672
     C**********           PARM           OLNRF   60                                   201672 CLE148
     C                     PARM           OLNRF   6                                           CLE148
     C                     PARM           OVDAT   50                                          201672
     C                     PARM           OLASN   30                                          201672
     C                     PARM           OMPRAM 130                                          201672
     C                     PARM           AMTP                                                201672
     C                     PARM           SACTN                                               201672
     C                     PARM *BLANKS   ##RTCD                                            AR868380
     C                     ENDIF                                                              201672
     C                     ENDIF                                                              201672
     C/COPY WNCPYSRC,LE2120C020
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRLOAD  -  Load subfile page                                  *
      * Called by: SRREVW - Build subfile from Review fields          *
      *            SRSUBF - Process subfile                           *
      * Calls    : SRFRMT - Format subfile screen fields              *
      *                                                               *
      *****************************************************************
      *
     C           SRLOAD    BEGSR
      *
     C                     Z-ADD0         SCOUNT  20
      *
     C           *IN04     DOWEQ*OFF
     C           SCOUNT    ANDLT10
      *
     C           FAMTP     IFEQ 'RE'
      *
      ** Save original branch from loan record
      *
     C                     MOVE FLNRF     WCLOAN
     C                     MOVE 'A'       WCRCDT
     C           WKLON     CHAINCLOAN               N02
     C           *IN02     IFEQ *OFF
      *
      ** Check user authorization to loans's branch before writing to
      ** subfile
      *
     C                     MOVE FBRCA     BRCA
     C                     Z-ADD*ZERO     @ERR
     C           BGMBIN    IFEQ 'Y'
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBBBU'
     C                     PARM FBRCA     @ZBR
     C                     PARM           @USER
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVBBU'
     C                     PARM FBRCA     @ZBR
     C                     PARM           @ERR
     C                     ENDIF
     C                     ENDIF
      *                                                                   CLE005
      ** Include repayment schedules for processing types 68 and 69       CLE005
      ** only if CLE005 is installed                                      CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'N'                                       CLE005
     C           @ERR      ANDEQ*ZERO                                     CLE005
     C           PTYPC     IFEQ 68                                        CLE005
     C           PTYPC     OREQ 69                                        CLE005
     C                     Z-ADD1         @ERR                            CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *
     C           @ERR      IFEQ *ZERO
     C                     MOVE ' '       SACTN
     C                     ADD  1         SRRN
     C                     Z-ADDSRRN      SSREC
     C                     ADD  1         SCOUNT
      *
      ** Format subfile fields
      *
     C                     EXSR SRFRMT
     C                     WRITELE2120S0
      *
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C           *IN21     IFEQ *OFF
     C                     READ LELOAMD0                 04
     C                     ELSE
     C                     READ LELOAMD1                 04
     C                     ENDIF
      *
     C                     ENDDO
      *
      ** If end of file, disable Rollup key
      *
     C           *IN04     IFEQ *ON
     C                     MOVE *OFF      *IN80
      *
      ** File empty
      *
     C           SRRN      IFEQ 0
     C                     MOVE *ON       *IN86
     C                     ENDIF
      *
      ** One-page subfile, remove 'Page Keys'
      *
     C           SRRN      IFLE 10
     C                     MOVE *OFF      *IN29
     C                     ENDIF
      *
     C                     ELSE
      *
      ** Read next record (this is for enabling/disabling Rollup key)
      ** Still check if user is authorised to thte loan's branch
      *
     C           *IN04     DOWEQ*OFF
      *
     C           FAMTP     IFEQ 'RE'
     C                     Z-ADD*ZERO     @ERR
     C           BGMBIN    IFEQ 'Y'
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBBBU'
     C                     PARM FBRCA     @ZBR
     C                     PARM           @USER
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVBBU'
     C                     PARM FBRCA     @ZBR
     C                     PARM           @ERR
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** Still check if CLE005 is installed, before including loan        CLE005
      ** processing types 68 and 69                                       CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'N'                                       CLE005
     C           @ERR      ANDEQ*ZERO                                     CLE005
     C                     MOVE FLNRF     WCLOAN                          CLE005
     C                     MOVE 'A'       WCRCDT                          CLE005
     C           WKLON     CHAINCLOAN               N02                   CLE005
     C           PTYPC     IFEQ 68                                        CLE005
     C           PTYPC     OREQ 69                                        CLE005
     C                     Z-ADD1         @ERR                            CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C           FAMTP     IFEQ 'RE'
     C           @ERR      ANDEQ*ZERO
     C                     LEAVE
     C                     ENDIF
      *
     C           *IN21     IFEQ *OFF
     C                     READ LELOAMD0                 04
     C                     ELSE
     C                     READ LELOAMD1                 04
     C                     ENDIF
      *
     C                     ENDDO
      *
      ** Disable Rollup if end of file
      *
     C           *IN04     IFEQ *ON
     C                     MOVE *OFF      *IN80
      *
     C           SRRN      IFLE 10
     C                     MOVE *OFF      *IN29
     C                     ENDIF
     C                     ENDIF
      * Save RRN
     C                     Z-ADDSRRN      WRRNSV  40
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRCLRS  -  Clears the subfile message queue                   *
      * Called by: SRINPU - Process input screen for Interactive/Rec  *
      *            SRSUBF - Subfile processing                        *
      *            SRINZD - Initialise detail screen                  *
      *            SRDETL - Process detail screen                     *
      *            *INZSR - Initial processing                        *
      * Calls    : Y2CLMSC                                            *
      *                                                               *
      *****************************************************************
      *
     C           SRCLRS    BEGSR
      *
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
     C                     MOVE *BLANK    WERRF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRREVW   - Build subfile from Review fields                   *
      * Called by: SRSUBF - Process subfile                           *
      * Calls    : SRINIS - Initialise subfile                        *
      *            SRLOAD - Load subfile page                         *
      *                                                               *
      *****************************************************************
      *
     C           SRREVW    BEGSR
      *
      ** Initialise subfile
      *
     C                     EXSR SRINIS
      *
      ** Build key from Review From fields
      ** Review from Loan Number
      *
     C           SLONR     IFEQ *BLANKS
     C                     MOVE *LOVAL    WLLOAN
     C                     ELSE
     C                     MOVE SLONR     WLLOAN
     C                     ENDIF
      *
      ** Review from Value Date
      *
     C           SDATR     IFEQ *BLANKS
     C                     MOVE *LOVAL    WLVDAT
     C                     ELSE
     C                     MOVE SDATR     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    WLVDAT
     C                     ENDIF
      *
      ** Review from Sequence Number
      *
     C           SSEQR     IFEQ *BLANKS
     C                     MOVE *LOVAL    WLLASN
     C                     ELSE
     C                     MOVE SSEQR     WLLASN
     C                     ENDIF
      *
      ** Select Unauthorised records only or not
      *
     C           SAUTR     COMP 'Y'                      21
      *
      ** Access the corresponding file
      *
     C           *IN21     IFEQ *OFF
     C           WKLAM     SETLLLELOAML0
     C                     READ LELOAML0                 04
     C                     ELSE
     C           WKLAM     SETLLLELOAML1
     C                     READ LELOAML1                 04
     C                     ENDIF
      *
      ** Save Review From fields
      *
     C                     MOVE SLONR     WSLONR  6
     C                     MOVE SDATR     WSDATR  6
     C                     MOVE SSEQR     WSSEQR  3
     C                     MOVE SAUTR     WSAUTR  1
      *
      ** Load Subfile
      *
     C                     EXSR SRLOAD
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRNSEQ  -  Get next amendment sequence number                 *
      * Called by: SRUPDT - Update files                              *
      * Calls    : none                                               *
      *                                                               *
      *****************************************************************
      *
     C           SRNSEQ    BEGSR
      *
      ** Find next available sequence no. for Insert
      *
     C                     Z-ADD0         WLASNX  30
     C                     MOVE SLOAN     WLLOAN
     C                     Z-ADDWVDAYN    WLVDAT
     C                     Z-ADD0         WLLASN
     C           WKLAM     SETLLLOAMD
      *
     C                     READ LOAMD                    07
      *
     C           *IN07     DOWEQ*OFF
     C           WLLOAN    IFNE LNRFA
     C           WLVDAT    ORNE VDATA
     C                     LEAVE
     C                     ENDIF
     C                     Z-ADDLASNA     WLASNX
     C                     READ LOAMD                    07
     C                     ENDDO
      *
     C                     ADD  1         WLASNX
     C                     Z-ADDWLASNX    WLLASN
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRGNST   - Get nostro details                                 *
      * Called by: SRUPLX - Update Loan Amendment trailer             *
      * Calls    : AONOSTR0                                           *
      *                                                               *
      *****************************************************************
      *
     C           SRGNST    BEGSR
      *
     C                     MOVE *BLANKS   W@STLC  3
      *
      ** Access Nostro details to get nostro location code
      *
     C                     CALL 'AONOSTR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @KEYA   6
     C                     PARM W@CCY     @KEYB   3
     C**********           PARM *BLANKS   @KEYC   4                                           CAS011
     C                     PARM *BLANKS   @KEYC  10                                           CAS011
     C                     PARM *BLANKS   @KEYD   2
     C                     PARM W@NSTR    @KEYE   2
     C                     PARM *BLANKS   @KEYF   3
     C                     PARM *BLANKS   @KEYG  10
     C                     PARM *BLANKS   @KEYH   1
     C           SDNOST    PARM SDNOST    DSFDY
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRCURR   - Access currency details                            *
      * Called by: SRFMTA - Format amount for display                 *
      *            FCLTSR - Update Facility file                      *
      * Calls    : AOCURRR0                                           *
      *                                                               *
      *****************************************************************
      *
     C           SRCURR    BEGSR
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*BLANK  'PRTCD
     C                     PARM '*KEY    'POPTN
     C                     PARM WCURR     PCURR   3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD20        DBASE            * DBERR 20 *
     C                     MOVELWCURR     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SREROR  -  Error processing                                   *
      * Called by: SRVAL1 - Validate initial screen                   *
      *            SRVAL2 - Validate detail screen                    *
      *            SRVVAL - Validate value date                       *
      *            SRCAUT - Validate user authority on branch/action  *
      *            SRVALR - Validate Review fields                    *
      *            SRVALS - Validate subfile tags                     *
      *            SRAVAL - Additional validation                     *
      *            SRUPDT - Update files                              *
      * Calls    : none                                               *
      *                                                               *
      *****************************************************************
      *
     C           SREROR    BEGSR
      *
     C           ZAMSGF    IFNE 'DRSMM   '                                123801
     C                     MOVEL'LERMSGF 'ZAMSGF
     C                     ENDIF                                          123801
      *
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      *
      ** On Interactive/Record Mode, send message to program msgq
      *
     C           PMODE     IFNE 'B'
     C           PMODE     ANDNE'P'
     C                     EXSR ZASNMS
     C                     ELSE
      *
      ** For Batch and Play mode, return message
      *
     C                     CALL 'Y2RVMGC'
     C                     PARM           PRTCD
     C                     PARM           ZAMSID           Message Id.
     C                     PARM           ZAMSGF           Message file.
     C                     PARM           ZAMSDA           Message data.
     C                     PARM           ZAMSTX132        Messge text
      *
     C           PMODE     IFNE 'B'                                       120002
     C                     ROLBK
     C                     ENDIF                                          120002
      *                                                                   120468
      *  Include DUMP here for problems during batch and play modes.      120468
      *                                                                   120468
     C           WMSEV     IFEQ 'E'                                       120468
     C                     DUMP                                           120468
     C                     ENDIF                                          120468
      *
      ** Play Mode
      *
     C           PMODE     IFEQ 'P'
      *
      ** Restore the saved record to ensure that no other fields
      ** will be updated aside from error msg id, text and severity
      *
     C                     MOVE L2120S    L2120F
     C                     MOVE WMSEV     MSVR
     C                     MOVELZAMSID    MSID
     C                     MOVELZAMSTX    MSTX
     C                     UPDATLE2120D0
      *
     C           WMSEV     IFEQ 'E'
     C                     CLOSELE2120PD
     C                     ENDIF
      *
     C                     ELSE
      *
      ** Batch Mode
      *
     C                     CLEARPOUTP
     C                     MOVE PIMTYP    POMTYP
     C                     MOVE WTUSR     POTUSR
     C                     MOVE WTWST     POTWST
     C                     MOVE WTREF     POTREF
     C                     MOVE WTSEQ     POTSEQ
     C                     MOVE SACTN     POTACT
     C                     MOVE WTDST     POTDST
     C                     MOVE WTTST     POTTST
     C                     MOVE PINPAR    PONPAR
     C                     MOVE SLOAN     POLOAN
     C                     MOVE PIVDAT    POVDAT
     C           SACTN     IFEQ 'I'
     C                     MOVE WLASNX    PORESQ
     C                     ELSE
     C                     MOVE SSEQN     PORESQ
     C                     ENDIF
     C                     MOVELWMSEV     POMSVR
     C                     MOVELZAMSID    POMSID
     C                     MOVELZAMSTX    POMSTX
     C                     ENDIF
      *
      ** If not a warning error, stop validation and return
      *
     C           WMSEV     IFEQ 'E'
     C                     MOVE *ON       *INLR
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDSR
      /EJECT
      *****************************************************************
      * GLZADD   - Add an amount to the total                         *
      * Called by: SRUPTR - Update Loan Amendment Trailer             *
      * Calls    : GLZSUM - Carry out an addition for subroutines     *
      *                                                               *
      *****************************************************************
      *
     C           GLZADD    BEGSR                                       ***
      *
     C***********ZZAMT     IFGT 0                                         119989
     C           ZZAMT     IFNE 0                                         119989
      *
      ** Split ZZAMT into integer and decimal fields
      *
     C                     Z-ADDZZAMT     ZZAMTI 150       Integer
     C                     MOVE ZZAMT     ZZAMTD  30       Decimal
      *
      ** Both ZZAMTI and ZZAMTD contain a 'sign' zone now
      *
     C                     EXSR GLZSUM
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * GLZSUB   - Subroutine to subtract an amount to the total      *
      * Called by: SRUPTR - Update Loan Amendment Trailer             *
      * Calls    : GLZADD - Add an amount to the total                *
      *                                                               *
      *****************************************************************
      *
     C           GLZSUB    BEGSR
      *
      ** Processing - Just reverse the 'sign' and add
      *
     C                     Z-SUBZZAMT     ZZAMT  153       Reverse 'sign'
     C                     EXSR GLZADD                       and 'add'
     C                     Z-SUBZZAMT     ZZAMT            Restore 'sign'
     C                     ENDSR
      /EJECT
      *****************************************************************
      * GLZSUM   - Carry out the additon for subroutine               *
      * Called by: GLZADD - Add an amount to the total                *
      * Calls    : None                                               *
      *                                                               *
      *****************************************************************
      *
     C           GLZSUM    BEGSR
      *
     C                     Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
     C                     Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
     C                     SETOF                     919293
     C                     SETOF                     949599
      *
      ** Determine sign of ZZAMTI & D,  92 if neg
      *
     C           ZZAMTI    COMP 0                      9293
     C   93      ZZAMTD    COMP 0                      9293
     C   93                GOTO ZZSEND                     ZERO BYPASS
      *
      ** Determine sign of ZZTOTI & D, 91 if neg
      *
     C           ZZTOTI    COMP 0                      9193
     C   93      ZZTOTD    COMP 0                      9193
      *
      ** If ZZTOTAL is zero, return ZZAMOUNT
      *
     C   93                Z-ADDZZAMTI    ZZTOTI
     C   93                Z-ADDZZAMTD    ZZTOTD
     C   93                GOTO ZZSEND                     ZERO BYPASS
      *
      ** If signs differ, bypass overflow checks
      *
     C   91N92
     CORN91 92             GOTO ZZOFPS
      *
     C           ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     C           ZZWK2     COMP 999                  93    '93' = CARRY
     C  N93      ZZWK2     COMP -999                   93    INTO INTEGER.
      *
     C   93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
     C      93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
     C   93      ZZTOTI    ADD  ZZWK3     ZZWK3
     C  N93      ZZTOTI    ADD  ZZAMTI    ZZWK3
      *
      ** If the modulus of ZZWK3 is lt mod. ZZTOTI then O/F has occured
      *
     C  N92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     C   92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     C  N99                Z-ADDZZWK2     ZZTOTD
     C  N99                Z-ADDZZWK3     ZZTOTI
      *
      ** If O/F zeroise ZZAMT, Ind '99' set and ZZTOT fields left intact
      *
     C   99                Z-ADD0         ZZAMT  153
     C                     GOTO ZZSEND
      *
      ** The 'signs' are different
      *
     C           ZZOFPS    TAG                             ***  ZZOFPS ***
      *
      * If ZZAMT was negative, make it pos. to como with ZZTOT
      *
     C   92                Z-SUBZZAMTI    ZZAMTI 150
     C   92                Z-SUBZZAMTD    ZZAMTD  30
      *
      ** If ZZTOT was negative, make it pos. to comp with ZZAMT.
      *
     C   91                Z-SUBZZTOTI    ZZTOTI
     C   91                Z-SUBZZTOTD    ZZTOTD
      *
      ** Both ZZAMT and ZZTOT are now positive
      *
     C           ZZTOTI    COMP ZZAMTI               93  95
     C   95      ZZTOTD    COMP ZZAMTD               93  95
      *
      ** If ZZTOT eq. ZZAMT return ZERO.
      *
     C   95                Z-ADD0         ZZTOTI
     C   95                Z-ADD0         ZZTOTD
     C   95                GOTO ZZSEND
      *
      ** If ZZTOT gt. ZZAMT.
      *
     C   93      ZZAMTD    COMP ZZTOTD               94
     C   93 94   ZZTOTI    SUB  1         ZZTOTI
     C   93 94   ZZTOTD    ADD  1000      ZZWK2
     C   93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     C   93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     C   93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
      *
      ** If ZZAMT gt. ZZTOT.
      *
     C  N93      ZZTOTD    COMP ZZAMTD               94
     C  N93 94   ZZAMTI    SUB  1         ZZWK3  150
     C  N93 94   ZZAMTD    ADD  1000      ZZWK2
     C  N93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     C  N93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     C  N93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     C  N93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
      *
      ** Reverse sign of ZZTOT if larger I/P fields were negative
      *
     C                     SETOF                     94
     C   93 91
     CORN93 92             SETON                     94
     C   94                Z-SUBZZTOTI    ZZTOTI
     C   94                Z-SUBZZTOTD    ZZTOTD
      *
      ** Restore sign of ZZAMTI & ZZAMTD if it was reversed
      *
     C   92                Z-SUBZZAMTI    ZZAMTI
     C   92                Z-SUBZZAMTD    ZZAMTD
     C           ZZSEND    TAG
      *
      **   If ZZTOTD is zero, and ZZTOTI is neg. set up ZZNEGD.
      *
     C                     SETOF                     96
     C           ZZTOTD    COMP 0                        91
     C   91      ZZTOTI    COMP 0                      96
     C   96                MOVE '.000-'   ZZNEGD  5
     C                     ENDSR
      /EJECT
      ********************************************************************
      * QFCLTY   - Update exposure array                              *
      * Called by: FCLTSR - Update Facility file                      *
      * Calls    : SRCURR - Access currency details                   *
      *            QFCLTY - Update exposure value for facility        *
      *                                                               *
      ********************************************************************
      *
     C           QFCLTY    BEGSR
      *
      ***Do*not*update*for*parts*sold*with*recourse*******************                        CLE023
      ***for*a*non-syndicated*loan.**Same*thing*with*prime*facilities*                 122685 CLE023
      ***when*sold*with*recourse**************************************                 122685 CLE023
      ** Do not update for parts sold with or without recourse                                CLE023
      ** for a non-syndicated loan.  Prime facilities should not be                           CLE023
      ** updated for internal participation purchased and parts sold                          CLE023
      *
     C                     MOVE 'Y'       WCOMAV  1                                           CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           CLE023    OREQ 'N'                                                           CLE023
     C           RCSI      ANDEQ'Y'                                                           CLE023
     C                     MOVE 'N'       WCOMAV                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C           PTYP      IFEQ 66
     C********** RCSI      ANDEQ'Y'                                                           CLE023
     C           WCOMAV    ANDEQ'N'                                                           CLE023
     C           LPFI      ANDEQ*BLANK                                    122685
     C           CLE005    OREQ 'Y'                                       CLE005
     C           PTYP      ANDEQ69                                        CLE005
     C********** RCSI      ANDEQ'Y'                                                    CLE005 CLE023
     C           WCOMAV    ANDEQ'N'                                                           CLE023
     C           LPFI      ANDEQ*BLANK                                    CLE005
     C********** RCSI      OREQ 'Y'                                                    122685 CLE023
     C           WCOMAV    OREQ 'N'                                                           CLE023
     C           LPFI      ANDNE*BLANK                                    122685
     C           WPART     ANDEQ'N'                                       122685
     C                     ELSE
      *
      ** LOOPZ is not to be executed if the customer is a branch
      ** internal customer number.
      *
      * Use CNUM as SCUST may be a customer shortname                     128148
      *                                                                   128148
     C***********          MOVELSCUST     WCNUMN  60                      128418
     C**********           MOVELCNUM      WCNUMN  60                                   128148 CSD027
     C                     MOVELCNUM      WCNUMN  6                                           CSD027
      *
     C                     Z-ADD1         I
     C           WCNUMN    LOKUP@BIC,I                   88
      *
      ** Indicator 88 will be on if the customer was an internal cust.
      ** Update OAM array even if customer is an internal customer as                         203469
      ** long as the loan being processed is an IPP. (for Participant                         203469
      ** facility only)                                                                       203469
      *
     C           *IN88     IFEQ *OFF
     C           *IN88     OREQ *ON                                                           203469
     C           LPFI      ANDEQ'I'                                                           203469
      *
     C           UPEXP     IFEQ 'Y'                                                           204507
      *                                                                                       204507
     C                     Z-ADD1         Z       20
     C           Z         DOWLT11
      *
     C           DAYNO     LOKUPRUNS,Z               61  61
     C           *IN61     IFEQ *OFF
     C                     LEAVE
     C                     ELSE
     C  N63      OAM,Z     SUB  WFCBAL    OAM,Z
     C   63      OAM,Z     ADD  WFCBAL    OAM,Z
     C           Z         ADD  1         Z
     C                     ENDIF
     C                     ENDDO                                                              204507
     C                     ENDIF                                                              204507
      *                                                                   CLE009
      ** If CLE009 is installed, set Work Regeneration Indicator to       CLE009
      ** changed                                                          CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     MOVE 'C'       WKSWRI  1                       CLE009
     C                     ENDIF                                          CLE009
      *
     C**********           ENDDO                                                              204507
      *
     C                     ELSE
      *
     C                     SETOF                     88
     C                     ENDIF
     C                     ENDIF
     C                     ENDSR
      /EJECT
      *****************************************************************
      * ZASNMS  - Sends messages to the program's message queue       *
      * Called by: SREROR - Error processing                          *
      * Calls    : none                                               *
      *                                                               *
      *****************************************************************
      *
     C           ZASNMS    BEGSR
      *
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message Id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C                     PARM           ZAMSTP  7        Message type.
      *
     C                     MOVE 'Y'       WERRF   1
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRINIS  -  Initialise subfile and subfile fields              *
      * Called by: SRREVW - Build subfile from Review fields          *
      * Calls    : none                                               *
      *                                                               *
      *****************************************************************
      *
     C           SRINIS    BEGSR
      *
      ** Clear subfile
      *
     C                     MOVE *ON       *IN86
     C                     MOVE *OFF      *IN82
     C                     MOVE *ON       *IN84
     C                     WRITELE2120C0
     C                     MOVE *OFF      *IN84
      *
     C                     Z-ADD0         SRRN    40
     C                     Z-ADD0         SSREC   40
      *
      ** Set up subfile indicators
      *
     C                     MOVE *ON       *IN82
     C                     MOVE *ON       *IN80
     C                     MOVE *ON       *IN29
     C                     MOVE *OFF      *IN86
     C                     MOVE *OFF      *IN26
      *
      ** Default Unauthorised only field
      *
     C           SAUTR     IFNE 'Y'
     C                     MOVE 'N'       SAUTR
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRFMTA  -  Format amount for screen output                    *
      * Called by: SRCURR - Process subfile                           *
      * Calls    : SRINIS - Initialise subfile                        *
      *            SRLOAD - Load subfile page                         *
      *                                                               *
      *****************************************************************
      *
     C           SRFMTA    BEGSR
      *
      ** Get currency decimal places
      *
     C                     MOVE WCCY      WCURR   3
     C                     EXSR SRCURR
     C                     Z-ADDA6NBDP    ZDECS
      *
     C                     Z-ADDWPRAM     ZFLD15
     C                     EXSR ZFRPED
     C                     MOVELZOUT22    WFLD20 20
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRFRMT  -  Format subfile screen fields                       *
      * Called by: SRLOAD - Load subfile page                         *
      * Calls    : SRFMTA - Format amount field for screen output     *
      *            SRSTAT - Format RE status for display              *
      *                                                               *
      *****************************************************************
      *
     C           SRFRMT    BEGSR
      *
      ** Loan number
      *
     C                     MOVE FLNRF     SLOAN
      *
      ** Amount
      *
     C**********           MOVE FCCY      WCCY    3                       187559
     C                     MOVE RECCY     WCCY    3                       187559
     C           REPTC     IFNE 3                                         194454
     C                     Z-ADDFPRAM     WPRAM  130
     C                     ELSE                                           194454
     C                     Z-ADDFTAMT     WPRAM                           194454
     C                     ENDIF                                          194454
     C                     MOVE *BLANK    ZECODE
     C                     EXSR SRFMTA
     C                     MOVE WFLD20    SAMTO
      *
      ** Value Date
      *
     C                     Z-ADDFVDAT     SVDTH
     C                     Z-ADDFVDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SVDAT
     C                     MOVE ZADATE    SVALD
      *
      ** Sequence number, currency, customer number
      *
     C                     MOVE FLASN     SSEQN
     C**********           MOVE FCCY      SCURR                           187559
     C                     MOVE RECCY     SCURR                           187559
     C                     MOVE FCNUM     SCNUM
      *If the loan is a Participation Purchased, & System Value                               207629
      * LoanCustOriginPurch = 'O', use Original Borrower:                                     207629
     C           PPCUST    IFEQ 'O'                                                           207629
     C           PTYPC     IFEQ 64                                                            207629
     C           PTYPC     OREQ 65                                                            207629
     C           PTYPC     OREQ 68                                                            207629
     C           PTYPC     OREQ 71                                                            207629
     C                     MOVELOLNO      SCNUM                                               207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
      *                                                                   126274
      ** Access the Customer Details file for Shortname                   126274
      *                                                                   126274
     C                     CALL 'AOCUSTR0'                                126274
     C                     PARM '       ' PRTCD                           126274
     C                     PARM '*KEY   ' POPTN                           126274
     C                     PARM SCNUM     PCUST                           126274
     C                     PARM           PKYST                           126274
     C           SDCUST    PARM SDCUST    DSSDY                           126274
     C                     MOVE *BLANKS   SCSNM                           126274
     C           PRTCD     IFEQ *BLANKS                                   126274
     C                     MOVE BBCSSN    SCSNM                           126274
     C                     ELSE                                           126274
     C                     MOVE 'Unknown' SCSNM                           126274
     C                     ENDIF                                          126274
      *
     C                     MOVE FASTS     STATH
     C                     MOVE FASTS     WASTS   1
     C                     EXSR SRSTAT
      *
     C                     MOVE BRCA      SBRCH
     C                     MOVE ORBR      SORBH
     C/COPY WNCPYSRC,LE2120C024
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSTAT  -  Format Repayment Sched status for display          *
      * Called by: SRFRMT - Format subfile screen fields              *
      *            SRINZD - Initialise detail screen                  *
      * Calls    : none                                               *
      *                                                               *
      *****************************************************************
      *
     C           SRSTAT    BEGSR
      *
      ** Status
      *
     C                     SELEC
     C           WASTS     WHEQ 'C'
     C***********          MOVE WSTAT,1   SSTAT                           123998
     C                     MOVEL'LES0210' ZAMSID                          123998
     C           WASTS     WHEQ 'A'
     C***********          MOVE WSTAT,2   SSTAT                           123998
     C                     MOVEL'LES0211' ZAMSID                          123998
     C           WASTS     WHEQ 'R'
     C***********          MOVE WSTAT,3   SSTAT                           123998
     C                     MOVEL'LES0212' ZAMSID                          123998
     C           WASTS     WHEQ 'D'
     C***********          MOVE WSTAT,4   SSTAT                           123998
     C                     MOVEL'LES0213' ZAMSID                          123998
     C                     ENDSL
      *                                                                   123998
     C                     EXSR SRTEXT                                    123998
     C                     MOVELZAMSTX    SSTAT                           123998
     C                     MOVE *BLANKS   ZAMSID                          123998
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRVAL1  -  Validate initial screen                            *
      * Called by: SRBTCH - Process subfile                           *
      *            SRINPU - Process detail screen                     *
      * Calls    : SREROR - Error processing                          *
      *            SRCAUT - Validate user authority on branch/action  *
      *            SRVVAL - Validate value date                       *
      *            SRWARN - Display warning message if loan is synd.  *   159256
      *                                                               *
      *****************************************************************
      *
     C           SRVAL1    BEGSR
      *
      ** Do validation once
      *
     C                     DO
      *
      ** Validate Action code
      *
      ** Action code must be I, E, A, X or R
      *
     C           SACTN     IFNE 'I'
     C           SACTN     ANDNE'E'
     C           SACTN     ANDNE'A'
     C           SACTN     ANDNE'X'
     C           SACTN     ANDNE'R'
     C                     MOVEL'LES0021' ZAMSID
     C                     MOVE *ON       *IN32
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
      *
      ** Validate Loan Number
      *
      ** Loan number must be numeric
      *
     C           WALLOW    IFEQ 'N'                                                           CLE148
      *                                                                                       CLE148
     C                     MOVE *BLANK    ZFIELD
     C                     MOVELSLOAN     ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD6         ZADIG
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ *ON
     C                     MOVE *ON       *IN31
     C                     MOVEL'LES0030' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
      *                                                                                       CLE148
     C                     ELSE                                                               CLE148
      *                                                                                       CLE148
     C                     MOVEL'LELOAN'  WCHR10 10                                           CLE148
     C                     MOVE 'ISO '    WCHR10                                              CLE148
     C                     CALL WCHR10                                                        CLE148
     C                     PARM SLOAN     PLNRF   6                                           CLE148
     C                     PARM *BLANKS   PVALID  6                                           CLE148
     C                     PARM *BLANKS   PCHKD   1                                           CLE148
     C                     PARM *BLANKS   PDATA   2                                           CLE148
      *                                                                                       CLE148
     C           PVALID    IFNE *BLANKS                                                       CLE148
     C                     MOVE *ON       *IN31                                               CLE148
     C                     MOVEL'LEL0822' ZAMSID                                              CLE148
     C                     MOVE 'E'       WMSEV                                               CLE148
     C                     EXSR SREROR                                                        CLE148
     C                     LEAVE                                                              CLE148
     C                     ENDIF                                                              CLE148
      *                                                                                       CLE148
     C                     ENDIF                                                              CLE148
      *
      ** Loan must exist on Loans file as live
      *
     C                     MOVE SLOAN     WCLOAN
     C                     MOVE 'A'       WCRCDT
      *
     C********** WCLOAN    IFEQ 0                                                             CLE148
     C           WCLOAN    IFEQ *BLANK                                                        CLE148
     C                     MOVE *ON       *IN31
     C                     MOVEL'LES0030' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
      *
     C           WKLON     CHAINCLOAN               N02
     C           *IN02     IFEQ *ON
     C                     MOVE *ON       *IN31
     C                     MOVEL'LES0025' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
      *
      ** Loan should not have status of Reversed or Matured
      *
     C           RECIC     IFEQ 'R'
     C           RECIC     OREQ 'M'
      *                                                                   131253
     C           RECIC     IFNE 'M'                                       131253
     C           RATF      ORNE 'Y'                                       131253
     C           CLE005    ORNE 'Y'                                       131253
     C                     MOVE *ON       *IN31
     C                     MOVEL'LES0025' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF                                          131253
      *
     C                     ENDIF
      *
      ** Processing type of loan should not be 63, 65, 68, and 70
      *
     C           PTYPC     IFEQ 63
     C           PTYPC     OREQ 65
     C           PTYPC     OREQ 67
     C***********PTYPC     OREQ 70                                        142388
     C                     MOVE *ON       *IN31
     C                     MOVEL'LES0026' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
      *                                                                   CLE005
      ** Loan should not be a guarantee or risk loan                      CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C***********PTYPC     IFEQ 71                                 CLE005 142388
     C***********PTYPC     OREQ 72                                 CLE005 142388
     C***********          MOVE *ON       *IN31                    CLE005 142388
     C***********          MOVEL'LES0040' ZAMSID                   CLE005 142388
     C***********          MOVE 'E'       WMSEV                    CLE005 142388
     C***********          EXSR SREROR                             CLE005 142388
     C***********          LEAVE                                   CLE005 142388
     C***********          ENDIF                                   CLE005 142388
      *                                                                   CLE005
      ** Processing type 68,69,71,72 are not allowed if CLE005            CLE005
      ** is not installed                                                 CLE005
      *                                                                   CLE005
     C                     ELSE                                           CLE005
     C           PTYPC     IFEQ 68                                        CLE005
     C           PTYPC     OREQ 69                                        CLE005
     C           PTYPC     OREQ 71                                        CLE005
     C           PTYPC     OREQ 72                                        CLE005
     C                     MOVE *ON       *IN31                           CLE005
     C                     MOVEL'LES0041' ZAMSID                          CLE005
     C                     MOVE 'E'       WMSEV                           CLE005
     C                     EXSR SREROR                                    CLE005
     C                     LEAVE                                          CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                                       CLE028
      ** When CLE028 is installed, Repayment schedules are not allowed                        CLE028
      ** for flat rate personal loans                                                         CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYPC     ANDEQ80                                                            CLE028
     C                     MOVE *ON       *IN31                                               CLE028
     C                     MOVEL'LES0308' ZAMSID                                              CLE028
     C                     EXSR SREROR                                                        CLE028
     C                     LEAVE                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                    AR1046444
      ** Loan must not be PDCL.                                                            AR1046444
      *                                                                                    AR1046444
     C                     MOVELLTYPC     LTYP1   1                                        AR1046444
     C           LTYP1     IFEQ 'X'                                                        AR1046444
     C           LTYP1     OREQ 'Y'                                                        AR1046444
     C           LTYP1     OREQ 'Z'                                                        AR1046444
     C                     MOVE *ON       *IN31                                            AR1046444
     C                     MOVEL'LES0616' ZAMSID                                           AR1046444
     C                     MOVE 'E'       WMSEV                                            AR1046444
     C                     EXSR SREROR                                                     AR1046444
     C                     LEAVE                                                           AR1046444
     C                     ENDIF                                                           AR1046444
      *
      ** Validate User Authority on Action/Branch
      *
     C                     MOVE BRCAC     BRCA
     C                     EXSR SRCAUT
      *
     C           WAERR     IFEQ 'Y'
     C                     MOVE '11'      *IN,31
     C                     LEAVE
     C                     ENDIF
      *                                                                   124922
      ** Allow action 'X' if CLE002 = Y and Repayment Schedule Auth = Y   124922
      *                                                                   124922
     C           SACTN     IFEQ 'X'                                       124922
     C           CLE002    IFNE 'Y'                                       124922
     C           BPREAU    ORNE 'Y'                                       124922
     C                     MOVE *ON       *IN32                           124922
     C                     MOVEL'LES0037' ZAMSID                          124922
     C                     MOVE 'E'       WMSEV                           124922
     C                     EXSR SREROR                                    124922
     C                     ENDIF                                          124922
     C/COPY WNCPYSRC,LE2120C025
     C                     ENDIF                                          124922
     C/COPY WNCPYSRC,LE2120C008
      *
      ** Validate Sequence Number
      *
      ** Sequence number should be blank if action is Insert
      *
     C           SSEQN     IFEQ *BLANKS
     C           SACTN     ANDNE'I'
     C                     MOVEL'LES0107' ZAMSID
     C                     MOVE *ON       *IN34
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
      *
      ** Sequence number should not be blank if action is not Insert
      *
     C           SSEQN     IFNE *BLANKS
     C           SACTN     ANDEQ'I'
     C                     MOVEL'LES0108' ZAMSID
     C                     MOVE *ON       *IN34
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
      *
      ** Sequence number should be numeric
      *
     C           SSEQN     IFNE *BLANKS
     C                     MOVELSSEQN     WFLD4N  30
     C                     MOVELWFLD4N    WFLD3A  3
     C           SSEQN     IFNE WFLD3A
     C                     MOVEL'LES0031' ZAMSID
     C                     MOVE *ON       *IN34
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate Value Date
      *
     C                     EXSR SRVVAL
      *
     C           WMSEV     IFEQ 'E'
     C           WVERR     ANDEQ'Y'
     C                     MOVE *ON       *IN33
     C                     LEAVE
     C                     ENDIF
      *
     C           SACTN     IFNE 'I'
      *
      ** Other Validation
      *
      ** Access loan amendment record
      *
     C                     MOVE SLOAN     WLLOAN
     C                     MOVE WVDAYN    WLVDAT
     C                     MOVE SSEQN     WLLASN
      *
     C           WKLAM     CHAINLOAMS               N01
      *
      ** Error if loan amendment not found
      *
     C           *IN01     IFEQ *ON
     C                     SETON                     313334
     C                     MOVEL'LES0176' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
      *
      ** If not RE, invalid loan amendment type
      *
     C           AMTP      IFNE 'RE'
     C                     SETON                     313334
     C                     MOVEL'LES0176' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
      *
      ** If action is Authorise, record must exist with status of
      ** 'C' Complete or 'R' Reauthorization required
      *
     C           SACTN     IFEQ 'X'
     C           ASTS      ANDNE'C'
     C           ASTS      ANDNE'R'
     C                     SETON                     313234
     C                     MOVEL'LES0022' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
      *
     C           SACTN     IFEQ 'R'
     C           XASQ      ANDNE0
     C                     SETON                     313234
     C                     MOVEL'LES0231' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
      *
      ** If action is Authorise, authorising user must not be the
      ** same as the Inserting/Amending user
      *
     C/COPY WNCPYSRC,LE2120C011
     C           SACTN     IFEQ 'X'
     C           AUSR      IFEQ USER
     C           IUSR      OREQ USER
     C                     SETON                     313234
     C                     MOVEL'LES0023' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2120C012
      *
      ** If Reversed record found, display as enquiry
      *
     C           AMTP      IFEQ 'RE'
     C           RECI      ANDEQ'R'
     C                     MOVE 'E'       SACTN
      *
      ** Return error message if on Batch/Play mode
      *
     C           PMODE     IFEQ 'B'
     C           PMODE     OREQ 'P'
     C                     MOVEL'LES0024' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                                       CSD015
      ** If Watch List Checking Applied                                                       CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C           CLE002    ANDEQ'Y'                                                           CSD015
     C           BPREAU    ANDEQ'Y'                                                           CSD015
     C           SACTN     ANDEQ'X'                                                           CSD015
      *                                                                                       CSD015
     C                     MOVEL*BLANKS   WKIDEN                                              CSD015
     C                     MOVEL*BLANKS   WLNRF                                               CSD015
     C                     MOVEL*BLANKS   WVDAT                                               CSD015
     C                     MOVEL*BLANKS   WLASN                                               CSD015
     C                     MOVEL*BLANKS   KFUNT                                               CSD015
     C                     MOVEL*BLANKS   KIDEN                                               CSD015
     C                     MOVEL*BLANKS   KBRCH                                               CSD015
     C                     MOVE *OFF      *IN39                                               CSD015
      *                                                                                       CSD015
     C                     MOVE LNRF      WLNRF                                               CSD015
     C                     MOVE VDAT      WVDAT                                               CSD015
     C                     MOVE LASN      WLASN                                               CSD015
     C           WLNRF     CAT  WVDAT:0   WKIDEN                                              CSD015
     C                     CAT  WLASN:0   WKIDEN                                              CSD015
      *                                                                                       CSD015
      ** If 24X7 is not installed or the suport system is off.                                CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
      *                                                                                       CSD015
     C                     MOVEL'LOAMSDK' KFUNT                                               CSD015
     C                     MOVELWKIDEN    KIDEN                                               CSD015
     C                     MOVELBRCA      KBRCH                                               CSD015
     C           CWHTKY    CHAINSDCWHTL1             39                                       CSD015
      *                                                                                       CSD015
      ** If record found, diplay error message 'Trade details being                           CSD015
      ** reviewed by Compliance Officer'                                                      CSD015
      *                                                                                       CSD015
     C           *IN39     IFEQ *OFF                                                          CSD015
     C           W3TREL    ANDNE'Y'                                                           CSD015
     C                     MOVEA'1111'    *IN,31                                              CSD015
     C                     MOVEL'LEL0564' ZAMSID                                              CSD015
     C                     EXSR SREROR                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C/COPY WNCPYSRC,LEH00606
      *                                                                   159256
      ** Issue warning if changing a syndicated transaction.              159256
      *                                                                   159256
     C           SACTN     IFNE 'E'                                       159256
     C           SACTN     ANDNE*BLANK                                    159256
     C                     EXSR SRWARN                                    159256
     C           WE232     IFNE *BLANK                                    159256
     C                     MOVEA'11'      *IN,31                          159256
     C                     ENDIF                                          159256
     C                     ENDIF                                          159256
      *
     C                     LEAVE
      *
     C                     ENDDO
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRVVAL  -  Validate value date                                *
      * Called by: SRVAL1 - Validate initial screen                   *
      *            SRVAL2 - Validate detail screen                    *
      * Calls    : SREROR - Error processing                          *
      *                                                               *
      *****************************************************************
      *
     C           SRVVAL    BEGSR
      *
     C                     MOVE ' '       WVERR   1
      *
     C                     DO
      *
      ** Value date should not be blanks
      *
     C           SVDAT     IFEQ *BLANKS
     C                     MOVEL'LES0105' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     MOVE 'Y'       WVERR   1
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
      *
      ** Value date should be numeric and in valid date format
      *
     C                     MOVELSVDAT     WFLD7N  60
     C                     MOVELWFLD7N    WFLD6A  6
     C           SVDAT     IFNE WFLD6A
     C                     MOVEL'LES0105' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     MOVE 'Y'       WVERR   1
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
      *
     C                     MOVE SVDAT     ZDATE
     C                     EXSR ZDATE1
      *
     C           *IN99     IFEQ *ON
     C                     MOVEL'LES0105' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     MOVE 'Y'       WVERR   1
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
      *
     C                     Z-ADDZDAYNO    WVDAYN  50
      *
      ** If action is Insert
      *
     C           SACTN     IFEQ 'I'
      *
      ** Value date should not be earlier than start date and not later
      ** than maturity date
      *
     C/COPY WNCPYSRC,LE2120C009
     C           WVDAYN    IFLE VDATC
     C           MDATC     ORGT 0
     C********** WVDAYN    ANDGEMDATC                                                       AR740107
     C           WVDAYN    ANDGTMDATC                                                       AR740107
     C                     MOVEL'LES0106' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     MOVE 'Y'       WVERR   1
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
     C/COPY WNCPYSRC,LE2120C010
      *                                                                                     AR740107
      ** If Value date is amended to be equal to Maturity date                              AR740107
      ** generate a warning message.                                                        AR740107
      *                                                                                     AR740107
     C           WVDAYN    IFEQ MDATC                                                       AR740107
     C                     MOVEL'LES0615' ZAMSID                                            AR740107
     C                     MOVE 'W'       WMSEV                                             AR740107
     C                     MOVE 'W'       WVERR                                             AR740107
     C                     EXSR SREROR                                                      AR740107
     C                     ENDIF                                                            AR740107
      *
      ** Extra validation for value date
      *
      ** Calculate Back value limit
      *
     C           BJRDNB    SUB  BJBVPD    WBKLIM  50
      *
     C***********CLE003    IFEQ 'Y'                                       122998
     C***********WVDAYN    ANDLTRLDT                                      122998
     C***********          MOVEL'LES0110' ZAMSID                          122998
     C***********          MOVE 'E'       WMSEV                           122998
     C***********          MOVE 'Y'       WVERR   1                       122998
     C***********          EXSR SREROR                                    122998
     C***********          LEAVE                                          122998
     C***********          ENDIF                                          122998
      *
     C           CLE003    IFEQ 'N'                                       122998
      *                                                                   122998
     C           SLID      IFLT WBKLIM
     C           WVDAYN    ANDLTSLID
     C                     MOVEL'LES0111' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     MOVE 'Y'       WVERR   1
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
      *
     C           WVDAYN    IFLT WBKLIM
     C                     MOVEL'LES0111' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     MOVE 'Y'       WVERR   1
     C                     EXSR SREROR
     C                     LEAVE
     C                     ENDIF
      *
     C                     ENDIF                                          122998
      *                                                                   122998
     C                     ENDIF
      *                                                                   CLE014
      ** If CLE014 is on, value date must not be between multi-currency   CLE014
      ** rollover date and the working date after it.                     CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           RLDT      ANDNE*ZERO                                     CLE014
      *                                                                   CLE014
     C                     MOVE 'B'       WCRCDT                          CLE014
     C           WKLON     CHAINCLOANCKF            N02                   CLE014
      *                                                                   CLE014
     C           *IN02     IFEQ *OFF                                      CLE014
     C           NCCY      ANDNE*BLANKS                                   CLE014
     C           NCCY      ANDNELCCYC                                     CLE014
      *                                                                   CLE014
     C                     Z-ADDRLDT      ZDAYNO                          CLE014
     C                     MOVE BJLCCY    ZCCY                            CLE014
     C                     MOVE *BLANKS   ZLOC                            CLE014
     C                     Z-ADD1         ZNRDYS                          CLE014
     C                     EXSR ZFWDT                                     CLE014
      *                                                                   CLE014
     C           WVDAYN    IFGT RLDT                                      CLE014
     C           WVDAYN    ANDLTZDYNBR                                    CLE014
     C                     MOVEL'LES0138' ZAMSID                          CLE014
     C                     MOVE 'E'       WMSEV                           CLE014
     C                     MOVE 'Y'       WVERR                           CLE014
     C                     EXSR SREROR                                    CLE014
     C                     LEAVE                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** Back-valued repayment schedule is prohibited if rollover         CLE014
      ** details exists                                                   CLE014
      *                                                                   CLE014
     C           RLDT      IFLT BJRDNB                                    CLE014
     C           WVDAYN    ANDLTBJRDNB                                    CLE014
     C           WVDAYN    ANDGTRLDT                                      CLE014
     C                     MOVEL'LES0139' ZAMSID                          CLE014
     C                     MOVE 'E'       WMSEV                           CLE014
     C                     MOVE 'Y'       WVERR                           CLE014
     C                     EXSR SREROR                                    CLE014
     C                     LEAVE                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ENDIF                                          CLE014
      *
     C                     LEAVE
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRCAUT  -  Validate user authority on branch/action           *
      * Called by: SRVAL1 - Validate initial screen                   *
      *            SRLOAD - Load subfile                              *
      *            SRVALS - Validate subfile tags                     *
      * Calls    : SREROR - Error processing                          *
      *                                                               *
      *****************************************************************
      *
     C           SRCAUT    BEGSR
      *
     C                     MOVE ' '       WAERR   1
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
      *
      ** For single branch system, check if user is authorised to the
      ** action
      *
     C                     Z-ADD0         @ERR
     C           BGMBIN    IFEQ 'N'
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBACTU'
     C                     PARM SACTN     @ZACTN
     C                     PARM           @USER
     C**********           PARM           @ZMGRP                                              CSF002
     C**********           PARM           @ZICDE                                              CSF002
     C                     PARM           @UNQCD                                              CSF002
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVACTU'
     C                     PARM SACTN     @ZACTN
     C                     PARM           @ERR
     C                     ENDIF
     C           @ERR      IFNE 0
     C                     MOVEL'LES0302' ZAMSID
     C                     MOVE 'Y'       WAERR
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
      ** For multibranching system, and action codes A/E/R, branch code
      ** on loans file must be valid for user
      *
     C           WERRF     IFEQ *BLANK
     C           BGMBIN    ANDEQ'Y'
     C           SACTN     ANDNE'I'
     C                     MOVE SACTN     @ZACTN
     C                     MOVE BRCA      @ZBR
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBACTBU'
     C                     PARM SACTN     @ZACTN
     C                     PARM           @ZBR
     C                     PARM           @USER  10
     C**********           PARM           @ZMGRP  40                                          CSF002
     C**********           PARM           @ZICDE  4                                           CSF002
     C                     PARM           @UNQCD 10                                           CSF002
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVACTBU'
     C                     PARM           @ZACTN  1
     C                     PARM           @ZBR    3
     C                     PARM           @ERR    10
     C                     ENDIF
     C           @ERR      IFEQ 1
     C                     MOVEL'LES0303' ZAMSID
     C                     MOVE 'Y'       WAERR
     C                     EXSR SREROR
     C                     ENDIF
     C           @ERR      IFEQ 2
     C                     MOVEL'LES0304' ZAMSID
     C                     MOVE 'Y'       WAERR
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
      ** For multibranching system, and action codes A/R, originating
      ** branch on loans file must be valid for user
      *
     C           WERRF     IFEQ *BLANK
     C           BGMBIN    ANDEQ'Y'
     C           SACTN     ANDNE'E'
     C           BKOBUV    ANDEQ'Y'
     C           BKOBRU    ANDEQ'Y'
     C           PMODE     IFEQ 'B'
     C                     CALL 'ZBOBU'
     C                     PARM ORBR      @ZOBRX
     C                     PARM           @USER
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVOBU'
     C                     PARM ORBR      @ZOBRX  3
     C                     PARM           @ERR
     C                     ENDIF
     C           @ERR      IFEQ 1
     C                     MOVEL'LES0305' ZAMSID
     C                     MOVE 'Y'       WAERR
     C                     EXSR SREROR
     C                     ENDIF
     C           @ERR      IFEQ 2
     C                     MOVEL'LES0306' ZAMSID
     C                     MOVE 'Y'       WAERR
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRPF02  -  Initialise input screen fields                     *
      * Called by: SRPREV - Process previous screen                   *
      *            SRINPU - Input screen for Interactive/Rec mode     *
      * Calls    : none                                               *
      *                                                               *
      *****************************************************************
      *
     C           SRPF02    BEGSR
      *
      ** Initialis screen fields
      *
     C                     CLEARLE2120F1
     C           SAUTR     IFNE 'Y'
     C                     MOVE 'N'       SAUTR
     C                     ENDIF
      *
      ** Allocated sequence number for Insert
      *
     C           *IN26     IFEQ *ON
     C                     MOVE WLASNX    SLASN
     C                     ENDIF
      *
      ** Default action code to 'I' if F9 is pressed from subfile
      *
     C           *IN27     IFEQ *ON
     C                     MOVE 'I'       SACTN
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRPF01  -  Initialise work fields for input screen            *
      * Called by: SRPREV - Process previous screen                   *
      *            SRINPU - Input screen for Interactive/Rec mode     *
      * Calls    : none                                               *
      *                                                               *
      *****************************************************************
      *
     C           SRPF01    BEGSR
      *
     C           *IN27     IFEQ *OFF
     C                     MOVE 'I'       WPREV   1
     C                     ELSE
     C                     MOVE 'S'       WPREV
     C                     ENDIF
     C                     MOVE 'D'       WOPTN   1
     C                     MOVE 'Y'       WPASS   1
     C                     MOVE ' '       WERRF   1
     C                     MOVE ' '       WMSEV   1
     C                     MOVE '0'       *IN70                                               203856
     C                     Z-ADD0         WCAMT                                               CLE036
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRBSET  -  Format screen fields for Batch/Play                *
      * Called by: SRBTCH - Batch mode processing                     *
      * Calls    : None                                               *
      *                                                               *
      *****************************************************************
      *
     C           SRBSET    BEGSR
      *
      ** Play mode: move Test Harness fields to screen fields
      *
     C           PMODE     IFEQ 'P'
      *
      ** Save Test harness record to DS
      *
     C                     MOVE L2120F    L2120S
      *
     C                     MOVE LNRF      SLOAN
     C                     MOVE ACTN      SACTN
     C                     MOVE CCY       SCURR
     C                     Z-ADDVDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SVDAT
     C           ACTN      IFEQ 'I'
     C                     MOVE *BLANKS   SSEQN
     C                     ELSE
     C                     MOVE LASN      SSEQN
     C                     ENDIF
     C                     MOVE *BLANKS   SCUST                                               207629
     C                     MOVELCNUM      SCUST
      *If the loan is a Participation Purchased, & System Value                               207629
      * LOANCUSTORIGINPURCH = 'O', use Original Borrower:                                     207629
     C           PPCUST    IFEQ 'O'                                                           207629
     C           PTYPC     IFEQ 64                                                            207629
     C           PTYPC     OREQ 65                                                            207629
     C           PTYPC     OREQ 68                                                            207629
     C           PTYPC     OREQ 71                                                            207629
     C                     MOVELOLNO      SCUST                                               207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     MOVELCCY       WCCY
     C                     Z-ADDPRAM      WPRAM
     C                     MOVE 'L'       ZECODE
     C                     EXSR SRFMTA
     C                     MOVE WFLD20    SAMNT
     C                     MOVE AUTO      SAUTO
     C                     MOVE SPI1      SSPI1
     C                     MOVE SPI2      SSPI2
     C                     MOVE SPI3      SSPI3
      *
     C                     ELSE
      *
      ** Batch mode: move formatted message to screen fields
      *
     C                     MOVE PILOAN    SLOAN
     C                     MOVE PITACT    SACTN
     C                     MOVE PICURR    SCURR
     C                     MOVE PIVDAT    WPITDS
     C                     MOVELWPIDD     WFLD4   4
     C                     MOVE WPIMM     WFLD4
     C                     MOVELWFLD4     WFLD6   6
     C                     MOVE WPIYY     WFLD2   2
     C                     MOVE WFLD2     WFLD6
     C                     MOVELWFLD6     SVDAT
     C           PITACT    IFEQ 'I'
     C                     MOVE *BLANKS   SSEQN
     C                     ELSE
     C                     MOVE PIRESQ    SSEQN
     C                     ENDIF
     C                     MOVELPICSNO    SCUST
     C                     MOVE PIPAMT    SAMNT
     C                     MOVE PIAUTO    SAUTO
     C                     MOVE PISPI1    SSPI1
     C                     MOVE PISPI2    SSPI2
     C                     MOVE PISPI3    SSPI3
      *
     C***********          MOVELPIPSTM    PSTM                            123699
     C***********          MOVELPIPONS    PONS                            123699
     C***********          MOVELPIPREC    RVNO                            123699
     C***********          MOVELPICVMR    CVMR                            123699
     C***********          MOVELPIPOCN    POCN                            123699
     C***********          MOVELPIPOBN    POBN                            123699
     C***********          MOVELPIRCRN    RCRN                            123699
     C***********          MOVELPIRCRA    RCRA                            123699
     C***********          MOVELPIPIBN    PIBN                            123699
     C***********          MOVELPIPIBA    PIBA                            123699
     C***********          MOVELPIAWBN    AWBN                            123699
     C***********          MOVELPIAWBA    AWBA                            123699
     C***********          MOVELPIBENN    BENN                            123699
     C***********          MOVELPIBENA    BENA                            123699
      *
     C***********          MOVELPIRSTM    RSTM                            123699
     C***********          MOVELPIRONS    RONS                            123699
     C***********          MOVELPIROCN    ROCN                            123699
     C***********          MOVELPIROBN    ROBN                            123699
     C***********          MOVELPIRIBN    RIBN                            123699
     C***********          MOVELPIRIBA    RIBA                            123699
      *
     C***********          MOVELPIDTP1    DTP1                            123699
     C***********          MOVELPIDTP2    DTP2                            123699
     C***********          MOVELPIDTP3    DTP3                            123699
     C***********          MOVELPIDTP4    DTP4                            123699
     C***********          MOVELPIDCHG    DCHG                            123699
     C***********          MOVELPIBTB1    BTB1                            123699
     C***********          MOVELPIBTB2    BTB2                            123699
     C***********          MOVELPIBTB3    BTB3                            123699
     C***********          MOVELPIBTB4    BTB4                            123699
     C***********          MOVELPIBTB5    BTB5                            123699
     C***********          MOVELPIBTB6    BTB6                            123699
      *
     C                     MOVELPIPSTM    PMPSTM                          123699
     C           PIPSTM    IFEQ '05'                                      123699
     C           CLE033    OREQ 'Y'                                       CLE033
     C           PIPSTM    ANDEQ'09'                                      CLE033
     C                     MOVELPIPONS    PMPOBR                          123699
     C                     MOVE PIPONS    PMPONS                          123699
     C                     ELSE                                           123699
     C                     MOVELP#PONS    PMPONS                          123699
     C                     ENDIF                                          123699
      *                                                                   123699
     C                     MOVELPIPREC    PARVNO                          123699
     C                     MOVELPICVMR    PMCVMR                          123699
     C                     MOVELPIPOCN    PAPOCN                          123699
     C                     MOVELPIPOBN    PAPOBN                          123699
     C                     MOVELPIRCRN    PARCRN                          123699
     C                     MOVELPIRCRA    PMRCRA                          123699
     C                     MOVELPIPIBN    PAPIBN                          123699
     C                     MOVELPIPIBA    PMPIBA                          123699
     C                     MOVELPIAWBN    PAAWBN                          123699
     C                     MOVELPIAWBA    PMAWBA                          123699
     C                     MOVELPIBENN    PABENN                          123699
     C                     MOVELPIBENA    PMBENA                          123699
      *                                                                   123699
     C                     MOVELPIRSTM    PMRSTM                          123699
     C           PIRSTM    IFEQ '05'                                      123699
     C           CLE033    OREQ 'Y'                                       CLE033
     C           PIRSTM    ANDEQ'09'                                      CLE033
     C                     MOVELPIRONS    PMROBR                          123699
     C                     MOVE PIRONS    PMRONS                          123699
     C                     ELSE                                           123699
     C                     MOVELP#RONS    PMRONS                          123699
     C                     ENDIF                                          123699
      *                                                                   123699
     C                     MOVELPIROCN    PAROCN                          123699
     C                     MOVELPIROBN    PAROBN                          123699
     C                     MOVELPIRIBN    PARIBN                          123699
     C                     MOVELPIRIBA    PMRIBA                          123699
      *                                                                   123699
     C                     MOVELPIDTP1    PMDTP1                          123699
     C                     MOVELPIDTP2    PMDTP2                          123699
     C                     MOVELPIDTP3    PMDTP3                          123699
     C                     MOVELPIDTP4    PMDTP4                          123699
     C                     MOVELPIDCHG    PMDCHG                          123699
     C                     MOVELPIBTB1    PMBTB1                          123699
     C                     MOVELPIBTB2    PMBTB2                          123699
     C                     MOVELPIBTB3    PMBTB3                          123699
     C                     MOVELPIBTB4    PMBTB4                          123699
     C                     MOVELPIBTB5    PMBTB5                          123699
     C                     MOVELPIBTB6    PMBTB6                          123699
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELPISCCY    PMRSCY                          CEU004
     C                     MOVELPISCCY    PMPSCY                          CEU004
     C                     MOVELPIICCY    PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   123699
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELPISCCY    PMRSCY                                              CLE031
     C                     MOVELPIPSCY    PMPSCY                                              CLE031
     C                     MOVELPIREXR    PMREXR                                              CLE031
     C           PIREXR    IFNE *BLANKS                                                       CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVELPIREXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     EXSR ZALIGN
     C                     Z-ADD*ZEROS    WSEXR  138                                          CLE031
     C                     MOVELZFIELD    WSEXR                                               CLE031
     C           *IN99     IFEQ *ON                                                           CLE031
     C           WSEXR     OREQ *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELPIPEXR    PMPEXR                                              CLE031
     C           PIPEXR    IFNE *BLANKS                                                       CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVELPIPEXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     EXSR ZALIGN
     C                     Z-ADD*ZEROS    WSEXR                                               CLE031
     C                     MOVELZFIELD    WSEXR                                               CLE031
     C           *IN99     IFEQ *ON                                                           CLE031
     C           WSEXR     OREQ *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELPIREXI    PMREXI                                              CLE031
     C           PIREXI    IFEQ 'N'                                                           CLE031
     C                     MOVE *BLANKS   PMREXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVELPIPEXI    PMPEXI                                              CLE031
     C           PIPEXI    IFEQ 'N'                                                           CLE031
     C                     MOVE *BLANKS   PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVE PITUSR    WTUSR  16
     C                     MOVE PITWST    WTWST  16
     C***********          MOVE PITREF    WTREF  12                       121798
     C                     MOVE PITREF    WTREF  15                       121798
     C                     MOVE PITSEQ    WTSEQ   4
     C                     MOVE PITDST    WTDST   8
     C                     MOVE PITTST    WTTST   8
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE PISTAL    SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRVALR  - Validate/Set Review from fields                     *
      * Called by: SRINPU - Process input screen for Interactive/Rec  *
      *            SRSUBF - Process subfile                           *
      * Calls    : SREROR - Error processing                          *
      *                                                               *
      *****************************************************************
      *
     C           SRVALR    BEGSR
      *
      ** Review from Loan Number
      *
     C           SLONR     IFNE *BLANKS
     C                     TESTN          SLONR      888888
      *                                                                                       CLE148
     C           WALLOW    IFEQ 'Y'                                                           CLE148
     C                     MOVEL'LELOAN'  WCHR10 10                                           CLE148
     C                     MOVE 'ISO '    WCHR10                                              CLE148
     C                     CALL WCHR10                                                        CLE148
     C                     PARM SLONR     PLNRF   6                                           CLE148
     C                     PARM *BLANKS   PVALID  6                                           CLE148
     C                     PARM *BLANKS   PCHKD   1                                           CLE148
     C                     PARM *BLANKS   PDATA   2                                           CLE148
     C                     ENDIF                                                              CLE148
      *                                                                                       CLE148
     C           *IN88     IFEQ *OFF
     C           WALLOW    ANDEQ'N'                                                           CLE148
     C           PVALID    ORNE *BLANKS                                                       CLE148
     C           WALLOW    ANDEQ'Y'                                                           CLE148
     C                     MOVE *ON       *IN35
     C**********           MOVEL'LES0027' ZAMSID                                              CLE148
     C           WALLOW    IFEQ 'N'                                                           CLE148
     C                     MOVEL'LEL0823' ZAMSID                                              CLE148
     C                     ELSE                                                               CLE148
     C                     MOVEL'LEL0821' ZAMSID                                              CLE148
     C                     MOVELPDATA     ZAMSDA                                              CLE148
     C                     ENDIF                                                              CLE148
     C                     EXSR SREROR
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Review from VALUE DATE is set to blanks if invalid
      *
     C           SDATR     IFNE *BLANKS
     C                     MOVELSDATR     WFLD7N  60
     C                     MOVELWFLD7N    WFLD6A  6
      *
     C           SDATR     IFNE WFLD6A
     C                     MOVE *ON       *IN36
     C                     MOVEL'LES0028' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE SDATR     ZDATE
     C                     EXSR ZDATE1
      *
     C           *IN99     IFEQ *ON
     C                     MOVE *ON       *IN36
     C                     MOVEL'LES0028' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Review from SEQUENCE NUMBER is set to blanks if invalid
      *
     C           SSEQR     IFNE *BLANKS
     C                     TESTN          SSEQR      888888
     C           *IN88     IFEQ *OFF
     C                     MOVE *ON       *IN37
     C                     MOVEL'LES0027' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Review from Unauthorised Only should only be 'Y' or 'N' if
      ** entered. If not, default the value to 'N'
      *
     C           SAUTR     IFEQ *BLANKS
      *
     C                     MOVE 'N'       SAUTR
     C                     ELSE
      *
     C           SAUTR     IFNE 'Y'
     C           SAUTR     ANDNE'N'
     C                     MOVEL'LES0061' ZAMSID
     C                     MOVE *ON       *IN38
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
     C                     MOVE 'S'       WOPTN
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRVALS  -  Validate subfile tags                              *
      * Called by: SRSUBF - Process subfile                           *
      * Calls    : SREROR - Error processing                          *
      *                                                               *
      *****************************************************************
      *
     C           SRVALS    BEGSR
      *
     C                     MOVE *OFF      *IN06
     C                     READCLE2120S0                 06
     C                     MOVE ' '       WFIRST  1
      *
      ** Validate tags/process action
      *
     C           *IN06     DOWEQ*OFF
      *
      ** Action code is not blank, and not A,R,E,X
      *
     C           SACTN     IFNE ' '
      *
     C           SACTN     IFNE 'A'
     C           SACTN     ANDNE'R'
     C           SACTN     ANDNE'E'
     C           SACTN     ANDNE'X'
     C                     MOVE *ON       *IN30
     C                     MOVEL'LES0038' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
      ** Allow action 'X' if CLE002 = Y and Repayment Schedule Auth = Y
      *
     C           *IN30     IFEQ *OFF
     C           SACTN     IFEQ 'X'
     C           CLE002    IFNE 'Y'
     C           BPREAU    ORNE 'Y'
     C                     MOVE *ON       *IN30
     C                     MOVEL'LES0037' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2120C026
      *
     C           *IN30     IFEQ *OFF
     C           SACTN     IFEQ 'X'
     C           STATH     ANDEQ'A'
     C                     MOVE *ON       *IN30
     C                     MOVEL'LES0039' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
     C           *IN30     IFEQ *OFF
     C                     MOVE SLOAN     WLLOAN
     C                     Z-ADDSVDTH     WLVDAT
     C                     MOVE SSEQN     WLLASN
     C           WKLAM     CHAINLOAMD                07
      *
     C           *IN07     IFEQ *OFF
     C           SACTN     ANDEQ'X'
     C/COPY WNCPYSRC,LE2120C013
     C           AUSRA     IFEQ USER
     C           IUSRA     OREQ USER
     C                     MOVE *ON       *IN30
     C                     MOVEL'LES0023' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2120C014
      *
      ** Check user authority on action
      *
     C           *IN30     IFEQ *OFF
     C                     MOVE SBRCH     BRCA
     C                     MOVE SORBH     ORBR
     C                     EXSR SRCAUT
     C           WAERR     IFEQ 'Y'
     C                     MOVE 'E'       WMSEV
     C                     MOVE *ON       *IN30
     C                     ENDIF
     C                     ENDIF
      *
      ** Check if live Manual Repayments exist for this Repayment Sched
      *
     C           SACTN     IFEQ 'R'
     C           XASQA     ANDNE0
     C                     MOVE 'E'       WMSEV
     C                     MOVEL'LES0231' ZAMSID
     C                     MOVE *ON       *IN30
     C                     EXSR SREROR
     C                     ENDIF
      *                                                                                       CSD015
      ** If Watch List Checking Applied                                                       CSD015
      *                                                                                       CSD015
     C           CLE002    IFEQ 'Y'                                                           CSD015
     C           BPREAU    ANDEQ'Y'                                                           CSD015
     C           SACTN     ANDEQ'X'                                                           CSD015
      *                                                                                       CSD015
     C                     MOVEL*BLANKS   WLNRF                                               CSD015
     C                     MOVEL*BLANKS   WVDAT                                               CSD015
     C                     MOVEL*BLANKS   WLASN                                               CSD015
     C                     MOVEL*BLANKS   WKIDEN                                              CSD015
     C                     MOVEL*BLANKS   KFUNT                                               CSD015
     C                     MOVEL*BLANKS   KIDEN                                               CSD015
     C                     MOVEL*BLANKS   KBRCH                                               CSD015
     C                     MOVE *OFF      *IN39                                               CSD015
      *                                                                                       CSD015
     C                     MOVE LNRFA     WLNRF                                               CSD015
     C                     MOVE VDATA     WVDAT                                               CSD015
     C                     MOVE LASNA     WLASN                                               CSD015
     C           WLNRF     CAT  WVDAT:0   WKIDEN                                              CSD015
     C                     CAT  WLASN:0   WKIDEN                                              CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
      ** If 24X7 is not installed or the suport system is off.                                CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           S1MAIN    OREQ LIBR                                                          CSD015
      *                                                                                       CSD015
     C                     MOVEL'LOAMSDK' KFUNT                                               CSD015
     C                     MOVELWKIDEN    KIDEN                                               CSD015
     C                     MOVELBRCA      KBRCH                                               CSD015
     C           CWHTKY    CHAINSDCWHTL1             39                                       CSD015
      *                                                                                       CSD015
      ** If record found, diplay error message 'Trade details being                           CSD015
      ** reviewed by Compliance Officer'                                                      CSD015
      *                                                                                       CSD015
     C           *IN39     IFEQ *OFF                                                          CSD015
     C           W3TREL    ANDNE'Y'                                                           CSD015
     C                     MOVE '1'       *IN30                                               CSD015
     C                     MOVEL'LEL0564' ZAMSID                                              CSD015
     C                     EXSR SREROR                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *
      ** If this is the first occurrence of the error
      *
     C           *IN30     IFEQ *ON
     C           WFIRST    ANDEQ' '
     C                     MOVE SRRN      SSREC
     C                     MOVE 'Y'       WFIRST  1
     C                     ENDIF
      *
     C                     MOVE *ON       *IN83            Sflnxtchg
     C                     UPDATLE2120S0
     C                     Z-ADD1         WDETL   10
     C                     MOVE *OFF      *IN30
      *
      ** Selection field has been blanked out, do not process
      *
     C                     ELSE
     C                     MOVE *OFF      *IN83
     C                     MOVE *OFF      *IN30
     C                     UPDATLE2120S0
     C                     ENDIF
      *
      ** Read next change on subfile
      *
     C                     READCLE2120S0                 06
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRINZD  -  Initialise detail screen                           *
      * Called by: SRBTCH - Batch mode processing                     *
      *            SRDETL - Process detail screen                     *
      * Calls    : SREROR - Error processing                          *
      *                                                               *
      *****************************************************************
      *
     C           SRINZD    BEGSR
      *
      ** Initialise screen indicators
      *
     C                     MOVEA'00'      *IN,50
     C                     MOVE *OFF      *IN22
     C                     MOVE *OFF      *IN25
     C                     MOVE '00'      *IN,23
     C                     MOVEA'00000'   *IN,41
     C                     MOVEA'0000'    *IN,60
     C                     MOVE ' '       WMSEV
     C                     MOVE *OFF      *IN11                                               CLE036
      *
      ** Clear subfile message queue
      *
     C                     EXSR SRCLRS
      *
      ** Set on screen indicators according to Action
      *
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C                     MOVE *ON       *IN25
     C                     ENDIF
      *
     C           SACTN     IFNE 'I'
     C                     MOVE *ON       *IN22
     C           SACTN     COMP 'R'                      50
     C           SACTN     COMP 'X'                      51
     C                     ENDIF
      *
      ** Format details for screen output
      *
      ** For Insert, if the mode is 'I' or 'R' clear all input fields
      ** If mode is 'B' or 'P', these fields have already been setup
      ** from the parameter received
      *
     C           SACTN     IFEQ 'I'
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
      *
     C                     MOVE *BLANKS   SCUST
     C                     MOVE *BLANKS   SAMNT
     C                     MOVE *BLANKS   SCURR
     C                     MOVE *BLANKS   SAUTO
     C                     MOVE *BLANKS   SSPI1
     C                     MOVE *BLANKS   SSPI2
     C                     MOVE *BLANKS   SSPI3
     C                     MOVE *BLANKS   SSTAT
     C                     MOVE *BLANKS   SLCCY                                               CLE036
     C                     MOVE *BLANKS   SLRAM                                               CLE036
      *
      ** For initial screen validation
      *
     C                     MOVE '*'       SAVSCR
      *
     C                     ENDIF
      *
     C                     ELSE
      *
      ** Amend action
      *
     C                     MOVE *BLANKS   SCUST                                               207629
     C                     MOVELCNUM      SCUST
     C                     MOVE CCY       SCURR
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
      *
     C                     MOVE AUTO      SAUTO
     C                     MOVE AUTO      AUTOA                                               205714
     C                     MOVE SPI1      SSPI1
     C                     MOVE SPI2      SSPI2
     C                     MOVE SPI3      SSPI3
      *
     C                     MOVE CCY       WCCY
      *                                                                   158268
     C********** REPTC     IFEQ 3                                  158268 194454
     C           REPT      IFEQ 3                                         194454
     C                     Z-ADDTAMT      WPRAM                           158268
     C                     ELSE                                           158268
     C                     Z-ADDPRAM      WPRAM
     C                     ENDIF                                          158268
      *                                                                   158268
     C                     MOVE 'L'       ZECODE
     C                     EXSR SRFMTA
      *                                                                                       CLE036
     C           FREPAY    IFEQ 'Y'                                                           CLE036
     C           FRCY      ANDNE*BLANKS                                                       CLE036
     C                     MOVE *ON       *IN11                                               CLE036
     C                     MOVE WFLD20    SLRAM                                               CLE036
     C                     MOVE CCY       SLCCY                                               CLE036
     C                     MOVE FRCY      SCURR                                               CLE036
     C           REPT      IFEQ 3                                                             CLE036
     C                     Z-ADDFTOT      WPRAM                                               CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE FRAM      WPRAM                                               CLE036
     C                     ENDIF                                                              CLE036
     C                     MOVE FRCY      WCCY                                                CLE036
     C                     EXSR SRFMTA                                                        CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     MOVE WFLD20    SAMNT
      *
     C                     Z-ADDVDAT      ZDAYNO
     C                     Z-ADDVDAT      WVDAYN
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SVDAT
     C                     ENDIF
      *
      ** Settlement details
      *
     C                     CLEAROLDSET
     C                     MOVE SETP      OSETP
     C                     MOVE OSAC      OOSAC
     C                     MOVE TSEN      OTSEN
     C                     MOVE FACO      OFACO
     C                     MOVE SPI1      OSPI1
     C                     MOVE SPI2      OSPI2
     C                     MOVE SPI3      OSPI3
     C                     MOVE STALK     SSTAL                                               CLE034
      *
      ** Format RE status for display
      *
     C                     MOVE ASTS      WASTS   1
     C                     EXSR SRSTAT
     C                     MOVE *BLANKS   SAVSCR 34
     C                     ENDIF
      *
     C                     MOVE 'Y'       WPASS
     C                     MOVE 'Y'       WSDTV
     C                     MOVE 'N'       WXPAS   1
      *
      ** Confirmation sequence number
      *
     C           SACTN     IFNE 'E'
     C                     MOVE LSWCC     LSWCA   3
     C           LSWCA     IFEQ *BLANK
     C                     Z-ADD0         WLSWC   30
     C                     ELSE
     C                     Z-ADDLSWCC     WLSWC   30
     C                     ENDIF
      *
     C                     MOVE LSWSC     LSWSA   3
     C           LSWSA     IFEQ *BLANK
     C                     Z-ADD0         WLSWS   30
     C                     ELSE
     C                     Z-ADDLSWSC     WLSWS   30
     C                     ENDIF
     C                     ENDIF
      *
      ** Retrieve CLOAN record
      *
     C                     MOVE SLOAN     WCLOAN
     C                     MOVE 'A'       WCRCDT
     C           WKLON     CHAINCLOAN               N02
     C           *IN02     IFEQ *ON
     C                     MOVEL'CLOAN'   DBFILE           ************
     C                     Z-ADD21        DBASE            * DBERR 21 *
     C                     MOVELWCLKEY    DBKEY            ************
     C                     EXSR *PSSR
     C                     ENDIF
      *                                                                                       207629
     C           SACTN     IFNE 'I'                                                           207629
     C           PPCUST    ANDEQ'O'                                                           207629
     C           PTYPC     IFEQ 64                                                            207629
     C           PTYPC     OREQ 65                                                            207629
     C           PTYPC     OREQ 68                                                            207629
     C           PTYPC     OREQ 71                                                            207629
     C                     MOVELOLNO      SCUST                                               207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
      *
     C                     CLEARNEWSET
      *
     C                     Z-ADDLCD       WLCD    50
     C                     MOVE CHTP      WCHTP   1
     C                     Z-ADDTNLU      WTNLU   50
     C                     MOVE WLSTC     SAVLC  11
     C                     Z-ADD0         WAMNT                           142398
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRVAL2  -  Validate detail screen                             *
      * Called by: SRBTCH - Process subfile                           *
      *            SRINPU - Process detail screen                     *
      * Calls    : SREROR - Error processing                          *
      *            SRCAUT - Validate user authority on branch/action  *
      *            SRVVAL - Validate value date                       *
      *                                                               *
      *****************************************************************
      *
     C           SRVAL2    BEGSR
      *
      ** Initialise error indicators
      *
     C                     MOVE ' '       WMSEV
     C                     MOVE ' '       WERRF
     C                     MOVEA'00000'   *IN,41
      *
     C           SACTN     IFEQ 'X'
     C                     MOVE 'Y'       WSDTV
     C                     ELSE
     C                     MOVE 'N'       WSDTV
     C                     ENDIF
      *
      ** For Authorisation of a Complete Repayment, validate as Insert
      *
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'X'
     C           ASTS      ANDEQ'C'
      *
      ** Customer must exist in Customer File
      *
     C           SCUST     IFEQ *BLANKS
     C                     MOVE *ON       *IN41
     C                     MOVEL'LES0178' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     ENDIF
      *
     C           *IN41     IFEQ *OFF
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C           SCUST     PARM SCUST     PCUST  10
     C                     PARM *BLANKS   PKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           PRTCD     IFNE *BLANK
     C           PRTCD     IFEQ '*NOSEL'
     C                     MOVE *BLANKS   SCUST
     C                     ENDIF
     C                     MOVE *ON       *IN41
     C                     MOVEL'LES0034' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
      ** Customer must not be a parent
      *
     C           *IN41     IFEQ *OFF
     C           BBPAIN    ANDEQ'P'
     C                     MOVE *ON       *IN41
     C                     MOVEL'LES0036' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     ENDIF
      *
      ** Entered customer must equal customer in related loan
      *
     C           *IN41     IFEQ *OFF
     C                     MOVE CNUMC     WLCNOA  6
     C           PPCUST    IFEQ 'O'                                                           207629
     C           PTYPC     IFEQ 64                                                            207629
     C           PTYPC     OREQ 65                                                            207629
     C           PTYPC     OREQ 68                                                            207629
     C           PTYPC     OREQ 71                                                            207629
     C                     MOVE OLNO      WLCNOA                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C           BBCUST    IFNE WLCNOA
     C                     MOVE *ON       *IN41
     C                     MOVEL'LES0104' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVELBBCHID    WCHID   9
      *
      ** Validate value date
      *
     C                     EXSR SRVVAL
     C           WVERR     IFEQ 'Y'
     C                     MOVE 'E'       WMSEV
     C                     MOVE *ON       *IN42
     C                     ENDIF
      *
      ** Entry in Currency field is mandatory
      *
     C           SCURR     IFEQ *BLANKS
     C                     MOVE *ON       *IN43
     C                     MOVEL'LES0175' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     ELSE
      *
      ** Must be a valid currency
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*BLANK  'PRTCD
     C                     PARM '*KEY    'POPTN
     C           SCURR     PARM SCURR     PCURR
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           PRTCD     IFNE *BLANKS
     C           PRTCD     IFEQ '*NOSEL'
     C                     MOVE *BLANKS   SCURR
     C                     ENDIF
     C                     MOVE *ON       *IN43
     C                     MOVEL'LES0188' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
      ** Must equal currency of related loan - if multi ccy rollover
      ** is not allowed
      *
     C           *IN43     IFEQ *OFF
     C           MCRA      IFNE 'Y'
     C           CLE014    ANDNE'Y'                                       CLE014
     C           CLE014    OREQ 'Y'                                       CLE014
     C           FREPAY    ANDEQ'N'                                                           CLE036
      *
     C           SCURR     IFNE LCCYC
     C                     MOVE *ON       *IN43
     C                     MOVEL'LES0189' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     ENDIF
      *
     C                     ELSE
      *                                                                   CLE014
     C           CLE014    IFNE 'Y'                                       CLE014
     C           FREPAY    OREQ 'Y'                                                          CLE036
      *
      ** If Loan allows multicurrency rollover, then repayment
      ** schedule should be in facility currency
      *
      ** Access facility 'A' record
      *
     C                     MOVE FCUSC     WFCNUM
     C                     MOVE FTYPC     WFFACT
     C                     MOVE FSEQC     WFFCNO
     C                     MOVE 'A'       WFRCTP
      *
     C           WKFAC     CHAINFCLTY               N08
     C           *IN08     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY'   DBFILE           ************
     C                     Z-ADD22        DBASE            * DBERR 22 *
     C                     MOVELWFKEY     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           SCURR     IFNE FCCY
     C           FREPAY    ANDNE'Y'                                                           CLE036
     C                     MOVE *ON       *IN43
      ***********                                                  CEU020 147281
      ***Validation*of*the*loan*amendment*currency**************** CEU020 147281
      ***********                                                  CEU020 147281
     C***********CEU020    IFEQ 'Y'                                CEU020 147281
     C***********SCURR     ANDEQBKEURO                             CEU020 147281
     C***********          MOVELSLOAN     WCLOAN                   CEU020 147281
     C***********          MOVEL'B'       WCRCDT                   CEU020 147281
     C***********WKLON     CHAINCLOAN                05            CEU020 147281
     C***********A6INCY    IFEQ 'Y'                                CEU020 147281
     C***********SCURR     OREQ BKEURO                             CEU020 147281
     C***********          CALL 'AOCURRR0'                         CEU020 147281
     C***********          PARM '*BLANK  'PRTCD                    CEU020 147281
     C***********          PARM '*KEY    'POPTN                    CEU020 147281
     C***********          PARM LCCYC     PCURR                    CEU020 147281
     C***********SDCURR    PARM SDCURR    DSSDY                    CEU020 147281
      ***********                                                  CEU020 147281
     C***********PRTCD     IFEQ *BLANKS                            CEU020 147281
     C***********NCCY      ANDEQBKEURO                             CEU020 147281
     C***********WVDAYN    ANDGERLDT                               CEU020 147281
     C***********WVDAYN    ANDGEA6TPSD                             CEU020 147281
     C***********          MOVE '0'       *IN43                    CEU020 147281
     C***********          MOVE 'Y'       WFLOAM  1                CEU020 147281
     C***********          ENDIF                                   CEU020 147281
     C***********          ENDIF                                   CEU020 147281
     C***********          ENDIF                                   CEU020 147281
     C***********          ENDIF                                   CEU020 147281
     C************IN43     IFEQ '1'                                CEU020 147281
     C***********          MOVE 'N'       WFLOAM                   CEU020 147281
     C                     MOVEL'LES0187' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     ELSE                                                              CLE036
     C           SCURR     IFNE LCCYC                                                        CLE036
     C           SCURR     ANDNEFCCY                                                         CLE036
     C           FREPAY    ANDEQ'Y'                                                          CLE036
     C                     MOVE *ON       *IN43                                              CLE036
     C                     MOVEL'LES0193' ZAMSID                                             CLE036
     C                     MOVE 'E'       WMSEV                                              CLE036
     C                     EXSR SREROR                                                       CLE036
     C                     ENDIF                                                             CLE036
     C                     ENDIF
      *                                                                   CLE014
     C                     ENDIF                                          CLE014
      *
     C                     ENDIF
     C                     ENDIF
      *
      ** Entry in Amount field is mandatory
      *
     C           SAMNT     IFEQ *BLANKS
     C                     MOVE *ON       *IN44
     C                     MOVEL'LES0190' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     ELSE
      *
     C           *IN44     IFEQ *OFF
      *
      ** Amount should use the correct number of decimal
      *
     C                     Z-ADDA6NBDP    ZADEC
     C           13        SUB  A6NBDP    ZADIG
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SAMNT     ZFIELD
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    WLAMT  130
      *
     C           *IN99     IFEQ *ON
     C           WLAMT     OREQ 0                                         155421
     C                     MOVE *ON       *IN44
     C                     MOVEL'LES0192' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     ENDIF                             99
     C                     ENDIF                             43=0
     C                     ENDIF
      *
      ** Must be less or equal the outstanding principal of the related
      ** loan, taking into account all manual repayment and repayment
      ** schedule entered against it
      *
     C           *IN44     IFEQ *OFF
     C                     MOVE SSEQN     WSEQN   30
     C                     Z-ADDCPAM      WPRIN  130
     C                     MOVE *OFF      *IN07
      *                                                                   156048
     C           SVDAT     IFNE *BLANKS                                   156048
     C                     MOVE SVDAT     ZDATE                           156048
     C                     EXSR ZDATE1                                    156048
     C                     Z-ADDZDAYNO    WDAT    50                      156048
     C                     ENDIF                                          156048
      *
     C           LNRF      SETLLLOAMD
     C                     READ LOAMD                    07               152625
     C           *IN07     DOWEQ*OFF
     C***********          READ LOAMD                    07               152625
      *
     C           RECIA     IFEQ 'D'
     C           LNRFA     ANDEQLNRF
     C***********AUTOA     ANDEQ'Y'                                       142398
      *                                                                                       CLE134
     C                     MOVE AUTOA     WAUTOA  1                                           CLE134
     C           WAUTOA    IFEQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     MOVE 'Y'       WAUTOA                                              CLE134
     C                     ENDIF                                                              CLE134
      *
     C           AMTPA     IFEQ 'MR'
     C           AMTPA     OREQ 'RE'
     C********** AUTOA     ANDEQ'Y'                                                    142398 CLE134
     C           WAUTOA    ANDEQ'Y'                                                           CLE134
     C           AMTPA     OREQ 'PF'                                      152669
      *
     C***********LASNA     IFNE WSEQN                                     142398
     C***********VDATA     ANDNEWVDAYN                                    142398
     C           SACTN     IFEQ 'I'                                       142398
     C           SACTN     OREQ 'X'                                       142398
     C           LASNA     ANDNEWSEQN                                     142398
     C           VDATA     ANDEQWVDAYN                                    142398
     C           SACTN     OREQ 'X'                                       142398
     C           LASNA     ANDEQWSEQN                                     142398
     C           VDATA     ANDNEWVDAYN                                    142398
     C           SACTN     OREQ 'X'                                       142398
     C           LASNA     ANDNEWSEQN                                     142398
     C           VDATA     ANDNEWVDAYN                                    142398
      *                                                                   127348
      * Convert all previous repayments into loan currency amount and     127348
      * deduct from principal outstanding, if loan currency does not      127348
      * equal facility currency.                                          127348
      *                                                                   127348
     C           LCCYC     IFNE FCCY                                      127348
     C           AMTPA     IFEQ 'RE'                                      127348
      *                                                                   127348
      * Loan currency                                                     127348
     C                     MOVELLCCYC     WCURR                           127348
     C                     EXSR SRCURR                                    127348
     C                     Z-ADDA6NBDP    W#DP1   10                      127348
      *                                                                   127348
      * Base currency                                                     127348
     C                     MOVELBJCYCD    WCURR                           127348
     C                     EXSR SRCURR                                    127348
     C                     MOVE A6MDIN    WMDIN   1                       127348
     C                     Z-ADDA6SPRT    WSPRT  138                      127348
      *                                                                   127348
      * Facility currency                                                 127348
     C                     MOVELCCY       WCURR                           127348
     C                     EXSR SRCURR                                    127348
     C                     Z-ADDA6NBDP    WNBDP   10                      127348
     C                     MOVE A6MDIN    ZMDI1   1                       127348
     C                     Z-ADDA6SPRT    ZRATE1 138                      127348
     C                     MOVE WMDIN     ZMDI2   1                       127348
     C                     Z-ADDWSPRT     ZRATE2 138                      127348
     C                     EXSR ZXRATE                                    127348
      *                                                                   127348
     C                     Z-ADDPRAMA     W#20   200                      127348
      *                                                                   127348
      * If currencies have same number of decimal places need to          127348
      * obtain one more decimal place for rounding purposes               127348
      *                                                                   127348
     C           W#DP1     IFEQ WNBDP                                     127348
     C                     Z-ADD5         W#DP                            127348
     C           W#20      MULT POWR,W#DP W#20                            127348
     C                     ENDIF                                          127348
      *                                                                   127348
     C           A6MDIN    IFEQ 'M'                                       127348
     C           W#20      MULT ZRATEX    W#20                            127348
     C                     ELSE                                           127348
     C           W#20      DIV  ZRATEX    W#20                            127348
     C                     ENDIF                                          127348
      *                                                                   127348
      *  Convert new amount in base currency to loan currency             127348
      *                                                                   127348
     C                     MOVELLCCYC     WCURR                           127348
     C                     EXSR SRCURR                                    127348
     C                     MOVE A6MDIN    ZMDI1                           127348
     C                     Z-ADDA6SPRT    ZRATE1                          127348
     C                     MOVE WMDIN     ZMDI2                           127348
     C                     Z-ADDWSPRT     ZRATE2                          127348
     C                     EXSR ZXRATE                                    127348
      *                                                                   127348
     C           A6MDIN    IFEQ 'M'                                       127348
     C           W#20      DIV  ZRATEX    W#20                            127348
     C                     ELSE                                           127348
     C           W#20      MULT ZRATEX    W#20                            127348
     C                     ENDIF                                          127348
      *                                                                   127348
      * If the number of decimal places between loan ccy and facility     127348
      * ccy are not equal, need to drop or add decimal places before      127348
      * deducting from outstanding principal                              127348
      *                                                                   127348
     C                     Z-ADDW#20      WAMT0                           127348
      *                                                                   127348
     C           WNBDP     IFGT A6NBDP                                    127348
      *                                                                   127348
     C           WNBDP     SUB  A6NBDP    W#NBDP  10                      127348
      *                                                                   127348
     C                     SELEC                                          127348
      *                                                                   127348
     C           W#NBDP    WHEQ 1                                         127348
     C                     Z-ADDWAMT1     WNAMT     H                     127348
     C           WPRIN     SUB  WNAMT     WPRIN                           127348
      *                                                                   127348
     C           W#NBDP    WHEQ 2                                         127348
     C                     Z-ADDWAMT2     WNAMT     H                     127348
     C           WPRIN     SUB  WNAMT     WPRIN                           127348
      *                                                                   127348
     C           W#NBDP    WHEQ 3                                         127348
     C                     Z-ADDWAMT3     WNAMT     H                     127348
     C           WPRIN     SUB  WNAMT     WPRIN                           127348
      *                                                                   127348
     C           W#NBDP    WHEQ 4                                         127348
     C                     Z-ADDWAMT4     WNAMT     H                     127348
     C           WPRIN     SUB  WNAMT     WPRIN                           127348
      *                                                                   127348
     C           W#NBDP    WHEQ 5                                         127348
     C                     Z-ADDWAMT5     WNAMT     H                     127348
     C           WPRIN     SUB  WNAMT     WPRIN                           127348
      *                                                                   127348
     C                     ENDSL                                          127348
      *                                                                   127348
     C                     ELSE                                           127348
      *                                                                   127348
     C           WNBDP     IFLT A6NBDP                                    127348
      *                                                                   127348
     C           A6NBDP    SUB  WNBDP     W#DP    10                      127348
     C                     ADD  4         W#DP                            127348
      *                                                                   127348
     C           WAMT0     MULT POWR,W#DP WNAMT                           127348
     C           WPRIN     SUB  WNAMT     WPRIN                           127348
      *                                                                   127348
     C                     ELSE                                           127348
      *                                                                   127348
      * If the same number of decimal places need to round last digit     127348
      *                                                                   127348
     C                     SELEC                                          127348
      *                                                                   127348
     C           A6NBDP    WHEQ 1                                         127348
     C                     Z-ADDWAMT2     W#MT1     H                     127348
     C                     Z-ADDW#MT0     WNAMT                           127348
     C           WPRIN     SUB  WNAMT     WPRIN                           127348
      *                                                                   127348
     C           A6NBDP    WHEQ 2                                         127348
     C                     Z-ADDWAMT3     W#MT2     H                     127348
     C                     Z-ADDW#MT0     WNAMT                           127348
     C           WPRIN     SUB  WNAMT     WPRIN                           127348
      *                                                                   127348
     C           A6NBDP    WHEQ 3                                         127348
     C                     Z-ADDWAMT4     W#MT3     H                     127348
     C                     Z-ADDW#MT0     WNAMT                           127348
     C           WPRIN     SUB  WNAMT     WPRIN                           127348
      *                                                                   127348
     C           A6NBDP    WHEQ 4                                         127348
     C                     Z-ADDWAMT5     W#MT4     H                     127348
     C                     Z-ADDW#MT0     WNAMT                           127348
     C           WPRIN     SUB  WNAMT     WPRIN                           127348
      *                                                                   127348
     C           A6NBDP    WHEQ 5                                         127348
     C                     Z-ADDWAMT6     W#MT5     H                     127348
     C                     Z-ADDW#MT0     WNAMT                           127348
     C           WPRIN     SUB  WNAMT     WPRIN                           127348
      *                                                                   127348
     C                     ENDSL                                          127348
      *                                                                   127348
     C                     ENDIF                                          127348
     C                     ENDIF                                          127348
      *                                                                   127348
     C                     ENDIF                                          127348
      *                                                                   127348
     C                     ELSE                                           127348
      *                                                                   127348
     C           WPRIN     SUB  PRAMA     WPRIN
     C                     ENDIF                                          127348
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           AMTPA     IFEQ 'PI'                                      156048
     C           AMTPA     OREQ 'PT'                                      156048
     C           VDATA     IFLE WDAT                                      156048
     C                     ADD  PRAMA     WPRIN                           156048
     C                     ENDIF                                          156048
     C                     ENDIF                                          156048
      *                                                                   156048
     C                     ENDIF
     C                     READ LOAMD                    07               152625
     C                     ENDDO
      *                                                                   127348
      * Need to convert screen amount into loan amount before deducting   127348
      * from outstanding principal                                        127348
      *                                                                   127348
     C                     Z-ADDWLAMT     W#LAMT 130                      127348
      *                                                                   127348
     C           SCURR     IFNE LCCYC                                     127348
     C           *IN43     ANDEQ'0'                                       157585
      *                                                                   127348
      * Loan currency                                                     127348
     C                     MOVELLCCYC     WCURR                           127348
     C                     EXSR SRCURR                                    127348
     C                     Z-ADDA6NBDP    W#DP1                           127348
      *                                                                   127348
      * Base ccy                                                          127348
     C                     MOVELBJCYCD    WCURR                           127348
     C                     EXSR SRCURR                                    127348
     C                     MOVE A6MDIN    WMDIN                           127348
     C                     Z-ADDA6SPRT    WSPRT                           127348
      *                                                                   127348
      * Screen ccy - facility ccy                                         127348
     C                     MOVELSCURR     WCURR                           127348
     C                     EXSR SRCURR                                    127348
     C                     Z-ADDA6NBDP    WNBDP                           127348
     C                     MOVE A6MDIN    ZMDI1                           127348
     C                     Z-ADDA6SPRT    ZRATE1                          127348
     C                     MOVE WMDIN     ZMDI2                           127348
     C                     Z-ADDWSPRT     ZRATE2                          127348
     C                     EXSR ZXRATE                                    127348
      *                                                                   127348
      * Remove any decimal places                                         127348
      *                                                                   127348
     C                     MOVE *BLANKS   ZFIELD                          127348
     C                     MOVE SAMNT     ZFIELD                          127348
     C           13        SUB  A6NBDP    ZADIG                           127348
     C                     Z-ADDA6NBDP    ZADEC                           127348
     C                     EXSR ZALIGN                                    127348
     C                     MOVE ZFIELD    W#20                            127348
      *                                                                   127348
      * If currencies have same number of decimal places need to          127348
      * obtain one more decimal place for rounding purposes               127348
      *                                                                   127348
     C           W#DP1     IFEQ WNBDP                                     127348
     C                     Z-ADD5         W#DP                            127348
     C           W#20      MULT POWR,W#DP W#20                            127348
     C                     ENDIF                                          127348
      *                                                                   127348
     C           A6MDIN    IFEQ 'M'                                       127348
     C           W#20      MULT ZRATEX    W#20                            127348
     C                     ELSE                                           127348
     C           W#20      DIV  ZRATEX    W#20                            127348
     C                     ENDIF                                          127348
      *                                                                   127348
      *  Convert new amount in base currency to loan currency             127348
      *                                                                   127348
     C                     MOVELLCCYC     WCURR                           127348
     C                     EXSR SRCURR                                    127348
     C                     MOVE A6MDIN    ZMDI1                           127348
     C                     Z-ADDA6SPRT    ZRATE1                          127348
     C                     MOVE WMDIN     ZMDI2                           127348
     C                     Z-ADDWSPRT     ZRATE2                          127348
     C                     EXSR ZXRATE                                    127348
      *                                                                   127348
     C           A6MDIN    IFEQ 'M'                                       127348
     C           W#20      DIV  ZRATEX    W#20                            127348
     C                     ELSE                                           127348
     C           W#20      MULT ZRATEX    W#20                            127348
     C                     ENDIF                                          127348
      *                                                                   127348
      * If the number of decimal places between loan ccy and facility     127348
      * ccy are not equal, need to drop or add decimal places before      127348
      * deducting from outstanding principal                              127348
      *                                                                   127348
     C                     Z-ADDW#20      WAMT0                           127348
      *                                                                   127348
     C           WNBDP     IFGT A6NBDP                                    127348
      *                                                                   127348
     C           WNBDP     SUB  A6NBDP    W#NBDP                          127348
      *                                                                   127348
     C                     SELEC                                          127348
      *                                                                   127348
     C           W#NBDP    WHEQ 1                                         127348
     C                     Z-ADDWAMT1     WNAMT  130H                     127348
      *                                                                   127348
     C           W#NBDP    WHEQ 2                                         127348
     C                     Z-ADDWAMT2     WNAMT     H                     127348
      *                                                                   127348
     C           W#NBDP    WHEQ 3                                         127348
     C                     Z-ADDWAMT3     WNAMT     H                     127348
      *                                                                   127348
     C           W#NBDP    WHEQ 4                                         127348
     C                     Z-ADDWAMT4     WNAMT     H                     127348
      *                                                                   127348
     C           W#NBDP    WHEQ 5                                         127348
     C                     Z-ADDWAMT5     WNAMT     H                     127348
      *                                                                   127348
     C                     ENDSL                                          127348
      *                                                                   127348
     C                     ELSE                                           127348
      *                                                                   127348
     C           WNBDP     IFLT A6NBDP                                    127348
      *                                                                   127348
     C           A6NBDP    SUB  WNBDP     W#DP                            127348
     C                     ADD  4         W#DP                            127348
      *                                                                   127348
     C           WAMT0     MULT POWR,W#DP WNAMT                           127348
      *                                                                   127348
     C                     ELSE                                           127348
      *                                                                   127348
      * If the same number of decimal places need to round last digit     127348
      *                                                                   127348
     C                     SELEC                                          127348
      *                                                                   127348
     C           A6NBDP    WHEQ 1                                         127348
     C                     Z-ADDWAMT2     W#MT1     H                     127348
     C                     Z-ADDW#MT0     WNAMT                           127348
      *                                                                   127348
     C           A6NBDP    WHEQ 2                                         127348
     C                     Z-ADDWAMT3     W#MT2     H                     127348
     C                     Z-ADDW#MT0     WNAMT                           127348
      *                                                                   127348
     C           A6NBDP    WHEQ 3                                         127348
     C                     Z-ADDWAMT4     W#MT3     H                     127348
     C                     Z-ADDW#MT0     WNAMT                           127348
      *                                                                   127348
     C           A6NBDP    WHEQ 4                                         127348
     C                     Z-ADDWAMT5     W#MT4     H                     127348
     C                     Z-ADDW#MT0     WNAMT                           127348
      *                                                                   127348
     C           A6NBDP    WHEQ 5                                         127348
     C                     Z-ADDWAMT6     W#MT5     H                     127348
     C                     Z-ADDW#MT0     WNAMT                           127348
      *                                                                   127348
     C                     ENDSL                                          127348
      *                                                                   127348
     C                     ENDIF                                          127348
     C                     ENDIF                                          127348
     C                     Z-ADDWNAMT     WLAMT                           127348
     C                     ENDIF                                          127348
      *
     C           SACTN     IFNE 'X'                                       151295
     C           WLAMT     IFGT WPRIN
     C           WLAMT     ANDNEWAMNT                                     142398
     C                     MOVE *ON       *IN44
     C***********          MOVEL'LES0156' ZAMSID                          142398
     C***********          MOVE 'E'       WMSEV                           142398
     C                     MOVEL'LES0157' ZAMSID                          142398
     C                     MOVE 'W'       WMSEV                           142398
     C                     MOVE 'W'       WXPAS                           142398
     C                     EXSR SREROR
     C                     ENDIF
     C***********WLAMT     IFEQ WAMNT                              142398 157209
     C***********          MOVE ' '       WERRF                    142398 157209
     C***********          MOVE ' '       WMSEV                    142398 157209
     C***********          MOVE '0'       *IN44                    142398 157209
     C***********          ENDIF                                   142398 157209
     C                     Z-ADDWLAMT     WAMNT  130                      142398
      *                                                                                       CLE036
      ** If repayment was inserted in facility currency,                                      CLE036
      ** convert to loan currency amount for update of file                                   CLE036
     C           FREPAY    IFEQ 'Y'                                                           CLE036
     C           SCURR     ANDNELCCYC                                                         CLE036
     C                     EXSR FRCONV                                                        CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     Z-ADDW#LAMT    WLAMT                           127348
     C                     ENDIF                                          151295
      *
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate Auto settle indicator
      *
     C                     MOVE SAUTO     WAUTOS  1                                           CLE134
     C           WAUTOS    IFEQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C           SACTN     IFEQ 'I'                                                         AR693137
     C           SACTN     OREQ 'A'                                                         AR693137
     C                     SELEC                                                            AR693137
      *                                                                                     AR693137
      ** Autosettle cannot be 'C' for processing type other than                            AR693137
      ** 61, 62, 64, 68 and 80.                                                             AR693137
      *                                                                                     AR693137
     C           PTYP      WHEQ 61                                                          AR693137
     C           PTYP      ANDNE62                                                          AR693137
     C           PTYP      ANDNE64                                                          AR693137
     C           PTYP      ANDNE68                                                          AR693137
     C           PTYP      ANDNE80                                                          AR693137
     C                     MOVE *ON       *IN45                                             AR693137
     C                     MOVEL'LES0614' ZAMSID                                            AR693137
     C                     MOVE 'E'       WMSEV                                             AR693137
     C                     EXSR SREROR                                                      AR693137
      *                                                                                     AR693137
      ** Autosettle cannot be 'C' if settlement methods are not equal                       AR693137
      ** to 01, 05, 08 and 14.                                                              AR693137
      *                                                                                     AR693137
     C           PTYP      WHEQ 80                                                          AR693137
     C           PMPSTM    IFNE 01                                                          AR693137
     C           PMPSTM    ANDNE05                                                          AR693137
     C           PMPSTM    ANDNE08                                                          AR693137
     C           PMPSTM    ANDNE14                                                          AR693137
     C                     MOVE *ON       *IN45                                             AR693137
     C                     MOVEL'LER5595' ZAMSID                                            AR693137
     C                     MOVE 'E'       WMSEV                                             AR693137
     C                     EXSR SREROR                                                      AR693137
     C                     ENDIF                                                            AR693137
     C           PTYP      WHEQ 61                                                          AR693137
     C           PTYP      OREQ 62                                                          AR693137
     C           PTYP      OREQ 64                                                          AR693137
     C           PTYP      OREQ 68                                                          AR693137
     C           PMRSTM    IFNE 01                                                          AR693137
     C           PMRSTM    ANDNE05                                                          AR693137
     C           PMRSTM    ANDNE08                                                          AR693137
     C           PMRSTM    ANDNE14                                                          AR693137
     C                     MOVE *ON       *IN45                                             AR693137
     C                     MOVEL'LER5594' ZAMSID                                            AR693137
     C                     MOVE 'E'       WMSEV                                             AR693137
     C                     EXSR SREROR                                                      AR693137
     C                     ENDIF                                                            AR693137
     C                     OTHER                                                            AR693137
     C                     MOVE 'Y'       WAUTOS                                            AR693137
     C                     ENDSL                                                            AR693137
     C                     ELSE                                                             AR693137
     C                     MOVE 'Y'       WAUTOS                                              CLE134
     C                     ENDIF                                                            AR693137
      *                                                                                     AR693137
     C                     ENDIF                                                              CLE134
     C           SAUTO     IFEQ *BLANK
     C                     MOVE AUTOC     SAUTO
     C                     ELSE
     C********** SAUTO     IFNE 'Y'                                                           CLE134
     C           WAUTOS    IFNE 'Y'                                                           CLE134
     C           SAUTO     ANDNE'N'
     C                     MOVE *ON       *IN45
     C                     MOVEL'LES0061' ZAMSID
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CLE034
      ** Validate Settlement Allocation                                                       CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
      *                                                                                       CLE034
     C           SSTAL     IFEQ *BLANK                                                        CLE034
     C***********          MOVE STALC     SSTAL                                               CLE034
     C                     MOVE 'N'       SSTAL                                               CLE034
     C                     ELSE                                                               CLE034
     C           SSTAL     IFNE 'Y'                                                           CLE034
     C           SSTAL     ANDNE'N'                                                           CLE034
     C                     MOVE *ON       *IN46                                               CLE034
     C                     MOVEL'LES0062' ZAMSID                                              CLE034
     C                     MOVE 'E'       WMSEV                                               CLE034
     C                     EXSR SREROR                                                        CLE034
     C                     ENDIF                                                              CLE034
     C                     MOVE SSTAL     STALK                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *
     C           WERRF     IFEQ ' '
     C                     EXSR SRSETT
      *
     C           PMERCD    IFNE *BLANKS
     C           PMODE     IFEQ 'I'                                       123801
     C           PMODE     OREQ 'R'                                       123801
     C                     MOVEL'LES0999' ZAMSID
     C                     ELSE                                           123801
     C           3         SUBSTPMERCD:1  WSERR   3                       123801
     C                     MOVEL'ESM0'    ZAMSID                          123801
     C                     MOVE WSERR     ZAMSID                          123801
     C                     MOVEL'DRSMM   'ZAMSGF                          123801
     C                     ENDIF                                          123801
     C                     MOVE 'E'       WMSEV
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
      ** Additional validation - check holiday against nostro locn
      *
     C           WERRF     IFEQ ' '
     C                     EXSR SRAVAL
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRSETT  -  Settlements screen                                 *
      * Called by: SRDETL - Process detail screen                     *
      *            SRVAL2 - Validate detail screen                    *
      * Calls    : SRFXST - Error processing                          *
      *            SRSETL - Set up data received from SD2400          *
      *            SD2400 - SD Extended settlements                   *
      *                                                               *
      *****************************************************************
      *
     C           SRSETT    BEGSR
      *
      ** Set up settlement details on first time pass
      *
     C           WPASS     IFEQ 'Y'
     C           WSDTV     OREQ 'N'
      *
      ** Settlement details should be initialized only on first pass.     187559
      *                                                                   187559
     C           *IN70     IFEQ '0'                                       187559
     C                     EXSR SRFXST
     C                     ENDIF                                          187559
      *                                                                   187559
     C                     EXSR SRCLRS
     C                     MOVE *BLANKS   PMTERM
     C                     Z-ADD0         PMDBSE
     C***********          MOVE *OFF      *INKN                    172288 172706
      *
     C           SEENSL    IFNE 'Y'                                       172706
     C           *INKN     OREQ *ON                                       172706
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
      ** For inserts, the loan amendment sequence number can be zero.                         CLE034
      ** This is not a problem. The first settlement allocation record                        CLE034
      ** written by LE2230 will be given a timestamp and used on all                          CLE034
      ** the other settlement allocation records.                                             CLE034
      *                                                                                       CLE034
     C           SSEQN     IFEQ *BLANKS                                                       CLE034
     C           SSEQN     OREQ *ZEROS                                                        CLE034
      *                                                                                       CLE034
     C                     MOVEL'Y'       WNKEY   1                                           CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
     C                     MOVE WVDAYN    PVDAT   5                                           CLE034
      *                                                                                       CLE034
     C                     CALL 'LE2230'                                                      CLE034
     C                     PARM 'LARE'    PTYPE   4                                           CLE034
     C                     PARM           SLOAN                                               CLE034
     C                     PARM           PVDAT                                               CLE034
     C                     PARM           SSEQN                                               CLE034
     C                     PARM *BLANKS   PCNUM   6                                           CLE034
     C                     PARM *BLANKS   PFACL   5                                           CLE034
     C                     PARM *BLANKS   PFESQ   2                                           CLE034
     C                     PARM           SETLIB                                              CLE034
     C                     PARM           SETLIZ                                              CLE034
     C                     PARM           PMODE                                               CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM *BLANKS   PERRF   1                                           CLE034
     C                     PARM *BLANKS   PWARN   1                                           CLE034
     C                     PARM *BLANKS   PSNOS   1                                           CLE034
     C                     PARM *BLANKS   PSAMD   1                                           CLE034
     C                     PARM *BLANKS   PNDET   1                                           CLE034
     C                     PARM *BLANKS   PRCCY  60                                           CLE034
     C                     PARM *BLANKS   PRLOC  60                                           CLE034
     C                     PARM *BLANKS   PPCCY  60                                           CLE034
     C                     PARM *BLANKS   PPLOC  60                                           CLE034
     C                     PARM           PCRFK                                               CLE034
     C                     PARM *BLANKS   PORED   5                                           CLE038
     C                     PARM *ZERO     PAAMT  130                                          CLE038
      *                                                                                       219152
     C                     MOVE 'Y'       SEENSL  1                                           219152
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C/COPY WNCPYSRC,LE2120C002
     C                     CALL 'SD2400'
     C                     PARM           PRCODE  7
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C**********           PARM           PSLNRF  6                                           214643
     C                     PARM           SLOAN                                               214643
     C                     PARM           @PARM3                          222373
     C                     MOVE 'Y'       SEENSL  1                       172706
     C/COPY WNCPYSRC,LE2120C003
      *
     C                     ELSE
      *
      ** Set up fields on call to SD2410 for settlement validation
      ** Process settlement branch only if method 05 and multibranching
      *
     C           BGMBIN    IFEQ 'Y'
     C           PMRSTM    IFNE 05
     C           PMPRCV    IFEQ 'N'
     C           PMACTC    ORNE 'A'
     C                     MOVE *BLANKS   PMROBR
     C                     ENDIF
     C                     ENDIF
      *
     C           PMPSTM    IFNE 05
     C           PMPPAY    IFEQ 'N'
     C           PMACTC    ORNE 'A'
     C                     MOVE *BLANKS   PMPOBR
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C/COPY WNCPYSRC,LE2120C004
     C                     CALL 'SD2410'
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           @PARM3                          222373
     C/COPY WNCPYSRC,LE2120C005
     C                     ENDIF
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                          172706
     C                     MOVE *OFF      *INKN                           172706
      *
      ** If database error terminate processing
      *
     C           PMDBSE    IFNE 0
     C           *LOCK     IN   LDA
     C                     MOVELPMDBFL    DBFILE           ************
     C                     Z-ADDPMDBSE    DBASE            * DBERR XX *
     C                     MOVELPMDBKY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** F3 - Exit
      *
     C           PMCMDP    IFEQ '03'
     C                     MOVE *ON       *INKC
     C           PMODE     IFNE 'B'                                                           227710
     C           PMODE     ANDNE'P'                                                           227710
     C                     ROLBK                                                              227710
     C                     ENDIF                                                              227710
     C                     ENDIF
      *
      ** F12 - Previous
      *
     C           PMCMDP    IFEQ '12'
     C           PMODE     OREQ 'P'
     C           PMODE     OREQ 'B'
     C           PMCMDP    OREQ *BLANK                                    187559
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           PMSDTV    ANDEQ'N'                                                           CLE034
     C           PMERCD    ANDEQ*BLANKS                                                       CLE034
     C                     MOVE 'N'       SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
      *
     C/COPY WNCPYSRC,LE2120C018
     C                     MOVE 'N'       WPASS
     C                     MOVE 'N'       PMFRST
      *
     C           SACTN     IFEQ 'X'
     C                     MOVE 'Y'       WPASS
      *                                                                   151295
      ** Output warning if overpayment has been done on authorisation     151295
      *                                                                   151295
     C           WLAMT     IFGT WPRIN                                     151295
     C                     MOVE '1'       *IN44                           151295
     C                     MOVEL'LES0157' ZAMSID                          151295
     C                     MOVE 'W'       WMSEV                           151295
     C                     MOVE 'W'       WXPAS                           151295
     C                     EXSR SREROR                                    151295
     C                     MOVE ' '       WERRF                           151295
     C                     ENDIF                                          151295
     C/COPY WNCPYSRC,LE2120C029
      *                                                                   148624
      ** Put out detail screen again - must then press enter              148624
      ** to authorise.                                                    148624
      *                                                                   148624
     C                     WRITELE2120C1                                  148624
     C                     WRITELE2120F4                                  148624
     C                     EXFMTLE2120F3                                  148624
      *                                                                   148624
      ** Check Cmd keys                                                   148624
      *                                                                   148624
     C                     SELEC                                          148624
     C           *INKC     WHEQ *ON                        F3             148624
     C                     MOVE 'N'       WPASS                           148624
      *                                                                   148624
     C           *INKL     WHEQ *ON                        F12            148624
     C                     MOVE 'N'       WPASS                           148624
     C                     MOVE 'N'       WSDTV                           148624
     C                     MOVE 'Y'       @F12A                           148624
      *                                                                   148624
      *  If F14 is pressed from detail screen, User wants                 172288
      *   to view the settlement instructions screen again                172288
     C           *INKN     WHEQ *ON                        F14            172288
     C                     MOVE 'N'       WPASS                           172288
     C                     MOVE 'N'       WSDTV                           172288
     C                     MOVE 'N'       SEENSL                          172706
      *                                                                   172288
     C                     OTHER                                          148624
     C                     MOVE 'Y'       WPASS                           148624
     C                     MOVE 'Y'       @ENTA            Enter          148624
     C                     ENDSL                                          148624
     C/COPY WNCPYSRC,LE2120C030
      *                                                                   148624
     C                     ENDIF
      *
      * If user is amending or inputting a repayment schedule,            172288
     C           PMODE     IFNE 'B'                        Not Batch Mode 181357
     C           SACTN     IFEQ 'I'                                       172288
     C           SACTN     OREQ 'A'                                       172288
      *                                                                   172288
      * If user didnt validate settlement details before pressing F12     172288
     C           PMSDTV    ANDEQ'N'                                       172288
     C                     MOVE 'Y'       WPASS                           172288
     C                     MOVE 'N'       WSDTV                           172288
      *                                                                   172288
      ** Put out previous detail screen - User must then press enter      172288
      ** again to update files.                                           172288
      *                                                                   172288
     C                     MOVE SCRFLD    SAVSCR                          187559
     C                     WRITELE2120C1                                  172288
     C                     WRITELE2120F4                                  172288
     C                     EXFMTLE2120F3                                  172288
      *                                                                   172288
      ** What command key did user press in detail screen?                172288
      *                                                                   172288
     C                     SELEC                                          172288
     C           *INKC     WHEQ *ON                        F3             172288
     C                     MOVE 'N'       WPASS                           172288
      *                                                                   172288
     C           *INKL     WHEQ *ON                        F12            172288
     C                     MOVE 'N'       WPASS                           172288
     C                     MOVE 'N'       WSDTV                           172288
     C                     MOVE 'Y'       @F12A                           172288
      *                                                                   172288
     C           *INKN     WHEQ *ON                        F14            172288
     C                     MOVE 'N'       WPASS                           172288
     C                     MOVE 'N'       WSDTV                           172288
      *                                                                   172288
     C                     OTHER                           Enter          172288
      *                                                                   187559
     C           SCRFLD    IFEQ SAVSCR                                    187559
     C                     MOVE 'Y'       WPASS                           172288
     C                     ELSE                                           187559
     C                     MOVE 'N'       WPASS                           187559
     C                     MOVE 'N'       WSDTV                           187559
     C                     MOVE '1'       *IN53                           187559
     C                     ENDIF                                          187559
      *                                                                   187559
     C                     ENDSL                                          172288
      *                                                                   172288
     C                     ENDIF                                          172288
     C                     ENDIF                                          181357
      *                                                                   172288
     C           WPASS     IFEQ 'Y'                                       148624
     C           WSDTV     OREQ 'N'                                       148624
     C           *INKL     ANDEQ*OFF                                      148624
     C           *INKN     ANDEQ*OFF                                      172288
     C           *IN53     ANDEQ'0'                                       187559
      *                                                                   148624
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C           SACTN     OREQ 'X'
      *
     C           PMSDTV    IFEQ 'Y'
     C           PMSDTV    OREQ 'N'
     C           PMERCD    ANDEQ*BLANKS
     C                     EXSR SRSETL
     C                     MOVE 'Y'       WSDTV
     C                     ENDIF
      *
     C           PMERCD    IFNE *BLANKS
     C                     MOVE 'N'       WSDTV   1
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                          148624
      *                                                                   148624
      **   Settlement instructions blank, take special instructions
      **   from CLOAN if processing type is 66
      **   or processing type is 69 when CLE005 is installed              CLE005
      *
     C           WSDTV     IFEQ 'Y'
      *
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
      *
     C           NEWSET    IFEQ *BLANKS
     C           PTYPC     ANDEQ66
     C           NEWSET    OREQ *BLANKS                                   CLE005
     C           PTYPC     ANDEQ69                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
      *
     C                     MOVE 'B'       WCRCDT
     C                     MOVE LNRF      WCLOAN
     C                     MOVE 'B'       WCLKEY
     C                     MOVELLNRF      WCLKEY  7
      *
     C           WKLON     CHAINCLOAN               N02
     C           *IN02     IFEQ *ON
     C                     MOVEL'CLOAN'   DBFILE           ************
     C                     Z-ADD15        DBASE            * DBERR 15 *
     C                     MOVELWCLKEY    DBKEY            ************
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVE SPI1K     SSPI1
     C                     MOVE SPI2K     SSPI2
     C                     MOVE SPI3K     SSPI3
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      * SRAVAL  -  Additional Validation Dependent on Settlement Ins. *
      * Called by: SRVAL2 - Validate detail screen                    *
      * Calls    : ZCHKH  - Check holiday                             *
      *            SREROR - Error processing                          *
      *                                                               *
      *****************************************************************
      *
     C           SRAVAL    BEGSR
      *                                                                                       CLE034
      ** Restructure SR/SRAVAL for CLE034.                                                    CLE034
      *                                                                                       CLE034
      **********                                                                              CLE034
      ***Check*that value date is not a holiday in the deal / local CCY                       CLE034
      **********                                                                              CLE034
     C********** WTYPE     IFNE '00'                                                          CLE034
     C********** WTYPE     ANDNE'  '                                                          CLE034
      **********                                                                              CLE034
     C**********           Z-ADDWVDAYN    ZDAYNO                                              CLE034
      **********                                                                              CLE034
      ***Find*currency to use                                                                 CLE034
      **********                                                                              CLE034
     C********** WTYPE     IFEQ '01'                                                          CLE034
     C********** WTYPE     OREQ '07'                                                          CLE034
     C********** WTYPE     OREQ '08'                                                          CLE034
      **********                                                                       CEU004 CLE034
     C********** CEU004    IFEQ 'Y'                                                    CEU004 CLE034
     C********** WSCCY     ANDNE*BLANKS                                                CEU004 CLE034
     C**********           MOVE WSCCY     ZCCY                                         CEU004 CLE034
     C**********           ELSE                                                        CEU004 CLE034
     C**********           MOVE SCURR     ZCCY                                                CLE034
     C**********           ENDIF                                                       CEU004 CLE034
      **********                                                                       CEU004 CLE034
     C**********           ELSE                                                               CLE034
     C**********           MOVE BJLCCY    ZCCY                                                CLE034
     C**********           ENDIF                                                              CLE034
      **********                                                                              CLE034
      ***If*date is holiday send warning messages                                             CLE034
      **********                                                                              CLE034
     C**********           Z-ADD0         ZNRDYS                                              CLE034
     C**********           EXSR ZCHKH                                                         CLE034
      **********                                                                              CLE034
     C********** WTYPE     IFEQ '01'                                                          CLE034
     C********** WTYPE     OREQ '07'                                                          CLE034
     C********** WTYPE     OREQ '08'                                                          CLE034
      **********                                                                              CLE034
     C********** ZIND      IFEQ 'H'                                                           CLE034
      **********                                                                       CEU004 CLE034
     C********** CEU004    IFEQ 'Y'                                                    CEU004 CLE034
     C**********           MOVEL'LES0307' ZAMSID                                       CEU004 CLE034
     C**********           ELSE                                                        CEU004 CLE034
     C**********           MOVEL'LES0051' ZAMSID                                              CLE034
     C**********           ENDIF                                                       CEU004 CLE034
      **********                                                                       CEU004 CLE034
     C**********           MOVE 'W'       WMSEV                                               CLE034
     C**********           EXSR SREROR                                                        CLE034
     C**********           ENDIF                                                              CLE034
     C**********           ELSE                                                               CLE034
      **********                                                                              CLE034
     C********** ZIND      IFEQ 'H'                                                           CLE034
     C**********           MOVEL'LES0052' ZAMSID                                              CLE034
     C**********           MOVE 'W'       WMSEV                                               CLE034
     C**********           EXSR SREROR                                                        CLE034
     C**********           ENDIF                                                              CLE034
     C**********           ENDIF                                                              CLE034
      **********                                                                              CLE034
     C********** ZIND      IFEQ 'H'                                                    187559 CLE034
     C**********           MOVE '1'       *IN70                                        187559 CLE034
     C**********           ELSE                                                        187559 CLE034
     C**********           MOVE '0'       *IN70                                        187559 CLE034
     C**********           ENDIF                                                       187559 CLE034
      **********                                                                       187559 CLE034
     C********** WMSEV     IFEQ 'W'                                                           CLE034
     C**********           MOVE *ON       *IN42                                               CLE034
     C**********           MOVE ' '       WERRF                                               CLE034
     C**********           ENDIF                                                              CLE034
     C**********           ENDIF                                                              CLE034
      *
     C           WTYPE     IFNE '00'                                                          CLE034
     C           WTYPE     ANDNE' '                                                           CLE034
     C           CLE034    ANDEQ'N'                                                           CLE034
     C           CLE034    OREQ 'Y'                                                           CLE034
     C           WTYPE     ANDNE'00'                                                          CLE034
     C           SSTAL     ANDNE'Y'                                                           CLE034
     C           CLE034    OREQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
     C           PNDET     ANDNE'Y'                                                           CLE034
      *                                                                                       CLE034
      ** Set ZDAYNO to WVDAYN                                                                 CLE034
      *                                                                                       CLE034
     C                     Z-ADDWVDAYN    ZDAYNO                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           PTYPC     IFEQ 66                                                            CLE034
     C           PTYPC     OREQ 69                                                            CLE034
     C           PTYPC     OREQ 72                                                            CLE034
     C                     MOVEAPPCCY     ACUR                                                CLE034
     C                     MOVEAPPLOC     ALOC                                                CLE034
     C                     ELSE                                                               CLE034
     C                     MOVEAPRCCY     ACUR                                                CLE034
     C                     MOVEAPRLOC     ALOC                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE *ON       *IN97                                               CLE034
     C                     MOVEAACUR      WACUR  60                                           CLE034
     C           WACUR     IFEQ *BLANKS                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE BJSLCD    ALOC,1                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
      ** Find currency to use                                                                 CLE034
      *                                                                                       CLE034
     C           WTYPE     IFEQ '01'                                                          CLE034
     C           WTYPE     OREQ '07'                                                          CLE034
     C           WTYPE     OREQ '08'                                                          CLE034
      *                                                                                       CLE034
     C                     MOVE *ON       *IN97                                               CLE034
     C           CEU004    IFEQ 'Y'                                                           CLE034
     C           WSCCY     ANDNE*BLANK                                                        CLE034
     C                     MOVE WSCCY     ZCCY                                                CLE034
     C                     MOVE WSCCY     ACUR,1                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE SCURR     ACUR,1                                              CLE034
     C                     MOVE *BLANKS   ALOC,1                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE BJSLCD    ALOC,1                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Initialise holiday field.                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE *BLANK    WHDAY   1                                           CLE034
      *                                                                                       CLE034
      ** If CLE034 is off or CLE034 is on but Settlement allocation is                        CLE034
      ** not 'Y'.                                                                             CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'N'                                                           CLE034
     C           CLE034    OREQ 'Y'                                                           CLE034
     C           SSTAL     ANDNE'Y'                                                           CLE034
      *                                                                                       CLE034
     C           WTYPE     IFEQ '01'                                                          CLE034
     C           WTYPE     OREQ '07'                                                          CLE034
     C           WTYPE     OREQ '08'                                                          CLE034
     C                     MOVE 'Y'       WHDAY                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** If CLE034 is on and Settlement allocation is 'Y'                                     CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
     C           PSNOS     IFEQ 'Y'                                                           CLE034
     C                     MOVE 'Y'       WHDAY                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD1         WX      20                                          CLE034
     C           WX        DOWLE20                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE ACUR,WX   ZCCY                                                CLE034
     C                     MOVE ALOC,WX   ZLOC                                                CLE034
     C           ZCCY      IFNE *BLANKS                                                       CLE034
      *                                                                                       CLE034
     C                     Z-ADD0         ZNRDYS                                              CLE034
     C                     EXSR ZCHKH                                                         CLE034
      *                                                                                       CLE034
      ** If WHDAY = 'Y'                                                                       CLE034
      *                                                                                       CLE034
     C           WHDAY     IFEQ 'Y'                                                           CLE034
      *                                                                                       CLE034
     C           ZIND      IFEQ 'H'                                                           CLE034
     C           CEU004    IFEQ 'Y'                                                           CLE034
     C                     MOVEL'LES0307' ZAMSID                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVEL'LES0051' ZAMSID                                              CLE034
     C                     MOVE 'W'       WMSEV                                               CLE034
     C                     EXSR SREROR                                                        CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
     C                     ELSE                                                               CLE034
     C           ZIND      IFEQ 'H'                                                           CLE034
     C                     MOVEL'LES0052' ZAMSID                                              CLE034
     C                     MOVE 'W'       WMSEV                                               CLE034
     C                     EXSR SREROR                                                        CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
     C*                    ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Increment counter                                                                    CLE034
      *                                                                                       CLE034
     C           WX        ADD  1         WX                                                  CLE034
      *                                                                                       CLE034
     C           ZIND      IFEQ 'H'                                                           CLE034
     C                     MOVE '1'       *IN70                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE '0'       *IN70                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WMSEV     IFEQ 'W'                                                           CLE034
     C                     MOVE *ON       *IN42                                               CLE034
     C                     MOVE ' '       WERRF                                               CLE034
     C                     ENDIF                                                              CLE034
     C*                    ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSETL  -  Set Up Data Received from SD2400                   *
      * Called by: SRSETT - Settlements screen                        *
      * Calls    : none                                               *
      *                                                               *
      *****************************************************************
      *
     C           SRSETL    BEGSR
      *
      ** Move settlement details received from SD2400 to variables
      *
     C***********PTYP      IFEQ 66                                        148730
     C           PTYPC     IFEQ 66                                        148730
     C           CLE005    OREQ 'Y'                                       CLE005
     C***********PTYP      ANDEQ69                                 CLE005 148730
     C           PTYPC     ANDEQ69                                        148730
     C           CLE005    OREQ 'Y'                                                           197083
     C           PTYPC     ANDEQ72                                                            197083
     C                     MOVELPMPSTM    WSETP   2
     C**********           MOVELPMPONS    WOSAC  12                                          BUG2117
     C                     MOVELPMPONS    WOSAC                                              BUG2117
     C                     MOVELPMPOBR    WOBBR   3
     C                     MOVELPMPOBR    WOSBR   3
     C                     MOVELPAPIBN    WTSEN  10
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE PMPSCY    WSCCY   3                       CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PMPEXI    PEXIK                                               CLE031
     C                     MOVE *BLANKS   WSCCY                                               CLE031
     C                     MOVE *BLANKS   PSCRF                                               CLE031
     C                     MOVE PMPSCY    PSCYK                                               CLE031
      *                                                                                       CLE031
     C                     Z-ADD8         PNDEC                                               CLE031
     C                     Z-ADD5         PNDIG                                               CLE031
     C                     MOVE PMPEXR    PSCRF                                               CLE031
      *                                                                                       CLE031
     C           PMPEXR    IFNE *BLANKS                                                       CLE031
     C                     CALL 'ZALIGN'                                                      CLE031
     C                     PARM *BLANK    PRTCD                                               CLE031
     C                     PARM           PSCRF  16                                           CLE031
     C                     PARM           PNDEC   10                                          CLE031
     C                     PARM           PNDIG   20                                          CLE031
     C                     PARM *BLANKS   PRVAL  16                                           CLE031
      *                                                                                       CLE031
     C           PRTCD     IFEQ *BLANK                                                        CLE031
     C                     MOVE PRVAL     PMPEXC                                              CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE PMPEXC    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMPEXR                                              CLE031
     C                     ELSE                                                               CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'ZALIGN  'DBFILE                                              CLE031
     C                     Z-ADD34        DBASE                                               CLE031
     C                     MOVELPSCRF     DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ELSE
     C                     MOVELPMRSTM    WSETP   2
     C**********           MOVELPMRONS    WOSAC  12                                          BUG2117
     C                     MOVELPMRONS    WOSAC                                              BUG2117
     C                     MOVELPMROBR    WOBBR   3
     C                     MOVELPMROBR    WOSBR   3
     C                     MOVELPARIBN    WTSEN  10
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE PMRSCY    WSCCY   3                       CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PMREXI    REXIK                                               CLE031
     C                     MOVE *BLANKS   WSCCY                                               CLE031
     C                     MOVE *BLANKS   PSCRF                                               CLE031
     C                     MOVE PMPSCY    PSCYK                                               CLE031
     C                     Z-ADD8         PNDEC                                               CLE031
     C                     Z-ADD5         PNDIG                                               CLE031
      *                                                                                       CLE031
     C           PMREXR    IFNE *BLANKS                                                       CLE031
     C                     MOVE PMREXR    PSCRF                                               CLE031
     C                     CALL 'ZALIGN'                                                      CLE031
     C                     PARM *BLANK    PRTCD                                               CLE031
     C                     PARM           PSCRF  16                                           CLE031
     C                     PARM           PNDEC   10                                          CLE031
     C                     PARM           PNDIG   20                                          CLE031
     C                     PARM *BLANKS   PRVAL  16                                           CLE031
      *                                                                                       CLE031
     C           PRTCD     IFEQ *BLANK                                                        CLE031
     C                     MOVE PRVAL     PMREXR                                              CLE031
     C                     ELSE                                                               CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'ZALIGN  'DBFILE                                              CLE031
     C                     Z-ADD35        DBASE                                               CLE031
     C                     MOVELPSCRF     DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     END
      *
     C                     MOVELPABENN    WFACO  10
     C                     MOVE WSETP     WTYPE   2
      *
      ** Move to numeric field to initialize file fields to zero in
      ** case input is blank
      *
     C**********           MOVE PAROBN    WROBN   60                                          CSD027
     C**********           MOVE PAROCN    WROCN   60                                          CSD027
     C**********           MOVE PAPOBN    WPOBN   60                                          CSD027
     C**********           MOVE PAPOCN    WPOCN   60                                          CSD027
     C                     MOVE PAROBN    WROBN   6                                           CSD027
     C                     MOVE PAROCN    WROCN   6                                           CSD027
     C                     MOVE PAPOBN    WPOBN   6                                           CSD027
     C                     MOVE PAPOCN    WPOCN   6                                           CSD027
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRFXST  -  Format settlement details                          *
      * Called by: SRSETT - Settlements screen                        *
      * Calls    : SRINTI - Initialise settlement detail for insert   *
      *            SRMFSC - Move file values to settlement screen     *
      *                                                               *
      *****************************************************************
      *
     C           SRFXST    BEGSR
      *
     C           WPASS     IFEQ 'Y'
      *
      ** Setup details for settlement screen if first time pass through
      ** extended settlement screen
      *
      ** ... retail function flags
      *
     C           BGRTBN    IFEQ 'Y'
     C                     MOVE 'Y'       PMRETP
     C                     ENDIF
     C           BMRANR    IFEQ 'Y'
     C                     MOVE 'Y'       PMRETS
     C                     ENDIF
     C                     MOVE SACTN     PMACTC
      *
     C           SACTN     IFEQ 'R'
     C                     MOVE 'D'       PMACTC
     C                     END
     C           SACTN     IFEQ 'X'
     C                     MOVE 'E'       PMACTC
     C                     END
      *
     C***********          MOVE 'MMLD'    PMCPGM                          135152
     C                     MOVE 'LEND'    PMCPGM                          135152
     C                     Z-ADD0         PMDBSE
     C                     MOVE *BLANKS   PMERCD
     C                     MOVE 'Y'       PMFRST
     C                     Z-ADDBJRDNB    PMRUND
     C                     Z-ADDBJBVPD    PMBVPD
      *
     C                     MOVE 'RE'      PMTTYP
     C***********          MOVE SCNUM     PMCSNM                          142392
     C                     MOVELSCUST     PMCSNM                          142392
     C                     MOVE SCURR     PMRCCY
     C                     MOVE SCURR     PMPCCY
     C           FREPAY    IFEQ 'Y'                                                           CLE036
     C                     MOVE LCCYC     PMRCCY                                              CLE036
     C                     MOVE LCCYC     PMPCCY                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     Z-ADDWVDAYN    PMDTRC
     C                     Z-ADDWVDAYN    PMDTPY
     C                     MOVE BRCA      PMBRCA
      *
      ** Determine if pay & receive settlement screen will be
      ** protected
      *
     C           SACTN     IFEQ 'E'
     C           SACTN     OREQ 'R'
     C           SACTN     OREQ 'X'
     C                     MOVE 'Y'       PMPRCV
     C                     MOVE 'Y'       PMPPAY
      *
     C                     ELSE
      *
     C           PTYPC     IFEQ 66
     C           CLE005    OREQ 'Y'                                       CLE005
     C           PTYPC     ANDEQ69                                        CLE005
     C           CLE005    OREQ 'Y'                                                           197083
     C           PTYPC     ANDEQ72                                                            197083
     C                     MOVE 'Y'       PMPRCV
     C                     MOVE 'N'       PMPPAY
     C                     ELSE
     C                     MOVE 'N'       PMPRCV
     C                     MOVE 'Y'       PMPPAY
     C                     END
     C                     END
      *
     C           SACTN     IFEQ 'I'
     C           PMODE     ANDEQ'I'
     C           SACTN     OREQ 'I'
     C           PMODE     ANDEQ'R'
     C                     EXSR SRINTI
     C                     ELSE
     C                     EXSR SRMFSC
     C                     END
      *
     C                     MOVE *BLANK    PMFFND
     C                     MOVE *BLANK    PMCMDP
      *
      ** Validation only flag
      *
     C           PMFRST    IFEQ 'N'
     C                     MOVE 'Y'       PMVALO
     C                     ELSE
     C                     MOVE 'N'       PMVALO
     C                     END
      *
      ** Settlement detail valid flag
      *
     C           SACTN     IFEQ 'E'
     C           SACTN     OREQ 'R'
     C           SACTN     OREQ 'X'
     C                     MOVE 'Y'       PMSDTV
     C                     ELSE
     C                     MOVE 'N'       PMSDTV
     C                     END
      *
     C                     ENDIF
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRINTI  -  Initialise settlement details for insert           *
      * Called by: SRFXST - Format extended settlement fields         *
      * Calls    : SRSNAM - Move cust no to shortname counterpart     *
      *                                                               *
      *****************************************************************
      *
     C           SRINTI    BEGSR
      *
      ***For*insert*default*settlement*screen*to*that*of*the*loan         142392
      ***action*has*to*be*an*amend*upon*entry*to*SD2400*for*the**         142392
      ***default*fields*to*be*displayed**************************         142392
      ***********************************************************         142392
      **  Call to access object if extended settlement instructions       142392
      *   exist.                                                          142392
     C                     MOVE 'N'       EXDTA   1                       142392
      *                                                                   143071
      ** Use original borrower if loan is parts purch                     143071
      *                                                                   143071
     C           PTYPC     IFEQ 64                                        143071
     C           PTYPC     OREQ 65                                        143071
     C           PTYPC     OREQ 68                                        143071
     C           PTYPC     OREQ 71                                        143071
     C                     MOVELOLNO      @CUST                           143071
     C                     ELSE                                           143071
     C                     MOVELBBCUST    @CUST                           142392
     C                     ENDIF                                          143071
      *                                                                   143071
     C                     MOVELSCURR     @CYCD                           142392
     C                     MOVEL'LE'      @TRTY                           142392
      *                                                                   142392
     C                     CALL 'AOEXSTR0'                                142392
     C                     PARM *BLANKS   @RTCD   7                       142392
     C                     PARM '*KEY   ' @OPTN   7                       142392
     C                     PARM           @CYCD   3                       142392
     C                     PARM           @CUST   6                       142392
     C                     PARM           @TRTY   2                       142392
     C           SDEXST    PARM SDEXST    DSSDY                           142392
      *                                                                   142392
     C           @RTCD     IFNE *BLANKS                                   142392
      *                                                                   142392
     C                     MOVE 'AT'      @TRTY                           142392
     C                     CALL 'AOEXSTR0'                                142392
     C                     PARM *BLANKS   @RTCD                           142392
     C                     PARM '*KEY   ' @OPTN                           142392
     C                     PARM           @CYCD   3                       142392
     C                     PARM           @CUST   6                       142392
     C                     PARM           @TRTY   2                       142392
     C           SDEXST    PARM SDEXST    DSSDY                           142392
      *                                                                   142392
     C                     ENDIF                                          142392
      *                                                                   142392
     C           @RTCD     IFEQ *BLANKS                                   142392
     C                     MOVE 'Y'       EXDTA                           142392
     C                     ENDIF                                          142392
      *                                                                   142392
     C                     MOVE 'A'       PMACTC
     C***********          MOVE *BLANKS   PMCSNM                   142392 148532
      *
      ** For participation sold (i.e PTYP 66)
      *
     C           PTYPC     IFEQ 66
     C           CLE005    OREQ 'Y'                                       CLE005
     C           PTYPC     ANDEQ69                                        CLE005
     C           CLE005    OREQ 'Y'                                                           197083
     C           PTYPC     ANDEQ72                                                            197083
     C                     Z-ADD0         PMRSTM
     C                     MOVE *BLANKS   PMRONS
     C                     MOVE *BLANKS   PARIBN
     C                     MOVE *BLANKS   PMRIBA
     C                     MOVE *BLANKS   PAROBN
     C                     MOVE *BLANKS   PAROCN
     C                     MOVE *BLANKS   PMROBR
      *
      ** Default Settlement Details to Standard Settlement (SDEXSTPD)     142392
      *                                                                   142392
     C           EXDTA     IFEQ 'Y'                                       142392
     C                     MOVELBYPSTY    PMPSTM                          142392
     C                     MOVELBYPONO    PMPONS                          142392
     C                     MOVELBYPIBN    PAPIBN                          142392
     C                     MOVELBYPIBA    PMPIBA                          142392
     C                     MOVELBYPOBN    PAPOBN                          142392
     C                     MOVELBYPOCS    PAPOCN                          142392
     C                     MOVELBYCVMR    PMCVMR                          142392
     C                     MOVELBYRCNO    PARCRN                          142392
     C                     MOVELBYRCAL    PMRCRA                          142392
     C                     MOVELBYRCNB    PARVNO                          142392
     C                     MOVELBYACBN    PAAWBN                          142392
     C                     MOVELBYACBL    PMAWBA                          142392
     C                     MOVELBYBYNB    PABENN                          142392
     C                     MOVELBYBACL    PMBENA                          142392
     C                     MOVELBYDPY1    PMDTP1                          142392
     C                     MOVELBYDPY2    PMDTP2                          142392
     C                     MOVELBYDPY3    PMDTP3                          142392
     C                     MOVELBYDPY4    PMDTP4                          142392
     C                     MOVELBYDECG    PMDCHG                          142392
     C                     MOVELBYBBI1    PMBTB1                          142392
     C                     MOVELBYBBI2    PMBTB2                          142392
     C                     MOVELBYBBI3    PMBTB3                          142392
     C                     MOVELBYBBI4    PMBTB4                          142392
     C                     MOVELBYBBI5    PMBTB5                          142392
     C                     MOVELBYBBI6    PMBTB6                          142392
     C                     MOVELBYOPBR    PMPOBR                          142392
     C                     ELSE                                           142392
      *                                                                   142392
     C                     Z-ADDPSTMC     PMPSTM
     C                     MOVE PONSC     PMPONS
     C                     MOVE PIBNC     PAPIBN
     C                     MOVE PIBAC     PMPIBA
      *
     C********** POBNC     IFNE 0                                                             CSD027
     C           POBNC     IFNE *BLANKS                                                       CSD027
     C                     MOVE POBNC     PAPOBN
     C                     ELSE
     C                     MOVE *BLANKS   PAPOBN
     C                     END
      *
     C********** POCNC     IFNE 0                                                             CSD027
     C           POCNC     IFNE *BLANKS                                                       CSD027
     C                     MOVE POCNC     PAPOCN
     C                     ELSE
     C                     MOVE *BLANKS   PAPOCN
     C                     END
      *
     C                     MOVE CVMRC     PMCVMR
     C                     MOVE RCRNC     PARCRN
     C                     MOVE RCRAC     PMRCRA
     C                     MOVE RVNOC     PARVNO
     C                     MOVE AWBNC     PAAWBN
     C                     MOVE AWBAC     PMAWBA
     C                     MOVE BENNC     PABENN
     C                     MOVE BENAC     PMBENA
     C                     MOVE DTP1C     PMDTP1
     C                     MOVE DTP2C     PMDTP2
     C                     MOVE DTP3C     PMDTP3
     C                     MOVE DTP4C     PMDTP4
     C                     MOVE DCHGC     PMDCHG
     C                     MOVE BTB1C     PMBTB1
     C                     MOVE BTB2C     PMBTB2
     C                     MOVE BTB3C     PMBTB3
     C                     MOVE BTB4C     PMBTB4
     C                     MOVE BTB5C     PMBTB5
     C                     MOVE BTB6C     PMBTB6
     C                     MOVE OSDBC     PMPOBR
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE *BLANKS   PMRSCY                          CEU004
     C                     MOVE SCCYC     PMPSCY                          CEU004
     C                     MOVE ICCYC     PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   PMRSCY                                              CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     MOVE *BLANKS   PMREXI                                              CLE031
     C                     MOVE PSCYC     PMPSCY                                              CLE031
     C                     MOVE PEXRC     PMPEXC                                              CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE PMPEXC    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMPEXR                                              CLE031
     C                     MOVE PEXIC     PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                   142392
     C                     ENDIF                                          142392
      *
      ** else for loans other than Participation sold
      *
     C                     ELSE
      *                                                                   142392
     C           EXDTA     IFEQ 'Y'                                       142392
     C                     MOVELBYRSTY    PMRSTM                          142392
     C                     MOVE BYRONO    PMRONS                          142392
     C                     MOVE BYRIBN    PARIBN                          142392
     C                     MOVE BYRIBL    PMRIBA                          142392
     C                     MOVE BYORBR    PMROBR                          142392
     C                     MOVE BYROBN    PAROBN                          142392
     C                     MOVE BYROCS    PAROCN                          142392
      *                                                                   142392
     C                     ELSE                                           142392
      *                                                                   142392
     C                     Z-ADDRSTMC     PMRSTM
     C                     MOVE RONSC     PMRONS
     C                     MOVE RIBNC     PARIBN
     C                     MOVE RIBAC     PMRIBA
     C                     MOVE OMDBC     PMROBR
      *
     C********** ROBNC     IFNE 0                                                             CSD027
     C           ROBNC     IFNE *BLANKS                                                       CSD027
     C                     MOVE ROBNC     PAROBN
     C                     ELSE
     C                     MOVE *BLANKS   PAROBN
     C                     END
      *
     C********** ROCNC     IFNE 0                                                             CSD027
     C           ROCNC     IFNE *BLANKS                                                       CSD027
     C                     MOVE ROCNC     PAROCN
     C                     ELSE
     C                     MOVE *BLANKS   PAROCN
     C                     END
      *                                                                   142392
     C                     ENDIF                                          142392
      *
     C                     Z-ADD0         PMPSTM
     C                     MOVE *BLANKS   PMPONS
     C                     MOVE *BLANKS   PAPIBN
     C                     MOVE *BLANKS   PMPIBA
     C                     MOVE *BLANKS   PAPOBN
     C                     MOVE *BLANKS   PAPOCN
     C                     MOVE *BLANKS   PMCVMR
     C                     MOVE *BLANKS   PARCRN
     C                     MOVE *BLANKS   PMRCRA
     C                     MOVE *BLANKS   PARVNO
     C                     MOVE *BLANKS   PAAWBN
     C                     MOVE *BLANKS   PMAWBA
     C                     MOVE *BLANKS   PABENN
     C                     MOVE *BLANKS   PMBENA
     C                     MOVE *BLANKS   PMDTP1
     C                     MOVE *BLANKS   PMDTP2
     C                     MOVE *BLANKS   PMDTP3
     C                     MOVE *BLANKS   PMDTP4
     C                     MOVE *BLANKS   PMDCHG
     C                     MOVE *BLANKS   PMBTB1
     C                     MOVE *BLANKS   PMBTB2
     C                     MOVE *BLANKS   PMBTB3
     C                     MOVE *BLANKS   PMBTB4
     C                     MOVE *BLANKS   PMBTB5
     C                     MOVE *BLANKS   PMBTB6
     C                     MOVE *BLANKS   PMPOBR
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE *BLANKS   PMPSCY                          CEU004
     C                     MOVE *BLANKS   PMIC72                          CEU004
     C                     MOVELSCCYC     PMRSCY                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   PMPSCY                                              CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     MOVE *BLANKS   PMPEXI                                              CLE031
     C                     MOVE SCCYC     PMRSCY                                              CLE031
     C           REXRC     IFEQ 0                                                             CLE036
     C                     MOVE *BLANKS   PMREXR                                              CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE REXRC     PMREXC                                              CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE PMREXC    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMREXR                                              CLE031
     C                     ENDIF                                                              CLE036
     C                     MOVE REXIC     PMREXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     END
      *
     C                     EXSR SRSNAM
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSNAM  -  Move cust no to shortname counterpart              *
      * Called by: SRINIT - Initialise settlement details for insert  *
      * Calls    : none                                               *
      *                                                               *
      *****************************************************************
      *
     C           SRSNAM    BEGSR
      *
      ** Counterparty Pay instructions
      *
     C                     MOVE *BLANKS   PMRIBN
     C                     MOVELPARIBN    PMRIBN
      *
      ** RCPT - Ordering bank
      *
     C                     MOVE *BLANKS   PMROBN
     C                     MOVELPAROBN    PMROBN
      *
      ** RCPT - Ordering customer
      *
     C                     MOVE *BLANKS   PMROCN
     C                     MOVELPAROCN    PMROCN
      *
      ** PAY - Intermediary bank
      *
     C                     MOVE *BLANKS   PMPIBN
     C                     MOVELPAPIBN    PMPIBN
      *
      ** PAY - Ordering bank
      *
     C                     MOVE *BLANKS   PMPOBN
     C                     MOVELPAPOBN    PMPOBN
      *
      ** PAY - Ordering customer
      *
     C                     MOVE *BLANKS   PMPOCN
     C                     MOVELPAPOCN    PMPOCN
      *
      ** Receiver correspondent
      *
     C                     MOVE *BLANKS   PMRCRN
     C                     MOVELPARCRN    PMRCRN
      *
      ** Receiver number
      *
     C                     MOVE *BLANKS   PMRVNO
     C                     MOVELPARVNO    PMRVNO
      *
      ** Counterparty receive instructions
      *
     C                     MOVE *BLANKS   PMAWBN
     C                     MOVELPAAWBN    PMAWBN
      *
      ** For account of instructions
      *
     C                     MOVE *BLANKS   PMBENN
     C                     MOVELPABENN    PMBENN
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRMFSC  -  Move file values to settlement screen              *
      * Called by: SRFXST - Format settlement details                 *
      * Calls    : SRSNAM - Move cust no to shortname counterpart     *
      *                                                               *
      *****************************************************************
      *
     C           SRMFSC    BEGSR
      *
     C           PMODE     IFNE 'B'                                       123699
     C                     Z-ADDRSTM      PMRSTM
     C                     MOVE RONS      PMRONS
     C                     MOVE RIBN      PARIBN
     C                     MOVE RIBA      PMRIBA
      *
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE SCCY      PMPSCY                          CEU004
     C                     MOVE SCCY      PMRSCY                          CEU004
     C                     MOVE ICCY      PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVELPSCYK     PMPSCY                                              CLE031
     C                     MOVELSCCY      PMRSCY                                              CLE031
      *                                                                                       CLE031
     C           REXRK     IFEQ 0                                                             CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE REXRK     PMREXC 14                                           CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE PMREXC    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMREXR                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PEXRK     IFEQ 0                                                             CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE PEXRK     PMPEXC 14                                           CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE PMPEXC    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMPEXR                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVE REXIK     PMREXI                                              CLE031
     C                     MOVE PEXIK     PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C********** ROBN      IFNE 0                                                             CSD027
     C           ROBN      IFNE *BLANKS                                                       CSD027
     C                     MOVE ROBN      PAROBN
     C                     ELSE
     C                     MOVE *BLANKS   PAROBN
     C                     END
      *
     C********** ROCN      IFNE 0                                                             CSD027
     C           ROCN      IFNE *BLANKS                                                       CSD027
     C                     MOVE ROCN      PAROCN
     C                     ELSE
     C                     MOVE *BLANKS   PAROCN
     C                     END
      *
     C                     Z-ADDPSTM      PMPSTM
     C                     MOVE PONS      PMPONS
     C                     MOVE PIBN      PAPIBN
     C                     MOVE PIBA      PMPIBA
      *
     C********** POBN      IFNE 0                                                             CSD027
     C           POBN      IFNE *BLANKS                                                       CSD027
     C                     MOVE POBN      PAPOBN
     C                     ELSE
     C                     MOVE *BLANKS   PAPOBN
     C                     END
      *
     C********** POCN      IFNE 0                                                             CSD027
     C           POCN      IFNE *BLANKS                                                       CSD027
     C                     MOVE POCN      PAPOCN
     C                     ELSE
     C                     MOVE *BLANKS   PAPOCN
     C                     END
      *
     C                     MOVE CVMR      PMCVMR
     C                     MOVE RCRN      PARCRN
     C                     MOVE RCRA      PMRCRA
     C                     MOVE RVNO      PARVNO
     C                     MOVE AWBN      PAAWBN
     C                     MOVE AWBA      PMAWBA
     C                     MOVE BENN      PABENN
     C                     MOVE BENA      PMBENA
     C                     MOVE DTP1      PMDTP1
     C                     MOVE DTP2      PMDTP2
     C                     MOVE DTP3      PMDTP3
     C                     MOVE DTP4      PMDTP4
     C                     MOVE DCHG      PMDCHG
     C                     MOVE BTB1      PMBTB1
     C                     MOVE BTB2      PMBTB2
     C                     MOVE BTB3      PMBTB3
     C                     MOVE BTB4      PMBTB4
     C                     MOVE BTB5      PMBTB5
     C                     MOVE BTB6      PMBTB6
      *
     C           PTYPC     IFEQ 66
     C           CLE005    OREQ 'Y'                                       CLE005
     C           PTYPC     ANDEQ69                                        CLE005
     C           CLE005    OREQ 'Y'                                                           197083
     C           PTYPC     ANDEQ72                                                            197083
     C                     MOVE OSBR      PMPOBR
     C                     MOVE *BLANKS   PMROBR
     C                     ELSE
     C                     MOVE OSBR      PMROBR
     C                     MOVE *BLANKS   PMPOBR
     C                     END
      *                                                                   123699
     C                     ENDIF                                          123699
      *                                                                                       CLE034
      ** If CLE034 is installed, move Settlement allocation field                             CLE034
      ** to screen field.                                                                     CLE034
      *                                                                                       CLE034
     C********** CLE034    IFEQ 'Y'                                                           CLE034
     C**********           MOVELFSTAL     SSTAL                                               CLE034
     C**********           ENDIF                                                              CLE034
      *
     C                     EXSR SRSNAM
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSETU  -  Setup fields for update                            *
      * Called by: SRUPDT - Update files                              *
      * Calls    : SRSHAD - Set up parameter for shadow post          *
      *                                                               *
      *****************************************************************
      *
     C           SRSETU    BEGSR
      *
      ** Before-status for shadow posting
      *
     C           SACTN     IFEQ 'I'
     C                     CLEARZ#BSTS
     C                     ELSE
     C**********           MOVE OLDSET    OTIST  34                                          BUG2117
     C                     MOVE OLDSET    OTIST  40                                          BUG2117
     C                     MOVE 'Y'       BEFSTS  1                       CLE033
     C                     EXSR SRSHAD
     C                     MOVE Z#ADTA    Z#BDT1
     C                     MOVE Z#ADTB    Z#BDT2
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           CLE031    OREQ 'Y'                                                           CLE031
     C                     MOVE Z#ADTE    Z#BDT5                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C                     ENDIF
      *
      ** Set up the following fields for action Insert
      *
     C           SACTN     IFEQ 'I'
     C                     CLEARLOAMSDKF
      ** allocate Timestamp:                                                                 BUG2117
     C                     CALL 'ZAGENTS'                                                    BUG2117
     C                     PARM           NEWTIM 26                                          BUG2117
     C                     MOVELNEWTIM    TMSTK                                              BUG2117
      *                                                                                      BUG2117
     C                     MOVE SLOAN     LNRF
     C                     MOVE SCURR     CCY
     C                     Z-ADDWVDAYN    VDAT
     C                     MOVE WLASNX    LASN
     C                     MOVE '2'       MRIN
     C                     MOVE LTYPC     LTYP
     C                     MOVE SUTPC     SUTP
     C                     MOVE PTYPC     PTYP
     C                     MOVE 'RE'      AMTP
      *                                                                                       CLE036
      ** If repayment is in facility ccy, ensure that the amount input                        CLE036
      ** by the User is used to update the new fields on the file....                         CLE036
     C           FREPAY    IFEQ 'Y'                                                           CLE036
     C           SCURR     ANDNELCCYC                                                         CLE036
     C                     MOVE LCCYC     CCY                                                 CLE036
     C                     MOVE SCURR     FRCY                                                CLE036
      *                                                                                       CLE036
     C           REPTC     IFNE 1                                                             CLE036
     C                     Z-ADDWLAMT     FTOT                                                CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           REPTC     IFNE 3                                                             CLE036
     C                     Z-ADDWLAMT     FRAM                                                CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
      ** ...and the 'converted to loan currency' amount is used to                            CLE036
      ** update the old fields on the file.                                                   CLE036
     C                     Z-ADDWCAMT     WLAMT                                               CLE036
      *                                                                                       CLE036
     C                     ENDIF                                                              CLE036
      *
     C           REPTC     IFNE 1
     C***********          Z-ADDWLAMT     PRAM                            158268
     C                     Z-ADDWLAMT     TAMT                            158268
     C                     ENDIF
      *
     C           REPTC     IFNE 3
     C***********          Z-ADDWLAMT     TAMT                            158268
     C                     Z-ADDWLAMT     PRAM                            158268
     C                     ENDIF
      *
     C                     MOVE BRCAC     BRCA
     C***********          MOVELSCUST     CNUM                            128148
     C                     MOVELBBCUST    CNUM                            128148
     C           PPCUST    IFEQ 'O'                                                           207629
     C           PTYPC     IFEQ 64                                                            207629
     C           PTYPC     OREQ 65                                                            207629
     C           PTYPC     OREQ 68                                                            207629
     C           PTYPC     OREQ 71                                                            207629
     C                     MOVELCNUMC     CNUM                                                207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     MOVE REPTC     REPT
     C                     BITOF'01234567'LAIN
     C                     MOVE WTINC     WTIN
     C                     MOVE 'A'       LLAG
     C                     MOVE FCUSC     FCUS
     C                     MOVE FTYPC     FTYP
     C                     MOVE FSEQC     FSEQ
     C                     BITOF'01234567'PONI
     C                     BITOF'01234567'TLXY
     C                     MOVE WOSBR     OSBR
     C                     MOVE FCLBC     FCLB
     C                     MOVE 'I'       CHTP
     C                     MOVE *ON       *IN26
     C           CLE002    IFNE 'Y'                                       161136
     C           BPREAU    ORNE 'Y'                                       161136
     C                     MOVE WLASNX    SSEQN                           161136
     C                     ENDIF                                          161136
     C                     ENDIF
      *
      ** Set status of Repayment
      *
     C           CLE002    IFEQ 'Y'
     C           BPREAU    ANDEQ'Y'
      *
     C                     SELEC
     C           SACTN     WHEQ 'I'
     C                     MOVE 'C'       ASTS
     C           SACTN     WHEQ 'A'
     C           ASTS      IFEQ 'A'
     C           ASTS      OREQ 'R'                                       194509
     C                     MOVE 'R'       ASTS
     C                     ELSE
     C                     MOVE 'C'       ASTS
     C                     ENDIF
     C           SACTN     WHEQ 'X'
     C           SEENSL    ANDEQ'Y'                                       172706
      *                                                                                       207653
     C           *IN87     IFEQ *ON                                                           207653
     C           *IN87     OREQ *OFF                                                          207653
     C           *INKK     ANDEQ*ON                                       172706
     C                     MOVE 'A'       ASTS
     C                     ENDIF                                                              207653
      *                                                                                       207653
     C           SACTN     WHEQ 'R'
     C                     MOVE 'D'       ASTS
     C                     ENDSL
      *
     C                     ELSE
      *
     C           SACTN     IFNE 'R'
     C                     MOVE 'A'       ASTS
     C                     ELSE
     C                     MOVE 'R'       ASTS
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                   120002
     C           PMODE     IFEQ 'B'                                       120002
     C                     MOVE 'A'       ASTS                            120002
     C/COPY WNCPYSRC,LE2120C027
     C                     ENDIF                                          120002
      *
      ** Inserting/Amending/Authorising user and other details
      *
     C                     SELEC
     C           SACTN     WHEQ 'I'
     C                     Z-ADDBJRDNB    ORED
     C                     MOVELSUSER     IUSR
     C                     MOVE 'D'       RECI
     C           SACTN     WHEQ 'A'
     C           NEWSET    IFNE OLDSET
     C                     BITOF'2'       LAIN
     C                     ENDIF
     C                     MOVELSUSER     AUSR
     C           SACTN     WHEQ 'X'
     C                     MOVELSUSER     XUSR
     C           SACTN     WHEQ 'R'
     C                     MOVE 'R'       RECI
     C                     ENDSL
      *                                                                   120002
     C           PMODE     IFEQ 'B'                                       120002
     C                     MOVE PIIUSR    IUSR                            120002
     C                     MOVE PIAUSR    AUSR                            120002
     C                     MOVE PIXUSR    XUSR                            120002
     C                     ENDIF                                          120002
      *
     C                     MOVE SAUTO     AUTO
      *                                                                                       205964
     C           SACTN     IFEQ 'A'                                                           205964
     C           NEWSTS    ANDNEOLDSTS                                                        205964
     C                     MOVE '1'       *IN10                                               205964
     C                     ELSE                                                               205964
     C                     MOVE '0'       *IN10                                               205964
     C                     ENDIF                                                              205964
     C           PIFIL2    IFEQ 'C134'                                                        CLE134
     C           SACTN     ANDEQ'A'                                                           CLE134
     C                     MOVE PIPAMT    PRAM                                                CLE134
     C                     MOVE PRAM      WLAMT                                               CLE134
     C                     MOVE OLDSTS    NEWSTS                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       205964
     C                     MOVE NEWSTS    OLDSTS
     C                     Z-ADDWLSWC     LSWCC
     C                     Z-ADDWLSWS     LSWSC
     C                     MOVE NATN      TNLU
     C           SACTN     IFNE 'X'                                       123789
     C                     MOVE SACTN     CHTP
     C                     MOVE 'M'       MNSG                            122461
     C                     ENDIF                                          123789
     C                     Z-ADDBJRDNB    LCD
     C                     MOVE 'N'       GASS
     C                     MOVE 'N'       GPRT
     C                     MOVE 'N'       NRLI
     C***********          MOVE 'M'       MNSG                            122461
      *
      ** Settlement details for Insert and Amend
      *
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
      *                                                                                       CSD015
      **  Check if before and after image of the record of LOAMSDK                            CSD015
      **  is different.                                                                       CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C           SACTN     ANDEQ'A'                                                           CSD015
      *                                                                                       CSD015
     C                     MOVE ROBN      WKROBN  6                                           CSD015
     C                     MOVE ROCN      WKROCN  6                                           CSD015
     C                     MOVE POBN      WKPOBN  6                                           CSD015
     C                     MOVE POCN      WKPOCN  6                                           CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       WDIFF   1                                           CSD015
     C                     MOVE 'N'       WDTPC   1                                           CSD015
      *                                                                                       CSD015
     C                     MOVEA*BLANKS   WLF,1                                               CSD015
      *                                                                                       CSD015
     C           RONS      IFNE PMRONS                                                        CSD015
     C                     MOVELPMRONS    WLF,1                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RIBN      IFNE PARIBN                                                        CSD015
     C                     MOVELPARIBN    WLF,2                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           WKROBN    IFNE PAROBN                                                        CSD015
     C                     MOVELPAROBN    WLF,3                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           WKROCN    IFNE PAROCN                                                        CSD015
     C                     MOVELPAROCN    WLF,4                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PONS      IFNE PMPONS                                                        CSD015
     C                     MOVELPMPONS    WLF,5                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PIBN      IFNE PAPIBN                                                        CSD015
     C                     MOVELPAPIBN    WLF,6                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           WKPOBN    IFNE PAPOBN                                                        CSD015
     C                     MOVELPAPOBN    WLF,7                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           WKPOCN    IFNE PAPOCN                                                        CSD015
     C                     MOVELPAPOCN    WLF,8                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RCRN      IFNE PARCRN                                                        CSD015
     C                     MOVELPARCRN    WLF,9                                               CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RVNO      IFNE PARVNO                                                        CSD015
     C                     MOVELPARVNO    WLF,10                                              CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           AWBN      IFNE PAAWBN                                                        CSD015
     C                     MOVELPAAWBN    WLF,11                                              CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           BENN      IFNE PABENN                                                        CSD015
     C                     MOVELPABENN    WLF,12                                              CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           DTP1      IFNE PMDTP1                                                        CSD015
     C           DTP2      ORNE PMDTP2                                                        CSD015
     C           DTP3      ORNE PMDTP3                                                        CSD015
     C           DTP4      ORNE PMDTP4                                                        CSD015
     C                     MOVE 'Y'       WDTPC   1                                           CSD015
     C                     MOVE 'Y'       WDIFF                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *
     C           PIFIL2    IFNE 'C134'                                                        CLE134
     C                     MOVE WSETP     SETP
     C                     MOVE WOSAC     OSAC
     C                     MOVE WOSBR     OSBR                            123699
     C                     MOVE WTSEN     TSEN
     C                     MOVE WFACO     FACO
     C                     MOVE SSPI1     SPI1
     C                     MOVE SSPI2     SPI2
     C                     MOVE SSPI3     SPI3
      *
     C                     Z-ADDPMRSTM    RSTM
     C                     MOVE PMRONS    RONS
     C                     MOVE PARIBN    RIBN
     C                     MOVE PMRIBA    RIBA
     C                     MOVE PAROBN    ROBN
     C                     MOVE PAROCN    ROCN
     C                     MOVE PMPSTM    PSTM
     C                     MOVE PMPONS    PONS
     C                     MOVE PAPIBN    PIBN
     C                     MOVE PMPIBA    PIBA
     C                     MOVE PMPIBA    PIBA
     C                     MOVE PAPOBN    POBN
     C                     MOVE PAPOCN    POCN
     C                     MOVE PARCRN    RCRN
     C                     MOVE PMRCRA    RCRA
     C                     MOVE PARVNO    RVNO
     C                     MOVE PAAWBN    AWBN
     C                     MOVE PMAWBA    AWBA
     C                     MOVE PABENN    BENN
     C                     MOVE PMBENA    BENA
     C                     MOVE PMDTP1    DTP1
     C                     MOVE PMDTP2    DTP2
     C                     MOVE PMDTP3    DTP3
     C                     MOVE PMDTP4    DTP4
     C                     MOVE PMDCHG    DCHG
     C                     MOVE PMBTB1    BTB1
     C                     MOVE PMBTB2    BTB2
     C                     MOVE PMBTB3    BTB3
     C                     MOVE PMBTB4    BTB4
     C                     MOVE PMBTB5    BTB5
     C                     MOVE PMBTB6    BTB6
     C                     MOVE PMCVMR    CVMR
     C                     MOVE SSTAL     STALK                                               CLE034
      *
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE WSCCY     SCCY                            CEU004
     C                     MOVE PMIC72    ICCY                            CEU004
     C                     ENDIF                                          CEU004
      *
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PMRSCY    SCCY                                                CLE031
     C                     MOVE PMPSCY    PSCYK                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE134
      *                                                                   CEU004
     C                     ENDIF
      *
      ** Set up other fields for Test Harness update on Record mode
      *
     C           PMODE     IFEQ 'R'
     C                     MOVE SACTN     ACTN
     C                     Z-ADDBJRDNB    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     WDATE
     C                     MOVELWDD       WFLD3A  3
     C                     MOVE '/'       WFLD3A
     C                     MOVELWMM       WFLD3B  3
     C                     MOVE '/'       WFLD3B
     C                     MOVELWFLD3A    WFLD6A  6
     C                     MOVE WFLD3B    WFLD6A
     C                     MOVELWFLD6A    WDTST   8
     C                     MOVE WYY       WDTST
     C                     MOVELWDTST     DTST
     C                     TIME           WTIME   60
     C                     MOVELWTIME     WTIMEA  6
     C                     MOVELWHH       WFLD3A  3
     C                     MOVE ':'       WFLD3A
     C                     MOVELWNN       WFLD3B  3
     C                     MOVE ':'       WFLD3B
     C                     MOVELWFLD3A    WFLD6A  6
     C                     MOVE WFLD3B    WFLD6A
     C                     MOVELWFLD6A    WTMST   8
     C                     MOVE WSS       WTMST
     C***********          MOVELWTMST     TMST                                                CLE031
     C                     MOVELWTMST     L2TMST                                              CLE031
     C                     MOVELSACTN     ACTN
     C                     MOVE *BLANK    MSVR
     C                     MOVE *BLANK    MSID
     C                     MOVE *BLANK    MSTX
     C                     MOVE L2120F    L2120S
     C                     ENDIF
      *
      ** Batch Mode: Set up Original Entry Date, and Last Change Date
      *
     C           PMODE     IFEQ 'B'
     C                     MOVE PITDST    WPITDS
     C                     MOVELWPIDD     WFLD4   4
     C                     MOVE WPIMM     WFLD4
     C                     MOVELWFLD4     WFLD6   6
     C                     MOVE WPIYY     WFLD2   2
     C                     MOVE WFLD2     WFLD6
     C                     MOVELWFLD6     ZDATE
     C                     EXSR ZDATE1
     C           SACTN     IFEQ 'I'
     C                     Z-ADDZDAYNO    ORED
     C                     ENDIF
     C                     Z-ADDZDAYNO    LCD
      *
      ** Set up Last Change Type and PC transaction reference
      *
     C           PITACT    IFNE 'X'                                       123789
     C                     MOVE PITACT    CHTP
     C                     ENDIF                                          123789
      *
     C***********PMODE     IFEQ 'B'                                       122109
     C                     MOVE PIPCOB    PCOBK
     C                     ELSE
     C                     MOVE *BLANKS   PCOBK
     C                     ENDIF
      *
     C           PMODE     IFNE 'B'
     C           SACTN     ANDEQ'I'
     C                     MOVE BRCA      PBRCA
     C***********          CALL 'AOBRCHR0'                                121783
     C                     CALL 'AOBRCHR1'                                121783
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PBRCA   3
     C           SDBRCH    PARM SDBRCH    DSSDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRCHPD'DBFILE           ************
     C                     Z-ADD23        DBASE            * DBERR 23 *
     C                     MOVELBRCA      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVELA8MQSM    W#1ST3  3
     C***                  MOVELW#1ST3    PCRFK     P                     158177
     C********** *NAMVAR   DEFN           LEALLO                                       158177 CLE148
     C********** *LOCK     IN   LEALLO                                                 158177 CLE148
     C********** PCLAST    ADD  1         PCNEXT  80                                   158177 CLE148
     C                     CALL 'LEALLO'                                                      CLE148
     C                     PARM *BLANKS   PRTCD   7                                           CLE148
     C                     PARM 'Y'       PUPDT   1                                           CLE148
     C                     PARM *BLANKS   PCLAST                                              CLE148
     C                     PARM *BLANKS   PCNEXT  8                                           CLE148
     C                     MOVE PCNEXT    W1ST11 11                       158177
     C                     MOVELW#1ST3    W1ST11                          158177
     C                     MOVELW1ST11    PCRFK                           158177
     C                     MOVE '0001'    PCRFK                           158177
     C**********           Z-ADDPCNEXT    PCLAST                                       158177 CLE148
     C**********           OUT  LEALLO                                                 158177 CLE148
     C                     ENDIF
     C                     ELSE
     C           PMODE     IFEQ 'B'
     C                     MOVELPITREF    PCRFK
     C                     ENDIF
     C                     ENDIF
      *
      ** System generated
      *
     C           PMODE     IFEQ 'B'                                       123873
     C           P#TSEQ    ANDNE1                                         122461
     C                     MOVE 'S'       MNSG
     C                     ENDIF                                          123873
      *
     C***********          ENDIF                                          122109
      *
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRUPFC  -  Setup file for update of Facility                  *
      * Called by: SRUPDT - Update files                              *
      * Calls    : FCLTSR - Update Facility file                      *
      *                                                               *
      *****************************************************************
      *
     C           SRUPFC    BEGSR
      *
     C                     MOVE 'N'       WPART   1
      *
      ** Access facility 'A' record
      *
     C                     MOVE FCUSC     WFCNUM
     C                     MOVE FTYPC     WFFACT
     C                     MOVE FSEQC     WFFCNO
     C                     MOVE 'A'       WFRCTP
      *
     C           WKFAC     CHAINFCLTY               N08
     C           *IN08     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY'   DBFILE           ************
     C                     Z-ADD16        DBASE            * DBERR 16 *
     C                     MOVELWFKEY     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVEA'0000'    *IN,60
     C           CLE134    IFEQ 'Y'                                                         AR806351
     C                     MOVE 'Y'       WEXPO   1                                         AR806351
     C                     EXSR PDCLRE                                                      AR806351
     C                     ENDIF                                                            AR806351
      *                                                                                     AR806351
     C                     EXSR FCLTSR
      *                                                                   CLE005
      ** Update superfacility of the tranche, if any, for CLE005          CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           TRCA      ANDEQ'TR'                                      CLE005
     C                     MOVELWPRME     SPRME  12                       CLE005
     C                     EXSR SRUPCA                                    CLE005
     C                     MOVELSPRME     WPRME                           CLE005
     C                     ENDIF                                          CLE005
      *
      ** Update also the Participant facility if existing
      *
      *
     C           LPFI      IFNE ' '
     C           LPFI      ANDNE'R'                                       144073
      *
     C                     MOVE 'Y'       WPART
     C                     MOVE PTFC      WFCNUM
     C                     MOVE PTFT      WFFACT
     C                     MOVE PTFN      WFFCNO
     C                     MOVE 'A'       WFRCTP
      *
     C           WKFAC     CHAINFCLTY               N08
      *
     C           *IN08     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY   'DBFILE           ************
     C                     Z-ADD17        DBASE            * DBERR 17 *
     C                     MOVELWFKEY     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVEA'0000'    *IN,60
     C           CLE134    IFEQ 'Y'                                                         AR806351
     C                     MOVE 'Y'       WEXPO                                             AR806351
     C                     EXSR PDCLRE                                                      AR806351
     C                     ENDIF                                                            AR806351
      *                                                                                     AR806351
     C                     EXSR FCLTSR
      *                                                                   CLE005
      ***Update*superfacility*of*the*tranche,*if*any,*for*CLE005** CLE005 153864
      ***********                                                  CLE005 153864
     C***********CLE005    IFEQ 'Y'                                CLE005 153864
     C***********TRCA      ANDEQ'TR'                               CLE005 153864
     C***********          EXSR SRUPCA                             CLE005 153864
     C***********          ENDIF                                   CLE005 153864
      *
     C                     ENDIF
      *
     C                     ENDSR
      *                                                                   CLE005
      /EJECT                                                              CLE005
      *****************************************************************   CLE005
      * SRUPCA  -  Update credit agreement/superfacility              *   CLE005
      * Called by: SRUPFC - Set up file for update of facility        *   CLE005
      * Calls    : FCLTSR - Update Facility file                      *   CLE005
      *                                                               *   CLE005
      *****************************************************************   CLE005
      *                                                                   CLE005
     C           SRUPCA    BEGSR                                          CLE005
      *                                                                   CLE005
     C                     MOVE FCCY      WTCCY   3                       CLE005
     C                     MOVE CMDI      WFCMDI  1                       CLE005
     C                     Z-ADDCAXR      WFCAXR 138                      CLE005
     C                     MOVE CANM      WFCNUM                          CLE005
     C                     MOVE CAFT      WFFACT                          CLE005
     C                     MOVE CAFN      WFFCNO                          CLE005
     C                     MOVE 'A'       WFRCTP                          CLE005
      *                                                                   CLE014
      ** Save the revolving credit indicator specified for the tranche    CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C                     MOVE RVCR      WRVCR   1                       CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE005
     C           WKFAC     CHAINFCLTY               N08                   CLE005
      *                                                                   CLE005
     C           *IN08     IFEQ *ON                                       CLE005
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVEL'FCLTY   'DBFILE           ************   CLE005
     C                     Z-ADD25        DBASE            * DBERR 25 *   CLE005
     C                     MOVELWFKEY     DBKEY            ************   CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE014
      ** If the revolving credit indicator for the credit agreement is    CLE014
      ** 'T', use the saved tranche revolving credit indicator as the     CLE014
      ** credit agreement revolving indicator.                            CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
      *                                                                   CLE014
     C           RVCR      IFEQ 'T'                                       CLE014
     C                     MOVE WRVCR     RVCR                            CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE005
     C                     MOVE 'Y'       WTRCA   1                       CLE005
     C                     MOVEA'0000'    *IN,60                          CLE005
     C           CLE134    IFEQ 'Y'                                                         AR806351
     C                     MOVE 'Y'       WEXPO                                             AR806351
     C                     EXSR PDCLRE                                                      AR806351
     C                     ENDIF                                                            AR806351
      *                                                                                     AR806351
     C                     EXSR FCLTSR                                    CLE005
     C                     MOVE *BLANK    WTRCA                           CLE005
      *                                                                   CLE005
     C                     ENDSR                                          CLE005
      *                                                                   CLE005
      /EJECT                                                                                AR806351
      *****************************************************************                     AR806351
      * PDCLRE   - Check if loan has FAMU N/Y                         *                     AR806351
      * Called by: SRFCLT, SRUPCA                                     *                     AR806351
      * Calls    : None                                               *                     AR806351
      *****************************************************************                     AR806351
     C           PDCLRE    BEGSR                                                            AR806351
      *                                                                                     AR806351
      ** Bypass if PDCL type is Interest(Y) or Fee(Z) and with FAMU = N                     AR806351
      ** Use auto-settlement flag from CLOANCL (should be 'C')                              AR806351
      *                                                                                     AR806351
     C                     MOVELLTYPC     WLTYP   1                                         AR806351
      *                                                                                     AR806351
     C           AUTOC     IFEQ 'C'                                                         AR806351
     C           WLTYP     IFEQ 'Y'                                                         AR806351
     C           FAMU      ANDEQ'N'                                                         AR806351
     C           WLTYP     OREQ 'Z'                                                         AR806351
     C           FAMU      ANDEQ'N'                                                         AR806351
     C                     MOVE 'N'       WEXPO                                             AR806351
     C                     ENDIF                                                            AR806351
     C                     ENDIF                                                            AR806351
      *                                                                                     AR806351
     C                     ENDSR                                                            AR806351
      /EJECT
      *****************************************************************
      * SRBICA   - To get all branch internal customers into an array *
      * Called by: *INZSR - Initial processing                        *
      * Calls    : none                                               *
      *                                                               *
      *****************************************************************
      *
     C           SRBICA    BEGSR
      *
     C                     Z-ADD0         I       30
     C                     MOVE *OFF      *IN88
      *
      ** First read
      *
     C           *LOVAL    SETLLSDBRCHL5
     C                     READ SDBRCHL5                 88
      *
      ** If no record found on first read end with DB error else
      ** read branch codes file and build BICN array until EOF
      *
     C           *IN88     IFEQ *ON
     C                     MOVE 'SDBRCHL5'DBFILE
     C                     MOVE *BLANKS   DBKEY            ************
     C                     Z-ADD19        DBASE            * DBERR 19 *
     C                     EXSR *PSSR                      ************
      *
     C                     ELSE
      *
     C           *IN88     DOUEQ*ON
     C                     ADD  1         I
     C                     MOVE A8BICN    @BIC,I
     C                     READ SDBRCHL5                 88
     C                     ENDDO
      *
     C                     ENDIF
     C                     MOVE *OFF      *IN88
      *
     C                     ENDSR
      /EJECT
      *
      *****************************************************************
      * SRSHAD   - Retrieve parameter fields for Shadow Update        *
      * Called by: SRUPDT - Update files                              *
      *            SRSETU - Set up fields for update                  *
      * Calls    : None                                               *
      *                                                               *
      *****************************************************************
      *
     C           SRSHAD    BEGSR
      *
     C                     MOVE RECI      SHRECI
     C                     MOVE LNRF      SHLNRF
     C                     Z-ADDVDAT      SHVDAT
     C                     Z-ADDLASN      SHLASN
     C                     MOVE PTYPC     SHPTYP
     C                     MOVE AMTP      SHAMTP
     C                     MOVE CCY       SHCCY
     C                     MOVE AUTO      SHAUTO
     C                     Z-ADDPRAM      SHPRAM
     C                     MOVE BRCA      SHBRCA
     C                     Z-ADD0         SHREPT
     C                     MOVE OTIST     SHTIST
      *
     C                     MOVE OSBR      SHOSBR
     C                     MOVE CHTP      SHCHTP
      *                                                                   CLE033
     C           SACTN     IFEQ 'A'                                       CLE033
     C           BEFSTS    ANDEQ'Y'                                       CLE033
     C                     MOVE 'N'       BEFSTS                          CLE033
     C                     MOVE SAVLC     SHTNLU                          CLE033
     C                     ELSE                                           CLE033
     C                     Z-ADDTNLU      SHTNLU                          CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE SCCY      SHSCCY                          CEU004
     C                     MOVE ICCY      SHICCY                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE SCCY      SHSCCY                                              CLE031
     C                     MOVE ICCY      SHICCY                                              CLE031
     C                     Z-ADDREXRK     SHREXR                                              CLE031
     C                     MOVE REXIK     SHREXI                                              CLE031
     C                     MOVE PSCYK     SHPSCY                                              CLE031
     C                     Z-ADDPEXRK     SHPEXR                                              CLE031
     C                     MOVE PEXIK     SHPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       219608
     C           CLE034    IFEQ 'Y'                                                           219608
     C                     MOVE STALK     SHSTAL                                              219608
     C                     ENDIF                                                              219608
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *  SRPOUT - Return message Format (For Batch only)              *
      *  Called by: SRBTCH - Batch Mode Processing                    *
      *  Calls    : None                                              *
      *****************************************************************
     C           SRPOUT    BEGSR
      *
     C                     CLEARPOUTP
     C                     MOVE PIMTYP    POMTYP
     C                     MOVE WTUSR     POTUSR
     C                     MOVE WTWST     POTWST
     C                     MOVE WTREF     POTREF
     C                     MOVE WTSEQ     POTSEQ
     C                     MOVE SACTN     POTACT
     C                     MOVE WTDST     POTDST
     C                     MOVE WTTST     POTTST
     C                     MOVE PINPAR    PONPAR
     C                     MOVE SLOAN     POLOAN
     C                     MOVE PIVDAT    POVDAT
     C           SACTN     IFEQ 'I'
     C                     MOVE WLASNX    PORESQ
     C                     ELSE
     C                     MOVE SSEQN     PORESQ
     C                     ENDIF
     C                     ENDSR
      /EJECT
      *****************************************************************
      * *INZSR  -  Initial Processing                                 *
      * Called by: None                                               *
      * Calls    : None                                               *
      *                                                               *
      *****************************************************************
      *
     C           *INZSR    BEGSR
      *
      ** Copyright
      *
     C                     MOVEACPY@      CPY2@  80
      *
      ** Receive entry parameters
      *
     C           *ENTRY    PLIST
     C                     PARM           PMODE   1
     C                     PARM           PINPP
     C                     PARM           POUTP
     C                     PARM           PTMST  26                                           CLE034
      *
      ** Define data areas
      *
     C           *NAMVAR   DEFN           LDA
      *                                                                                       CSD015
     C           *NAMVAR   DEFN           SDSTAT                                              CSD015
      *                                                                                       CSD015
     C           *NAMVAR   DEFN           SC24X7                                              CSD015
      *
      ** Define Key Lists
      *
      ** Loan Amendments
      *
     C           WKLAM     KLIST
     C**********           KFLD           WLLOAN  60                                          CLE148
     C                     KFLD           WLLOAN  6                                           CLE148
     C                     KFLD           WLVDAT  50
     C                     KFLD           WLLASN  30
      *
      ** Loans
      *
     C           WKLON     KLIST
     C**********           KFLD           WCLOAN  60                                          CLE148
     C                     KFLD           WCLOAN  6                                           CLE148
     C                     KFLD           WCRCDT  1
      *
      ** Facility
      *
     C           WKFAC     KLIST
     C**********           KFLD           WFCNUM  60                                          CSD027
     C                     KFLD           WFCNUM  6                                           CSD027
     C                     KFLD           WFFACT  30
     C                     KFLD           WFFCNO  20
     C                     KFLD           WFRCTP  1
      *                                                                   CLE009
      ** Keylist for loan amendment fee index file                        CLE009
      *                                                                   CLE009
     C           KIDXF     KLIST                                          CLE009
     C**********           KFLD           WKLOAN  60                                   CLE009 CLE148
     C                     KFLD           WKLOAN  6                                           CLE148
     C                     KFLD           WKDATE  50                      CLE009
     C                     KFLD           WKSEQN  30                      CLE009
      *                                                                   CLE009
      ** Key list for Fees file                                           CLE009
      *                                                                   CLE009
     C           WKFEE     KLIST                                          CLE009
     C**********           KFLD           WFCNUM  60                                   CLE009 CSD027
     C                     KFLD           WFCNUM  6                                           CSD027
     C                     KFLD           WFFACL  50                      CLE009
     C**********           KFLD           WFLOAN  60                                   CLE009 CLE148
     C                     KFLD           WFLOAN  6                                           CLE148
      *                                                                                       CSD015
      **  Used fo Compliance Watch                                                            CSD015
      *                                                                                       CSD015
     C           CWHTKY    KLIST                                                              CSD015
     C                     KFLD           KFUNT   8                                           CSD015
     C                     KFLD           KIDEN  40                                           CSD015
     C                     KFLD           KBRCH   3                                           CSD015
      *
      ** Define parameter list for AOSARDR0
      *
     C           WPAR2     PLIST
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
      *
      ** Initialise LDA
      *
     C           *LOCK     IN   LDA
     C**********           MOVEL'LE2030'  DBPGM                                               CLE036
     C                     MOVEL'LE2120'  DBPGM                                               CLE036
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD*ZEROS    DBASE
     C                     OUT  LDA
      *
      ** Access Bank Details
      *
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANKS   PRTCD   7
     C                     PARM '*FIRST ' POPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           PRTCD     IFNE *BLANKS
     C                     MOVE 'E'       WSEV    1
     C                     MOVE 'MEM0001' WMSGID 10
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBANKPD'DBFILE           ************
     C                     Z-ADD1         DBASE            * DBERR 01 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     ELSE
     C           BJDFIN    IFEQ 'M'
     C                     MOVE *ON       *IN98
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LE2120C021
      *
      ** Check if S01465 is installed
      *
     C                     MOVE 'S01465'  PSARD
     C                     CALL 'AOSARDR0'WPAR2
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       S01465  1
     C                     ELSE
     C                     MOVE 'N'       S01465
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD02        DBASE            * DBERR 02 *
     C                     MOVEL'S01465'  DBKEY            ************
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      *
      ** Check if CLE002 is installed
      *
     C                     MOVE 'CLE002'  PSARD
     C                     CALL 'AOSARDR0'WPAR2
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE002  1
     C                     ELSE
     C                     MOVE 'N'       CLE002
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD03        DBASE            * DBERR 03 *
     C                     MOVEL'CLE002'  DBKEY            ************
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Determine if Customer Lending Enhancements - Backvaluations
      ** feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'CLE003'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE003  1
     C                     ELSE
     C                     MOVE 'N'       CLE003
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD4         DBASE            * DBERR 04 *
     C                     MOVEL'CLE003'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Determine if Customer Lending Enhancements - Syndications
      ** feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'CLE004'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE004  1
     C                     ELSE
     C                     MOVE 'N'       CLE004
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD5         DBASE            * DBERR 05 *
     C                     MOVEL'CLE004'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *                                                                   CLE005
      ** Check if CLE005 is installed                                     CLE005
      *                                                                   CLE005
     C                     MOVE 'CLE005'  PSARD                           CLE005
     C                     CALL 'AOSARDR0'WPAR2                           CLE005
     C           PRTCD     IFEQ *BLANKS                                   CLE005
     C                     MOVE 'Y'       CLE005  1                       CLE005
     C                     ELSE                                           CLE005
     C                     MOVE 'N'       CLE005                          CLE005
     C           PRTCD     IFNE '*NRF    '                                CLE005
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE005
     C                     Z-ADD024       DBASE            * DBERR 24 *   CLE005
     C                     MOVEL'CLE005'  DBKEY            ************   CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE033
      ** Access Switchable Feature Details (CLE033)                       CLE033
      *                                                                   CLE033
     C                     MOVE 'N'       CLE033  1                       CLE033
      *                                                                   CLE033
     C                     CALL 'AOSARDR0'                                CLE033
     C                     PARM *BLANKS   @RTCD                           CLE033
     C                     PARM '*VERIFY '@OPTN                           CLE033
     C                     PARM 'CLE033'  @SARD   6                       CLE033
      *                                                                   CLE033
     C           @RTCD     IFEQ *BLANKS                                   CLE033
     C                     MOVE 'Y'       CLE033                          CLE033
      *                                                                   CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE009
      ** Access SAR details file to see if Customer Lending               CLE009
      ** Enhancements                                                     CLE009
      *                                                                   CLE009
     C                     CALL 'AOSARDR0'                                CLE009
     C                     PARM *BLANK    PRTCD                           CLE009
     C                     PARM '*KEY   ' POPTN                           CLE009
     C                     PARM 'CLE007'  PSARD   6                       CLE009
     C           SCSARD    PARM SCSARD    DSFDY                           CLE009
      *                                                                   CLE009
     C           PRTCD     IFEQ *BLANK                                    CLE009
     C                     MOVE 'Y'       CLE007  1                       CLE009
     C                     CALL 'AOSARDR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*KEY   ' POPTN                           CLE009
     C                     PARM 'CLE009'  PSARD   6                       CLE009
     C           SCSARD    PARM SCSARD    DSFDY                           CLE009
      *                                                                   CLE009
      ** If CLE009 is installed, fill currency and their corresponding    CLE009
      ** telex notice days arrays                                         CLE009
      *                                                                   CLE009
     C           PRTCD     IFEQ *BLANKS                                   CLE009
     C                     MOVE 'Y'       CLE009  1                       CLE009
     C                     Z-ADD1         Y       30                      CLE009
      *                                                                   CLE009
     C                     CALL 'AOCURRR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*FIRST ' POPTN                           CLE009
     C                     PARM           PCURR   3                       CLE009
     C           SDCURR    PARM SDCURR    DSSDY                           CLE009
      *                                                                   CLE009
     C                     MOVE A6CYCD    CYA,Y                           CLE009
     C                     MOVE A6TXND    TND,Y                           CLE009
      *                                                                   CLE009
     C           PRTCD     DOWNE'*EOF    '                                CLE009
     C                     ADD  1         Y                               CLE009
      *                                                                   CLE009
     C                     CALL 'AOCURRR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*NEXT  ' POPTN                           CLE009
     C                     PARM           PCURR   3                       CLE009
     C           SDCURR    PARM SDCURR    DSSDY                           CLE009
      *                                                                   CLE009
     C           PRTCD     IFNE '*EOF    '                                CLE009
     C                     MOVE A6CYCD    CYA,Y                           CLE009
     C                     MOVE A6TXND    TND,Y                           CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDDO                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'N'       CLE009                          CLE009
      *                                                                   CLE009
     C           PRTCD     IFNE '*NRF    '                                CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE009
     C                     Z-ADD27        DBASE            * DBERR 27 *   CLE009
     C                     MOVEL'CLE009'  DBKEY            ************   CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'N'       CLE007                          CLE009
     C           PRTCD     IFNE '*NRF   '                                 CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE009
     C                     Z-ADD28        DBASE            * DBERR 28 *   CLE009
     C                     MOVEL'CLE007'  DBKEY            ************   CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                                       CLE023
      ** Determine if Customer Lending Enhancement CLE023 - Facilty                           CLE023
      ** History Improvements is installed                                                    CLE023
      *                                                                                       CLE023
     C                     CALL 'AOSARDR0'                                                    CLE023
     C                     PARM *BLANKS   PRTCD                                               CLE023
     C                     PARM '*KEY   ' POPTN                                               CLE023
     C                     PARM 'CLE023'  PSARD   6                                           CLE023
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE023
     C           PRTCD     IFEQ *BLANKS                                                       CLE023
     C                     MOVE 'Y'       CLE023  1                                           CLE023
     C                     ELSE                                                               CLE023
     C                     MOVE 'N'       CLE023                                              CLE023
     C           PRTCD     IFNE '*NRF    '                                                    CLE023
     C           *LOCK     IN   LDA                                                           CLE023
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE023
     C                     Z-ADD31        DBASE                                               CLE023
     C                     MOVEL'CLE023'  DBKEY                                               CLE023
     C                     OUT  LDA                                                           CLE023
     C                     EXSR *PSSR                                                         CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CSD015
      ** Determine if Compliance Watch Enhancedment - CSD015                                  CSD015
      ** feature is installed.                                                                CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY 'POPTN                                               CSD015
     C                     PARM 'CSD015'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD55        DBASE                                               CSD015
     C                     MOVEL'CSD015'  DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015  1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'N'       CSD015                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Determine if Function Code is being monitored by                                     CSD015
      ** Compliance Watch.                                                                    CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*KEY    'POPTN                                               CSD015
     C                     PARM 'LENDING 'PFUNC   8                                           CSD015
     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SDWLCCPD'DBFILE                                              CSD015
     C                     Z-ADD56        DBASE                                               CSD015
     C                     MOVELPFUNC     DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCWCDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*FIRST  'POPTN                                               CSD015
     C           SDCWCD    PARM SDCWCD    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SDCWCDPD'DBFILE                                              CSD015
     C                     Z-ADD57        DBASE                                               CSD015
     C                     MOVELPOPTN     DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Determine if Cncord Interface Development  - CCF001                                  CSD015
      ** feature is installed.                                                                CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY 'POPTN                                               CSD015
     C                     PARM 'CCF001'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD58        DBASE                                               CSD015
     C                     MOVEL'CCF001'  DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CCF001  1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'N'       CCF001                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Determine if 24x7 Midas Availability active?                                         CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CSC011'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSC011  1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'N'       CSC011                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD59        DBASE                                               CSD015
     C                     MOVEL'CSC011'  DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     IN   SDSTAT                                                        CSD015
     C                     IN   SC24X7                                                        CSD015
      *                                                                   CEU004
      ** Access SAR details file to see if Customer Lending               CEU004
      ** Enhancements - Ccy Conversion Upgrade to DBA R2.0                CEU004
      *                                                                   CEU004
     C                     CALL 'AOSARDR0'                                CEU004
     C                     PARM *BLANK    PRTCD                           CEU004
     C                     PARM '*KEY   ' POPTN                           CEU004
     C                     PARM 'CEU004'  PSARD   6                       CEU004
     C           SCSARD    PARM SCSARD    DSFDY                           CEU004
      *                                                                   CEU004
     C           PRTCD     IFEQ *BLANK                                    CEU004
     C                     MOVE 'Y'       CEU004  1                       CEU004
     C                     ELSE                                           CEU004
     C                     MOVE 'N'       CEU004                          CEU004
     C           PRTCD     IFNE '*NRF   '                                 CEU004
     C           *LOCK     IN   LDA                                       CEU004
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU004
     C                     Z-ADD025       DBASE            * DBERR 25 *   CEU004
     C                     MOVEL'CEU004'  DBKEY            ************   CEU004
     C                     OUT  LDA                                       CEU004
     C                     EXSR *PSSR                                     CEU004
     C                     ENDIF                                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU020
      ** Check whether SAR CEU020 is installed or not.                    CEU020
      *                                                                   CEU020
     C                     CALL 'AOSARDR0'                                CEU020
     C                     PARM *BLANK    PRTCD                           CEU020
     C                     PARM '*KEY   ' POPTN                           CEU020
     C                     PARM 'CEU020'  PSARD   6                       CEU020
     C           SCSARD    PARM SCSARD    DSFDY                           CEU020
      *                                                                   CEU020
     C           PRTCD     IFEQ *BLANK                                    CEU020
     C                     MOVE 'Y'       CEU020  1                       CEU020
     C                     ELSE                                           CEU020
     C                     MOVE 'N'       CEU020                          CEU020
     C           PRTCD     IFNE '*NRF   '                                 CEU020
     C           *LOCK     IN   LDA                                       CEU020
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU020
     C                     Z-ADD026       DBASE            * DBERR  26*   CEU020
     C                     MOVEL'CEU020'  DBKEY            ************   CEU020
     C                     OUT  LDA                                       CEU020
     C                     EXSR *PSSR                                     CEU020
     C                     ENDIF                                          CEU020
     C                     ENDIF                                          CEU020
     C/COPY WNCPYSRC,LE2120C006
      *
      ** Determine if Data Export for CCRM Limits is active               CDE001
      *                                                                   CDE001
     C                     CALL 'AOSARDR0'                                CDE001
     C                     PARM *BLANKS   PRTCD                           CDE001
     C                     PARM '*VERIFY' POPTN                           CDE001
     C                     PARM 'CDE001'  PSARD                           CDE001
     C           PRTCD     IFEQ *BLANKS                                   CDE001
     C                     MOVE 'Y'       CDE001  1                       CDE001
     C                     ELSE                                           CDE001
     C                     MOVE 'N'       CDE001                          CDE001
     C           PRTCD     IFNE '*NRF    '                                CDE001
     C           *LOCK     IN   LDA                                       CDE001
     C                     MOVEL'SCSARDPD'DBFILE           ************   CDE001
     C                     Z-ADD30        DBASE            * DBERR 30 *   CDE001
     C                     MOVEL'CDE001'  DBKEY            ************   CDE001
     C                     OUT  LDA                                       CDE001
     C                     EXSR *PSSR                                     CDE001
     C                     ENDIF                                          CDE001
     C                     ENDIF                                          CDE001
      *                                                                   CLE014
      ** Determine if Lending Enhancements for BHF-London is active       CLE014
      *                                                                   CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM *BLANKS   PRTCD                           CLE014
     C                     PARM '*VERIFY' POPTN                           CLE014
     C                     PARM 'CLE014'  PSARD                           CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CLE014  1                       CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CLE014                          CLE014
     C           PRTCD     IFNE '*NRF    '                                CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVEL'SCSARDPD'DBFILE                          CLE014
     C                     Z-ADD38        DBASE                           CLE014
     C                     MOVEL'CLE014'  DBKEY                           CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                                       CLE028
      ** Determine if Flat Rate Personal Loans (Rule of 78s) is                               CLE028
      ** installed                                                                            CLE028
      *                                                                                       CLE028
     C                     CALL 'AOSARDR0'                                                    CLE028
     C                     PARM *BLANKS   PRTCD                                               CLE028
     C                     PARM '*VERIFY' POPTN                                               CLE028
     C                     PARM 'CLE028'  PSARD                                               CLE028
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE028
      *                                                                                       CLE028
     C           PRTCD     IFNE *BLANKS                                                       CLE028
     C           PRTCD     ANDNE'*NRF   '                                                     CLE028
     C           *LOCK     IN   LDA                                                           CLE028
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE028
     C                     Z-ADD39        DBASE                                               CLE028
     C                     MOVELPSARD     DBKEY                                               CLE028
     C                     OUT  LDA                                                           CLE028
     C                     EXSR *PSSR                                                         CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           PRTCD     IFEQ *BLANKS                                                       CLE028
     C                     MOVE 'Y'       CLE028  1                                           CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE 'N'       CLE028                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE031
      ** Determine if CLE031 enhancement is on                                                CLE031
      *                                                                                       CLE031
     C                     MOVE 'N'       CLE031  1                                           CLE031
     C                     CALL 'AOSARDR0'                                                    CLE031
     C                     PARM *BLANKS   PRTCD                                               CLE031
     C                     PARM '*KEY   ' POPTN                                               CLE031
     C                     PARM 'CLE031'  PSARD                                               CLE031
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE031
      *                                                                                       CLE031
     C           PRTCD     IFEQ *BLANKS                                                       CLE031
     C                     MOVE 'Y'       CLE031                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PRTCD     IFNE *BLANKS                                                       CLE031
     C           PRTCD     ANDNE'*NRF    '                                                    CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE031
     C                     Z-ADD33        DBASE                                               CLE031
     C                     MOVEL'CLE031'  DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
      ** Check if CLE034 is installed.                                                        CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSARDR0'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM '*VERIFY' POPTN                                               CLE034
     C                     PARM 'CLE034'  PSARD                                               CLE034
      *                                                                                       CLE034
     C           PRTCD     IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'Y'       CLE034  1                                           CLE034
     C                     MOVEL*ON       *IN56                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'N'       CLE034                                              CLE034
     C                     MOVEL*OFF      *IN56                                               CLE034
     C           PRTCD     IFNE '*NRF    '                                                    CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE034
     C                     Z-ADD36        DBASE                                               CLE034
     C                     MOVEL'CLE034'  DBKEY                                               CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      *                                                                                       CAS009
      ** Check if switchable feature CAS009 is installed                                      CAS009
      *                                                                                       CAS009
     C                     CALL 'AOSARDR0'                                                    CAS009
     C                     PARM *BLANKS   PRTCD                                               CAS009
     C                     PARM '*KEY   ' POPTN                                               CAS009
     C                     PARM 'CAS009'  PSARD   6                                           CAS009
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS009
     C           PRTCD     IFEQ *BLANKS                                                       CAS009
     C                     MOVE 'Y'       CAS009  1                                           CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE 'N'       CAS009                                              CAS009
     C           PRTCD     IFNE '*NRF    '                                                    CAS009
     C           *LOCK     IN   LDA                                                           CAS009
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS009
     C                     Z-ADD39        DBASE                                               CAS009
     C                     MOVEL'CAS009'  DBKEY                                               CAS009
     C                     OUT  LDA                                                           CAS009
     C                     EXSR *PSSR                                                         CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Check if CLE002 is installed                                                         CLE134
      *                                                                                       CLE134
     C                     MOVE 'CLE134'  PSARD                                               CLE134
     C                     CALL 'AOSARDR0'WPAR2                                               CLE134
     C           PRTCD     IFEQ *BLANKS                                                       CLE134
     C                     MOVE 'Y'       CLE134  1                                           CLE134
     C                     ELSE                                                               CLE134
     C                     MOVE 'N'       CLE134                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C/COPY WNCPYSRC,LE2120C028
      *                                                                   CDE001
      ** Retrieve Lending ICD
      *
     C           CLE002    IFEQ 'Y'
     C                     CALL 'AOCLNDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDCLND    PARM SDCLND    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCLNDPD'DBFILE           ************
     C                     Z-ADD6         DBASE            * DBERR 06 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Repayment schedule AUTHORISATION
      *
     C           BPREAU    IFEQ 'Y'
     C                     MOVE *ON       *IN24
     C                     ENDIF
      *                                                                   123857
      ** Set on indicator that will disable F11 on auth. as needed        123857
      *                                                                   123857
     C           BPAURV    IFEQ 'Y'                                       123857
     C                     MOVE *ON       *IN87                           123857
     C                     ENDIF                                          123857
      *
     C                     ENDIF
      *
      ** Retrieve Midas module details
      *
     C                     CALL 'AOMMODR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDMMODPD'DBFILE           ************
     C                     Z-ADD7         DBASE            * DBERR 07 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Retrieve general ledger details
      *
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDGELRPD'DBFILE           ************
     C                     Z-ADD8         DBASE            * DBERR 08 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Retrieve retail details
      *
     C           BGRTBN    IFEQ 'Y'
     C                     CALL 'AORETLR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDRETL    PARM SDRETL    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDRETLPD'DBFILE           ************
     C                     Z-ADD9         DBASE            * DBERR 09 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *                                                                                       207629
      ** Check System Value: Use Original Borrower or Purchased From?                         207629
      ** Set up parameter so access object checks LoanCustOriginPurch                         207629
     C                     MOVE *BLANKS   WPARM                                               207629
     C                     MOVEL'LoanC'   WPARM1                                              207629
     C                     MOVEL'ustOr'   WPARM2                                              207629
     C                     MOVEL'iginP'   WPARM3                                              207629
     C                     MOVEL'urch'    WPARM4                                              207629
     C                     MOVELWPARM     SVALK1                                              207629
      ** Check System Value: Allow Repayments in Facility Currency?                           CLE036
      ** Set up parameter so access object checks FacilityCcyRepayment                        CLE036
     C                     MOVE *BLANKS   WPARM                                               CLE036
     C                     MOVEL'Facil'   WPARM1                                              CLE036
     C                     MOVEL'ityCc'   WPARM2                                              CLE036
     C                     MOVEL'yRepa'   WPARM3                                              CLE036
     C                     MOVEL'yment'   WPARM4                                              CLE036
     C                     MOVELWPARM     SVALK2                                              CLE036
      *                                                                                       CLE148
     C                     MOVELSVALTX,1  SVALK3                                              CLE148
      * Call Access object:                                                                   207629
     C                     CALL 'AOSVALR0'                                                    207629
     C                     PARM           RTNCDE  7                                           207629
     C                     PARM           SVALK1 20                                           207629
     C                     PARM           SVAL1 200                                           207629
     C                     PARM           SVALK2 20                                           207629
     C                     PARM           SVAL2 200                                           207629
     C                     PARM           SVALK3 20                                           207629
     C                     PARM           SVAL3 200                                           207629
     C                     PARM           SVALK4 20                                           207629
     C                     PARM           SVAL4 200                                           207629
     C                     PARM           SVALK5 20                                           207629
     C                     PARM           SVAL5 200                                           207629
     C                     PARM           SVALK6 20                                           207629
     C                     PARM           SVAL6 200                                           207629
     C                     PARM           SVALK7 20                                           207629
     C                     PARM           SVAL7 200                                           207629
     C                     PARM           SVALK8 20                                           207629
     C                     PARM           SVAL8 200                                           207629
     C                     PARM           SVALK9 20                                           207629
     C                     PARM           SVAL9 200                                           207629
     C                     PARM           SVALK0 20                                           207629
     C                     PARM           SVAL10200                                           207629
      * If the system value is not found then issue a database error                          207629
      * unless batch mode, in which case default value to 'P'                                 216067
     C           RTNCDE    IFNE '        '                                                    207629
     C           PMODE     IFEQ 'B'                                                           216067
     C                     MOVE 'P'       PPCUST                                              216067
     C                     ELSE                                                               216067
     C           *LOCK     IN   LDA                                                           207629
     C                     MOVEL'SDSVALPD'DBFILE           ************                       207629
     C                     Z-ADD32        DBASE            * DBERR 32 *                       207629
     C                     MOVEL'SVALK1'  DBKEY            ************                       207629
     C                     OUT  LDA                                                           207629
     C                     EXSR *PSSR                                                         207629
     C                     ENDIF                                                              216067
     C                     ELSE                                                               207629
      * Isolate the first character of SVAL1 which = 'P' or 'O'.                              207629
     C                     MOVELSVAL1     WRK01   1        1 character fld                    207629
     C           WRK01     IFEQ 'O'                                                           207629
     C                     MOVE 'O'       PPCUST  1                                           207629
     C                     ELSE                                                               207629
     C                     MOVE 'P'       PPCUST                                              207629
     C                     ENDIF                                                              207629
      * Isolate the first character of SVAL2 which = 'Y' or 'N'.                              CLE036
     C                     MOVELSVAL2     WRK01                                               CLE036
     C           WRK01     IFEQ 'Y'                                                           CLE036
     C                     MOVE 'Y'       FREPAY  1                                           CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE 'N'       FREPAY                                              CLE036
     C                     ENDIF                                                              CLE036
     C                     ENDIF                                                              207629
      *                                                                                       CLE148
     C                     MOVELSVAL3     WALLOW  1                                           CLE148
      *
      ** Array of branch internal customers
      *
     C                     EXSR SRBICA
      *
      ** Move default values to screen header
      *
     C                     MOVE USER      SUSER
     C                     MOVE WSID      SWSID
     C                     MOVE BJMRDT    SRUNA
      *
      ** Depending on the Parameter Mode, open files
      *
     C                     SELEC
     C           PMODE     WHEQ 'I'
     C           PMODE     OREQ 'R'
     C                     OPEN LE2120DF
      *
      ** Write display file header
      *
     C                     WRITELE2120F0
     C           PMODE     IFEQ 'R'
     C                     OPEN LE2120PD
     C                     ENDIF
     C           PMODE     WHEQ 'B'
     C           PMODE     OREQ 'P'
     C                     OPEN LE2120PD
     C           PMODE     IFEQ 'B'
     C                     MOVELPITUSR    @USER
     C**********           Z-ADD1         @ZMGRP                                              CSF002
     C**********           MOVE 'RESC'    @ZICDE                                              CSF002
     C                     MOVEL'00000'   @UNQCD                                              CSF002
     C                     MOVE '01813'   @UNQCD                                              CSF002
     C                     ENDIF
     C                     ENDSL
      *
      ** Set off error indicators
      *
     C                     MOVEA'00000000'*IN,31
     C                     MOVE *OFF      *INKL
      *                                                                   123998
      ** Set up message file for screen error messages                    123998
     C                     MOVEL'LERMSGF 'ZAMSGF                          123998
      *
      ** Clear subfile message queue
      *
     C                     EXSR SRCLRS
      *
     C                     ENDSR
      /EJECT                                                              123998
      *****************************************************************   123998
      * SRTEXT  -  Set up text from message file                      *   123998
      * Called by: All subroutines setting of texts                   *   123998
      * Calls    : None                                               *   123998
      *****************************************************************   123998
     C           SRTEXT    BEGSR                                          123998
      *                                                                   123998
     C                     CALL 'Y2RVMGC'                                 123998
     C                     PARM *BLANKS   PRTCD                           123998
     C                     PARM           ZAMSID           Message Id.    123998
     C                     PARM           ZAMSGF           Message file.  123998
     C                     PARM           ZAMSDA           Message data.  123998
     C                     PARM           ZAMSTX           Messge text    123998
      *                                                                   123998
     C                     ENDSR                                          123998
      /EJECT
      *****************************************************************   159256
      * SRWARN   - Send a warning message if a syndicated loan is     *   159256
      *            being amended, reversed or authorised directly on  *   159256
      *            Midas as Loan Manager should be used to take       *   159256
      *            advantage of the autogeneration process.           *   159256
      * Called by: SRDETL, SRVAL1                                     *   159256
      * Calls    : None                                               *   159256
      *****************************************************************   159256
      *                                                                   159256
     C           SRWARN    BEGSR                                       ** 159256
      *                                                                   159256
     C           PMODE     IFEQ 'I'                                       159256
      *                                                                   188983
      * First fill the program message queue                              188983
      *                                                                   188983
     C           ZAPGMQ    IFEQ *BLANK                                    188983
     C                     MOVEL##PGM     ZAPGMQ                          188983
     C                     END                                            188983
      *                                                                   159256
      ** Only issue the warning once for the same transaction.            159256
      *                                                                   159256
     C           WE232     IFEQ *BLANK                                    159256
     C           WE232     OREQ 'Y'                                       159256
     C           SLOAN     ANDNEW1LNRF                                    159256
     C                     MOVELSLOAN     W1LNRF  6                       159256
      *                                                                   159256
      ** Warn if participation linked to a syndicate                      159256
      *                                                                   159256
     C           PTYPC     IFEQ 64                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYPC     OREQ 66                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYPC     OREQ 68                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C           PTYPC     OREQ 69                                        159256
     C           LNKS      ANDEQ'Y'                                       159256
     C                     MOVE 'LEM0232' ZAMSID                          159256
     C                     EXSR ZASNMS                                    159256
     C                     MOVE 'Y'       WE232   1                       159256
      *                                                                   159256
     C                     ELSE                                           159256
      *                                                                   159256
     C                     MOVE *BLANKS   WE232                           159256
      *                                                                   159256
      ** Warn if loan or direct participation purchased but facility      159256
      ** is syndicated.                                                   159256
      *                                                                   159256
     C           PTYPC     IFEQ 61                                        159256
     C           PTYPC     OREQ 62                                        159256
     C           PTYPC     OREQ 64                                        159256
     C           LNKS      ANDNE'Y'                                       159256
     C           PTYPC     OREQ 68                                        159256
     C           LNKS      ANDNE'Y'                                       159256
      *                                                                   159256
      ** Access facility 'A' record                                       159256
      *                                                                   159256
     C                     MOVE FCUSC     WFCNUM                          159256
     C                     MOVE FTYPC     WFFACT                          159256
     C                     MOVE FSEQC     WFFCNO                          159256
     C                     MOVE 'A'       WFRCTP                          159256
      *                                                                   159256
     C           WKFAC     CHAINFCLTY               N08                   159256
     C           SYIN      IFEQ 'Y'                                       159256
     C                     MOVE 'LEM0232' ZAMSID                          159256
     C                     EXSR ZASNMS                                    159256
     C                     MOVE 'Y'       WE232                           159256
     C                     ENDIF                                          159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDIF                                          159256
     C                     ELSE                                           159256
      *                                                                   159256
     C                     MOVE *BLANKS   WE232                           159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDIF                                          159256
      *                                                                   159256
     C                     ENDSR                                          159256
      *                                                                   159256
      *****************************************************************                       CLE036
      * FRCONV   - Convert Facility ccy amounts to loan currency.     *                       CLE036
      *                                                               *                       CLE036
      * Called by: SRVAL2                                             *                       CLE036
      * Calls    : SRCURR, ZCONV                                      *                       CLE036
      *****************************************************************                       CLE036
      *                                                                                       CLE036
     C           FRCONV    BEGSR                                                              CLE036
      *                                                                                       CLE036
      ** Retrieve exchange rate & convert amount to loan currency:                            CLE036
      *                                                                                       CLE036
     C********** RLDT      IFLT BJRDNB                                                 CLE036 223174
     C           RLDT      IFLT WDAT                                                          223174
     C           RLDT      ANDNE*ZERO                                                         CLE036
     C           NFCE      ANDNE*ZERO                                                         CLE036
     C           NCCY      ANDEQ*BLANKS                                                       CLE036
     C                     Z-ADDNFCE      ZEXCH  138                                          CLE036
     C                     MOVE NFMD      ZMD                                                 CLE036
     C                     ELSE                                                               CLE036
     C                     Z-ADDFCXR      ZEXCH                                               CLE036
     C                     MOVE FMDI      ZMD                                                 CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           ZMD       IFEQ 'D'                                                           CLE036
     C                     MOVE 'M'       ZMD                                                 CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE 'D'       ZMD                                                 CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     MOVE FCCY      WCURR                                               CLE036
     C                     EXSR SRCURR                                                        CLE036
     C                     Z-ADDA6NBDP    ZCDPI                                               CLE036
     C                     MOVE FCCY      ZCCYI                                               CLE036
      *                                                                                       CLE036
     C                     MOVE LCCYC     WCURR                                               CLE036
     C                     EXSR SRCURR                                                        CLE036
     C                     Z-ADDA6NBDP    ZCDPO                                               CLE036
     C                     MOVE LCCYC     ZCCYO                                               CLE036
      *                                                                                       CLE036
     C                     Z-ADDW#LAMT    ZAMTCI                                              CLE036
     C                     EXSR ZCONV                                                         CLE036
      * Save converted amount in workfield for updating files later.                          CLE036
     C                     Z-ADDZAMTCO    WCAMT  150                                          CLE036
      *                                                                                       CLE036
     C                     ENDSR                                                              CLE036
      *                                                                                       CLE036
      *****************************************************************
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *****************************************************************
      *
     C           *PSSR     BEGSR                                       **
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           @RUN      IFEQ *BLANK
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     ENDIF
     C                     CALL 'DBERRCTL'
      *
     C                     ELSE
      *
     C           PMODE     IFNE 'B'                                       120002
     C                     ROLBK
     C                     ENDIF                                          120002
      *
     C           @RUN      IFEQ *BLANK
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     ENDIF
      *
     C                     MOVE 'D'       POMSVR
     C                     MOVE 'E'       WMSEV
     C                     MOVE 'MEM0001' ZAMSID
     C                     EXSR SREROR
      *
     C                     ENDIF
      *
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *
     C/COPY ZSRSRC,ZDATE1Z2
     C/COPY ZSRSRC,ZDATE2Z2
     C/COPY ZSRSRC,ZFRPEDZ3
     C/COPY ZSRSRC,ZALIGNZ2
     C/COPY ZSRSRC,ZEDITZ2                                                                    CLE031
     C/COPY ZSRSRC,ZCHKH
     C/COPY ZSRSRC,ZACCH
     C/COPY ZSRSRC,ZTNLU1Z2
     C/TITLE SR/ZF2C
     C/COPY ZSRSRC,ZF2C
     C/COPY ZSRSRC,ZXRATEZ1                                               127348
     C/COPY ZSRSRC,ZFWDT                                                  CLE009
      /TITLE SR/ZCONV                                                                         CLE036
     C/COPY ZSRSRC,ZCONVZ1                                                                    CLE036
      *
     O*LTRIX***E                LTRIXH                                                      AR322732
     O**********               NORE      11P                                                AR322732
     O**********               RRNA      20P                                                AR322732
     O**********               NLAR      32P                                                AR322732
     O**********               NATN      40P                                                AR322732
      *
      ** Output LTRIX detail record
      *
     O********E*               LTRIXD                                                       AR322732
     OLTRIX   EADD             LTRIXD                                                       AR322732
     O                                    2 'DA'
     O                         SLOAN      8
     O                         WVDAYN    13
     O***********              SSEQN     16                               162494
     O                         LASN      16                               162494
     O***********              SACTN     17                               128094
     O                         CHTP      17                               128094
     O                                   18 'N'
     O                                   19 'N'
     O                                   25 '00001'
     O                                   26 'N'
     O***********              PRI1      27                               128094
     O***********                        27 '1'                    128094 157536
     O                         PRI1      27                               157536
     O                         RRNA      37P
     O                         NATN      40P
     O                                   43 '000'                                           AR322732
     O                                   44 ' '                                             AR322732
     O                                   45 ' '                                             AR322732
     O/COPY WNCPYSRC,LE2120O001
** CWA - Array for watch list fields                                                          CSD015
<Receipt Nostro>                                                                              CSD015
</Receipt Nostro>                                                                             CSD015
<Receipt Intermed Bank>                                                                       CSD015
</Receipt Intermed Bank>                                                                      CSD015
<Receipt Ordering Bank>                                                                       CSD015
</Receipt Ordering Bank>                                                                      CSD015
<Receipt Ordering Cust>                                                                       CSD015
</Receipt Ordering Cust>                                                                      CSD015
<Payment Nostro>                                                                              CSD015
</Payment Nostro>                                                                             CSD015
<Payment Intermed Bank>                                                                       CSD015
</Payment Intermed Bank>                                                                      CSD015
<Payment Ordering Bank>                                                                       CSD015
</Payment Ordering Bank>                                                                      CSD015
<Payment Ordering Cust>                                                                       CSD015
</Payment Ordering Cust>                                                                      CSD015
<Receiver Correspondent>                                                                      CSD015
</Receiver Correspondent>                                                                     CSD015
<Receiver>                                                                                    CSD015
</Receiver>                                                                                   CSD015
<Account With Bank>                                                                           CSD015
</Account With Bank>                                                                          CSD015
<Beneficiary>                                                                                 CSD015
</Beneficiary>                                                                                CSD015
<Details Of Payment>                                                                          CSD015
</Details Of Payment>                                                                         CSD015
** CPY@  **      Copyright statement
(c) Finastra International Limited 2001
**  POWR -- USED IN CURRENCY CONVERSION(FACILITY)
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  POWER -- USED IN ZCONV SUBROUTINE                                                         CLE036
0000001                                                                                       CLE036
0000010                                                                                       CLE036
0000100                                                                                       CLE036
0001000                                                                                       CLE036
0010000                                                                                       CLE036
0100000                                                                                       CLE036
1000000                                                                                       CLE036
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** SVALTX - SYSTEM VALUE KEY TEXT                                                             CLE148
LoanAlphaAllow                                                                                CLE148
