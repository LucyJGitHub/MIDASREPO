     H        1
      *****************************************************************
/*XBI *  OVRDBF FILE(LEIFEELX) TOFILE(LEIFEEL2) SHARE(*NO)            *
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Fees input maintenance')                      *
      *****************************************************************
      *                                                               *
      *  Midas - Customer Lending Module                              *
      *                                                               *
      *  LE2210 - Fees Input Maintenance                              *
      *                                                               *
      *  Function:  This program allows the user to perform various   *
      *             functions relating to the use of loan or facility *
      *             fee.  This could be run in any of the four modes  *
      *             available, depending on the parameter passed      *
      *             to it.                                            *
      *               1. Interactive ('I') - called from the Midas    *
      *                    Transaction Input menu                     *
      *               2. Record ('R') - Run interactively but updates *
      *                    are done to a new 'test harness' file      *
      *               3. Play ('P') - Run interactively but data is   *
      *                    read from the 'test harness' file          *
      *               4. Batch ('B') - Run in batch and called by a   *
      *                    communications control program             *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD055733           Date 03Jul20               *
      *  Prev Amend No. MD052216           Date 04Apr19               *
      *                 CER050             Date 16Jun19               *
      *                 MD053607           Date 19Jul19               *
      *                 MD050139           Date 23Mar18               *
      *                 MD046248           Date 27Oct17               *
      *                 CGL184             Date 07Dec16               *
      *                 CLE141             Date 08Feb16               *
      *                 CSD095             Date 08Apr14               *
      *                 AR868380           Date 11Jun13               *
      *                 260075             Date 15Nov12               *
      *                 263584             Date 09Nov12               *
      *                 261083A            Date 06Oct12               *
      *                 AR682710           Date 02Oct12               *
      *                 AR322732           Date 23Jul12               *
      *                 CLE148             Date 23Jul12               *
      *                 CRE073             Date 06Dec10               *
      *                 CLE143             Date 06Dec10               *
      *                 CLE139             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 CLE073             Date 30Oct08               *
      *                 261340A            Date 04Feb10               *
      *                 261340             Date 10Dec09               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 257053             Date 08Oct08               *
      *                 256822             Date 30Sep08               *
      *                 CSW208             Date 15Apr08               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 BUG12876           Date 12Dec06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 227710             Date 21May04               *
      *                 CLE038             Date 11May04               *
      *                 CAS011             Date 16May05               *
      *                 232314             Date 28Feb05               *
      *                 231710             Date 25Jan04               *
      *                 CAS009             Date 04May04               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3729            Date 21Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CAAA03             Date 07Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 223922             Date 22Dec03               *
      *                 222373             Date 29Oct03               *
      *                 CSF002             Date 11Aug03               *
      *                 CAP074             Date 13Sep03               *
      *                 CLE034             Date 05May03               *
      *                 CLE033             Date 09Apr03               *
      *                 216067             Date 20Mar03               *
      *                 215961             Date 19Mar03               *
      *                 CLE031             Date 04Feb03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CSD015             Date 14Oct02               *
      *                 CLE028             Date 27Jun02               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 188366             Date 07Oct02               *
      *                 200452             Date 13Feb02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 209925             Date 02Oct02               *
      *                 207629             Date 23Aug02               *
      *                 205734             Date 06Jun02               *
      *                 204452             Date 02May02               *
      *                 204463             Date 25Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 22May02               *
      *                 202845             Date 11Feb02               *
      *                 202403             Date 22Jan02               *
      *                 CSC011             Date 07Jan02               *
      *                 186066             Date 27Dec01               *
      *                 199709             Date 20Dec01               *
      *                 199459             Date 20Dec01               *
      *                 193475             Date 29Nov01               *
      *                 193450             Date 09Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CAP064             Date 07Jun01               *
      *                 194509             Date 19Jun01               *
      *                 193772             Date 29May01               *
      *                 192756             Date 01May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE011             Date 07Nov00               *
      *                 187509             Date 26Jan01               *
      *                 186557             Date 22Jan01               *
      *                 187261             Date 16Jan01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CRT004             DATE 04MAY00               *
      *                 181569             Date 02Nov00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 180573             Date 21Jun00               *
      *                 179732             Date 02Jun00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 171859             Date 20Dec99               *
      *                 171462             Date 15Dec99               *
      *                 170111             Date 11Nov99               *
      *                 164499             Date 19Jul99               *
      *                 CLE009             Date 10Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 158838             Date 23May99               *
      *                 160201             Date 13May99               *
      *                 133789 (BT0672)    Date 24Sep98               *
      *                 158634 (BT1438)    Date 02Feb99               *
      *                 158623 (BT1447)    Date 03Feb99               *
      *                 158621 (BT1462)    Date 08Feb99               *
      *                 157302             Date 19Mar99               *
      *                 155772             Date 05Mar99               *
      *                 156227             Date 05Mar99               *
      *                 155610             Date 26Feb99               *
      *                 154799             Date 24Feb99               *
      *                 151295             Date 18Feb99               *
      *                 155685             Date 18Feb99               *
      *                 154113             Date 04Feb99               *
      *                 153348             Date 18Jan99               *
      *                 152169             Date 17Feb99               *
      *                 143791             Date 09Oct98               *
      *                 142447             Date 11Sep98               *
      *                 141453             Date 17Feb99               *
      *                 141351             Date 16Feb99               *
      *                 140814             Date 15Feb99               *
      *                 135748             Date 11Feb99               *
      *                 135351             Date 11Feb99               *
      *                 135152             Date 11Feb99               *
      *                 134972             Date 10Feb99               *
      *                 134284             Date 10Feb99               *
      *                 133870             Date 10Feb99               *
      *                 133789             Date 09Feb99               *
      *                 133237             Date 09Feb99               *
      *                 132949             Date 05Feb99               *
      *                 132282             Date 04Feb99               *
      *                 131253             Date 04Feb99               *
      *                 148323             Date 20Jan99               *
      *                 139832             Date 24AUG98               *
      *                 CEU004             Date 02Feb98               *
      *                 131409             Date 03Mar98               *
      *                 128566             Date 07Jan98               *
      *                 127656             Date 05Nov97               *
      *                 128285             Date 05Nov97               *
      *                 CLE005 *Create     Date 22May97               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD055733 - COB: Multiple UTCHOBJEX calls in LEC06A           *
      *             components.                                       *
      *           - Redeliver of MD050139.                            *
      *  MD052216 - Lending Fee's Payment Due and Taken Day           *
      *             (Recompile)                                       *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  MD053607 - Matured Fee did not appear on fees screen.        *
      *           - Recompile due to changes in LEFHSTL1.             *
      *  MD050139- AOSARDR0 called every time causing performance     *
      *            issue. Recompile due to changes in /COPY           *
      *            ZFREQ/ZFRQ*.                                       *
      *  MD046248 - Finastra Rebranding                               *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  CLE141 - Currency and Location Business Day Convention       *
      *           (Recompile)                                         *
      *  CSD095 - Allow Deal Sub-Type and Branch for MM and FX SSIs   *
      *           (Recompile)                                         *
      *  AR868380 - APISERVER on LCKW status. Return *RECLCK to       *
      *             calling program if file locking occurred on       *
      *             online position files. (Child: AR868381)          *
      *  260075 - Use rundate instead as the original entry date of   *
      *           fees inserted via API.                              *
      *  263584 - Screen field 'Day in Month' not edited correctly.   *
      *  261083A- Fee uploaded from MQ Uploader gives error when      *
      *           enquired from listview. Validate fee currency code  *
      *           all the time, irregardless if the fee has already   *
      *           started.                                            *
      *  AR682710 - Last Change date should always be equal to system *
      *             rundate regardless if batch or interactive mode.  *
      *             LERC14 failed becuse LCD is equal to yesterday    *
      *             taken from PC input file                          *
      *  AR322732 - LEC0212A and APISERVER locks LTRIX file.          *
      *           - Prevent LTRIX RRN 1 from being locked.            *
      *  CLE148 - Alpha Loan Reference                                *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CLE143 - Original Loan Contract Date & Effective Interest    *
      *           Rate (Recompile)                                    *
      *  CLE139 - Lending Fee Capitalisation (Recompile)              *
      *  CLE064 - Enhancement of Lending Frequencies                  *
      *  CLE073 - Calculated Loan Based Fees                          *
      *  261340A- Could not compile successfully due to READ command  *
      *           for LEFEEQD0. Remove line that reads LEFEEQD0.      *
      *  261340 - Does not update PF/LEFEEDQD causing Java screen to  *
      *           show error message that fee record could not be     *
      *           found. Amend program such when fee transaction      *
      *           is processsed thru API, PF/LEFEEDQD will also       *
      *           be updated.                                         *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c             *
      *           (Recompile)                                         *
      *  257053 - Settlemement changes at Mplus for RONS and PONS     *
      *  256822 - Pass Loan Class to AOLOANR0 as parameter.           *
      *  CSW208 - SWIFT 2008 Changes                                  *
      * BUG12876- 1st issue:                                          *
      *           System always validate field date account opened to *
      *           to Fee Start Date. Amend program so the system will *
      *           validate field date account opened against the      *
      *           corresponding date of field 'Payment On'.           *
      *           Use Fee start date as date when 'Payment On'        *
      *           is blank.   Applied fixes 236606 & 211068.          *
      *         - 2nd issue:                                          *
      *           Fee Indicator should not be displayed if CLE006 is  *
      *           switched off. Recompiled due to changes in LE2210DF *
      *           Applied fixed 234543.                               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  227710 - If F3 is pressed in the settlement programs, ensure *
      *           that all database changes are rolled back.          *
      *  CLE038 - Lending Enhancement for Nordea: Allocation by Amount*
      *  CAS011 - EIR/AC Accounting Upgrade to MP1                    *
      *  232314 - TFDP and TFDPA are updated incorrectly              *
      *  231710 - Initialised new fields introduced by CAS009         *
      *  CAS009 - Effective Interest Rate/Amortised Cost Accounting   *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3729 - Deleted fee is displayed with status 'AUTHORISED'. *
      *            Applied fix 224932.                                *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CAAA03 - Webfacing changes.  Format subfile amounts.         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  223922 - Shadow Postings were not updated when amending the  *
      *           Advice/Confirm indicator of the fee.                *
      *  222373 - Parameter Mismatch                                  *
      *  CSF002 - Global layer.                                       *
      *           - Replace previous ZBACT* parameters with the new   *
      *             unique code.                                      *
      *  CAP074 - Lending API enhancements - Loans input.             *
      *           - Addition of TMST field to CLOANCL.                *
      *  CLE034 - Lending Enhancements.                               *
      *  CLE033 - Settlement method 09                                *
      *  216067 - If batch mode do not cause d/b error when System    *
      *           Value LoanCustOriginPurch not present. Instead      *
      *           default to 'P' (purchased from customer)            *
      *  215961 - Payment Branch being blanked.                       *
      *  CLE031 - Lending Enhancements.                               *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enahancements to CAS001, CAS002 and CAS004          *
      *           (Recompile)                                         *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  188366 - Initialise FESTTL with the new settlement method    *
      *           inserted by the user.                               *
      *  200452 - Reversed fix 152169 because the fee exchange rate   *
      *           between facility ccy and fee ccy should not be      *
      *           defaulted if left blank. A blank rate is valid, as  *
      *           then COB calculations will use the daily spot rates.*
      *  209925 - Cannot delete fee. Caused by fix 204463.            *
      *  207629 - Check System Value LoanCustOriginPurch to decide if *
      *           original borrower should be input as the customer of*
      *           a Part Purchased, instead of 'Purchased From' num.  *
      *  205734 - Added validation to prevent next payment date being *
      *           amended to be run date when a fee adjustment exists.*
      *  204452 - Add initialisation of FEAMTW (new field on LEFEED). *
      *  204463 - Do not allow a fee, selected from the subfile, to   *
      *           be deleted if it has already had a settlement.      *
      *  CPK015 - Packaging changes:                                  *
      *           Ensure that message format in sync with file layout *
      *  202845 - Files need to be under program control.             *
      *  202403 - Movement of fields in retreival of batch processing *
      *           details incorrect.                                  *
      *  CSC011 - 24x7 Midas Availability                             *
      *  186066 - Allow cancellation or deletion processing for fees  *
      *           which have been reversed or whose settlement method *
      *           has been amended from 08 to 01. Amend checking for  *
      *           reverse action code in SR/SRSWRI.                   *
      *  199709 - Recompiled due to changes made to DSPF/LE2210DF.    *
      *  199459 - Allow input to sign only if non-calculated fee and  *
      *           fee amount not equal to zero.                       *
      *  193475 - Participant Fee Indicator (PTFI) should always be   *
      *           ' ' (receivable) if CLE006 is OFF.                  *
      *  193450 - Initialise variable PMCSNM with the correct value   *
      *           so that fee settlement to prime retail A/C will     *
      *           be allowed.                                         *
      *  CAP064 - Lending API enhancements - Fees Input               *
      *  194509 - Amended Transactions go to Re-auth and then complete*
      *  193772 - 141351 inadvertently prevents shared fees on        *
      *           non-agented syndicated facilities                   *
      *  192756 - Shared fee indicator SFESHR should be defaulted to  *
      *           'N' if field SHFI on LEFEED is blank.               *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
      *  187509 - A fee can be enquired even if fee sequence no. is   *
      *           not entered on the initial input screen.            *
      *  186557 - Ensure the correct customer number is taken         *
      *           to write in Fees (corrupted by FCUS  - 127656)      *
      *  187261 - Do not display fields linked to Syndications unless *
      *           CLE006 is switched on.                              *
      *  CRT004 - Cashier Midas TCP/IP interface.                     *
      *             Recompiled over SDBRCHPD Changes                  *
      *  181569 - Correct dates should be used in checking holidays   *
      *           for start date, end date and next payment date.     *
      *  180573 - Original message IDs have subsequently been over-   *
      *           written for new programs.                           *
      *  179732 - Application of fix similar to 176510 in LER110.     *
      *           Loan type/Subtype and book used in the Profit Centre*
      *           Default matrix. The correct customer number now     *
      *           parmed to the matrix.                               *
      *         - 146536 DET and SDET should be the same length.      *
      *  171859 - Allow input of a fee when facility used has been    *
      *           reactivated today.                                  *
      *  171462 - Return to first screen if user presses F12 from the *
      *           Extended Settlements screen without validation.     *
      *  170111 - Zero amounts with no decimal places are being       *
      *           displayed out of line with the rest of the amounts. *
      *  164499 - Invalid 'our nostro' message is returned if fee     *
      *           authorised on Loan Manager with EMU settlement ccy. *
      *  CLE009 - Customer Lending Enhancements - SWIFT Message       *
      *           Generation for fees                                 *
      *  158838 - Payment instruction is shown when amending fee even *
      *           though the fee is receivable.                       *
      *  160201 - Incorrect defaulting of the shared fee indicator.   *
      *  133789 - Branch and settlement branch fields contained in    *
      * (BT0672)  the parameter for sd2400/10 are incorrectly set.    *
      *           Also, length of input parameter increased by        *
      *           another fix which became redundant.                 *
      *  158634 - Dates not set up correctly for holiday checks       *
      *  158623 - Should issue warning error if next payment date     *
      *           is a holiday if payment on "next"                   *
      *  158621 - Unable to input loan fee against non-synd part. sold*
      *  157302 - Profit center field protected on the input of a     *
      *           new facility.                                       *
      *  155772 - Perform proper database error when AOOUFEU0 fails   *
      *           for any reason.  Also, set FSTS to 'A' when  fee    *
      *           record is reversed.                                 *
      *  156227 - Added 4 messages to identify a nonexisting loan, a  *
      *           nonreactivated matured loan, a nonlive loan, and an *
      *           invalid customer-loan combination.                  *
      *  155610 - Authorisation processing incorrect if CLE002 is     *
      *           off as manual ICD flags are still on.               *
      *  154799 - Recompiled due to changes in /COPY,ZACCH            *
      *  151295 - Problems authorising repayment schedules            *
      *           Recompiled due to changes in ZCHKH                  *
      *  155685 - Should not be able to enter Next Payment Date the   *
      *           same as the Start Date.                             *
      *  154113 - Unwanted settlement details appearing on screen.    *
      *  153348 - Reset FEAMTA and FEAMTS after chain to LEFEED       *
      *  152169 - Wrong calculation of cross rate and multiply-divide *
      *           indicator from fee ccy to facility ccy when exchange*
      *           rate is blank.                                      *
      *  143791 - Allow Fee settlement in the past                    *
      *  142447 - Trickle Feed message contains blank PCRF field      *
      *           when entering fee interactively.                    *
      *  141453 - Recompiled due to changes in PF/LEFEED              *
      *  141351 - Can't amend settlement instructions for fee.        *
      *  140814 - Should be able to enter shortname as well as        *
      *           customer number on input of fee (Recompiled only)   *
      *  135748 - Extended settlements are not saved correctly to file*
      *  135351 - Allow amendment of Fee Settlement Instruction.      *
      *  135152 - There needs to be a separate standard settlement    *
      *           instruction transaction type for Lending - use of   *
      *           'MM' is not sufficiently flexible                   *
      *  134972 - Problems re-sending a fee from the PC with type 03  *
      *  134284 - Wrong set of settlement instructions are picked up  *
      *           for a message sent from the PC.                     *
      *  133870 - Profit centre is not defaulted when analytical      *
      *           accounting and default flag are on.                 *
      *  133789 - Fee Settlements '05' are defaulting to the account  *
      *           but not including the branch.                       *
      *  133237 - The message format from the PC is incorrectly       *
      *           formatted. The profit centre field should be added  *
      *           at the end of the layout.                           *
      *  132949 - DB error when using ? processing for fee codes -    *
      *           some message id's do not start with a letter.       *
      *  132282 - Rollback should only be issued from LE2010 for      *
      *           batch mode.                                         *
      *  131253 - Accept amendment when CLE005 is *ON and RATF in     *
      *           CLOANCL is 'Y' even if RECI is 'M'.                 *
      *  148323 - Shadow postings not added to RSACMTPD.              *
      *  139832 - Fix 128285 was originally coded as LER001. During   *
      *           scan/replace message IDs were corrupted.            *
      *  CEU004 - LE Settlement Ccy Conversion Upgrade to DBA R2.0    *
      *  131409 - Pgm does not dump for an error during batch mode.   *
      *  128566 - Extended settlement is available only for non-      *
      *           internal fee settlement                             *
      *  127966 - Profit Centre Accounting Development:               *
      *           This fix is already incorporated under the change   *
      *           CLE005.(For information only see LER110)            *
      *  127656 - Incomplete check if loan is syndicated              *
      *  128285 - Status should be complete if CLE002 not installed   *
      *  CLE005 - Customer Lending Enhancements - Others              *
      *                                                               *
      *****************************************************************
     FLE2210DFCF  E                    WORKSTN                        UC
     F                                        SRRN  KSFILE LE2210S0
     FLE2210PDUF  E                    DISK         KINFSR *PSSR A    UC
     FLEFEEDL1UF  E           K        DISK         KCOMIT       A
     F                                              KINFDS INFDS
     F                                              KINFSR *PSSR
     FLEFEEZ  UF  E                    DISK         KCOMIT
     F                                              KINFSR *PSSR
     F***CLOAN** IF  E           K        DISK                                                CSW208
     FCLOAN   UF  E           K        DISK                                                   CSW208
     F            CLOANHHF                          KIGNORE
     F            CLOANCKF                          KIGNORE
     F            CLOANZ1F                          KIGNORE
     F                                              KCOMIT                                    CSW208
     F***LTRIX** UF  F      43            DISK         KINFSR *PSSR                  CSW208 AR322732
     FLTRIX   O   F      45            DISK         KINFSR *PSSR A                          AR322732
     F                                              KCOMIT                                    CSW208
     F                                              KINFDS FLDTX                              CSW208
     F/COPY WNCPYSRC,LEH00591
     FFCLTY   IF  E           K        DISK
     F            FCLTYHHF                          KIGNORE
     F            FCLTYZZF                          KIGNORE
     FLEFEADL2IF  E           K        DISK
     FLEFHSTL1IF  E           K        DISK
     FLEFEEDL0IF  E           K        DISK
     F            LEFEEDF                           KRENAMELEFEEDD0
     FLEFEEDL3IF  E           K        DISK
     F            LEFEEDF                           KRENAMELEFEEDD3
     FLEFCAML3IF  E           K        DISK                               171859
      *                                                                   CAP064
     F*EIFEEL1IF**E***********K        DISK                               CAP064202845
     FLEIFEEL1IF  E           K        DISK                           UC  CAP064202845
     F/COPY WNCPYSRC,LE2210F001
     F            LEIFEEP0                          KRENAMELEIFEEP1       CAP064
     F*EIFEEL2IF**E***********K        DISK                               CAP064202845
     FLEIFEEL2IF  E           K        DISK                           UC  CAP064202845
     F            LEIFEEP0                          KRENAMELEIFEEP2       CAP064
     F*EIFEELXUF**E***********K        DISK                      A        CAP064202845
     FLEIFEELXUF  E           K        DISK                      A    UC  CAP064202845
     F            LEIFEEP0                          KRENAMELEIFEEDL       CAP064
     F                                              KCOMIT                CAP064
      **  24/7 Midas Availability log file                                CSC011
     FAPILOGL0UF  E           K        DISK                           UC  CSC011
     F            APILOGD0                          KRENAMEAPILOGX0       CSC011
     FAPVLOGPDO   E                    DISK                           UC  CSC011
     F                                              KCOMIT                CSC011
     FAPILOGPDO   E                    DISK                           UC  CSC011
     F                                              KCOMIT                CSC011
     F***CLOANL4 UF  E           K        DISK                                         CAS009 232314
     F**********  CLOANCLF                          KRENAMEZ9LNCLF                     CAS009 232314
     FLEEIRDL5UF  E           K        DISK         KCOMIT                                    CAS009
     F            LEEIRDD0                          KRENAMELEEIRDD5                           CAS009
      *
     FSDCWHTL1IF  E           K        DISK                                                   CSD015
      ** Compliance Watch Hit List by Function Type/Identifier/Branch                         CSD015
      *                                                                                       CSD015
     FLEFEEDQDO   E                    DISK         KCOMIT                                    261340
      ** LE Fees record extension file                                                        261340
      *                                                                                       261340
     F/COPY WNCPYSRC,LE2210F002
      /SPACE 3
      *****************************************************************
      *                                                               *
      *    F U N C T I O N   O F   I N D I C A T O R S                *
      *                                                               *
      *    11           SFLCLR                                        *
      *    12           SFLDSPCTL                                     *
      *    13           Display 'Page Keys'                           *
      *    16           CLE034 is installed                           *                       CLE034
      *    19           SFLEND at Subfile Control                     *
      *    20           SFLNXTCHG                                     *
      *    21           ROLLUP                                        *
      *    22           Protect detail screen fields                  *
      *    24           Do not output last sequence no. allocated for *
      *                 Loan Amendment just entered                   *
      *    25           F9 pressed from subfile screen                *
      *    26           Authorisation - F11                           *
      *    27           Deletion - F10                                *
      *    28           Settlements - F14                             *
      *    29           Authorisation required                        *
      *    30           Invalid Action code                           *
      *    31           Invalid Customer no.                          *
      *    32           Invalid Facility type/number                  *
      *    33           Invalid Loan no.                              *
      *    34           Invalid Fee sequence                          *
      *    35           Invalid Review customer                       *
      *    36           Invalid Review Facility type/number           *
      *    37           Invalid Review Loan no.                       *
      *    38           Invalid Review Fee Sequence no.               *
      *    39           Invalid Require authorisation                 *
      *    40           Invalid Fee code                              *
      *    41           Invalid Currency                              *
      *    42           Invalid Amount                                *
      *    43           Invalid Amount sign                           *
      *    44           Invalid Start date                            *
      *    45           Invalid End date                              *
      *    46           Invalid Payment On                            *
      *    47           Invalid Advice/Confirmed indicator            *
      *    48           Invalid Shared fee                            *
      *    49           Invalid Calculation type                      *
      *    50           Invalid Rate 1                                *
      *    51           Invalid Amount 1                              *
      *    52           Invalid Rate 2                                *
      *    53           Invalid Amount 2                              *
      *    54           Invalid Rate 3                                *
      *    55           Invalid Amount 3                              *
      *    56           Invalid Rate 4                                *
      *    57           Invalid Amount 4                              *
      *    58           Invalid Rate 5                                *
      *    59           Invalid Amount 5                              *
      *    60           Invalid Percent indicator                     *
      *    61           Invalid Calculation basis                     *
      *    62           Invalid Exchange rate                         *
      *    63           Invalid Mult/Div indicator                    *
      *    64           Invalid Next Payment date                     *
      *    65           Invalid Frequency                             *
      *    66           Invalid Day in month                          *
      *    67           Invalid Selection on subfile                  *
      *    68           Non display of facility if loan number entered*
      *    69           Non display of loan number if facility entered*
      *    71           Profit Centre amendable                       *   133870
      *    72           Fail on CHAIN/READ commands                   *
      *    74           Numeric testing indicator                     *
      *    75           Work field                                    *                       CLE009
      *    76           Invalid Settlement Allocation                 *                       CLE034
      *    77           Start date has been reached and calc type     *
      *                 entered                                       *
      *    78           Work field                                    *
      *    79           Start date has been reached and Conf ind is on*
      *    80           EOF on subfile read                           *
      *    81           EOF on subfile READC                          *
      *    84           Start date has been reached and pay on = S    *
      *    85           Start date has been reached and pay on = E    *
      *                                                               *
      *****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E                    WCTP   14  14  2
     E                    STAMP   1   1 26                                                    CLE034
     E/COPY WNCPYSRC,LEH00744
     E                    ECTP   17  17  2                                                    CLE073
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZHOLE
     E/COPY ZSRSRC,ZFRPEDZ1
     E/COPY ZSRSRC,ZALIGNZ1
     E/COPY ZSRSRC,ZFREQBZ1
     E                    ODA        16  3               O/L POSIT'N DATES
     E                    OIA        16  8               O/L.POS.LN/DP IN.
     E                    PBA         5  8               PROJ. NOSTRO BALS
     E                    PDA         5  3               PRONO BAL. DATES
     E                    ODN        16  5 0A            O/L POSIT'N DATES
     E                    OIN        16 15 0             O/L.POS.LN/DP IN.
     E                    PBN         5 15 0             PROJ. NOSTRO BALS
     E                    PDN         5  5 0A            PRONO BAL. DATES
     E                    FEEM        5 11 0A            FEE AMOUNTS
     E                    FAM         5 15 0A            FEE AMOUNTS
     E                    FRT         5  7 5A            FEE RATES
     E                    FPC         5  6 3A            FEE PERCENTAGE
     E                    RUN        10  5 0A            FUTURE DATES
     E                    OAM        10 13 0             FUTURE TOTAL DRAW
     E                    FFAM       10 13 0             FUTURE FACILITY A
     E                    CURR      150  3               ALL CCYS
     E                    CSPT      150 13 8             SPOT RATES/CCY
     E                    MTDV      150  1               M/D INDICATOR/CCY
     E                    CCDP      150  1 0             DEC PLACES/CCY
     E                    TXND      150  1 0             Tlx NtcDay/CCY                       CLE009
      *                                                                                       CLE034
     E                    ACUR       20  3                                                    CLE034
      ** Array of Currencies                                                                  CLE034
      *                                                                                       CLE034
     E                    ALOC       20  3                                                    CLE034
      ** Array of Locations                                                                   CLE034
     E/COPY WNCPYSRC,LE2210E001
      *
      /SPACE 3
     E                    OPTAG   1  13 25                                                    CSD015
     E                    CLTAG   1  13 25                                                    CSD015
     E                    SVALTX  1   1 20                                                    CLE148
      ** Watch List fields Open and Close tags                                                CSD015
      *
     ILE2210D0                                                                                CGL029
     I              QQPONS                          Q2PONS                                    CGL029
     I              QQRONS                          Q2RONS                                    CGL029
      *
     ICLOANCLF                                                            131253
      ** Rename field                                                     131253
     I              RECI                            RECIL                 131253
     I              TMST                            TMSTL                                     CAP074
     I              CLAS                            LCLAS                                     256822
      *                                                                                       CSW208
     I*LTRIX***NS       1 CH                                                         CSW208 AR322732
      ***Transaction*index*header**************************************              CSW208 AR322732
     I**********                              1   1 RECID                            CSW208 AR322732
     I**********                              2   2 RCDTD                            CSW208 AR322732
     I**********                              3   80LNRFD                            CSW208 AR322732
     I**********                          P   9  110NORED                            CSW208 AR322732
     I**********                          P  12  140FLSZD                            CSW208 AR322732
     I**********                          P  15  170RRLCD                            CSW208 AR322732
     I**********                          P  18  200RRNAD                            CSW208 AR322732
     I**********                          P  21  230RRLXD                            CSW208 AR322732
     I**********                          P  24  260RRXPD                            CSW208 AR322732
     I**********                          P  27  290NLNRD                            CSW208 AR322732
     I**********                          P  30  320NLARD                            CSW208 AR322732
     I**********                             33  330STPID                            CSW208 AR322732
     I**********                          P  38  400TNLUD                            CSW208 AR322732
      *                                                                                       CSW208
     I********NS       1 CD                                                          CSW208 AR322732
      ***Transaction*index*detail**************************************              CSW208 AR322732
     I**********                              1   1 RECID                            CSW208 AR322732
     I**********                              2   2 RCDTD                            CSW208 AR322732
     I**********                              3   80LNRFD                            CSW208 AR322732
     I**********                              9  130VDATD                            CSW208 AR322732
     I**********                             14  160LASND                            CSW208 AR322732
     I**********                             17  17 CHTPD                            CSW208 AR322732
     I**********                             18  18 CNRQD                            CSW208 AR322732
     I**********                             19  19 CNPRD                            CSW208 AR322732
     I**********                             20  20 REPRD                            CSW208 AR322732
     I**********                             21  250RRLAD                            CSW208 AR322732
     I**********                             26  26 LADID                            CSW208 AR322732
     I**********                             27  270PRI1D                            CSW208 AR322732
     I**********                             32  34 BRCAD                            CSW208 AR322732
     I**********                          P  35  370RRNTD                            CSW208 AR322732
     I**********                          P  38  400TNLUD                            CSW208 AR322732
     I**********                             41  410PRI2D                            CSW208 AR322732
     I**********                             42  420PRI3D                            CSW208 AR322732
     I**********                             43  430PRI4D                            CSW208 AR322732
      *                                                                                       CSW208
     I********NS                                                                     CSW208 AR322732
      ***Catch*all*****************************************************              CSW208 AR322732
     I**********                              1   1 RECID                            CSW208 AR322732
     I***Z9LNCLF                                                                       CAS009 232314
      ***Rename*field                                                                  CAS009 232314
     I**********    RECI                            Z9RECI                             CAS009 232314
     I**********    LNRF                            Z9LNRF                             CAS009 232314
     I**********    RCDT                            Z9RCDT                             CAS009 232314
     I**********    MRIN                            Z9MRIN                             CAS009 232314
     I**********    PTYP                            Z9PTYP                             CAS009 232314
     I**********    CNUM                            Z9CNUM                             CAS009 232314
     I**********    BRCA                            Z9BRCA                             CAS009 232314
     I**********    LTYP                            Z9LTYP                             CAS009 232314
     I**********    SUTP                            Z9SUTP                             CAS009 232314
     I**********    DDAT                            Z9DDAT                             CAS009 232314
     I**********    VDAT                            Z9VDAT                             CAS009 232314
     I**********    MDAT                            Z9MDAT                             CAS009 232314
     I**********    LASQ                            Z9LASQ                             CAS009 232314
     I**********    FCUS                            Z9FCUS                             CAS009 232314
     I**********    FTYP                            Z9FTYP                             CAS009 232314
     I**********    FSEQ                            Z9FSEQ                             CAS009 232314
     I**********    CCY                             Z9CCY                              CAS009 232314
     I**********    CPAM                            Z9CPAM                             CAS009 232314
     I**********    INTC                            Z9INTC                             CAS009 232314
     I**********    INTR                            Z9INTR                             CAS009 232314
     I**********    BRTT                            Z9BRTT                             CAS009 232314
     I**********    BRTE                            Z9BRTE                             CAS009 232314
     I**********    RTSP                            Z9RTSP                             CAS009 232314
     I**********    MARG                            Z9MARG                             CAS009 232314
     I**********    SPIN                            Z9SPIN                             CAS009 232314
     I**********    CHIN                            Z9CHIN                             CAS009 232314
     I**********    WTRT                            Z9WTRT                             CAS009 232314
     I**********    WTIN                            Z9WTIN                             CAS009 232314
     I**********    REPT                            Z9REPT                             CAS009 232314
     I**********    RAMT                            Z9RAMT                             CAS009 232314
     I**********    NRPD                            Z9NRPD                             CAS009 232314
     I**********    RFRQ                            Z9RFRQ                             CAS009 232314
     I**********    RDYN                            Z9RDYN                             CAS009 232314
     I**********    FCCY                            Z9FCCY                             CAS009 232314
     I**********    LIND                            Z9LIND                             CAS009 232314
     I**********    CRSK                            Z9CRSK                             CAS009 232314
     I**********    ACOF                            Z9ACOF                             CAS009 232314
     I**********    NACD                            Z9NACD                             CAS009 232314
     I**********    RELI                            Z9RELI                             CAS009 232314
     I**********    AUTO                            Z9AUTO                             CAS009 232314
     I**********    PSAM                            Z9PSAM                             CAS009 232314
     I**********    BCXR                            Z9BCXR                             CAS009 232314
     I**********    FCXR                            Z9FCXR                             CAS009 232314
     I**********    SDST                            Z9SDST                             CAS009 232314
     I**********    OSDA                            Z9OSDA                             CAS009 232314
     I**********    TSTN                            Z9TSTN                             CAS009 232314
     I**********    MDST                            Z9MDST                             CAS009 232314
     I**********    OMDA                            Z9OMDA                             CAS009 232314
     I**********    TMAN                            Z9TMAN                             CAS009 232314
     I**********    FACO                            Z9FACO                             CAS009 232314
     I**********    RLDT                            Z9RLDT                             CAS009 232314
     I**********    NROD                            Z9NROD                             CAS009 232314
     I**********    RLFQ                            Z9RLFQ                             CAS009 232314
     I**********    RLDY                            Z9RLDY                             CAS009 232314
     I**********    RDFC                            Z9RDFC                             CAS009 232314
     I**********    NBRA                            Z9NBRA                             CAS009 232314
     I**********    NRTS                            Z9NRTS                             CAS009 232314
     I**********    NSIN                            Z9NSIN                             CAS009 232314
     I**********    NCAS                            Z9NCAS                             CAS009 232314
     I**********    AWTP                            Z9AWTP                             CAS009 232314
     I**********    WTRD                            Z9WTRD                             CAS009 232314
     I**********    WTWD                            Z9WTWD                             CAS009 232314
     I**********    IWOD                            Z9IWOD                             CAS009 232314
     I**********    PWOD                            Z9PWOD                             CAS009 232314
     I**********    BMDI                            Z9BMDI                             CAS009 232314
     I**********    FMDI                            Z9FMDI                             CAS009 232314
     I**********    PDIN                            Z9PDIN                             CAS009 232314
     I**********    LSWC                            Z9LSWC                             CAS009 232314
     I**********    LSWS                            Z9LSWS                             CAS009 232314
     I**********    OSDB                            Z9OSDB                             CAS009 232314
     I**********    OMDB                            Z9OMDB                             CAS009 232314
     I**********    ORBR                            Z9ORBR                             CAS009 232314
     I**********    PRFC                            Z9PRFC                             CAS009 232314
     I**********    FCLB                            Z9FCLB                             CAS009 232314
     I**********    MLNR                            Z9MLNR                             CAS009 232314
     I**********    BTIN                            Z9BTIN                             CAS009 232314
     I**********    BLDY                            Z9BLDY                             CAS009 232314
     I**********    OLNO                            Z9OLNO                             CAS009 232314
     I**********    RCSI                            Z9RCSI                             CAS009 232314
     I**********    ICBS                            Z9ICBS                             CAS009 232314
     I**********    IPFR                            Z9IPFR                             CAS009 232314
     I**********    TOTI                            Z9TOTI                             CAS009 232314
     I**********    NIDT                            Z9NIDT                             CAS009 232314
     I**********    IBDT                            Z9IBDT                             CAS009 232314
     I**********    SLID                            Z9SLID                             CAS009 232314
     I**********    AIPD                            Z9AIPD                             CAS009 232314
     I**********    DLRC                            Z9DLRC                             CAS009 232314
     I**********    IACD                            Z9IACD                             CAS009 232314
     I**********    AITC                            Z9AITC                             CAS009 232314
     I**********    TFEP                            Z9TFEP                             CAS009 232314
     I**********    AIAP                            Z9AIAP                             CAS009 232314
     I**********    IPRD                            Z9IPRD                             CAS009 232314
     I**********    IPRM                            Z9IPRM                             CAS009 232314
     I**********    ICTD                            Z9ICTD                             CAS009 232314
     I**********    AIMN                            Z9AIMN                             CAS009 232314
     I**********    RBDT                            Z9RBDT                             CAS009 232314
     I**********    NOPS                            Z9NOPS                             CAS009 232314
     I**********    NCHI                            Z9NCHI                             CAS009 232314
     I**********    IFDY                            Z9IFDY                             CAS009 232314
     I**********    LONI                            Z9LONI                             CAS009 232314
     I**********    CNFI                            Z9CNFI                             CAS009 232314
     I**********    ACEI                            Z9ACEI                             CAS009 232314
     I**********    TLXI                            Z9TLXI                             CAS009 232314
     I**********    CBLI                            Z9CBLI                             CAS009 232314
     I**********    ORED                            Z9ORED                             CAS009 232314
     I**********    LCD                             Z9LCD                              CAS009 232314
     I**********    CHTP                            Z9CHTP                             CAS009 232314
     I**********    TNLU                            Z9TNLU                             CAS009 232314
     I**********    ADDI                            Z9ADDI                             CAS009 232314
     I**********    ORMD                            Z9ORMD                             CAS009 232314
     I**********    ORTI                            Z9ORTI                             CAS009 232314
     I**********    ZZ023A                          Z9023A                             CAS009 232314
     I**********    BOKC                            Z9BOKC                             CAS009 232314
     I**********    COCU                            Z9COCU                             CAS009 232314
     I**********    RECE                            Z9RECE                             CAS009 232314
     I**********    OMDT                            Z9OMDT                             CAS009 232314
     I**********    NIPD                            Z9NIPD                             CAS009 232314
     I**********    NMDT                            Z9NMDT                             CAS009 232314
     I**********    APMI                            Z9APMI                             CAS009 232314
     I**********    RSTM                            Z9RSTM                             CAS009 232314
     I**********    RONS                            Z9RONS                             CAS009 232314
     I**********    RIBN                            Z9RIBN                             CAS009 232314
     I**********    RIBA                            Z9RIBA                             CAS009 232314
     I**********    ROBN                            Z9ROBN                             CAS009 232314
     I**********    ROCN                            Z9ROCN                             CAS009 232314
     I**********    PSTM                            Z9PSTM                             CAS009 232314
     I**********    PONS                            Z9PONS                             CAS009 232314
     I**********    PIBN                            Z9PIBN                             CAS009 232314
     I**********    PIBA                            Z9PIBA                             CAS009 232314
     I**********    POBN                            Z9POBN                             CAS009 232314
     I**********    POCN                            Z9POCN                             CAS009 232314
     I**********    RCRN                            Z9RCRN                             CAS009 232314
     I**********    RCRA                            Z9RCRA                             CAS009 232314
     I**********    RVNO                            Z9RVNO                             CAS009 232314
     I**********    AWBN                            Z9AWBN                             CAS009 232314
     I**********    AWBA                            Z9AWBA                             CAS009 232314
     I**********    BENN                            Z9BENN                             CAS009 232314
     I**********    BENA                            Z9BENA                             CAS009 232314
     I**********    DTP1                            Z9DTP1                             CAS009 232314
     I**********    DTP2                            Z9DTP2                             CAS009 232314
     I**********    DTP3                            Z9DTP3                             CAS009 232314
     I**********    DTP4                            Z9DTP4                             CAS009 232314
     I**********    DCHG                            Z9DCHG                             CAS009 232314
     I**********    BTB1                            Z9BTB1                             CAS009 232314
     I**********    BTB2                            Z9BTB2                             CAS009 232314
     I**********    BTB3                            Z9BTB3                             CAS009 232314
     I**********    BTB4                            Z9BTB4                             CAS009 232314
     I**********    BTB5                            Z9BTB5                             CAS009 232314
     I**********    BTB6                            Z9BTB6                             CAS009 232314
     I**********    CVMR                            Z9CVMR                             CAS009 232314
     I**********    PTFR                            Z9PTFR                             CAS009 232314
     I**********    HLEX                            Z9HLEX                             CAS009 232314
     I**********    FSRP                            Z9FSRP                             CAS009 232314
     I**********    FSGN                            Z9FSGN                             CAS009 232314
     I**********    FPRC                            Z9FPRC                             CAS009 232314
     I**********    TCOF                            Z9TCOF                             CAS009 232314
     I**********    ACPD                            Z9ACPD                             CAS009 232314
     I**********    ACDA                            Z9ACDA                             CAS009 232314
     I**********    ACAJ                            Z9ACAJ                             CAS009 232314
     I**********    ACAP                            Z9ACAP                             CAS009 232314
     I**********    COFD                            Z9COFD                             CAS009 232314
     I**********    COFM                            Z9COFM                             CAS009 232314
     I**********    CFCD                            Z9CFCD                             CAS009 232314
     I**********    NFRS                            Z9NFRS                             CAS009 232314
     I**********    NFSN                            Z9NFSN                             CAS009 232314
     I**********    NFPC                            Z9NFPC                             CAS009 232314
     I**********    PDCF                            Z9PDCF                             CAS009 232314
     I**********    FCTD                            Z9FCTD                             CAS009 232314
     I**********    FWOD                            Z9FWOD                             CAS009 232314
     I**********    DFTP                            Z9DFTP                             CAS009 232314
     I**********    DFST                            Z9DFST                             CAS009 232314
     I**********    MCRA                            Z9MCRA                             CAS009 232314
     I**********    FCRA                            Z9FCRA                             CAS009 232314
     I**********    PDDI                            Z9PDDI                             CAS009 232314
     I**********    PTDI                            Z9PTDI                             CAS009 232314
     I**********    GDPR                            Z9GDPR                             CAS009 232314
     I**********    GDIN                            Z9GDIN                             CAS009 232314
     I**********    LNKS                            Z9LNKS                             CAS009 232314
     I**********    MNSG                            Z9MNSG                             CAS009 232314
     I**********    GASS                            Z9GASS                             CAS009 232314
     I**********    GPRT                            Z9GPRT                             CAS009 232314
     I**********    TOLN                            Z9TOLN                             CAS009 232314
     I**********    LSTS                            Z9LSTS                             CAS009 232314
     I**********    IUSR                            Z9IUSR                             CAS009 232314
     I**********    AUSR                            Z9AUSR                             CAS009 232314
     I**********    XUSR                            Z9XUSR                             CAS009 232314
     I**********    RATF                            Z9RATF                             CAS009 232314
     I**********    CNCF                            Z9CNCF                             CAS009 232314
     I**********    PCRF                            Z9PCRF                             CAS009 232314
     I**********    LPFI                            Z9LPFI                             CAS009 232314
     I**********    PTFC                            Z9PTFC                             CAS009 232314
     I**********    PTFT                            Z9PTFT                             CAS009 232314
     I**********    PTFN                            Z9PTFN                             CAS009 232314
     I**********    PCOB                            Z9PCOB                             CAS009 232314
     I**********    LRLD                            Z9LRLD                             CAS009 232314
     I**********    LMCD                            Z9LMCD                             CAS009 232314
     I**********    SCCY                            Z9SCCY                             CAS009 232314
     I**********    ICCY                            Z9ICCY                             CAS009 232314
     I**********    OINR                            Z9OINR                             CAS009 232314
     I**********    OIDT                            Z9OIDT                             CAS009 232314
     I**********    REPI                            Z9REPI                             CAS009 232314
     I**********    RFDY                            Z9RFDY                             CAS009 232314
     I**********    RFRI                            Z9RFRI                             CAS009 232314
     I**********    RFRT                            Z9RFRT                             CAS009 232314
     I**********    RFAR                            Z9RFAR                             CAS009 232314
     I**********    FSYLDC                          Z9YLDC                             CAS009 232314
     I**********    FSFYLD                          Z9FYLD                             CAS009 232314
     I**********    FSURPL                          Z9URPL                             CAS009 232314
     I**********    FSPLAM                          Z9PLAM                             CAS009 232314
     I**********    FSPLDT                          Z9PLDT                             CAS009 232314
     I**********    FSYUPL                          Z9YUPL                             CAS009 232314
     I**********    FSEFUP                          Z9EFUP                             CAS009 232314
     I**********    FSECUP                          Z9ECUP                             CAS009 232314
     I**********    AIPN                            Z9AIPN                             CAS009 232314
     I**********    AITN                            Z9AITN                             CAS009 232314
     I**********    AIAN                            Z9AIAN                             CAS009 232314
     I**********    IPRN                            Z9IPRN                             CAS009 232314
     I**********    AINN                            Z9AINN                             CAS009 232314
     I**********    TOTN                            Z9TOTN                             CAS009 232314
     I**********    ICTN                            Z9ICTN                             CAS009 232314
     I**********    IWON                            Z9IWON                             CAS009 232314
     I**********    IPNM                            Z9IPNM                             CAS009 232314
     I**********    PDNN                            Z9PDNN                             CAS009 232314
     I**********    FSCPAM                          Z9FSCP                             CAS009 232314
     I**********    TFDP                            Z9TFDP                             CAS009 232314
     I**********    TFDPA                           Z9FDPA                             CAS009 232314
     I**********    TFAM                            Z9TFAM                             CAS009 232314
     I**********    TFAC                            Z9TFAC                             CAS009 232314
     I**********    TFOF                            Z9TFOF                             CAS009 232314
     I**********    AFDP                            Z9AFDP                             CAS009 232314
     I**********    CFDP                            Z9CFDP                             CAS009 232314
     I**********    AMDS                            Z9AMDS                             CAS009 232314
     I**********    AMADJ                           Z9MADJ                             CAS009 232314
     I**********    ANADJ                           Z9NADJ                             CAS009 232314
     I**********    DSAM                            Z9DSAM                             CAS009 232314
     I**********    AMCOST                          Z9AMCO                             CAS009 232314
     I**********    YMCOST                          Z9YMCO                             CAS009 232314
     I**********    YAINT                           Z9YAIN                             CAS009 232314
     ILEFEEDF
      ** Rename fields for subfile use
     I              FSTS                            FEFSTS
     I              IUSR                            FEIUSR
     I              AUSR                            FEAUSR
     I              XUSR                            FEXUSR
     I              PCRF                            FEPCRF
     I              PTFI                            FEPTFI
     I              SHFI                            FESHFI
     I              OSDB                            FEOSDB
     I              OMDB                            FEOMDB
     I              RSTM                            FERSTM
     I              RONS                            FERONS
     I              RIBN                            FERIBN
     I              RIBA                            FERIBA
     I              ROBN                            FEROBN
     I              ROCN                            FEROCN
     I              PSTM                            FEPSTM
     I              PONS                            FEPONS
     I              PIBN                            FEPIBN
     I              PIBA                            FEPIBA
     I              POBN                            FEPOBN
     I              POCN                            FEPOCN
     I              RCRN                            FERCRN
     I              RCRA                            FERCRA
     I              RVNO                            FERVNO
     I              AWBN                            FEAWBN
     I              AWBA                            FEAWBA
     I              BENN                            FEBENN
     I              BENA                            FEBENA
     I              DTP1                            FEDTP1
     I              DTP2                            FEDTP2
     I              DTP3                            FEDTP3
     I              DTP4                            FEDTP4
     I              DCHG                            FEDCHG
     I              BTB1                            FEBTB1
     I              BTB2                            FEBTB2
     I              BTB3                            FEBTB3
     I              BTB4                            FEBTB4
     I              BTB5                            FEBTB5
     I              BTB6                            FEBTB6
     I              CVMR                            FECVMR
     I              GFPT                            FEGFPT
     I              PTAI                            FEPTAI
     I              SMAC                            FESMAC
     I              PCOB                            FEPCOB
      *
     ILEFEEDD0
      ** Rename fields for subfile use
     I              FECNUM                          BFCNUM
     I              FEFACL                          BFFACL
     I              FELOAN                          BFLOAN
     I              FEFSEQ                          BFFSEQ
     I              FEPSTD                          BFPSTD
     I              FEPEND                          BFPEND
     I              FEFAMT                          BFFAMT
     I              FEFCCY                          BFFCCY
     I              FSTS                            BFFSTS
     I              IUSR                            BFIUSR
     I              AUSR                            BFAUSR
     I              FEBRCA                          BFBRCA
      *
     ILEFEEDD3
      ** Rename fields for subfile use
     I              FECNUM                          BFCNUM
     I              FEFACL                          BFFACL
     I              FELOAN                          BFLOAN
     I              FEFSEQ                          BFFSEQ
     I              FEPSTD                          BFPSTD
     I              FEPEND                          BFPEND
     I              FEFAMT                          BFFAMT
     I              FEFCCY                          BFFCCY
     I              FSTS                            BFFSTS
     I              IUSR                            BFIUSR
     I              AUSR                            BFAUSR
     I              FEBRCA                          BFBRCA
      *
     ILEFCAMPF                                                            171859
      ** Rename fields                                                    171859
     I              RECI                            RECIC                 171859
     I              BRCA                            BRCAC                 171859
     I              CNUM                            CNUMC                 171859
     I              FACT                            FACTC                 171859
     I              FCNO                            FCNOC                 171859
     I              RVCR                            RVCRC                 171859
     I              ASTS                            ASTSC                 171859
     I              IUSR                            IUSRC                 171859
     I              AUSR                            AUSRC                 171859
     I              XUSR                            XUSRC                 171859
     I              CHTP                            CHTPC                 171859
      *                                                                   171859
     ILEIFEEP2                                                            CAP064
      ** Rename fields                                                    CAP064
     I              SFLCHT                          ILCHT                 CAP064
     I              SFCNUM                          ICNUM                 CAP064
     I              SFFACT                          IFACT                 CAP064
     I              SFFCNO                          IFCNO                 CAP064
     I              SFLNRF                          ILNRF                 CAP064
     I              SFFSEQ                          IFSEQ                 CAP064
     I              SFECOD                          IECOD                 CAP064
     I              SFECUR                          IECUR                 CAP064
     I              SFEAMT                          IEAMT                 CAP064
     I              SFESGN                          IESGN                 CAP064
     I              SFEPSD                          IEPSD                 CAP064
     I              SFEPED                          IEPED                 CAP064
     I              SFEPON                          IEPON                 CAP064
     I              SFEADV                          IEADV                 CAP064
     I              SFESHR                          IESHR                 CAP064
     I              SFCALT                          ICALT                 CAP064
     I              SFRTE1                          IRTE1                 CAP064
     I              SFAMT1                          IAMT1                 CAP064
     I              SFRTE2                          IRTE2                 CAP064
     I              SFAMT2                          IAMT2                 CAP064
     I              SFRTE3                          IRTE3                 CAP064
     I              SFAMT3                          IAMT3                 CAP064
     I              SFRTE4                          IRTE4                 CAP064
     I              SFAMT4                          IAMT4                 CAP064
     I              SFRTE5                          IRTE5                 CAP064
     I              SFAMT5                          IAMT5                 CAP064
     I              SFPIND                          IPIND                 CAP064
     I              SFCALC                          ICALC                 CAP064
     I              SFEXRT                          IEXRT                 CAP064
     I              SFMDIN                          IMDIN                 CAP064
     I              SFNPYD                          INPYD                 CAP064
     I              SFFREQ                          IFREQ                 CAP064
     I              SFDYIM                          IDYIM                 CAP064
     I              SPRFC                           IPRFC                 CAP064
     I              SFRSTM                          IRSTM                 CAP064
     I              SFRONS                          IRONS                 CAP064
     I              SFROBN                          IROBN                 CAP064
     I              SFROCN                          IROCN                 CAP064
     I              SFRIBN                          IRIBN                 CAP064
     I              SFRIBA                          IRIBA                 CAP064
     I              SFPSTM                          IPSTM                 CAP064
     I              SFPONS                          IPONS                 CAP064
     I              SFPOBN                          IPOBN                 CAP064
     I              SFPOCN                          IPOCN                 CAP064
     I              SFPIBN                          IPIBN                 CAP064
     I              SFPIBA                          IPIBA                 CAP064
     I              SFRCRN                          IRCRN                 CAP064
     I              SFRCRA                          IRCRA                 CAP064
     I              SFRVNO                          IRVNO                 CAP064
     I              SFAWBN                          IAWBN                 CAP064
     I              SFAWBA                          IAWBA                 CAP064
     I              SFBENN                          IBENN                 CAP064
     I              SFBENA                          IBENA                 CAP064
     I              SFDTP1                          IDTP1                 CAP064
     I              SFDTP2                          IDTP2                 CAP064
     I              SFDTP3                          IDTP3                 CAP064
     I              SFDTP4                          IDTP4                 CAP064
     I              SFDCHG                          IDCHG                 CAP064
     I              SFBTB1                          IBTB1                 CAP064
     I              SFBTB2                          IBTB2                 CAP064
     I              SFBTB3                          IBTB3                 CAP064
     I              SFBTB4                          IBTB4                 CAP064
     I              SFBTB5                          IBTB5                 CAP064
     I              SFBTB6                          IBTB6                 CAP064
     I              SFCVMR                          ICVMR                 CAP064
     I              SFICCY                          IICCY                 CAP064
     I              SFSCCY                          ISCCY                                     CLE031
     I              SFREXR                          IREXR                                     CLE031
     I              SFREXI                          IREXI                                     CLE031
     I              SFPSCY                          IPSCY                                     CLE031
     I              SFPEXR                          IPEXR                                     CLE031
     I              SFPEXI                          IPEXI                                     CLE031
     I              SFSTAL                          ISTAL                                     CLE034
     IFLDTX       DS                                                                          CSW208
      *                                                                                       CSW208
      ** Data Structure for LTRIX                                                             CSW208
      *                                                                                       CSW208
     I                                     *STATUS  TXSTS                                     CSW208
      *                                                                                       CSW208
     IA@CPY       DS
      * Copyright array
     I                                        1  80 CPY@
      *
     IPSDS       SDS
      *
      ** Program Status Data Structure - gives Job/Workstation name and
      ** User ID
      *
     I                                     *PROGRAM ##PGM
     I                                      244 253 WSID
     I                                      254 263 USER
      *
     ILDA         DS                            256
      ** Local data area for database error details
      *
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      *
     IRUNDAT    E DSRUNDAT
      ** Standard data area layout for system flags & run date.
     I              AGMBIN                          MBIN
      *
     IDET         DS
      ** Data Structure for Screen Detail
     I                                        1   2 SFECOD
     I                                        3   5 SFECUR
     I                                        6  19 SFEAMT
     I                                       20  20 SFESGN
     I                                       21  26 SFEPSD
     I                                       27  32 SFEPED
     I                                       33  33 SFEPON
     I                                       34  34 SFEADV
     I                                       35  42 SFRTE1
     I                                       43  50 SFRTE2
     I                                       51  58 SFRTE3
     I                                       59  66 SFRTE4
     I                                       67  74 SFRTE5
     I                                       75  85 SFAMT1
     I                                       86  96 SFAMT2
     I                                       97 107 SFAMT3
     I                                      108 118 SFAMT4
     I                                      119 129 SFAMT5
     I                                      130 130 SFPIND
     I                                      131 131 SFCALC
     I                                      132 145 SFEXRT
     I                                      146 146 SFMDIN
     I                                      147 152 SFNPYD
     I                                      153 153 SFFREQ
     I                                      154 155 SFDYIM
     I                                      156 157 SFCALT
     I                                      158 158 SFESHR
     I                                      159 159 SFSTAL                                    CLE034
     I                                       35 146 WCALTP                                    CLE031
     I                                      147 155 WNXTPY                                    CLE031
      *
     IINFDS       DS
      **  Data structure for file status of LEFEE
     I                                     *STATUS  STATUS
      *
     ICMTTXT      DS                            131
      ** Data structure for setup of commitment text
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTNX
     I                                       26  35 USRIDX
     I                                       51  51 LCHTX
     I                                       52  61 CNUMX
     I                                       62  67 LNRFX
     I                                       68  70 FACTX
     I                                       71  72 FCNOX
     I                                       73  74 FSEQX
      *
     I            DS
      ** Data structure to set work amounts
     I                                        1  130WFAMT
     I                                       14  190DDMMYY
     I                                       20  220WFAC3
     I                                       23  350WA13
      *
     I            DS
      ** Data structure to set partial key
     I**********                              1   60WCNUM                                     CSD027
     I                                        1   6 WCNUM                                     CSD027
     I                                        7   90WFAC03
     I                                       10  110WFAC02
     I                                        7  11 WFACL
     I                                        7  110WFAC05
     I**********                             12  170WLOAN                                     CLE148
     I                                       12  17 WLOAN                                     CLE148
     I                                       18  190WFSEQ
     I**********                              1  190WFPKEY                                    CSD027
     I                                        1  19 WFPKEY                                    CSD027
      *
     I            DS
      ** Data structure to check next Next Payment Date
     I                                        1   60WPYDAT
     I                                        1   20WPYD12
     I                                        3   40WPYD34
     I                                        5   60WPYDYY
     I/COPY WNCPYSRC,LE2210I001
      *
     I/COPY ZSRSRC,ZHOLI
     I/COPY ZSRSRC,ZFRPEDZ2
     I/COPY ZSRSRC,ZTNLU1Z1
      *
     ILERSTS    E DSLERSTS
      ** Fees/Profitability enhancement status data area
     I              FACHISD                         WHISST
     I              LERC2030                        LERC20
     I              LERC135                         LERC13
     I              LERC315                         LERC35
     I              LERC425                         LERC42
     I              EOYFLAG                         EOYFLG
      *
     I***PINPP       DS                            944                    127656
     I***PINPP       DS                            948             127656 CEU004
     I***PINPP       DS                            954             CEU004 164499
     I***PINPP       DS                            957             164499 CPK015
     IPINPP     E DSLEF3MFPD                                              CPK015
      ** Transmitted message format
     I                                        1   4 PIMTYP
     I                                        5  20 PITUSR
     I                                       21  36 PITWST
     I                                       37  51 PITREF
     I                                       52  55 PITSEQ
     I                                       56  56 PITACT
     I                                       57  64 PITDST
     I                                       65  72 PITTST
     I                                       73  76 PINRBT
     I                                       77  77 PILTAC
     I                                       78  78 PIPLC                 CAP064
     I***************************************78  80 PIFILL                CAP064
     I                                       79  80 PIFILL                CAP064
     I                                       81  86 PICNUM
     I                                       87  89 PIFACT
     I                                       90  91 PIFCNO
     I                                       92  97 PILNRF
     I                                       98  99 PIFSEQ
     I                                      100 101 PIFCOD
     I                                      102 104 PIFCUR
     I                                      105 118 PIFAMT
     I                                      119 119 PIFSGN
     I                                      120 127 PIFPSD
     I                                      128 135 PIFPED
     I                                      136 136 PIFPON
     I                                      137 137 PIFADV
     I                                      138 139 PICALT
     I                                      140 147 PIRTE1
     I                                      148 155 PIRTE2
     I                                      156 163 PIRTE3
     I                                      164 171 PIRTE4
     I                                      172 179 PIRTE5
     I                                      180 191 PIAMT1
     I                                      192 203 PIAMT2
     I                                      204 215 PIAMT3
     I                                      216 227 PIAMT4
     I                                      228 239 PIAMT5
     I                                      240 240 PIPIND
     I                                      241 241 PICALC
     I                                      242 242 PIFREQ
     I                                      243 244 PIDYIM
     I**************************************245 252 PINPYD                127656
     I**************************************253 253 PIMDIN                127656
     I**************************************254 267 PIEXRT                127656
     I**************************************268 269 PIPSTM                127656
     I**************************************270 284 PIPONS                127656
     I**************************************285 292 PIPREC                127656
     I**************************************293 293 PICVMR                127656
     I**************************************294 299 PIPOCN                127656
     I**************************************300 305 PIPOBN                127656
     I**************************************306 313 PIRCRN                127656
     I**************************************314 348 PIRCRA                127656
     I**************************************349 356 PIPIBN                127656
     I**************************************357 391 PIPIBA                127656
     I**************************************392 399 PIAWBN                127656
     I**************************************400 434 PIAWBA                127656
     I**************************************435 442 PIBENN                127656
     I**************************************443 477 PIBENA                127656
     I**************************************478 479 PIRSTM                127656
     I**************************************480 494 PIRONS                127656
     I**************************************495 500 PIROCN                127656
     I**************************************501 506 PIROBN                127656
     I**************************************507 514 PIRIBN                127656
     I**************************************515 549 PIRIBA                127656
     I**************************************550 689 PIDTPA                127656
     I**************************************550 584 PIDTP1                127656
     I**************************************585 619 PIDTP2                127656
     I**************************************620 654 PIDTP3                127656
     I**************************************655 689 PIDTP4                127656
     I**************************************690 692 PIDCHG                127656
     I**************************************693 902 PIBTBA                127656
     I**************************************693 727 PIBTB1                127656
     I**************************************728 762 PIBTB2                127656
     I**************************************763 797 PIBTB3                127656
     I**************************************798 832 PIBTB4                127656
     I**************************************833 867 PIBTB5                127656
     I**************************************868 902 PIBTB6                127656
     I**************************************903 903 PISHRF                127656
     I**************************************904 904 PIGPDI                127656
     I**************************************905 905 PIPTAI                127656
     I**************************************906 911 PISMAC                127656
     I**************************************912 921 PIIUSR                127656
     I**************************************922 931 PIAUSR                127656
     I**************************************932 941 PIXUSR                127656
     I**************************************942 944 PIPCOB                127656
     I**************************************245 248 PIPRFC          127656133237
     I**************************************249 256 PINPYD          127656133237
     I**************************************257 257 PIMDIN          127656133237
     I**************************************258 271 PIEXRT          127656133237
     I**************************************272 273 PIPSTM          127656133237
     I**************************************274 288 PIPONS          127656133237
     I**************************************289 296 PIPREC          127656133237
     I**************************************297 297 PICVMR          127656133237
     I**************************************298 303 PIPOCN          127656133237
     I**************************************304 309 PIPOBN          127656133237
     I**************************************310 317 PIRCRN          127656133237
     I**************************************318 352 PIRCRA          127656133237
     I**************************************353 360 PIPIBN          127656133237
     I**************************************361 395 PIPIBA          127656133237
     I**************************************396 403 PIAWBN          127656133237
     I**************************************404 438 PIAWBA          127656133237
     I**************************************439 446 PIBENN          127656133237
     I**************************************447 481 PIBENA          127656133237
     I**************************************482 483 PIRSTM          127656133237
     I**************************************484 498 PIRONS          127656133237
     I**************************************499 504 PIROCN          127656133237
     I**************************************505 510 PIROBN          127656133237
     I**************************************511 518 PIRIBN          127656133237
     I**************************************519 553 PIRIBA          127656133237
     I**************************************554 693 PIDTPA          127656133237
     I**************************************554 588 PIDTP1          127656133237
     I**************************************589 623 PIDTP2          127656133237
     I**************************************624 658 PIDTP3          127656133237
     I**************************************659 693 PIDTP4          127656133237
     I**************************************694 696 PIDCHG          127656133237
     I**************************************697 906 PIBTBA          127656133237
     I**************************************697 731 PIBTB1          127656133237
     I**************************************732 766 PIBTB2          127656133237
     I**************************************767 801 PIBTB3          127656133237
     I**************************************802 836 PIBTB4          127656133237
     I**************************************837 871 PIBTB5          127656133237
     I**************************************872 906 PIBTB6          127656133237
     I**************************************907 907 PISHRF          127656133237
     I**************************************908 908 PIGPDI          127656133237
     I**************************************909 909 PIPTAI          127656133237
     I**************************************910 915 PISMAC          127656133237
     I**************************************916 925 PIIUSR          127656133237
     I**************************************926 934 PIAUSR          127656133237
     I**************************************936 945 PIXUSR          127656133237
     I**************************************946 948 PIPCOB          127656133237
     I                                      245 252 PINPYD                133237
     I                                      253 253 PIMDIN                133237
     I                                      254 267 PIEXRT                133237
     I                                      268 269 PIPSTM                133237
     I**********                            270 284 PIPONS                             133237 257053
     I                                      270 284 QXPONS                                    257053
     I                                      285 292 PIPREC                133237
     I                                      293 293 PICVMR                133237
     I                                      294 299 PIPOCN                133237
     I                                      300 305 PIPOBN                133237
     I                                      306 313 PIRCRN                133237
     I                                      314 348 PIRCRA                133237
     I                                      349 356 PIPIBN                133237
     I                                      357 391 PIPIBA                133237
     I                                      392 399 PIAWBN                133237
     I                                      400 434 PIAWBA                133237
     I                                      435 442 PIBENN                133237
     I                                      443 477 PIBENA                133237
     I                                      478 479 PIRSTM                133237
     I**********                            480 494 PIRONS                             133237 257053
     I                                      480 494 QXRONS                                    257053
     I                                      495 500 PIROCN                133237
     I                                      501 506 PIROBN                133237
     I                                      507 514 PIRIBN                133237
     I                                      515 549 PIRIBA                133237
     I                                      550 689 PIDTPA                133237
     I                                      550 584 PIDTP1                133237
     I                                      585 619 PIDTP2                133237
     I                                      620 654 PIDTP3                133237
     I                                      655 689 PIDTP4                133237
     I                                      690 692 PIDCHG                133237
     I                                      693 902 PIBTBA                133237
     I                                      693 727 PIBTB1                133237
     I                                      728 762 PIBTB2                133237
     I                                      763 797 PIBTB3                133237
     I                                      798 832 PIBTB4                133237
     I                                      833 867 PIBTB5                133237
     I                                      868 902 PIBTB6                133237
     I                                      903 903 PISHRF                133237
     I                                      904 904 PIGPDI                133237
     I                                      905 905 PIPTAI                133237
     I                                      906 911 PISMAC                133237
     I                                      912 921 PIIUSR                133237
     I                                      922 931 PIAUSR                133237
     I                                      932 941 PIXUSR                133237
     I                                      942 944 PIPCOB                133237
     I***********                           945 948 PIPRFC         133237 164499
     I***********                           949 951 PISCCY         CEU004 164499
     I***********                           952 954 PIICCY         CEU004 164499
     I                                      945 947 PISCCY                164499
     I                                      948 950 PIICCY                164499
     I                                      951 954 PIPRFC                164499
     I                                      955 957 PIBRCA                164499
     I                                      958 971 PIREXR                                    CLE031
     I                                      972 972 PIREXI                                    CLE031
     I                                      973 975 PIPSCY                                    CLE031
     I                                      976 989 PIPEXR                                    CLE031
     I                                      990 990 PIPEXI                                    CLE031
     I                                      991 991 PISTAL                                    CLE034
     I                                      992 992 PIRPLC                                    257053
     I                                      9931013 PIPONS                                    257053
     I                                     10141034 PIRONS                                    257053
      *
     IPOUTP       DS                            192
      ** Return message format
     I                                        1   4 POMTYP
     I                                        5  20 POTUSR
     I                                       21  36 POTWST
     I                                       37  51 POTREF
     I                                       52  55 POTSEQ
     I                                       56  56 POTACT
     I                                       57  64 POTDST
     I                                       65  72 POTTST
     I                                       73  76 PONRBT
     I                                       77  77 POLTAC
     I                                       78  80 POFILL
     I                                       81  81 POMSVR
     I                                       82  88 POMSID
     I                                       89 166 POMSTX
     I                                      167 172 POCNUM
     I                                      173 175 POFACT
     I                                      176 177 POFCNO
     I                                      178 183 POLNRF
     I                                      184 185 POFSEQ
     I                                      186 186 POPTAI
     I                                      187 192 POSMAC
      *
     I            DS
     I                                        1   6 WDATE
     I                                        1   2 WDD
     I                                        3   4 WMM
     I                                        5   6 WYY
      *
     I            DS
     I                                        1   6 WTIMEA
     I                                        1   2 WHH
     I                                        3   4 WNN
     I                                        5   6 WSS
      *
     I            DS
     I                                        1   8 WPITDS
     I                                        1   2 WPIDD
     I                                        3   4 WPIMM
     I                                        5   6 WPICC                 CSC011
     I                                        7   8 WPIYY
      *
     I            DS
     I                                        1  20 SCRREV
     I                                        1   6 SRCUS
     I                                        7   9 SRFCT
     I                                       10  11 SRFCN
     I                                       12  17 SRLON
     I                                       18  19 SRSEQ
     I                                       20  20 SRAUT
      *
     IZ#BSTS    E DSZ#BST
     IZ#ASTS    E DSZ#AST
     IZ#WSTS    E DSZ#WST
      ** External data structures for update of PRONO, MEMOS etc.
      *
     ISCSARD    E DSSCSARDPD
      ** SAR details
     I              LCD                             LCDX
      *
     ISDBANK    E DSSDBANKPD
      ** External DS for Bank details
      *
     ISDCLND    E DSSDCLNDPD
      ** External DS for Lending ICD Details
      *
     ISDCURR    E DSSDCURRPD
      ** External DS for Currency Details
      *
     ISDTRAD    E DSSDTRADPD
      ** External DS for Trading Details
      *
     ISDRETL    E DSSDRETLPD
     I              QQACCD                          Q1ACCD                                    CGL029
      ** External DS for Retail Details
      *
     ISDNOST    E DSSDNOSTPD
     I              QQACCD                          Q2ACCD                                    CGL029
      ** External DS for Nostro Details
      *
     ISDBRCH    E DSSDBRCHPD
      ** External DS for Branch Codes
      *
     ISDFEE     E DSSDFEEPD
      ** External DS for Fee Details
      *
     ISDCUST    E DSSDCUSTPD
     I              QQDFAC                          Q1DFAC                                    CGL029
      ** External DS for Customer Code Details
      *
     ISDMMOD    E DSSDMMODPD
      ** External DS with Midas Module Details
     I              BGRTBN                          RETF
      *
     ISDPRFC    E DSSDPRFCPD
     I** External DS for Profit Centre Access Program
      *
     ISDGELR    E DSSDGELRPD
     I              QQACCD                          Q3ACCD                                    CGL029
      ** General Ledger ICD Record Details
      *
     ISDEXST    E DSSDEXSTPD                                              154113
      ** External DS for Extended settlement Instruction.                 154113
      *                                                                   154113
     ISDLOAN    E DSSDLOANPD                                                                  CAS009
      ** Loan Type/Sub Type Details                                                           CAS009
      *                                                                                       CAS009
     IDSFDY     E DSDSFDY
      ** Short data structure for access objects
      *
     IDSSDY     E DSDSSDY
      ** Long data structure for access objects
      *
     ISETLIB    E DSSETLIAB
     I              QQPONS                          Q1PONS                                    CGL029
     I              QQRONS                          Q1RONS                                    CGL029
      ** data structure for passing a parameter to synon screen
      *  handling program.
      *
     ISETLIZ    E DSSETLIAZ
      ** data structure for passing a parameter to synon screen
      *  handling program.
     I@PARM3    E DSSDSETLPD                                              222373
      *                                                                   142447
     ILEALLO    E DSLEALLO                                                142447
      * DS for calculating PC reference                                   142447
      *
     IWLFEED    E DSLEFEED
      ** Rename fields for Parameter String                               148323
     I              FSTS                            FEFSTS                148323
     I              IUSR                            FEIUSR                148323
     I              AUSR                            FEAUSR                148323
     I              XUSR                            FEXUSR                148323
     I              PCRF                            FEPCRF                148323
     I              PTFI                            FEPTFI                148323
     I              SHFI                            FESHFI                148323
     I              OSDB                            FEOSDB                148323
     I              OMDB                            FEOMDB                148323
     I              RSTM                            FERSTM                148323
     I              RONS                            FERONS                148323
     I              RIBN                            FERIBN                148323
     I              RIBA                            FERIBA                148323
     I              ROBN                            FEROBN                148323
     I              ROCN                            FEROCN                148323
     I              PSTM                            FEPSTM                148323
     I              PONS                            FEPONS                148323
     I              PIBN                            FEPIBN                148323
     I              PIBA                            FEPIBA                148323
     I              POBN                            FEPOBN                148323
     I              POCN                            FEPOCN                148323
     I              RCRN                            FERCRN                148323
     I              RCRA                            FERCRA                148323
     I              RVNO                            FERVNO                148323
     I              AWBN                            FEAWBN                148323
     I              AWBA                            FEAWBA                148323
     I              BENN                            FEBENN                148323
     I              BENA                            FEBENA                148323
     I              DTP1                            FEDTP1                148323
     I              DTP2                            FEDTP2                148323
     I              DTP3                            FEDTP3                148323
     I              DTP4                            FEDTP4                148323
     I              DCHG                            FEDCHG                148323
     I              BTB1                            FEBTB1                148323
     I              BTB2                            FEBTB2                148323
     I              BTB3                            FEBTB3                148323
     I              BTB4                            FEBTB4                148323
     I              BTB5                            FEBTB5                148323
     I              BTB6                            FEBTB6                148323
     I              CVMR                            FECVMR                148323
     I              GFPT                            FEGFPT                148323
     I              PTAI                            FEPTAI                148323
     I              SMAC                            FESMAC                148323
     I              PCOB                            FEPCOB                148323
      *                                                                   CSC011
      ** ISO format timestamp for 24/7 log                                CSC011
      ** Used as Key in APILOGL0                                          CSC011
     I                                        1  26 TSTISO                CSC011
     I                                        1   4 TSTYY                 CSC011
     I I            '-'                       5   5 TSTF1                 CSC011
     I                                        6   7 TSTMM                 CSC011
     I I            '-'                       8   8 TSTF2                 CSC011
     I                                        9  10 TSTDD                 CSC011
     I I            '-'                      11  11 TSTF3                 CSC011
     I                                       12  19 TSTTM                 CSC011
     I                                       12  13 TSTTM1                CSC011
     I I            '.'                      14  14 TSTF4                 CSC011
     I                                       15  16 TSTTM2                CSC011
     I I            '.'                      17  17 TSTF5                 CSC011
     I                                       18  19 TSTTM3                CSC011
     I I            '.'                      20  20 TSTF6                 CSC011
     I                                       21  26 TSTTM4                CSC011
     I            DS                                                      CSC011
      ** Data Structure to separate time for correct timestamp            CSC011
      **                                                                  CSC011
     I                                        1   8 WTSTM                 CSC011
     I                                        1   2 WTSHR                 CSC011
     I                                        3   4 WTSMN                 CSC011
     I                                        5   6 WTSSC                 CSC011
      *                                                                   CSC011
     IPXML        DS                           9999                                           CSD015
      ** 2ND PARAMETER in XML Format for Compliance Engine Program                            CSD015
      *                                                                                       CSD015
      * 24X7 Data Structure                                               CSC011
     ISC24X7    E DSSC24X7                                                CSC011
      *                                                                   CSC011
      * SDSTAT Data Structure                                             CSC011
     ISDSTAT    E DSSDSTAT                                                CSC011
      *                                                                   CSC011
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      ** Midas Functions for Watch List Checking Details File                                 CSD015
      *                                                                                       CSD015
     ISDCWCD    E DSSDCWCDPD                                                                  CSD015
      ** Midas SD Watch List Configuration Data File                                          CSD015
      *                                                                                       CSD015
     IPSDWLT    E DSSDWLTOPD                                                                  CSD015
      ** Watch List Transaction details file                                                  CSD015
     I/COPY WNCPYSRC,LE2210I002
      *                                                                                       207629
      ** Datastructure to hold input parameter for AOSVALR0.                                  207629
     I            DS                                                                          207629
     I                                        1  20 WPARM                                     207629
     I                                        1   5 WPARM1                                    207629
     I                                        6  10 WPARM2                                    207629
     I                                       11  15 WPARM3                                    207629
     I                                       16  20 WPARM4                                    207629
      *
     I              'LEFSWIFTConf'        C         POPVAL                                    CSW208
      *                                                                                       CSW208
     I/COPY QWINDSRC,LE2210GDTA
      /EJECT
      *****************************************************************
      *                   Index to subroutines                        *
      *  Main routine                                                 *
      *  SRINIT  -  Initial processing                                *
      *  SRSTRT  -  Start of processing for Screen Validation         *
      *  SRDET1  -  First Detail Screen                               *
      *  SRDET2  -  Second Detail Screen                              *
      *  SRFXST  -  Format Extended Settlement Fields                 *
      *  SRBTCH  -  Batch Processing                                  *
      *  SRFISC  -  File fields to screen fields                      *   CAP064
      *  SRSCWK  -  Save screen fields to work fields                 *   CAP064
      *  SRCOMP  -  Compare values of incoming fields with those      *   CAP064
      *             of saved values.                                  *   CAP064
      *  SRVALI  -  Validate Initial Screen                           *
      *  VALERR  -  Action key error                                  *
      *  VALINP  -  Validate Input key                                *
      *  VALAMD  -  Validate Amend and Authorise Key                  *
      *  VALDEL  -  Validate Delete Key                               *
      *  VALENQ  -  Validate Enquire Key                              *
      *  SRVALF  -  Validate Detail Screen Fields                     *
      *  SRCATP  -  Validate Calculation Type                         *
      *  RATE    -  Validate Rates entered                            *
      *  AMNT    -  Validate Amounts entered                          *
      *  SRSWRI  -  Set Swift Msg Regeneration Indicator              *                       CLE009
      *  SRTXDT  -  Set Telex Notice Date                             *                       CLE009
      *  SRWRIT  -  Write a new record in file                        *
      *  SRUPDT  -  Update record                                     *
      *  SRTRAL  -  Update Trailer File                               *
      *  SRUSHD  -  Update Shadow Record                              *
      *  SRVALR  -  Validate Review Fields                            *
      *  SRWIND  -  Window Processing                                 *
      *  SRAUTH  -  Validate authorisation action                     *
      *  TRSFS   -  Format record fields for screen display           *
      *  TRSSTF  -  To convert screen fields to file                  *
      *  SRSAVT  -  Save screen fields to Test Harness File LE2210PD  *
      *  SRRTVT  -  Retrieve Test Harness fields to screen fields     *
      *  SRBDET  -  Retrieve Batch Processing Details                 *
      *  SRFTYP  -  Subroutine to set up Fee type                     *
      *  SEQGEN  -  Subroutine to generate fee sequence number        *
      *  SRAVAL  -  Additional Validation Dependent on Settlement Ins.*
      *  SRSUBF  -  Subfile Processing                                *
      *  SRLOAD  -  Load subfile records                              *
      *  SRSINS  -  Initialise Subfile fields                         *
      *  SRSCLR  -  Subfile Clear                                     *
      *  SRSFMT  -  Format Subfile fields                             *
      *  SRSVAL  -  Subfile Validation                                *
      *  SRPROC  -  Subfile Detail Processing                         *
      *  SRSSET  -  Set-up other fields for Detail Processing         *
      *  SRREVW  -  Set Loan no. from Review from                     *
      *  SRSREV  -  Select records from Review fields                 *
      *  CUSTDT  -  Subroutine to access customer details file        *
      *  SRINS1  -  Initialise all screen/work fields and indicators  *
      *  SCRNER  -  Resets screen error indicators and msgq           *
      *  SRUAUT  -  Check if user is authorised to the action         *
      *  ZASNMS  -  Sends message to the program message queue        *
      *  SRPOUT  -  Return message Format (For Batch only)            *
      *  CLEAR   -  Clears message from the program message queue     *
      *  SREROR  -  Error Processing                                  *
      *  SRBERR  -  Sends error messages for Batch records            *
      *  *PSSR   -  Error handling subroutine                         *
      *****************************************************************
      *
      ** Perform initial processing
      *
     C                     EXSR SRINIT
      *
      ** Perform different detailed processing
      *
     C           WFMT      DOWNE*BLANK
     C           WFMT      CASEQ'F0'      SRSTRT
     C           WFMT      CASEQ'S0'      SRSUBF
     C           WFMT      CASEQ'D1'      SRDET1
     C           WFMT      CASEQ'D2'      SRDET2
     C           WFMT      CASEQ'WR'      SRWRIT
     C           WFMT      CASEQ'UP'      SRUPDT
     C                     ENDCS
     C                     ENDDO
      *                                                                                       CLE034
     C           CLE034    IFNE 'Y'                                                           CLE034
     C           SFSTAL    ORNE 'Y'                                                           CLE034
      *
      ** Close SD2400 program and end this program's processing
      *
     C                     MOVE 'T'       PMTERM
     C                     CALL 'SD2400'
     C                     PARM           PRTCD
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           PSLNRF
     C                     PARM           @PARM3                          222373
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
     C           PMODE     IFNE 'B'                                                           227710
     C           PMODE     ANDNE'P'                                                           227710
     C                     ROLBK                                                              227710
     C                     ENDIF                                                              227710
     C/COPY WNCPYSRC,LEH00843
      *
      ** Terminate program
      *
     C                     MOVE '1'       *INLR
      /EJECT
      *****************************************************************
      * SRINIT  -  Initial Processing                                 *
      * Called by: Main routine                                       *
      * Calls    : SRBTCH - Batch Processing                          *
      *            SRPOUT - Return message Format (For Batch only)    *
      *****************************************************************
     C           SRINIT    BEGSR
      *
      ** Set up copyright parameter
      *
     C                     MOVEACPY@      CPY2@  80
      *
      ** Receive entry parameters
      *
     C           *ENTRY    PLIST
     C                     PARM           PMODE   1
     C                     PARM           PINPP
     C                     PARM           POUTP
     C                     PARM           PTMST  26                                           CLE034
      *
      ** Define dataara LDA
      *
     C           *NAMVAR   DEFN           LDA
      *
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
      *
     C           *NAMVAR   DEFN           LERSTS
     C                     IN   LERSTS
     C*                                                                   CSC011
     C           *NAMVAR   DEFN           SDSTAT                          CSC011
     C*                                                                   CSC011
     C           *NAMVAR   DEFN           SC24X7                          CSC011
     C*                                                                   CSC011
      *
      ** Initialise LDA
      *
     C           *LOCK     IN   LDA
     C                     MOVEL'LE2210'  DBPGM
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD*ZEROS    DBASE
     C                     OUT  LDA
      *
      ** Retrieve bank details
      *
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANKS   PRTCD   7
     C                     PARM '*FIRST ' POPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBANKPD'DBFILE           ************
     C                     Z-ADD1         DBASE            * DBERR 01 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98            MMDDYY
     C                     ENDIF
      *
      ** Retrieve General Ledger Details
      *
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' PRTCD
     C                     PARM '*FIRST ' POPTN
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDGELRPD'DBFILE           ************
     C                     Z-ADD18        DBASE            * DBERR 18 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Retrieve Trading details
      *
     C                     CALL 'AOTRADR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDTRAD    PARM SDTRAD    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDTRADPD'DBFILE           ************
     C                     Z-ADD2         DBASE            * DBERR 02 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Retrieve midas module details
      *
     C                     CALL 'AOMMODR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDMMODPD'DBFILE           ************
     C                     Z-ADD3         DBASE            * DBERR 03 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C*
     C**  Check if Analytical Accounting is installed.
     C*
     C           BGN0ST    IFEQ 'Y'
     C                     MOVE '1'       *IN70
     C                     ELSE
     C                     MOVE '0'       *IN70
     C                     ENDIF
      *
      ** Read SDRETLPD record if retail module on.
      *
     C           RETF      IFEQ 'Y'
     C                     CALL 'AORETLR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDRETL    PARM SDRETL    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDRETLPD'DBFILE           ************
     C                     Z-ADD4         DBASE            * DBERR 04 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     MOVE 'Y'       PMRETP
     C                     MOVE BMRANR    PMRETS
     C                     MOVELBMACCD    PMPCYA
     C                     ENDIF
      *
      ** Retrieve Lending ICD details
      *
     C                     CALL 'AOCLNDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' POPTN
     C           SDCLND    PARM SDCLND    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCLNDPD'DBFILE           ************
     C                     Z-ADD5         DBASE            * DBERR 05 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C/COPY WNCPYSRC,LE2210C013
      *
      ** Determine if Customer Lending Enhancements - Authorisation
      ** feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'CLE002'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE002  1
     C                     ELSE
     C                     MOVE 'N'       CLE002
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD7         DBASE            * DBERR 07 *
     C                     MOVEL'CLE002'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Determine if Customer Lending Enhancements - Backvaluations
      ** feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'CLE003'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE003  1
     C                     ELSE
     C                     MOVE 'N'       CLE003
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD8         DBASE            * DBERR 08 *
     C                     MOVEL'CLE003'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Determine if Customer Lending Enhancements - Syndications
      ** feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'CLE004'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE004  1
     C                     ELSE
     C                     MOVE 'N'       CLE004
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD9         DBASE            * DBERR 09 *
     C                     MOVEL'CLE004'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Determine if Customer Lending Enhancements - Others
      ** feature is installed
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM 'CLE005'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
     C           PRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE005  1
     C                     ELSE
     C                     MOVE 'N'       CLE005
     C           PRTCD     IFNE '*NRF    '
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD10        DBASE            * DBERR 10 *
     C                     MOVEL'CLE005'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *                                                                   187261
      ** Determine if Customer Lending Enhancements - Syndications        187261
      ** feature is installed - CLE006                                    187261
      *                                                                   187261
     C                     CALL 'AOSARDR0'                                187261
     C                     PARM *BLANKS   PRTCD                           187261
     C                     PARM '*KEY   ' POPTN                           187261
     C                     PARM 'CLE006'  PSARD   6                       187261
     C           SCSARD    PARM SCSARD    DSFDY                           187261
     C           PRTCD     IFEQ *BLANKS                                   187261
     C                     MOVE 'Y'       CLE006  1                       187261
     C                     MOVE *ON       *IN14                           187261
     C                     ELSE                                           187261
     C                     MOVE 'N'       CLE006                          187261
     C                     MOVE *OFF      *IN14                           187261
     C           PRTCD     IFNE '*NRF    '                                187261
     C           *LOCK     IN   LDA                                       187261
     C                     MOVEL'SCSARDPD'DBFILE           ************   187261
     C                     Z-ADD25        DBASE            * DBERR 25 *   187261
     C                     MOVEL'CLE006'  DBKEY            ************   187261
     C                     OUT  LDA                                       187261
     C                     EXSR *PSSR                                     187261
     C                     ENDIF                                          187261
     C                     ENDIF                                          187261
      *
      ** Determine if EMU LE Settlement Currency Conversion               CEU004
      ** Upgrade feature is installed                                     CEU004
      *                                                                   CEU004
     C                     CALL 'AOSARDR0'                                CEU004
     C                     PARM *BLANKS   PRTCD                           CEU004
     C                     PARM '*KEY   ' POPTN                           CEU004
     C                     PARM 'CEU004'  PSARD   6                       CEU004
     C           SCSARD    PARM SCSARD    DSFDY                           CEU004
     C           PRTCD     IFEQ *BLANKS                                   CEU004
     C                     MOVE 'Y'       CEU004  1                       CEU004
     C                     ELSE                                           CEU004
     C                     MOVE 'N'       CEU004                          CEU004
     C           PRTCD     IFNE '*NRF    '                                CEU004
     C           *LOCK     IN   LDA                                       CEU004
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU004
     C                     Z-ADD19        DBASE            * DBERR 19 *   CEU004
     C                     MOVEL'CEU004'  DBKEY            ************   CEU004
     C                     OUT  LDA                                       CEU004
     C                     EXSR *PSSR                                     CEU004
     C                     ENDIF                                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CLE033
      ** Access Switchable Feature Details (CLE033)                       CLE033
      *                                                                   CLE033
     C                     MOVE 'N'       CLE033  1                       CLE033
      *                                                                   CLE033
     C                     CALL 'AOSARDR0'                                CLE033
     C                     PARM *BLANKS   @RTCD                           CLE033
     C                     PARM '*VERIFY '@OPTN                           CLE033
     C                     PARM 'CLE033'  @SARD   6                       CLE033
      *                                                                   CLE033
     C           @RTCD     IFEQ *BLANKS                                   CLE033
     C                     MOVE 'Y'       CLE033                          CLE033
      *                                                                   CLE033
     C                     ENDIF                                          CLE033
     C/COPY WNCPYSRC,LE2210C001
      *                                                                   CEU004
      *                                                                   CLE009
      ** Determine if Customer Lending MISC Enhancements                  CLE009
      ** feature is installed                                             CLE009
      *                                                                   CLE009
     C                     CALL 'AOSARDR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*KEY   ' POPTN                           CLE009
     C                     PARM 'CLE007'  PSARD   6                       CLE009
     C           SCSARD    PARM SCSARD    DSFDY                           CLE009
     C           PRTCD     IFEQ *BLANKS                                   CLE009
     C                     MOVE 'Y'       CLE007  1                       CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'N'       CLE007                          CLE009
     C           PRTCD     IFNE '*NRF    '                                CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE009
     C                     Z-ADD20        DBASE            * DBERR 20 *   CLE009
     C                     MOVEL'CLE007'  DBKEY            ************   CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** Determine if Customer Lending Enhancements                       CLE009
      ** Swift Message Genereation for Fees Feature is installed          CLE009
      *                                                                   CLE009
     C           CLE007    IFEQ 'Y'                                       CLE009
     C                     CALL 'AOSARDR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*KEY   ' POPTN                           CLE009
     C                     PARM 'CLE009'  PSARD   6                       CLE009
     C           SCSARD    PARM SCSARD    DSFDY                           CLE009
     C           PRTCD     IFEQ *BLANKS                                   CLE009
     C                     MOVE 'Y'       CLE009  1                       CLE009
     C                     Z-ADD1         Y       30                      CLE009
      *                                                                   CLE009
     C                     CALL 'AOCURRR0'                                CLE009
     C                     PARM *BLANKS   @RTCD                           CLE009
     C                     PARM '*FIRST ' @OPTN                           CLE009
     C                     PARM           PCURR   3                       CLE009
     C           SDCURR    PARM SDCURR    DSSDY                           CLE009
      *                                                                   CLE009
     C                     MOVE A6CYCD    CURR,Y                          CLE009
     C                     MOVE A6TXND    TXND,Y           Telex Nt Day   CLE009
      *                                                                   CLE009
      *                                                                   CLE009
     C           @RTCD     DOWNE'*EOF    '                                CLE009
     C                     CALL 'AOCURRR0'                                CLE009
     C                     PARM *BLANKS   @RTCD                           CLE009
     C                     PARM '*NEXT  ' @OPTN                           CLE009
     C                     PARM           PCURR   3                       CLE009
     C           SDCURR    PARM SDCURR    DSSDY                           CLE009
      *                                                                   CLE009
     C           @RTCD     IFNE '*EOF    '                                CLE009
     C           A6DLCI    ANDEQ'Y'                                       CLE009
      *                                                                   CLE009
     C                     ADD  1         Y                               CLE009
     C                     MOVE A6CYCD    CURR,Y                          CLE009
     C                     MOVE A6TXND    TXND,Y           Telex Nt Day   CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
     C                     ENDDO                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'N'       CLE009                          CLE009
     C           PRTCD     IFNE '*NRF    '                                CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE009
     C                     Z-ADD21        DBASE            * DBERR 21 *   CLE009
     C                     MOVEL'CLE009'  DBKEY            ************   CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'N'       CLE009                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** Determine if Lending API enhancements - Fees Input               CAP064
      ** feature is installed                                             CAP064
      *                                                                   CAP064
     C                     CALL 'AOSARDR0'                                CAP064
     C                     PARM *BLANKS   PRTCD                           CAP064
     C                     PARM '*KEY   ' POPTN                           CAP064
     C                     PARM 'CAP064'  PSARD                           CAP064
     C           SCSARD    PARM SCSARD    DSFDY                           CAP064
     C           PRTCD     IFEQ *BLANKS                                   CAP064
     C                     MOVE 'Y'       CAP064  1                       CAP064
     C                     ELSE                                           CAP064
     C                     MOVE 'N'       CAP064                          CAP064
     C           PRTCD     IFNE '*NRF    '                                CAP064
     C           *LOCK     IN   LDA                                       CAP064
     C                     MOVEL'SCSARDPD'DBFILE           ************   CAP064
     C                     Z-ADD23        DBASE            * DBERR 23 *   CAP064
     C                     MOVEL'CAP064'  DBKEY            ************   CAP064
     C                     OUT  LDA                                       CAP064
     C                     EXSR *PSSR                                     CAP064
     C                     ENDIF                                          CAP064
     C                     ENDIF                                          CAP064
     C/COPY WNCPYSRC,LEH00592
      *                                                                   CAP064
      ** Determine if 24x7 Midas Availability active?                     CSC011
      *                                                                   CSC011
     C                     CALL 'AOSARDR0'                                CSC011
     C                     PARM *BLANKS   PRTCD                           CSC011
     C                     PARM '*KEY   ' POPTN                           CSC011
     C                     PARM 'CSC011'  PSARD                           CSC011
     C           SCSARD    PARM SCSARD    DSFDY                           CSC011
     C           PRTCD     IFEQ *BLANKS                                   CSC011
     C                     MOVE 'Y'       CSC011  1                       CSC011
     C                     ELSE                                           CSC011
     C                     MOVE 'N'       CSC011                          CSC011
     C           PRTCD     IFNE '*NRF    '                                CSC011
     C           *LOCK     IN   LDA                                       CSC011
     C                     MOVEL'SCSARDPD'DBFILE           ************   CSC011
     C                     Z-ADD24        DBASE            * DBERR 24 *   CSC011
     C                     MOVEL'CSC011'  DBKEY            ************   CSC011
     C                     OUT  LDA                                       CSC011
     C                     EXSR *PSSR                                     CSC011
     C                     ENDIF                                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                                       CSW208
      ** Access Switchable Features file for CSW208                                           CSW208
      *                                                                                       CSW208
     C                     CALL 'SWIF2008'                                                    CSW208
     C                     PARM *BLANKS   @RTCD   7                                           CSW208
      *                                                                                       CSW208
     C           @RTCD     IFEQ 'CSW2008'                                                     CSW208
     C                     MOVE 'Y'       CSW208  1                                           CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE 'N'       CSW208                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** Retrieve system values                                                               CSW208
      *                                                                                       CSW208
     C                     MOVE 'N'       LSCONF                                              CSW208
      *                                                                                       CSW208
     C           CSW208    IFEQ 'Y'                                                           CSW208
     C                     MOVELPOPVAL    POP01                                               CSW208
     C                     CALL 'AOSVALR0'                                                    CSW208
     C                     PARM *BLANKS   @RTCD   7                                           CSW208
     C                     PARM           POP01  20                                           CSW208
     C                     PARM           PVL01 200                                           CSW208
     C                     PARM           POP02  20                                           CSW208
     C                     PARM           PVL02 200                                           CSW208
     C                     PARM           POP03  20                                           CSW208
     C                     PARM           PVL03 200                                           CSW208
     C                     PARM           POP04  20                                           CSW208
     C                     PARM           PVL04 200                                           CSW208
     C                     PARM           POP05  20                                           CSW208
     C                     PARM           PVL05 200                                           CSW208
     C                     PARM           POP06  20                                           CSW208
     C                     PARM           PVL06 200                                           CSW208
     C                     PARM           POP07  20                                           CSW208
     C                     PARM           PVL07 200                                           CSW208
     C                     PARM           POP08  20                                           CSW208
     C                     PARM           PVL08 200                                           CSW208
     C                     PARM           POP09  20                                           CSW208
     C                     PARM           PVL09 200                                           CSW208
     C                     PARM           POP10  20                                           CSW208
     C                     PARM           PVL10 200                                           CSW208
      *                                                                                       CSW208
     C           @RTCD     IFEQ *BLANKS                                                       CSW208
     C                     MOVELPVL01     LSCONF  1                                           CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ENDIF                                                              CSW208
     C/COPY WNCPYSRC,LEH00525
      *                                                                                       CLE148
     C                     MOVELSVALTX,1  POP01                                               CLE148
      *
     C                     CALL 'AOSVALR0'                                                    CLE148
     C                     PARM *BLANKS   @RTCD                                               CLE148
     C                     PARM           POP01                                               CLE148
     C                     PARM *BLANKS   PVL01                                               CLE148
     C                     PARM           POP02                                               CLE148
     C                     PARM *BLANKS   PVL02                                               CLE148
     C                     PARM           POP03                                               CLE148
     C                     PARM *BLANKS   PVL03                                               CLE148
     C                     PARM           POP04                                               CLE148
     C                     PARM *BLANKS   PVL04                                               CLE148
     C                     PARM           POP05                                               CLE148
     C                     PARM *BLANKS   PVL05                                               CLE148
     C                     PARM           POP06                                               CLE148
     C                     PARM *BLANKS   PVL06                                               CLE148
     C                     PARM           POP07                                               CLE148
     C                     PARM *BLANKS   PVL07                                               CLE148
     C                     PARM           POP08                                               CLE148
     C                     PARM *BLANKS   PVL08                                               CLE148
     C                     PARM           POP09                                               CLE148
     C                     PARM *BLANKS   PVL09                                               CLE148
     C                     PARM           POP10                                               CLE148
     C                     PARM *BLANKS   PVL10                                               CLE148
      *                                                                                       CLE148
     C           @RTCD     IFEQ *BLANKS                                                       CLE148
     C                     MOVELPVL01     WALLOW  1                                           CLE148
     C                     ENDIF                                                              CLE148
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C*                                                                   CSC011
     C* Is the support system on?                                         CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     Z-ADDS1DATE    WRNDAY  60                      CSC011
     C                     ELSE                                           CSC011
     C                     MOVE BJRDNB    WRNDAY                          CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
      ** Determine if CSD015 enhancement is installed                                         CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSD015  1                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CSD015'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** Database Error (return code other than *NRF)                                         CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVEL'CSD015'  DBKEY                                               CSD015
     C                     MOVEL'LE2210'  DBPGM                                               CSD015
     C                     Z-ADD31        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015                                              CSD015
      *                                                                                       CSD015
      ** Access Compliance Watch Configuration file to get the                                CSD015
      ** Private Customer Industry Codes                                                      CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCWCDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*FIRST ' POPTN                                               CSD015
     C           SDCWCD    PARM SDCWCD    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SDCWCDPD'DBFILE                                              CSD015
     C                     Z-ADD32        DBASE                                               CSD015
     C                     MOVEL'LE2210'  DBPGM                                               CSD015
     C                     MOVELPOPTN     DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if function code is being monitored by compliance watch.                       CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*KEY   ' POPTN                                               CSD015
     C                     PARM 'LENDING' PFUNC   8                                           CSD015
     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE '*NRF    '                                                    CSD015
     C           PRTCD     ANDNE*BLANKS                                                       CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SDWLCCPD'DBFILE                                              CSD015
     C                     Z-ADD33        DBASE                                               CSD015
     C                     MOVELPFUNC     DBKEY                                               CSD015
     C                     MOVEL'LE2210'  DBPGM                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access SAR Details to see if Concord Interface Development (CCF001)                  CSD015
      ** is installed.                                                                        CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CCF001  1                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CCF001'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** Database Error (return code other than *NRF)                                         CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVEL'CCF001'  DBKEY                                               CSD015
     C                     MOVEL'LE2210'  DBPGM                                               CSD015
     C                     Z-ADD34        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CCF001                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Determine if CLE031 enhancement is on                                                CLE031
      *                                                                                       CLE031
     C                     MOVE 'N'       CLE031  1                                           CLE031
     C                     CALL 'AOSARDR0'                                                    CLE031
     C                     PARM *BLANKS   PRTCD                                               CLE031
     C                     PARM '*KEY   ' POPTN                                               CLE031
     C                     PARM 'CLE031'  PSARD                                               CLE031
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE031
      *                                                                                       CLE031
     C           PRTCD     IFEQ *BLANKS                                                       CLE031
     C                     MOVE 'Y'       CLE031                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PRTCD     IFNE *BLANKS                                                       CLE031
     C           PRTCD     ANDNE'*NRF    '                                                    CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'SCSARDPD'DBFILE           ************                       CLE031
     C                     Z-ADD25        DBASE            * DBERR 25 *                       CLE031
     C                     MOVEL'CLE031'  DBKEY            ************                       CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Check if CLE034 is installed.                                                        CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSARDR0'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM '*VERIFY' POPTN                                               CLE034
     C                     PARM 'CLE034'  PSARD                                               CLE034
      *                                                                                       CLE034
     C           PRTCD     IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'Y'       CLE034  1                                           CLE034
     C                     MOVEL*ON       *IN16                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'N'       CLE034                                              CLE034
     C                     MOVEL*OFF      *IN16                                               CLE034
     C           PRTCD     IFNE '*NRF    '                                                    CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE034
     C                     Z-ADD26        DBASE                                               CLE034
     C                     MOVEL'CLE034'  DBKEY                                               CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      *                                                                                       CAS009
      ** Determine if SAR CAS009 is installed                                                 CAS009
      *                                                                                       CAS009
     C                     CALL 'AOSARDR0'                                                    CAS009
     C                     PARM *BLANKS   @RTCD                                               CAS009
     C                     PARM '*VERIFY '@OPTN                                               CAS009
     C                     PARM 'CAS009'  @SARD   6                                           CAS009
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS009
      *                                                                                       CAS009
     C           @RTCD     IFNE *BLANKS                                                       CAS009
     C           @RTCD     ANDNE'*NRF   '                                                     CAS009
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS009
     C                     Z-ADD67        DBASE                                               CAS009
     C                     MOVEL'CAS009'  DBKEY                                               CAS009
     C                     EXSR *PSSR                                                         CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           @RTCD     IFEQ *BLANKS                                                       CAS009
     C                     MOVE 'Y'       CAS009  1                                           CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE 'N'       CAS009                                              CAS009
     C                     ENDIF                                                              CAS009
      *****************************************************************                CAS009 232314
      ***Key*list*for*CLOANL4******************************************                CAS009 232314
     C********** Z9KEY     KLIST                                                       CAS009 232314
     C**********           KFLD           Z9KYID  1                                    CAS009 232314
     C**********           KFLD           Z9LNRF  60                                   CAS009 232314
      *****************************************************************                CAS009 232314
     C/COPY WNCPYSRC,LE2210C009
      *                                                                                       CLE073
      ** Check if feature CLE073 is ON:                                                       CLE073
      *                                                                                       CLE073
     C                     CALL 'AOSARDR0'                                                    CLE073
     C                     PARM *BLANKS   PRTCD                                               CLE073
     C                     PARM '*KEY   ' POPTN                                               CLE073
     C                     PARM 'CLE073'  PSARD                                               CLE073
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE073
     C           PRTCD     IFEQ *BLANKS                                                       CLE073
     C                     MOVE 'Y'       CLE073  1                                           CLE073
     C                     ELSE                                                               CLE073
     C                     MOVE 'N'       CLE073                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Check if authorisation is required
      *
     C           CLE002    IFEQ 'Y'
     C           BPFEAU    ANDEQ'Y'
     C                     MOVE '1'       *IN29
     C                     ENDIF
      *                                                                                       207629
      ** Check System Value: Use Original Borrower or Purchased From?                         207629
      ** Set up parameter so access object checks LoanCustOriginPurch                         207629
     C                     MOVE *BLANKS   WPARM                                               207629
     C                     MOVEL'LoanC'   WPARM1                                              207629
     C                     MOVEL'ustOr'   WPARM2                                              207629
     C                     MOVEL'iginP'   WPARM3                                              207629
     C                     MOVEL'urch'    WPARM4                                              207629
     C                     MOVELWPARM     SVALK1                                              207629
      * Call Access object:                                                                   207629
     C                     CALL 'AOSVALR0'                                                    207629
     C                     PARM           RTNCDE  7                                           207629
     C                     PARM           SVALK1 20                                           207629
     C                     PARM           SVAL1 200                                           207629
     C                     PARM           SVALK2 20                                           207629
     C                     PARM           SVAL2 200                                           207629
     C                     PARM           SVALK3 20                                           207629
     C                     PARM           SVAL3 200                                           207629
     C                     PARM           SVALK4 20                                           207629
     C                     PARM           SVAL4 200                                           207629
     C                     PARM           SVALK5 20                                           207629
     C                     PARM           SVAL5 200                                           207629
     C                     PARM           SVALK6 20                                           207629
     C                     PARM           SVAL6 200                                           207629
     C                     PARM           SVALK7 20                                           207629
     C                     PARM           SVAL7 200                                           207629
     C                     PARM           SVALK8 20                                           207629
     C                     PARM           SVAL8 200                                           207629
     C                     PARM           SVALK9 20                                           207629
     C                     PARM           SVAL9 200                                           207629
     C                     PARM           SVALK0 20                                           207629
     C                     PARM           SVAL10200                                           207629
      * If the system value is not found then issue a database error                          207629
      * unless batch mode, in which case default value to 'P'                                 216067
     C           RTNCDE    IFNE '        '                                                    207629
     C           PMODE     IFEQ 'B'                                                           216067
     C                     MOVE 'P'       PPCUST                                              216067
     C                     ELSE                                                               216067
     C           *LOCK     IN   LDA                                                           207629
     C                     MOVEL'SDSVALPD'DBFILE           ************                       207629
     C                     Z-ADD24        DBASE            * DBERR 24 *                       207629
     C                     MOVEL'SVALK1'  DBKEY            ************                       207629
     C                     OUT  LDA                                                           207629
     C                     EXSR *PSSR                                                         207629
     C                     ENDIF                                                              216067
     C                     ELSE                                                               207629
      * Isolate the first character of SVAL1 which = 'P' or 'O'.                              207629
     C                     MOVELSVAL1     WRK01   1        1 character fld                    207629
     C           WRK01     IFEQ 'O'                                                           207629
     C                     MOVE 'O'       PPCUST  1                                           207629
     C                     ELSE                                                               207629
     C                     MOVE 'P'       PPCUST                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
      *
      ** Define field names
      *
     C           *LIKE     DEFN FESTTL    WSETM
     C           *LIKE     DEFN FESTTL    WNOST
     C           *LIKE     DEFN A7CYCD    WCCY
      *** When DET changes, variable SDET should match new length.        179732
     C           *LIKE     DEFN DET       SDET                            179732
     C           *LIKE     DEFN WTNLU     RRNTD                                             AR322732
      *
     C                     Z-ADD1         WRRN    50
     C                     MOVE '1'       *IN40
     C                     MOVE 'A'       WCLRT
     C                     MOVE 'A'       WRCDT   1
     C                     Z-ADD0         WFAMT
     C                     Z-ADD0         WFAC05
     C**********           Z-ADD0         WLOAN                                               CLE148
     C                     MOVEL*BLANKS   WLOAN                                               CLE148
     C                     Z-ADD0         WFSEQ
     C*                                                                   CLE009
      ** Set up parameter fields                                          CLE009
      ** PLIST for access program AONOSTR0                                CLE009
     C           PLIST1    PLIST                                          CLE009
     C                     PARM '*MSG   ' @RTCD   7                       CLE009
     C                     PARM '*KEY   ' @OPTN   7                       CLE009
     C                     PARM           KCNUM   6                    A  CLE009
     C                     PARM           KCCY    3                    B  CLE009
     C**********           PARM           KEYC1   4                    C  CLE009
     C                     PARM           KEYC1  10                                    CLE009 CAS011
     C                     PARM           KEYD    2                    D  CLE009
     C                     PARM           KNONB   2                    E  CLE009
     C                     PARM           KEYF    3                    F  CLE009
     C                     PARM           KEYG   10                    G  CLE009
     C                     PARM           KEYH    1                    H  CLE009
     C           SDNOST    PARM SDNOST    DSFDY                           CLE009
      *
      ** Set up key fields
      *
      ** KLIST for file FCLTY
     C           KEY001    KLIST
     C                     KFLD           WCNUM
     C                     KFLD           WFAC03
     C                     KFLD           WFAC02
     C                     KFLD           WRCDT
      *
      ** KLIST for file LEFEED
     C           KEY002    KLIST
     C                     KFLD           WCNUM
     C                     KFLD           WFAC05
     C                     KFLD           WLOAN
     C                     KFLD           WFSEQ
      *
      ** KLIST for file CLOAN
     C           KEY004    KLIST
     C                     KFLD           WLOAN
     C                     KFLD           WCLRT   1
      *
      ** KLIST for file LEFEED
     C           KEY005    KLIST
     C                     KFLD           WCNUM
     C                     KFLD           WFAC05
     C                     KFLD           WLOAN
      *
      ** KLIST for file LEFCAMPD                                          171859
     C           KEY006    KLIST                                          171859
     C                     KFLD           CNUM                            171859
     C                     KFLD           FACT                            171859
     C                     KFLD           FCNO                            171859
      *                                                                   171859
      ** KLIST for file LEFHSTL1
     C           KEY012    KLIST
     C                     KFLD           BRCA
     C                     KFLD           WCNUM
     C                     KFLD           WFAC05
     C                     KFLD           WLOAN
     C                     KFLD           WFSEQ
      *
      ** KLIST for file LEFHSTL1
     C           KEY015    KLIST
     C                     KFLD           BRCA
     C                     KFLD           WCNUM
     C                     KFLD           WFAC05
     C                     KFLD           WLOAN
      *
      ** KLIST for file LEFEADL2
      *
     C           FEADKY    KLIST
     C                     KFLD           FEBRCA
     C                     KFLD           FECNUM
     C                     KFLD           FEFACL
     C                     KFLD           FELOAN
     C                     KFLD           FEFSEQ
      *
      ** KLIST for file LEFEEDL0/L3
     C           KSFEED    KLIST
     C**********           KFLD           WKCUS   60                                          CSD027
     C                     KFLD           WKCUS   6                                           CSD027
     C                     KFLD           WKFAC   50
     C**********           KFLD           WKLON   60                                          CLE148
     C                     KFLD           WKLON   6                                           CLE148
     C                     KFLD           WKSEQ   20
      *
      **  Used for APILOGL0                                               CSC011
      *                                                                   CSC011
     C           KAPLOG    KLIST                                          CSC011
     C                     KFLD           KMTYPE  8                       CSC011
     C                     KFLD           KFOID  20                       CSC011
     C                     KFLD           KTSTMP 26                       CSC011
      *                                                                   CSC011
      **  Used for SDCWHTL1                                                                   CSD015
      *                                                                                       CSD015
     C           KCWHT     KLIST                                                              CSD015
     C                     KFLD           K3FUNT  8                                           CSD015
     C                     KFLD           K3IDEN 40                                           CSD015
     C                     KFLD           K3BRCH  3                                           CSD015
      *                                                                                       CSD015
     C                     MOVEL'LERMSGF 'ZAMSGF
      *
      ** Check mode of processing
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C                     OPEN LE2210DF
     C                     MOVEL'F0'      WFMT    2
     C                     ENDIF
      *
     C           PMODE     IFEQ 'R'
     C           PMODE     OREQ 'P'
     C                     OPEN LE2210PD
     C                     ENDIF
      *
     C           PMODE     IFEQ 'F'                                       CAP064
     C                     OPEN LEIFEEL1                                  202845
     C                     OPEN LEIFEEL2                                  202845
     C                     OPEN LEIFEELX                                  202845
     C                     OPEN LE2210DF                                  CAP064
     C                     MOVEL'S0'      WFMT                            CAP064
     C                     MOVE USER      SUSER                           CAP064
     C                     MOVE BJMRDT    SRUNA                           CAP064
     C                     MOVE WSID      SWSID                           CAP064
     C                     MOVE *ON       *IN89                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
     C           PMODE     IFEQ 'B'
     C           PMODE     OREQ 'P'
     C/COPY WNCPYSRC,LEH00526
      *
     C           PMODE     IFEQ 'B'
     C************         OPEN LEIFEELX                            202845CLE031
     C                     OPEN LEIFEEL1                                  CLE031
     C                     MOVELPITUSR    WUSER
     C**********           Z-ADD1         WZMGRP                                              CSF002
     C**********           MOVEL'FEES'    WZICDE                                              CSF002
     C                     MOVEL'00000'   UNQCDE                                              CSF002
     C                     MOVE '02001'   UNQCDE                                              CSF002
     C                     ENDIF
     C/COPY WNCPYSRC,LEH00527
      *
     C                     EXSR SRBTCH
      *
      ** Return Message Format for Batch mode
      *
     C                     EXSR SRPOUT
     C                     MOVE '1'       *INLR
     C                     RETRN
     C                     ENDIF
      *
     C                     MOVE '1'       *IN24
     C                     MOVEL'F0'      WWRTRN  2
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSTRT  -  Start of processing for Screen Validation          *
      * Called by: Main routine                                       *
      * Calls    : SRINS1 - Initialise all screen fields              *
      *            CLEAR  - Clears message from the pgm msg queue     *
      *            SCRNER - Resets screen error indicators and msgq   *
      *            SRVALI - Validate Initial Screen                   *
      *****************************************************************
     C           SRSTRT    BEGSR
      *
      ** Initialise all screen and work fields
      *
     C                     EXSR SRINS1
      *
      ** Display first screen while F0
      *
     C           WFMT      DOWEQ'F0'
     C                     WRITELE2210F0
     C                     WRITELE2210C1
     C                     EXFMTLE2210F1
      *
     C                     EXSR CLEAR
     C                     EXSR SCRNER
      *
     C                     MOVE '0'       *IN22
     C                     MOVE '1'       *IN24
     C                     MOVEA'000'     *IN,26
     C                     MOVE '1'       *IN71                    157302
      *
      ** Exit this subroutine if F3 pressed
      *
     C           *INKC     IFEQ '1'
     C                     MOVE *BLANK    WFMT
     C                     LEAVE
     C                     ENDIF
      *
      ** Return to subfile screen if called from subfile screen
      *
     C           *INKL     IFEQ '1'
     C           *IN25     ANDEQ'1'
     C                     MOVE 'S0'      WFMT
     C                     LEAVE
     C                     ENDIF
      *
      ** Validate Initial Screen
      *
     C                     EXSR SRVALI
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRDET1  -  First Detail Screen                                *
      * Called by: Main processing                                    *
      * Calls    : CLEAR  - Clears message from the pgm message queue *
      *            SCRNER - Resets screen error indicators and msgq   *
      *            SRVALF - Validate Detail Screen Fields             *
      *            SRAVAL - Additional Val. Dependent on Settl. Ins.  *
      *            SRWIND - Window Processing                         *
      *****************************************************************
     C           SRDET1    BEGSR
      *
     C           WFMT      DOWEQ'D1'
      *
     C                     WRITELE2210C1
     C                     WRITELE2210F3
     C                     EXFMTLE2210F4
      *
      **  Enable *INKK if BPAURV is activated
      *
     C           SFLCHT    IFEQ 'X'
     C           BPAURV    ANDEQ'Y'
     C                     MOVE '1'       *INKK
     C                     ENDIF
      *
      ** Check if warning error is outstanding
      *
     C                     MOVE *BLANK    WSKIP
     C           WWFLG     IFEQ 'Y'
     C           WERRF     ANDNE'Y'
     C           DET       IFEQ SDET
     C                     MOVE 'Y'       WSKIP
     C                     MOVE *BLANK    WWFLG
     C                     ENDIF
     C                     ENDIF
      *
      ** Clear message subfile
      *
     C                     EXSR CLEAR
      *
      ** Reset all screen fields indicators
      *
     C                     EXSR SCRNER
      *
     C/COPY WNCPYSRC,LE2210C020
     C           *INKC     IFEQ '1'
     C                     MOVE *BLANK    WFMT
     C                     LEAVE
     C                     ENDIF
      *
     C           *INKL     IFEQ '1'
     C                     MOVE WWRTRN    WFMT
     C                     LEAVE
     C                     ENDIF
      *
      **  Allow user to leave if settlement details have been validated   171462
      **  and nothing new has been changed on first screen.               171462
     C           SFLCHT    IFEQ 'A'                                       171462
     C           #VALID    ANDEQ'Y'                                       171462
     C           *INKN     ANDEQ'0'                                       171462
     C           DET       ANDEQSDET                                      171462
     C                     MOVE 'UP'      WFMT                            171462
     C                     MOVE 'N'       #VALID                          171462
     C                     LEAVE                                          171462
     C                     ELSE                                           171462
     C           SFLCHT    IFEQ 'I'                                       171462
     C           #VALID    ANDEQ'Y'                                       171462
     C           *INKN     ANDEQ'0'                                       171462
     C           DET       ANDEQSDET                                      171462
     C                     MOVE 'WR'      WFMT                            171462
     C                     MOVE 'N'       #VALID                          171462
     C                     LEAVE                                          171462
     C                     ENDIF                                          171462
     C                     ENDIF                                          171462
      *                                                                   171462
      ** Validate first details screen inputs if action is I, A, X
      *
     C           SFLCHT    IFEQ 'I'
     C           WSKIP     ANDEQ*BLANK
     C           SFLCHT    OREQ 'A'
     C           WSKIP     ANDEQ*BLANK
     C           SFLCHT    OREQ 'X'
     C           *INKJ     ANDEQ'0'
     C           *INKK     ANDEQ'0'
     C           *INKN     ANDEQ'0'
      *
     C                     MOVE *BLANK    WWFLG
     C                     MOVE *BLANK    WERRF
      *
     C                     EXSR SRVALF
      *
      ** Check if dates in holiday on action 'X' before display
      *
     C           SFLCHT    IFEQ 'X'
     C                     EXSR SRAVAL
     C                     ENDIF
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           PMODE     OREQ 'F'                                       CAP064
     C           WWFLG     IFEQ 'Y'
     C           WERRF     ANDNE'Y'
     C******************** MOVE DET       SDET  158                       179732
      *** When DET changes, variable SDET should match new length.        179732
     C                     MOVE DET       SDET                            179732
     C                     MOVE 'D1'      WFMT
     C                     ITER
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate if F10 pressed
      * Calculated Fees cannot be deleted if they have already had                            204463
      * a settlement against them. Also, block reversal if there                              204463
      * is an existing record within LEFEEAD.                                                 204463
      *                                                                                       204463
     C           FEADKY    SETLLLEFEEADF                                                      204463
     C           FEADKY    READELEFEEADF                 72                                   204463
      *                                                                                       204463
     C           *INKJ     IFEQ '1'                                                           204463
     C           FECALT    ANDNE*BLANKS                                                       204463
     C           FEAMTS    ANDNE0                                                             204463
     C                     MOVEL'LER0110' ZAMSID                                              204463
     C                     EXSR SREROR                                                        204463
     C                     ELSE                                                               204463
      *                                                                                       204463
     C           *INKJ     IFEQ '1'                                                           204463
     C           FECALT    ANDNE*BLANKS                                                       204463
     C           *IN72     ANDEQ'0'                                                           204463
     C                     MOVEL'LER0414' ZAMSID                                              204463
     C                     EXSR SREROR                                                        204463
      *                                                                                       209925
     C                     ELSE                                                               209925
      *
     C           *INKJ     IFEQ '1'
     C           WERRF     ANDEQ*BLANK
     C                     MOVE 'UP'      WFMT
     C                     ENDIF
      *                                                                                       204463
     C                     ENDIF                                                              204463
     C                     ENDIF                                                              204463
      *
      ** Validate if F11 pressed
      *
     C           *INKK     IFEQ '1'
     C           WERRF     ANDEQ*BLANK
     C***********          MOVE 'UP'      WFMT
     C           WPTFI     IFNE 'I'                                       128566
     C           PMFRST    ANDNE'N'                                       128566
     C                     MOVE 'D2'      WFMT
     C                     ELSE                                           128566
     C                     MOVE 'UP'      WFMT                            128566
     C                     ENDIF                                          128566
     C                     ENDIF
      *
      ** Process Extended Settlement if F14 or Enter pressed
      ** (No Settlement for Internal Fee)
      *
     C           *INKN     IFEQ '1'
     C           WERRF     ANDEQ*BLANK
     C           WERRF     OREQ *BLANK
     C           WPTFI     ANDNE'I'
     C           *INKJ     ANDEQ'0'
     C           *INKK     ANDEQ'0'
     C           WACCPT    ANDEQ*BLANK
     C           SFLCHT    ANDNE'E'
     C           SFLCHT    ANDNE'X'
     C           SFLCHT    ANDNE'D'
     C                     MOVE 'D2'      WFMT
      *
     C                     ENDIF
      *
      ** Enter pressed on enquire will get you back to initial
      ** or subfile screen
      *
     C           WERRF     IFEQ *BLANK
     C           WPTFI     ANDNE'I'
     C           *INKJ     ANDEQ'0'
     C           *INKK     ANDEQ'0'
     C           *INKN     ANDEQ'0'
     C           WACCPT    ANDEQ*BLANK
     C           SFLCHT    ANDEQ'E'
     C           WWBACK    IFEQ 'SP'
     C                     MOVE 'SP'      WFMT
     C                     ELSE
     C                     MOVE WWRTRN    WFMT
     C                     ENDIF
     C                     ENDIF
      *
      ** Enter pressed after Warning error shown after settlement
      ** screen
      *
     C           WERRF     IFEQ *BLANK
     C           WPTFI     ANDNE'I'
     C           *INKJ     ANDEQ'0'
     C           *INKK     ANDEQ'0'
     C           *INKN     ANDEQ'0'
     C           WACCPT    ANDEQ'Y'
     C           DET       IFEQ SDET
     C           SFLCHT    IFEQ 'I'
     C                     MOVE 'WR'      WFMT
     C                     ENDIF
     C           SFLCHT    IFEQ 'A'
     C                     MOVE 'UP'      WFMT
     C                     ENDIF
     C                     ELSE
     C                     MOVE 'D2'      WFMT
     C                     ENDIF
     C                     ENDIF
      *
      ** Write/Update Internal Fees (No Settlements)
      *
     C           WERRF     IFEQ *BLANK
     C           WPTFI     ANDEQ'I'
     C           *INKJ     ANDEQ'0'
     C           *INKK     ANDEQ'0'
     C           *INKN     ANDEQ'0'
      *
     C                     SELEC
     C           SFLCHT    WHEQ 'I'
     C                     MOVE 'WR'      WFMT
     C           SFLCHT    WHEQ 'A'
     C                     MOVE 'UP'      WFMT
     C           SFLCHT    WHEQ 'E'
     C           WWBACK    IFEQ 'SP'
     C                     MOVE 'SP'      WFMT
     C                     ELSE
     C                     MOVE WWRTRN    WFMT
     C                     ENDIF
     C                     ENDSL
      *
     C                     ENDIF
      *
      ** Window Processing
      *
     C           WWFLG     IFEQ *BLANK
     C           WERRF     ANDEQ*BLANK
     C           WACCPT    ANDEQ*BLANK
     C                     EXSR SRWIND
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRDET2  -  Second Detail Screen                               *
      * Called by: Main processing                                    *
      * Calls    : SRFXST - Format Extended Settlement Fields         *
      *            SRAVAL - Addtl Validation dependent of Settl. Ins. *
      *            SREROR  -  Error Processing                        *
      *****************************************************************
     C           SRDET2    BEGSR
      *
     C           WFMT      DOWEQ'D2'
      *
      ** Set on Settlement Details flag and Format fields for
      ** Extended Settlement
      *
     C                     MOVE 'Y'       WSD
     C                     MOVE *BLANK    WACCPT
     C                     EXSR SRFXST
      *
      * If Mode is repair then move all the settlement detail fields      CAP064
      * into DS SETLIB.                                                   CAP064
     C           PMODE     IFEQ 'F'                                       CAP064
     C                     MOVE SFRSTM    PMRSTM                          CAP064
     C                     MOVELSFRONS    PMRONS    P                     CAP064
     C                     MOVELSFROBN    PAROBN    P                     CAP064
     C                     MOVELSFROCN    PAROCN    P                     CAP064
     C                     MOVELSFRIBN    PARIBN    P                     CAP064
     C                     MOVELSFRIBA    PMRIBA    P                     CAP064
     C                     MOVE SFPSTM    PMPSTM                          CAP064
     C                     MOVELSFPONS    PMPONS    P                     CAP064
     C                     MOVELSFPOBN    PAPOBN    P                     CAP064
     C                     MOVELSFPOCN    PAPOCN    P                     CAP064
     C                     MOVELSFPIBN    PAPIBN    P                     CAP064
     C                     MOVELSFPIBA    PMPIBA    P                     CAP064
     C                     MOVELSFRCRN    PARCRN    P                     CAP064
     C                     MOVELSFRCRA    PMRCRA    P                     CAP064
     C                     MOVELSFRVNO    PARVNO    P                     CAP064
     C                     MOVELSFAWBN    PAAWBN    P                     CAP064
     C                     MOVELSFAWBA    PMAWBA    P                     CAP064
     C                     MOVELSFBENN    PABENN    P                     CAP064
     C                     MOVELSFBENA    PMBENA    P                     CAP064
     C                     MOVELSFDTP1    PMDTP1    P                     CAP064
     C                     MOVELSFDTP2    PMDTP2    P                     CAP064
     C                     MOVELSFDTP3    PMDTP3    P                     CAP064
     C                     MOVELSFDTP4    PMDTP4    P                     CAP064
     C                     MOVELSFDCHG    PMDCHG    P                     CAP064
     C                     MOVELSFBTB1    PMBTB1    P                     CAP064
     C                     MOVELSFBTB2    PMBTB2    P                     CAP064
     C                     MOVELSFBTB3    PMBTB3    P                     CAP064
     C                     MOVELSFBTB4    PMBTB4    P                     CAP064
     C                     MOVELSFBTB5    PMBTB5    P                     CAP064
     C                     MOVELSFBTB6    PMBTB6    P                     CAP064
     C                     MOVELSFCVMR    PMCVMR    P                     CAP064
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE SFSCCY    PMRSCY                                              CLE031
     C                     MOVE SFREXR    PMREXR                                              CLE031
     C                     MOVE SFREXI    PMREXI                                              CLE031
     C                     MOVE SFPSCY    PMPSCY                                              CLE031
     C                     MOVE SFPEXR    PMPEXR                                              CLE031
     C                     MOVE SFPEXI    PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                   CAP064
      * Set Protect receipt instructions and Protect Payment              CAP064
      * instructions flags to be 'N'.                                     CAP064
     C                     MOVE 'N'       PMPRCV                          CAP064
     C                     MOVE 'N'       PMPPAY                          CAP064
     C                     ENDIF                                          CAP064
     C/COPY WNCPYSRC,LE2210C003
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SFSTAL    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
      ** For inserts, the Fee Sequence number can be zero.                                    CLE034
      ** This is not a problem. The first settlement allocation record                        CLE034
      ** written by LE2230 will be given a timestamp and used on all                          CLE034
      ** the other settlement allocation records.                                             CLE034
      *                                                                                       CLE034
     C           SFFSEQ    IFEQ *BLANKS                                                       CLE034
     C           SFFSEQ    OREQ *ZEROS                                                        CLE034
      *                                                                                       CLE034
     C                     MOVEL'Y'       WNKEY   1                                           CLE034
     C                     ENDIF                                                              CLE034
     C                     MOVE SFLNRF    PLNRF                                               CLE034
     C                     MOVE SFCNUM    PCNUM                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'LE2230'                                                      CLE034
     C                     PARM 'FEES'    PTYPE   4                                           CLE034
     C                     PARM           PLNRF   6                                           CLE034
     C                     PARM *BLANKS   PVDAT   5                                           CLE034
     C                     PARM *BLANKS   PSEQN   3                                           CLE034
     C                     PARM           PCNUM   6                                           CLE034
     C                     PARM           WFACL                                               CLE034
     C                     PARM           SFFSEQ                                              CLE034
     C                     PARM           SETLIB                                              CLE034
     C                     PARM           SETLIZ                                              CLE034
     C                     PARM           PMODE                                               CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM *BLANKS   PERRF   1                                           CLE034
     C                     PARM *BLANKS   PWARN   1                                           CLE034
     C                     PARM *BLANKS   PSNOS   1                                           CLE034
     C                     PARM *BLANKS   PSAMD   1                                           CLE034
     C                     PARM *BLANKS   PNDET   1                                           CLE034
     C                     PARM *BLANKS   PRCCY  60                                           CLE034
     C                     PARM *BLANKS   PRLOC  60                                           CLE034
     C                     PARM *BLANKS   PPCCY  60                                           CLE034
     C                     PARM *BLANKS   PPLOC  60                                           CLE034
     C                     PARM           FEPCRF                                              CLE034
     C                     PARM *BLANKS   PORED   5                                           CLE038
     C                     PARM *ZERO     PAAMT  130                                          CLE038
      *                                                                                       CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'SD2400'
     C                     PARM           PRCODE  7
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           PSLNRF  6
     C                     PARM           @PARM3                          222373
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C/COPY WNCPYSRC,LE2210C004
      *
      ** If database error terminate processing
      *
     C           PMDBSE    IFNE 0
     C           *LOCK     IN   LDA
     C                     MOVELPMDBFL    DBFILE           ************
     C                     Z-ADDPMDBSE    DBASE            * DBERR XX *
     C                     MOVELPMDBKY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C/COPY WNCPYSRC,LE2210C021
     C                     SELEC
     C           PMCMDP    WHEQ '03'
     C                     MOVE *BLANK    WFMT
     C           PMODE     IFNE 'B'                                                           227710
     C           PMODE     ANDNE'P'                                                           227710
     C                     ROLBK                                                              227710
     C                     ENDIF                                                              227710
      *
     C           PMCMDP    WHEQ '12'
      *
     C           PMSDTV    IFEQ 'Y'
     C           PMSDTV    OREQ 'N'
     C           PMERCD    ANDEQ*BLANK
     C           SFLCHT    ANDNE'D'
     C           SFLCHT    ANDNE'E'
     C           SFLCHT    ANDNE'X'
     C           SFLCHT    OREQ 'X'
     C           WWFLG     ANDNE*BLANK
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           PMSDTV    ANDEQ'N'                                                           CLE034
     C           PMERCD    ANDEQ*BLANKS                                                       CLE034
     C                     MOVE 'N'       SFSTAL                                              CLE034
     C                     ENDIF                                                              CLE034
      *
     C                     EXSR SRSCRN                                    133789
     C                     EXSR SRAVAL
      *
      * Redisplay first screen after User leaves Settlements screen       171462
     C           SFLCHT    IFEQ 'I'
     C***********          MOVE 'WR'      WFMT                            171462
     C                     MOVE 'D1'      WFMT                            171462
     C                     ENDIF
      *
     C           SFLCHT    IFEQ 'A'
     C***********          MOVE 'UP'      WFMT                            171462
     C                     MOVE 'D1'      WFMT                            171462
     C                     ENDIF
      *
      ** Redisplay Detail screen if Warning message exists
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           PMODE     OREQ 'F'                                       CAP064
     C           WWFLG     IFEQ 'Y'
     C           WERRF     ANDNE'Y'
     C                     MOVE DET       SDET
     C                     MOVE 'D1'      WFMT
     C                     MOVE 'Y'       WACCPT
     C           SFLCHT    IFEQ 'X'
     C                     MOVE '1'       *IN22
     C           *INKK     IFEQ '1'
     C                     MOVE 'UP'      WFMT
     C                     ENDIF
     C                     ELSE
     C                     MOVE '0'       *IN22
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ELSE
      *
     C                     MOVE 'D1'      WFMT
     C                     MOVE 'N'       PMFRST
      *
     C           PMERCD    IFNE *BLANK
     C                     MOVE '1'       *IN22
     C                     MOVEL'LER0176' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSL
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRFXST  -  Format Extended Settlement Fields                  *
      * Called by: SRDET2                                             *
      * Calls    : None                                               *
      *****************************************************************
      *
     C           SRFXST    BEGSR
      *
      ** Set up communication fileds
      *
     C           SFLNRF    IFNE *BLANKS
     C                     MOVE 'F1'      PMTTYP
     C                     ELSE
     C                     MOVE 'F2'      PMTTYP
     C                     ENDIF
     C                     MOVE SFLCHT    PMACTC
     C***********          MOVE 'MMLD'    PMCPGM                          135152
     C                     MOVE 'LEND'    PMCPGM                          135152
     C                     MOVE *BLANK    PMCMDP
     C                     Z-ADD0         PMDBSE
     C                     Z-ADDBJRDNB    PMRUND
     C                     Z-ADDBJBVPD    PMBVPD
      *                                                                                     BUG12876
      ** If Payment On is 'S' or is *blank, Start Date should be passed.                    BUG12876
      ** If Payment On is 'N', Next Payment Date should be passed.                          BUG12876
      ** If Payment On is 'E', End Date should be passed.                                   BUG12876
      *                                                                                     BUG12876
     C           SFEPON    IFEQ 'S'                                                         BUG12876
     C           SFEPON    OREQ ' '                                                         BUG12876
     C                     MOVE WPSTD     PMDTRC
     C                     MOVE WPSTD     PMDTPY
     C                     END                                                              BUG12876
     C           SFEPON    IFEQ 'N'                                                         BUG12876
     C                     MOVE WNPYD     PMDTRC                                            BUG12876
     C                     MOVE WNPYD     PMDTPY                                            BUG12876
     C                     END                                                              BUG12876
     C           SFEPON    IFEQ 'E'                                                         BUG12876
     C                     MOVE WPEND     PMDTRC                                            BUG12876
     C                     MOVE WPEND     PMDTPY                                            BUG12876
     C                     END                                                              BUG12876
      *                                                                                     BUG12876
      ** Initialise PMCSNM value with the correct format                                      193450
     C**********           MOVELSFCNUM    PMCSNM                                              193450
     C                     MOVE SFCNUM    WPMCNM  6                                           193450
     C                     MOVELWPMCNM    PMCSNM                                              193450
     C                     MOVELBRCA      PMBRCA
     C                     MOVE SFECUR    PMRCCY
     C                     MOVE SFECUR    PMPCCY
     C                     MOVE 'N'       PMSDTV
      *
     C           PMFRST    IFEQ 'Y'
     C                     MOVE 'N'       PMVALO
     C                     MOVE *BLANKS   PMERCD
     C                     ELSE
     C                     MOVE 'Y'       PMVALO
     C                     ENDIF
      *
      ** Determine if pay settlement should be protected
      *
     C           SFLCHT    IFEQ 'E'
     C           SFLCHT    OREQ 'D'
     C           SFLCHT    OREQ 'X'
     C                     MOVE 'Y'       PMPRCV
     C                     MOVE 'Y'       PMPPAY
     C                     MOVE 'N'       PMVALO
     C                     ENDIF
      *
     C           SFLCHT    IFEQ 'I'
     C           SFLCHT    OREQ 'A'
      *
     C           WPTFI     IFEQ 'P'
     C                     MOVE 'N'       PMPPAY
     C                     MOVE 'Y'       PMPRCV
     C                     ENDIF
      *
     C           WPTFI     IFEQ *BLANK
     C                     MOVE 'Y'       PMPPAY
     C                     MOVE 'N'       PMPRCV
     C                     ENDIF
      *
     C                     MOVE 'N'       PMSDTV
      *
     C***********SFLCHT    IFEQ 'A'                                       135351
     C***********FEPSTD    ANDLTBJRDNB                                    135351
     C***********FEORED    ANDLTBJRDNB                                    135351
     C***********          MOVE 'Y'       PMPPAY                          135351
     C***********          MOVE 'Y'       PMPRCV                          135351
     C***********          ENDIF                                          135351
     C                     ENDIF
      *
     C           SFLCHT    IFNE 'I'
     C           PMERCD    IFEQ *BLANK
      *
      ** Set up payment settlement details
      *
     C                     MOVELFERSTM    PMRSTM
     C                     MOVELFERONS    PMRONS
     C                     MOVELFERIBN    PMRIBN
     C                     MOVELFERIBN    PARIBN
     C                     MOVELFERIBA    PMRIBA
     C                     MOVELFEROCN    PMROCN
     C                     MOVELFEROCN    PAROCN
     C                     MOVELFEROBN    PMROBN
     C                     MOVELFEROBN    PAROBN
     C                     MOVELFEPSTM    PMPSTM
     C                     MOVELFEPONS    PMPONS
     C                     MOVELFEPIBN    PMPIBN
     C                     MOVELFEPIBN    PAPIBN
     C                     MOVELFEPIBA    PMPIBA
     C                     MOVELFEPOCN    PMPOCN
     C                     MOVELFEPOCN    PAPOCN
     C                     MOVELFEPOBN    PMPOBN
     C                     MOVELFEPOBN    PAPOBN
     C                     MOVELFERCRN    PMRCRN
     C                     MOVELFERCRN    PARCRN
     C                     MOVELFERCRA    PMRCRA
     C                     MOVELFERVNO    PMRVNO
     C                     MOVELFERVNO    PARVNO
     C                     MOVELFEAWBN    PMAWBN
     C                     MOVELFEAWBN    PAAWBN
     C                     MOVELFEAWBA    PMAWBA
     C                     MOVELFEBENN    PMBENN
     C                     MOVELFEBENN    PABENN
     C                     MOVELFEBENA    PMBENA
     C                     MOVELFEDTP1    PMDTP1
     C                     MOVELFEDTP2    PMDTP2
     C                     MOVELFEDTP3    PMDTP3
     C                     MOVELFEDTP4    PMDTP4
     C                     MOVELFEDCHG    PMDCHG
     C                     MOVELFEBTB1    PMBTB1
     C                     MOVELFEBTB2    PMBTB2
     C                     MOVELFEBTB3    PMBTB3
     C                     MOVELFEBTB4    PMBTB4
     C                     MOVELFEBTB5    PMBTB5
     C                     MOVELFEBTB6    PMBTB6
     C                     MOVELFECVMR    PMCVMR
     C                     MOVELFEOSDB    PMROBR
     C                     MOVELFEOMDB    PMPOBR
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVELFESCCY    PMRSCY                          CEU004
     C                     MOVELFESCCY    PMPSCY                          CEU004
     C                     MOVELFEICCY    PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE FESCCY    PMRSCY                                              CLE031
     C           FEREXR    IFEQ 0                                                             CLE031
     C                     MOVE *BLANK    PMREXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE FEREXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMREXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE FEREXI    PMREXI                                              CLE031
     C                     MOVE FEPSCY    PMPSCY                                              CLE031
     C           FEPEXR    IFEQ 0                                                             CLE031
     C                     MOVE *BLANK    PMPEXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE FEPEXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     EXSR ZEDIT                                                         CLE031
     C                     MOVE ZFIELD    PMPEXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE FEPEXI    PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF
      *
     C                     ELSE
      *
     C           PMFRST    IFEQ 'Y'
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANK    PMRSCY                                              CLE031
     C                     MOVE *BLANK    PMREXR                                              CLE031
     C                     MOVE *BLANK    PMREXI                                              CLE031
     C                     MOVE *BLANK    PMPSCY                                              CLE031
     C                     MOVE *BLANK    PMPEXR                                              CLE031
     C                     MOVE *BLANK    PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      **                                                                  154113
      **  Call to access object to see if extended settlement             154113
      **  instructions exist.                                             154113
     C                     MOVE 'N'       EXDTA   1                       154113
     C                     MOVELW#CUST    @CUST                           154113
     C                     MOVELSFECUR    @CYCD                           154113
     C                     MOVEL'LE'      @TRTY                           154113
      *                                                                   154113
     C                     CALL 'AOEXSTR0'                                154113
     C                     PARM *BLANKS   @RTCD   7                       154113
     C                     PARM '*KEY   ' @OPTN   7                       154113
     C                     PARM           @CYCD   3                       154113
     C                     PARM           @CUST   6                       154113
     C                     PARM           @TRTY   2                       154113
     C           SDEXST    PARM SDEXST    DSSDY                           154113
      *                                                                   154113
     C           @RTCD     IFNE *BLANKS                                   154113
     C                     MOVE 'AT'      @TRTY                           154113
     C                     CALL 'AOEXSTR0'                                154113
     C                     PARM *BLANKS   @RTCD                           154113
     C                     PARM '*KEY   ' @OPTN                           154113
     C                     PARM           @CYCD   3                       154113
     C                     PARM           @CUST   6                       154113
     C                     PARM           @TRTY   2                       154113
     C           SDEXST    PARM SDEXST    DSSDY                           154113
     C                     ENDIF                                          154113
      *                                                                   154113
     C           @RTCD     IFEQ *BLANKS                                   154113
      *                                                                   154113
      ** If they exist, default settlement details to Standard            154113
      ** Settlement Instructions...                                       154113
     C           PMPRCV    IFEQ 'N'                                       154113
     C                     MOVELBYRSTY    PMRSTM                          154113
     C                     MOVELBYRONO    PMRONS                          154113
     C                     MOVELBYROBN    PAROBN                          154113
     C                     MOVELBYORBR    PMROBR                          154113
     C                     MOVELBYROCS    PAROCN                          154113
     C                     MOVELBYRIBN    PARIBN                          154113
     C                     MOVELBYRIBL    PMRIBA                          154113
     C                     ENDIF                                          154113
     C           PMPPAY    IFEQ 'N'                                       154113
     C                     MOVELBYPSTY    PMPSTM                          154113
     C                     MOVELBYPONO    PMPONS                          154113
     C                     MOVELBYOPBR    PMPOBR                          154113
     C                     MOVELBYPOCS    PAPOCN                          154113
     C                     MOVELBYPIBN    PAPIBN                          154113
     C                     MOVELBYPOBN    PAPOBN                          154113
     C                     MOVELBYPIBA    PMPIBA                          154113
     C                     MOVELBYRCNO    PARCRN                          154113
     C                     MOVELBYRCAL    PMRCRA                          154113
     C                     MOVELBYRCNB    PARVNO                          154113
     C                     MOVELBYACBN    PAAWBN                          154113
     C                     MOVELBYACBL    PMAWBA                          154113
     C                     MOVELBYBYNB    PABENN                          154113
     C                     MOVELBYBACL    PMBENA                          154113
     C                     MOVELBYDPY1    PMDTP1                          154113
     C                     MOVELBYDPY2    PMDTP2                          154113
     C                     MOVELBYDPY3    PMDTP3                          154113
     C                     MOVELBYDPY4    PMDTP4                          154113
     C                     MOVELBYDECG    PMDCHG                          154113
     C                     MOVELBYBBI1    PMBTB1                          154113
     C                     MOVELBYBBI2    PMBTB2                          154113
     C                     MOVELBYBBI3    PMBTB3                          154113
     C                     MOVELBYBBI4    PMBTB4                          154113
     C                     MOVELBYBBI5    PMBTB5                          154113
     C                     MOVELBYBBI6    PMBTB6                          154113
     C                     MOVELBYCVMR    PMCVMR                          154113
     C                     ENDIF                                          154113
      *                                                                   158838
     C                     EXSR SRSCRN                                    158838
      *                                                                   154113
      ** If this is an insert, send 'A' to SD2400 to access correct       154113
      ** processing.                                                      154113
     C           SFLCHT    IFEQ 'I'                                       154113
     C                     MOVE 'A'       PMACTC                          154113
     C                     ELSE                                           154113
     C                     MOVE SFLCHT    PMACTC                          154113
     C                     ENDIF                                          154113
      *                                                                   154113
     C                     ELSE                                           154113
      ** ... otherwise leave settlement instructions blank.               154113
     C                     MOVE BRCA      PMROBR
     C                     MOVE BRCA      PMPOBR
     C                     MOVE *BLANK    PMRSTM
     C                     MOVE *BLANK    PMRONS
     C                     MOVE *BLANK    PMRIBN
     C                     MOVE *BLANK    PARIBN
     C                     MOVE *BLANK    PMRIBA
     C                     MOVE *BLANK    PMROCN
     C                     MOVE *BLANK    PAROCN
     C                     MOVE *BLANK    PMROBN
     C                     MOVE *BLANK    PAROBN
     C                     MOVE *BLANK    PMPSTM
     C                     MOVE *BLANK    PMPONS
     C                     MOVE *BLANK    PMPOBR
     C                     MOVE *BLANK    PMPIBN
     C                     MOVE *BLANK    PAPIBN
     C                     MOVE *BLANKS   PMPOCN
     C                     MOVE *BLANKS   PAPOCN
     C                     MOVE *BLANKS   PMPOBN
     C                     MOVE *BLANKS   PAPOBN
     C                     MOVE *BLANKS   PMRCRN
     C                     MOVE *BLANKS   PARCRN
     C                     MOVE *BLANKS   PMRCRA
     C                     MOVE *BLANKS   PMPIBA
     C                     MOVE *BLANKS   PMRVNO
     C                     MOVE *BLANKS   PARVNO
     C                     MOVE *BLANKS   PMAWBN
     C                     MOVE *BLANKS   PAAWBN
     C                     MOVE *BLANKS   PMAWBA
     C                     MOVE *BLANKS   PMBENN
     C                     MOVE *BLANKS   PABENN
     C                     MOVE *BLANKS   PMBENA
     C                     MOVE *BLANKS   PMDTP1
     C                     MOVE *BLANKS   PMDTP2
     C                     MOVE *BLANKS   PMDTP3
     C                     MOVE *BLANKS   PMDTP4
     C                     MOVE *BLANKS   PMDCHG
     C                     MOVE *BLANKS   PMBTB1
     C                     MOVE *BLANKS   PMBTB2
     C                     MOVE *BLANKS   PMBTB3
     C                     MOVE *BLANKS   PMBTB4
     C                     MOVE *BLANKS   PMBTB5
     C                     MOVE *BLANKS   PMBTB6
     C                     MOVE *BLANKS   PMCVMR
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE *BLANKS   PMRSCY                          CEU004
     C                     MOVE *BLANKS   PMPSCY                          CEU004
     C                     MOVE *BLANKS   PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C                     ENDIF                                          154113
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************   133789
      * SRSCRN  -  Screen Extended Settlement Fields from SD2400      *   133789
      * Called by: SRDET2                                             *   133789
      * Calls    : None                                               *   133789
      *****************************************************************   133789
      *                                                                   133789
     C           SRSCRN    BEGSR                                          133789
      *                                                                   133789
     C           PMPRCV    IFEQ 'Y'                                       133789
      *                                                                   133789
     C                     MOVE *BLANKS   PMRSTM                          133789
     C                     MOVE *BLANKS   PMRONS                          133789
     C                     MOVE *BLANKS   PMRIBN                          133789
     C                     MOVE *BLANKS   PARIBN                          133789
     C                     MOVE *BLANKS   PMRIBA                          133789
     C                     MOVE *BLANKS   PMROCN                          133789
     C                     MOVE *BLANKS   PAROCN                          133789
     C                     MOVE *BLANKS   PMROBN                          133789
     C                     MOVE *BLANKS   PAROBN                          133789
     C                     MOVE *BLANKS   PMROBR                          133789
      *                                                                   133789
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   PMRSCY                                              CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     MOVE *BLANKS   PMREXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                          133789
      *                                                                   133789
     C           PMPPAY    IFEQ 'Y'                                       133789
      *                                                                   133789
     C                     MOVE *BLANKS   PMPSTM                          133789
     C                     MOVE *BLANKS   PMPONS                          133789
     C                     MOVE *BLANKS   PMPIBN                          133789
     C                     MOVE *BLANKS   PAPIBN                          133789
     C                     MOVE *BLANKS   PMPIBA                          133789
     C                     MOVE *BLANKS   PMPOCN                          133789
     C                     MOVE *BLANKS   PAPOCN                          133789
     C                     MOVE *BLANKS   PMPOBN                          133789
     C                     MOVE *BLANKS   PAPOBN                          133789
     C                     MOVE *BLANKS   PMPOBR                          133789
     C                     MOVE *BLANKS   PARCRN                          158838
     C                     MOVE *BLANKS   PMRCRA                          158838
     C                     MOVE *BLANKS   PARVNO                          158838
     C                     MOVE *BLANKS   PAAWBN                          158838
     C                     MOVE *BLANKS   PMAWBA                          158838
     C                     MOVE *BLANKS   PABENN                          158838
     C                     MOVE *BLANKS   PMBENA                          158838
     C                     MOVE *BLANKS   PMDTP1                          158838
     C                     MOVE *BLANKS   PMDTP2                          158838
     C                     MOVE *BLANKS   PMDTP3                          158838
     C                     MOVE *BLANKS   PMDTP4                          158838
     C                     MOVE *BLANKS   PMDCHG                          158838
     C                     MOVE *BLANKS   PMBTB1                          158838
     C                     MOVE *BLANKS   PMBTB2                          158838
     C                     MOVE *BLANKS   PMBTB3                          158838
     C                     MOVE *BLANKS   PMBTB4                          158838
     C                     MOVE *BLANKS   PMBTB5                          158838
     C                     MOVE *BLANKS   PMBTB6                          158838
     C                     MOVE *BLANKS   PMCVMR                          158838
     C                     ENDIF                                          133789
      *                                                                   133789
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   PMPSCY                                              CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     MOVE *BLANKS   PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR                                          133789
      /EJECT                                                              133789
      *****************************************************************
      * SRBTCH  -  Batch Processing                                   *
      * Called by: SRINIT                                             *
      * Calls    : SRINS1 - Initialise all screen fields              *
      *            SRRTVT - Retrieve Test Harness flds to screen flds *
      *            SRFISC - Screen fields to file fields              *   CAP064
      *            SRSCWK - Save screen fields to work fields         *   CAP064
      *            SRBDET - Retrieve Batch Processing Details         *
      *            SRCOMP - Compare incoming fields with saved fields *   CAP064
      *            SRVALI - Validate Initial Screen                   *
      *            SRVALF - Validate Detail Screen Fields             *
      *            SREROR - Error Processing                          *
      *            SRWRIT - Write a new record in file                *
      *            SRUPDT - Update record                             *
      *****************************************************************
     C           SRBTCH    BEGSR
      *
     C           PMODE     IFEQ 'P'
     C                     READ LE2210PD                 78
     C                     ENDIF
      *
     C           *IN78     DOWEQ'0'
      *
      ** Initialise all screen and work fields
      *
     C                     EXSR SRINS1
     C/COPY WNCPYSRC,LEH00893
      *
      ** Move Test harness file fields to screen fields if mode is PLAY
      *
     C           PMODE     IFEQ 'P'
      *
     C                     EXSR SRRTVT
      *
     C                     ENDIF
      *                                                            CAP064
      ** If Mode = Batch, Action = Amend and CAP064 is on          CAP064
     C           PMODE     IFEQ 'B'                                CAP064
     C           PITACT    ANDEQ'A'                                CAP064
     C           PIPLC     ANDEQ'B'                                CAP064
     C           CAP064    ANDEQ'Y'                                CAP064
      *                                                            CAP064
      ** Move file fields to screen fields                         CAP064
     C                     EXSR SRFISC                             CAP064
      *                                                            CAP064
      ** Move screen fields to save fields                         CAP064
     C                     EXSR SRSCWK                             CAP064
      *                                                            CAP064
      ** Clear screen fields                                       CAP064
     C                     EXSR SRINS1                             CAP064
      *                                                            CAP064
     C                     ENDIF                                   CAP064
      *                                                            CAP064
      *
      ** Move fields coming from input parameter in screen fields
      *
     C           PMODE     IFEQ 'B'
     C/COPY WNCPYSRC,LEH00528
      *
     C                     EXSR SRBDET
      *
     C                     ENDIF
      *                                                            CAP064
      ** If Mode = Batch, Action = Amend and CAP064 is on          CAP064
     C           PMODE     IFEQ 'B'                                CAP064
     C           PITACT    ANDEQ'A'                                CAPB64
     C           PIPLC     ANDEQ'B'                                CAPB64
     C           CAP064    ANDEQ'Y'                                CAP064
      *                                                            CAP064
      ** Compare Incoming screen fields with save fields           CAP064
     C                     EXSR SRCOMP                             CAP064
      *                                                            CAP064
     C                     ENDIF                                   CAP064
      *
      ** Validate action code
      *
     C                     EXSR SRVALI
      *
      ** Validate detail screen
      *
     C           SFLCHT    IFEQ 'I'
     C           SFLCHT    OREQ 'A'
     C                     EXSR SRVALF
     C                     ENDIF
      *
      ** Validate Settlement details
      *
     C           SFLCHT    IFEQ 'I'
     C           WPTFI     ANDNE'I'
     C           SFLCHT    OREQ 'A'
     C           WPTFI     ANDNE'I'
      *
     C/COPY WNCPYSRC,LE2210C005
      *                                                                                       CLE034
      ** Determine if pay settlement should be protected                                      CLE034
      *                                                                                       CLE034
     C           SFLCHT    IFEQ 'E'                                                           CLE034
     C           SFLCHT    OREQ 'D'                                                           CLE034
     C           SFLCHT    OREQ 'X'                                                           CLE034
     C                     MOVE 'Y'       PMPRCV                                              CLE034
     C                     MOVE 'Y'       PMPPAY                                              CLE034
     C                     MOVE 'N'       PMVALO                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           SFLCHT    IFEQ 'I'                                                           CLE034
     C           SFLCHT    OREQ 'A'                                                           CLE034
      *                                                                                       CLE034
     C           WPTFI     IFEQ 'P'                                                           CLE034
     C                     MOVE 'N'       PMPPAY                                              CLE034
     C                     MOVE 'Y'       PMPRCV                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WPTFI     IFEQ *BLANK                                                        CLE034
     C                     MOVE 'Y'       PMPPAY                                              CLE034
     C                     MOVE 'N'       PMPRCV                                              CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SFSTAL    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
      ** For inserts, the fee sequence number can be zero.                                    CLE034
      ** This is not a problem. The first settlement allocation record                        CLE034
      ** written by LE2230 will be given a timestamp and used on all                          CLE034
      ** the other settlement allocation records.                                             CLE034
      *                                                                                       CLE034
     C           SFFSEQ    IFEQ *BLANKS                                                       CLE034
     C           SFFSEQ    OREQ *ZEROS                                                        CLE034
      *                                                                                       CLE034
     C                     MOVEL'Y'       WNKEY                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     MOVE SFLNRF    PLNRF                                               CLE034
     C                     MOVE SFCNUM    PCNUM                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'LE2230'                                                      CLE034
     C                     PARM 'FEES'    PTYPE                                               CLE034
     C                     PARM           PLNRF   6                                           CLE034
     C                     PARM *BLANKS   PVDAT                                               CLE034
     C                     PARM *BLANKS   PSEQN                                               CLE034
     C                     PARM           PCNUM   6                                           CLE034
     C                     PARM           WFACL                                               CLE034
     C                     PARM           SFFSEQ                                              CLE034
     C                     PARM           SETLIB                                              CLE034
     C                     PARM           SETLIZ                                              CLE034
     C                     PARM           PMODE                                               CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM *BLANKS   PERRF                                               CLE034
     C                     PARM *BLANKS   PWARN                                               CLE034
     C                     PARM *BLANKS   PSNOS                                               CLE034
     C                     PARM *BLANKS   PSAMD                                               CLE034
     C                     PARM *BLANKS   PNDET                                               CLE034
     C                     PARM *BLANKS   PRCCY                                               CLE034
     C                     PARM *BLANKS   PRLOC                                               CLE034
     C                     PARM *BLANKS   PPCCY                                               CLE034
     C                     PARM *BLANKS   PPLOC                                               CLE034
     C                     PARM           FEPCRF                                              CLE034
     C                     PARM *BLANKS   PORED                                               CLE038
     C                     PARM *ZERO     PAAMT                                               CLE038
      *                                                                                       CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'SD2410'
     C                     PARM           SETLIB
     C                     PARM           SETLIZ
     C                     PARM           @PARM3                          222373
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C/COPY WNCPYSRC,LE2210C006
      *
      ** If database error terminate processing
      *
     C           PMDBSE    IFNE 0
     C           *LOCK     IN   LDA
     C                     MOVELPMDBFL    DBFILE           ************
     C                     Z-ADDPMDBSE    DBASE            * DBERR XX *
     C                     MOVELPMDBKY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           PMERCD    IFNE *BLANK
     C           3         SUBSTPMERCD:1  WSERR   3
     C                     MOVEL'ESM0'    ZAMSID
     C                     MOVE WSERR     ZAMSID
     C                     MOVEL'DRSMM   'ZAMSGF
     C***********          EXSR ZASNMS                                    135748
     C                     EXSR SRBERR                                    135748
     C                     ENDIF
     C                     ENDIF
      *
      ** Write to Fee Details file for action Insert
      *
     C/COPY WNCPYSRC,LE2210C002
     C           SFLCHT    IFEQ 'I'
     C                     EXSR SRWRIT
     C                     ENDIF
      *
      ** Update Fee Details file for action Amend, Authorise and
      ** Reverse
      *
     C           SFLCHT    IFEQ 'A'
     C           SFLCHT    OREQ 'X'
     C           SFLCHT    OREQ 'D'
     C                     EXSR SRUPDT
     C                     ENDIF
      *
     C           PMODE     IFEQ 'B'
     C/COPY WNCPYSRC,LEH00529
     C                     MOVE '1'       *IN78
     C                     ENDIF
      *
     C           *IN78     IFEQ '0'
     C                     READ LE2210PD                 78
     C                     ENDIF
      *
     C                     ENDDO
     C/COPY WNCPYSRC,LEH00894
      *
     C                     ENDSR
      /EJECT                                                              CAP064
      *****************************************************************   CAP064
      * SRFISC  -  Move file fields to screen fields                  *   CAP064
      * Called by: SRBTCH - Batch processing                          *   CAP064
      *****************************************************************   CAP064
      *                                                                   CAP064
     C           SRFISC    BEGSR                                          CAP064
      *                                                                   CAP064
      ** KLIST for file LEFEED                                            CAP064
      *                                                                   CAP064
     C                     MOVE PICNUM    WCNUM                           CAP064
     C                     MOVE PIFCNO    WFAC02                          CAP064
     C                     MOVE PIFACT    WFAC03                          CAP064
     C                     MOVE PILNRF    WLOAN                           CAP064
     C                     MOVE PIFSEQ    WFSEQ                           CAP064
      *                                                                   CAP064
     C           KEY002    CHAINLEFEEDF              99                   CAP064
      *                                                                   CAP064
      * Customer                                                          CAP064
     C********** FECNUM    IFNE 0                                                      CAP064 CSD027
     C           FECNUM    IFNE *BLANKS                                                       CSD027
     C                     MOVE FECNUM    SFCNUM                          CAP064
     C                     ELSE                                           CAP064
     C                     MOVE *BLANKS   SFCNUM                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Facility                                                          CAP064
     C                     MOVE FEFACL    SFFACT                          CAP064
      *                                                                   CAP064
      * Loan number                                                       CAP064
     C********** FELOAN    IFNE 0                                                      CAP064 CLE148
     C           FELOAN    IFNE *BLANKS                                                       CLE148
     C                     MOVE FELOAN    SFLNRF                          CAP064
     C                     ELSE                                           CAP064
     C                     MOVE *BLANKS   SFLNRF                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Fee Sequence                                                      CAP064
     C                     MOVE FEFSEQ    SFFSEQ                          CAP064
      *                                                                   CAP064
      * Fee Code                                                          CAP064
     C                     MOVE FEFCOD    SFECOD                          CAP064
      *                                                                   CAP064
      * Fee currency                                                      CAP064
     C                     MOVE FEFCCY    SFECUR                          CAP064
      *                                                                   CAP064
      * Fee amount                                                        CAP064
     C           FEFAMT    IFNE 0                                         CAP064
     C                     MOVE FEFAMT    SFEAMT                          CAP064
     C                     ELSE                                           CAP064
     C                     MOVE *BLANKS   SFEAMT                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Fee sign                                                          CAP064
     C                     MOVE FEPSTD    SFEPSD                          CAP064
      *                                                                   CAP064
      * Fee period end                                                    CAP064
     C                     MOVE FEPEND    SFEPED                          CAP064
      *                                                                   CAP064
      * Payment on                                                        CAP064
     C                     MOVE FEPYON    SFEPON                          CAP064
      *                                                                   CAP064
      * Advice confirmation indicator                                     CAP064
      ***                  MOVE           SFEADV                          CAP064
      *                                                                   CAP064
      * Shared fee                                                        CAP064
     C                     MOVE SHFI      SFESHR                          CAP064
      *                                                                   CAP064
      * Calculation type                                                  CAP064
     C                     MOVE FECALT    SFCALT                          CAP064
      *                                                                   CAP064
      * Rate 1                                                            CAP064
     C           FEFRT1    IFNE 0                                         CAP064
     C                     MOVE FEFRT1    SFRTE1                          CAP064
     C                     ELSE                                           CAP064
     C                     MOVE *BLANKS   SFRTE1                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Amount 1                                                          CAP064
     C           FEAMT1    IFNE 0                                         CAP064
     C                     MOVE FEAMT1    SFAMT1                          CAP064
     C                     ELSE                                           CAP064
     C                     MOVE *BLANKS   SFAMT1                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Rate 2                                                            CAP064
     C           FEFRT2    IFNE 0                                         CAP064
     C                     MOVE FEFRT2    SFRTE2                          CAP064
     C                     ELSE                                           CAP064
     C                     MOVE *BLANKS   SFRTE2                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Amount 2                                                          CAP064
     C           FEAMT2    IFNE 0                                         CAP064
     C                     MOVE FEAMT2    SFAMT2                          CAP064
     C                     ELSE                                           CAP064
     C                     MOVE *BLANKS   SFAMT2                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Rate 3                                                            CAP064
     C           FEFRT3    IFNE 0                                         CAP064
     C                     MOVE FEFRT3    SFRTE3                          CAP064
     C                     ELSE                                           CAP064
     C                     MOVE *BLANKS   SFRTE3                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Amount 3                                                          CAP064
     C           FEAMT3    IFNE 0                                         CAP064
     C                     MOVE FEAMT3    SFAMT3                          CAP064
     C                     ELSE                                           CAP064
     C                     MOVE *BLANKS   SFAMT3                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Rate 4                                                            CAP064
     C           FEFRT4    IFNE 0                                         CAP064
     C                     MOVE FEFRT4    SFRTE4                          CAP064
     C                     ELSE                                           CAP064
     C                     MOVE *BLANKS   SFRTE4                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Amount 4                                                          CAP064
     C           FEAMT4    IFNE 0                                         CAP064
     C                     MOVE FEAMT4    SFAMT4                          CAP064
     C                     ELSE                                           CAP064
     C                     MOVE *BLANKS   SFAMT4                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Rate 5                                                            CAP064
     C           FEFRT5    IFNE 0                                         CAP064
     C                     MOVE FEFRT5    SFRTE5                          CAP064
     C                     ELSE                                           CAP064
     C                     MOVE *BLANKS   SFRTE5                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Amount 5                                                          CAP064
     C           FEAMT5    IFNE 0                                         CAP064
     C                     MOVE FEAMT5    SFAMT5                          CAP064
     C                     ELSE                                           CAP064
     C                     MOVE *BLANKS   SFAMT5                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Percentage indicator                                              CAP064
     C                     MOVE FEPIND    SFPIND                          CAP064
      *                                                                   CAP064
      * Calculation basis                                                 CAP064
     C                     MOVE FECALC    SFCALC                          CAP064
      *                                                                   CAP064
      * Exchange rate                                                     CAP064
     C           FEERAT    IFNE 0                                         CAP064
     C                     MOVE FEERAT    SFEXRT                          CAP064
     C                     ELSE                                           CAP064
     C                     MOVE *BLANKS   SFEXRT                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Multiply/Divide indicator                                         CAP064
     C                     MOVE FEMDIN    SFMDIN                          CAP064
      *                                                                   CAP064
      * Next payment date                                                 CAP064
     C           FENPYD    IFNE 0                                         CAP064
     C                     MOVE FENPYD    SFNPYD                          CAP064
     C                     ELSE                                           CAP064
     C                     MOVE *BLANKS   SFNPYD                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Frequency                                                         CAP064
     C                     MOVE FEFREQ    SFFREQ                          CAP064
      *                                                                   CAP064
      * Day in month                                                      CAP064
      *                                                                                       263584
     C           FEDYIM    IFNE 0                                                             263584
     C                     MOVE FEDYIM    SFDYIM                          CAP064
      *                                                                                       263584
     C                     ELSE                                                               263584
     C                     MOVE *BLANKS   SFDYIM                                              263584
     C                     ENDIF                                                              263584
      *                                                                   CAP064
      * Profit centre                                                     CAP064
     C                     MOVE FEPRFC    SPRFC                           CAP064
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVELFESTAL    SFSTAL                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   CAP064
     C                     ENDSR                                          CAP064
      /EJECT                                                              CAP064
      *****************************************************************   CAP064
      * SRSCWK  -  Save screen fields to work fields                  *   CAP064
      * Called by: SRBTCH - Batch processing                          *   CAP064
      *****************************************************************   CAP064
      *                                                                   CAP064
     C           SRSCWK    BEGSR                                          CAP064
      * Customer                                                          CAP064
     C                     MOVE SFCNUM    ICNUM                           CAP064
      * Facility                                                          CAP064
     C                     MOVE SFFACT    IFACT                           CAP064
     C                     MOVE SFFCNO    IFCNO                           CAP064
      * Loan number                                                       CAP064
     C                     MOVE SFLNRF    ILNRF                           CAP064
      * Fee Code                                                          CAP064
     C                     MOVE SFECOD    IECOD                           CAP064
      * Fee currency                                                      CAP064
     C                     MOVE SFECUR    IECUR                           CAP064
      * Fee amount                                                        CAP064
     C                     MOVE SFEAMT    IEAMT                           CAP064
      * Fee sign                                                          CAP064
     C                     MOVE SFESGN    IESGN                           CAP064
      * Fee period start                                                  CAP064
     C                     MOVE SFEPSD    IEPSD                           CAP064
      * Fee period end                                                    CAP064
     C                     MOVE SFEPED    IEPED                           CAP064
      * Payment on                                                        CAP064
     C                     MOVE SFEPON    IEPON                           CAP064
      * Advice confirmation indicator                                     CAP064
     C                     MOVE SFEADV    IEADV                           CAP064
      * Shared fee                                                        CAP064
     C                     MOVE SFESHR    IESHR                           CAP064
      * Calculation type                                                  CAP064
     C                     MOVE SFCALT    ICALT                           CAP064
      * Rate 1                                                            CAP064
     C                     MOVE SFRTE1    IRTE1                           CAP064
      * Amount 1                                                          CAP064
     C                     MOVE SFAMT1    IAMT1                           CAP064
      * Rate 2                                                            CAP064
     C                     MOVE SFRTE2    IRTE2                           CAP064
      * Amount 2                                                          CAP064
     C                     MOVE SFAMT2    IAMT2                           CAP064
      * Rate 3                                                            CAP064
     C                     MOVE SFRTE3    IRTE3                           CAP064
      * Amount 3                                                          CAP064
     C                     MOVE SFAMT3    IAMT3                           CAP064
      * Rate 4                                                            CAP064
     C                     MOVE SFRTE4    IRTE4                           CAP064
      * Amount 4                                                          CAP064
     C                     MOVE SFAMT4    IAMT4                           CAP064
      * Rate 5                                                            CAP064
     C                     MOVE SFRTE5    IRTE5                           CAP064
      * Amount 5                                                          CAP064
     C                     MOVE SFAMT5    IAMT5                           CAP064
      * Percentage indicator                                              CAP064
     C                     MOVE SFPIND    IPIND                           CAP064
      * Calculation basis                                                 CAP064
     C                     MOVE SFCALC    ICALC                           CAP064
      * Exchange rate                                                     CAP064
     C                     MOVE SFEXRT    IEXRT                           CAP064
      * Mult/Div indicator                                                CAP064
     C                     MOVE SFMDIN    IMDIN                           CAP064
      * Next payment date                                                 CAP064
     C                     MOVE SFNPYD    INPYD                           CAP064
      * Frequency                                                         CAP064
     C                     MOVE SFFREQ    IFREQ                           CAP064
      * Day in month                                                      CAP064
     C                     MOVE SFDYIM    IDYIM                           CAP064
      * Profit centre                                                     CAP064
     C                     MOVE SPRFC     IPRFC                           CAP064
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE SFSCCY    ISCCY                                               CLE031
     C                     MOVE SFREXR    IREXR                                               CLE031
     C                     MOVE SFREXI    IREXI                                               CLE031
     C                     MOVE SFPSCY    IPSCY                                               CLE031
     C                     MOVE SFPEXR    IPEXR                                               CLE031
     C                     MOVE SFPEXI    IPEXI                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVELSFSTAL    ISTAL                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   CAP064
     C                     ENDSR                                          CAP064
      /EJECT                                                              CAP064
      *****************************************************************   CAP064
      * SRCOMP  -  Compare values of Incoming fields with those of    *   CAP064
      *            saved values. If they are different replace with   *   CAP064
      *            value of file and flag as error.                   *   CAP064
      * Called by: SRBTCH - Batch processing                          *   CAP064
      *****************************************************************   CAP064
      *                                                                   CAP064
     C           SRCOMP    BEGSR                                          CAP064
      *                                                                   CAP064
      ** Set protect indicators and error Flag to 'N'                     CAP064
     C                     MOVE 'N'       WERRA   1                       CAP064
      *                                                                   CAP064
      ** Set indicators used as protects in display file                  CAP064
      ** *IN71 = Profit centre is amendable                               CAP064
     C           BKPRCA    IFNE 'Y'                                       CAP064
     C                     MOVE *OFF      *IN71                           CAP064
     C                     ELSE                                           CAP064
     C                     MOVE *ON       *IN71                           CAP064
     C                     ENDIF                                          CAP064
      ** *IN77 = Start date has been reached and calc type entered        CAP064
      ** *IN79 = Start date has been reached and confirmation ind is on   CAP064
      ** *IN84 = Start date has been reached and pay on = S               CAP064
      ** *IN85 = Start date has been reached and pay on = E               CAP064
     C           FEPSTD    IFLT BJRDNB                                    CAP064
     C           FEORED    ANDNEBJRDNB                                    CAP064
     C           FEAUTO    IFEQ 'Y'                                       CAP064
     C           FECALT    ANDEQ*BLANKS                                   CAP064
     C                     MOVE '1'       *IN79                           CAP064
     C                     ENDIF                                          CAP064
     C           FEPYON    IFEQ 'S'                                       CAP064
     C                     MOVE '1'       *IN84                           CAP064
     C                     ENDIF                                          CAP064
     C           FEPYON    IFEQ 'E'                                       CAP064
     C                     MOVE '1'       *IN85                           CAP064
     C                     ENDIF                                          CAP064
     C           FECALT    IFNE *BLANKS                                   CAP064
     C                     MOVE '1'       *IN77                           CAP064
     C                     ENDIF                                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      ** Compare Customer                                                 CAP064
     C           SFCNUM    IFNE ICNUM                                     CAP064
     C                     MOVE ICNUM     SFCNUM                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Facility                                                  CAP064
     C           SFFACT    IFNE IFACT                                     CAP064
     C                     MOVE IFACT     SFFACT                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
     C           SFFCNO    IFNE IFCNO                                     CAP064
     C                     MOVE IFCNO     SFFCNO                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Loan number                                               CAP064
     C           SFLNRF    IFNE ILNRF                                     CAP064
     C                     MOVE ILNRF     SFLNRF                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Fee Code                                                  CAP064
     C           *IN77     IFEQ *ON                                       CAP064
     C           *IN84     OREQ *ON                                       CAP064
     C           *IN85     OREQ *ON                                       CAP064
     C           SFECOD    IFNE IECOD                                     CAP064
     C                     MOVE IECOD     SFECOD                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Fee currency                                              CAP064
     C           *IN77     IFEQ *ON                                       CAP064
     C           *IN84     OREQ *ON                                       CAP064
     C           *IN85     OREQ *ON                                       CAP064
     C           SFECUR    IFNE IECUR                                     CAP064
     C                     MOVE IECUR     SFECUR                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Fee amount                                                CAP064
     C           *IN77     IFEQ *ON                                       CAP064
     C           *IN84     OREQ *ON                                       CAP064
     C           SFEAMT    IFNE IEAMT                                     CAP064
     C                     MOVE IEAMT     SFEAMT                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Fee sign                                                  CAP064
     C           *IN77     IFEQ *ON                                       CAP064
     C           *IN84     OREQ *ON                                       CAP064
     C           SFESGN    IFNE IESGN                                     CAP064
     C                     MOVE IESGN     SFESGN                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Fee period start                                          CAP064
     C           *IN77     IFEQ *ON                                       CAP064
     C           *IN84     OREQ *ON                                       CAP064
     C           *IN85     OREQ *ON                                       CAP064
     C           SFEPSD    IFNE IEPSD                                     CAP064
     C                     MOVE IEPSD     SFEPSD                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Fee period end                                            CAP064
     C           SFEPED    IFNE IEPED                                     CAP064
     C                     MOVE IEPED     SFEPED                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Payment on                                                CAP064
     C           *IN77     IFEQ *ON                                       CAP064
     C           *IN84     OREQ *ON                                       CAP064
     C           *IN85     OREQ *ON                                       CAP064
     C           SFEPON    IFNE IEPON                                     CAP064
     C                     MOVE IEPON     SFEPON                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Advice confirmation indicator                             CAP064
     C           *IN77     IFEQ *OFF                                      CAP064
     C           *IN79     ANDEQ*ON                                       CAP064
     C           SFEADV    IFNE IEADV                                     CAP064
     C                     MOVE IEADV     SFEADV                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Shared fee                                                CAP064
     C           *IN77     IFEQ *ON                                       CAP064
     C           *IN84     OREQ *ON                                       CAP064
     C           *IN85     OREQ *ON                                       CAP064
     C           SFESHR    IFNE IESHR                                     CAP064
     C                     MOVE IESHR     SFESHR                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Calculation type                                          CAP064
     C           *IN77     IFEQ *ON                                       CAP064
     C           *IN84     OREQ *ON                                       CAP064
     C           *IN85     OREQ *ON                                       CAP064
     C           SFCALT    IFNE ICALT                                     CAP064
     C                     MOVE ICALT     SFCALT                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Rate 1                                                    CAP064
     C           SFRTE1    IFNE IRTE1                                     CAP064
     C                     MOVE IRTE1     SFRTE1                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Amount 1                                                  CAP064
     C           SFAMT1    IFNE IAMT1                                     CAP064
     C                     MOVE IAMT1     SFAMT1                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Rate 2                                                    CAP064
     C           SFRTE2    IFNE IRTE2                                     CAP064
     C                     MOVE IRTE2     SFRTE2                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Amount 2                                                  CAP064
     C           SFAMT2    IFNE IAMT2                                     CAP064
     C                     MOVE IAMT2     SFAMT2                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Rate 3                                                    CAP064
     C           SFRTE3    IFNE IRTE3                                     CAP064
     C                     MOVE IRTE3     SFRTE3                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Amount 3                                                  CAP064
     C           SFAMT3    IFNE IAMT3                                     CAP064
     C                     MOVE IAMT3     SFAMT3                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Rate 4                                                    CAP064
     C           SFRTE4    IFNE IRTE4                                     CAP064
     C                     MOVE IRTE4     SFRTE4                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Amount 4                                                  CAP064
     C           SFAMT4    IFNE IAMT4                                     CAP064
     C                     MOVE IAMT4     SFAMT4                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Rate 5                                                    CAP064
     C           SFRTE5    IFNE IRTE5                                     CAP064
     C                     MOVE IRTE5     SFRTE5                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Amount 5                                                  CAP064
     C           SFAMT5    IFNE IAMT5                                     CAP064
     C                     MOVE IAMT5     SFAMT5                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Percentage indicator                                      CAP064
     C           SFPIND    IFNE IPIND                                     CAP064
     C                     MOVE IPIND     SFPIND                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Calculation basis                                         CAP064
     C           *IN77     IFEQ *ON                                       CAP064
     C           SFCALC    IFNE ICALC                                     CAP064
     C                     MOVE ICALC     SFCALC                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Exchange rate                                             CAP064
     C           *IN77     IFEQ *ON                                       CAP064
     C           SFEXRT    IFNE IEXRT                                     CAP064
     C                     MOVE IEXRT     SFEXRT                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Mult/Div indicator                                        CAP064
     C           *IN77     IFEQ *ON                                       CAP064
     C           SFMDIN    IFNE IMDIN                                     CAP064
     C                     MOVE IMDIN     SFMDIN                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Next payment date                                         CAP064
     C           SFNPYD    IFNE INPYD                                     CAP064
     C                     MOVE INPYD     SFNPYD                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Frequency                                                 CAP064
     C           SFFREQ    IFNE IFREQ                                     CAP064
     C                     MOVE IFREQ     SFFREQ                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Day in month                                              CAP064
     C           SFDYIM    IFNE IDYIM                                     CAP064
     C                     MOVE IDYIM     SFDYIM                          CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * Compare Profit centre                                             CAP064
     C           *IN71     IFEQ *OFF                                      CAP064
     C           SPRFC     IFNE IPRFC                                     CAP064
     C                     MOVE IPRFC     SPRFC                           CAP064
     C                     MOVE 'Y'       WERRA                           CAP064
     C                     ENDIF                                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SFSTAL    IFNE ISTAL                                                         CLE034
     C                     MOVE ISTAL     SFSTAL                                              CLE034
     C                     MOVE 'Y'       WERRA                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   CAP064
      ** If Error set-up error message & write details to Invalid file    CAP064
     C           WERRA     IFEQ 'Y'                                       CAP064
     C                     MOVEL'LEA1043' ZAMSID                          CAP064
     C                     EXSR ZASNMS                                    CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
     C                     ENDSR                                          CAP064
      /EJECT                                                              CAP064
      *****************************************************************   CAP064
      * SRVALI  -  Validate Initial Screen                            *
      * Called by: SRSTRT, SRBTCH                                     *
      * Calls    : VALERR - Action key error                          *
      *            VALINP - Validate Input key                        *
      *            VALAMD - Validate Amend and Authorise Key          *
      *            VALDEL - Validate Delete Key                       *
      *            VALENQ - Validate Enquire Key                      *
      *            SRFTYP - Subroutine to set up Fee type             *
      *            SRVALF - Validate Detail Screen Fields             *
      *            SRAVAL - Additional Val Dependent on Settl Ins.    *
      *            SRVALR - Validate Review Fields                    *
      *****************************************************************
     C           SRVALI    BEGSR
      *
     C           SFLCHT    IFNE *BLANK
     C           SFCNUM    ORNE *BLANK
     C           SFLNRF    ORNE *BLANK
     C           SFFACT    ORNE *BLANK
     C           SFFCNO    ORNE *BLANK
     C           SFFSEQ    ORNE *BLANK
      *
     C           SFLCHT    CASEQ'I'       VALINP
     C           SFLCHT    CASEQ'A'       VALAMD
     C           SFLCHT    CASEQ'D'       VALDEL
     C           SFLCHT    CASEQ'E'       VALENQ
     C           SFLCHT    CASEQ'X'       VALAMD
     C                     CAS            VALERR
     C                     ENDCS
      *                                                                   133789
      * For settlement validation, set booking branch. This is not        133789
      * held on the message received.                                     133789
     C                     MOVE WBKBRC    PMBRCA                          133789
      *
      ** If error message is blank then there has been no error
      *
     C           WERRF     IFEQ *BLANKS
      *
      ** If the facility is blank then non display field Facility
      *
     C           WFACL     IFEQ *BLANKS
     C           WFACL     OREQ *ZEROS
     C                     MOVE '1'       *IN68
     C                     ENDIF
      *
      **  Otherwise non display the loan number as this is blank
      *
     C           SFLNRF    IFEQ *BLANKS
     C           SFLNRF    OREQ *ZEROS
     C                     MOVE '1'       *IN69
     C                     ENDIF
      *
      ** Set up Status field
      *
     C           SFLCHT    IFNE 'I'
     C           FERECI    IFNE 'M'
     C           FERECI    ANDNE'R'                                       155772
     C           FERECI    ANDNE'*'                                                          BUG3729
     C                     SELEC
     C           FEFSTS    WHEQ 'C'
     C                     MOVEL'LER0194' ZAMSID
     C           FEFSTS    WHEQ 'R'
     C                     MOVEL'LER0195' ZAMSID
     C           FEFSTS    WHEQ 'A'
     C                     MOVEL'LER0196' ZAMSID
     C           FEFSTS    WHEQ 'D'
     C                     MOVEL'LER0197' ZAMSID
     C                     ENDSL
      *
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SSTAT
     C                     MOVE *BLANKS   ZAMSID
      *
     C                     ENDIF
     C                     ELSE
     C                     MOVE *BLANK    SSTAT
     C                     ENDIF
      *
      **  Set up Fee type
      *
     C                     EXSR SRFTYP
     C/COPY WNCPYSRC,LE2210C023
      *
      ** Default Shared Fee to 'N' if entered against direct
      ** Facilities or Loan, default to 'Y' if entered against
      ** syndicated Facilities or Loan
      *
     C           CLE006    IFEQ 'Y'                                       187261
     C           SFLCHT    IFEQ 'I'
     C           SFESHR    ANDEQ*BLANK                                    160201
     C***********WPTFI     IFNE 'P'                                       127656
     C***********WPTFI     ANDNE'I'                                       127656
     C           WSYND     IFEQ 'N'                                       127656
     C                     MOVE 'N'       SFESHR
     C                     ELSE
     C                     MOVE 'Y'       SFESHR
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                          187261
      *
     C           SFLCHT    IFEQ 'X'
     C                     EXSR SRVALF
     C                     EXSR SRAVAL
     C                     ENDIF
      *
     C                     MOVE 'D1'      WFMT
      *
     C                     ELSE
     C                     MOVE 'F0'      WFMT
     C                     ENDIF
      *
     C                     ELSE
      *
      ** Validate Review fields
      *
     C                     EXSR SRVALR
      *
     C           WERRF     IFEQ *BLANK
     C                     MOVE 'S0'      WFMT
     C                     ELSE
     C                     MOVE 'F0'      WFMT
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *  VALERR - Action key error                                    *
      *  Called by: SRVALI                                            *
      *  Calls    : SREROR - Error Processing                         *
      *****************************************************************
     C           VALERR    BEGSR
     C                     MOVEL'LER0172' ZAMSID
     C                     EXSR SREROR
     C                     MOVE '1'       *IN30
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *  VALINP - Validate Input Key                                  *
      *  Called by: SRVALI                                            *
      *             SRVALF                                            *   CAP064
      *  Calls    : SREROR - Error Processing                         *
      *             CUSTDT - Subr. to access customer details file    *
      *             SRUAUT - Check if user is authorised to the action*
      *****************************************************************
     C           VALINP    BEGSR
      *
      ** Test if customer entered
      *
     C           SFCNUM    IFEQ *BLANKS
     C                     MOVEL'LER0006' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C                     MOVEL*BLANKS   KEYC   10
     C                     MOVELSFCNUM    KEYC
     C                     EXSR CUSTDT
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN31
     C                     MOVEL'LER0007' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE *BLANKS   SFCNUM
     C***********          MOVELBBCUST    SFCNUM                          140814
     C                     MOVE BBCUST    SFCNUM                          140814
     C                     MOVE BBCUST    WCNUM
     C                     ENDIF
      *
      ** If both FACILITY & LOAN no. entered then error
      *
     C                     MOVELSFFACT    WFACL
     C                     MOVE SFFCNO    WFACL
     C           WFACL     IFNE *BLANKS
     C           SFLNRF    ANDNE*BLANKS
     C                     MOVEA'11'      *IN,32
     C***********          MOVEL'1282855' ZAMSID                          139832
     C                     MOVEL'LER0015' ZAMSID                          139832
     C                     EXSR SREROR
     C                     ELSE
      *
      ** If both FACILITY & LOAN no. blank then error
      *
     C           WFACL     IFEQ *BLANKS
     C           SFLNRF    ANDEQ*BLANKS
     C                     MOVEA'11'      *IN,32
     C***********          MOVEL'1282855' ZAMSID                          139832
     C                     MOVEL'LER0015' ZAMSID                          139832
     C                     EXSR SREROR
     C                     ELSE
      *
      ** Loan number must be a six numeric field.
      *
     C           SFLNRF    IFNE *BLANKS
     C                     MOVE '0'       TEST6   7
     C                     MOVELSFLNRF    TEST6
     C                     TESTN          TEST6      78
      *                                                                                       CLE148
     C           WALLOW    IFEQ 'Y'                                                           CLE148
     C                     MOVEL'LELOAN'  WCHR10 10                                           CLE148
     C                     MOVE 'ISO '    WCHR10                                              CLE148
     C                     CALL WCHR10                                                        CLE148
     C                     PARM SFLNRF    PLNRF   6                                           CLE148
     C                     PARM *BLANKS   PVALID  6                                           CLE148
     C                     PARM *BLANKS   PCHKD   1                                           CLE148
     C                     PARM *BLANKS   PDATA   2                                           CLE148
     C                     ENDIF                                                              CLE148
      *
     C           *IN78     IFEQ '0'
     C           WALLOW    ANDEQ'N'                                                           CLE148
     C           PVALID    ORNE *BLANKS                                                       CLE148
     C           WALLOW    ANDEQ'Y'                                                           CLE148
     C                     MOVE '1'       *IN33
     C***********          MOVEL'1282850' ZAMSID                          139832
     C**********           MOVEL'LER0010' ZAMSID                                       139832 CLE148
     C           WALLOW    IFEQ 'N'                                                           CLE148
     C                     MOVEL'LEL0824' ZAMSID                                              CLE148
     C                     ELSE                                                               CLE148
     C                     MOVEL'LEL0822' ZAMSID                                              CLE148
     C                     MOVELPDATA     ZAMSDA                                              CLE148
     C                     ENDIF                                                              CLE148
     C                     EXSR SREROR
     C                     ELSE
      *
      ** Validate loan number against customer details file
      *
     C                     MOVE SFLNRF    WLOAN
     C           KEY004    CHAINCLOAN                78
     C************IN78     IFEQ '1'                                       156227
     C***********RECIL     ORNE 'D'                                131253 156227
     C***********RECI      ORNE 'D'                                       131253
     C***********CNUM      ORNE WCNUM                                     156227
      *                                                                   131253
     C***********RECIL     IFNE 'M'                                131253 156227
     C***********RATF      ORNE 'Y'                                131253 156227
     C***********CLE005    ORNE 'Y'                                131253 156227
     C***********          MOVE '1'       *IN33                           156227
     C***********          MOVEL'1282851' ZAMSID                          139832
     C***********          MOVEL'LER0011' ZAMSID                   139832 153227
     C***********          EXSR SREROR                                    156227
     C***********          ENDIF                                   131253 156227
      *                                                                   131253
     C***********          ENDIF                                          156227
      *                                                                   156227
     C                     SELEC                                          156227
      *                                                                   156227
     C           *IN78     WHEQ '1'                                       156227
     C                     MOVE '1'       *IN33                           156227
     C***********          MOVEL'LER0216' ZAMSID                                       156227 180573
     C                     MOVEL'LER0231' ZAMSID                                              180573
     C                     EXSR SREROR                                    156227
      *                                                                   156227
     C           RECIL     WHEQ 'M'                                       156227
     C           RATF      IFEQ 'Y'                                       156227
     C           CLE005    ANDEQ'Y'                                       156227
      *                                                                                       207629
      *If the loan is a Participation Purchased, & System Value                               207629
      * LoanCustOriginPurch = 'O', use Original Borrower:                                     207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C           PPCUST    IFEQ 'O'                                                           207629
     C           OLNO      IFNE WCNUM                                                         207629
     C                     MOVE '1'       *IN31                                               207629
     C                     MOVEL'LER0219' ZAMSID                                              207629
     C                     EXSR SREROR                                                        207629
     C                     ELSE                                                               207629
     C                     MOVE CNUM      WCNUM                                               207629
     C                     ENDIF                                                              207629
      * Else, System value LoanCustOriginPurch = 'P'                                          207629
     C                     ELSE                                                               207629
     C           CNUM      IFNE WCNUM                                                         207629
     C                     MOVE '1'       *IN31                                               207629
     C                     MOVEL'LER0219' ZAMSID                                              207629
     C                     EXSR SREROR                                                        207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
      *                                                                                       207629
     C                     ELSE                                                               207629
      *                                                                                       207629
     C           CNUM      IFNE WCNUM                                     156227
     C                     MOVE '1'       *IN31                           156227
     C                     MOVEL'LER0219' ZAMSID                          156227
     C                     EXSR SREROR                                    156227
     C                     ENDIF                                          156227
     C                     ENDIF                                                              207629
     C                     ELSE                                           156227
     C                     MOVE '1'       *IN33                           156227
     C***********          MOVEL'LER0217' ZAMSID                                       156227 180573
     C                     MOVEL'LER0232' ZAMSID                                              180573
     C                     EXSR SREROR                                    156227
     C                     ENDIF                                          156227
      *                                                                   156227
     C           RECIL     WHNE 'D'                                       156227
     C                     MOVE '1'       *IN33                           156227
     C                     MOVEL'LER0218' ZAMSID                          156227
     C                     EXSR SREROR                                    156227
      *                                                                   156227
     C           PTYP      WHEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C           PPCUST    IFEQ 'O'                                                           207629
     C           OLNO      IFNE WCNUM                                                         207629
     C                     MOVE '1'       *IN31                                               207629
     C                     MOVEL'LER0219' ZAMSID                                              207629
     C                     EXSR SREROR                                                        207629
     C                     ELSE                                                               207629
     C                     MOVE CNUM      WCNUM                                               207629
     C                     ENDIF                                                              207629
     C                     ELSE                                                               207629
     C           CNUM      IFNE WCNUM                                                         207629
     C                     MOVE '1'       *IN31                                               207629
     C                     MOVEL'LER0219' ZAMSID                                              207629
     C                     EXSR SREROR                                                        207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
      *                                                                                       207629
     C           CNUM      WHNE WCNUM                                     156227
     C                     MOVE '1'       *IN31                           156227
     C                     MOVEL'LER0219' ZAMSID                          156227
     C                     EXSR SREROR                                    156227
      *                                                                   156227
     C                     ENDSL                                          156227
      *                                                                   156227
     C                     MOVE BRCA      WRKBRC  3
     C                     MOVE BRCA      WBKBRC  3
     C                     ENDIF
     C                     ELSE
     C**********           Z-ADD0         WLOAN                                               CLE148
     C                     MOVEL*BLANKS   WLOAN                                               CLE148
     C                     ENDIF
      *
      ** Validate Facility with Customer Det.
      *
     C           WFACL     IFNE *BLANKS
     C           *LIKE     DEFN WFACL     TEST5 + 1
     C                     MOVE '0'       TEST5
     C                     MOVELWFACL     TEST5
     C                     TESTN          TEST5      78
      *
     C           *IN78     IFEQ '0'
     C                     MOVEA'1'       *IN,32
     C                     MOVEL'LER0008' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C           KEY001    CHAINFCLTY                78
     C           *IN78     IFEQ *OFF                                      171859
     C                     EXSR SRCKFR                                    171859
     C                     ENDIF                                          171859
     C           *IN78     IFEQ '1'
     C           RECI      ORNE 'D'
     C           WREAC     ANDEQ*OFF                                      171859
     C                     MOVEA'1'       *IN,32
     C                     MOVEL'LER0143' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     MOVE BRCA      WRKBRC
     C                     MOVE BRCA      WBKBRC
     C                     ENDIF
     C                     ELSE
     C                     Z-ADD0         WFAC05
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate Fee sequence
      *
     C           SFFSEQ    IFNE *BLANKS
     C                     MOVE '1'       *IN34
     C***********          MOVEL'1282852' ZAMSID                          139832
     C                     MOVEL'LER0012' ZAMSID                          139832
     C                     EXSR SREROR
     C                     ENDIF
      *
     C                     MOVE WRKBRC    WZBRCA  3
     C           PMODE     IFNE 'F'                                       CAP064
     C                     EXSR SRUAUT
     C                     ENDIF                                          CAP064
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *  VALAMD - Validate Amend and Authorise Key                    *
      *  Called by: SRVALI                                            *
      *  Calls    : SREROR - Error Processing                         *
      *             CUSTDT - Subr. to access customer details file    *
      *             TRSFS  - Format record fields for screen display  *
      *             SRAUTH - Validate authorisation action            *
      *             SRUAUT - Check if user is authorised to the action*
      *****************************************************************
     C           VALAMD    BEGSR
      *
      ** Customer must be entered
      *
     C           SFCNUM    IFEQ *BLANKS                    ***B001
     C                     MOVEL'LER0006' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C                     MOVEL*BLANKS   KEYC   10
     C                     MOVELSFCNUM    KEYC
     C                     EXSR CUSTDT
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN31
     C                     MOVEL'LER0007' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE *BLANKS   SFCNUM
     C***********          MOVELBBCUST    SFCNUM                          140814
     C                     MOVE BBCUST    SFCNUM                          140814
     C                     MOVE BBCUST    WCNUM
     C                     ENDIF
      *
      ** If both FACILITY & LOAN no. entered then error
      *
     C                     MOVELSFFACT    WFACL
     C                     MOVE SFFCNO    WFACL
     C           WFACL     IFNE *BLANKS
     C           SFLNRF    ANDNE*BLANKS
     C                     MOVEA'11'      *IN,32
     C***********          MOVEL'1282855' ZAMSID                          139832
     C                     MOVEL'LER0015' ZAMSID                          139832
     C                     EXSR SREROR
     C                     ENDIF
      *
      ** Facility no. must be numeric
      *
     C           WFACL     IFNE *BLANKS
     C                     MOVE '0'       TEST5
     C                     MOVELWFACL     TEST5
     C                     TESTN          TEST5      78
      *
     C           *IN78     IFEQ '0'
     C                     MOVEA'1'       *IN,32
     C                     MOVEL'LER0008' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ELSE
     C                     Z-ADD0         WFAC05
     C                     ENDIF
      *
      ** Loan no. must be numeric
      *
     C           SFLNRF    IFNE *BLANKS
     C                     MOVE '0'       TEST6
     C                     MOVELSFLNRF    TEST6
     C                     TESTN          TEST6      78
      *                                                                                       CLE148
     C           WALLOW    IFEQ 'Y'                                                           CLE148
     C                     MOVEL'LELOAN'  WCHR10                                              CLE148
     C                     MOVE 'ISO '    WCHR10                                              CLE148
     C                     CALL WCHR10                                                        CLE148
     C                     PARM SFLNRF    PLNRF                                               CLE148
     C                     PARM *BLANKS   PVALID                                              CLE148
     C                     PARM *BLANKS   PCHKD                                               CLE148
     C                     PARM *BLANKS   PDATA                                               CLE148
     C                     ENDIF                                                              CLE148
      *
     C           *IN78     IFEQ '0'
     C           WALLOW    ANDEQ'N'                                                           CLE148
     C           PVALID    ORNE *BLANKS                                                       CLE148
     C           WALLOW    ANDEQ'Y'                                                           CLE148
     C                     MOVE '1'       *IN33
     C***********          MOVEL'1282850' ZAMSID                          139832
     C**********           MOVEL'LER0010' ZAMSID                                       139832 CLE148
     C           WALLOW    IFEQ 'N'                                                           CLE148
     C                     MOVEL'LEL0824' ZAMSID                                              CLE148
     C                     ELSE                                                               CLE148
     C                     MOVEL'LEL0822' ZAMSID                                              CLE148
     C                     MOVELPDATA     ZAMSDA                                              CLE148
     C                     ENDIF                                                              CLE148
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE SFLNRF    WLOAN
     C                     ENDIF
     C                     ELSE
      *
     C**********           Z-ADD0         WLOAN                                               CLE148
     C                     MOVEL*BLANKS   WLOAN                                               CLE148
     C                     ENDIF
      *
      ** Validate Fee sequence
      *
     C                     MOVE '0'       TEST2   3
     C                     MOVELSFFSEQ    TEST2
     C                     TESTN          TEST2      78
      *
     C           *IN78     IFEQ '0'
     C                     MOVE '1'       *IN34
     C***********          MOVEL'1282854' ZAMSID                          139832
     C                     MOVEL'LER0014' ZAMSID                          139832
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE SFFSEQ    WFSEQ
     C                     END
      *                                                                                       207629
     C********** WLOAN     IFNE 0                                                      207629 CLE148
     C           WLOAN     IFNE *BLANKS                                                       CLE148
     C           PPCUST    ANDEQ'O'                                                           207629
     C           KEY004    CHAINCLOAN                74                                       207629
     C           *IN74     IFEQ '0'                                                           207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C**********           MOVE WCNUM     OCNUM   60                                   207629 CSD027
     C                     MOVE WCNUM     OCNUM   6                                           CSD027
     C                     MOVE CNUM      WCNUM                                               207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
      *
      * No error found yet, check to see if record on file
      *
     C           WERRF     IFEQ *BLANK
     C           KEY002    SETLLLEFEEDF
     C           KEY002    READELEFEEDF                  74
      *                                                                                       207629
     C           *IN74     IFEQ '0'                                                           207629
     C           PPCUST    ANDEQ'O'                                                           207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C           OCNUM     IFNE OLNO                                                          207629
     C                     MOVE '1'       *IN74                                               207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
      *                                                                                       207629
     C           *IN74     IFEQ '1'
     C           FERECI    ORNE 'D'
     C                     MOVE '1'       *IN74
     C                     MOVEA'1111'    *IN,31
     C***********          MOVEL'1282856' ZAMSID                          139832
     C                     MOVEL'LER0016' ZAMSID                          139832
     C                     EXSR SREROR
     C                     ELSE
      *
     C           BKPRCA    IFNE 'Y'
     C                     MOVE '0'       *IN71
     C                     ELSE
     C                     MOVE '1'       *IN71
     C                     ENDIF
      *
     C                     Z-ADDFETNLU    WTNLU
      *
     C                     MOVE FEBRCA    WZBRCA
     C                     EXSR SRUAUT
      *
      ** Release file and transfer info to screen.
      *
     C                     EXCPT
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C                     EXSR TRSFS
     C                     ENDIF
      *
     C           WFAC05    IFEQ 0
     C           KEY004    CHAINCLOAN                78
     C           *IN78     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'CLOAN'   DBFILE           ************
     C                     Z-ADD11        DBASE            * DBERR 11 *
     C                     MOVELWLOAN     DBKEY            ************
     C                     MOVE WCLRT     DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     MOVE BRCA      WBKBRC
      *
     C                     ELSE
      *
     C           KEY001    CHAINFCLTY                78
     C           *IN78     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY'   DBFILE           ************
     C                     Z-ADD12        DBASE            * DBERR 12 *
     C                     MOVELWCNUM     DBKEY            ************
     C                     MOVELWFAC03    FACKEY  5
     C                     MOVE WFAC02    FACKEY
     C                     MOVE FACKEY    DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     MOVE BRCA      WBKBRC
     C                     ENDIF
      *
      ** Set the protect indicators depending upon details.
      *
     C***********FEPSTD    IFLT BJRDNB                                    CSC011
     C***********FEORED    ANDNEBJRDNB                                    CSC011
     C           FEPSTD    IFLT WRNDAY                                    CSC011
     C           FEORED    ANDNEWRNDAY                                    CSC011
     C           FEAUTO    IFEQ 'Y'
     C           FECALT    ANDEQ*BLANKS
     C                     MOVE '1'       *IN79
     C                     ENDIF
     C           FEPYON    IFEQ 'S'
     C                     MOVE '1'       *IN84
     C                     ENDIF
     C           FEPYON    IFEQ 'E'
     C                     MOVE '1'       *IN85
     C                     ENDIF
     C           FECALT    IFNE *BLANKS
     C                     MOVE '1'       *IN77
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** For Authorise action
      *
     C           SFLCHT    IFEQ 'X'
     C           WERRF     ANDEQ*BLANK
     C                     MOVE '1'       *IN22
      *
      **  Enable F11 only if BPAURV is not activated
      *
     C           BPAURV    IFNE 'Y'
     C                     MOVE '1'       *IN26
     C                     ENDIF
      *
     C                     EXSR SRAUTH
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *  VALDEL - Validate Delete Key                                 *
      *  Called by: SRVALI                                            *
      *  Calls    : SREROR - Error Processing                         *
      *             CUSTDT - Subr. to access customer details file    *
      *             TRSFS  - Format record fields for screen display  *
      *             SRUAUT - Check if user is authorised to the action*
      *****************************************************************
     C           VALDEL    BEGSR
      *
      ** Test if customer entered
      *
     C           SFCNUM    IFEQ *BLANKS
     C                     MOVEL'LER0006' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     MOVEL*BLANKS   KEYC   10
     C                     MOVELSFCNUM    KEYC
     C                     EXSR CUSTDT
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN31
     C                     MOVEL'LER0007' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE *BLANKS   SFCNUM
     C***********          MOVELBBCUST    SFCNUM                          140814
     C                     MOVE BBCUST    SFCNUM                          140814
     C                     MOVE BBCUST    WCNUM
     C                     ENDIF
      *
      ** If both FACILITY & LOAN no. entered then error
      *
     C                     MOVELSFFACT    WFACL
     C                     MOVE SFFCNO    WFACL
     C           WFACL     IFNE *BLANKS
     C           SFLNRF    ANDNE*BLANKS
     C                     MOVEA'11'      *IN,32
     C***********          MOVEL'1282855' ZAMSID                          139832
     C                     MOVEL'LER0015' ZAMSID                          139832
     C                     EXSR SREROR
     C                     ENDIF
      *
      ** Facility no. must be numeric
      *
     C           WFACL     IFNE *BLANKS
     C                     MOVE '0'       TEST5
     C                     MOVELWFACL     TEST5
     C                     TESTN          TEST5      78
     C           *IN78     IFEQ '0'
     C                     MOVEA'1'       *IN,32
     C                     MOVEL'LER0008' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ELSE
     C                     Z-ADD0         WFAC05
     C                     ENDIF
      *
      ** Loan no. must be numeric
      *
     C           SFLNRF    IFNE *BLANKS
     C                     MOVE '0'       TEST6
     C                     MOVELSFLNRF    TEST6
     C                     TESTN          TEST6      78
      *                                                                                       CLE148
     C           WALLOW    IFEQ 'Y'                                                           CLE148
     C                     MOVEL'LELOAN'  WCHR10                                              CLE148
     C                     MOVE 'ISO '    WCHR10                                              CLE148
     C                     CALL WCHR10                                                        CLE148
     C                     PARM SFLNRF    PLNRF                                               CLE148
     C                     PARM *BLANKS   PVALID                                              CLE148
     C                     PARM *BLANKS   PCHKD                                               CLE148
     C                     PARM *BLANKS   PDATA                                               CLE148
     C                     ENDIF                                                              CLE148
      *                                                                                       CLE148
     C           *IN78     IFEQ '0'
     C           WALLOW    ANDEQ'N'                                                           CLE148
     C           PVALID    ORNE *BLANKS                                                       CLE148
     C           WALLOW    ANDEQ'Y'                                                           CLE148
     C                     MOVE '1'       *IN33
     C***********          MOVEL'1282850' ZAMSID                          139832
     C**********           MOVEL'LER0010' ZAMSID                                       139832 CLE148
     C           WALLOW    IFEQ 'N'                                                           CLE148
     C                     MOVEL'LEL0824' ZAMSID                                              CLE148
     C                     ELSE                                                               CLE148
     C                     MOVEL'LEL0822' ZAMSID                                              CLE148
     C                     MOVELPDATA     ZAMSDA                                              CLE148
     C                     ENDIF                                                              CLE148
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE SFLNRF    WLOAN
     C                     ENDIF
     C                     ELSE
     C**********           Z-ADD0         WLOAN                                               CLE148
     C                     MOVEL*BLANK    WLOAN                                               CLE148
     C                     ENDIF
      *
      ** Validate Fee sequence
      *
     C                     MOVE '0'       TEST2
     C                     MOVELSFFSEQ    TEST2
     C                     TESTN          TEST2      78
     C           *IN78     IFEQ '0'
     C                     MOVE '1'       *IN34
     C***********          MOVEL'1282854' ZAMSID                          139832
     C                     MOVEL'LER0014' ZAMSID                          139832
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE SFFSEQ    WFSEQ
     C                     ENDIF
      *                                                                                       207629
     C********** WLOAN     IFNE 0                                                      207629 CLE148
     C           WLOAN     IFNE *BLANKS                                                       CLE148
     C           PPCUST    ANDEQ'O'                                                           207629
     C           KEY004    CHAINCLOAN                74                                       207629
     C           *IN74     IFEQ '0'                                                           207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C**********           MOVE WCNUM     OCNUM   60                                   207629 CSD027
     C                     MOVE WCNUM     OCNUM   6                                           CSD027
     C                     MOVE CNUM      WCNUM                                               207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
      *
      ** No error found yet, check to see if record on file
      *
     C           WERRF     IFEQ *BLANK
     C           KEY002    SETLLLEFEEDF
     C           KEY002    READELEFEEDF                  74
      *                                                                                       207629
     C           *IN74     IFEQ '0'                                                           207629
     C           PPCUST    ANDEQ'O'                                                           207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C           OCNUM     IFNE OLNO                                                          207629
     C                     MOVE '1'       *IN74                                               207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
      *                                                                                       207629
     C           *IN74     IFEQ '1'
     C           FERECI    ORNE 'D'
     C                     MOVE '1'       *IN74
     C                     MOVEA'1111'    *IN,31
     C***********          MOVEL'1282856' ZAMSID                          139832
     C                     MOVEL'LER0016' ZAMSID                          139832
     C                     EXSR SREROR
     C                     ELSE
      *
     C                     Z-ADDFETNLU    WTNLU
      *
      ** Make sure that user is authorised to this information before
      ** transferring details to the screen.
      *
     C                     MOVE FEBRCA    WZBRCA
     C                     EXSR SRUAUT
      *
      ** Release file and transfer info to screen.
     C                     EXCPT
      *
     C           FECALT    IFNE *BLANKS
     C           FEAMTS    ANDNE0
     C                     MOVEA'1111'    *IN,31
     C                     MOVEL'LER0110' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C                     EXSR TRSFS
     C                     ENDIF
      *
      ** Set the protect indicators depending upon details.
      *
     C                     MOVE '1'       *IN22
     C                     MOVE '1'       *IN27
      *
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *  VALENQ - Validate Enquire Key                                *
      *  Called by: SRVALI                                            *
      *  Calls    : SREROR - Error Processing                         *
      *             CUSTDT - Subr. to access customer details file    *
      *             TRSFS  - Format record fields for screen display  *
      *             SRUAUT - Check if user is authorised to the action*
      *****************************************************************
     C           VALENQ    BEGSR
      *
     C                     MOVE '0'       *IN74
      ** Test if customer entered
      *
     C           SFCNUM    IFEQ *BLANKS
     C                     MOVEL'LER0006' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C                     MOVEL*BLANKS   KEYC   10
     C                     MOVELSFCNUM    KEYC
     C                     EXSR CUSTDT
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN31
     C                     MOVEL'LER0007' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE *BLANKS   SFCNUM
     C                     MOVE BBCUST    SFCNUM
     C                     MOVE BBCUST    WCNUM
     C                     ENDIF
      *
      ** If both FACILITY & LOAN no. entered then error
      *
     C                     MOVELSFFACT    WFACL   5
     C                     MOVE SFFCNO    WFACL
     C           WFACL     IFNE *BLANKS
     C           SFLNRF    ANDNE*BLANKS
     C                     MOVEA'11'      *IN,32
     C***********          MOVEL'1282855' ZAMSID                          139832
     C                     MOVEL'LER0015' ZAMSID                          139832
     C                     EXSR SREROR
     C                     ENDIF
      *
      ** Facility no. must be numeric or the first 3 digits must be.
      *
     C           SFFACT    IFNE *BLANKS
     C                     MOVE '0'       TEST3   4
     C                     MOVELSFFACT    TEST3
     C                     TESTN          TEST3      78
     C           *IN78     IFEQ '0'
     C                     MOVEA'1'       *IN,32
     C                     MOVEL'LER0008' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE SFFACT    WFAC03
     C                     ENDIF
     C                     ELSE
     C                     Z-ADD0         WFAC05
     C                     ENDIF
      *
     C           SFFCNO    IFEQ *BLANKS
     C                     Z-ADD0         WFAC02
     C                     ELSE
     C                     MOVE SFFCNO    WFAC02
     C                     ENDIF
      *                                                                   187509
      ** Additional validation in case facility no. is                    187509
      ** incomplete.                                                      187509
      *                                                                   187509
     C           SFFCNO    IFEQ *BLANKS                                   187509
     C           SFFACT    OREQ *BLANKS                                   187509
     C           SFLNRF    IFEQ *BLANKS                                   187509
     C                     MOVE '1'       *IN32                           187509
     C                     MOVEL'LER0008' ZAMSID                          187509
     C                     EXSR SREROR                                    187509
     C                     ENDIF                                          187509
     C                     ENDIF                                          187509
      *
      ** Loan no. must be numeric
      *
     C           SFLNRF    IFNE *BLANKS
     C                     MOVE '0'       TEST6
     C                     MOVELSFLNRF    TEST6
     C                     TESTN          TEST6      78
      *
     C           *IN78     IFEQ '0'
     C                     MOVE '1'       *IN33
     C***********          MOVEL'1282850' ZAMSID                          139832
     C                     MOVEL'LER0010' ZAMSID                          139832
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE SFLNRF    WLOAN
     C                     ENDIF
     C                     ELSE
      *                                                                   187509
      ** Additional validation if loan no. is blank                       187509
      *                                                                   187509
     C           SFFACT    IFNE *BLANKS                                   187509
     C           SFFCNO    ANDNE*BLANKS                                   187509
     C**********           Z-ADD0         WLOAN                                               CLE148
     C                     MOVEL*BLANKS   WLOAN                                               CLE148
     C                     ELSE                                           187509
     C                     MOVE '1'       *IN32                           187509
     C                     MOVEL'LER0008' ZAMSID                          187509
     C                     EXSR SREROR                                    187509
     C                     ENDIF                                          187509
     C                     ENDIF
      *
      ** Validate Fee sequence
      *
     C***********SFFSEQ    IFNE *BLANKS                                   187509
     C                     MOVE '0'       TEST2
     C                     MOVELSFFSEQ    TEST2
     C                     TESTN          TEST2      78
     C           *IN78     IFEQ '0'
     C                     MOVE '1'       *IN34
     C***********          MOVEL'1282854' ZAMSID                          139832
     C                     MOVEL'LER0014' ZAMSID                          139832
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE SFFSEQ    WFSEQ
     C                     ENDIF
      *                                                                                       207629
     C********** WLOAN     IFNE 0                                                      207629 CLE148
     C           WLOAN     IFNE *BLANKS                                                       CLE148
     C           PPCUST    ANDEQ'O'                                                           207629
     C           KEY004    CHAINCLOAN                74                                       207629
     C           *IN74     IFEQ '0'                                                           207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C**********           MOVE WCNUM     OCNUM   60                                   207629 CSD027
     C                     MOVE WCNUM     OCNUM   6                                           CSD027
     C                     MOVE CNUM      WCNUM                                               207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C***********          ELSE                                           187509
     C***********          Z-ADD0         WFSEQ                           187509
     C***********          ENDIF                                          187509
      *
      ** No error found yet, check to see if record on file
      *
     C           WERRF     IFEQ *BLANK
     C           KEY002    SETLLLEFEEDF
     C                     READ LEFEEDF                  74
      *
     C           *IN74     IFEQ '0'                                                           207629
     C           PPCUST    ANDEQ'O'                                                           207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C           OCNUM     IFNE OLNO                                                          207629
     C                     MOVE '1'       *IN74                                               207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
      *                                                                                       207629
     C           *IN74     IFEQ '0'
     C           WCNUM     IFEQ FECNUM
     C********** WLOAN     IFNE 0                                                             CLE148
     C           WLOAN     IFNE *BLANKS                                                       CLE148
     C           WLOAN     ANDNEFELOAN
     C                     MOVE '1'       *IN74
     C                     ENDIF
     C           WFAC03    IFNE 0
     C                     MOVELFEFACL    WFAC3
     C           WFAC03    IFNE WFAC3
     C                     MOVE '1'       *IN74
     C                     ENDIF
      *
     C           WFAC02    IFNE 0
     C                     Z-ADDFEFACL    WWFAC2  20
     C           WFAC02    IFNE WWFAC2
     C                     MOVE '1'       *IN74
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C           WFSEQ     IFNE 0
     C           WFSEQ     ANDNEFEFSEQ
     C                     MOVE '1'       *IN74
     C                     ENDIF
      *
     C                     ELSE
     C                     MOVE '1'       *IN74
     C                     ENDIF
     C                     ENDIF
      *
     C           *IN74     IFEQ '0'                                                           207629
     C           PPCUST    ANDEQ'O'                                                           207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C                     MOVE OLNO      SFCNUM                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
      *                                                                                       207629
     C           *IN74     IFEQ '1'
     C                     EXCPT
     C                     MOVEA'1111'    *IN,31
     C***********          MOVEL'1282857' ZAMSID                          139832
     C                     MOVEL'LER0017' ZAMSID                          139832
     C                     EXSR SREROR
     C                     ELSE
      *
     C                     MOVE FEBRCA    WZBRCA
     C                     EXSR SRUAUT
      *
      ** Release file and transfer info to screen.
      *
     C                     EXCPT
     C                     EXSR TRSFS
      *
      ** If a deleted record
      *
     C           FERECI    IFEQ 'R'
     C           FERECI    OREQ '*'                                                          BUG3729
     C                     MOVEL'LER0197' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SSTAT
     C                     MOVE *BLANKS   ZAMSID
     C                     ENDIF
      *
      ** If a matured record
      *
     C           FERECI    IFEQ 'M'
     C                     MOVEL'LER0198' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SSTAT
     C                     MOVE *BLANKS   ZAMSID
     C                     ENDIF
      *
      ** Set the protect indicators depending upon details
      *
     C                     MOVE '1'       *IN22
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRVALF  -  Validate Detail Screen                             *
      * Called by: SRDET1, SRBTCH, SRVALI, SRSSET, SRSREV             *
      * Calls    : SREROR - Error Processing                          *
      *            SRCATP - Validate Calculation Type                 *
      *****************************************************************
     C           SRVALF    BEGSR
      *
      ** No validation needed if 57 or 58 is on because the input
      ** fields are protected
      *
      ** Reset screen ERROR ind.
     C                     MOVEA'00000000'*IN,30
     C                     MOVEA'00000000'*IN,38
     C                     MOVEA'00000000'*IN,46
     C                     MOVEA'00000000'*IN,54
     C                     MOVEA'00000'   *IN,62
     C                     MOVE '0'       *IN73
     C                     MOVE *OFF      *IN76                                               CLE034
      *
     C                     MOVE '0'       GRTCD
      *
     C           SFLCHT    IFEQ 'D'
     C                     ELSE
      *
      * If Repair mode then need to validate customer, facility,          CAP064
      * loan and fee sequence.                                            CAP064
     C           PMODE     IFEQ 'F'                                       CAP064
     C                     EXSR VALINP                                    CAP064
     C                     ENDIF                                          CAP064
      ** Fee Code validation
      ** ===================
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C                     MOVE *BLANK    WADJY   1                                           CAS009
     C                     ENDIF                                                              CAS009
      *
     C           *IN84     IFEQ '0'
     C           *IN85     ANDEQ'0'
     C           *IN77     ANDEQ'0'
     C                     CALL 'AOFEER0'
     C                     PARM '*BLANKS' PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM SFECOD    FKEY    2
     C           SDFEE     PARM SDFEE     DSFDY
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN40
     C***********          MOVEL'1282858' ZAMSID                          139832
     C                     MOVEL'LER0018' ZAMSID                          139832
     C                     EXSR SREROR
     C                     ELSE
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C                     CALL 'AOLOANR0'                                                    CAS009
     C                     PARM '*BLANKS' PRTCD                                               CAS009
     C                     PARM '*KEY   ' POPTN                                               CAS009
     C                     PARM LTYP      PLTYP   2                                           CAS009
     C                     PARM SUTP      PSUTP   2                                           CAS009
     C                     PARM LCLAS     PCLAS   4                                           256822
     C           SDLOAN    PARM SDLOAN    DSFDY                                               CAS009
     C           PRTCD     IFNE *BLANKS                                                       CAS009
     C           AUADJY    OREQ 'Y'                                                           CAS009
     C           AYACAI    ANDNE'Y'                                                           CAS009
     C                     MOVE '1'       *IN40                                               CAS009
     C                     MOVEL'LEV1071' ZAMSID                                              CAS009
     C                     EXSR SREROR                                                        CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE AUADJY    WADJY                                               CAS009
     C                     MOVE *BLANKS   SFECOD                                              CAS009
     C                     MOVELAUFECD    SFECOD                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ELSE                                                               CAS009
      *                                                                                       CAS009
      ** CAS009 is *Off                                                                       CAS009
      *                                                                                       CAS009
     C                     MOVE *BLANKS   SFECOD
     C                     MOVELAUFECD    SFECOD
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF
     C                     ENDIF
      *
      ** Fee Currency validation
      ** =======================
      *
     C********** *IN84     IFEQ '0'                                                          261083A
     C********** *IN85     ANDEQ'0'                                                          261083A
     C********** *IN77     ANDEQ'0'                                                          261083A
     C                     CALL 'AOCURRR0'
     C***********          PARM '*BLANKS' PRTCD                           152469
     C                     PARM *BLANKS   PRTCD                           152169
     C                     PARM '*KEY   ' POPTN
     C                     PARM SFECUR    K101    3
     C           SDCURR    PARM SDCURR    DSSDY
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN41
     C***********          MOVEL'1282859' ZAMSID                          139832
     C                     MOVEL'LER0019' ZAMSID                          139832
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE *BLANKS   SFECUR
     C                     MOVE A6CYCD    SFECUR
     C                     MOVE SFECUR    WCCY
     C***********          MOVE A6MDIN    ZMDI1   1                 152169CLE009
     C***********          Z-ADDA6SPRT    ZRATE1 138                152169CLE009
     C                     MOVE A6MDIN    ZMDI2   1                       CLE009
     C                     Z-ADDA6SPRT    ZRATE2 138                      CLE009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C                     Z-ADDA6SPRT    WFEERT 138                                          CAS009
     C                     MOVE A6MDIN    WFEEMD  1                                           CAS009
     C                     Z-ADDA6NBDP    WFEEDP  10                                          CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF
     C**********           ENDIF                                                             261083A
      *
      ** Fee Amount validation
      ** =====================
      *
     C           *IN84     IFEQ '0'
     C           *IN77     ANDEQ'0'
      *
      ** If LOAN reference entered then amount is mandatory
      *
     C********** WLOAN     IFNE 0                                                             CLE148
     C           WLOAN     IFNE *BLANKS                                                       CLE148
     C           SFEAMT    ANDEQ*BLANKS
     C/COPY WNCPYSRC,LEH00745
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'97'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'98'                                                          CLE073
     C                     ELSE                                                               CLE073
     C                     MOVE '1'       *IN42
     C                     MOVEL'LER0020' ZAMSID
     C                     EXSR SREROR
     C/COPY WNCPYSRC,LEH00746
     C                     ENDIF                                                              CLE073
     C                     ENDIF
     C/COPY WNCPYSRC,LE2210C024
      *
      ** Align
      *
     C           SFEAMT    IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SFEAMT    ZFIELD
     C                     Z-ADDA6NBDP    ZADEC
     C           13        SUB  A6NBDP    ZADIG
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN42
     C                     MOVEL'LER0021' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE ZFIELD    WFAMT
     C                     ENDIF
      *
      ** If facility amount blank
      *
     C                     ELSE
     C                     Z-ADD0         WFAMT
     C                     ENDIF
      *
      ** Loan amount must be greater the zero
      *
     C********** WLOAN     IFNE 0                                                             CLE148
     C           WLOAN     IFNE *BLANKS                                                       CLE148
     C           WFAMT     ANDEQ0
     C           WERRF     ANDEQ*BLANK
     C/COPY WNCPYSRC,LEH00747
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'97'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'98'                                                          CLE073
     C                     ELSE                                                               CLE073
     C                     MOVE '1'       *IN42
     C                     MOVEL'LER0020' ZAMSID
     C                     EXSR SREROR
     C/COPY WNCPYSRC,LEH00748
     C                     ENDIF                                                              CLE073
     C                     ENDIF
      *
      ** If this is a non-calculated facility based fee the amount
      ** must be entered.
      *
     C           WFAMT     IFEQ 0
     C           WFAC05    ANDNE0
     C           SFCALT    ANDEQ*BLANKS
     C                     MOVE '1'       *IN42
     C                     MOVEL'LER0021' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
      ** Calculated fee cannot have negative accruals                                         199459
      *                                                                                       199459
     C           SFCALT    IFEQ *BLANKS                                                       199459
     C           WFAMT     ANDNE0                                                             199459
     C           SFESGN    IFEQ '-'
     C                     Z-SUBWFAMT     WFAMT
     C                     ENDIF
     C           SFESGN    IFEQ '-'
     C           SFESGN    OREQ ' '
     C           SFESGN    OREQ '+'
     C                     ELSE
     C                     MOVE '1'       *IN42
     C                     MOVE '1'       *IN43
     C***********          MOVEL'1276567' ZAMSID                    132949
     C                     MOVEL'LER0077' ZAMSID                    132949
     C                     EXSR SREROR
     C                     ENDIF
      *                                                                                       199459
     C                     ELSE                                                               199459
     C           ACTN      IFEQ 'I'                                                           CLE073
     C           SFESGN    IFNE ' '                                                           199459
     C           PMODE     ANDNE'B'                                                           CLE031
     C           SFESGN    OREQ '-'                                                           CLE031
     C           PMODE     ANDEQ'B'                                                           CLE031
     C                     MOVE '1'       *IN42                                               199459
     C                     MOVE '1'       *IN43                                               199459
     C                     MOVEL'LER0233' ZAMSID                                              199459
     C                     EXSR SREROR                                                        199459
     C                     ENDIF                                                              199459
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              199459
      *
     C                     ENDIF
      *
      ** Validate Period Start Date
      ** ==========================
      *
     C           *IN84     IFEQ '0'
     C           *IN85     ANDEQ'0'
     C           *IN77     ANDEQ'0'
      *
      ** Start date is mandatory and must be numeric
      *
     C           SFEPSD    IFEQ *BLANKS
     C                     MOVE '1'       *IN44
     C                     MOVEL'LER0022' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE '0'       TEST6
     C                     MOVELSFEPSD    TEST6
     C                     TESTN          TEST6      78
     C                     ENDIF
      *
      ** convert to Midas date format
      *
     C           *IN78     IFEQ '1'
     C                     MOVE '0'       *IN99
     C                     MOVE SFEPSD    ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN44
     C                     MOVEL'LER0022' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     Z-ADDZDAYNO    WPSTD   50
      *
      ** If loan based fee
      *
     C           WFAC03    IFEQ 0
     C           WFAC02    ANDEQ0
      *
      ** Warning if date is before start date or after maturity
      ** date of loan
      *
     C           ZDAYNO    IFLT VDAT
     C/COPY WNCPYSRC,LEH00749
     C           CLE073    ANDNE'Y'                                                           CLE073
     C           ZDAYNO    ORLT VDAT                                                          CLE073
     C           CLE073    ANDEQ'Y'                                                           CLE073
     C           SFCALT    ANDNE'97'                                                          CLE073
     C           SFCALT    ANDNE'98'                                                          CLE073
     C           SFCALT    ANDNE'99'                                                          CLE073
     C           ZDAYNO    ORGT MDAT
     C           MDAT      ANDNE0
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           WFAC05    ANDEQ0                                                             CAS009
     C           WADJY     ANDEQ'Y'                                                           CAS009
     C           FECALT    ANDEQ*BLANKS                                                       CAS009
     C           FEPYON    ANDEQ'S'                                                           CAS009
     C           CAS009    OREQ 'Y'                                                           CAS009
     C           WFAC05    ANDEQ0                                                             CAS009
     C           WADJY     ANDEQ'Y'                                                           CAS009
     C           FECALT    ANDEQ*BLANKS                                                       CAS009
     C           FEPYON    ANDEQ' '                                                           CAS009
     C                     MOVE '1'       *IN44                                               CAS009
     C**********           MOVEL'LEV1067' ZAMSID                                       CAS009 CAS011
     C                     MOVEL'LEV1072' ZAMSID                                              CAS011
     C                     EXSR SREROR                                                        CAS009
      *                                                                                       CAS009
     C                     ELSE                                                               CAS009
      *                                                                                       CAS009
     C                     MOVE 'Y'       WWERR
     C                     MOVEL'LER0023' ZAMSID
     C                     MOVE '1'       *IN44
     C                     EXSR SREROR
     C                     MOVE *BLANK    WWERR
     C                     ENDIF                                                              CAS009
     C/COPY WNCPYSRC,LEH00750
     C                     ENDIF
      *                                                                                       CLE073
     C           ZDAYNO    IFLT VDAT                                                          CLE073
     C           CLE073    ANDEQ'Y'                                                           CLE073
     C           SFCALT    ANDEQ'97'                                                          CLE073
     C           ZDAYNO    ORLT VDAT                                                          CLE073
     C           CLE073    ANDEQ'Y'                                                           CLE073
     C           SFCALT    ANDEQ'98'                                                          CLE073
     C           ZDAYNO    ORLT VDAT                                                          CLE073
     C           CLE073    ANDEQ'Y'                                                           CLE073
     C           SFCALT    ANDEQ'99'                                                          CLE073
     C                     MOVEL'XLE0012' ZAMSID                                              CLE073
     C                     MOVE '1'       *IN44                                               CLE073
     C                     EXSR SREROR                                                        CLE073
     C                     ENDIF                                                              CLE073
      *
     C                     ELSE
      *
      ** If facility based fee warning if date is either before
      ** the availabilty date or after the expiry Date
      *
     C           ZDAYNO    IFLT DTAP
     C           ZDAYNO    ORGT DTEX
      *
      ** If calculation type then error message rather than warning
      ** message
      *
     C           SFEAMT    IFEQ *BLANK
     C                     MOVEL'LER0112 'ZAMSID
     C                     ELSE
     C                     MOVE 'Y'       WWERR
     C                     MOVEL'LER0023' ZAMSID
     C                     ENDIF
      *
     C                     MOVE '1'       *IN44
     C                     EXSR SREROR
     C                     MOVE *BLANK    WWERR
     C                     ENDIF
      *
      ** Also if calc type then cannot be prior to start of History
      *
     C           SFCALT    IFNE *BLANKS
     C           WHISST    IFGT ZDAYNO
     C                     MOVEL'LER0113 'ZAMSID
     C                     MOVE '1'       *IN44
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
     C                     ELSE
      *
     C           *IN44     IFEQ '0'
     C                     MOVE '1'       *IN44
     C                     MOVEL'LER0022' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
     C                     ELSE
     C                     Z-ADDFEPSTD    WPSTD
     C                     ENDIF
      *
      ** Period End date validation
      ** ==========================
      *
      ** Period End Date if entered must be a valid date
      ** and greater than period start date
      *
     C           SFEPED    IFNE *BLANKS
     C                     MOVE '0'       TEST6
     C                     MOVELSFEPED    TEST6
     C                     TESTN          TEST6      78
     C           *IN78     IFEQ '1'
      *
      ** Check for valid date
      *
     C                     MOVE SFEPED    ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       GRTCD   1
     C                     ENDIF
     C                     ELSE
     C                     MOVE '1'       *IN45
     C                     MOVEL'LER0193' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
      ** Error if grtcd = 1
      *
     C           GRTCD     IFEQ '0'
     C           *IN45     ANDEQ'0'
      *
      ***If*end*date*is*less*than*run*date*then*an*error*for*calc.*type   143791
      ***********                                                         143791
     C***********ZDAYNO    IFLT BJRDNB                                    143791
     C***********SFCALT    ANDNE*BLANKS                                   143791
     C***********          MOVE '1'       *IN45                           143791
     C***********          MOVEL'LER0115' ZAMSID                          143791
     C***********          EXSR SREROR                                    143791
     C***********          ENDIF                                          143791
      *
      ** If end date is less than start date then an error
      *
     C           ZDAYNO    IFLE WPSTD
     C                     MOVE '1'       GRTCD
     C                     ENDIF
      *
     C           GRTCD     IFEQ '1'
     C                     MOVE '1'       *IN45
     C                     MOVEL'LER0025' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     Z-ADDZDAYNO    WPEND   50
     C                     ENDIF
     C                     ENDIF
      *
     C           *IN45     IFEQ '0'
     C           WFAC03    IFEQ 0
     C           WFAC02    ANDEQ0
      *
      ** Warning if date is before start date or after maturity
      ** date of loan.
      *
     C           ZDAYNO    IFLT VDAT
     C           ZDAYNO    ORGT MDAT
     C           MDAT      ANDNE0
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           WFAC05    ANDEQ0                                                             CAS009
     C           WADJY     ANDEQ'Y'                                                           CAS009
     C           FECALT    ANDEQ*BLANKS                                                       CAS009
     C           FEPYON    ANDEQ'E'                                                           CAS009
     C           CAS009    OREQ 'Y'                                                           CAS009
     C           WFAC05    ANDEQ0                                                             CAS009
     C           WADJY     ANDEQ'Y'                                                           CAS009
     C           FECALT    ANDEQ*BLANKS                                                       CAS009
     C           FEPYON    ANDEQ'N'                                                           CAS009
     C           WFAMT     ANDNE0                                                             CAS009
     C                     MOVE '1'       *IN45                                               CAS009
     C**********           MOVEL'LEV1068' ZAMSID                                       CAS009 CAS011
     C                     MOVEL'LEV1073' ZAMSID                                              CAS011
     C                     EXSR SREROR                                                        CAS009
      *                                                                                       CAS009
     C                     ELSE                                                               CAS009
      *                                                                                       CAS009
     C                     MOVE 'Y'       WWERR
     C                     MOVEL'LER0030' ZAMSID
     C                     MOVE '1'       *IN45
     C                     EXSR SREROR
     C                     MOVE *BLANK    WWERR
     C                     ENDIF                                                              CAS009
     C/COPY WNCPYSRC,LEH00751
     C                     ENDIF
      *                                                                                       CLE073
      ** Warning if date is before than Loan maturity date                                    CLE073
      *                                                                                       CLE073
     C           ZDAYNO    IFLT MDAT                                                          CLE073
     C           MDAT      ANDNE0                                                             CLE073
     C           CLE073    ANDEQ'Y'                                                           CLE073
     C                     MOVE 'Y'       WWERR                                               CLE073
     C                     MOVEL'XLE0010' ZAMSID                                              CLE073
     C                     MOVE '1'       *IN45                                               CLE073
     C                     EXSR SREROR                                                        CLE073
     C                     MOVE *BLANK    WWERR                                               CLE073
     C                     ENDIF                                                              CLE073
      *
     C                     ELSE
      *
      ** Warning if Facility *ne 0 and date is either befor
      ** the Availabilty Date or after the Expiry Date
      *
     C           ZDAYNO    IFLT DTAP
     C           ZDAYNO    ORGT DTEX
      *
      ** If calculation type output error message rather than
      ** warning message
      *
     C           SFEAMT    IFEQ *BLANK
     C                     MOVEL'LER0114 'ZAMSID
     C                     ELSE
     C                     MOVE 'Y'       WWERR
     C                     MOVEL'LER0030' ZAMSID
     C                     ENDIF
      *
     C                     MOVE '1'       *IN45
     C                     EXSR SREROR
     C                     MOVE *BLANK    WWERR
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Validate Payment on Indicator
      ** =============================
      *
     C           *IN84     IFEQ '0'
     C           *IN85     ANDEQ'0'
     C           *IN77     ANDEQ'0'
     C/COPY WNCPYSRC,LEH00752
      *                                                                                       CLE073
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'97'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'98'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'99'                                                          CLE073
     C           SFEPON    IFNE 'N'                                                           CLE073
     C                     MOVE '1'       *IN46                                               CLE073
     C                     MOVEL'XLE0006' ZAMSID                                              CLE073
     C                     EXSR SREROR                                                        CLE073
     C                     ENDIF                                                              CLE073
     C                     ELSE                                                               CLE073
      *                                                                                       CLE073
     C           SFEPED    IFEQ *BLANKS
     C           SFEPON    ANDNE*BLANKS
     C           CAS009    ANDNE'Y'                                                           CAS009
      *                                                                                       CAS009
      ** Allow Payment On = 'N' when CAS009 is *On. Cannot be S or E.                         CAS009
      *                                                                                       CAS009
     C           SFEPED    OREQ *BLANKS                                                       CAS009
     C           SFEPON    ANDEQ'S'                                                           CAS009
     C           CAS009    ANDEQ'Y'                                                           CAS009
     C           SFEPED    OREQ *BLANKS                                                       CAS009
     C           SFEPON    ANDEQ'E'                                                           CAS009
     C           CAS009    ANDEQ'Y'                                                           CAS009
      *
     C           SFCALT    IFEQ *BLANKS
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           SFEPON    ANDEQ'N'                                                           CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE '1'       *IN46
     C                     MOVEL'LER0027' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF                                                              CLE031
     C                     ENDIF
      *
     C                     ELSE
     C           SFEPED    IFNE *BLANKS
     C           SFEPON    IFEQ 'S'
     C           SFEPON    OREQ 'E'
     C           SFEPON    OREQ 'N'
     C                     ELSE
     C                     MOVE '1'       *IN46
     C                     MOVEL'LER0028' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C           SFEPON    IFEQ 'N'
     C           SFEAMT    ANDNE*BLANKS
     C           CLE031    ANDEQ'N'                                                           CLE031
      *                                                                                       CAS009
      ** Allow Payment On = 'N' when CAS009 is *On.                                           CAS009
      *                                                                                       CAS009
     C           CAS009    ANDNE'Y'                                                           CAS009
     C                     MOVE '1'       *IN46
     C                     MOVEL'LER0094' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C           SFEPON    IFEQ 'S'
     C           SFEAMT    ANDEQ*BLANKS
     C                     MOVE '1'       *IN46
     C                     MOVEL'LER0094' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LEH00753
     C                     ENDIF                                                              CLE073
     C                     ENDIF
      *
      ** Validate advice indicator
      ** =========================
      *
      **  If not protected, can only be Y, N, or blank.
      *
     C           *IN79     IFEQ '0'
     C/COPY WNCPYSRC,LE2210C010
     C           SFEADV    IFEQ *BLANKS
     C           SFEADV    OREQ 'N'
     C           SFEADV    OREQ 'Y'
     C                     ELSE
     C                     MOVE '1'       *IN47
     C                     MOVEL'LER0029' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
      **  Can't auto settle calculated fees if adjustment outstanding
      *
     C           SFCALT    IFNE *BLANKS
     C           SFLCHT    ANDEQ'A'
     C           SFEADV    ANDEQ'Y'
      *
      **  Can't autosettle if there is any adjustment amount on LEFEED
      *
     C           FEAMTA    IFNE 0
     C                     MOVE '1'       *IN47
     C                     MOVEL'LER0144' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
      *
      **  Can't autosettle if there is any adjustment on LEFEEAD
      *
     C           FEADKY    SETLLLEFEEADF
     C           FEADKY    READELEFEEADF                 74
     C           FARECI    DOWEQ'*'
     C           *IN74     ANDEQ'0'
     C           FATYPE    ORNE *BLANK
     C           *IN74     ANDEQ'0'
     C           FEADKY    READELEFEEADF                 74
     C                     ENDDO
     C           *IN74     IFEQ '0'
     C                     MOVE '1'       *IN47
     C                     MOVEL'LER0144' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate Shared Fee
      ** ===================
      *
     C           CLE006    IFEQ 'Y'                                       187261
     C           SFESHR    IFNE 'Y'
     C           SFESHR    ANDNE'N'
     C                     MOVE '1'       *IN48
     C                     MOVEL'LER0183' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF                                          187261
      *
      ** Shared Fee must be 'N' for non-syndicated loan or facility
      *
     C           CLE006    IFEQ 'Y'                                       187261
     C           SFESHR    IFNE 'N'
     C***********WPTFI     ANDNE'P'                                       127656
     C***********WPTFI     ANDNE'I'                                       127656
     C           WSYND     ANDEQ'N'                                       127656
     C           *IN48     ANDEQ'0'
     C                     MOVE '1'       *IN48
     C                     MOVEL'LER0184' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF                                          187261
      *
      ** Validate Calculation Type
      ** =========================
      *
     C           SFCALT    IFNE *BLANKS
     C           SFEAMT    ANDNE*BLANKS
     C/COPY WNCPYSRC,LEH00754
     C           CLE073    ANDNE'Y'                                                           CLE073
     C           SFCALT    ORNE *BLANKS                                                       CLE073
     C           SFEAMT    ANDNE*BLANKS                                                       CLE073
     C           CLE073    ANDEQ'Y'                                                           CLE073
     C           SFCALT    ANDNE'99'                                                          CLE073
     C                     MOVE '1'       *IN49
     C/COPY WNCPYSRC,LEH00755
      *                                                                                       CLE073
     C           SFCALT    IFEQ '97'                                                          CLE073
     C           SFCALT    OREQ '98'                                                          CLE073
     C                     MOVEL'XLE0008' ZAMSID                                              CLE073
      *                                                                                       CLE073
     C                     ELSE                                                               CLE073
     C                     MOVEL'LER0045' ZAMSID
     C/COPY WNCPYSRC,LEH00756
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     EXSR SREROR
     C                     ENDIF
     C/COPY WNCPYSRC,LEH00757
      *                                                                                       CLE073
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'99'                                                          CLE073
     C           SFEAMT    ANDEQ*BLANKS                                                       CLE073
     C                     MOVE '1'       *IN42                                               CLE073
     C                     MOVE '1'       *IN49                                               CLE073
     C                     MOVEL'XLE0007' ZAMSID                                              CLE073
     C                     EXSR SREROR                                                        CLE073
     C                     ENDIF                                                              CLE073
      *
     C                     EXSR SRCATP
      *
     C           SFLCHT    IFEQ 'I'
     C                     MOVE WDIND     FEDIND
     C                     Z-ADDWAMTP     FEAMTP
     C                     Z-ADDWAMTA     FEAMTA
     C                     Z-ADDWAMTS     FEAMTS
     C                     Z-ADDWFAMT     FEAMTO
     C                     Z-ADDWSDAT     FESDAT
     C                     Z-ADDWADAT     FEADAT
     C                     Z-ADDWDDAT     FEDDAT
     C*********************Z-ADDBJRDNB    FEORED                          CSC011
     C                     Z-ADDWRNDAY    FEORED                          CSC011
     C                     Z-ADD0         FELPDT
     C                     Z-ADD0         FELADT
     C                     MOVE 'D'       FERECI
     C                     MOVE WRKBRC    FEBRCA
     C                     ELSE
     C           *IN84     IFEQ '0'
     C           *IN79     ANDEQ'0'
     C           *IN77     ANDEQ'0'
     C                     Z-ADDWFAMT     FEAMTO
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate Profit Center
      ** ======================
      *
      **  Validate Profit Centre if Profit Centre is used and             133870
      **  is amendable, or during insert.                                 133870
      *                                                                   133870
     C***********BGN0ST    IFEQ 'Y'                                       133870
     C************IN71     ANDEQ'1'                                       133870
     C           BKPRCU    IFEQ 'Y'                                       133870
     C           *IN71     IFEQ '1'                                       133870
     C           SFLCHT    OREQ 'I'                                       133870
     C*
      **  If Profit Centre is used then :-                                133870
      **  Validate the input Profit Centre if entered                     133870
      *                                                                   133870
     C           SPRFC     IFNE *BLANKS                                   133870
     C                     CALL 'AOPRFCR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM SPRFC     PPRFC   4
     C           SDPRFC    PARM SDPRFC    DSFDY
     C           PRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN73
     C***********          MOVEL'LER0151' ZAMSID                          133870
     C                     MOVEL'LER0146' ZAMSID                          133870
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE DSPCCD    SPRFC
     C                     ENDIF
      *                                                                   133870
      **  Else /* Profit Centre is used but not entered */ :-             133870
      **  Extract the default Profit Centre if input Profit Centre is     133870
      **  blank and Profit Centre used flag is on and default flag is     133870
      **  also on.                                                        133870
     C                     ELSE                                           133870
     C                     MOVE *BLANKS   RTCDPR                          179732
     C           FEACOF    IFNE *BLANKS                                   179732
     C                     MOVE FEACOF    ACOFDM  2                       179732
     C                     ELSE                                           179732
     C                     MOVE ACOF      ACOFDM                          179732
     C                     ENDIF                                          179732
     C                     MOVE WCNUM     CNUMDM  6                       179732
      *                                                                   179732
     C           BKPCDU    IFEQ 'Y'                                       133870
     C                     CALL 'AOPRFMR0'                                133870
     C                     PARM *BLANKS   RTCDPR  1                       133870
     C******************** PARM *BLANKS   BOOKPR  2                133870 179732
     C******************** PARM *BLANKS   TRTPPR  5                133870 179732
     C******************** PARM *BLANKS   SUTPPR  2                133870 179732
     C                     PARM BOKC      BOOKPR  2                       179732
     C                     PARM LTYP      TRTPPR  5                       179732
     C                     PARM SUTP      SUTPPR  2                       179732
     C                     PARM BRCA      BRANPR  3                       133870
     C                     PARM *BLANKS   DEPTPR  3                       133870
     C                     PARM USER      USERPR 10                       133870
     C******************** PARM ACOF      ACOFPR  2                133870 179732
     C******************** PARM SFCNUM    CNUMPR  6                133870 179732
     C                     PARM ACOFDM    ACOFPR  2                       179732
     C                     PARM CNUMDM    CNUMPR  6                       179732
     C                     PARM *BLANKS   PRFCPR  4                       133870
     C                     MOVE PRFCPR    SPRFC                           133870
     C           RTCDPR    IFEQ '2'                                       133870
     C                     MOVEL'LER0146' ZAMSID                          133870
     C                     MOVE '1'       *IN73                           133870
     C                     EXSR SREROR                                    133870
     C                     ENDIF                                          133870
     C                     ENDIF                                          133870
      *                                                                   133870
     C                     ENDIF                                          133870
     C                     ENDIF                                          133870
     C*
     C                     ENDIF
      *                                                                                       CLE034
      ** Validate Settlement Allocation                                                       CLE034
      ** ==============================                                                       CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
      *                                                                                       CLE034
     C           SFSTAL    IFEQ *BLANKS                                                       CLE034
     C                     MOVEL'N'       SFSTAL                                              CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C           SFSTAL    IFNE 'Y'                                                           CLE034
     C           SFSTAL    ANDNE'N'                                                           CLE034
     C                     MOVE *ON       *IN76                                               CLE034
     C                     MOVEL'LER1184' ZAMSID                                              CLE034
     C                     EXSR SREROR                                                        CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
     C                     MOVE SFLCHT    FELCHT
     C*********************Z-ADDBJRDNB    FELCHD                          CSC011
     C                     Z-ADDWRNDAY    FELCHD                          CSC011
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRCATP  -  Validate Calculation Type                          *
      * Called by: SRVALF                                             *
      * Calls    : SREROR - Error Processing                          *
      *            RATE   -  Validate Rates entered                   *
      *            AMNT   -  Validate Amounts entered                 *
      *****************************************************************
     C           SRCATP    BEGSR
      *
      ** If calculation type entered
      *
     C           SFCALT    IFNE *BLANKS
      *
      ** Protect if fee already started
      *
     C           *IN77     IFEQ '0'
      *
      ** must be a valid type
      *
     C                     Z-ADD1         X       20
     C           SFCALT    LOKUPWCTP,X                   78
     C/COPY WNCPYSRC,LEH00758
     C           *IN78     IFEQ *OFF                                                          CLE073
     C           CLE073    ANDEQ'Y'                                                           CLE073
     C           SFLNRF    ANDNE*BLANKS                                                       CLE073
     C           SFCALT    LOKUPECTP,X                   78                                   CLE073
     C                     ENDIF                                                              CLE073
     C           *IN78     IFNE '1'
     C                     MOVE '1'       *IN49
     C                     MOVEL'LER0046' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C           SFEPED    IFEQ *BLANKS
     C                     MOVE '1'       *IN45
     C                     MOVEL'LER0026' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** First rate is mandatory
      ** If CLE073 is ON, it is only mandatory for calculation types '97' and '98'.           CLE073
      ** If CLE073 is ON, first rate must be blank for calculation type '99'.                 CLE073
      *
     C           SFRTE1    IFEQ *BLANKS
     C/COPY WNCPYSRC,LEH00759
     C           CLE073    ANDNE'Y'                                                           CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           SFRTE1    ANDEQ*BLANKS                                                       CLE073
     C           SFCALT    ANDEQ'97'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           SFRTE1    ANDEQ*BLANKS                                                       CLE073
     C           SFCALT    ANDEQ'98'                                                          CLE073
     C                     MOVE '1'       *IN50
     C                     MOVEL'LER0048' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C/COPY WNCPYSRC,LEH00760
     C           SFRTE1    IFNE *BLANKS                                                       CLE073
     C           CLE073    ANDEQ'Y'                                                           CLE073
     C           SFCALT    ANDEQ'99'                                                          CLE073
     C                     MOVE '1'       *IN50                                               CLE073
     C                     MOVEL'XLE0004' ZAMSID                                              CLE073
     C                     EXSR SREROR                                                        CLE073
     C                     ENDIF                                                              CLE073
      ** Check the rates input
      *
     C                     EXSR RATE
      *
      ** Check the amounts input
      *
     C                     EXSR AMNT
      *
      ** Check the correct calculation basis
      *
     C           SFCALC    IFNE *BLANKS
     C                     MOVE SFCALC    WCALC
      *
      ** Protect if fee already started
      *
     C           *IN77     IFEQ '0'
     C                     MOVE '0'       TEST1   2
     C                     MOVELSFCALC    TEST1
     C                     TESTN          TEST1      78
      *
     C           *IN78     IFEQ '1'
     C           WCALC     ANDGE1
     C           WCALC     ANDLE6
     C                     ELSE
     C                     MOVE '1'       *IN61
     C                     MOVEL'LER0056' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C           SFEPON    IFEQ 'E'
     C           SFEPON    OREQ 'N'
     C                     ELSE
     C                     MOVE '1'       *IN61
     C                     MOVEL'LER0057' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
     C                     ELSE
      *
      ** Protect if fee already started
      *
     C           *IN77     IFEQ '0'
     C           SFCALT    IFEQ '04'
     C           SFCALT    OREQ '05'
     C           SFCALT    OREQ '06'
     C           SFCALT    OREQ '14'
     C           SFCALT    OREQ '15'
     C           SFCALT    OREQ '16'
     C           SFCALT    OREQ '22'
     C/COPY WNCPYSRC,LEH00761
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'97'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'98'                                                          CLE073
     C                     MOVE '1'       *IN61
     C                     MOVEL'LER0098' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANK    PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM FCCY      K101    3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C                     MOVE A6DICB    WCALC
      *
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Check the exchange rate
      *
     C           SFEXRT    IFNE *BLANKS
      *
      ** Is rate a valid entry
      *
     C           *IN77     IFEQ '0'
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SFEXRT    ZFIELD
     C                     Z-ADD5         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN62
     C                     MOVEL'LER0058' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE ZFIELD    WA13
     C           WA13      DIV  100000000 WERAT
     C                     ENDIF
      *
      ** Is fee ccy diff. to fac. ccy
      *
     C           WCCY      IFEQ FCCY
     C                     MOVE '1'       *IN62
     C                     MOVEL'LER0059' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
      ** If exchange rate field (alpha) on screen is blank, put zero
      ** in numberic version of field in program.
      *
     C                     ELSE
     C                     Z-ADD0         WERAT
      **********                                                                       152169 200452
      ***Default*cross*rate*and*multi/div*indicator********************                152169 200452
      **********                                                                       152169 200452
     C********** *IN41     IFEQ '0'                                                    152169 200452
     C********** *IN77     ANDEQ'0'                                                    152169 200452
     C********** WCCY      ANDNEFCCY                                                   152169 200452
     C**********           CALL 'AOCURRR0'                                             152169 200452
     C**********           PARM *BLANK    PRTCD                                        152169 200452
     C**********           PARM '*KEY   ' POPTN                                        152169 200452
     C**********           PARM FCCY      PCURR   3                                    152169 200452
     C********** SDCURR    PARM SDCURR    DSSDY                                        152169 200452
      **********                                                                       152169 200452
     C***********          MOVE A6MDIN    ZMDI2   1                 152169CLE009
     C***********          Z-ADDA6SPRT    ZRATE2 138                152169CLE009
     C**********           MOVE A6MDIN    ZMDI1   1                                    CLE009 200452
     C**********           Z-ADDA6SPRT    ZRATE1 138                                   CLE009 200452
     C**********           EXSR ZXRATE                                                 152169 200452
     C**********           Z-ADDZRATEX    WERAT                                        152169 200452
     C**********           ENDIF                                                       152169 200452
      *
     C                     ENDIF
      *
      ** Mult/Div ind
      *
     C           SFEXRT    IFEQ *BLANKS
     C           SFMDIN    ANDNE*BLANKS
     C                     MOVE '1'       *IN63
     C                     MOVEL'LER0111' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C           SFMDIN    IFNE *BLANKS
     C           SFMDIN    IFEQ 'D'
     C           SFMDIN    OREQ 'M'
     C                     ELSE
     C                     MOVE '1'       *IN63
     C                     MOVEL'LER0111' ZAMSID
     C                     EXSR SREROR
     C                     END
     C                     END
     C                     MOVE SFMDIN    WMDIN
      **********                                                                       152169 200452
     C********** SFEXRT    IFEQ *BLANKS                                                152169 200452
     C********** SFMDIN    ANDEQ*BLANKS                                                152169 200452
     C********** WCCY      ANDNEFCCY                                                   152169 200452
     C**********           MOVE ZMDIX     WMDIN                                        152169 200452
     C**********           ENDIF                                                       152169 200452
      *                                                                                       CLE031
      ** Validate Next Payment Date, Frequency and Day in Month                               CLE031
      *                                                                                       CLE031
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           WFAC05    ANDEQ0                                                             CAS009
     C**********           EXSR SRNXTP                                                 CAS009 CAS011
     C                     EXSR SRNXT2                                                        CAS011
      *                                                                                       CAS009
     C                     ELSE                                                               CAS009
      *                                                                                       CAS009
     C                     EXSR SRNXTP                                                        CLE031
      **********                                                                              CLE031
      ***Next*Payment Date                                                                    CLE031
      **********                                                                              CLE031
      ***If*date not entered and payment on *EQ to N                                          CLE031
      **********                                                                              CLE031
     C********** SFEPON    IFEQ 'N'                                                           CLE031
     C********** SFNPYD    ANDEQ*BLANKS                                                       CLE031
     C**********           MOVE '1'       *IN64                                               CLE031
     C**********           MOVEL'LER0060' ZAMSID                                              CLE031
     C**********           EXSR SREROR                                                        CLE031
     C**********           ENDIF                                                              CLE031
      **********                                                                              CLE031
     C********** SFNPYD    IFNE *BLANKS                                                       CLE031
     C**********           MOVE '0'       TEST6                                               CLE031
     C**********           MOVELSFNPYD    TEST6                                               CLE031
     C**********           TESTN          TEST6      78                                       CLE031
      **********                                                                              CLE031
      ***Check*for valid date if numeric                                                      CLE031
      **********                                                                              CLE031
     C********** *IN78     IFEQ '1'                                                           CLE031
     C**********           MOVE '0'       *IN99                                               CLE031
     C**********           MOVE SFNPYD    ZDATE                                               CLE031
     C**********           EXSR ZDATE1                                                        CLE031
      **********                                                                              CLE031
      ***Error*in date conversion                                                             CLE031
      **********                                                                              CLE031
     C********** *IN99     IFEQ '1'                                                           CLE031
     C**********           MOVE '1'       GRTCD                                               CLE031
     C**********           ENDIF                                                              CLE031
      **********                                                                              CLE031
     C**********           ELSE                                                               CLE031
     C**********           MOVE '1'       GRTCD                                               CLE031
     C**********           ENDIF                                                              CLE031
      **********                                                                              CLE031
      ***Error*if grtcd = 1                                                                   CLE031
      **********                                                                              CLE031
     C********** GRTCD     IFEQ '1'                                                           CLE031
     C********** *IN99     OREQ '1'                                                           CLE031
     C**********           MOVE '1'       *IN64                                               CLE031
     C**********           MOVEL'LER0061' ZAMSID                                              CLE031
     C**********           EXSR SREROR                                                        CLE031
     C**********           ELSE                                                               CLE031
     C**********           Z-ADDZDAYNO    WNPYD                                               CLE031
      **********                                                                              CLE031
      ***If*date entered and *LT last payment date then error                                 CLE031
      **********                                                                              CLE031
     C********** SFLCHT    IFEQ 'A'                                                           CLE031
     C********** WNPYD     ANDLTFELPDT                                                        CLE031
     C**********           MOVE '1'       *IN64                                               CLE031
     C**********           MOVEL'LER0062' ZAMSID                                              CLE031
     C**********           EXSR SREROR                                                        CLE031
     C**********           ENDIF                                                              CLE031
      **********                                                                              CLE031
      ***If*date entered and payment on *NE to N                                              CLE031
      **********                                                                              CLE031
     C********** SFEPON    IFNE 'N'                                                           CLE031
     C**********           MOVE '1'       *IN64                                               CLE031
     C**********           MOVEL'LER0060' ZAMSID                                              CLE031
     C**********           EXSR SREROR                                                        CLE031
     C**********           ENDIF                                                              CLE031
      **********                                                                              CLE031
     C***********WPSTD     IFGT WNPYD                                                  155685 CLE031
     C********** WPSTD     IFGE WNPYD                                                  155685 CLE031
     C**********           MOVE '1'       *IN64                                               CLE031
     C**********           MOVEL'LER0061' ZAMSID                                              CLE031
     C**********           EXSR SREROR                                                        CLE031
     C**********           ENDIF                                                              CLE031
      **********                                                                              CLE031
     C********** WPEND     IFLT WNPYD                                                         CLE031
     C**********           MOVE '1'       *IN64                                               CLE031
     C**********           MOVEL'LER0099' ZAMSID                                              CLE031
     C**********           EXSR SREROR                                                        CLE031
     C**********           ENDIF                                                              CLE031
     C**********           ENDIF                                                              CLE031
     C/COPY WNCPYSRC,LEH00762
      **********                                                                              CLE031
     C**********           ELSE                                                               CLE031
     C**********           Z-ADD0         WNPYD                                               CLE031
     C**********           ENDIF                                                              CLE031
      **********                                                                              CLE031
      **Frequency of Payment                                                                  CLE031
      **********                                                                              CLE031
     C**********           MOVE *BLANKS   WFREQ                                               CLE031
     C********** SFFREQ    IFNE *BLANKS                                                       CLE031
      **********                                                                              CLE031
     C********** SFFREQ    IFEQ 'M'                                                           CLE031
     C********** SFFREQ    OREQ 'Q'                                                           CLE031
     C********** SFFREQ    OREQ 'X'                                                           CLE031
     C********** SFFREQ    OREQ 'Y'                                                           CLE031
     C**********           MOVE SFFREQ    WFREQ                                               CLE031
     C**********           ELSE                                                               CLE031
     C**********           MOVE '1'       *IN65                                               CLE031
     C**********           MOVEL'LER0064' ZAMSID                                              CLE031
     C**********           EXSR SREROR                                                        CLE031
     C**********           ENDIF                                                              CLE031
      **********                                                                              CLE031
      ***If*next payment date is not entered then freq. cannot be                             CLE031
      ***entered                                                                              CLE031
      **********                                                                              CLE031
     C********** WNPYD     IFEQ 0                                                             CLE031
     C********** GRTCD     ANDNE'1'                                                           CLE031
     C**********           MOVE '1'       *IN65                                               CLE031
     C**********           MOVEL'LER0100' ZAMSID                                              CLE031
     C**********           EXSR SREROR                                                        CLE031
     C**********           ENDIF                                                              CLE031
     C**********           ENDIF                                                              CLE031
      **********                                                                              CLE031
      ***If*next payment date is entered then freq. must be entered                           CLE031
      **********                                                                              CLE031
     C********** SFFREQ    IFEQ *BLANK                                                        CLE031
     C********** GRTCD     ANDNE'1'                                                           CLE031
      **********                                                                              CLE031
     C********** WNPYD     IFEQ WPEND                                                         CLE031
     C********** WNPYD     OREQ 0                                                             CLE031
     C********** WNPYD     ORGT 0                                                             CLE031
     C********** SFEPON    ANDEQ'N'                                                           CLE031
     C********** WPEND     ANDGT0                                                             CLE031
     C**********           ELSE                                                               CLE031
     C**********           MOVE '1'       *IN65                                               CLE031
     C**********           MOVEL'LER0141' ZAMSID                                              CLE031
     C**********           EXSR SREROR                                                        CLE031
     C**********           ENDIF                                                              CLE031
      **********                                                                              CLE031
     C**********           ENDIF                                                              CLE031
      **********                                                                              CLE031
      ***Day*in*month                                                                         CLE031
      **********                                                                              CLE031
     C**********           Z-ADD0         WDYIM                                               CLE031
     C********** SFDYIM    IFNE *BLANKS                                                       CLE031
      **********                                                                              CLE031
      ***Frequency must be entered                                                            CLE031
      **********                                                                              CLE031
     C********** SFFREQ    IFEQ *BLANKS                                                       CLE031
     C**********           MOVE '1'       *IN65                                               CLE031
     C**********           MOVE '1'       *IN66                                               CLE031
     C**********           MOVEL'LER0065' ZAMSID                                              CLE031
     C**********           EXSR SREROR                                                        CLE031
     C**********           ENDIF                                                              CLE031
      **********                                                                              CLE031
      ***Must*be between 1 & 31                                                               CLE031
      **********                                                                              CLE031
     C**********           MOVE '0'       TEST2                                               CLE031
     C**********           MOVELSFDYIM    TEST2                                               CLE031
     C**********           TESTN          TEST2      78                                       CLE031
     C**********           MOVE SFDYIM    WDYIM                                               CLE031
     C********** *IN78     IFEQ '1'                                                           CLE031
     C********** WDYIM     ANDGT0                                                             CLE031
     C********** WDYIM     ANDLT32                                                            CLE031
     C**********           ELSE                                                               CLE031
     C**********           MOVE '1'       *IN66                                               CLE031
     C**********           MOVEL'LER0066' ZAMSID                                              CLE031
     C**********           EXSR SREROR                                                        CLE031
     C**********           ENDIF                                                              CLE031
     C**********           ENDIF                                                              CLE031
      **********                                                                              CLE031
      ***If*day*in month not entered then default to day of                                   CLE031
      ***next*payment                                                                         CLE031
      **********                                                                              CLE031
     C********** SFDYIM    IFEQ *BLANK                                                        CLE031
     C********** GRTCD     ANDNE'1'                                                           CLE031
     C********** WNPYD     ANDNE0                                                             CLE031
     C********** SFFREQ    ANDNE*BLANKS                                                       CLE031
     C********** *IN98     IFEQ '0'                                                           CLE031
     C**********           MOVELSFNPYD    WDYIM                                               CLE031
     C**********           ELSE                                                               CLE031
     C**********           MOVELSFNPYD    WRKRP   40                                          CLE031
     C**********           MOVE WRKRP     WDYIM                                               CLE031
     C**********           ENDIF                                                              CLE031
     C**********           ENDIF                                                              CLE031
      **********                                                                              CLE031
      ****Ensure next Next Payment Date is not after End Date                                 CLE031
      **********                                                                              CLE031
     C********** WDYIM     IFGT 0                                                             CLE031
     C********** WNPYD     ANDNE*ZEROS                                                        CLE031
     C********** WPEND     ANDNE*ZEROS                                                        CLE031
     C********** WFREQ     ANDNE*BLANKS                                                       CLE031
     C********** WCCY      ANDNE*BLANKS                                                       CLE031
     C**********           MOVE '0'       *IN99                                               CLE031
     C**********           MOVE WNPYD     ZDAYNO                                              CLE031
     C**********           MOVE WFREQ     ZFREQ                                               CLE031
     C**********           MOVE WDYIM     ZMDAY                                               CLE031
     C**********           MOVE WCCY      ZCCY                                                CLE031
     C**********           MOVE *BLANKS   ZLOC                                                CLE031
     C**********           EXSR ZFREQB                                                        CLE031
     C********** ZZERR@    IFEQ '*ERROR '                                                     CLE031
     C********** ZDAYNO    ORGT WPEND                                                         CLE031
     C**********           MOVE '1'       *IN65                                               CLE031
     C**********           MOVE '1'       *IN66                                               CLE031
     C**********           MOVEL'LER0142' ZAMSID                                              CLE031
     C**********           EXSR SREROR                                                        CLE031
     C**********           ENDIF                                                              CLE031
     C**********           ENDIF                                                              CLE031
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       205734
      ** If next payment date is amended for calculated fees,                                 205734
      ** do not allow date to equal run date if there is a                                    205734
      ** fee adjustment.                                                                      205734
      *                                                                                       205734
     C           SFLCHT    IFEQ 'A'                                                           205734
     C           FECALT    ANDNE*BLANKS                                                       205734
     C           WNPYD     ANDNEFENPYD                                                        205734
      *                                                                                       205734
     C           FEADKY    SETLLLEFEEADF                                                      205734
     C           FEADKY    READELEFEEADF                 74                                   205437
     C           FARECI    DOWEQ'*'                                                           205734
     C           *IN74     ANDEQ'0'                                                           205734
     C           FATYPE    ORNE *BLANK                                                        205734
     C           *IN74     ANDEQ'0'                                                           205734
     C           FEADKY    READELEFEEADF                 74                                   205734
     C                     ENDDO                                                              205734
      *                                                                                       205734
     C           *IN74     IFEQ '0'                                                           205734
     C           WNPYD     ANDEQBJRDNB                                                        205734
     C                     MOVE '1'       *IN64                                               205734
     C                     MOVEL'LER1183' ZAMSID                                              205734
     C                     EXSR SREROR                                                        205734
     C                     ENDIF                                                              205734
     C                     ENDIF                                                              205734
      *
      ** Percent indicator
      *
     C           SFPIND    IFEQ ' '
     C           SFPIND    OREQ 'A'
     C           SFPIND    OREQ 'P'
     C                     MOVE SFPIND    WPIND
     C/COPY WNCPYSRC,LEH00763
      *                                                                                       CLE073
      ** SFPIND must be 'P' for types '97' or '98' and 'A' for '99'.                          CLE073
      *                                                                                       CLE073
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'97'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'98'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'99'                                                          CLE073
      *                                                                                       CLE073
     C           SFCALT    IFEQ '97'                                                          CLE073
     C           SFPIND    ANDNE'P'                                                           CLE073
     C           SFCALT    OREQ '98'                                                          CLE073
     C           SFPIND    ANDNE'P'                                                           CLE073
     C           SFCALT    OREQ '99'                                                          CLE073
     C           SFPIND    ANDNE'A'                                                           CLE073
     C                     MOVE '1'       *IN60                                               CLE073
     C                     MOVEL'XLE0009' ZAMSID                                              CLE073
     C                     EXSR SREROR                                                        CLE073
     C                     ENDIF                                                              CLE073
     C                     ELSE                                                               CLE073
      *
      ** Check % ind against calc type
      *
     C           SFPIND    IFEQ ' '
     C           SFCALT    IFEQ '03'
     C           SFCALT    OREQ '06'
     C           SFCALT    OREQ '13'
     C           SFCALT    OREQ '16'
     C           SFCALT    OREQ '21'
     C           SFCALT    OREQ '22'
     C                     MOVE 'A'       WPIND
     C                     ELSE
     C                     MOVE '1'       *IN60
     C                     MOVEL'LER0067' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
     C           SFPIND    IFEQ 'A'
     C           SFPIND    OREQ 'P'
     C           SFCALT    IFEQ '01'
     C           SFCALT    OREQ '02'
     C           SFCALT    OREQ '04'
     C           SFCALT    OREQ '05'
     C           SFCALT    OREQ '11'
     C           SFCALT    OREQ '12'
     C           SFCALT    OREQ '14'
     C           SFCALT    OREQ '15'
     C                     ELSE
     C                     MOVE '1'       *IN60
     C                     MOVEL'LER0053' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LEH00764
     C                     ENDIF                                                              CLE073
      *
     C                     ELSE
     C                     MOVE '1'       *IN60
     C                     MOVEL'LER0067' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C                     ELSE
      *                                                                                       CLE031
      ** Validate calculation type details                                                    CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
      *                                                                                       CAS009
      ** Calculation type is blank, all other fields must be blank                            CAS009
      ** except for the Next Payment fields when Payment On indcator                          CAS009
      ** is 'N'                                                                               CAS009
      *                                                                                       CAS009
     C           CAS009    OREQ 'Y'                                                           CAS009
     C           WFAC05    ANDEQ0                                                             CAS009
     C           WCALTP    IFNE *BLANK                                                        CLE031
     C                     MOVE '1'       *IN49                                               CLE031
     C                     MOVEL'LER0047' ZAMSID                                              CLE031
     C                     EXSR SREROR                                                        CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
      ** Initialise fields                                                                    CLE031
      *                                                                                       CLE031
     C                     Z-ADD0         WFRT1                                               CLE031
     C                     Z-ADD0         WFRT2                                               CLE031
     C                     Z-ADD0         WFRT3                                               CLE031
     C                     Z-ADD0         WFRT4                                               CLE031
     C                     Z-ADD0         WFRT5                                               CLE031
     C                     Z-ADD0         WCAMT1                                              CLE031
     C                     Z-ADD0         WCAMT2                                              CLE031
     C                     Z-ADD0         WCAMT3                                              CLE031
     C                     Z-ADD0         WCAMT4                                              CLE031
     C                     Z-ADD0         WCAMT5                                              CLE031
     C                     Z-ADD0         WCALC                                               CLE031
     C                     Z-ADD0         WERAT                                               CLE031
     C                     MOVE *BLANKS   WMDIN                                               CLE031
     C                     MOVE *BLANK    WPIND                                               CLE031
     C                     MOVE *BLANKS   WDIND                                               CLE031
     C                     Z-ADD0         WAMTP                                               CLE031
     C                     Z-ADD0         WAMTA                                               CLE031
     C                     Z-ADD0         WAMTS                                               CLE031
     C                     Z-ADD0         WSDAT                                               CLE031
     C                     Z-ADD0         WADAT                                               CLE031
     C                     Z-ADD0         WDDAT                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Next payment details not allowed when payment on is 'N' for                          CLE031
      ** non-calculated fees                                                                  CLE031
      *                                                                                       CLE031
     C           WNXTPY    IFNE *BLANK                                                        CLE031
     C           SFEPON    ANDNE'N'                                                           CLE031
     C           CLE031    ANDEQ'Y'                                                           CAS009
     C           SFNPYD    IFNE *BLANK                                                        CLE031
     C                     MOVE *ON       *IN64                                               CLE031
     C                     ENDIF                                                              CLE031
     C           SFFREQ    IFNE *BLANK                                                        CLE031
     C                     MOVE *ON       *IN65                                               CLE031
     C                     ENDIF                                                              CLE031
     C           SFDYIM    IFNE *BLANK                                                        CLE031
     C                     MOVE *ON       *IN66                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVEL'LER0500' ZAMSID                                              CLE031
     C                     EXSR SREROR                                                        CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
      ** End date is mandatory when payment on is 'N'                                         CLE031
      *                                                                                       CLE031
     C           SFEPED    IFEQ *BLANKS                                                       CLE031
     C           SFEPON    ANDEQ'N'                                                           CLE031
     C                     MOVE '1'       *IN45                                               CLE031
     C                     MOVEL'LER0501' ZAMSID                                              CLE031
     C                     EXSR SREROR                                                        CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Validate next payment details                                                        CLE031
      *                                                                                       CLE031
     C                     EXSR SRNXTP                                                        CLE031
     C                     ENDIF                                                              CLE031
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C**********           EXSR SRNXTP                                                 CAS009 CAS011
     C                     EXSR SRNXT2                                                        CAS011
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CLE031
      *
      ** Calculation type is blank then all other fields must be blank
      *
     C           CLE031    IFEQ 'N'                                                           CLE031
     C           CAS009    ORNE 'Y'                                                           CAS009
     C           CAS009    OREQ 'Y'                                                           CAS009
     C           WFAC05    ANDNE0                                                             CAS009
     C           SFRTE1    IFEQ *BLANKS
     C           SFRTE2    ANDEQ*BLANKS
     C           SFRTE3    ANDEQ*BLANKS
     C           SFRTE4    ANDEQ*BLANKS
     C           SFRTE5    ANDEQ*BLANKS
     C           SFAMT1    ANDEQ*BLANKS
     C           SFAMT2    ANDEQ*BLANKS
     C           SFAMT3    ANDEQ*BLANKS
     C           SFAMT4    ANDEQ*BLANKS
     C           SFAMT5    ANDEQ*BLANKS
     C           SFCALC    ANDEQ*BLANKS
     C           SFEXRT    ANDEQ*BLANKS
     C           SFNPYD    ANDEQ*BLANKS
     C           SFFREQ    ANDEQ*BLANKS
     C           SFDYIM    ANDEQ*BLANKS
     C           SFPIND    ANDEQ*BLANKS
     C           SFMDIN    ANDEQ*BLANKS
     C                     Z-ADD0         WFRT1   75
     C                     Z-ADD0         WFRT2   75
     C                     Z-ADD0         WFRT3   75
     C                     Z-ADD0         WFRT4   75
     C                     Z-ADD0         WFRT5   75
     C                     Z-ADD0         WCAMT1 110
     C                     Z-ADD0         WCAMT2 110
     C                     Z-ADD0         WCAMT3 110
     C                     Z-ADD0         WCAMT4 110
     C                     Z-ADD0         WCAMT5 110
     C                     Z-ADD0         WCALC   10
     C                     Z-ADD0         WERAT  138
     C                     MOVE *BLANKS   WMDIN   1
     C                     Z-ADD0         WNPYD   50
     C                     MOVE *BLANKS   WFREQ   1
     C                     Z-ADD0         WDYIM   20
     C                     MOVE *BLANK    WPIND   1
     C                     MOVE *BLANKS   WDIND   1
     C                     Z-ADD0         WAMTP  130
     C                     Z-ADD0         WAMTA  130
     C                     Z-ADD0         WAMTS  130
     C                     Z-ADD0         WSDAT   50
     C                     Z-ADD0         WADAT   50
     C                     Z-ADD0         WDDAT   50
      *
     C                     ELSE
      *
      ** Then it must be an error
      *
     C                     MOVE '1'       *IN49
     C                     MOVEL'LER0047' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF                                                              CLE031
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT                                                                                  CLE031
      *****************************************************************                       CLE031
      *                                                               *                       CLE031
      *  SRNXTP - Validate Next Payment Details                       *                       CLE031
      *                                                               *                       CLE031
      *****************************************************************                       CLE031
     C           SRNXTP    BEGSR                                                              CLE031
      *                                                                                       CLE031
      ** Next Payment Date                                                                    CLE031
      *                                                                                       CLE031
      ** If date not entered and payment on *EQ to N                                          CLE031
      *                                                                                       CLE031
     C           SFEPON    IFEQ 'N'                                                           CLE031
     C           SFNPYD    ANDEQ*BLANKS                                                       CLE031
     C                     MOVE '1'       *IN64                                               CLE031
     C                     MOVEL'LER0060' ZAMSID                                              CLE031
     C                     EXSR SREROR                                                        CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           SFNPYD    IFNE *BLANKS                                                       CLE031
     C                     MOVE '0'       TEST6                                               CLE031
     C                     MOVELSFNPYD    TEST6                                               CLE031
     C                     TESTN          TEST6      78                                       CLE031
      *                                                                                       CLE031
      ** Check for valid date if numeric                                                      CLE031
      *                                                                                       CLE031
     C           *IN78     IFEQ '1'                                                           CLE031
     C                     MOVE '0'       *IN99                                               CLE031
     C                     MOVE SFNPYD    ZDATE                                               CLE031
     C                     EXSR ZDATE1                                                        CLE031
      *                                                                                       CLE031
      ** Error in date conversion                                                             CLE031
      *                                                                                       CLE031
     C           *IN99     IFEQ '1'                                                           CLE031
     C                     MOVE '1'       GRTCD                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE '1'       GRTCD                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Error if grtcd = 1                                                                   CLE031
      *                                                                                       CLE031
     C           GRTCD     IFEQ '1'                                                           CLE031
     C           *IN99     OREQ '1'                                                           CLE031
     C                     MOVE '1'       *IN64                                               CLE031
     C                     MOVEL'LER0061' ZAMSID                                              CLE031
     C                     EXSR SREROR                                                        CLE031
     C                     ELSE                                                               CLE031
     C                     Z-ADDZDAYNO    WNPYD                                               CLE031
      *                                                                                       CLE031
      ** If date entered and *LT last payment date then error                                 CLE031
      *                                                                                       CLE031
     C           SFLCHT    IFEQ 'A'                                                           CLE031
     C           WNPYD     ANDLTFELPDT                                                        CLE031
     C                     MOVE '1'       *IN64                                               CLE031
     C                     MOVEL'LER0062' ZAMSID                                              CLE031
     C                     EXSR SREROR                                                        CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** If date entered and payment on *NE to N                                              CLE031
      *                                                                                       CLE031
     C           SFEPON    IFNE 'N'                                                           CLE031
     C                     MOVE '1'       *IN64                                               CLE031
     C                     MOVEL'LER0060' ZAMSID                                              CLE031
     C                     EXSR SREROR                                                        CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           WPSTD     IFGE WNPYD                                                         CLE031
     C                     MOVE '1'       *IN64                                               CLE031
     C                     MOVEL'LER0061' ZAMSID                                              CLE031
     C                     EXSR SREROR                                                        CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           WPEND     IFLT WNPYD                                                         CLE031
     C                     MOVE '1'       *IN64                                               CLE031
     C                     MOVEL'LER0099' ZAMSID                                              CLE031
     C                     EXSR SREROR                                                        CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE073
      ** Validate Next Payment Date is within loan period                                     CLE073
      *                                                                                       CLE073
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'97'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'98'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'99'                                                          CLE073
     C           WNPYD     IFLT VDAT                                                          CLE073
     C           WNPYD     ORGT MDAT                                                          CLE073
     C           MDAT      ANDNE0                                                             CLE073
     C                     MOVE '1'       *IN64                                               CLE073
     C                     MOVEL'XLE0003' ZAMSID                                              CLE073
     C                     EXSR SREROR                                                        CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Do not allow amendment if Payment is due today                                       CLE073
      *                                                                                       CLE073
     C           SFLCHT    IFEQ 'A'                                                           CLE073
     C           WNPYD     ANDNEFENPYD                                                        CLE073
     C           BJRDNB    ANDEQFELPDT                                                        CLE073
     C                     MOVE '1'       *IN64                                               CLE073
     C                     MOVEL'XLE0011' ZAMSID                                              CLE073
     C                     EXSR SREROR                                                        CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
     C                     Z-ADD0         WNPYD                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      * Frequency of Payment                                                                  CLE031
      *                                                                                       CLE031
     C                     MOVE *BLANKS   WFREQ                                               CLE031
     C           SFFREQ    IFNE *BLANKS                                                       CLE031
      *                                                                                       CLE031
     C           SFFREQ    IFEQ 'M'                                                           CLE031
     C           SFFREQ    OREQ 'Q'                                                           CLE031
     C           SFFREQ    OREQ 'X'                                                           CLE031
     C           SFFREQ    OREQ 'Y'                                                           CLE031
     C           SFFREQ    OREQ 'D'                                                           CLE064
     C           SFFREQ    OREQ 'W'                                                           CLE064
     C           SFFREQ    OREQ 'F'                                                           CLE064
     C           SFFREQ    OREQ 'T'                                                           CLE064
     C           SFFREQ    OREQ '4'                                                           CLE064
     C           SFFREQ    OREQ '5'                                                           CLE064
     C           SFFREQ    OREQ '7'                                                           CLE064
     C           SFFREQ    OREQ '8'                                                           CLE064
     C           SFFREQ    OREQ '9'                                                           CLE064
     C           SFFREQ    OREQ 'V'                                                           CLE064
     C           SFFREQ    OREQ 'E'                                                           CLE064
     C           SFFREQ    OREQ 'C'                                                           CLE064
     C           SFFREQ    OREQ 'I'                                                           CLE064
     C           SFFREQ    OREQ 'J'                                                           CLE064
     C           SFFREQ    OREQ 'N'                                                           CLE064
     C           SFFREQ    OREQ 'U'                                                           CLE064
     C                     MOVE SFFREQ    WFREQ                                               CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE '1'       *IN65                                               CLE031
     C**********           MOVEL'LER0064' ZAMSID                                       CLE031 CLE064
     C                     MOVEL'LER5611' ZAMSID                                              CLE064
     C                     EXSR SREROR                                                        CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** If next payment date is not entered then freq. cannot be                             CLE031
      ** entered                                                                              CLE031
      *                                                                                       CLE031
     C           WNPYD     IFEQ 0                                                             CLE031
     C           GRTCD     ANDNE'1'                                                           CLE031
     C                     MOVE '1'       *IN65                                               CLE031
     C                     MOVEL'LER0100' ZAMSID                                              CLE031
     C                     EXSR SREROR                                                        CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** If next payment date is entered then freq. must be entered                           CLE031
      *                                                                                       CLE031
     C           SFFREQ    IFEQ *BLANK                                                        CLE031
     C           GRTCD     ANDNE'1'                                                           CLE031
      *                                                                                       CLE031
     C           WNPYD     IFEQ WPEND                                                         CLE031
     C           WNPYD     OREQ 0                                                             CLE031
     C           WNPYD     ORGT 0                                                             CLE031
     C           SFEPON    ANDEQ'N'                                                           CLE031
     C           WPEND     ANDGT0                                                             CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE '1'       *IN65                                               CLE031
     C                     MOVEL'LER0141' ZAMSID                                              CLE031
     C                     EXSR SREROR                                                        CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Day in month                                                                         CLE031
      *                                                                                       CLE031
     C                     Z-ADD0         WDYIM                                               CLE031
     C           SFDYIM    IFNE *BLANKS                                                       CLE031
      *                                                                                       CLE031
      ** Frequency must be entered                                                            CLE031
      *                                                                                       CLE031
     C           SFFREQ    IFEQ *BLANKS                                                       CLE031
     C                     MOVE '1'       *IN65                                               CLE031
     C                     MOVE '1'       *IN66                                               CLE031
     C                     MOVEL'LER0065' ZAMSID                                              CLE031
     C                     EXSR SREROR                                                        CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Must be between 1 & 31                                                               CLE031
      *                                                                                       CLE031
     C                     MOVE '0'       TEST2                                               CLE031
     C                     MOVELSFDYIM    TEST2                                               CLE031
     C                     TESTN          TEST2      78                                       CLE031
     C                     MOVE SFDYIM    WDYIM                                               CLE031
     C           *IN78     IFEQ '1'                                                           CLE031
     C           WDYIM     ANDGT0                                                             CLE031
     C           WDYIM     ANDLT32                                                            CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE '1'       *IN66                                               CLE031
     C                     MOVEL'LER0066' ZAMSID                                              CLE031
     C                     EXSR SREROR                                                        CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** If day in month not entered then default to day of                                   CLE031
      ** next payment                                                                         CLE031
      *                                                                                       CLE031
     C           SFDYIM    IFEQ *BLANK                                                        CLE031
     C           GRTCD     ANDNE'1'                                                           CLE031
     C           WNPYD     ANDNE0                                                             CLE031
     C           SFFREQ    ANDNE*BLANKS                                                       CLE031
     C           *IN98     IFEQ '0'                                                           CLE031
     C                     MOVELSFNPYD    WDYIM                                               CLE031
     C                     ELSE                                                               CLE031
     C                     MOVELSFNPYD    WRKRP   40                                          CLE031
     C                     MOVE WRKRP     WDYIM                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      **  Ensure next Next Payment Date is not after End Date                                 CLE031
      *                                                                                       CLE031
     C           WDYIM     IFGT 0                                                             CLE031
     C           WNPYD     ANDNE*ZEROS                                                        CLE031
     C           WPEND     ANDNE*ZEROS                                                        CLE031
     C           WFREQ     ANDNE*BLANKS                                                       CLE031
     C           WCCY      ANDNE*BLANKS                                                       CLE031
     C                     MOVE '0'       *IN99                                               CLE031
     C                     MOVE WNPYD     ZDAYNO                                              CLE031
     C                     MOVE WFREQ     ZFREQ                                               CLE031
     C                     MOVE WDYIM     ZMDAY                                               CLE031
     C                     MOVE WCCY      ZCCY                                                CLE031
     C                     MOVE *BLANKS   ZLOC                                                CLE031
     C                     EXSR ZFREQB                                                        CLE031
     C           ZZERR@    IFEQ '*ERROR '                                                     CLE031
     C           ZDAYNO    ORGT WPEND                                                         CLE031
     C                     MOVE '1'       *IN65                                               CLE031
     C                     MOVE '1'       *IN66                                               CLE031
     C                     MOVEL'LER0142' ZAMSID                                              CLE031
     C                     EXSR SREROR                                                        CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      /EJECT
      *****************************************************************
      * RATE    -  Validate Rates entered                             *
      * Called by: SRCATP                                             *
      * Calls    : SREROR - Error Processing                          *
      *****************************************************************
     C           RATE      BEGSR
      *
     C/COPY WNCPYSRC,LEH00765
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'99'                                                          CLE073
     C           SFRTE2    IFNE *BLANKS                                                       CLE073
     C           SFRTE3    ORNE *BLANKS                                                       CLE073
     C           SFRTE4    ORNE *BLANKS                                                       CLE073
     C           SFRTE5    ORNE *BLANKS                                                       CLE073
     C                     MOVE '1'       *IN52                                               CLE073
     C                     MOVE '1'       *IN54                                               CLE073
     C                     MOVE '1'       *IN56                                               CLE073
     C                     MOVE '1'       *IN58                                               CLE073
     C                     MOVEL'XLE0004' ZAMSID                                              CLE073
     C                     EXSR SREROR                                                        CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'97'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'98'                                                          CLE073
     C           SFRTE2    IFNE *BLANKS                                                       CLE073
     C           SFRTE3    ORNE *BLANKS                                                       CLE073
     C           SFRTE4    ORNE *BLANKS                                                       CLE073
     C           SFRTE5    ORNE *BLANKS                                                       CLE073
     C                     MOVE '1'       *IN52                                               CLE073
     C                     MOVE '1'       *IN54                                               CLE073
     C                     MOVE '1'       *IN56                                               CLE073
     C                     MOVE '1'       *IN58                                               CLE073
     C                     MOVEL'LER0049' ZAMSID                                              CLE073
     C                     EXSR SREROR                                                        CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      ** If more than one rate entered then calculation type must NOT equal
      ** 03,06,13,16,21,22.
      *
     C           SFRTE2    IFNE *BLANKS
     C           SFCALT    IFEQ '03'
     C           SFCALT    OREQ '06'
     C           SFCALT    OREQ '13'
     C           SFCALT    OREQ '16'
     C           SFCALT    OREQ '21'
     C           SFCALT    OREQ '22'
     C/COPY WNCPYSRC,LEH00766
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'97'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'98'                                                          CLE073
     C                     MOVE '1'       *IN52
     C                     MOVE '1'       *IN54
     C                     MOVE '1'       *IN56
     C                     MOVE '1'       *IN58
     C                     MOVEL'LER0049' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
      ** A rate is invalid if the previous rate is blank
      *
     C           SFRTE2    IFEQ *BLANKS
     C           SFRTE3    ANDNE*BLANKS
     C           SFRTE2    OREQ *BLANKS
     C           SFRTE4    ANDNE*BLANKS
     C           SFRTE2    OREQ *BLANKS
     C           SFRTE5    ANDNE*BLANKS
     C                     MOVE '1'       *IN52
     C                     MOVE '1'       *IN54
     C                     MOVE '1'       *IN56
     C                     MOVE '1'       *IN58
     C                     MOVEL'LER0050' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C           SFRTE3    IFEQ *BLANKS
     C           SFRTE4    ANDNE*BLANKS
     C           SFRTE3    OREQ *BLANKS
     C           SFRTE5    ANDNE*BLANKS
     C                     MOVE '1'       *IN52
     C                     MOVE '1'       *IN54
     C                     MOVE '1'       *IN56
     C                     MOVE '1'       *IN58
     C                     MOVEL'LER0050' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C           SFRTE4    IFEQ *BLANKS
     C           SFRTE5    ANDNE*BLANKS
     C                     MOVE '1'       *IN52
     C                     MOVE '1'       *IN54
     C                     MOVE '1'       *IN56
     C                     MOVE '1'       *IN58
     C                     MOVEL'LER0050' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
      ** If rates have been entered in the correct sequence check
      ** for valid entry
      *
      * Rate 1
      * ~~~~~~
     C/COPY WNCPYSRC,LEH00767
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           SFRTE1    ANDNE*BLANKS                                                       CLE073
     C           CLE073    ORNE 'Y'                                                           CLE073
      *                                                                                       CLE073
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SFRTE1    ZFIELD
     C                     Z-ADD2         ZADIG   20
     C                     Z-ADD5         ZADEC
     C                     MOVE '0'       *IN99
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN50
     C                     MOVEL'LER0051' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE ZFIELD    WA13
     C           WA13      DIV  100000    WFRT1
     C                     ENDIF
     C/COPY WNCPYSRC,LEH00768
     C                     ELSE                                                               CLE073
     C                     Z-ADD0         WFRT1                                               CLE073
     C                     ENDIF                                                              CLE073
      *
      * Rate 2
      * ~~~~~~
     C           SFRTE2    IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SFRTE2    ZFIELD
     C                     Z-ADD2         ZADIG
     C                     Z-ADD5         ZADEC
     C                     MOVE '0'       *IN99
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN52
     C                     MOVEL'LER0051' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE ZFIELD    WA13
     C           WA13      DIV  100000    WFRT2
     C                     ENDIF
     C                     ELSE
     C                     Z-ADD0         WFRT2
     C                     ENDIF
      *
      * Rate 3
      * ~~~~~~
     C           SFRTE3    IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SFRTE3    ZFIELD
     C                     Z-ADD2         ZADIG
     C                     Z-ADD5         ZADEC
     C                     MOVE '0'       *IN99
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN54
     C                     MOVEL'LER0051' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE ZFIELD    WA13
     C           WA13      DIV  100000    WFRT3
     C                     ENDIF
     C                     ELSE
     C                     Z-ADD0         WFRT3
     C                     ENDIF
      *
      * Rate 4
      * ~~~~~~
     C           SFRTE4    IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SFRTE4    ZFIELD
     C                     Z-ADD2         ZADIG
     C                     Z-ADD5         ZADEC
     C                     MOVE '0'       *IN99
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN56
     C                     MOVEL'LER0051' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE ZFIELD    WA13
     C           WA13      DIV  100000    WFRT4
     C                     ENDIF
     C                     ELSE
     C                     Z-ADD0         WFRT4
     C                     ENDIF
      *
      * Rate 5
      * ~~~~~~
     C           SFRTE5    IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SFRTE5    ZFIELD
     C                     Z-ADD2         ZADIG
     C                     Z-ADD5         ZADEC
     C                     MOVE '0'       *IN99
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN58
     C                     MOVEL'LER0051' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     MOVE ZFIELD    WA13
     C           WA13      DIV  100000    WFRT5
     C                     ENDIF
     C                     ELSE
     C                     Z-ADD0         WFRT5
     C                     ENDIF
      *
     C           WFRT1     IFEQ 0
     C           WFRT2     ANDEQ0
     C/COPY WNCPYSRC,LEH00769
     C           CLE073    ANDNE'Y'                                                           CLE073
     C           WFRT1     OREQ 0                                                             CLE073
     C           WFRT2     ANDEQ0                                                             CLE073
     C           CLE073    ANDEQ'Y'                                                           CLE073
     C           SFCALT    ANDNE'99'                                                          CLE073
     C                     MOVE '1'       *IN52
     C                     MOVE '1'       *IN54
     C                     MOVE '1'       *IN56
     C                     MOVE '1'       *IN58
     C                     MOVEL'LER0050' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * AMNT    -  Validate Amounts entered                           *
      * Called by: SRCATP                                             *
      * Calls    : SREROR - Error Processing                          *
      *****************************************************************
     C           AMNT      BEGSR
      *
     C           SFPIND    IFEQ 'A'
     C                     Z-ADD11        ZADIG
     C                     Z-ADD0         ZADEC
     C                     ELSE
     C                     Z-ADD3         ZADIG
     C                     Z-ADD3         ZADEC
     C                     ENDIF
     C/COPY WNCPYSRC,LEH00770
      *                                                                                       CLE073
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'97'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'98'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           SFCALT    ANDEQ'99'                                                          CLE073
     C           SFAMT1    IFNE *BLANKS                                                       CLE073
     C           SFAMT2    ORNE *BLANKS                                                       CLE073
     C           SFAMT3    ORNE *BLANKS                                                       CLE073
     C           SFAMT4    ORNE *BLANKS                                                       CLE073
     C           SFAMT5    ORNE *BLANKS                                                       CLE073
     C                     MOVE '1'       *IN51                                               CLE073
     C                     MOVE '1'       *IN53                                               CLE073
     C                     MOVE '1'       *IN55                                               CLE073
     C                     MOVE '1'       *IN57                                               CLE073
     C                     MOVE '1'       *IN59                                               CLE073
     C                     MOVEL'XLE0005' ZAMSID                                              CLE073
     C                     EXSR SREROR                                                        CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADD0         WCAMT1                                              CLE073
     C                     Z-ADD0         WCAMT2                                              CLE073
     C                     Z-ADD0         WCAMT3                                              CLE073
     C                     Z-ADD0         WCAMT4                                              CLE073
     C                     Z-ADD0         WCAMT5                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ELSE                                                               CLE073
      *
      ** Amount 1
      *
     C           SFAMT1    IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SFAMT1    ZFIELD
     C                     MOVE '0'       *IN99
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN51
     C                     ELSE
     C                     MOVE ZFIELD    WA13
     C                     Z-ADDWA13      WCAMT1
     C                     ENDIF
      *
     C                     ELSE
     C                     Z-ADD0         WCAMT1
     C                     ENDIF
      *
      ** Amount 2
      *
     C           SFAMT2    IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SFAMT2    ZFIELD
     C                     MOVE '0'       *IN99
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN53
     C                     ELSE
     C                     MOVE ZFIELD    WA13
     C                     Z-ADDWA13      WCAMT2
     C                     ENDIF
      *
     C                     ELSE
     C                     Z-ADD0         WCAMT2
     C                     ENDIF
      *
      ** Amount 3
      *
     C           SFAMT3    IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SFAMT3    ZFIELD
     C                     MOVE '0'       *IN99
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN55
     C                     ELSE
     C                     MOVE ZFIELD    WA13
     C                     Z-ADDWA13      WCAMT3
     C                     ENDIF
      *
     C                     ELSE
     C                     Z-ADD0         WCAMT3
     C                     ENDIF
      *
      ** Amount 4
      *
     C           SFAMT4    IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SFAMT4    ZFIELD
     C                     MOVE '0'       *IN99
      *
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN57
     C                     ELSE
     C                     MOVE ZFIELD    WA13
     C                     Z-ADDWA13      WCAMT4
     C                     ENDIF
      *
     C                     ELSE
     C                     Z-ADD0         WCAMT4
     C                     ENDIF
      *
      ** Amount 5
      *
     C           SFAMT5    IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SFAMT5    ZFIELD
     C                     MOVE '0'       *IN99
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN59
     C                     ELSE
     C                     MOVE ZFIELD    WA13
     C                     Z-ADDWA13      WCAMT5
     C                     ENDIF
      *
     C                     ELSE
     C                     Z-ADD0         WCAMT5
     C                     ENDIF
      *
     C           *IN51     IFNE '0'
     C           *IN53     ORNE '0'
     C           *IN55     ORNE '0'
     C           *IN57     ORNE '0'
     C           *IN59     ORNE '0'
     C           SFPIND    IFEQ 'A'
     C                     MOVEL'LER0055' ZAMSID
     C                     ELSE
     C***********          MOVEL'1276562' ZAMSID                    132949
     C                     MOVEL'LER0072' ZAMSID                    132949
     C                     ENDIF
     C                     EXSR SREROR
     C                     ENDIF
      *
     C           WCAMT2    IFNE 0
     C           WCAMT2    ANDLEWCAMT1
     C           WCAMT3    ORNE 0
     C           WCAMT3    ANDLEWCAMT2
     C           WCAMT4    ORNE 0
     C           WCAMT4    ANDLEWCAMT3
     C           WCAMT5    ORNE 0
     C           WCAMT5    ANDLEWCAMT4
     C                     MOVE '1'       *IN51
     C                     MOVE '1'       *IN53
     C                     MOVE '1'       *IN55
     C                     MOVE '1'       *IN57
     C                     MOVE '1'       *IN59
     C                     MOVEL'LER0054' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C           WCAMT1    IFEQ 0
     C           WCAMT2    ANDNE0
     C           WCAMT1    OREQ 0
     C           WCAMT3    ANDNE0
     C           WCAMT1    OREQ 0
     C           WCAMT4    ANDNE0
     C           WCAMT1    OREQ 0
     C           WCAMT5    ANDNE0
     C           WCAMT2    OREQ 0
     C           WCAMT3    ANDNE0
     C           WCAMT2    OREQ 0
     C           WCAMT4    ANDNE0
     C           WCAMT2    OREQ 0
     C           WCAMT5    ANDNE0
     C           WCAMT3    OREQ 0
     C           WCAMT4    ANDNE0
     C           WCAMT3    OREQ 0
     C           WCAMT5    ANDNE0
     C           WCAMT4    OREQ 0
     C           WCAMT5    ANDNE0
     C                     MOVE '1'       *IN51
     C                     MOVE '1'       *IN53
     C                     MOVE '1'       *IN55
     C                     MOVE '1'       *IN57
     C                     MOVE '1'       *IN59
     C                     MOVEL'LER0052' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C           WFRT2     IFNE 0
     C           WCAMT1    ANDEQ0
     C           WFRT3     ORNE 0
     C           WCAMT2    ANDEQ0
     C           WFRT4     ORNE 0
     C           WCAMT3    ANDEQ0
     C           WFRT5     ORNE 0
     C           WCAMT4    ANDEQ0
     C                     MOVE '1'       *IN51
     C                     MOVE '1'       *IN53
     C                     MOVE '1'       *IN55
     C                     MOVE '1'       *IN57
     C                     MOVE '1'       *IN59
     C                     MOVEL'LER0052' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C           WCAMT1    IFNE 0
     C           SFCALT    IFEQ '03'
     C           SFCALT    OREQ '06'
     C           SFCALT    OREQ '13'
     C           SFCALT    OREQ '16'
     C           SFCALT    OREQ '21'
     C           SFCALT    OREQ '22'
     C                     MOVE '1'       *IN51
     C                     MOVE '1'       *IN53
     C                     MOVE '1'       *IN55
     C                     MOVE '1'       *IN57
     C                     MOVE '1'       *IN59
     C                     MOVEL'LER0053' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
     C           WCAMT1    IFEQ 0
     C           SFCALT    IFEQ '01'
     C           SFCALT    OREQ '02'
     C           SFCALT    OREQ '04'
     C           SFCALT    OREQ '05'
     C           SFCALT    OREQ '11'
     C           SFCALT    OREQ '12'
     C           SFCALT    OREQ '14'
     C           SFCALT    OREQ '15'
     C                     MOVE '1'       *IN51
     C                     MOVE '1'       *IN53
     C                     MOVE '1'       *IN55
     C                     MOVE '1'       *IN57
     C                     MOVE '1'       *IN59
     C                     MOVEL'LER0054' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
     C/COPY WNCPYSRC,LEH00771
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRWRIT  -  Write a new record in file                         *
      * Called by: SRBTCH                                             *
      * Calls    : SEQGEN - Subr. to generate fee sequence number     *
      *            TRSSTF - To convert screen fields to file          *
      *            SRSAVT - Save screen fields to Test Harness File   *
      *            SRTRAL - Update Loan Amendments Trailer File       *
      *            SRUSHD - Update Shadow Files                       *
      *****************************************************************
     C           SRWRIT    BEGSR
      *                                                                                       CSD015
      ** Check if Watch List Checking Engine needs to be called                               CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       WATCH   1                                           CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           CSC011    OREQ 'Y'                                                           CSD015
     C           LIBR      ANDEQS1MAIN                                                        CSD015
     C                     EXSR SRCHCK                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *
      ** Find next available sequence no. for insert
      *
     C                     EXSR SEQGEN
      *
      ** Obtain last transaction number and prepare standard
      *
     C                     EXSR ZTNLU1
      *
      ** Prepare COMIT text
      *
     C                     MOVEL'LE'      MDID
     C                     MOVEL'LE2210  'PGMN
     C                     MOVELWSID      WSIDX
     C                     TIME           MTIME
     C                     MOVE SFLCHT    ACTNX
     C                     MOVE USER      USRIDX
     C                     MOVE SFLCHT    LCHTX
     C                     MOVE SFCNUM    CNUMX
     C                     MOVE SFLNRF    LNRFX
     C                     MOVE SFFACT    FACTX
     C                     MOVE SFFCNO    FCNOX
     C                     MOVE SFFSEQ    FSEQX
     C                     Z-ADDNATN      FETNLU
      *
      ** Set Swift Message Regeneration Indicator                         CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     EXSR SRSWRI                                    CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** Initialise new fields introduced by CAS009                                           231710
     C                     MOVE *BLANK    FEADJY                                              231710
     C                     Z-ADD*ZERO     FEAMTD                                              231710
     C                     Z-ADD*ZERO     FEFEAM                                              231710
     C                     Z-ADD*ZERO     FEFEAC                                              231710
     C                     Z-ADD*ZERO     FEAFES                                              231710
     C                     Z-ADD*ZERO     FEAFEE                                              231710
     C                     Z-ADD*ZERO     FEAFOF                                              231710
     C                     Z-ADD*ZERO     FETFTD                                              231710
     C                     Z-ADD*ZERO     FEAFLS                                              231710
     C                     Z-ADD*ZERO     FEUAFA                                              231710
     C                     Z-ADD*ZERO     FEAFLD                                              231710
      *                                                                                       231710
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           WFAC05    ANDEQ0                                                             CAS009
     C           SFCALT    ANDEQ*BLANKS                                                       CAS009
     C                     EXSR UPDEIR                                                        CAS009
     C                     Z-ADD0         FETFTD                                              CAS009
     C                     Z-ADD0         FEAFLD                                              CAS009
     C                     MOVE WADJY     FEADJY                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Obtain Fee details to be written to file
      *
     C                     EXSR TRSSTF
      *
      ** Settlement details
      *
     C           WSD       IFEQ *BLANK
     C           PMODE     ANDEQ'I'
     C           WSD       OREQ *BLANK
     C           PMODE     ANDEQ'R'
     C           WSD       OREQ *BLANK                                    CAP064
     C           PMODE     ANDEQ'F'                                       CAP064
     C                     CLEARSETLIB
     C                     ENDIF
      *
     C                     Z-ADDPMRSTM    FERSTM
     C                     MOVE PMRONS    FERONS
     C                     MOVE PARIBN    FERIBN
     C                     MOVE PMRIBA    FERIBA
     C                     MOVE PAROBN    FEROBN
     C                     MOVE PAROCN    FEROCN
     C                     MOVE PMPSTM    FEPSTM
     C                     MOVE PMPONS    FEPONS
     C                     MOVE PAPIBN    FEPIBN
     C                     MOVE PMPIBA    FEPIBA
     C                     MOVE PAPOBN    FEPOBN
     C                     MOVE PAPOCN    FEPOCN
     C                     MOVE PARCRN    FERCRN
     C                     MOVE PMRCRA    FERCRA
     C                     MOVE PARVNO    FERVNO
     C                     MOVE PAAWBN    FEAWBN
     C                     MOVE PMAWBA    FEAWBA
     C                     MOVE PABENN    FEBENN
     C                     MOVE PMBENA    FEBENA
     C                     MOVE PMDTP1    FEDTP1
     C                     MOVE PMDTP2    FEDTP2
     C                     MOVE PMDTP3    FEDTP3
     C                     MOVE PMDTP4    FEDTP4
     C                     MOVE PMDCHG    FEDCHG
     C                     MOVE PMBTB1    FEBTB1
     C                     MOVE PMBTB2    FEBTB2
     C                     MOVE PMBTB3    FEBTB3
     C                     MOVE PMBTB4    FEBTB4
     C                     MOVE PMBTB5    FEBTB5
     C                     MOVE PMBTB6    FEBTB6
     C                     MOVE PMCVMR    FECVMR
      *
     C                     MOVE WCNUM     FECNUM
     C**********           Z-ADDWLOAN     FELOAN                                              CLE148
     C                     MOVELWLOAN     FELOAN                                              CLE148
     C                     Z-ADDWFAC05    FEFACL
     C                     MOVE SFLCHT    FELCHT
     C                     Z-ADDBJRDNB    FELCHD
      *                                                                                       193475
      ** PTFI should always be blank (receivable) if CLE006 is OFF.                           193475
      *                                                                                       193475
     C           CLE006    IFEQ 'Y'                                                           193475
     C                     MOVE WPTFI     FEPTFI
     C                     ELSE                                                               193475
     C                     MOVE ' '       FEPTFI                                              193475
     C                     ENDIF                                                              193475
     C                     MOVE SPRFC     FEPRFC
     C********** FELOAN    IFEQ 0                                                             CLE148
     C           FELOAN    IFEQ *BLANKS                                                       CLE148
     C                     MOVE *BLANKS   FELTYP
     C                     MOVE *BLANKS   FESUTP
     C                     ELSE
     C                     MOVE LTYP      FELTYP
     C                     MOVE SUTP      FESUTP
     C                     ENDIF
      *
     C                     Z-ADDBJRDNB    FEORED
     C                     MOVE WRKBRC    FEBRCA
     C                     Z-ADD0         FEADAT
     C                     MOVE 'D'       FERECI
     C                     Z-ADD0         FEAMTP
     C                     Z-ADD0         FELPDT
     C                     Z-ADD0         FELADT
     C                     Z-ADD0         FEDDAT
     C                     Z-ADD0         FEAMTO
     C                     Z-ADD0         FEPLPD
     C                     Z-ADD0         FELPAM
     C                     Z-ADD0         FEPAMS
     C                     Z-ADD0         FEPAMP
     C                     Z-ADD0         FEADBP
      *
      ** Move work field back into file field                             153348
      *                                                                   153348
     C                     Z-ADDWAMTA     FEAMTA                          153348
     C                     Z-ADDWAMTS     FEAMTS                          153348
     C                     MOVE *BLANKS   FEACOF                          153348
     C                     MOVE WDIND     FEDIND                          153348
     C                     Z-ADDWSDAT     FESDAT                          153348
     C                     MOVE *BLANK    FESPTI                          153348
     C                     MOVE *BLANK    FEPPTI                          153348
     C                     MOVE *BLANK    FEEPTI                          153348
     C                     MOVE *BLANK    FESBTI                          153348
     C                     MOVE *BLANK    FEPBTI                          153348
     C                     MOVE *BLANK    FEEBTI                          153348
     C                     Z-ADD0         LSWC                            153348
     C                     Z-ADD0         LSWS                            153348
     C                     Z-ADD0         FETADJ                          153348
     C                     Z-ADD0         FEWOFF                          153348
     C                     Z-ADD0         FEAMTW                                              204452
     C                     MOVE *BLANK    FEINDC                          153348
      *                                                                   153348
     C           BPFEAU    IFEQ 'N'
     C           CLE002    OREQ 'N'                                       128285
     C                     MOVE 'A'       FEFSTS
     C                     ELSE
     C                     MOVE 'C'       FEFSTS
     C                     ENDIF
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE WSCCY     FESCCY                          CEU004
     C                     MOVE PMIC72    FEICCY                          CEU004
     C                     ENDIF                                          CEU004
      *
     C           PMODE     IFEQ 'B'
     C/COPY WNCPYSRC,LEH00530
     C                     MOVELPIIUSR    FEIUSR
     C                     MOVELPIAUSR    FEAUSR
     C                     MOVELPIXUSR    FEXUSR
     C                     ELSE
     C                     MOVELUSER      FEIUSR
     C                     MOVE *BLANK    FEAUSR
     C                     MOVE *BLANK    FEXUSR
     C                     ENDIF
     C                     MOVE *BLANK    FEGFPT
     C                     MOVE *BLANK    FEPTAI
     C                     MOVE *BLANK    FESMAC
     C                     MOVE *BLANK    FEPCOB
      *
      ** If mode is 'B'...
      *
     C           PMODE     IFEQ 'B'
     C/COPY WNCPYSRC,LEH00531
      *
      ** Set up Original Entry Date, and Last Change Date
      *
     C**********           MOVE PITDST    WPITDS                                              260075
     C**********           MOVELWPIDD     WFLD4   4                                           260075
     C**********           MOVE WPIMM     WFLD4                                               260075
     C**********           MOVELWFLD4     WFLD6   6                                           260075
     C**********           MOVE WPIYY     WFLD6                                               260075
     C**********           MOVELWFLD6     ZDATE                                               260075
     C**********           EXSR ZDATE1                                                        260075
     C**********           Z-ADDZDAYNO    FEORED                                              260075
     C**********           Z-ADDZDAYNO    FELCHD                                              260075
     C                     Z-ADDWRNDAY    FEORED                                              260075
     C                     Z-ADDWRNDAY    FELCHD                                              260075
     C                     MOVE 'A'       FEFSTS
     C/COPY WNCPYSRC,LE2210C016
      *
      ** Set up Last Change Type and PC transaction reference
      *
     C                     MOVE PITACT    FELCHT
     C                     MOVE PITREF    FEPCRF
     C                     MOVE PIPCOB    FEPCOB
      *
      ** Mode is not 'B', set up transaction reference.                   142447
      *                                                                   142447
     C                     ELSE                                           142447
     C                     CALL 'AOBRCHR1'                                142447
     C                     PARM *BLANKS   @RTCD   7                       142447
     C                     PARM '*KEY   ' @OPTN   7                       142447
     C                     PARM BRCA      @BRCA   3                       142447
     C           SDBRCH    PARM SDBRCH    DSSDY                           142447
     C           @RTCD     IFNE *BLANKS                                   142447
     C           *LOCK     IN   LDA                                       142447
     C                     Z-ADD19        DBASE                           142447
     C                     MOVEL'SDBRCHPD'DBFILE                          142447
     C                     MOVELBRCA      DBKEY                           142447
     C                     MOVEL'LE2210'  DBPGM                           142447
     C                     OUT  LDA                                       142447
     C                     EXSR *PSSR                                     142447
     C                     ELSE                                           142447
     C                     MOVELA8MQSM    W#1ST3  3                       142447
     C********** *NAMVAR   DEFN           LEALLO                                       142447 CLE148
     C********** *LOCK     IN   LEALLO                                                 142447 CLE148
     C********** PCLAST    ADD  1         PCNEXT  80                                   142447 CLE148
     C                     CALL 'LEALLO'                                                      CLE148
     C                     PARM *BLANKS   PRTCD   7                                           CLE148
     C                     PARM 'Y'       PUPDT   1                                           CLE148
     C                     PARM *BLANKS   PCLAST                                              CLE148
     C                     PARM *BLANKS   PCNEXT  8                                           CLE148
     C                     MOVE PCNEXT    W1ST11 11                       142447
     C                     MOVELW#1ST3    W1ST11                          142447
     C                     MOVELW1ST11    FEPCRF                          142447
     C                     MOVE '0001'    FEPCRF                          142447
     C**********           Z-ADDPCNEXT    PCLAST                                       142447 CLE148
     C**********           OUT  LEALLO                                                 142447 CLE148
     C                     ENDIF                                          142447
      *                                                                   142447
     C                     ENDIF
      *                                                                                       CSD015
      ** Call Watch List Checking Engine program                                              CSD015
      *                                                                                       CSD015
     C           WATCH     IFEQ 'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           WPTFI     IFEQ *BLANK                                                        CLE031
     C                     MOVE PMRSCY    FESCCY                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANK    FESCCY                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     Z-ADD0         WSEXR0 130                                          CLE031
     C                     Z-ADD0         WSEXR8 138                                          CLE031
     C                     MOVE *BLANK    ZFIELD                                              CLE031
     C                     MOVE PMREXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
      *                                                                                       CLE031
     C           *IN99     IFEQ *OFF                                                          CLE031
     C                     MOVE ZFIELD    WSEXR0                                              CLE031
     C           WSEXR0    DIV  100000000 WSEXR8                                              CLE031
     C                     Z-ADDWSEXR8    FEREXR                                              CLE031
     C                     ELSE                                                               CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'ZALIGN  'DBFILE                                              CLE031
     C                     Z-ADD30        DBASE                                               CLE031
     C                     MOVELPMREXR    DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE PMREXI    FEREXI                                              CLE031
     C                     Z-ADD0         WSEXR0                                              CLE031
     C                     Z-ADD0         WSEXR8                                              CLE031
     C           WPTFI     IFEQ 'P'                                                           CLE031
     C                     MOVE PMPSCY    FEPSCY                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANK    FEPSCY                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE *BLANK    ZFIELD                                              CLE031
     C                     MOVE PMPEXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
      *                                                                                       CLE031
     C           *IN99     IFEQ *OFF                                                          CLE031
     C                     MOVE ZFIELD    WSEXR0                                              CLE031
     C           WSEXR0    DIV  100000000 WSEXR8                                              CLE031
     C                     Z-ADDWSEXR8    FEPEXR                                              CLE031
     C                     ELSE                                                               CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'ZALIGN  'DBFILE                                              CLE031
     C                     Z-ADD31        DBASE                                               CLE031
     C                     MOVELPMPEXR    DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE PMPEXI    FEPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE SFSTAL    FESTAL                                              CLE034
     C                     ENDIF                                                              CLE034
      *
      ** Write a new record to file LEFEED
      *
     C                     WRITELEFEEDF                78
      *                                                                                       261340
      ** Setup Fields For LEFEEDQD                                                            261340
      *                                                                                       261340
     C           PMODE     IFEQ 'B'                                                           261340
     C**********           READ LEFEEQD0                 80                           261340 261340A
     C                     MOVE WRKBRC    FQBRCA                                              261340
     C                     MOVE WCNUM     FQCNUM                                              261340
     C                     Z-ADDWFAC05    FQFACL                                              261340
     C**********           Z-ADDWLOAN     FQLOAN                                       261340 CLE148
     C                     MOVELWLOAN     FQLOAN                                              CLE148
     C                     Z-ADDFEFSEQ    FQFSEQ                                              261340
     C                     MOVE *BLANKS   FQFRID                                              261340
     C                     WRITELEFEEQD0                                                      261340
     C                     ENDIF                                                              261340
     C/COPY WNCPYSRC,LE2210C022
      *                                                                                       CLE034
      ** After LEFEED has been written to, need to update the                                 CLE034
      ** settlement allocations table.                                                        CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           SFLCHT    ANDEQ'I'                                                           CLE034
     C           WNKEY     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALU0'                                                    CLE034
     C                     PARM PMODE     PRTCD                                               CLE034
     C                     PARM 'FEES  '  PTYPE                                               CLE034
     C                     PARM 'U'       PACTN   1                                           CLE034
     C                     PARM           FELOAN                                              CLE034
     C                     PARM *ZEROS    PVDAT                                               CLE034
     C                     PARM *ZEROS    PSEQN                                               CLE034
     C                     PARM           FECNUM                                              CLE034
     C                     PARM           FEFACL                                              CLE034
     C                     PARM           FEFSEQ                                              CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM           FEPCRF                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *
     C                     MOVE '0'       *IN24
     C                     MOVEL@ALSEQ    WLSNA
      *
      ** Write a new record in file LE2210PD if mode is 'R'
      *
     C           PMODE     IFEQ 'R'
      *
     C                     Z-ADDBJRDNB    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     WDATE
     C                     MOVELWDD       WFLD3A  3
     C                     MOVE '/'       WFLD3A
     C                     MOVELWMM       WFLD3B  3
     C                     MOVE '/'       WFLD3B
     C                     MOVELWFLD3A    WFLD6A  6
     C                     MOVE WFLD3B    WFLD6A
     C                     MOVELWFLD6A    WDTST   8
     C                     MOVE WYY       WDTST
     C                     MOVELWDTST     DTST
      *
     C                     TIME           WTIME   60
     C                     MOVELWTIME     WTIMEA  6
     C                     MOVELWHH       WFLD3A  3
     C                     MOVE ':'       WFLD3A
     C                     MOVELWNN       WFLD3B  3
     C                     MOVE ':'       WFLD3B
     C                     MOVELWFLD3A    WFLD6A  6
     C                     MOVE WFLD3B    WFLD6A
     C                     MOVELWFLD6A    WTMST   8
     C                     MOVE WSS       WTMST
     C                     MOVELWTMST     TMST
      *
     C                     MOVELSFLCHT    ACTN
     C                     MOVE *BLANK    MSVR
     C                     MOVE *BLANK    MSID
     C                     MOVE *BLANK    MSTX
      *
      ** Save test harness record for later update after COMIT
      *
     C                     EXSR SRSAVT
      *
     C                     MOVE *BLANK    THFSEQ
     C                     ENDIF
      *
     C           *IN78     IFEQ '0'
     C/COPY WNCPYSRC,LEH00593
      *
      ** Update Loan Amend. Trailer file
      *
     C                     EXSR SRTRAL
      *
      ** Update Shadow Files
      *
     C                     CLEARZ#BSTS
     C                     MOVELWLFEED    Z#ASTS
      *
     C           FEAUTO    IFEQ 'Y'
     C           FEAUTO    ORNE WFEAUT                                                        223922
     C                     EXSR SRUSHD
     C                     ENDIF
      *
      * Delete invalid record                                             CAP064
     C           PMODE     IFEQ 'F'                                       CAP064
     C           XREPN     CHAINLEIFEEDL             99                   CAP064
     C                     DELETLEIFEEDL                                  CAP064
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     EXSR LOGDEL                                    CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      * If Support System active, write transaction to 24x7 log           CSC011
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C*                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
      *                                                                   CSC011
      * Convert to PINPP format                                           CSC011
     C                     EXSR LOG247                                    CSC011
      *                                                                   CSC011
      * Write valid Fee in PINPP format to 24x7 Log File                  CSC011
     C                     MOVE 'V'       LOGVAL  1                       CSC011
     C                     EXSR APLGTR                                    CSC011
     C                     COMIT                                          CSC011
      *                                                                   CSC011
     C                     ENDIF                                          CSC011
      ** COMMIT if no errors
      *
     C           PMODE     IFNE 'B'
     C/COPY WNCPYSRC,LEH00532
     C                     COMIT
     C                     ENDIF
      *
      ** Write a new record to test harness file
      *
     C           PMODE     IFEQ 'R'
     C                     WRITELE2210D0
     C                     ENDIF
      *
     C                     MOVE 'F0'      WFMT
     C                     ENDIF
     C/COPY WNCPYSRC,LE2210C007
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRUPDT  -  Update record                                      *
      * Called by: SRBTCH                                             *
      * Calls    : SREROR - Error Processing                          *
      *            TRSSTF  -  To convert screen fields to file        *
      *            SRSAVT  -  Save screen fields to Test Harness File *
      *            SRTRAL - Update Loan Amendments Trailer File       *
      *            SRUSHD - Update Shadow Files                       *
      *****************************************************************
     C           SRUPDT    BEGSR
      *
      ** Check whether amended by another work station
      *
     C           KEY002    SETLLLEFEEDF
     C           KEY002    CHAINLEFEEDF              78
      *
      ** Save Last Change Type                                                                CSW208
      *                                                                                       CSW208
     C                     MOVELFELCHT    WLCHT   1                                           CSW208
      *                                                                                       CSW208
     C           FETNLU    IFNE WTNLU
     C***********          MOVEL'1276561' ZAMSID                    132949
     C                     MOVEL'LER0071' ZAMSID                    132949
     C                     EXSR SREROR
     C                     MOVE 'D1'      WFMT
     C                     GOTO EXUPD
     C                     ENDIF
      *
     C                     CLEARZ#BSTS
     C                     MOVELWLFEED    Z#BSTS
      *
      ** Obtain last transaction number
      *
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      FETNLU
     C                     Z-ADDBJRDNB    FELCHD
      *
      ** Prepare COMIT text
      *
     C                     MOVEL'LE'      MDID
     C                     MOVEL'LE2210  'PGMN
     C                     MOVELWSID      WSIDX
     C                     TIME           MTIME
     C                     MOVE SFLCHT    ACTNX
     C                     MOVE USER      USRIDX
     C                     MOVE SFLCHT    LCHTX
     C                     MOVE SFCNUM    CNUMX
     C                     MOVE SFLNRF    LNRFX
     C                     MOVE SFFACT    FACTX
     C                     MOVE SFFCNO    FCNOX
     C                     MOVE SFFSEQ    FSEQX
      *                                                                   CLE009
      ** Set Swift Message Regeneration Indicator                         CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C                     EXSR SRSWRI                                    CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      *
      ** Set up the following fields for action Amend
      *
     C           SFLCHT    IFEQ 'A'
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE WSCCY     FESCCY                          CEU004
     C                     MOVE PMIC72    FEICCY                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           WFAC05    ANDEQ0                                                             CAS009
     C           SFCALT    ANDEQ*BLANKS                                                       CAS009
      *                                                                                       CAS009
     C                     MOVE 'N'       WUPDEI  1                                           CAS009
      *                                                                                       CAS009
     C           WADJY     IFNE FEADJY                                                        CAS009
     C           WCCY      ORNE FEFCCY                                                        CAS009
     C           WFAMT     ORNE FEFAMT                                                        CAS009
     C                     MOVE 'Y'       WUPDEI                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C** If the Fee is a Bullet Fee or Amortised Fee                                          CAS009
     C           FEPYON    IFEQ *BLANKS                                                       CAS009
     C           FEPYON    OREQ 'S'                                                           CAS009
      *                                                                                       CAS009
      ** The Start Date has been Amended                                                      CAS009
     C           WPSTD     IFNE FEPSTD                                                        CAS009
     C                     MOVE 'Y'       WUPDEI                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** The Fee is an Accrued Fee                                                            CAS009
     C           FEPYON    IFEQ 'E'                                                           CAS009
     C           FEPYON    OREQ 'N'                                                           CAS009
     C           WFAMT     ANDNE0                                                             CAS009
      *                                                                                       CAS009
      ** The End Date has been Amended                                                        CAS009
     C           WPEND     IFNE FEPEND                                                        CAS009
     C                     MOVE 'Y'       WUPDEI                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           WUPDEI    IFEQ 'Y'                                                           CAS009
     C                     EXSR UPDEIR                                                        CAS009
     C                     MOVE WADJY     FEADJY                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *
     C                     EXSR TRSSTF
      *
     C                     MOVE 'A'       FELCHT
     C                     MOVELUSER      FEAUSR
     C           BPFEAU    IFEQ 'N'
     C           CLE002    OREQ 'N'                                       128285
     C                     MOVE 'A'       FEFSTS
     C                     ELSE
     C           FEFSTS    IFEQ 'A'
     C           FEFSTS    OREQ 'R'                                       194509
     C                     MOVE 'R'       FEFSTS
     C                     ELSE
     C                     MOVE 'C'       FEFSTS
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CSD015
      ** Check if Watch List Checking Engine program needs to be called                       CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       WATCH                                               CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           CSC011    OREQ 'Y'                                                           CSD015
     C           LIBR      ANDEQS1MAIN                                                        CSD015
     C                     EXSR SRCHCK                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *
      ** Settlement details
      *
     C                     Z-ADDPMRSTM    FERSTM
     C                     MOVE PMRONS    FERONS
     C                     MOVE PARIBN    FERIBN
     C                     MOVE PMRIBA    FERIBA
     C                     MOVE PAROBN    FEROBN
     C                     MOVE PAROCN    FEROCN
     C                     MOVE PMPSTM    FEPSTM
     C                     MOVE PMPONS    FEPONS
     C                     MOVE PAPIBN    FEPIBN
     C                     MOVE PMPIBA    FEPIBA
     C                     MOVE PAPOBN    FEPOBN
     C                     MOVE PAPOCN    FEPOCN
     C                     MOVE PARCRN    FERCRN
     C                     MOVE PMRCRA    FERCRA
     C                     MOVE PARVNO    FERVNO
     C                     MOVE PAAWBN    FEAWBN
     C                     MOVE PMAWBA    FEAWBA
     C                     MOVE PABENN    FEBENN
     C                     MOVE PMBENA    FEBENA
     C                     MOVE PMDTP1    FEDTP1
     C                     MOVE PMDTP2    FEDTP2
     C                     MOVE PMDTP3    FEDTP3
     C                     MOVE PMDTP4    FEDTP4
     C                     MOVE PMDCHG    FEDCHG
     C                     MOVE PMBTB1    FEBTB1
     C                     MOVE PMBTB2    FEBTB2
     C                     MOVE PMBTB3    FEBTB3
     C                     MOVE PMBTB4    FEBTB4
     C                     MOVE PMBTB5    FEBTB5
     C                     MOVE PMBTB6    FEBTB6
     C                     MOVE PMCVMR    FECVMR
      *
     C                     ENDIF
      *
      ** Set up the following fields for Authorisation
      *
     C           SFLCHT    IFEQ 'X'
     C           BPFEAU    ANDEQ'Y'
     C           CLE002    ANDEQ'Y'                                       155610
     C                     MOVE 'A'       FEFSTS
     C                     MOVE 'X'       FELCHT
     C                     MOVELUSER      FEXUSR
     C                     ENDIF
      *
      ** Set up the following fields for reverse Amend
      *
     C           SFLCHT    IFEQ 'D'
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           WFAC05    ANDEQ0                                                             CAS009
     C           SFCALT    ANDEQ*BLANKS                                                       CAS009
     C                     EXSR UPDEIR                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     MOVE 'R'       FERECI
     C                     MOVE 'D'       FELCHT
     C***********          MOVE 'D'       FEFSTS                          155772
     C                     MOVE 'A'       FEFSTS                          155772
     C                     ENDIF
      *
      ** Set up the Last Change Date field if mode is 'B'
      *
     C           PMODE     IFEQ 'B'
     C/COPY WNCPYSRC,LEH00533
      *
     C                     MOVE PITDST    WPITDS
     C                     MOVELWPIDD     WFLD4   4
     C                     MOVE WPIMM     WFLD4
     C                     MOVELWFLD4     WFLD6   6
     C                     MOVE WPIYY     WFLD6
     C                     MOVELWFLD6     ZDATE
     C                     EXSR ZDATE1
     C**********           Z-ADDZDAYNO    FELCHD                                            AR682710
     C                     Z-ADDBJRDNB    FELCHD                                            AR682710
     C                     MOVE 'A'       FEFSTS
     C                     MOVELPIAUSR    FEAUSR
     C                     MOVELPIXUSR    FEXUSR
      *
      ** Set up Last Change Type and PC transaction reference
      *
     C                     MOVE PITACT    FELCHT
     C                     MOVE PITREF    FEPCRF
      *
     C                     ENDIF
      *                                                                                       CSD015
      ** Call Watch List Checking Engine program                                              CSD015
      *                                                                                       CSD015
     C           WATCH     IFEQ 'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           WPTFI     IFEQ *BLANK                                                        CLE031
     C                     MOVE WSCCY     FESCCY                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANK    FESCCY                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     Z-ADD0         WSEXR0                                              CLE031
     C                     Z-ADD0         WSEXR8                                              CLE031
     C                     MOVE *BLANK    ZFIELD                                              CLE031
     C                     MOVE PMREXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
      *                                                                                       CLE031
     C           *IN99     IFEQ *OFF                                                          CLE031
     C                     MOVE ZFIELD    WSEXR0                                              CLE031
     C           WSEXR0    DIV  100000000 WSEXR8                                              CLE031
     C                     Z-ADDWSEXR8    FEREXR                                              CLE031
     C                     ELSE                                                               CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'ZALIGN  'DBFILE                                              CLE031
     C                     Z-ADD32        DBASE                                               CLE031
     C                     MOVELPMREXR    DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE PMREXI    FEREXI                                              CLE031
     C                     Z-ADD0         WSEXR0                                              CLE031
     C                     Z-ADD0         WSEXR8                                              CLE031
     C           WPTFI     IFEQ 'P'                                                           CLE031
     C                     MOVE WSCCY     FEPSCY                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANK    FEPSCY                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE *BLANK    ZFIELD                                              CLE031
     C                     MOVE PMPEXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
      *                                                                                       CLE031
     C           *IN99     IFEQ *OFF                                                          CLE031
     C                     MOVE ZFIELD    WSEXR0                                              CLE031
     C           WSEXR0    DIV  100000000 WSEXR8                                              CLE031
     C                     Z-ADDWSEXR8    FEPEXR                                              CLE031
     C                     ELSE                                                               CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'ZALIGN  'DBFILE                                              CLE031
     C                     Z-ADD33        DBASE                                               CLE031
     C                     MOVELPMPEXR    DBKEY                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE PMPEXI    FEPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVE SFSTAL    FESTAL                                              CLE034
     C                     ENDIF                                                              CLE034
      *
      ** Update record of LEFEED
      *
     C                     UPDATLEFEEDF                78
     C/COPY WNCPYSRC,LEH00905
      *
      ** Retrieve parameter fields for Shadow update
      *
     C                     CLEARZ#ASTS
     C           SFLCHT    IFEQ 'A'
     C           SFLCHT    OREQ 'D'                                       CLE009
     C                     MOVELWLFEED    Z#ASTS
     C                     ENDIF
      *
      ** Write a new record in file LE2210PD if mode is 'R'
      *
     C           PMODE     IFEQ 'R'
      *
     C                     Z-ADDBJRDNB    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     WDATE
     C                     MOVELWDD       WFLD3A  3
     C                     MOVE '/'       WFLD3A
     C                     MOVELWMM       WFLD3B  3
     C                     MOVE '/'       WFLD3B
     C                     MOVELWFLD3A    WFLD6A  6
     C                     MOVE WFLD3B    WFLD6A
     C                     MOVELWFLD6A    WDTST   8
     C                     MOVE WYY       WDTST
     C                     MOVELWDTST     DTST
      *
     C                     TIME           WTIME   60
     C                     MOVELWTIME     WTIMEA  6
     C                     MOVELWHH       WFLD3A  3
     C                     MOVE ':'       WFLD3A
     C                     MOVELWNN       WFLD3B  3
     C                     MOVE ':'       WFLD3B
     C                     MOVELWFLD3A    WFLD6A  6
     C                     MOVE WFLD3B    WFLD6A
     C                     MOVELWFLD6A    WTMST   8
     C                     MOVE WSS       WTMST
     C                     MOVELWTMST     TMST
      *
     C           SFLCHT    IFEQ 'A'
     C           SFLCHT    OREQ 'X'
     C           SFLCHT    OREQ 'D'
     C                     MOVE SFLCHT    ACTN
     C                     MOVE *BLANK    MSVR
     C                     MOVE *BLANK    MSID
     C                     MOVE *BLANK    MSTX
     C                     ENDIF
      *
      ** Save test harness record for later update after COMIT
      *
     C                     EXSR SRSAVT
     C                     ENDIF
      *
     C           *IN78     IFEQ '0'
     C/COPY WNCPYSRC,LEH00594
      *
      ** Update Trailer file
      *
     C                     EXSR SRTRAL
      *
      ** Update Shadow files
      *
     C           SFLCHT    IFNE 'X'
     C           FEAUTO    ANDEQ'Y'
     C           FEAUTO    ORNE WFEAUT                                                        223922
     C                     EXSR SRUSHD
     C                     ENDIF
      *                                                                                       CLE034
      ** After LEFEED has been written to, need to update the                                 CLE034
      ** settlement allocations table.                                                        CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           SFLCHT    ANDEQ'D'                                                           CLE034
     C           FEFSEQ    IFNE *ZEROS                                                        CLE034
     C                     MOVELSTAMP,1   PTMST                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALU0'                                                    CLE034
     C                     PARM PMODE     PRTCD                                               CLE034
     C                     PARM 'FEES  '  PTYPE                                               CLE034
     C                     PARM 'D'       PACTN                                               CLE034
     C                     PARM           FELOAN                                              CLE034
     C                     PARM *ZEROS    PVDAT                                               CLE034
     C                     PARM *ZEROS    PSEQN                                               CLE034
     C                     PARM           FECNUM                                              CLE034
     C                     PARM           FEFACL                                              CLE034
     C                     PARM           FEFSEQ                                              CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM           FEPCRF                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *
      ** Output Record in LTRIX                                                               CSW208
      ** LE Confirmation should be 'Y'                                                        CSW208
      ** Loan Status should be Authorised                                                     CSW208
      ** Customer should have SWIFT ID                                                        CSW208
      *                                                                                       CSW208
     C           LSCONF    IFEQ 'Y'                                                           CSW208
     C********** FELOAN    ANDNE*ZEROS                                                 CSW208 CLE148
     C           FELOAN    ANDNE*BLANKS                                                       CLE148
     C           LSTS      ANDEQ'A'                                                           CSW208
     C           BBCSID    ANDNE*BLANKS                                                       CSW208
      *                                                                                       CSW208
      ** Generate confirmation if Amended                                                     CSW208
      *                                                                                       CSW208
     C                     EXSR SRLOAN                                                        CSW208
     C           WAMDED    IFEQ 'Y'                                                           CSW208
     C                     BITOF'0'       CNFI                                                CSW208
     C                     UPDATCLOANCLF                                                      CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C           FEFSTS    IFEQ 'A'                                                           CSW208
     C                     EXSR ZTNLU1                                                        CSW208
     C**********           EXSR SRRLTX                                               CSW208 AR322732
      *                                                                                       CSW208
      ** Generate confirmation if Last Change type = Insert or Delete                         CSW208
      *                                                                                       CSW208
     C           WLCHT     IFEQ 'I'                                                           CSW208
     C           FELCHT    OREQ 'D'                                                           CSW208
     C                     BITOF'0'       CNFI                                                CSW208
     C                     UPDATCLOANCLF                                                      CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     TESTB'0'       CNFI           78                                   CSW208
      *                                                                                       CSW208
     C**********           MOVE 'N'       CNRQD                                      CSW208 AR322732
     C                     MOVE 'N'       CNRQD   1                                         AR322732
     C           *IN78     IFEQ *OFF                                                          CSW208
     C                     MOVE 'Y'       CNRQD                                               CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     EXSR SRWLTX                                                        CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      * Delete invalid record                                             CAP064
     C/COPY WNCPYSRC,LE2210C014
     C           PMODE     IFEQ 'F'                                       CAP064
     C           XREPN     CHAINLEIFEEDL             99                   CAP064
     C                     DELETLEIFEEDL                                  CAP064
     C*                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     EXSR LOGDEL                                    CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      ** COMMIT if no errors
      *
     C           PMODE     IFNE 'B'
     C/COPY WNCPYSRC,LEH00534
     C                     COMIT
     C                     ENDIF
      *
      ** Write a new record to test harness file
      *
     C           PMODE     IFEQ 'R'
     C                     WRITELE2210D0
     C                     ENDIF
      *                                                                   CSC011
      * If Support System active, write transaction to 24x7 log           CSC011
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
     C*                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
      *                                                                   CSC011
      * Convert facility to PINPP format                                  CSC011
     C                     EXSR LOG247                                    CSC011
      *                                                                   CSC011
      * Write valid facility in PINPP format to 24x7 Log File             CSC011
     C                     MOVE 'V'       LOGVAL  1                       CSC011
     C                     EXSR APLGTR                                    CSC011
     C                     COMIT                                          CSC011
      *                                                                   CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
      *
     C                     MOVE 'F0'      WFMT
     C                     ENDIF
     C/COPY WNCPYSRC,LE2210C008
      *
     C           EXUPD     ENDSR
     C/COPY WNCPYSRC,LE2210C017
      /EJECT
      *****************************************************************   CLE009
      * SRSWRI  -  Set SWIFT Message Regeneration Indicator           *   CLE009
      * Called by: SRWRIT, SRUPDT                                     *   CLE009
      * Calls    : SRTXDT                                             *   CLE009
      *****************************************************************   CLE009
     C           SRSWRI    BEGSR                                          CLE009
      *                                                                   CLE009
      ** Action Code is Insert                                            CLE009
     C           SFLCHT    IFEQ 'I'                                       CLE009
     C           CLE002    IFEQ 'N'                                       CLE009
     C           CLE002    OREQ 'Y'                                       CLE009
     C           BPFEAU    ANDEQ'N'                                       CLE009
     C                     MOVE *BLANK    FESWRI                          CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'I'       FESWRI                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** Action Code is Reverse                                           CLE009
     C********** SFLCHT    IFEQ 'R'                                                    CLE009 186066
     C           SFLCHT    IFEQ 'D'                                                           186066
      ** Start, Payment, or End Pay/Receive Telex Indicator is Yes        CLE009
     C           FESPTI    IFEQ 'Y'                                       CLE009
     C           FEPPTI    OREQ 'Y'                                       CLE009
     C           FEEPTI    OREQ 'Y'                                       CLE009
     C                     MOVE 'R'       FESWRI                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** Action Code is Amend                                             CLE009
     C           SFLCHT    IFEQ 'A'                                       CLE009
     C           FESWRI    ANDNE'I'                                       CLE009
     C           FESWRI    ANDNE'B'                                       CLE009
     C           FESWRI    ANDNE'H'                                       CLE009
      *                                                                   CLE009
      ** Set Telex Notice Date                                            CLE009
      *                                                                                       188366
      ** Initialize FESTTL with the new settlement method.                                    188366
      *                                                                                       188366
     C           WPTFI     IFEQ 'P'                                                           188366
     C                     Z-ADDPMPSTM    FESTTL                                              188366
     C                     ENDIF                                                              188366
      *                                                                                       188366
     C           WPTFI     IFEQ *BLANK                                                        188366
     C                     Z-ADDPMRSTM    FESTTL                                              188366
     C                     ENDIF                                                              188366
      *                                                                                       188366
     C                     EXSR SRTXDT                                    CLE009
      *                                                                   CLE009
      ** If the Fee is a non-calculated Fee                               CLE009
     C           FECALT    IFEQ *BLANKS                                   CLE009
      *                                                                   CLE009
     C** If the Fee is a Bullet Fee or Amortised Fee                      CLE009
     C           FEPYON    IFEQ *BLANKS                                   CLE009
     C           FEPYON    OREQ 'S'                                       CLE009
      *                                                                   CLE009
     C                     MOVE 'N'       WAMDED  1                       CLE009
      *                                                                   CLE009
      ** The Start Date has been Amended                                  CLE009
     C           WPSTD     IFNE FEPSTD                                    CLE009
     C                     MOVE 'Y'       WAMDED                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** The Amount has been Amended                                      CLE009
     C           WFAMT     IFNE FEFAMT                                    CLE009
     C                     MOVE 'Y'       WAMDED                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** The Confirm Indicator has been Amended                           CLE009
     C           SFEADV    IFNE *BLANKS                                   CLE009
     C           SFEADV    ANDNEFEAUTO                                    CLE009
     C           SFEADV    OREQ *BLANKS                                   CLE009
     C           'N'       ANDNEFEAUTO                                    CLE009
     C                     MOVE 'Y'       WAMDED                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** The Settlement Instructions have been Amended                    CLE009
     C                     MOVE FEROBN    WFROBN  6        Num -> Char    CLE009
     C                     MOVE FEROCN    WFROCN  6                       CLE009
     C                     MOVE FEPOBN    WFPOBN  6                       CLE009
     C                     MOVE FEPOCN    WFPOCN  6                       CLE009
      *                                                                                       CLE034
      ** If CLE034 is on and Settlement allocation is 'Y'                                     CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SFSTAL    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C                     MOVE 'Y'       WAMDED                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C           FEROBN    IFEQ *ZEROS                                                        CSW208
     C                     MOVEL*BLANKS   WFROBN                                              CSW208
     C                     ENDIF                                                              CSW208
     C           FEROCN    IFEQ *ZEROS                                                        CSW208
     C                     MOVEL*BLANKS   WFROCN                                              CSW208
     C                     ENDIF                                                              CSW208
     C           FEPOBN    IFEQ *ZEROS                                                        CSW208
     C                     MOVEL*BLANKS   WFPOBN                                              CSW208
     C                     ENDIF                                                              CSW208
     C           FEPOCN    IFEQ *ZEROS                                                        CSW208
     C                     MOVEL*BLANKS   WFPOCN                                              CSW208
     C                     ENDIF                                                              CSW208
     C           PMRSTM    IFNE FERSTM                                    CLE009
     C           PMRONS    ORNE FERONS                                    CLE009
     C           PMRIBN    ORNE FERIBN                                    CLE009
     C           PMRIBA    ORNE FERIBA                                    CLE009
     C********** PMROBN    ORNE WFROBN                                                 CLE009 CSW208
     C********** PMROCN    ORNE WFROCN                                                 CLE009 CSW208
     C           PAROBN    ORNE WFROBN                                                        CSW208
     C           PAROCN    ORNE WFROCN                                                        CSW208
     C           PMPSTM    ORNE FEPSTM                                    CLE009
     C           PMPONS    ORNE FEPONS                                    CLE009
     C           PMPIBN    ORNE FEPIBN                                    CLE009
     C           PMPIBA    ORNE FEPIBA                                    CLE009
     C********** PMPOBN    ORNE WFPOBN                                                 CLE009 CSW208
     C********** PMPOCN    ORNE WFPOCN                                                 CLE009 CSW208
     C           PAPOBN    ORNE WFPOBN                                                        CSW208
     C           PAPOCN    ORNE WFPOCN                                                        CSW208
     C           PMRCRN    ORNE FERCRN                                    CLE009
     C           PMRCRA    ORNE FERCRA                                    CLE009
     C           PMAWBN    ORNE FEAWBN                                    CLE009
     C           PMAWBA    ORNE FEAWBA                                    CLE009
     C           PMBENN    ORNE FEBENN                                    CLE009
     C           PMBENA    ORNE FEBENA                                    CLE009
     C           PMDTP1    ORNE FEDTP1                                    CLE009
     C           PMDTP2    ORNE FEDTP2                                    CLE009
     C           PMDTP3    ORNE FEDTP3                                    CLE009
     C           PMDTP4    ORNE FEDTP4                                    CLE009
     C           PMRVNO    ORNE FERVNO                                    CLE009
     C           PMDCHG    ORNE FEDCHG                                    CLE009
     C           PMBTB1    ORNE FEBTB1                                    CLE009
     C           PMBTB2    ORNE FEBTB2                                    CLE009
     C           PMBTB3    ORNE FEBTB3                                    CLE009
     C           PMBTB4    ORNE FEBTB4                                    CLE009
     C           PMBTB5    ORNE FEBTB5                                    CLE009
     C           PMBTB6    ORNE FEBTB6                                    CLE009
     C           PMCVMR    ORNE FECVMR                                    CLE009
     C           PMROBR    ORNE FEOSDB                                    CLE009
     C           PMPOBR    ORNE FEOMDB                                    CLE009
     C                     MOVE 'Y'       WAMDED                          CLE009
     C                     ELSE                                           CLE009
     C           CEU004    IFEQ 'Y'                                       CLE009
     C           WSCCY     IFNE FESCCY                                    CLE009
     C           PMIC72    ORNE FEICCY                                    CLE009
     C                     MOVE 'Y'       WAMDED                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                                              CLE034
      *                                                                   CLE009
     C           WAMDED    IFEQ 'Y'                                       CLE009
      *                                                                   CLE009
     C           FEPSTD    IFGE BJRDNB                                    CLE009
     C           FESPTI    IFEQ 'Y'                                       CLE009
     C           WPSTD     ORLE TXDT                                      CLE009
     C           FEPSTD    ORLE TXDT                                      CLE009
      *                                                                   CLE009
     C           CLE002    IFEQ 'N'                                       CLE009
     C           CLE002    OREQ 'Y'                                       CLE009
     C           BPFEAU    ANDEQ'N'                                       CLE009
     C                     MOVE 'A'       FESWRI                          CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'B'       FESWRI                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C** The Fee is a Accrued Fee                                         CLE009
     C           FEPYON    IFEQ 'E'                                       CLE009
      *                                                                   CLE009
     C                     MOVE 'N'       WAMDED                          CLE009
      *                                                                   CLE009
      ** The End Date has been Amended                                    CLE009
     C           WPEND     IFNE FEPEND                                    CLE009
     C                     MOVE 'Y'       WAMDED                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** The Amount has been Amended                                      CLE009
     C           WFAMT     IFNE FEFAMT                                    CLE009
     C                     MOVE 'Y'       WAMDED                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** The Confirm Indicator has been Amended                           CLE009
     C           SFEADV    IFNE *BLANKS                                   CLE009
     C           SFEADV    ANDNEFEAUTO                                    CLE009
     C           SFEADV    OREQ *BLANKS                                   CLE009
     C           'N'       ANDNEFEAUTO                                    CLE009
     C                     MOVE 'Y'       WAMDED                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** The Settlement Instructions have been Amended                    CLE009
     C                     MOVE FEROBN    WFROBN  6        Num -> Char    CLE009
     C                     MOVE FEROCN    WFROCN  6                       CLE009
     C                     MOVE FEPOBN    WFPOBN  6                       CLE009
     C                     MOVE FEPOCN    WFPOCN  6                       CLE009
      *                                                                                       CLE034
      ** If CLE034 is on and Settlement allocation is 'Y'                                     CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SFSTAL    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C                     MOVE 'Y'       WAMDED                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C           PMRSTM    IFNE FERSTM                                    CLE009
     C           PMRONS    ORNE FERONS                                    CLE009
     C           PMRIBN    ORNE FERIBN                                    CLE009
     C           PMRIBA    ORNE FERIBA                                    CLE009
     C           PMROBN    ORNE WFROBN                                    CLE009
     C           PMROCN    ORNE WFROCN                                    CLE009
     C           PMPSTM    ORNE FEPSTM                                    CLE009
     C           PMPONS    ORNE FEPONS                                    CLE009
     C           PMPIBN    ORNE FEPIBN                                    CLE009
     C           PMPIBA    ORNE FEPIBA                                    CLE009
     C           PMPOBN    ORNE WFPOBN                                    CLE009
     C           PMPOCN    ORNE WFPOCN                                    CLE009
     C           PMRCRN    ORNE FERCRN                                    CLE009
     C           PMRCRA    ORNE FERCRA                                    CLE009
     C           PMAWBN    ORNE FEAWBN                                    CLE009
     C           PMAWBA    ORNE FEAWBA                                    CLE009
     C           PMBENN    ORNE FEBENN                                    CLE009
     C           PMBENA    ORNE FEBENA                                    CLE009
     C           PMDTP1    ORNE FEDTP1                                    CLE009
     C           PMDTP2    ORNE FEDTP2                                    CLE009
     C           PMDTP3    ORNE FEDTP3                                    CLE009
     C           PMDTP4    ORNE FEDTP4                                    CLE009
     C           PMRVNO    ORNE FERVNO                                    CLE009
     C           PMDCHG    ORNE FEDCHG                                    CLE009
     C           PMBTB1    ORNE FEBTB1                                    CLE009
     C           PMBTB2    ORNE FEBTB2                                    CLE009
     C           PMBTB3    ORNE FEBTB3                                    CLE009
     C           PMBTB4    ORNE FEBTB4                                    CLE009
     C           PMBTB5    ORNE FEBTB5                                    CLE009
     C           PMBTB6    ORNE FEBTB6                                    CLE009
     C           PMCVMR    ORNE FECVMR                                    CLE009
     C           PMROBR    ORNE FEOSDB                                    CLE009
     C           PMPOBR    ORNE FEOMDB                                    CLE009
     C                     MOVE 'Y'       WAMDED                          CLE009
     C                     ELSE                                           CLE009
     C           CEU004    IFEQ 'Y'                                       CLE009
     C           WSCCY     IFNE FESCCY                                    CLE009
     C           PMIC72    ORNE FEICCY                                    CLE009
     C                     MOVE 'Y'       WAMDED                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                                              CLE034
      *                                                                   CLE009
     C           WAMDED    IFEQ 'Y'                                       CLE009
      *                                                                   CLE009
     C           FEPEND    IFGE BJRDNB                                    CLE009
     C           FEEPTI    IFEQ 'Y'                                       CLE009
     C           WPEND     ORLE TXDT                                      CLE009
     C           FEPEND    ORLE TXDT                                      CLE009
      *                                                                   CLE009
     C           CLE002    IFEQ 'N'                                       CLE009
     C           CLE002    OREQ 'Y'                                       CLE009
     C           BPFEAU    ANDEQ'N'                                       CLE009
     C                     MOVE 'A'       FESWRI                          CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'B'       FESWRI                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** The Fee is a calculated Fee (FECALT <> BLANK)                    CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** The Fee is a Confirmed Fee                                       CLE009
     C           FEAUTO    IFEQ 'Y'                                       CLE009
      *                                                                   CLE009
      ** The Payment Pay/Receive Telex Indicator is Yes and Payment on    CLE009
      ** is Next                                                          CLE009
     C           FEPPTI    IFEQ 'Y'                                       CLE009
     C           FEPYON    ANDEQ'N'                                       CLE009
      *                                                                   CLE009
      ** The next Payment Date has been Amended                           CLE009
     C           WNPYD     IFNE FENPYD                                    CLE009
      *                                                                   CLE009
     C           WNPYD     IFLE TXDT                                      CLE009
     C           FENPYD    ORLE TXDT                                      CLE009
      *                                                                   CLE009
     C           CLE002    IFEQ 'N'                                       CLE009
     C           CLE002    OREQ 'Y'                                       CLE009
     C           BPFEAU    ANDEQ'N'                                       CLE009
     C                     MOVE 'A'       FESWRI                          CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'B'       FESWRI                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      *                                                                   CLE009
      ** The Payment Pay/Receive Telex Indicator is blank and Payment     CLE009
      ** on is Next                                                       CLE009
     C           FEPPTI    IFEQ *BLANKS                                   CLE009
     C           FEPYON    ANDEQ'N'                                       CLE009
      *                                                                   CLE009
     C           WNPYD     IFLE TXDT                                      CLE009
     C           FENPYD    ORLE TXDT                                      CLE009
      *                                                                   CLE009
     C           CLE002    IFEQ 'N'                                       CLE009
     C           CLE002    OREQ 'Y'                                       CLE009
     C           BPFEAU    ANDEQ'N'                                       CLE009
     C                     MOVE 'G'       FESWRI                          CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'H'       FESWRI                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      *                                                                   CLE009
      ** The End Pay/Receive Telex Indicator is Yes and Payment on        CLE009
      ** is End.                                                          CLE009
     C           FEEPTI    IFEQ 'Y'                                       CLE009
     C           FEPYON    ANDEQ'E'                                       CLE009
      *                                                                   CLE009
      ** The End Date has been Amended                                    CLE009
     C           WPEND     IFNE FEPEND                                    CLE009
      *                                                                   CLE009
     C           WPEND     IFLE TXDT                                      CLE009
     C           FEPEND    ORLE TXDT                                      CLE009
      *                                                                   CLE009
     C           CLE002    IFEQ 'N'                                       CLE009
     C           CLE002    OREQ 'Y'                                       CLE009
     C           BPFEAU    ANDEQ'N'                                       CLE009
     C                     MOVE 'A'       FESWRI                          CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'B'       FESWRI                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** The End Pay/Receive Telex Indicator is Blank and Payment on      CLE009
      ** is End.                                                          CLE009
     C           FEEPTI    IFEQ *BLANKS                                   CLE009
     C           FEPYON    ANDEQ'E'                                       CLE009
      *                                                                   CLE009
      *                                                                   CLE009
     C           WPEND     IFLE TXDT                                      CLE009
     C           FEPEND    ORLE TXDT                                      CLE009
      *                                                                   CLE009
     C           CLE002    IFEQ 'N'                                       CLE009
     C           CLE002    OREQ 'Y'                                       CLE009
     C           BPFEAU    ANDEQ'N'                                       CLE009
     C                     MOVE 'G'       FESWRI                          CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'H'       FESWRI                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** The confirm Indicator has been amended                           CLE009
     C           SFEADV    IFNE *BLANK                                    CLE009
     C           SFEADV    ANDNEFEAUTO                                    CLE009
     C           SFEADV    OREQ *BLANK                                    CLE009
     C           'N'       ANDNEFEAUTO                                    CLE009
      *                                                                   CLE009
     C           FEPPTI    IFEQ 'Y'                                       CLE009
     C           FEPYON    ANDEQ'N'                                       CLE009
     C           WNPYD     ORLE TXDT                                      CLE009
     C           FEPYON    ANDEQ'N'                                       CLE009
     C           FENPYD    ORLE TXDT                                      CLE009
     C           FEPYON    ANDEQ'N'                                       CLE009
     C           FEEPTI    OREQ 'Y'                                       CLE009
     C           FEPYON    ANDEQ'E'                                       CLE009
     C           WPEND     ORLE TXDT                                      CLE009
     C           FEPYON    ANDEQ'E'                                       CLE009
     C           FEPEND    ORLE TXDT                                      CLE009
     C           FEPYON    ANDEQ'E'                                       CLE009
      *                                                                   CLE009
     C           CLE002    IFEQ 'N'                                       CLE009
     C           CLE002    OREQ 'Y'                                       CLE009
     C           BPFEAU    ANDEQ'N'                                       CLE009
     C                     MOVE 'A'       FESWRI                          CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'B'       FESWRI                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      *                                                                   CLE009
      ** Action Code is Authorise                                         CLE009
     C           SFLCHT    IFEQ 'X'                                       CLE009
      *                                                                   CLE009
     C           FESWRI    IFEQ 'I'                                       CLE009
     C                     MOVE *BLANK    FESWRI                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C           FESWRI    IFEQ 'B'                                       CLE009
     C                     MOVE 'A'       FESWRI                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C           FESWRI    IFEQ 'H'                                       CLE009
     C                     MOVE 'G'       FESWRI                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDSR                                          CLE009
      /EJECT                                                              CLE009
      *****************************************************************   CLE009
      *                                                                   CLE009
      *    SRTXDT - Set Telex Notice Date                                 CLE009
      *                                                                   CLE009
      *    CALLED BY: SRSWRI                                              CLE009
      *    CALLS    : ZFWDT -                                             CLE009
      ********************************************************************CLE009
      *                                                                   CLE009
     C           SRTXDT    BEGSR                                          CLE009
      *                                                                   CLE009
     C                     MOVE WCCY      ZCCY                            CLE009
     C                     Z-ADDBJRDNB    ZDAYNO                          CLE009
     C                     MOVE WCCY      WKCCY   3                       CLE031
      *                                                                                       CLE034
      ** If CLE034 is off or Settlement allocation is not 'Y'                                 CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'N'                                                           CLE034
     C           SFSTAL    ANDNE'Y'                                                           CLE034
      *                                                                   CLE031
     C           CLE031    IFEQ 'Y'                                       CLE031
      *                                                                   CLE031
     C           WPTFI     IFEQ 'P'                                       CLE031
     C           FEPSCY    IFNE *BLANKS                                   CLE031
     C                     MOVE FEPSCY    WKCCY                           CLE031
     C                     ENDIF                                          CLE031
     C                     ELSE                                           CLE031
     C           FESCCY    IFNE *BLANKS                                   CLE031
     C                     MOVE FESCCY    WKCCY                           CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     ENDIF                                          CLE031
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE WKCCY     ZCCY                            CLE031
     C                     MOVE WKCCY     KCCY                            CLE031
      *                                                                   CLE009
      ** Retrieve the Telex Notice Day for the currency.                  CLE009
     C********** WCCY      LOKUPCURR,Y                   75        CLE009 CLE031
     C           WKCCY     LOKUPCURR,Y                   75               CLE031
     C                     MOVE TXND,Y    ZNRDYS                          CLE009
      *                                                                   CLE009
      ** If CLE034 is off or Settlement allocation is not 'Y'                                 CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'N'                                                           CLE034
     C           SFSTAL    ANDNE'Y'                                                           CLE034
      *                                                                                       CLE034
      ** Method = Telex, Cheque to be sent, CHIPS, SWIFT, or Cheque to    CLE009
      **          Collected                                               CLE009
     C           FESTTL    IFEQ 1                                         CLE009
     C           FESTTL    OREQ 2                                         CLE009
     C           FESTTL    OREQ 7                                         CLE009
     C           FESTTL    OREQ 8                                         CLE009
     C           FESTTL    OREQ 12                                        CLE009
      *                                                                   CLE009
     C           WPTFI     IFEQ 'P'                                       CLE009
     C                     MOVELPMPONS    WOURST  2                       CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C           WPTFI     IFEQ *BLANKS                                   CLE009
     C                     MOVELPMRONS    WOURST                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C           WPTFI     IFNE 'I'                                       CLE009
      *                                                                   CLE009
     C                     MOVE WCCY      KCCY                            CLE009
     C                     MOVE WOURST    KNONB                           CLE009
     C                     MOVE *BLANKS   KCNUM                           CLE009
     C                     CALL 'AONOSTR0'PLIST1                          CLE009
      ** Call Nostro Details Access Object                                CLE009
     C           @RTCD     IFNE *BLANKS                                   CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVE *BLANKS   DBKEY                           CLE009
     C                     MOVELWOURST    DBKEY                           CLE009
     C                     MOVE WCCY      DBKEY            ************   CLE009
     C                     Z-ADD22        DBASE            * DBERR 22     CLE009
     C                     MOVEL'SDNOSTPD'DBFILE           ************   CLE009
     C                     MOVEL'LE2210'  DBPGM                           CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     MOVE A7NOSN    ZLOC                            CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
     C                     MOVE *BLANKS   ZLOC                            CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
     C                     MOVE *BLANKS   ZLOC                            CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANKS   ZLOC                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     EXSR ZFWDT                                     CLE009
      ** Calculate Number of days forward                                 CLE009
      *                                                                   CLE009
     C                     Z-ADDZDYNBR    TXDT    50                      CLE009
      ** Set Telex Notice Date                                            CLE009
      *                                                                   CLE009
     C                     ENDSR                                          CLE009
      *                                                                   CLE009
     C/TITLE SR/ZFWDT                                                     CLE009
     C/COPY ZSRSRC,ZFWDT                                                  CLE009
      * Calculate Working day Forward                                     CLE009
      *****************************************************************
      * SRTRAL  -  Update Loan Amendments Trailer File                *
      * Called by: SRWRIT, SRUPDT                                     *
      * Calls    : None                                               *
      *****************************************************************
     C           SRTRAL    BEGSR
      *
     C           1         SETLLLEFEEZ
     C                     READ LEFEEZ                   78
      *
     C           *IN78     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'LEFEEZ'  DBFILE           ************
     C                     MOVEL1         DBKEY            * DBERR 13 *
     C                     Z-ADD13        DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           SFLCHT    IFEQ 'I'
     C                     ADD  1         FENINT
     C                     ADD  1         FENORE
     C                     END
      *
     C           SFLCHT    IFEQ 'A'
     C                     ADD  1         FENAMD
     C                     END
      *
     C           SFLCHT    IFEQ 'D'
     C                     ADD  1         FENDEL
     C                     END
      *
     C                     UPDATLEFEEZF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRUSHD  -  Update Shadow Record                               *
      * Called by: SRWRIT, SRUPDT                                     *
      * Calls    : None                                               *
      *****************************************************************
     C           SRUSHD    BEGSR
      *
      ** Do On-line updates
      *
     C           SFLCHT    IFEQ 'I'
     C           SFLCHT    OREQ 'A'
     C           SFLCHT    OREQ 'D'
     C           WPTFI     IFNE 'I'
      *                                                                   134284
      *  Suppress rollback in batch mode                                  134284
      *                                                                   134284
     C           PMODE     IFEQ 'B'                                       134284
     C/COPY WNCPYSRC,LEH00535
     C                     MOVE '*LEBTCH' ##RTCD                          134284
     C                     ELSE                                           134284
     C                     MOVE *BLANKS   ##RTCD                          134284
     C                     ENDIF                                          134284
      *
     C                     CALL 'AOOUFEU0'
     C                     PARM           ##RTCD  7
     C                     PARM           Z#BSTS
     C                     PARM           Z#ASTS
     C                     PARM           Z#WSTS
      *
     C           ##RTCD    IFEQ '*ERROR*'
     C           ##RTCD    OREQ '*RECLCK'                                                   AR868380
     C           *LOCK     IN   LDA                                       155772
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INU7
     C                     MOVE *BLANK    WFMT
     C                     MOVEL'AOOUFEU0'DBFILE           ************   155772
     C                     Z-ADD20        DBASE            * DBERR 20 *   155772
     C                     MOVEL##RTCD    DBKEY            ************   155772
     C                     OUT  LDA                                       155772
     C                     EXSR *PSSR                                     155772
     C                     ENDIF
     C/COPY WNCPYSRC,LE2210C015
      *
     C                     ENDIF
     C                     ENDIF
      *
     C           ##RTCD    IFEQ *BLANK
     C                     MOVE 'F0'      WFMT
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRVALR  -  Validate Review Fields                             *
      * Called by: SRVALI                                             *
      * Calls    : SREROR - Error Processing                          *
      *****************************************************************
     C           SRVALR    BEGSR
      *
      ** Validate Review Customer
      *
     C           SRCUS     IFNE *BLANK
     C**********           MOVELSRCUS     NUM7    70                                          CSD027
     C**********           MOVELNUM7      WSRCUS  6                                           CSD027
     C                     MOVELSRCUS     WSRCUS  6                                           CSD027
     C           SRCUS     IFNE WSRCUS
     C                     MOVE '1'       *IN35
     C                     MOVEL'LER0171' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate Review Facility Reference
      *
     C           SRFCT     IFNE *BLANK
     C           SRFCN     ORNE *BLANK
     C           SRLON     IFNE *BLANK
     C                     MOVEA'11'      *IN,36
     C                     MOVEL'LER0186' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C           *IN36     IFEQ '0'
     C                     MOVELSRFCT     WFREF   5
     C                     MOVE SRFCN     WFREF
     C                     MOVELWFREF     NUM6    60
     C                     MOVELNUM6      WNFREF  5
     C           WFREF     IFNE WNFREF
     C                     MOVE '1'       *IN36
     C                     MOVEL'LER0008' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate Review Loan No.
      *
     C           SRLON     IFNE *BLANK
     C           *IN37     ANDEQ'0'
     C                     MOVELSRLON     NUM7    70
     C                     MOVELNUM7      WSRLON  6
     C           SRLON     IFNE WSRLON
     C                     MOVE '1'       *IN37
     C***********          MOVEL'1282850' ZAMSID                          139832
     C                     MOVEL'LER0010' ZAMSID                          139832
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate Sequence No.
      *
     C           SRSEQ     IFNE *BLANK
     C                     MOVELSRSEQ     NUM3    30
     C                     MOVELNUM3      WSRSEQ  2
     C           SRSEQ     IFNE WSRSEQ
     C                     MOVE '1'       *IN38
     C***********          MOVEL'1282854' ZAMSID                          139832
     C                     MOVEL'LER0014' ZAMSID                          139832
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate Requiring Authorisation field
      *
     C           SRAUT     IFNE *BLANK
     C           SRAUT     ANDNE'Y'
     C           SRAUT     ANDNE'N'
     C                     MOVE '1'       *IN39
     C                     MOVEL'LER0177' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C           SRAUT     IFEQ *BLANK
     C                     MOVE 'N'       SRAUT
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRWIND  -  Window Processing                                  *
      * Called by: SRDET1                                             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRWIND    BEGSR
      *
     C           BGWDPR    IFEQ 'Y'
      *
     C/COPY WNCPYSRC,LE2210MOV1
      *
     C                     MOVE SFLCHT    UACTCD
     C           SFLCHT    IFEQ 'X'
     C                     MOVE 'E'       UACTCD
     C                     ENDIF
      *
     C                     CALL 'WN0010'
     C                     PARM ##PGM     UPGM   10        Program
     C                     PARM *BLANK    UFKEY   2        Function Key
     C                     PARM           UACTCD  1        Action
     C                     PARM           DATA             Trans Data
     C                     PARM *BLANK    W0RTN   7        Return Code
     C                     PARM           SPARE 256        Spare Field
      *
     C                     SELEC
     C           W0RTN     WHEQ 'Y2U9999'
     C                     MOVE *BLANK    WFMT
      *
     C           W0RTN     WHEQ 'USR0563'
     C                     MOVEL'USR0563' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'D1'      WFMT
      *
     C           W0RTN     WHEQ 'Y2U0004'
     C                     MOVEL'USR0567' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'D1'      WFMT
      *
     C           W0RTN     WHEQ 'USR0790'
     C                     MOVE 'D1'      WFMT
     C                     ENDSL
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRAUTH  -  Validate authorisation action                      *
      * Called by: VALAMD, SRSVAL                                     *
      * Calls    : SREROR - Error Processing                          *
      *****************************************************************
     C           SRAUTH    BEGSR
      *
      ** If authorisation feature (CLE002) is not installed
      ** authorisation action is not allowed
      *
     C           CLE002    IFEQ 'N'
     C           WFMT      IFEQ 'F0'
     C                     MOVE '1'       *IN30
     C                     ELSE
     C                     MOVE '1'       *IN67
     C                     MOVE 'Y'       WSFER
     C                     ENDIF
     C                     MOVEL'LER0161' ZAMSID
     C                     EXSR SREROR
      *
      ** If authorisation feature is installed
      *
     C                     ELSE
      *
     C           BPFEAU    IFEQ 'N'
     C           WFMT      IFEQ 'F0'
     C                     MOVE '1'       *IN30
     C                     ELSE
     C                     MOVE '1'       *IN67
     C                     MOVE 'Y'       WSFER
     C                     ENDIF
     C                     MOVEL'LER0162' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
      *
      ** Authorising user must be different from the insert and
      ** amend users
      *
     C/COPY WNCPYSRC,LE2210C011
     C           USER      IFEQ FEIUSR
     C           USER      OREQ FEAUSR
     C           WFMT      IFEQ 'F0'
     C                     MOVE '1'       *IN30
     C                     ELSE
     C                     MOVE '1'       *IN67
     C                     MOVE 'Y'       WSFER
     C                     ENDIF
     C                     MOVEL'LER0163' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C/COPY WNCPYSRC,LE2210C012
      *
      ** Status of loan must be complete or requiring re-authori-
      ** sation
      *
     C           FEFSTS    IFNE 'C'
     C           FEFSTS    ANDNE'R'
     C           WFMT      IFEQ 'F0'
     C                     MOVE '1'       *IN30
     C                     ELSE
     C                     MOVE '1'       *IN67
     C                     MOVE 'Y'       WSFER
     C                     ENDIF
     C                     MOVEL'LER0182' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CSD015
      ** If Compliance Watch Enhancement (CSD015) is installed and Watch                      CSD015
      ** List Checking Applied...                                                             CSD015
      ** If 24x7 Midas Availability is not installed or it is installed and                   CSD015
      ** in the main system...                                                                CSD015
      ** Determine  if there is a pending case.                                               CSD015
      ** If there no pending case or case has been temporarily released,                      CSD015
      ** continue normal processing.  Otherwise send error message.                           CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           CSC011    OREQ 'Y'                                                           CSD015
     C           LIBR      ANDEQS1MAIN                                                        CSD015
     C                     MOVE *BLANKS   WFCNUM  6                                           CSD015
     C                     MOVE *BLANKS   WFFALN  6                                           CSD015
     C                     MOVE *BLANKS   WFFSEQ  2                                           CSD015
     C                     MOVE *BLANKS   K3FUNT                                              CSD015
     C                     MOVE *BLANKS   K3IDEN                                              CSD015
     C                     MOVE *BLANKS   K3BRCH                                              CSD015
     C                     MOVEL'LEFEED'  K3FUNT                                              CSD015
      *                                                                                       CSD015
     C           WFMT      IFEQ 'S0'                                                          CSD015
     C           SBFLIN    IFEQ 'F'                                                           CSD015
     C                     MOVELSBCNUM    WFCNUM                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELSBFALO    WFFALN                                              CSD015
     C                     MOVELSBFSEQ    WFFSEQ                                              CSD015
     C                     ELSE                                                               CSD015
     C           SFLNRF    IFEQ *BLANKS                                                       CSD015
     C                     MOVE SFCNUM    WFCNUM                                              CSD015
     C           SFFACT    CAT  SFFCNO:0  WFFALN                                              CSD015
     C                     MOVELSFFSEQ    WFFSEQ                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE SFLNRF    WFFALN                                              CSD015
     C                     MOVELSFFSEQ    WFFSEQ                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     CAT  WFCNUM:0  K3IDEN                                              CSD015
     C                     CAT  WFFALN:0  K3IDEN                                              CSD015
     C                     CAT  WFFSEQ:0  K3IDEN                                              CSD015
      *                                                                                       CSD015
     C           WFMT      IFEQ 'S0'                                                          CSD015
     C                     MOVELSBBRCA    K3BRCH                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELFEBRCA    K3BRCH                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           KCWHT     CHAINSDCWHTL1             78                                       CSD015
      *                                                                                       CSD015
     C           *IN78     IFEQ *OFF                                                          CSD015
     C           W3TREL    ANDNE'Y'                                                           CSD015
     C           WFMT      IFEQ 'F0'                                                          CSD015
     C                     MOVE *ON       *IN30                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE '1'       *IN67                                               CSD015
     C                     MOVE 'Y'       WSFER                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVEL'LEL0564' ZAMSID                                              CSD015
     C                     EXSR SREROR                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF
     C/COPY WNCPYSRC,LE2210C018
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * TRSFS   -  Format record fields for screen display            *
      * Called by: VALAMD, VALDEL, VALENQ, SRSSET                     *
      * Calls    : None                                               *
      *****************************************************************
     C           TRSFS     BEGSR
      *
      ** Translate record details from file layout to screen layout
      *
     C********** FELOAN    IFEQ 0                                                             CLE148
     C           FELOAN    IFEQ *BLANKS                                                       CLE148
     C                     MOVE *BLANKS   SFLNRF
     C                     ELSE
     C                     MOVE FELOAN    SFLNRF
     C                     ENDIF
     C           FEFACL    IFEQ 0
     C                     MOVE *BLANKS   SFFACT
     C                     MOVE *BLANKS   SFFCNO
     C                     ELSE
     C                     MOVELFEFACL    SFFACT
     C                     MOVE FEFACL    SFFCNO
     C                     ENDIF
     C                     MOVE FEFSEQ    SFFSEQ
     C                     MOVE FEFCOD    SFECOD
     C                     MOVE FEFCCY    SFECUR
     C                     MOVE FEFCCY    WCCY
     C                     MOVE *BLANKS   SFESGN
      ** setup decimal places for ccy
     C                     CALL 'AOCURRR0'
     C                     PARM '*DBERR ' PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM FEFCCY    K101    3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           FEFAMT    IFEQ 0
     C                     MOVE *BLANKS   SFEAMT
     C                     ELSE
     C                     Z-ADDFEFAMT    ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    @WAMT  17
     C                     MOVEL@WAMT     SFEAMT
     C                     ENDIF
      *
     C           FEFAMT    IFLT 0
     C                     MOVE '-'       SFESGN
     C                     ELSE
     C                     MOVE ' '       SFESGN
     C                     ENDIF
      *
     C                     Z-ADDFEPSTD    ZDAYNO
     C                     EXSR ZDATE2
     C                     Z-ADDZDATE     DDMMYY
     C                     MOVE DDMMYY    SFEPSD
      *
     C                     Z-ADDFEPEND    ZDAYNO
     C                     EXSR ZDATE2
     C                     Z-ADDZDATE     DDMMYY
     C           DDMMYY    IFEQ 0
     C                     MOVE *BLANKS   SFEPED
     C                     ELSE
     C                     MOVE DDMMYY    SFEPED
     C                     ENDIF
      *
     C                     MOVE FEPYON    SFEPON
     C                     MOVE FEAUTO    SFEADV
     C                     MOVE FECALT    SFCALT
     C           FEFRT1    IFEQ 0
     C           FEFRT2    ANDEQ0
     C                     MOVE *BLANKS   SFRTE1
     C                     ELSE
     C           FEFRT1    MULT 100000    ZFLD15
     C                     Z-ADD5         ZDECS
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    WWA10  10
     C                     MOVELWWA10     SFRTE1
     C                     ENDIF
      *
     C           FEFRT2    IFEQ 0
     C                     MOVE *BLANKS   SFRTE2
     C                     ELSE
     C           FEFRT2    MULT 100000    ZFLD15
     C                     Z-ADD5         ZDECS
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    WWA10
     C                     MOVELWWA10     SFRTE2
     C                     ENDIF
     C           FEFRT3    IFNE 0
     C           FEFRT3    MULT 100000    ZFLD15
     C                     Z-ADD5         ZDECS
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    WWA10
     C                     MOVELWWA10     SFRTE3
     C                     ELSE
     C                     MOVE *BLANKS   SFRTE3
     C                     ENDIF
     C           FEFRT4    IFNE 0
     C           FEFRT4    MULT 100000    ZFLD15
     C                     Z-ADD5         ZDECS
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    WWA10
     C                     MOVELWWA10     SFRTE4
     C                     ELSE
     C                     MOVE *BLANKS   SFRTE4
     C                     ENDIF
     C           FEFRT5    IFNE 0
     C           FEFRT5    MULT 100000    ZFLD15
     C                     Z-ADD5         ZDECS
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    WWA10
     C                     MOVELWWA10     SFRTE5
     C                     ELSE
     C                     MOVE *BLANKS   SFRTE5
     C                     ENDIF
     C           FEAMT1    IFEQ 0
     C                     MOVE *BLANKS   SFAMT1
     C                     MOVE *BLANKS   SFAMT2
     C                     MOVE *BLANKS   SFAMT3
     C                     MOVE *BLANKS   SFAMT4
     C                     MOVE *BLANKS   SFAMT5
     C                     ELSE
     C           FEPIND    IFEQ 'A'
     C                     Z-ADD0         ZDECS
     C                     ENDIF
     C           FEPIND    IFEQ 'P'
     C                     Z-ADD3         ZDECS
     C                     ENDIF
     C                     Z-ADDFEAMT1    ZFLD15
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    WWA13  13
     C                     MOVELWWA13     SFAMT1
      *
     C           FEAMT2    IFNE 0
     C                     Z-ADDFEAMT2    ZFLD15
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    WWA13
     C                     MOVELWWA13     SFAMT2
     C                     ELSE
     C                     MOVE *BLANKS   SFAMT2
     C                     ENDIF
      *
     C           FEAMT3    IFNE 0
     C                     Z-ADDFEAMT3    ZFLD15
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    WWA13
     C                     MOVELWWA13     SFAMT3
     C                     ELSE
     C                     MOVE *BLANKS   SFAMT3
     C                     ENDIF
      *
     C           FEAMT4    IFNE 0
     C                     Z-ADDFEAMT4    ZFLD15
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    WWA13
     C                     MOVELWWA13     SFAMT4
     C                     ELSE
     C                     MOVE *BLANKS   SFAMT4
     C                     ENDIF
      *
     C           FEAMT5    IFNE 0
     C                     Z-ADDFEAMT5    ZFLD15
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    WWA13
     C                     MOVELWWA13     SFAMT5
     C                     ELSE
     C                     MOVE *BLANKS   SFAMT5
     C                     ENDIF
     C                     ENDIF
      *
     C           FECALC    IFEQ 0
     C                     MOVE *BLANKS   SFCALC
     C                     ELSE
     C                     MOVE FECALC    SFCALC
     C                     ENDIF
     C           FEERAT    IFEQ 0
     C                     MOVE *BLANKS   SFEXRT
     C                     ELSE
     C           FEERAT    MULT 100000000 ZFLD15
     C                     Z-ADD8         ZDECS
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    @WAMT
     C***********          MOVEL@WAMT     SFEXRT                          152169
     C                     MOVE @WAMT     SFEXRT                          152169
     C                     ENDIF
      *
     C                     MOVE FEMDIN    SFMDIN
      *
     C           FENPYD    IFEQ 0
     C                     MOVE *BLANKS   SFNPYD
     C                     ELSE
     C                     Z-ADDFENPYD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    GADATE  7
     C                     Z-ADDZDATE     DDMMYY
     C                     MOVE DDMMYY    SFNPYD
     C                     ENDIF
     C           FEDYIM    IFEQ 0
     C                     MOVE *BLANKS   SFDYIM
     C                     ELSE
     C                     MOVE FEDYIM    SFDYIM
     C                     ENDIF
     C                     MOVE FEFREQ    SFFREQ
     C                     MOVE FEPIND    WPIND
     C                     MOVE FESHFI    SFESHR
     C                     MOVE FEPRFC    SPRFC
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVELFESTAL    SFSTAL                                              CLE034
     C                     ENDIF                                                              CLE034
      *
      * If SFESHR (Shared fee indicator) is blank, default to 'N'.        192756
     C           SFESHR    IFEQ *BLANKS                                   192756
     C                     MOVE 'N'       SFESHR                          192756
     C                     ENDIF                                          192756
      *
     C           FECALT    IFEQ '03'
     C           FECALT    OREQ '06'
     C           FECALT    OREQ '13'
     C           FECALT    OREQ '16'
     C           FECALT    OREQ '21'
     C           FECALT    OREQ '22'
     C                     MOVE *BLANKS   SFPIND
     C                     ELSE
     C                     MOVE FEPIND    SFPIND
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************   CAP064
      *  SSINV - To move fields from invalid file to screen           *   CAP064
      *  Called by: TRSFS                                             *   CAP064
      *  Calls    : None                                              *   CAP064
      *****************************************************************   CAP064
     C           SSINV     BEGSR                                          CAP064
      *                                                                   CAP064
     C           XREPN     CHAINLEIFEEP2             99                   CAP064
      *                                                                   CAP064
     C                     MOVELILCHT     SFLCHT                          CAP064
     C                     MOVELICNUM     SFCNUM                          CAP064
     C                     MOVELIFACT     SFFACT                          CAP064
     C                     MOVELIFCNO     SFFCNO                          CAP064
     C                     MOVELILNRF     SFLNRF                          CAP064
     C                     MOVELIFSEQ     SFFSEQ                          CAP064
     C                     MOVELIECOD     SFECOD                          CAP064
     C                     MOVELIECUR     SFECUR                          CAP064
     C                     MOVELIEAMT     SFEAMT                          CAP064
     C                     MOVELIESGN     SFESGN                          CAP064
     C                     MOVELIEPSD     SFEPSD                          CAP064
     C                     MOVELIEPED     SFEPED                          CAP064
     C                     MOVELIEPON     SFEPON                          CAP064
     C                     MOVELIEADV     SFEADV                          CAP064
     C                     MOVELIESHR     SFESHR                          CAP064
     C                     MOVELICALT     SFCALT                          CAP064
     C                     MOVELIRTE1     SFRTE1                          CAP064
     C                     MOVELIAMT1     SFAMT1                          CAP064
     C                     MOVELIRTE2     SFRTE2                          CAP064
     C                     MOVELIAMT2     SFAMT2                          CAP064
     C                     MOVELIRTE3     SFRTE3                          CAP064
     C                     MOVELIAMT3     SFAMT3                          CAP064
     C                     MOVELIRTE4     SFRTE4                          CAP064
     C                     MOVELIAMT4     SFAMT4                          CAP064
     C                     MOVELIRTE5     SFRTE5                          CAP064
     C                     MOVELIAMT5     SFAMT5                          CAP064
     C                     MOVELIPIND     SFPIND                          CAP064
     C                     MOVELICALC     SFCALC                          CAP064
     C                     MOVELIEXRT     SFEXRT                          CAP064
     C                     MOVELIMDIN     SFMDIN                          CAP064
     C                     MOVELINPYD     SFNPYD                          CAP064
     C                     MOVELIFREQ     SFFREQ                          CAP064
     C                     MOVELIDYIM     SFDYIM                          CAP064
     C                     MOVELIPRFC     SPRFC                           CAP064
     C                     MOVELIRSTM     SFRSTM                          CAP064
     C                     MOVELIRONS     SFRONS                          CAP064
     C                     MOVELIROBN     SFROBN                          CAP064
     C                     MOVELIROCN     SFROCN                          CAP064
     C                     MOVELIRIBN     SFRIBN                          CAP064
     C                     MOVELIRIBA     SFRIBA                          CAP064
     C                     MOVELIPSTM     SFPSTM                          CAP064
     C                     MOVELIPONS     SFPONS                          CAP064
     C                     MOVELIPOBN     SFPOBN                          CAP064
     C                     MOVELIPOCN     SFPOCN                          CAP064
     C                     MOVELIPIBN     SFPIBN                          CAP064
     C                     MOVELIPIBA     SFPIBA                          CAP064
     C                     MOVELIRCRN     SFRCRN                          CAP064
     C                     MOVELIRCRA     SFRCRA                          CAP064
     C                     MOVELIRVNO     SFRVNO                          CAP064
     C                     MOVELIAWBN     SFAWBN                          CAP064
     C                     MOVELIAWBA     SFAWBA                          CAP064
     C                     MOVELIBENN     SFBENN                          CAP064
     C                     MOVELIBENA     SFBENA                          CAP064
     C                     MOVELIDTP1     SFDTP1                          CAP064
     C                     MOVELIDTP2     SFDTP2                          CAP064
     C                     MOVELIDTP3     SFDTP3                          CAP064
     C                     MOVELIDTP4     SFDTP4                          CAP064
     C                     MOVELIDCHG     SFDCHG                          CAP064
     C                     MOVELIBTB1     SFBTB1                          CAP064
     C                     MOVELIBTB2     SFBTB2                          CAP064
     C                     MOVELIBTB3     SFBTB3                          CAP064
     C                     MOVELIBTB4     SFBTB4                          CAP064
     C                     MOVELIBTB5     SFBTB5                          CAP064
     C                     MOVELIBTB6     SFBTB6                          CAP064
     C                     MOVELICVMR     SFCVMR                          CAP064
     C                     MOVELIICCY     SFICCY                          CAP064
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE ISCCY     SFSCCY                                              CLE031
     C                     MOVE IREXR     SFREXR                                              CLE031
     C                     MOVE IREXI     SFREXI                                              CLE031
     C                     MOVE IPSCY     SFPSCY                                              CLE031
     C                     MOVE IPEXR     SFPEXR                                              CLE031
     C                     MOVE IPEXI     SFPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVELISTAL     SFSTAL                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   CAP064
     C                     ENDSR                                          CAP064
      /EJECT                                                              CAP064
      *****************************************************************
      *  TRSSTF - To convert screen fields to file                    *
      *  Called by: SRWRIT, SRUPDT                                    *
      *  Calls    : None                                              *
      *****************************************************************
     C           TRSSTF    BEGSR
      *
     C                     Z-ADDWPEND     FEPEND
      *
     C           *IN84     IFEQ '0'
     C           *IN77     IFEQ '0'
     C                     Z-ADDWFAMT     FEFAMT
     C                     ENDIF
     C                     ENDIF
      *
     C           WPTFI     IFEQ 'P'
     C                     MOVE PMPSTM    FESTTL
     C                     MOVELPMPONS    FEOURS
     C                     MOVELPAPIBN    FETHER
     C                     MOVE PMPOBR    FEOSBR                          133789
     C                     MOVE PMPOBR    FEOMDB                          133789
     C***********          MOVE PMBRCA    FEOSBR                          133789
     C***********          MOVE PMBRCA    FEOMDB                          133789
     C                     ENDIF
      *
     C           WPTFI     IFEQ *BLANK
     C                     MOVE PMRSTM    FESTTL
     C                     MOVELPMRONS    FEOURS
     C                     MOVELPARIBN    FETHER
     C                     MOVE PMROBR    FEOSBR                          133789
     C                     MOVE PMROBR    FEOSDB                          133789
     C***********          MOVE PMBRCA    FEOSBR                          133789
     C***********          MOVE PMBRCA    FEOSDB                          133789
     C                     ENDIF
      *
     C           *IN85     IFEQ '1'
     C           *IN84     OREQ '1'
     C                     ELSE
     C                     MOVE SFECOD    FEFCOD
     C                     MOVE WCCY      FEFCCY
     C                     Z-ADDWPSTD     FEPSTD
     C                     MOVE SFEPON    FEPYON
     C                     ENDIF
      *
     C                     MOVE FEAUTO    WFEAUT  1                                           223922
     C           SFEADV    IFEQ *BLANKS
     C                     MOVE 'N'       FEAUTO
     C                     ELSE
     C                     MOVE SFEADV    FEAUTO
     C                     ENDIF
      *
     C                     MOVE SFCALT    FECALT
     C                     Z-ADDWFRT1     FEFRT1
     C                     Z-ADDWFRT2     FEFRT2
     C                     Z-ADDWFRT3     FEFRT3
     C                     Z-ADDWFRT4     FEFRT4
     C                     Z-ADDWFRT5     FEFRT5
     C                     Z-ADDWCAMT1    FEAMT1
     C                     Z-ADDWCAMT2    FEAMT2
     C                     Z-ADDWCAMT3    FEAMT3
     C                     Z-ADDWCAMT4    FEAMT4
     C                     Z-ADDWCAMT5    FEAMT5
     C                     Z-ADDWCALC     FECALC
     C           *IN77     IFEQ '0'
     C                     Z-ADDWERAT     FEERAT
     C                     MOVE WMDIN     FEMDIN
     C                     ENDIF
     C                     Z-ADDWNPYD     FENPYD
     C                     MOVE WFREQ     FEFREQ
     C                     Z-ADDWDYIM     FEDYIM
     C                     MOVE WPIND     FEPIND
     C                     MOVE SFESHR    FESHFI
     C                     MOVE SPRFC     FEPRFC
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVELSFSTAL    FESTAL                                              CLE034
     C                     ENDIF                                                              CLE034
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *  SRSAVT - Save screen fields to Test Harness File LE2210PD    *
      *  Called by: SRWRIT, SRUPDT                                    *
      *  Calls    : None                                              *
      *****************************************************************
     C           SRSAVT    BEGSR
      *
     C                     MOVE FEBRCA    THBRCA
     C                     MOVE SFCNUM    THCNUM
     C                     MOVELSFFACT    THFACL
     C                     MOVE SFFCNO    THFACL
     C                     MOVE SFLNRF    THLOAN
     C                     MOVE SFFSEQ    THFSEQ
     C                     MOVE SFECOD    THFCOD
     C                     MOVE SFECUR    THFCCY
     C                     MOVE SFEAMT    THFAMT
     C                     MOVE SFESGN    THFSGN
     C                     MOVE SFEPSD    THPSTD
     C                     MOVE SFEPED    THPEND
     C                     MOVE SFEPON    THPYON
     C                     MOVE SFEADV    THAUTO
     C                     MOVE SFCALT    THCALT
     C                     MOVE SFRTE1    THFRT1
     C                     MOVE SFRTE2    THFRT2
     C                     MOVE SFRTE3    THFRT3
     C                     MOVE SFRTE4    THFRT4
     C                     MOVE SFRTE5    THFRT5
     C                     MOVE SFAMT1    THAMT1
     C                     MOVE SFAMT2    THAMT2
     C                     MOVE SFAMT3    THAMT3
     C                     MOVE SFAMT4    THAMT4
     C                     MOVE SFAMT5    THAMT5
     C                     MOVE SFCALC    THCALC
     C                     MOVE SFEXRT    THERAT
     C                     MOVE SFMDIN    THMDIN
     C                     MOVE SFNPYD    THNPYD
     C                     MOVE SFFREQ    THFREQ
     C                     MOVE SFDYIM    THDYIM
     C                     MOVE SPRFC     THPRFC
     C                     MOVE SFPIND    THPIND
     C                     MOVE FEFSTS    THFSTS
     C                     MOVE FEIUSR    THIUSR
     C                     MOVE FEAUSR    THAUSR
     C                     MOVE FEXUSR    THXUSR
     C                     MOVE FESHFI    THSHFI
     C                     MOVE FEOSDB    THOSDB
     C                     MOVE FEOMDB    THOMDB
     C                     MOVE FERSTM    THRSTM
     C                     MOVE FERONS    THRONS
     C                     MOVE FERIBN    THRIBN
     C                     MOVE FERIBA    THRIBA
     C********** FEROBN    IFNE *ZERO                                                         CSD027
     C           FEROBN    IFNE *BLANKS                                                       CSD027
     C                     MOVE FEROBN    THROBN
     C                     ELSE
     C                     MOVE *BLANK    THROBN
     C                     ENDIF
     C********** FEROCN    IFNE *ZERO                                                         CSD027
     C           FEROCN    IFNE *BLANKS                                                       CSD027
     C                     MOVE FEROCN    THROCN
     C                     ELSE
     C                     MOVE *BLANK    THROCN
     C                     ENDIF
     C                     MOVE FEPSTM    THPSTM
     C                     MOVE FEPONS    THPONS
     C                     MOVE FEPIBN    THPIBN
     C                     MOVE FEPIBA    THPIBA
     C********** FEPOBN    IFNE *ZERO                                                         CSD027
     C           FEPOBN    IFNE *BLANKS                                                       CSD027
     C                     MOVE FEPOBN    THPOBN
     C                     ELSE
     C                     MOVE *BLANK    THPOBN
     C                     ENDIF
     C********** FEPOCN    IFNE *ZERO                                                         CSD027
     C           FEPOCN    IFNE *BLANKS                                                       CSD027
     C                     MOVE FEPOCN    THPOCN
     C                     ELSE
     C                     MOVE *BLANK    THPOCN
     C                     ENDIF
     C                     MOVE FERCRN    THRCRN
     C                     MOVE FERCRA    THRCRA
     C                     MOVE FERVNO    THRVNO
     C                     MOVE FEAWBN    THAWBN
     C                     MOVE FEAWBA    THAWBA
     C                     MOVE FEBENN    THBENN
     C                     MOVE FEBENA    THBENA
     C                     MOVE FEDTP1    THDTP1
     C                     MOVE FEDTP2    THDTP2
     C                     MOVE FEDTP3    THDTP3
     C                     MOVE FEDTP4    THDTP4
     C                     MOVE FEDCHG    THDCHG
     C                     MOVE FEBTB1    THBTB1
     C                     MOVE FEBTB2    THBTB2
     C                     MOVE FEBTB3    THBTB3
     C                     MOVE FEBTB4    THBTB4
     C                     MOVE FEBTB5    THBTB5
     C                     MOVE FEBTB6    THBTB6
     C                     MOVE FECVMR    THCVMR
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE FESCCY    THSCCY                          CEU004
     C                     MOVE FEICCY    THICCY                          CEU004
     C                     ENDIF                                          CEU004
      *
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVELFESTAL    STAL                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR
      /EJECT
      *****************************************************************
      *  SRRTVT - Retrieve Test Harness LE2210PD fields to screen flds*
      *  Called by: SRBTCH                                            *
      *  Calls    : SREROR - Error Processing                         *
      *****************************************************************
     C           SRRTVT    BEGSR
      *
     C                     MOVE ACTN      SFLCHT
     C                     MOVE THCNUM    SFCNUM
     C                     MOVELTHFACL    SFFACT
     C                     MOVE THFACL    SFFCNO
     C                     MOVE THLOAN    SFLNRF
     C                     MOVE THFSEQ    SFFSEQ
     C                     MOVE THFCOD    SFECOD
     C                     MOVE THFCCY    SFECUR
     C                     MOVE THFAMT    SFEAMT
     C                     MOVE THFSGN    SFESGN
     C                     MOVE THPSTD    SFEPSD
     C                     MOVE THPEND    SFEPED
     C                     MOVE THPYON    SFEPON
     C                     MOVE THAUTO    SFEADV
     C                     MOVE THCALT    SFCALT
     C                     MOVE THFRT1    SFRTE1
     C                     MOVE THFRT2    SFRTE2
     C                     MOVE THFRT3    SFRTE3
     C                     MOVE THFRT4    SFRTE4
     C                     MOVE THFRT5    SFRTE5
     C                     MOVE THAMT1    SFAMT1
     C                     MOVE THAMT2    SFAMT2
     C                     MOVE THAMT3    SFAMT3
     C                     MOVE THAMT4    SFAMT4
     C                     MOVE THAMT5    SFAMT5
     C                     MOVE THCALC    SFCALC
     C                     MOVE THERAT    SFEXRT
     C                     MOVE THMDIN    SFMDIN
     C                     MOVE THNPYD    SFNPYD
     C                     MOVE THFREQ    SFFREQ
     C                     MOVE THDYIM    SFDYIM
     C                     MOVE THPIND    SFPIND
     C                     MOVE THSHFI    SFESHR
     C                     MOVE THPRFC    SPRFC
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVELSTAL      SFSTAL                                              CLE034
     C                     ENDIF                                                              CLE034
      *
     C                     MOVELTHRSTM    PMRSTM
     C                     MOVELTHRONS    PMRONS
     C                     MOVELTHRIBN    PMRIBN
     C                     MOVELTHRIBN    PARIBN
     C                     MOVELTHRIBA    PMRIBA
     C                     MOVELTHROBN    PMROBN
     C                     MOVELTHROBN    PAROBN
     C                     MOVELTHROCN    PMROCN
     C                     MOVELTHROCN    PAROCN
     C                     MOVELTHPSTM    PMPSTM
     C                     MOVELTHPONS    PMPONS
     C                     MOVELTHPIBN    PMPIBN
     C                     MOVELTHPIBN    PAPIBN
     C                     MOVELTHPIBA    PMPIBA
     C                     MOVELTHPOBN    PMPOBN
     C                     MOVELTHPOBN    PAPOBN
     C                     MOVELTHPOCN    PMPOCN
     C                     MOVELTHPOCN    PAPOCN
     C                     MOVELTHRCRN    PMRCRN
     C                     MOVELTHRCRN    PARCRN
     C                     MOVELTHRCRA    PMRCRA
     C                     MOVELTHRVNO    PMRVNO
     C                     MOVELTHRVNO    PARVNO
     C                     MOVELTHAWBN    PMAWBN
     C                     MOVELTHAWBN    PAAWBN
     C                     MOVELTHAWBA    PMAWBA
     C                     MOVELTHBENN    PMBENN
     C                     MOVELTHBENN    PABENN
     C                     MOVELTHBENA    PMBENA
     C                     MOVELTHDTP1    PMDTP1
     C                     MOVELTHDTP2    PMDTP2
     C                     MOVELTHDTP3    PMDTP3
     C                     MOVELTHDTP4    PMDTP4
     C                     MOVELTHDCHG    PMDCHG
     C                     MOVELTHBTB1    PMBTB1
     C                     MOVELTHBTB2    PMBTB2
     C                     MOVELTHBTB3    PMBTB3
     C                     MOVELTHBTB4    PMBTB4
     C                     MOVELTHBTB5    PMBTB5
     C                     MOVELTHBTB6    PMBTB6
     C                     MOVELTHCVMR    PMCVMR
     C                     MOVELTHOSDB    PMROBR
     C                     MOVELTHOMDB    PMPOBR
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE THSCCY    PMRSCY                          CEU004
     C                     MOVE THSCCY    PMPSCY                          CEU004
     C                     MOVE THSCCY    WSCCY                           CEU004
     C                     MOVE THICCY    PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE THSCCY    PMRSCY                                              CLE031
     C                     MOVE THREXR    PMREXR                                              CLE031
     C                     MOVE THREXI    PMREXI                                              CLE031
     C                     MOVE THPSCY    PMPSCY                                              CLE031
     C                     MOVE THPEXR    PMPEXR                                              CLE031
     C                     MOVE THPEXI    PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *
     C                     MOVE ACTN      PMACTC
     C***********          MOVE 'MMLD'    PMCPGM                          135152
     C                     MOVE 'LEND'    PMCPGM                          135152
     C                     MOVE *BLANK    PMCMDP
     C                     Z-ADD0         PMDBSE
     C                     MOVE *BLANKS   PMERCD
     C                     MOVE 'Y'       PMFRST
     C                     Z-ADDBJRDNB    PMRUND
     C                     Z-ADDBJBVPD    PMBVPD
      *
     C           SFLNRF    IFNE *BLANKS
     C                     MOVE 'F1'      PMTTYP
     C                     ELSE
     C                     MOVE 'F2'      PMTTYP
     C                     ENDIF
     C**********           MOVELSFCNUM    PMCSNM                                              193450
     C                     MOVE SFCNUM    WPMCNM  6                                           193450
     C                     MOVELWPMCNM    PMCSNM                                              193450
     C                     MOVELTHBRCA    PMBRCA
     C                     MOVE '0'       *IN99
     C                     MOVE THPSTD    ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     MOVEL'LER0022' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     Z-ADDZDAYNO    WPSTD   50
     C                     ENDIF
     C                     MOVE WPSTD     PMDTRC
     C                     MOVE WPSTD     PMDTPY
     C                     MOVE SFECUR    PMRCCY
     C                     MOVE SFECUR    PMPCCY
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *  SRBDET - Retrieve Batch Processing Details                   *
      *  Called by: SRBTCH                                            *
      *  Calls    : SREROR - Error Processing                         *
      *****************************************************************
     C           SRBDET    BEGSR
      *
     C                     MOVE PITACT    SFLCHT
     C                     MOVE PICNUM    SFCNUM
     C                     MOVELPIFACT    SFFACT
     C                     MOVE PIFCNO    SFFCNO
     C                     MOVE PILNRF    SFLNRF
     C                     MOVE PIFSEQ    SFFSEQ
     C********** WLOAN     IFNE 0                                                      207629 CLE148
     C           WLOAN     IFNE *BLANKS                                                       CLE148
     C           PPCUST    ANDEQ'O'                                                           207629
     C           KEY004    CHAINCLOAN                74                                       207629
     C           *IN74     IFEQ '0'                                                           207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C**********           MOVE WCNUM     OCNUM   60                                   207629 CSD027
     C                     MOVE WCNUM     OCNUM   6                                           CSD027
     C                     MOVE CNUM      WCNUM                                               207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     MOVE PIFCOD    SFECOD
     C                     MOVE PIFCUR    SFECUR
     C                     MOVE PIFCUR    WCCY
     C                     MOVE PIFAMT    SFEAMT
     C                     MOVE PIFSGN    SFESGN
     C                     MOVE PIFPSD    WPITDS
     C                     MOVELWPIDD     WFLD4   4
     C                     MOVE WPIMM     WFLD4
     C                     MOVELWFLD4     WFLD6   6
     C                     MOVE WPIYY     WFLD6
     C                     MOVELWFLD6     SFEPSD
     C           PIFPED    IFNE *BLANK
     C                     MOVE PIFPED    WPITDS
     C                     MOVELWPIDD     WFLD4   4
     C                     MOVE WPIMM     WFLD4
     C                     MOVELWFLD4     WFLD6   6
     C                     MOVE WPIYY     WFLD6
     C                     MOVELWFLD6     SFEPED
     C                     ENDIF
     C                     MOVE PIFPON    SFEPON
     C                     MOVE PIFADV    SFEADV
     C                     MOVE PICALT    SFCALT
     C                     MOVE PIRTE1    SFRTE1
     C                     MOVE PIRTE2    SFRTE2
     C                     MOVE PIRTE3    SFRTE3
     C                     MOVE PIRTE4    SFRTE4
     C                     MOVE PIRTE5    SFRTE5
     C                     MOVELPIAMT1    SFAMT1
     C                     MOVELPIAMT2    SFAMT2
     C                     MOVELPIAMT3    SFAMT3
     C                     MOVELPIAMT4    SFAMT4
     C                     MOVELPIAMT5    SFAMT5
     C                     MOVE PICALC    SFCALC
     C                     MOVE PIEXRT    SFEXRT
     C                     MOVE PIMDIN    SFMDIN
     C                     MOVE PINPYD    WPITDS
     C                     MOVELWPIDD     WFLD4   4
     C                     MOVE WPIMM     WFLD4
     C                     MOVELWFLD4     WFLD6   6
     C                     MOVE WPIYY     WFLD6
     C                     MOVELWFLD6     SFNPYD
     C                     MOVE PIFREQ    SFFREQ
     C                     MOVE PIDYIM    SFDYIM
     C***********          MOVE PIPIND    SFPIND                    134972
      *                                                             134972
     C           PICALT    IFEQ '03'                                134972
     C           PICALT    OREQ '06'                                134972
     C           PICALT    OREQ '13'                                134972
     C           PICALT    OREQ '16'                                134972
     C           PICALT    OREQ '21'                                134972
     C           PICALT    OREQ '22'                                134972
     C                     MOVE *BLANKS   SFPIND                    134972
     C                     ELSE                                     134972
     C                     MOVE PIPIND    SFPIND                    134972
     C                     ENDIF                                    134972
      *                                                             134972
     C                     MOVE PISHRF    SFESHR
     C                     MOVE PIPRFC    SPRFC
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVELPISTAL    SFSTAL                                              CLE034
     C                     ENDIF                                                              CLE034
      *
     C                     MOVELPIRSTM    PMRSTM
     C***********          MOVELPIRONS    PMRONS                          135748
     C***********          MOVE PIRONS    PMRONS                    135748CAP064
     C***********          MOVELPIRONS    PMRONS                    CAP064202403
     C**********           MOVE PIRONS    WKRONS 12                                    202403 257053
     C                     MOVE PIRONS    WKRONS 18                                           257053
     C                     MOVE WKRONS    PMRONS                          202403
     C                     MOVELPIRIBN    PMRIBN
     C                     MOVELPIRIBN    PARIBN
     C                     MOVELPIRIBA    PMRIBA
     C                     MOVELPIROBN    PMROBN
     C                     MOVELPIROBN    PAROBN
     C                     MOVELPIROCN    PMROCN
     C                     MOVELPIROCN    PAROCN
     C                     MOVELPIPSTM    PMPSTM
     C***********          MOVELPIPONS    PMPONS                          135748
     C***********          MOVE PIPONS    PMPONS                    135748CAP064
     C***********          MOVELPIPONS    PMPONS                    CAP064202403
     C**********           MOVE PIPONS    WKPONS 12                                    202403 257053
     C                     MOVE PIPONS    WKPONS 18                                           257053
     C                     MOVE WKPONS    PMPONS                          202403
     C                     MOVELPIPIBN    PMPIBN
     C                     MOVELPIPIBN    PAPIBN
     C                     MOVELPIPIBA    PMPIBA
     C                     MOVELPIPOBN    PMPOBN
     C                     MOVELPIPOBN    PAPOBN
     C                     MOVELPIPOCN    PMPOCN
     C                     MOVELPIPOCN    PAPOCN
     C                     MOVELPIRCRN    PMRCRN
     C                     MOVELPIRCRN    PARCRN
     C                     MOVELPIRCRA    PMRCRA
     C                     MOVELPIPREC    PMRVNO
     C                     MOVELPIPREC    PARVNO
     C                     MOVELPIAWBN    PMAWBN
     C                     MOVELPIAWBN    PAAWBN
     C                     MOVELPIAWBA    PMAWBA
     C                     MOVELPIBENN    PMBENN
     C                     MOVELPIBENN    PABENN
     C                     MOVELPIBENA    PMBENA
     C                     MOVELPIDTP1    PMDTP1
     C                     MOVELPIDTP2    PMDTP2
     C                     MOVELPIDTP3    PMDTP3
     C                     MOVELPIDTP4    PMDTP4
     C                     MOVELPIDCHG    PMDCHG
     C                     MOVELPIBTB1    PMBTB1
     C                     MOVELPIBTB2    PMBTB2
     C                     MOVELPIBTB3    PMBTB3
     C                     MOVELPIBTB4    PMBTB4
     C                     MOVELPIBTB5    PMBTB5
     C                     MOVELPIBTB6    PMBTB6
     C                     MOVELPICVMR    PMCVMR
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE PISCCY    PMRSCY                          CEU004
     C                     MOVE PISCCY    PMPSCY                          CEU004
     C                     MOVE PISCCY    WSCCY                           CEU004
     C                     MOVE PIICCY    PMIC72                          CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PISCCY    PMRSCY                                              CLE031
     C                     MOVE PIREXR    PMREXR                                              CLE031
     C           PIREXR    IFNE *BLANKS                                                       CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE PIREXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     MOVE *OFF      *IN99                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
     C                     Z-ADD*ZEROS    WSEXR  138                                          CLE031
     C                     MOVELZFIELD    WSEXR                                               CLE031
     C           *IN99     IFEQ *ON                                                           CLE031
     C           WSEXR     OREQ *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE PIREXI    PMREXI                                              CLE031
     C           PIREXI    IFEQ 'N'                                                           CLE031
     C                     MOVE *BLANKS   PMREXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE PIPSCY    PMPSCY                                              CLE031
     C                     MOVE PIPEXR    PMPEXR                                              CLE031
     C           PIPEXR    IFNE *BLANKS                                                       CLE031
     C                     MOVE PIPEXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     MOVE *OFF      *IN99                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
     C                     Z-ADD*ZEROS    WSEXR                                               CLE031
     C                     MOVELZFIELD    WSEXR                                               CLE031
     C           *IN99     IFEQ *ON                                                           CLE031
     C           WSEXR     OREQ *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE PIPEXI    PMPEXI                                              CLE031
     C           PIPEXI    IFEQ 'N'                                                           CLE031
     C                     MOVE *BLANKS   PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *
     C                     MOVE PITACT    PMACTC
     C***********          MOVE 'MMLD'    PMCPGM                          135152
     C                     MOVE 'LEND'    PMCPGM                          135152
     C                     MOVE *BLANK    PMCMDP
     C                     Z-ADD0         PMDBSE
     C                     MOVE *BLANKS   PMERCD
     C                     MOVE 'Y'       PMFRST
     C                     Z-ADDBJRDNB    PMRUND
     C                     Z-ADDBJBVPD    PMBVPD
     C           PILNRF    IFNE *BLANKS
     C                     MOVE 'F1'      PMTTYP
     C                     ELSE
     C                     MOVE 'F2'      PMTTYP
     C                     ENDIF
     C                     MOVELPICNUM    PMCSNM
     C***********          MOVELPIPCOB    PMBRCA                          135748
      *                                                                   135748
     C           PIRONS    IFNE *BLANKS                                   135748
      *                                                                   135748
     C           PIRSTM    IFEQ '05'                                      135748
     C           CLE033    OREQ 'Y'                                       CLE033
     C           PIRSTM    ANDEQ'09'                                      CLE033
     C                     MOVELPIRONS    PMROBR                          135748
     C/COPY WNCPYSRC,LEH00547
     C                     ELSE                                           135748
     C                     MOVE *BLANKS   PMROBR                          135748
     C                     ENDIF                                          135748
      *                                                                   135748
     C***********          ELSE                                    135748 215961
     C                     ENDIF                                          215961
      *                                                                   135748
     C           PIPONS    IFNE *BLANKS                                   215961
      *                                                                   215961
     C           PIPSTM    IFEQ '05'                                      135748
     C           CLE033    OREQ 'Y'                                       CLE033
     C           PIPSTM    ANDEQ'09'                                      CLE033
     C                     MOVELPIPONS    PMPOBR                          135748
     C/COPY WNCPYSRC,LEH00548
     C                     ELSE                                           135748
     C***********          MOVE *BLANKS   PMROBR                   135748 153348
     C                     MOVE *BLANKS   PMPOBR                          153348
     C                     ENDIF                                          135748
      *                                                                   135748
     C                     ENDIF                                          135748
      *                                                                   135748
     C                     MOVE '0'       *IN99
     C                     MOVE SFEPSD    ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     MOVEL'LER0022' ZAMSID
     C                     EXSR SREROR
     C                     ELSE
     C                     Z-ADDZDAYNO    WPSTD   50
     C                     ENDIF
     C                     MOVE WPSTD     PMDTRC
     C                     MOVE WPSTD     PMDTPY
     C                     MOVE PIFCUR    PMRCCY
     C                     MOVE PIFCUR    PMPCCY
      *
     C                     MOVE PITUSR    WTUSR  16
     C                     MOVE PITWST    WTWST  16
     C                     MOVE PITREF    WTREF  15
     C                     MOVE PITSEQ    WTSEQ   4
     C                     MOVE PITDST    WTDST   8
     C                     MOVE PITTST    WTTST   8
      *                                                                                       CLE031
      ** Determine if pay settlement should be protected                                      CLE031
      *                                                                                       CLE031
     C           SFLCHT    IFEQ 'E'                                                           CLE031
     C           SFLCHT    OREQ 'D'                                                           CLE031
     C           SFLCHT    OREQ 'X'                                                           CLE031
     C                     MOVE 'Y'       PMPRCV                                              CLE031
     C                     MOVE 'Y'       PMPPAY                                              CLE031
     C                     MOVE 'N'       PMVALO                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           SFLCHT    IFEQ 'I'                                                           CLE031
     C           SFLCHT    OREQ 'A'                                                           CLE031
      *                                                                                       CLE031
     C           WPTFI     IFEQ 'P'                                                           CLE031
     C                     MOVE 'N'       PMPPAY                                              CLE031
     C                     MOVE 'Y'       PMPRCV                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           WPTFI     IFEQ *BLANK                                                        CLE031
     C                     MOVE 'Y'       PMPPAY                                              CLE031
     C                     MOVE 'N'       PMPRCV                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *  SRFTYP - Subroutine to set up Fee type                       *
      *  Called by: SRVALI, SRSSET                                    *
      *  Calls    : None                                              *
      *****************************************************************
     C           SRFTYP    BEGSR
      *
     C                     MOVE *BLANK    WPTFI   1
      *
     C           CLE004    IFEQ 'Y'
     C           SFLCHT    IFEQ 'I'
      *
     C                     MOVEL'LER0202' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SFETP
     C                     MOVE *BLANKS   ZAMSID
     C                     MOVE '1'       *IN28
      *
      ** For loan fee...
      *
     C           *IN69     IFEQ '0'
     C           PTYP      IFEQ 66
     C****       LPFI      ANDEQ'P'                                       158621
     C           LPFI      ANDNE'I'                                       158621
     C           PTYP      OREQ 67
     C****       LPFI      ANDEQ'P'                                       158621
     C           LPFI      ANDNE'I'                                       158621
     C           PTYP      OREQ 69
     C****       LPFI      ANDEQ'P'                                       158621
     C           LPFI      ANDNE'I'                                       158621
     C           CLE005    ANDEQ'Y'
     C           PTYP      OREQ 72
     C****       LPFI      ANDEQ'P'                                       158621
     C           LPFI      ANDNE'I'                                       158621
     C           CLE005    ANDEQ'Y'
     C                     MOVEL'LER0203' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SFETP
     C                     MOVE *BLANKS   ZAMSID
     C****                 MOVE LPFI      WPTFI                           158621
     C                     MOVE 'P'       WPTFI                           158621
     C                     ENDIF
      *
     C           PTYP      IFEQ 64
     C           LPFI      ANDEQ'I'
     C           PTYP      OREQ 65
     C           LPFI      ANDEQ'I'
     C           PTYP      OREQ 68
     C           LPFI      ANDEQ'I'
     C           CLE005    ANDEQ'Y'
     C           PTYP      OREQ 71
     C           LPFI      ANDEQ'I'
     C           CLE005    ANDEQ'Y'
     C                     MOVEL'LER0204' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SFETP
     C                     MOVE *BLANKS   ZAMSID
     C                     MOVE '0'       *IN28
     C                     MOVE LPFI      WPTFI
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** For facility fee...
      *
     C           *IN68     IFEQ '0'
     C           PRTR      IFEQ 'P'
     C                     MOVEL'LER0203' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SFETP
     C                     MOVE *BLANKS   ZAMSID
     C                     MOVE PRTR      WPTFI
     C                     ENDIF
     C           PRTR      IFEQ 'I'
     C                     MOVEL'LER0204' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SFETP
     C                     MOVE *BLANKS   ZAMSID
     C                     MOVE '0'       *IN28
     C                     MOVE PRTR      WPTFI
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ELSE
      *
     C           FEPTFI    IFEQ *BLANK
     C                     MOVEL'LER0202' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SFETP
     C                     MOVE *BLANKS   ZAMSID
     C                     MOVE '1'       *IN28
     C                     ENDIF
      *
     C           FEPTFI    IFEQ 'P'
     C                     MOVEL'LER0203' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SFETP
     C                     MOVE *BLANKS   ZAMSID
     C                     MOVE '1'       *IN28
     C                     ENDIF
      *
     C           FEPTFI    IFEQ 'I'
     C                     MOVEL'LER0204' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SFETP
     C                     MOVE *BLANKS   ZAMSID
     C                     MOVE '0'       *IN28
     C                     ENDIF
      *
     C                     MOVE FEPTFI    WPTFI
     C                     ENDIF
      *                                                                   127656
      ** Determine if fee is for against a syndicated facility/loan       127656
      *                                                                   127656
     C                     MOVE 'N'       WSYND   1                       127656
     C           *IN69     IFEQ '0'                                       127656
     C           PTYP      IFNE 61                                        127656
     C           PTYP      ANDNE62                                        127656
     C           PTYP      ANDNE63                                        127656
     C           PTYP      ANDNE70                                        127656
     C           PTYP      ANDNE80                                                            CLE028
     C           LPFI      IFNE *BLANKS                                   127656
     C                     MOVE 'Y'       WSYND                           127656
     C                     ENDIF                                          127656
     C                     ELSE                                           127656
      * Facility used may be on another customer, if we access it CNUM    186557
      * will be changed also                                              186557
     C**********           Z-ADDWCNUM     WCNSAV  60                                   186557 CSD027
     C**********           Z-ADDCNUM      CNMSAV  60                                   186557 CSD027
     C                     MOVE WCNUM     WCNSAV  6                                           CSD027
     C                     MOVE CNUM      CNMSAV  6                                           CSD027
     C                     MOVE FCUS      WCNUM                           127656
     C                     MOVE FTYP      WFAC03                          127656
     C                     MOVE FSEQ      WFAC02                          127656
     C           KEY001    CHAINFCLTY                78                   127656
     C           *IN78     IFEQ '0'                                       127656
     C           SYIN      ANDEQ'Y'                                       127656
     C                     MOVE 'Y'       WSYND                           127656
     C                     ENDIF                                          127656
     C**********           Z-ADDWCNSAV    WCNUM   60                                   186557 CSD027
     C**********           Z-ADDCNMSAV    CNUM    60                                   186557 CSD027
     C                     MOVE WCNSAV    WCNUM   6                                           CSD027
     C                     MOVE CNMSAV    CNUM    6                                           CSD027
     C                     Z-ADD0         WFAC05                          127656
     C                     ENDIF                                          127656
     C                     ENDIF                                          127656
      *                                                                   127656
     C           *IN68     IFEQ '0'                                       127656
     C********** PRTR      ANDNE*BLANKS                            127656 193772
     C********** PRTR      ANDEQ'A'                                141351 193772
     C           SYIN      ANDEQ'Y'                                       193772
     C           PRTR      ANDNE'I'                                       193772
     C           PRTR      ANDNE'P'                                       193772
     C                     MOVE 'Y'       WSYND                           127656
     C                     ENDIF                                          127656
      *                                                                   127656
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *  SEQGEN - Subroutine to generate fee sequence number          *
      *  Called by: SRWRIT                                            *
      *  Calls    : None                                              *
      *****************************************************************
     C           SEQGEN    BEGSR                           *** SEQGEN ***
      *
     C                     Z-ADD99        WFSEQ
      *
      **  Prevent pick up of details from previous fee
      *
     C           KEY002    SETGTLEFEEDF
     C           KEY005    REDPELEFEEDF                  78
      *
     C           *IN78     IFEQ '1'
     C                     MOVE '01'      FEFSEQ
      *
     C                     ELSE
      *
      **  Release File
     C                     EXCPT
      *
     C           WCNUM     IFEQ FECNUM
     C           WLOAN     ANDEQFELOAN
     C           WFAC05    ANDEQFEFACL
     C                     ADD  1         FEFSEQ
      *
     C                     ELSE
      *
      ** There are no existing fee records with the key fields input so
      ** put original values back in key fields ready for file update
      ** and allocate a fee sequence no. of 01.
      *
     C                     MOVE WCNUM     FECNUM
     C**********           Z-ADDWLOAN     FELOAN                                              CLE148
     C                     MOVELWLOAN     FELOAN                                              CLE148
     C                     Z-ADDWFAC05    FEFACL
     C                     MOVE '01'      FEFSEQ
      *
     C                     ENDIF
     C                     ENDIF
      *
      ** Having checked the live fees the matured fees need to be
      ** checked in the same way
      *
     C           KEY012    SETGTLEFHSTF
     C           KEY015    REDPELEFHSTF                  78
      *
     C           *IN78     IFEQ '0'
      *
     C           WCNUM     IFEQ HICNUM
     C           WLOAN     ANDEQHILNRF
     C           WFAC05    ANDEQHIFACL
     C                     ADD  1         HIFSEQ
      *
     C                     ELSE
     C                     MOVE '01'      HIFSEQ
      *
     C                     ENDIF
     C                     ENDIF
      *
      **  Store allocated sequence number for output
      *
     C           FEFSEQ    IFGT HIFSEQ
     C                     MOVE FEFSEQ    @ALSEQ  2
     C                     ELSE
     C                     MOVE HIFSEQ    @ALSEQ  2
     C                     ENDIF
      *
     C                     MOVE @ALSEQ    FEFSEQ
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *  SRAVAL - Additional Validation for Settlement                *
      *  Called by: SRDET1, SRDET2, SRVALI, SRSSET                    *
      *  Calls    : SREROR - Error Processing                         *
      *****************************************************************
     C           SRAVAL    BEGSR
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           WPTFI     IFEQ *BLANKS                                   CEU004
     C                     MOVE PMRSCY    WSCCY   3                       CEU004
     C                     ENDIF                                          CEU004
     C           WPTFI     IFEQ 'P'                                       CEU004
     C                     MOVE PMPSCY    WSCCY                           CEU004
     C                     ENDIF                                          CEU004
     C                     ENDIF                                          CEU004
      *
      ** If settlement is start date and method is either 01 07 or 08,
      ** then check date for a holiday in both local and fee ccy.
      *
     C           *IN44     IFNE '1'                                       158634
     C           SFEPON    IFEQ 'S'
     C           SFEPON    OREQ ' '
     C                     Z-ADDWPSTD     ZDAYNO                          181569
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SFSTAL    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           PSNOS     IFEQ 'Y'                                                           CLE034
      *                                                                                       CLE034
     C           WPTFI     IFEQ *BLANKS                                                       CLE034
     C                     MOVEAPRCCY     ACUR                                                CLE034
     C                     MOVEAPRLOC     ALOC                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WPTFI     IFEQ 'I'                                                           CLE034
     C                     MOVEAPPCCY     ACUR                                                CLE034
     C                     MOVEAPPLOC     ALOC                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE *ON       *IN97                                               CLE034
     C                     MOVEAACUR      WACUR  60                                           CLE034
     C           WACUR     IFEQ *BLANKS                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE SFECUR    ACUR,1                                              CLE034
     C                     MOVE *BLANKS   ALOC,1                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE *BLANKS   ALOC,1                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C           FESTTL    IFEQ 01
     C           FESTTL    OREQ 07
     C           FESTTL    OREQ 08
      *                                                                                       CLE034
     C                     MOVE *ON       *IN97                                               CLE034
      *
      ** Fee Ccy check
      *
     C**********           Z-ADDWPSTD     ZDAYNO                   158634 181569
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           WSCCY     ANDNE*BLANKS                                   CEU004
     C                     MOVE WSCCY     ZCCY                            CEU004
     C                     MOVE WSCCY     ACUR,1                                              CLE034
     C                     ELSE                                           CEU004
     C**********           MOVE SFECUR    ZCCY    3                                           CLE034
     C                     MOVE SFECUR    ACUR,1                                              CLE034
     C                     ENDIF                                          CEU004
     C**********           MOVE '*BLANKS' ZLOC    3                                           CLE034
     C                     MOVE *BLANKS   ALOC,1                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE *BLANKS   ALOC,1                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Endif of if CLE034 is on and SFSTAL is 'Y'                                           CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Initialise holiday field.                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE *BLANK    WHDAY   1                                           CLE034
      *                                                                                       CLE034
      ** If CLE034 is off or CLE034 is on but Settlement allocation is                        CLE034
      ** not 'Y'.                                                                             CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'N'                                                           CLE034
     C           CLE034    OREQ 'Y'                                                           CLE034
     C           SFSTAL    ANDNE'Y'                                                           CLE034
      *                                                                                       CLE034
     C           FESTTL    IFEQ 01                                                            CLE034
     C           FESTTL    OREQ 07                                                            CLE034
     C           FESTTL    OREQ 08                                                            CLE034
     C                     MOVE 'Y'       WHDAY                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** If CLE034 is on and Settlement allocation is 'Y'                                     CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SFSTAL    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           PSNOS     IFEQ 'Y'                                                           CLE034
     C                     MOVE 'Y'       WHDAY                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD1         WX      20                                          CLE034
     C           WX        DOWLE20                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE ACUR,WX   ZCCY                                                CLE034
     C                     MOVE ALOC,WX   ZLOC                                                CLE034
      *                                                                                       CLE034
     C           ZCCY      IFNE *BLANKS                                                       CLE034
      *
     C                     Z-ADD0         ZNRDYS                                              CLE034
     C                     EXSR ZCHKH
      *
      ** If WHDAY = 'Y'                                                                       CLE034
      *                                                                                       CLE034
     C           WHDAY     IFEQ 'Y'                                                           CLE034
      *                                                                                       CLE034
     C           ZIND      IFEQ 'H'
     C                     MOVE '1'       *IN44
     C                     MOVE 'Y'       WWERR
     C           CEU004    IFEQ 'Y'                                       CEU004
     C********** WSCCY     ANDNE*BLANKS                                                CEU004 CLE034
     C           ZCCY      ANDNESFECUR                                                        CLE034
     C***********          MOVEL'LER0210' ZAMSID                                       CEU004 180573
     C                     MOVEL'LER0225' ZAMSID                                              180573
     C                     ELSE                                           CEU004
     C                     MOVEL'LER0024' ZAMSID
     C                     ENDIF                                          CEU004
     C                     EXSR SREROR
     C                     MOVE *BLANK    WWERR
     C                     ENDIF
     C                     ELSE
      *
      ** Local Ccy check
      *
     C**********           MOVE BJLCCY    ZCCY    3                                           CLE034
     C**********           MOVE '*BLANKS' ZLOC    3                                           CLE034
      *
     C**********           EXSR ZCHKH                                                         CLE034
      *
     C           ZIND      IFEQ 'H'
     C                     MOVE '1'       *IN44
     C                     MOVE 'Y'       WWERR
     C                     MOVEL'LER0032' ZAMSID
     C                     EXSR SREROR
     C                     MOVE *BLANK    WWERR
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CLE034
      ** Endif of If ZCCY is not blank                                                        CLE034
      *                                                                                       CLE034
     C                     ENDIF
      *                                                                                       CLE034
      ** Increment counter                                                                    CLE034
      *                                                                                       CLE034
     C           WX        ADD  1         WX                                                  CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
      ** Endif of If *IN44 is off                                                             CLE034
      *                                                                                       CLE034
     C                     ENDIF                                          158634
      *
      ** If settlement is end date and method is either 01 07 or 08,
      ** then check date for a holiday in both local and fee ccy.
      *
     C           *IN45     IFNE '1'                                       158634
     C           SFEPON    IFEQ 'E'
     C                     Z-ADDWPEND     ZDAYNO                          181569
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SFSTAL    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           PSNOS     IFEQ 'Y'                                                           CLE034
      *                                                                                       CLE034
     C           WPTFI     IFEQ *BLANKS                                                       CLE034
     C                     MOVEAPRCCY     ACUR                                                CLE034
     C                     MOVEAPRLOC     ALOC                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WPTFI     IFEQ 'P'                                                           CLE034
     C                     MOVEAPPCCY     ACUR                                                CLE034
     C                     MOVEAPPLOC     ALOC                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE *ON       *IN97                                               CLE034
     C                     MOVEAACUR      WACUR                                               CLE034
     C           WACUR     IFEQ *BLANKS                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE SFECUR    ACUR,1                                              CLE034
     C                     MOVE *BLANKS   ALOC,1                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE *BLANKS   ALOC,1                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C           FESTTL    IFEQ 01
     C           FESTTL    OREQ 07
     C           FESTTL    OREQ 08
      *                                                                                       CLE034
     C                     MOVE *ON       *IN97                                               CLE034
      *
     C**********           Z-ADDWPEND     ZDAYNO                   158634 181569
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           WSCCY     ANDNE*BLANKS                                   CEU004
     C                     MOVE WSCCY     ZCCY                            CEU004
     C                     MOVE WSCCY     ACUR,1                                              CLE034
     C                     ELSE                                           CEU004
     C**********           MOVE SFECUR    ZCCY    3                                           CLE034
     C                     MOVE SFECUR    ACUR,1                                              CLE034
     C                     ENDIF                                          CEU004
     C**********           MOVE '*BLANKS' ZLOC    3                                           CLE034
     C                     MOVE *BLANKS   ALOC,1                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE *BLANKS   ALOC,1                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Endif of if CLE034 is on and SFSTAL is 'Y'                                           CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Initialise holiday field.                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE *BLANK    WHDAY   1                                           CLE034
      *                                                                                       CLE034
      ** If CLE034 is off or CLE034 is on but Settlement allocation is                        CLE034
      ** not 'Y'.                                                                             CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'N'                                                           CLE034
     C           CLE034    OREQ 'Y'                                                           CLE034
     C           SFSTAL    ANDNE'Y'                                                           CLE034
      *                                                                                       CLE034
     C           FESTTL    IFEQ 01                                                            CLE034
     C           FESTTL    OREQ 07                                                            CLE034
     C           FESTTL    OREQ 08                                                            CLE034
     C                     MOVE 'Y'       WHDAY                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** If CLE034 is on and Settlement allocation is 'Y'                                     CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SFSTAL    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           PSNOS     IFEQ 'Y'                                                           CLE034
     C                     MOVE 'Y'       WHDAY                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD1         WX      20                                          CLE034
     C           WX        DOWLE20                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE ACUR,WX   ZCCY                                                CLE034
     C                     MOVE ALOC,WX   ZLOC                                                CLE034
     C           ZCCY      IFNE *BLANKS                                                       CLE034
      *
     C                     Z-ADD0         ZNRDYS                                              CLE034
     C                     EXSR ZCHKH
      *                                                                                       CLE034
      ** If WHDAY = 'Y'                                                                       CLE034
      *                                                                                       CLE034
     C           WHDAY     IFEQ 'Y'                                                           CLE034
      *                                                                                       CLE034
      ** Fee Ccy check
      *
     C           ZIND      IFEQ 'H'
     C                     MOVE '1'       *IN45
     C                     MOVE 'Y'       WWERR
     C           CEU004    IFEQ 'Y'                                       CEU004
     C********** WSCCY     ANDNE*BLANKS                                                CEU004 CLE034
     C           ZCCY      ANDNESFECUR                                                        CLE034
     C***********          MOVEL'LER0211' ZAMSID                                       CEU004 180573
     C                     MOVEL'LER0216' ZAMSID                                              180573
     C                     ELSE                                           CEU004
     C                     MOVEL'LER0031' ZAMSID
     C                     ENDIF                                          CEU004
     C                     EXSR SREROR
     C                     MOVE *BLANK    WWERR
     C                     ENDIF
     C                     ELSE
      *
      ** Local Ccy check
      *
     C**********           MOVE BJLCCY    ZCCY    3                                           CLE034
     C**********           MOVE '*BLANKS' ZLOC    3                                           CLE034
      *
     C**********           EXSR ZCHKH                                                         CLE034
      *
     C           ZIND      IFEQ 'H'
     C                     MOVE '1'       *IN45
     C                     MOVE 'Y'       WWERR
     C                     MOVEL'LER0033' ZAMSID
     C                     EXSR SREROR
     C                     MOVE *BLANK    WWERR
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CLE034
      ** Endif of If ZCCY is not blank                                                        CLE034
      *                                                                                       CLE034
     C                     ENDIF
      *                                                                                       CLE034
      ** Increment counter                                                                    CLE034
      *                                                                                       CLE034
     C           WX        ADD  1         WX                                                  CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
      ** Endif of If *IN44 is off                                                             CLE034
      *                                                                                       CLE034
     C                     ENDIF                                          158634
      *
      ** If settlement is next payment date and method is either 01 07    158623
      ** or 08, then check date for a holiday in both local and fee ccy.  158623
      *                                                                   158623
     C           *IN64     IFNE '1'                                       158623
     C           SFEPON    IFEQ 'N'                                       158623
     C                     Z-ADDWNPYD     ZDAYNO                          181569
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SFSTAL    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           PSNOS     IFEQ 'Y'                                                           CLE034
      *                                                                                       CLE034
     C           WPTFI     IFEQ *BLANKS                                                       CLE034
     C                     MOVEAPRCCY     ACUR                                                CLE034
     C                     MOVEAPRLOC     ALOC                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WPTFI     IFEQ 'P'                                                           CLE034
     C                     MOVEAPPCCY     ACUR                                                CLE034
     C                     MOVEAPPLOC     ALOC                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE *ON       *IN97                                               CLE034
     C                     MOVEAACUR      WACUR                                               CLE034
     C           WACUR     IFEQ *BLANKS                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE SFECUR    ACUR,1                                              CLE034
     C                     MOVE *BLANKS   ALOC,1                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE *BLANKS   ALOC,1                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C           FESTTL    IFEQ 01                                        158623
     C           FESTTL    OREQ 07                                        158623
     C           FESTTL    OREQ 08                                        158623
      *                                                                                       CLE034
     C                     MOVE *ON       *IN97                                               CLE034
      *                                                                   158623
     C**********           Z-ADDWNPYD     ZDAYNO                   158623 181569
     C           CEU004    IFEQ 'Y'                                                           CLE034
     C           WSCCY     ANDNE*BLANKS                                                       CLE034
     C                     MOVE WSCCY     ZCCY                                                CLE034
     C                     MOVE WSCCY     ACUR,1                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE SFECUR    ACUR,1                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C**********           MOVE SFECUR    ZCCY    3                                    158623 CLE034
     C**********           MOVE '*BLANKS' ZLOC    3                                    158623 CLE034
     C                     MOVE *BLANKS   ALOC,1                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     MOVE *OFF      *IN97                                               CLE034
     C                     MOVE BJLCCY    ACUR,1                                              CLE034
     C                     MOVE *BLANKS   ALOC,1                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Endif of if CLE034 is on and SFSTAL is 'Y'                                           CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Initialise holiday field.                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE *BLANK    WHDAY   1                                           CLE034
      *                                                                                       CLE034
      ** If CLE034 is off or CLE034 is on but Settlement allocation is                        CLE034
      ** not 'Y'.                                                                             CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'N'                                                           CLE034
     C           CLE034    OREQ 'Y'                                                           CLE034
     C           SFSTAL    ANDNE'Y'                                                           CLE034
      *                                                                                       CLE034
     C           FESTTL    IFEQ 01                                                            CLE034
     C           FESTTL    OREQ 07                                                            CLE034
     C           FESTTL    OREQ 08                                                            CLE034
     C                     MOVE 'Y'       WHDAY                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** If CLE034 is on and Settlement allocation is 'Y'                                     CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SFSTAL    ANDEQ'Y'                                                           CLE034
     C           PSNOS     IFEQ 'Y'                                                           CLE034
     C                     MOVE 'Y'       WHDAY                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD1         WX      20                                          CLE034
     C           WX        DOWLE20                                                            CLE034
      *                                                                                       CLE034
     C                     MOVE ACUR,WX   ZCCY                                                CLE034
     C                     MOVE ALOC,WX   ZLOC                                                CLE034
     C           ZCCY      IFNE *BLANKS                                                       CLE034
      *                                                                   158623
     C                     Z-ADD0         ZNRDYS                                              CLE034
     C                     EXSR ZCHKH                                     158623
      *                                                                                       CLE034
      ** If WHDAY = 'Y'                                                                       CLE034
      *                                                                                       CLE034
     C           WHDAY     IFEQ 'Y'                                                           CLE034
      *                                                                                       CLE034
      ** Fee Ccy check                                                    158623
      *                                                                   158623
     C           ZIND      IFEQ 'H'                                       158623
     C                     MOVE '1'       *IN64                           158623
     C                     MOVE 'Y'       WWERR                           158623
     C***********          MOVEL'LER0214' ZAMSID                                       158623 180573
     C                     MOVEL'LER0229' ZAMSID                                              180573
     C                     EXSR SREROR                                    158623
     C                     MOVE *BLANK    WWERR                           158623
     C                     ENDIF                                          158623
     C                     ELSE                                           158623
      *                                                                   158623
      ** Local Ccy check                                                  158623
      *                                                                   158623
     C**********           MOVE BJLCCY    ZCCY    3                                    158623 CLE034
     C**********           MOVE '*BLANKS' ZLOC    3                                    158623 CLE034
      *                                                                   158623
     C**********           EXSR ZCHKH                                                  158623 CLE034
      *                                                                   158623
     C           ZIND      IFEQ 'H'                                       158623
     C                     MOVE '1'       *IN64                           158623
     C                     MOVE 'Y'       WWERR                           158623
     C***********          MOVEL'LER0215' ZAMSID                                       158623 180573
     C                     MOVEL'LER0230' ZAMSID                                              180573
     C                     EXSR SREROR                                    158623
     C                     MOVE *BLANK    WWERR                           158623
     C                     ENDIF                                          158623
     C                     ENDIF                                          158623
      *                                                                                       CLE034
      ** Endif of If ZCCY is not blank                                                        CLE034
      *                                                                                       CLE034
     C                     ENDIF                                          158623
      *                                                                                       CLE034
      ** Increment counter                                                                    CLE034
      *                                                                                       CLE034
     C           WX        ADD  1         WX                                                  CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
      ** Endif of If *IN44 is off                                                             CLE034
      *                                                                                       CLE034
     C                     ENDIF                                          158623
      * Flag to show that the settlement details have been validated      171462
     C           PMSDTV    IFEQ 'Y'                                       171462
     C                     MOVE 'Y'       #VALID                          171462
     C                     ENDIF                                          171462
      * Keep copy of first screen contents to see if they change.         171462
     C                     MOVE DET       SDET                            171462
      * After settlement details, redisplay first screen.                 171462
     C                     MOVE 'D1'      WFMT                            171462
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSUBF  -  Subfile Processing                                 *
      * Called by: SRLOAD                                             *
      * Calls    : SRSINS - Initialise all Screen Fields              *
      *            SRSCLR - Subfile Clear                             *
      *            SRREVW - Set Loan no. from Review from             *
      *            SRLOAD - Load Subfile Records                      *
      *            SRSVAL - Subfile Validation                        *
      *            SRSREV - Select Records from Review Fields         *
      *            CLEAR  - Clears message from the pgm message queue *
      *****************************************************************
     C           SRSUBF    BEGSR
      *
      ** Restore the Authorised selection after F9 pressed
      *
     C           WWRTRN    IFEQ 'S0'
     C                     MOVE WRAUT     SRAUT
     C                     ENDIF
     C                     MOVE SCRREV    SAVREV 20
      *
      ** Initialise subfile fields
      *
     C                     EXSR SRSINS
     C                     EXSR SRSCLR
      *
      ** Set Review from Loan no.
      *
     C                     EXSR SRREVW
      *
      ** Load subfile
      *
     C                     EXSR SRLOAD
      *
     C           WFMT      DOWEQ'S0'
     C                     WRITELE2210F2
     C                     WRITELE2210C1
     C                     EXFMTLE2210C0
      *
     C                     EXSR CLEAR
      *
     C                     SELEC
     C           *INKC     WHEQ '1'
     C                     MOVE *BLANK    WFMT
      *
     C           *INKL     WHEQ '1'
     C                     MOVE 'F0'      WFMT
     C                     MOVE 'F0'      WWRTRN
     C                     MOVE '0'       *IN25
      *
      ** F9 pressed for Insert
      *
     C           *INKI     WHEQ '1'
     C                     MOVE 'S0'      WWRTRN
     C                     MOVE 'F0'      WFMT
     C                     MOVE '1'       *IN25
     C                     MOVE SRAUT     WRAUT   1
      *
     C           *INKE     WHEQ '1'
     C                     EXSR SRSINS
     C                     EXSR SRSCLR
      *
      ** Set Review from Loan no.
      *
     C                     EXSR SRREVW
     C                     EXSR SRLOAD
      *
     C                     MOVE SCRREV    SAVREV
      *
     C           *IN21     WHEQ '1'
     C                     EXSR SRSINS
     C                     EXSR SRLOAD
      *
     C                     OTHER
      *
      ** Priority on Review from fields: if this is entered, process
      ** this request
      *
     C           SCRREV    IFNE SAVREV
     C                     EXSR SRSREV
     C                     ELSE
     C                     EXSR SRSVAL
     C           DELMOD    IFEQ 'Y'                                       CAP064
     C                     EXSR SRSREV                                    CAP064
     C                     ENDIF
     C                     ENDIF                                          CAP064
      *
     C                     ENDSL
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRLOAD  -  Load subfile records                               *
      * Called by: SRSUBF, SRSREV                                     *
      * Calls    : SREROR - Error Processing                          *
      *            SRSFMT -  Format Subfile fields                    *
      *****************************************************************
     C           SRLOAD    BEGSR
      *
     C           *IN80     IFEQ '1'
     C                     MOVEL'LER0170' ZAMSID
     C                     EXSR SREROR
     C                     MOVE '1'       *IN12
     C                     ELSE
      *
     C                     MOVE '0'       *IN12
     C                     Z-ADD1         WCTR    20
     C                     Z-ADDSRRN      SRECN
      *
     C           *IN80     DOWEQ'0'
     C           WCTR      ANDLE10
      *
      ** User must have access to the branch of the fee
      *
     C                     Z-ADD*ZERO     WERR
      *                                                                   CAP064
     C           PMODE     IFEQ 'F'                                       CAP064
     C                     MOVE SFBRCA    BFBRCA                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
     C           BGMBIN    IFEQ 'Y'
     C                     CALL 'ZVBBU'
     C                     PARM BFBRCA    WZBR
     C                     PARM           WERR
     C                     ENDIF
      *
     C           WERR      IFEQ *ZERO
      *                                                                   CAP064
     C           PMODE     IFEQ 'F'                                       CAP064
     C                     EXSR SRSFMF                                    CAP064
     C                     ELSE                                           CAP064
     C                     EXSR SRSFMT
     C                     ENDIF                                          CAP064
      *
     C                     WRITELE2210S0
     C                     ADD  1         SRRN
     C                     ADD  1         WCTR
      *
     C                     ENDIF
      *
     C           PMODE     IFEQ 'F'                                       CAP064
     C                     READ LEIFEEP1                 80               CAP064
     C                     ELSE                                           CAP064
     C           SRAUT     IFEQ 'Y'
     C                     READ LEFEEDL3                 80
     C                     ELSE
     C                     READ LEFEEDL0                 80
     C                     ENDIF                                          CAP064
     C                     ENDIF
      *
     C           BGMBIN    IFEQ 'Y'
     C                     CALL 'ZVBBU'
     C                     PARM BFBRCA    WZBR
     C                     PARM           WERR
     C                     ENDIF
      *
     C                     ENDDO
     C                     ENDIF
      *
      ** User must have access to the branch of the fee
      *
     C           *IN80     DOWEQ'0'
     C           WERR      ANDNE*ZERO
      *
      *                                                                   CAP064
     C           PMODE     IFEQ 'F'                                       CAP064
     C                     READ LEIFEEP1                 80               CAP064
     C                     ELSE                                           CAP064
     C           SRAUT     IFEQ 'Y'
     C                     READ LEFEEDL3                 80
     C                     ELSE
     C                     READ LEFEEDL0                 80
     C                     ENDIF                                          CAP064
     C                     ENDIF
      *
     C           BGMBIN    IFEQ 'Y'
     C                     CALL 'ZVBBU'
     C                     PARM BFBRCA    WZBR
     C                     PARM           WERR
     C                     ENDIF
      *
     C                     ENDDO
      *
     C           *IN80     IFEQ '1'
      *
      ** Set on Subfile end indicator
      *
     C                     MOVE '1'       *IN19
      *
      ** Do not display 'Page key' for one-page subfile
      *
     C           SRRN      IFLE 11
     C                     MOVE '0'       *IN13
     C                     ENDIF
      *
      ** No records to display if SRRN = 1
      *
     C           SRRN      IFEQ 1
     C           WERRF     ANDNE'Y'
     C                     MOVEL'LER0170' ZAMSID
     C                     EXSR SREROR
     C                     MOVE '1'       *IN12
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSINS  -  Initialise Subfile fields                          *
      * Called by: SRSUBF, SRSREV                                     *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSINS    BEGSR
      *
      ** Initialise subfile
      *
     C                     MOVE *BLANKS   SBSEL
     C                     MOVE *BLANKS   SBCNUM
     C                     MOVE *BLANKS   SBFALO
     C                     MOVE *BLANKS   SBFSEQ
     C                     MOVE *BLANKS   SBSTRD
     C                     MOVE *BLANKS   SBENDD
     C                     MOVE *BLANKS   SBAMNT
     C                     MOVE *BLANKS   SBCCY
     C                     MOVE *BLANKS   SBSTAT
     C                     MOVE *BLANKS   SBFLIN
     C                     MOVE *BLANKS   SBIUSR
     C                     MOVE *BLANKS   SBAUSR
     C                     MOVE *BLANKS   SBBRCA
     C                     MOVE *BLANKS   SBASTS
     C                     MOVE '1'       *IN13
     C                     MOVE '0'       *IN19
     C                     MOVE '0'       *IN67
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSCLR  -  Subfile Clear                                      *
      * Called by: SRSUBF, SRSREV                                     *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSCLR    BEGSR
      *
     C                     MOVE '1'       *IN11
     C                     WRITELE2210C0
     C                     MOVE '00'      *IN,11
      *
     C                     Z-ADD1         SRRN    40
     C                     WRITELE2210F0
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSFMT  -  Format Subfile fields                              *
      * Called by: SRLOAD                                             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRSFMT    BEGSR
      *
      ** Retrieve Fee Currency number of decimal places
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*BLANK  'PRTCD
     C                     PARM '*KEY    'POPTN
     C                     PARM BFFCCY    PCURR   3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD14        DBASE            * DBERR 14 *
     C                     MOVELBFFCCY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE BFCNUM    SBCNUM
     C                     MOVE *BLANKS   SBFALO
     C           BFFACL    IFNE *ZERO
     C                     MOVELBFFACL    SBFALO
     C                     MOVE 'F'       SBFLIN
     C                     ELSE
     C                     MOVE BFLOAN    WLOAN                                               207629
     C                     MOVE 'A'       WCLRT                                               207629
     C           KEY004    CHAINCLOAN                74                                       207629
     C           *IN74     IFEQ '0'                                                           207629
     C           PPCUST    ANDEQ'O'                                                           207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C                     MOVE OLNO      SBCNUM                                              207629
     C                     MOVE CNUM      OCNUM                                               207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     MOVE BFLOAN    SBFALO
     C                     MOVE 'L'       SBFLIN
     C                     ENDIF
     C                     MOVE BFFSEQ    SBFSEQ
     C                     Z-ADDBFPSTD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    SBSTRD
     C                     Z-ADDBFPEND    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    SBENDD
     C                     MOVE BFFAMT    ZFLD15
     C                     MOVE A6NBDP    ZDECS
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVELZOUT22    WFLD21 21
     C                     MOVE WFLD21    SBAMNT
     C                     MOVE ZOUT22    WFLDN  220                      170111
     C           ZDECS     IFEQ 0                                         170111
     C           WFLDN     ANDEQ*ZEROS                                    170111
     C                     MOVELZOUT22    WFLD22 22                       170111
     C                     MOVE WFLD22    SBAMNT                          170111
     C                     ENDIF                                          170111
     C                     MOVE BFFCCY    SBCCY
     C                     MOVELBFIUSR    SBIUSR
     C                     MOVELBFAUSR    SBAUSR
     C                     MOVELBFBRCA    SBBRCA
     C                     MOVELBFFSTS    SBASTS
      *
     C           PMODE     IFEQ 'F'                                       CAP064
     C/COPY WNCPYSRC,LE2210C019
     C                     MOVE SFASTS    BFFSTS                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
     C                     SELEC
     C           BFFSTS    WHEQ 'C'
     C                     MOVEL'LER0199' ZAMSID
     C           BFFSTS    WHEQ 'R'
     C                     MOVEL'LER0200' ZAMSID
     C           BFFSTS    WHEQ 'A'
     C                     MOVEL'LER0201' ZAMSID
     C                     ENDSL
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SBSTAT
     C                     MOVE *BLANKS   ZAMSID
      *
     C                     ENDSR
      /EJECT
      *****************************************************************   CAP064
      * SRSFMF  -  Format Subfile fields if in repair mode            *   CAP064
      * Called by: SRLOAD                                             *   CAP064
      * Calls    : None                                               *   CAP064
      *****************************************************************   CAP064
     C           SRSFMF    BEGSR                                          CAP064
      *                                                                   CAP064
     C                     MOVE FCNUM     SBCNUM                          CAP064
     C                     MOVE *BLANKS   SBFALO                          CAP064
     C           SFFACT    IFNE *ZERO                                     CAP064
     C                     MOVELSFFACT    ULWRK5  5                       CAP064
     C                     MOVE SFFCNO    ULWRK5                          CAP064
     C                     MOVELULWRK5    SBFALO                          CAP064
     C                     MOVE 'F'       SBFLIN                          CAP064
     C                     ELSE                                           CAP064
     C                     MOVE SFLNRF    SBFALO                          CAP064
     C                     MOVE 'L'       SBFLIN                          CAP064
     C                     ENDIF                                          CAP064
     C                     MOVE SFFSEQ    SBFSEQ                          CAP064
     C                     MOVE SFEPSD    ZDATE                           CAP064
     C                     EXSR ZDATE1                                    CAP064
     C                     EXSR ZDATE2                                    CAP064
     C                     MOVE ZDATE     SBSTRD                          CAP064
     C                     MOVE SFEPED    ZDATE                           CAP064
     C                     EXSR ZDATE1                                    CAP064
     C                     EXSR ZDATE2                                    CAP064
     C                     MOVE ZDATE     SBENDD                          CAP064
      *                                                                                       CAAA03
      ** Scan blank position to format the screen amounts                                     CAAA03
      *                                                                                       CAAA03
     C           ' '       SCAN SFEAMT    WBLANK  20                                          CAAA03
     C           WBLANK    SUB  1         X       20                                          CAAA03
     C                     SELEC                                                              CAAA03
     C           WBLANK    WHEQ 2                                                             CAAA03
     C           X         SUBSTSFEAMT:1  WSBAM1  1                                           CAAA03
     C                     MOVE WSBAM1    SBAMNT                                              CAAA03
     C           WBLANK    WHEQ 3                                                             CAAA03
     C           X         SUBSTSFEAMT:1  WSBAM2  2                                           CAAA03
     C                     MOVE WSBAM2    SBAMNT                                              CAAA03
     C           WBLANK    WHEQ 4                                                             CAAA03
     C           X         SUBSTSFEAMT:1  WSBAM3  3                                           CAAA03
     C                     MOVE WSBAM3    SBAMNT                                              CAAA03
     C           WBLANK    WHEQ 5                                                             CAAA03
     C           X         SUBSTSFEAMT:1  WSBAM4  4                                           CAAA03
     C                     MOVE WSBAM4    SBAMNT                                              CAAA03
     C           WBLANK    WHEQ 6                                                             CAAA03
     C           X         SUBSTSFEAMT:1  WSBAM5  5                                           CAAA03
     C                     MOVE WSBAM5    SBAMNT                                              CAAA03
     C           WBLANK    WHEQ 7                                                             CAAA03
     C           X         SUBSTSFEAMT:1  WSBAM6  6                                           CAAA03
     C                     MOVE WSBAM6    SBAMNT                                              CAAA03
     C           WBLANK    WHEQ 8                                                             CAAA03
     C           X         SUBSTSFEAMT:1  WSBAM7  7                                           CAAA03
     C                     MOVE WSBAM7    SBAMNT                                              CAAA03
     C           WBLANK    WHEQ 9                                                             CAAA03
     C           X         SUBSTSFEAMT:1  WSBAM8  8                                           CAAA03
     C                     MOVE WSBAM8    SBAMNT                                              CAAA03
     C           WBLANK    WHEQ 10                                                            CAAA03
     C           X         SUBSTSFEAMT:1  WSBAM9  9                                           CAAA03
     C                     MOVE WSBAM9    SBAMNT                                              CAAA03
     C           WBLANK    WHEQ 11                                                            CAAA03
     C           X         SUBSTSFEAMT:1  WSBA10 10                                           CAAA03
     C                     MOVE WSBA10    SBAMNT                                              CAAA03
     C           WBLANK    WHEQ 12                                                            CAAA03
     C           X         SUBSTSFEAMT:1  WSBA11 11                                           CAAA03
     C                     MOVE WSBA11    SBAMNT                                              CAAA03
     C           WBLANK    WHEQ 13                                                            CAAA03
     C           X         SUBSTSFEAMT:1  WSBA12 12                                           CAAA03
     C                     MOVE WSBA12    SBAMNT                                              CAAA03
     C           WBLANK    WHEQ 14                                                            CAAA03
     C           X         SUBSTSFEAMT:1  WSBA13 13                                           CAAA03
     C                     MOVE WSBA13    SBAMNT                                              CAAA03
     C           WBLANK    WHEQ 0                                                             CAAA03
     C                     MOVE SFEAMT    SBAMNT                          CAP064
     C                     ENDSL                                                              CAAA03
     C           SFEAMT    IFEQ *BLANKS                                   CAP064
     C                     MOVE '0.00'    SBAMNT                          CAP064
     C                     ENDIF                                          CAP064
     C                     MOVELSFECUR    SBCCY                           CAP064
     C                     MOVELSFIUSR    SBIUSR                          CAP064
     C                     MOVELSFAUSR    SBAUSR                          CAP064
     C                     MOVELSFBRCA    SBBRCA                          CAP064
     C                     MOVELSFASTS    SBASTS                          CAP064
     C                     MOVELSFSTAT    SBSTAT                          CAP064
      *                                                                   CAP064
     C                     ENDSR                                          CAP064
      /EJECT                                                              CAP064
      *****************************************************************
      * SRSVAL  -  Subfile Validation                                 *
      * Called by: SRSUBF                                             *
      * Calls    : SREROR - Error Processing                          *
      *            SRAUTH - Validate authorisation action             *
      *            SRPROC - Subfile Detail Processing                 *
      *****************************************************************
     C           SRSVAL    BEGSR
      *
     C                     Z-ADDSRRN      WSRRN   40
     C                     MOVE 'S0'      WWRTRN
      *
      ** Read changed records in subfile
      *
     C                     MOVE *BLANK    WSFER   1
     C                     MOVE *BLANK    WFRST   1
      *
     C           *IN12     IFEQ '0'
     C                     READCLE2210S0                 81
     C                     ELSE
     C                     MOVE '1'       *IN81
     C                     ENDIF
      *
     C           *IN81     DOWEQ'0'
     C                     MOVE '0'       *IN20
     C                     MOVE '0'       *IN67
      *
     C           SBSEL     IFNE *BLANK
     C                     MOVE '1'       *IN20
      *
      ** Valid actions are E, A, R, and X (for unauthorised loan)
      ** If in repair mode, only 'U' and 'Q' actions allowed.             CAP064
      *
     C           SBSEL     IFNE 'E'
     C           SBSEL     ANDNE'A'
     C           SBSEL     ANDNE'X'
     C           SBSEL     ANDNE'D'
     C           PMODE     ANDNE'F'                                       CAP064
     C           SBSEL     ORNE 'U'                                       CAP064
     C           SBSEL     ANDNE'Q'                                       CAP064
     C           PMODE     ANDEQ'F'                                       CAP064
     C                     MOVE '1'       *IN67
     C                     MOVE 'Y'       WSFER
     C           PMODE     IFEQ 'F'                                       CAP064
     C                     MOVEL'LEA1044' ZAMSID                          CAP064
     C                     ELSE                                           CAP064
     C                     MOVEL'LER0173' ZAMSID
     C                     ENDIF                                          CAP064
     C                     EXSR SREROR
     C                     ENDIF
      *
     C           SBSEL     IFEQ 'X'
     C           SBASTS    ANDEQ'A'
     C           *IN67     ANDEQ'0'
     C                     MOVE '1'       *IN67
     C                     MOVE 'Y'       WSFER
     C                     MOVEL'LER0182' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C                     MOVELSBSEL     SFLCHT
     C                     MOVELSBIUSR    FEIUSR
     C                     MOVELSBAUSR    FEAUSR
     C                     MOVELSBBRCA    BRCA
     C                     MOVELSBASTS    FEFSTS
      *
      ** Check user/action/branch authority
      *
     C           *IN67     IFEQ '0'
      *
      ** For single branch system, check if user is authorised to the
      ** action
      *
     C                     Z-ADD0         WERR
     C           MBIN      IFEQ 'N'
     C                     CALL 'ZVACTU'
     C                     PARM SFLCHT    WZACTN
     C                     PARM           WERR
     C           WERR      IFNE 0
     C                     MOVE '1'       *IN67
     C                     MOVE 'Y'       WSFER
     C                     MOVEL'LER0123' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
      ** For multibranching system, and action codes A/E/R/X, branch code
      ** on loans file must be valid for user
      *
     C           *IN67     IFEQ '0'
     C           MBIN      ANDEQ'Y'
     C           SFLCHT    ANDNE'I'
     C                     CALL 'ZVACTBU'
     C                     PARM SFLCHT    WZACTN  1
     C                     PARM BRCA      WZBR    3
     C                     PARM           WERR    10
     C           WERR      IFEQ 1
     C                     MOVE '1'       *IN67
     C                     MOVE 'Y'       WSFER
     C                     MOVEL'LER0121' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C           WERR      IFEQ 2
     C                     MOVE '1'       *IN67
     C                     MOVE 'Y'       WSFER
     C                     MOVEL'LER0122' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** If action code is 'X', execute Authorisation Processing
      *
     C           SBSEL     IFEQ 'X'
     C           *IN67     ANDEQ'0'
     C                     EXSR SRAUTH
     C                     ENDIF
      *                                                                   CAP064
      * If Delete mode then EXSR INVLTM.                                  CAP064
     C                     MOVE *BLANKS   DELMOD  1                       CAP064
     C           SBSEL     IFEQ 'Q'                                       CAP064
     C           PMODE     ANDEQ'F'                                       CAP064
     C                     EXSR INVLTM                                    CAP064
     C                     MOVE *BLANKS   SBSEL                           CAP064
     C                     MOVE 'Y'       DELMOD                          CAP064
     C                     ENDIF                                          CAP064
      *
      ** Save rel. record no. of first record in error
      *
     C           WFRST     IFEQ *BLANK
     C           *IN67     ANDEQ'1'
     C                     Z-ADDSRRN      SRECN
     C                     MOVE 'Y'       WFRST
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     UPDATLE2210S0
     C                     READCLE2210S0                 81
     C                     ENDDO
      *
     C           WSFER     IFEQ *BLANK
     C           DELMOD    ANDNE'Y'                                       CAP064
     C                     EXSR SRPROC
     C                     ENDIF
      *
      ** Restore next available RRN
      *
     C                     Z-ADDWSRRN     SRRN    40
      *
     C                     ENDSR
      /EJECT
      *****************************************************************   CAP064
      * INVLTM  -  Call to Program LE2031                             *   CAP064
      * Called by: SRSVAL                                             *   CAP064
      * Calls    :                                                    *   CAP064
      *****************************************************************   CAP064
     C           INVLTM    BEGSR                                          CAP064
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
      *                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
     C                     MOVE 'Y'       SUPSYS  1                       CSC011
     C                     ELSE                                           CSC011
     C                     MOVE 'N'       SUPSYS                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CAP064
     C                     CALL 'LE2031'                                  CAP064
      *                                                                   CAP064
      * INPUTS                                                            CAP064
      * Invalid file name                                                 CAP064
     C                     PARM 'LEIFEEPD'INVFIL  8                       CAP064
      *                                                                   CAP064
      * Repair Number                                                     CAP064
     C                     PARM XREPN     IREPN   50                      CAP064
      **Support*System On                                          CSC011 222373
     C**********           PARM SUPSYS    SUPSYS                   CSC011 222373
      *                                                                   CAP064
     C                     ENDSR                                          CAP064
      /EJECT                                                              CAP064
      *****************************************************************   CAP064
      * SRPROC  -  Subfile Detail Processing                          *
      * Called by: SRSVAL                                             *
      * Calls    : SRSSET - Set-up other fields for Detail Processing *
      *            SRSREV - Select Records from Review Fields         *
      *****************************************************************
     C           SRPROC    BEGSR
      *
      ** Save review from field and select authorised field
      *
     C                     MOVE SRCUS     WRCUS   6
     C                     MOVE SRFCT     WRFCT   3
     C                     MOVE SRFCN     WRFCN   2
     C                     MOVE SRLON     WRLON   6
     C                     MOVE SRSEQ     WRSEQ   2
     C                     MOVE SRAUT     WRAUT   1
      *
      ** Read changed records in subfile
      *
     C           *IN12     IFEQ '0'
     C                     READCLE2210S0                 81
     C                     MOVE 'D1'      WFMT
     C                     ELSE
     C                     MOVE '1'       *IN81
     C                     ENDIF
      *
     C           *IN81     DOWEQ'0'
     C           WFMT      ANDNE*BLANK
     C           WFMT      ANDNE'S0'
      *
      ** Set-up other fields for Detail Processing
      *
     C                     EXSR SRSSET
      *
     C           WFMT      DOUEQ'F0'
     C           WFMT      OREQ 'S0'
     C           WFMT      OREQ *BLANK
     C           WFMT      OREQ 'SP'
      *
     C           WFMT      CASEQ'D1'      SRDET1
     C           WFMT      CASEQ'D2'      SRDET2
     C           WFMT      CASEQ'WR'      SRWRIT
     C           WFMT      CASEQ'UP'      SRUPDT
     C                     ENDCS
     C                     ENDDO
      *
      ** Blank out selection field
      *
     C                     MOVE *BLANK    SBSEL
     C                     UPDATLE2210S0
      *
      ** Reset WFMT indicator and Read next change record
      *
     C           WFMT      IFNE *BLANK
     C           WFMT      ANDNE'S0'
     C                     MOVE 'D1'      WFMT
     C                     READCLE2210S0                 81
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     MOVE WRCUS     SRCUS
     C                     MOVE WRFCT     SRFCT
     C                     MOVE WRFCN     SRFCN
     C                     MOVE WRLON     SRLON
     C                     MOVE WRSEQ     SRSEQ
     C                     MOVE WRAUT     SRAUT
      *
      ** Reload subfile if no more changed record to read
      *
     C           *IN81     IFEQ '1'
      *
     C                     EXSR SRSREV
      *
     C           *IN35     IFEQ '0'
     C           *IN36     ANDEQ'0'
     C           *IN37     ANDEQ'0'
     C           *IN38     ANDEQ'0'
     C           *IN39     ANDEQ'0'
     C                     Z-ADDSRRN      WSRRN
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVE *BLANK    WWBACK  2
     C           WFMT      IFNE *BLANK
     C                     MOVE 'S0'      WFMT
     C                     ENDIF
     C                     Z-ADD1         SRECN
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSSET  -  Set-up other fields for Detail Processing          *
      * Called by: SRPROC                                             *
      * Calls    : SRINS1 - Initialise all screen fields              *
      *            TRSFS  - Format record fields for screen display   *
      *            SRFTYP - Subroutine to set up Fee type             *
      *            SRVALF - Validate Detail Screen Fields             *
      *            SRAVAL - Additional Val. Dependent on Settl. Ins.  *
      *****************************************************************
     C           SRSSET    BEGSR
      *
     C                     EXSR SRINS1
     C                     MOVE '0'       *IN22
     C                     MOVEA'000'     *IN,26
      *
     C           PMODE     IFNE 'F'                                       CAP064
     C                     MOVE SBSEL     SFLCHT
     C                     ENDIF                                          CAP064
     C                     MOVE SBCNUM    SFCNUM
     C                     MOVE SBCNUM    WCNUM
     C           SBFLIN    IFEQ 'F'
     C                     MOVELSBFALO    WBFACL  5
     C                     MOVELWBFACL    SFFACT
     C                     MOVE WBFACL    SFFCNO
     C                     MOVE WBFACL    WFAC05
     C                     ELSE
     C                     MOVE SBFALO    SFLNRF
     C                     MOVE SBFALO    WLOAN
     C********** WLOAN     IFNE 0                                                      207629 CLE148
     C           WLOAN     IFNE *BLANKS                                                       CLE148
     C           KEY004    CHAINCLOAN                74                                       207629
     C           *IN74     IFEQ '0'                                                           207629
     C           PPCUST    ANDEQ'O'                                                           207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C                     MOVE OLNO      SFCNUM                                              207629
     C                     MOVE CNUM      WCNUM                                               207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF
     C                     MOVE SBFSEQ    SFFSEQ
     C                     MOVE SBFSEQ    WFSEQ
     C                     MOVE 'SP'      WWBACK
      *
      ** Retrieve records on file
      *
     C           PMODE     IFNE 'F'                                       CAP064
      *                                                                   CAP064
     C           KEY002    CHAINLEFEEDF             N78
     C           *IN78     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'LEFEED'  DBFILE           ************
     C                     Z-ADD15        DBASE            * DBERR 15 *
     C                     MOVELWFPKEY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     EXSR TRSFS
     C                     Z-ADDFETNLU    WTNLU
      *
     C           WFAC05    IFEQ 0
     C           KEY004    CHAINCLOAN                78
     C           *IN78     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'CLOAN'   DBFILE           ************
     C                     Z-ADD16        DBASE            * DBERR 16 *
     C                     MOVELWLOAN     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     MOVE BRCA      WBKBRC
      *
     C                     ELSE
      *
     C           KEY001    CHAINFCLTY                78
     C           *IN78     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTY'   DBFILE           ************
     C                     Z-ADD17        DBASE            * DBERR 17 *
     C                     MOVELWCNUM     DBKEY            ************
     C                     MOVELWFAC03    FACKEY  5
     C                     MOVE WFAC02    FACKEY
     C                     MOVE FACKEY    DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     MOVE BRCA      WBKBRC
     C                     ENDIF
      *
      ** Retrieve record from Invalid File if Repair mode                 CAP064
     C                     ELSE                                           CAP064
     C                     EXSR SSINV                                     CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      ** Set the protect indicators depending upon details.
      ** Not relevant if in Repair Mode.                                  CAP064
     C           PMODE     IFNE 'F'                                       CAP064
      *
     C           FEPSTD    IFLT BJRDNB
     C           FEORED    ANDNEBJRDNB
     C           FEAUTO    IFEQ 'Y'
     C           FECALT    ANDEQ*BLANKS
     C                     MOVE '1'       *IN79
     C                     ENDIF
     C           FEPYON    IFEQ 'S'
     C                     MOVE '1'       *IN84
     C                     ENDIF
     C           FEPYON    IFEQ 'E'
     C                     MOVE '1'       *IN85
     C                     ENDIF
     C           FECALT    IFNE *BLANKS
     C                     MOVE '1'       *IN77
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** If the facility is blank then non display field Facility
      *
     C           WFACL     IFEQ *BLANKS
     C           WFACL     OREQ *ZEROS
     C                     MOVE '1'       *IN68
     C                     ENDIF
      *
      **  Otherwise non display the loan number as this is blank
      *
     C           SFLNRF    IFEQ *BLANKS
     C           SFLNRF    OREQ *ZEROS
     C                     MOVE '1'       *IN69
     C                     ENDIF
      *
      ** Set up Status field
      *
     C           SFLCHT    IFNE 'I'
     C           FERECI    IFNE 'M'
     C                     SELEC
     C           FEFSTS    WHEQ 'C'
     C                     MOVEL'LER0194' ZAMSID
     C           FEFSTS    WHEQ 'R'
     C                     MOVEL'LER0195' ZAMSID
     C           FEFSTS    WHEQ 'A'
     C                     MOVEL'LER0196' ZAMSID
     C           FEFSTS    WHEQ 'D'
     C                     MOVEL'LER0197' ZAMSID
     C                     ENDSL
      *
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SSTAT
     C                     MOVE *BLANKS   ZAMSID
      *
     C                     ENDIF
     C                     ELSE
     C                     MOVE *BLANK    SSTAT
     C                     ENDIF
      *
      **  Set up Fee type
      *
     C                     EXSR SRFTYP
      *
     C                     ENDIF                                          CAP064
      ** Enable F14 (for Settlements) if not Internal Fee
      *
     C           WPTFI     IFNE 'I'
     C                     MOVE '1'       *IN28
     C                     ENDIF
      *
      ** Protect all screen fields for Enquire
      *
     C           SFLCHT    IFEQ 'E'
     C                     MOVE '1'       *IN22
     C                     ENDIF
      *
      ** Protect all screen fields, enable F11 for Authorise
      ** also validate screen fields before display
      *
     C           SFLCHT    IFEQ 'X'
     C                     MOVE '1'       *IN22
      *
      **  Enable F11 only if BPAURV is not activated
      *
     C           BPAURV    IFNE 'Y'
     C                     MOVE '1'       *IN26
     C                     ENDIF
      *
     C                     EXSR SRVALF
     C                     EXSR SRAVAL
     C                     ENDIF
      *
      ** Protect all screen fields, enable F10 for Delete
      *
     C           SFLCHT    IFEQ 'D'
     C                     MOVE '1'       *IN22
     C                     MOVE '1'       *IN27
     C                     ENDIF
      *
     C           SFLCHT    IFEQ 'A'
     C           PMODE     OREQ 'F'                                       CAP064
     C           BKPRCA    IFEQ 'Y'
     C                     MOVE '1'       *IN71
     C                     ELSE
     C                     MOVE '0'       *IN71
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRREVW  -  Set Loan no. from Review from                      *
      * Called by: SRSUBF, SRSREV                                     *
      * Calls    : None                                               *
      *****************************************************************
     C           SRREVW    BEGSR
      *
      ** Set default value for Req. authorisation,
      ** and Review from field
      *
     C           SRAUT     IFEQ *BLANK
     C           PMODE     ANDNE'F'                                       CAP064
     C                     MOVE 'N'       SRAUT
     C                     ENDIF
      *
     C           SRCUS     IFEQ *BLANK
     C**********           Z-ADD0         WKCUS                                               CSD027
     C                     MOVE *BLANKS   WKCUS                                               CSD027
     C                     ELSE
     C                     MOVE SRCUS     WKCUS
     C                     ENDIF
      *
     C                     MOVELSRFCT     WFREF
     C                     MOVE SRFCN     WFREF
     C           WFREF     IFEQ *BLANK
     C                     Z-ADD0         WKFAC
     C                     ELSE
     C                     MOVE WFREF     WKFAC
     C                     ENDIF
      *
     C           SRLON     IFEQ *BLANK
     C**********           Z-ADD0         WKLON                                               CLE148
     C                     MOVEL*BLANKS   WKLON                                               CLE148
     C                     ELSE
     C                     MOVE SRLON     WKLON
     C                     ENDIF
      *
     C           SRSEQ     IFEQ *BLANK
     C                     Z-ADD0         WKSEQ
     C                     ELSE
     C                     MOVE SRSEQ     WKSEQ
     C                     ENDIF
      *
     C           PMODE     IFEQ 'F'                                       CAP064
     C           KSFEED    SETLLLEIFEEP1                                  CAP064
     C                     READ LEIFEEP1                 80               CAP064
     C                     ELSE                                           CAP064
     C           SRAUT     IFEQ 'Y'
     C           KSFEED    SETLLLEFEEDL3
     C                     READ LEFEEDL3                 80
     C                     ELSE
     C           KSFEED    SETLLLEFEEDL0
     C                     READ LEFEEDL0                 80
     C                     ENDIF
     C                     ENDIF                                          CAP064
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRSREV  -  Select records from Review fields                  *
      * Called by: SRSUBF, SRPROC                                     *
      * Calls    : SRVALR - Validate Review Fields                    *
      *            SRSINS - Initialise all Screen Fields              *
      *            SRSCLR - Subfile Clear                             *
      *            SRREVW - Set Loan no. from Review from             *
      *            SRLOAD - Load Subfile Records                      *
      *****************************************************************
     C           SRSREV    BEGSR
      *
     C                     MOVEA'00000'   *IN,35
      *
      ** Validate Review fields
      *
     C                     EXSR SRVALR
      *
      ** Initialise and Clear subfile for reload
      *
     C           *IN35     IFEQ '0'
     C           *IN36     ANDEQ'0'
     C           *IN37     ANDEQ'0'
     C           *IN38     ANDEQ'0'
     C           *IN39     ANDEQ'0'
     C                     EXSR SRSINS
     C                     EXSR SRSCLR
     C                     EXSR SRREVW
     C                     EXSR SRLOAD
     C                     MOVE SCRREV    SAVREV
     C                     Z-ADD1         SRECN
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *  CUSTDT - Subroutine to access customer details file          *
      *  Called by: VALINP, VALAMD, VALDEL, VALENQ                    *
      *  Calls    : None                                              *
      *****************************************************************
     C           CUSTDT    BEGSR
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM '*BLANKS' PRTCD
     C                     PARM '*KEY   ' POPTN
     C                     PARM           KEYC   10
     C                     PARM *BLANKS   KEYSTS  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           PRTCD     IFEQ *BLANKS                                   154113
     C                     MOVE BBCUST    W#CUST  6                       154113
     C                     ENDIF                                          154113
      *                                                                   154113
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *  SRINS1  - Resets screen error indicators and msgq            *
      *            And all screen fields and work fields              *
      *  Called by: SRSTRT, SRBTCH, SRSSET                            *
      *  Calls:     SCRNER - Resets screen error indicators and msgq  *
      *             CLEAR  - Clears message from the pgm msg queue    *
      *****************************************************************
     C           SRINS1    BEGSR
      *
     C                     MOVE USER      SUSER
     C                     MOVE BJMRDT    SRUNA
     C                     MOVE WSID      SWSID
     C           PMODE     IFNE 'F'                                       CAP064
     C           *IN25     IFEQ '0'
     C                     MOVE *BLANK    SFLCHT
     C                     ELSE
     C                     MOVE 'I'       SFLCHT
     C                     ENDIF
     C                     ENDIF                                          CAP064
     C           PMODE     IFNE 'F'                                       CAP064
     C                     MOVE 'N'       SRAUT
     C                     ENDIF                                          CAP064
      *
      ** Blank all screen input fields.
      *
     C                     MOVE *BLANKS   SFCNUM
     C                     MOVE *BLANKS   SFLNRF
     C                     MOVE *BLANKS   SFFACT
     C                     MOVE *BLANKS   SFFCNO
     C                     MOVE *BLANKS   SFFSEQ
     C                     MOVE *BLANKS   SFECOD
     C                     MOVE *BLANKS   SFECUR
     C                     MOVE *BLANKS   SFEAMT
     C                     MOVE *BLANKS   SFEPSD
     C                     MOVE *BLANKS   SFEPED
     C                     MOVE *BLANKS   SFEPON
     C                     MOVE *BLANKS   SFEADV
     C                     MOVE *BLANKS   SFRTE1
     C                     MOVE *BLANKS   SFRTE2
     C                     MOVE *BLANKS   SFRTE3
     C                     MOVE *BLANKS   SFRTE4
     C                     MOVE *BLANKS   SFRTE5
     C                     MOVE *BLANKS   SFAMT1
     C                     MOVE *BLANKS   SFAMT2
     C                     MOVE *BLANKS   SFAMT3
     C                     MOVE *BLANKS   SFAMT4
     C                     MOVE *BLANKS   SFAMT5
     C                     MOVE *BLANKS   SFCALC
     C                     MOVE *BLANKS   SFEXRT
     C                     MOVE *BLANKS   SFNPYD
     C                     MOVE *BLANKS   SFFREQ
     C                     MOVE *BLANKS   SFDYIM
     C                     MOVE *BLANKS   SFESGN
     C                     MOVE *BLANKS   SFCALT
     C                     MOVE *BLANKS   SFPIND
     C                     MOVE *BLANKS   SFMDIN
     C                     MOVE *BLANKS   SPRFC
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVEL*BLANKS   SFSTAL                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE *BLANKS   SRCUS
     C                     MOVE *BLANKS   SRFCT
     C                     MOVE *BLANKS   SRFCN
     C                     MOVE *BLANKS   SRLON
     C                     MOVE *BLANKS   SRSEQ
     C                     MOVE *BLANKS   ZAMSID
     C                     MOVE *BLANKS   SDET
     C                     MOVEA'00'      *IN,84
     C                     MOVE '0'       *IN77
     C                     Z-ADD0         WFAC05
     C**********           Z-ADD0         WLOAN                                               CLE148
     C                     MOVEL*BLANKS   WLOAN                                               CLE148
     C                     Z-ADD0         WFSEQ
     C                     Z-ADD0         WFRT1
     C                     Z-ADD0         WFRT2
     C                     Z-ADD0         WFRT3
     C                     Z-ADD0         WFRT4
     C                     Z-ADD0         WFRT5
     C                     Z-ADD0         WCAMT1
     C                     Z-ADD0         WCAMT2
     C                     Z-ADD0         WCAMT3
     C                     Z-ADD0         WCAMT4
     C                     Z-ADD0         WCAMT5
     C                     Z-ADD0         WCALC
     C                     Z-ADD0         WERAT
     C                     Z-ADD0         WDYIM
     C                     MOVE *BLANKS   WMDIN
     C                     MOVE *BLANKS   WPIND
     C                     MOVE *BLANKS   WFREQ
     C                     MOVE *BLANKS   WRKBRC
     C                     MOVE 'Y'       PMFRST
     C                     MOVE *BLANK    WWERR   1
     C                     MOVE *BLANK    WWFLG   1
     C                     MOVE *BLANKS   WSKIP   1
     C                     MOVE *BLANK    WACCPT  1
     C                     MOVE *BLANK    WSD     1
     C                     Z-ADD0         WPEND
     C                     Z-ADD0         WTNLU   50
      *
      ** Initialise the non display conditioning indicators
     C                     MOVEA'00'      *IN,68
      *
      ** Reset indicators.
     C                     EXSR SCRNER
     C                     EXSR CLEAR
      *
      ** Blank all program work fields.
     C**********           Z-ADD0         WFPKEY                                              CSD027
     C                     MOVE *BLANKS   WFPKEY                                              CSD027
      *                                                                   171462
      ** Initialise the 'Settlements Validated' flag                      171462
     C                     MOVE 'N'       #VALID  1                       171462
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *  SCRNER - Resets screen error indicators and msgq             *
      *  Called by: SRSTRT, SRDET1, SRINS1                            *
      *  Calls    : None                                              *
      *****************************************************************
     C           SCRNER    BEGSR
      *
      ** Reset all field error indicators.
      *
     C                     MOVEA'00000000'*IN,30
     C                     MOVEA'00000000'*IN,38
     C                     MOVEA'00000000'*IN,46
     C                     MOVEA'00000000'*IN,54
     C                     MOVEA'000000'  *IN,62
     C                     MOVE '0'       *IN73
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRUAUT  -  Check if user is authorised to the action          *
      * Called by: VALINP - Validate Input key                        *
      *            VALAMD - Validate Amend and Authorise Key          *
      *            VALDEL - Validate Delete Key                       *
      *            VALENQ - Validate Enquire Key                      *
      * Calls    : none                                               *
      *****************************************************************
      *
     C           SRUAUT    BEGSR
      *
      ** If single branch system, check user is authorised to action.
      *
     C           MBIN      IFEQ 'N'
     C           PMODE     IFEQ 'B'
     C/COPY WNCPYSRC,LEH00536
     C                     CALL 'ZBACTU'
     C                     PARM SFLCHT    WZACTN
     C                     PARM           WUSER  10
     C**********           PARM           WZMGRP  40                                          CSF002
     C**********           PARM           WZICDE  4                                           CSF002
     C                     PARM           UNQCDE 10                                           CSF002
     C                     PARM           WERR
     C                     ELSE
     C                     CALL 'ZVACTU'
     C                     PARM SFLCHT    WZACTN  1
     C                     PARM           WERR    10
     C                     ENDIF
      *
     C           WERR      IFNE 0
     C                     MOVE '1'       *IN30
     C                     MOVEL'LER0123' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** If multiple branch system, user must be authorised to action
      ** on branch
     C           MBIN      IFEQ 'Y'
     C           WERRF     ANDEQ*BLANK
      *
     C           PMODE     IFEQ 'B'
     C/COPY WNCPYSRC,LEH00537
     C                     CALL 'ZBACTBU'
     C                     PARM SFLCHT    WZACTN
     C                     PARM WZBRCA    WZBR
     C                     PARM           WUSER  10
     C**********           PARM           WZMGRP  40                                          CSF002
     C**********           PARM           WZICDE  4                                           CSF002
     C                     PARM           UNQCDE 10                                           CSF002
     C                     PARM           WERR
     C                     ELSE
     C                     CALL 'ZVACTBU'
     C                     PARM SFLCHT    WZACTN
     C                     PARM WZBRCA    WZBR    3
     C                     PARM           WERR
     C                     ENDIF
      *
     C           WERR      IFEQ 1
     C                     MOVE '1'       *IN30
     C                     MOVEL'LER0121' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
      *
     C           WERR      IFEQ 2
     C                     MOVE '1'       *IN30
     C                     MOVEL'LER0122' ZAMSID
     C                     EXSR SREROR
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRTEXT  -  Set up text from message file                      *
      * Called by: All subroutines setting of texts                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRTEXT    BEGSR
      *
     C                     CALL 'Y2RVMGC'
     C                     PARM *BLANKS   PRTCD
     C                     PARM           ZAMSID           Message Id.
     C                     PARM           ZAMSGF           Message file.
     C                     PARM           ZAMSDA           Message data.
     C                     PARM           ZAMSTX           Messge text
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * ZASNMS  - Sends messages to the program's message queue       *
      * Called by: SREROR - Error processing                          *
      * Calls    : none                                               *
      *****************************************************************
      *
     C           ZASNMS    BEGSR
      *
     C           PMODE     IFEQ 'B'                                       CAP064
     C           PMODE     OREQ 'P'                                       CAP064
     C/COPY WNCPYSRC,LEH00538
     C                     EXSR SRBERR                                    CAP064
      *                                                                   CAP064
     C                     ELSE                                           CAP064
     C           ZAPGMQ    IFEQ *BLANK                                    CAP064
     C                     MOVEL##PGM     ZAPGMQ                          CAP064
     C                     END                                            CAP064
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message Id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C                     PARM           ZAMSTP  7        Message type.
     C                     ENDIF                                          CAP064
      *
     C                     ENDSR
      /EJECT
      /TITLE Validate Next Payment Date                                                       CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      ***SRNXTP*-*Set*EIR*Indicators*to*re-calculate.******************                CAS009 CAS011
      *  SRNXT2 - Set EIR Indicators to re-calculate.                 *                       CAS011
      *                                                               *                       CAS009
      *  Called By: SRCATP                                            *                       CAS009
      *  Calls:                                                       *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
      *                                                                                       CAS009
     C********** SRNXTP    BEGSR                                                       CAS009 CAS011
     C           SRNXT2    BEGSR                                                              CAS009
      *                                                                                       CAS009
      ** Next Payment Date                                                                    CAS009
      *                                                                                       CAS009
      ** If date not entered and payment on *EQ to N                                          CAS009
      *                                                                                       CAS009
     C           SFNPYD    IFEQ *BLANKS                                                       CAS009
     C           SFEPON    IFEQ 'N'                                                           CAS009
     C                     MOVE '1'       *IN64                                               CAS009
     C                     MOVEL'LER0060' ZAMSID                                              CAS009
     C                     EXSR SREROR                                                        CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           SFCALT    IFEQ *BLANKS                                                       CAS009
     C           WNXTPY    ANDNE*BLANKS                                                       CAS009
     C           SFEPON    IFNE 'N'                                                           CAS009
     C           SFNPYD    IFNE *BLANK                                                        CAS009
     C                     MOVE *ON       *IN64                                               CAS009
     C                     ENDIF                                                              CAS009
     C           SFFREQ    IFNE *BLANK                                                        CAS009
     C                     MOVE *ON       *IN65                                               CAS009
     C                     ENDIF                                                              CAS009
     C           SFDYIM    IFNE *BLANK                                                        CAS009
     C                     MOVE *ON       *IN66                                               CAS009
     C                     ENDIF                                                              CAS009
     C**********           MOVEL'LEV1069' ZAMSID                                       CAS009 CAS011
     C                     MOVEL'LEV1074' ZAMSID                                              CAS011
     C                     EXSR SREROR                                                        CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           SFNPYD    IFNE *BLANKS                                                       CAS009
     C                     MOVE '0'       TEST6                                               CAS009
     C                     MOVELSFNPYD    TEST6                                               CAS009
     C                     TESTN          TEST6      78                                       CAS009
      *                                                                                       CAS009
      ** Check for valid date if numeric                                                      CAS009
      *                                                                                       CAS009
     C           *IN78     IFEQ '1'                                                           CAS009
     C                     MOVE '0'       *IN99                                               CAS009
     C                     MOVE SFNPYD    ZDATE                                               CAS009
     C                     EXSR ZDATE1                                                        CAS009
      *                                                                                       CAS009
      ** Error in date conversion                                                             CAS009
      *                                                                                       CAS009
     C           *IN99     IFEQ '1'                                                           CAS009
     C                     MOVE '1'       GRTCD                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE '1'       GRTCD                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Error if grtcd = 1                                                                   CAS009
      *                                                                                       CAS009
     C           GRTCD     IFEQ '1'                                                           CAS009
     C           *IN99     OREQ '1'                                                           CAS009
     C                     MOVE '1'       *IN64                                               CAS009
     C                     MOVEL'LER0061' ZAMSID                                              CAS009
     C                     EXSR SREROR                                                        CAS009
     C                     ELSE                                                               CAS009
     C                     Z-ADDZDAYNO    WNPYD                                               CAS009
      *                                                                                       CAS009
      ** If date entered and *LT last payment date then error                                 CAS009
      *                                                                                       CAS009
     C           SFLCHT    IFEQ 'A'                                                           CAS009
     C           WNPYD     ANDLTFELPDT                                                        CAS009
     C                     MOVE '1'       *IN64                                               CAS009
     C                     MOVEL'LER0062' ZAMSID                                              CAS009
     C                     EXSR SREROR                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** If date entered and payment on *NE to N                                              CAS009
      *                                                                                       CAS009
     C           SFEPON    IFNE 'N'                                                           CAS009
     C                     MOVE '1'       *IN64                                               CAS009
     C                     MOVEL'LER0060' ZAMSID                                              CAS009
     C                     EXSR SREROR                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           WPSTD     IFGE WNPYD                                                         CAS009
     C                     MOVE '1'       *IN64                                               CAS009
     C                     MOVEL'LER0061' ZAMSID                                              CAS009
     C                     EXSR SREROR                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           WPEND     IFLT WNPYD                                                         CAS009
     C                     MOVE '1'       *IN64                                               CAS009
     C                     MOVEL'LER0099' ZAMSID                                              CAS009
     C                     EXSR SREROR                                                        CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ELSE                                                               CAS009
     C                     Z-ADD0         WNPYD                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Frequency of Payment                                                                 CAS009
      *                                                                                       CAS009
     C                     MOVE *BLANKS   WFREQ                                               CAS009
     C           SFFREQ    IFNE *BLANKS                                                       CAS009
      *                                                                                       CAS009
     C           SFFREQ    IFEQ 'M'                                                           CAS009
     C           SFFREQ    OREQ 'Q'                                                           CAS009
     C           SFFREQ    OREQ 'X'                                                           CAS009
     C           SFFREQ    OREQ 'Y'                                                           CAS009
     C           SFFREQ    OREQ 'D'                                                           CLE064
     C           SFFREQ    OREQ 'W'                                                           CLE064
     C           SFFREQ    OREQ 'F'                                                           CLE064
     C           SFFREQ    OREQ 'T'                                                           CLE064
     C           SFFREQ    OREQ '4'                                                           CLE064
     C           SFFREQ    OREQ '5'                                                           CLE064
     C           SFFREQ    OREQ '7'                                                           CLE064
     C           SFFREQ    OREQ '8'                                                           CLE064
     C           SFFREQ    OREQ '9'                                                           CLE064
     C           SFFREQ    OREQ 'V'                                                           CLE064
     C           SFFREQ    OREQ 'E'                                                           CLE064
     C           SFFREQ    OREQ 'C'                                                           CLE064
     C           SFFREQ    OREQ 'I'                                                           CLE064
     C           SFFREQ    OREQ 'J'                                                           CLE064
     C           SFFREQ    OREQ 'N'                                                           CLE064
     C           SFFREQ    OREQ 'U'                                                           CLE064
     C                     MOVE SFFREQ    WFREQ                                               CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE '1'       *IN65                                               CAS009
     C**********           MOVEL'LER0064' ZAMSID                                       CAS009 CLE064
     C                     MOVEL'LER5611' ZAMSID                                              CLE064
     C                     EXSR SREROR                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** If next payment date is not entered then freq. cannot be                             CAS009
      ** entered                                                                              CAS009
      *                                                                                       CAS009
     C           WNPYD     IFEQ 0                                                             CAS009
     C           GRTCD     ANDNE'1'                                                           CAS009
     C                     MOVE '1'       *IN65                                               CAS009
     C                     MOVEL'LER0100' ZAMSID                                              CAS009
     C                     EXSR SREROR                                                        CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** If next payment date is entered then freq. must be entered                           CAS009
      *                                                                                       CAS009
     C           SFFREQ    IFEQ *BLANK                                                        CAS009
     C           GRTCD     ANDNE'1'                                                           CAS009
      *                                                                                       CAS009
     C           WNPYD     IFEQ WPEND                                                         CAS009
     C           WNPYD     OREQ 0                                                             CAS009
     C           WNPYD     ORGT 0                                                             CAS009
     C           SFEPON    ANDEQ'N'                                                           CAS009
     C           WPEND     ANDGT0                                                             CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE '1'       *IN65                                               CAS009
     C                     MOVEL'LER0141' ZAMSID                                              CAS009
     C                     EXSR SREROR                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Day in month                                                                         CAS009
      *                                                                                       CAS009
     C                     Z-ADD0         WDYIM                                               CAS009
     C           SFDYIM    IFNE *BLANKS                                                       CAS009
      *                                                                                       CAS009
      ** Frequency must be entered                                                            CAS009
      *                                                                                       CAS009
     C           SFFREQ    IFEQ *BLANKS                                                       CAS009
     C                     MOVE '1'       *IN65                                               CAS009
     C                     MOVE '1'       *IN66                                               CAS009
     C                     MOVEL'LER0065' ZAMSID                                              CAS009
     C                     EXSR SREROR                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Must be between 1 & 31                                                               CAS009
      *                                                                                       CAS009
     C                     MOVE '0'       TEST2                                               CAS009
     C                     MOVELSFDYIM    TEST2                                               CAS009
     C                     TESTN          TEST2      78                                       CAS009
     C                     MOVE SFDYIM    WDYIM                                               CAS009
     C           *IN78     IFEQ '1'                                                           CAS009
     C           WDYIM     ANDGT0                                                             CAS009
     C           WDYIM     ANDLT32                                                            CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE '1'       *IN66                                               CAS009
     C                     MOVEL'LER0066' ZAMSID                                              CAS009
     C                     EXSR SREROR                                                        CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** If day in month not entered then default to day of                                   CAS009
      ** next payment                                                                         CAS009
      *                                                                                       CAS009
     C           SFDYIM    IFEQ *BLANK                                                        CAS009
     C           GRTCD     ANDNE'1'                                                           CAS009
     C           WNPYD     ANDNE0                                                             CAS009
     C           SFFREQ    ANDNE*BLANKS                                                       CAS009
     C           *IN98     IFEQ '0'                                                           CAS009
     C                     MOVELSFNPYD    WDYIM                                               CAS009
     C                     ELSE                                                               CAS009
     C                     MOVELSFNPYD    WRKRP   40                                          CAS009
     C                     MOVE WRKRP     WDYIM                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      **  Ensure next Next Payment Date is not after End Date                                 CAS009
      *                                                                                       CAS009
     C           WDYIM     IFGT 0                                                             CAS009
     C           WNPYD     ANDNE*ZEROS                                                        CAS009
     C           WPEND     ANDNE*ZEROS                                                        CAS009
     C           WFREQ     ANDNE*BLANKS                                                       CAS009
     C           WCCY      ANDNE*BLANKS                                                       CAS009
     C                     MOVE '0'       *IN99                                               CAS009
     C                     MOVE WNPYD     ZDAYNO                                              CAS009
     C                     MOVE WFREQ     ZFREQ                                               CAS009
     C                     MOVE WDYIM     ZMDAY                                               CAS009
     C                     MOVE WCCY      ZCCY                                                CAS009
     C                     MOVE *BLANKS   ZLOC                                                CAS009
     C                     EXSR ZFREQB                                                        CAS009
     C           ZZERR@    IFEQ '*ERROR '                                                     CAS009
     C           ZDAYNO    ORGT WPEND                                                         CAS009
     C                     MOVE '1'       *IN65                                               CAS009
     C                     MOVE '1'       *IN66                                               CAS009
     C                     MOVEL'LER0142' ZAMSID                                              CAS009
     C                     EXSR SREROR                                                        CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      *                                                                                       CAS009
      *****************************************************************                       CAS009
      /TITLE Update EIR                                                                       CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  UPDEIR - Update EIR info.                                    *                       CAS009
      *                                                               *                       CAS009
      *  Called By: SRWRIT, SRUPDT                                    *                       CAS009
      *  Calls: CNVF2L, SEIRI2                                        *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
      *                                                                                       CAS009
     C           UPDEIR    BEGSR                                                              CAS009
      *                                                                                       CAS009
     C**********           MOVE 'D'       Z9KYID                                       CAS009 232314
     C**********           Z-ADDWLOAN     Z9LNRF                                       CAS009 232314
      *****************************************************************                CAS009 232314
     C********** Z9KEY     CHAINZ9LNCLF              86                                CAS009 232314
      *****************************************************************                CAS009 232314
     C********** *IN86     IFEQ '0'                                                    CAS009 232314
      *****************************************************************                CAS009 232314
     C**********           Z-ADDWFAMT     WCFAMT 150                                   CAS009 232314
     C**********           Z-ADDFEFAMT    WOFAMT 150                                   CAS009 232314
      *****************************************************************                CAS009 232314
     C********** WCCY      IFNE Z9CCY                                                  CAS009 232314
     C**********           Z-ADDWFAMT     ZAMTCI                                       CAS009 232314
     C**********           EXSR CNVF2L                                                 CAS009 232314
     C**********           Z-ADDZAMTCO    WCFAMT                                       CAS009 232314
      *****************************************************************                CAS009 232314
     C**********           Z-ADDFEFAMT    ZAMTCI                                       CAS009 232314
     C**********           EXSR CNVF2L                                                 CAS009 232314
     C**********           Z-ADDZAMTCO    WOFAMT                                       CAS009 232314
     C**********           ENDIF                                                       CAS009 232314
      *****************************************************************                CAS009 232314
     C**********           SELEC                                                       CAS009 232314
      *****************************************************************                CAS009 232314
     C********** SFLCHT    WHEQ 'I'                                                    CAS009 232314
     C********** WFAMT     ANDNE0                                                      CAS009 232314
      *****************************************************************                CAS009 232314
     C**********           ADD  WCFAMT    Z9TFDP                                       CAS009 232314
      *****************************************************************                CAS009 232314
     C********** WADJY     IFEQ 'Y'                                                    CAS009 232314
     C**********           ADD  WCFAMT    Z9FDPA                                       CAS009 232314
     C**********           ENDIF                                                       CAS009 232314
      *****************************************************************                CAS009 232314
     C********** SFLCHT    WHEQ 'A'                                                    CAS009 232314
      *****************************************************************                CAS009 232314
     C********** WOFAMT    IFNE WCFAMT                                                 CAS009 232314
     C********** WADJY     ORNE FEADJY                                                 CAS009 232314
     C**********           SUB  WOFAMT    Z9TFDP                                       CAS009 232314
     C**********           ADD  WCFAMT    Z9TFDP                                       CAS009 232314
     C********** FEADJY    IFEQ 'Y'                                                    CAS009 232314
     C**********           SUB  WOFAMT    Z9FDPA                                       CAS009 232314
     C**********           ENDIF                                                       CAS009 232314
     C********** WADJY     IFEQ 'Y'                                                    CAS009 232314
     C**********           ADD  WCFAMT    Z9FDPA                                       CAS009 232314
     C**********           ENDIF                                                       CAS009 232314
     C**********           ENDIF                                                       CAS009 232314
      *****************************************************************                CAS009 232314
     C********** SFLCHT    WHEQ 'D'                                                    CAS009 232314
      *****************************************************************                CAS009 232314
     C**********           SUB  WOFAMT    Z9TFDP                                       CAS009 232314
      *****************************************************************                CAS009 232314
     C********** WADJY     IFEQ 'Y'                                                    CAS009 232314
     C**********           SUB  WOFAMT    Z9FDPA                                       CAS009 232314
     C**********           ENDIF                                                       CAS009 232314
      *****************************************************************                CAS009 232314
     C**********           ENDSL                                                       CAS009 232314
      *****************************************************************                CAS009 232314
     C**********           UPDATZ9LNCLF                                                CAS009 232314
     C**********           ENDIF                                                       CAS009 232314
      *                                                                                       CAS009
     C           WADJY     IFEQ 'Y'                                                           CAS009
     C**********           Z-ADDWLOAN     WTRAN   60                                   CAS009 CLE148
     C                     MOVELWLOAN     WTRAN   6                                           CLE148
     C                     Z-ADDWPSTD     WVALD   50                                          CAS009
     C                     EXSR SEIRI2                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      *                                                                                       CAS009
      *****************************************************************                       CAS009
      /TITLE Convert Amount                                                                   CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  CNVF2L - Convert from Fee currency to Loan currency          *                       CAS009
      *                                                               *                       CAS009
      *  Called By: UPDEIR                                            *                       CAS009
      *  Calls:                                                       *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
      *                                                                                       CAS009
     C********** CNVF2L    BEGSR                                                       CAS009 232314
      *****************************************************************                CAS009 232314
     C**********           CALL 'AOCURRR0'                                             CAS009 232314
     C**********           PARM *BLANKS   PRTCD                                        CAS009 232314
     C**********           PARM '*KEY   ' POPTN                                        CAS009 232314
     C**********           PARM Z9CCY     K101                                         CAS009 232314
     C********** SDCURR    PARM SDCURR    DSSDY                                        CAS009 232314
      *****************************************************************                CAS009 232314
     C**********           Z-ADDA6SPRT    WLONRT 138                                   CAS009 232314
     C**********           MOVE A6MDIN    WLONMD  1                                    CAS009 232314
     C**********           Z-ADDA6NBDP    WLONDP  10                                   CAS009 232314
      *****************************************************************                CAS009 232314
     C**********           Z-ADDWFEERT    ZRATE1                                       CAS009 232314
     C**********           MOVE WFEEMD    ZMDI1                                        CAS009 232314
     C**********           Z-ADDWLONRT    ZRATE2                                       CAS009 232314
     C**********           MOVE WLONMD    ZMDI2                                        CAS009 232314
     C**********           EXSR ZXRATE                                                 CAS009 232314
     C**********           Z-ADDZRATEX    ZEXCH                                        CAS009 232314
     C**********           MOVE ZMDIX     ZMD                                          CAS009 232314
      *****************************************************************                CAS009 232314
     C**********           CALL 'ZCONVZ1'                                              CAS009 232314
     C**********           PARM           ZAMTCI 150                                   CAS009 232314
     C**********           PARM           ZEXCH  138                                   CAS009 232314
     C**********           PARM           ZMD     1                                    CAS009 232314
     C**********           PARM WCCY      ZCCYI   3                                    CAS009 232314
     C**********           PARM Z9CCY     ZCCYO   3                                    CAS009 232314
     C**********           PARM WFEEDP    ZCDPI   10                                   CAS009 232314
     C**********           PARM WLONDP    ZCDPO   10                                   CAS009 232314
     C**********           PARM           ZAMTCO 150                                   CAS009 232314
      *****************************************************************                CAS009 232314
     C**********           ENDSR                                                       CAS009 232314
      *                                                                                       CAS009
      *****************************************************************                       CAS009
      /TITLE Set EIR Indicators                                                               CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  SEIRI2 - Set EIR Indicators to re-calculate.                 *                       CAS009
      *                                                               *                       CAS009
      *  Called By: UPDEIR                                            *                       CAS009
      *  Calls:                                                       *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
      *                                                                                       CAS009
     C           SEIRI2    BEGSR                                                              CAS009
      *                                                                                       CAS009
     C                     MOVE *IN81     SVIN81  1                                           CAS009
      *                                                                                       CAS009
     C           WTRAN     CHAINLEEIRDD5             81                                       CAS009
      *                                                                                       CAS009
     C           *IN81     IFEQ '0'                                                           CAS009
     C           WVALD     ANDLEEIENDT                                                        CAS009
      *                                                                                       CAS009
     C                     MOVE 'Y'       EIRCAL                                              CAS009
      *                                                                                       CAS009
     C                     UPDATLEEIRDD5                                                      CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     MOVE SVIN81    *IN81                                               CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      /EJECT                                                                                  CAS009
      *****************************************************************
      *  SRPOUT - Return message Format (For Batch only)              *
      *  Called by: SRINIT, SRBERR, *PSSR                             *
      *  Calls    : None                                              *
      *****************************************************************
     C           SRPOUT    BEGSR
      *
     C                     CLEARPOUTP
     C                     MOVE PIMTYP    POMTYP
     C                     MOVE WTUSR     POTUSR
     C                     MOVE WTWST     POTWST
     C                     MOVE WTREF     POTREF
     C                     MOVE WTSEQ     POTSEQ
     C                     MOVE SFLCHT    POTACT
     C                     MOVE WTDST     POTDST
     C                     MOVE WTTST     POTTST
     C                     MOVE PINRBT    PONRBT
     C                     MOVE PILTAC    POLTAC
     C                     MOVE PICNUM    POCNUM
     C                     MOVE PIFACT    POFACT
     C                     MOVE PIFCNO    POFCNO
     C                     MOVE PILNRF    POLNRF
     C           SFLCHT    IFEQ 'I'
     C                     MOVE WLSNA     POFSEQ
     C                     ELSE
     C                     MOVE SFFSEQ    POFSEQ
     C                     ENDIF
     C                     MOVE PIPTAI    POPTAI
     C                     MOVE POSMAC    POSMAC
      *                                                                                     AR868380
     C           ZAMSVR    IFEQ 'D'                                                         AR868380
     C                     CALL 'Y2RVMGC'                                                   AR868380
     C                     PARM           PRTCD                                             AR868380
     C                     PARM           ZAMSID                                            AR868380
     C                     PARM           ZAMSGF                                            AR868380
     C                     PARM           ZAMSDA                                            AR868380
     C                     PARM           ZAMSTX                                            AR868380
      *                                                                                     AR868380
     C           ZAMSID    IFNE *BLANK                                                      AR868380
     C                     MOVE ZAMSVR    POMSVR                                            AR868380
     C                     MOVELZAMSID    POMSID                                            AR868380
     C                     MOVELZAMSTX    POMSTX                                            AR868380
     C                     ENDIF                                                            AR868380
     C                     ENDIF                                                            AR868380
      *                                                                                     AR868380
     C                     ENDSR
      /EJECT
      *****************************************************************
      * CLEAR   -  Clears the message queue                           *
      * Called by: SRSTRT, SRDET1, SRSUBF, SRINS1                     *
      * Calls    : Y2CLMSC                                            *
      *****************************************************************
     C           CLEAR     BEGSR
      *
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
     C                     MOVE *BLANK    WERRF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SREROR  -  Error Processing                                   *
      * Called by: SRDET2, SRBTCH, VALERR, VALINP, VALAMD, VALDEL,    *
      *            VALENQ, SRVALF, SRCATP, RATE, AMNT, SRUPDT, SRVALR *
      *            SRAUTH, SRRTVT, SRBDET, SRAVAL, SRLOAD, SRSVAL     *
      * Calls    : ZASNMS - Send Error message                        *
      *            SRBERR - Send Error messages for Batch records     *
      *****************************************************************
     C           SREROR    BEGSR
      *
     C           PMODE     IFNE 'B'
     C           PMODE     ANDNE'P'
     C/COPY WNCPYSRC,LEH00539
      *
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     ENDIF
      *
     C                     EXSR ZASNMS
      *
     C           WWERR     IFEQ 'Y'
     C                     MOVE 'Y'       WWFLG   1
     C                     ELSE
     C                     MOVE 'Y'       WERRF   1
     C                     ENDIF
      *
      ** For Batch and Play mode, return message
      *
     C                     ELSE
     C                     EXSR SRBERR
     C                     ENDIF
      *
     C           ZAEXIT    ENDSR
      /EJECT
      *****************************************************************
      *  SRBERR - Sends error messages for Batch records              *
      *  Called by: SREROR                                            *
      *  Calls    : SRPOUT - Return message Format (For Batch only)   *
      *****************************************************************
     C           SRBERR    BEGSR
      *
     C                     CALL 'Y2RVMGC'
     C                     PARM           PRTCD
     C                     PARM           ZAMSID           Message Id.
     C                     PARM           ZAMSGF           Message file.
     C                     PARM           ZAMSDA           Message data.
     C                     PARM           ZAMSTX132        Messge text
      *
     C           WWERR     IFNE 'Y'
     C           PMODE     ANDNE'B'                                 132282
     C/COPY WNCPYSRC,LEH00540
     C                     ROLBK
     C                     ENDIF
      *
     C           PMODE     IFEQ 'B'
     C/COPY WNCPYSRC,LEH00541
     C                     EXSR SRPOUT
     C           WWERR     IFEQ 'Y'
     C                     MOVE 'W'       POMSVR
     C                     ELSE
     C                     MOVE 'E'       POMSVR
     C                     ENDIF
     C                     MOVELZAMSID    POMSID
     C                     MOVELZAMSTX    POMSTX
     C                     ENDIF
      *
     C           PMODE     IFEQ 'P'
      *
     C           WWERR     IFEQ 'Y'
     C                     MOVE 'W'       MSVR
     C                     ELSE
     C                     MOVE 'E'       MSVR
     C                     ENDIF
     C                     MOVELZAMSID    MSID
     C                     MOVELZAMSTX    MSTX
     C/COPY WNCPYSRC,LEH00895
     C                     UPDATLE2210D0
     C/COPY WNCPYSRC,LEH00896
     C                     ENDIF
      *
      *  Include DUMP here for problems during batch and play modes.
      *
     C***********WWERR     IFEQ 'Y'                                       131409
     C           WWERR     IFNE 'Y'                                       131409
      *                                                                   CAP064
      * If error and repair is in Back office then obtain next repair     CAP064
      * number                                                            CAP064
     C           POMSVR    IFEQ 'E'                                       CAP064
     C           PIPLC     ANDEQ'B'                                       CAP064
     C           CAP064    ANDEQ'Y'                                       CAP064
     C                     CALL 'LEC0215'                                 CAP064
     C                     PARM           XREPN                           CAP064
      *                                                                   CAP064
      * Set up remaining fields on LEIFEEPD.                              CAP064
     C                     MOVELZAMSID    XMSID                           CAP064
     C                     EXSR SRFLDM                                    CAP064
     C                     WRITELEIFEEDL                                  CAP064
      *                                                                   CSC011
      * If Support System active, write transaction to 24x7 log           CSC011
      *                                                                   CSC011
     C                     IN   SDSTAT                                    CSC011
     C                     IN   SC24X7                                    CSC011
      *                                                                   CSC011
     C           CSC011    IFEQ 'Y'                                       CSC011
     C           S1SUPP    ANDEQLIBR                                      CSC011
      *                                                                   CSC011
      * Convert facility to PINPP format                                  CSC011
     C                     EXSR LOG247                                    CSC011
      *                                                                   CSC011
      * Write invalid facility in PINPP format to 24x7 Log File           CSC011
     C                     MOVE 'I'       LOGVAL  1                       CSC011
     C                     EXSR APLGTR                                    CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     COMIT                                          CAP064
      *                                                                   CSC011
     C                     ELSE                                           CAP064
     C                     DUMP
     C                     ENDIF
     C                     ENDIF                                          CAP064
      *
     C           POMSVR    IFEQ 'E'                                       CAP064
     C           PMODE     ANDEQ'B'                                       CAP064
     C           PIPLC     ANDEQ'B'                                       CAP064
     C           CAP064    ANDEQ'Y'                                       CAP064
     C                     MOVE *BLANK    POMSVR                          CAP064
     C                     MOVE '1'       *INLR                           CAP064
     C                     RETRN                                          CAP064
     C                     ENDIF                                          CAP064
      *                                                                   CAP064
      ** If not a warning error, stop validation and return
      *
     C           POMSVR    IFEQ 'E'
     C           MSVR      OREQ 'E'
     C                     MOVE '1'       *INLR
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************   CAP064
      *  SRFLDM  -  Set Up remaining fields on LEIFEEPD that have not *   CAP064
      *             already been set up.                              *   CAP064
      *  Called by: SRBERR                                            *   CAP064
      *  Calls    : None                                              *   CAP064
      *****************************************************************   CAP064
     C           SRFLDM    BEGSR                                          CAP064
      *                                                                   CAP064
     C                     MOVE SFCNUM    FCNUM                           CAP064
     C                     MOVELSFFACT    FFACT                           CAP064
     C                     MOVE SFFCNO    FFACT                           CAP064
     C                     MOVE SFLNRF    FLNRF                           CAP064
     C                     MOVE SFFSEQ    FFSEQ                           CAP064
      *                                                                   CAP064
      * Change dates to MMDDDYY format.                                   CAP064
     C                     Z-ADDWPSTD     ZDAYNO                          CAP064
     C                     EXSR ZDATE2                                    CAP064
     C                     MOVE ZADATE    SFSTRD                          CAP064
     C                     Z-ADDWPEND     ZDAYNO                          CAP064
     C                     EXSR ZDATE2                                    CAP064
     C                     MOVE ZADATE    SFENDD                          CAP064
      * Branch                                                            CAP064
     C                     MOVE PIBRCA    SFBRCA                          CAP064
      * Input User                                                        CAP064
     C                     MOVE PIIUSR    SFIUSR                          CAP064
      * Amend User                                                        CAP064
     C                     MOVE PIAUSR    SFAUSR                          CAP064
      *                                                                   CAP064
     C                     MOVE PIPRFC    SPRFC                           CAP064
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVELPISTAL    SFSTAL                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      * Set up Setlement Details fields that were sent to SD2410 to       CAP064
      * be validated.                                                     CAP064
     C                     MOVE PMRSTM    SFRSTM                          CAP064
     C                     MOVE PMRONS    SFRONS                          CAP064
     C                     MOVE PAROBN    SFROBN                          CAP064
     C                     MOVE PAROCN    SFROCN                          CAP064
     C                     MOVE PARIBN    SFRIBN                          CAP064
     C                     MOVE PMRIBA    SFRIBA                          CAP064
     C                     MOVE PMPSTM    SFPSTM                          CAP064
     C                     MOVE PMPONS    SFPONS                          CAP064
     C                     MOVE PAPOBN    SFPOBN                          CAP064
     C                     MOVE PAPOCN    SFPOCN                          CAP064
     C                     MOVE PAPIBN    SFPIBN                          CAP064
     C                     MOVE PMPIBA    SFPIBA                          CAP064
     C                     MOVE PARCRN    SFRCRN                          CAP064
     C                     MOVE PMRCRA    SFRCRA                          CAP064
     C                     MOVE PARVNO    SFRVNO                          CAP064
     C                     MOVE PAAWBN    SFAWBN                          CAP064
     C                     MOVE PMAWBA    SFAWBA                          CAP064
     C                     MOVE PABENN    SFBENN                          CAP064
     C                     MOVE PMBENA    SFBENA                          CAP064
     C                     MOVE PMDTP1    SFDTP1                          CAP064
     C                     MOVE PMDTP2    SFDTP2                          CAP064
     C                     MOVE PMDTP3    SFDTP3                          CAP064
     C                     MOVE PMDTP4    SFDTP4                          CAP064
     C                     MOVE PMDCHG    SFDCHG                          CAP064
     C                     MOVE PMBTB1    SFBTB1                          CAP064
     C                     MOVE PMBTB2    SFBTB2                          CAP064
     C                     MOVE PMBTB3    SFBTB3                          CAP064
     C                     MOVE PMBTB4    SFBTB4                          CAP064
     C                     MOVE PMBTB5    SFBTB5                          CAP064
     C                     MOVE PMBTB6    SFBTB6                          CAP064
     C                     MOVE PMCVMR    SFCVMR                          CAP064
     C                     MOVE PMBTB6    SFBTB6                          CAP064
     C                     MOVE PMIC72    SFICCY                          CAP064
     C                     MOVE WTREF     STNRF                           CSC011
     C*                                                                   CSC011
     C           PITDST    IFEQ *BLANKS                                   CSC011
     C           PITTST    OREQ *BLANKS                                   CSC011
     C                     CALL 'ZAGENTS'                                 CSC011
     C                     PARM ZATMST    ZATMST 26                       CSC011
     C                     MOVE ZATMST    TSTISO                          CSC011
     C                     ELSE                                           CSC011
     C                     MOVE PITDST    WPITDS                          CSC011
     C                     MOVE WPIDD     TSTDD                           CSC011
     C                     MOVE WPIMM     TSTMM                           CSC011
     C                     MOVELWPICC     TSTYY                           CSC011
     C                     MOVE WPIYY     TSTYY                           CSC011
     C                     MOVE PITTST    WTSTM                           CSC011
     C                     MOVE WTSHR     TSTTM1                          CSC011
     C                     MOVE WTSMN     TSTTM2                          CSC011
     C                     MOVE WTSSC     TSTTM3                          CSC011
     C                     MOVE '000000'  TSTTM4                          CSC011
     C                     ENDIF                                          CSC011
     C                     MOVE TSTISO    STMST                           CSC011
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PISCCY    SFSCCY                                              CLE031
     C                     MOVE PIREXR    SFREXR                                              CLE031
     C           PIREXR    IFNE *BLANKS                                                       CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE PIREXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     MOVE *OFF      *IN99                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
     C                     Z-ADD*ZEROS    WSEXR  138                                          CLE031
     C                     MOVELZFIELD    WSEXR                                               CLE031
     C           *IN99     IFEQ *ON                                                           CLE031
     C           WSEXR     OREQ *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   SFREXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE PIREXI    SFREXI                                              CLE031
     C           PIREXI    IFEQ 'N'                                                           CLE031
     C                     MOVE *BLANKS   SFREXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE PIPSCY    SFPSCY                                              CLE031
     C                     MOVE PIPEXR    SFPEXR                                              CLE031
     C           PIPEXR    IFNE *BLANKS                                                       CLE031
     C                     MOVE PIPEXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
     C                     Z-ADD5         ZADIG                                               CLE031
     C                     MOVE *OFF      *IN99                                               CLE031
     C                     EXSR ZALIGN                                                        CLE031
     C                     Z-ADD*ZEROS    WSEXR                                               CLE031
     C                     MOVELZFIELD    WSEXR                                               CLE031
     C           *IN99     IFEQ *ON                                                           CLE031
     C           WSEXR     OREQ *ZEROS                                                        CLE031
     C                     MOVE *BLANKS   SFPEXR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE PIPEXI    SFPEXI                                              CLE031
     C           PIPEXI    IFEQ 'N'                                                           CLE031
     C                     MOVE *BLANKS   PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                   CAP064
     C                     ENDSR                                          CAP064
      *****************************************************************   171859
      *  SRCKFR  -  Check if the Facility has been reactivated.       *   171859
      *  Called by: VALINP - Validate input key                       *   171859
      *  Calls    : None                                              *   171859
      *****************************************************************   171859
     C           SRCKFR    BEGSR                                          171859
      *                                                                   171859
     C                     MOVE *OFF      WREAC   1                       171859
      *                                                                   171859
     C           RECI      IFEQ 'C'                                       171859
     C           RECI      OREQ 'E'                                       171859
      *                                                                   171859
     C           KEY006    SETLLLEFCAML3                                  171859
     C           KEY006    READELEFCAML3                 78               171859
      *                                                                   171859
     C           *IN78     DOWEQ*OFF                                      171859
     C           WREAC     ANDEQ*OFF                                      171859
     C           RECIC     IFEQ 'D'                                       171859
     C           FATP      ANDEQ'FR'                                      171859
     C                     Z-ADDAAMT      FAMT                            171859
     C                     Z-ADDNDEX      DTEX                            171859
     C                     MOVE *ON       WREAC                           171859
     C                     ENDIF                                          171859
     C           KEY006    READELEFCAML3                 78               171859
     C                     ENDDO                                          171859
      *                                                                   171859
     C                     ENDIF                                          171859
      *                                                                   171859
     C                     MOVE *OFF      *IN78                           171859
      *                                                                   171859
     C                     ENDSR                                          171859
      /EJECT
      *****************************************************************   CSC011
      *  APLGTR  -  Write facility transaction to the 24X7 Midas      *   CSC011
      *             availability Log File                             *   CSC011
      *  Called by: SRUPDT                                            *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           APLGTR    BEGSR                                          CSC011
      *                                                                   CSC011
     C                     MOVE TSTISO    APSTMS                          CSC011
     C                     MOVEL'LE'      W#MSGT  6                       CSC011
     C                     MOVE PIMTYP    W#MSGT                          CSC011
     C                     MOVELW#MSGT    APMTYP                          CSC011
     C                     MOVE '  '      APMTYP                          CSC011
     C                     MOVELWTREF     APSOFC                          CSC011
     C                     MOVELPINPP     APTRAN                          CSC011
      *                                                                   CSC011
      ** If timestamp field is blank, then call ZAGENTS to set it up      CSC011
      *                                                                   CSC011
     C           APSTMS    IFEQ *BLANKS                                   CSC011
     C                     CALL 'ZAGENTS'                                 CSC011
     C                     PARM ZATMST    ZATMST 26                       CSC011
     C                     MOVE ZATMST    APSTMS                          CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C           LOGVAL    IFEQ 'V'                                       CSC011
     C                     OPEN APVLOGPD                                  CSC011
     C                     WRITEAPVLOGD0                                  CSC011
     C                     CLOSEAPVLOGPD                                  CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C           LOGVAL    IFEQ 'I'                                       CSC011
     C                     OPEN APILOGPD                                  CSC011
     C                     WRITEAPILOGD0                                  CSC011
     C                     CLOSEAPILOGPD                                  CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     ENDSR                                          CSC011
      *                                                                   CSC011
      /EJECT                                                              CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
      *  LOG247  -  Convert fields to the format required to be       *   CSC011
      *             written to the 24x7 Midas Availability Log        *   CSC011
      *  Called by: SRUPDT                                            *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           LOG247    BEGSR                                          CSC011
      *                                                                   CSC011
     C           PMODE     IFNE 'B'                                       CSC011
     C/COPY WNCPYSRC,LEH00542
     C                     CLEARPINPP                                     CSC011
     C                     MOVE 'FEES'    PIMTYP                          CSC011
     C                     MOVE USER      PITUSR                          CSC011
     C                     MOVE WSID      PITWST                          CSC011
     C                     MOVE SFLCHT    PITACT                          CSC011
     C*                                                                   CSC011
     C                     CALL 'ZAGENTS'                                 CSC011
     C                     PARM ZATMST    ZATMST 26                       CSC011
     C                     MOVE ZATMST    TSTISO                          CSC011
     C*                                                                   CSC011
     C           PITDST    IFEQ *BLANKS                                   CSC011
     C                     MOVELTSTYY     WPICC                           CSC011
     C                     MOVE TSTYY     WPIYY                           CSC011
     C                     MOVE TSTMM     WPIMM                           CSC011
     C                     MOVE TSTDD     WPIDD                           CSC011
     C                     MOVE WPITDS    PITDST                          CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C           PITTST    IFEQ *BLANKS                                   CSC011
     C                     MOVELTSTTM1    WSTM1   40                      CSC011
     C                     MOVE TSTTM2    WSTM1                           CSC011
     C                     MOVELTSTTM3    WSTM2   40                      CSC011
     C                     MOVELTSTTM4    WSTM3   20                      CSC011
     C                     MOVELWSTM1     PITTST                          CSC011
     C                     MOVE WSTM3     WSTM2                           CSC011
     C                     MOVE WSTM2     PITTST                          CSC011
     C                     ENDIF                                          CSC011
     C*                                                                   CSC011
     C                     MOVE SFCNUM    PICNUM                          CSC011
     C                     MOVE SFFACT    PIFACT                          CSC011
     C                     MOVE SFFCNO    PIFCNO                          CSC011
     C                     MOVE SFLNRF    PILNRF                          CSC011
     C                     MOVE SFFSEQ    PIFSEQ                          CSC011
     C                     MOVE SFECOD    PIFCOD                          CSC011
     C                     MOVE SFECUR    PIFCUR                          CSC011
     C                     MOVE SFEAMT    PIFAMT                          CSC011
     C                     MOVE SFESGN    PIFSGN                          CSC011
     C*                                                                   CSC011
     C                     MOVE SFEPSD    WPITDS                          CSC011
     C                     MOVELSFEPSD    WPITDS                          CSC011
     C                     MOVE *BLANKS   WPICC                           CSC011
     C                     MOVE WPITDS    PIFPSD                          CSC011
     C*                                                                   CSC011
     C                     MOVE SFEPED    WPITDS                          CSC011
     C                     MOVELSFEPED    WPITDS                          CSC011
     C                     MOVE *BLANKS   WPICC                           CSC011
     C                     MOVE WPITDS    PIFPED                          CSC011
     C*                                                                   CSC011
     C                     MOVE SFEPON    PIFPON                          CSC011
     C                     MOVE SFEADV    PIFADV                          CSC011
     C                     MOVE SFCALT    PICALT                          CSC011
     C                     MOVE SFRTE1    PIRTE1                          CSC011
     C                     MOVE SFRTE2    PIRTE2                          CSC011
     C                     MOVE SFRTE3    PIRTE3                          CSC011
     C                     MOVE SFRTE4    PIRTE4                          CSC011
     C                     MOVE SFRTE5    PIRTE5                          CSC011
     C                     MOVE SFAMT1    PIAMT1                          CSC011
     C                     MOVE SFAMT2    PIAMT2                          CSC011
     C                     MOVE SFAMT3    PIAMT3                          CSC011
     C                     MOVE SFAMT4    PIAMT4                          CSC011
     C                     MOVE SFAMT5    PIAMT5                          CSC011
     C                     MOVE SFPIND    PIPIND                          CSC011
     C                     MOVE SFCALC    PICALC                          CSC011
     C                     MOVE SFFREQ    PIFREQ                          CSC011
     C                     MOVE SFDYIM    PIDYIM                          CSC011
     C*                                                                   CSC011
     C                     MOVE SFNPYD    WPITDS                          CSC011
     C                     MOVELSFNPYD    WPITDS                          CSC011
     C                     MOVE *BLANKS   WPICC                           CSC011
     C                     MOVE WPITDS    PINPYD                          CSC011
     C*                                                                   CSC011
     C                     MOVE SFMDIN    PIMDIN                          CSC011
     C                     MOVE SFEXRT    PIEXRT                          CSC011
     C                     MOVE PMPSTM    PIPSTM                          CSC011
     C                     MOVE PMPONS    PIPONS                          CSC011
     C                     MOVE PMRVNO    PIPREC                          CSC011
     C                     MOVE PMCVMR    PICVMR                          CSC011
     C                     MOVE PMPOCN    PIPOCN                          CSC011
     C                     MOVE PMPOBN    PIPOBN                          CSC011
     C                     MOVE PMRCRN    PIRCRN                          CSC011
     C                     MOVE PMRCRA    PIRCRA                          CSC011
     C                     MOVE PMPIBN    PIPIBN                          CSC011
     C                     MOVE PMPIBA    PIPIBA                          CSC011
     C                     MOVE PMAWBN    PIAWBN                          CSC011
     C                     MOVE PMAWBA    PIAWBA                          CSC011
     C                     MOVE PMBENN    PIBENN                          CSC011
     C                     MOVE PMBENA    PIBENA                          CSC011
     C                     MOVE PMRSTM    PIRSTM                          CSC011
     C                     MOVE PMRONS    PIRONS                          CSC011
     C                     MOVE PMROCN    PIROCN                          CSC011
     C                     MOVE PMROBN    PIROBN                          CSC011
     C                     MOVE PMRIBN    PIRIBN                          CSC011
     C                     MOVE PMRIBA    PIRIBA                          CSC011
     C                     MOVE PMDTP1    PIDTP1                          CSC011
     C                     MOVE PMDTP2    PIDTP2                          CSC011
     C                     MOVE PMDTP3    PIDTP3                          CSC011
     C                     MOVE PMDTP4    PIDTP4                          CSC011
     C                     MOVE PMDCHG    PIDCHG                          CSC011
     C                     MOVE PMBTB1    PIBTB1                          CSC011
     C                     MOVE PMBTB2    PIBTB2                          CSC011
     C                     MOVE PMBTB3    PIBTB3                          CSC011
     C                     MOVE PMBTB4    PIBTB4                          CSC011
     C                     MOVE PMBTB5    PIBTB5                          CSC011
     C                     MOVE PMBTB6    PIBTB6                          CSC011
     C                     MOVE SFESHR    PISHRF                          CSC011
     C                     MOVE SFIUSR    PIIUSR                          CSC011
     C                     MOVE SFAUSR    PIAUSR                          CSC011
     C                     MOVE FEXUSR    PIXUSR                          CSC011
     C                     MOVE FEPCOB    PIPCOB                          CSC011
     C                     MOVE PMRSCY    PISCCY                          CSC011
     C                     MOVE PMIC72    PIICCY                          CSC011
     C                     MOVE SPRFC     PIPRFC                          CSC011
     C                     MOVE SFBRCA    PIBRCA                          CSC011
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE PMRSCY    PISCCY                                              CLE031
     C                     MOVE PMREXR    PIREXR                                              CLE031
     C                     MOVE PMREXI    PIREXI                                              CLE031
     C                     MOVE PMPSCY    PIPSCY                                              CLE031
     C                     MOVE PMPEXR    PIPEXR                                              CLE031
     C                     MOVE PMPEXI    PIPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
      ** Settlement Allocations                                                               CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVELSFSTAL    PISTAL                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   CSC011
     C                     ENDIF                                          CSC011
      *                                                                   CSC011
     C                     ENDSR                                          CSC011
      *                                                                   CSC011
      /EJECT                                                              CSC011
      *****************************************************************   CSC011
      *  LOGDEL  -  Delete record from 24x7 Midas availability log    *   CSC011
      *             file                                              *   CSC011
      *  Called by: SRWRIT, SRUPDT                                    *   CSC011
      *  Calls    : None                                              *   CSC011
      *****************************************************************   CSC011
      *                                                                   CSC011
     C           LOGDEL    BEGSR                                          CSC011
      *                                                                   CSC011
     C                     MOVEL'LE'      W#MSGT                          CSC011
     C                     MOVE 'FEES'    W#MSGT                          CSC011
     C                     MOVELW#MSGT    KMTYPE                          CSC011
     C                     MOVE '  '      KMTYPE                          CSC011
     C                     MOVELSTNRF     KFOID                           CSC011
     C                     MOVE STMST     KTSTMP                          CSC011
      *                                                                   CSC011
     C                     OPEN APILOGL0                                  CSC011
     C           KAPLOG    CHAINAPILOGX0             99                   CSC011
     C           *IN99     IFEQ *OFF                                      CSC011
     C                     DELETAPILOGX0                                  CSC011
     C                     ENDIF                                          CSC011
     C                     CLOSEAPILOGL0                                  CSC011
      *                                                                   CSC011
     C                     ENDSR                                          CSC011
      *                                                                   CSC011
      /EJECT                                                                                  CSW208
      *****************************************************************                       CSW208
      *  SRRLTX  -  Chain to transaction header                       *                       CSW208
      *  Called by: SRWRIT, SRUPDT                                    *                       CSW208
      *  Calls    : None                                              *                       CSW208
      *****************************************************************                       CSW208
      *                                                                                       CSW208
     C           SRRLTX    BEGSR                                                              CSW208
     C**********           Z-ADD1         LXRRN   50                                 CSW208 AR322732
     C********** LXRRN     CHAINLTRIX               N89                              CSW208 AR322732
     C**********           Z-ADDRRNAD     WRRNA   50                                 CSW208 AR322732
      *****************************************************************              CSW208 AR322732
     C********** *IN89     IFEQ *ON                                                  CSW208 AR322732
     C********** RRNAD     ORGT FLSZD                                                CSW208 AR322732
     C********** *LOCK     IN   LDA                                                  CSW208 AR322732
     C**********           MOVEL'LTRIX   'DBFILE           ************              CSW208 AR322732
     C**********           Z-ADD21        DBASE            * DBERR 21 *              CSW208 AR322732
     C**********           MOVELLXRRN     DBKEY            ************              CSW208 AR322732
     C**********           OUT  LDA                                                  CSW208 AR322732
     C**********           EXSR *PSSR                                                CSW208 AR322732
     C**********           ENDIF                                                     CSW208 AR322732
      *                                                                                       CSW208
     C                     ENDSR                                                              CSW208
      *****************************************************************                       CSW208
      /EJECT                                                                                  CSW208
      *****************************************************************                       CSW208
      *  SRWLTX  -  Write record to LTRIX                             *                       CSW208
      *  Called by: SRWRIT, SRUPDT                                    *                       CSW208
      *  Calls    : None                                              *                       CSW208
      *****************************************************************                       CSW208
      *                                                                                       CSW208
     C           SRWLTX    BEGSR                                                              CSW208
      *                                                                                       CSW208
     C**********           MOVE RRNAD     LXRRN                                      CSW208 AR322732
     C**********           MOVE '1'       TXERR   1                                  CSW208 AR322732
      *                                                                                       CSW208
     C********** LXRRN     CHAINLTRIX                8887                            CSW208 AR322732
      *                                                                                       CSW208
     C********** *IN87     DOWEQ*ON                                                  CSW208 AR322732
     C********** TXERR     ANDEQ'1'                                                  CSW208 AR322732
     C********** RECID     ORNE *BLANK                                               CSW208 AR322732
      *                                                                                       CSW208
     C**********           Z-ADDTXSTS     SVSTS   50                                 CSW208 AR322732
     C**********           UNLCKLTRIX                                                CSW208 AR322732
     C********** SVSTS     IFEQ 1218                                                 CSW208 AR322732
     C********** *IN87     OREQ *OFF                                                 CSW208 AR322732
     C********** RECID     ANDNE*BLANK                                               CSW208 AR322732
     C**********           EXSR SRRLTX                                               CSW208 AR322732
     C**********           MOVE RRNAD     LXRRN                                      CSW208 AR322732
     C********** LXRRN     CHAINLTRIX                8887                            CSW208 AR322732
      *                                                                                       CSW208
     C**********           ELSE                                                      CSW208 AR322732
      *                                                                                       CSW208
     C**********           MOVE 'O'       TXERR                                      CSW208 AR322732
     C**********           ENDIF                                                     CSW208 AR322732
      *                                                                                       CSW208
     C**********           ENDDO                                                     CSW208 AR322732
      *                                                                                       CSW208
     C**********           EXSR CLEAR                                                CSW208 AR322732
      *                                                                                       CSW208
     C********** TXERR     IFEQ 'O'                                                  CSW208 AR322732
     C********** *LOCK     IN   LDA                                                  CSW208 AR322732
     C**********           MOVEL'LTRIX   'DBFILE                                     CSW208 AR322732
     C**********           Z-ADD53        DBASE                                      CSW208 AR322732
     C**********           MOVELLXRRN     DBKEY                                      CSW208 AR322732
     C**********           OUT  LDA                                                  CSW208 AR322732
     C**********           EXSR *PSSR                                                CSW208 AR322732
     C**********           ENDIF                                                     CSW208 AR322732
      *                                                                                       CSW208
     C**********           Z-ADD*ZERO     PRI1D                                      CSW208 AR322732
     C**********           Z-ADD*ZERO     LASND                                      CSW208 AR322732
     C**********           MOVE 'A'       CHTPD                                      CSW208 AR322732
     C**********           MOVE BRCA      BRCAD                                      CSW208 AR322732
     C**********           MOVE *BLANKS   REPRD                                      CSW208 AR322732
     C**********           Z-ADD*ZERO     PRI2D                                      CSW208 AR322732
     C**********           Z-ADD*ZERO     PRI3D                                      CSW208 AR322732
     C**********           Z-ADD*ZERO     PRI4D                                      CSW208 AR322732
      *                                                                                     AR322732
     C                     Z-ADD*ZERO     PRI1D   10                                        AR322732
     C                     Z-ADD*ZERO     LASND   30                                        AR322732
     C                     MOVE 'A'       CHTPD   1                                         AR322732
     C                     MOVE BRCA      BRCAD   3                                         AR322732
     C                     MOVE *BLANKS   REPRD   1                                         AR322732
     C                     Z-ADD*ZERO     PRI2D   10                                        AR322732
     C                     Z-ADD*ZERO     PRI3D   10                                        AR322732
     C                     Z-ADD*ZERO     PRI4D   10                                        AR322732
      *                                                                                       CSW208
      ** Update header.                                                                       CSW208
      *                                                                                       CSW208
     C                     EXCPTTRXDTL                                                        CSW208
      *                                                                                       CSW208
      ** Get Header Record                                                                    CSW208
      *                                                                                       CSW208
     C**********           Z-ADD1         LXRRN                                      CSW208 AR322732
     C********** LXRRN     CHAINLTRIX                79                              CSW208 AR322732
      *                                                                                       CSW208
     C********** *IN79     IFEQ *ON                                                  CSW208 AR322732
     C********** *LOCK     IN   LDA                                                  CSW208 AR322732
     C**********           MOVEL'LTRIX   'DBFILE                                     CSW208 AR322732
     C**********           Z-ADD22        DBASE                                      CSW208 AR322732
     C**********           MOVELLXRRN     DBKEY                                      CSW208 AR322732
     C**********           OUT  LDA                                                  CSW208 AR322732
     C**********           EXSR *PSSR                                                CSW208 AR322732
     C**********           ENDIF                                                     CSW208 AR322732
      *                                                                                       CSW208
     C**********           ADD  1         NORED                                      CSW208 AR322732
     C**********           ADD  1         RRNAD                                      CSW208 AR322732
     C**********           ADD  1         NLNRD                                      CSW208 AR322732
      *                                                                                       CSW208
     C**********           EXCPTTRXHDR                                               CSW208 AR322732
      *                                                                                       CSW208
     C                     ENDSR                                                              CSW208
      *****************************************************************                       CSW208
      /EJECT                                                                                  CSW208
      *****************************************************************                       CSW208
      *  SRLOAN  -  Access Loan file from LF/CLOAN                    *                       CSW208
      *  Called by: SRWRIT, SRUPDT                                    *                       CSW208
      *  Calls    : None                                              *                       CSW208
      *****************************************************************                       CSW208
      *                                                                                       CSW208
     C           SRLOAN    BEGSR                                                              CSW208
      *                                                                                       CSW208
     C           KEY004    CHAINCLOAN                78                                       CSW208
      *                                                                                       CSW208
     C           *IN78     IFEQ *ON                                                           CSW208
     C           *LOCK     IN   LDA                                                           CSW208
     C                     MOVEL'CLOAN'   DBFILE           ************                       CSW208
     C                     Z-ADD16        DBASE            * DBERR 16 *                       CSW208
     C                     MOVELWLOAN     DBKEY            ************                       CSW208
     C                     OUT  LDA                                                           CSW208
     C                     EXSR *PSSR                                                         CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ENDSR                                                              CSW208
      *****************************************************************                       CSW208
      /EJECT                                                              CSC011
      *****************************************************************                       CSD015
      *  SRCHCK  - Check if Watch List Checking Engine Program needs  *                       CSD015
      *            to be called                                       *                       CSD015
      *                                                               *                       CSD015
      *  Called by: SRWRIT, SRUPDT                                    *                       CSD015
      *  Calls    : None                                              *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRCHCK    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Initialization                                                                       CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       WRONSX  1                                           CSD015
     C                     MOVE 'N'       WRIBNX  1                                           CSD015
     C                     MOVE 'N'       WROBNX  1                                           CSD015
     C                     MOVE 'N'       WROCNX  1                                           CSD015
     C                     MOVE 'N'       WPONSX  1                                           CSD015
     C                     MOVE 'N'       WPIBNX  1                                           CSD015
     C                     MOVE 'N'       WPOBNX  1                                           CSD015
     C                     MOVE 'N'       WPOCNX  1                                           CSD015
     C                     MOVE 'N'       WRCRNX  1                                           CSD015
     C                     MOVE 'N'       WRVNOX  1                                           CSD015
     C                     MOVE 'N'       WAWBNX  1                                           CSD015
     C                     MOVE 'N'       WBENNX  1                                           CSD015
     C                     MOVE 'N'       WDTPXX  1                                           CSD015
     C                     MOVE *BLANKS   WFCNUM                                              CSD015
     C                     MOVE *BLANKS   WFFALN                                              CSD015
     C                     MOVE *BLANKS   WFFSEQ                                              CSD015
     C                     MOVE *BLANKS   K3FUNT                                              CSD015
     C                     MOVE *BLANKS   K3IDEN                                              CSD015
     C                     MOVE *BLANKS   K3BRCH                                              CSD015
      *                                                                                       CSD015
     C           ACTNX     IFEQ 'A'                                                           CSD015
     C                     MOVEL'LEFEED'  K3FUNT                                              CSD015
      *                                                                                       CSD015
     C********** FELOAN    IFEQ *ZERO                                                  CSD015 CLE148
     C           FELOAN    IFEQ *BLANKS                                                       CLE148
     C                     MOVELFECNUM    WFCNUM                                              CSD015
     C                     MOVELFEFACL    WFFALN                                              CSD015
     C                     MOVELFEFSEQ    WFFSEQ                                              CSD015
     C                     CAT  WFCNUM:0  K3IDEN                                              CSD015
     C                     CAT  WFFALN:0  K3IDEN                                              CSD015
     C                     CAT  WFFSEQ:0  K3IDEN                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELFELOAN    WFFALN                                              CSD015
     C                     MOVELFEFSEQ    WFFSEQ                                              CSD015
     C                     CAT  WFFALN:0  K3IDEN                                              CSD015
     C                     CAT  WFFSEQ:0  K3IDEN                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVELFEBRCA    K3BRCH                                              CSD015
      *                                                                                       CSD015
     C           KCWHT     CHAINSDCWHTL1             78                                       CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receipt Nostro                                                                       CSD015
      *                                                                                       CSD015
     C           PMRONS    IFNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PMRONS    ORNE FERONS                                                        CSD015
     C                     MOVE 'Y'       WRONSX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receipt Intermediary Bank + Account Line                                             CSD015
      *                                                                                       CSD015
     C           PARIBN    IFNE *BLANKS                                                       CSD015
     C           PMRIBA    ORNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PARIBN    ORNE FERIBN                                                        CSD015
     C           PARIBN    ANDNE*BLANKS                                                       CSD015
     C           PMRIBA    ORNE FERIBA                                                        CSD015
     C           PMRIBA    ANDNE*BLANKS                                                       CSD015
     C                     MOVE 'Y'       WRIBNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receipt Ordering Bank                                                                CSD015
      *                                                                                       CSD015
     C           PAROBN    IFNE *BLANKS                                                       CSD015
     C                     MOVELFEROBN    WAROBN  6                                           CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PAROBN    ORNE WAROBN                                                        CSD015
     C                     MOVE 'Y'       WROBNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receipt Ordering Customer                                                            CSD015
      *                                                                                       CSD015
     C           PAROCN    IFNE *BLANKS                                                       CSD015
     C                     MOVELFEROCN    WAROCN  6                                           CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PAROCN    ORNE WAROCN                                                        CSD015
     C                     MOVE 'Y'       WROCNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay Nostro                                                                           CSD015
      *                                                                                       CSD015
     C           PMPONS    IFNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PMPONS    ORNE FEPONS                                                        CSD015
     C                     MOVE 'Y'       WPONSX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay Intermediary Bank + Account Line                                                 CSD015
      *                                                                                       CSD015
     C           PAPIBN    IFNE *BLANKS                                                       CSD015
     C           PMPIBA    ORNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PAPIBN    ORNE FEPIBN                                                        CSD015
     C           PAPIBN    ANDNE*BLANKS                                                       CSD015
     C           PMPIBA    ORNE FEPIBA                                                        CSD015
     C           PMPIBA    ANDNE*BLANKS                                                       CSD015
     C                     MOVE 'Y'       WPIBNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay Ordering Bank                                                                    CSD015
      *                                                                                       CSD015
     C           PAPOBN    IFNE *BLANKS                                                       CSD015
     C                     MOVELFEPOBN    WAPOBN  6                                           CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PAPOBN    ORNE WAPOBN                                                        CSD015
     C                     MOVE 'Y'       WPOBNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay Ordering Customer                                                                CSD015
      *                                                                                       CSD015
     C           PAPOCN    IFNE *BLANKS                                                       CSD015
     C                     MOVELFEPOCN    WAPOCN  6                                           CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PAPOCN    ORNE WAPOCN                                                        CSD015
     C                     MOVE 'Y'       WPOCNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver Correspondent + Account Line                                                CSD015
      *                                                                                       CSD015
     C           PARCRN    IFNE *BLANKS                                                       CSD015
     C           PMRCRA    ORNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PARCRN    ORNE FERCRN                                                        CSD015
     C           PARCRN    ANDNE*BLANKS                                                       CSD015
     C           PMRCRA    ORNE FERCRA                                                        CSD015
     C           PMRCRA    ANDNE*BLANKS                                                       CSD015
     C                     MOVE 'Y'       WRCRNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver                                                                             CSD015
      *                                                                                       CSD015
     C           PARVNO    IFNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PARVNO    ORNE FERVNO                                                        CSD015
     C                     MOVE 'Y'       WRVNOX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Account with Bank + Account Line                                                     CSD015
      *                                                                                       CSD015
     C           PAAWBN    IFNE *BLANKS                                                       CSD015
     C           PMAWBA    ORNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PAAWBN    ORNE FEAWBN                                                        CSD015
     C           PAAWBN    ANDNE*BLANKS                                                       CSD015
     C           PMAWBA    ORNE FEAWBA                                                        CSD015
     C           PMAWBA    ANDNE*BLANKS                                                       CSD015
     C                     MOVE 'Y'       WAWBNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              OSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Beneficiary + Account Line                                                           CSD015
      *                                                                                       CSD015
     C           PABENN    IFNE *BLANKS                                                       CSD015
     C           PMBENA    ORNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PABENN    ORNE FEBENN                                                        CSD015
     C           PABENN    ANDNE*BLANKS                                                       CSD015
     C           PMBENA    ORNE FEBENA                                                        CSD015
     C           PMBENA    ANDNE*BLANKS                                                       CSD015
     C                     MOVE 'Y'       WBENNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Details of Payment                                                                   CSD015
      *                                                                                       CSD015
     C           PMDTP1    IFNE *BLANKS                                                       CSD015
     C           PMDTP2    ORNE *BLANKS                                                       CSD015
     C           PMDTP3    ORNE *BLANKS                                                       CSD015
     C           PMDTP4    ORNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           PMDTP1    ORNE FEDTP1                                                        CSD015
     C           PMDTP1    ANDNE*BLANKS                                                       CSD015
     C           PMDTP2    ORNE FEDTP2                                                        CSD015
     C           PMDTP2    ANDNE*BLANKS                                                       CSD015
     C           PMDTP3    ORNE FEDTP3                                                        CSD015
     C           PMDTP3    ANDNE*BLANKS                                                       CSD015
     C           PMDTP4    ORNE FEDTP4                                                        CSD015
     C           PMDTP4    ANDNE*BLANKS                                                       CSD015
     C                     MOVE 'Y'       WDTPXX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *  SRWTCH  -                                                    *                       CSD015
      *                                                               *                       CSD015
      *  Called by: SRWRIT, SRUPDT                                    *                       CSD015
      *  Calls    : None                                              *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Set-up parameter for Compliance Engine Program                                       CSD015
      *                                                                                       CSD015
      ** 1st Parameter                                                                        CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   WFCNUM                                              CSD015
     C                     MOVE *BLANKS   WFFALN                                              CSD015
     C                     MOVE *BLANKS   WFFSEQ                                              CSD015
     C                     MOVE *BLANKS   W4IDEN                                              CSD015
     C                     MOVE *BLANKS   W4ITEM                                              CSD015
     C                     MOVE *BLANKS   W4BRCH                                              CSD015
     C                     MOVE *BLANKS   W4SYSM                                              CSD015
     C                     MOVE *BLANKS   W4FUNT                                              CSD015
     C                     MOVE *BLANKS   W4CUST                                              CSD015
     C                     Z-ADD*ZERO     W4DDAT                                              CSD015
     C                     Z-ADD*ZERO     W4VDAT                                              CSD015
     C                     Z-ADD*ZERO     W4MDAT                                              CSD015
     C                     MOVE *BLANKS   W4DEN1                                              CSD015
     C                     MOVE *BLANKS   W4DEN2                                              CSD015
     C                     Z-ADD*ZERO     W4AMT1                                              CSD015
     C                     Z-ADD*ZERO     W4AMT2                                              CSD015
      *                                                                                       CSD015
      ** Item code                                                                            CSD015
      *                                                                                       CSD015
     C                     MOVEL'LEFEE'   W4ITEM                                              CSD015
      *                                                                                       CSD015
      ** Identifier                                                                           CSD015
      *                                                                                       CSD015
     C********** FELOAN    IFEQ *ZERO                                                  CSD015 CLE148
     C           FELOAN    IFEQ *BLANKS                                                       CLE148
     C                     MOVELFECNUM    WFCNUM                                              CSD015
     C                     MOVELFEFACL    WFFALN                                              CSD015
     C                     MOVELFEFSEQ    WFFSEQ                                              CSD015
     C                     CAT  WFCNUM:0  W4IDEN                                              CSD015
     C                     CAT  WFFALN:0  W4IDEN                                              CSD015
     C                     CAT  WFFSEQ:0  W4IDEN                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE FELOAN    WFFALN                                              CSD015
     C                     MOVELFEFSEQ    WFFSEQ                                              CSD015
     C                     CAT  WFFALN:0  W4IDEN                                              CSD015
     C                     CAT  WFFSEQ:0  W4IDEN                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Branch                                                                               CSD015
      *                                                                                       CSD015
     C                     MOVELFEBRCA    W4BRCH                                              CSD015
      *                                                                                       CSD015
      ** System                                                                               CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'Y'                                                           CSD015
     C                     MOVELS1MAIN    W4SYSM                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELLIBR      W4SYSM                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Function Type                                                                        CSD015
      *                                                                                       CSD015
     C                     MOVEL'LEFEED'  W4FUNT                                              CSD015
      *                                                                                       CSD015
      ** Counter Party Number                                                                 CSD015
      *                                                                                       CSD015
     C                     MOVELFECNUM    W4CNUM                                              CSD015
      *                                                                                       CSD015
      ** Access customer details for counterparty details                                     CSD015
      *                                                                                       CSD015
     C                     MOVELW4CNUM    KEYC                                                CSD015
     C                     EXSR CUSTDT                                                        CSD015
      *                                                                                       CSD015
      ** Counterparty Type                                                                    CSD015
      *                                                                                       CSD015
      *                                                                                       CSD015
      ** If Concord Interface Development is installed                                        CSD015
      **    If Corporate Customer is 'Y', set Counterparty Type to 'C'                        CSD015
      **    Else, Counterparty Type to 'I'                                                    CSD015
      *                                                                                       CSD015
     C           CCF001    IFEQ 'Y'                                                           CSD015
     C           BBCRPC    IFEQ 'Y'                                                           CSD015
     C                     MOVEL'C'       W4CTYP                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
      ** ELSE,                                                                                CSD015
      **    If Local Industry Code is not blank and it is not equal to a                      CSD015
      **    any of the five Private Customer Industry Code, set CounterParty                  CSD015
      **    Type to 'C'                                                                       CSD015
      **     Else, set Counterparty Type to 'I'.                                              CSD015
      *                                                                                       CSD015
     C           BBLICD    IFNE *BLANKS                                                       CSD015
     C           BBLICD    ANDNEW1IND1                                                        CSD015
     C           BBLICD    ANDNEW1IND2                                                        CSD015
     C           BBLICD    ANDNEW1IND3                                                        CSD015
     C           BBLICD    ANDNEW1IND4                                                        CSD015
     C           BBLICD    ANDNEW1IND5                                                        CSD015
     C                     MOVEL'C'       W4CTYP                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Counter Party Name                                                                   CSD015
      *                                                                                       CSD015
     C           BBCRNM    CAT  BBCRTN    W4CUST                                              CSD015
      *                                                                                       CSD015
      ** Value Date                                                                           CSD015
      *                                                                                       CSD015
     C                     Z-ADDFEPSTD    W4VDAT                                              CSD015
      *                                                                                       CSD015
      ** Maturity Date                                                                        CSD015
      *                                                                                       CSD015
     C                     Z-ADDFEPEND    W4MDAT                                              CSD015
      *                                                                                       CSD015
      ** Denomination Side 1 (W4DEN1)                                                         CSD015
      *                                                                                       CSD015
     C                     MOVELFEFCCY    W4DEN1                                              CSD015
      *                                                                                       CSD015
      ** Denomination Side 2                                                                  CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   W4DEN2                                              CSD015
      *                                                                                       CSD015
      ** Amount Side 1 (W4AMT1)                                                               CSD015
      *                                                                                       CSD015
     C                     Z-ADDFEFAMT    W4AMT1                                              CSD015
      *                                                                                       CSD015
      ** Amount Side 2 (W4AMT2)                                                               CSD015
      *                                                                                       CSD015
     C                     Z-ADD0         W4AMT2                                              CSD015
      *                                                                                       CSD015
      ** 2nd Parameter                                                                        CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PXML                                                CSD015
      *                                                                                       CSD015
      ** Receipt Nostro                                                                       CSD015
      *                                                                                       CSD015
     C           WRONSX    IFEQ 'Y'                                                           CSD015
     C                     MOVELFERONS    PINP1                                               CSD015
     C           FESCCY    IFNE *BLANKS                                                       CSD015
     C                     MOVELFESCCY    PCCY                                                CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELFEFCCY    PCCY                                                CSD015
     C                     ENDIF                                                              CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,1:0 PXML                                                CSD015
     C           PXML      CAT  POUT:0    PXML                                                CSD015
     C           PXML      CAT  CLTAG,1:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receipt Intermediary Bank + Account Line                                             CSD015
      *                                                                                       CSD015
     C           WRIBNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELFERIBN    PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,2:0 PXML                                                CSD015
     C           PXML      CAT  POUT:0    PXML                                                CSD015
     C           PXML      CAT  FERIBA:0  PXML                                                CSD015
     C           PXML      CAT  CLTAG,2:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receipt Ordering Bank                                                                CSD015
      *                                                                                       CSD015
     C           WROBNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELFEROBN    PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,3:0 PXML                                                CSD015
     C           PXML      CAT  POUT:0    PXML                                                CSD015
     C           PXML      CAT  CLTAG,3:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receipt Ordering Customer                                                            CSD015
      *                                                                                       CSD015
     C           WROCNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELFEROCN    PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,4:0 PXML                                                CSD015
     C           PXML      CAT  POUT:0    PXML                                                CSD015
     C           PXML      CAT  CLTAG,4:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay Nostro                                                                           CSD015
      *                                                                                       CSD015
     C           WPONSX    IFEQ 'Y'                                                           CSD015
     C                     MOVELFEPONS    PINP1                                               CSD015
     C           FESCCY    IFNE *BLANKS                                                       CSD015
     C                     MOVELFESCCY    PCCY                                                CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELFEFCCY    PCCY                                                CSD015
     C                     ENDIF                                                              CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,5:0 PXML                                                CSD015
     C           PXML      CAT  POUT:0    PXML                                                CSD015
     C           PXML      CAT  CLTAG,5:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay Intermediary Bank + Account Line                                                 CSD015
      *                                                                                       CSD015
     C           WPIBNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELFEPIBN    PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,6:0 PXML                                                CSD015
     C           PXML      CAT  POUT:0    PXML                                                CSD015
     C           PXML      CAT  FEPIBA:0  PXML                                                CSD015
     C           PXML      CAT  CLTAG,6:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay Ordering Bank                                                                    CSD015
      *                                                                                       CSD015
     C           WPOBNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELFEPOBN    PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,7:0 PXML                                                CSD015
     C           PXML      CAT  POUT:0    PXML                                                CSD015
     C           PXML      CAT  CLTAG,7:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay Ordering Customer                                                                CSD015
      *                                                                                       CSD015
     C           WPOCNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELFEPOCN    PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,8:0 PXML                                                CSD015
     C           PXML      CAT  POUT:0    PXML                                                CSD015
     C           PXML      CAT  CLTAG,8:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver Correspondent + Account Line                                                CSD015
      *                                                                                       CSD015
     C           WRCRNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELFERCRN    PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,9:0 PXML                                                CSD015
     C           PXML      CAT  POUT:0    PXML                                                CSD015
     C           PXML      CAT  FERCRA:0  PXML                                                CSD015
     C           PXML      CAT  CLTAG,9:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver                                                                             CSD015
      *                                                                                       CSD015
     C           WRVNOX    IFEQ 'Y'                                                           CSD015
     C                     MOVELFERVNO    PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,10:0PXML                                                CSD015
     C           PXML      CAT  POUT:0    PXML                                                CSD015
     C           PXML      CAT  CLTAG,10:0PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Account with Bank + Account Line                                                     CSD015
      *                                                                                       CSD015
     C           WAWBNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELFEAWBN    PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,11:0PXML                                                CSD015
     C           PXML      CAT  POUT:0    PXML                                                CSD015
     C           PXML      CAT  FEAWBA:0  PXML                                                CSD015
     C           PXML      CAT  CLTAG,11:0PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Beneficiary + Account Line                                                           CSD015
      *                                                                                       CSD015
     C           WBENNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELFEBENN    PINP1                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,12:0PXML                                                CSD015
     C           PXML      CAT  POUT:0    PXML                                                CSD015
     C           PXML      CAT  FEBENA:0  PXML                                                CSD015
     C           PXML      CAT  CLTAG,12:0PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Details of Payment                                                                   CSD015
      *                                                                                       CSD015
     C           WDTPXX    IFEQ 'Y'                                                           CSD015
     C           PXML      CAT  OPTAG,13:0PXML                                                CSD015
     C           PXML      CAT  FEDTP1:0  PXML                                                CSD015
     C           PXML      CAT  FEDTP2:1  PXML                                                CSD015
     C           PXML      CAT  FEDTP3:1  PXML                                                CSD015
     C           PXML      CAT  FEDTP4:1  PXML                                                CSD015
     C           PXML      CAT  CLTAG,13:0PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Send Transaction Details to Compliance Watch by Calling the                          CSD015
      ** Dummy program that will call the watch list enqine.                                  CSD015
      *                                                                                       CSD015
     C                     CALL 'SDWLCLOP'                                                    CSD015
     C                     PARM           PSDWLT                                              CSD015
     C                     PARM           PXML                                                CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *  SRFRMT  -                                                    *                       CSD015
      *                                                               *                       CSD015
      *  Called by: SRWTCH                                            *                       CSD015
      *  Calls    : SDCWLFMT                                          *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRFRMT    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     CALL 'SDCWLFMT'                                                    CSD015
     C                     PARM           PRTCD                                               CSD015
     C                     PARM           PINP1  35                                           CSD015
     C                     PARM           PINP2  35                                           CSD015
     C                     PARM           PINP3  35                                           CSD015
     C                     PARM           PINP4  35                                           CSD015
     C                     PARM           PINP5  35                                           CSD015
     C                     PARM           PINP6  35                                           CSD015
     C                     PARM           PCCY    3                                           CSD015
     C                     PARM           POUT  216                                           CSD015
     C                     PARM           POUT2   6                                           CSD015
      *                                                                                       CSD015
      ** Initialize to blanks the input parameters.                                           CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PINP1                                               CSD015
     C                     MOVE *BLANKS   PINP2                                               CSD015
     C                     MOVE *BLANKS   PINP3                                               CSD015
     C                     MOVE *BLANKS   PINP4                                               CSD015
     C                     MOVE *BLANKS   PINP5                                               CSD015
     C                     MOVE *BLANKS   PINP6                                               CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************
      * *PSSR   -  File Exception/Error Handling Subroutine           *
      * Called by: Various                                            *
      *  Calls    : SRPOUT - Return message Format (For Batch only)   *
      *****************************************************************
     C           *PSSR     BEGSR
      *
     C           WRUN      IFEQ *BLANK
     C                     MOVE 'Y'       WRUN    1
     C                     DUMP
     C                     ENDIF
      *
     C           PMODE     IFEQ 'I'
     C           PMODE     OREQ 'R'
     C           PMODE     OREQ 'F'                                 CAP064
     C                     CALL 'DBERRCTL'
     C                     ELSE
      *
     C           PMODE     IFNE 'B'                                 132282
     C/COPY WNCPYSRC,LEH00543
     C                     ROLBK
     C                     ENDIF                                    132282
      *
     C           PMODE     IFEQ 'B'
     C                     MOVE 'D'       POMSVR                                            AR868380
     C                     MOVE POMSVR    ZAMSVR  1                                         AR868380
     C                     MOVEL'LEL0035 'ZAMSID                                            AR868380
     C           ##RTCD    IFEQ '*RECLCK'                                                   AR868380
     C                     MOVEL'LEL0817 'ZAMSID                                            AR868380
     C                     ENDIF                                                            AR868380
     C/COPY WNCPYSRC,LEH00544
     C                     EXSR SRPOUT
     C**********           MOVE 'E'       POMSVR                                            AR868380
     C**********           MOVE DBASE     POMSID                                            AR868380
     C**********           MOVELDBFILE    POMSTX                                            AR868380
     C                     ENDIF
      *
     C           PMODE     IFEQ 'P'
     C                     MOVE 'E'       MSVR
     C                     MOVE DBASE     MSID
     C                     MOVELDBFILE    MSTX
     C                     UPDATLE2210D0
     C                     CLOSELE2210PD
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      *****************************************************************
      ***/EJECT***                                                                     152169 200452
     C***/COPY*ZSRSRC,ZXRATEZ1***                                                      152169 200452
      /EJECT
     C/TITLE SR/ZACCH
     C/COPY ZSRSRC,ZACCH
     C/TITLE SR/ZCHKH
     C/COPY ZSRSRC,ZCHKH
     C/TITLE SR/ZTNLU
     C/COPY ZSRSRC,ZTNLU1Z2
     C/TITLE SR/ZDATE1
     C/COPY ZSRSRC,ZDATE1Z2
     C/TITLE SR/ZDATE2
     C/COPY ZSRSRC,ZDATE2Z2
     C/TITLE SR/ZFRPED
     C/COPY ZSRSRC,ZFRPEDZ3
     C/TITLE SR/ZALIGN
     C/COPY ZSRSRC,ZALIGNZ2
     C/TITLE SR/ZFREQB
     C/COPY ZSRSRC,ZFREQBZ2
     C/COPY ZSRSRC,ZEDITZ2                                                                    CLE031
     C/COPY WNCPYSRC,LE2210C025
      *                                                                                       CSW208
      ** Update LTRIX header record                                                           CSW208
      *                                                                                       CSW208
     O*LTRIX***E                TRXHDR                                               CSW208 AR322732
     O**********               NORED     11P                                         CSW208 AR322732
     O**********               RRNAD     20P                                         CSW208 AR322732
     O**********               NLNRD     29P                                         CSW208 AR322732
     O**********               NATN      40P                                         CSW208 AR322732
      *                                                                                       CSW208
      ** Update LTRIX detail record                                                           CSW208
      *                                                                                       CSW208
     O********E*               TRXDTL                                                CSW208 AR322732
     OLTRIX   EADD             TRXDTL                                                       AR322732
     O                                    2 'DL'                                              CSW208
     O                         FELOAN     8                                                   CSW208
     O                         VDAT      13                                                   CSW208
     O                                   16 '000'                                             CSW208
     O                         CHTPD     17                                                   CSW208
     O                         CNRQD     18                                                   CSW208
     O                                   19 'N'                                               CSW208
     O                                   20 ' '                                               CSW208
     O                                   25 '00001'                                           CSW208
     O                                   26 'N'                                               CSW208
     O                         PRI1D     27                                                   CSW208
     O                         BRCAD     34                                                   CSW208
     O**********               RRNAD     37P                                         CSW208 AR322732
     O                         RRNTD     37P                                                AR322732
     O                         NATN      40P                                                  CSW208
     O                         PRI2D     41                                                   CSW208
     O                         PRI3D     42                                                   CSW208
     O                         PRI4D     43                                                   CSW208
     O                                   44 ' '                                             AR322732
     O                                   45 ' '                                             AR322732
      /EJECT
      ****************************************************************
      * Release file.
     OLEFEEDF E
** CPY@
(c) Finastra International Limited 2001
**  WCTP
0102030405061112131415162122
** STAMP - Dummy timestamp                                                                    CLE034
0001-01-01-00.00.00.000000                                                                    CLE034
**  ECTP                                                                                      CLE073
0102030405061112131415162122979899                                                            CLE073
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
** OPTAG - OPEN TAGS for XML                                                                  CSD015
<Receipt Nostro>                                                                              CSD015
<Receipt Intermed Bank>                                                                       CSD015
<Receipt Ordering Bank>                                                                       CSD015
<Receipt Ordering Cust>                                                                       CSD015
<Payment Nostro>                                                                              CSD015
<Payment Intermed Bank>                                                                       CSD015
<Payment Ordering Bank>                                                                       CSD015
<Payment Ordering Cust>                                                                       CSD015
<Receiver Correspondent>                                                                      CSD015
<Receiver>                                                                                    CSD015
<Account With Bank>                                                                           CSD015
<Beneficiary>                                                                                 CSD015
<Details Of Payment>                                                                          CSD015
** CLTAG - CLOSE TAGS for XML                                                                 CSD015
</Receipt Nostro>                                                                             CSD015
</Receipt Intermed Bank>                                                                      CSD015
</Receipt Ordering Bank>                                                                      CSD015
</Receipt Ordering Cust>                                                                      CSD015
</Payment Nostro>                                                                             CSD015
</Payment Intermed Bank>                                                                      CSD015
</Payment Ordering Bank>                                                                      CSD015
</Payment Ordering Cust>                                                                      CSD015
</Receiver Correspondent>                                                                     CSD015
</Receiver>                                                                                   CSD015
</Account With Bank>                                                                          CSD015
</Beneficiary>                                                                                CSD015
</Details Of Payment>                                                                         CSD015
** SVALTX - System value key text                                                             CLE148
LoanAlphaAllow                                                                                CLE148
