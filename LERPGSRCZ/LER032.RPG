     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Loan/facility history update')                *
/*OVRF*: OVRDBF FILE(HISUPD1) TOFILE(HISUPD) SHARE(*NO)             : *                       246032
      *****************************************************************
      *                                                               *
      *  Midas - Customer Lending Module                              *
      *                                                               *
      *  LER032 - LOAN/FACILITY HISTORY UPDATE                        *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD053826           Date 25Sep19               *
      *  Prev Amend No. MD037440           Date 18Sep19               *
      *                 246029             Date 18Sep19               *
      *                 MD051963A          Date 10Dec18               *
      *                 AR325915           Date 03Oct18               *
      *                 MD045032           Date 07Apr18               *
      *                 CLE168             Date 26Feb18               *
      *                 MD046248           Date 27Oct17               *
      *                 AR802544           Date 28Jul11               *
      *                 MD038236           Date 14Apr16               *
      *                 CLE154             Date 06Aug12               *
      *                 259872             Date 02Feb15               *
      *                 MD027262           Date 02Feb15               *
      *                 CRE095             Date 25Apr14               *
      *                 CRE090             Date 14Feb14               *
      *                 AR1095876          Date 30Sep13               *
      *                 MD020563           Date 21May13               *
      *                 AR806351           Date 24Apr13               *
      *                 AR1097176          Date 22Mar13               *
      *                 254211             Date 20Feb13               *
      *                 CFC006             Date 06Aug12               *
      *                 AR991602           Date 11Feb13               *
      *                 AR571209           Date 01Aug12               *
      *                 AR398038           Date 01Aug12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR652989           Date 03Aug12               *
      *                 AR657105           Date 27Jul12               *
      *                 AR899028           Date 25Jan12               *
      *                 AR847269           Date 09Nov11               *
      *                 CLE147             Date 30Sep11               *
      *                 CRE073             Date 06Dec10               *
      *                 AR798540           Date 10Jun11               *
      *                 CER042             Date 11May11               *
      *                 CRE075             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 258793             Date 09Feb09               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP205             Date 22Jan10               *
      *                 BUG23388           Date 19Mar09               *
      *                 CSC042             Date 16Feb09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CPK026             Date 02Jan07               *
      *                 248133A            Date 12Jun07               *
      *                 246709             Date 31May07               *
      *                 247164             Date 20Apr07               *
      *                 246032             Date 13Apr07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 213749             Date 17Oct06               *
      *                 240436             Date 18Sep06               *
      *                 239910             Date 29Jun06               *
      *                 224974             Date 06Jun06               *
      *                 222461             Date 06Jun06               *
      *                 228881             Date 06Jun06               *
      *                 228002             Date 26May06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG8222            Date 25May06               *
      *                 CLE042             Date 06Sep05               *
      *                 CLE106             Date 14Feb05               *
      *                 225591             Date 08Jul04               *
      *                 CLE041             Date 15Oct04               *
      *                 BUG5224            Date 16Dec04               *
      *                 CLE040             Date 05Jul04               *
      *                 BUG3035            Date 03Jun04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CLE029             Date 04Sep02               *
      *                 CAP073             Date 08Aug02               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CLE028             Date 27Jun02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 206325             Date 06Jun02               *
      *                 204646             Date 26Apr02               *
      *                 204450             Date 25Apr02               *
      *                 204647             Date 25Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAP068             Date 25JUN02               *
      *                 203890             Date 18Mar02               *
      *                 203185             Date 20Feb02               *
      *                 203070             Date 14Feb02               *
      *                 CLE023             Date 19Nov01               *
      *                 200289             Date 19Nov01               *
      *                 193859             Date 19Nov01               *
      *                 194912             Date 19Nov01               *
      *                 194943             Date 18Dec01               *
      *                 193603             Date 31Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 195125             Date 11Jul01               *
      *                 185781             Date 05Jul01               *
      *                 CLE014             Date 20Mar01               *
      *                 179594             Date 07Jun01               *
      *                 190627             Date 10May01               *
      *                 179077             Date 02Apr01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 184748             Date 18Jan01               *
      *                 182274             Date 17Jan01               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 171851             Date 19Jun00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 161412             Date 02Jun99               *
      *                 162667             Date 21May99               *
      *                 159692             Date 11May99               *
      *                 159961             Date 27Apr99               *
      *                 159212             Date 26Apr99               *
      *                 159499             Date 20Apr99                *
      *                 159050             Date 16Apr99               *
      *                 158852             Date 16Apr99               *
      *                 158138             Date 16Apr99               *
      *                 158559             Date 16Apr99               *
     A*                 156993             Date 29Mar99               *
      *                 157050             Date 09Apr99               *
      *                 156585             Date 08Mar99               *
      *                 154529             Date 04Mar99               *
      *                 154584             Date 18Feb99               *
      *                 153938             Date 02Feb99               *
      *                 152164             Date 22Feb99               *
      *                 149036             Date 22Feb99               *
      *                 147509             Date 22Feb99               *
      *                 147488             Date 22Feb99               *
      *                 144712             Date 22Feb99               *
      *                 128980             Date 03Jan99               *
      *                 146936             Date 06Nov98               *
      *                 127733             Date 08Dec97               *
      *                 127728             Date 01Dec97               *
      *                 127723             Date 27Nov97               *
      *                 CLE005             Date 22May97               *
      *                 CLE004             Date 02Dec96               *
     A*                 063200             Date 18Apr95               *
     A*                 S01408             Date 22Feb95               *
     A*                 081634             DATE 12JAN95               *
     A*                 S01473             DATE 22JUL94               *
     A*                 053523 (FB0052)    DATE 08SEP93               *
     A*                 BH3502             DATE 26AUG92               *
     A*                 FS0005             DATE 22JUL92               *
     A*                 E29762             DATE 07APR92               *
     A*                 E29760             DATE 07APR92               *
     A*                                                               *
     A*---------------------------------------------------------------*
     A*                                                               *
      *  MD053826 - Consider any back valued RC of the tranche when   *
      *             updating a CA with 'T' revolving credit indicator *
      *  MD037440 - Facility amount of credit agreement is incorrect  *
      *             after backvalued transaction. Extend fix 246029.  *
      *           - Rename the rest of the fields in HISUPD1 as       *
      *             preventive fix. Apply part of fix MD029006.       *
      *           - Ensure that HISACT's HTRRC value passed to @RCI is*
      *             for the same facility in FACHISA being processed  *
      *             in SR/FACTAC. Enhance fix 240436.                 *
      *           - Applied for MD053826.                             *
      *  246029 - Revolving Credit indicator is corrupted for CAs     *
      *           with RVCR = 'T' after backvalued transactions are   *
      *           processed. The actual value needs to be saved in a  *
      *           separate work field, as @RCI is used to contain the *
      *           value from the relevant Tranche for calculation     *
      *           purposes. Applied CIC-LDN DBA3.05 fix GEMS208272.   *
      *         - Applied for MD053826.                               *
      *  MD051963A - FBM 2.1 SP16 upgrade - Difference in Facility    *
      *              History                                          *
      *  AR325915 - Fclty amounts on tranche did not reflect in CA.   *
      *             Partially applied Gems fix 248611.                *
      *           - Applied for MD051963.                             *
      *  MD045032 - No reversal entries for previous facility.        *
      *             Delete history tagged as reversal. Write history  *
      *             into LECLHIST file before deletion to generate    *
      *             reversal CFA entries for previous facility.       *
      *             Applied for CLE169.                               *
      *  CLE168 - Allow Debit of Blocked Account (Recompile)          *
      *  MD046248 - Finastra Rebranding                               *
      *  AR802544 - LERC30A failed due to an invalid array index.     *
      *             Applied core fix 171451 (Child: AR802545)         *
      *             Applied fix for MDA-22967                         *
      *  171451 - Field HAACTN remains 'RV' causing the index to the  *
      *           array SQN to overflow and become 0, hence an inva-  *
      *           lid array index.                                    *
      *  MD038236 - Utilisation increase and decrease not reversed    *
      *             when MFU is reversed. Do 204646 code removing the *
      *             sequence in SQN array for 'CA' facility only.     *
      *  CLE154 - Loan Repayment Schedule Enhancement (Recompile)     *
      *  259872 - Undrawn amount posted in FACHISA is incorrect and   *
      *           the drawn amount reflected in LER032P1 is wrong.    *
      *         - Include offset indicator in the validation.         *
      *         - Set pointer to the last record processed in HISACT  *
      *           to ensure that correct drawn amount is reflected in *
      *           LER032P1.                                           *
      *         - Applied for AR1042783.                              *
      *  MD027262 - RECI corrupted for Credit Agreement.              *
      *  CRE095 - Rate Fixing for RE Accounts (Recompile)             *
      *  CRE090 - Delay Capitalisation of Interest (Recompile)        *
      *  AR1095876- ABC - Forward Days 1 should = DNWD-1, not just    *
      *             RUND (Child: AR1095877) (Recompile)               *
      *  MD020563 - CFC006 issues                                     *
      *  AR806351 - Principal increase on PDCL's has affected the     *
      *             drawn amount. Bypass update of files on PI of     *
      *             PDCL with type X or FAMU = N. (Child: AR806352)   *
      *  AR1097176 - Accessing AOCOMR0 multiple times slows down the  *
      *              system                                           *
      *  254211 - Facility exchange rate function error for rollovers.*
      *           Add the missing fix for 247164 when it is processing*
      *           the RO record from HISACT.                          *
      *         - Applied for AR968622 (Child: AR968623)              *
      *  CFC006 - COB Restructure - Remove reports from COB           *
      *  AR991602 - The array index is not valid. File pointer is     *
      *             incorrectly being set for reversed manual         *
      *             facility utilisation records.                     *
      *             (Child:AR991603)                                  *
      *  AR571209 - Only update FADRAM & FAUNDR for PDCL start if it  *
      *             is for Interest or for a Fee and has FAMU = 'Y'.  *
      *             (Child: AR571217)                                 *
      *  AR398038 - Wrong Facility History update.                    *
      *             (Child: AR398039)                                 *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR652989 - Wrong sequence number for backvalued RC when there*
      *             are already records existing at the given date.   *
      *             Applied fix 250702 and AR577770. (Child: AR659685)*
      *  AR657105 - 0.01 difference in available amount. Enhance fix  *
      *             224974, include FACHISA records. (Child: AR657106)*
      *  AR899028 - NOSTRO AMAD System errors occured; applied        *
      *             fix AR847269                                      *
      *  AR847269 - Column F1DACN not in specified tables (Recompile) *
      *  CLE147 - Aggregate Facility (Recompile)                      *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  AR798540 - Applied fix of AR787620 ;                         *
      *             Hooks Incorporation                               *
      *             WNCPYSRC,LEH00307                                 *
      *             WNCPYSRC,LEH00308                                 *
      *             WNCPYSRC,LEH00309                                 *
      *             WNCPYSRC,LEH00310                                 *
      *             WNCPYSRC,LEH00311                                 *
      *             WNCPYSRC,LEH00312                                 *
      *             WNCPYSRC,LEH00313                                 *
      *             WNCPYSRC,LEH00314                                 *
      *  CER042 - Interest Scale Report Correspondence                *
      *           (Upgrade of FGE178/179) (Recompile)                 *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  258793 - Applied fix from RIB Bulgaria, CMS001.              *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CAP205 - Teller Related APIs - Account Balance Check         *
      *           (Recompile)                                         *
      *  BUG23388 - LEC07 & LEC10 (Applied fix 255932).               *
      *  255932 - Component LEC07/LEC10  failed. Should not update    *
      *           Facility Trailer for closed facility.               *
      *  CSC042 - Performance is appalling due to *LOVAL SETTL FCLYYZ *
      *           followed by READ FCLTYZ. In tests this took 325ms to*
      *           execute whereas a CHAIN FCLTYZ took less than 1ms   *
      *           Of course the best fix would be to only update the  *
      *           FCLTYZ once at the end of the pgm execution rather  *
      *           than every update to FCLTYFN but as the code is     *
      *           already set up this way this fix is less disruptive *
      *           Net result is RPG execution changes from 3.5 hours  *
      *           to less than 5 minutes at RIB                       *
      *           Cut out use of AOCURRR* for currency decimal places *
      *           As this is the only field used from CC file then    *
      *           store and get this field from an array              *
      *  CPK026 - Change numeric customer number.                     *
      *  248133A- Rename field FAAFAM in HISUPD1 to prevent corruption*
      *  246709 - Expired facility should be indicated as expired     *
      *           Applied DBA3 fix 223736                             *
      *  247164 - Amend this program to match change in LER033 done   *
      *           for 243656.                                         *
      *  246032 - Incorrect update of CA's FACFAM upon entry of back  *
      *           backvalued repayment against a non-revolving TR.    *
      *           Reset indicators 14 and 15 to get TR's correct      *
      *           revolving credit indicator. Apply R3.5 fix 219273.  *
      *           Incorrect update of field FACFAM during backvalued  *
      *           loan maturity. Amended program to use the correct   *
      *           revolving credit indicator if CA's FARCIN or HARCIN *
      *           is 'T'. Apply R3.5 fix 216151.                      *
      *           For CAs, need to discover value of RVCR of Tranche  *
      *           at value date of event. Apply R3.5 fix 213698.      *
      *  213749 - Report Facilities if the drawn amount difference    *
      *           between the facility history and facility detail    *
      *           is beyond 10 for 0 decimal place, 1 for 1 decimal   *
      *           place, 0.1 for 2 decimal places and 0.01 for 3      *
      *           decimal places.                                     *
      *  240436 - Applied client's fix 214774 (partial).              *
      *           Error in 'T' function at Credit agreement level.    *
      *           Use tranche's RVCR if CA's RVCR is 'T' to correctly *
      *           calculate CA facility amounts.                      *
      *  239910 - LERC30A Failed                                      *
      *  224974 - MCCY facility at maturity does not close exposure   *
      *           (rounding). Adjust amount in maturity to settle the *
      *           discrepancy between Facility Amount and Actual      *
      *           Facility Amount.                                    *
      *  222461 - GASS and RCSI should be initialised before          *
      *           accessing loan details in case the loans have       *
      *           already been dropped. Same as 228002.               *
      *  228881 - Ensure FR action amount is used as FACFAM for       *
      *           events valued on facility reactivation date.        *
      *         - Ensure facility increase or decrease affects the    *
      *           facility amount even when inserted to value on the  *
      *           reactivation date.                                  *
      *  228002 - FACFAM shouldn't go negative. Clear GASS & RCSI.    *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG8222- If event date is earlier than take-on date, use     *
      *           take-on date instead. This is only for facilities   *
      *           existing prior to M+.                               *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  CLE106 - Syndication Manager                                 *
      *  225591 - Facility history changes for repayments due to      *
      *           rollover. A repayment due to a rollover and         *
      *           non-revolving should not affect the facility amt.   *
      *  CLE041 - Collateralised Lending Phase 2B (Recompile)         *
      *  BUG5224 - LE3180P1 reported a facility imbalance error       *
      *  CLE040 - Collateralised Lending Phase 2 (Recompile)          *
      *  BUG3035 - Error on calculation when a rate change is done    *
      *  CLE025 - Credit Lines                                        *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  CLE029 - Addition of Severity code and Limit ID to FCLTYFM   *
      *  CAP073 - Conversion of MN inputs into modular structure to   *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enahancements to CAS001, CAS002 and CAS004          *
      *           (Recompile)                                         *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  206325 - Availability of Credit Agreement was wrong after the*
      *           COB. Amendment to fix 203890 - only calculate WDIFF *
      *           after accessing the correct record from FCLTYFN.    *
      *  204646 - MFU reversal incorrectly processed.  Changes made   *
      *           similar to those done under 204393. Problem in the  *
      *           processing for reversal loan/MFU was actually due   *
      *           to codes under 200401 which applied core fix 185781 *
      *           Also, ensure array SQN is updated accordingly after *
      *           processing each reversal.                           *
      *  204450 - Ensure update of facility amount is correctly taken *
      *           into consideration when facility and loan are both  *
      *           reactivated on the same day.                        *
      *  204647 - Ensure correct CA revolving credit indicator is     *
      *           output to FACHISA.  If CA facility has 'T' for the  *
      *           revolving credit indicator, it should also have the *
      *           same value when it is written to FACHISA.           *
      *  CAP068 - Recompiled for changes to FCLTYFM and FCLTYFN.      *
      *  203890 - Do not override the values of future dated OAM array*
      *           with the drawn amount computed for FADRAM.          *
      *  203185 - Do not update amounts for reversed records. This    *
      *           is already being ignored in recalculation.          *
      *  203070 - Chain to Matured Loans file to retrieve matured     *
      *           loan's detail. Also, added appropriate conditions   *
      *           in SR/FACTAC for update of amounts due to loan      *
      *           events.                                             *
      *  CLE023 - Lending Facility History Improvements.              *
      *  200289 - Increase facility sequence number in FACHISA from   *
      *           2 to 3.                                             *
      *  193859 - Multi-ccy Rollover corrupts Facility amounts.       *
      *           Amend fix 146936 to process all types of multi-ccy  *
      *           rollover when updating facility history amounts.    *
      *           Also, reverse part of fix for 162343.               *
      *  194912 - Change multi-ccy event from 'ST' to 'MC'            *
      *  194943 - Facility and available amount incorrectly updated   *
      *           when a back-valued 'RC' is entered.                 *
      *  193603 - Incorrect hash totalling when facility amount goes  *
      *           negative                                            *
      *  195125 - Facility history file not updated by utilisation    *
      *           records.                                            *
      *  185781 - Incorrect sequencing of facility history records    *
      *           due to backvalued transactions. Facility amount,    *
      *           Drawn and Undrawn were not recomputed  after entry  *
      *           of backvalued transactions.                         *
      *  CLE014 - Customer Driven Lending Enhancements                *
      *  179594 - If CLE005 is switched off then back valued actions  *
      *           are not calculated correctly.                       *
      *  190627 - Recompiled due to fields added to FCLTY1 by 189544. *
      *  179077 - Reinstate processing to zeroise facility amount if  *
      *           less than 0, unless CLE005 is installed, to prevent *
      *           situation where customer is shown as being          *
      *           overdrawn by the total of loans outstanding - amend *
      *           fix 159499.                                         *
      *  184748 - Drawn and Undrawn amounts on FACHISA wrong after a  *
      *           loan reversed. Apply fix 169546 (moves fix 162667):-*
      *  182274 - Ensure HISUPD record for correct facility is read   *
      *           and updated.                                        *
      *  171851 - RECI on FACHISH not being updated when a facility   *
      *           closes or expires, leading to the history records   *
      *           remaining after the facility itself has been dropped*
      *  161412 - Records for part sold transactions with a non       *
      *           syndicated facility are not generated               *
      *  162667 - Reset @CFA, @DA and @UA not updated on READ HISUPD. *
      *  159692 - Generated Date may not contain valid numeric data,  *
      *           so initialise prior to file access.                 *
      *  159961 - Confusion with wrci (introduced by 154584) causes   *
      *           current value of revolving credit ind to be lost.   *
      *  159212 - Correct the processing of FR's:- drawn amount       *
      *           should be unchanged, recalculate undrawn amount.    *
      *  159499 - Remove code which zeroises a negative facility       *
      *           amount. Consistent with same change in LER020.       *
      *  159050 - Conditioning on when amounts adjusted incorrect.    *
      *           Also, start of 'running totals' should come from    *
      *           last record on FACHISA prior to FACACT date.        *
      *  158852 - When zeroising a negative facility amount,          *
      *           adjust the undrawn amount accordingly.              *
      *  158138 - 1. Program is processing action from HISACT, but    *
      *           then processing the same item through FACHISA.      *
      *           2. READP needs to be REDPE with check on whether    *
      *           record is found.                                    *
      *           3. Reversal indicator not checked before update of  *
      *           running totals on file.                             *
      *  158559 - Corruption of history occurs because current        *
      *           values are not stored after a new record is         *
      *           written to FACHISA.                                 *
      *  156993 - Facility Expiry comes first before Loan Maturity    *
      *           event when both are in the same day.  Thus, drawn   *
      *           amount is computed incorrectly.                     *
      *  157050 - Error on backvalued facility increase.              *
      *  156585 - Error on Facility History update.                   *
      *  154529 - LE0700 file out of balance                          *
      *  154584 - Facility increase/decrease are not updated on       *
      *           history's o/s amounts                               *
      *  153938 - Facility expiry record gives odd drawn amount if    *
      *           loan matured.                                       *
      *  152164 - Reconciliation report includes CA default facilities*
      *  149036 - Recompiled due to changes in LF/FCLTY1              *
      *  147509 - Wrong Drawn Amount in facility history report when  *
      *           an expired facility has still an outstanding LEO    *
      *           transaction                                         *
      *  147488 - Difficulty in distinguishing a prime and a          *
      *           participant facility on Facility Activity Enquiry   *
      *  144712 - Change revolving to non-revolving, changes history  *
      *           If action is 'RC' zeroise @UADJ so that Undrawn     *
      *           Amount will have the correct value.                 *
      *  128980 - Tranche does not show historic details of           *
      *           participant transactions                            *
      *  146936 - Non-revolving credit facility overdrawn due to      *
      *           multi-ccy rollover.                                 *
      *  127733 - Set reci of FACHISA/FACHISH accordingly for a closed*
      *           or expired facility                                 *
      *  127728 - Set generation indicator to blank when creating     *
      *           FACHISA record to produce contingent facility acctg *
      *  127723 - Facility type change not being shown                *
      *  CLE005 - Customer Lending Enhancements - Others (T3)         *
      *  CLE004 - Customer Lending Enhancements - Syndication         *
     A*  063200 - If loan is deleted and its facility deleted on the   *
     A*           same day then a database error occurs as the Lending *
     A*           Enhancements assume that the reversed facility       *
     A*           stays on the FCLTY file. It is , however, dropped on *
     A*           the same day. If the facility is not found on the    *
     A*           FCLTY file search the Reversed/Closed Facilities     *
     A*           file PF/PEFCLFM.                                     *
     A*  S01408 - Addition of core hook LER032CPDR                    *
     A*           Addition of core hook LER032CEIP                    *
     A*           Addition of core hook LER032CCPG                    *
     A*           Addition of core hook LER032IIPG                    *
     A*           Addition of core hook LER032FFPG                    *
     A*           Addition of core hook LER032CPLH                    *
     A*  081634 - Remove code that sets Facility amount for Expired   *
     A*           facility to 1 unit rather than 0, to avoid division *
     A*           by 0 in other programs as this will not happen.     *
     A*  S01473 - Leo Midas Integration. Output the L/C reference     *
     A*           to PF/FACHISA.                                      *
     A*  053523 - If database error occurs, output details of the     *
     A*           key.                                                *
     A*  BH3501 - Sequence number on backvalued facility history      *
     A*           actions incorrect.                                  *
     A*  FS0005 - LEO/Midas Integration, output L/C Reference         *
     A*  E29762 - History checked incorrectly - changed so            *
     A*           that revolving credit facilities are reported       *
     A*           in the same way as non-revolving facilities.        *
     A*           and the report now shows expired facilities.        *
     A*  E29760 - All for 100 reversals for each facility             *
     A*                                                               *
     A*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     A*****************************************************************
      *
     FFCLTY1  IF  E           K        DISK
      ** Facilities Files (FM & FN) with branch details
      *                                                                   154584
     FFCLTY   UF  E           K        DISK                               154584
     F            FCLTYHHF                          KIGNORE               154584
     F            FCLTYFMF                          KRENAMEFCLTYM         154584
     F            FCLTYFNF                          KRENAMEFCLTYN         154584
     F            FCLTYZZF                          KRENAMEFCLTYZ         154529
     F*********** FCLTYZZF                          KIGNORE        154584 154529
      ** Facilities Files                                                 154584
      *
     FFACHISHLUF  E           K        DISK
      ** Facility History Header
      *
     FCLOANLB IF  E           K        DISK                               128980
     F            CLOANCLF                          KRENAMECLOANB         128980
      *                                                                   128980
     FMLOAN   IF  E           K        DISK                                                   203070
     F            CLOANHHF                          KIGNORE                                   203070
     F            CLOANCLF                          KRENAMEMLOANB                             203070
     F            CLOANCKF                          KIGNORE                                   203070
     F            CLOANZ1F                          KIGNORE                                   203070
      *                                                                                       203070
     FLEHISFL0IF  E           K        DISK                                                   224974
      ** Midas LE Facility history amounts by loan                                            224974
     F            HISACTF                           KRENAMEHISACT1                            224974
     F            FACHISAF                          KRENAMEFACHIS1                            224974
      *                                                                                       224974
     FHISACTL2IF  E           K        DISK                               154584
     F            HISACTF                           KRENAMEHISACT2        154584
      *                                                                   154584
     FHISUPD  UF  E           K        DISK                      A
      ** History Actions/Facility History Amounts
      *
     FHISUPD1 IF  E           K        DISK                                                   246032
     F            HISACTF                           KRENAMEHISACT3                            246032
     F            FACHISAF                          KRENAMEFACHIS3                            246032
      ** History Actions/Facility History Amounts                                             246032
      *                                                                                       246032
     FFACACTL1IF  E           K        DISK
      ** Facilities Actioned
      *
     FPEFCLFL1IF  E           K        DISK                               063200
     F            FCLTYFMF                          KRENAMEPEFCLFLF       063200
     F*                                                                   063200
     F** REVERSED & CLOSED FACILITY RECORDS LOGICAL KEYED ACCESS          063200
     F*                                                                   063200
     FPEFCLFM IF  E           K        DISK
      ** Reversed & Closed Facility Records
     F            FCLTYFMF                          KRENAMEPEFCLFMF
     FLEFCLTLGIF  E           K        DISK                                                   CLE025
     F            LEFCLTD0                          KRENAMELEFCLTDG                           CLE025
      ** Facilities Extension File                                                            CLE025
      *                                                                                       CLE025
     FLEFCLTLHUF  E           K        DISK                                                   CLE025
      ** Facilities Extension File                                                            CLE025
      *                                                                                       CLE025
     FACCNTAB UF  E                    DISK                                                   CLE025
      ** GL Account Master File                                                               CLE025
      *                                                                                       CLE025
     FGLACNTL3UF  E           K        DISK                                                   CLE025
      ** GL Account Master Extension File                                                     CLE025
      *                                                                                       CLE025
     FFACHSAL5UF  E           K        DISK                                                   CLE025
     F            FACHISAF                          KRENAMEFACHISA5                           CLE025
      ** Facilities History Details                                                           CLE025
      *
     FPEFCLTL1IF  E           K        DISK                                                   239910
     F            LEFCLTD0                          KRENAMEPEFCLTLR                           239910
      ** Facilities Extension File by Branch                                                  239910
      *                                                                                       239910
     FSDCURRPDIF  E                    DISK                           UC                      CSC042
      *                                                                                       CSC042
     FLER032P1O   E             50     PRINTER      KINFDS SPOOL      UC
      ** Facilities History Reconciliation Exceptions Report
      *
     F**LER032AUO   E                  PRINTER      KINFDS SPOOLU     UC  0026
     FLER032AUO   E                    PRINTER      KINFDS SPOOLU         0026
      ** Facilities History Audit report
      *
     FLECLHIPDO   E                    DISK                      A                          MD045032
     F            FACHISAF                          KRENAMEFACHISCL                         MD045032
      ** Midas LE Credit Lines Deleted History                                              MD045032
     F*                                                                   S01408
     F/COPY WNCPYSRC,LER032FFPG                                           S01408
     F*                                                                   S01408
      *****************************************************************
      *                                                               *
      *  F U N C T I O N   O F   I N D I C A T O R S                  *
      *                                                               *
      * 10    Format for Facilities History Action File               *
      * 11    Format for History Action File                          *
      * 14    Format for Facilities History Action File from HISUPD1  *                       246032
      * 15    Format for History Action File from HISUPD1             *                       246032
      **21****Records*have*been*archived*****                         *  0022
      * 21    Facility history record amounts are in error message    *  0022
      *    25          CLE004 is switched *ON                         *   CLE004
      * 25    Lookup on SQN                                           *   CLE005
      * 33    Multibranching indicator                                *
      * 50    Overflow indictor                                       *
      * 60    Number of Decimal Places = 0                            *
      * 61    Number of Decimal Places = 1                            *
      * 62    Number of Decimal Places = 2                            *
      * 63    Number of Decimal Places = 3                            *
      * 80    Record not found                                        *
      * 81    Record not found on LF/PEFCLFL1 (PF/PEFCLFM)            *   063200
      * 83    Beginning of file on facilities history amounts record  *
      * 84    Record not found on history update file                 *
      * 86    Record not found on PEFCLFM                             *
      * 87    Record not found on READE to FACHISA/FACHISH            *
      * 90    EOF on facilities actioned today file                   *
      *                                                               *
      *  U7+U8 - Database Error                                       *
      *                                                               *
      *****************************************************************
      *
     E***********         LN         10  6 0                              E29760
     E**********          LN        100  6 0                                           E29760 CLE148
     E                    LN        100  6                                                    CLE148
      ** Reversed Loans
     E                    CPY@    1   1 80
      ** Copyright statement
      *
     E**********          WFIND   1   3 11                                             CLE004 CLE106
     E                    WFIND   1   5 11                                                    CLE106
      ** Facility types                                                   CLE004
      *                                                                   CLE004
     E                    SQN       100  3 0                              CLE005
      ** Sequence Array                                                   CLE005
     E                    CURR      150  3               All CCYS                             CSC042
     E                    CCDP      150  1 0             Dec Places/CCY                       CSC042
      *                                                                   CLE005
     E                    VDL       100  6 0                                                  CLE025
      ** Reversed Deals Array                                                                 CLE025
      *                                                                                       CLE025
     E                    IDL       100  6 0                                                  CLE025
      ** Reinstated Deals Array                                                               CLE025
      *                                                                                       CLE025
      /SPACE 3
      *
     IFACHISAF    10
     IHISACTF     11
      ** HISUPD Formats
      *
     IFACHIS3     14                                                                          246032
     I              FARECI                          F2RECI                                    246032
     I              BRCA                            BRCA2                                     246032
     I              FACNUM                          F2CNUM                                    246032
     I              FAFCTY                          F2FCTY                                    246032
     I              FADATE                          F2DATE                                    246032
     I              FAFSEQ                          F2FSEQ                                    246032
     I              FALOAN                          F2LOAN                                    246032
     I              FAACTN                          F2ACTN                                    246032
     I              FAAAMT                          F2AAMT                                    246032
     I              FAPART                          F2PART                                    246032
     I              FARCIN                          F2RCIN                                    246032
     I              FACFAM                          F2CFAM                                    246032
     I              FADRAM                          F2DRAM                                    246032
     I              FAUNDR                          F2UNDR                                    246032
     I              FAREVI                          F2REVI                                    246032
     I              FALCRF                          F2LCRF                                    246032
     I              FAGNDT                          F2GNDT                                    246032
     I              FASQNO                          F2SQNO                                    246032
     I              FACFGI                          F2CFGI                                    246032
     I              FAGASS                          F2GASS                                    246032
     I              FATSEQ                          F2TSEQ                                  MD037440
     I              FALUCY                          F2LUCY                                  MD037440
     I              FALUAM                          F2LUAM                                  MD037440
     I              FAEXRT                          F2EXRT                                  MD037440
     I              FARTMD                          F2RTMD                                  MD037440
     I              FAPTYP                          F2PTYP                                  MD037440
     I              FARCSI                          F2RCSI                                  MD037440
     I              FAORED                          F2ORED                                  MD037440
     I              FAAFAM                          F2AFAM                                   248133A
     I              FAPAMT                          F2PAMT                                  MD037440
     I              FALPFI                          F2LPFI                                  MD037440
     I              FAOFFS                          F2OFFS                                  MD037440
     I              FADEAL                          F2DEAL                                  MD037440
     I              FAMCY                           F2MCY                                   MD037440
     I              FAACBR                          F2ACBR                                  MD037440
     I              FAACCU                          F2ACCU                                  MD037440
     I              FAACCY                          F2ACCY                                  MD037440
     I              FAACCD                          F2ACCD                                  MD037440
     I              FAACSQ                          F2ACSQ                                  MD037440
     I              FAACNO                          F2ACNO                                  MD037440
     I              FATTEO                          F2TTEO                                  MD037440
     I              FAPTEO                          F2PTEO                                  MD037440
     I              FAEXCY                          F2EXCY                                  MD037440
     I              FATVAL                          F2TVAL                                  MD037440
     I              FAWEIG                          F2WEIG                                  MD037440
     I              FAWCPC                          F2WCPC                                  MD037440
     I              FAINOF                          F2INOF                                  MD037440
     I              FAFXMT                          F2FXMT                                  MD037440
     I              FAFXPC                          F2FXPC                                  MD037440
     I              FARIND                          F2RIND                                  MD037440
     IHISACT3     15                                                                          246032
     I              BRCA                            BRCA2                                     246032
     I              HACNUM                          H2CNUM                                    246032
     I              HAFCTY                          H2FCTY                                    246032
     I              HADATE                          H2DATE                                    246032
     I              HASEQ                           H2SEQ                                     246032
     I              HALOAN                          H2LOAN                                    246032
     I              HAACTN                          H2ACTN                                    246032
     I              HAAAMT                          H2AAMT                                    246032
     I              HAPART                          H2PART                                    246032
     I              HALCRF                          H2LCRF                                    246032
     I              GEDT                            GEDT2                                     246032
     I              HASQNO                          H2SQNO                                    246032
     I              HAECIN                          H2ECIN                                    246032
     I              HARCIN                          H2RCIN                                    246032
     I              HAGASS                          H2GASS                                    246032
     I              HATRRC                          H2TRRC                                    246032
     I              HAOLRC                          H2OLRC                                    246032
     I              HATSEQ                          H2TSEQ                                  MD037440
     I              HALUCY                          H2LUCY                                  MD037440
     I              HALUAM                          H2LUAM                                  MD037440
     I              HAEXRT                          H2EXRT                                  MD037440
     I              HARTMD                          H2RTMD                                  MD037440
     I              HAPTYP                          H2PTYP                                  MD037440
     I              HARCSI                          H2RCSI                                  MD037440
     I              HALPFI                          H2LPFI                                  MD037440
     I              HADEAL                          H2DEAL                                  MD037440
     I              HAMCY                           H2MCY                                   MD037440
     I              HAACBR                          H2ACBR                                  MD037440
     I              HAACCU                          H2ACCU                                  MD037440
     I              HAACCY                          H2ACCY                                  MD037440
     I              HAACCD                          H2ACCD                                  MD037440
     I              HAACSQ                          H2ACSQ                                  MD037440
     I              HAACNO                          H2ACNO                                  MD037440
     I              HATTEO                          H2TTEO                                  MD037440
     I              HAPTEO                          H2PTEO                                  MD037440
     I              HAEXCY                          H2EXCY                                  MD037440
     I              HATVAL                          H2TVAL                                  MD037440
     I              HAWEIG                          H2WEIG                                  MD037440
     I              HAWCPC                          H2WCPC                                  MD037440
     I              HAINOF                          H2INOF                                  MD037440
     I              HAFXMT                          H2FXMT                                  MD037440
     I              HAFXPC                          H2FXPC                                  MD037440
     I              HARIND                          H2RIND                                  MD037440
      ** HISUPD1 Formats                                                                      246032
      *                                                                   128980
     ICLOANB                                                              128980
     I              RECI                            XRECI                 128980
     I              LNRF                            XLNRF                 128980
     I              CNUM                            XCNUM                 128980
     I              BRCA                            XBRCA                 128980
     I              LASQ                            XLASQ                 128980
     I              FCUS                            XFCUS                 128980
     I              FTYP                            XFTYP                 128980
     I              FSEQ                            XFSEQ                 128980
     I              CCY                             XCCY                  128980
     I              FCCY                            XFCCY                 128980
     I              NBRA                            XNBRA                 128980
     I              CPAM                            XCPAM                                   AR657105
      *                                                                                       203070
     IMLOANB                                                                                  203070
     I              RECI                            XRECI                                     203070
     I              LNRF                            XLNRF                                     203070
     I              CNUM                            XCNUM                                     203070
     I              BRCA                            XBRCA                                     203070
     I              LASQ                            XLASQ                                     203070
     I              FCUS                            XFCUS                                     203070
     I              FTYP                            XFTYP                                     203070
     I              FSEQ                            XFSEQ                                     203070
     I              CCY                             XCCY                                      203070
     I              FCCY                            XFCCY                                     203070
     I              NBRA                            XNBRA                                     203070
      *                                                                                       224974
     IHISACT1                                                                                 224974
     I              BRCA                            BRCA1                                     224974
     I              HACNUM                          CNUM1                                     224974
     I              HAFCTY                          FCTY1                                     224974
     I              HADATE                          DATE1                                     224974
     I              HASEQ                           SEQN1                                     224974
     I              HALOAN                          LOAN1                                     224974
     I              HAACTN                          ACTN1                                     224974
     I              HAAAMT                          AAMT1                                     224974
     I              HAPART                          PART1                                     224974
     I              HALCRF                          LCRF1                                     224974
     I              GEDT                            GEDT1                                     224974
     I              HASQNO                          SQNO1                                     224974
     I              HARCIN                          RCIN1                                     224974
     I              HATSEQ                          SEQT1                                     224974
      *                                                                                     AR657105
     IFACHIS1                                                                               AR657105
     I              FARECI                          F3RECI                                  AR657105
     I              BRCA                            F3BRCA                                  AR657105
     I              FACNUM                          F3CNUM                                  AR657105
     I              FAFCTY                          F3FCTY                                  AR657105
     I              FADATE                          F3DATE                                  AR657105
     I              FAFSEQ                          F3FSEQ                                  AR657105
     I              FALOAN                          F3LOAN                                  AR657105
     I              FAACTN                          F3ACTN                                  AR657105
     I              FAAAMT                          F3AAMT                                  AR657105
     I              FAPART                          F3PART                                  AR657105
     I              FARCIN                          F3RCIN                                  AR657105
     I              FACFAM                          F3CFAM                                  AR657105
     I              FADRAM                          F3DRAM                                  AR657105
     I              FAUNDR                          F3UNDR                                  AR657105
     I              FAREVI                          F3REVI                                  AR657105
     I              FALCRF                          F3LCRF                                  AR657105
     I              FAGNDT                          F3GNDT                                  AR657105
     I              FASQNO                          F3SQNO                                  AR657105
     I              FACFGI                          F3CFGI                                  AR657105
     I              FAGASS                          F3GASS                                  AR657105
     I              FATSEQ                          F3TSEQ                                  AR657105
     I              FALUCY                          F3LUCY                                  AR657105
     I              FALUAM                          F3LUAM                                  AR657105
     I              FAEXRT                          F3EXRT                                  AR657105
     I              FARTMD                          F3RTMD                                  AR657105
     I              FAPTYP                          F3PTYP                                  AR657105
     I              FARCSI                          F3RCSI                                  AR657105
     I              FAORED                          F3ORED                                  AR657105
     I              FAAFAM                          F3AFAM                                  AR657105
     I              FAPAMT                          F3PAMT                                  AR657105
     I              FALPFI                          F3LPFI                                  AR657105
     I/COPY WNCPYSRC,LEH00307
      *                                                                   154584
     IHISACT2                                                             154584
     I              BRCA                            BRCA2                 154584
     I              HACNUM                          CNUM2                 154584
     I              HAFCTY                          FCTY2                 154584
     I              HADATE                          DATE2                 154584
     I              HASEQ                           SEQN2                 154584
     I              HALOAN                          LOAN2                 154584
     I              HAACTN                          ACTN2                 154584
     I              HAAAMT                          AAMT2                 154584
     I              HAPART                          PART2                 154584
     I              HALCRF                          LCRF2                 154584
     I              GEDT                            GEDT2                 154584
     I              HASQNO                          SQNO2                 154584
     I              HARCIN                          RCIN2                 154584
     I              HATSEQ                          SEQT2                                     200289
     I/COPY WNCPYSRC,LEH00308
      *                                                                                      BUG8222
     IFCLTYF                                                                                 BUG8222
     I              ORED                            FMORED                                   BUG8222
      *                                                                   154529
     IFCLTYZ                                                              154529
     I              RECI                            RECIT                 154529
     I              CNUM                            CNUMT                 154529
     I              FACT                            FACTT                 154529
     I              FCNO                            FCNOT                 154529
     I              RCTP                            RCTPT                 154529
      *
     I            DS
      ** Breakdown of Facility No.
     I                                        1   50FCFCTY
     I                                        1   30@FTYP
     I                                        4   50@FSEQ
      *
     I            DS
      ** Facility Amount - History
     I                                        1  130@DSAMT
     I                                        1  131@DSAM1
     I                                        1  132@DSAM2
     I                                        1  133@DSAM3
      *
     I            DS
      ** Drawn Amount History
     I                                        1  130@DTAMT
     I                                        1  131@DTAM1
     I                                        1  132@DTAM2
     I                                        1  133@DTAM3
      *
     I            DS
      ** Facility Amount from Facility Record
     I                                        1  130@DUAMT
     I                                        1  131@DUAM1
     I                                        1  132@DUAM2
     I                                        1  133@DUAM3
      *
     I            DS
     I                                        1  130@DVAMT
     I                                        1  131@DVAM1
     I                                        1  132@DVAM2
     I                                        1  133@DVAM3
      *                                                                                       CLE025
     I            DS                                                                          CLE025
      ** History Offset Amount                                                                CLE025
     I                                        1  130@DWAMT                                    CLE025
     I                                        1  131@DWAM1                                    CLE025
     I                                        1  132@DWAM2                                    CLE025
     I                                        1  133@DWAM3                                    CLE025
      *                                                                                       CLE025
     I            DS                                                                          CLE025
      ** Facility Offset Amount                                                               CLE025
     I                                        1  130@DXAMT                                    CLE025
     I                                        1  131@DXAM1                                    CLE025
     I                                        1  132@DXAM2                                    CLE025
     I                                        1  133@DXAM3                                    CLE025
      *                                                                   053523
     I            DS                                                      053523
      ** Key to files - for DB error report                               053523
     I                                        1  14 U1FKEY                053523
     I                                        1   3 BRCA                  053523
     I**********                              4   90FCCNUM                             053523 CSD027
     I                                        4   9 FCCNUM                                    CSD027
     I                                       10  120U1FTYP                053523
     I                                       13  140U1FSEQ                053523
     I            DS                                                                          CLE025
      ** Key to files - for DB error report                                                   CLE025
     I                                        1  24 U2FKEY                                    CLE025
     I**********                              1   60KYCNUM                             CLE025 CSD027
     I                                        1   6 KYCNUM                                    CSD027
     I                                        7   9 KYCCY                                     CLE025
     I                                       10  190KYACOD                                    CLE025
     I                                       20  210KYACSQ                                    CLE025
     I                                       22  24 KYBRCA                                    CLE025
      *                                                                                     AR571209
     I            DS                                                                        AR571209
      ** Breakdown of Loan Type.                                                            AR571209
     I                                        1   2 LTYP                                    AR571209
     I                                        1   1 LTYP1                                   AR571209
     I                                        2   2 LTYP2                                   AR571209
      *
     ISPOOL       DS
      ** Detail File information data structure
     I                                       83  92 SFILE
     I                                    B 123 1240SFNUM
      *
     ISPOOLU      DS
      ** Audit File information data structure
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
      *
     IRUNDAT    E DS
     I              AGMBIN                          MBIN
      *
     ILDA       E DS
      ** Database error DS
      *
     ISDBANK    E DSSDBANKPD
      ** Bank details
      *
     ISDCURR    E DSSDCURRPD
      ** Currency Type
      *
     ISDBRCH    E DSSDBRCHPD
      ** Branch name details
     I              A8BRNM                          BRNM
      *
     IDSFDY     E DSDSFDY
      ** First DS for access programs, short data structure
      *
     IDSSDY     E DSDSSDY
      ** Second DS for access programs, long data structure
      *
     I*                                                                   S01408
     I***/COPY*WNCPYSRC,LER032IIPGIIPG***                                              S01408 CFC006
     I/COPY WNCPYSRC,LER032IIPG                                                             MD020563
     I*                                                                   S01408
     I              'LER032001'           C         SECTN                                     CFC006
     ISCSARD    E DSSCSARDPD                                              CLE004
      ** Switchable Features File                                         CLE004
      *                                                                   CLE004
     ILERSTS    E DSLERSTS                                                                   BUG8222
     I              FACHISD                         TONDAT                                   BUG8222
     I              LERC2030                        RENAM1                                   BUG8222
     I              LERC135                         RENAM2                                   BUG8222
     I              LERC315                         RENAM3                                   BUG8222
     I              LERC425                         RENAM4                                   BUG8222
     I              EOYFLAG                         RENAM5                                   BUG8222
      *                                                                                      BUG8222
      *****************************************************************
     C/TITLE MAIN PROCESSING
      *****************************************************************
      *
      ** Initialisation
     C                     EXSR INIT
      *
     C                     DO   *HIVAL
      *
      ** Read facilities action file
      *                                                                                       194943
     C                     MOVE *BLANK    WRVCHG                                              194943
      *                                                                                       194943
     C                     READ FACACTF                  90
      *
      ** Store branch details for output on report
     C                     MOVE BRCA      REPBRC  3
      *
      ** If no records on facility action file write out facility
      ** details reconciled message and skip detail output to PRTF.
     C           *IN90     CABEQ'1'       A0100
      *
      ** Using key access facility history header and facility details
      ** records
     C           KEY001    CHAINFACHISHF             80
     C           *IN80     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     Z-ADD@FTYP     U1FTYP                          053523
     C                     Z-ADD@FSEQ     U1FSEQ                          053523
     C                     MOVELU1FKEY    DBKEY                           053523
     C                     MOVEL'LER032'  DBPGM
     C                     MOVEL'FACHISH' DBFILE             ************
     C                     Z-ADD001       DBASE              * DBERR 01 *
     C***********          EXSR OPNFIL                       ************ 0026
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *                                                                   CLE004
      ** If CLE004 is switched *ON, check the participant facility        CLE004
      ** indicator.                                                       CLE004
      *                                                                   CLE004
     C           CLE004    IFEQ 'Y'                                       CLE004
     C                     MOVE *BLANKS   RFAIN                           CLE004
     C                     SELEC                                          CLE004
     C           FHPRTR    WHEQ 'A'                                       CLE004
     C                     MOVELWFIND,1   RFAIN                           CLE004
     C           FHPRTR    WHEQ 'I'                                       CLE004
     C                     MOVELWFIND,2   RFAIN                           CLE004
     C           FHPRTR    WHEQ 'P'                                       CLE004
     C                     MOVELWFIND,3   RFAIN                           CLE004
     C           FHPRTR    WHEQ 'R'                                                           CLE106
     C                     MOVELWFIND,4   RFAIN                                               CLE106
     C           FHPRTR    WHEQ 'S'                                                           CLE106
     C                     MOVELWFIND,5   RFAIN                                               CLE106
     C                     ENDSL                                          CLE004
     C                     ENDIF                                          CLE004
      *
     C           KEY001    CHAINFCLTYF               80
     C           *IN80     IFEQ '1'
     C*                                                                   063200
     C** IF RECORD NOT ON FACILITY FILE THEN CHECK DELETED FACILITIES     063200
     C** FILE.                                                            063200
     C*                                                                   063200
     C           KEY001    CHAINPEFCLFLF             81                   063200
     C*                                                                   063200
     C** IF RECORD NOT ON DELETED FACILITIES FILE THEN THIS IS            063200
     C** DEFINITELY A DATABASE ERROR....                                  063200
     C*                                                                   063200
     C           *IN81     IFEQ '1'                                       063200
     C*                                                                   063200
     C           *LOCK     IN   LDA
     C                     Z-ADD@FTYP     U1FTYP                          053523
     C                     Z-ADD@FSEQ     U1FSEQ                          053523
     C                     MOVELU1FKEY    DBKEY                           053523
     C                     MOVEL'LER032'  DBPGM
     C*********************MOVEL'FCLTY   'DBFILE             ************ 063200
     C                     MOVEL'FCLT/PEF'DBFILE             ************ 063200
     C                     Z-ADD002       DBASE              * DBERR 02 *
     C***********          EXSR OPNFIL                       ************ 0026
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                            063200
     C                     END
      *                                                                                     MD027262
     C                     MOVELRECI      SVRECI  1                                         MD027262
      *                                                                                       CLE025
      ** Access the extension file LEFCLTQD                                                   CLE025
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
      *                                                                                       CLE025
     C                     MOVE FCCNUM    KACNUM                                              CLE025
     C                     MOVE @FTYP     KAFTYP                                              CLE025
     C                     MOVE @FSEQ     KAFSEQ                                              CLE025
      *                                                                                       CLE025
     C           KEY01A    CHAINLEFCLTLG             82                                       CLE025
      *                                                                                       CLE025
     C           *IN82     IFEQ *ON                                                           239910
     C           KEY01A    CHAINPEFCLTL1             82                                       239910
     C                     ENDIF                                                              239910
      *                                                                                       239910
     C           *IN82     IFEQ *ON                                                           CLE025
     C           *LOCK     IN   LDA                                                           CLE025
     C                     Z-ADD@FTYP     U1FTYP                                              CLE025
     C                     Z-ADD@FSEQ     U1FSEQ                                              CLE025
     C                     MOVELU1FKEY    DBKEY                                               CLE025
     C                     MOVEL'LER032'  DBPGM                                               CLE025
     C                     MOVEL'LEFCLTQD'DBFILE                                              CLE025
     C                     Z-ADD012       DBASE                                               CLE025
     C                     OUT  LDA                                                           CLE025
     C                     EXSR *PSSR                                                         CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                   152164
      ** Exclude CA default facilities on the report                      152164
      *                                                                   152164
     C                     MOVE *BLANKS   WPRNT                           152164
     C           TRCA      IFEQ 'CA'                                      152164
     C           PRTR      IFEQ 'I'                                       152164
     C           PRTR      OREQ 'P'                                       152164
     C           PRTR      OREQ 'R'                                                           CLE106
     C           PRTR      OREQ 'S'                                                           CLE106
     C                     MOVE 'Y'       WPRNT   1                       152164
     C                     ENDIF                                          152164
     C                     ENDIF                                          152164
     C*                                                                     0027
     C***  SAVE FACILITY BRANCH FOR WRITES OF HISTORY RECORD FACHISA        0027
     C*                                                                     0027
     C                     MOVE BRCA      WKBRCA  3                         0027
     C/COPY WNCPYSRC,LEH00309
     C           CLE005    IFEQ 'Y'                                       127733
     C                     MOVE RECI      WRECI   1                       127733
     C                     ENDIF                                          127733
      *
     C***********          Z-ADD1         @SEQ                            159050
     C**********           MOVE *LOVAL    @SEQ                                         159050 200289
     C                     MOVE *LOVAL    W@SEQ                                               200289
      *
     C                     SETOF                     1011
      *
      ** access facility history amounts file
     C***********KEY002    SETGTFACHISAF                                  159050
     C***********          READPFACHISAF                 83               159050
     C           KEY002    SETLLFACHISAF                                  159050
     C           KEY003    REDPEFACHISAF                 83               159050
      *                                                                   159050
      * If no prior record, then access facility start record.            159050
     C           *IN83     IFEQ *ON                                       159050
     C**********           Z-ADD1         @SEQ                                         159050 200289
     C                     Z-ADD1         W@SEQ                                               200289
     C           KEY002    CHAINFACHISAF             83                   159050
     C                     ENDIF                                          159050
      *
      ** If a matching record not found on facility history amounts
      ** create initial facility history amounts record
     C           *IN83     CASEQ'1'       HISTRC
     C           *IN10     CASEQ'0'       HISTRC
     C***********FCCNUM    CASNEFACNUM    HISTRC                          159050
     C***********FCFCTY    CASNEFAFCTY    HISTRC                          159050
     C                     END
      **Reversed loans
     C***********          Z-ADD0         X       20                      E29760
     C                     Z-ADD0         X       30                      E29760
     C                     Z-ADD*ZERO     Y       30                      CLE005
     C                     Z-ADD*ZERO     SQN                             CLE005
     C**********           Z-ADD0         LN                                                  CLE148
     C                     MOVEL*BLANKS   LN                                                  CLE148
      *                                                                                       CLE025
      ** Initialise array of reversed and reinstated deals and it's indexes                   CLE025
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADD*ZEROS    VDL                                                 CLE025
     C                     Z-ADD*ZEROS    IDL                                                 CLE025
     C                     Z-ADD*ZEROS    H       30                                          CLE025
     C                     Z-ADD*ZEROS    I       30                                          CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE023
      ** If CLE023 is installed and Rework Required = 'Y', set                                CLE023
      ** facility amount work field to Actual Facility Amount.                                CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDFAAFAM    @CFA                                                CLE023
     C                     ELSE                                                               CLE023
     C                     Z-ADDFACFAM    @CFA   130
     C                     ENDIF                                                              CLE023
     C                     Z-ADDFADRAM    @DA    130
     C                     Z-ADDFAUNDR    @UA    130
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADDFAOFFS    @OA    130                                          CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** Set keys to date & seq just read or written
      *                                                                   BH3502
      ** If previous PF/FACHISA record for this Facility/date - as        BH3502
      ** determined by SETGT/READP from PF/FACACT key + 01 - @CSEQ will   BH3502
      ** always be 01. Initialise to zero and increment when processing   BH3502
      ** existing PF/FACHISA records in SR/FACTAC. SR/HISTRA will         BH3502
      ** increment sequence number for new PF/FACHISA records when        BH3502
      ** processing PF/HISACT.                                            BH3502
      *                                                                   BH3502
     C***********          Z-ADDFAFSEQ    @CSEQ   20                      BH3502
     C           KEY010    CHAINHISACTL2             83                                     AR652989
     C           *IN83     IFEQ '0'                                                         AR652989
     C           DATE2     ANDLTBJRDNB                                                      AR652989
     C           ACTN2     ANDEQ'RC'                                                        AR652989
     C           NEWCOB    ANDNE'Y'                                                         AR398038
     C                     MOVE 'Y'       WBKVLD  1                                         AR652989
     C                     ELSE                                                             AR652989
     C                     MOVE 'N'       WBKVLD                                            AR652989
     C                     ENDIF                                                            AR652989
      *                                                                                     AR652989
     C           WBKVLD    IFEQ 'Y'                                                         AR652989
     C                     Z-ADD*ZEROS    W#VDAT  50                                        AR652989
     C                     Z-ADD*ZEROS    W#FFSQ  20                                        AR652989
     C                     Z-ADD*ZEROS    W#FTSQ  30                                        AR652989
     C                     MOVE *BLANKS   W#FACT  2                                         AR652989
     C                     MOVE *BLANKS   W#NREC  1                                         AR652989
     C           KEY002    SETLLFACHISAF                                                    AR652989
     C           W#NREC    DOWEQ*BLANKS                                                     AR652989
     C           KEY010    READEFACHISAF                 83                                 AR652989
     C           *IN83     IFEQ *ON                                                         AR652989
     C           FADATE    ANDEQW#VDAT                                                      AR652989
     C           FAFSEQ    ANDEQW#FFSQ                                                      AR652989
     C           FATSEQ    ANDEQW#FTSQ                                                      AR652989
     C           FAACTN    ANDEQW#FACT                                                      AR652989
     C                     MOVE 'Y'       W#NREC                                            AR652989
     C                     MOVE *OFF      *IN83                                             AR652989
     C                     ELSE                                                             AR652989
     C                     MOVE FADATE    W#VDAT                                            AR652989
     C                     MOVE FAFSEQ    W#FFSQ                                            AR652989
     C                     MOVE FATSEQ    W#FTSQ                                            AR652989
     C                     MOVE FAACTN    W#FACT                                            AR652989
     C                     ENDIF                                                            AR652989
     C                     ENDDO                                                            AR652989
     C                     ENDIF                                                            AR652989
     C                     Z-ADD0         @CSEQ   20                      BH3502
     C                     Z-ADD0         WTSEQ   30                                          200289
     C           *IN83     IFEQ *OFF                                                        AR652989
     C           WBKVLD    ANDEQ'Y'                                                         AR652989
     C                     Z-ADDFAFSEQ    @CSEQ                                             AR652989
     C                     Z-ADDFATSEQ    WTSEQ                                             AR652989
     C                     ENDIF                                                            AR652989
      *                                                                   BH3502
     C                     Z-ADDFADATE    @DATE   50
     C                     MOVE FARCIN    @RCI    1
     C                     MOVE FARCIN    RCISV   1                                           246029
     C                     MOVE *BLANK    WWRT    1                       154584
     C***********          MOVE FARCIN    WRCI    1                 154584159961
     C                     Z-ADD0         @FADJ  130
     C                     Z-ADD0         @DADJ  130
     C                     Z-ADD0         @UADJ  130
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADD*ZEROS    @OADJ  130                                          CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C***********          Z-ADD0         @SEQ                            127723
     C***********          Z-ADD-1        @SEQ                      LER024159961
     C**********           MOVE *LOVAL    @SEQ                                         159961 200289
     C                     MOVE *LOVAL    W@SEQ                                               200289
     C           KEY002    SETLLHISUPD
     C                     Z-ADD*ZERO     FAGNDT                          159692
     C                     SETOF                     1011
     C                     MOVELBRCA      WBRCA   3                       128980
     C                     Z-ADDOAM1      WOAM1  130                      128980
     C                     Z-ADDFAMT      WFAMT  130                      128980
     C**********           Z-ADDCNUM      WCNUM   60                                   128980 CSD027
     C                     MOVE CNUM      WCNUM   6                                           CSD027
     C                     Z-ADDFACT      WFACT   30                      128980
     C                     Z-ADDFCNO      WFCNO   20                      128980
     C                     MOVELTRCA      WTRCA   2                       128980
     C                     MOVELPRTR      WPRTR   1                       128980
     C                     Z-ADDFACFAM    WCFAM  130                      154584
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDFAAFAM    WAFAM  130                                          CLE023
     C                     ENDIF                                                              CLE023
     C                     Z-ADDFADRAM    WDRAM  130                      154584
     C                     Z-ADDFAUNDR    WUNDR  130                      154584
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADDFAOFFS    WOFFS  130                                          CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     Z-ADDFADATE    WDATE   50                      154584
     C                     MOVELFAACTN    WACTN   2                       156585
     C                     MOVELFCTI      WFCTI   1                       161412
     C***********          READ HISUPD                   84               182274
     C           KEY003    READEHISUPD                   84               182274
      *                                                                                       204450
     C                     Z-ADD0         RDATE                                               204450
     C**********           Z-ADD0         RCNUM                                        204450 CSD027
     C                     MOVE *BLANKS   RCNUM                                               CSD027
     C                     Z-ADD0         RFCLT                                               204450
     C                     MOVE 'N'       REACTF                                              204450
      *
      ** Read all records for this facility GE FACACT date on logical
     C           *IN84     DOUEQ'1'
      *                                                                   158138
      * Disregard records already processed from hisact.                  158138
     C           *IN10     IFEQ *ON                                       158138
     C           FAGNDT    ANDEQBJRDNB                                    158138
     C           FAACTN    ANDNE'RC'                                      159961
     C           NEWCOB    ANDNE'Y'                                                         AR398038
     C                     MOVE *OFF      *IN10                           158138
     C                     ENDIF                                          158138
      *                                                                   158138
     C***********          Z-ADDFACFAM    @CFA   130               162667 184748
     C***********          Z-ADDFADRAM    @DA    130               162667 184748
     C***********          Z-ADDFAUNDR    @UA    130               162667 184748
     C***********          Z-ADD0         @FADJ  130               162667 184748
     C***********          Z-ADD0         @DADJ  130               162667 184748
     C***********          Z-ADD0         @UADJ  130               162667 184748
      *                                                                   162667
     C           *IN11     CASEQ'1'       HISTRA
     C           *IN10     CASEQ'1'       FACTAC
     C                     END
     C                     Z-ADD*ZERO     FAGNDT                          159692
     C                     SETOF                     1011
     C           KEY003    READEHISUPD                   84
     C           *IN84     IFEQ *OFF                                                        AR652989
     C                     MOVE FAGNDT    WGNDT   50                                        AR652989
     C                     ENDIF                                                            AR652989
     C                     END
     C                     MOVELWBRCA     BRCA                            128980
     C                     Z-ADDWOAM1     OAM1                            128980
     C                     Z-ADDWFAMT     FAMT                            128980
     C**********           Z-ADDWCNUM     CNUM                                         128980 CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C                     Z-ADDWFACT     FACT                            128980
     C                     Z-ADDWFCNO     FCNO                            128980
     C                     MOVELWTRCA     TRCA                            128980
     C                     MOVELWPRTR     PRTR    1                       128980
      ************                                                        E29762
      ***If*the*1mounts*on*the*facility*history*amounts*file*and*         E29762
      ***facility*file*are*different*output*details*on*report*            E29762
     C***********FACFAM    IFNE FAMT                                      E29762
      *
      ** Get Number of decimal places for output of amount fields
     C**********           CALL 'AOCURRR0'                                                    CSC042
     C**********           PARM '*MSG   ' @RTCD   7                                           CSC042
     C**********           PARM '*KEY   ' @OPTN   7                                           CSC042
     C**********           PARM FCCY      @AJCD   3                                           CSC042
     C********** SDCURR    PARM SDCURR    DSSDY                                               CSC042
     C********** @RTCD     IFNE *BLANKS                                                       CSC042
     C                     MOVELFCCY      ##KC                                                CSC042
     C                     EXSR ##CHKC                                                        CSC042
     C           ##FIC     IFEQ 'Y'                                                           CSC042
     C                     MOVE CURR,Q    A6CYCD                                              CSC042
     C                     Z-ADDCCDP,Q    A6NBDP                                              CSC042
     C                     ELSE                                                               CSC042
     C           *LOCK     IN   LDA
     C                     MOVEL'LER032'  DBPGM
     C**********           MOVEL'SDCURRPD'DBFILE             ************                     CSC042
     C                     MOVEL'CURR,Q  'DBFILE             ************                     CSC042
     C                     Z-ADD003       DBASE              * DBERR 03 *
     C                     MOVELFCCY      DBKEY              ************
     C***********          EXSR OPNFIL                                    0026
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *                                                                   154584
      ** Update facility file to update the outstanding amounts and       154584
      ** drawn amounts when RC is backvalued.                             154584
      *                                                                   154584
     C           WWRT      IFEQ 'Y'                                       154584
     C           CLE005    ANDEQ'Y'                                       154584
     C           CLE023    OREQ 'Y'                                                           CLE023
     C           FHRWKR    ANDEQ'Y'                                                           CLE023
     C           CLE025    OREQ 'Y'                                                           CLE025
     C           FHRWKR    ANDEQ'Y'                                                           CLE025
      *                                                                                       203890
      ** Obtain the difference between computed FADRAM and CAMD.  Add                         203890
      ** this difference to OAMxx array to adjust the amounts.                                203890
      *                                                                                       203890
     C********** FADRAM    SUB  CAMD      WDIFF  130                                   203890 206325
      *                                                                                       203890
     C                     MOVE 'A'       WRCTP                           154584
     C           WFCUP     CHAINFCLTYM               80                   154584
     C           *IN80     IFEQ '0'                                       154584
     C                     Z-ADD0         WTRAL                           154529
     C                     Z-ADDFAMT      OFAMT  130                                          193603
     C                     Z-ADDFACFAM    NFAMT  130                                          193603
     C           OFAMT     IFLT 0                                                             193603
     C                     Z-SUBOFAMT     OFAMT                                               193603
     C                     END                                                                193603
     C           NFAMT     IFLT 0                                                             193603
     C                     Z-SUBNFAMT     NFAMT                                               193603
     C                     END                                                                193603
     C********** FACFAM    SUB  FAMT      WTRAL  130                                   154529 193603
     C           NFAMT     SUB  OFAMT     WTRAL  130                                          193603
     C                     Z-ADDFACFAM    FAMT                            154584
     C           RECI      IFEQ 'C'                                                           255932
     C                     Z-ADD0         WTRAL                                               255932
     C                     ENDIF                                                              255932
     C                     UPDATFCLTYM                                    154584
     C                     MOVE 'B'       WRCTP                           154584
     C           WFCUP     CHAINFCLTYN               80                   154584
     C           *IN80     IFEQ '0'                                       154584
      *  Calculate WDIFF with correct value of CAMD:                                          206325
     C           FADRAM    SUB  CAMD      WDIFF  130                                          206325
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C           FAOFFS    SUB  FCXCOF    WOFFSD 130                                          CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     Z-ADDFADRAM    CAMD                            154584
     C                     Z-ADDFADRAM    PEXP                            154584
     C                     Z-ADDFADRAM    OAM1                            154584
     C**********           Z-ADDFADRAM    OAM2                                         154584 203890
     C**********           Z-ADDFADRAM    OAM3                                         154584 203890
     C**********           Z-ADDFADRAM    OAM4                                         154584 203890
     C**********           Z-ADDFADRAM    OAM5                                         154584 203890
     C**********           Z-ADDFADRAM    OAM6                                         154584 203890
     C**********           Z-ADDFADRAM    OAM7                                         154584 203890
     C**********           Z-ADDFADRAM    OAM8                                         154584 203890
     C**********           Z-ADDFADRAM    OAM9                                         154584 203890
     C**********           Z-ADDFADRAM    OA10                                         154584 203890
     C           OAM2      ADD  WDIFF     OAM2                                                203890
     C           OAM3      ADD  WDIFF     OAM3                                                203890
     C           OAM4      ADD  WDIFF     OAM4                                                203890
     C           OAM5      ADD  WDIFF     OAM5                                                203890
     C           OAM6      ADD  WDIFF     OAM6                                                203890
     C           OAM7      ADD  WDIFF     OAM7                                                203890
     C           OAM8      ADD  WDIFF     OAM8                                                203890
     C           OAM9      ADD  WDIFF     OAM9                                                203890
     C           OA10      ADD  WDIFF     OA10                                                203890
      *                                                                                       203890
     C                     UPDATFCLTYN                                    154584
      *                                                                                       CLE025
      ** Access the corresponding record in LF/LEFCLTLH                                       CLE025
      *                                                                                       CLE025
     C                     MOVE FCCNUM    KFCNUM                                              CLE025
     C                     MOVE @FTYP     KFFTYP                                              CLE025
     C                     MOVE @FSEQ     KFFSEQ                                              CLE025
      *                                                                                       CLE025
     C           KFCUPH    CHAINLEFCLTLH             80                                       CLE025
     C           *IN80     IFEQ *OFF                                                          CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADDFAOFFS    FCXCOF                                              CLE025
     C                     Z-ADDFAOFFS    FCXOF1                                              CLE025
     C           FCXOF2    ADD  WOFFSD    FCXOF2                                              CLE025
     C           FCXOF3    ADD  WOFFSD    FCXOF3                                              CLE025
     C           FCXOF4    ADD  WOFFSD    FCXOF4                                              CLE025
     C           FCXOF5    ADD  WOFFSD    FCXOF5                                              CLE025
     C           FCXOF6    ADD  WOFFSD    FCXOF6                                              CLE025
     C           FCXOF7    ADD  WOFFSD    FCXOF7                                              CLE025
     C           FCXOF8    ADD  WOFFSD    FCXOF8                                              CLE025
     C           FCXOF9    ADD  WOFFSD    FCXOF9                                              CLE025
     C           FCXO10    ADD  WOFFSD    FCXO10                                              CLE025
     C                     UPDATLEFCLTD0                                                      CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C********** *LOVAL    SETLLFCLTYZ                                                 154529 258793
     C**********           READ FCLTYZ                   80                            154529 258793
     C           KTRAIL    CHAINFCLTYZ               80                                       258793
      *                                                                   154529
      ** Update Trailer                                                   154529
      *                                                                   154529
     C           *IN80     IFEQ '0'                                       154529
     C           WTRAL     ANDNE0                                         154529
     C                     Z-ADD0         ZZAMT                           154529
     C           WTRAL     DIV  1000      ZZAMT                           154529
     C                     Z-ADDVLBF      ZZTOTI                          154529
     C                     Z-ADDVLBL      ZZTOTD                          154529
     C                     EXSR GLZADD                                    154529
     C                     Z-ADDZZTOTI    VLBF                            154529
     C                     Z-ADDZZTOTD    VLBL                            154529
     C                     Z-ADDVLAF      ZZTOTI                          154529
     C                     Z-ADDVLAL      ZZTOTD                          154529
     C                     EXSR GLZADD                                    154529
     C                     Z-ADDZZTOTI    VLAF                            154529
     C                     Z-ADDZZTOTD    VLAL                            154529
     C                     UPDATFCLTYZ                                    154529
     C                     ENDIF                                          154529
     C                     ENDIF                                          154584
     C                     ENDIF                                          154584
     C                     ENDIF                                          154584
      *                                                                                     MD027262
     C                     MOVELSVRECI    RECI                                              MD027262
      *
     C           A6NBDP    COMP 1                    626061
     C   62      A6NBDP    COMP 3                      6263
     C                     Z-ADDFACFAM    @DSAMT
     C                     Z-ADDFADRAM    @DTAMT
     C                     Z-ADDFAMT      @DUAMT
     C***********          Z-ADDCAMD      @DVAMT                          E29762
      *                                                                   E29762
      ** Use outstanding amount instead of exposure amount                E29762
      *                                                                   E29762
     C                     Z-ADDOAM1      @DVAMT                          E29762
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADDFAOFFS    @DWAMT                                              CLE025
     C                     Z-ADDFCXOF1    @DXAMT                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     MOVEL*BLANKS   @STAT
      *                                                                                       213749
      ** GET THE ABSOLUTE VALUE OF THE DIFFERENCE BETWEEN THE FACILITY                        213749
      ** HISTORY DRAWN AMOUNT AND FACILITY DETAILS DRAWN AMOUNT.                              213749
      *                                                                                       213749
     C           OAM1      SUB  FADRAM    WTDIF  150                                          213749
     C           WTDIF     IFLT 0                                                             213749
     C                     Z-SUBWTDIF     WTDIF                                               213749
     C                     ENDIF                                                              213749
      *                                                                   E29762
      ** Error if facility or drawn amount are out.                       E29762
      *                                                                   E29762
     C           FACFAM    IFNE FAMT                                      E29762
     C           FADRAM    ORNE OAM1                                      E29762
     C           WTDIF     ANDGT10                                                            213749
     C           CLE025    OREQ 'Y'                                                           CLE025
     C           FAOFFS    ANDNEFCXOF1                                                        CLE025
      *                                                                   E29762
      ** Indicate error on report                                         E29762
      *                                                                   E29762
     C           RECI      IFNE 'E'                                       E29762
     C                     MOVEL'ERROR'   @STAT                           E29762
     C                     ADD  1         NERR                            0026
     C                     Z-ADD1         NERRBR  20                      0075
     C                     ELSE                                           E29762
     C                     MOVEL'EXPIRED' @STAT                           E29762
     C                     END                                            E29762
     C************         MOVE '1'       *IN21                    E29762 0026
      *                                                                   E29762
     C                     END                                            E29762
      *                                                                                       246709
     C           RECI      IFEQ 'E'                                                           246709
     C                     MOVEL'EXPIRED' @STAT                                               246709
     C                     ENDIF                                                              246709
      *
      ** When branch code changes open new spool file
     C           MBIN      IFEQ 'Y'
     C           REPBRC    ANDNESTRBRC
      ** Write out end of report details for last print
     C           *IN21     IFEQ '1'
     C           P1OP      ANDEQ'Y'                                        0022
     C*                                                                     0075
     C           NERRBR    IFEQ 1                                           0075
     C***/COPY*WNCPYSRC,LEH00966***                                                           CFC006
     C/COPY WNCPYSRC,LEH00966                                                               MD020563
     C           SUPFLG    ANDNE'Y'                                                           CFC006
     C                     WRITELER032T2
     C                     END                                              0075
     C*                                                                     0075
     C***/COPY*WNCPYSRC,LEH00967***                                                           CFC006
     C/COPY WNCPYSRC,LEH00967                                                               MD020563
     C           SUPFLG    IFNE 'Y'                                                           CFC006
     C                     WRITELER032T3
     C***/COPY*WNCPYSRC,LEH00968***                                                           CFC006
     C/COPY WNCPYSRC,LEH00968                                                               MD020563
     C                     ENDIF                                                              CFC006
     C                     MOVE '0'       *IN21                            0022
     C                     Z-ADD0         NERRBR                            0075
     C                     END
     C                     MOVE REPBRC    STRBRC  3
     C                     CLOSELER032P1
      ** File has been opened field
     C                     MOVE 'Y'       P1OP    1
     C                     OPEN LER032P1
     C                     Z-ADD0         PAGE
      ** Ensure report spool file recorded by RCF
     C                     Z-ADDSFNUM     ZSNUM
     C**********           OUT  LDA                                         0021
      *
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ     5
     C                     PARM BRCA      SENTY   3
     C                     PARM           SFILE
     C                     PARM           ZSNUM   60
     C                     PARM           ZSERR   1
      *
     C********** *LOCK     IN   LDA                                         0021
      *
      ** If error during ZSFILE processing, return to calling program
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ** If system is multibranching obtain branch name for output
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM BRCA      @DSNB   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'LER032'  DBPGM
     C                     MOVELBRCA      DBKEY            ************
     C                     MOVEL'SDBRCHPD'DBFILE           * DBERR 04 *
     C                     Z-ADD004       DBASE            ************
     C***********          EXSR OPNFIL                                    0026
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** Output header
     C***/COPY*WNCPYSRC,LEH00969***                                                           CFC006
     C/COPY WNCPYSRC,LEH00969                                                               MD020563
     C           SUPFLG    IFNE 'Y'                                                           CFC006
     C                     WRITELER032H1
     C***/COPY*WNCPYSRC,LEH00970***                                                           CFC006
     C/COPY WNCPYSRC,LEH00970                                                               MD020563
     C                     ENDIF                                                              CFC006
      *
      ** If system multibranching
     C                     END
      *
      ** If system is not multibranching set up single spool file
     C           MBIN      IFNE 'Y'
     C           P1OP      ANDNE'Y'
     C                     CLOSELER032P1
     C                     MOVE 'Y'       P1OP
     C                     OPEN LER032P1
     C                     Z-ADD0         PAGE
      ** Ensure report spool file recorded by RCF
     C                     Z-ADDSFNUM     ZSNUM
     C**********           OUT  LDA                                         0021
      *
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ     5
     C                     PARM *BLANKS   SENTY   3
     C                     PARM           SFILE
     C                     PARM           ZSNUM   60
     C                     PARM           ZSERR   1
      *
     C********** *LOCK     IN   LDA                                         0021
      *
      ** If error during ZSFILE processing, return to calling program
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      *
      ** Output header
     C***/COPY*WNCPYSRC,LEH00971***                                                           CFC006
     C/COPY WNCPYSRC,LEH00971                                                               MD020563
     C           SUPFLG    IFNE 'Y'                                                           CFC006
     C                     WRITELER032H1
     C***/COPY*WNCPYSRC,LEH00972***                                                           CFC006
     C/COPY WNCPYSRC,LEH00972                                                               MD020563
     C                     ENDIF                                                              CFC006
      *
      ** MBIN IFNE 'Y' end
     C                     END
      *
      ** Details have been output indicator                               0026
     C                     MOVE '1'       *IN21                           0026
      *                                                                   152164
     C           WPRNT     IFEQ *BLANKS                                   152164
     C***/COPY*WNCPYSRC,LEH00973***                                                           CFC006
     C/COPY WNCPYSRC,LEH00973                                                               MD020563
     C           SUPFLG    ANDNE'Y'                                                           CFC006
      *                                                                   0026
      ** Keep count of records output                                     0026
     C                     ADD  1         NREP                            0026
      *                                                                   0026
      ** Output details
     C                     WRITELER032D1
     C                     ENDIF                                          152164
      *
      ** If overflow indicator on, output another header
     C           *IN50     IFEQ '1'
     C***/COPY*WNCPYSRC,LEH00974***                                                           CFC006
     C/COPY WNCPYSRC,LEH00974                                                               MD020563
     C           SUPFLG    ANDNE'Y'                                                           CFC006
     C                     WRITELER032H1
     C                     MOVE '0'       *IN50
     C                     END
      *
      ** FACFAM*IFNE FAMT end
     C***********          END
      *
     C                     Z-ADDFAMT      FHLFAM
      *                                                                   E29762
      ** Use outstanding amount instead of exposure amount                E29762
      *                                                                   E29762
     C***********          Z-ADDCAMD      FHLDAM                          E29762
     C                     Z-ADDOAM1      FHLDAM                          E29762
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADDFCXOF1    FHLOAM                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           CLE005    IFEQ 'Y'                                       127733
     C                     MOVE WRECI     FHRECI                          127733
     C                     ENDIF                                          127733
      *                                                                                       CLE023
      ** After facility history "Rework", update FACHISH's new fields                         CLE023
      ** accordingly.                                                                         CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           FHRWTP    IFEQ 'B'                                                           CLE023
     C                     Z-ADDFHRWDT    FHLBRD                                              CLE023
     C                     ENDIF                                                              CLE023
     C           FHRWTP    IFEQ 'M'                                                           CLE023
     C                     Z-ADDFHRWDT    FHLMRD                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     Z-ADDBJRDNB    FHDLRW                                              CLE023
     C                     MOVE *BLANK    FHRWKR                                              CLE023
     C                     MOVE *BLANK    FHRWTP                                              CLE023
     C                     Z-ADD*ZERO     FHRWDT                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C/COPY WNCPYSRC,LEH00310
     C                     UPDATFACHISHF
      ** DO *HIVAL end
     C                     END
      *
     C           A0100     TAG
      *
      ** *IN21 = '1' output 'facilities require investigating' msg
     C           *IN21     IFEQ '1'
     C*                                                                     0075
     C           NERRBR    IFEQ 1                                           0075
     C***/COPY*WNCPYSRC,LEH00975***                                                           CFC006
     C/COPY WNCPYSRC,LEH00975                                                               MD020563
     C           SUPFLG    ANDNE'Y'                                                           CFC006
     C                     WRITELER032T2
     C                     END                                              0075
      *
      ** 'End of report' message
     C***/COPY*WNCPYSRC,LEH00976***                                                           CFC006
     C/COPY WNCPYSRC,LEH00976                                                               MD020563
     C           SUPFLG    IFNE 'Y'                                                           CFC006
     C                     WRITELER032T3
     C***/COPY*WNCPYSRC,LEH00977***                                                           CFC006
     C/COPY WNCPYSRC,LEH00977                                                               MD020563
     C                     ENDIF                                                              CFC006
     C                     END
      *
      ***If*detail*spool*file*has*not*been*opened*then*all*******         0026
      ***facilities*have*been*successfully*reconciled************         0026
      *
      ** Output appropriate details to audit report.                      0026
     C                     Z-ADD0         PAGE                            0026
      *
     C           P1OP      IFNE 'Y'
     C************         EXSR OPNFIL                                    0026
      *
      ** Output 'No Details to Report' msg to audit report                0026
     C                     WRITELER032A1
     C                     WRITELER032A2
      *
     C                     ELSE                                           0026
      ** Output record count details to audit report                      0026
     C                     WRITELER032A1                                  0026
     C                     WRITELER032A3                                  0026
      *
     C                     END
      *
     C/COPY WNCPYSRC,LEH00311
     C                     DO   *HIVAL
     C                     READ PEFCLFM                  86
     C           *IN86     CABEQ'1'       AEXIT
     C*                                                                   00027
     C* Read equal changed to CHAIN because there will be only one        00027
     C* record anyway (therefore READE superfluous) and indicator is      00027
     C* not being reset at the moment                                     00027
     C*                                                                   00027
     C***********KEY004    READEFACHISHF                 87               00027
     C           KEY004    CHAINFACHISHF             87                   00027
      *
      **  Reset History
     C           *IN87     IFEQ '0'
     C                     MOVE RECI      FHRECI
      *                                                                                       CLE023
      ** After facility history "Rework", update FACHISH's new fields                         CLE023
      ** accordingly.                                                                         CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           FHRWTP    IFEQ 'B'                                                           CLE023
     C                     Z-ADDFHRWDT    FHLBRD                                              CLE023
     C                     ENDIF                                                              CLE023
     C           FHRWTP    IFEQ 'M'                                                           CLE023
     C                     Z-ADDFHRWDT    FHLMRD                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     Z-ADDBJRDNB    FHDLRW                                              CLE023
     C                     MOVE *BLANK    FHRWKR                                              CLE023
     C                     MOVE *BLANK    FHRWTP                                              CLE023
     C                     Z-ADD*ZERO     FHRWDT                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     UPDATFACHISHF
     C                     END
      *
     C           FACT      MULT 100       FAFCTY
     C                     ADD  FCNO      FAFCTY
     C           KEY005    SETLLFACHISAF
     C           KEY005    READEFACHISAF                 87
      *
     C           *IN87     DOWEQ'0'
     C                     MOVE RECI      FARECI
     C                     UPDATFACHISAF
     C           KEY005    READEFACHISAF                 87
     C                     END
     C                     END
      *
     C           AEXIT     TAG
      *                                                                                       CLE025
      ** If CLE025 is switched on                                                             CLE025
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     EXSR SRUPDF                                                        CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     SETON                     LR
     C                     RETRN
      *
      ********************************************************************
     C/TITLE SR/INITIALISATION
      ********************************************************************
      *
      *  INIT - INITIALISATION SUBROUTINE
      *
      *  CALLED FROM: MAIN PROCESSING
      *
      *  CALLS: OPNFIL, *PSSR
      *
      ********************************************************************
      *
     C           INIT      BEGSR
      *                                                                                     AR398038
     C           *ENTRY    PLIST                                                            AR398038
     C                     PARM           WPNAM  10                                         AR398038
      *
      ** Set up copyright statement
     C                     MOVEACPY@      BIS@   80
      *
      ** Move blanks into sequence number
     C                     MOVE *BLANKS   SEQ
      *
      ** Define LDA
     C           *NAMVAR   DEFN           LDA
      *                                                                                      BUG8222
      ** Define LERSTS                                                                       BUG8222
      *                                                                                      BUG8222
     C           *NAMVAR   DEFN           LERSTS                                             BUG8222
     C                     IN   LERSTS                                                       BUG8222
      *
      ** Lock in dataarea RUNDAT
     C           *NAMVAR   DEFN           RUNDAT
     C           *LOCK     IN   RUNDAT
      *
     C           KEY001    KLIST
     C                     KFLD           BRCA
     C                     KFLD           FCCNUM
     C                     KFLD           @FTYP
     C                     KFLD           @FSEQ
      *                                                                                       CLE025
     C           KEY01A    KLIST                                                              CLE025
     C                     KFLD           BRCA                                                CLE025
     C                     KFLD           KACNUM  6                                           CLE025
     C                     KFLD           KAFTYP  3                                           CLE025
     C                     KFLD           KAFSEQ  2                                           CLE025
      *
     C           KEY002    KLIST
     C                     KFLD           BRCA
     C                     KFLD           FCCNUM
     C                     KFLD           FCFCTY
     C                     KFLD           FCDATE
     C**********           KFLD           @SEQ    20                                          200289
     C                     KFLD           W@SEQ   30                                          200289
      *
     C/COPY WNCPYSRC,LER032C001
     C           KEY003    KLIST
     C                     KFLD           BRCA
     C                     KFLD           FCCNUM
     C                     KFLD           FCFCTY
      *
     C           KEY004    KLIST
     C***********          KFLD           FHBRCH                          171851
     C                     KFLD           BRCA                            171851
     C                     KFLD           CNUM
     C                     KFLD           FACT
     C                     KFLD           FCNO
      *
     C           KEY005    KLIST
     C                     KFLD           BRCA
     C                     KFLD           CNUM
     C                     KFLD           FAFCTY
      *                                                                   158138
     C           KEY006    KLIST                                          158138
     C                     KFLD           BRCA                            158138
     C                     KFLD           FCCNUM                          158138
     C                     KFLD           FCFCTY                          158138
     C                     KFLD           HADATE                          158138
     C**********           KFLD           HASEQ                                        158138 200289
     C                     KFLD           HATSEQ                                              200289
     C                     KFLD           HALOAN                          158138
      *                                                                                       224974
     C           KEY007    KLIST                                                              224974
     C                     KFLD           BRCA                                                224974
     C                     KFLD           FCCNUM                                              224974
     C                     KFLD           FCFCTY                                              224974
     C                     KFLD           HALOAN                                              224974
      *                                                                                     AR652989
     C           KEY010    KLIST                                                            AR652989
     C                     KFLD           BRCA                                              AR652989
     C                     KFLD           FCCNUM                                            AR652989
     C                     KFLD           FCFCTY                                            AR652989
     C                     KFLD           FCDATE                                            AR652989
      *                                                                   128980
     C           WFCTY     KLIST                                          128980
     C                     KFLD           WBRCH                           128980
     C                     KFLD           WCSNO                           128980
     C                     KFLD           WFTYE                           128980
     C                     KFLD           WFSNO                           128980
      *                                                                   128980
     C           WCLON     KLIST                                          128980
     C                     KFLD           WBRCA                           128980
     C                     KFLD           WLNRF                           128980
      *                                                                   154584
     C           WHIST     KLIST                                          154584
     C                     KFLD           BRCA                            154584
     C                     KFLD           FCCNUM                          154584
     C                     KFLD           FCFCTY                          154584
      *                                                                   154584
     C           WFCUP     KLIST                                          154584
     C                     KFLD           FCCNUM                          154584
     C                     KFLD           @FTYP                           154584
     C                     KFLD           @FSEQ                           154584
     C                     KFLD           WRCTP   1                       154584
      *                                                                                       258793
     C           KTRAIL    KLIST                                                              258793
     C                     KFLD           KCNUM   6                                           258793
     C                     KFLD           KFACT   30                                          258793
     C                     KFLD           KFCNO   20                                          258793
     C                     KFLD           KRCTP   1                                           258793
      *                                                                                       CLE025
     C           KFCUPH    KLIST                                                              CLE025
     C                     KFLD           KFCNUM  6                                           CLE025
     C                     KFLD           KFFTYP  3                                           CLE025
     C                     KFLD           KFFSEQ  2                                           CLE025
      *                                                                                       258793
     C                     MOVEL'999999'  KCNUM                                               258793
     C                     Z-ADD999       KFACT                                               258793
     C                     Z-ADD99        KFCNO                                               258793
     C                     MOVEL'Z'       KRCTP                                               258793
      *
      ** Set sequence number to zero
     C                     MOVE *BLANKS   SEQ
      *
      ** Move program name into error output field
     C                     MOVEL'LER032'  DBPGM
      *
      ** Access bank details
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'*FIRST  'DBKEY                           053523
     C                     MOVEL'LER032'  DBPGM
     C                     MOVEL'SDBANKPD'DBFILE             ************
     C                     Z-ADD005       DBASE              * DBERR 05 *
     C***********          EXSR OPNFIL                       ************ 0026
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** If system is not multibranching do not output branch details
      ** on print report
     C           MBIN      IFNE 'Y'
     C                     SETON                     33
     C                     END
      *
      ** Initialise number of records output field                        0026
     C                     Z-ADD0         NREP                            0026
     C                     Z-ADD0         NERR                            0026
      *
      ** Ensure audit report spool file recorded by RCF                   0026
     C                     Z-ADDSFNUMU    ZSNUMU  60                      0026
     C                     CALL 'ZSFILE'                                  0026
     C                     PARM           SEQ                             0026
     C                     PARM *BLANKS   SENTY   3                       0026
     C                     PARM           SFILEU                          0026
     C                     PARM           ZSNUMU                          0026
     C                     PARM           ZSERR                           0026
      *                                                                   0026
      *                                                                   0026
     C           ZSERR     IFEQ 'Y'                                       0026
      ** Error during ZSFILE processing, return to calling program        0026
     C                     SETON                     U7U8LR               0026
     C                     RETRN                                          0026
     C                     END                                            0026
     C*                                                                   S01408
     C***/COPY*WNCPYSRC,LER032CEIP***                                                  S01408 CFC006
     C/COPY WNCPYSRC,LER032CEIP                                                             MD020563
     C*                                                                   S01408
      *****************************************************************           AR1097176 MD020563
      ***Check*if*CFC006*is*switched**ON.******************************           AR1097176 MD020563
      *****************************************************************           AR1097176 MD020563
     C**********           MOVE 'N'       CFC006                                  AR1097176 MD020563
     C**********           CALL 'AOSARDR0'                                        AR1097176 MD020563
     C**********           PARM *BLANKS   @RTCD                                   AR1097176 MD020563
     C**********           PARM '*VERIFY' @OPTN                                   AR1097176 MD020563
     C**********           PARM 'CFC006'  @SARD                                   AR1097176 MD020563
     C********** SCSARD    PARM SCSARD    DSFDY                                   AR1097176 MD020563
      *****************************************************************           AR1097176 MD020563
     C********** @RTCD     IFEQ *BLANKS                                           AR1097176 MD020563
     C**********           MOVE 'Y'       CFC006  1                               AR1097176 MD020563
     C**********           ELSE                                                   AR1097176 MD020563
      *****************************************************************           AR1097176 MD020563
     C********** @RTCD     IFNE '*NRF   '                                         AR1097176 MD020563
      *****************************************************************           AR1097176 MD020563
      ***Call*to*program*ended*in*error********************************           AR1097176 MD020563
      *****************************************************************           AR1097176 MD020563
     C********** *LOCK     IN   LDA                                               AR1097176 MD020563
     C**********           MOVE *BLANKS   DBKEY                                   AR1097176 MD020563
     C**********           MOVEL'CFC006'  DBKEY                                   AR1097176 MD020563
     C**********           MOVE 'SCSARDPD'DBFILE                                  AR1097176 MD020563
     C**********           Z-ADD014       DBASE                                   AR1097176 MD020563
     C**********           MOVEL'LER032'  DBPGM                                   AR1097176 MD020563
     C**********           OUT  LDA                                               AR1097176 MD020563
     C**********           EXSR *PSSR                                             AR1097176 MD020563
     C**********           ENDIF                                                  AR1097176 MD020563
     C**********           ENDIF                                                  AR1097176 MD020563
      *                                                                                       CFC006
      ** Enable output indicator for LER032P1                                                 CFC006
      *                                                                                       CFC006
     C                     MOVEL'N'       SUPFLG  1                                           CFC006
     C********** CFC006    IFEQ 'Y'                                               AR1097176 MD020563
     C                     CALL 'AOCOMR0'                                                     CFC006
     C                     PARM 'LERC30A' PNAME  10                                           CFC006
     C                     PARM '*ALL '   PCSEQ   5                                           CFC006
     C                     PARM SECTN     PSCTN  50                                           CFC006
     C                     PARM *BLANKS   PRTCD                                               CFC006
      *                                                                                       CFC006
     C           PRTCD     IFEQ 'Y      '                                                     CFC006
     C                     MOVEL'Y'       SUPFLG                                              CFC006
     C                     ENDIF                                                              CFC006
     C**********           ENDIF                                                  AR1097176 MD020563
      *                                                                   CLE004
      ** Check if CLE004 is switched *ON.                                 CLE004
      *                                                                   CLE004
     C                     MOVE 'N'       CLE004  1                       CLE004
     C                     CALL 'AOSARDR0'                                CLE004
     C                     PARM *BLANKS   @RTCD   7                       CLE004
     C                     PARM '*VERIFY' @OPTN   7                       CLE004
     C                     PARM 'CLE004'  @SARD   6                       CLE004
     C           SCSARD    PARM SCSARD    DSFDY                           CLE004
      *                                                                   CLE004
     C           @RTCD     IFEQ *BLANKS                                   CLE004
     C                     MOVE 'Y'       CLE004                          CLE004
     C                     END                                            CLE004
      *                                                                   CLE004
     C           @RTCD     IFNE *BLANKS                                   CLE004
     C           @RTCD     ANDNE'*NRF   '                                 CLE004
      *                                                                   CLE004
      ** Call to program ended in error                                   CLE004
      *                                                                   CLE004
     C           *LOCK     IN   LDA                                       CLE004
     C                     MOVE *BLANKS   DBKEY                           CLE004
     C                     MOVEL'CLE004'  DBKEY            ************   CLE004
     C                     MOVE 'SCSARDPD'DBFILE           * DBERR 06 *   CLE004
     C                     Z-ADD0006      DBASE            ************   CLE004
     C                     MOVEL'LER032'  DBPGM                           CLE004
     C                     OUT  LDA                                       CLE004
     C                     EXSR *PSSR                                     CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE004
      ** Set indicator *ON if CLE004 is switched *ON.                     CLE004
      *                                                                   CLE004
     C           CLE004    IFEQ 'Y'                                       CLE004
     C                     MOVE *ON       *IN25                           CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE005
      ** Check if CLE005 is switched *ON.                                 CLE005
      *                                                                   CLE005
     C                     MOVE 'N'       CLE005  1                       CLE005
     C                     CALL 'AOSARDR0'                                CLE005
     C                     PARM *BLANKS   @RTCD   7                       CLE005
     C                     PARM '*VERIFY' @OPTN   7                       CLE005
     C                     PARM 'CLE005'  @SARD   6                       CLE005
     C           SCSARD    PARM SCSARD    DSFDY                           CLE005
      *                                                                   CLE005
     C           @RTCD     IFEQ *BLANKS                                   CLE005
     C                     MOVE 'Y'       CLE005                          CLE005
     C                     END                                            CLE005
      *                                                                   CLE005
     C           @RTCD     IFNE *BLANKS                                   CLE005
     C           @RTCD     ANDNE'*NRF   '                                 CLE005
      *                                                                   CLE005
      ** Call to program ended in error                                   CLE005
      *                                                                   CLE005
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVE *BLANKS   DBKEY                           CLE005
     C                     MOVEL'CLE005'  DBKEY            ************   CLE005
     C                     MOVE 'SCSARDPD'DBFILE           * DBERR 07 *   CLE005
     C                     Z-ADD007       DBASE            ************   CLE005
     C                     MOVEL'LER032'  DBPGM                           CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE014
      ** Check if CLE014 is switched *ON.                                 CLE014
      *                                                                   CLE014
     C                     MOVE 'N'       CLE014  1                       CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM *BLANKS   PRTCD   7                       CLE014
     C                     PARM '*VERIFY' POPTN   7                       CLE014
     C                     PARM 'CLE014'  PSARD   6                       CLE014
     C           SCSARD    PARM SCSARD    DSFDY                           CLE014
      *                                                                   CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CLE014                          CLE014
     C                     ELSE                                           CLE014
     C           PRTCD     IFNE '*NRF   '                                 CLE014
      *                                                                   CLE014
      ** Call to program ended in error                                   CLE014
      *                                                                   CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVE *BLANKS   DBKEY                           CLE014
     C                     MOVEL'CLE014'  DBKEY                           CLE014
     C                     MOVE 'SCSARDPD'DBFILE                          CLE014
     C                     Z-ADD008       DBASE                           CLE014
     C                     MOVEL'LER032'  DBPGM     P                     CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                                       CLE023
      ** Check if CLE023 is installed.                                                        CLE023
      *                                                                                       CLE023
     C                     MOVE 'N'       CLE023  1                                           CLE023
     C                     CALL 'AOSARDR0'                                                    CLE023
     C                     PARM *BLANKS   PRTCD                                               CLE023
     C                     PARM '*VERIFY' POPTN                                               CLE023
     C                     PARM 'CLE023'  PSARD                                               CLE023
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE023
      *                                                                                       CLE023
     C           PRTCD     IFEQ *BLANKS                                                       CLE023
     C                     MOVE 'Y'       CLE023                                              CLE023
     C                     ELSE                                                               CLE023
     C           PRTCD     IFNE '*NRF   '                                                     CLE023
      *                                                                                       CLE023
      ** Call to program ended in error                                                       CLE023
      *                                                                                       CLE023
     C           *LOCK     IN   LDA                                                           CLE023
     C                     MOVE *BLANKS   DBKEY                                               CLE023
     C                     MOVEL'CLE023'  DBKEY                                               CLE023
     C                     MOVE 'SCSARDPD'DBFILE                                              CLE023
     C                     Z-ADD009       DBASE                                               CLE023
     C                     MOVEL'LER032'  DBPGM     P                                         CLE023
     C                     OUT  LDA                                                           CLE023
     C                     EXSR *PSSR                                                         CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE028
      ** Check if CLE028 is switched *ON.                                                     CLE028
      *                                                                                       CLE028
     C                     MOVE 'N'       CLE028  1                                           CLE028
     C                     CALL 'AOSARDR0'                                                    CLE028
     C                     PARM *BLANKS   PRTCD                                               CLE028
     C                     PARM '*VERIFY' POPTN                                               CLE028
     C                     PARM 'CLE028'  PSARD                                               CLE028
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE028
      *                                                                                       CLE028
     C           PRTCD     IFEQ *BLANKS                                                       CLE028
     C                     MOVE 'Y'       CLE028                                              CLE028
     C                     ELSE                                                               CLE028
     C           PRTCD     IFNE '*NRF   '                                                     CLE028
      *                                                                                       CLE028
      ** Call to program ended in error                                                       CLE028
      *                                                                                       CLE028
     C           *LOCK     IN   LDA                                                           CLE028
     C                     MOVE *BLANKS   DBKEY                                               CLE028
     C                     MOVEL'CLE028'  DBKEY                                               CLE028
     C                     MOVE 'SCSARDPD'DBFILE                                              CLE028
     C                     Z-ADD009       DBASE                                               CLE028
     C                     MOVEL'LER032'  DBPGM     P                                         CLE028
     C                     OUT  LDA                                                           CLE028
     C                     EXSR *PSSR                                                         CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE025
      ** Check if enhancement CLE025 is installed                                             CLE025
      *                                                                                       CLE025
     C                     MOVE *OFF      *IN51                                               CLE025
     C                     CALL 'AOSARDR0'                                                    CLE025
     C                     PARM *BLANKS   PRTCD                                               CLE025
     C                     PARM '*VERIFY' POPTN                                               CLE025
     C                     PARM 'CLE025'  PSARD                                               CLE025
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE025
      *                                                                                       CLE025
     C           PRTCD     IFNE *BLANKS                                                       CLE025
     C           PRTCD     ANDNE'*NRF   '                                                     CLE025
     C           *LOCK     IN   LDA                                                           CLE025
     C                     MOVE 'SCSARDPD'DBFILE                                              CLE025
     C                     MOVEL'CLE025'  DBKEY                                               CLE025
     C                     Z-ADD10        DBASE                                               CLE025
     C                     OUT  LDA                                                           CLE025
     C                     EXSR *PSSR                                                         CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           PRTCD     IFEQ *BLANKS                                                       CLE025
     C                     MOVE *ON       *IN51                                               CLE025
     C                     MOVE 'Y'       CLE025  1                                           CLE025
     C                     ELSE                                                               CLE025
     C                     MOVE 'N'       CLE025                                              CLE025
     C                     ENDIF                                                              CLE025
     C/COPY WNCPYSRC,LEH00312
      *                                                                                       CSC042
     C* Set up CCY array                                                                      CSC042
     C                     Z-ADD0         Q       40                                          CSC042
      * Save state of *IN03                                                                   CSC042
     C           *IN03     IFEQ *ON                                                           CSC042
     C                     MOVEL'Y'       INDC03  1                                           CSC042
     C                     ELSE                                                               CSC042
     C                     MOVEL'N'       INDC03  1                                           CSC042
     C                     END                                                                CSC042
     C                     SETOF                         03                                   CSC042
     C                     OPEN SDCURRPD                                                      CSC042
     C           *IN03     DOWEQ*OFF                                                          CSC042
     C                     READ SDCURRPD                 03                                   CSC042
     C           *IN03     IFEQ *OFF                                                          CSC042
     C           Q         IFLE 150                                                           CSC042
     C                     ADD  1         Q                                                   CSC042
     C                     MOVE A6CYCD    CURR,Q                                              CSC042
     C                     Z-ADDA6NBDP    CCDP,Q                                              CSC042
     C                     END                                                                CSC042
     C                     END                                                                CSC042
     C                     END                                                                CSC042
      * Restore 03 back to previous state                                                     CSC042
     C           INDC03    IFEQ 'Y'                                                           CSC042
     C                     SETON                     03                                       CSC042
     C                     ELSE                                                               CSC042
     C                     SETOF                     03                                       CSC042
     C                     END                                                                CSC042
     C                     CLOSESDCURRPD                                                      CSC042
      *                                                                   0026
      ** Past Due Call Loans                                                                AR398038
      *                                                                                     AR398038
     C                     MOVE 'N'       CLE134  1                                         AR398038
     C                     CALL 'AOSARDR0'                                                  AR398038
     C                     PARM *BLANKS   @RTCD                                             AR398038
     C                     PARM '*VERIFY' @OPTN                                             AR398038
     C                     PARM 'CLE134'  @SARD                                             AR398038
     C           SCSARD    PARM SCSARD    DSFDY                                             AR398038
      *                                                                                     AR398038
     C           @RTCD     IFEQ *BLANKS                                                     AR398038
     C                     MOVE 'Y'       CLE134                                            AR398038
     C                     ENDIF                                                            AR398038
      *                                                                                     AR398038
     C           CLE134    IFEQ 'Y'                                                         AR398038
     C           WPNAM     ANDEQ'NEWCOB'                                                    AR398038
     C                     MOVE 'Y'       NEWCOB  1                                         AR398038
     C                     ENDIF                                                            AR398038
      *                                                                                     AR398038
     C                     ENDSR
      ********************************************************************
      /EJECT                                                                                  CSC042
     C********************************************************************                    CSC042
     C*                                                                                       CSC042
     C*  ##CHKC  - Check the currency details                                                 CSC042
     C*                                                                                       CSC042
     C********************************************************************                    CSC042
     C           ##CHKC    BEGSR                                                              CSC042
      *                                                                                       CSC042
     C           *LIKE     DEFN BJCYCD    ##KC                                                CSC042
     C           *LIKE     DEFN Q         ##QSV                                               CSC042
      *                                                                                       CSC042
      * Set off the currency found indicator                                                  CSC042
     C                     MOVEL*BLANK    ##FIC   1                                           CSC042
      *                                                                                       CSC042
      * Save the state of indicator 87 so it can be reset at the end                          CSC042
      * of the SR as it may be used elsewhere in the code                                     CSC042
     C           *IN87     IFEQ *ON                                                           CSC042
     C                     MOVEL'Y'       #IN87   1                                           CSC042
     C                     ELSE                                                               CSC042
     C                     MOVEL'N'       #IN87                                               CSC042
     C                     END                                                                CSC042
      *                                                                                       CSC042
     C                     SETOF                         87                                   CSC042
      *                                                                                       CSC042
      * Restore Q from ##QSV in case Q is used elsewhere in the code                          CSC042
     C                     Z-ADD##QSV     Q       40                                          CSC042
      *                                                                                       CSC042
      * Are we looking for the same details as the last time this                             CSC042
      * subroutine was called i.e. is Q already set correctly?                                CSC042
      * If so then use the data rather than do another LOKUP                                  CSC042
      * First make sure that we don't reference the 0th array element                         CSC042
     C           Q         IFEQ 0                                                             CSC042
     C                     Z-ADD1         Q                                                   CSC042
     C                     END                                                                CSC042
      * Now see if this search is same as last one performed                                  CSC042
      * If we have a match then seton 87 so the code after this                               CSC042
      * subroutine knows it can use Q directly                                                CSC042
     C           ##KC      IFEQ CURR,Q                                                        CSC042
     C                     SETON                         87                                   CSC042
     C                     ELSE                                                               CSC042
      * Otherwise hunt in the array and seton 87 if found                                     CSC042
     C                     Z-ADD1         Q                                                   CSC042
     C           ##KC      LOKUPCURR,Q                   87                                   CSC042
     C                     END                                                                CSC042
      *                                                                                       CSC042
      * Save Q for next time                                                                  CSC042
     C           *IN87     IFEQ *ON                                                           CSC042
     C                     Z-ADDQ         ##QSV                                               CSC042
      * Set the indicator to show the data was found                                          CSC042
     C                     MOVEL'Y'       ##FIC                                               CSC042
     C                     END                                                                CSC042
      *                                                                                       CSC042
      * Reset the state of indicator 87.                                                      CSC042
     C           #IN87     IFEQ 'Y'                                                           CSC042
     C                     MOVEL*ON       *IN87                                               CSC042
     C                     ELSE                                                               CSC042
     C                     MOVEL*OFF      *IN87                                               CSC042
     C                     END                                                                CSC042
      *                                                                                       CSC042
     C                     ENDSR                                                              CSC042
      *                                                                                       CSC042
     C********************************************************************                    CSC042
      /EJECT                                                                                  CSC042
     C/TITLE SR/HISTRC
      ********************************************************************
      *
      *  HISTRC - SUBROUTINE TO CREATE INITIAL FACILITY HISTORY RECORD
      *
      *  CALLED FROM: MAIN PROCESSING
      *
      *  CALLS: NOTHING
      *
     C********************************************************************
      *
     C           HISTRC    BEGSR
     C                     MOVE 'D'       FARECI
     C*                                                                     0027
     C***  USE FACILITY BRANCH                                              0027
     C*                                                                     0027
     C                     MOVE WKBRCA    BRCA                              0027
     C*                                                                     0027
     C                     MOVE FCCNUM    FACNUM
     C                     MOVE FCFCTY    FAFCTY
     C                     MOVE DTAP      FADATE
      *                                                                                      BUG8222
     C           FADATE    IFLT TONDAT                                                       BUG8222
     C           FMORED    ANDLTTONDAT                                                       BUG8222
     C                     Z-ADDTONDAT    FADATE                                             BUG8222
     C                     ENDIF                                                             BUG8222
      *                                                                                      BUG8222
     C                     Z-ADD1         FAFSEQ
     C                     Z-ADD1         FATSEQ                                              200289
     C**********           Z-ADD0         FALOAN                                              CLE148
     C                     MOVEL*BLANKS   FALOAN                                              CLE148
     C                     MOVE 'FS'      FAACTN
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDFHOFAM    FAAFAM                                              CLE023
     C                     MOVE *BLANKS   FALUCY                                              CLE023
     C                     MOVE *BLANKS   FARTMD                                              CLE023
     C                     MOVE *BLANKS   FARCSI                                              CLE023
     C                     Z-ADD0         FALUAM                                              CLE023
     C                     Z-ADD0         FAEXRT                                              CLE023
     C                     Z-ADD0         FAPTYP                                              CLE023
     C                     Z-ADD0         FAPAMT                                              CLE023
     C                     Z-ADDBJRDNB    FAORED                                              CLE023
     C                     MOVE *BLANKS   FALPFI                                              CLE023
     C                     ENDIF                                                              CLE023
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADD*ZEROS    FAOFFS                                              CLE025
     C                     Z-ADD*ZEROS    FADEAL                                              CLE025
     C                     MOVE *BLANKS   FAMCY                                               CLE025
     C                     MOVE *BLANKS   FAACBR                                              CLE025
     C**********           Z-ADD*ZEROS    FAACCU                                       CLE025 CSD027
     C                     MOVE *BLANKS   FAACCU                                              CSD027
     C                     MOVE *BLANKS   FAACCY                                              CLE025
     C                     Z-ADD*ZEROS    FAACCD                                              CLE025
     C                     Z-ADD*ZEROS    FAACSQ                                              CLE025
     C                     Z-ADD*ZEROS    FAACNO                                              CLE025
     C                     Z-ADD*ZEROS    FATTEO                                              CLE025
     C                     Z-ADD*ZEROS    FAPTEO                                              CLE025
     C                     MOVE *BLANKS   FAEXCY                                              CLE025
     C                     Z-ADD*ZEROS    FATVAL                                              CLE025
     C                     Z-ADD*ZEROS    FAWEIG                                              CLE025
     C                     Z-ADD*ZEROS    FAWCPC                                              CLE025
     C                     MOVE *BLANKS   FAINOF                                              CLE025
     C                     MOVE *BLANKS   FAFXMT                                              CLE025
     C                     Z-ADD*ZEROS    FAFXPC                                              CLE025
     C                     ENDIF                                                              CLE025
     C                     MOVE FHOFAM    FAAAMT
     C                     MOVE *BLANKS   FAPART
     C                     MOVE FHRCIN    FARCIN
     C                     MOVE FHOFAM    FACFAM
     C                     Z-ADD0         FADRAM
     C                     Z-ADDFHOFAM    FAUNDR
     C                     MOVE *BLANKS   FAREVI
     C                     MOVE *BLANKS   FALCRF                          S01473
     C           CLE005    IFEQ 'Y'                                       127728
     C                     Z-ADDBJRDNB    FAGNDT                          127728
     C                     MOVE *BLANK    FACFGI                          127728
     C                     ENDIF                                          127728
      *                                                                   154584
     C           WHIST     CHAINHISACTL2             13                   154584
     C           *IN13     DOWEQ'0'                                       154584
     C           ACTN2     ANDNE'RC'                                      154584
     C           WHIST     READEHISACTL2                 13               154584
     C                     ENDDO                                          154584
     C           *IN13     IFEQ '0'                                       154584
     C           ACTN2     ANDEQ'RC'                                      154584
     C           RCIN2     IFEQ 'Y'                                       154584
     C                     MOVE 'N'       FARCIN                          154584
     C                     ELSE                                           154584
     C                     MOVE 'Y'       FARCIN                          154584
     C                     ENDIF                                          154584
     C                     ENDIF                                          154584
      *                                                                   154584
     C/COPY WNCPYSRC,LEH00313
     C                     WRITEFACHISAF
     C*                                                                   S01408
     C/COPY WNCPYSRC,LER032CPLH                                           S01408
     C*                                                                   S01408
     C           CEXIT     ENDSR
      ********************************************************************                    CLE025
     C/TITLE SR/SRUPDF                                                                        CLE025
      ********************************************************************                    CLE025
      *                                                                  *                    CLE025
      *  SRUPDF - Subroutine to Update Files namely ACCNTAB, GLACNTQD    *                    CLE025
      *           and FACHISA                                            *                    CLE025
      *                                                                  *                    CLE025
      ********************************************************************                    CLE025
      *                                                                                       CLE025
     C           SRUPDF    BEGSR                                                              CLE025
      *                                                                                       CLE025
     C           KLACCT    KLIST                                                              CLE025
     C**********           KFLD           KYCNUM  60                                   CLE025 CSD027
     C                     KFLD           KYCNUM  6                                           CSD027
     C                     KFLD           KYCCY   3                                           CLE025
     C                     KFLD           KYACOD 100                                          CLE025
     C                     KFLD           KYACSQ  20                                          CLE025
     C                     KFLD           KYBRCA  3                                           CLE025
      *                                                                                       CLE025
     C           KLFACH    KLIST                                                              CLE025
     C**********           KFLD           KYPFCU  60                                   CLE025 CSD027
     C                     KFLD           KYPFCU  6                                           CSD027
     C                     KFLD           KYFCLT  50                                          CLE025
     C                     KFLD           KYBRCA                                              CLE025
     C                     KFLD           KYCNUM                                              CLE025
     C                     KFLD           KYCCY                                               CLE025
     C                     KFLD           KYACOD                                              CLE025
     C                     KFLD           KYACSQ                                              CLE025
      *                                                                                       CLE025
     C           1         SETLLACCNTABF                                                      CLE025
     C                     READ ACCNTABF                 14                                   CLE025
      *                                                                                       CLE025
     C           *IN14     DOWEQ*OFF                                                          CLE025
      *                                                                                       CLE025
     C                     MOVE CNUM      KYCNUM                                              CLE025
     C                     MOVE CCY       KYCCY                                               CLE025
     C                     MOVE ACOD      KYACOD                                              CLE025
     C                     MOVE ACSQ      KYACSQ                                              CLE025
     C                     MOVE BRCA      KYBRCA                                              CLE025
      *                                                                                       CLE025
     C           KLACCT    CHAINGLACNTL3             15                                       CLE025
      *                                                                                       CLE025
     C           *IN15     IFEQ *ON                                                           CLE025
     C           *LOCK     IN   LDA                                                           CLE025
     C                     MOVE *BLANKS   DBKEY                                               CLE025
     C                     MOVELU2FKEY    DBKEY                                               CLE025
     C                     MOVE 'GLACNTQD'DBFILE                                              CLE025
     C                     Z-ADD13        DBASE                                               CLE025
     C                     MOVEL'LER032'  DBPGM                                               CLE025
     C                     OUT  LDA                                                           CLE025
     C                     EXSR *PSSR                                                         CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           F1FCHD    IFNE 0                                                             CLE025
      *                                                                                       CLE025
     C********** PFCU      IFNE 0                                                      CLE025 CSD027
     C           PFCU      IFNE *BLANKS                                                       CSD027
     C           PFTP      ORNE 0                                                             CLE025
     C           PFSQ      ORNE 0                                                             CLE025
      *                                                                                       CLE025
      ** Setup key list for Facilities Details File                                           CLE025
     C**********           Z-ADDPFCU      KYPFCU                                       CLE025 CSD027
     C                     MOVE PFCU      KYPFCU                                              CSD027
     C                     Z-ADDPFTP      KYFCLT                                              CLE025
     C                     MULT 100       KYFCLT                                              CLE025
     C                     ADD  PFSQ      KYFCLT                                              CLE025
     C                     MOVE BRCA      KYBRCA                                              CLE025
     C**********           Z-ADDCNUM      KYCNUM                                       CLE025 CSD027
     C                     MOVE CNUM      KYCNUM                                              CSD027
     C                     MOVE CCY       KYCCY                                               CLE025
     C                     Z-ADDACOD      KYACOD                                              CLE025
     C                     Z-ADDACSQ      KYACSQ                                              CLE025
      *                                                                                       CLE025
     C           KLFACH    SETLLFACHISA5                                                      CLE025
     C           KLFACH    READEFACHISA5                 16                                   CLE025
      *                                                                                       CLE025
     C           *IN16     DOWEQ*OFF                                                          CLE025
      *                                                                                     MD045032
      ** Delete history record if tag as Reversal                                           MD045032
      *                                                                                     MD045032
     C           FAREVI    IFEQ 'R'                                                         MD045032
     C                     WRITEFACHISCL                                                    MD045032
     C                     DELETFACHISA5                                                      CLE025
     C                     ENDIF                                                            MD045032
      *                                                                                     MD045032
      ** Include in file the previous facility history                                      MD045032
      ** that have been reversed today.                                                     MD045032
      *                                                                                     MD045032
     C           FARECI    IFEQ 'R'                                                         MD045032
     C                     MOVE 'R'       FAREVI                                            MD045032
     C                     WRITEFACHISCL                                                    MD045032
     C                     ENDIF                                                            MD045032
      *                                                                                     MD045032
     C           KLFACH    READEFACHISA5                 16                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     READ ACCNTABF                 14                                   CLE025
      *                                                                                       CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
     C           1         SETLLACCNTABF                                                      CLE025
     C                     READ ACCNTABF                 14                                   CLE025
      *                                                                                       CLE025
     C           *IN14     DOWEQ*OFF                                                          CLE025
     C           FCCU      IFNE PFCU                                                          CLE025
     C           FACT      ORNE PFTP                                                          CLE025
     C           FCNO      ORNE PFSQ                                                          CLE025
     C**********           Z-ADDFCCU      PFCU                                         CLE025 CSD027
     C                     MOVE FCCU      PFCU                                                CSD027
     C                     Z-ADDFACT      PFTP                                                CLE025
     C                     Z-ADDFCNO      PFSQ                                                CLE025
     C                     UPDATACCNTABF                                                      CLE025
     C                     ENDIF                                                              CLE025
     C                     READ ACCNTABF                 14                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
     C           *LOVAL    SETLLGLACNTL3                                                      CLE025
     C                     READ GLACNTL3                 14                                   CLE025
      *                                                                                       CLE025
     C           *IN14     DOWEQ*OFF                                                          CLE025
     C           F1FCHD    IFNE *ZERO                                                         CLE025
     C                     Z-ADDF1FCHD    F1LFCD                                              CLE025
     C                     Z-ADD0         F1FCHD                                              CLE025
     C                     UPDATGLACNTD0                                                      CLE025
     C                     ENDIF                                                              CLE025
     C                     READ GLACNTL3                 14                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
     C                     ENDSR                                                              CLE025
      ********************************************************************
     C/TITLE SR/HISTRA
      ****************************************************************
      *
      *  HISTRA - SUBROUTINE TO PROCESS HISTORY ACTION RECORD
      *
      *  CALLED FROM: MAIN PROCESSING
      *
      *  CALLS: NOTHING
      *
     C********************************************************************
      *
     C           HISTRA    BEGSR
      *                                                                   CLE014
      ** If the facility is a credit agreement and the revolving credit   CLE014
      ** indicator is 'T', use the tranche's revolving credit indicator   CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           WTRCA     ANDEQ'CA'                                      CLE014
     C           HARCIN    ANDEQ'T'                                       CLE014
     C                     MOVE HATRRC    @RCI                            CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      *                                                                                       204450
      ** Reset reactivation flag                                                              204450
      *                                                                                       204450
     C           REACTF    IFEQ 'Y'                                                           204450
     C           HACNUM    IFNE RCNUM                                                         204450
     C           HAFCTY    ORNE RFCLT                                                         204450
     C           HADATE    ORNE RDATE                                                         204450
     C                     MOVE 'N'       REACTF                                              200450
     C                     ENDIF                                                              204450
     C                     ENDIF                                                              204450
      *                                                                                       204450
      * Set up new date if difference
     C           @DATE     IFNE HADATE
      *                                                                   185781
      ** Do not zeroise the sequence number for backvalued transactions   185781
      ** with value date equal to the date of the last record in          185781
      ** FACHISA before the entry of the said transactions                185781
      *                                                                   185781
     C           HADATE    IFNE FADATE                                    185781
     C                     Z-ADD0         @CSEQ
     C                     Z-ADD0         WTSEQ                                               200289
     C                     ELSE                                           185781
     C                     Z-ADDFAFSEQ    @CSEQ                           185781
     C                     Z-ADDFATSEQ    WTSEQ                                               200289
     C                     ENDIF                                          185781
     C                     MOVE HADATE    @DATE
     C                     END
      *                                                                                       224974
     C           HAACTN    IFEQ 'RE'                                                        AR657105
     C**********           Z-ADDHALOAN    WLNRF                                      AR657105 CLE148
     C                     MOVELHALOAN    WLNRF                                               CLE148
     C           WCLON     CHAINCLOANLB              99                                     AR657105
     C                     ENDIF                                                            AR657105
      *                                                                                     AR657105
     C           HAACTN    IFEQ 'MT'                                                          224974
     C           HAACTN    OREQ 'RE'                                                        AR657105
     C           *IN99     ANDEQ'0'                                                         AR657105
     C           XCPAM     ANDEQ0                                                           AR657105
     C                     Z-ADD0         STRAMT 150                                          224974
     C                     Z-ADD0         TOTAMT 150                                          224974
     C           KEY007    SETLLHISACT1                                                       224974
     C           KEY007    READEHISACT1                  99                                   224974
     C           *IN99     DOWEQ*OFF                                                          224974
     C                     SELEC                                                              224974
     C           ACTN1     WHEQ 'ST'                                                          224974
     C           ACTN1     OREQ 'IC'                                                          224974
     C           ACTN1     OREQ 'MC'                                                          224974
     C           ACTN1     OREQ 'PI'                                                          224974
     C           ACTN1     OREQ 'PT'                                                          224974
     C                     ADD  AAMT1     STRAMT                                              224974
     C           ACTN1     WHEQ 'WO'                                                          224974
     C           ACTN1     OREQ 'RE'                                                          224974
     C           ACTN1     OREQ 'MT'                                                          224974
     C           ACTN1     OREQ 'PF'                                                          224974
     C                     ADD  AAMT1     TOTAMT                                              224974
     C                     ENDSL                                                              224974
     C           KEY007    READEHISACT1                  99                                   224974
     C                     ENDDO                                                              224974
      *                                                                                     AR657105
     C           KEY007    SETLLFACHIS1                                                     AR657105
     C           KEY007    READEFACHIS1                  99                                 AR657105
     C           *IN99     DOWEQ*OFF                                                        AR657105
     C                     SELEC                                                            AR657105
     C           F3ACTN    WHEQ 'ST'                                                        AR657105
     C           F3ACTN    OREQ 'IC'                                                        AR657105
     C           F3ACTN    OREQ 'MC'                                                        AR657105
     C           F3ACTN    OREQ 'PI'                                                        AR657105
     C           F3ACTN    OREQ 'PT'                                                        AR657105
     C                     ADD  F3AAMT    STRAMT                                            AR657105
     C           F3ACTN    WHEQ 'WO'                                                        AR657105
     C           F3ACTN    OREQ 'RE'                                                        AR657105
     C           F3ACTN    OREQ 'MT'                                                        AR657105
     C           F3ACTN    OREQ 'PF'                                                        AR657105
     C                     ADD  F3AAMT    TOTAMT                                            AR657105
     C                     ENDSL                                                            AR657105
     C           KEY007    READEFACHIS1                  99                                 AR657105
     C                     ENDDO                                                            AR657105
      *                                                                                     AR657105
     C           STRAMT    IFNE TOTAMT                                                        224974
     C           STRAMT    SUB  TOTAMT    DIFAMT 150                                          224974
     C           DIFAMT    IFLT 0                                                             224974
     C           DIFAMT    ANDGT-100                                                          224974
     C           DIFAMT    ORGT 0                                                             224974
     C           DIFAMT    ANDLT100                                                           224974
     C                     ADD  DIFAMT    HAAAMT                                              224974
     C                     ENDIF                                                              224974
     C                     ENDIF                                                              224974
     C                     ENDIF                                                              224974
      *
     C                     Z-ADDHAAAMT    @AMT   130
      *                                                                   128980
      ** Exclude actions with participant facilities when the facilty     128980
      ** being processed is a Credit agreement or a Tranche               128980
      *                                                                   128980
     C                     MOVE *BLANK    WNSYN   1                       161412
     C                     MOVE *BLANK    WRCSI   1                       161412
     C           WPRTR     IFNE 'P'                                       128980
     C           WPRTR     ANDNE'I'                                       128980
     C           WPRTR     ANDNE'R'                                                           CLE106
     C           WPRTR     ANDNE'S'                                                           CLE106
      *                                                                   128980
     C***********WTRCA     IFEQ 'CA'                               128980 147488
     C***********WTRCA     OREQ 'TR'                               128980 147488
      *                                                                   222461
      * Initialise GASS and RCSI in case loans already dropped            222461
     C                     MOVE *BLANKS   GASS                            222461
     C                     MOVE *BLANKS   RCSI                            222461
      *                                                                   222461
     C**********           Z-ADDHALOAN    WLNRF   60                                   128980 CLE148
     C                     MOVELHALOAN    WLNRF   6                                           CLE148
     C           WCLON     CHAINCLOANLB              12                   128980
      *                                                                                       203070
      ** If loan is not found from CLOANB, chain to MLOAN.                                    203070
      *                                                                                       203070
     C           *IN12     IFEQ '1'                                                           203070
     C           WLNRF     CHAINMLOAN                12                                       203070
     C                     ENDIF                                                              203070
      *                                                                                       203070
     C                     MOVE GASS      WNSYN                           161412
     C                     MOVE RCSI      WRCSI                           161412
     C                     SELEC                                          128980
     C           LPFI      WHEQ 'P'                                       128980
     C           *IN12     ANDEQ'0'                                       128980
     C           LPFI      OREQ 'S'                                                           CLE106
     C           *IN12     ANDEQ'0'                                                           CLE106
     C           LPFI      OREQ 'R'                                                           CLE106
     C           *IN12     ANDEQ'0'                                                           CLE106
     C           LPFI      OREQ 'I'                                       128980
     C           *IN12     ANDEQ'0'                                       128980
     C                     Z-ADD0         @AMT                            128980
     C           *IN12     WHEQ '0'                                       128980
     C           WTRCA     IFEQ 'CA'                                      147488
     C           WTRCA     OREQ 'TR'                                      147488
     C                     MOVELBRCA      WBRCH   3                       128980
     C**********           Z-ADDXFCUS     WCSNO   60                                   128980 CSD027
     C                     MOVE XFCUS     WCSNO   6                                           CSD027
     C                     Z-ADDXFTYP     WFTYE   30                      128980
     C                     Z-ADDXFSEQ     WFSNO   20                      128980
      *                                                                   128980
     C           WFCTY     CHAINFCLTY1               12                   128980
     C           *IN12     IFEQ '1'                                       128980
     C           WFCTY     CHAINPEFCLFL1             12                   128980
     C                     ENDIF                                          128980
      *                                                                   128980
     C           *IN12     IFEQ '0'                                       128980
     C           TRCA      ANDEQ'TR'                                      128980
     C           PRTR      ANDEQ'P'                                       128980
     C           *IN12     OREQ '0'                                       128980
     C           TRCA      ANDEQ'TR'                                      128980
     C           PRTR      ANDEQ'I'                                       128980
     C           *IN12     OREQ '0'                                                           CLE106
     C           TRCA      ANDEQ'TR'                                                          CLE106
     C           PRTR      ANDEQ'R'                                                           CLE106
     C           *IN12     OREQ '0'                                                           CLE106
     C           TRCA      ANDEQ'TR'                                                          CLE106
     C           PRTR      ANDEQ'S'                                                           CLE106
     C                     Z-ADD0         @AMT                            128980
     C                     ENDIF                                          128980
     C                     ENDIF                                          147488
     C                     ENDSL                                          128980
     C***********          ENDIF                                   128980 147488
     C                     ENDIF                                          128980
      *
      ** Store loan reversal details
     C           HAACTN    IFEQ 'RV'
      *                                                                                       CLE025
     C           HADEAL    IFNE *ZEROS                                                        CLE025
     C                     ADD  1         H                                                   CLE025
     C                     MOVE HADEAL    VDL,H                                               CLE025
     C                     ELSE                                                               CLE025
      *                                                                   CLE005
      ** If SAR CLE005 is installed and HALOAN is *ZERO                   CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C********** HALOAN    ANDEQ*ZERO                                                  CLE005 CLE148
     C           HALOAN    ANDEQ*BLANKS                                                       CLE148
     C                     ADD  1         Y                               CLE005
      *                                                                   CLE005
     C           Y         IFLE 100                                       CLE005
     C                     MOVE HASQNO    SQN,Y                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ELSE                                           CLE005
     C***********          ADD  1         X       20                      E29760
     C                     ADD  1         X                               E29760
      *
     C***********X         IFLE 10                                        E29760
     C           X         IFLE 100                                       E29760
     C                     MOVE HALOAN    LN,X
     C                     END
     C                     ENDIF                                          CLE005
     C                     ENDIF                                                              CLE025
      *
     C                     GOTO D1EXIT
     C                     END
      *                                                                                       CLE025
      ** Action type is Reinstatement ('RS')                                                  CLE025
      *                                                                                       CLE025
     C           HAACTN    IFEQ 'RS'                                                          CLE025
      *                                                                                       CLE025
     C           HADEAL    IFNE *ZEROS                                                        CLE025
     C                     ADD  1         I                                                   CLE025
     C                     MOVE HADEAL    IDL,I                                               CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     GOTO D1EXIT                                                        CLE025
      *                                                                                       CLE025
     C                     ENDIF                                                              CLE025
      *                                                                   CLE005
      ** If SAR CLE005 is Present, and action type is 'US' or 'UI'        CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
      *                                                                   CLE005
     C           HAACTN    IFEQ 'US'                                      CLE005
     C           HAACTN    OREQ 'UI'                                      CLE005
     C                     ADD  @AMT      @DADJ                           CLE005
     C                     SUB  @AMT      @UADJ                           CLE005
     C                     GOTO D1EXIT                                    CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C           HAACTN    IFEQ 'UE'                                      CLE005
     C           HAACTN    OREQ 'UD'                                      CLE005
     C                     SUB  @AMT      @DADJ                           CLE005
      *                                                                   CLE005
     C           @RCI      IFEQ 'Y'                                       CLE005
     C                     ADD  @AMT      @UADJ                           CLE005
     C                     ELSE                                           CLE005
     C                     SUB  @AMT      @FADJ                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     GOTO D1EXIT                                    CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *
      ** Update syndicated loans or non syndicated parts purchased        161412
      *                                                                   161412
     C           CLE004    IFEQ 'N'                                       161412
     C           CLE004    OREQ 'Y'                                       161412
     C           WNSYN     ANDNE'P'                                       161412
     C           CLE004    OREQ 'Y'                                       161412
     C           WNSYN     ANDEQ'P'                                       161412
     C           PTYP      ANDNE66                                        161412
     C           PTYP      ANDNE67                                        161412
     C           PTYP      ANDNE69                                        161412
     C           PTYP      ANDNE72                                        161412
     C           HAACTN    IFEQ 'WO'
     C           HAACTN    OREQ 'RE'
     C           HAACTN    OREQ 'PF'                                                        AR325915
     C           HAACTN    OREQ 'MT'
     C/COPY WNCPYSRC,LEH01342
     C                     SUB  @AMT      @DADJ
     C/COPY WNCPYSRC,LEH01343
      *
     C           @RCI      IFEQ 'Y'
     C           HAACTN    OREQ 'PF'                                                        AR325915
     C********** HAACTN    OREQ 'RE'                                                 225591 AR325915
     C********** HARIND    ANDEQ'R'                                                  225591 AR325915
     C********** @RCI      ANDNE'Y'                                                  225591 AR325915
     C/COPY WNCPYSRC,LEH01344
     C                     ADD  @AMT      @UADJ
     C/COPY WNCPYSRC,LEH01345
     C                     ELSE
     C           HAGASS    IFNE 'A'                                       156585
      *                                                                                       204450
     C           REACTF    IFEQ 'N'                                                           204450
     C/COPY WNCPYSRC,LEH01346
     C                     SUB  @AMT      @FADJ
     C/COPY WNCPYSRC,LEH01347
     C                     ELSE                                                               204450
     C                     ADD  @AMT      @UADJ                                               204450
     C                     ENDIF                                                              204450
      *                                                                                       204450
     C                     ELSE                                           156585
     C                     ADD  @AMT      @UADJ                           156585
     C                     ENDIF                                          156585
     C                     END
     C                     GOTO D1EXIT
      *
     C                     END
      *
     C           HAACTN    IFEQ 'IC'
     C           HAACTN    OREQ 'PI'
     C           HAACTN    OREQ 'ST'
     C           HAACTN    OREQ 'PT'                                                       MD051963A
     C           HAACTN    OREQ 'MC'                                                          194912
     C           HAACTN    OREQ 'CH'                                                          CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
      *                                                                   146936
      ** If ST is for multi-ccy rollover and facility is non-revolving    146936
      ** add the amount to facility amount                                146936
      ** This processing should be done for all types of multi-ccy                            193859
      ** rollover, not only for EMU.                                                          193859
      *                                                                   146936
     C           LTYP1     IFNE 'X'                                                         AR571209
     C           LTYP1     ANDNE'Y'                                                         AR571209
     C           LTYP1     ANDNE'Z'                                                         AR571209
     C           LTYP1     OREQ 'Y'                                                         AR571209
     C           FAMU      ANDEQ'Y'                                                         AR571209
     C           LTYP1     OREQ 'Z'                                                         AR571209
     C           FAMU      ANDEQ'Y'                                                         AR571209
     C           HAACTN    ORNE 'ST'                                                        AR571209
     C           HAACTN    ANDNE'PI'                                                        AR806351
      *                                                                                     AR571209
     C           HAECIN    IFEQ *BLANK                                    146936
     C           HAACTN    ANDNE'MC'                                                          193859
     C                     ADD  @AMT      @DADJ
     C                     SUB  @AMT      @UADJ
     C                     ELSE                                           146936
     C           @RCI      IFEQ 'N'                                       146936
      *                                                                                       193859
     C           HAGASS    IFNE 'A'                                                           193859
     C                     ADD  @AMT      @FADJ                           146936
     C                     ELSE                                                               193859
     C                     SUB  @AMT      @UADJ                                               193859
     C                     ENDIF                                                              193859
      *                                                                                       193859
     C                     ELSE                                           146936
     C                     SUB  @AMT      @UADJ                           146936
     C                     ENDIF                                          146936
     C                     ADD  @AMT      @DADJ                           146936
     C                     ENDIF                                          146936
      *                                                                   146936
     C                     ENDIF                                                            AR571209
     C                     GOTO D1EXIT
     C                     END
      *                                                                                       CLE023
      ** If CLE023 is installed, process rollover record. Rollover                            CLE023
      ** record must not affect the facility amount, only the Drawn                           CLE023
      ** and Undrawn amounts.  The sign of the rollover action                                CLE023
      ** determines if drawn and undrawn will be reduced or increased.                        CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           HAACTN    ANDEQ'RO'                                                          CLE023
     C**********           SUB  @AMT      @DADJ                                        CLE023 254211
     C**********           ADD  @AMT      @UADJ                                        CLE023 254211
     C                     ADD  @AMT      @DADJ                                               254211
     C                     SUB  @AMT      @UADJ                                               254211
     C                     GOTO D1EXIT                                                        CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF                                          161412
      *
      ** Update part solds sold w/o recourse against non syndicated,      161412
      ** non commitment and revolving facilities                          161412
      ** Participations Sold should not affect the drawn amount of a                          CLE023
      ** facility, regardless of recourse indicator, facility type, etc.                      CLE023
      *
     C           CLE004    IFEQ 'Y'                                       161412
     C           WNSYN     ANDEQ'P'                                       161412
     C           @RCI      ANDEQ'Y'                                       161412
     C           WRCSI     ANDNE'Y'                                       161412
     C           WFCTI     ANDNE'C'                                       161412
     C           CLE023    ANDEQ'N'                                                           CLE023
      *                                                                   161412
     C           PTYP      IFEQ 66                                        161412
     C           PTYP      OREQ 67                                        161412
     C           PTYP      OREQ 69                                        161412
     C           CLE005    ANDEQ'Y'                                       161412
     C           PTYP      OREQ 72                                        161412
     C           CLE005    ANDEQ'Y'                                       161412
      *                                                                   161412
      ** Increase drawn amount and decrease undrawn amount                161412
      *                                                                   161412
     C           HAACTN    IFEQ 'WO'                                      161412
     C           HAACTN    OREQ 'RE'                                      161412
     C           HAACTN    OREQ 'MT'                                      161412
     C           HAACTN    OREQ 'PF'                                                        AR325915
     C                     ADD  @AMT      @DADJ                           161412
     C                     SUB  @AMT      @UADJ                           161412
     C                     GOTO D1EXIT                                    161412
     C                     ENDIF                                          161412
      *                                                                   161412
      ** Decrease drawn amount and increase undrawn amount                161412
      *                                                                   161412
     C           HAACTN    IFEQ 'IC'                                      161412
     C           HAACTN    OREQ 'PI'                                      161412
     C           HAACTN    OREQ 'ST'                                      161412
     C           HAACTN    OREQ 'PT'                                                        AR325915
     C           HAACTN    OREQ 'CH'                                                          CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C                     SUB  @AMT      @DADJ                           161412
     C                     ADD  @AMT      @UADJ                           161412
     C                     GOTO D1EXIT                                    161412
     C                     ENDIF                                          161412
     C                     ENDIF                                          161412
     C                     ENDIF                                          161412
      *                                                                   161412
     C           CLE025    IFEQ 'Y'                                                           CLE025
      *                                                                                       CLE025
      ** MM Loan Start (S1), MM Loan Principal Increase (I1), MM Loan                         CLE025
      ** Interest Capitalisation (C1)                                                         CLE025
      *                                                                                       CLE025
     C           HAACTN    IFEQ 'S1'                                                          CLE025
     C           HAACTN    OREQ 'I1'                                                          CLE025
     C           HAACTN    OREQ 'C1'                                                          CLE025
     C           HAACTN    OREQ 'MR'                                                         BUG3035
     C                     ADD  @AMT      @DADJ                                               CLE025
     C           @UADJ     SUB  @AMT      @UADJ                                               CLE025
     C                     GOTO D1EXIT                                                        CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** MM Loan Maturity (M1), MM Loan Principal Decrease (D1)                               CLE025
      *                                                                                       CLE025
     C           HAACTN    IFEQ 'M1'                                                          CLE025
     C           HAACTN    OREQ 'D1'                                                          CLE025
     C           @DADJ     SUB  @AMT      @DADJ                                               CLE025
     C           @RCI      IFEQ 'Y'                                                           CLE025
     C                     ADD  @AMT      @UADJ                                               CLE025
     C                     ELSE                                                               CLE025
     C                     SUB  @AMT      @FADJ                                               CLE025
     C                     ENDIF                                                              CLE025
     C                     GOTO D1EXIT                                                        CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** FX Mark-to-Market revaluation (FX), FX Expiry (F0), FRA Mark-to-                     CLE025
      ** Market revaluation (FW), FRA Expiry (FV), IRS Mark-to-Market                         CLE025
      ** revaluation (IR), IRS Expiry (IS), A/C Start (AS), A/C Movement (AC)                 CLE025
      *                                                                                       CLE025
     C           HAACTN    IFEQ 'FX'                                                          CLE025
     C           HAACTN    OREQ 'F0'                                                          CLE025
     C           HAACTN    OREQ 'FW'                                                          CLE025
     C           HAACTN    OREQ 'FV'                                                          CLE025
     C           HAACTN    OREQ 'IR'                                                          CLE025
     C           HAACTN    OREQ 'IS'                                                          CLE025
     C           HAACTN    OREQ 'AS'                                                          CLE025
     C           HAACTN    OREQ 'AC'                                                          CLE025
     C           HAACTN    OREQ 'AR'                                                         BUG3035
     C           HATTEO    IFGE *ZEROS                                                        CLE025
     C           HAPTEO    IFGE *ZEROS                                                        CLE025
     C                     ADD  @AMT      @DADJ                                               CLE025
     C                     ELSE                                                               CLE025
     C                     ADD  HAPTEO    @OADJ                                               CLE025
     C                     ADD  HATTEO    @DADJ                                               CLE025
     C                     ENDIF                                                              CLE025
     C                     ELSE                                                               CLE025
     C           HAPTEO    IFLT *ZEROS                                                        CLE025
     C                     SUB  @AMT      @OADJ                                               CLE025
     C                     ELSE                                                               CLE025
     C                     SUB  HAPTEO    @DADJ                                               CLE025
     C                     SUB  HATTEO    @OADJ                                               CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                              CLE025
     C                     SUB  @AMT      @UADJ                                               CLE025
     C                     GOTO D1EXIT                                                        CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** FX Margin (FM)                                                                       CLE025
      *                                                                                       CLE025
     C           HAACTN    IFEQ 'FM'                                                          CLE025
     C                     ADD  @AMT      @DADJ                                               CLE025
     C                     SUB  @AMT      @UADJ                                               CLE025
     C                     GOTO D1EXIT                                                        CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           HAACTN    IFEQ 'FI'
     C                     ADD  @AMT      @FADJ
     C                     ADD  @AMT      @UADJ
     C                     ADD  @AMT      FHLFAM                          144712
     C                     END
      *
     C           HAACTN    IFEQ 'FD'
     C                     SUB  @AMT      @FADJ
     C                     SUB  @AMT      @UADJ
     C                     SUB  @AMT      FHLFAM                          144712
     C                     END
      *
     C********** HAACTN    IFEQ 'FI'                                                          193603
     C********** HAACTN    OREQ 'FD'                                                          193603
     C********** HAACTN    OREQ 'RC'                                                          193603
     C           HAACTN    IFEQ 'RC'                                                          193603
     C***********          MOVE FHRCIN    @RCI                            144712
     C***********          MOVE HARCIN    @RCI                     144712 184748
     C***********          MOVE HARCIN    FHRCIN                   144712 184748
     C                     MOVE HARCIN    FHRCIN                                            AR652989
     C                     MOVE FHRCIN    @RCI                            184748
     C                     END
      *                                                                   CLE005
      ** If SAR CLE005 is Present and action type is 'FR' or 'TC'         CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
      *                                                                   CLE005
     C           HAACTN    IFEQ 'FR'                                      CLE005
     C           HAACTN    OREQ 'TC'                                      CLE005
     C           HAACTN    OREQ 'FE'                                      CLE005
     C           HAACTN    OREQ 'FC'                                      CLE005
     C/COPY WNCPYSRC,LEH00435
     C                     MOVE FHRCIN    @RCI                            CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C           D1EXIT    TAG
      *
      ** Do not create records for reversals
     C           HAACTN    IFNE 'RV'
     C                     MOVE 'D'       FARECI
     C*                                                                     0027
     C***  USE FACILITY BRANCH                                              0027
     C*                                                                     0027
     C                     MOVE WKBRCA    BRCA                              0027
     C*                                                                     0027
     C                     MOVE HACNUM    FACNUM
     C                     MOVE HAFCTY    FAFCTY
     C                     MOVE HADATE    FADATE
     C                     ADD  1         @CSEQ
     C                     ADD  1         WTSEQ                                               200289
     C                     Z-ADD@CSEQ     FAFSEQ
     C                     Z-ADDWTSEQ     FATSEQ                                              200289
     C                     MOVE HALOAN    FALOAN
     C                     MOVE HAACTN    FAACTN
     C                     Z-ADDHAAAMT    FAAAMT
     C                     MOVE HAGASS    FAGASS                          156585
     C**********           MOVELHARIND    FARIND                                     225591 AR325915
      *                                                                   144712
      ** Zeroise FAAAMT if Action is for Credit Indicator                 144712
      *                                                                   144712
     C           HAACTN    IFEQ 'RC'                                      144712
     C                     Z-ADD0         FAAAMT                          144712
     C                     MOVE HARCIN    RCISV                                               246029
     C                     ENDIF                                          144712
     C                     MOVE HAPART    FAPART
     C**********           MOVE @RCI      FARCIN                                              246029
     C********** CLE014    IFEQ 'Y'                                                    CLE014 246029
     C********** WTRCA     ANDEQ'CA'                                                   CLE014 246029
     C********** HAACTN    OREQ 'RC'                                                   194943 246029
     C**********           MOVE HARCIN    FARCIN                                       CLE014 246029
     C**********           ENDIF                                                       CLE014 246029
     C                     MOVE RCISV     FARCIN                                              246029
     C           @CFA      ADD  @FADJ     FACFAM
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDFACFAM    FAAFAM                                              CLE023
     C                     ENDIF                                                              CLE023
     C           @DA       ADD  @DADJ     FADRAM
     C           @UA       ADD  @UADJ     FAUNDR
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C           HAINOF    ANDEQ'Y'                                                           259872
     C           @OA       ADD  @OADJ     FAOFFS                                              CLE025
     C                     ENDIF                                                              CLE025
     C***********          MOVE FARCIN    WRCI                      154584159961
     C                     MOVE FARCIN    @RCI                            159961
     C                     MOVE ' '       FAREVI
     C                     MOVE HALCRF    FALCRF                          S01473
     C********** FACFAM    IFLE 0                                         081634
     C**********           Z-ADD1         FACFAM                          081634
     C***********FACFAM    IFLT 0                                   081634158852
     C***********          Z-ADD0         FACFAM                    081634158852
     C***********          END                                            158852
      *                                                                   157050
     C           CLE005    IFNE 'Y'                                       157050
     C           HAACTN    ANDNE'FI'                                      157050
     C           CLE005    ORNE 'Y'                                       157050
     C           FAUNDR    ANDGT0                                         157050
     C           CLE005    OREQ 'Y'                                       157050
     C           HADATE    ANDLTBJRDNB                                    157050
     C           @UA       ADD  @UADJ     FAUNDR                          157050
     C                     ELSE                                           157050
     C           FACFAM    SUB  FADRAM    FAUNDR                          157050
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     ADD  FAOFFS    FAUNDR                                              CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                          157050
      *                                                                   158852
     C***********FACFAM    IFLT 0                                   158852159499
     C***********          SUB  FACFAM    FAUNDR                    158852159499
     C***********          Z-ADD0         FACFAM                    158852159499
     C***********          END                                      158852159499
      *                                                                   CLE005
      ** Reinstate processing to zeroise facility amount if less than     179077
      ** 0, but condition on CLE005 not being installed.                  179077
      ** If CLE023 is installed and facility amount is negative,                              CLE023
      ** facility amount must be zeroised also.                                               CLE023
      *                                                                   179077
     C           FACFAM    IFLT 0                                         179077
     C           CLE005    ANDNE'Y'                                       179077
     C           FACFAM    ORLT 0                                                             CLE023
     C           CLE023    ANDEQ'Y'                                                           CLE023
     C           FAAFAM    ORLT 0                                                            BUG5224
     C           CLE023    ANDEQ'Y'                                                          BUG5224
      *                                                                                       CLE023
      ** FAUNDR must reflect the actual undrawn amount when CLE023 is                         CLE023
      ** installed.  This is needed for recalculation of actual                               CLE023
      ** facility amount.                                                                     CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'N'                                                           CLE023
     C                     SUB  FACFAM    FAUNDR                          179077
     C                     ENDIF                                                              CLE023
     C                     Z-ADD0         FACFAM                          179077
     C                     ELSE                                                               CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C********** FACFAM    ANDGE*ZERO                                                 CLE023 BUG5224
     C           FACFAM    ANDGT*ZERO                                                        BUG5224
     C                     Z-ADDFAAFAM    FACFAM                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     END                                            179077
     C*                                                                   179077
      ** If SAR CLE005 is Present                                         CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C                     Z-ADDBJRDNB    FAGNDT                          CLE005
     C                     MOVE *BLANK    FACFGI                          127728
      *                                                                   CLE005
     C           HAACTN    IFEQ 'FR'                                      CLE005
     C                     Z-ADD@AMT      FACFAM                          CLE005
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADD@AMT      FAAFAM                                              CLE023
     C                     ENDIF                                                              CLE023
     C           @AMT      SUB  FADRAM    FAUNDR                          159212
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C           HAINOF    ANDEQ'Y'                                                           259872
     C                     ADD  FAOFFS    FAUNDR                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       204450
      ** Note facility has been reactivated                                                   204450
      *                                                                                       204450
     C                     Z-ADDHADATE    RDATE   50                                          204450
     C**********           Z-ADDHACNUM    RCNUM   60                                   204450 CSD027
     C                     MOVE HACNUM    RCNUM   6                                           CSD027
     C                     Z-ADDHAFCTY    RFCLT   50                                          204450
     C                     MOVE 'Y'       REACTF  1                                           204450
      *                                                                                       204450
     C***********          Z-ADD*ZERO     FADRAM                    CLE005159212
     C***********          Z-ADD@AMTO     FAUNDR                    CLE005159212
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C           HAACTN    IFEQ 'FE'                                      CLE005
     C           HAACTN    OREQ 'FC'                                      CLE005
     C***********          Z-ADD*ZEROS    FADRAM                   CLE005 147509
     C***********          Z-ADDFAMT      FADRAM                   147509 153938
     C***********          Z-ADDOAM1      FADRAM                   153938 156993
     C***********          Z-ADD*ZEROS    FAUNDR                   CLE005 127728
     C***********          Z-ADDFAMT      FAUNDR                   127728 147509
     C***********          Z-ADD*ZEROS    FAUNDR                   147509 156993
     C                     MOVE WRECI     FARECI                          127733
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     Z-ADDHASQNO    FASQNO                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                                       CLE023
      ** Before writing to FACHISA, set up values for new fields if                           CLE023
      ** CLE023 is installed.                                                                 CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDBJRDNB    FAORED                                              CLE023
     C                     MOVE HALUCY    FALUCY                                              CLE023
     C                     Z-ADDHALUAM    FALUAM                                              CLE023
     C                     Z-ADDHAEXRT    FAEXRT                                              CLE023
     C                     MOVE HARTMD    FARTMD                                              CLE023
     C                     Z-ADDHAPTYP    FAPTYP                                              CLE023
     C                     MOVE HARCSI    FARCSI                                              CLE023
     C                     Z-ADD0         FAPAMT                                              CLE023
     C                     MOVE HALPFI    FALPFI                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADDHADEAL    FADEAL                                              CLE025
     C                     MOVE HAMCY     FAMCY                                               CLE025
     C                     MOVE HAACBR    FAACBR                                              CLE025
     C                     MOVE HAACCU    FAACCU                                              CLE025
     C                     MOVE HAACCY    FAACCY                                              CLE025
     C                     MOVE HAACCD    FAACCD                                              CLE025
     C                     MOVE HAACSQ    FAACSQ                                              CLE025
     C                     MOVE HAACNO    FAACNO                                              CLE025
     C**********           Z-ADDHATTEO    FAPTEO                                      CLE025 BUG3035
     C                     Z-ADDHATTEO    FATTEO                                             BUG3035
     C                     Z-ADDHAPTEO    FAPTEO                                              CLE025
     C                     MOVE HAEXCY    FAEXCY                                              CLE025
     C                     Z-ADDHATVAL    FATVAL                                              CLE025
     C                     MOVE HAWEIG    FAWEIG                                              CLE025
     C                     MOVE HAWCPC    FAWCPC                                              CLE025
     C                     MOVE HAINOF    FAINOF                                              CLE025
     C                     MOVE HAFXMT    FAFXMT                                              CLE025
     C                     Z-ADDHAFXPC    FAFXPC                                              CLE025
     C                     ENDIF                                                              CLE025
      *
     C/COPY WNCPYSRC,LEH00314
     C                     WRITEFACHISAF
      *                                                                   158559
     C                     Z-ADDFACFAM    WCFAM                           158559
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDFAAFAM    WAFAM                                               CLE023
     C                     ENDIF                                                              CLE023
     C                     Z-ADDFADRAM    WDRAM                           158559
     C                     Z-ADDFAUNDR    WUNDR                           158559
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADDFAOFFS    WOFFS                                               CLE025
     C                     ENDIF                                                              CLE025
      *                                                                   CLE005
      ** If SAR CLE005 is Present and action type is 'FR' or 'TC'         CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
      *                                                                   CLE005
     C           HAACTN    IFEQ 'FR'                                      CLE005
     C           HAACTN    OREQ 'TC'                                      CLE005
     C           HAACTN    OREQ 'FE'                                      CLE005
     C           HAACTN    OREQ 'FC'                                      CLE005
     C/COPY WNCPYSRC,LEH00436
     C                     Z-ADD*ZERO     @FADJ                           CLE005
     C                     Z-ADD*ZERO     @UADJ                           CLE005
     C                     Z-ADD*ZERO     @DADJ                           CLE005
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADD*ZERO     @OADJ                                               CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C           HAACTN    IFEQ 'RC'                                      144712
     C                     Z-ADD*ZERO     @UADJ                           144712
     C                     ENDIF                                          144712
      *                                                                   144712
     C                     ENDIF                                          CLE005
     C*                                                                   S01408
     C/COPY WNCPYSRC,LER032CPDR                                           S01408
     C*                                                                   S01408
      *
     C                     END
      *
     C*********************WRITEFACHISAF
      *
     C** Save facility amounts so that updates can be performed on        156585
     C** backdated facilities.                                            156585
     C*                                                                   156585
     C           WACTN     IFNE HAACTN                                    156585
     C           WDATE     ANDNEHADATE                                    156585
     C           HAACTN    ANDNE'RV'                                      156585
     C                     Z-ADDFACFAM    WCFAM                           154584
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDFAAFAM    WAFAM                                               CLE023
     C                     ENDIF                                                              CLE023
     C                     Z-ADDFADRAM    WDRAM                           154584
     C                     Z-ADDFAUNDR    WUNDR                           154584
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADDFAOFFS    WOFFS                                               CLE025
     C                     ENDIF                                                              CLE025
     C                     Z-ADDFADATE    WDATE                           154584
     C                     ENDIF                                          156585
     C** Access previous facility drawn amounts if facility has been      156585
     C** reversed for update purposes, as present amounts should          156585
     C** be taken out and rewritten.                                      156585
     C           HAACTN    IFEQ 'RV'                                      156585
     C           FACNUM    IFNE WKCNUM                                                        171451
     C           FAFCTY    ORNE WKFCTY                                                        171451
     C                     Z-ADDFACFAM    WCFAM                           156585
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDFAAFAM    WAFAM                                               CLE023
     C                     ENDIF                                                              CLE023
     C                     Z-ADDFADATE    WDATE                           156585
     C                     Z-ADDFADRAM    WDRAM                           184748
     C                     Z-ADDFAUNDR    WUNDR                           184748
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADDFAOFFS    WOFFS                                               CLE025
     C                     ENDIF                                                              CLE025
     C***********          READPFACHISAF                 84         156585158138
     C           KEY003    REDPEFACHISAF                 84               158138
     C           *IN84     IFEQ *ON                                       158138
     C           KEY003    CHAINFACHISAF             84                   158138
     C                     ENDIF                                          158138
     C                     Z-ADDHASQNO    WKSQNO  30                                        AR991602
     C           KEY006    CHAINHISACTF              84                   158138
     C*                                                                                     AR991602
     C           HASQNO    IFNE WKSQNO                                                      AR991602
     C           HASQNO    DOWNEWKSQNO                                                      AR991602
     C           *IN84     ANDEQ*OFF                                                        AR991602
     C           KEY006    READEHISACTF                  84                                 AR991602
     C                     ENDDO                                                            AR991602
     C           *IN84     IFEQ *ON                                                         AR991602
     C           KEY006    CHAINHISACTF              84                                     AR991602
     C                     ENDIF                                                            AR991602
     C                     ENDIF                                                            AR991602
      *                                                                   158138
     C***********          Z-ADDFADRAM    WDRAM                    156585 184748
     C***********          Z-ADDFAUNDR    WUNDR                    156585 184748
     C***********          READ FACHISAF                 84         156585158138
     C***********          READPHISACTF                  84         156585158138
      *                                                                                       171451
     C                     MOVE FAFCTY    WKFCTY  50                                          171451
     C                     MOVE FACNUM    WKCNUM  6                                           171451
     C                     ENDIF                                                              171451
     C                     ENDIF                                          156585
     C                     MOVELHAACTN    WACTN                           156585
      ** If facility changed zeroise adjustments so that this record
      ** will be read next.
     C           HAACTN    IFEQ 'FI'
     C           HAACTN    OREQ 'FD'
     C           HAACTN    OREQ 'RC'
     C           HAACTN    OREQ 'FR'                                                          228881
     C/COPY WNCPYSRC,LEH00437
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDFAAFAM    @CFA                                                CLE023
     C                     ELSE                                                               CLE023
     C                     Z-ADDFACFAM    @CFA                            184748
     C                     ENDIF                                                              CLE023
     C                     Z-ADDFADRAM    @DA                             184748
     C                     Z-ADDFAUNDR    @UA                             184748
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADDFAOFFS    @OA                                                 CLE025
     C                     Z-ADD*ZEROS    @OADJ                                               CLE025
     C                     ENDIF                                                              CLE025
     C                     Z-ADD0         @FADJ
     C                     Z-ADD0         @UADJ
     C                     Z-ADD0         @DADJ
     C                     END
      *
     C           DEXIT     ENDSR
     C****************************************************************
     C/TITLE SR/FACTAC
     C****************************************************************
      *
      *  FACTAC - SUBROUTINE TO PROCESS FACILITIES HISTORY ACTION
      *          RECORD
      *
      *  CALLED FROM: MAIN PROCESSING
      *
      *  CALLS: NOTHING
      *
     C********************************************************************
      *
     C           FACTAC    BEGSR
      ** Reset stored values
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDFAAFAM    @CFA                                                CLE023
     C                     Z-ADDWAFAM     FAAFAM                                              CLE023
     C                     ELSE                                                               CLE023
     C                     Z-ADDFACFAM    @CFA
     C                     ENDIF                                                              CLE023
     C                     Z-ADDFADRAM    @DA
     C                     Z-ADDFAUNDR    @UA
     C                     Z-ADDWCFAM     FACFAM                          185781
     C                     Z-ADDWDRAM     FADRAM                          185781
     C                     Z-ADDWUNDR     FAUNDR                          185781
      *                                                                                       240436
      ** If the facility is a credit agreement and the revolving credit                       240436
      ** indicator is 'T', use the tranche's revolving credit indicator                       240436
      *                                                                                       240436
     C           WTRCA     IFEQ 'CA'                                                          240436
     C           HARCIN    ANDEQ'T'                                                           240436
     C           HACNUM    ANDEQFACNUM                                                      MD037440
     C           HAFCTY    ANDEQFAFCTY                                                      MD037440
     C                     MOVE HATRRC    @RCI                                                240436
     C                     ENDIF                                                              240436
      *                                                                                       240436
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADDFAOFFS    @OA                                                 CLE025
     C                     Z-ADDWOFFS     FAOFFS                                              CLE025
     C                     ENDIF                                                              CLE025
     C           CLE005    IFNE 'Y'                                       144712
     C                     MOVE FARCIN    @RCI
     C                     ENDIF                                          144712
      *                                                                                       246029
     C           FAACTN    IFEQ 'RC'                                                          246029
     C                     MOVE FARCIN    RCISV                                               246029
     C                     ENDIF                                                              246029
      *                                                                                       204450
     C           RDATE     IFNE 0                                                             204450
     C           FACNUM    IFNE RCNUM                                                         204450
     C           FAFCTY    ORNE RFCLT                                                         204450
     C                     Z-ADD0         RDATE                                               204450
     C                     ENDIF                                                              204450
     C                     ENDIF                                                              204450
      *                                                                                       194943
     C           CLE014    IFEQ 'Y'                                                           194943
     C           FAACTN    ANDEQ'RC'                                                          194943
     C           WTRCA     ANDEQ'CA'                                                          194943
     C                     MOVE FARCIN    WRVCHG  1                                           194943
     C                     ENDIF                                                              194943
      *                                                                   BH3502
     C           WBKVLD    IFEQ 'Y'                                                         AR652989
     C                     Z-ADDFAFSEQ    @CSEQ                                             AR652989
     C                     Z-ADDFATSEQ    WTSEQ                                             AR652989
     C                     ELSE                                                             AR652989
     C                     ADD  1         @CSEQ                           BH3502
     C                     ADD  1         WTSEQ                                               200289
     C                     ENDIF                                                            AR652989
      *
     C                     Z-ADDFAAAMT    @AMT
      *                                                                                       203070
      ** Initialise WNSYN field to blank so that previous value will                          203070
      ** not be carried for update of participant facility.                                   203070
      *                                                                                       203070
     C                     MOVE *BLANK    WNSYN                                               203070
     C                     MOVE *BLANK    WRCSI                                               203070
      *                                                                   128980
      ** Exclude actions with participant facilities when the facilty     128980
      ** being processed is a Credit agreement or a Tranche               128980
      *                                                                   128980
     C           WPRTR     IFNE 'P'                                       128980
     C           WPRTR     ANDNE'I'                                       128980
     C           WPRTR     ANDNE'R'                                                           CLE106
     C           WPRTR     ANDNE'S'                                                           CLE106
      *                                                                   128980
     C***********WTRCA     IFEQ 'CA'                               128980 147488
     C***********WTRCA     OREQ 'TR'                               128980 147488
      *                                                                   222461
      * Initialise GASS and RCSI in case loans already dropped            222461
     C                     MOVE *BLANKS   GASS                            222461
     C                     MOVE *BLANKS   RCSI                            222461
      *                                                                   222461
     C**********           Z-ADDFALOAN    WLNRF   60                                   128980 CLE148
     C                     MOVELFALOAN    WLNRF                                               CLE148
     C           WCLON     CHAINCLOANLB              12                   128980
      *                                                                                       203070
      ** If loan is not found from CLOANB, chain to MLOAN.                                    203070
      *                                                                                       203070
     C           *IN12     IFEQ '1'                                                           203070
     C           WLNRF     CHAINMLOAN                12                                       203070
     C                     ENDIF                                                              203070
      *                                                                                       203070
     C                     MOVE GASS      WNSYN                                               203070
     C                     MOVE RCSI      WRCSI                                               203070
      *                                                                                       203070
     C                     SELEC                                          128980
     C           LPFI      WHEQ 'P'                                       128980
     C           *IN12     ANDEQ'0'                                       128980
     C           LPFI      OREQ 'S'                                                           CLE106
     C           *IN12     ANDEQ'0'                                                           CLE106
     C           LPFI      OREQ 'R'                                                           CLE106
     C           *IN12     ANDEQ'0'                                                           CLE106
     C           LPFI      OREQ 'I'                                       128980
     C           *IN12     ANDEQ'0'                                       128980
     C                     Z-ADD0         @AMT                            128980
     C           *IN12     WHEQ '0'                                       128980
     C           WTRCA     IFEQ 'CA'                                      147488
     C           WTRCA     OREQ 'TR'                                      147488
     C                     MOVELBRCA      WBRCH   3                       128980
     C**********           Z-ADDXFCUS     WCSNO   60                                   128980 CSD027
     C                     MOVE XFCUS     WCSNO   6                                           CSD027
     C                     Z-ADDXFTYP     WFTYE   30                      128980
     C                     Z-ADDXFSEQ     WFSNO   20                      128980
      *                                                                   128980
     C           WFCTY     CHAINFCLTY1               12                   128980
     C           *IN12     IFEQ '1'                                       128980
     C           WFCTY     CHAINPEFCLFL1             12                   128980
     C                     ENDIF                                          128980
      *                                                                   128980
     C           *IN12     IFEQ '0'                                       128980
     C           TRCA      ANDEQ'TR'                                      128980
     C           PRTR      ANDEQ'P'                                       128980
     C           *IN12     OREQ '0'                                       128980
     C           TRCA      ANDEQ'TR'                                      128980
     C           PRTR      ANDEQ'I'                                       128980
     C           *IN12     OREQ '0'                                                           CLE106
     C           TRCA      ANDEQ'TR'                                                          CLE106
     C           PRTR      ANDEQ'R'                                                           CLE106
     C           *IN12     OREQ '0'                                                           CLE106
     C           TRCA      ANDEQ'TR'                                                          CLE106
     C           PRTR      ANDEQ'S'                                                           CLE106
     C                     Z-ADD0         @AMT                            128980
     C                     ENDIF                                          128980
      *                                                                   CLE014
      ** Revolving Credit of the Facility attached to the loan            CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           WTRCA     ANDEQ'CA'                                      CLE014
     C           FARCIN    ANDEQ'T'                                       CLE014
     C           WRVCHG    ANDEQ*BLANK                                                        194943
     C           WRVCHG    OREQ 'T'                                                           194943
      *                                                                                       246032
      ** If the action is backvalued, check whether the Facility was                          246032
      ** revolving or non-revolving on the date of the transaction.                           246032
      *                                                                                       246032
     C           KEY009    KLIST                           Key to                             246032
     C                     KFLD           KYBRCA           HISUPD1                            246032
     C                     KFLD           KYCNUM                                              246032
     C                     KFLD           KYFCTY                                              246032
     C                     KFLD           KYDATE                                              246032
      *                                                                                       246032
     C           KEY008    KLIST                           Key to                             246032
     C                     KFLD           KYBRCA           HISUPD1                            246032
     C                     KFLD           KYCNUM                                              246032
     C                     KFLD           KYFCTY                                              246032
      *                                                                                       246032
     C                     MOVELBRCA      KYBRCA  3                                           246032
     C**********           Z-ADDCNUM      KYCNUM  60                                   246032 CPK026
     C                     MOVE CNUM      KYCNUM                                              CPK026
     C                     MOVELFACT      ALFCTY  5                                           246032
     C                     MOVE FCNO      ALFCTY                                              246032
     C                     MOVELALFCTY    KYFCTY  50                                          246032
     C                     Z-ADDFADATE    KYDATE  50                                          246032
      *                                                                                       246032
     C           FADATE    IFLT BJRDNB                                                        246032
      *                                                                                     MD053826
      ** Check if there is an existing RC record in the action file.                        MD053826
      *                                                                                     MD053826
     C                     MOVE *BLANKS   INDRC   1                                         MD053826
     C           KEY009    SETGTHISACTL2                                                    MD053826
     C           KEY008    REDPEHISACTL2                 83                                 MD053826
     C           *IN83     DOWEQ'0'                                                         MD053826
     C           ACTN2     IFEQ 'RC'                                                        MD053826
     C                     MOVE 'Y'       INDRC                                             MD053826
     C                     SETON                     83                                     MD053826
     C                     ELSE                                                             MD053826
     C           KEY008    REDPEHISACTL2                 83                                 MD053826
     C                     ENDIF                                                            MD053826
     C                     ENDDO                                                            MD053826
      *                                                                                     MD053826
     C           KEY009    SETGTHISUPD1                                                       246032
     C           KEY008    REDPEHISUPD1                  99                                   246032
      *                                                                                     MD053826
     C           *IN99     IFEQ '0'                                                         MD053826
     C           *IN14     ANDEQ'1'                                                         MD053826
     C                     MOVE F2RCIN    WRCIN   1                                         MD053826
     C           INDRC     IFEQ 'Y'                                                         MD053826
     C           DATE2     ANDLEF2DATE                                                      MD053826
     C           DATE2     ANDLEFADATE                                                      MD053826
     C                     MOVE RCIN2     WRCIN                                             MD053826
     C                     ENDIF                                                            MD053826
     C                     ENDIF                                                            MD053826
      *                                                                                     MD053826
     C           *IN99     IFEQ '1'                                                           246032
     C                     MOVE RVCR      @RCI                                                246032
     C                     ELSE                                                               246032
     C           *IN14     IFEQ '1'                                                           246032
     C********** F2RCIN    IFNE 'T'                                                  246032 MD053826
     C**********           MOVE F2RCIN    @RCI                                       246032 MD053826
     C           WRCIN     IFNE 'T'                                                         MD053826
     C                     MOVE WRCIN     @RCI                                              MD053826
     C                     ELSE                                                               246032
     C                     MOVE RVCR      @RCI                                                246032
     C                     ENDIF                                                              246032
     C                     MOVE '0'       *IN14                                               246032
     C                     ENDIF                                                              246032
     C           *IN15     IFEQ '1'                                                           246032
     C           H2RCIN    IFNE 'T'                                                           246032
     C                     MOVE H2RCIN    @RCI                                                246032
     C                     ELSE                                                               246032
     C                     MOVE H2TRRC    @RCI                                                246032
     C                     ENDIF                                                              246032
     C                     MOVE '0'       *IN15                                               246032
     C                     ENDIF                                                              246032
     C                     ENDIF                                                              246032
     C                     ELSE                                                               246032
     C                     MOVE RVCR      @RCI                            CLE014
     C                     ENDIF                                                              246032
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ENDIF                                          147488
      *                                                                                       CLE023
      ** If CLE023 is installed and loan is already dropped from Loans                        CLE023
      ** file, check for FALPFI value to determine if it must affect                          CLE023
      ** calculation of prime facility.                                                       CLE023
      *                                                                                       CLE023
     C           *IN12     WHEQ '1'                                                           CLE023
     C           CLE023    ANDEQ'Y'                                                           CLE023
     C           FALPFI    ANDEQ'P'                                                           CLE023
     C           *IN12     OREQ '1'                                                           CLE106
     C           CLE023    ANDEQ'Y'                                                           CLE106
     C           FALPFI    ANDEQ'S'                                                           CLE106
     C           *IN12     OREQ '1'                                                           CLE106
     C           CLE023    ANDEQ'Y'                                                           CLE106
     C           FALPFI    ANDEQ'R'                                                           CLE106
     C           *IN12     OREQ '1'                                                           CLE023
     C           CLE023    ANDEQ'Y'                                                           CLE023
     C           FALPFI    ANDEQ'I'                                                           CLE023
     C                     Z-ADD0         @AMT                                                CLE023
      *                                                                                       CLE023
      ** If loan event is not attached to participant facility and                            CLE023
      ** is a parts sold, it must not affect recalculation of amounts.                        CLE023
      *                                                                                       CLE023
     C           *IN12     WHEQ '1'                                                           CLE023
     C           CLE023    ANDEQ'Y'                                                           CLE023
     C           FALPFI    ANDEQ*BLANKS                                                       CLE023
     C           FAPTYP    IFEQ 66                                                            CLE023
     C           FAPTYP    OREQ 67                                                            CLE023
     C           FAPTYP    OREQ 69                                                            CLE023
     C           FAPTYP    OREQ 72                                                            CLE023
     C                     Z-ADD0         @AMT                                                CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDSL                                          128980
     C***********          ENDIF                                   128980 147488
     C                     ENDIF                                          128980
      *                                                                   CLE005
      ** If SAR CLE005 is installed and FALOAN is *ZERO                   CLE005
      ** and FASQNO is not *ZERO                                          CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C********** FALOAN    ANDEQ*ZERO                                                  CLE005 CLE148
     C           FALOAN    ANDEQ*BLANKS                                                       CLE148
     C           FASQNO    ANDNE*ZERO                                     CLE005
     C           FASQNO    LOKUPSQN                      26               CLE005
      *                                                                   CLE005
     C           *IN26     IFEQ *ON                                       CLE005
      *                                                                                       204646
     C           TRCA      IFEQ 'CA'                                                        MD038236
     C                     Z-ADD1         J       30                                          204646
     C           J         DOWLE100                                                           204646
     C           FASQNO    IFEQ SQN,J                                                         204646
     C                     Z-ADD0         SQN,J                                               204646
     C                     LEAVE                                                              204646
     C                     ENDIF                                                              204646
     C                     ADD  1         J                                                   204646
     C                     ENDDO                                                              204646
     C                     ENDIF                                                            MD038236
      *                                                                                       204646
     C                     MOVE 'R'       FAREVI                          CLE005
      *                                                                   127728
     C           CLE005    IFEQ 'Y'                                       127728
     C                     Z-ADDBJRDNB    FAGNDT                          127728
     C                     MOVE *BLANK    FACFGI                          127728
     C                     ENDIF                                          127728
      *                                                                   CLE005
     C           FAACTN    IFEQ 'US'                                      CLE005
     C           FAACTN    OREQ 'UI'                                      CLE005
     C**********           SUB  FAAAMT    @DADJ                    CLE005 185781
     C**********           SUB  FAAAMT    FADRAM                          185781              204646
     C                     Z-ADDFADRAM    FADRAM                                              204646
     C**********           ADD  FAAAMT    @UADJ                    CLE005 185781
     C**********           ADD  FAAAMT    FAUNDR                          185781              204646
     C                     Z-ADDFAUNDR    FAUNDR                                              204646
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C           FAACTN    IFEQ 'UD'                                      CLE005
     C           FAACTN    OREQ 'UE'                                      CLE005
      *                                                                   CLE005
     C           @RCI      IFEQ 'Y'                                       CLE005
     C**********           SUB  FAAAMT    @UADJ                    CLE005 185781
     C**********           SUB  FAAAMT    FAUNDR                          185781              204646
     C                     Z-ADDFAUNDR    FAUNDR                                              204646
     C                     ELSE                                           CLE005
     C**********           ADD  FAAAMT    @FADJ                    CLE005 185781
     C**********           ADD  FAAAMT    FACFAM                          185781              204646
     C                     Z-ADDFACFAM    FACFAM                                              204646
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     ADD  FAAAMT    FAAFAM                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C**********           ADD  FAAAMT    @DADJ                    CLE005 185781
     C**********           ADD  FAAAMT    FADRAM                          185781              204646
     C                     Z-ADDFADRAM    FADRAM                                              204646
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     MOVE FARCIN    @RCI                                                204647
      *                                                                                       204647
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C           FADEAL    IFNE *ZEROS                                                        CLE025
      *                                                                                       CLE025
      ** Check if Dealing deal number exists in the reversed deals array                      CLE025
      *                                                                                       CLE025
     C           FADEAL    LOKUPVDL                      80                                   CLE025
     C           *IN80     IFEQ *ON                                                           CLE025
     C                     MOVE 'R'       FAREVI                                              CLE025
     C                     Z-ADDBJRDNB    FAGNDT                                              CLE025
     C                     MOVE *BLANKS   FACFGI                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** Check if Dealing deal number exists in the reinstated deals array                    CLE025
      *                                                                                       CLE025
     C           FADEAL    LOKUPIDL                      80                                   CLE025
     C           *IN80     IFEQ *ON                                                           CLE025
     C                     MOVE *BLANKS   FAREVI                                              CLE025
     C                     Z-ADDBJRDNB    FAGNDT                                              CLE025
     C                     MOVE *BLANKS   FACFGI                                              CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *
      **  Check for reversal
     C********** FALOAN    IFNE 0                                                             CLE148
     C           FALOAN    IFNE *BLANKS                                                       CLE148
     C           FALOAN    LOKUPLN                       20
      *
     C           *IN20     IFEQ '1'
     C                     MOVE 'R'       FAREVI
      *                                                                   127728
     C           CLE005    IFEQ 'Y'                                       127728
     C                     Z-ADDBJRDNB    FAGNDT                          127728
     C                     MOVE *BLANK    FACFGI                          127728
     C                     ENDIF                                          127728
      *
     C********** FAACTN    IFEQ 'IC'                                                          203185
     C********** FAACTN    OREQ 'PI'                                                          203185
     C********** FAACTN    OREQ 'ST'                                                          203185
     C********** FAACTN    OREQ 'MC'                                                   194912 203185
     C**********           SUB  FAAAMT    @DADJ                           185781
     C**********           SUB  FAAAMT    FADRAM                                       185781 203185
     C**********           ADD  FAAAMT    @UADJ                           185781
     C**********           ADD  FAAAMT    FAUNDR                                       185781 203185
     C**********           ELSE                                                               203185
      **********                                                                              203185
     C********** FAACTN    IFEQ 'WO'                                                          203185
     C********** FAACTN    OREQ 'RE'                                                          203185
     C********** FAACTN    OREQ 'MT'                                                          203185
     C********** @RCI      IFEQ 'Y'                                                           203185
     C**********           SUB  FAAAMT    @UADJ                           185781
     C**********           SUB  FAAAMT    FAUNDR                                       185781 203185
     C**********           ELSE                                                               203185
     C********** FAGASS    IFNE 'A'                                                    156585 203185
     C**********           ADD  FAAAMT    @FADJ                           185781
     C**********           ADD  FAAAMT    FACFAM                                       185781 203185
     C**********           ELSE                                                        156585 203185
     C**********           SUB  FAAAMT    @UADJ                    156585 185781
     C**********           SUB  FAAAMT    FAUNDR                                       185781 203185
     C**********           ENDIF                                                       156585 203185
     C**********           END                                                                203185
      **********                                                                              203185
     C**********           ADD  FAAAMT    @DADJ                           185781
     C**********           ADD  FAAAMT    FADRAM                                       185781 203185
     C**********           END                                                                203185
     C**********           END                                                                203185
     C                     END
     C                     END
      *
      ** Adjust values
     C***********CLE005    IFEQ 'Y'                                154584 179594
     C***********FADATE    ANDGEWDATE                              154584 179594
     C********** FADATE    IFGE WDATE                              179594 185781
     C***********WCFAM     ANDNEFACFAM                              154584159050
     C***********CLE005    OREQ 'Y'                                 154584159050
     C***********FADATE    ANDGEWDATE                               154584159050
     C***********WDRAM     ANDNEFADRAM                              154584159050
     C***********CLE005    OREQ 'Y'                                 154584159050
     C***********FADATE    ANDGEWDATE                               154584159050
     C***********WRCI      ANDNEFARCIN                              154584159050
     C***********FAACTN    ANDNE'RC'                                154584159050
     C**********           Z-ADDWCFAM     FACFAM                   154584 185781
     C**********           Z-ADDWDRAM     FADRAM                   154584 185781
     C**********           Z-ADDWUNDR     FAUNDR                   154584 185781
     C***********WRCI      IFNE FARCIN                              154584159961
     C********** @RCI      IFNE FARCIN                                                 159961 246029
     C           RCISV     IFNE FARCIN                                                        246029
     C           FAACTN    ANDNE'RC'                                      154584
     C           WGNDT     ANDGT@DATE                                                       AR652989
     C***********          MOVE WRCI      FARCIN                    154584159961
     C**********           MOVE @RCI      FARCIN                                       159961 246029
     C                     MOVE RCISV     FARCIN                                              246029
     C                     MOVE 'Y'       WWRT                            154584
     C                     ENDIF                                          154584
     C                     SELEC                                          154584
     C           FAACTN    WHEQ 'FI'                                      154584
     C           FAREVI    ANDNE'R'                                       158138
     C                     ADD  @AMT      FACFAM                          154584
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     ADD  @AMT      FAAFAM                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     ADD  @AMT      FAUNDR                          154584
     C           FAACTN    WHEQ 'FD'                                      154584
     C           FAREVI    ANDNE'R'                                       158138
     C                     SUB  @AMT      FACFAM                          154584
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     SUB  @AMT      FAAFAM                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     SUB  @AMT      FAUNDR                          154584
     C           FAACTN    WHEQ 'WO'                                      154584
     C           FAREVI    ANDNE'R'                                       158138
     C           FAACTN    OREQ 'RE'                                      154584
     C           FAREVI    ANDNE'R'                                       158138
     C           FAACTN    OREQ 'PF'                                                        AR325915
     C           FAREVI    ANDNE'R'                                                         AR325915
     C           FAACTN    OREQ 'MT'                                      154584
     C           FAREVI    ANDNE'R'                                       158138
     C           CLE005    OREQ 'Y'                                                           195125
     C           FAACTN    ANDEQ'UE'                                                          195125
     C           FAREVI    ANDNE'R'                                                           195125
     C           CLE005    OREQ 'Y'                                                           195125
     C           FAACTN    ANDEQ'UD'                                                          195125
     C           FAREVI    ANDNE'R'                                                           195125
     C/COPY WNCPYSRC,LEH01348
      *
      ** The following codes were removed because it prevents the update                      203070
      ** of the amounts of the participant facility if parts sold                             203070
      *                                                                                       203070
     C********** CLE014    IFEQ 'Y'                                                    CLE014 203070
     C********** PTYP      ANDEQ66                                                     CLE014 203070
     C********** RCSI      ANDNE'Y'                                                    CLE014 203070
     C********** CLE014    OREQ 'Y'                                                    CLE014 203070
     C********** PTYP      ANDEQ67                                                     CLE014 203070
     C********** RCSI      ANDNE'Y'                                                    CLE014 203070
     C**********           GOTO NEXT                                                   CLE014 203070
     C**********           ENDIF                                                       CLE014 203070
      *                                                                   CLE014
     C           CLE004    IFEQ 'N'                                                           203070
     C           CLE004    OREQ 'Y'                                                           203070
     C           WNSYN     ANDNE'P'                                                           203070
     C           CLE004    OREQ 'Y'                                                           203070
     C           WNSYN     ANDEQ'P'                                                           203070
     C           PTYP      ANDNE66                                                            203070
     C           PTYP      ANDNE67                                                            203070
     C           PTYP      ANDNE69                                                            203070
     C           PTYP      ANDNE72                                                            203070
     C           FAACTN    OREQ 'UE'                                                          203070
     C********** FALOAN    ANDEQ*ZEROS                                                 203070 CLE148
     C           FALOAN    ANDEQ*BLANKS                                                       CLE148
     C           FAACTN    OREQ 'UD'                                                          203070
     C********** FALOAN    ANDEQ*ZEROS                                                 203070 CLE148
     C           FALOAN    ANDEQ*BLANKS                                                       CLE148
      *                                                                                       203070
     C                     MOVE 'N'       REACTF                                              204450
     C           FAACTN    IFEQ 'RE'                                                          204450
     C           @AMT      ANDLT0                                                             204450
     C           FADATE    ANDLERDATE                                                         204450
     C                     MOVE 'Y'       REACTF                                              204450
     C                     ENDIF                                                              204450
      *                                                                                       204450
     C/COPY WNCPYSRC,LEH01349
     C                     SUB  @AMT      FADRAM                          154584
     C/COPY WNCPYSRC,LEH01350
     C********** FARCIN    IFEQ 'Y'                                                    154584 246029
     C           @RCI      IFEQ 'Y'                                                           246029
     C           FAACTN    OREQ 'PF'                                                        AR325915
     C*********  FAACTN    OREQ 'RE'                                                 225591 AR325915
     C*********  FARIND    ANDEQ'R'                                                  225591 AR325915
     C*********  FARCIN    ANDNE'Y'                                                  225591 AR325915
     C/COPY WNCPYSRC,LEH01351
     C                     ADD  @AMT      FAUNDR                          154584
     C/COPY WNCPYSRC,LEH01352
     C                     ELSE                                           154584
     C           FAGASS    IFNE 'A'                                       156585
      *                                                                                       204450
     C           REACTF    IFEQ 'N'                                                           204450
     C/COPY WNCPYSRC,LEH01353
     C                     SUB  @AMT      FACFAM                          154584
     C/COPY WNCPYSRC,LEH01354
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C/COPY WNCPYSRC,LEH01355
     C                     SUB  @AMT      FAAFAM                                              CLE023
     C/COPY WNCPYSRC,LEH01356
     C                     ENDIF                                                              CLE023
     C                     ELSE                                                               204450
     C                     ADD  @AMT      FAUNDR                                              204450
     C                     MOVE 'N'       REACTF                                              204450
     C                     ENDIF                                                              204450
      *                                                                                       204450
     C                     ELSE                                           156585
     C                     ADD  @AMT      FAUNDR                          156585
     C                     ENDIF                                          156585
     C                     ENDIF                                          154584
     C                     ENDIF                                                              203070
      *                                                                                       203070
     C           FAACTN    WHEQ 'IC'                                      154584
     C           FAREVI    ANDNE'R'                                       156585
     C           FAACTN    OREQ 'PI'                                      154584
     C           FAREVI    ANDNE'R'                                       156585
     C           FAACTN    OREQ 'PT'                                                        AR325915
     C           FAREVI    ANDNE'R'                                                         AR325915
     C           FAACTN    OREQ 'ST'                                      154584
     C           FAREVI    ANDNE'R'                                       156585
     C           FAACTN    OREQ 'MC'                                                          194912
     C           FAREVI    ANDNE'R'                                                           194912
     C           CLE005    OREQ 'Y'                                                           195125
     C           FAACTN    ANDEQ'US'                                                          195125
     C           FAREVI    ANDNE'R'                                                           195125
     C           CLE005    OREQ 'Y'                                                           195125
     C           FAACTN    ANDEQ'UI'                                                          195125
     C           FAREVI    ANDNE'R'                                                           195125
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           FAACTN    ANDEQ'CH'                                                          CLE028
     C           FAREVI    ANDNE'R'                                                           CLE028
      *                                                                                       203070
     C           CLE004    IFEQ 'N'                                                           203070
     C           CLE004    OREQ 'Y'                                                           203070
     C           WNSYN     ANDNE'P'                                                           203070
     C           CLE004    OREQ 'Y'                                                           203070
     C           WNSYN     ANDEQ'P'                                                           203070
     C           PTYP      ANDNE66                                                            203070
     C           PTYP      ANDNE67                                                            203070
     C           PTYP      ANDNE69                                                            203070
     C           PTYP      ANDNE72                                                            203070
     C           FAACTN    OREQ 'US'                                                          203070
     C********** FALOAN    ANDEQ*ZEROS                                                 203070 CLE148
     C           FALOAN    ANDEQ*BLANKS                                                       CLE148
     C           FAACTN    OREQ 'UI'                                                          203070
     C********** FALOAN    ANDEQ*ZEROS                                                 203070 CLE148
     C           FALOAN    ANDEQ*BLANKS                                                       CLE148
      *                                                                                       203070
     C           LTYP1     IFNE 'X'                                                         AR571209
     C           LTYP1     ANDNE'Y'                                                         AR571209
     C           LTYP1     ANDNE'Z'                                                         AR571209
     C           LTYP1     OREQ 'Y'                                                         AR571209
     C           FAMU      ANDEQ'Y'                                                         AR571209
     C           LTYP1     OREQ 'Z'                                                         AR571209
     C           FAMU      ANDEQ'Y'                                                         AR571209
     C           FAACTN    ORNE 'ST'                                                        AR571209
     C           FAACTN    ANDNE'PI'                                                        AR806351
     C                     ADD  @AMT      FADRAM                          154584
      *                                                                                       193859
     C           FAACTN    IFNE 'MC'                                                          193859
     C                     SUB  @AMT      FAUNDR                          154584
     C                     ELSE                                                               193859
     C********** FARCIN    IFEQ 'N'                                                  193859 MD037440
     C           @RCI      IFEQ 'N'                                                         MD037440
     C           FAGASS    IFNE 'A'                                                           193859
     C                     ADD  @AMT      FACFAM                                              193859
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     ADD  @AMT      FAAFAM                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     ELSE                                                               193859
     C                     SUB  @AMT      FAUNDR                                              193859
     C                     ENDIF                                                              193859
      *                                                                                       193859
     C                     ELSE                                                               193859
     C                     SUB  @AMT      FAUNDR                                              193859
     C                     ENDIF                                                              193859
     C                     ENDIF                                                              193859
     C                     ENDIF                                                            AR571209
     C                     ENDIF                                                              203070
      *                                                                                       CLE023
      ** If CLE023 is installed, process rollover record. Rollover                            CLE023
      ** record must not affect the facility amount, only the Drawn                           CLE023
      ** and Undrawn amounts.  The sign of the rollover action                                CLE023
      ** determines if drawn and undrawn will be reduced or increased.                        CLE023
      *                                                                                       CLE023
     C           FAACTN    WHEQ 'RO'                                                          CLE023
     C           FAREVI    ANDNE'R'                                                           CLE023
     C           CLE023    ANDEQ'Y'                                                           CLE023
      *                                                                                       CLE023
     C           CLE004    IFEQ 'N'                                                           CLE023
     C           CLE004    OREQ 'Y'                                                           CLE023
     C           WNSYN     ANDNE'P'                                                           CLE023
     C           CLE004    OREQ 'Y'                                                           CLE023
     C           WNSYN     ANDEQ'P'                                                           CLE023
     C           PTYP      ANDNE66                                                            CLE023
     C           PTYP      ANDNE67                                                            CLE023
     C           PTYP      ANDNE69                                                            CLE023
     C           PTYP      ANDNE72                                                            CLE023
     C***********          SUB  @AMT      FADRAM                                       CLE023 247164
     C***********          ADD  @AMT      FAUNDR                                       CLE023 247164
     C                     ADD  @AMT      FADRAM                                              247164
     C                     SUB  @AMT      FAUNDR                                              247164
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C           FAACTN    WHEQ 'S1'                                                          CLE025
     C           FAREVI    ANDNE'R'                                                           CLE025
     C           FAACTN    OREQ 'I1'                                                          CLE025
     C           FAREVI    ANDNE'R'                                                           CLE025
     C           FAACTN    OREQ 'C1'                                                          CLE025
     C           FAREVI    ANDNE'R'                                                           CLE025
     C           FAACTN    OREQ 'MR'                                                         BUG3035
     C           FAREVI    ANDNE'R'                                                          BUG3035
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     ADD  @AMT      FADRAM                                              CLE025
     C                     SUB  @AMT      FAUNDR                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           FAACTN    WHEQ 'M1'                                                          CLE025
     C           FAREVI    ANDNE'R'                                                           CLE025
     C           FAACTN    OREQ 'D1'                                                          CLE025
     C           FAREVI    ANDNE'R'                                                           CLE025
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     SUB  @AMT      FADRAM                                              CLE025
     C********** FARCIN    IFEQ 'Y'                                                  CLE025 MD037440
     C           @RCI      IFEQ 'Y'                                                         MD037440
     C                     ADD  @AMT      FAUNDR                                              CLE025
     C                     ELSE                                                               CLE025
     C                     SUB  @AMT      FACFAM                                              CLE025
     C                     SUB  @AMT      FAAFAM                                              CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           FAACTN    WHEQ 'FX'                                                          CLE025
     C           FAREVI    ANDNE'R'                                                           CLE025
     C           FAACTN    OREQ 'F0'                                                          CLE025
     C           FAREVI    ANDNE'R'                                                           CLE025
     C           FAACTN    OREQ 'FW'                                                          CLE025
     C           FAREVI    ANDNE'R'                                                           CLE025
     C           FAACTN    OREQ 'FV'                                                          CLE025
     C           FAREVI    ANDNE'R'                                                           CLE025
     C           FAACTN    OREQ 'IR'                                                          CLE025
     C           FAREVI    ANDNE'R'                                                           CLE025
     C           FAACTN    OREQ 'IS'                                                          CLE025
     C           FAREVI    ANDNE'R'                                                           CLE025
     C           FAACTN    OREQ 'AS'                                                          CLE025
     C           FAREVI    ANDNE'R'                                                           CLE025
     C           FAACTN    OREQ 'AC'                                                          CLE025
     C           FAREVI    ANDNE'R'                                                           CLE025
     C           FAACTN    OREQ 'AR'                                                         BUG3035
     C           FAREVI    ANDNE'R'                                                          BUG3035
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C           FATTEO    IFGE *ZEROS                                                        CLE025
     C           FAPTEO    IFGE *ZEROS                                                        CLE025
     C                     ADD  @AMT      FADRAM                                              CLE025
     C                     ELSE                                                               CLE025
     C                     ADD  FAPTEO    FAOFFS                                              CLE025
     C                     ADD  FATTEO    FADRAM                                              CLE025
     C                     ENDIF                                                              CLE025
     C                     ELSE                                                               CLE025
     C           FAPTEO    IFLT *ZEROS                                                        CLE025
     C                     SUB  @AMT      FAOFFS                                              CLE025
     C                     ELSE                                                               CLE025
     C                     SUB  FAPTEO    FADRAM                                              CLE025
     C                     SUB  FATTEO    FAOFFS                                              CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                              CLE025
     C                     SUB  @AMT      FAUNDR                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           FAACTN    WHEQ 'FM'                                                          CLE025
     C           FAREVI    ANDNE'R'                                                           CLE025
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     ADD  @AMT      FADRAM                                              CLE025
     C                     SUB  @AMT      FAUNDR                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     ENDSL                                          154584
      *                                                                                       194943
     C           CLE014    IFEQ 'Y'                                                           194943
     C           WTRCA     ANDEQ'CA'                                                          194943
     C           WRVCHG    ANDEQ'T'                                                           194943
     C                     MOVE WRVCHG    FARCIN                                              194943
     C                     ENDIF                                                              194943
      *                                                                                       194943
     C**********           Z-ADDFACFAM    WCFAM                    154584 185781
     C**********           Z-ADDFADRAM    WDRAM                    154584 185781
     C**********           Z-ADDFAUNDR    WUNDR                    154584 185781
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDFAAFAM    @CFA                                                CLE023
     C                     ELSE                                                               CLE023
     C                     Z-ADDFACFAM    @CFA                            154584
     C                     ENDIF                                                              CLE023
     C                     Z-ADDFADRAM    @DA                             154584
     C                     Z-ADDFAUNDR    @UA                             154584
     C                     Z-ADD0         @FADJ                           154584
     C                     Z-ADD0         @DADJ                           154584
     C                     Z-ADD0         @UADJ                           154584
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADDFAOFFS    @OA                                                 CLE025
     C                     Z-ADD*ZEROS    @OADJ                                               CLE025
     C                     ENDIF                                                              CLE025
     C**********           ELSE                                    154584 185781
     C**********           ADD  @FADJ     FACFAM                          185781
     C**********           ADD  @DADJ     FADRAM                          185781
     C**********           ADD  @UADJ     FAUNDR                          185781
     C**********           ENDIF                                   154584 185781
     C********** FACFAM    IFLE 0                                         081634
     C**********           Z-ADD1         FACFAM                          081634
     C***********FACFAM    IFLT 0                                   081634159499
     C***********          SUB  FACFAM    FAUNDR                    158852159499
     C***********          Z-ADD0         FACFAM                    081634159499
     C***********          END                                            159499
      *                                                                   CLE014
     C           NEXT      TAG                                            CLE014
      *                                                                   CLE005
      ** Reinstate processing to zeroise facility amount if less than     179077
      ** 0, but condition on CLE005 not being installed.                  179077
      *                                                                   179077
     C           FACFAM    IFLT 0                                         179077
     C           CLE005    ANDNE'Y'                                       179077
     C           FACFAM    ORLT 0                                                             CLE023
     C           CLE023    ANDEQ'Y'                                                           CLE023
     C           FAAFAM    ORLE 0                                                            BUG5224
     C           CLE023    ANDEQ'Y'                                                          BUG5224
      *                                                                                       CLE023
      ** FAUNDR must reflect the actual undrawn amount when CLE023 is                         CLE023
      ** installed.  This is needed for recalculation of actual                               CLE023
      ** facility amount.                                                                     CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'N'                                                           CLE023
     C                     SUB  FACFAM    FAUNDR                          179077
     C                     ENDIF                                                              CLE023
     C                     Z-ADD0         FACFAM                          179077
     C                     ELSE                                                               CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C********** FACFAM    ANDGE*ZERO                                                 CLE023 BUG5224
     C           FACFAM    ANDGT*ZERO                                                        BUG5224
     C                     Z-ADDFAAFAM    FACFAM                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     END                                            179077
      *                                                                   179077
      ** If SAR CLE005 is installed                                       CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           FAACTN    IFEQ 'FR'                                      CLE005
     C                     Z-ADD@AMT      FACFAM                          CLE005
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADD@AMT      FAAFAM                                              CLE023
     C                     ENDIF                                                              CLE023
     C           @AMT      SUB  FADRAM    FAUNDR                          159212
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C           FAINOF    ANDEQ'Y'                                                           259872
     C                     ADD  FAOFFS    FAUNDR                                              CLE025
     C                     ENDIF                                                              CLE025
     C***********          Z-ADD*ZERO     FADRAM                    CLE005159212
     C***********          Z-ADD@AMT      FAUNDR                    CLE005159212
      *                                                                                       204450
      ** Note facility reactivation date                                                      204450
      *                                                                                       204450
     C                     Z-ADDFADATE    RDATE                                               204450
     C**********           Z-ADDFACNUM    RCNUM                                        204450 CSD027
     C                     MOVE FACNUM    RCNUM                                               CSD027
     C                     Z-ADDFAFCTY    RFCLT                                               204450
      *                                                                                       204450
     C                     ENDIF                                          CLE005
     C           FAACTN    IFEQ 'FE'                                      CLE005
     C           FAACTN    OREQ 'FC'                                      CLE005
     C***********          Z-ADD*ZERO     FADRAM                   CLE005 147509
     C***********          Z-ADDFAMT      FADRAM                   147509 153938
     C***********          Z-ADDOAM1      FADRAM                   153938 156993
     C***********          Z-ADD*ZERO     FAUNDR                   CLE005 127728
     C***********          Z-ADDFAMT      FAUNDR                   127728 147509
     C***********          Z-ADD*ZEROS    FAUNDR                   147509 156993
     C                     MOVE WRECI     FARECI                          127733
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
     C***********          MOVE FARCIN    WRCI                      154584159961
     C                     MOVE FARCIN    @RCI                            159961
      *                                                                   CLE005
     C                     UPDATFACHISAF
      *                                                                   158559
     C                     Z-ADDFACFAM    WCFAM                           158559
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDFAAFAM    WAFAM                                               CLE023
     C                     ENDIF                                                              CLE023
     C                     Z-ADDFADRAM    WDRAM                           158559
     C                     Z-ADDFAUNDR    WUNDR                           158559
      *                                                                                       203185
     C                     Z-ADDFACFAM    @CFA                                                203185
     C           CLE023    IFEQ 'Y'                                                           203185
     C                     Z-ADDFAAFAM    @CFA                                                203185
     C                     ENDIF                                                              203185
     C                     Z-ADDFADRAM    @DA                                                 203185
     C                     Z-ADDFAUNDR    @UA                                                 203185
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADDFAOFFS    WOFFS                                               CLE025
     C                     Z-ADDFAOFFS    @OA                                                 CLE025
     C                     ENDIF                                                              CLE025
     C           EEXIT     ENDSR
      ********************************************************************
      /TITLE SR/GLZADD                                                    154529
      *****************************************************************   154529
      *                                                               *   154529
      *  GLZADD - Adds an amount (ZZAMT) to the total (ZZTOTI,ZZTOTD) *   154529
      *                                                               *   154529
      *  Called by: Main Processing                                   *   154529
      *  Calls    :                                                   *   154529
      *  GLZSUM - Carries out the addition of the amounts             *   154529
      *                                                               *   154529
      *****************************************************************   154529
      *                                                                   154529
     C           GLZADD    BEGSR                                          154529
      *                                                                   154529
     C           ZZAMT     IFNE *ZERO                                     154529
      *                                                                   154529
      ** Split ZZAMT into integer and decimal fields                      154529
      *                                                                   154529
     C                     Z-ADDZZAMT     ZZAMTI 150                      154529
     C                     MOVE ZZAMT     ZZAMTD  30                      154529
      *                                                                   154529
      ** Both ZZAMTI and ZZAMTD contain a 'sign' zone now                 154529
      *                                                                   154529
     C                     EXSR GLZSUM                                    154529
     C                     ENDIF                                          154529
      *                                                                   154529
     C                     ENDSR                                          154529
      *                                                                   154529
      *****************************************************************   154529
      /TITLE SR/GLZSUM                                                    154529
      *****************************************************************   154529
      *                                                               *   154529
      *  GLZSUM - Carries out the addition of the amounts             *   154529
      *                                                               *   154529
      *  Called by: GLZADD                                            *   154529
      *  Calles   : None                                              *   154529
      *                                                               *   154529
      *****************************************************************   154529
      *                                                                   154529
     C           GLZSUM    BEGSR                                          154529
      *                                                                   154529
      ** Save values of indicators to be used in the program              154529
      *                                                                   154529
     C                     MOVE *IN91     WIN91   1                       154529
     C                     MOVE *IN92     WIN92   1                       154529
     C                     MOVE *IN93     WIN93   1                       154529
     C                     MOVE *IN94     WIN94   1                       154529
     C                     MOVE *IN95     WIN95   1                       154529
     C                     MOVE *IN96     WIN96   1                       154529
     C                     SETOF                     919293               154529
     C                     SETOF                     949599               154529
      *                                                                   154529
      ** Determine sign of ZZAMTI and ZZAMTD, 92 if neg                   154529
      *                                                                   154529
     C           ZZAMTI    COMP 0                      9293               154529
     C   93      ZZAMTD    COMP 0                      9293               154529
     C   93                GOTO ZZSEND                     ZERO BYPASS    154529
      *                                                                   154529
      ** Determine sign of ZZTOTI and ZZTOTD, 91 if neg                   154529
      *                                                                   154529
     C           ZZTOTI    COMP 0                      9193               154529
     C   93      ZZTOTD    COMP 0                      9193               154529
      *                                                                   154529
      ** If ZZTOTAL is zero, return ZZAMOUNT                              154529
      *                                                                   154529
     C   93                Z-ADDZZAMTI    ZZTOTI 150                      154529
     C   93                Z-ADDZZAMTD    ZZTOTD  30                      154529
     C   93                GOTO ZZSEND                     ZERO BYPASS    154529
      *                                                                   154529
      ** If signs differ, bypass overflow checks                          154529
      *                                                                   154529
     C   91N92                                                            154529
     CORN91 92             GOTO ZZOFPS                                    154529
     C*                                                                   154529
     C           ZZAMTD    ADD  ZZTOTD    ZZWK2   40                      154529
     C           ZZWK2     COMP 999                  93    '93' = CARRY   154529
     C  N93      ZZWK2     COMP -999                   93    INTO INTEGER.154529
     C*                                                                   154529
     C   93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE154529
     C      93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE154529
     C   93      ZZTOTI    ADD  ZZWK3     ZZWK3                           154529
     C  N93      ZZTOTI    ADD  ZZAMTI    ZZWK3                           154529
      *                                                                   154529
      ** If the modulus of ZZWK3 is lt mod. ZZTOTI then O/F has occured   154529
      *                                                                   154529
     C  N92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS. 154529
     C   92      ZZWK3     COMP ZZTOTI               99     NEGATIVE      154529
     C  N99                Z-ADDZZWK2     ZZTOTD                          154529
     C  N99                Z-ADDZZWK3     ZZTOTI                          154529
      *                                                                   154529
      ** If O/F zeroise ZZAMT, Ind '99' set and ZZTOT fields left intact  154529
      *                                                                   154529
     C   99                Z-ADD0         ZZAMT  153                      154529
     C                     GOTO ZZSEND                                    154529
      *                                                                   154529
      ** The 'signs' are different                                        154529
      *                                                                   154529
     C           ZZOFPS    TAG                                            154529
      *                                                                   154529
      ** If ZZAMT was negative, make it pos. to como with ZZTOT           154529
      *                                                                   154529
     C   92                Z-SUBZZAMTI    ZZAMTI 150                      154529
     C   92                Z-SUBZZAMTD    ZZAMTD  30                      154529
      *                                                                   154529
      ** If ZZTOT was negative, make it pos. to comp with ZZAMT.          154529
      *                                                                   154529
     C   91                Z-SUBZZTOTI    ZZTOTI                          154529
     C   91                Z-SUBZZTOTD    ZZTOTD                          154529
      *                                                                   154529
      ** Both ZZAMT and ZZTOT are now positive                            154529
      *                                                                   154529
     C           ZZTOTI    COMP ZZAMTI               93  95               154529
     C   95      ZZTOTD    COMP ZZAMTD               93  95               154529
      *                                                                   154529
      ** If ZZTOT eq. ZZAMT return ZERO.                                  154529
      *                                                                   154529
     C   95                Z-ADD0         ZZTOTI                          154529
     C   95                Z-ADD0         ZZTOTD                          154529
     C   95                GOTO ZZSEND                                    154529
      *                                                                   154529
      ** If ZZTOT gt. ZZAMT.                                              154529
      *                                                                   154529
     C   93      ZZAMTD    COMP ZZTOTD               94                   154529
     C   93 94   ZZTOTI    SUB  1         ZZTOTI                          154529
     C   93 94   ZZTOTD    ADD  1000      ZZWK2                           154529
     C   93      ZZTOTI    SUB  ZZAMTI    ZZTOTI                          154529
     C   93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD                          154529
     C   93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD                          154529
      *                                                                   154529
      ** If ZZAMT gt. ZZTOT.                                              154529
      *                                                                   154529
     C  N93      ZZTOTD    COMP ZZAMTD               94                   154529
     C  N93 94   ZZAMTI    SUB  1         ZZWK3  150                      154529
     C  N93 94   ZZAMTD    ADD  1000      ZZWK2                           154529
     C  N93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI                          154529
     C  N93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI                          154529
     C  N93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD                          154529
     C  N93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD                          154529
      *                                                                   154529
      ** Reverse sign of ZZTOT if larger I/P fields were negative         154529
      *                                                                   154529
     C                     SETOF                     94                   154529
     C   93 91                                                            154529
     CORN93 92             SETON                     94                   154529
     C   94                Z-SUBZZTOTI    ZZTOTI                          154529
     C   94                Z-SUBZZTOTD    ZZTOTD                          154529
      *                                                                   154529
      ** Restore sign of ZZAMTI & ZZAMTD if it was reversed               154529
      *                                                                   154529
     C   92                Z-SUBZZAMTI    ZZAMTI                          154529
     C   92                Z-SUBZZAMTD    ZZAMTD                          154529
     C           ZZSEND    TAG                                            154529
      *                                                                   154529
      **   If ZZTOTD is zero, and ZZTOTI is neg. set up ZZNEGD.           154529
      *                                                                   154529
     C                     SETOF                     96                   154529
     C           ZZTOTD    COMP 0                        91               154529
     C   91      ZZTOTI    COMP 0                      96                 154529
     C   96                MOVE '.000-'   ZZNEGD  5                       154529
      *                                                                   154529
      ** Restore previous indicator values                                154529
      *                                                                   154529
     C                     MOVE WIN91     *IN91                           154529
     C                     MOVE WIN92     *IN92                           154529
     C                     MOVE WIN93     *IN93                           154529
     C                     MOVE WIN94     *IN94                           154529
     C                     MOVE WIN95     *IN95                           154529
     C                     MOVE WIN96     *IN96                           154529
      *                                                                   154529
     C                     ENDSR                                          154529
      *****************************************************************   154529
     C/TITLE SR/OPNFIL
      ********************************************************************
      ************                                                        0026
      ***OPNFIL*-*SUBROUTINE TO OPEN PRINTER FILE IF NOT ALREADY          0026
      ************OPENED (e.g., database error or successfully reconciled 0026
      ************message on audit report)                                0026
      ************                                                        0026
      ***CALLED*FROM:  MAIN PROCESSING                                    0026
      ***********                                                         0026
      ***CALLS:*ZSFILE                                                    0026
      ***********                                                         0026
     C********************************************************************0026
      ***********                                                         0026
     C***********OPNFIL    BEGSR                                          0026
      ***********                                                         0026
      ***Open*audit*spool*file                                            0026
     C***********          OPEN LER032AU                                  0026
      ***********                                                         0026
      ***Ensure*report*spool*file*recorded*by*RCF                         0026
     C**********           Z-ADDSFNUMU    ZSNUMU  60                      0026
     C**********           OUT  LDA                                  0021 0026
     C**********           CALL 'ZSFILE'                                  0026
     C**********           PARM           SEQ                             0026
     C**********           PARM *BLANKS   SENTY   3                       0026
     C**********           PARM           SFILEU                          0026
     C**********           PARM           ZSNUMU                          0026
     C**********           PARM           ZSERR                           0026
      **********                                                          0026
     C************LOCK     IN   LDA                                  0021 0026
      ***********                                                         0026
     C***********ZSERR     IFEQ 'Y'                                       0026
      ***Error*during*ZSFILE*processing,*return*to*calling*program****    0026
     C***********          SETON                     U7U8LR               0026
     C***********          RETRN                                          0026
     C***********          END                                            0026
      ***********                                                         0026
     C***********          ENDSR                                          0026
      *****************************************************************
     C/TITLE SR/*PSSR
      *****************************************************************
      *
      *  *PSSR - SUBROUTINE TO HANDLE ERROR CONDITIONS
      *
      *  CALLED FROM:  ANY ERROR SITUATION
      *
      *  CALLS: NOTHING
      *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
     C           WRUN      IFEQ *BLANKS
     C                     MOVE 'Y'       WRUN    1
     C                     SETON                     U7U8                 S01117
     C                     DUMP
      ** Reset page number for audit report print.                        0026
     C                     Z-ADD0         PAGE                            0026
      ** Write error report details                                       S01117
     C                     WRITELER032A1
     C                     WRITEERROR
     C                     END
      *
      **  IF *PSSR already run, then just end the program here.           S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     ENDSR
      **
     C********************************************************************
     C*                                                                   S01408
     C/COPY WNCPYSRC,LER032CCPG                                           S01408
     C*                                                                   S01408
      * Changed WFIND narrative from 'PARTICIPANT' to 'FUND. PART'                            CLE106
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**  WFIND  **  Facility types
PRIME
INT. PART.
FUND. PART.                                                                                   CLE106
RISK PART.                                                                                    CLE106
SUB PART.                                                                                     CLE106
