     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Fees activity enquiry')                       *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Customer Lending Module
     F*                                                               *
     F*  LER115 - Fees Activity Enquiry                               *
     F*                                                               *
     F*  Function:  This program displays details of live and         *
     F*             historical fees associated with a loan            *
     F*             or facility through a linked enquiry from         *
     F*             either the facility or loan details screens.      *
     F*                                                               *
     F*  (I/C)                                                        *
     F*                                                               *
     F*  Called By: LE0170 - Facility Details Enquiry  or             *
     F*           : LE0190 - Loan Details Enquiry                     *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amedn No. MD043383           Date 30Mar17               *
      *  Last Amend No. MD045010           Date 05Apr17               *
      *  Prev Amend No. CGL184             Date 07Dec16               *
      *                 CLE154             Date 06Aug12               *
      *                 CLE141A            Date 28Apr16               *
      *                 CLE141             Date 08Feb16               *
      *                 MD022974           Date 26Apr16               *
      *                 MD024550           Date 13Jan15               *
      *                 MD034270           Date 13May15               *
      *                 MD031852           Date 28Jan15               *
      *                 MD030669           Date 10Oct14               *
      *                 MD027397           Date 19Aug14               *
      *                 MD028091           Date 03Jul14               *
      *                 AR550590           Date 19May14               *
      *                 MD024830           Date 20Mar14               *
      *                 MD022296           Date 10Sep12               *
      *                 263725             Date 12Jun13               *
      *                 AR1090331          Date 17May13               *
      *                 AR1020182          Date 28Dec12               *
      *                 AR690561           Date 21Dec12               *
      *                 AR588683           Date 21Dec12               *
      *                 AR753180           Date 21Dec12               *
      *                 AR996895           Date 25Nov12               *
      *                 AR634880           Date 03Oct12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CLE139             Date 06Dec10               *
      *                 AR750553           Date 29Apr11               *
      *                 AR738760           Date 01Apr11               *
      *                 AR740100           Date 31Mar11               *
      *                 CLE073             Date 12May08               *
      *                 244381             Date 28Oct08               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG23523           Date 20Mar09               *
      *                 BUG23230           Date 16Mar09               *
      *                 BUG23121A          Date 05Mar09               *
      *                 BUG23121           Date 27Feb09               *
      *                 BUG22790           Date 17Feb09               *
      *                 BUG22702           Date 06Feb09               *
      *                 BUG22343           Date 28Jan09               *
      *                 BUG21935           Date 26Jan09               *
      *                 BUG22313           Date 20Jan09               *
      *                 BUG21831           Date 22Dec08               *
      *                 BUG21892           Date 11Dec08               *
      *                 BUG21857           Date 03Dec08               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 250989             Date 23Oct07               *
      *                 CAS016             Date 28Feb06               *
      *                 247644B            Date 22Jun07               *
      *                 243496B            Date 12Apr07               *
      *                 246141             Date 26Mar07               *
      *                 246344             Date 12Mar07               *
      *                 245803             Date 20Feb07               *
      *                 245329             Date 29Jan07               *
      *                 245012             Date 12Jan07               *
      *                 243496A            Date 22Dec06               *
      *                 243496             Date 24Nov06               *
      *                 164847             Date 30Nov06               *
      *                 243497             Date 22Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 BUG12876           Date 12Dec06               *
      *                 242286             Date 26Sep06               *
      *                 239961             Date 19Jun06               *
      *                 212048             Date 06Jun06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027A            Date 10May06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 BUG8762            Date 01Oct05               *
      *                 CLE106             Date 17Mar05               *
      *                 CLE038             Date 11May04               *
      *                 CSW037A            Date 02May05               *
      *                 CIR013             Date 25Apr05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 222373             Date 27Oct03               *
      *                 CLE034             Date 05May03               *
      *                 CLE031             Date 03Feb03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 204543             Date 06Jan03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 207629             Date 12Aug02               *
      *                 204452             Date 02May02               *
      *                 204320             Date 02May02               *
      *                 204409             Date 02May02               *
      *                 203765             Date 02May02               *
      *                 204653             Date 26Apr02               *
      *                 204302             Date 25Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 200289             Date 19Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 187268             Date 26Jun01               *
      *                 CLE014             Date 20Mar01               *
      *                 181729             Date 03May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 186841             Date 24Jan01               *
      *                 CLE013             Date 11Dec00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 176783             Date 18Jul00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CLE009             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 157894             Date 13Apr99               *
      *                 157532             Date 08Apr99               *
      *                 156367             Date 18Mar99               *
      *                 156886             Date 17Mar99               *
      *                 156225             Date 04Mar99               *
      *                 154104             Date 25Feb99               *
      *                 155677             Date 25Feb99               *
      *                 154111             Date 24Feb99               *
      *                 153736             Date 24Feb99               *
      *                 153664             Date 17Feb99               *
      *                 146237             Date 24Feb99               *
      *                 144092             Date 24Feb99               *
      *                 141453             Date 17Feb99               *
     F*                 113362             DATE 16FEB98               *
     F*                 112462             DATE 02FEB98               *
     F*                 084833             DATE 29OCT97               *
     F*                 105265             Date 28Aug97               *
     F*                 CLE005             Date 22May97               *
     F*                 PCA031             Date 13Oct97               *
     F*                 106111             Date 24Mar97               *
     F*                 100515             Date 22May96               *
     F*                 090266             DATE 12JUL95               *
     F*                 S01408             DATE 26JUN95               *
     F*                 052814             DATE 26APR93               *
     F*                 052153             DATE 26APR93               *
     F*                 052125             DATE 26APR93               *
     F*                 BH3530             DATE 17SEP92               *
     F*                 BH3527             DATE 14SEP92               *
     F*                 BH3521             DATE 09SEP92               *
     F*                 BH3514             DATE 07SEP92               *
     F*                 BH3414             DATE 02SEP92               *
     F*                 BH3424             DATE 11AUG92               *
     F*                 BH3467             DATE 10AUG92               *
     F*                 BH3414             DATE 22JUL92               *
     F*                 BH3431             DATE 21JUL92               *
     F*                 BH3378             DATE 21JUL92               *
     F*                 CB0087             DATE 15MAY92               *
     F*                 MOF60              DATE 21FEB92               *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD043383 - Display only the fee maturity for matured fee.    *
      *  MD045010 - Component LEC06A 10008 looping during COB caused  *
      *             by CGL184. Recompile due to changes in ZFRQB3.    *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  CLE154 - Loan Repayment Schedule Enhancement (Recompile)     *
      *  CLE141A - CLE141 Change Control 1                            *
      *  CLE141 - Currency and Location Business Day Convention       *
      *           for LE Transactions                                 *
      *  MD022974 - Accrued Calculated Facility Fee is incorrect on   *
      *             fee summary screen after successful fee adjstment *
      *             transaction.                                      *
      *           - Applied for MD036766                              *
      *  MD024550 - Matured and settled Flat Fee is still displayed   *
      *             in Total Accrued to date field                    *
      *  MD034270 - The total accrued to date is incorrect after fee  *
      *             settlement.                                       *
      *  MD031852 - The outstanding amount is not correct for calcu-  *
      *             lation type 90 when its next repayment date is in *
      *             the past.                                         *
      *  MD030669 - Reverse some part of MD027397 to make sure that   *
      *             only average fees will have zero accrual.         *
      *  MD027397 - 'Total accrued to date' for average type fees     *
      *             with FEPYON = N should be 0 since accruals are    *
      *             only processed during payment date.               *
      *  MD028091 -  Fee total accrued today shows unexpected amount  *
      *              (Recompile)                                      *
      *  AR550590 - Incorrect O/S fee amount after fee adjustment.    *
      *             Compute WFEE correctly when there is a live fee   *
      *             adjustment for a fee account whose calculation    *
      *             type is based on actual amount. Apply fix 255032. *
      *           - Applied for MD-26796                              *
      *  MD024830 - Calculation of fee accrual during IC on day 1     *
      *             is incorrect                                      *
      *           - Applied for MD-24955                              *
      *  MD022296 - Make sure to use the correct amount in calculation*
      *             of total accrued interest.                        *
      *  263725 - Wrong details shown when enquiring matured fees     *
      *           with 00 sequence number. Ensure that no details     *
      *           will be shown for matured fees with 00 seq. no.     *
      *  AR1090331 - Reversed fee still shows value on some screen    *
      *              fields.  Initialise the fields to blanks to if   *
      *              FERECI is '*' or 'R'. (Child: AR1090333)         *
      *  AR1020182 - Commitment fee accrues twice after payment.      *
      *              Reinstate reversed codes of fix BUG22702 and     *
      *              initialise WAMT to show correct outstanding fee  *
      *              amount and total accrued to date, respectively.  *
      *              (Child: AR1020183)                               *
      *  AR690561 - Negative amount does not reflect in fee details   *
      *             from Facility Fees Activity Screen. Remove part   *
      *             of fix AR588683 , 250989 and CLE134 where ZOUT20  *
      *             is used instead of ZOUT21 to output negative      *
      *             amount. (Child: AR692196)                         *
      *  AR588683 - 'Amount Due/Past Due' is incorrectly displayed    *
      *             when it is already in millions. Use field ZOUT20  *
      *             instead of ZOUT25 to move the amount to SFOAMT.   *
      *             (Child: AR588684)                                 *
      *  AR753180 - Duplicate fee history records displayed for       *
      *             matured fees. Only write records read from LEFHST *
      *             if HILCHD > HIHDAT. Applied fix 243469.           *
      *             (Child: AR753181)                                 *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  AR634880 - Unclear amounts appear on O/S Fee Amount and Total*
      *             Accrued to Date when fee is enquired on payment   *
      *             date. Redefine WTOT to 15,0. (Child: AR634881)    *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CLE148 - Alpha Loan Reference                                *
      *  CLE139 - Lending Fee Capitalisation                          *
      *  AR750553 - Wrong total accrued to date for calc 98           *
      *             (Child:AR750554)                                  *
      *  AR738760 - Incorrect O/S fee amount when fee                 *
      *             is backvalued (Child:AR738761)                    *
      *  AR740100 - Accrued interest already reflected(Child:AR740101)*
      *  CLE073 - Calculated Loan Based Fees                          *
      *  244381 - Amend to show the correct value when CAS009 on.     *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  BUG23523  - Reverse fix 21831                                *
      *  BUG23230  - "Fee Details Enquiry" showing incorrect figure   *
      *              in "Amount Due/Past Due" field Calc. type 21     *
      *  BUG23121A - Fees Details Enquiry is showing Incorrect fee    *
      *              details                                          *
      *  BUG23121 - Fees Details Enquiry is showing Incorrect fee     *
      *             details                                           *
      *  BUG22790 - Fee Amount Due/Past due showning wrong amount,    *
      *             hence unable to settle fee. Revert part of fix    *
      *             243496B                                           *
      *  BUG22702 - Incorrect Accrued to date value for Fee           *
      *             Calculation type-06                               *
      *  BUG22343 - Facility Fee Details Calcaulation Type 22 is not  *
      *             correctly coming                                  *
      *  BUG21935 - Increase WRK155 decimal places to 9 for computing *
      *             Fees using calculation type '12'                  *
      *  BUG22313 - Fees should not display Total Amount Accrued when *
      *             Fee period has not started yet                    *
      *  BUG21831 - For Calculated Fees, do not use the Facility      *
      *             Amount when computing the Outstanding Fee Amount  *
      *             and Total Accrued to date                         *
      *  BUG21892 - Fee Details Enquiry showing incorrect calculation *
      *  BUG21857 - Facility fees not calculated correctly            *
      *  250989 - Missing comma for all numeric fields.               *
      *  CAS016 - IAS18 EIR Recalculation (Fee Amortisation Over      *
      *           Whole Period)                                       *
      *  247644B - Incorrect Total Accrued to Date amount calculated  *
      *            for fees.  Accrual on Rundate is included even if  *
      *            the system is not on last day accrual.  Applied    *
      *            part of fix 247862.                                *
      *  243496B- Use current facility amount based on average/actual *
      *           amount type for fees using percentage indicator.    *
      *           Reinstated fixes 243496 and 243496A.                *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  246344 - Retain original sign of settlement amount in fee    *
      *           details screen enquiry                              *
      *  245803 - Reverse fixes 243496 and 243496A.                   *
      *  245329 - Fees being paid should show negative on enquiry.    *
      *           The sign on the far right side of the amount is     *
      *           removed to avoid confusion. The sign is made part   *
      *           of the amount on the enquiry list screen.           *
      *  245012 - Enquiry screen not consistent (Apply GEMS 220264)   *
      *           Ensure that a facility fee can still be enquired a  *
      *           day after its maturity.                             *
      *  243496A- FELPAM should be used only if FEINDC=Y or           *
      *           CLE005=*OFF when calculating total accrued to date. *
      *           Reverse fix 239961 and reinstate fix 204653.        *
      *  243496 - Use the Fee Adjustment Amount FEAMTA from PF/LEFEAM *
      *           Applied 216123 (plus re-open & 221326 correction).  *
      *         - Also apply work field fix WFLD15 to calls of ZFRPED *
      *           as in 204302 - to retain sign of original ZFLD15.   *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  243497 - Show past due date under the Settled/Due Date column*
      *           if there is a past due amount. Show the settlement  *
      *           date if there is a settlement amount and no past due*
      *           amount exists. If there are no amounts for          *
      *           settlement and past due, show the next payment date.*
      *           Applied fix 176526.                                 *
      * BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE   *
      * BUG12876 -2nd Issue.                                          *
      *           Fee Indicator should not be displayed if CLE006 is  *
      *           switched off.  Applied fix 234543.                  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  239961 - Completely remove the core fix 204653. It causes the*
      *           incorrect facility fee amount. Applied fix 230258.  *
      *  212048 - If calc method 6 then INT6DY contains the number    *
      *           of days from ZINTDY.                                *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A - Conversion Of Customer Number to Alpha             *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  BUG8762 - Amending Fee Rate has caused recalculation of fee  *
      *            accrual. Align computation of total accrued to date*
      *            to processing in LER135. Applied fix 233208.       *
      *  CLE106 - Syndication Manager                                 *
      *  CLE038 - Lending Enhancement for Nordea: Allocation by Amount*
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over ZINTDY.                              *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  222373 - Parameter mismatch.                                 *
      *  CLE034 - Lending Enhancements Phase 1 Priority 1A            *
      *  CLE031 - Lending Enhancements.                               *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enahancements to CAS001, CAS002 and CAS004          *
      *           (Recompile)                                         *
      *  204543 - Wrong number of decimal places is used to display   *
      *           the fee amount.                                     *
      *  207629 - Check System Value LoanCustOriginPurch to decide if *
      *           original borrower should be shown as the customer of*
      *           a Part Purchased, instead of 'Purchased From' num.  *
      *  204452 - Add the previous fee amount written off to the total*
      *           write off inserted today for the fee period.        *
      *  204320 - Incorrect total accrued to date and O/S fee amount  *
      *           for newly inserted fees based on actual amounts when*
      *           there is a movement for the facility in PF/FACHISA  *
      *  204409 - Write-off amount not reflected in Fee Details Enqy. *
      *           Fee amount written off was blanked out after insert *
      *           of a partial settlement for the fee.                *
      *           Add processing of settled amount when there is a    *
      *           write off transaction for the fee.                  *
      *  203765 - Multiple settelements can be made on a fee.  Read   *
      *           all records in LEFEEAD to have a correct amount.    *
      *  204653 - Open accruals in I/C differs by 0.01 compared to    *
      *           the total outstanding in LER135P2.                  *
      *  204302 - Negative fee accrued to date does not affect the    *
      *           outstanding fee amount.                             *
      *  200289 - Expand facility history sequence field (STFSEQ)     *
      *           from 2N to 3N.                                      *
      *  187268 - Matured participant facility's fees should also be  *
      *           shown on prime facility's fees summary.             *
      *  CLE014 - Customer Driven Lending Enhancements                *
      *  181729 - Fees attached to the participant facilities must be *
      *           displayed also when primary facility is enquired on *
      *           Facility Fees Activity screen.                      *
      *  186841 - The Fee Indicator of a matured fee is still 'R' and *
      *           not 'H'. Fix is to check if FERECI is 'M' so that   *
      *           'H' is moved to SFSTAT and SFPTFI is blanked out.   *
      *  CLE013 - Customer Lending Fees Enhancement - Phase 1         *
      *  176783 - The fee settlement currency is shown on the Fees    *
      *           Activity screen if it is not equal to *BLANKS. The  *
      *           fee currency is shown, otherwise.                   *
      *  CLE009 - LE I/C Swift Message Generation for Fees            *
      *           Recompiled due to changes in LEFEED                 *
      *  157894 - Incorrect amount retained by agent when fees        *
      *           involved are non-shared fees                        *
      *  157532 - Change the amount shown on the subfile from o/s amt *
      *           to past due amount.                                 *
      *  156367 - Rounding errors on total accrued to date field.     *
      *  156886 - Various problems in Fees Enquiry.                   *
      *  156225 - Enquiry on fee saves part of settlement onto        *
      *           next fee.                                           *
      *  154104 - Wrong outstanding amount.                           *
     F*  155677 - Don't include FEAMTP in calculation of SDTACR       *
     F*  154111 - Branch needed for fee settlement but does not show  *
     F*  153736 - Need to reset FASADJ after reading LEFEEAD before   *
     F*           processing next record.                             *
      *  153664 - Fees enquiry from facility details should also      *
      *           show payable.                                       *
     F*  146237 - SETGT functionality requires key to be double       *
     F*         - checked before being used.                          *
     F*  144092 - Accrued amount incorrect as is attempting to        *
     F*         - use Facility History file when no such entry exists *
      *  141453 - Recompiled due to changes in PF/LEFEED              *
     F*  113362 - Amount due on run date is shown as past due on fee  *
     F*           details enquiry screen. Condition 'Amount past due' *
     F*           text so it is displayed only when amount is actually*
     F*           past due - text conditioned on *IN17.               *
     F*  112462 - Recompile due to changes in LER115FM.               *
     F*  084833 - Adjust Total Accrued To Date field for adjustments/ *
     F*           settlements entered today.                          *
     F*  105265 - The total accrued amount for forward valued fees    *
     F*           should be zero or blank.                            *
     F*  CLE005 - Customer Lending Enhancements - Others (T3)         *
     F*  PCA031 - Profit Centre Accounting Development:               *
     F*         - Attach profit centre to lending fees.               *
     F*  106111 - Program loop endlessly if there was deleted but no  *
     F*           live Fee Adjustment record.                         *
     F*  100515 - Recompile program due to changes in LEFEED.         *
     F*  090266 - 1. If program error occurs, set return code (RTRNC) *
     F*              to 'E' before return.                            *
     F*           2. If called by LE0170, field ORED in file FCLTYFM  *
     F*              should be check in order to determine whether    *
     F*              file FACHISH should be retrieved.                *
     F*              ie. if ORED = system date, then do not retrieve  *
     F*                  file FACHISH.                                *
     F*           3. If called by LE0190, screen title displayed is   *
     F*              incorrect. Indicator 15 is set incorrectly by    *
     F*              program codes from BH3414.                       *
     F*  S01408 - Addition of core hook LER115CLDS                    *
     F*  052814 - Calculated fees based on actual balances are        *
     F*           incorrect on Mondays - they need to calculate       *
     F*           the amount from the last accrual date rather than   *
     F*           assuming that only one day needs to be added        *
     F*  052153 - Sequence number allocation causes problems on       *
     F*           the enquiry. This has been fixed in LER110 for      *
     F*           new fees being entered, but existing fees will      *
     F*           still be a problem                                  *
     F*  052125 - Total fees accrued should not include settled amount*
     F*  BH3530 - Flat fees show accrual amt before payment date      *
     F*  BH3527 - Divide by 0 error if fee started yesterday.         *
     F*  BH3521 - Settled amount not updated on detail screen.        *
     F*  BH3514 - Shouldn't calculate extra day if this is a payment  *
     F*           day as LER135 set up all the fields in the last COB.*
     F*  BH3414 - Accrued to date should be up to today.              *
     F*  BH3424 - Adjustments to calculated fees not treated correctly*
     F*  BH3467 - Fees only posting on accrual profit date and fee    *
     F*           payment date nowadays....                           *
     F*  BH3414 - Fee outstanding amount incorrectly set up           *
     F*  BH3341 - Fee status added to the inital screen               *
     F*  BH3378 - Changes to screen layout and information            *
     F*  CB0087 - Amount field on first screen not edited             *
     F*           correctly for decimal place positioning.            *
     F*  MOF60  - Customer Fees & Profitability Processing            *
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*****************************************************************
     FLEFHSTL1IF  E           K        DISK
     FLEFHSTL2IF  E           K        DISK                                                  BUG8762
     F            LEFHSTF                           KRENAMELEFHSTOM                          BUG8762
     FLEFEADL2IF  E           K        DISK
     FLEFEED  IF  E           K        DISK
     FFACHISH IF  E           K        DISK                               BH3414
     FFACHSAL1IF  E           K        DISK                               BH3414
     FSDCURRPDIF  E           K        DISK                               BH3414
     FFCLTYL1 IF  E           K        DISK                               090266
     F*LEFEEDL4IF***E*****      K        DISK                      153664 181729
     F**********  LEFEEDF                           KRENAMELEFEED4F153664 181729
     FLEFCLTLBIF  E           K        DISK                               181729
     F            FCLTYFMF                          KRENAMEFCLTYFPF       181729
     FLEFEEDL1IF  E           K        DISK                               181729
     F            LEFEEDF                           KRENAMELEFEED1F       181729
     F*LEFEAM**I***E           K        DISK                                           243496 245803
      **********                                                                       243496 245803
     FLEFEAM  IF  E           K        DISK                                                  243496B
      *                                                                                      243496B
     FCLOAN   IF  E           K        DISK                                                   207629
     F            CLOANHHF                          KIGNORE                                   207629
     F            CLOANCKF                          KIGNORE                                   207629
     F            CLOANZ1F                          KIGNORE                                   207629
      *                                                                                       CLE073
     FCLOANK  IF  E           K        DISK                                                   CLE073
     F            CLOANCKF                          KRENAMECLOANCKK                           CLE073
     FLEHISTLAIF  E           K        DISK                                                   CLE073
     FLEHISTLBIF  E           K        DISK                                                   CLE073
      *                                                                                       CLE073
     F*FCLTYL2**IF  E           K        DISK                                      BUG21831 BUG23523
      *
     F/COPY WNCPYSRC,LEH00637
     FLER115FMCF  E                    WORKSTN
     F                                        RRN   KSFILE SFLRCD
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*  10    - Read of Fees History File                            *
     F*  11    - Read of Fees Master File                             *
     F*  12    - Chain to Fees Settlement/Adjustment File             *
     F*  13    - Matching record found on Fees History File           *
     F*  14    - Matching record found on Fees Master File            *
     F*  15    - Loan or facility for screen output format            *
     F*  16    - Expanded details requested                           *
      *   24  - Execute SR/SRPRTC                                     *   181729
      *   26  - EOF indicator for LF/LEFCLTLB                         *   181729
     F*  30    - CLE005 is Present                                    *   CLE005
     F*  50    - SFLDSP keyword indicators                            *
     F*  51    - SFLDSPCTL keyword indicator                          *
     F*  52    - SFLEND keyword indicator                             *
     F*  53    - Net Fee keyword indicator                            *   153664
      *  78    - CLE034 is installed                                  *                       CLE034
     F*  80    - Analytical Accounting is installed                   *   PCA031
     F*                                                               *
     F*  90-99 - Used by Standard Subroutines                         *
     F*                                                               *
     F*  U7+U8 - Database Error                                       *
     F*                                                               *
     F*****************************************************************
     F/SPACE 3
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  INIT   - Program Initialisation                              *
     F*  PROCES - Detail Processing                                   *
     F*  SETTLE - Settlement Processing for calculated facility fees. *
     F*  DETLSR - Selection of detail records for display.            *
     F*  DETSCR - Display of expanded detail fee records.             *
      *  SRPRTC - Get participant/internal fee of prime fee           *   153664
      *           with shared indicator = 'Y'                         *   153664
      *  SRSIGN - Check what sign to be place on amount               *   153664
     F*  ZDATE2 - Converts a five figure day number into              *
     F*           date format.                                        *
     F*  ZFRPED - Format of amount field.                             *
      *  SROSAM - Calculate the outstanding amount for fees with      *   154104
      *           settlements/adjustments.                            *   154104
     F*  *PSSR  - Program exception error routine.                    *
     F*                                                               *
     F*****************************************************************
     E/EJECT
     E                    CPY@    1   1 80
     E                    POWER   1   7  7 3             POWER ARRAY      BH3414
     E                    TABCAL  6   6  1 0 TABCBS  5 0 CALC.BASES       BH3414
     E                    FEAM        5 11 0A            FEE AMOUNTS      BH3414
     E                    FAM         5 13 0A            FEE AMOUNTS      BH3414
     E                    FRT         5  7 5A            FEE RATES        BH3414
     E                    FPC         5  6 3A            FEE PERCENTAGE   BH3414
     E                    CURR      150  3               ALL CCYS         BH3414
     E                    CSPT      150 13 8             SPOT RATES/CCY   BH3414
     E                    MTDV      150  1               M/D INDICATOR/CCYBH3414
     E                    CCDP      150  1 0             DEC PLACES/CCY   BH3414
     E                    CCNO      150  2 0             SORT SEQ.NO/CCY  BH3414
     E                    @HAMT       5 11 0A            FEE AMOUNTS - HISTORY               BUG8762
     E                    @HRT        5  7 5A            FEE RATES - HISTORY                 BUG8762
     E                    @WAMT       5 11 0A            FEE AMOUNTS - WORK ARRAY            BUG8762
     E                    @WRT        5  7 5A            FEE RATES - WORK ARRAY              BUG8762
      *                                                                                       CLE073
     E                    ZFMD   12  12  2               FREQ SR.ARRAY                        CLE073
     E/COPY WNCPYSRC,LEH00638
     E/COPY ZSRSRC,ZHOLE                                                                      CLE073
      *                                                                                       CLE073
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZFRPEDZ1
     E/COPY ZSRSRC,ZDATE9Z1                                               CLE013
     E/SPACE 3
     IFACHISAF                                                            BH3521
     I              FARECI                          FWRECI                BH3521
      *                                                                                       207629
     ICLOANCLF                                                                                207629
      ** Rename fields                                                                        207629
     I              RECI                            RECIL                                     207629
     I              FTYP                            FTYPL                                     207629
     I              FSEQ                            FSEQL                                     207629
     I              AWBA                            AWBAL                                     207629
     I              AWBN                            AWBNL                                     207629
     I              BENA                            BENAL                                     207629
     I              BENN                            BENNL                                     207629
     I              BTB1                            BTB1L                                     207629
     I              BTB2                            B3B2L                                     207629
     I              BTB3                            BTB3L                                     207629
     I              BTB4                            BTB4L                                     207629
     I              BTB5                            BTB5L                                     207629
     I              BTB6                            BTB6L                                     207629
     I              DCHG                            DCHGL                                     207629
     I              DTP1                            DTP1L                                     207629
     I              DTP2                            DTP2L                                     207629
     I              DTP3                            DTP3L                                     207629
     I              DTP4                            DTP4L                                     207629
     I              FCCY                            FCCYL                                     207629
     I              PIBA                            PIBAL                                     207629
     I              PIBN                            PIBNL                                     207629
     I              POBN                            POBNL                                     207629
     I              POCN                            POCNL                                     207629
     I              PONS                            PONSL                                     207629
     I              PSTM                            PSTML                                     207629
     I              RCRA                            RCRAL                                     207629
     I              RCRN                            RCRNL                                     207629
     I              RIBA                            RIBAL                                     207629
     I              RIBN                            RIBNL                                     207629
     I              ROBN                            ROBNL                                     207629
     I              ROCN                            ROCNL                                     207629
     I              RONS                            RONSL                                     207629
     I              RSTM                            RSTML                                     207629
     I              RVNO                            RVNOL                                     207629
      *                                                                                       CLE073
      *                                                                                       CLE073
     ICLOANCKK                                                                                CLE073
      ** Rename fields                                                                        CLE073
     I              RECI                            RECIK                                     CLE073
     I              LNRF                            LNRFK                                     CLE073
     I              OPAM                            OPAMK                                     CLE073
     I              ABLC                            ABLCK                                     CLE073
      *                                                                                       CLE073
     IHISTSHPF                                                                                CLE073
      ** Rename fields                                                                        CLE073
     I              RECI                            RECIP                                     CLE073
     I              RCDT                            RCDTP                                     CLE073
     I              BRCA                            BRCAP                                     CLE073
     I              CNUM                            CNUMP                                     CLE073
     I              LNRF                            LNRFP                                     CLE073
     I              VDAT                            VDATP                                     CLE073
     I              PRSQ                            PRSQP                                     CLE073
     I              LASN                            LASNP                                     CLE073
     I              CCY                             CCYP                                      CLE073
     I              AMTP                            AMTPP                                     CLE073
     I              PRAM                            PRAMP                                     CLE073
     I              LCD                             LCDP                                      CLE073
     I              CPAM                            CPAMP                                     CLE073
      *                                                                                       CLE073
     IHISTSHMF                                                                                CLE073
      ** Rename fields                                                                        CLE073
     I              RECI                            RECIM                                     CLE073
     I              RCDT                            RCDTM                                     CLE073
     I              BRCA                            BRCAM                                     CLE073
     I              CNUM                            CNUMM                                     CLE073
     I              LNRF                            LNRFM                                     CLE073
     I              VDAT                            VDATM                                     CLE073
     I              PRSQ                            PRSQM                                     CLE073
     I              LASN                            LASNM                                     CLE073
     I              CCY                             CCYM                                      CLE073
     I              AMTP                            AMTPM                                     CLE073
     I              PRAM                            PRAMM                                     CLE073
     I              LCD                             LCDM                                      CLE073
     I              CPAM                            CPAMM                                     CLE073
      *                                                                                       CLE073
      *                                                                                       CLE073
      *                                                                   181729
     IFCLTYFPF                                                            181729
      ** Rename similar fields                                            181729
      *                                                                   181729
     I              RECI                            PRECI                 181729
     I              CNUM                            PCNUM                 181729
     I              FACT                            PFACT                 181729
     I              FCNO                            PFCNO                 181729
     I              BRCA                            PBRCA                 181729
     I              FCCY                            PFCCY                 181729
     I              FAMT                            PFAMT                 181729
     I              ORED                            PORED                 181729
     I              SYIN                            PSYIN                 181729
     I              PCRF                            SPCRF                 181729
     I              PRTR                            PPRTR                 181729
     I              PMFC                            PPMFC                 181729
     I              PMFT                            PPMFT                 181729
     I              PMFN                            PPMFN                 181729
     I              OSDB                            POSDB                 181729
     I              OMDB                            POMDB                 181729
     ILEFHSTOM                                                                               BUG8762
      ** Rename fields                                                                       BUG8762
     I              HIRECI                          OMRECI                                   BUG8762
     I              HIBRCA                          OMBRCA                                   BUG8762
     I              HICNUM                          OMCNUM                                   BUG8762
     I              HIFACL                          OMFACL                                   BUG8762
     I              HILNRF                          OMLNRF                                   BUG8762
     I              HIFSEQ                          OMFSEQ                                   BUG8762
     I              HIFCOD                          OMFCOD                                   BUG8762
     I              HIFCCY                          OMFCCY                                   BUG8762
     I              HIAMTS                          OMAMTS                                   BUG8762
     I              HIHDAT                          OMHDAT                                   BUG8762
     I              HILCHD                          OMLCHD                                   BUG8762
     I              HILCHT                          OMLCHT                                   BUG8762
     I              HIFRT1                          OMFRT1                                   BUG8762
     I              HIFRT2                          OMFRT2                                   BUG8762
     I              HIFRT3                          OMFRT3                                   BUG8762
     I              HIFRT4                          OMFRT4                                   BUG8762
     I              HIFRT5                          OMFRT5                                   BUG8762
     I              HIAMT1                          OMAMT1                                   BUG8762
     I              HIAMT2                          OMAMT2                                   BUG8762
     I              HIAMT3                          OMAMT3                                   BUG8762
     I              HIAMT4                          OMAMT4                                   BUG8762
     I              HIAMT5                          OMAMT5                                   BUG8762
      **********                                                                   BUG21831 BUG23523
     I*FCLTYL2F*                                                                   BUG21831 BUG23523
     I**********    RECI                            FNRECI                         BUG21831 BUG23523
     I**********    CNUM                            FNCNUM                         BUG21831 BUG23523
     I**********    FACT                            FNFACT                         BUG21831 BUG23523
     I**********    FCNO                            FNFCNO                         BUG21831 BUG23523
     I**********    BRCA                            FNBRCA                         BUG21831 BUG23523
     I**********    ORED                            FNORED                         BUG21831 BUG23523
     I**********    TNLU                            FNTNLU                         BUG21831 BUG23523
     I**********    CHTP                            FNCHTP                         BUG21831 BUG23523
      *                                                                   181729
     I/COPY WNCPYSRC,LER115I001
     I            DS                                                      BH3414
     I** Fee amounts data structure                                       BH3414
     I                                    P   1  300FEAM                  BH3414
     I                                    P   1   60FEAMT1                BH3414
     I                                    P   7  120FEAMT2                BH3414
     I                                    P  13  180FEAMT3                BH3414
     I                                    P  19  240FEAMT4                BH3414
     I                                    P  25  300FEAMT5                BH3414
     I*                                                                   BH3414
     I            DS                                                      BH3414
     I** Fee rates data structure                                         BH3414
     I                                    P   1  205FRT                   BH3414
     I                                    P   1   45FEFRT1                BH3414
     I                                    P   5   85FEFRT2                BH3414
     I                                    P   9  125FEFRT3                BH3414
     I                                    P  13  165FEFRT4                BH3414
     I                                    P  17  205FEFRT5                BH3414
     I*                                                                   BH3414
     I            DS                                                      BH3414
     I                                        1   50FEFACL                BH3414
     I                                        1   5 FACNO                 BH3414
     I                                        1   30FTYP                  BH3414
     I                                        4   50FSEQ                  BH3414
     I*                                                                   BH3414
     I            DS                                                      090266
     I                                        1  14 WUKEY                 090266
     I                                        1   3 WUBRCA                090266
     I**********                              4   90WUCNUM                             090266 CSD027
     I                                        4   9 WUCNUM                                    CSD027
     I                                       10  140WUFREF                090266
     I                                       10  120WUFACT                090266
     I                                       13  140WUFCNO                090266
      *                                                                   CLE014
     I            DS                                                      CLE014
     I                                        1   2 SDCALT                CLE014
     I                                        1   2 SDCTYP                CLE014
     I                                        3  10 SDRAT1                CLE014
     I                                        3  10 SDRTE1                CLE014
     I                                       11  18 SDRAT2                CLE014
     I                                       11  18 SDRTE2                CLE014
     I                                       19  26 SDRAT3                CLE014
     I                                       19  26 SDRTE3                CLE014
     I                                       27  34 SDRAT4                CLE014
     I                                       27  34 SDRTE4                CLE014
     I                                       35  42 SDRAT5                CLE014
     I                                       35  42 SDRTE5                CLE014
     I                                       43  53 SDAMT1                CLE014
     I                                       43  53 SDAMO1                CLE014
     I                                       54  64 SDAMT2                CLE014
     I                                       54  64 SDAMO2                CLE014
     I                                       65  75 SDAMT3                CLE014
     I                                       65  75 SDAMO3                CLE014
     I                                       76  86 SDAMT4                CLE014
     I                                       76  86 SDAMO4                CLE014
     I                                       87  97 SDAMT5                CLE014
     I                                       87  97 SDAMO5                CLE014
     I*                                                                   090266
     IPSDS       SDS
      ** Program Status Data Structure - gives Job/Workstation name and
      ** User ID
      *
     I                                      244 253 JOB
     I                                      244 246 WSID
     I                                      254 263 USER
     I            DS                                                                         BUG8762
      ** Fee amounts data structure                                                          BUG8762
     I                                    P   1  300@HAMT                                    BUG8762
     I                                    P   1   60OMAMT1                                   BUG8762
     I                                    P   7  120OMAMT2                                   BUG8762
     I                                    P  13  180OMAMT3                                   BUG8762
     I                                    P  19  240OMAMT4                                   BUG8762
     I                                    P  25  300OMAMT5                                   BUG8762
      *                                                                                      BUG8762
     I            DS                                                                         BUG8762
      ** Fee rates data structure                                                            BUG8762
     I                                    P   1  205@HRT                                     BUG8762
     I                                    P   1   45OMFRT1                                   BUG8762
     I                                    P   5   85OMFRT2                                   BUG8762
     I                                    P   9  125OMFRT3                                   BUG8762
     I                                    P  13  165OMFRT4                                   BUG8762
     I                                    P  17  205OMFRT5                                   BUG8762
     IZOUT22      DS                             22                                          250989
      ** Amount    data structure                                                            250989
     I                                        1  21 ZOUT21                                   250989
     I                                        1  20 ZOUT20                                   250989
     I                                       21  21 ZNEG                                     250989
      *                                                                                       CLE141
     IACCY        DS                             30                                           CLE141
     I                                        1   3 C1PI                                      CLE141
     I                                        4   6 C2PI                                      CLE141
     I                                        7   9 C3PI                                      CLE141
     I                                       10  12 C4PI                                      CLE141
     I                                       13  15 C5PI                                      CLE141
     I                                       16  18 C6PI                                      CLE141
     I                                       19  21 C7PI                                      CLE141
     I                                       22  24 C8PI                                      CLE141
     I                                       25  27 C9PI                                      CLE141
     I                                       28  30 C0PI                                      CLE141
     IALOC        DS                             30                                           CLE141
     I                                        1   3 L1PI                                      CLE141
     I                                        4   6 L2PI                                      CLE141
     I                                        7   9 L3PI                                      CLE141
     I                                       10  12 L4PI                                      CLE141
     I                                       13  15 L5PI                                      CLE141
     I                                       16  18 L6PI                                      CLE141
     I                                       19  21 L7PI                                      CLE141
     I                                       22  24 L8PI                                      CLE141
     I                                       25  27 L9PI                                      CLE141
     I                                       28  30 L0PI                                      CLE141
      *
      *                                                                                       CLE073
     I/COPY ZSRSRC,ZHOLI                                                                      CLE073
      *                                                                                       CLE073
     ILDA       E DSLDA
      *
     IRUNDAT    E DSRUNDAT
      ** Data Area giving Installation Control Details
      *
     I/COPY ZSRSRC,ZFRPEDZ2
     I/COPY ZSRSRC,ZINTDYZ1                                               CLE013
     I/COPY ZSRSRC,ZDATE9Z2                                               CLE013
     I/COPY ZSRSRC,ZDAT10Z1                                               CLE013
      *
     ISETLIB    E DSSETLIAB                                               CLE014
      ** data structure for passing a parameter to synon screen           CLE014
      ** handling program.                                                CLE014
      *                                                                   CLE014
     ISETLIZ    E DSSETLIAZ                                               CLE014
      ** data structure for passing a parameter to synon screen           CLE014
      ** handling program.                                                CLE014
      *                                                                   CLE014
     ISDBANK    E DSSDBANKPD
      ** Bank Details
      *
     ISDHEDG    E DSSDHEDGPD                                                                  244381
      ** Hedging ICD Data Structure                                                           244381
      *                                                                                       244381
     ISDCURR    E DSSDCURRPD
      ** Currency Details
      *                                                                   BH3378
     ISDCUST    E DSSDCUSTPD                                              BH3378
      **   Customer Details                                               BH3378
      *                                                                   PCA031
     ISDMMOD    E DSSDMMODPD                                              PCA031
      ** Module Details                                                   PCA031
      *                                                                   CLE005
     ISCSARD    E DSSCSARDPD                                              CLE005
      **   SAR Details                                                    CLE005
     I@PARM3    E DSSDSETLPD                                                                  222373
      *
     ISDGELR    E DSSDGELRPD                                                                 BUG8762
      ** General Ledger Details                                                              BUG8762
      *                                                                                      BUG8762
     IDSFDY     E DSDSFDY
      ** DS for access programs, short data structure
      *
     IDSSDY     E DSDSSDY
      ** Second DS for access programs, long data structure
      *                                                                                       207629
      ** Datastructure to hold input parameter for AOSVALR0.                                  207629
     I            DS                                                                          207629
     I                                        1  20 WPARM                                     207629
     I                                        1   5 WPARM1                                    207629
     I                                        6  10 WPARM2                                    207629
     I                                       11  15 WPARM3                                    207629
     I                                       16  20 WPARM4                                    207629
      *                                                                                       CLE134
      ** Data Structure for Past Due parameter                                                CLE134
      *                                                                                       CLE134
     ID@PDUE      DS                             32                                           CLE134
     I                                        1   4 P@PDTP                                    CLE134
     I                                        5  10 P@LNRF                                    CLE134
     I                                       11  16 P@CNUM                                    CLE134
     I                                       17  210P@FACL                                    CLE134
     I                                       22  230P@FSEQ                                    CLE134
     I                                       24  26 P@BRCA                                    CLE134
      *
     I/COPY WNCPYSRC,LER115I002
     C/EJECT
      *****************************************************************
     C/TITLE Main Processing
      *****************************************************************
      *
     C           *ENTRY    PLIST
     C                     PARM           WBRCA   3
     C**********           PARM           WCNUM   60                                          CSD027
     C                     PARM           WCNUM   6                                           CSD027
     C                     PARM           WFREF   50
     C**********           PARM           WLNRF   60                                          CLE148
     C                     PARM           WLNRF   6                                           CLE148
     C                     PARM           RTRNC   1
      *
      ** Validate data passed in parameters.  Data should not be in
      ** both the facility field and loan reference field.  If
      ** error return to controlling program.
      *
     C           WFREF     IFEQ *ZERO
     C********** WLNRF     ANDEQ*ZERO                                                         CLE148
     C           WLNRF     ANDEQ*BLANKS                                                       CLE148
      *
     C           WFREF     ORNE *ZERO
     C********** WLNRF     ANDNE*ZERO                                                         CLE148
     C           WLNRF     ANDNE*BLANKS                                                       CLE148
      *
     C           WBRCA     OREQ *BLANK
      *
     C********** WCNUM     OREQ *ZERO                                                         CSD027
     C           WCNUM     OREQ *BLANKS                                                       CSD027
     C           *LOCK     IN   LDA
     C                     MOVEL'LER115  'DBPGM
     C                     MOVE 'PARMS   'DBKEY            ************
     C                     Z-ADD001       DBASE            * DBERR 01 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
      *
      ***  Determine if facility or loan record
      *
     C********** WLNRF     IFEQ *ZEROS                                                        CLE148
     C           WLNRF     IFEQ *BLANKS                                                       CLE148
     C                     MOVE '1'       *IN15
     C                     END
      *                                                                                    AR1090331
     C           WFREF     IFNE *ZEROS                                                     AR1090331
     C                     MOVE *BLANKS   WLNRF                                            AR1090331
     C                     ENDIF                                                           AR1090331
      *
      ***  Perform First Cycle Processing
      *
     C                     EXSR INIT
      *
      ** Perform Detail Processing.
      *
     C                     EXSR PROCES
      *
      ** End program.
      *
     C                     SETON                     LR
     C                     RETRN
      *
      *****************************************************************
      *                                                               *
      *  INIT  - Subroutine to perform program initialisation.        *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls:     AOBANKR0                                          *
      *                                                               *
      *****************************************************************
      *
     C           INIT      BEGSR
      *
      ** Keylist for read of Fees History File - LF/LEFHSTL1
      *
     C           KEY001    KLIST
     C                     KFLD           WBRCA
     C                     KFLD           WCNUM
     C                     KFLD           WFREF
     C                     KFLD           WLNRF
     C                     KFLD           HIFSEQ
      *
      ** Keylist for read of Fees Master File - PF/LEFEED
      *                                                                                       CLE073
      *                                                                                       CLE073
      ** Key to access HISTSHP                                                                CLE073
      *                                                                                       CLE073
     C           KEYHST    KLIST                                                              CLE073
     C                     KFLD           WBRCA                                               CLE073
     C                     KFLD           WCNUM                                               CLE073
     C                     KFLD           WLNRF                                               CLE073
     C                     KFLD           WVDAT   50                                          CLE073
     C                     KFLD           WLASN   30                                          CLE073
     C                     Z-ADD999       WLASN   30                                          CLE073
      *                                                                                       CLE073
      ** Partial Key to process HISTSHP                                                       CLE073
      *                                                                                       CLE073
     C           KEYPHS    KLIST                                                              CLE073
     C                     KFLD           WBRCA                                               CLE073
     C                     KFLD           WCNUM                                               CLE073
     C                     KFLD           WLNRF                                               CLE073
      *                                                                                       CLE073
      *
     C           KEY002    KLIST
     C                     KFLD           WBRCA
     C                     KFLD           WCNUM
     C                     KFLD           WFREF
     C                     KFLD           WLNRF
     C                     KFLD           FEFSEQ
      *
      ** Keylist for read of Fees Settlement/Adjustment file which
      ** is only used with calculated facility fees - LF/LEFEADL2
      *
     C           KEY003    KLIST
     C                     KFLD           WBRCA
     C                     KFLD           WCNUM
     C                     KFLD           WFREF
     C                     KFLD           WLNRF
     C                     KFLD           FAFSEQ
     C/COPY WNCPYSRC,LER115C005
      *                                                                   157532
     C           KEY004    KLIST                                          157532
     C                     KFLD           KBRCA   3                       157532
     C**********           KFLD           KCNUM   60                                   157532 CSD027
     C                     KFLD           KCNUM   6                                           CSD027
     C                     KFLD           KFACL   50                      157532
     C**********           KFLD           KLOAN   60                                   157532 CLE148
     C                     KFLD           KLOAN   6                                           CLE148
     C                     KFLD           FAFSEQ                          157532
      *                                                                                       207629
     C** Set up KLIST for accessing CLOANCL file                                              207629
     C           KEY005    KLIST                                                              207629
     C**********           KFLD           WLOAN   60                                   207629 CLE148
     C                     KFLD           WLOAN   6                                           CLE148
     C                     KFLD           WCLRT   1                                           207629
      *                                                                                       207629
      *                                                                                       245012
      ** Keylist for read of Fees History File - LF/LEFHSTL2                                  245012
      *                                                                                       245012
     C           KEY007    KLIST                                                              245012
     C                     KFLD           WCNUM                                               245012
     C                     KFLD           WFREF                                               245012
     C                     KFLD           HIFSEQ                                              245012
      *                                                                                       245012
     C********** KEY006    KLIST                                                       243496 245803
     C**********           KFLD           FEBRCA                                       243496 245803
     C**********           KFLD           FECNUM                                       243496 245803
     C**********           KFLD           FEFACL                                       243496 245803
     C**********           KFLD           FELOAN                                       243496 245803
     C**********           KFLD           FEFSEQ                                       243496 245803
      **********                                                                       243496 245803
     C           KEY006    KLIST                                                             243496B
     C                     KFLD           FEBRCA                                             243496B
     C                     KFLD           FECNUM                                             243496B
     C                     KFLD           FEFACL                                             243496B
     C                     KFLD           FELOAN                                             243496B
     C                     KFLD           FEFSEQ                                             243496B
      *                                                                                      243496B
     C/COPY WNCPYSRC,LER115C001
     C** Set up KLIST for accessing Facility file                         BH3414
     C*                                                                   BH3414
     C           FACKEY    KLIST                                          BH3414
     C**********           KFLD           FECNUM  60                                   BH3414 CSD027
     C                     KFLD           FECNUM  6                                           CSD027
     C                     KFLD           FTYP    30                      BH3414
     C                     KFLD           FSEQ    20                      BH3414
     C*                                                                   BH3414
     C** Define key list for read of FACHSAL1 file - full key.            BH3414
     C*                                                                   BH3414
     C           HSAKY1    KLIST                                          BH3414
     C                     KFLD           FECNUM                          BH3414
     C                     KFLD           FEFACL                          BH3414
     C                     KFLD           STDATE                          BH3414
     C                     KFLD           STFSEQ                          BH3414
     C*                                                                   BH3414
     C** Define key list for read of FACHSAL1 file - partial key.         BH3414
     C*                                                                   BH3414
     C           HSAKY2    KLIST                                          BH3414
     C                     KFLD           FECNUM                          BH3414
     C                     KFLD           FEFACL                          BH3414
     C*                                                                   BH3414
     C** Define key list for read of FCLTYL1 file.                        090266
     C*                                                                   090266
     C           KFCLTY    KLIST                                          090266
     C                     KFLD           WUBRCA                          090266
     C                     KFLD           WUCNUM                          090266
     C                     KFLD           WUFACT                          090266
     C                     KFLD           WUFCNO                          090266
      *                                                                   181729
      ** Define key list for read of LEFCLTLB file.                       181729
      *                                                                   181729
     C           KLEFCL    KLIST                                          181729
     C                     KFLD           WBRCA                           181729
     C                     KFLD           WCNUM                           181729
     C                     KFLD           WFACT   30                      181729
     C                     KFLD           WFCNO   20                      181729
      *                                                                   181729
      ** Define key list for read of LEFEEDL1 file.                       181729
      *                                                                   181729
     C           KLEFID    KLIST                                          181729
     C                     KFLD           PCNUM                           181729
     C                     KFLD           PFACL   50                      181729
      *                                                                   187268
      ** Define key list to get participant facility fees in PF/LEFHST    187268
      *                                                                   187268
     C           KFEHIS    KLIST                                          187268
     C                     KFLD           PBRCA                           187268
     C                     KFLD           PCNUM                           187268
     C                     KFLD           PFACL   50                      187268
      *                                                                                       CLE141
      ** Parameter list for program LEZBDYCD                                                  CLE141
      *                                                                                       CLE141
     C           BDCHK     PLIST                                                              CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           ACCY                                                CLE141
     C                     PARM           ALOC                                                CLE141
     C                     PARM           PAYIND  1                                           CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           CCYLL   3                                          CLE141A
     C                     PARM *BLANKS   LOCLL   3                                          CLE141A
     C                     PARM *ZEROS    ZADJDT  50                                          CLE141
      *
      **  Call access program for bank specific details, e.g., title
      **  local currency, run date & day number.
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'LER115  'DBPGM
     C                     MOVE 'SDBANKPD'DBFILE           ************
     C                     Z-ADD002       DBASE            * DBERR 02 *
     C                     MOVEL'*READ   'DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *                                                                   PCA031
      ** Access Module details                                            PCA031
      *                                                                   PCA031
     C                     CALL 'AOMMODR0'                                PCA031
     C                     PARM '*MSG   ' WRTCD                           PCA031
     C                     PARM '*FIRST ' WOPTN                           PCA031
     C           SDMMOD    PARM SDMMOD    DSFDY                           PCA031
     C           WRTCD     IFNE *BLANKS                                   PCA031
     C           *LOCK     IN   LDA                                       PCA031
     C                     MOVEL'LER115  'DBPGM                           PCA031
     C                     MOVEL'SDMMODPD'DBFILE           ************   PCA031
     C                     Z-ADD7         DBASE            * DBERR 07 *   PCA031
     C                     MOVEL'*FIRST  'DBKEY            ************   PCA031
     C                     OUT  LDA                                       PCA031
     C                     EXSR *PSSR                                     PCA031
     C                     END                                            PCA031
      *                                                                   PCA031
     C           BGN0ST    IFEQ 'Y'                                       PCA031
     C                     MOVE '1'       *IN80                           PCA031
     C                     ELSE                                           PCA031
     C                     MOVE '0'       *IN80                           PCA031
     C                     ENDIF                                          PCA031
      *
      ** Set up copyright parameter
      *
     C                     MOVEACPY@      BIS@   80
      *                                                                                      BUG8762
      ** Access SDGELRPD for accrual profit day                                              BUG8762
      *                                                                                      BUG8762
     C                     CALL 'AOGELRR0'                                                   BUG8762
     C                     PARM '*MSG   ' WRTCD                                              BUG8762
     C                     PARM '*FIRST ' WOPTN                                              BUG8762
     C           SDGELR    PARM SDGELR    DSFDY                                              BUG8762
     C           WRTCD     IFNE *BLANKS                                                      BUG8762
     C           *LOCK     IN   LDA                                                          BUG8762
     C                     MOVEL'LER115'  DBPGM            ************                      BUG8762
     C                     MOVEL'SDGELRPD'DBFILE           * DBERR 08 *                      BUG8762
     C                     Z-ADD8         DBASE            ************                      BUG8762
     C                     OUT  LDA                                                          BUG8762
     C                     EXSR *PSSR                                                        BUG8762
     C                     END                                                               BUG8762
      *                                                                   CLE005
      ** Check if SAR CLE005 is present                                   CLE005
      *                                                                   CLE005
     C                     CALL 'AOSARDR0'                                CLE005
     C                     PARM *BLANKS   P@RTCD  7                       CLE005
     C                     PARM '*KEY   ' P@OPTN  7                       CLE005
     C                     PARM 'CLE005'  P@SARD  6                       CLE005
     C           SCSARD    PARM SCSARD    DSFDY                           CLE005
      *                                                                   CLE005
     C           P@RTCD    IFEQ *BLANKS                                   CLE005
     C                     MOVE *ON       *IN30                           CLE005
     C                     ELSE                                           CLE005
      *                                                                   CLE005
      ** Handle Database Error                                            CLE005
      *                                                                   CLE005
     C           P@RTCD    IFNE '*NRF    '                                CLE005
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVE 'SCSARDPD'DBFILE           ************   CLE005
     C                     Z-ADD007       DBASE            * DBERR 07 *   CLE005
     C                     MOVEL'CLE005  'DBKEY            ************   CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *
      *                                                                   CLE014
      ** Determine if CLE014 is installed                                 CLE014
      *                                                                   CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM '       ' PRTCD   7                       CLE014
     C                     PARM '*VERIFY' POPTN   7                       CLE014
     C                     PARM 'CLE014'  PSARD   6                       CLE014
     C           SCSARD    PARM SCSARD    DSSDY                           CLE014
      *                                                                   CLE014
      ** Handle Database Error                                            CLE014
      *                                                                   CLE014
     C           PRTCD     IFNE *BLANKS                                   CLE014
     C           PRTCD     ANDNE'*NRF   '                                 CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVE 'SCSARDPD'DBFILE                          CLE014
     C                     MOVEL'LER115'  DBPGM                           CLE014
     C                     MOVELPSARD     DBKEY                           CLE014
     C                     Z-ADD20        DBASE                           CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** CLE014 is installed                                              CLE014
      *                                                                   CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CLE014  1                       CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CLE014                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** Determine if CEU004 is installed                                 CLE014
      *                                                                   CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM '       ' PRTCD                           CLE014
     C                     PARM '*VERIFY' POPTN                           CLE014
     C                     PARM 'CEU004'  PSARD                           CLE014
     C           SCSARD    PARM SCSARD    DSSDY                           CLE014
      *                                                                   CLE014
      ** Handle Database Error                                            CLE014
      *                                                                   CLE014
     C           PRTCD     IFNE *BLANKS                                   CLE014
     C           PRTCD     ANDNE'*NRF   '                                 CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVE 'SCSARDPD'DBFILE                          CLE014
     C                     MOVEL'LER115'  DBPGM                           CLE014
     C                     MOVELPSARD     DBKEY                           CLE014
     C                     Z-ADD21        DBASE                           CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** CEU004 is installed                                              CLE014
      *                                                                   CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CEU004  1                       CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CEU004                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** Determine if CLE006 is installed                                 CLE014
      *                                                                   CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM '       ' PRTCD                           CLE014
     C                     PARM '*VERIFY' POPTN                           CLE014
     C                     PARM 'CLE006'  PSARD                           CLE014
     C           SCSARD    PARM SCSARD    DSSDY                           CLE014
      *                                                                   CLE014
      ** Handle Database Error                                            CLE014
      *                                                                   CLE014
     C           PRTCD     IFNE *BLANKS                                   CLE014
     C           PRTCD     ANDNE'*NRF   '                                 CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVE 'SCSARDPD'DBFILE                          CLE014
     C                     MOVEL'LER115'  DBPGM                           CLE014
     C                     MOVELPSARD     DBKEY                           CLE014
     C                     Z-ADD22        DBASE                           CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** CLE006 is installed                                              CLE014
      *                                                                   CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CLE006  1                       CLE014
     C                     MOVE '1'       *IN22                                             BUG12876
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CLE006                          CLE014
     C                     MOVE '0'       *IN22                                             BUG12876
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** Determine if CLE007 is installed                                 CLE014
      *                                                                   CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM '       ' PRTCD                           CLE014
     C                     PARM '*VERIFY' POPTN                           CLE014
     C                     PARM 'CLE007'  PSARD                           CLE014
     C           SCSARD    PARM SCSARD    DSSDY                           CLE014
      *                                                                   CLE014
      ** Handle Database Error                                            CLE014
      *                                                                   CLE014
     C           PRTCD     IFNE *BLANKS                                   CLE014
     C           PRTCD     ANDNE'*NRF   '                                 CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVE 'SCSARDPD'DBFILE                          CLE014
     C                     MOVEL'LER115'  DBPGM                           CLE014
     C                     MOVELPSARD     DBKEY                           CLE014
     C                     Z-ADD23        DBASE                           CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** CLE007 is installed                                              CLE014
      *                                                                   CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CLE007  1                       CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CLE007                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** Determine if CLE105 is installed                                 CLE014
      *                                                                   CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM '       ' PRTCD                           CLE014
     C                     PARM '*VERIFY' POPTN                           CLE014
     C                     PARM 'CLE105'  PSARD                           CLE014
     C           SCSARD    PARM SCSARD    DSSDY                           CLE014
      *                                                                   CLE014
      ** Handle Database Error                                            CLE014
      *                                                                   CLE014
     C           PRTCD     IFNE *BLANKS                                   CLE014
     C           PRTCD     ANDNE'*NRF   '                                 CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVE 'SCSARDPD'DBFILE                          CLE014
     C                     MOVEL'LER115'  DBPGM                           CLE014
     C                     MOVELPSARD     DBKEY                           CLE014
     C                     Z-ADD24        DBASE                           CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** CLE105 is installed                                              CLE014
      *                                                                   CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CLE105  1                       CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CLE105                          CLE014
     C                     ENDIF                                          CLE014
     C/COPY WNCPYSRC,LER115C007
      *                                                                                       CLE031
      ** Determine if CLE031 is installed                                                     CLE031
      *                                                                                       CLE031
     C                     CALL 'AOSARDR0'                                                    CLE031
     C                     PARM '       ' PRTCD                                               CLE031
     C                     PARM '*VERIFY' POPTN                                               CLE031
     C                     PARM 'CLE031'  PSARD                                               CLE031
     C           SCSARD    PARM SCSARD    DSSDY                                               CLE031
      *                                                                                       CLE031
      ** Handle Database Error                                                                CLE031
      *                                                                                       CLE031
     C                     MOVE 'N'       CLE031  1                                           CLE031
     C           PRTCD     IFEQ *BLANKS                                                       CLE031
     C                     MOVE 'Y'       CLE031                                              CLE031
     C                     ELSE                                                               CLE031
     C           PRTCD     IFNE '*NRF   '                                                     CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVE 'SCSARDPD'DBFILE                                              CLE031
     C                     MOVEL'LER115'  DBPGM                                               CLE031
     C                     MOVELPSARD     DBKEY                                               CLE031
     C                     Z-ADD25        DBASE                                               CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
      ** Determine if CLE034 is installed                                                     CLE034
      *                                                                                       CLE034
     C                     MOVE 'N'       CLE034  1                                           CLE034
     C                     CALL 'AOSARDR0'                                                    CLE034
     C                     PARM '       ' PRTCD                                               CLE034
     C                     PARM '*VERIFY' POPTN                                               CLE034
     C                     PARM 'CLE034'  PSARD                                               CLE034
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE034
      *                                                                                       CLE034
      ** Handle Database Error                                                                CLE034
      *                                                                                       CLE034
     C           PRTCD     IFNE *BLANKS                                                       CLE034
     C           PRTCD     ANDNE'*NRF   '                                                     CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVE 'SCSARDPD'DBFILE                                              CLE034
     C                     MOVELPSARD     DBKEY                                               CLE034
     C                     Z-ADD26        DBASE                                               CLE034
     C                     MOVEL'LER115'  DBPGM                                               CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Check if CLE034 is installed                                                         CLE034
      *                                                                                       CLE034
     C           PRTCD     IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'Y'       CLE034                                              CLE034
     C                     MOVE *ON       *IN78                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *OFF      *IN78                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CAS016
      ** Determine if CAS016 is installed                                                     CAS016
      *                                                                                       CAS016
     C                     CALL 'AOSARDR0'                                                    CAS016
     C                     PARM *BLANKS   PRTCD                                               CAS016
     C                     PARM '*VERIFY' POPTN                                               CAS016
     C                     PARM 'CAS016'  PSARD                                               CAS016
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS016
      *                                                                                       CAS016
      ** Handle Database Error                                                                CAS016
      *                                                                                       CAS016
     C           PRTCD     IFNE *BLANKS                                                       CAS016
     C           PRTCD     ANDNE'*NRF   '                                                     CAS016
     C           *LOCK     IN   LDA                                                           CAS016
     C                     MOVE 'SCSARDPD'DBFILE                                              CAS016
     C                     MOVEL'LER115'  DBPGM                                               CAS016
     C                     MOVELPSARD     DBKEY                                               CAS016
     C                     Z-ADD26        DBASE                                               CAS016
     C                     OUT  LDA                                                           CAS016
     C                     EXSR *PSSR                                                         CAS016
     C                     ENDIF                                                              CAS016
      *                                                                                       CAS016
      ** CAS016 is installed                                                                  CAS016
      *                                                                                       CAS016
     C           PRTCD     IFEQ *BLANKS                                                       CAS016
     C                     MOVE 'Y'       CAS016  1                                           CAS016
     C                     ELSE                                                               CAS016
     C                     MOVE 'N'       CAS016                                              CAS016
     C                     ENDIF                                                              CAS016
      *                                                                                       244381
      ** Determine if SAR CAS009 is installed                                                 244381
      *                                                                                       244381
     C                     CALL 'AOSARDR0'                                                    244381
     C                     PARM *BLANKS   PRTCD                                               244381
     C                     PARM '*VERIFY 'POPTN                                               244381
     C                     PARM 'CAS009'  PSARD                                               244381
     C           SCSARD    PARM SCSARD    DSFDY                                               244381
      *                                                                                       244381
     C           PRTCD     IFNE *BLANKS                                                       244381
     C           PRTCD     ANDNE'*NRF   '                                                     244381
     C           *LOCK     IN   LDA                                                           244381
     C                     MOVEL'SCSARDPD'DBFILE                                              244381
     C                     MOVEL'LER115'  DBPGM                                               244381
     C                     MOVEL'CAS009'  DBKEY                                               244381
     C                     Z-ADD52        DBASE                                               244381
     C                     OUT  LDA                                                           244381
     C                     EXSR *PSSR                                                         244381
     C                     ENDIF                                                              244381
      *                                                                                       244381
     C           PRTCD     IFEQ *BLANKS                                                       244381
     C                     MOVE 'Y'       CAS009  1                                           244381
     C                     ELSE                                                               244381
     C                     MOVE 'N'       CAS009                                              244381
     C                     ENDIF                                                              244381
      *                                                                                       244381
     C           CAS009    IFEQ 'Y'                                                           244381
      *                                                                                       244381
      ** Access hedging details if CAS009 is enabled.                                         244381
      *                                                                                       244381
     C                     CALL 'AOHEDGR0'                                                    244381
     C                     PARM *BLANKS   PRTCD                                               244381
     C                     PARM '*FIRST ' POPTN                                               244381
     C           SDHEDG    PARM SDHEDG    DSFDY                                               244381
      *                                                                                       244381
     C           PRTCD     IFNE *BLANKS                                                       244381
     C           *LOCK     IN   LDA                                                           244381
     C                     MOVEL'SDHEDGPD'DBFILE                                              244381
     C                     MOVEL'LER115'  DBPGM                                               244381
     C                     MOVELPOPTN     DBKEY                                               244381
     C                     Z-ADD53        DBASE                                               244381
     C                     OUT  LDA                                                           244381
     C                     EXSR *PSSR                                                         244381
     C                     ENDIF                                                              244381
      *                                                                                       244381
     C                     ENDIF                                                              244381
     C/COPY WNCPYSRC,LEH01357
      *
      ** Read in Installation Data
      *
     C           *NAMVAR   DEFN           LDA
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
      *                                                                                       CLE073
      ** Determine if CLE073 is installed                                                     CLE073
      *                                                                                       CLE073
     C                     CALL 'AOSARDR0'                                                    CLE073
     C                     PARM '       ' PRTCD   7                                           CLE073
     C                     PARM '*VERIFY' POPTN   7                                           CLE073
     C                     PARM 'CLE073'  PSARD   6                                           CLE073
     C           SCSARD    PARM SCSARD    DSSDY                                               CLE073
      *                                                                                       CLE073
     C           PRTCD     IFEQ *BLANKS                                                       CLE073
     C                     MOVE 'Y'       CLE073  1                                           CLE073
     C                     ELSE                                                               CLE073
     C                     MOVE 'N'       CLE073                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE134
      ** Determine if CLE134 is installed                                                     CLE134
      *                                                                                       CLE134
     C                     CALL 'AOSARDR0'                                                    CLE134
     C                     PARM '       ' PRTCD   7                                           CLE134
     C                     PARM '*VERIFY' POPTN   7                                           CLE134
     C                     PARM 'CLE134'  PSARD   6                                           CLE134
     C           SCSARD    PARM SCSARD    DSSDY                                               CLE134
      *                                                                                       CLE134
     C           PRTCD     IFEQ *BLANKS                                                       CLE134
     C                     MOVE 'Y'       CLE134  1                                           CLE134
     C                     MOVE *ON       *IN31                                               CLE134
     C                     ELSE                                                               CLE134
     C                     MOVE 'N'       CLE134                                              CLE134
     C                     MOVE *OFF      *IN31                                               CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE141
      ** Determine if CLE141 is installed                                                     CLE141
      *                                                                                       CLE141
     C                     MOVEL'N'       CLE141  1                                           CLE141
     C                     CALL 'AOSARDR0'                                                    CLE141
     C                     PARM '       ' PRTCD   7                                           CLE141
     C                     PARM '*VERIFY' POPTN   7                                           CLE141
     C                     PARM 'CLE141'  PSARD   6                                           CLE141
     C           SCSARD    PARM SCSARD    DSSDY                                               CLE141
      *                                                                                       CLE141
     C           PRTCD     IFEQ *BLANKS                                                       CLE141
     C                     MOVE 'Y'       CLE141                                              CLE141
     C                     ENDIF                                                              CLE141
      *                                                                                       207629
      ** Check System Value: Use Original Borrower or Purchased From?                         207629
      ** Set up AOSVALR0 parameter with GISVAL "LoanCustOriginPurch"                          207629
     C                     MOVE *BLANKS   WPARM                                               207629
     C                     MOVEL'LoanC'   WPARM1                                              207629
     C                     MOVEL'ustOr'   WPARM2                                              207629
     C                     MOVEL'iginP'   WPARM3                                              207629
     C                     MOVEL'urch'    WPARM4                                              207629
     C                     MOVELWPARM     SVALK1                                              207629
      * Call Access object:                                                                   207629
     C                     CALL 'AOSVALR0'                                                    207629
     C                     PARM           RTNCDE  7                                           207629
     C                     PARM           SVALK1 20                                           207629
     C                     PARM           SVAL1 200                                           207629
     C                     PARM           SVALK2 20                                           207629
     C                     PARM           SVAL2 200                                           207629
     C                     PARM           SVALK3 20                                           207629
     C                     PARM           SVAL3 200                                           207629
     C                     PARM           SVALK4 20                                           207629
     C                     PARM           SVAL4 200                                           207629
     C                     PARM           SVALK5 20                                           207629
     C                     PARM           SVAL5 200                                           207629
     C                     PARM           SVALK6 20                                           207629
     C                     PARM           SVAL6 200                                           207629
     C                     PARM           SVALK7 20                                           207629
     C                     PARM           SVAL7 200                                           207629
     C                     PARM           SVALK8 20                                           207629
     C                     PARM           SVAL8 200                                           207629
     C                     PARM           SVALK9 20                                           207629
     C                     PARM           SVAL9 200                                           207629
     C                     PARM           SVALK0 20                                           207629
     C                     PARM           SVAL10200                                           207629
      * If the system value is not found then issue a database error                          207629
     C           RTNCDE    IFNE '        '                                                    207629
     C           *LOCK     IN   LDA                                                           207629
     C                     MOVEL'SDSVALPD'DBFILE           ************                       207629
     C                     Z-ADD25        DBASE            * DBERR 25 *                       207629
     C                     MOVEL'SVALK1'  DBKEY            ************                       207629
     C                     OUT  LDA                                                           207629
     C                     EXSR *PSSR                                                         207629
     C                     ELSE                                                               207629
      * Isolate the first character of SVAL1 which = 'P' or 'O'.                              207629
     C                     MOVELSVAL1     WRK01   1        1 character fld                    207629
     C           WRK01     IFEQ 'O'                                                           207629
     C                     MOVE 'O'       PPCUST  1                                           207629
     C                     ELSE                                                               207629
     C                     MOVE 'P'       PPCUST                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C*                                                                   BH3414
     C***  Set up currency arrays                                         BH3414
     C*                                                                   BH3414
     C                     Z-ADD0         X       30                      BH3414
     C***********          READ SDCURRPD                 15         BH3414090266
     C                     READ SDCURRPD                 17         BH3414090266
     C*                                                                   BH3414
     C************IN15     DOWEQ'0'                                 BH3414090266
     C           *IN17     DOWEQ'0'                                 BH3414090266
     C*                                                                   BH3414
     C           X         IFLE 150                                       BH3414
     C           X         ADD  1         X                               BH3414
     C                     MOVE A6CYCD    CURR,X                          BH3414
     C                     Z-ADDA6SPRT    CSPT,X                          BH3414
     C                     MOVELA6MDIN    MTDV,X                          BH3414
     C                     Z-ADDA6NBDP    CCDP,X                          BH3414
     C                     Z-ADDA6SSNB    CCNO,X                          BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C***********          READ SDCURRPD                 15         BH3414090266
     C                     READ SDCURRPD                 17         BH3414090266
     C*                                                                   BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C**********           Z-ADD99        STFSEQ  20                                   BH3414 200289
     C                     Z-ADD999       STFSEQ  30                                          200289
     C/COPY WNCPYSRC,LER115C002
     C                     Z-ADD0         WOPCT   63                      BH3414
     C                     Z-ADD0         WOAMT  130                      BH3414
     C                     Z-ADD0         WFPC    63                      BH3414
     C                     Z-ADD0         WFAM   130                      BH3414
     C**********           Z-ADD0         WTOT   130                                 BH3414 AR634880
     C                     Z-ADD0         WTOT   150                                        AR634880
     C                     Z-ADD0         WRK63   63                      BH3414
     C                     Z-ADD0         WRK15  150                      BH3414
     C                     Z-ADD0         WRK153 153                      BH3414
     C**********           Z-ADD0         WRK155 155                                 BH3414 BUG21935
     C                     Z-ADD0         WRK199 199                                        BUG21935
      *
      ** Set Date Format Indicator *IN98  on if date format is MMDDYY
      *
     C           AGDFF     IFEQ 'M'
     C                     SETON                     98
     C                     END
      *
      ** Set up edit code to be used throughout program
      *
     C                     MOVE 'L'       ZECODE
      *
      ** Initialise subfile relative record number.
      *
     C                     Z-ADD1         RRN     40
      *
      * Determine whether it is a facility record with original entry     090266
      * date not equal system date.                                       090266
      * ie. if facility record with original entry date not equal         090266
      *     system date then set on 71, otherwise set off 71.             090266
     C                     SETOF                     71                   090266
     C           WFREF     IFNE 0                                         090266
     C                     MOVE WBRCA     WUBRCA                          090266
     C**********           Z-ADDWCNUM     WUCNUM                                       090266 CSD027
     C                     MOVE WCNUM     WUCNUM                                              CSD027
     C                     Z-ADDWFREF     WUFREF                          090266
     C           KFCLTY    CHAINFCLTYFMF             70                   090266
     C           *IN70     IFEQ *ON                                       090266
     C           *LOCK     IN   LDA                                       090266
     C                     MOVEL'FCLTYL1' DBFILE    P                     090266
     C                     MOVEL'LER115'  DBPGM     P                     090266
     C                     MOVELWUKEY     DBKEY     P      ************   090266
     C                     Z-ADD006       DBASE            * DBERR 06 *   090266
     C                     OUT  LDA                        ************   090266
     C                     EXSR *PSSR                                     090266
     C                     ELSE                                           090266
     C           ORED      IFNE AGRDNB                                    090266
     C                     SETON                     71                   090266
     C                     ENDIF                                          090266
      *                                                                   156886
     C           SYIN      IFEQ 'Y'                                       156886
     C           PRTR      ANDNE'I'                                       156886
     C           PRTR      ANDNE'P'                                       156886
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C                     MOVE '1'       *IN53                           156886
     C                     ENDIF                                          156886
      *                                                                   156886
     C                     ENDIF                                          090266
     C                     ENDIF                                          090266
      *                                                                   090266
     C                     MOVELWCNUM     SFCNM2  6                       156886
     C                     ENDSR
      *
      *****************************************************************
      *                                                               *
      *  PROCES - Subroutine to retrieve fee details                  *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls:     AOCURRR0, ZFRPED, ZDATE2, SETTLE, DETLSR          *
      *                                                               *
      *****************************************************************
      *
     C           PROCES    BEGSR
      *                                                                   153664
     C**********           MOVELWCNUM     WFREFA 110                                   153664 CSD027
     C                     MOVELWCNUM     WFREFA 11                                           CSD027
     C                     MOVE WFREF     WFREFA                          153664
      *
      **  Retrieve details of any matured fees first (note: a fee
      **  cannot exist on both the fee history file and the fee master
      **  file).  Set up key from data passed in by paramaters.
      *
     C                     Z-ADD0         HIFSEQ
      *
     C           KEY001    SETLLLEFHSTF
     C                     READ LEFHSTF                  10
      *
      ** If record found on fee history file save key fields for
      ** comparison with later read of file.
      *
      ** Initalise subfile relative record number, set on
      ** indicators for SFLDSP, SFLDSPCTL and the "+" sign (END)
      ** and set up fields for output to the subfile record.
      *
     C           *IN10     IFEQ '0'
      *
      **  Lending Enhancements mean that Live fees will also exist on     153736
      **  Fees History file therefore need to check if fee has matured    153736
      *                                                                   153736
     C           HIRECI    IFEQ 'M'                                       153736
      *                                                                   153736
     C                     MOVE HIBRCA    SAVBRC  3
     C**********           Z-ADDHICNUM    SAVCUS  60                                          CSD027
     C                     MOVE HICNUM    SAVCUS  6                                           CSD027
     C                     Z-ADDHIFACL    SAVFAC  50
     C**********           Z-ADDHILNRF    SAVLON  60                                          CLE148
     C                     MOVELHILNRF    SAVLON  6                                           CLE148
      *
     C                     MOVEA'111'     *IN,50
      **
      ** Only continue processing if a record has been read from
      ** the fees history file and the key details are the same as
      ** the details in the input parameters.
      *
     C           *IN10     DOWEQ'0'
     C           SAVBRC    ANDEQWBRCA
     C           SAVCUS    ANDEQWCNUM
     C           SAVFAC    ANDEQWFREF
     C           SAVLON    ANDEQWLNRF
      *
      ** Indicator showing details on fee history file
      *
     C                     MOVE '1'       *IN13
      *
      ** Set up fields for output to subfile record.
      *
     C                     MOVE HIBRCA    SFBRCA
     C                     MOVE HICNUM    SFCNUM
      ** If the loan is a Participation Purchased, & System Value                             207629
      ** LoanCustOriginPurch = 'O', use Original Borrower:                                    207629
     C********** WLNRF     IFNE 0                                                      207629 CLE148
     C           WLNRF     IFNE *BLANKS                                                207629 CLE148
     C           PPCUST    ANDEQ'O'                                                           207629
     C                     MOVE WLNRF     WLOAN                                               207629
     C                     MOVE 'A'       WCLRT                                               207629
     C           KEY005    CHAINCLOAN                79                                       207629
     C           *IN79     IFEQ '0'                                                           207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C                     MOVE OLNO      SFCNUM                                              207629
     C**********           MOVE HICNUM    OFCNUM  60                                   207629 CSD027
     C                     MOVE HICNUM    OFCNUM  6                                           CSD027
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     MOVE HIFACL    SFFREF                          153664
     C                     MOVE HIFSEQ    SFFSEQ
     C                     MOVE HIFCOD    SFFCOD
     C                     MOVE HIFCCY    SFSCCY                          176783
      *
      ** set up decimal places from ccy on history record
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM HIFCCY    K101    3
     C           SDCURR    PARM SDCURR    DSSDY
      *
      ** Error if currency not found.
      *
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'LER115  'DBPGM
     C                     MOVE 'SDCURRPD'DBFILE           ************
     C                     Z-ADD003       DBASE            * DBERR 03 *
     C                     MOVELHIFCCY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** Format settlement amount for output using decimal places
      ** retrieved from currency file.
      *
     C           HIAMTS    IFEQ *ZEROS
     C                     MOVE *BLANKS   SFSAMT
     C                     ELSE
     C                     Z-ADDHIAMTS    ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SFSAMT                                              250989
     C**********           MOVE ZOUT20    SFSAMT                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SFSAMT                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *
      ** Format settlement date for output to screen.
      *
     C           HIHDAT    IFEQ *ZEROS
     C                     MOVE *BLANKS   SFSDAT                          BH3378
     C                     ELSE
     C                     Z-ADDHIHDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SFSDAT
     C                     END
      *
      ***For*history*records*the*outstanding*amount*should*be*zero.****   157532
      ** For history records the amount due/past due should be zero.      157532
      *
     C                     MOVE *BLANKS   SFOAMT
      *
      ** Historical record
      *
     C                     MOVE 'H'       SFSTAT
     C*                                                                   BH3431
     C** Move the record id into the screen field                         BH3431
     C*                                                                   BH3431
     C                     MOVE HIRECI    SFRECI                          BH3431
      *
      ** Load up subfile record.
      *
     C********** HILCHD    IFGT HIHDAT                                             AR753180 MD043383
     C********** BKANWD    ANDEQ'0'                                                AR753180 MD043383
     C********** HILCHD    ORGT HIHDAT                                             AR753180 MD043383
     C********** BKANWD    ANDEQ'1'                                                AR753180 MD043383
     C                     WRITESFLRCD
      *
     C                     ADD  1         RRN
     C**********           ENDIF                                                   AR753180 MD043383
      *
      **  Read next record and save details to ensure that only
      **  records with details equivalent to the input parameters
      **  are processed.
      *
     C                     READ LEFHSTF                  10
      *
     C                     MOVE HIBRCA    SAVBRC
     C**********           Z-ADDHICNUM    SAVCUS                                              CSD027
     C                     MOVE HICNUM    SAVCUS                                              CSD027
     C                     Z-ADDHIFACL    SAVFAC
     C**********           Z-ADDHILNRF    SAVLON                                              CLE148
     C                     MOVELHILNRF    SAVLON                                              CLE148
      *
     C                     END
      *                                                                   153736
     C                     END                                            153736
      *
     C                     END
      *
      *
      **  Now retrieve details of live fees from the fee master file.
      *
     C                     Z-ADD0         FEFSEQ
     C                     Z-ADD0         WPNETF 130                      153664
     C                     Z-ADD0         WIPNET 130                      153664
      *
     C           KEY002    SETLLLEFEED
     C                     READ LEFEED                   11
      *
      ** If record found save key fields for comparison with later
      ** read of file and set on indicators for SFLDSP, SFLDSPCTL
      ** and the "+" sign (END).
      *
     C           *IN11     IFEQ '0'
     C                     MOVE FEBRCA    SAVBRC
     C**********           Z-ADDFECNUM    SAVCUS                                              CSD027
     C                     MOVE FECNUM    SAVCUS                                              CSD027
     C                     Z-ADDFEFACL    SAVFAC
     C**********           Z-ADDFELOAN    SAVLON                                              CLE148
     C                     MOVELFELOAN    SAVLON                                              CLE148
     C                     MOVELPCRF      WPCRF  11                       153664
     C                     MOVELWPCRF     KYPCRF 15                       153664
     C                     MOVE '    '    KYPCRF 15                       153664
      *                                                                                       204543
     C                     MOVEA'111'     *IN,50                                              204543
      *                                                                                       204543
      ** Only continue processing if a record has been read from                              204543
      ** the fees master file and the key details are the same as                             204543
      ** the details in the input parameters.                                                 204543
      *                                                                                       204543
     C           *IN11     DOWEQ'0'                                                           204543
     C           SAVBRC    ANDEQWBRCA                                                         204543
     C           SAVCUS    ANDEQWCNUM                                                         204543
     C           SAVFAC    ANDEQWFREF                                                         204543
     C           SAVLON    ANDEQWLNRF                                                         204543
      *
      ** Obtain currency and set up currency decimal places field         CB0087
      ** for use in editing of screen amount fields.                      CB0087
      *                                                                   CB0087
     C                     CALL 'AOCURRR0'                                CB0087
     C                     PARM '*MSG   ' WRTCD   7                       CB0087
     C                     PARM '*KEY   ' WOPTN   7                       CB0087
     C                     PARM FEFCCY    K101    3                       CB0087
     C           SDCURR    PARM SDCURR    DSSDY                           CB0087
      *                                                                   CB0087
      ** Error if currency not found.                                     CB0087
      *                                                                   CB0087
     C           WRTCD     IFNE *BLANKS                                   CB0087
     C           *LOCK     IN   LDA                                       CB0087
     C                     MOVEL'LER115  'DBPGM                           CB0087
     C                     MOVELFEFCCY    DBKEY                           CB0087
     C                     MOVE 'SDCURRPD'DBFILE           ************   CB0087
     C                     Z-ADD004       DBASE            * DBERR 04 *   CB0087
     C                     OUT  LDA                        ************   CB0087
     C                     EXSR *PSSR                                     CB0087
     C                     END                                            CB0087
      *                                                                   CB0087
     C                     Z-ADDA6NBDP    ZDECS                           CB0087
     C                     Z-ADDA6NBDP    WZDECS  20                      153664
     C           A6NBDP    ADD  4         P       10                      BH3414
      *                                                                   CB0087
     C**********           MOVEA'111'     *IN,50                                              204543
      **********                                                                              204543
      ***Only*continue*processing*if*a*record*has*been*read*from*******                       204543
      ***the*fees*master*file*and*the*key*details*are*the*same*as******                       204543
      ***the*details*in*the*input*parameters.**************************                       204543
      **********                                                                              204543
     C********** *IN11     DOWEQ'0'                                                           204543
     C********** SAVBRC    ANDEQWBRCA                                                         204543
     C********** SAVCUS    ANDEQWCNUM                                                         204543
     C********** SAVFAC    ANDEQWFREF                                                         204543
     C********** SAVLON    ANDEQWLNRF                                                         204543
      *
      **  Details on fees master file indicator.
      *
     C                     MOVE '1'       *IN14
     C                     MOVE ' '       SFSIGN                          153664
     C                     MOVE ' '       SFSGN2                          153664
     C**********           MOVELFECNUM    WFREFB 110                                   153664 CSD027
     C                     MOVELFECNUM    WFREFB 11                                           CSD027
     C                     MOVE FEFACL    WFREFB                          153664
     C                     Z-ADD0         WPDUE  130                      157532
      *
     C                     MOVE *BLANKS   SFEFPA                                              CLE134
     C                     MOVE *BLANKS   SFEFMC                                              CLE134
     C                     MOVE *BLANKS   SFPSIN                                              CLE134
     C                     MOVE *BLANKS   SFMAXA                                              CLE134
      *                                                                                       CLE134
      **  If this is a calculated fee there may be a settlement or
      **  adjustment for this fee which affects the output amounts.
      *
     C           FECALT    IFNE ' '
      *
     C                     EXSR SETTLE
      *
     C                     ELSE
      *
      ***setup*decimal*places*for*ccy*******                              CB0087
      ***********                                                         CB0087
     C***********          CALL 'AOCURRR0'                                CB0087
     C***********          PARM '*MSG   ' WRTCD   7                       CB0087
     C***********          PARM '*KEY   ' WOPTN   7                       CB0087
     C***********          PARM FEFCCY    K101    3                       CB0087
     C***********SDCURR    PARM SDCURR    DSSDY                           CB0087
      ***********                                                         CB0087
      ***Error*if*currency*not*found.                                     CB0087
      ***********                                                         CB0087
     C***********WRTCD     IFNE *BLANKS                                   CB0087
     C************LOCK     IN   LDA                                       CB0087
     C************         MOVEL'LER115  'DBPGM                           CB0087
     C************         MOVELFEFCCY    DBKEY                           CB0087
     C************         MOVE 'SDCURRPD'DBFILE           ************   CB0087
     C***********          Z-ADD004       DBASE            * DBERR 04 *   CB0087
     C***********          OUT  LDA                        ************   CB0087
     C***********          EXSR *PSSR                                     CB0087
     C***********          END                                            CB0087
      ***********                                                         CB0087
      ***********                                                         CB0087
      ****Set*up*settlement*amount*field*using*decimal*places*from****    CB0087
      ****the*fee*currency.**********                                     CB0087
      *
      **  Set up settlement amount field                                  CB0087
      *                                                                   CB0087
     C           FEAMTS    IFEQ *ZEROS
     C                     MOVE *BLANKS   SFSAMT
     C                     ELSE
     C                     Z-ADDFEAMTS    ZFLD15
     C***********          Z-ADDA6NBDP    ZDECS                           CB0087
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SFSAMT                                              250989
     C**********           MOVE ZOUT20    SFSAMT                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SFSAMT                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *************************************************************CLE005 153664
      ***If*SAR*CLE005*is*Present**********************************CLE005 153664
      *************************************************************CLE005 153664
     C************IN30     IFEQ *ON                                CLE005 153664
      *************************************************************CLE005 153664
      ***Format*Fee*Indicator**************************************CLE005 153664
      *************************************************************CLE005 153664
     C***********          MOVEL*BLANKS   SFPTFI                   CLE005 153664
     C***********PTFI      IFEQ *BLANKS                            CLE005 153664
     C***********          MOVEL'R'       SFPTFI                   CLE005 153664
     C***********          ENDIF                                   CLE005 153664
     C***********PTFI      IFEQ 'P'                                CLE005 153664
     C***********          MOVEL'P'       SFPTFI                   CLE005 153664
     C***********          ENDIF                                   CLE005 153664
     C***********PTFI      IFEQ 'I'                                CLE005 153664
     C***********          MOVEL'I'       SFPTFI                   CLE005 153664
     C***********          ENDIF                                   CLE005 153664
      ***********                                                  CLE005 153664
     C***********          ENDIF                                   CLE005 153664
      *****************************************************************   153664
      ***Format*fee*settlement*date*for*output*to*the*screen.**********   153664
      *****************************************************************   153664
     C***********FESDAT    IFEQ *ZEROS                                    153664
     C***********          MOVE *BLANKS   SFSDAT                          153664
     C***********          ELSE                                           153664
     C***********          Z-ADDFESDAT    ZDAYNO                          153664
     C***********          EXSR ZDATE2                                    153664
     C***********          MOVE ZADATE    SFSDAT                          153664
     C***********          END                                            153664
      *****************************************************************   153664
      ***Format*outstanding*fee*amount.********************************   153664
      *****************************************************************   153664
     C***********FEAMTO    IFEQ *ZEROS                                    153664
     C***********          MOVE *BLANKS   SFOAMT                          153664
     C***********          ELSE                                           153664
     C***********          Z-ADDFEAMTO    ZFLD15                          153664
     C***********          EXSR ZFRPED                                    153664
     C***********          MOVE ZOUT25    SFOAMT                          153664
     C***********          END                                            153664
      *                                                                   154104
      ***Format*outstanding*fee*amount.*************************** 154104 157532
      ** Format amount due/past due.                                      157532
      *                                                                   154104
     C***********FEAMTO    IFEQ *ZEROS                             154104 157532
     C           FEAMTP    IFEQ *ZEROS                                    157532
     C                     MOVE *BLANKS   SFOAMT                          154104
     C                     ELSE                                           154104
     C***********          Z-ADDFEAMTO    ZFLD15                   154104 157532
     C                     Z-ADDFEAMTP    ZFLD15                          157532
      *                                                                                       CLE134
      ** suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     ADD  FESFA     ZFLD15                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     EXSR ZFRPED                                    154104
     C**********           MOVE ZOUT25    SFOAMT                                     154104 AR588683
     C**********           MOVE ZOUT20    SFOAMT                                   AR588683 AR690561
     C                     MOVE ZOUT21    SFOAMT                                            AR690561
     C                     EXSR SRSIGN                                    157532
     C                     MOVE WSIGN     SFSGN2                          157532
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     ENDIF                                          154104
      *                                                                   157532
      ** Store amount displayed on screen for later use                   157532
      *                                                                   157532
     C                     Z-ADDFEAMTP    WPDUE                           157532
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     ADD  FESFA     WPDUE                                               CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       204452
      ** format fee amount written off                                                        204452
      *                                                                                       204452
     C           FEAMTW    IFEQ *ZEROS                                                        204452
     C                     MOVE *BLANKS   SWOFFA                                              204452
     C                     ELSE                                                               204452
     C                     Z-ADDFEAMTW    ZFLD15                                              204452
     C                     Z-ADDZFLD15    WFLD15                                              204452
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                                        204452
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SWOFFA                                       204452 250989
     C**********           MOVE ZOUT20    SWOFFA                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SWOFFA                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C                     Z-ADDWFLD15    ZFLD15                                              204452
     C                     ENDIF                                                              204452
      *
     C                     END
      *                                                                   153664
      ** If SAR CLE005 is Present                                         153664
      *                                                                   153664
     C           *IN30     IFEQ *ON                                       153664
      *                                                                   153664
      ** Format Fee Indicator                                             153664
      *                                                                   153664
     C                     MOVEL*BLANKS   SFPTFI                          153664
     C           PTFI      IFEQ *BLANKS                                   153664
     C                     MOVEL'R'       SFPTFI                          153664
     C                     ENDIF                                          153664
     C           PTFI      IFEQ 'P'                                       153664
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVEL'P'       SFPTFI                          153664
     C                     ENDIF                                          153664
     C           PTFI      IFEQ 'I'                                       153664
     C                     MOVEL'I'       SFPTFI                          153664
     C                     ENDIF                                          153664
      *                                                                   153664
     C                     ENDIF                                          153664
      *                                                                   153664
      ***Format*fee*settlement*date*for*output*to*the*screen.**********                153664 243497
      **********                                                                       153664 243497
     C********** FESDAT    IFEQ *ZEROS                                                 153664 243497
     C                     MOVE *BLANKS   SFSDAT                          153664
     C**********           ELSE                                                        153664 243497
     C**********           Z-ADDFESDAT    ZDAYNO                                       153664 243497
     C**********           EXSR ZDATE2                                                 153664 243497
     C**********           MOVE ZADATE    SFSDAT                                       153664 243497
     C**********           ENDIF                                                       153664 243497
      *************************************************************153664 154104
      ***Format*outstanding*fee*amount.****************************153664 154104
      *************************************************************153664 154104
     C***********FEAMTO    IFEQ *ZEROS                             153664 154104
     C***********          MOVE *BLANKS   SFOAMT                   153664 154104
     C***********          ELSE                                    153664 154104
     C***********          Z-ADDFEAMTO    ZFLD15                   153664 154104
     C***********          EXSR ZFRPED                             153664 154104
     C***********          MOVE ZOUT25    SFOAMT                   153664 154104
     C***********          ENDIF                                   153664 154104
      *
     C                     MOVE FEBRCA    SFBRCA
     C                     MOVE FECNUM    SFCNUM
      *If the loan is a Participation Purchased, & System Value                               207629
      * LoanCustOriginPurch = 'O', use Original Borrower:                                     207629
     C********** FELOAN    IFNE 0                                                      207629 CLE148
     C           FELOAN    IFNE *BLANKS                                                       CLE148
     C           PPCUST    ANDEQ'O'                                                           207629
     C                     MOVE FELOAN    WLOAN                                               207629
     C                     MOVE 'A'       WCLRT                                               207629
     C           KEY005    CHAINCLOAN                79                                       207629
     C           *IN79     IFEQ '0'                                                           207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C                     MOVE OLNO      SFCNUM                                              207629
     C                     MOVE FECNUM    OFCNUM                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     MOVE FEFACL    SFFREF                          153664
     C                     MOVE FEFSEQ    SFFSEQ
     C                     MOVE FEFCOD    SFFCOD
     C                     MOVE *BLANKS   SFSTAT
     C           FESCCY    IFEQ *BLANKS                                   176783
     C                     MOVE FEFCCY    SFSCCY                          176783
     C                     ELSE                                           176783
     C                     MOVE FESCCY    SFSCCY                          176783
     C                     END                                            176783
     C*                                                                   BH3431
     C** Move the record id into the screen field                         BH3431
     C*                                                                   BH3431
     C           FERECI    IFNE 'D'                                       BH3431
     C                     MOVE FERECI    SFRECI                          BH3431
     C           FERECI    IFEQ 'M'                                       186841
     C                     MOVEL*BLANKS   SFPTFI                          186841
     C                     MOVE 'H'       SFSTAT                          186841
     C                     ENDIF                                          186841
     C                     ELSE                                           BH3431
     C                     MOVE ' '       SFRECI                          BH3431
     C                     END                                            BH3431
     C*                                                                   BH3378
     C** If the settlement date is blank format the due date              BH3378
     C** according to the payment on indicator                            BH3378
     C*                                                                   BH3378
     C           SFSDAT    IFEQ *BLANKS                                   BH3378
     C           FEPYON    IFEQ 'S'                                       BH3378
     C           FEPYON    OREQ ' '                                       BH3378
     C                     Z-ADDFEPSTD    ZDAYNO                          BH3378
     C                     END                                            BH3378
     C*                                                                   BH3378
     C           FEPYON    IFEQ 'E'                                       BH3378
     C                     Z-ADDFEPEND    ZDAYNO                          BH3378
     C                     END                                            BH3378
     C*                                                                   BH3378
     C           FEPYON    IFEQ 'N'                                       BH3378
     C           FEDDAT    IFEQ 0                                                             243497
     C           FESDAT    IFEQ 0                                                             243497
     C           FENPYD    IFNE 0                                         BH3378
     C                     Z-ADDFENPYD    ZDAYNO                          BH3378
     C                     ELSE                                           BH3378
     C                     Z-ADDFEPEND    ZDAYNO                          BH3378
     C                     END                                            BH3378
     C                     ELSE                                                               243497
     C                     Z-ADDFESDAT    ZDAYNO                                              243497
     C                     ENDIF                                                              243497
     C                     ELSE                                                               243497
     C                     Z-ADDFEDDAT    ZDAYNO                                              243497
     C                     ENDIF                                                              243497
     C                     END                                            BH3378
     C*                                                                   BH3378
     C                     EXSR ZDATE2                                    BH3378
     C                     MOVE ZADATE    SFSDAT                          BH3378
     C                     END                                            BH3378
      *
      ** Loan up subfile record.
      *
     C                     WRITESFLRCD
      *
     C                     ADD  1         RRN
      *
      **  Clear previous fee adjustment amount so that it is not          153736
      **  carried forward to processing of next fee record                153736
      *                                                                   153736
     C                     Z-ADD0         FASADJ                          153736
      *                                                                   153736
      ** Include Participant Fees if shared indicator is 'Y'              153664
      *                                                                   153664
     C           SHFI      IFEQ 'Y'                                       153664
     C           PTFI      ANDEQ' '                                       153664
     C********** FELOAN    ANDEQ0                                                      153664 CLE148
     C           FELOAN    ANDEQ*BLANKS                                                       CLE148
     C           SHFI      OREQ 'N'                                       157894
     C           PTFI      ANDEQ' '                                       157894
     C********** FELOAN    ANDEQ0                                                      157894 CLE148
     C           FELOAN    ANDEQ*BLANKS                                                       CLE148
      *                                                                   156886
     C***********FECALT    IFEQ ' '                                156886 157532
     C***********          ADD  FEAMTO    WPNETF                   153664 157532
     C***********          ELSE                                    156886 157532
     C***********          ADD  ZFLD15    WPNETF                   156886 157532
     C***********          ENDIF                                   156886 157532
     C                     ADD  WPDUE     WPNETF                          157532
      *                                                                   156886
     C***********          MOVE '1'       *IN53                    153664 156886
     C********** SHFI      IFEQ 'Y'                                157894 181729
     C           *IN24     IFEQ '0'                                       181729
     C                     EXSR SRPRTC                                    153664
     C                     MOVE '1'       *IN24                           181729
     C                     ENDIF                                          157894
     C                     ENDIF                                          153664
      *                                                                   153664
     C                     READ LEFEED                   11
     C                     MOVE FEBRCA    SAVBRC
     C                     MOVE FECNUM    SAVCUS
     C                     Z-ADDFEFACL    SAVFAC
     C**********           Z-ADDFELOAN    SAVLON                                              CLE148
     C                     MOVELFELOAN    SAVLON                                              CLE148
     C                     MOVELPCRF      WPCRF                           153664
     C                     MOVELWPCRF     KYPCRF                          153664
     C                     MOVE '    '    KYPCRF                          153664
      ** End do until
     C                     END
      *
      ** End if record found
     C                     END
      *
      ** If record not found on either fees history file or fees
      ** master file output "No Details to Report"' message
      *
     C           *IN13     IFEQ '0'
     C           *IN14     ANDEQ'0'
     C                     MOVEA'010'     *IN,50
     C                     MOVE WBRCA     SFBRCA                          154111
     C                     WRITENODETL
     C                     WRITEFOOTER
     C                     END
      *
      ** Once details have been written to subfile output subfile
      ** control record to screen.
      *
     C                     MOVELUSER      SFUSER
     C                     MOVELWSID      SFWSID
     C                     MOVE BJMRDT    SFRUNA
     C                     MOVE WCNUM     SFCNUM
      *If the loan is a Participation Purchased, & System Value                               207629
      * LoanCustOriginPurch = 'O', use Original Borrower:                                     207629
     C********** WLNRF     IFNE 0                                                      207629 CLE148
     C           WLNRF     IFNE *BLANKS                                                       CLE148
     C           PPCUST    ANDEQ'O'                                                           207629
     C                     MOVE WLNRF     WLOAN                                               207629
     C                     MOVE 'A'       WCLRT                                               207629
     C           KEY005    CHAINCLOAN                79                                       207629
     C           *IN79     IFEQ '0'                                                           207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C                     MOVE OLNO      SFCNUM                                              207629
     C                     MOVE WCNUM     OFCNUM                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     MOVELWFREF     SFFACT
     C                     MOVE WFREF     SFFCNO
     C                     MOVE WLNRF     SFLNRF
     C                     CALL 'AOCUSTR0'                                BH3378
     C                     PARM '*BLANKS' @RTCD   7                       BH3378
     C                     PARM '*KEY    '@OPTN   7                       BH3378
     C                     PARM SFCNUM    KEYC   10                       BH3378
     C                     PARM           KEYSTS  7                       BH3378
     C           SDCUST    PARM SDCUST    DSSDY                           BH3378
     C*                                                                   BH3378
     C           @RTCD     IFEQ *BLANKS                                   BH3378
     C                     MOVE BBCRNM    SFCNAM 20                       BH3378
     C                     END                                            BH3378
      *
     C           *IN53     IFEQ '1'                                       153664
      *                                                                   153664
     C           WPNETF    SUB  WIPNET    WRNETF 130                      153664
      *                                                                   153664
     C           WRNETF    IFEQ 0                                         153664
     C                     MOVE ' '       SFSGN3                          153664
     C                     MOVE *BLANKS   SFNETF                          153664
     C                     ELSE                                           153664
     C                     Z-ADDWRNETF    ZFLD15                          153664
     C                     Z-ADDWZDECS    ZDECS                           153664
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     EXSR ZFRPED                                    153664
     C                     MOVE ZOUT25    SFNETF                          153664
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C           ZFLD15    IFLT 0                                         153664
     C                     MOVE '-'       SFSGN3                          153664
     C                     ENDIF                                          153664
     C                     ENDIF                                          153664
     C                     ENDIF                                          153664
      *                                                                   153664
     C                     WRITEFOOTER
     C                     EXFMTSFLCTLR
     C/COPY WNCPYSRC,LER115C008
      *
      **  User can now choose to see further details of a fee so
      **  provide expanded details from PF/LEFEED.
      *
     C           *INKL     DOWEQ'0'
     C           *INKC     ANDEQ'0'                                       BH3378
     C                     EXSR DETLSR
     C           *INKC     IFEQ '0'                                       BH3378
     C                     MOVELUSER      SFUSER
     C                     MOVELWSID      SFWSID
     C                     MOVE BJMRDT    SFRUNA
     C                     WRITEFOOTER
     C                     EXFMTSFLCTLR
     C/COPY WNCPYSRC,LER115C009
     C                     END                                            BH3378
     C                     END
     C*                                                                   BH3378
     C           *INKC     IFEQ '1'                                       BH3378
     C                     MOVE 'X'       RTRNC                           BH3378
     C                     END                                            BH3378
      *
     C                     ENDSR
      *                                                                   153664
      *****************************************************************   153664
      *                                                               *   153664
      *  SRPRTC - Subroutine to get participant fee of prime fee      *   153664
      *           with shared indicator = 'Y'                         *   153664
      *                                                               *   153664
      *  Called By: PROCES                                            *   153664
      *  Calls:     SETTLE, ZFRPED, ZDATE2                            *   153664
      *                                                               *   153664
      *****************************************************************   153664
      *                                                                   153664
     C           SRPRTC    BEGSR                                          153664
      *                                                                   153664
     C**********           MOVE '0'       *IN21                    153664 181729
     C                     MOVE 'Y'       WPRTC   1                       157532
      *                                                                   157532
     C********** KYPCRF    SETLLLEFEED4F                           153664 181729
     C**********           READ LEFEED4F                 21        153664 181729
      *                                                                   181729
      ** Identify prime facility's funding participants                   181729
      *                                                                   181729
     C                     MOVELWFREF     WFACT                           181729
     C                     MOVE WFREF     WFCNO                           181729
     C                     MOVE '0'       *IN26                           181729
     C           KLEFCL    SETLLFCLTYFPF                                  181729
     C           KLEFCL    READEFCLTYFPF                 26               181729
     C           *IN26     DOWEQ'0'                                       181729
      *                                                                   181729
      ** Identify all fees attached to the participant facility           181729
      *                                                                   181729
     C                     MOVELPFACT     PFACL                           181729
     C                     MOVE PFCNO     PFACL                           181729
     C                     MOVE '0'       *IN21                           181729
     C           KLEFID    SETLLLEFEED1F                                  181729
     C           KLEFID    READELEFEED1F                 21               181729
     C           *IN21     DOWEQ'0'                                       153664
      *                                                                   153664
     C                     MOVELFECNUM    WFREFB                          153664
     C                     MOVE FEFACL    WFREFB                          153664
     C**********           MOVELPCRF      WPCRF2 11                153664 181729
      *                                                                   153664
     C********** WPCRF2    IFNE WPCRF                              153664 181729
     C**********           LEAVE                                   153664 181729
     C**********           ENDIF                                   153664 181729
      **********                                                   153664 181729
      ****If*not*prime*fee*read*(ie.*a*participant),*process*******153664 181729
      **********                                                   153664 181729
     C********** WFREFA    IFNE WFREFB                             153664 181729
      *                                                                   153664
      ** Obtain currency and set up currency decimal places field         153664
      ** for use in editing of screen amount fields.                      153664
      *                                                                   153664
     C                     CALL 'AOCURRR0'                                153664
     C                     PARM '*MSG   ' WRTCD                           153664
     C                     PARM '*KEY   ' WOPTN                           153664
     C                     PARM FEFCCY    K101                            153664
     C           SDCURR    PARM SDCURR    DSSDY                           153664
      *                                                                   153664
      ** Error if currency not found.                                     153664
      *                                                                   153664
     C           WRTCD     IFNE *BLANKS                                   153664
     C           *LOCK     IN   LDA                                       153664
     C                     MOVEL'LER115  'DBPGM                           153664
     C                     MOVELFEFCCY    DBKEY                           153664
     C                     MOVE 'SDCURRPD'DBFILE           ************   153664
     C                     Z-ADD019       DBASE            * DBERR 19 *   153664
     C                     OUT  LDA                        ************   153664
     C                     EXSR *PSSR                                     153664
     C                     ENDIF                                          153664
      *                                                                   153664
     C                     Z-ADDA6NBDP    ZDECS                           153664
     C           A6NBDP    ADD  4         P                               153664
      *                                                                   153664
      **  Details on fees master file indicator.                          153664
      *                                                                   153664
     C                     MOVE '1'       *IN14                           153664
      *                                                                   157532
      ** Initialize amount and set up key to be used by SR/SETTLE         157532
      *                                                                   157532
     C                     Z-ADD0         WPDUE                           157532
     C                     MOVE FEBRCA    KBRCA                           157532
     C**********           Z-ADDFECNUM    KCNUM                                        157532 CSD027
     C                     MOVE FECNUM    KCNUM                                               CSD027
     C                     Z-ADDFEFACL    KFACL                           157532
     C**********           Z-ADDFELOAN    KLOAN                                        157532 CLE148
     C                     MOVELFELOAN    KLOAN                                               CLE148
      *                                                                   153664
      **  If this is a calculated fee there may be a settlement or        153664
      **  adjustment for this fee which affects the output amounts.       153664
      *                                                                   153664
     C           FECALT    IFNE ' '                                       153664
      *                                                                   153664
     C                     EXSR SETTLE                                    153664
      *                                                                   153664
     C                     ELSE                                           153664
      *                                                                   153664
      **  Set up settlement amount field                                  153664
      *                                                                   153664
     C           FEAMTS    IFEQ *ZEROS                                    153664
     C                     MOVE *BLANKS   SFSAMT                          153664
     C                     ELSE                                           153664
     C                     Z-ADDFEAMTS    ZFLD15                          153664
     C**********           Z-ADDZFLD15    WFLD15 150                                   204302 245329
     C**********           EXSR ZFRPED                                                 153664 245329
     C**********           MOVE ZOUT25    SFSAMT                                       153664 245329
      *                                                                   153664
     C                     EXSR SRSIGN                                    153664
     C**********           MOVE WSIGN     SFSIGN                                       153664 245329
     C********** WSIGN     IFEQ '-'                                                    245329 246344
     C**********           MULT -1        ZFLD15                                       245329 246344
     C**********           ENDIF                                                       245329 246344
     C                     Z-ADDZFLD15    WFLD15 150                                          245329
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                                        245329
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SFSAMT                                      245329  250989
     C**********           MOVE ZOUT20    SFSAMT                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SFSAMT                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     ENDIF                                          153664
      *                                                                   153664
     C                     ENDIF                                          153664
      *                                                                   153664
      ** If SAR CLE005 is Present                                         153664
      *                                                                   153664
     C           *IN30     IFEQ *ON                                       153664
      *                                                                   153664
      ** Format Fee Indicator                                             153664
      *                                                                   153664
     C                     MOVEL*BLANKS   SFPTFI                          153664
     C           PTFI      IFEQ *BLANKS                                   153664
     C                     MOVEL'R'       SFPTFI                          153664
     C                     ENDIF                                          153664
     C           PTFI      IFEQ 'P'                                       153664
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVEL'P'       SFPTFI                          153664
     C                     ENDIF                                          153664
     C           PTFI      IFEQ 'I'                                       153664
     C                     MOVEL'I'       SFPTFI                          153664
     C                     ENDIF                                          153664
      *                                                                   153664
     C                     ENDIF                                          153664
      *                                                                   153664
      ***Format*fee*settlement*date*for*output*to*the*screen.******                    153664 243497
      **********                                                                       153664 243497
     C********** FESDAT    IFEQ *ZEROS                                                 153664 243497
     C                     MOVE *BLANKS   SFSDAT                          153664
     C**********           ELSE                                                        153664 243497
     C**********           Z-ADDFESDAT    ZDAYNO                                       153664 243497
     C**********           EXSR ZDATE2                                                 153664 243497
     C**********           MOVE ZADATE    SFSDAT                                       153664 243497
     C**********           ENDIF                                                       153664 243497
      *                                                                   153664
      ***Format*outstanding*fee*amount.*************************** 153664 157532
      *                                                                   153664
     C***********FECALT    IFEQ *BLANKS                            154104 157532
      *                                                                   154104
     C***********          Z-ADDFEAMTO    ZFLD15                   154104 157532
      *                                                                   154104
     C***********          ELSE                                    154104 157532
      *                                                                   154104
      ***For*calculated*fees*based*on*averages,*need*to*calculate* 154104 157532
      ***what*the*value*would*be*if*today*was*payment*date******** 154104 157532
      *                                                                   154104
     C***********FECALT    IFEQ '01'                               154104 157532
     C***********FECALT    OREQ '02'                               154104 157532
     C***********FECALT    OREQ '03'                               154104 157532
     C***********FECALT    OREQ '11'                               154104 157532
     C***********FECALT    OREQ '12'                               154104 157532
     C***********FECALT    OREQ '13'                               154104 157532
     C***********FECALT    OREQ '21'                               154104 157532
     C***********          EXSR AVCALC                             154104 157532
     C***********          Z-ADDWFEE      ZFLD15                   154104 157532
     C***********          ADD  FELPAM    ZFLD15                   154104 157532
     C***********          ADD  FEAMTP    ZFLD15                   154104 157532
     C***********          ELSE                                    154104 157532
     C***********          EXSR AVCALC                             154104 157532
     C***********WFEE      ADD  FEADAT    ZFLD15                   154104 157532
     C***********          ADD  FELPAM    ZFLD15                   154104 157532
     C***********          ADD  FEAMTP    ZFLD15                   154104 157532
     C***********          ENDIF                                   154104 157532
      *                                                                   154104
     C***********          ENDIF                                   154104 157532
      *                                                                   154104
      ** Format amount due/past due amount for noncalculated fees.        157532
      **    For calculated fees, calculation is done by SR/SETTLE.        157532
      *                                                                   157532
     C           FECALT    IFEQ *BLANKS                                   157532
     C                     Z-ADDFEAMTP    ZFLD15                          157532
      *                                                                                       CLE134
      ** suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     ADD  FESFA     ZFLD15                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     Z-ADDFEAMTP    WPDUE                           157532
     C***********FEAMTO    IFEQ *ZEROS                             153664 154104
     C           ZFLD15    IFEQ *ZEROS                                    154104
     C                     MOVE *BLANKS   SFOAMT                          153664
     C                     ELSE                                           153664
     C***********          Z-ADDFEAMTO    ZFLD15                   153664 154104
     C                     Z-ADDZFLD15    WFLD15 150                                          204302
     C                     EXSR ZFRPED                                    153664
     C**********           MOVE ZOUT25    SFOAMT                                     153664 AR588683
     C**********           MOVE ZOUT20    SFOAMT                                   AR588683 AR690561
     C                     MOVE ZOUT21    SFOAMT                                            AR690561
     C                     EXSR SRSIGN                                    153664
     C                     MOVE WSIGN     SFSGN2                          153664
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     ENDIF                                          153664
     C                     ENDIF                                          157532
      *                                                                   153664
     C                     MOVE FEBRCA    SFBRCA                          153664
     C                     MOVE FECNUM    SFCNUM                          153664
      *If the loan is a Participation Purchased, & System Value                               207629
      * LoanCustOriginPurch = 'O', use Original Borrower:                                     207629
     C********** FELOAN    IFNE 0                                                      207629 CLE148
     C           FELOAN    IFNE *BLANKS                                                       CLE148
     C           PPCUST    ANDEQ'O'                                                           207629
     C                     MOVE FELOAN    WLOAN                                               207629
     C                     MOVE 'A'       WCLRT                                               207629
     C           KEY005    CHAINCLOAN                79                                       207629
     C           *IN79     IFEQ '0'                                                           207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C                     MOVE OLNO      SFCNUM                                              207629
     C                     MOVE FECNUM    OFCNUM                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     MOVE FEFACL    SFFREF                          153664
     C                     MOVE FEFSEQ    SFFSEQ                          153664
     C                     MOVE FEFCOD    SFFCOD                          153664
     C                     MOVE *BLANKS   SFSTAT                          153664
      *                                                                   153664
      ** Move the record id into the screen field                         153664
      *                                                                   153664
     C           FERECI    IFNE 'D'                                       153664
     C                     MOVE FERECI    SFRECI                          153664
     C                     ELSE                                           153664
     C                     MOVE ' '       SFRECI                          153664
     C                     ENDIF                                          153664
      *                                                                   153664
      ** If the settlement date is blank format the due date              153664
      ** according to the payment on indicator                            153664
      *                                                                   153664
     C           SFSDAT    IFEQ *BLANKS                                   153664
     C           FEPYON    IFEQ 'S'                                       153664
     C           FEPYON    OREQ ' '                                       153664
     C                     Z-ADDFEPSTD    ZDAYNO                          153664
     C                     ENDIF                                          153664
      *                                                                   153664
     C           FEPYON    IFEQ 'E'                                       153664
     C                     Z-ADDFEPEND    ZDAYNO                          153664
     C                     ENDIF                                          153664
      *                                                                   153664
     C           FEPYON    IFEQ 'N'                                       153664
     C           FEDDAT    IFEQ 0                                                             243497
     C           FESDAT    IFEQ 0                                                             243497
     C           FENPYD    IFNE 0                                         153664
     C                     Z-ADDFENPYD    ZDAYNO                          153664
     C                     ELSE                                           153664
     C                     Z-ADDFEPEND    ZDAYNO                          153664
     C                     ENDIF                                          153664
     C                     ELSE                                                               243497
     C                     Z-ADDFESDAT    ZDAYNO                                              243497
     C                     ENDIF                                                              243497
     C                     ELSE                                                               243497
     C                     Z-ADDFEDDAT    ZDAYNO                                              243497
     C                     ENDIF                                                              243497
     C                     ENDIF                                          153664
      *                                                                   153664
     C                     EXSR ZDATE2                                    153664
     C                     MOVE ZADATE    SFSDAT                          153664
     C                     ENDIF                                          153664
      *                                                                   153664
      ** Load up subfile record.                                          153664
      *                                                                   153664
     C                     WRITESFLRCD                                    153664
      *                                                                   153664
     C***********          ADD  FEAMTO    WIPNET                   153664 156886
     C***********          ADD  ZFLD15    WIPNET                   156886 157532
     C                     ADD  WPDUE     WIPNET                          157532
      *                                                                   153664
     C                     ADD  1         RRN                             153664
      *                                                                   153664
      **  Clear previous fee adjustment amount so that it is not          153664
      **  carried forward to processing of next fee record                153664
      *                                                                   153664
     C                     Z-ADD0         FASADJ                          153664
      *                                                                   153664
     C**********           ENDIF                                   153664 181729
      *                                                                   153664
     C**********           READ LEFEED4F                 21        153664 181729
     C           KLEFID    READELEFEED1F                 21               181729
      *                                                                   153664
     C                     ENDDO                                          153664
      *                                                                   153664
      ** Retrieve details of matured fees for participant facilities      187268
      *                                                                   187268
     C                     MOVE '0'       *IN21                           187268
      *                                                                   187268
     C           KFEHIS    SETLLLEFHSTF                                   187268
     C           KFEHIS    READELEFHSTF                  21               187268
      *                                                                   187268
     C           *IN21     DOWEQ'0'                                       187268
      *                                                                   187268
      ** Set up fields for output to subfile record.                      187268
      *                                                                   187268
     C           HIRECI    IFEQ 'M'                                       187268
      *                                                                   187268
     C                     MOVE HIBRCA    SFBRCA                          187268
     C                     MOVE HICNUM    SFCNUM                          187268
      *If the loan is a Participation Purchased, & System Value                               207629
      * LoanCustOriginPurch = 'O', use Original Borrower:                                     207629
     C********** WLNRF     IFNE 0                                                      207629 CLE148
     C           WLNRF     IFNE *BLANKS                                                       CLE148
     C           PPCUST    ANDEQ'O'                                                           207629
     C                     MOVE WLNRF     WLOAN                                               207629
     C                     MOVE 'A'       WCLRT                                               207629
     C           KEY005    CHAINCLOAN                79                                       207629
     C           *IN79     IFEQ '0'                                                           207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C                     MOVE OLNO      SFCNUM                                              207629
     C**********           MOVE HICNUM    OFCNUM  60                                   207629 CSD027
     C                     MOVE HICNUM    OFCNUM  6                                           CSD027
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     MOVE HIFACL    SFFREF                          187268
     C                     MOVE HIFSEQ    SFFSEQ                          187268
     C                     MOVE HIFCOD    SFFCOD                          187268
      *                                                                   187268
      ** Set up decimal places from ccy on history record                 187268
      *                                                                   187268
     C                     CALL 'AOCURRR0'                                187268
     C                     PARM '*MSG   ' WRTCD   7                       187268
     C                     PARM '*KEY   ' WOPTN   7                       187268
     C                     PARM HIFCCY    K101    3                       187268
     C           SDCURR    PARM SDCURR    DSSDY                           187268
      *                                                                   187268
      ** Error if currency not found.                                     187268
      *                                                                   187268
     C           WRTCD     IFNE *BLANKS                                   187268
     C           *LOCK     IN   LDA                                       187268
     C                     MOVEL'LER115  'DBPGM                           187268
     C                     MOVE 'SDCURRPD'DBFILE           ************   187268
     C                     Z-ADD20        DBASE            * DBERR 20 *   187268
     C                     MOVELHIFCCY    DBKEY            ************   187268
     C                     OUT  LDA                                       187268
     C                     EXSR *PSSR                                     187268
     C                     END                                            187268
      *                                                                   187268
      ** Format settlement amount for output using decimal places         187268
      ** retrieved from currency file.                                    187268
      *                                                                   187268
     C                     MOVE *BLANK    SFSIGN                          187268
     C           HIAMTS    IFEQ *ZEROS                                    187268
     C                     MOVE *BLANKS   SFSAMT                          187268
     C                     ELSE                                           187268
      *                                                                   187268
     C                     Z-ADDHIAMTS    AMTTMP 150                      187268
     C           HIAMTS    IFLT 0                                         187268
     C                     Z-SUBHIAMTS    AMTTMP                          187268
     C                     ELSE                                           187268
     C                     MOVE '-'       SFSIGN                          187268
     C                     ENDIF                                          187268
      *                                                                   187268
     C                     Z-ADDAMTTMP    ZFLD15                          187268
     C                     Z-ADDA6NBDP    ZDECS                           187268
     C**********           Z-ADDZFLD15    WFLD15                                       204302 245329
     C**********           EXSR ZFRPED                                                 187268 245329
     C**********           MOVE ZOUT25    SFSAMT                                       187268 245329
     C           SFSIGN    IFEQ '-'                                                           245329
     C                     MULT -1        ZFLD15                                              245329
     C                     ENDIF                                                              245329
     C                     MOVEL*BLANKS   SFSIGN                                              245329
     C                     Z-ADDZFLD15    WFLD15                                              245329
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                                        245329
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SFSAMT                                       245329 250989
     C**********           MOVE ZOUT20    SFSAMT                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SFSAMT                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C                     Z-ADDWFLD15    ZFLD15                                              204302
      *                                                                   187268
     C                     ENDIF                                          187268
      *                                                                   187268
      ** Format settlement date for output to screen.                     187268
      *                                                                   187268
     C           HIHDAT    IFEQ *ZEROS                                    187268
     C                     MOVE *BLANKS   SFSDAT                          187268
     C                     ELSE                                           187268
     C                     Z-ADDHIHDAT    ZDAYNO                          187268
     C                     EXSR ZDATE2                                    187268
     C                     MOVE ZADATE    SFSDAT                          187268
     C                     END                                            187268
      *                                                                   187268
      ** For history records the amount due/past due should be zero.      187268
      *                                                                   187268
     C                     MOVE *BLANKS   SFOAMT                          187268
      *                                                                   187268
      ** Historical record                                                187268
      *                                                                   187268
     C                     MOVE 'H'       SFSTAT                          187268
     C                     MOVE *BLANK    SFPTFI                          187268
     C                     MOVE HIRECI    SFRECI                          187268
      *                                                                   187268
      ** Load up subfile record.                                          187268
      *                                                                   187268
     C********** HILCHD    IFGT HIHDAT                                             AR753180 MD043383
     C********** BKANWD    ANDEQ'0'                                                AR753180 MD043383
     C********** HILCHD    ORGT HIHDAT                                             AR753180 MD043383
     C********** BKANWD    ANDEQ'1'                                                AR753180 MD043383
     C                     WRITESFLRCD                                    187268
      *                                                                   187268
     C                     ADD  1         RRN                             187268
      *                                                                   187268
     C**********           ENDIF                                                   AR753180 MD043383
     C                     ENDIF                                          187268
      *                                                                   187268
     C           KFEHIS    READELEFHSTF                  21               187268
      *                                                                   187268
     C                     ENDDO                                          187268
      *                                                                   187268
     C           KLEFCL    READEFCLTYFPF                 26               181729
     C                     ENDDO                                          181729
      *                                                                   181729
     C                     MOVE 'N'       WPRTC                           157532
      *                                                                   157532
     C                     ENDSR                                          153664
      *
      *****************************************************************
      *                                                               *
      *  SETTLE - Subroutine to perform settlement amendments if      *
      *           record found on LF/LEFEADL2                         *
      *                                                               *
      *  Called By: PROCES                                            *
      *  Calls:     ZDATE2, ZFRPED                                    *
      *                                                               *
      *****************************************************************
      *
     C           SETTLE    BEGSR
      *
      ** Non-calculated facility fees or loan fees cannot be
      ** settled/adjusted so this processing is only for calculated
      ** facility fees.
      *
     C                     MOVE WBRCA     FABRCA
     C**********           Z-ADDWCNUM     FACNUM                                              CSD027
     C                     MOVE WCNUM     FACNUM                                              CSD027
     C                     Z-ADDWFREF     FAFACL
     C**********           Z-ADDWLNRF     FALOAN                                              CLE148
     C                     MOVELWLNRF     FALOAN                                              CLE148
     C                     Z-ADDFEFSEQ    FAFSEQ
     C/COPY WNCPYSRC,LER115C003
      *
      ** If this subroutine was called from SR/SRPRTC, then the key       157532
      ** should be set to the participant key.                            157532
      *                                                                   157532
     C           WPRTC     IFEQ 'Y'                                       157532
     C********** KEY004    CHAINLEFEADL2             12                   157532              203765
     C           KEY004    SETLLLEFEADL2                                                      203765
     C           KEY004    READELEFEADL2                 12                                   203765
     C                     ELSE                                           157532
     C********** KEY003    CHAINLEFEADL2             12                                       203765
     C           KEY003    SETLLLEFEADL2                                                      203765
     C           KEY003    READELEFEADL2                 12                                   203765
     C                     ENDIF                                          157532
      *                                                                                       203765
      ** To check if there is a live record in PF/LEFEEAD.                                    203765
      ** Indicator 12 will be off if there is a live record in LEFEEAD.                       203765
      *                                                                                       203765
     C           FARECI    DOWEQ'*'                                                           203765
     C           *IN12     ANDEQ'0'                                                           203765
      *                                                                                       203765
     C           WPRTC     IFEQ 'Y'                                                           203765
     C           KEY004    READELEFEADL2                 12                                   203765
     C                     ELSE                                                               203765
     C           KEY003    READELEFEADL2                 12                                   203765
     C                     ENDIF                                                              203765
      *                                                                                       203765
     C                     ENDDO                                                              203765
      *
      ** A live record in LEFEEAD has been found                                              203765
      *                                                                                       203765
     C           *IN12     IFEQ '0'
     C           FARECI    ANDNE'*'                                       BH3414
      *                                                                                       203765
     C                     Z-ADD*ZEROS    WFSAMT 130                                          203765
     C                     Z-ADD*ZEROS    WFOAMT 130                                          203765
     C                     MOVE *BLANKS   SFSDAT                                              203765
     C                     MOVE *BLANKS   SFSAMT                                              203765
     C                     MOVE *BLANKS   SFOAMT                                              203765
     C                     MOVE ' '       WFULL                                               203765
     C                     MOVE '0'       *IN12                                               203765
      *                                                                                       204409
      ** Initialise Write off amount field                                                    204409
      *                                                                                       203765
     C           FEAMTW    IFGT 0                                                             204409
     C                     Z-ADDFEAMTW    ZFLD15                                              204409
     C**********           Z-ADDZFLD15    WFLD15                                       243496 245803
     C                     Z-ADDZFLD15    WFLD15                                             243496B
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                                        204409
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SWOFFA                                       204409 250989
     C**********           MOVE ZOUT20    SWOFFA                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SWOFFA                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           Z-ADDWFLD15    ZFLD15                                       243496 245803
     C                     Z-ADDWFLD15    ZFLD15                                             243496B
     C                     ENDIF                                                              204409
      *                                                                                       204409
     C           WPRTC     IFEQ 'Y'                                                           203765
     C           KEY004    SETLLLEFEADL2                                                      203765
     C                     ELSE                                                               203765
     C           KEY003    SETLLLEFEADL2                                                      203765
     C                     ENDIF                                                              203765
      *                                                                                       203765
      ** Read all live settlement record in LEFEEAD                                           203765
      *                                                                                       203765
     C           *IN12     DOWEQ'0'                                                           203765
      *                                                                                       203765
     C           WPRTC     IFEQ 'Y'                                                           203765
     C           KEY004    READELEFEADL2                 12                                   203765
     C                     ELSE                                                               203765
     C           KEY003    READELEFEADL2                 12                                   203765
     C                     ENDIF                                                              203765
      *                                                                                       203765
     C           *IN12     IFEQ '0'                                                           203765
     C           FARECI    ANDNE'*'                                                           203765
      *
      ** If a record is found and it is a settlement the settlement
      ** date should be run date (the fee settlement/adjustment file
      ** is set up on a daily basis), and the settlement amount should
      ** be the settlement/adjustment amount plus the total fee amount
      ** settled from the fees master file.
      **
     C           FARECI    IFEQ 'S'
      *
     C           FEDDAT    IFEQ 0                                                             243497
     C                     Z-ADDBJRDNB    ZDAYNO
     C                     ELSE                                                               243497
     C                     Z-ADDFEDDAT    ZDAYNO                                              243497
     C                     ENDIF                                                              243497
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SFSDAT
      *
      ** Compute the Settlement amount                                                        203765
      *                                                                                       203765
     C********** FASADJ    ADD  FEAMTS    WFIELD 130                                          203765
     C           FATYPE    IFEQ 'F'                                                           204409
     C           FATYPE    OREQ 'P'                                                           204409
     C                     ADD  FASADJ    WFSAMT                                              203765
     C           WFSAMT    ADD  FEAMTS    WFIELD 130                                          203765
      *                                                                                       203765
     C           WFIELD    IFEQ *ZEROS
     C                     MOVE *BLANKS   SFSAMT
     C                     ELSE
     C                     Z-ADDWFIELD    ZFLD15
     C**********           Z-ADDZFLD15    WFLD15                                       243496 245329
     C**********           EXSR ZFRPED                                                        245329
     C**********           MOVE ZOUT25    SFSAMT                                              245329
     C                     EXSR SRSIGN                                    153664
     C**********           MOVE WSIGN     SFSIGN                                       153664 245329
     C********** WSIGN     IFEQ '-'                                                    245329 246344
     C**********           MULT -1        ZFLD15                                       245329 246344
     C**********           ENDIF                                                       245329 246344
     C                     Z-ADDZFLD15    WFLD15                                              245329
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                                        245329
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SFSAMT                                       245329 250989
     C**********           MOVE ZOUT20    SFSAMT                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SFSAMT                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           Z-ADDWFLD15    ZFLD15                                       243496 245803
     C                     Z-ADDWFLD15    ZFLD15                                             243496B
     C                     END
      *                                                                                       204409
     C                     ELSE                                                               204409
     C           FEAMTS    ADD  WFSAMT    WFIELD                                              204409
      *                                                                                       204409
     C           WFIELD    IFEQ *ZEROS                                                        204409
     C                     MOVE *BLANKS   SFSAMT                                              204409
     C                     ELSE                                                               204409
     C                     Z-ADDWFIELD    ZFLD15                                              204409
     C**********           Z-ADDZFLD15    WFLD15                                       243496 245329
     C**********           EXSR ZFRPED                                                 204409 245329
     C**********           MOVE ZOUT25    SFSAMT                                       204409 245329
     C                     EXSR SRSIGN                                                        204409
     C**********           MOVE WSIGN     SFSIGN                                       204409 245329
     C********** WSIGN     IFEQ '-'                                                    245329 246344
     C**********           MULT -1        ZFLD15                                       245329 246344
     C**********           ENDIF                                                       245329 246344
     C                     Z-ADDZFLD15    WFLD15                                              245329
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                                        245329
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SFSAMT                                      245329  259989
     C**********           MOVE ZOUT20    SFSAMT                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SFSAMT                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           Z-ADDWFLD15    ZFLD15                                       243496 245803
     C                     Z-ADDWFLD15    ZFLD15                                             243496B
     C                     ENDIF                                                              204409
     C                     ENDIF                                                              204409
      *
      ** The outstanding amount depends on what type of settlement this
      ** is - if it is a complete write off then the outstanding amount
      ** should be zero.  If it is a partial settlement then it
      ** should be zero.
      *
     C           FATYPE    IFEQ 'F'
     C                     MOVE 'Y'       WFULL                                               203765
     C                     MOVE *BLANKS   SFOAMT
     C                     Z-ADD0         WPDUE                           157532
     C                     END
      *
     C           FATYPE    IFEQ 'P'
     C           FATYPE    OREQ 'W'                                       157532
     C***********FEAMTO    SUB  FASADJ    WFIELD                          154104
     C***********          EXSR SROSAM                             154104 157532
     C***********ZFLD15    SUB  FASADJ    WFIELD                   154104 157532
      *                                                                                       203765
      ** Calculate the past due amount                                                        203765
      *                                                                                       203765
     C********** FEAMTP    SUB  FASADJ    WFIELD                          157532              203765
     C                     ADD  FASADJ    WFOAMT                                              203765
     C           FEAMTP    SUB  WFOAMT    WFIELD                                              203765
      *                                                                                       CLE134
      ** suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     ADD  FESFA     WFIELD                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     Z-ADDWFIELD    WPDUE                           157532
     C           WFIELD    IFEQ *ZEROS
     C           WFULL     OREQ 'Y'                                                           203765
     C                     MOVE *BLANKS   SFOAMT
     C                     ELSE
     C                     Z-ADDWFIELD    ZFLD15
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     EXSR ZFRPED
     C**********           MOVE ZOUT25    SFOAMT                                            AR588683
     C**********           MOVE ZOUT20    SFOAMT                                   AR588683 AR690561
     C                     MOVE ZOUT21    SFOAMT                                            AR690561
     C                     EXSR SRSIGN                                    157532
     C                     MOVE WSIGN     SFSGN2                          157532
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
     C                     END
      *
     C                     END
      *
      ** If a record is found on the settlement/adjustment file but it
      ** is not a settlement, i.e., it is an adjustment, then the
      ** screen settlement date and settlement amount should be blank
      ** and the screen outstanding amount should be the outstanding
      ** amount minus the adjustment amount.
      *
     C           FARECI    IFNE 'S'
      *
     C**********           MOVE *BLANKS   SFSDAT                                              203765
     C**********           MOVE *BLANKS   SFSAMT                                              203765
     C***********          EXSR SROSAM                             154104 157532
      *
     C***********FASIGN    IFEQ '-'                                BH3414 157532
     C***********FEAMTO    SUB  FASADJ    WFIELD                          154104
     C***********ZFLD15    SUB  FASADJ    WFIELD                   154104 157532
     C***********          ELSE                                    BH3414 157532
     C***********FEAMTO    ADD  FASADJ    WFIELD                   BH3414 154104
     C***********ZFLD15    ADD  FASADJ    WFIELD                   154104 157532
     C***********          END                                     BH3414 157532
     C*                                                                  BH3414
      *                                                                   157532
      ** The adjustment field has no effect on 'amount due/past due'      157532
      ** field if the record is not settlement.                           157532
      *                                                                   157532
     C**********           Z-ADDFEAMTP    WFIELD                          157532              203765
     C**********           Z-ADDFEAMTP    WPDUE                           157532              203765
     C           FEAMTP    SUB  WFOAMT    WFIELD                                              203765
     C           FEAMTP    SUB  WFOAMT    WPDUE                                               203765
      *                                                                                       CLE134
      ** suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     ADD  FESFA     WFIELD                                              CLE134
     C                     ADD  FESFA     WPDUE                                               CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       203765
     C           WFIELD    IFEQ *ZEROS
     C           WFULL     OREQ 'Y'                                                           203765
     C                     MOVE *BLANKS   SFOAMT
     C                     ELSE
     C                     Z-ADDWFIELD    ZFLD15
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     EXSR ZFRPED
     C**********           MOVE ZOUT25    SFOAMT                                            AR588683
     C**********           MOVE ZOUT20    SFOAMT                                   AR588683 AR690561
     C                     MOVE ZOUT21    SFOAMT                                            AR690561
     C                     EXSR SRSIGN                                    153664
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     MOVE WSIGN     SFSIGN                          153664
     C                     END
     C                     END
      *                                                                                       203765
     C                     ENDIF                                                              203765
      *                                                                                       203765
     C                     ENDDO                                                              203765
      *
      ** If record not found on the settlement/adjustment file then
      ** use details from the fees master file to set up the screen
      ** output fields.
      *
     C                     ELSE
      *
      ** If no record found on LEFEEAD zeroise FASADJ which may contain   153736
      ** value from previous or deleted record.                           153736
      *                                                                   153736
     C                     Z-ADD0         FASADJ                          153736
      *                                                                   153736
     C           FEAMTS    IFEQ *ZEROS
     C                     MOVE *BLANKS   SFSAMT
     C                     ELSE
     C                     Z-ADDFEAMTS    ZFLD15
     C**********           Z-ADDZFLD15    WFLD15                                       204302 245329
     C**********           EXSR ZFRPED                                                        245329
     C**********           MOVE ZOUT25    SFSAMT                                              245329
     C                     EXSR SRSIGN                                    153664
     C**********           MOVE WSIGN     SFSIGN                                       153664 245329
     C********** WSIGN     IFEQ '-'                                                    245329 246344
     C**********           MULT -1        ZFLD15                                       245329 246344
     C**********           ENDIF                                                       245329 246344
     C                     Z-ADDZFLD15    WFLD15                                              245329
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                                        245329
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SFSAMT                                      245329  250989
     C**********           MOVE ZOUT20    SFSAMT                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SFSAMT                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *
     C********** FESDAT    IFEQ *ZEROS                                                        243497
     C                     MOVE *BLANKS   SFSDAT
     C**********           ELSE                                                               243497
     C**********           Z-ADDFESDAT    ZDAYNO                                              243497
     C**********           EXSR ZDATE2                                                        243497
     C**********           MOVE ZADATE    SFSDAT                                              243497
     C**********           END                                                                243497
      *
     C***********          EXSR SROSAM                             154104 157532
     C***********FEAMTO    IFEQ *ZEROS                                    154104
     C                     Z-ADDFEAMTP    ZFLD15                          157532
      *                                                                                       CLE134
      ** suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     ADD  FESFA     ZFLD15                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     Z-ADDFEAMTP    WPDUE                           157532
     C           ZFLD15    IFEQ *ZEROS                                    154104
     C                     MOVE *BLANKS   SFOAMT
     C                     ELSE
     C***********          Z-ADDFEAMTO    ZFLD15                          154104
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     EXSR ZFRPED
     C**********           MOVE ZOUT25    SFOAMT                                            AR588683
     C**********           MOVE ZOUT20    SFOAMT                                   AR588683 AR690561
     C                     MOVE ZOUT21    SFOAMT                                            AR690561
     C                     EXSR SRSIGN                                    157532
     C                     MOVE WSIGN     SFSGN2                          157532
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************                       CLE134
      *                                                               *                       CLE134
      *  SRFSUS - Edit Fields for suspended fees                      *                       CLE134
      *                                                               *                       CLE134
      *****************************************************************                       CLE134
      *                                                                                       CLE134
     C           SRFSUS    BEGSR                                                              CLE134
      *                                                                                       CLE134
     C                     MOVE *BLANKS   SFTSUS                                              CLE134
     C                     MOVE *BLANKS   SFMAXA                                              CLE134
     C                     MOVE *BLANKS   SFEFPA                                              CLE134
     C                     MOVE *BLANKS   SFEFMC                                              CLE134
     C                     MOVE *BLANKS   SFPSIN                                              CLE134
     C                     MOVE *BLANKS   SFMAXA                                              CLE134
      *                                                                                       CLE134
     C                     MOVE FEFEMC    SFEFMC                                              CLE134
      *                                                                                       CLE134
      ** suspended amount                                                                     CLE134
      *                                                                                       CLE134
     C           FESFA     IFNE *ZEROS                                                        CLE134
     C                     Z-ADDFESFA     ZFLD15                                              CLE134
     C                     Z-ADDZFLD15    WFLD15                                              CLE134
     C                     MOVE 'J'       ZECODE                                              CLE134
     C                     EXSR ZFRPED                                                        CLE134
     C********** ZNEG      IFEQ '-'                                                  CLE134 AR690561
     C**********           MOVE ZOUT20    SFTSUS                                     CLE134 AR690561
     C**********           ELSE                                                      CLE134 AR690561
     C                     MOVE ZOUT21    SFTSUS                                              CLE134
     C**********           ENDIF                                                     CLE134 AR690561
     C                     Z-ADDWFLD15    ZFLD15                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           FEFPPA    IFNE *BLANKS                                                       CLE134
     C                     MOVE FEFPPA    SFEFPA                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** partial payment indicator                                                            CLE134
      *                                                                                       CLE134
     C           FEPSIN    IFNE *BLANKS                                                       CLE134
     C                     MOVE FEPSIN    SFPSIN                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** if Early Matured indicator is S (Subsequent payments)                                CLE134
      *                                                                                       CLE134
     C           FEFEMC    IFEQ 'S'                                                           CLE134
     C           FEPSIN    ANDNE*BLANKS                                                       CLE134
      *                                                                                       CLE134
      ** set partial limit indicator                                                          CLE134
      *                                                                                       CLE134
     C                     MOVE FEPSIN    SFPSIN                                              CLE134
      *                                                                                       CLE134
      ** edit partial limit                                                                   CLE134
      *                                                                                       CLE134
     C                     CLEARSFMAXA                                                        CLE134
     C                     Z-ADDZDECS     ZDECSV  10                                          CLE134
      *                                                                                       CLE134
     C           FEPSLM    IFNE *ZEROS                                                        CLE134
      *                                                                                       CLE134
      ** partial limit P = Percentage                                                         CLE134
      *                                                                                       CLE134
     C           FEPSIN    IFEQ 'P'                                                           CLE134
     C                     Z-ADD2         ZDECS                                               CLE134
     C                     END                                                                CLE134
     C                     Z-ADDFEPSLM    ZFLD15                                              CLE134
     C                     Z-ADDZFLD15    WFLD15                                              CLE134
     C                     MOVE 'J'       ZECODE                                              CLE134
     C                     EXSR ZFRPED                                                        CLE134
     C********** ZNEG      IFEQ '-'                                                  CLE134 AR690561
     C**********           MOVE ZOUT20    SFPSLM                                     CLE134 AR690561
     C**********           ELSE                                                      CLE134 AR690561
     C                     MOVE ZOUT21    SFPSLM                                              CLE134
     C**********           ENDIF                                                     CLE134 AR690561
     C                     Z-ADDWFLD15    ZFLD15                                              CLE134
     C                     Z-ADDZDECSV    ZDECS                                               CLE134
     C                     ENDIF                                                              CLE134
     C           FEPSIN    IFEQ 'P'                                                           CLE134
     C                     MOVE SFPSLM    WFL10  10                                           CLE134
     C                     MOVELWFL10     WFL11  11                                           CLE134
     C                     MOVE '%'       WFL11                                               CLE134
     C                     MOVE WFL11     SFPSLM                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** set Nr of suspended payments                                                         CLE134
      *                                                                                       CLE134
     C           FEFEMC    IFEQ 'S'                                                           CLE134
     C           FEFEMC    OREQ 'T'                                                           CLE134
     C                     Z-ADDZDECS     ZDECSV  10                                          CLE134
     C                     Z-ADD0         ZDECS                                               CLE134
      *                                                                                       CLE134
     C                     CLEARSFMAXA                                                        CLE134
     C                     CLEARZFLD15                                                        CLE134
     C           FESFPM    IFNE *ZEROS                                                        CLE134
     C                     Z-ADDFESFPM    ZFLD15                                              CLE134
     C                     Z-ADD0         ZDECS                                               CLE134
     C                     Z-ADDZFLD15    WFLD15                                              CLE134
     C                     MOVE 'J'       ZECODE                                              CLE134
     C                     EXSR ZFRPED                                                        CLE134
     C********** ZNEG      IFEQ '-'                                                  CLE134 AR690561
     C**********           MOVE ZOUT20    SFMAXA                                     CLE134 AR690561
     C**********           ELSE                                                      CLE134 AR690561
     C                     MOVE ZOUT21    SFMAXA                                              CLE134
     C**********           ENDIF                                                     CLE134 AR690561
     C                     Z-ADDWFLD15    ZFLD15                                              CLE134
     C                     Z-ADDZDECSV    ZDECS                                               CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** suspended payments                                                                   CLE134
      *                                                                                       CLE134
     C           FESFP     IFNE *ZEROS                                                        CLE134
     C                     CLEARSSUSP                                                         CLE134
     C                     Z-ADD0         ZDECS                                               CLE134
     C                     Z-ADDFESFP     ZFLD15                                              CLE134
     C                     Z-ADDZFLD15    WFLD15                                              CLE134
     C                     MOVE 'J'       ZECODE                                              CLE134
     C                     EXSR ZFRPED                                                        CLE134
     C********** ZNEG      IFEQ '-'                                                  CLE134 AR690561
     C**********           MOVE ZOUT20    SSUSP                                      CLE134 AR690561
     C**********           ELSE                                                      CLE134 AR690561
     C                     MOVE ZOUT21    SSUSP                                               CLE134
     C**********           ENDIF                                                     CLE134 AR690561
     C                     Z-ADDWFLD15    ZFLD15                                              CLE134
     C                     Z-ADDZDECSV    ZDECS                                               CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** max suspended payments allowed                                                       CLE134
      *                                                                                       CLE134
     C           FEFEMC    IFEQ 'A'                                                           CLE134
     C                     CLEARSFMAXA                                                        CLE134
     C           FESFAM    IFNE *ZEROS                                                        CLE134
     C                     Z-ADDFESFAM    ZFLD15                                              CLE134
     C                     Z-ADDZFLD15    WFLD15                                              CLE134
     C                     MOVE 'J'       ZECODE                                              CLE134
     C                     EXSR ZFRPED                                                        CLE134
     C********** ZNEG      IFEQ '-'                                                  CLE134 AR690561
     C**********           MOVE ZOUT20    SFMAXA                                     CLE134 AR690561
     C**********           ELSE                                                      CLE134 AR690561
     C                     MOVE ZOUT21    SFMAXA                                              CLE134
     C**********           ENDIF                                                     CLE134 AR690564
     C                     Z-ADDWFLD15    ZFLD15                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDSR                                                              CLE134
      *
      *****************************************************************
      *                                                               *
      *  DETLSR - Subroutine to display record details                *
      *                                                               *
      *  Called By: PROCES                                            *
      *  Calls:     DETSCR                                            *
      *                                                               *
      *****************************************************************
      *
     C           DETLSR    BEGSR
      *
     C                     MOVE '0'       *IN16
      *
      ** Check for selected subfile records until F12 (previous) is
      ** pressed.
      *
     C           *INKL     DOWEQ'0'
     C           *IN16     ANDEQ'0'
     C           *INKC     ANDEQ'0'                                       BH3378
      *
     C                     READCSFLRCD                 1616
      *
     C           *IN16     IFEQ '0'
      *                                                                   153664
     C**********           Z-ADDWCNUM     SVCNUM  60                                   187268 CSD027
     C                     MOVE WCNUM     SVCNUM  6                                           CSD027
     C                     MOVE SFCNUM    WCNUM                           153664
      *If the loan is a Participation Purchased, & System Value                               207629
      * LoanCustOriginPurch = 'O', use value saved in OFCNUM.                                 207629
     C********** WLNRF     IFNE 0                                                      207629 CLE148
     C           WLNRF     IFNE *BLANKS                                                       CLE148
     C           PPCUST    ANDEQ'O'                                                           207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C                     MOVE OFCNUM    WCNUM                                               207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     MOVE SFFREF    WFREF                           153664
      *
      ***  If record selected, reset the select field to blank
      ***  before displaying full details.
      *
     C           SELECT    IFNE *BLANK
     C                     MOVE ' '       SELECT
     C                     UPDATSFLRCD
     C                     EXSR DETSCR
     C                     END
      *                                                                   187268
      ** Re-initialise SFCNUM and WCNUM with the prime facility CNUM      187268
      *                                                                   187268
     C**********           Z-ADDSVCNUM    WCNUM                                        187268 CSD027
     C                     MOVE SVCNUM    WCNUM                                               CSD027
     C                     MOVE SVCNUM    SFCNUM                          187268
      *
     C                     END
      *
     C                     END
     C*                                                                   BH3378
     C           *INKC     IFEQ '1'                                       BH3378
     C                     MOVE 'X'       RTRNC                           BH3378
     C                     END                                            BH3378
      *
     C                     ENDSR
      *
      *****************************************************************
      *                                                               *
      *  DETSCR - Subroutine to show expanded detail fee record       *
      *                                                               *
      *  Called By: DETLSR                                            *
      *  Calls:     ZDATE2, AOCURRR0, ZFRPED                          *
      *                                                               *
      *****************************************************************
      *
     C           DETSCR    BEGSR
      *
      **  If a record is found on the fee history file there will
      **  be no further details on LEFEED or LEFEADL2 so output
      **  no further details message.
      *
      **  Initialize value of the signs to blank.                         153664
      *                                                                   153664
     C                     MOVE ' '       SDSIGN                          153664
     C                     MOVE ' '       SDSGN2                          153664
     C                     MOVE ' '       SDSGN3                          153664
     C                     MOVE ' '       SDSGN4                          153664
     C                     MOVE ' '       SDSGN5                          153664
     C                     MOVE ' '       SDSGN6                          153664
     C                     MOVE *BLANKS   SWOFFA                                              204409
     C                     Z-ADD*ZEROS    WWOFFA                                              204409
      *                                                                   153664
     C                     MOVE SFFSEQ    HIFSEQ
      *                                                                                       245012
     C           SFSTAT    IFEQ 'H'                                                           245012
      *                                                                                       245012
     C                     MOVE '0'       *IN54                                               245012
     C           KEY007    CHAINLEFHSTOM             10                                       245012
     C           *IN10     IFEQ '0'                                                           245012
     C           HIRECI    IFEQ 'D'                                                           245012
     C                     MOVE '1'       *IN54                                               245012
     C                     ENDIF                                                              245012
     C                     ELSE                                                               245012
     C**********           MOVE '1'       *IN54                                        245012 263725
     C                     MOVE '0'       *IN54                                               263725
     C                     ENDIF                                                              245012
      *                                                                                       245012
     C                     ENDIF                                                              245012
     C*                                                                   052153
     C** Only if this is a historic fee chain to the history file         052153
     C*                                                                   052153
     C           SFSTAT    IFEQ 'H'                                       052153
     C           *IN54     ANDEQ'0'                                                           245012
     C           SFFSEQ    ANDEQ'00'                                                          263725
     C           KEY001    CHAINLEFHSTL1             10
      *
     C************IN10     IFEQ '0'                                       052153
      *
     C                     MOVELUSER      SDUSER
     C                     MOVELWSID      SDWSID
     C                     MOVE BJMRDT    SDRUNA
     C                     MOVE WCNUM     SDCNUM
     C                     MOVE WBRCA     SDBRCA                          154111
     C           WFREF     IFNE *ZEROS
     C                     MOVELWFREF     SDFACT
     C                     MOVE WFREF     SDFCNO
     C                     MOVE *BLANKS   SDLNRF
     C                     ELSE
     C                     MOVE *BLANKS   SDFACT
     C                     MOVE *BLANKS   SDFCNO
     C                     MOVE WLNRF     SDLNRF
     C                     END
      *
     C                     MOVE SFFSEQ    SDFSEQ
      *
     C                     EXFMTNODETS
      *
     C                     ELSE
      *
      **  Retrieve record from LEFEED using sequence number from
      **  selected subfile record.
      *
     C                     MOVE SFFSEQ    FEFSEQ
     C           KEY002    CHAINLEFEED               11
      *
     C********** *IN11     IFEQ '0'                                                           245012
      *
      **  Set up basic details for output
      *
     C                     MOVELUSER      SDUSER
     C                     MOVELWSID      SDWSID
     C                     MOVE BJMRDT    SDRUNA
      *                                                                                       245012
      **  Initialize fields to blank                                                          245012
      *                                                                                       245012
     C                     MOVE *BLANKS   SDSDAT                                              245012
     C                     MOVE *BLANKS   SDEDAT                                              245012
     C                     MOVE *BLANKS   SDNPYD                                              245012
     C                     MOVEL*BLANKS   SDAMNT                                              245012
     C                     MOVEL*BLANKS   SDOAMT                                              245012
     C                     MOVEL*BLANKS   SDTACR                                              245012
     C                     MOVEL*BLANKS   SDSAMT                                              245012
     C                     MOVEL*BLANKS   SDPDUE                                              245012
     C                     MOVEL*BLANKS   SDADJA                                              245012
     C                     MOVE *BLANKS   SDPIND                                           AR1090331
     C                     MOVE *BLANKS   SDPYON                                           AR1090331
     C                     MOVE *BLANKS   SDAUTO                                           AR1090331
     C                     MOVE ' '       SDCALC                                           AR1090331
     C                     MOVE ' '       SDFREQ                                           AR1090331
     C                     MOVE *BLANKS   SDNPYD                                           AR1090331
     C                     MOVE *BLANKS   SDDYIM                                           AR1090331
     C                     MOVE *BLANKS   SDCALT                                           AR1090331
     C                     MOVE *BLANKS   SDCTYP                                           AR1090331
     C                     MOVEL*BLANKS   SDEXRT                                           AR1090331
     C                     MOVE ' '       SDMDIN                                           AR1090331
     C                     MOVE ' '       SSTAL                                            AR1090331
     C                     MOVEL*BLANKS   SWOFFA                                           AR1090331
     C                     MOVE *BLANKS   SDRAT1                                           AR1090331
     C                     MOVE *BLANKS   SDRAT2                                           AR1090331
     C                     MOVE *BLANKS   SDRAT3                                           AR1090331
     C                     MOVE *BLANKS   SDRAT4                                           AR1090331
     C                     MOVE *BLANKS   SDRAT5                                           AR1090331
     C                     MOVE *BLANKS   SDAMT1                                           AR1090331
     C                     MOVE *BLANKS   SDAMT2                                           AR1090331
     C                     MOVE *BLANKS   SDAMT3                                           AR1090331
     C                     MOVE *BLANKS   SDAMT4                                           AR1090331
     C                     MOVE *BLANKS   SDAMT5                                           AR1090331
      *                                                                                       245012
     C           *IN11     IFEQ '1'                                                           245012
     C           KEY001    CHAINLEFHSTL1             10                                       245012
     C           *IN10     IFEQ '0'                                                           245012
      *                                                                                       245012
     C                     MOVE HIFSEQ    SDFSEQ                                              245012
     C                     MOVE HIFCOD    SDFCOD                                              245012
     C                     MOVE HIFCCY    SDFCCY                                              245012
      *                                                                                       245012
      ** set up decimal places from ccy on history record                                     245012
      *                                                                                       245012
     C                     CALL 'AOCURRR0'                                                    245012
     C                     PARM '*MSG   ' WRTCD   7                                           245012
     C                     PARM '*KEY   ' WOPTN   7                                           245012
     C                     PARM HIFCCY    K101    3                                           245012
     C           SDCURR    PARM SDCURR    DSSDY                                               245012
      *                                                                                       245012
      ** Error if currency not found.                                                         245012
      *                                                                                       245012
     C           WRTCD     IFNE *BLANKS                                                       245012
     C           *LOCK     IN   LDA                                                           245012
     C                     MOVEL'LER115  'DBPGM                                               245012
     C                     MOVE 'SDCURRPD'DBFILE           ************                       245012
     C                     Z-ADD19        DBASE            * DBERR 19 *                       245012
     C                     MOVELHIFCCY    DBKEY            ************                       245012
     C                     OUT  LDA                                                           245012
     C                     EXSR *PSSR                                                         245012
     C                     END                                                                245012
      *                                                                                       245012
      ** Format settlement amount for output using decimal places                             245012
      ** retrieved from currency file.                                                        245012
      *                                                                                       245012
     C                     Z-ADDA6NBDP    ZDECS                                               245012
      *                                                                                       245012
     C           HIAMTS    IFNE 0                                                             245012
     C                     Z-ADDHIAMTS    ZFLD15                                              245012
     C                     Z-ADDZFLD15    WFLD15                                              245012
     C**********           MULT -1        ZFLD15                                       245012 246344
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                                        245012
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDSAMT                                      245012  250989
     C**********           MOVE ZOUT20    SDSAMT                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDSAMT                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C                     Z-ADDWFLD15    ZFLD15                                              245012
     C                     ELSE                                                               245012
     C                     MOVE *BLANKS   SDSAMT                                              245012
     C                     END                                                                245012
      *                                                                                       245012
     C                     MOVE HICNUM    SDCNUM                                              245012
     C                     MOVE HIBRCA    SDBRCA                                              245012
     C                     MOVELHICNUM    WFREFB                                              245012
     C                     MOVE HIFACL    WFREFB                                              245012
     C           HIFACL    IFNE *ZEROS                                                        245012
     C                     MOVELHIFACL    SDFACT                                              245012
     C                     MOVE HIFACL    SDFCNO                                              245012
     C                     MOVE *BLANKS   SDLNRF                                              245012
     C                     ELSE                                                               245012
     C                     MOVE *BLANKS   SDFACT                                              245012
     C                     MOVE *BLANKS   SDFCNO                                              245012
     C                     MOVE HILNRF    SDLNRF                                              245012
     C                     END                                                                245012
      *                                                                                       245012
     C           HISTTL    IFEQ 0                                                             245012
     C                     MOVE *BLANKS   SDSTTL                                              245012
     C                     ELSE                                                               245012
     C                     MOVE HISTTL    SDSTTL                                              245012
     C                     END                                                                245012
      *                                                                                       245012
     C           HISTTL    IFEQ 5                                                             245012
     C           PTFI      IFEQ *BLANK                                                        245012
     C                     MOVELOSDB      SDOURS                                              245012
     C                     ELSE                                                               245012
     C                     MOVELOMDB      SDOURS                                              245012
     C                     ENDIF                                                              245012
     C                     MOVE HIOURS    SDOURS                                              245012
     C                     ELSE                                                               245012
     C                     MOVE *BLANKS   SDOURS                                              245012
     C                     MOVELHIOURS    SDOURS                                              245012
     C                     ENDIF                                                              245012
      *                                                                                       245012
      **  Set up rates and amounts fields                                                     245012
      *                                                                                       245012
     C           HIFRT1    IFEQ 0                                                             245012
     C           HIFRT2    ANDEQ0                                                             245012
     C                     MOVE *BLANKS   SDRAT1                                              245012
     C                     ELSE                                                               245012
     C           HIFRT1    MULT 100000    ZFLD15                                              245012
     C                     Z-ADD5         ZDECS                                               245012
     C                     Z-ADDZFLD15    WFLD15                                              245012
     C                     EXSR ZFRPED                                                        245012
     C                     MOVE ZOUT25    WWA10  10                                           245012
     C                     MOVELWWA10     SDRAT1                                              245012
     C                     Z-ADDWFLD15    ZFLD15                                              245012
     C                     END                                                                245012
      *                                                                                       245012
     C           HIFRT2    IFEQ 0                                                             245012
     C                     MOVE *BLANKS   SDRAT2                                              245012
     C                     ELSE                                                               245012
     C           HIFRT2    MULT 100000    ZFLD15                                              245012
     C                     Z-ADD5         ZDECS                                               245012
     C                     Z-ADDZFLD15    WFLD15                                              245012
     C                     EXSR ZFRPED                                                        245012
     C                     MOVE ZOUT25    WWA10                                               245012
     C                     MOVELWWA10     SDRAT2                                              245012
     C                     Z-ADDWFLD15    ZFLD15                                              245012
     C                     END                                                                245012
      *                                                                                       245012
     C           HIFRT3    IFEQ 0                                                             245012
     C                     MOVE *BLANKS   SDRAT3                                              245012
     C                     ELSE                                                               245012
     C           HIFRT3    MULT 100000    ZFLD15                                              245012
     C                     Z-ADD5         ZDECS                                               245012
     C                     Z-ADDZFLD15    WFLD15                                              245012
     C                     EXSR ZFRPED                                                        245012
     C                     MOVE ZOUT25    WWA10                                               245012
     C                     MOVELWWA10     SDRAT3                                              245012
     C                     Z-ADDWFLD15    ZFLD15                                              245012
     C                     END                                                                245012
      *                                                                                       245012
     C           HIFRT4    IFEQ 0                                                             245012
     C                     MOVE *BLANKS   SDRAT4                                              245012
     C                     ELSE                                                               245012
     C           HIFRT4    MULT 100000    ZFLD15                                              245012
     C                     Z-ADD5         ZDECS                                               245012
     C                     Z-ADDZFLD15    WFLD15                                              245012
     C                     EXSR ZFRPED                                                        245012
     C                     MOVE ZOUT25    WWA10                                               245012
     C                     MOVELWWA10     SDRAT4                                              245012
     C                     Z-ADDWFLD15    ZFLD15                                              245012
     C                     END                                                                245012
      *                                                                                       245012
     C           HIFRT5    IFEQ 0                                                             245012
     C                     MOVE *BLANKS   SDRAT5                                              245012
     C                     ELSE                                                               245012
     C           HIFRT5    MULT 100000    ZFLD15                                              245012
     C                     Z-ADD5         ZDECS                                               245012
     C                     Z-ADDZFLD15    WFLD15                                              245012
     C                     EXSR ZFRPED                                                        245012
     C                     MOVE ZOUT25    WWA10                                               245012
     C                     MOVELWWA10     SDRAT5                                              245012
     C                     Z-ADDWFLD15    ZFLD15                                              245012
     C                     END                                                                245012
      *                                                                                       245012
     C           HIAMT1    IFEQ 0                                                             245012
     C                     MOVE *BLANKS   SDAMT1                                              245012
     C                     MOVE *BLANKS   SDAMT2                                              245012
     C                     MOVE *BLANKS   SDAMT3                                              245012
     C                     MOVE *BLANKS   SDAMT4                                              245012
     C                     MOVE *BLANKS   SDAMT5                                              245012
      *                                                                                       245012
     C                     ELSE                                                               245012
      *                                                                                       245012
     C                     Z-ADDHIAMT1    ZFLD15                                              245012
     C                     Z-ADDZFLD15    WFLD15                                              245012
     C                     EXSR ZFRPED                                                        245012
     C                     MOVE ZOUT22    WWA13  13                                           245012
     C                     MOVELWWA13     SDAMT1                                              245012
     C                     Z-ADDWFLD15    ZFLD15                                              245012
      *                                                                                       245012
     C           HIAMT2    IFNE 0                                                             245012
     C                     Z-ADDHIAMT2    ZFLD15                                              245012
     C                     Z-ADDZFLD15    WFLD15                                              245012
     C                     EXSR ZFRPED                                                        245012
     C                     MOVE ZOUT22    WWA13                                               245012
     C                     MOVELWWA13     SDAMT2                                              245012
     C                     Z-ADDWFLD15    ZFLD15                                              245012
     C                     ELSE                                                               245012
     C                     MOVE *BLANKS   SDAMT2                                              245012
     C                     END                                                                245012
      *                                                                                       245012
     C           HIAMT3    IFNE 0                                                             245012
     C                     Z-ADDHIAMT3    ZFLD15                                              245012
     C                     Z-ADDZFLD15    WFLD15                                              245012
     C                     EXSR ZFRPED                                                        245012
     C                     MOVE ZOUT22    WWA13                                               245012
     C                     MOVELWWA13     SDAMT3                                              245012
     C                     Z-ADDWFLD15    ZFLD15                                              245012
     C                     ELSE                                                               245012
     C                     MOVE *BLANKS   SDAMT3                                              245012
     C                     END                                                                245012
      *                                                                                       245012
     C           HIAMT4    IFNE 0                                                             245012
     C                     Z-ADDHIAMT4    ZFLD15                                              245012
     C                     Z-ADDZFLD15    WFLD15                                              245012
     C                     EXSR ZFRPED                                                        245012
     C                     MOVE ZOUT22    WWA13                                               245012
     C                     MOVELWWA13     SDAMT4                                              245012
     C                     Z-ADDWFLD15    ZFLD15                                              245012
     C                     ELSE                                                               245012
     C                     MOVE *BLANKS   SDAMT4                                              245012
     C                     END                                                                245012
      *                                                                                       245012
     C           HIAMT5    IFNE 0                                                             245012
     C                     Z-ADDHIAMT5    ZFLD15                                              245012
     C                     Z-ADDZFLD15    WFLD15                                              245012
     C                     EXSR ZFRPED                                                        245012
     C                     MOVE ZOUT22    WWA13                                               245012
     C                     MOVELWWA13     SDAMT5                                              245012
     C                     Z-ADDWFLD15    ZFLD15                                              245012
     C                     ELSE                                                               245012
     C                     MOVE *BLANKS   SDAMT5                                              245012
     C                     END                                                                245012
     C                     END                                                                245012
      *                                                                                       245012
     C                     ELSE                                                               245012
     C                     ENDIF                                                              245012
     C                     ELSE                                                               245012
     C                     MOVE FECNUM    SDCNUM
     C                     MOVE FEBRCA    SDBRCA                          154111
     C                     MOVELFECNUM    WFREFB                          153664
     C                     MOVE FEFACL    WFREFB                          153664
      *If the loan is a Participation Purchased, & System Value                               207629
      * LoanCustOriginPurch = 'O', use Original Borrower:                                     207629
     C********** FELOAN    IFNE 0                                                      207629 CLE148
     C           FELOAN    IFNE *BLANKS                                                       CLE148
     C           PPCUST    ANDEQ'O'                                                           207629
     C                     MOVE FELOAN    WLOAN                                               207629
     C                     MOVE 'A'       WCLRT                                               207629
     C           KEY005    CHAINCLOAN                79                                       207629
     C           *IN79     IFEQ '0'                                                           207629
     C           PTYP      IFEQ 64                                                            207629
     C           PTYP      OREQ 65                                                            207629
     C           PTYP      OREQ 68                                                            207629
     C           PTYP      OREQ 71                                                            207629
     C                     MOVE OLNO      SDCNUM                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
     C                     ENDIF                                                              207629
      *                                                                   CLE005
      ** If SAR CLE005 is Present                                         CLE005
      *                                                                   CLE005
     C           *IN30     IFEQ *ON                                       CLE005
      *                                                                   CLE005
      ** Format Fee Indicator                                             CLE005
      *                                                                   CLE005
     C                     MOVE *BLANKS   SDPTFN                          CLE005
     C           PTFI      IFEQ *BLANKS                                   CLE005
     C                     MOVEL'RECEIVAB'SDPTFN                          CLE005
     C                     MOVE 'LE'      SDPTFN                          CLE005
     C                     ENDIF                                          CLE005
     C           PTFI      IFEQ 'P'                                       CLE005
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVEL'PAYABLE' SDPTFN                          CLE005
     C                     ENDIF                                          CLE005
     C           PTFI      IFEQ 'I'                                       CLE005
     C                     MOVEL'INTERNAL'SDPTFN                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C                     MOVEL*BLANKS   SSTAL                                               CLE034
     C           FESTAL    IFEQ 'Y'                                                           CLE034
     C                     MOVEL'Y'       SSTAL   1                                           CLE034
     C                     ELSE                                                               CLE034
     C                     MOVEL'N'       SSTAL                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *
     C           FEFACL    IFNE *ZEROS
     C                     MOVELFEFACL    SDFACT
     C                     MOVE FEFACL    SDFCNO
     C                     MOVE *BLANKS   SDLNRF
     C                     ELSE
     C                     MOVE *BLANKS   SDFACT
     C                     MOVE *BLANKS   SDFCNO
     C                     MOVE FELOAN    SDLNRF
     C                     END
      *
     C                     MOVE FEFSEQ    SDFSEQ
     C                     MOVE FEFCOD    SDFCOD
     C                     MOVE FEFCCY    SDFCCY
     C                     MOVE FEPYON    SDPYON
     C                     MOVE FEAUTO    SDAUTO
     C                     MOVE FECAPI    SDCAPI                                              CLE139
     C           FESTTL    IFEQ 0
     C                     MOVE *BLANKS   SDSTTL
     C                     ELSE
     C                     MOVE FESTTL    SDSTTL
     C                     END
      *                                                                   154111
     C           FESTTL    IFEQ 5                                         154111
     C           PTFI      IFEQ *BLANK                                    154111
     C                     MOVELOSDB      SDOURS                          154111
     C                     ELSE                                           154111
     C                     MOVELOMDB      SDOURS                          154111
     C                     ENDIF                                          154111
     C                     MOVE FEOURS    SDOURS                          154111
     C                     ELSE                                           154111
     C***********          MOVE FEOURS    SDOURS                          154111
     C                     MOVE *BLANKS   SDOURS                          156225
     C                     MOVELFEOURS    SDOURS                          154111
     C                     ENDIF                                          154111
      *                                                                   154111
     C                     MOVE FETHER    SDTHER
      *
     C           FECALT    IFEQ ' '
     C                     MOVE *BLANKS   SDCALT
     C                     ELSE
     C                     MOVE FECALT    SDCALT
     C                     END
      *
     C                     MOVE FEPIND    SDPIND
      *
     C           FECALC    IFEQ 0
     C                     MOVE *BLANKS   SDCALC
     C                     ELSE
     C                     MOVE FECALC    SDCALC
     C                     END
      *
     C                     MOVE FEMDIN    SDMDIN
     C                     MOVE FEFREQ    SDFREQ
      *
      **  Set up fee period start date field.
      *
     C           FEPSTD    IFNE *ZEROS
     C                     Z-ADDFEPSTD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SDSDAT
     C                     ELSE
     C                     MOVE *BLANKS   SDSDAT
     C                     END
      *
      **  Set up fee period end date field.
      *
     C           FEPEND    IFNE *ZEROS
     C                     Z-ADDFEPEND    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SDEDAT
     C                     ELSE
     C                     MOVE *BLANKS   SDEDAT
     C                     END
      *
      **  Set up next payment date field
      *
     C           FENPYD    IFNE *ZEROS
     C                     Z-ADDFENPYD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SDNPYD
     C                     ELSE
     C                     MOVE *BLANKS   SDNPYD
     C                     END
      *
      **  Set up day in month field
      *
     C           FEDYIM    IFEQ 0
     C                     MOVE *BLANKS   SDDYIM
     C                     ELSE
     C                     MOVE FEDYIM    SDDYIM
     C                     END
      *
      **  Set up rates and amounts fields
      *
     C           FEFRT1    IFEQ 0
     C           FEFRT2    ANDEQ0
     C                     MOVE *BLANKS   SDRAT1
     C                     ELSE
     C           FEFRT1    MULT 100000    ZFLD15
     C                     Z-ADD5         ZDECS
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    WWA10  10
     C                     MOVELWWA10     SDRAT1
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *
     C           FEFRT2    IFEQ 0
     C                     MOVE *BLANKS   SDRAT2
     C                     ELSE
     C           FEFRT2    MULT 100000    ZFLD15
     C                     Z-ADD5         ZDECS
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    WWA10
     C                     MOVELWWA10     SDRAT2
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *
     C           FEFRT3    IFEQ 0
     C                     MOVE *BLANKS   SDRAT3
     C                     ELSE
     C           FEFRT3    MULT 100000    ZFLD15
     C                     Z-ADD5         ZDECS
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    WWA10
     C                     MOVELWWA10     SDRAT3
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *
     C           FEFRT4    IFEQ 0
     C                     MOVE *BLANKS   SDRAT4
     C                     ELSE
     C           FEFRT4    MULT 100000    ZFLD15
     C                     Z-ADD5         ZDECS
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    WWA10
     C                     MOVELWWA10     SDRAT4
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *
     C           FEFRT5    IFEQ 0
     C                     MOVE *BLANKS   SDRAT5
     C                     ELSE
     C           FEFRT5    MULT 100000    ZFLD15
     C                     Z-ADD5         ZDECS
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    WWA10
     C                     MOVELWWA10     SDRAT5
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *
     C           FEAMT1    IFEQ 0
     C                     MOVE *BLANKS   SDAMT1
     C                     MOVE *BLANKS   SDAMT2
     C                     MOVE *BLANKS   SDAMT3
     C                     MOVE *BLANKS   SDAMT4
     C                     MOVE *BLANKS   SDAMT5
      *
     C                     ELSE
      *
     C           FEPIND    IFEQ 'A'
     C                     Z-ADD0         ZDECS
     C                     END
     C           FEPIND    IFEQ 'P'
     C                     Z-ADD3         ZDECS
     C                     END
      *
     C                     Z-ADDFEAMT1    ZFLD15
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    WWA13  13
     C                     MOVELWWA13     SDAMT1
     C                     Z-ADDWFLD15    ZFLD15                                              204302
      *
     C           FEAMT2    IFNE 0
     C                     Z-ADDFEAMT2    ZFLD15
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    WWA13
     C                     MOVELWWA13     SDAMT2
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     ELSE
     C                     MOVE *BLANKS   SDAMT2
     C                     END
      *
     C           FEAMT3    IFNE 0
     C                     Z-ADDFEAMT3    ZFLD15
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    WWA13
     C                     MOVELWWA13     SDAMT3
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     ELSE
     C                     MOVE *BLANKS   SDAMT3
     C                     END
      *
     C           FEAMT4    IFNE 0
     C                     Z-ADDFEAMT4    ZFLD15
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    WWA13
     C                     MOVELWWA13     SDAMT4
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     ELSE
     C                     MOVE *BLANKS   SDAMT4
     C                     END
      *
     C           FEAMT5    IFNE 0
     C                     Z-ADDFEAMT5    ZFLD15
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    WWA13
     C                     MOVELWWA13     SDAMT5
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     ELSE
     C                     MOVE *BLANKS   SDAMT5
     C                     END
     C                     END
      *
      **  Set up exchange rate field
      *
     C           FEERAT    IFEQ 0
     C                     MOVE *BLANKS   SDEXRT
     C                     ELSE
     C           FEERAT    MULT 100000000 ZFLD15
     C                     Z-ADD8         ZDECS
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    WWA17  17
     C                     MOVELWWA17     SDEXRT
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *                                                                                       CAS016
     C                     MOVE '0'       *IN33                                               CAS016
     C                     MOVE *BLANKS   SFAMRI                                              CAS016
     C                     MOVE *BLANKS   SFSTPD                                              CAS016
     C                     MOVE *BLANKS   SFENPD                                              CAS016
     C           CAS016    IFEQ 'Y'                                                           CAS016
     C********** FELOAN    ANDGT0                                                      CAS016 CLE148
     C           FELOAN    ANDGT*BLANKS                                                       CLE148
     C           FEADJY    ANDEQ'Y'                                                           CAS016
     C           FESTPD    ANDNE0                                                             CAS016
     C                     MOVE '1'       *IN33                                               CAS016
     C                     MOVE FEAMRI    SFAMRI                                              CAS016
     C                     Z-ADDFESTPD    ZDAYNO                                              CAS016
     C                     EXSR ZDATE2                                                        CAS016
     C                     MOVE ZDATE     SFSTPD                                              CAS016
     C           FEENPD    IFNE 0                                                             CAS016
     C                     Z-ADDFEENPD    ZDAYNO                                              CAS016
     C                     EXSR ZDATE2                                                        CAS016
     C                     MOVE ZDATE     SFENPD                                              CAS016
     C                     ENDIF                                                              CAS016
      *                                                                                       CAS016
     C                     ENDIF                                                              CAS016
      *
      **  Only calculated fees can have details on the fee settlement
      **  adjustment file.  Use the fee sequence number from the
      **  selected subfile record.
      *
     C********** FECALT    IFNE ' '                                                           203765
     C                     MOVE SFFSEQ    FAFSEQ
      *                                                                                       203765
      ** Indicator 12 will be off if there is a live record in LEFEEAD.                       203765
      *                                                                                       203765
     C/COPY WNCPYSRC,LER115C004
     C***********KEY003    CHAINLEFEADL2             12                   BH3424
     C           KEY003    SETLLLEFEADL2                                  BH3424
     C           KEY003    READELEFEADL2                 12               BH3424
      *                                                                                       203765
     C           FARECI    DOWEQ'*'                                       BH3424
     C           *IN12     ANDEQ'0'                                       106111
      *                                                                   153736
      **  Clear fee adjustment amount if record is not live               153736
      *                                                                   153736
     C                     Z-ADD0         FASADJ                          153736
      *                                                                   153736
     C           KEY003    READELEFEADL2                 12               BH3424
     C                     END                                            BH3424
     C**********           ELSE                                                               203765
     C**********           MOVE '1'       *IN12                                               203765
     C**********           END                                                                203765
      *
      **  If record not found on fee settlment/adjustment file
      **  set up output fields with data from PF/LEFEED.  Otherwise
      **  the details on the settlement/adjustment file will effect
      **  the screen output data.
      *
     C           *IN12     IFEQ '1'
     C           FARECI    OREQ '*'                                       BH3414
      *
      ** setup decimal places for ccy on fee file.
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM FEFCCY    K101    3
     C           SDCURR    PARM SDCURR    DSSDY
      *
      **  Error if currency not found.
      *
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'LER115  'DBPGM
     C                     MOVELFEFCCY    DBKEY
     C                     MOVE 'SDCURRPD'DBFILE           ************
     C                     Z-ADD005       DBASE            * DBERR 05 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
      *
     C                     Z-ADDA6NBDP    ZDECS
     C           A6NBDP    ADD  4         P                               BH3414
      *
      **  Set up screen detail amount using fee amount.
      *
     C           FEFAMT    IFEQ *ZEROS
     C                     MOVE *BLANKS   SDAMNT
     C                     ELSE
     C                     Z-ADDFEFAMT    ZFLD15
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDAMNT                                              250989
     C**********           MOVE ZOUT20    SDAMNT                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDAMNT                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C                     EXSR SRSIGN                                    153664
     C                     MOVE WSIGN     SDSIGN                          153664
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      ******************************************************************* 153664
      ***Output*positive*or*negative*amount*sign*depending*on*fee******** 153664
      ***amount*value.*************************************************** 153664
      ******************************************************************* 153664
     C***********FEFAMT    IFLT 0                                         153664
     C***********          MOVE '-'       SDSIGN                          153664
     C***********          ELSE                                           153664
     C***********          MOVE ' '       SDSIGN                          153664
     C***********          END                                            153664
      *****************************************************************   154104
      ****Set*up*screen*detail*outstanding*amount.*********************   154104
      *****************************************************************   154104
     C***********FEAMTO    IFEQ *ZEROS                                    154104
     C***********          MOVE *BLANKS   SDOAMT                          154104
     C***********          ELSE                                           154104
     C***********          Z-ADDFEAMTO    ZFLD15                          154104
     C***********          EXSR ZFRPED                                    154104
     C***********          MOVE ZOUT25    SDOAMT                          154104
     C***********          EXSR SRSIGN                             153664 154104
     C***********          MOVE WSIGN     SDSGN2                   153664 154104
     C***********          END                                            154104
      *
      ** suspended fees                                                                       CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     EXSR SRFSUS                                                        CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      **  Set up screen detail fee accrued to date amount
      *
     C***  Non- calculated fees                                           BH3414
     C*                                                                   BH3414
     C           FECALT    IFEQ '  '                                      BH3414
     C*                                                                   BH3414
     C********** FEADAT    IFEQ *ZEROS                                    BH3414
     C**********           MOVE *BLANKS   SDTACR                          BH3414
     C**********           ELSE                                           BH3414
     C***********FEPEND    IFLE BJRDNB                             BH3414 BH3527
     C           FEPEND    IFLT BJRDNB                                    BH3527
     C           FEPEND    ANDNE0                                         BH3530
     C           FEPSTD    ANDNE0                                                           BUG22313
     C           BJRDNB    ANDGEFEPSTD                                                      BUG22313
     C           FEPEND    OREQ 0                                         BH3414
     C           BJRDNB    ANDGEFEPSTD                                                      BUG22313
     C           FEPYON    ANDEQ*BLANK                                    BH3414
     C                     Z-ADDFEFAMT    ZFLD15                          BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C***  Add extra day to accruals                                      BH3414
     C*                                                                   BH3414
     C********** FEPSTD    IFNE BJRDNB                             BH3414 BH3527
     C********** BJRDNB    SUB  FEPSTD    FLATDS  50               BH3414 BH3527
     C********** FLATDS    SUB  1         FLATDS                   BH3414 BH3527
     C********** FEADAT    DIV  FLATDS    FLATAM 130H              BH3414 BH3527
     C********** FLATDS    ADD  1         FLATDS                   BH3414 BH3527
     C********** FLATAM    MULT FLATDS    FLATAM                   BH3414 BH3527
     C**********           Z-ADDFLATAM    ZFLD15                   BH3414 BH3527
     C*                                                                   BH3527
     C           FEPSTD    IFLT BJRDNB                                    BH3527
     C/COPY WNCPYSRC,LEH01358
     C           FEPEND    SUB  FEPSTD    FLATDS  50                      BH3527
     C***********FEFAMT    DIV  FLATDS    FLATAM 130H              BH3527 156367
     C           FEFAMT    DIV  FLATDS    FLATAM 229H                     156367
     C           BJRDNB    SUB  FEPSTD    FLATDY  50                      BH3527
     C***********FLATAM    MULT FLATDY    ZFLD15                   BH3527 156367
     C           FLATAM    MULT FLATDY    ZFLD15    H                     156367
     C/COPY WNCPYSRC,LEH01359
     C*                                                                   BH3527
     C                     ELSE                                           BH3414
     C                     Z-ADDFEADAT    ZFLD15
     C                     END                                            BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C           CAS009    IFEQ 'Y'                                                           244381
     C           FEADJY    ANDEQ'Y'                                                           244381
     C           FSAMRM    IFEQ 'N'                                                           244381
     C           FSAMRM    OREQ *BLANK                                                        244381
     C                     Z-ADDFEAMTD    ZFLD15                                              244381
     C                     ENDIF                                                              244381
     C                     ENDIF                                                              244381
      *                                                                                       244381
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDTACR                                              250989
     C**********           MOVE ZOUT20    SDTACR                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDTACR                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN3                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C*                                                                   BH3530
     C***  Don't accrue bullet fees till they're paid                     BH3530
     C*                                                                   BH3530
     C           FEAUTO    IFNE 'Y'                                       BH3530
     C           FEPEND    ANDEQ0                                         BH3530
     C           FEPYON    ANDEQ*BLANK                                    BH3530
     C           FERECI    OREQ 'M'                                                         MD024550
     C                     MOVE *BLANKS   SDTACR                          BH3530
     C                     MOVE ' '       SDSGN3                          153664
     C                     END                                            BH3530
     C*                                                                   BH3530
     C**********           END                                            BH3414
     C                     ELSE                                           BH3414
      *
     C*                                                                   BH3414
     C** For calculated fees based on averages need to calculate          BH3414
     C** what the value would be if today was payment date                BH3414
     C*                                                                   BH3414
     C           FECALT    IFEQ '01'                                      BH3414
     C           FECALT    OREQ '02'                                      BH3414
     C           FECALT    OREQ '03'                                      BH3414
     C           FECALT    OREQ '11'                                      BH3414
     C           FECALT    OREQ '12'                                      BH3414
     C           FECALT    OREQ '13'                                      BH3414
     C           FECALT    OREQ '21'                                      BH3414
     C*                                                                   BH3414
     C                     EXSR AVCALC                                    BH3414
     C*                                                                   BH3414
     C           FEPYON    IFEQ 'N'                                                         MD027397
     C                     Z-ADD0         ZFLD15                                            MD027397
     C                     ELSE                                                             MD027397
     C                     Z-ADDWFEE      ZFLD15                          BH3414
     C                     ENDIF                                                            MD027397
     C*                                                                   153736
     C** Fee adjustment amount should only be added to records with       153736
     C** adjustments/settlements on LEFEEAD                               153736
     C*                                                                   153736
     C***********          ADD  FASADJ    ZFLD15                   CLE005 153736
     C*                                                                   153736
     C                     ADD  FELPAM    ZFLD15                          CLE005
     C***********          ADD  FEAMTP    ZFLD15                   BH3414 155677
     C***********          ADD  FEAMTS    ZFLD15                   BH3414 052125
     C*                                                                   BH3414
     C           ZFLD15    IFEQ *ZEROS                                    BH3414
     C           FERECI    OREQ 'M'                                                         MD024550
     C                     MOVE *BLANKS   SDTACR                          BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                    BH3414
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDTACR                          BH3414              250989
     C**********           MOVE ZOUT20    SDTACR                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDTACR                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN3                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END                                            BH3414
     C*                                                                   BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C***  Actual amount fees                                             BH3414
     C*                                                                   BH3414
     C                     EXSR AVCALC                                    BH3414
     C********** WFEE      ADD  FEADAT    WFEE                                       BH3414 BUG22343
     C*                                                                   153736
     C** Fee adjustment amount should only be added to records with       153736
     C** adjustments/settlements on LEFEEAD                               153736
     C*                                                                   153736
     C***********          ADD  FASADJ    WFEE                     CLE005 153736
     C********** *IN30     IFEQ '0'                                                    204653 239961
     C**********           ADD  FELPAM    WFEE                                        BH3414 243496A
     C**********           ADD  FELPAM    WFEE                                        245803 243496B
     C**********           ELSE                                                        204653 239961
      **********                                                                       204653 239961
      ***Pattern*computation*of*WFEE*from*LER135*to*avoid*0.01*difference************* 204653 239961
      ***in*the*open*accruals*if*CLE005*is*swiched*ON********************************* 204653 239961
      **********                                                                       204653 239961
     C**********           ADD  FEAMTA    WFEE                                         204653 239961
     C**********           ADD  FETADJ    WFEE                                         204653 239961
     C**********           SUB  FEAMTS    WFEE                                         204653 239961
     C**********           SUB  FEAMTP    WFEE                                         204653 239961
     C**********           SUB  FEAMTW    WFEE                                         204653 239961
     C**********           SUB  FEWOFF    WFEE                                         204653 239961
     C**********           ENDIF                                                       204653 239961
     C********** *IN30     IFEQ '0'                                                   243496A 245803
     C********** FEINDC    OREQ 'Y'                                                   243496A 245803
     C**********           ADD  FELPAM    WFEE                                        243496A 245803
     C**********           ELSE                                                       243496A 245803
     C**********           ADD  FEAMTA    WFEE                                        243496A 245803
     C**********           ADD  FETADJ    WFEE                                        243496A 245803
     C**********           SUB  FEAMTS    WFEE                                        243496A 245803
     C**********           SUB  FEAMTP    WFEE                                        243496A 245803
     C**********           SUB  FEAMTW    WFEE                                        243496A 245803
     C**********           SUB  FEWOFF    WFEE                                        243496A 245803
     C**********           ENDIF                                                      243496A 245803
     C           *IN30     IFEQ '0'                                                          243496B
     C           FEINDC    OREQ 'Y'                                                          243496B
     C                     ADD  FELPAM    WFEE                                               243496B
     C                     ELSE                                                              243496B
     C                     ADD  FEAMTA    WFEE                                               243496B
     C/COPY WNCPYSRC,LEH00639
      *                                                                                       CLE073
     C           FECALT    IFNE '99'                                                          CLE073
     C           FECALT    ANDNE'90'                                                          CLE134
      *                                                                                       CLE073
     C                     ADD  FETADJ    WFEE                                               243496B
     C**********           SUB  FEAMTS    WFEE                                      243496B BUG22702
     C**********           SUB  FEAMTP    WFEE                                      243496B BUG22702
     C                     SUB  FEAMTS    WFEE                                              AR750553
     C                     SUB  FEAMTP    WFEE                                              AR750553
     C                     SUB  FEAMTW    WFEE                                               243496B
      *                                                                                       CLE134
      ** Suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     SUB  FESFA     WFEE                                                CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE073
     C/COPY WNCPYSRC,LEH00640
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           FECALT    IFNE '99'                                                          CLE073
     C           FECALT    ANDNE'90'                                                          CLE134
      *                                                                                       CLE073
     C                     SUB  FEWOFF    WFEE                                               243496B
      *                                                                                       CLE073
     C/COPY WNCPYSRC,LEH00641
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                             243496B
     C***********          ADD  FEAMTP    WFEE                     BH3414 155677
     C***********          ADD  FEAMTS    WFEE                     BH3414 052125
     C*                                                                   BH3414
     C********** FEADAT    IFEQ *ZEROS                                    BH3414
     C********** FELPAM    ANDEQ*ZEROS                             BH3467 BH3414
     C           WFEE      IFEQ *ZEROS                                    BH3414
     C           FERECI    OREQ 'M'                                                         MD024550
     C                     MOVE *BLANKS   SDTACR
     C                     ELSE
     C*                                                                   BH3414
     C** For a calculated fee the accrued amount should be adjusted       BH3414
     C** for amounts outstanding and settled                              BH3414
     C*                                                                   BH3414
     C**********           Z-ADDFEADAT    ZFLD15                          BH3414
     C**********           ADD  FEAMTP    ZFLD15                          BH3414
     C**********           ADD  FEAMTS    ZFLD15                          BH3414
     C**********           ADD  FELPAM    ZFLD15                   BH3467 BH3414
     C                     Z-ADDWFEE      ZFLD15                          BH3414
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDTACR                                              250989
     C**********           MOVE ZOUT20    SDTACR                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDTACR                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN3                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
     C*                                                                   BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C                     END                                            BH3414
      *                                                                   154104
      **  Set up screen detail outstanding amount.                        154104
      *                                                                   154104
     C           FECALT    IFEQ *BLANKS                                   154104
     C                     Z-ADDFEAMTO    ZFLD15                          154104
     C                     ELSE                                           154104
     C           SDTACR    IFEQ *BLANKS                                   154104
     C                     Z-ADD0         ZFLD15                          154104
     C                     ENDIF                                          154104
     C**********           ADD  FEAMTP    ZFLD15                                     154104 BUG22702
     C**********           SUB  FEAMTS    ZFLD15                                  BUG22702 AR1020182
     C                     ADD  FEAMTP    ZFLD15                                           AR1020182
      *                                                                                       CLE134
      ** suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     ADD  FESFA     ZFLD15                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                          154104
      *                                                                   154104
     C/COPY WNCPYSRC,LEH00642
      *                                                                                       CLE073
     C           FENPYD    IFNE FEPEND                                                      MD031852
     C                     ADD  FE99AM    ZFLD15                                              CLE073
     C                     ENDIF                                                            MD031852
      *                                                                                       CLE073
     C           ZFLD15    IFEQ *ZEROS                                    154104
     C                     MOVE *BLANKS   SDOAMT                          154104
     C                     ELSE                                           154104
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                    154104
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDOAMT                          154104              250989
     C**********           MOVE ZOUT20    SDOAMT                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDOAMT                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 154104 245329
     C**********           MOVE WSIGN     SDSGN2                                       154104 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     ENDIF                                          154104
      *
      **  Set up screen detail fee settled amount.
      *
     C           FEAMTS    IFEQ *ZEROS
     C                     MOVE *BLANKS   SDSAMT
     C                     ELSE
     C                     Z-ADDFEAMTS    ZFLD15
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C**********           MULT -1        ZFLD15                                       245329 246344
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDSAMT                                              250989
     C**********           MOVE ZOUT20    SDSAMT                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDSAMT                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN4                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *
      **  Set up screen detail fee past due amount.
      *
     C           FEAMTP    IFEQ *ZEROS
     C                     MOVE *BLANKS   SDPDUE
     C                     ELSE
     C                     Z-ADDFEAMTP    ZFLD15
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDPDUE                                              250989
     C**********           MOVE ZOUT20    SDPDUE                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDPDUE                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN5                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *
      **  Set up screen detail fee adjustment amount.
      *
     C           FEAMTA    IFEQ *ZEROS
     C                     MOVE *BLANKS   SDADJA
     C********** FELPDT    IFEQ BJRDNB                                                 243496 245803
     C********** KEY006    CHAINLEFEAM               70                                243496 245803
     C********** *IN70     IFEQ '0'                                                    243496 245803
     C**********           Z-ADDFEOAMT    ZFLD15                                       243496 245803
     C**********           Z-ADDZFLD15    WFLD15                                       243496 245803
     C**********           EXSR ZFRPED                                                 243496 245803
     C**********           MOVE ZOUT25    SDADJA                                       243496 245803
     C**********           EXSR SRSIGN                                                 243496 245803
     C**********           MOVE WSIGN     SDSGN6                                       243496 245803
     C**********           Z-ADDWFLD15    ZFLD15                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C           FELPDT    IFEQ BJRDNB                                                       243496B
     C           KEY006    CHAINLEFEAM               70                                      243496B
     C           *IN70     IFEQ '0'                                                          243496B
     C                     Z-ADDFEOAMT    ZFLD15                                             243496B
     C                     Z-ADDZFLD15    WFLD15                                             243496B
     C                     EXSR ZFRPED                                                       243496B
     C                     MOVE ZOUT25    SDADJA                                             243496B
     C                     EXSR SRSIGN                                                       243496B
     C                     MOVE WSIGN     SDSGN6                                             243496B
     C                     Z-ADDWFLD15    ZFLD15                                             243496B
     C                     ENDIF                                                             243496B
     C                     ENDIF                                                             243496B
     C                     ELSE
     C                     Z-ADDFEAMTA    ZFLD15
     C********** FELPDT    IFEQ BJRDNB                                                 243496 245803
     C********** KEY006    CHAINLEFEAM               70                                243496 245803
     C********** *IN70     IFEQ '0'                                                    243496 245803
     C**********           ADD  FEOAMT    ZFLD15                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C********** FELPDT    IFEQ BJRDNB                                              243496B MD022974
     C********** KEY006    CHAINLEFEAM               70                             243496B MD022974
     C********** *IN70     IFEQ '0'                                                 243496B MD022974
     C**********           ADD  FEOAMT    ZFLD15                                    243496B MD022974
     C**********           ENDIF                                                    243496B MD022974
     C**********           ENDIF                                                    243496B MD022974
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDADJA                                              250989
     C**********           MOVE ZOUT20    SDADJA                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDADJA                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C                     EXSR SRSIGN                                    153664
     C                     MOVE WSIGN     SDSGN6                          153664
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *                                                                                       204452
     C           FEAMTW    IFEQ *ZEROS                                                        204452
     C                     MOVE *BLANKS   SWOFFA                                              204452
     C                     ELSE                                                               204452
     C                     Z-ADDFEAMTW    ZFLD15                                              204452
     C                     Z-ADDZFLD15    WFLD15                                              204452
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                                        204452
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SWOFFA                                       204452 250989
     C**********           MOVE ZOUT20    SWOFFA                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SWOFFA                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C                     Z-ADDWFLD15    ZFLD15                                              204452
     C                     ENDIF                                                              204452
      *
      **  If record found on settlement/adjustment file set up
      **  output fields using values from this record.
      *
     C                     ELSE
      *
      **  Reset decimal places field
      *
     C                     Z-ADDA6NBDP    ZDECS
      *                                                                                       203765
      ** Read all live Fee Adjustments/Settlement in LEFEEAD                                  203765
      *                                                                                       203765
     C                     Z-ADD*ZEROS    WDOAMT 130                                          203765
     C                     Z-ADD*ZEROS    WDTACR 130                                          203765
     C                     Z-ADD*ZEROS    WDSAMT 130                                          203765
     C                     Z-ADD*ZEROS    WDPDUE 130                                          203765
     C                     Z-ADD*ZEROS    WDADJA 130                                          203765
     C                     Z-ADD*ZEROS    WWOFFA 130                                          204409
     C                     MOVE *BLANKS   SWOFFA                                              204409
     C                     MOVE *BLANKS   SDOAMT                                              203765
     C                     MOVE *BLANKS   SDTACR                                              203765
     C                     MOVE *BLANKS   SDSAMT                                              203765
     C                     MOVE *BLANKS   SDPDUE                                              203765
     C                     MOVE *BLANKS   SDADJA                                              203765
     C                     MOVE ' '       WFULL   1                                           203765
     C                     MOVE '0'       *IN12                                               203765
      *                                                                                       203765
     C           FEAMTW    IFGT 0                                                             204409
     C                     Z-ADDFEAMTW    ZFLD15                                              204409
     C**********           Z-ADDZFLD15    WFLD15                                       243496 245803
     C                     Z-ADDZFLD15    WFLD15                                             243496B
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                                        204409
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SWOFFA                                       204409 250989
     C**********           MOVE ZOUT20    SWOFFA                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SWOFFA                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           Z-ADDWFLD15    ZFLD15                                       243496 245803
     C                     Z-ADDWFLD15    ZFLD15                                             243496B
     C                     ENDIF                                                              204409
      *                                                                                       CLE073
     C/COPY WNCPYSRC,LEH00643
      *                                                                                       CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C           FEFAMT    IFEQ *ZEROS                                                        CLE073
     C                     MOVE *BLANKS   SDAMNT                                              CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDFEFAMT    ZFLD15                                              CLE073
     C                     Z-ADDZFLD15    WFLD15                                              CLE073
     C                     EXSR ZFRPED                                                        CLE073
     C                     MOVE ZOUT25    SDAMNT                                              CLE073
     C                     EXSR SRSIGN                                                        CLE073
     C                     MOVE WSIGN     SDSIGN                                              CLE073
     C                     Z-ADDWFLD15    ZFLD15                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      *                                                                                       204409
     C           KEY003    SETLLLEFEADL2                                                      203765
      *                                                                                       203765
     C           *IN12     DOWEQ'0'                                                           203765
     C                     MOVE SFFSEQ    FAFSEQ                                              203765
     C           KEY003    READELEFEADL2                 12                                   203765
      *                                                                                       203765
     C           *IN12     IFEQ '0'                                                           203765
     C           FARECI    ANDNE'*'                                                           203765
      *
      ** If this is a fee settlement record rather than an
      ** amendment record.
      *
     C           FARECI    IFEQ 'S'
      *
      ** Set up screen detail settlement amount field.
      *
     C********** FEAMTS    ADD  FASADJ    AMTFLD 130                                          203765
     C           FATYPE    IFEQ 'F'                                                           204409
     C           FATYPE    OREQ 'P'                                                           204409
     C                     ADD  FASADJ    WDSAMT                                              203765
     C           FEAMTS    ADD  WDSAMT    AMTFLD 130                                          203765
     C                     Z-ADDAMTFLD    ZFLD15
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C**********           MULT -1        ZFLD15                                       245329 246344
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDSAMT                                              250989
     C**********           MOVE ZOUT20    SDSAMT                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDSAMT                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C                     EXSR SRSIGN                                    153664
     C                     MOVE WSIGN     SDSGN4                          153664
     C                     Z-ADDWFLD15    ZFLD15                                              204302
      *                                                                                       204409
      ** Write off                                                                            204409
     C                     ELSE                                                               204409
      *                                                                                       204409
     C                     ADD  FASADJ    WWOFFA                                              204409
     C                     Z-ADDWWOFFA    ZFLD15                                              204409
      *                                                                                       204409
     C           ZFLD15    IFEQ *ZEROS                                                        204409
     C                     MOVE *BLANKS   SWOFFA                                              204409
     C                     ELSE                                                               204409
      *                                                                                       204452
      ** add fee amount previously written off                                                204452
      *                                                                                       204452
      *                                                                                       204452
     C                     ADD  FEAMTW    ZFLD15                                              204452
     C**********           Z-ADDZFLD15    WFLD15                                       243496 245803
     C                     Z-ADDZFLD15    WFLD15                                             243496B
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                                        204409
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SWOFFA                                       204409 250989
     C**********           MOVE ZOUT20    SWOFFA                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SWOFFA                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           Z-ADDWFLD15    ZFLD15                                       243496 245803
     C                     Z-ADDWFLD15    ZFLD15                                             243496B
     C                     ENDIF                                                              204409
      *                                                                                       204409
     C                     Z-ADDWWOFFA    ZFLD15                                              204409
      *                                                                                       204409
      ** set up settled amount as well                                                        204409
      *                                                                                       204409
     C           FEAMTS    ADD  WDSAMT    ZFLD15                                              204409
      *                                                                                       204409
     C           ZFLD15    IFEQ *ZEROS                                                        204409
     C                     MOVE *BLANKS   SDSAMT                                              204409
     C                     ELSE                                                               204409
     C**********           Z-ADDZFLD15    WFLD15                                       243496 245803
     C                     Z-ADDZFLD15    WFLD15                                             243496B
     C                     Z-ADDZFLD15    WFLD15                                             243496B
     C**********           MULT -1        ZFLD15                                       245329 246344
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                                        204409
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDSAMT                                       204409 250989
     C**********           MOVE ZOUT20    SDSAMT                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDSAMT                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           Z-ADDWFLD15    ZFLD15                                       243496 245803
     C                     Z-ADDWFLD15    ZFLD15                                             243496B
     C                     ENDIF                                                              204409
     C                     ENDIF                                                              204409
      *
      ** If this is a full settlement then the outstanding amount,
      ** adjustment amount and past due amount should be blank and
      ** the total accrued to date should be taken from the fees
      ** master file.
      *
     C           FATYPE    IFEQ 'F'
     C**********           MOVE *BLANKS   SDOAMT                                              203765
     C**********           MOVE *BLANKS   SDADJA                                              203765
     C                     MOVE *BLANKS   SDPDUE
     C                     MOVE 'Y'       WFULL                                               203765
     C**********           Z-ADDFEADAT    ZFLD15                          BH3414
     C**********           ADD  FELPAM    ZFLD15                   BH3467 BH3414
     C**********           EXSR ZFRPED                                    BH3414
     C**********           MOVE ZOUT25    SDTACR                          BH3414
     C*                                                                   BH3414
     C***  Non- calculated fees                                           BH3414
     C*                                                                   BH3414
     C           FECALT    IFEQ '  '                                      BH3414
     C*                                                                   BH3414
     C           FEPEND    IFLE BJRDNB                                    BH3414
     C           FEPEND    OREQ 0                                         BH3414
     C           FEPYON    ANDEQ*BLANK                                    BH3414
     C                     Z-ADDFEFAMT    ZFLD15                          BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C***  Add extra day to accruals                                      BH3414
     C*                                                                   BH3414
     C           FEPSTD    IFNE BJRDNB                                    BH3414
     C           BJRDNB    SUB  FEPSTD    FLATDS  50                      BH3414
     C           FLATDS    SUB  1         FLATDS                          BH3414
     C***********FEADAT    DIV  FLATDS    FLATAM 130H              BH3414 156367
     C           FEADAT    DIV  FLATDS    FLATAM    H                     156367
     C           FLATDS    ADD  1         FLATDS                          BH3414
     C***********FLATAM    MULT FLATDS    FLATAM                   BH3414 156367
     C           FLATAM    MULT FLATDS    FLATAM    H                     156367
     C                     Z-ADDFLATAM    ZFLD15                          BH3414
     C                     ELSE                                           BH3414
     C                     Z-ADDFEADAT    ZFLD15                          BH3414
     C                     END                                            BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C**********           SUB  FASADJ    ZFLD15                                     084833 BUG23121
      *                                                                                       203765
      ** Add the Adjustment amount                                                            203765
      *                                                                                       203765
     C           FERECI    IFEQ 'M'                                                         MD024550
     C                     MOVE *BLANKS   SDTACR                                            MD024550
     C                     ELSE                                                             MD024550
     C                     ADD  WDTACR    ZFLD15                                              203765
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                    BH3414
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDTACR                          BH3414              250989
     C**********           MOVE ZOUT20    SDTACR                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDTACR                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN3                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     ENDIF                                                            MD024550
     C                     ELSE                                           BH3414
      *                                                                   BH3414
     C*                                                                   BH3414
     C** For calculated fees based on averages need to calculate          BH3414
     C** what the value would be if today was payment date                BH3414
     C*                                                                   BH3414
     C           FECALT    IFEQ '01'                                      BH3414
     C           FECALT    OREQ '02'                                      BH3414
     C           FECALT    OREQ '03'                                      BH3414
     C           FECALT    OREQ '11'                                      BH3414
     C           FECALT    OREQ '12'                                      BH3414
     C           FECALT    OREQ '13'                                      BH3414
     C           FECALT    OREQ '21'                                      BH3414
     C*                                                                   BH3414
     C                     EXSR AVCALC                                    BH3414
     C*                                                                   BH3414
     C           FEPYON    IFEQ 'N'                                                         MD027397
     C                     Z-ADD0         ZFLD15                                            MD027397
     C                     ELSE                                                             MD027397
     C                     Z-ADDWFEE      ZFLD15                          BH3414
     C                     ENDIF                                                            MD027397
     C***********          ADD  FEAMTP    ZFLD15                   BH3414 155677
     C***********          ADD  FEAMTS    ZFLD15                   BH3414 052125
      *                                                                                       203765
      ** Add the Adjustment amount                                                            203765
      *                                                                                       203765
     C                     ADD  WDTACR    ZFLD15                                              203765
     C*                                                                   BH3414
     C           ZFLD15    IFEQ *ZEROS                                    BH3414
     C           FERECI    OREQ 'M'                                                         MD024550
     C                     MOVE *BLANKS   SDTACR                          BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C**********           SUB  FASADJ    ZFLD15                                     084833 BUG23121
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                    BH3414
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDTACR                          BH3414              250989
     C**********           MOVE ZOUT20    SDTACR                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDTACR                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN3                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END                                            BH3414
     C*                                                                   BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C***  Actual amount fees                                             BH3414
     C*                                                                   BH3414
     C                     EXSR AVCALC                                    BH3414
     C           WFEE      ADD  FEADAT    WFEE                            BH3414
     C/COPY WNCPYSRC,LEH00644
      *                                                                                       CLE073
     C           FECALT    IFNE '97'                                                          CLE073
     C           FECALT    ANDNE'98'                                                          CLE073
     C           FECALT    ANDNE'99'                                                          CLE073
     C           FECALT    ANDNE'90'                                                          CLE134
      *                                                                                       CLE073
     C           *IN30     IFEQ '0'                                                         MD034270
     C           FEINDC    OREQ 'Y'                                                         MD034270
     C                     ADD  FELPAM    WFEE                            BH3414
     C                     ELSE                                                             MD034270
     C                     ADD  FEAMTA    WFEE                                              MD034270
     C           FECALT    IFNE '99'                                                        MD034270
     C           FECALT    ANDNE'90'                                                        MD034270
     C                     ADD  FETADJ    WFEE                                              MD034270
     C                     SUB  FEAMTS    WFEE                                              MD034270
     C                     SUB  FEAMTP    WFEE                                              MD034270
     C                     SUB  FEAMTW    WFEE                                              MD034270
      *                                                                                     MD034270
      ** Suspended fee                                                                      MD034270
      *                                                                                     MD034270
     C           CLE134    IFEQ 'Y'                                                         MD034270
     C           FEFSFA    ANDEQ'Y'                                                         MD034270
     C                     SUB  FESFA     WFEE                                              MD034270
     C                     ENDIF                                                            MD034270
      *                                                                                     MD034270
     C                     SUB  FEWOFF    WFEE                                              MD034270
     C                     ENDIF                                                            MD034270
     C                     ENDIF                                                            MD034270
     C/COPY WNCPYSRC,LEH00645
      *                                                                                       CLE073
     C                     ELSE                                                               CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C                     ADD  FETADJ    WFEE                                                CLE073
     C                     SUB  FEAMTS    WFEE                                                CLE073
     C                     SUB  FEAMTP    WFEE                                                CLE073
      *                                                                                       CLE134
      ** Suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     SUB  FESFA     WFEE                                                CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C                     SUB  FEAMTW    WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C                     SUB  FEWOFF    WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C           FECALT    OREQ '98'                                                          CLE073
     C           FECALT    OREQ '97'                                                          CLE073
     C                     ADD  FEAMTA    WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C***********          ADD  FEAMTP    WFEE                     BH3414 155677
     C***********          ADD  FEAMTS    WFEE                     BH3414 052125
      *                                                                                       203765
      ** Accrued to date amount plus fee adjustment                                           203765
      *                                                                                       203765
     C                     Z-ADDWFEE      ZFLD15                                              203765
     C                     ADD  WDTACR    ZFLD15                                              203765
     C*                                                                   BH3414
     C********** WFEE      IFEQ *ZEROS                                    BH3414              203765
     C           ZFLD15    IFEQ *ZEROS                                                        203765
     C           FERECI    OREQ 'M'                                                         MD024550
     C                     MOVE *BLANKS   SDTACR                          BH3414
     C                     ELSE                                           BH3414
     C**********                                                          BH3414              203765
     C***For*a*calculated fee the accrued amount should be adjusted       BH3414              203765
     C***for*amounts outstanding and settled                              BH3414              203765
     C**********                                                          BH3414              203765
     C**********           Z-ADDWFEE      ZFLD15                          BH3414              203765
      ******************************************************************               243496 245803
     C********** FEAMTP    IFEQ 0                                                      243496 245803
     C********** FEAMTP    IFEQ 0                                                   243496B BUG23121
     C**********           SUB  FASADJ    ZFLD15                                     084833 BUG23121
     C**********           ENDIF                                                    243496B BUG23121
     C**********           ENDIF                                                       243496 245803
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                    BH3414
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDTACR                          BH3414              250989
     C**********           MOVE ZOUT20    SDTACR                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDTACR                                              250989
     C**********           ENDIF                                                     250989 AR690561
      ******************************************************************               243496 245803
     C**********           MOVE ZOUT25    SDOAMT                                       243496 245803
      ******************************************************************               243496 245803
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN2                                       153664 245329
     C**********           MOVE ZOUT25    SDOAMT                                    243496B BUG23121
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C/COPY WNCPYSRC,LEH00646
      *                                                                                     MD034270
      ** Outstanding amount is the sum of total accr. to date and the                       MD034270
      ** amount due plus/minus the settlement amount.                                       MD034270
      *                                                                                     MD034270
     C**********           SUB  FASADJ    ZFLD15                                   BUG23121 MD034270
     C                     ADD  FEAMTP    ZFLD15                                            MD034270
     C           FASIGN    IFEQ '+'                                                         MD034270
     C                     Z-ADDFASADJ    WSADJ  130                                        MD034270
     C                     ELSE                                                             MD034270
     C                     Z-SUBFASADJ    WSADJ                                             MD034270
     C                     END                                                              MD034270
     C                     ADD  WSADJ     ZFLD15                                            MD034270
     C/COPY WNCPYSRC,LEH00648
     C                     MOVE 'J'       ZECODE                                            BUG23121
     C                     EXSR ZFRPED                                                      BUG23121
     C           ZNEG      IFEQ '-'                                                         BUG23121
     C                     MOVE ZOUT20    SDOAMT                                            BUG23121
     C                     ELSE                                                             BUG23121
     C                     MOVE ZOUT21    SDOAMT                                            BUG23121
     C                     ENDIF                                                            BUG23121
     C                     MOVE ZOUT25    SDOAMT                                            BUG23121
     C                     END                                            BH3414
     C/COPY WNCPYSRC,LEH00704
     C*                                                                   BH3414
      *                                                                                       CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C           FECALT    OREQ '98'                                                          CLE073
     C           FECALT    OREQ '97'                                                          CLE073
     C                     MOVE SDTACR    SDOAMT                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     END                                            BH3414
     C*                                                                   BH3414
     C                     END                                            BH3414
     C                     END
      *
      ** If this is a partial settlement set up screen fields
      ** accordingly.
      *
     C           FATYPE    IFEQ 'P'
      *
     C***********FEAMTO    SUB  FASADJ    AMTFLD                          154104
     C***********          Z-ADDAMTFLD    ZFLD15                          154104
     C***********          EXSR ZFRPED                                    154104
     C***********          MOVE ZOUT25    SDOAMT                          154104
     C***********          EXSR SRSIGN                             153664 154104
     C***********          MOVE WSIGN     SDSGN2                   153664 154104
      *                                                                                       203765
      ** Adjustment Amount                                                                    203765
      *
     C           FEAMTA    ADD  WDADJA    ZFLD15                                              203765
     C********** FEAMTA    IFEQ *ZEROS                                                        203765
     C           ZFLD15    IFEQ *ZEROS                                                        203765
     C                     MOVE *BLANKS   SDADJA
     C*********  FELPDT    IFEQ BJRDNB                                                 243496 245803
     C*********  KEY006    CHAINLEFEAM               70                                243496 245803
     C*********  *IN70     IFEQ '0'                                                    243496 245803
     C*********            Z-ADDFEOAMT    ZFLD15                                       243496 245803
     C*********            Z-ADDZFLD15    WFLD15                                       243496 245803
     C*********            EXSR ZFRPED                                                 243496 245803
     C*********            MOVE ZOUT25    SDADJA                                       243496 245803
     C*********            EXSR SRSIGN                                                 243496 245803
     C*********            MOVE WSIGN     SDSGN6                                       243496 245803
     C*********            Z-ADDWFLD15    ZFLD15                                       243496 245803
     C*********            ENDIF                                                       243496 245803
     C*********            ENDIF                                                       243496 245803
     C           FELPDT    IFEQ BJRDNB                                                       243496B
     C           KEY006    CHAINLEFEAM               70                                      243496B
     C           *IN70     IFEQ '0'                                                          243496B
     C                     Z-ADDFEOAMT    ZFLD15                                             243496B
     C                     Z-ADDZFLD15    WFLD15                                             243496B
     C                     EXSR ZFRPED                                                       243496B
     C                     MOVE ZOUT25    SDADJA                                             243496B
     C                     EXSR SRSIGN                                                       243496B
     C                     MOVE WSIGN     SDSGN6                                             243496B
     C                     Z-ADDWFLD15    ZFLD15                                             243496B
     C                     ENDIF                                                             243496B
     C                     ENDIF                                                             243496B
     C                     ELSE
     C**********           Z-ADDFEAMTA    ZFLD15                                              203765
     C********** FELPDT    IFEQ BJRDNB                                                 243496 245803
     C********** KEY006    CHAINLEFEAM               70                                243496 245803
     C********** *IN70     IFEQ '0'                                                    243496 245803
     C**********           ADD  FEOAMT    ZFLD15                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C           FELPDT    IFEQ BJRDNB                                                       243496B
     C           KEY006    CHAINLEFEAM               70                                      243496B
     C           *IN70     IFEQ '0'                                                          243496B
     C                     ADD  FEOAMT    ZFLD15                                             243496B
     C                     ENDIF                                                             243496B
     C                     ENDIF                                                             243496B
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDADJA                                              250989
     C**********           MOVE ZOUT20    SDADJA                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDADJA                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C                     EXSR SRSIGN                                    153664
     C                     MOVE WSIGN     SDSGN6                          153664
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *                                                                                       203765
      ** Amount Past Due                                                                      203765
      *
     C********** FEAMTP    SUB  FASADJ    AMTFLD                                              203765
     C                     SUB  FASADJ    WDPDUE                                              203765
     C           FEAMTP    ADD  WDPDUE    AMTFLD                                              203765
      *                                                                                       CLE134
      ** suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     ADD  FESFA     AMTFLD                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       203765
     C           AMTFLD    IFEQ *ZEROS
     C           AMTFLD    ORLT *ZEROS                                                        203765
     C           WFULL     OREQ 'Y'                                                           203765
     C                     MOVE *BLANKS   SDPDUE
     C                     ELSE
     C                     Z-ADDAMTFLD    ZFLD15
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDPDUE                                              250989
     C**********           MOVE ZOUT20    SDPDUE                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDPDUE                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN5                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *
      **  Set up screen detail fee accrued to date amount
      *
     C***  Non- calculated fees                                           BH3414
     C*                                                                   BH3414
     C           FECALT    IFEQ '  '                                      BH3414
     C*                                                                   BH3414
     C           FEPEND    IFLE BJRDNB                                    BH3414
     C                     Z-ADDFEFAMT    ZFLD15                          BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C***  Add extra day to accruals                                      BH3414
     C*                                                                   BH3414
     C           FEPSTD    IFNE BJRDNB                                    BH3414
     C           BJRDNB    SUB  FEPSTD    FLATDS  50                      BH3414
     C           FLATDS    SUB  1         FLATDS                          BH3414
     C***********FEADAT    DIV  FLATDS    FLATAM 130H              BH3414 156367
     C           FEADAT    DIV  FLATDS    FLATAM    H                     156367
     C           FLATDS    ADD  1         FLATDS                          BH3414
     C***********FLATAM    MULT FLATDS    FLATAM                   BH3414 156367
     C           FLATAM    MULT FLATDS    FLATAM    H                     156367
     C                     Z-ADDFLATAM    ZFLD15                          BH3414
     C                     ELSE                                           BH3414
     C                     Z-ADDFEADAT    ZFLD15
     C                     END                                            BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C**********           SUB  FASADJ    ZFLD15                                     084833 BUG23121
      ** Add the Adjustment amount                                                            203765
      *                                                                                       203765
     C           FERECI    IFEQ 'M'                                                         MD024550
     C                     MOVE *BLANKS   SDTACR                                            MD024550
     C                     ELSE                                                             MD024550
     C                     ADD  WDTACR    ZFLD15                                              203765
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDTACR                                              250989
     C**********           MOVE ZOUT20    SDTACR                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDTACR                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN3                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     ENDIF                                                            MD024550
     C                     ELSE                                           BH3414
      *
     C*                                                                   BH3414
     C** For calculated fees based on averages need to calculate          BH3414
     C** what the value would be if today was payment date                BH3414
     C*                                                                   BH3414
     C           FECALT    IFEQ '01'                                      BH3414
     C           FECALT    OREQ '02'                                      BH3414
     C           FECALT    OREQ '03'                                      BH3414
     C           FECALT    OREQ '11'                                      BH3414
     C           FECALT    OREQ '12'                                      BH3414
     C           FECALT    OREQ '13'                                      BH3414
     C           FECALT    OREQ '21'                                      BH3414
     C*                                                                   BH3414
     C                     EXSR AVCALC                                    BH3414
     C*                                                                   BH3414
     C           FEPYON    IFEQ 'N'                                                         MD027397
     C                     Z-ADD0         ZFLD15                                            MD027397
     C                     ELSE                                                             MD027397
     C                     Z-ADDWFEE      ZFLD15                          BH3414
     C                     ENDIF                                                            MD027397
     C***********          ADD  FEAMTP    ZFLD15                   BH3414 155677
     C***********          ADD  FEAMTS    ZFLD15                   BH3414 052125
     C*                                                                   BH3414
      ** Add the Adjustment amount                                                            203765
      *                                                                                       203765
     C                     ADD  WDTACR    ZFLD15                                              203765
      *                                                                                       203765
     C           ZFLD15    IFEQ *ZEROS                                    BH3414
     C           FERECI    OREQ 'M'                                                         MD024550
     C                     MOVE *BLANKS   SDTACR                          BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C**********           SUB  FASADJ    ZFLD15                                     084833 BUG23121
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                    BH3414
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDTACR                          BH3414              250989
     C**********           MOVE ZOUT20    SDTACR                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDTACR                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN3                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END                                            BH3414
     C*                                                                   BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C***  Actual amount fees                                             BH3414
     C*                                                                   BH3414
     C                     EXSR AVCALC                                    BH3414
     C           WFEE      ADD  FEADAT    WFEE                            BH3414
     C/COPY WNCPYSRC,LEH00705
      *                                                                                       CLE073
     C           FECALT    IFNE '97'                                                          CLE073
     C           FECALT    ANDNE'98'                                                          CLE073
     C           FECALT    ANDNE'99'                                                          CLE073
     C           FECALT    ANDNE'90'                                                          CLE134
      *                                                                                       CLE073
     C                     ADD  FELPAM    WFEE                            BH3414
     C/COPY WNCPYSRC,LEH00706
      *                                                                                       CLE073
     C                     ELSE                                                               CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C                     ADD  FETADJ    WFEE                                                CLE073
     C                     SUB  FEAMTS    WFEE                                                CLE073
     C                     SUB  FEAMTP    WFEE                                                CLE073
      *                                                                                       CLE134
      ** suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     SUB  FESFA     WFEE                                                CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C                     SUB  FEAMTW    WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C                     SUB  FEWOFF    WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C           FECALT    OREQ '98'                                                          CLE073
     C           FECALT    OREQ '97'                                                          CLE073
     C                     ADD  FEAMTA    WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C***********          ADD  FEAMTP    WFEE                     BH3414 155677
     C***********          ADD  FEAMTS    WFEE                     BH3414 052125
     C*                                                                   BH3414
     C********** FEADAT    IFEQ *ZEROS                                    BH3414
     C********** FELPAM    ANDEQ*ZEROS                             BH3467 BH3414
      *                                                                                       203765
      ** Accrued to date amount plus fee adjustment                                           203765
      *                                                                                       203765
     C                     Z-ADDWFEE      ZFLD15                                              203765
     C                     ADD  WDTACR    ZFLD15                                              203765
      *                                                                                       203765
     C********** WFEE      IFEQ *ZEROS                                    BH3414              203765
     C           ZFLD15    IFEQ *ZEROS                                                        203765
     C           FERECI    OREQ 'M'                                                         MD024550
     C                     MOVE *BLANKS   SDTACR
     C                     ELSE
     C**********                                                          BH3414              203765
     C***For*a*calculated*fee*the*accrued*amount*should*be*adjusted****   BH3414              203765
     C***for*amounts*outstanding*and*settled***************************   BH3414              203765
     C**********                                                          BH3414              203765
     C**********           Z-ADDFEADAT    ZFLD15                          BH3414
     C**********           ADD  FEAMTP    ZFLD15                          BH3414
     C**********           ADD  FEAMTS    ZFLD15                          BH3414
     C**********           ADD  FELPAM    ZFLD15                   BH3467 BH3414
     C**********           Z-ADDWFEE      ZFLD15                          BH3414              203765
     C/COPY WNCPYSRC,LEH00707
     C**********           SUB  FASADJ    ZFLD15                                     084833 BUG23121
     C/COPY WNCPYSRC,LEH00708
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDTACR                                              250989
     C**********           MOVE ZOUT20    SDTACR                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDTACR                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN3                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
     C*                                                                   BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C                     END                                            BH3414
      *                                                                   154104
     C           FECALT    IFEQ *BLANKS                                   154104
     C                     Z-ADDFEAMTO    ZFLD15                          154104
     C                     ELSE                                           154104
     C           SDTACR    IFEQ *BLANKS                                   154104
     C                     Z-ADD0         ZFLD15                          154104
     C                     ENDIF                                          154104
      *                                                                                       203765
      ** If a 'Full' settlement has not yet been made, add the past                           203765
      ** due amount then subtract the accumulated 'Partial' and                               203765
      ** 'Write-off' settlement amount                                                        203765
      *                                                                                       203765
     C           WFULL     IFNE 'Y'                                                           203765
     C**********           ADD  FEAMTP    ZFLD15                                     154104 BUG23121
     C/COPY WNCPYSRC,LEH00709
      *                                                                                       CLE134
      ** suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     ADD  FESFA     ZFLD15                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE073
     C           FECALT    IFNE '97'                                                          CLE073
     C           FECALT    ANDNE'98'                                                          CLE073
     C           FECALT    ANDNE'99'                                                          CLE073
     C           FECALT    ANDNE'90'                                                          CLE134
      *                                                                                       CLE073
     C                     SUB  WDSAMT    ZFLD15                                              203765
     C                     SUB  WWOFFA    ZFLD15                                              204409
     C/COPY WNCPYSRC,LEH00710
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     SUB  FEAMTS    ZFLD15                                           BUG23121A
     C           ZFLD15    IFLT 0                                                          BUG23121A
     C                     Z-ADD0         ZFLD15                                           BUG23121A
     C                     ENDIF                                                           BUG23121A
     C*                                                                                    BUG23121A
     C                     ENDIF                                                              203765
      *                                                                                       203765
     C                     ENDIF                                          154104
     C**********           SUB  FASADJ    ZFLD15                          154104              203765
      *                                                                   154104
     C           ZFLD15    IFEQ *ZEROS                                    154104
     C                     MOVE *BLANKS   SDOAMT                          154104
     C                     ELSE                                           154104
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                    154104
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDOAMT                          154104              250989
     C**********           MOVE ZOUT20    SDOAMT                                     250989 AR690569
     C**********           ELSE                                                      250989 AR690569
     C                     MOVE ZOUT21    SDOAMT                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 154104 245329
     C**********           MOVE WSIGN     SDSGN2                                       154104 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     ENDIF                                          154104
      *
     C                     END
      *
      ** A write off can be for the whole amount or part of the
      ** amount.
      *
     C           FATYPE    IFEQ 'W'
      *                                                                                       203765
      ** Amount Past Due                                                                      203765
      *
     C********** FEAMTP    SUB  FASADJ    AMTFLD                                              203765
     C                     SUB  FASADJ    WDPDUE                                              203765
     C           FEAMTP    ADD  WDPDUE    AMTFLD                                              203765
      *                                                                                       CLE134
      ** Suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     ADD  FESFA     AMTFLD                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           AMTFLD    IFEQ *ZEROS
     C           AMTFLD    ORLT *ZEROS                                                        203765
     C           WFULL     OREQ 'Y'                                                           203765
     C                     MOVE *BLANKS   SDPDUE
     C                     ELSE
     C                     Z-ADDAMTFLD    ZFLD15
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDPDUE                                              250989
     C**********           MOVE ZOUT20    SDPDUE                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDPDUE                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN5                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *
     C***********FEAMTO    SUB  FASADJ    AMTFLD                          154104
     C***********AMTFLD    IFEQ *ZEROS                                    154104
     C***********          MOVE *BLANKS   SDOAMT                          154104
     C***********          ELSE                                           154104
     C***********          Z-ADDAMTFLD    ZFLD15                          154104
     C***********          EXSR ZFRPED                                    154104
     C***********          MOVE ZOUT25    SDOAMT                          154104
     C***********          EXSR SRSIGN                             153664 154104
     C***********          MOVE WSIGN     SDSGN2                   153664 154104
     C***********          END                                            154104
      *
     C           FEAMTA    ADD  WDADJA    ZFLD15                                              203765
     C********** FEAMTA    IFEQ *ZEROS                                                        203765
     C           ZFLD15    IFEQ *ZEROS                                                        203765
     C                     MOVE *BLANKS   SDADJA
     C********** FELPDT    IFEQ BJRDNB                                                 243496 245803
     C********** KEY006    CHAINLEFEAM               70                                243496 245803
     C********** *IN70     IFEQ '0'                                                    243496 245803
     C**********           Z-ADDFEOAMT    ZFLD15                                       243496 245803
     C**********           Z-ADDZFLD15    WFLD15                                       243496 245803
     C**********           EXSR ZFRPED                                                 243496 245803
     C**********           MOVE ZOUT25    SDADJA                                       243496 245803
     C**********           EXSR SRSIGN                                                 243496 245803
     C**********           MOVE WSIGN     SDSGN6                                       243496 245803
     C**********           Z-ADDWFLD15    ZFLD15                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C           FELPDT    IFEQ BJRDNB                                                       243496B
     C           KEY006    CHAINLEFEAM               70                                      243496B
     C           *IN70     IFEQ '0'                                                          243496B
     C                     Z-ADDFEOAMT    ZFLD15                                             243496B
     C                     Z-ADDZFLD15    WFLD15                                             243496B
     C                     EXSR ZFRPED                                                       243496B
     C                     MOVE ZOUT25    SDADJA                                             243496B
     C                     EXSR SRSIGN                                                       243496B
     C                     MOVE WSIGN     SDSGN6                                             243496B
     C                     Z-ADDWFLD15    ZFLD15                                             243496B
     C                     ENDIF                                                             243496B
     C                     ENDIF                                                             243496B
     C                     ELSE
     C**********           Z-ADDFEAMTA    ZFLD15                                              203765
     C********** FELPDT    IFEQ BJRDNB                                                 243496 245803
     C********** KEY006    CHAINLEFEAM               70                                243496 245803
     C********** *IN70     IFEQ '0'                                                    243496 245803
     C**********           ADD  FEOAMT    ZFLD15                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C           FELPDT    IFEQ BJRDNB                                                       243496B
     C           KEY006    CHAINLEFEAM               70                                      243496B
     C           *IN70     IFEQ '0'                                                          243496B
     C                     ADD  FEOAMT    ZFLD15                                             243496B
     C                     ENDIF                                                             243496B
     C                     ENDIF                                                             243496B
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDADJA                                              250989
     C**********           MOVE ZOUT20    SDADJA                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDADJA                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C                     EXSR SRSIGN                                    153664
     C                     MOVE WSIGN     SDSGN6                          153664
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
     C*                                                                   BH3414
     C***  Non- calculated fees                                           BH3414
     C*                                                                   BH3414
     C           FECALT    IFEQ '  '                                      BH3414
     C*                                                                   BH3414
     C           FEPEND    IFLE BJRDNB                                    BH3414
     C           FEPEND    OREQ 0                                         BH3414
     C           FEPYON    ANDEQ*BLANK                                    BH3414
     C                     Z-ADDFEFAMT    ZFLD15                          BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C***  Add extra day to accruals                                      BH3414
     C*                                                                   BH3414
     C           FEPSTD    IFNE BJRDNB                                    BH3414
     C           BJRDNB    SUB  FEPSTD    FLATDS  50                      BH3414
     C           FLATDS    SUB  1         FLATDS                          BH3414
     C***********FEADAT    DIV  FLATDS    FLATAM 130H              BH3414 156367
     C           FEADAT    DIV  FLATDS    FLATAM    H                     156367
     C           FLATDS    ADD  1         FLATDS                          BH3414
     C           FLATAM    MULT FLATDS    FLATAM                          BH3414
     C***********FLATAM    MULT FLATDS    FLATAM                   BH3414 156367
     C           FLATAM    MULT FLATDS    FLATAM    H                     156367
     C                     Z-ADDFLATAM    ZFLD15                          BH3414
     C                     ELSE                                           BH3414
     C                     Z-ADDFEADAT    ZFLD15                          BH3414
     C                     END                                            BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C**********           SUB  FASADJ    ZFLD15                                     084833 BUG23121
      *                                                                                       203765
      ** Add the Adjustment amount                                                            203765
      *                                                                                       203765
     C           FERECI    IFEQ 'M'                                                         MD024550
     C                     MOVE *BLANKS   SDTACR                                            MD024550
     C                     ELSE                                                             MD024550
     C                     ADD  WDTACR    ZFLD15                                              203765
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                    BH3414
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDTACR                          BH3414              250989
     C**********           MOVE ZOUT20    SDTACR                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDTACR                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN3                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     ENDIF                                                            MD024550
     C                     ELSE                                           BH3414
      *                                                                   BH3414
     C*                                                                   BH3414
     C** For calculated fees based on averages need to calculate          BH3414
     C** what the value would be if today was payment date                BH3414
     C*                                                                   BH3414
     C           FECALT    IFEQ '01'                                      BH3414
     C           FECALT    OREQ '02'                                      BH3414
     C           FECALT    OREQ '03'                                      BH3414
     C           FECALT    OREQ '11'                                      BH3414
     C           FECALT    OREQ '12'                                      BH3414
     C           FECALT    OREQ '13'                                      BH3414
     C           FECALT    OREQ '21'                                      BH3414
     C*                                                                   BH3414
     C                     EXSR AVCALC                                    BH3414
     C*                                                                   BH3414
     C           FEPYON    IFEQ 'N'                                                         MD027397
     C                     Z-ADD0         ZFLD15                                            MD027397
     C                     ELSE                                                             MD027397
     C                     Z-ADDWFEE      ZFLD15                          BH3414
     C                     ENDIF                                                            MD027397
     C***********          ADD  FEAMTP    ZFLD15                   BH3414 155677
     C***********          ADD  FEAMTS    ZFLD15                   BH3414 052125
      *                                                                                       203765
      ** Add the Adjustment amount                                                            203765
      *                                                                                       203765
     C                     ADD  WDTACR    ZFLD15                                              203765
     C*                                                                   BH3414
     C           ZFLD15    IFEQ *ZEROS                                    BH3414
     C           FERECI    OREQ 'M'                                                         MD024550
     C                     MOVE *BLANKS   SDTACR                          BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C                     SUB  FASADJ    ZFLD15                          084833
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                    BH3414
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDTACR                          BH3414              250989
     C**********           MOVE ZOUT20    SDTACR                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDTACR                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN3                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END                                            BH3414
     C*                                                                   BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C***  Actual amount fees                                             BH3414
     C*                                                                   BH3414
     C                     EXSR AVCALC                                    BH3414
     C           WFEE      ADD  FEADAT    WFEE                            BH3414
     C/COPY WNCPYSRC,LEH00711
      *                                                                                       CLE073
     C           FECALT    IFNE '97'                                                          CLE073
     C           FECALT    ANDNE'98'                                                          CLE073
     C           FECALT    ANDNE'99'                                                          CLE073
     C           FECALT    ANDNE'90'                                                          CLE134
      *                                                                                       CLE073
     C                     ADD  FELPAM    WFEE                            BH3414
     C/COPY WNCPYSRC,LEH00712
      *                                                                                       CLE073
     C                     ELSE                                                               CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C                     ADD  FETADJ    WFEE                                                CLE073
     C                     SUB  FEAMTS    WFEE                                                CLE073
     C                     SUB  FEAMTP    WFEE                                                CLE073
      *                                                                                       CLE134
      ** suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     SUB  FESFA     WFEE                                                CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C                     SUB  FEAMTW    WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C                     SUB  FEWOFF    WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C           FECALT    OREQ '98'                                                          CLE073
     C           FECALT    OREQ '97'                                                          CLE073
     C                     ADD  FEAMTA    WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C***********          ADD  FEAMTP    WFEE                     BH3414 155677
     C***********          ADD  FEAMTS    WFEE                     BH3414 052125
      *                                                                                       203765
      ** Accrued to date amount plus fee adjustment                                           203765
      *                                                                                       203765
     C                     Z-ADDWFEE      ZFLD15                                              203765
     C                     ADD  WDTACR    ZFLD15                                              203765
     C*                                                                   BH3414
     C********** WFEE      IFEQ *ZEROS                                    BH3414              203765
     C           ZFLD15    IFEQ *ZEROS                                                        203765
     C           FERECI    OREQ 'M'                                                         MD024550
     C                     MOVE *BLANKS   SDTACR                          BH3414
     C                     ELSE                                           BH3414
     C**********                                                          BH3414              203765
     C***For*a*calculated*fee*the*accrued*amount*should*be*adjusted**     BH3414              203765
     C***for*amounts*outstanding*and*settled*************************     BH3414              203765
     C**********                                                          BH3414              203765
     C**********           Z-ADDWFEE      ZFLD15                          BH3414              203765
     C/COPY WNCPYSRC,LEH00713
      *                                                                                       CLE073
     C           FECALT    IFNE '99'                                                          CLE073
     C           FECALT    ANDNE'90'                                                          CLE134
      *                                                                                       CLE073
     C                     SUB  FASADJ    ZFLD15                          084833
     C/COPY WNCPYSRC,LEH00714
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                    BH3414
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDTACR                          BH3414              250989
     C**********           MOVE ZOUT20    SDTACR                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDTACR                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN3                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END                                            BH3414
     C*                                                                   BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C                     END                                            BH3414
      *                                                                   154104
     C           FECALT    IFEQ *BLANKS                                   154104
     C                     Z-ADDFEAMTO    ZFLD15                          154104
     C                     ELSE                                           154104
     C           SDTACR    IFEQ *BLANKS                                   154104
     C                     Z-ADD0         ZFLD15                          154104
     C                     ENDIF                                          154104
      *                                                                                       203765
      ** If a 'Full' settlement has not yet been made, add the past                           203765
      ** due amount then subtract the accumulated 'Partial' and                               203765
      ** 'Write-off' settlement amount                                                        203765
      *                                                                                       203765
     C           WFULL     IFNE 'Y'                                                           203765
     C**********           ADD  FEAMTP    ZFLD15                                     154104 BUG23121
     C/COPY WNCPYSRC,LEH00715
      *                                                                                       CLE134
      ** suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     ADD  FESFA     ZFLD15                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE073
     C           FECALT    IFNE '97'                                                          CLE073
     C           FECALT    ANDNE'98'                                                          CLE073
     C           FECALT    ANDNE'99'                                                          CLE073
     C           FECALT    ANDNE'90'                                                          CLE134
      *                                                                                       CLE073
     C                     SUB  WDSAMT    ZFLD15                                              203765
     C                     SUB  WWOFFA    ZFLD15                                              204409
     C/COPY WNCPYSRC,LEH00716
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     SUB  FEAMTS    ZFLD15                                           BUG23121A
     C           ZFLD15    IFLT 0                                                          BUG23121A
     C                     Z-ADD0         ZFLD15                                           BUG23121A
     C                     ENDIF                                                           BUG23121A
     C*                                                                                    BUG23121A
     C                     ENDIF                                                              203765
      *                                                                                       203765
     C                     ENDIF                                          154104
     C**********           SUB  FASADJ    ZFLD15                          154104              203765
      *                                                                   154104
     C           ZFLD15    IFEQ *ZEROS                                    154104
     C                     MOVE *BLANKS   SDOAMT                          154104
     C                     ELSE                                           154104
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                    154104
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDOAMT                          154104              250989
     C**********           MOVE ZOUT20    SDOAMT                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDOAMT                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 154104 245329
     C**********           MOVE WSIGN     SDSGN2                                       154104 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     ENDIF                                          154104
      *
     C                     END
      *
     C**********           END                                            BH3521
     C*                                                                   BH3521
     C                     ELSE                                           BH3521
      *
      ** If this is an adjustment record.
      *
     C********** FARECI    IFNE 'S'                                       BH3521
      *
     C           FASIGN    IFEQ '+'                                       084833
     C                     Z-ADDFASADJ    WSADJ  130                      084833
     C                     ELSE                                           084833
     C                     Z-SUBFASADJ    WSADJ                           084833
     C                     END                                            084833
      *                                                                                       203765
      ** Save the fee adjustment for use in Full, Partial and Write-off                       203765
      ** There should only be one adjustment for every fee.                                   203765
      *                                                                                       203765
     C                     Z-ADDWSADJ     WDTACR                                              203765
     C*                                                                   084833
      ** Settle Amount                                                                        203765
      *                                                                                       203765
     C           FEAMTS    ADD  WDSAMT    ZFLD15                                              203765
     C********** FEAMTS    IFEQ *ZEROS                                                        203765
     C           ZFLD15    IFEQ *ZEROS                                                        203765
     C                     MOVE *BLANKS   SDSAMT
     C                     ELSE
     C**********           Z-ADDFEAMTS    ZFLD15                                              203765
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C**********           MULT -1        ZFLD15                                       245329 246344
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDSAMT                                              250989
     C**********           MOVE ZOUT20    SDSAMT                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDSAMT                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C                     EXSR SRSIGN                                    153664
     C                     MOVE WSIGN     SDSGN4                          153664
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *
      **  Set up screen detail fee accrued to date amount
      *
     C***  Non- calculated fees                                           BH3414
     C*                                                                   BH3414
     C           FECALT    IFEQ '  '                                      BH3414
     C*                                                                   BH3414
     C           FEPEND    IFLE BJRDNB                                    BH3414
     C                     Z-ADDFEFAMT    ZFLD15                          BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C***  Add extra day to accruals                                      BH3414
     C*                                                                   BH3414
     C           FEPSTD    IFNE BJRDNB                                    BH3414
     C           BJRDNB    SUB  FEPSTD    FLATDS  50                      BH3414
     C           FLATDS    SUB  1         FLATDS                          BH3414
     C***********FEADAT    DIV  FLATDS    FLATAM 130H              BH3414 156367
     C           FEADAT    DIV  FLATDS    FLATAM    H                     156367
     C           FLATDS    ADD  1         FLATDS                          BH3414
     C***********FLATAM    MULT FLATDS    FLATAM                   BH3414 156367
     C           FLATAM    MULT FLATDS    FLATAM    H                     156367
     C                     Z-ADDFLATAM    ZFLD15                          BH3414
     C                     ELSE                                           BH3414
     C                     Z-ADDFEADAT    ZFLD15
     C                     END                                            BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C           FERECI    IFEQ 'M'                                                         MD024550
     C                     MOVE *BLANKS   SDTACR                                            MD024550
     C                     ELSE                                                             MD024550
     C                     ADD  WSADJ     ZFLD15                          084833
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDTACR                                              250989
     C**********           MOVE ZOUT20    SDTACR                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDTACR                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN3                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     ENDIF                                                            MD024550
     C                     ELSE                                           BH3414
      *
     C*                                                                   BH3414
     C** For calculated fees based on averages need to calculate          BH3414
     C** what the value would be if today was payment date                BH3414
     C*                                                                   BH3414
     C           FECALT    IFEQ '01'                                      BH3414
     C           FECALT    OREQ '02'                                      BH3414
     C           FECALT    OREQ '03'                                      BH3414
     C           FECALT    OREQ '11'                                      BH3414
     C           FECALT    OREQ '12'                                      BH3414
     C           FECALT    OREQ '13'                                      BH3414
     C           FECALT    OREQ '21'                                      BH3414
     C*                                                                   BH3414
     C                     EXSR AVCALC                                    BH3414
     C*                                                                   BH3414
     C           FEPYON    IFEQ 'N'                                                         MD027397
     C                     Z-ADD0         ZFLD15                                            MD027397
     C                     ELSE                                                             MD027397
     C                     Z-ADDWFEE      ZFLD15                          BH3414
     C                     ENDIF                                                            MD027397
     C***********          ADD  FEAMTP    ZFLD15                   BH3414 155677
      *                                                                   153736
      ** Add adjustment amount to Total recieved to date                  153736
      *                                                                   153736
     C           FASIGN    IFEQ '+'                                       153736
     C                     ADD  FASADJ    ZFLD15                          153736
     C                     ELSE                                           153736
     C                     SUB  FASADJ    ZFLD15                          153736
     C                     ENDIF                                          153736
      *                                                                   153736
     C***********          ADD  FEAMTS    ZFLD15                   BH3414 052125
     C*                                                                   BH3414
     C           ZFLD15    IFEQ *ZEROS                                    BH3414
     C           FERECI    OREQ 'M'                                                         MD024550
     C                     MOVE *BLANKS   SDTACR                          BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C**********           ADD  WSADJ     ZFLD15                          084833              203765
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED                                    BH3414
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDTACR                          BH3414              250989
     C**********           MOVE ZOUT20    SDTACR                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDTACR                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN3                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END                                            BH3414
     C*                                                                   BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C***  Actual amount fees                                             BH3414
     C*                                                                   BH3414
     C                     EXSR AVCALC                                    BH3414
     C           WFEE      ADD  FEADAT    WFEE                            BH3414
     C/COPY WNCPYSRC,LEH00717
      *                                                                                       CLE073
     C           FECALT    IFNE '99'                                                          CLE073
     C           FECALT    ANDNE'98'                                                          CLE073
     C           FECALT    ANDNE'97'                                                          CLE073
      *                                                                                       CLE073
     C**********           ADD  FELPAM    WFEE                                       BH3414 AR550590
     C/COPY WNCPYSRC,LEH00718
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C                     ADD  FETADJ    WFEE                                                CLE073
     C                     SUB  FEAMTS    WFEE                                                CLE073
     C                     SUB  FEAMTP    WFEE                                                CLE073
      *                                                                                       CLE134
      * suspended fee                                                                         CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     SUB  FESFA     WFEE                                                CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C                     SUB  FEAMTW    WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C                     SUB  FEWOFF    WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C           FECALT    OREQ '98'                                                          CLE073
     C           FECALT    OREQ '97'                                                          CLE073
     C                     ADD  FEAMTA    WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C***********          ADD  FEAMTP    WFEE                     BH3414 155677
      *                                                                   153736
      ** Add adjustment amount to Total recieved to date                  153736
      *                                                                   153736
     C           FASIGN    IFEQ '+'                                       153736
     C                     ADD  FASADJ    ZFLD15                          153736
     C                     ELSE                                           153736
     C                     SUB  FASADJ    ZFLD15                          153736
     C                     ENDIF                                          153736
      *                                                                   153736
     C***********          ADD  FEAMTS    WFEE                     BH3414 052125
      *                                                                                     AR550590
     C           *IN30     IFEQ '0'                                                         AR550590
     C           FEINDC    OREQ 'Y'                                                         AR550590
     C                     Z-ADDFELPAM    WFEE                                              AR550590
     C                     ELSE                                                             AR550590
     C                     ADD  FEAMTA    WFEE                                              AR550590
     C                     ADD  FETADJ    WFEE                                              AR550590
     C                     SUB  FEAMTS    WFEE                                              AR550590
     C                     SUB  FEAMTP    WFEE                                              AR550590
     C                     SUB  FEAMTW    WFEE                                              AR550590
     C                     SUB  FEWOFF    WFEE                                              AR550590
     C                     ENDIF                                                            AR550590
     C*                                                                   BH3414
     C********** FEADAT    IFEQ *ZEROS                                    BH3414
     C********** FELPAM    ANDEQ*ZEROS                             BH3467 BH3414
     C           WFEE      IFEQ *ZEROS                                    BH3414
     C           FERECI    OREQ 'M'                                                         MD024550
     C                     MOVE *BLANKS   SDTACR
     C                     ELSE
     C*                                                                   BH3414
     C** For a calculated fee the accrued amount should be adjusted       BH3414
     C** for amounts outstanding and settled                              BH3414
     C*                                                                   BH3414
     C**********           Z-ADDFEADAT    ZFLD15                          BH3414
     C**********           ADD  FEAMTP    ZFLD15                          BH3414
     C**********           ADD  FEAMTS    ZFLD15                          BH3414
     C**********           ADD  FELPAM    ZFLD15                   BH3467 BH3414
     C                     Z-ADDWFEE      ZFLD15                          BH3414
     C                     ADD  WSADJ     ZFLD15                          084833
      *                                                                                       204302
     C                     Z-ADDZFLD15    WFLD15 150                                          204302
      *                                                                                       204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDTACR                                              250989
     C**********           MOVE ZOUT20    SDTACR                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDTACR                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN3                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
     C*                                                                   BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C                     END                                            BH3414
      *
     C           FATYPE    IFEQ ' '
      *
     C           FECALT    IFEQ *BLANKS                                   154104
     C                     Z-ADDFEAMTO    ZFLD15                          154104
     C                     ELSE                                           154104
     C           SDTACR    IFEQ *BLANKS                                   154104
     C                     Z-ADD0         ZFLD15                          154104
     C                     ENDIF                                          154104
     C                     ADD  FEAMTP    ZFLD15                          154104
      *                                                                                       CLE134
      ** suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     ADD  FESFA     ZFLD15                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDIF                                          154104
      *                                                                                       203765
      ** If a 'Full' settlement has been made, subtract the whole past                        203765
      ** due amount to retain the accrued amount only.                                        203765
      ** Else, subtract the accumulated settlement amount                                     203765
      *                                                                                       203765
     C           WFULL     IFEQ 'Y'                                                           203765
     C                     SUB  FEAMTP    ZFLD15                                              203765
      *                                                                                       CLE134
      ** suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     SUB  FESFA     ZFLD15                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ELSE                                                               203765
     C                     SUB  WDSAMT    ZFLD15                                              203765
     C                     ENDIF                                                              203765
      *                                                                   154104
      ** Fee adjusment has already been added in previous statements                          203765
      *                                                                                       203765
     C********** FASIGN    IFEQ '-'                                       BH3414              203765
     C***********FEAMTO    SUB  FASADJ    AMTFLD                          154104
     C**********           SUB  FASADJ    ZFLD15                          154104              203765
     C**********           ELSE                                           BH3414              203765
     C***********FEAMTO    ADD  FASADJ    AMTFLD                   BH3414 154104
     C**********           ADD  FASADJ    ZFLD15                          154104              203765
     C**********           END                                            BH3414              203765
     C*                                                                   BH3414
     C***********          Z-ADDAMTFLD    ZFLD15                          154104
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDOAMT                                              250989
     C**********           MOVE ZOUT20    SDOAMT                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDOAMT                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN2                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
      *
      **  Positive or negative adjustment.
      *
     C           FASIGN    IFEQ '+'
     C           FASIGN    OREQ ' '                                       BH3521
     C********** FEAMTA    ADD  FASADJ    AMTFLD                                              203765
     C                     ADD  FASADJ    WDADJA                                              203765
     C           FEAMTA    ADD  WDADJA    AMTFLD                                              203765
     C                     Z-ADDAMTFLD    ZFLD15
     C********** FELPDT    IFEQ BJRDNB                                                 243496 245803
     C********** KEY006    CHAINLEFEAM               70                                243496 245803
     C********** *IN70     IFEQ '0'                                                    243496 245803
     C**********           ADD  FEOAMT    ZFLD15                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C           FELPDT    IFEQ BJRDNB                                                       243496B
     C           KEY006    CHAINLEFEAM               70                                      243496B
     C           *IN70     IFEQ '0'                                                          243496B
     C                     ADD  FEOAMT    ZFLD15                                             243496B
     C                     ENDIF                                                             243496B
     C                     ENDIF                                                             243496B
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDADJA                                              250989
     C**********           MOVE ZOUT20    SDADJA                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDADJA                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C                     EXSR SRSIGN                                    153664
     C                     MOVE WSIGN     SDSGN6                          153664
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *
     C           FASIGN    IFEQ '-'
     C********** FEAMTA    SUB  FASADJ    AMTFLD                                              203765
     C                     SUB  FASADJ    WDADJA                                              203765
     C           FEAMTA    ADD  WDADJA    AMTFLD                                              203765
     C                     Z-ADDAMTFLD    ZFLD15
     C********** FELPDT    IFEQ BJRDNB                                                 243496 245803
     C********** KEY006    CHAINLEFEAM               70                                243496 245803
     C********** *IN70     IFEQ '0'                                                    243496 245803
     C**********           ADD  FEOAMT    ZFLD15                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C           FELPDT    IFEQ BJRDNB                                                       243496B
     C           KEY006    CHAINLEFEAM               70                                      243496B
     C           *IN70     IFEQ '0'                                                          243496B
     C                     ADD  FEOAMT    ZFLD15                                             243496B
     C                     ENDIF                                                             243496B
     C                     ENDIF                                                             243496B
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDADJA                                              250989
     C**********           MOVE ZOUT20    SDADJA                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDADJA                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C                     EXSR SRSIGN                                    153664
     C                     MOVE WSIGN     SDSGN6                          153664
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *
      ** Amount Past Due, WFULL will be 'Y' whenever there is a Full                          203765
      ** Settlement                                                                           203765
      *                                                                                       203765
     C           FEAMTP    ADD  WDPDUE    ZFLD15                                              203765
      *                                                                                       CLE134
      * suspended fee                                                                         CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     ADD  FESFA     ZFLD15                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C********** FEAMTP    IFEQ *ZEROS                                                        203765
     C           ZFLD15    IFLE *ZEROS                                                        203765
     C           WFULL     OREQ 'Y'                                                           203765
     C                     MOVE *BLANKS   SDPDUE
     C                     ELSE
     C**********           Z-ADDFEAMTP    ZFLD15                                              203765
     C                     Z-ADDZFLD15    WFLD15                                              204302
     C                     MOVE 'J'       ZECODE                                              250989
     C                     EXSR ZFRPED
     C********** ZNEG      IFEQ '-'                                                  250989 AR690561
     C**********           MOVE ZOUT25    SDPDUE                                              250989
     C**********           MOVE ZOUT20    SDPDUE                                     250989 AR690561
     C**********           ELSE                                                      250989 AR690561
     C                     MOVE ZOUT21    SDPDUE                                              250989
     C**********           ENDIF                                                     250989 AR690561
     C**********           EXSR SRSIGN                                                 153664 245329
     C**********           MOVE WSIGN     SDSGN5                                       153664 245329
     C                     Z-ADDWFLD15    ZFLD15                                              204302
     C                     END
      *
     C                     END
      *
     C                     END
      *
     C                     ENDIF                                                              203765
      *                                                                                       203765
     C                     ENDDO                                                              203765
      *                                                                                       203765
     C                     END
      *
     C                     END
      *                                                                                    AR1090331
      ** Blank out some of the fields when fee is already                                  AR1090331
      ** a reversed fee.                                                                   AR1090331
      *                                                                                    AR1090331
     C           FERECI    IFEQ '*'                                                        AR1090331
     C           *IN11     ANDEQ'0'                                                        AR1090331
     C           *IN11     OREQ '1'                                                        AR1090331
     C                     MOVE *BLANKS   SDTACR                                           AR1090331
     C                     MOVE *BLANKS   SDOAMT                                           AR1090331
     C                     MOVE ' '       SDSGN3                                           AR1090331
     C                     MOVE ' '       SDSGN2                                           AR1090331
     C                     ENDIF                                                           AR1090331
      *                                                                                    AR1090331
      *
     C                     MOVE FEPRFC    SPRFC                           PCA031
     C*                                                                   S01408
     C           FEDDAT    IFEQ BJRDNB                                    113362
     C                     MOVE *ON       *IN17                           113362
     C                     ELSE                                           113362
     C                     MOVE *OFF      *IN17                           113362
     C                     ENDIF                                          113362
      *                                                                   CLE014
      ** Display F14 function narrative for settlement details            CLE014
      *                                                                   CLE014
     C                     MOVE *OFF      *IN32                           CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           CLE006    IFEQ 'Y'                                       CLE014
     C           CLE007    OREQ 'Y'                                       CLE014
     C           CLE105    OREQ 'Y'                                       CLE014
     C                     MOVE *ON       *IN32                           CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C*                                                                   113362
     C/COPY WNCPYSRC,LER115CLDS                                           S01408
     C*                                                                   S01408
     C           WEXIT     DOUEQ'Y'                                       CLE014
     C                     MOVE 'Y'       WEXIT   1                       CLE014
     C                     EXFMTDETAIL
     C           *IN32     IFEQ *ON                                       CLE014
     C           *INKN     IFEQ *ON                                       CLE014
     C                     EXSR SRFXST                                    CLE014
      ** Call the new program LE2230 instead of SD2400, if the                                CLE034
      ** CLE034 = 'Y' and Settlement Allocation is 'Y'                                        CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           SSTAL     ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C                     CALL 'LE2230'                                                      CLE034
     C                     PARM 'FEES'    PTYPE   4                                           CLE034
     C                     PARM           SFLNRF                                              CLE034
     C                     PARM *BLANKS   PVDAT   5                                           CLE034
     C                     PARM *BLANKS   PSEQN   3                                           CLE034
     C                     PARM           SFCNUM                                              CLE034
     C                     PARM           SFFREF                                              CLE034
     C                     PARM           SFFSEQ                                              CLE034
     C                     PARM           SETLIB                                              CLE034
     C                     PARM           SETLIZ                                              CLE034
     C                     PARM           PMODE   1                                           CLE034
     C                     PARM           PTMST  26                                           CLE034
     C                     PARM *BLANKS   PERRF   1                                           CLE034
     C                     PARM *BLANKS   PWARN   1                                           CLE034
     C                     PARM *BLANKS   PSNOS   1                                           CLE034
     C                     PARM *BLANKS   PSAMD   1                                           CLE034
     C                     PARM *BLANKS   PNDET   1                                           CLE034
     C                     PARM *BLANKS   PRCCY  60                                           CLE034
     C                     PARM *BLANKS   PRLOC  60                                           CLE034
     C                     PARM *BLANKS   PPCCY  60                                           CLE034
     C                     PARM *BLANKS   PPLOC  60                                           CLE034
     C                     PARM *BLANKS   PPCRF  15                                           CLE034
     C                     PARM *BLANKS   WORED   5                                           CLE038
     C                     PARM *ZEROS    WALAM  130                                          CLE038
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'SD2400'                                  CLE014
     C                     PARM           PRCODE  7                       CLE014
     C                     PARM           SETLIB                          CLE014
     C                     PARM           SETLIZ                          CLE014
     C                     PARM           PSLNRF  6                       CLE014
     C                     PARM           @PARM3                                              222373
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   CLE014
      ** Database error, terminate processing                             CLE014
      *                                                                   CLE014
     C           PMDBSE    IFNE 0                                         CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVELPMDBFL    DBFILE                          CLE014
     C                     Z-ADDPMDBSE    DBASE                           CLE014
     C                     MOVELPMDBKY    DBKEY                           CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     SELEC                                          CLE014
     C           PMCMDP    WHEQ '03'                                      CLE014
     C                     MOVE *ON       *INKC                           CLE014
     C           PMCMDP    WHEQ '12'                                      CLE014
     C                     MOVE *BLANK    WEXIT                           CLE014
     C                     ENDSL                                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                                       CLE134
      ** If F21, call Past Due Loans Enquiry                                                  CLE134
      *                                                                                       CLE134
     C           *INKV     IFEQ *ON                                                           CLE134
     C                     CLEARD@PDUE                                                        CLE134
      *                                                                                       CLE134
     C           *IN15     IFEQ *ON                                                           CLE134
     C                     MOVE 'FFEE'    P@PDTP                                              CLE134
     C                     MOVELSDFACT    P@FACL                                              CLE134
     C                     MOVE SDFCNO    P@FACL                                              CLE134
     C                     ELSE                                                               CLE134
     C                     MOVE 'LFEE'    P@PDTP                                              CLE134
     C                     MOVE SDLNRF    P@LNRF                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     MOVE SDCNUM    P@CNUM                                              CLE134
     C                     MOVE SDFSEQ    P@FSEQ                                              CLE134
     C                     MOVE SDBRCA    P@BRCA                                              CLE134
      *                                                                                       CLE134
     C                     CALL 'LE000215'                                                    CLE134
     C                     PARM *BLANKS   P@RTCD  7                                           CLE134
     C                     PARM           D@PDUE                                              CLE134
      *                                                                                       CLE134
     C           P@RTCD    IFEQ '*ERROR*'                                                     CLE134
     C                     EXSR *PSSR                                                         CLE134
     C                     ELSE                                                               CLE134
     C                     MOVE *BLANK    WEXIT                                               CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                   CLE014
     C                     ENDDO                                          CLE014
      *
     C/COPY WNCPYSRC,LER115C006
     C                     END
      *
     C                     ENDSR
      *                                                                   153664
      *****************************************************************   CLE014
      /EJECT                                                              CLE014
      *****************************************************************   CLE014
      *                                                               *   CLE014
      *  SRFXST  -  Format Extended Settlement Fields                 *   CLE014
      *                                                               *   CLE014
      *  Called by: DETSCR subroutine                                 *   CLE014
      *  Calls: None                                                  *   CLE014
      *                                                               *   CLE014
      *****************************************************************   CLE014
      *                                                                   CLE014
     C           SRFXST    BEGSR                                          CLE014
      *                                                                   CLE014
      ** Set up communication fileds                                      CLE014
      *                                                                   CLE014
     C           SFLNRF    IFNE *BLANKS                                   CLE014
     C                     MOVE 'F1'      PMTTYP                          CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'F2'      PMTTYP                          CLE014
     C                     ENDIF                                          CLE014
     C                     MOVE 'E'       PMACTC                          CLE014
     C                     MOVE 'LEND'    PMCPGM                          CLE014
     C                     MOVE *BLANK    PMCMDP                          CLE014
     C                     Z-ADD0         PMDBSE                          CLE014
     C                     Z-ADDBJRDNB    PMRUND                          CLE014
     C                     Z-ADDBJBVPD    PMBVPD                          CLE014
     C                     MOVE FEPSTD    PMDTRC                          CLE014
     C                     MOVE FEPEND    PMDTPY                          CLE014
     C                     MOVELFECNUM    PMCSNM                          CLE014
     C                     MOVELFEBRCA    PMBRCA                          CLE014
     C                     MOVE FEFCCY    PMRCCY                          CLE014
     C                     MOVE FEFCCY    PMPCCY                          CLE014
     C                     MOVE 'N'       PMSDTV                          CLE014
      *                                                                   CLE014
      ** No settlement validation                                         CLE014
      *                                                                   CLE014
     C                     MOVE 'N'       PMVALO                          CLE014
     C                     MOVE *BLANK    PMERCD                          CLE014
      *                                                                   CLE014
      ** Protect settlement details                                       CLE014
      *                                                                   CLE014
     C                     MOVE 'Y'       PMPRCV                          CLE014
     C                     MOVE 'Y'       PMPPAY                          CLE014
      *                                                                   CLE014
      ** Set up payment settlement details                                CLE014
      *                                                                   CLE014
     C                     MOVELRSTM      PMRSTM                          CLE014
     C                     MOVELRONS      PMRONS                          CLE014
     C                     MOVELRIBN      PMRIBN                          CLE014
     C                     MOVELRIBN      PARIBN                          CLE014
     C                     MOVELRIBA      PMRIBA                          CLE014
     C                     MOVELROCN      PMROCN                          CLE014
     C                     MOVELROCN      PAROCN                          CLE014
     C                     MOVELROBN      PMROBN                          CLE014
     C                     MOVELROBN      PAROBN                          CLE014
     C                     MOVELPSTM      PMPSTM                          CLE014
     C                     MOVELPONS      PMPONS                          CLE014
     C                     MOVELPIBN      PMPIBN                          CLE014
     C                     MOVELPIBN      PAPIBN                          CLE014
     C                     MOVELPIBA      PMPIBA                          CLE014
     C                     MOVELPOCN      PMPOCN                          CLE014
     C                     MOVELPOCN      PAPOCN                          CLE014
     C                     MOVELPOBN      PMPOBN                          CLE014
     C                     MOVELPOBN      PAPOBN                          CLE014
     C                     MOVELRCRN      PMRCRN                          CLE014
     C                     MOVELRCRN      PARCRN                          CLE014
     C                     MOVELRCRA      PMRCRA                          CLE014
     C                     MOVELRVNO      PMRVNO                          CLE014
     C                     MOVELRVNO      PARVNO                          CLE014
     C                     MOVELAWBN      PMAWBN                          CLE014
     C                     MOVELAWBN      PAAWBN                          CLE014
     C                     MOVELAWBA      PMAWBA                          CLE014
     C                     MOVELBENN      PMBENN                          CLE014
     C                     MOVELBENN      PABENN                          CLE014
     C                     MOVELBENA      PMBENA                          CLE014
     C                     MOVELDTP1      PMDTP1                          CLE014
     C                     MOVELDTP2      PMDTP2                          CLE014
     C                     MOVELDTP3      PMDTP3                          CLE014
     C                     MOVELDTP4      PMDTP4                          CLE014
     C                     MOVELDCHG      PMDCHG                          CLE014
     C                     MOVELBTB1      PMBTB1                          CLE014
     C                     MOVELBTB2      PMBTB2                          CLE014
     C                     MOVELBTB3      PMBTB3                          CLE014
     C                     MOVELBTB4      PMBTB4                          CLE014
     C                     MOVELBTB5      PMBTB5                          CLE014
     C                     MOVELBTB6      PMBTB6                          CLE014
     C                     MOVELCVMR      PMCVMR                          CLE014
     C                     MOVELOSDB      PMROBR                          CLE014
     C                     MOVELOMDB      PMPOBR                          CLE014
      *                                                                   CLE014
     C           CEU004    IFEQ 'Y'                                       CLE014
     C           CLE031    OREQ 'Y'                                                           CLE031
     C                     MOVELFESCCY    PMRSCY                          CLE014
     C                     MOVELFESCCY    PMPSCY                          CLE014
     C                     MOVELFEICCY    PMIC72                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           CLE031    IFEQ 'Y'                                                           CLE031
      *                                                                                       CLE031
     C           FEREXR    IFEQ 0                                                             CLE031
     C                     MOVE *BLANKS   PMREXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   ZFIELD 16                                           CLE031
     C                     MOVE FEREXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC   10                                          CLE031
      *                                                                                       CLE031
     C                     CALL 'ZEDIT'                                                       CLE031
     C                     PARM           ZFIELD                                              CLE031
     C                     PARM           ZADEC                                               CLE031
      *                                                                                       CLE031
     C                     MOVE ZFIELD    PMREXR                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVE FEREXI    PMREXI                                              CLE031
     C                     MOVE FEPSCY    PMPSCY                                              CLE031
      *                                                                                       CLE031
     C           FEPEXR    IFEQ 0                                                             CLE031
     C                     MOVE *BLANKS   PMPEXR                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *BLANKS   ZFIELD                                              CLE031
     C                     MOVE FEPEXR    ZFIELD                                              CLE031
     C                     Z-ADD8         ZADEC                                               CLE031
      *                                                                                       CLE031
     C                     CALL 'ZEDIT'                                                       CLE031
     C                     PARM           ZFIELD                                              CLE031
     C                     PARM           ZADEC                                               CLE031
      *                                                                                       CLE031
     C                     MOVE ZFIELD    PMPEXR                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVE FEPEXI    PMPEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR                                          CLE014
      *                                                                   CLE014
      *****************************************************************   CLE014
      /EJECT                                                              CLE014
      *****************************************************************   153664
      *                                                               *   153664
      *  SRSIGN - Subroutine to check what sign to be place on amount *   153664
      *                                                               *   153664
      *  Called By: DETSCR                                            *   153664
      *  Calls:     NONE                                              *   153664
      *                                                               *   153664
      *****************************************************************   153664
      *                                                                   153664
     C           SRSIGN    BEGSR                                          153664
      *                                                                   153664
      ** Sign of amount will be set up as follows:                        153664
      **  1. Sign will be set to blank if amount is positive and the      153664
      **     facility has been selected.                                  153664
      **  2. Sign will be set to blank if amount is negative and the      153664
      **     facility is  participant  or internal and it has not         153664
      **     been selected.                                               153664
      **  3. Sign will be set to '-' if amount is negative and the        153664
      **     facility has been selected.                                  153664
      **  4. Sign will be set to '-' if amount is positive and the        153664
      **     facility is  participant  or internal and it has not         153664
      **     been selected.                                               153664
      *                                                                   153664
     C********** FELOAN    IFNE 0                                                      153664 CLE148
     C           FELOAN    IFNE *BLANKS                                                       CLE148
      *                                                                   153664
     C           ZFLD15    IFLT 0                                         153664
     C                     MOVE '-'       WSIGN   1                       153664
     C                     ELSE                                           153664
     C                     MOVE ' '       WSIGN                           153664
     C                     ENDIF                                          153664
      *                                                                   153664
     C                     ELSE                                           153664
      *                                                                   153664
     C           ZFLD15    IFLT 0                                         153664
     C           PTFI      ANDEQ'P'                                       153664
     C           WFREFA    ANDEQWFREFB                                    153664
     C           ZFLD15    ORLT 0                                         153664
     C           PTFI      ANDEQ'I'                                       153664
     C           WFREFA    ANDEQWFREFB                                    153664
     C           ZFLD15    ORLT 0                                                             CLE106
     C           PTFI      ANDEQ'S'                                                           CLE106
     C           WFREFA    ANDEQWFREFB                                                        CLE106
     C           ZFLD15    ORLT 0                                                             CLE106
     C           PTFI      ANDEQ'R'                                                           CLE106
     C           WFREFA    ANDEQWFREFB                                                        CLE106
     C           ZFLD15    ORGT 0                                         153664
     C           PTFI      ANDEQ'P'                                       153664
     C           WFREFA    ANDNEWFREFB                                    153664
     C           ZFLD15    ORGT 0                                         153664
     C           PTFI      ANDEQ'I'                                       153664
     C           WFREFA    ANDNEWFREFB                                    153664
     C           ZFLD15    ORGT 0                                                             CLE106
     C           PTFI      ANDEQ'S'                                                           CLE106
     C           WFREFA    ANDNEWFREFB                                                        CLE106
     C           ZFLD15    ORGT 0                                                             CLE106
     C           PTFI      ANDEQ'R'                                                           CLE106
     C           WFREFA    ANDNEWFREFB                                                        CLE106
     C                     MOVE '-'       WSIGN                           153664
     C                     ELSE                                           153664
     C                     MOVE ' '       WSIGN                           153664
     C                     ENDIF                                          153664
      *                                                                   153664
     C                     ENDIF                                          153664
      *                                                                   153664
     C                     ENDSR                                          153664
      *
     C********************************************************************BH3414
     C*                                                                   BH3414
     C*  AVCALC -- Calculation of fees based on average balances          BH3414
     C*                                                                   BH3414
     C*  CALLED FROM: Main Processing                                     BH3414
     C*                                                                   BH3414
     C*  CALLS: NOTHING                                                   BH3414
     C*                                                                   BH3414
     C********************************************************************BH3414
     C           AVCALC    BEGSR                                          BH3414
     C/COPY WNCPYSRC,LEH00719
      *                                                                                       CLE073
      *                                                                                       CLE073
      ** If Loan based calculated fees then call AVCALL                                       CLE073
      *                                                                                       CLE073
     C                     MOVE *BLANKS   WLOANF  1                                           CLE073
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C           FECALT    OREQ '99'                                                          CLE073
     C                     MOVE 'Y'       WLOANF                                              CLE073
     C                     EXSR AVCALL                                                        CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FECALT    ANDEQ'90'                                                          CLE134
     C                     MOVE 'Y'       WLOANF                                              CLE134
     C                     EXSR AVCALL                                                        CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE073
     C           WLOANF    IFNE 'Y'                                                           CLE073
      *                                                                                       CLE073
     C*                                                                   BH3414
     C** Obtain original facility details from facility history header.   BH3414
     C*                                                                   BH3414
     C           *IN71     IFEQ *ON                                       090266
     C           FACKEY    CHAINFACHISH              20                   BH3414
     C*                                                                   BH3414
     C           *IN20     IFEQ '1'                                       BH3414
     C           *LOCK     IN   LDA                                       BH3414
     C                     MOVEL'LER115'  DBPGM                           BH3414
     C                     MOVELFECNUM    DBKEY                           BH3414
     C                     MOVE FEFACL    DBKEY                           BH3414
     C                     MOVEL'FACHISH' DBFILE           ************   BH3414
     C                     Z-ADD17        DBASE            * DBERR 17 *   BH3414
     C                     OUT  LDA                        ************   BH3414
     C                     EXSR *PSSR                                     BH3414
     C                     END                                            BH3414
     C                     ENDIF                                          090266
     C*                                                                   BH3414
     C                     Z-ADD0         WAMT   130                      BH3414
     C                     Z-ADD0         WPCT    63                      BH3414
     C*                                                                   BH3414
     C***  Set up Start and End dates                                     BH3414
     C*                                                                   BH3414
     C                     Z-ADDFELPDT    STDATE  50     19               BH3414
     C   19                Z-ADDFEPSTD    STDATE                          BH3414
     C                     Z-ADDBJRDNB    ENDATE  50                      BH3414
      ******************************************************************               243496 245803
     C********** FEPEND    IFGT BJRDNB                                                 243496 245803
     C********** FELPDT    ANDEQBJRDNB                                                 243496 245803
     C**********           ADD  1         ENDATE                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C********** FEPEND    IFGT BJRDNB                                              243496B BUG22790
     C           FEPEND    IFEQ BJRDNB                                                      BUG22790
     C           FELPDT    ANDEQBJRDNB                                                       243496B
     C                     ADD  1         ENDATE                                             243496B
     C                     ENDIF                                                             243496B
      *******************************************************************              243496 245803
     C           FEPEND    IFLE BJRDNB                                    BH3414
     C                     Z-ADDFEPEND    ENDATE                          BH3414
     C                     END                                            BH3414
     C********** BKALDI    IFEQ 'N'                                                 247644B BUG21857
     C**********           SUB  1         ENDATE                                    247644B BUG21857
     C**********           END                                                      247644B BUG21857
      *                                                                                      BUG8762
     C           *IN30     IFEQ '1'                                                          BUG8762
     C********** FEINDC    ANDNE'Y'                                                   243496A 245803
     C           FEINDC    ANDNE'Y'                                                          243496B
     C                     Z-ADDFEPSTD    STDATE                                             BUG8762
     C                     ELSE                                                              BUG8762
     C                     Z-ADDFELADT    STDATE                                             BUG8762
     C           STDATE    IFEQ 0                                                            BUG8762
     C                     Z-ADDFEPSTD    STDATE                                             BUG8762
     C                     ENDIF                                                             BUG8762
     C                     ENDIF                                                             BUG8762
     C*                                                                   BH3414
     C***  For Actual amount fees, need to accrue for today to add to     BH3414
     C***  accrued to date amount on file.                                BH3414
     C*                                                                   BH3414
     C           BJRDNB    IFNE FEPEND                                    BH3514
     C           BJRDNB    ANDNEFELPDT                                    BH3514
     C           FECALT    IFEQ '04'                                      BH3414
     C           FECALT    OREQ '05'                                      BH3414
     C           FECALT    OREQ '06'                                      BH3414
     C           FECALT    OREQ '14'                                      BH3414
     C           FECALT    OREQ '15'                                      BH3414
     C           FECALT    OREQ '16'                                      BH3414
     C           FECALT    OREQ '22'                                      BH3414
     C***********BJRDNB    SUB  1         STDATE                   BH3414 052814
      **********                                                                       204653 239961
      ***When*CLE005*is*switched*ON,*LER135*always*use*fee*start*date*as************** 204653 239961
      ***start*date*for*the*computation*of*the*number*of*days************************* 204653 239961
      **********                                                                       204653 239961
     C********** *IN30     IFEQ '1'                                                    204653 239961
     C**********           Z-ADDFEPSTD    STDATE                                       204653 239961
     C**********           ELSE                                                        204653 239961
     C********** *IN30     IFEQ '1'                                                   243496A 245803
     C********** FEINDC    ANDNE'Y'                                                   243496A 245803
     C**********           Z-ADDFEPSTD    STDATE                                      243496A 245803
     C**********           ELSE                                                       243496A 245803
     C           *IN30     IFEQ '1'                                                          243496B
     C           FEINDC    ANDNE'Y'                                                          243496B
     C                     Z-ADDFEPSTD    STDATE                                             243496B
     C                     ELSE                                                              243496B
     C                     Z-ADDFELADT    STDATE                          052814
     C           STDATE    IFEQ 0                                         105265
     C                     Z-ADDFEPSTD    STDATE                          105265
     C                     END                                            105265
     C**********           ENDIF                                                       204653 239961
     C**********           ENDIF                                                      243496A 245803
     C                     ENDIF                                                             243496B
     C                     END                                            BH3414
     C                     END                                            BH3514
     C*                                                                   BH3414
     C** Obtain number of days to use.                                    BH3414
     C*                                                                   BH3414
     C********** ENDATE    SUB  STDATE    WDAYS   50               BH3414 CLE013
     C                     Z-ADDSTDATE    ZZBEG                           CLE013
     C                     Z-ADDENDATE    ZZEND                           CLE013
     C                     MOVE FECALC    ZZCALC                          CLE013
     C                     EXSR ZINTDY                                    CLE013
     C           FECALC    IFEQ 6                                                             212048
     C**********           Z-ADDINT6DY    WDAYS                                      212048 BUG21892
     C                     Z-ADDINT6DY    WDAYS2 159H                                       BUG21892
     C                     ELSE                                                               212048
     C                     Z-ADDZZINDY    WDAYS   50                      CLE013
     C                     END                                                                212048
      *                                                                                      BUG8762
     C                     Z-ADD0         WFEE   130                                         BUG8762
      *                                                                                      BUG8762
      ** Store end date which is equal to rundate.                                           BUG8762
      *                                                                                      BUG8762
     C                     Z-ADDENDATE    OMDATE  50                                         BUG8762
      *                                                                                      BUG8762
      ** Move rates and amounts from LEFEED to working arrays.                               BUG8762
      *                                                                                      BUG8762
     C                     Z-ADDFEAM      @WAMT                                              BUG8762
     C                     Z-ADDFRT       @WRT                                               BUG8762
      *                                                                                      BUG8762
      *                                                                                      BUG8762
      ** Read LEFHST to get the right rates and amounts for                                  BUG8762
      ** for specific fee period.                                                            BUG8762
      *                                                                                      BUG8762
     C           LEFKEY    KLIST                                                             BUG8762
     C                     KFLD           FECNUM                                             BUG8762
     C                     KFLD           FEFACL                                             BUG8762
     C                     KFLD           FEFSEQ                                             BUG8762
      *                                                                                      BUG8762
     C           LEFKEY    SETLLLEFHSTOM                                                     BUG8762
     C           LEFKEY    READELEFHSTOM            N    27                                  BUG8762
     C           *IN27     DOUEQ'1'                                                          BUG8762
      ******************************************************************              243496A 245803
     C********** *IN30     IFEQ '0'                                                   243496A 245803
     C********** FEINDC    OREQ 'Y'                                                   243496A 245803
     C**********           MOVE '1'       *IN27                                       243496A 245803
     C**********           ENDIF                                                      243496A 245803
     C           *IN30     IFEQ '0'                                                          243496B
     C           FEINDC    OREQ 'Y'                                                          243496B
     C                     MOVE '1'       *IN27                                              243496B
     C                     ENDIF                                                             243496B
      *                                                                                      BUG8762
      ** Move rates and amounts from historical file to FAMT & FRT.                          BUG8762
      *                                                                                      BUG8762
     C           *IN27     IFEQ '0'                                                          BUG8762
     C                     Z-ADD@HAMT     FEAM                                               BUG8762
     C                     Z-ADD@HRT      FRT                                                BUG8762
     C                     Z-ADDOMHDAT    ENDATE                                             BUG8762
     C                     ELSE                                                              BUG8762
     C                     Z-ADD@WAMT     FEAM                                               BUG8762
     C                     Z-ADD@WRT      FRT                                                BUG8762
     C                     Z-ADDOMDATE    ENDATE                                             BUG8762
     C                     ENDIF                                                             BUG8762
      *                                                                                      BUG8762
     C*                                                                   BH3414
     C** Get starting amount from facility history file                   BH3414
     C*                                                                   BH3414
     C**********           Z-ADD*ZERO     FACNUM                                       146237 CSD027
     C                     MOVE *BLANKS   FACNUM                                              CSD027
     C                     Z-ADD*ZERO     FAFCTY                          146237
     C                     Z-ADD*ZERO     FADATE                          146237
     C                     Z-ADD*ZERO     FAFSEQ                          146237
     C***********HSAKY1    SETGTFACHSAL1                            BH3414144092
     C***********HSAKY1    SETGTFACHSAL1             26             144092146237
     C           HSAKY1    SETGTFACHSAL1                                  146237
     C************IN26     IFEQ *ON                                 144092146237
     C                     READPFACHSAL1                 20               BH3414
     C           FECNUM    IFEQ FACNUM                                    146237
     C           FEFACL    ANDEQFAFCTY                                    146237
     C***********STDATE    ANDEQFADATE                              146237153736
     C***********STFSEQ    ANDEQFAFSEQ                              146237153736
     C*                                                                   BH3414
     C** Set up current facility amount from file.                        BH3414
     C*                                                                   BH3414
     C** Set up amount for accrual according to calculation type.         BH3414
     C** Calculation types 01 to 06 use available facility amount,        BH3414
     C** types 11 to 16 use outstanding facility amount and               BH3414
     C** types 21 and 22 use the current facility amount.                 BH3414
     C*                                                                   BH3414
     C           FECALT    IFEQ '01'                                      BH3414
     C           FECALT    OREQ '02'                                      BH3414
     C           FECALT    OREQ '03'                                      BH3414
     C           FECALT    OREQ '04'                                      BH3414
     C           FECALT    OREQ '05'                                      BH3414
     C           FECALT    OREQ '06'                                      BH3414
     C           FAUNDR    IFGE 0                                         BH3414
     C                     Z-ADDFAUNDR    AAMT   130                      BH3414
     C                     ELSE                                           BH3414
     C                     Z-ADD0         AAMT                            BH3414
     C                     END                                            BH3414
     C                     ELSE                                           BH3414
     C           FECALT    IFEQ '11'                                      BH3414
     C           FECALT    OREQ '12'                                      BH3414
     C           FECALT    OREQ '13'                                      BH3414
     C           FECALT    OREQ '14'                                      BH3414
     C           FECALT    OREQ '15'                                      BH3414
     C           FECALT    OREQ '16'                                      BH3414
     C                     Z-ADDFADRAM    AAMT                            BH3414
     C                     ELSE                                           BH3414
     C           FECALT    IFEQ '21'                                      BH3414
     C           FECALT    OREQ '22'                                      BH3414
     C                     Z-ADDFACFAM    AAMT                            BH3414
     C                     END                                            BH3414
     C                     END                                            BH3414
     C                     END                                            BH3414
     C                     ELSE                                           144092
     C********** FECALT    IFEQ '21'                                               BUG21831 BUG23523
     C********** FECALT    OREQ '22'                                               BUG21831 BUG23523
     C                     Z-ADDFAMT      AAMT                            144092
     C**********           ELSE                                                    BUG21831 BUG23523
     C********** KFCLTY    CHAINFCLTYL2F             70                            BUG21831 BUG23523
     C********** *IN70     IFEQ *ON                                                BUG21831 BUG23523
     C********** *LOCK     IN   LDA                                                BUG21831 BUG23523
     C**********           MOVEL'FCLTYL2' DBFILE    P                              BUG21831 BUG23523
     C**********           MOVEL'LER115'  DBPGM     P                              BUG21831 BUG23523
     C**********           MOVELWUKEY     DBKEY     P                              BUG21831 BUG23523
     C**********           Z-ADD006       DBASE                                    BUG21831 BUG23523
     C**********           OUT  LDA                                                BUG21831 BUG23523
     C**********           EXSR *PSSR                                              BUG21831 BUG23523
     C**********           ENDIF                                                   BUG21831 BUG23523
     C********** FECALT    IFEQ '01'                                               BUG21831 BUG23523
     C********** FECALT    OREQ '02'                                               BUG21831 BUG23523
     C********** FECALT    OREQ '03'                                               BUG21831 BUG23523
     C********** FECALT    OREQ '04'                                               BUG21831 BUG23523
     C********** FECALT    OREQ '05'                                               BUG21831 BUG23523
     C********** FECALT    OREQ '06'                                               BUG21831 BUG23523
     C********** FAMT      SUB  CAMD      AAMT                                     BUG21831 BUG23523
     C**********           ELSE                                                    BUG21831 BUG23523
     C********** FECALT    IFEQ '11'                                               BUG21831 BUG23523
     C********** FECALT    OREQ '12'                                               BUG21831 BUG23523
     C********** FECALT    OREQ '13'                                               BUG21831 BUG23523
     C********** FECALT    OREQ '14'                                               BUG21831 BUG23523
     C********** FECALT    OREQ '15'                                               BUG21831 BUG23523
     C********** FECALT    OREQ '16'                                               BUG21831 BUG23523
     C**********           Z-ADDCAMD      AAMT                                     BUG21831 BUG23523
     C**********           ENDIF                                                   BUG21831 BUG23523
     C**********           ENDIF                                                   BUG21831 BUG23523
     C**********           ENDIF                                                   BUG21831 BUG23523
     C                     ENDIF                                          144092
     C*                                                                   BH3414
     C** Initialise work fee field.                                       BH3414
     C*                                                                   BH3414
     C**********           Z-ADD0         WFEE   130                                  BH3414 BUG8762
     C                     Z-ADD0         WTOT                                                204320
     C                     Z-ADD0         WAMT                                             AR1020182
     C                     MOVE '0'       *IN19   1                                           204320
     C*                                                                   BH3414
     C** Read file until date read is greater than date of end of         BH3414
     C** this accrual period.                                             BH3414
     C** NDAYS is the number of days in this accrual.                     BH3414
     C*                                                                   BH3414
     C                     MOVE '0'       *IN18                           BH3414
     C           *LOVAL    SETLLFACHSAL1                                                    BUG23230
     C           HSAKY2    SETLLFACHSAL1                                                    BUG23230
     C           *IN18     DOWEQ'0'                                       BH3414
     C           HSAKY2    READEFACHSAL1                 18               BH3414
     C*                                                                   BH3414
     C           *IN18     IFEQ '1'                                       BH3414
     C           FADATE    ORGT ENDATE                                    BH3414
     C           BKALDI    ANDNE'Y'                                                          BUG8762
     C           FADATE    ORGE ENDATE                                                       BUG8762
     C           BKALDI    ANDEQ'Y'                                                          BUG8762
     C                     Z-ADDENDATE    FADATE                          BH3414
     C                     MOVE '1'       *IN18                           BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
      *                                                                                     MD022296
      ** Save drawn amount of FS (Facility Start) which might be needed                     MD022296
      ** in calculation of accrual.                                                         MD022296
      *                                                                                     MD022296
     C           FAACTN    IFEQ 'FS'                                                        MD022296
     C                     Z-ADDFAUNDR    OFAUDR 150                                        MD022296
     C                     ENDIF                                                            MD022296
      *                                                                                     MD022296
     C********** FADATE    SUB  STDATE    NDAYS   50               BH3414 CLE013
     C                     Z-ADDSTDATE    ZZBEG                           CLE013
     C                     Z-ADDFADATE    ZZEND                           CLE013
     C                     MOVE FECALC    ZZCALC                          CLE013
     C                     EXSR ZINTDY                                    CLE013
     C           FECALC    IFEQ 6                                                             212048
     C**********           Z-ADDINT6DY    NDAYS                                      212048 BUG21892
     C                     Z-ADDINT6DY    NDAYS2 159H                                       BUG21892
     C                     ELSE                                                               212048
     C                     Z-ADDZZINDY    NDAYS   50                      CLE013
     C                     END                                                                212048
     C*                                                                                     BUG23230
     C** Make sure that current amount from history file is use based on Calculation type.  BUG23230
     C*                                                                                     BUG23230
     C*                                                                                     BUG23230
     C           *IN18     IFEQ '0'                                                         BUG23523
     C           FECALT    IFEQ '01'                                                        BUG23230
     C           FECALT    OREQ '02'                                                        BUG23230
     C           FECALT    OREQ '03'                                                        BUG23230
     C           FECALT    OREQ '04'                                                        BUG23230
     C           FECALT    OREQ '05'                                                        BUG23230
     C           FECALT    OREQ '06'                                                        BUG23230
     C           FAUNDR    IFGE 0                                                           BUG23230
     C                     Z-ADDFAUNDR    NEWAMT                                            BUG23230
     C           AAMT      IFNE NEWAMT                                                      BUG23230
     C                     Z-ADDNEWAMT    AAMT                                              BUG23230
     C                     ENDIF                                                            BUG23230
     C                     ENDIF                                                            BUG23230
     C                     ENDIF                                                            BUG23230
     C*                                                                                     BUG23230
     C           FECALT    IFEQ '11'                                                        BUG23230
     C           FECALT    OREQ '12'                                                        BUG23230
     C           FECALT    OREQ '13'                                                        BUG23230
     C           FECALT    OREQ '14'                                                        BUG23230
     C           FECALT    OREQ '15'                                                        BUG23230
     C           FECALT    OREQ '16'                                                        BUG23230
     C           FADRAM    IFGE 0                                                           BUG23230
     C                     Z-ADDFADRAM    NEWAMT                                            BUG23230
     C           AAMT      IFNE NEWAMT                                                      BUG23230
     C                     Z-ADDNEWAMT    AAMT                                              BUG23230
     C                     ENDIF                                                            BUG23230
     C                     ENDIF                                                            BUG23230
     C                     ENDIF                                                            BUG23230
     C*                                                                                     BUG23230
     C           FAACTN    IFEQ 'FI'                                                        BUG23230
     C           FAACTN    OREQ 'FD'                                                        BUG23230
     C           FECALT    IFEQ '21'                                                        BUG23230
     C           FECALT    OREQ '22'                                                        BUG23230
     C                     Z-ADDFACFAM    NEWAMT 130                                        BUG23230
     C                     ENDIF                                                            BUG23230
     C                     ENDIF                                                            BUG23230
     C*                                                                                     BUG23523
     C                     ENDIF                                                            BUG23523
     C*                                                                   BH3414
     C           NDAYS     IFGT 0                                         BH3414
     C           NDAYS2    ORGT 0                                                           BUG21892
      *                                                                                       204320
      ** limit the processing for fees based on average amount                                204320
      *                                                                                       204320
     C           FECALT    IFEQ '01'                                                          204320
     C           FECALT    OREQ '02'                                                          204320
     C           FECALT    OREQ '03'                                                          204320
     C           FECALT    OREQ '11'                                                          204320
     C           FECALT    OREQ '12'                                                          204320
     C           FECALT    OREQ '13'                                                          204320
     C           FECALT    OREQ '21'                                                          204320
     C*                                                                   BH3414
     C** Average amount used (only does accrual once)                     BH3414
     C*                                                                   BH3414
     C           FECALC    IFEQ 6                                                           BUG21892
     C                     MULT NDAYS2    AAMT                                              BUG21892
     C                     DIV  WDAYS2    AAMT      H                                       BUG21892
     C                     ADD  AAMT      WAMT                                              BUG21892
     C                     ELSE                                                             BUG21892
     C                     MULT NDAYS     AAMT                            BH3414
     C                     DIV  WDAYS     AAMT      H                     BH3414
     C                     ADD  AAMT      WAMT                            BH3414
     C                     ENDIF                                                            BUG21892
     C                     ELSE                                                               204320
     C**********           Z-ADDAAMT      WAMT                                       204320 MD022296
      *                                                                                     MD022296
      ** Use the previous amount in accrual computation in this period                      MD022296
      *                                                                                     MD022296
     C                     Z-ADDOFAUDR    WAMT                                              MD022296
     C                     ENDIF                                                              204320
     C                     Z-ADDFADATE    STDATE                          BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C** Reset amount to accrue - comes from next record on amounts       BH3414
     C** file.                                                            BH3414
     C*                                                                   BH3414
     C           FECALT    IFEQ '01'                                      BH3414
     C           FECALT    OREQ '02'                                      BH3414
     C           FECALT    OREQ '03'                                      BH3414
     C           FECALT    OREQ '04'                                                          204320
     C           FECALT    OREQ '05'                                                          204320
     C           FECALT    OREQ '06'                                                          204320
     C           FAUNDR    IFGE 0                                         BH3414
     C                     Z-ADDFAUNDR    AAMT                            BH3414
     C                     ELSE                                           BH3414
     C                     Z-ADD0         AAMT                            BH3414
     C                     END                                            BH3414
     C                     ELSE                                           BH3414
     C           FECALT    IFEQ '11'                                      BH3414
     C           FECALT    OREQ '12'                                      BH3414
     C           FECALT    OREQ '13'                                      BH3414
     C           FECALT    OREQ '14'                                                          204320
     C           FECALT    OREQ '15'                                                          204320
     C           FECALT    OREQ '16'                                                          204320
     C                     Z-ADDFADRAM    AAMT                            BH3414
     C                     ELSE                                           BH3414
     C           FECALT    IFEQ '21'                                      BH3414
     C           FECALT    OREQ '22'                                                          204320
     C           FACFAM    IFNE NEWAMT                                                      BUG23230
     C           NEWAMT    ANDGT*ZERO                                                       BUG23230
     C                     Z-ADDNEWAMT    AAMT                                              BUG23230
     C                     ELSE                                                             BUG23230
     C                     Z-ADDFACFAM    AAMT                            BH3414
     C                     ENDIF                                                            BUG23230
     C                     END                                            BH3414
     C                     END                                            BH3414
     C                     END                                            BH3414
      *                                                                                       204320
     C           FECALT    IFEQ '04'                                                          204320
     C           FECALT    OREQ '05'                                                          204320
     C           FECALT    OREQ '06'                                                          204320
     C           FECALT    OREQ '14'                                                          204320
     C           FECALT    OREQ '15'                                                          204320
     C           FECALT    OREQ '16'                                                          204320
     C           FECALT    OREQ '22'                                                          204320
     C                     EXSR ACCRUE                                                        204320
     C********** FEPYON    IFEQ 'N'                                                MD027397 MD030669
     C**********           Z-ADD0         ZFLD15                                   MD027397 MD030669
     C**********           ELSE                                                    MD027397 MD030669
     C                     ADD  WTOT      WFEE                                                204320
     C**********           ENDIF                                                   MD027397 MD030669
     C                     ENDIF                                                              204320
      *                                                                                       204320
      ** Save the drawn amount. This will be used in the computation of                     MD022296
      ** next period accrual.                                                               MD022296
      *                                                                                     MD022296
     C           FADATE    IFGT OFADAT                                                      MD022296
     C           FAUNDR    ORNE OFAUDR                                                      MD022296
     C                     Z-ADDFAUNDR    OFAUDR 150                                        MD022296
     C                     Z-ADDFADATE    OFADAT  50                                        MD022296
     C                     ENDIF                                                            MD022296
      *                                                                                     MD022296
     C                     END                                            BH3414
     C                     Z-ADDENDATE    STDATE                                             BUG8762
     C           LEFKEY    READELEFHSTOM            N    27                                  BUG8762
     C                     ENDDO                                                             BUG8762
      *                                                                                      BUG8762
     C           *IN27     IFEQ '1'                                                          BUG8762
     C           ENDATE    ANDLTOMDATE                                                       BUG8762
      *                                                                                      BUG8762
     C                     Z-ADD@WAMT     FEAM                                               BUG8762
     C                     Z-ADD@WRT      FRT                                                BUG8762
     C                     Z-ADDOMDATE    ENDATE                                             BUG8762
     C**********           Z-ADD*ZERO     FACNUM                                     BUG8762 CSD027A
     C                     MOVE *BLANKS   FACNUM                                             CSD027A
     C                     Z-ADD*ZERO     FAFCTY                                             BUG8762
     C                     Z-ADD*ZERO     FADATE                                             BUG8762
     C                     Z-ADD*ZERO     FAFSEQ                                             BUG8762
     C           HSAKY1    SETGTFACHSAL1                                                     BUG8762
     C                     READPFACHSAL1                 20                                  BUG8762
     C           FECNUM    IFEQ FACNUM                                                       BUG8762
     C           FEFACL    ANDEQFAFCTY                                                       BUG8762
     C           FECALT    IFEQ '01'                                                         BUG8762
     C           FECALT    OREQ '02'                                                         BUG8762
     C           FECALT    OREQ '03'                                                         BUG8762
     C           FECALT    OREQ '04'                                                         BUG8762
     C           FECALT    OREQ '05'                                                         BUG8762
     C           FECALT    OREQ '06'                                                         BUG8762
     C           FAUNDR    IFGE 0                                                            BUG8762
     C                     Z-ADDFAUNDR    AAMT   130                                         BUG8762
     C                     ELSE                                                              BUG8762
     C                     Z-ADD0         AAMT                                               BUG8762
     C                     END                                                               BUG8762
     C                     ELSE                                                              BUG8762
     C           FECALT    IFEQ '11'                                                         BUG8762
     C           FECALT    OREQ '12'                                                         BUG8762
     C           FECALT    OREQ '13'                                                         BUG8762
     C           FECALT    OREQ '14'                                                         BUG8762
     C           FECALT    OREQ '15'                                                         BUG8762
     C           FECALT    OREQ '16'                                                         BUG8762
     C                     Z-ADDFADRAM    AAMT                                               BUG8762
     C                     ELSE                                                              BUG8762
     C           FECALT    IFEQ '21'                                                         BUG8762
     C           FECALT    OREQ '22'                                                         BUG8762
     C                     Z-ADDFACFAM    AAMT                                               BUG8762
     C                     END                                                               BUG8762
     C                     END                                                               BUG8762
     C                     END                                                               BUG8762
     C                     ELSE                                                              BUG8762
     C                     Z-ADDFAMT      AAMT                                               BUG8762
     C                     ENDIF                                                             BUG8762
     C                     Z-ADD0         WTOT                                               BUG8762
     C                     Z-ADD0         WAMT                                             AR1020182
     C                     MOVE '0'       *IN19   1                                          BUG8762
     C                     MOVE '0'       *IN18                                              BUG8762
     C           *IN18     DOWEQ'0'                                                          BUG8762
     C           HSAKY2    READEFACHSAL1                 18                                  BUG8762
     C*                                                                                      BUG8762
     C           *IN18     IFEQ '1'                                                          BUG8762
     C           FADATE    ORGT ENDATE                                                       BUG8762
     C           BKALDI    ANDNE'Y'                                                          BUG8762
     C           FADATE    ORGE ENDATE                                                       BUG8762
     C           BKALDI    ANDEQ'Y'                                                          BUG8762
     C                     Z-ADDENDATE    FADATE                                             BUG8762
     C                     MOVE '1'       *IN18                                              BUG8762
     C                     END                                                               BUG8762
     C                     Z-ADDSTDATE    ZZBEG                                              BUG8762
     C                     Z-ADDFADATE    ZZEND                                              BUG8762
     C                     MOVE FECALC    ZZCALC                                             BUG8762
     C                     EXSR ZINTDY                                                       BUG8762
     C           FECALC    IFEQ 6                                                            BUG8762
     C*********            Z-ADDINT6DY    NDAYS                                     BUG8762 BUG21892
     C                     Z-ADDINT6DY    NDAYS2                                            BUG21892
     C                     ELSE                                                              BUG8762
     C                     Z-ADDZZINDY    NDAYS   50                                         BUG8762
     C                     END                                                               BUG8762
      *                                                                                      BUG8762
     C           NDAYS     IFGT 0                                                            BUG8762
     C           NDAYS2    ORGT 0                                                           BUG21892
      *                                                                                      BUG8762
      ** Limit the processing for fees based on average amount                               BUG8762
      *                                                                                      BUG8762
     C           FECALT    IFEQ '01'                                                         BUG8762
     C           FECALT    OREQ '02'                                                         BUG8762
     C           FECALT    OREQ '03'                                                         BUG8762
     C           FECALT    OREQ '11'                                                         BUG8762
     C           FECALT    OREQ '12'                                                         BUG8762
     C           FECALT    OREQ '13'                                                         BUG8762
     C           FECALT    OREQ '21'                                                         BUG8762
      *                                                                                      BUG8762
      ** Average amount used (only does accrual once)                                        BUG8762
      *                                                                                      BUG8762
     C           FECALC    IFEQ 6                                                           BUG21892
     C                     MULT NDAYS2    AAMT                                              BUG21892
     C                     DIV  WDAYS2    AAMT      H                                       BUG21892
     C                     ADD  AAMT      WAMT                                              BUG21892
     C                     ELSE                                                             BUG21892
     C                     MULT NDAYS     AAMT                                               BUG8762
     C                     DIV  WDAYS     AAMT      H                                        BUG8762
     C                     ADD  AAMT      WAMT                                               BUG8762
     C                     ENDIF                                                            BUG21892
     C                     ELSE                                                              BUG8762
     C                     Z-ADDAAMT      WAMT                                               BUG8762
     C                     ENDIF                                                             BUG8762
     C                     Z-ADDFADATE    STDATE                                             BUG8762
     C                     END                                                               BUG8762
      *                                                                                      BUG8762
      ** Reset amount to accrue - comes from next record on amounts                          BUG8762
      ** file.                                                                               BUG8762
      *                                                                                      BUG8762
     C           FECALT    IFEQ '01'                                                         BUG8762
     C           FECALT    OREQ '02'                                                         BUG8762
     C           FECALT    OREQ '03'                                                         BUG8762
     C           FECALT    OREQ '04'                                                         BUG8762
     C           FECALT    OREQ '05'                                                         BUG8762
     C           FECALT    OREQ '06'                                                         BUG8762
     C           FAUNDR    IFGE 0                                                            BUG8762
     C                     Z-ADDFAUNDR    AAMT                                               BUG8762
     C                     ELSE                                                              BUG8762
     C                     Z-ADD0         AAMT                                               BUG8762
     C                     END                                                               BUG8762
     C                     ELSE                                                              BUG8762
     C           FECALT    IFEQ '11'                                                         BUG8762
     C           FECALT    OREQ '12'                                                         BUG8762
     C           FECALT    OREQ '13'                                                         BUG8762
     C           FECALT    OREQ '14'                                                         BUG8762
     C           FECALT    OREQ '15'                                                         BUG8762
     C           FECALT    OREQ '16'                                                         BUG8762
     C                     Z-ADDFADRAM    AAMT                                               BUG8762
     C                     ELSE                                                              BUG8762
     C           FECALT    IFEQ '21'                                                         BUG8762
     C           FECALT    OREQ '22'                                                         BUG8762
     C                     Z-ADDFACFAM    AAMT                                               BUG8762
     C                     END                                                               BUG8762
     C                     END                                                               BUG8762
     C                     END                                                               BUG8762
      *                                                                                      BUG8762
     C           FECALT    IFEQ '04'                                                         BUG8762
     C           FECALT    OREQ '05'                                                         BUG8762
     C           FECALT    OREQ '06'                                                         BUG8762
     C           FECALT    OREQ '14'                                                         BUG8762
     C           FECALT    OREQ '15'                                                         BUG8762
     C           FECALT    OREQ '16'                                                         BUG8762
     C           FECALT    OREQ '22'                                                         BUG8762
     C                     EXSR ACCRUE                                                       BUG8762
     C                     ADD  WTOT      WFEE                                               BUG8762
     C                     ENDIF                                                             BUG8762
     C                     ENDDO                                                             BUG8762
     C                     ENDIF                                                             BUG8762
      *                                                                                      BUG8762
     C*                                                                   BH3414
     C           FECALT    IFEQ '01'                                                          204320
     C           FECALT    OREQ '02'                                                          204320
     C           FECALT    OREQ '03'                                                          204320
     C           FECALT    OREQ '11'                                                          204320
     C           FECALT    OREQ '12'                                                          204320
     C           FECALT    OREQ '13'                                                          204320
     C           FECALT    OREQ '21'                                                          204320
     C                     MOVE '1'       *IN19                                               204320
     C                     EXSR ACCRUE                                    BH3414
     C           FEPYON    IFEQ 'N'                                                         MD027397
     C                     Z-ADD0         ZFLD15                                            MD027397
     C                     ELSE                                                             MD027397
     C                     Z-ADDWTOT      WFEE                            BH3414
     C                     ENDIF                                                            MD027397
     C                     ENDIF                                                              204320
     C*                                                                   105265
     C** Forward valued fees should have zero total accrued amount        105265
      ** Same with back valued fees inserted today.                                         MD024830
     C*                                                                   105265
     C           FEPSTD    IFGT BJRDNB                                    105265
     C           FEPSTD    ORLT BJRDNB                                                      MD024830
     C           FEORED    ANDEQBJRDNB                                                      MD024830
     C                     Z-ADD0         WFEE                            105265
     C                     END                                            105265
     C/COPY WNCPYSRC,LEH00720
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C*                                                                   105265
     C                     ENDSR                                          BH3414
     C/COPY WNCPYSRC,LEH00721
      ********************************************************************                    CLE073
     C/EJECT                                                                                  CLE073
     C********************************************************************                    CLE073
     C*                                                                                       CLE073
     C*  AVCALL -- Calculation of fees based on loans                                         CLE073
     C*                                                                                       CLE073
     C*  This sr is based on sr/AVCALC - in case of any change to                             CLE073
     C*  sr/AVCALC (or in case of upgrade) verify whether new changes                         CLE073
     C*  are to be applied to sr/AVCALL as well.                                              CLE073
     C*                                                                                       CLE073
     C*  CALLED FROM: AVCALC                                                                  CLE073
     C*                                                                                       CLE073
     C*  CALLS: ACCRUL                                                                        CLE073
     C*                                                                                       CLE073
     C********************************************************************                    CLE073
     C           AVCALL    BEGSR                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADD0         FE99AM                                              CLE073
     C                     Z-ADD0         WAMT   130                                          CLE073
     C                     Z-ADD0         WPCT    63                                          CLE073
      *                                                                                       CLE073
     C                     MOVE 'A'       WCLRT                                               CLE073
     C                     MOVE WLNRF     WLOAN                                               CLE073
     C           KEY005    CHAINCLOAN                79                                       CLE073
      *                                                                                       CLE073
      ** If Calculation type 99 check if there are backvalued periods                         CLE073
      *                                                                                       CLE073
     C           *LIKE     DEFN FELPAM    FE99AM                                              CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
      *                                                                                       CLE073
     C           FENPYD    IFLT BJRDNB                                                        CLE073
     C                     ADD  FEFAMT    FE99AM                                              CLE073
     C                     ENDIF                                                              CLE073
     C           FEFREQ    IFEQ *BLANKS                                                       CLE073
     C           FENPYD    ANDLEBJRDNB                                                        CLE073
     C                     MOVE FEPEND    FENPYD                                              CLE073
     C                     ENDIF                                                              CLE073
     C           FENPYD    DOWLTBJRDNB                                                        CLE073
     C           FEFREQ    ANDNE*BLANKS                                                       CLE073
     C                     MOVE FENPYD    FELPDT                                              CLE073
     C                     MOVE FENPYD    ZDAYNO                                              CLE073
     C                     Z-ADDFENPYD    ZDAYNO  50                                          CLE073
     C                     MOVE FEDYIM    ZMDAY   20                                          CLE073
     C                     MOVE FEFREQ    ZFREQ   1                                           CLE073
     C                     MOVE BJLCCY    ZCCY    3                                           CLE073
     C**********           MOVE *BLANK    ZZERR   7                                    CLE073 CLE141
     C                     MOVE *BLANK    ZZERR@  7                                           CLE141
      *                                                                                       CLE073
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** FESTTL    ANDEQ1                                                     CLE141 CLE141A
     C           FELOAN    ANDNE*BLANKS                                                       CLE141
     C********** CLE141    OREQ 'Y'                                                   CLE141 CLE141A
     C********** FESTTL    ANDEQ7                                                     CLE141 CLE141A
     C********** FELOAN    ANDNE*BLANKS                                               CLE141 CLE141A
     C********** CLE141    OREQ 'Y'                                                   CLE141 CLE141A
     C********** FESTTL    ANDEQ8                                                     CLE141 CLE141A
     C********** FELOAN    ANDNE*BLANKS                                               CLE141 CLE141A
     C                     EXSR ZFRQB3                                                        CLE141
     C                     MOVELZCCY      CCYLL                                              CLE141A
     C                     MOVEL*BLANKS   PAYIND                                              CLE141
     C                     CALL 'LEZBDYCD'BDCHK                                               CLE141
     C                     MOVELZADJDT    ZDAYNO                                              CLE141
     C                     ELSE                                                               CLE141
     C                     EXSR ZFREQB                                                        CLE073
     C                     ENDIF                                                              CLE141
      *                                                                                       CLE073
     C********** ZZERR     IFNE *BLANK                                                 CLE073 CLE141
     C           ZZERR@    IFNE *BLANK                                                        CLE141
     C                     LEAVE                                                              CLE073
     C                     ENDIF                                                              CLE073
     C********** ZZERR     IFEQ *BLANK                                                 CLE073 CLE141
     C           ZZERR@    IFEQ *BLANK                                                        CLE141
      *                                                                                       CLE073
     C                     MOVE ZDAYNO    FENPYD                                              CLE073
     C           ZDAYNO    IFGT FEPEND                                                        CLE073
     C                     MOVE FEPEND    FENPYD                                              CLE073
     C                     ENDIF                                                              CLE073
     C********** FENPYD    IFLE BJRDNB                                               CLE073 AR738760
     C           FENPYD    IFLT BJRDNB                                                      AR738760
     C                     ADD  FEFAMT    FE99AM                                              CLE073
     C                     ENDIF                                                              CLE073
     C           FENPYD    IFGT BJRDNB                                                        CLE073
     C           FENPYD    OREQ FEPEND                                                        CLE073
     C                     LEAVE                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDDO                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** If Calculation type 99 obtain nr of days from Last Payment                           CLE073
      ** date to Next Payment date                                                            CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C                     Z-ADDFELPDT    STDATE  50     19                                   CLE073
     C   19                Z-ADDFEPSTD    STDATE                                              CLE073
     C                     Z-ADDFENPYD    ENDATE  50                                          CLE073
     C           ENDATE    IFLT BJRDNB                                                        CLE073
     C           ENDATE    ANDEQFELPDT                                                        CLE073
     C                     Z-ADDFEPEND    ENDATE                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Obtain number of days to use.                                                        CLE073
      *                                                                                       CLE073
     C                     Z-ADDSTDATE    ZZBEG                                               CLE073
     C                     Z-ADDENDATE    ZZEND                                               CLE073
     C                     MOVE FECALC    ZZCALC                                              CLE073
     C                     EXSR ZINTDY                                                        CLE073
     C           FECALC    IFEQ 6                                                             CLE073
     C                     Z-ADDINT6DY    WDAYS9                                              CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDZZINDY    WDAYS9  50                                          CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Set up Start and End dates                                                           CLE073
      *                                                                                       CLE073
     C                     Z-ADDFELPDT    STDATE  50     19                                   CLE073
     C   19                Z-ADDFEPSTD    STDATE                                              CLE073
     C                     Z-ADDBJRDNB    ENDATE  50                                          CLE073
     C           FEPEND    IFLE BJRDNB                                                        CLE073
     C                     Z-ADDFEPEND    ENDATE                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** When CLE005 is switched ON, LER135 always use fee start date as                      CLE073
      ** start date for the computation of the number of days                                 CLE073
      *                                                                                       CLE073
     C           *IN30     IFEQ *ON                                                           CLE073
     C                     Z-ADDFEPSTD    STDATE                                              CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDFELADT    STDATE                                              CLE073
     C                     ENDIF                                                              CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C                     Z-ADDFELPDT    STDATE                                              CLE073
     C                     ENDIF                                                              CLE073
     C           STDATE    IFEQ 0                                                             CLE073
     C                     Z-ADDFEPSTD    STDATE                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Obtain number of days to use.                                                        CLE073
      *                                                                                       CLE073
     C           STDATE    IFGT ENDATE                                                        CLE073
     C                     Z-ADDENDATE    STDATE                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     Z-ADDSTDATE    ZZBEG                                               CLE073
     C                     Z-ADDENDATE    ZZEND                                               CLE073
     C                     MOVE FECALC    ZZCALC                                              CLE073
     C                     EXSR ZINTDY                                                        CLE073
     C           FECALC    IFEQ 6                                                             CLE073
     C                     Z-ADDINT6DY    WDAYS                                               CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDZZINDY    WDAYS   50                                          CLE073
     C                     ENDIF                                                              CLE073
     C********** WDAYS     IFEQ 0                                                    CLE073 AR740100
     C********** FECALT    IFNE '99'                                                 CLE073 AR740100
     C********** BKALDI    ORNE 'Y'                                                  CLE073 AR740100
     C**********           Z-ADD1         WDAYS                                      CLE073 AR740100
     C**********           ENDIF                                                     CLE073 AR740100
     C**********           ENDIF                                                     CLE073 AR740100
      *                                                                                       CLE073
      ** Type 99: Fixed Amount                                                                CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C                     Z-ADDFEFAMT    AAMT                                                CLE073
     C                     Z-ADDFEFAMT    WAMT                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Type 98: Loan Original Amount                                                        CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '98'                                                          CLE073
     C           FECALT    OREQ '97'                                                          CLE073
     C           FELOAN    CHAINCLOANK               18                                       CLE073
     C           KEYPHS    CHAINLEHISTLB             22                                       CLE073
     C           *IN22     IFEQ *OFF                                                          CLE073
     C                     Z-ADDPRAMM     OPAMK                                               CLE073
     C                     ENDIF                                                              CLE073
     C           *IN18     IFNE *ON                                                           CLE073
     C           *IN22     ORNE *ON                                                           CLE073
     C                     Z-ADDOPAMK     AAMT                                                CLE073
     C                     Z-ADDOPAMK     WAMT                                                CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     MOVE CCY       CCYP                                                CLE073
      *                                                                                       CLE073
      ** Initialise work fee field.                                                           CLE073
      *                                                                                       CLE073
     C                     Z-ADD0         WFEE   130                                          CLE073
     C                     Z-ADD0         WTOT                                                CLE073
     C                     MOVE '0'       *IN19   1                                           CLE073
     C                     Z-ADDSTDATE    WVDAT                                               CLE073
      *                                                                                       CLE073
      ** Caculation type 97: get amount from loan history file                                CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C                     EXSR CALT97                                                        CLE073
      *                                                                                     AR634880
     C                     Z-ADDWFEE      WFEE1  130                                        AR634880
     C           FELPDT    IFGT 0                                                           AR634880
     C           FEAMTS    ANDGT0                                                           AR634880
     C                     Z-ADDFEPSTD    STDATE                                            AR634880
     C                     Z-ADDFELPDT    ENDATE                                            AR634880
     C                     Z-ADD0         WFEE                                              AR634880
     C                     Z-ADD0         WTOT                                              AR634880
     C                     EXSR CALT97                                                      AR634880
     C           WFEE      SUB  FEAMTS    WDIFF1 130                                        AR634880
     C                     SUB  FEAMTP    WDIFF1                                            AR634880
     C                     ADD  FETADJ    WDIFF1                                            AR634880
     C                     ADD  FEAMTA    WDIFF1                                            AR634880
     C                     SUB  FEWOFF    WDIFF1                                            AR634880
     C                     SUB  FEAMTW    WDIFF1                                            AR634880
     C           WDIFF1    IFEQ 1                                                           AR634880
     C                     SUB  1         WFEE1                                             AR634880
     C                     ENDIF                                                            AR634880
     C           WDIFF1    IFEQ -1                                                          AR634880
     C                     ADD  1         WFEE1                                             AR634880
     C                     ENDIF                                                            AR634880
     C                     ENDIF                                                            AR634880
     C                     Z-ADDWFEE1     WFEE                                              AR634880
     C                     ELSE                                                               CLE073
      *                                                                                       CLE073
      ** Process accrual                                                                      CLE073
      *                                                                                       CLE073
     C                     EXSR ACCRUL                                                        CLE073
     C                     Z-ADDWTOT      WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Forward valued fees should have zero total accrued amount                            CLE073
      *                                                                                       CLE073
     C           FEPSTD    IFGT BJRDNB                                                        CLE073
     C                     Z-ADD0         WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      *                                                                                       CLE073
     C                     ENDSR                                                              CLE073
      *****************************************************************                       CLE073
     C/EJECT                                                              BH3414
     C*****************************************************************   BH3414
     C/TITLE SR/ACCRUE                                                    BH3414
     C*****************************************************************   BH3414
     C*                                                                   BH3414
     C*  ACCRUE - SUBROUTINE TO CALCULATE ACCRUAL AMOUNT                  BH3414
     C*                                                                   BH3414
     C*  CALLED FROM: AVCALC                                              BH3414
     C*                                                                   BH3414
     C*  CALLS: ZXRATE, ZCONV, LSTRAT, AOCURRR0                           BH3414
     C*                                                                   BH3414
     C*****************************************************************   BH3414
     C*                                                                   BH3414
     C           ACCRUE    BEGSR                                          BH3414
     C*                                                                   BH3414
     C                     Z-ADD0         WTOT                            BH3414
     C*                                                                   BH3414
     C** Calculate percentage if required.                                BH3414
     C** Use original facility amount for average.                        BH3414
     C*                                                                   BH3414
     C           FEPIND    IFNE 'A'                                       BH3414
     C***********WAMT      DIV  FHOFAM    WRK155    H               BH3414090266
     C***71***** WAMT      DIV  FHOFAM    WRK155    H                                090266 BUG21935
     C**N71***** WAMT      DIV  FAMT      WRK155    H                                090266 BUG21935
     C********** WRK155    MULT 100       WPCT                                       BH3414 BUG21935
     C***********          Z-ADDFHOFAM    WAMT                      BH3414090266
     C   71      WAMT      DIV  FHOFAM    WRK199    H                                       BUG21935
     C  N71      WAMT      DIV  FAMT      WRK199    H                                       BUG21935
     C           WRK199    MULT 100       WPCT                                              BUG21935
     C   71                Z-ADDFHOFAM    WAMT                            090266
     C  N71                Z-ADDFAMT      WAMT                            090266
     C           WPCT      IFGT 100                                       BH3414
     C                     Z-ADD100       WPCT                            BH3414
     C                     END                                            BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C** Convert from facility to fee currency if required.               BH3414
     C** If exchange rate field on fees master file is blank              BH3414
     C** obtain cross-currency exchange rate for these                    BH3414
     C** two currencies from the standing data files otherwise use        BH3414
     C** exchange rate on fees master file.                               BH3414
     C*                                                                   BH3414
     C           FHFCCY    IFNE FEFCCY                                    BH3414
     C           *IN71     ANDEQ*ON                                       090266
     C           FCCY      ORNE FEFCCY                                    090266
     C           *IN71     ANDEQ*OFF                                      090266
     C                     Z-ADDWAMT      CAMT   130                      BH3414
     C           FEERAT    IFEQ 0                                         BH3414
     C***********          MOVE FHFCCY    INCCY   3                 BH3414090266
     C   71                MOVE FHFCCY    INCCY   3                       090266
     C  N71                MOVE FCCY      INCCY                           090266
     C                     MOVE FEFCCY    OUTCCY  3                       BH3414
     C                     Z-ADD1         X                               BH3414
     C           INCCY     LOKUPCURR,X                   13               BH3414
     C           *IN13     IFEQ '1'                                       BH3414
     C                     MOVE MTDV,X    ZMDI1   1                       BH3414
     C                     Z-ADDCSPT,X    ZRATE1 138                      BH3414
     C                     Z-ADDCCDP,X    ZNBDP1  10                      BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C                     Z-ADD1         X                               BH3414
     C           OUTCCY    LOKUPCURR,X                   14               BH3414
     C           *IN14     IFEQ '1'                                       BH3414
     C                     MOVE MTDV,X    ZMDI2   1                       BH3414
     C                     Z-ADDCSPT,X    ZRATE2 138                      BH3414
     C                     Z-ADDCCDP,X    ZNBDP2  10                      BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C** Obtain cross exchange rate & cross multiply/divide indicator.    BH3414
     C*                                                                   BH3414
     C                     EXSR ZXRATE                                    BH3414
     C*                                                                   BH3414
     C** Set up input fields for conversion subroutine.                   BH3414
     C*                                                                   BH3414
     C                     Z-ADDZRATEX    ZEXCH  138                      BH3414
     C                     MOVE ZMDIX     ZMD     1                       BH3414
     C                     Z-ADDCAMT      ZAMTCI 150                      BH3414
     C                     MOVE INCCY     ZCCYI   3                       BH3414
     C                     MOVE OUTCCY    ZCCYO   3                       BH3414
     C                     Z-ADDZNBDP1    ZCDPI   10                      BH3414
     C                     Z-ADDZNBDP2    ZCDPO   10                      BH3414
     C*                                                                   BH3414
     C                     EXSR ZCONV                                     BH3414
     C*                                                                   BH3414
     C                     Z-ADDZAMTCO    CAMT                            BH3414
     C*                                                                   BH3414
     C** Exchange rate not blank                                          BH3414
     C*                                                                   BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C                     CALL 'AOCURRR0'                                BH3414
     C                     PARM '*MSG   ' WRTCD   7                       BH3414
     C                     PARM '*KEY   ' WOPTN   7                       BH3414
     C***********          PARM FHFCCY    WAJCD   3                BH3414 157894
     C                     PARM FCCY      WAJCD   3                       157894
     C           SDCURR    PARM SDCURR    DSSDY                           BH3414
     C           WRTCD     IFNE *BLANKS                                   BH3414
     C           *LOCK     IN   LDA                                       BH3414
     C                     MOVEL'LER115'  DBPGM                           BH3414
     C                     MOVEL'SDCURRPD'DBFILE           ************   BH3414
     C                     Z-ADD18        DBASE            * DBERR 18 *   BH3414
     C***********          MOVELFHFCCY    DBKEY            ********BH3414 157894
     C                     MOVELWAJCD     DBKEY                           157894
     C                     OUT  LDA                                       BH3414
     C                     EXSR *PSSR                                     BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C** Set up currency decimal place power position.                    BH3414
     C*                                                                   BH3414
     C           A6NBDP    ADD  4         FD      10                      BH3414
     C*                                                                   BH3414
     C** Fee currency decimal places + 1.                                 BH3414
     C*                                                                   BH3414
     C                     Z-ADDP         TD      10                      BH3414
     C*                                                                   BH3414
     C** Adjust incoming amount for from CCY decimal places.              BH3414
     C*                                                                   BH3414
     C           CAMT      DIV  POWER,FD  WRK153                          BH3414
     C*                                                                   BH3414
     C** Exchange rate conversion.                                        BH3414
     C*                                                                   BH3414
     C           FEMDIN    IFEQ 'M'                                       BH3414
     C                     MULT FEERAT    WRK153                          BH3414
     C                     ELSE                                           BH3414
     C                     DIV  FEERAT    WRK153    H                     BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C** Adjust calculated amount for to currency decimal places.         BH3414
     C*                                                                   BH3414
     C           WRK153    MULT POWER,TD  CAMT                            BH3414
     C*                                                                   BH3414
     C                     END                                            BH3414
     C                     Z-ADDCAMT      WAMT                            BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C** Look up factor for division corresponding to calc. basis         BH3414
     C*                                                                   BH3414
     C                     MOVE '0'       *IN25                           BH3414
     C           FECALC    LOKUPTABCAL    TABCBS         25               BH3414
     C                     MOVE TABCBS    WCBS    50                      BH3414
     C*                                                                   BH3414
     C** TIERED CALCULATION:                                              BH3414
     C** ------------------                                               BH3414
     C*                                                                   BH3414
     C           FECALT    IFEQ '01'                                      BH3414
     C           FECALT    OREQ '04'                                      BH3414
     C           FECALT    OREQ '11'                                      BH3414
     C           FECALT    OREQ '14'                                      BH3414
     C*                                                                   BH3414
     C** Amount (not percentage)                                          BH3414
     C*                                                                   BH3414
     C           FEPIND    IFEQ 'A'                                       BH3414
     C*                                                                   BH3414
     C** Convert limit amounts for fee decimal places.                    BH3414
     C*                                                                   BH3414
     C           FEAM      MULT POWER,P   FAM                             BH3414
     C                     Z-ADD0         WFAM                            BH3414
     C                     Z-ADDWAMT      WOAMT                           BH3414
     C                     Z-ADD1         X                               BH3414
     C           WAMT      DOWGT0                                         BH3414
     C           X         ANDLT6                                         BH3414
     C*                                                                   BH3414
     C           WOAMT     IFLT FAM,X                                     BH3414
     C           FAM,X     OREQ 0                                         BH3414
     C           WAMT      MULT FRT,X     WRK15                           BH3414
     C                     ELSE                                           BH3414
     C           FAM,X     SUB  WFAM      WRK15                           BH3414
     C                     MULT FRT,X     WRK15                           BH3414
     C                     END                                            BH3414
     C                     ADD  WRK15     WTOT                            BH3414
     C                     SUB  FAM,X     WAMT                            BH3414
     C                     ADD  WFAM      WAMT                            BH3414
     C                     Z-ADDFAM,X     WFAM                            BH3414
     C*                                                                   BH3414
     C                     ADD  1         X                               BH3414
     C*                                                                   BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C** Calculate final accrual amount.                                  BH3414
     C*                                                                   BH3414
     C           *IN19     IFEQ '1'                                                           204320
      *                                                                                       204320
      ** if based on average use WDAYS                                                        204320
      *                                                                                       204320
     C           FECALC    IFEQ 6                                                           BUG21892
     C                     MULT WDAYS2    WTOT                                              BUG21892
     C                     ELSE                                                             BUG21892
     C                     MULT WDAYS     WTOT                            BH3414
     C                     ENDIF                                                            BUG21892
     C                     ELSE                                                               204320
     C           FECALC    IFEQ 6                                                           BUG21892
     C                     MULT NDAYS2    WTOT                                              BUG21892
     C                     ELSE                                                             BUG21892
     C                     MULT NDAYS     WTOT                                                204320
     C                     ENDIF                                                            BUG21892
     C                     ENDIF                                                              204320
     C                     DIV  WCBS      WTOT      H                     BH3414
     C*                                                                   BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C** - PERCENTAGE:                                                    BH3414
     C*                                                                   BH3414
     C           FEAM      DIV  1000      FPC                             BH3414
     C*                                                                   BH3414
     C                     Z-ADD0         WFPC                            BH3414
     C                     Z-ADDWPCT      WOPCT                           BH3414
     C                     Z-ADD1         X                               BH3414
     C           WPCT      DOWGT0                                         BH3414
     C           X         ANDLT6                                         BH3414
     C*                                                                   BH3414
     C           WOPCT     IFLT FPC,X                                     BH3414
     C           FPC,X     OREQ 0                                         BH3414
     C           WAMT      MULT WPCT      WRK15                           BH3414
     C                     ELSE                                           BH3414
     C           FPC,X     SUB  WFPC      WRK63                           BH3414
     C           WAMT      MULT WRK63     WRK15                           BH3414
     C                     END                                            BH3414
     C                     MULT FRT,X     WRK15                           BH3414
     C                     DIV  100       WRK15     H                     BH3414
     C                     ADD  WRK15     WTOT                            BH3414
     C                     SUB  FPC,X     WPCT                            BH3414
     C                     ADD  WFPC      WPCT                            BH3414
     C                     Z-ADDFPC,X     WFPC                            BH3414
     C*                                                                   BH3414
     C                     ADD  1         X                               BH3414
     C*                                                                   BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C** Calculate final accrual amount.                                  BH3414
     C*                                                                   BH3414
     C           *IN19     IFEQ '1'                                                           204320
      *                                                                                       204320
     C           FECALC    IFEQ 6                                                           BUG21892
     C                     MULT WDAYS2    WTOT                                              BUG21892
     C                     ELSE                                                             BUG21892
     C                     MULT WDAYS     WTOT                            BH3414
     C                     ENDIF                                                            BUG21892
     C                     ELSE                                                               204320
     C           FECALC    IFEQ 6                                                           BUG21892
     C                     MULT NDAYS2    WTOT                                              BUG21892
     C                     ELSE                                                             BUG21892
     C                     MULT NDAYS     WTOT                                                204320
     C                     ENDIF                                                            BUG21892
     C                     ENDIF                                                              204320
     C                     DIV  WCBS      WTOT      H                     BH3414
     C*                                                                   BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C** THRESHOLD CALCULATION:                                           BH3414
     C** ---------------------                                            BH3414
     C*                                                                   BH3414
     C           FECALT    IFEQ '02'                                      BH3414
     C           FECALT    OREQ '05'                                      BH3414
     C           FECALT    OREQ '12'                                      BH3414
     C           FECALT    OREQ '15'                                      BH3414
     C*                                                                   BH3414
     C** - AMOUNT:                                                        BH3414
     C*                                                                   BH3414
     C           FEPIND    IFEQ 'A'                                       BH3414
     C*                                                                   BH3414
     C** Convert limit amounts for fee decimal places.                    BH3414
     C*                                                                   BH3414
     C           FEAM      MULT POWER,P   FAM                             BH3414
     C*                                                                   BH3414
     C** Search amount array to find value larger or equal.               BH3414
     C*                                                                   BH3414
     C                     Z-ADD1         X                               BH3414
     C                     MOVE '0'       *IN25                           BH3414
     C*                                                                   BH3414
     C           WAMT      LOKUPFAM,X                25  25               BH3414
     C           *IN25     IFEQ '0'                                       BH3414
     C                     EXSR LSTRAT                                    BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C           *IN25     IFEQ '0'                                       BH3414
     C           Y         ANDEQ0                                         BH3414
     C                     MULT 0         WAMT                            BH3414
     C                     ELSE                                           BH3414
     C                     MULT FRT,X     WAMT                            BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C           *IN19     IFEQ '1'                                                           204320
      *                                                                                       204320
     C           FECALC    IFEQ 6                                                           BUG21892
     C           WAMT      MULT WDAYS2    WTOT                                              BUG21892
     C                     ELSE                                                             BUG21892
     C           WAMT      MULT WDAYS     WTOT                            BH3414
     C                     ENDIF                                                            BUG21892
     C                     ELSE                                                               204320
     C           FECALC    IFEQ 6                                                           BUG21892
     C           WAMT      MULT NDAYS2    WTOT                                              BUG21892
     C                     ELSE                                                             BUG21892
     C           WAMT      MULT NDAYS     WTOT                                                204320
     C                     ENDIF                                                            BUG21892
     C                     ENDIF                                                              204320
     C                     DIV  WCBS      WTOT      H                     BH3414
     C*                                                                   BH3414
     C                     ELSE                                           BH3414
     C*                                                                   BH3414
     C** - PERCENTAGE:                                                    BH3414
     C*                                                                   BH3414
     C           FEAM      DIV  1000      FPC                             BH3414
     C*                                                                   BH3414
     C** Search percentage array to find value larger or equal.           BH3414
     C*                                                                   BH3414
     C                     Z-ADD1         X                               BH3414
     C                     MOVE '0'       *IN25                           BH3414
     C           WPCT      LOKUPFPC,X                25  25               BH3414
     C           *IN25     IFEQ '0'                                       BH3414
     C                     EXSR LSTRAT                                    BH3414
     C                     END                                            BH3414
     C**********           MULT WPCT      WAMT                                       BH3414 BUG21935
     C                     MULT 100       WRK199                                            BUG21935
     C                     MULT WRK199    WAMT                                              BUG21935
     C*                                                                   BH3414
     C           *IN25     IFEQ '0'                                       BH3414
     C           Y         ANDEQ0                                         BH3414
     C                     MULT 0         WAMT                            BH3414
     C                     ELSE                                           BH3414
     C                     MULT FRT,X     WAMT                            BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C                     DIV  100       WAMT      H                     BH3414
     C           *IN19     IFEQ '1'                                                           204320
      *                                                                                       204320
     C           FECALC    IFEQ 6                                                           BUG21892
     C           WAMT      MULT WDAYS2    WTOT                                              BUG21892
     C                     ELSE                                                             BUG21892
     C           WAMT      MULT WDAYS     WTOT                            BH3414
     C                     ENDIF                                                            BUG21892
     C                     ELSE                                                               204320
     C           FECALC    IFEQ 6                                                           BUG21892
     C           WAMT      MULT NDAYS2    WTOT                                              BUG21892
     C                     ELSE                                                             BUG21892
     C           WAMT      MULT NDAYS     WTOT                                                204320
     C                     ENDIF                                                            BUG21892
     C                     ENDIF                                                              204320
     C                     DIV  WCBS      WTOT      H                     BH3414
     C*                                                                   BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C** SINGLE CALCULATION:                                              BH3414
     C** ------------------                                               BH3414
     C*                                                                   BH3414
     C           FECALT    IFEQ '03'                                      BH3414
     C           FECALT    OREQ '06'                                      BH3414
     C           FECALT    OREQ '13'                                      BH3414
     C           FECALT    OREQ '16'                                      BH3414
     C           FECALT    OREQ '21'                                      BH3414
     C           FECALT    OREQ '22'                                      BH3414
     C*                                                                   BH3414
     C           WAMT      MULT FRT,1     WTOT                            BH3414
     C           *IN19     IFEQ '1'                                                           204320
      *                                                                                       204320
     C           FECALC    IFEQ 6                                                           BUG21892
     C                     MULT WDAYS2    WTOT                                              BUG21892
     C                     ELSE                                                             BUG21892
     C                     MULT WDAYS     WTOT                            BH3414
     C                     ENDIF                                                            BUG21892
     C                     ELSE                                                               204320
     C           FECALC    IFEQ 6                                                           BUG21892
     C                     MULT NDAYS2    WTOT                                              BUG21892
     C                     ELSE                                                             BUG21892
     C                     MULT NDAYS     WTOT                                                204320
     C                     ENDIF                                                            BUG21892
     C                     ENDIF                                                              204320
     C                     DIV  WCBS      WTOT      H                     BH3414
     C*                                                                   BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C                     ENDSR                                          BH3414
     C*                                                                   BH3414
      *****************************************************************                       CLE073
      /EJECT                                                                                  CLE073
      *****************************************************************                       CLE073
      /TITLE SR/ACCRUL                                                                        CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
      *  ACCRUL - SUBROUTINE TO CALCULATE ACCRUAL AMOUNT                                      CLE073
      *                                                                                       CLE073
      *  CALLED FROM: AVCALL                                                                  CLE073
      *                                                                                       CLE073
      *  CALLS: ZXRATE, ZCONV, LSTRAT, AOCURRR0                                               CLE073
      *                                                                                       CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
     C           ACCRUL    BEGSR                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADD0         WTOT                                                CLE073
     C                     Z-ADD0         WRK15                                               CLE073
     C           WAMT      IFNE 0                                                B* AMNT      CLE073
      *                                                                                       CLE073
      ** Convert from Loan ccy to fee currency if required.                                   CLE073
      ** If exchange rate field on fees master file is blank                                  CLE073
      ** obtain cross-currency exchange rate for these                                        CLE073
      ** two currencies from the standing data files otherwise use                            CLE073
      ** exchange rate on fees master file.                                                   CLE073
      *                                                                                       CLE073
     C           CCYP      IFNE FEFCCY                                                        CLE073
     C                     Z-ADDWAMT      CAMT   130                                          CLE073
     C           FEERAT    IFEQ 0                                                             CLE073
     C                     MOVE CCYP      INCCY   3                                           CLE073
     C                     MOVE FEFCCY    OUTCCY  3                                           CLE073
     C                     Z-ADD1         X                                                   CLE073
     C           INCCY     LOKUPCURR,X                   13                                   CLE073
     C           *IN13     IFEQ '1'                                                           CLE073
     C                     MOVE MTDV,X    ZMDI1   1                                           CLE073
     C                     Z-ADDCSPT,X    ZRATE1 138                                          CLE073
     C                     Z-ADDCCDP,X    ZNBDP1  10                                          CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADD1         X                                                   CLE073
     C           OUTCCY    LOKUPCURR,X                   14                                   CLE073
     C           *IN14     IFEQ '1'                                                           CLE073
     C                     MOVE MTDV,X    ZMDI2   1                                           CLE073
     C                     Z-ADDCSPT,X    ZRATE2 138                                          CLE073
     C                     Z-ADDCCDP,X    ZNBDP2  10                                          CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Obtain cross exchange rate & cross multiply/divide indicator.                        CLE073
      *                                                                                       CLE073
     C                     EXSR ZXRATE                                                        CLE073
      *                                                                                       CLE073
      ** Set up input fields for conversion subroutine.                                       CLE073
      *                                                                                       CLE073
     C                     Z-ADDZRATEX    ZEXCH  138                                          CLE073
     C                     MOVE ZMDIX     ZMD     1                                           CLE073
     C                     Z-ADDCAMT      ZAMTCI 150                                          CLE073
     C                     MOVE INCCY     ZCCYI   3                                           CLE073
     C                     MOVE OUTCCY    ZCCYO   3                                           CLE073
     C                     Z-ADDZNBDP1    ZCDPI   10                                          CLE073
     C                     Z-ADDZNBDP2    ZCDPO   10                                          CLE073
      *                                                                                       CLE073
     C                     EXSR ZCONV                                                         CLE073
     C                     Z-ADDZAMTCO    CAMT                                                CLE073
      *                                                                                       CLE073
      ** Exchange rate not blank                                                              CLE073
      *                                                                                       CLE073
     C                     ELSE                                                               CLE073
      *                                                                                       CLE073
     C                     CALL 'AOCURRR0'                                                    CLE073
     C                     PARM '*MSG   ' WRTCD   7                                           CLE073
     C                     PARM '*KEY   ' WOPTN   7                                           CLE073
     C                     PARM CCYP      WAJCD   3                                           CLE073
     C           SDCURR    PARM SDCURR    DSSDY                                               CLE073
     C           WRTCD     IFNE *BLANKS                                                       CLE073
     C           *LOCK     IN   LDA                                                           CLE073
     C                     MOVEL'LER115'  DBPGM                                               CLE073
     C                     MOVEL'SDCURRPD'DBFILE                                              CLE073
     C                     Z-ADD21        DBASE                                               CLE073
     C                     MOVELWAJCD     DBKEY                                               CLE073
     C                     OUT  LDA                                                           CLE073
     C                     EXSR *PSSR                                                         CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Set up currency decimal place power position.                                        CLE073
      *                                                                                       CLE073
     C           A6NBDP    ADD  4         FD      10                                          CLE073
      *                                                                                       CLE073
      ** Fee currency decimal places + 1.                                                     CLE073
      *                                                                                       CLE073
     C                     Z-ADDP         TD      10                                          CLE073
      *                                                                                       CLE073
      ** Adjust incoming amount for from CCY decimal places.                                  CLE073
      *                                                                                       CLE073
     C           CAMT      DIV  POWER,FD  WRK153                                              CLE073
      *                                                                                       CLE073
      ** Exchange rate conversion.                                                            CLE073
      *                                                                                       CLE073
     C           FEMDIN    IFEQ 'M'                                                           CLE073
     C                     MULT FEERAT    WRK153                                              CLE073
     C                     ELSE                                                               CLE073
     C                     DIV  FEERAT    WRK153    H                                         CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Adjust calculated amount for to currency decimal places.                             CLE073
      *                                                                                       CLE073
     C           WRK153    MULT POWER,TD  CAMT                                                CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
     C                     Z-ADDCAMT      WAMT                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Look up factor for division corresponding to calc. basis                             CLE073
      *                                                                                       CLE073
     C                     MOVE '0'       *IN25                                               CLE073
     C           FECALC    LOKUPTABCAL    TABCBS         25                                   CLE073
     C                     MOVE TABCBS    WCBS    50                                          CLE073
      *                                                                                       CLE073
      ** Apply rate                                                                           CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C                     Z-ADD1         X                                                   CLE073
     C           WAMT      IFGT 0                                                             CLE073
     C           FRT,X     ANDGT0                                                             CLE073
     C           WAMT      MULT FRT,X     WRK15                                               CLE073
     C                     ADD  WRK15     WTOT                                                CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C                     Z-ADDWAMT      WTOT                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Calculate final accrual amount.                                                      CLE073
      *                                                                                       CLE073
     C           WDAYS9    IFEQ 0                                                             CLE073
     C                     Z-ADD1         WDAYS9                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     MULT WDAYS     WTOT                                                CLE073
      *                                                                                       CLE073
     C           WTOT      IFNE 0                                                             CLE073
     C           FECALT    IFNE '99'                                                          CLE073
     C           FECALT    ANDNE'90'                                                          CLE134
     C                     DIV  WCBS      WTOT      H                                         CLE073
     C                     ELSE                                                               CLE073
     C                     DIV  WDAYS9    WTOT      H                                         CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDSR                                                              CLE073
      *****************************************************************                       CLE073
      /EJECT                                                                                  CLE073
      *****************************************************************                       CLE073
      /TITLE SR/CALT97                                                                        CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
      *  CALT97 - Subroutine for calculation 97 amount calculations                           CLE073
      *                                                                                       CLE073
      *  CALLED FROM: AVCALL                                                                  CLE073
      *                                                                                       CLE073
      *  CALLS:                                                                               CLE073
      *                                                                                       CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
     C           CALT97    BEGSR                                                              CLE073
      *                                                                                       CLE073
      ** Initialise work fields                                                               CLE073
      *                                                                                       CLE073
     C                     Z-ADD0         WAMT   130                                          CLE073
     C                     Z-ADD0         AAMT   130                                          CLE073
     C                     Z-ADDSTDATE    WVDAT                                               CLE073
      *                                                                                       CLE073
      ** Get amount from loan history file                                                    CLE073
      *                                                                                       CLE073
     C                     Z-ADDOPAMK     AAMT                                                CLE073
     C                     Z-ADD999       WLASN                                               CLE073
     C           KEYHST    SETGTLEHISTLA                                                      CLE073
     C           KEYPHS    REDPELEHISTLA                 18                                   CLE073
     C           *IN18     IFEQ *OFF                                                          CLE073
     C                     Z-ADDCPAMP     AAMT                                                CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADD001       WLASN                                               CLE073
     C           KEYHST    SETLLLEHISTLA                 18                                   CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Read file until date read is greater than date of end of                             CLE073
      ** this accrual period.                                                                 CLE073
      ** NDAYS is the number of days in this accrual.                                         CLE073
      *                                                                                       CLE073
     C                     MOVE '0'       *IN18                                               CLE073
     C           *IN18     DOWEQ'0'                                                           CLE073
     C           KEYPHS    READELEHISTLA                 18                                   CLE073
      *                                                                                       CLE073
     C           *IN18     IFEQ '1'                                                           CLE073
     C           VDATP     ORGT ENDATE                                                        CLE073
     C                     Z-ADDENDATE    VDATP                                               CLE073
     C                     MOVE '1'       *IN18                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADDSTDATE    ZZBEG                                               CLE073
     C           VDATP     IFGT STDATE                                                        CLE073
     C                     Z-ADDVDATP     ZZEND                                               CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDSTDATE    ZZEND                                               CLE073
     C                     ENDIF                                                              CLE073
     C                     MOVE FECALC    ZZCALC                                              CLE073
     C                     EXSR ZINTDY                                                        CLE073
     C           FECALC    IFEQ 6                                                             CLE073
     C                     Z-ADDINT6DY    NDAYS                                               CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDZZINDY    NDAYS   50                                          CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           NDAYS     IFGT 0                                                             CLE073
     C                     Z-ADDAAMT      WAMT                                                CLE073
     C                     Z-ADDNDAYS     WDAYS                                               CLE073
     C                     EXSR ACCRUL                                                        CLE073
     C                     ADD  WTOT      WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
     C           VDATP     IFGT STDATE                                                        CLE073
     C                     Z-ADDVDATP     STDATE                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Reset amount to accrue - comes from next record on amounts                           CLE073
      ** file.                                                                                CLE073
      *                                                                                       CLE073
     C           *IN18     IFNE '1'                                                           CLE073
     C                     Z-ADDCPAMP     AAMT                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDDO                                                              CLE073
      *                                                                                       CLE073
     C                     ENDSR                                                              CLE073
      *****************************************************************                       CLE073
      /EJECT                                                                                  CLE073
      *                                                                                       CLE073
     C********************************************************************BH3414
     C*                                                                   BH3414
     C*  LSTRAT SUBROUTINE TO FIND LAST RATE IN AMOUNT/%AGE ARRAY.        BH3414
     C*                                                                   BH3414
     C*  CALLED FROM:  ACCRUE                                             BH3414
     C*                                                                   BH3414
     C*  CALLS:  NOTHING                                                  BH3414
     C*                                                                   BH3414
     C*****************************************************************   BH3414
     C*                                                                   BH3414
     C           LSTRAT    BEGSR                                          BH3414
     C*                                                                   BH3414
     C                     Z-ADD5         Y       20                      BH3414
     C           Y         DOWGT0                                         BH3414
     C           FEAM,Y    IFEQ 0                                         BH3414
     C           FRT,Y     ANDNE0                                         BH3414
     C                     Z-ADDY         X                               BH3414
     C                     Z-ADD0         Y                               BH3414
     C                     END                                            BH3414
     C                     SUB  1         Y                               BH3414
     C                     END                                            BH3414
     C*                                                                   BH3414
     C                     ENDSR                                          BH3414
     C*                                                                   BH3414
      *****************************************************************   154104
      /EJECT                                                              154104
      *****************************************************************   154104
      *                                                               *   154104
      *  SROSAM - Calculate the outstanding amount for fees with      *   154104
      *           settlements and adjustments.                        *   154104
      *                                                               *   154104
      *  Called by: SETTLE                                            *   154104
      *                                                               *   154104
      *  Calls: AVCALC                                                *   154104
      *                                                               *   154104
      *****************************************************************   154104
     C           SROSAM    BEGSR                                          154104
      *                                                                   154104
      ** Non-calculated fees                                              154104
      *                                                                   154104
     C           FECALT    IFEQ *BLANKS                    *B001*         154104
      *                                                                   154104
     C                     Z-ADDFEAMTO    ZFLD15                          154104
      *                                                                   154104
     C                     ELSE                            *X001*         154104
      *                                                                   154104
      ** For calculated fees based on averages, need to calculate         154104
      ** what the value would be if today was payment date                154104
      *                                                                   154104
     C           FECALT    IFEQ '01'                       *B002*         154104
     C           FECALT    OREQ '02'                                      154104
     C           FECALT    OREQ '03'                                      154104
     C           FECALT    OREQ '11'                                      154104
     C           FECALT    OREQ '12'                                      154104
     C           FECALT    OREQ '13'                                      154104
     C           FECALT    OREQ '21'                                      154104
      *                                                                   154104
     C                     EXSR AVCALC                                    154104
     C           FEPYON    IFEQ 'N'                                                         MD027397
     C                     Z-ADD0         WFEE                                              MD027397
     C                     ENDIF                                                            MD027397
     C           WFEE      ADD  FEAMTP    ZFLD15                          154104
      *                                                                                       CLE134
      ** suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     ADD  FESFA     ZFLD15                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      *                                                                   154104
     C                     ELSE                            *X002*         154104
      *                                                                   154104
      ** Actual amount fees                                               154104
      *                                                                   154104
     C                     EXSR AVCALC                                    154104
     C           WFEE      ADD  FEADAT    ZFLD15                          154104
     C                     ADD  FELPAM    ZFLD15                          154104
     C                     ADD  FEAMTP    ZFLD15                          154104
      *                                                                                       CLE134
      ** suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     ADD  FESFA     ZFLD15                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                   154104
     C                     ENDIF                           *E002*         154104
      *                                                                   154104
     C                     ENDIF                           *E001*         154104
      *                                                                   154104
     C                     ENDSR                                          154104
      *****************************************************************   154104
      /EJECT                                                              154104
      *****************************************************************
      *                                                               *
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *                                                               *
      * Called by: Main Processing, INIT, PROCES, DETSCR              *
      *                                                               *
      * Calls: None                                                   *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           ** *PSSR SR **
      *
     C           @RUN      IFEQ *BLANK
     C                     MOVE 'Y'       @RUN    1
      *
     C***********          SETON                     U7U8LR               090266
     C                     SETON                     LR                   090266
     C                     MOVE 'E'       RTRNC                           090266
     C                     RETRN
     C                     END
     C                     ENDSR
      *
      ********************************************************************
     C/COPY ZSRSRC,ZDATE1Z2                                                                   CLE073
     C/COPY ZSRSRC,ZCHKH                                                                      CLE073
     C/COPY ZSRSRC,ZFREQBZ2                                                                   CLE073
     C/COPY ZSRSRC,ZACCH                                                                      CLE073
     C/TITLE SR/ZDATE2
     C/COPY ZSRSRC,ZDATE2Z2
     C/TITLE SR/ZFRPED
     C/COPY ZSRSRC,ZFRPEDZ3
     C/TITLE SR/ZXRATE
     C/COPY ZSRSRC,ZXRATEZ1
     C/TITLE SR/ZCONV
     C/COPY ZSRSRC,ZCONVZ1
     C/COPY ZSRSRC,ZINTDYZ2                                               CLE013
     C/COPY ZSRSRC,ZDATE9Z3                                               CLE013
     C/COPY ZSRSRC,ZDAT10Z2                                               CLE013
     C/COPY ZSRSRC,ZFRQB3                                                                     CLE141
      ********************************************************************
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   TABCAL/TABCBS - CALCULATION BASES.
136500236000336000436500536000636600
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH                                                     CLE073
312831303130313130313031                                                                      CLE073
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN    CLE013
00366007310109601461                                                      CLE013
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR       CLE013
00000000310005900090001200015100181002120024300273003040033400365         CLE013
